{"version":3,"mappings":"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","names":["ChatMessageList","React.forwardRef","className","jsx","cn","ref","props","children","useChatApplicationData","useState","mainEmbeddingInfo","setMainEmbeddingInfo","threadInfo","mainLLMInfo","retriverInfo","setRetriverInfo","setCurrentDataNode","onThreadMessagesLoadedRef","useRef","currentSession","useSessionState","state","loadModel","useLoadModel","sessionPassphraseDialogRef","SessionPassphraseDialog","selectDataNode","useCallback","getRepository","dataNode","jsonData","addNewDataNode","input","threadNode","systemPrompt","prompt","initialMessages","jsonDataNode","sessionId","chatInfo","prompts","threadData","getRetrieveVectorDatabase","placeholderInfo","info","connections","findFlowNodesWithSource","In","connection","result","item","promptNode","node","vectorDatabaseNode","nodeData","promptEntity","vectorDatabaseEntity","getChatApplicationData","thread","threadConnections","threadConnectedNodes","flowNodes","llm","passphraseConfirm","promptInfo","embeddingNode","embeddingEntity","setLLMInfo","setThreadInfo","schemaEntity","schemaInfo","schemaItems","setChatInfo","sessionHandleStatus","loadLLM","pre","LLMStatusEnum","data","onThreadMessagesLoaded","callback","updateMessagesData","currentDataNode","useEffect","useSendMessage","chatApplicationData","similaritySearchWithScore","placeholderRecord","FlowNodePlaceholderTypeEnum","minimalScore","content","documents","template","PromptTemplate","AIMessage","score","doc","injectedMessages","handlePlaceholders","message","onInjectedMessages","formatedMessages","SystemMessage","HumanMessage","onResponseMessageCreate","stream","schema","onMessageUpdate","response","DeleteChatDataNodeDialog","create","onDelete","t","useModal","useToast","handleSubmit","setLoading","currentModal","toast","AlertDialog","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","memo","progress","useTranslation","llmInfo","__vitePreload","functionCallingModelIds","prebuiltAppConfig","hasCache","LazyIcon","LLMIcon","Card","jsxs","llmIcon","LLMInfo","status","Button","handleLoadLLM","useVectorDatabaseActions","loading","similaritySearchWithScoreFunction","useEmbedding","options","VectorDatabaseStorageEnum","indexData","Document","handledCount","partDocuments","chunkedDocuments","indexFunction","setProgress","vectorDatabaseData","useMemo","headers","decodeLine","row","args","file","reader","e","blob","pdfjs","handleCreateData","renderContent","mode","TabsContent","VectorSearch","IndexNewText","IndexNewFile","handleIndexPDF","DataViewer","Dialog","DialogContent","DialogHeader","Tabs","setMode","TabsList","TabsTrigger","chatList","setChatList","threadDataEdged","flowNodeDatas","edge","all","entity","allEdges","getChatList","deleteChat","ChatPanel","onSelectThread","onAddNewThread","changeLLMOptions","React.useState","vectorDatabaseDialog","React.useCallback","handleDeleteDataNode","deleteChatDataNodeDialog","handleChangeOptions","React.useMemo","convertToZodSchemaString","Sidebar","SidebarGroupLabel","SidebarContent","SidebarMenu","index","SidebarMenuItem","key","React.Suspense","MessageLoading","ChatLLMInfo","AVATAR_NAME","createAvatarContext","createAvatarScope","createContextScope","AvatarProvider","forwardedRef","avatarProps","imageLoadingStatus","setImageLoadingStatus","Avatar","AvatarImage","__scopeAvatar","src","onLoadingStatusChange","useAvatarContext","IMAGE_NAME","context","useLayoutEffect","handleLoadingStatusChange","Primitive","FALLBACK_NAME","AvatarFallback","canRender","setCanRender","delayMs","React.useEffect","timerId","fallbackProps","useImageLoadingStatus","loadingStatus","setLoadingStatus","updateStatus","image","referrerPolicy","Root","Image","Fallback","AvatarPrimitive.Root","AvatarPrimitive.Image","AvatarPrimitive.Fallback","chatBubbleVariant","ChatBubble","layout","variant","React.isValidElement","React.cloneElement","fallback","chatBubbleMessageVariants","isLoading","ChatBubbleMessage","size","onClick","ChatItem","isSchema","onActionClick","MarkdownViewer","ChatBubbleAvatar","isGenerating","isLastMessage","Suspense","Fragment","ChatAiIcons","iconIndex","ChatBubbleAction","icon","useUpdateLLMOptions","ChatApplication","messagesRef","sendMessage","messages","setInput","setMessages","_input","init","setIsGenerating","body","nanoid","lastMessage","isScrolling","newMessages","newMessageId","scrollToBottom","cleandUp","onSubmit","_value","handleActionClick","action","reload","handleStopScroll","SidebarInset","AIInput"],"ignoreList":[10],"sources":["../../src/lib/shadcn/chat/chat-message-list.tsx","../../src/components/pages/ChatApplication/hooks/use-chat-application-data.ts","../../src/components/pages/ChatApplication/hooks/use-send-message.ts","../../src/components/dialogs/DeleteChatDataNodeDialog/index.tsx","../../src/lib/shadcn/chat/message-loading.tsx","../../src/components/pages/ChatApplication/components/ChatLLMInfo.tsx","../../src/components/pages/ChatApplication/hooks/use-vector-database-actions.ts","../../src/components/pages/ChatApplication/components/VectorDatabaseDialog/index.tsx","../../src/components/pages/ChatApplication/hooks/use-chat-list.ts","../../src/components/pages/ChatApplication/components/ChatPanel.tsx","../../node_modules/@radix-ui/react-avatar/dist/index.mjs","../../src/lib/shadcn/ui/avatar.tsx","../../src/lib/shadcn/chat/chat-bubble.tsx","../../src/components/pages/ChatApplication/components/ChatItem.tsx","../../src/components/pages/ChatApplication/hooks/use-update-llm-options.ts","../../src/components/pages/ChatApplication/ChatApplication.tsx"],"sourcesContent":["import * as React from 'react'\nimport { cn } from 'src/lib/utils'\n\ntype ChatMessageListProps = React.HTMLAttributes<HTMLDivElement>\n\nconst ChatMessageList = React.forwardRef<HTMLDivElement, ChatMessageListProps>(\n  ({ className, children, ...props }, ref) => (\n    <div\n      className={cn('flex flex-col w-full h-full p-4 gap-6 overflow-y-auto', className)}\n      ref={ref}\n      {...props}\n    >\n      {children}\n    </div>\n  ),\n)\n\nChatMessageList.displayName = 'ChatMessageList'\n\nexport { ChatMessageList }\n","import { useCallback, useEffect, useRef, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { findFlowNodesWithSource } from 'src/states/flow/actions'\nimport {\n  EntityTypes,\n  FlowEdge,\n  FlowNode,\n  FlowNodePlaceholder,\n  FlowNodeTypeEnum,\n  JSONData,\n  LLM,\n  LLMStatusEnum,\n  Prompt,\n  Schema,\n  Thread,\n  VectorDatabase,\n} from 'src/services/database/types'\nimport { In } from 'src/services/database/typeorm-wrapper'\nimport { Message } from 'ai/react'\nimport { useLoadModel } from 'src/hooks/mutations/use-load-model'\nimport SessionPassphraseDialog from 'src/components/dialogs/SessionPassphraseDialog'\nimport { passphraseConfirm } from 'src/utils/passphrase'\nimport { useModalRef } from 'src/hooks/use-modal-ref'\n\nexport const useChatApplicationData = () => {\n  const [chatInfo, setChatInfo] = useState<{\n    prompts?: Prompt[]\n    schema?: Schema\n  }>()\n  const [mainEmbeddingInfo, setMainEmbeddingInfo] = useState<{\n    embedding?: FlowNodePlaceholder\n  }>()\n  const [threadInfo, setThreadInfo] = useState<{ thread: Thread; threadNode: FlowNode }>()\n  const [mainLLMInfo, setLLMInfo] = useState<{\n    llm: LLM\n    status: `${LLMStatusEnum}`\n    progress?: string\n  }>()\n  const [retriverInfo, setRetriverInfo] = useState<\n    {\n      promptNode: FlowNode\n      vectorDatabaseNode: FlowNode\n      placeholderNode: FlowNode\n      placeholderEntity: FlowNodePlaceholder\n      promptEntity: Prompt\n      vectorDatabaseEntity: VectorDatabase\n    }[]\n  >([])\n  const [currentDataNode, setCurrentDataNode] = useState<{ node: FlowNode; enity: JSONData }>()\n  const onThreadMessagesLoadedRef = useRef<(messages: Message[]) => void>()\n  const sessionHandleStatus = useRef<{ handling?: string; handled?: string }>({})\n  const currentSession = useSessionState((state) => state.currentSession)\n  const { loadModel } = useLoadModel()\n  const { modalRef: sessionPassphraseDialogRef } = useModalRef(SessionPassphraseDialog)\n\n  const selectDataNode = useCallback(\n    async (dataNode: FlowNode) => {\n      if (!currentSession) {\n        return\n      }\n      const jsonData = await getRepository('JSONData').findOne({\n        where: { id: dataNode.source_id, session_id: currentSession?.id },\n      })\n      if (!jsonData) {\n        return\n      }\n      onThreadMessagesLoadedRef.current?.(\n        jsonData.data ? (jsonData.data as unknown as Message[]) : [],\n      )\n      setCurrentDataNode({\n        node: dataNode,\n        enity: jsonData,\n      })\n    },\n    [currentSession],\n  )\n\n  const addNewDataNode = useCallback(\n    async (input?: { sessionId?: string; threadNode?: FlowNode; prompts?: Prompt[] }) => {\n      const sessionId = input?.sessionId || currentSession?.id\n      const threadNode = input?.threadNode || threadInfo?.threadNode\n      const systemPrompt = input?.prompts || chatInfo?.prompts\n\n      if (!sessionId || !threadNode?.id) {\n        return\n      }\n      const initialMessages = systemPrompt\n        ?.map((prompt) => {\n          if (prompt.type === 'few_shot_example') {\n            return undefined\n          }\n          switch (prompt.role) {\n            case 'ai':\n            case 'assistant':\n            case 'tool':\n              return {\n                id: prompt.id,\n                content: prompt.content,\n                role: 'assistant',\n              }\n            case 'system':\n              return {\n                id: prompt.id,\n                content: prompt.content,\n                role: 'system',\n              }\n            default:\n              return {\n                id: prompt.id,\n                content: prompt.content,\n                role: 'user',\n              }\n          }\n        })\n        .filter(Boolean) as Message[]\n      const jsonData = await getRepository('JSONData').save({\n        headers: 'item',\n        session_id: sessionId,\n        json: '',\n        data: initialMessages,\n      })\n      if (!jsonData) {\n        return\n      }\n      const jsonDataNode = await getRepository('FlowNode').save({\n        session_id: sessionId,\n        source_id: jsonData.id,\n        source_type: 'JSONData',\n        node_type: 'JSON_DATA',\n        x: 0,\n        y: 0,\n      })\n      if (!jsonDataNode) {\n        return\n      }\n      await getRepository('FlowEdge').save({\n        session_id: sessionId,\n        source: threadNode.id,\n        target: jsonDataNode.id,\n      })\n      onThreadMessagesLoadedRef.current?.(initialMessages)\n      setCurrentDataNode({\n        node: jsonDataNode,\n        enity: jsonData,\n      })\n      return {\n        jsonData,\n        jsonDataNode,\n      }\n    },\n    [chatInfo?.prompts, currentSession?.id, threadInfo?.threadNode],\n  )\n\n  const handleThreadData = useCallback(\n    async (threadNode: FlowNode, prompts: Prompt[]) => {\n      if (!currentSession) {\n        return\n      }\n      const threadData = await getRepository('FlowEdge').findOne({\n        where: { session_id: currentSession.id, source: threadNode.id },\n        order: { id: 'DESC' },\n      })\n      if (!threadData) {\n        const result = await addNewDataNode({\n          sessionId: currentSession.id,\n          threadNode,\n          prompts: prompts || [],\n        })\n        if (!result) {\n          return\n        }\n      } else {\n        const dataNode = await getRepository('FlowNode').findOne({\n          where: { id: threadData.target, session_id: currentSession.id },\n        })\n        if (!dataNode) {\n          return\n        }\n        await selectDataNode(dataNode)\n      }\n    },\n    [addNewDataNode, currentSession, selectDataNode],\n  )\n\n  const getRetrieveVectorDatabase = useCallback(\n    async (\n      placeholderInfo: {\n        connection: FlowEdge\n        source: FlowNode\n        entity?: EntityTypes\n      }[],\n    ) => {\n      if (placeholderInfo?.length && currentSession?.id) {\n        const data = await Promise.all(\n          placeholderInfo.map(async (info) => {\n            return getRepository('FlowEdge')\n              .find({\n                where: {\n                  target: info.source.id,\n                },\n              })\n              .then((connections) => {\n                return findFlowNodesWithSource({\n                  where: {\n                    session_id: currentSession.id,\n                    id: In(connections.map((connection) => connection.source)),\n                  },\n                }).then((result) => ({\n                  ...result,\n                  ...info,\n                }))\n              })\n          }),\n        )\n        const retriverInfo = data\n          .map((item) => {\n            const promptNode = item.flowNodes.find((node) => node.source_type === 'Prompt')\n            const vectorDatabaseNode = item.flowNodes.find(\n              (node) => node.source_type === 'VectorDatabase',\n            )\n            if (!vectorDatabaseNode || !promptNode) {\n              return\n            }\n            const promptEntity = item.flowNodeDatas?.Prompt?.find(\n              (nodeData) => nodeData.id === promptNode.source_id,\n            )\n            const vectorDatabaseEntity = item.flowNodeDatas?.VectorDatabase?.find(\n              (nodeData) => nodeData.id === vectorDatabaseNode.source_id,\n            )\n            return {\n              promptNode,\n              vectorDatabaseNode,\n              placeholderNode: item.source,\n              placeholderEntity: item.entity,\n              promptEntity: promptEntity as Prompt,\n              vectorDatabaseEntity: vectorDatabaseEntity as VectorDatabase,\n            }\n          })\n          .filter(Boolean) as {\n          promptNode: FlowNode\n          vectorDatabaseNode: FlowNode\n          placeholderNode: FlowNode\n          placeholderEntity: FlowNodePlaceholder\n          promptEntity: Prompt\n          vectorDatabaseEntity: VectorDatabase\n        }[]\n        setRetriverInfo(retriverInfo)\n      }\n    },\n    [currentSession?.id],\n  )\n\n  const getChatApplicationData = useCallback(async () => {\n    try {\n      sessionHandleStatus.current.handling = currentSession?.id\n      if (\n        !currentSession?.id ||\n        !currentSession?.main_source_id ||\n        currentSession?.main_source_type !== 'Thread'\n      ) {\n        return\n      }\n      const [thread, threadNode] = await Promise.all([\n        getRepository('Thread').findOne({\n          where: { id: currentSession.main_source_id, session_id: currentSession.id },\n        }),\n        getRepository('FlowNode').findOne({\n          where: {\n            id: currentSession.main_node_id,\n          },\n        }),\n      ])\n      if (!thread || !threadNode) {\n        return\n      }\n      const threadConnections = await getRepository('FlowEdge').find({\n        where: { session_id: currentSession.id, target: threadNode.id },\n      })\n      const { flowNodes, flowNodeDatas } = await findFlowNodesWithSource({\n        where: {\n          session_id: currentSession.id,\n          id: In(threadConnections.map((connection) => connection.source)),\n        },\n      })\n      const allConnections = await getRepository('FlowEdge').find({\n        where: { session_id: currentSession.id },\n      })\n\n      const threadConnectedNodes = allConnections\n        .filter((connection) => connection.target === threadNode.id)\n        .map((connection) => {\n          const node = flowNodes.find((node) => node.id === connection.source)!\n          return {\n            connection,\n            source: node,\n            entity: flowNodeDatas?.[node.source_type]?.find(\n              (nodeData) => nodeData.id === node.source_id,\n            ),\n          }\n        })\n\n      const llmInfo = threadConnectedNodes.find((node) => node.source.source_type === 'LLM')\n      const promptInfo = threadConnectedNodes.filter((node) => node.source.source_type === 'Prompt')\n      const schemaInfo = threadConnectedNodes.find((node) => node.source.source_type === 'Schema')\n\n      const llm = llmInfo?.entity as LLM\n\n      if (!llm) {\n        return\n      }\n\n      if (currentSession.passphrase) {\n        await passphraseConfirm(currentSession.passphrase!, sessionPassphraseDialogRef.current)\n      }\n\n      const placeholderInfo = threadConnectedNodes.filter(\n        (node) => node.source.source_type === 'FlowNodePlaceholder',\n      )\n\n      await getRetrieveVectorDatabase(placeholderInfo)\n      await handleThreadData(threadNode, promptInfo?.map((info) => info.entity as Prompt) || [])\n\n      // Handle Embedding Node\n      const embeddingNode = await getRepository('FlowNode').findOne({\n        where: {\n          node_type: FlowNodeTypeEnum.DefaultEmbeddingModel,\n          source_type: 'FlowNodePlaceholder',\n        },\n      })\n\n      if (embeddingNode) {\n        const embeddingEntity = await getRepository('FlowNodePlaceholder').findOne({\n          where: { id: embeddingNode.source_id },\n        })\n        setMainEmbeddingInfo({\n          embedding: embeddingEntity,\n        })\n      }\n\n      setLLMInfo({\n        llm,\n        status: llm.status || LLMStatusEnum.Started,\n        progress: '',\n      })\n      setThreadInfo({\n        thread,\n        threadNode,\n      })\n      const schemaEntity = schemaInfo?.entity as Schema\n      if (schemaEntity) {\n        const schemaItems = await getRepository('SchemaItem').find({\n          where: { schema_id: schemaEntity.id },\n        })\n        schemaEntity.schema_items = schemaItems || []\n      }\n\n      setChatInfo({\n        prompts: promptInfo?.map((info) => info.entity as Prompt) || [],\n        schema: schemaEntity,\n      })\n\n      sessionHandleStatus.current.handled = currentSession.id\n    } finally {\n      sessionHandleStatus.current.handling = undefined\n    }\n  }, [\n    currentSession?.id,\n    currentSession?.main_node_id,\n    currentSession?.main_source_id,\n    currentSession?.main_source_type,\n    currentSession?.passphrase,\n    getRetrieveVectorDatabase,\n    handleThreadData,\n    sessionPassphraseDialogRef,\n  ])\n\n  const loadLLM = useCallback(async () => {\n    if (!mainLLMInfo?.llm?.name) {\n      return\n    }\n    try {\n      setLLMInfo((pre) => (pre ? { ...pre, status: LLMStatusEnum.Loading } : pre))\n      await loadModel(mainLLMInfo.llm.provider, mainLLMInfo?.llm.name, {\n        provider: mainLLMInfo.llm.provider,\n        callback: (data) => {\n          setLLMInfo((pre) => (pre ? { ...pre, progress: data.text } : pre))\n        },\n      })\n      setLLMInfo((pre) => (pre ? { ...pre, status: LLMStatusEnum.Loaded, progress: '' } : pre))\n    } catch {\n      setLLMInfo((pre) => (pre ? { ...pre, status: LLMStatusEnum.Started, progress: '' } : pre))\n    }\n  }, [mainLLMInfo?.llm?.name, mainLLMInfo?.llm?.provider, loadModel])\n\n  const onThreadMessagesLoaded = useCallback((callback: (messages: Message[]) => void) => {\n    onThreadMessagesLoadedRef.current = callback\n    return () => {\n      onThreadMessagesLoadedRef.current = undefined\n    }\n  }, [])\n\n  const updateMessagesData = useCallback(\n    async (messages: Message[]) => {\n      if (!currentDataNode?.node || !currentDataNode?.enity) {\n        return\n      }\n      await getRepository('JSONData').save({\n        ...currentDataNode.enity,\n        data: messages,\n      })\n    },\n    [currentDataNode?.enity, currentDataNode?.node],\n  )\n\n  useEffect(() => {\n    if (\n      sessionHandleStatus.current.handling ||\n      sessionHandleStatus?.current.handled === currentSession?.id\n    ) {\n      return\n    }\n    getChatApplicationData()\n  }, [currentSession?.id, getChatApplicationData])\n\n  return {\n    ...chatInfo,\n    loadLLM,\n    threadInfo,\n    mainLLMInfo,\n    mainEmbeddingInfo,\n    retriverInfo,\n    currentDataNode,\n    updateMessagesData,\n    addNewDataNode,\n    selectDataNode,\n    setLLMInfo,\n    onThreadMessagesLoaded,\n  }\n}\n","import { useCallback, useState } from 'react'\nimport { PromptTemplate } from '@langchain/core/prompts'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { FlowNodePlaceholderTypeEnum, LLMStatusEnum, Schema } from 'src/services/database/types'\nimport { AIMessage, BaseMessage, HumanMessage, SystemMessage } from '@langchain/core/messages'\nimport { Message } from 'ai/react'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\nimport { useChatApplicationData } from './use-chat-application-data'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\n\ntype CreateMessageOption = {\n  schema?: Schema\n  onMessageUpdate: (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => void\n  onResponseMessageCreate: (message?: string) => void\n  onInjectedMessages: (messages: BaseMessage[]) => void\n}\nexport const useSendMessage = (chatApplicationData: ReturnType<typeof useChatApplicationData>) => {\n  const [loading] = useState(false)\n  const { similaritySearchWithScore } = useEmbedding()\n  const { stream } = useLLM()\n\n  const handlePlaceholders = useCallback(\n    async (\n      content: string,\n      retriverInfo: ReturnType<typeof useChatApplicationData>['retriverInfo'],\n    ): Promise<BaseMessage[]> => {\n      if (!retriverInfo?.length) {\n        return []\n      }\n      const injectedMessages: BaseMessage[] = []\n      await Promise.all(\n        retriverInfo.map(async (item) => {\n          const placeholderRecord = item.placeholderEntity\n          if (!placeholderRecord) {\n            return\n          }\n          switch (placeholderRecord.placeholder_type) {\n            case FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER: {\n              if (\n                !item.promptNode ||\n                !item.promptEntity ||\n                !item.vectorDatabaseNode ||\n                !item.vectorDatabaseEntity\n              ) {\n                return\n              }\n              const k = placeholderRecord.metadata?.k ? +placeholderRecord.metadata?.k : 1\n              let minimalScore = placeholderRecord.metadata?.minimalScore\n                ? +placeholderRecord.metadata?.minimalScore\n                : undefined\n              if (minimalScore && minimalScore > 1) {\n                minimalScore = minimalScore / 100\n              }\n              const documents = await similaritySearchWithScore(\n                chatApplicationData?.mainEmbeddingInfo?.embedding,\n                {\n                  database: {\n                    databaseId: item.vectorDatabaseEntity.id,\n                  },\n                },\n                content,\n                k,\n              )\n              if (!documents) {\n                return []\n              }\n              const template = new PromptTemplate({\n                template: item.promptEntity.content,\n                inputVariables: ['context'],\n              })\n              injectedMessages.push(\n                new AIMessage(\n                  await template.format({\n                    context: !minimalScore\n                      ? documents.map(([doc]) => doc.pageContent).join('\\n')\n                      : documents\n                          .filter(([, score]) => score >= minimalScore)\n                          .map(([doc]) => doc.pageContent)\n                          .join('\\n'),\n                  }),\n                ),\n              )\n            }\n          }\n        }),\n      )\n      return injectedMessages\n    },\n    [similaritySearchWithScore, chatApplicationData?.mainEmbeddingInfo?.embedding],\n  )\n\n  const sendMessage = useCallback(\n    async (\n      message: string,\n      messages: Message[],\n      {\n        retriverInfo,\n      }: {\n        retriverInfo?: ReturnType<typeof useChatApplicationData>['retriverInfo']\n      },\n      { schema, onMessageUpdate, onResponseMessageCreate, onInjectedMessages }: CreateMessageOption,\n    ) => {\n      if (\n        !chatApplicationData.mainLLMInfo?.llm ||\n        chatApplicationData.mainLLMInfo?.status !== LLMStatusEnum.Loaded\n      ) {\n        throw new Error('LLM not found')\n      }\n\n      const injectedMessages: BaseMessage[] = []\n\n      if (retriverInfo?.length) {\n        injectedMessages.push(...(await handlePlaceholders(message, retriverInfo)))\n        onInjectedMessages?.(injectedMessages)\n      }\n\n      const formatedMessages = messages.map((message) => {\n        if (message.role === 'system') {\n          return new SystemMessage(message.content)\n        }\n        if (message.role === 'user') {\n          return new HumanMessage(message.content)\n        }\n        return new AIMessage(message.content)\n      })\n\n      onResponseMessageCreate?.()\n\n      const response = await stream(\n        chatApplicationData.mainLLMInfo.llm.provider,\n        [...injectedMessages, ...formatedMessages],\n        {\n          schemas: schema ? [schema] : undefined,\n          onMessageUpdate: ({ content }) => {\n            onMessageUpdate?.({\n              nodeData: {\n                loading: true,\n                content: content,\n              },\n            })\n          },\n          llm: chatApplicationData.mainLLMInfo.llm,\n        },\n      )\n\n      onMessageUpdate?.({\n        nodeData: {\n          content: response?.content,\n        },\n      })\n      return response?.content\n    },\n    [handlePlaceholders, stream, chatApplicationData.mainLLMInfo],\n  )\n\n  return {\n    loading,\n    sendMessage,\n  }\n}\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from 'src/lib/shadcn/ui/alert-dialog'\n\ntype DeleteSessionDialogProps = {\n  onDelete: () => Promise<void>\n}\nconst DeleteChatDataNodeDialog = create<DeleteSessionDialogProps>(({ onDelete }) => {\n  const { t } = useTranslation('dialogs')\n  const [loading, setLoading] = useState(false)\n  const currentModal = useModal()\n  const { toast } = useToast()\n\n  const handleSubmit = async () => {\n    try {\n      setLoading(true)\n      await onDelete()\n      currentModal.hide()\n    } catch {\n      toast({\n        variant: 'destructive',\n        description: t('delete_chat_data_node.errors.delete_failed'),\n      })\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <AlertDialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('delete_chat_data_node.title')}</AlertDialogTitle>\n          <AlertDialogDescription>{t('delete_chat_data_node.description')}</AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel onClick={currentModal.hide}>\n            {t('delete_chat_data_node.cancel')}\n          </AlertDialogCancel>\n          <AlertDialogAction disabled={loading} onClick={handleSubmit}>\n            {t('delete_chat_data_node.delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  )\n})\n\nexport default DeleteChatDataNodeDialog\n","// @hidden\nexport default function MessageLoading() {\n  return (\n    <svg\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className=\"text-foreground\"\n    >\n      <circle cx=\"4\" cy=\"12\" r=\"2\" fill=\"currentColor\">\n        <animate\n          id=\"spinner_qFRN\"\n          begin=\"0;spinner_OcgL.end+0.25s\"\n          attributeName=\"cy\"\n          calcMode=\"spline\"\n          dur=\"0.6s\"\n          values=\"12;6;12\"\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\n        />\n      </circle>\n      <circle cx=\"12\" cy=\"12\" r=\"2\" fill=\"currentColor\">\n        <animate\n          begin=\"spinner_qFRN.begin+0.1s\"\n          attributeName=\"cy\"\n          calcMode=\"spline\"\n          dur=\"0.6s\"\n          values=\"12;6;12\"\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\n        />\n      </circle>\n      <circle cx=\"20\" cy=\"12\" r=\"2\" fill=\"currentColor\">\n        <animate\n          id=\"spinner_OcgL\"\n          begin=\"spinner_qFRN.begin+0.2s\"\n          attributeName=\"cy\"\n          calcMode=\"spline\"\n          dur=\"0.6s\"\n          values=\"12;6;12\"\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\n        />\n      </circle>\n    </svg>\n  )\n}\n","import { memo, useCallback, useEffect, useMemo, useState } from 'react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { LLMStatusEnum } from 'src/services/database/types/llm'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\n\nimport { LLM } from 'src/services/database/types'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { Card } from 'src/lib/shadcn/ui/card'\n\nexport const ChatLLMInfo = memo(\n  ({\n    llm,\n    status,\n    loadLLM,\n    progress,\n  }: {\n    llm?: LLM\n    progress?: string\n    status?: `${LLMStatusEnum}`\n    loadLLM?: () => Promise<void>\n  }) => {\n    const { t } = useTranslation('flows')\n    const [llmInfo, setLLMInfo] = useState<\n      | { hasCache: boolean; isFunctionCalling: boolean; info?: ModelRecord; cloud?: boolean }\n      | undefined\n    >()\n\n    useEffect(() => {\n      if (llmInfo || !llm?.name) {\n        return\n      }\n      if (llm?.provider !== 'WebLLM') {\n        setLLMInfo({\n          hasCache: false,\n          cloud: true,\n          isFunctionCalling: true,\n          info: {\n            model_id: llm?.name,\n            model: llm?.name,\n            model_lib: llm?.provider,\n            model_type: 2,\n          },\n        })\n        return\n      }\n      import('@mlc-ai/web-llm').then(\n        async ({ hasModelInCache, functionCallingModelIds, prebuiltAppConfig }) => {\n          const hasCache = await hasModelInCache(llm?.name)\n          setLLMInfo({\n            hasCache,\n            isFunctionCalling: functionCallingModelIds.includes(llm?.name),\n            info: prebuiltAppConfig.model_list.find((item) => item.model_id === llm?.name),\n          })\n        },\n      )\n    }, [llm?.name, llmInfo])\n\n    const handleLoadLLM = useCallback(async () => {\n      await loadLLM?.()\n    }, [loadLLM])\n\n    const llmIcon = useMemo(() => {\n      switch (status) {\n        case LLMStatusEnum.Downloading:\n          return <LazyIcon className={'animate-spin w-7 h-7'} name={'arrow-big-down-dash'} />\n        case LLMStatusEnum.Loaded:\n          return <LLMIcon name={llm?.name || 'brain'} className=\"w-7 h-7\" />\n        default:\n          return <LLMIcon name={llm?.name || 'brain'} className=\"w-7 h-7\" />\n      }\n    }, [llm?.name, status])\n    return (\n      <Card className=\"flex justify-center !bg-inherit !p-2 max-w-full overflow-y-hidden !mb-2 m-2 !mt-0\">\n        <div className=\"ml-2 pt-1 max-w-full\">\n          <p className=\"flex gap-2 items-center pr-6 !text-sm font-semibold\">\n            {llmIcon}\n            {`${llm?.name || ''}`}\n          </p>\n          <div className=\"max-w-full mt-2 flex-wrap flex gap-1\">\n            <LLMInfo\n              model={llmInfo?.info}\n              isFunctionCalling={llmInfo?.isFunctionCalling || false}\n              name={llm?.name}\n              isCached={llmInfo?.hasCache || false}\n              cloud={llmInfo?.cloud || false}\n            />\n            {status !== LLMStatusEnum.Loaded ? (\n              progress ? (\n                <div className=\"text-sm break-words flex-wrap\">{progress}</div>\n              ) : (\n                <Button\n                  disabled={status === LLMStatusEnum.Loading}\n                  onClick={handleLoadLLM}\n                  className=\"mt-4 w-full\"\n                >\n                  {t(\n                    llmInfo?.hasCache\n                      ? 'llm_node.load_model_button'\n                      : 'llm_node.download_model_button',\n                  )}\n                </Button>\n              )\n            ) : undefined}\n          </div>\n        </div>\n      </Card>\n    )\n  },\n)\n","import { Document } from '@langchain/core/documents'\nimport chunk from 'lodash/chunk'\nimport { useCallback, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport type { VectorDatabase } from 'src/services/database/types'\nimport { VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { useChatApplicationData } from './use-chat-application-data'\n\nexport const useVectorDatabaseActions = (\n  mainEmbeddingInfo?: ReturnType<typeof useChatApplicationData>['mainEmbeddingInfo'],\n) => {\n  const [loading, setLoading] = useState(false)\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n\n  const { index: indexFunction, similaritySearchWithScore: similaritySearchWithScoreFunction } =\n    useEmbedding()\n  const similaritySearchWithScore = useCallback(\n    async (input: string, options?: { k?: number; vectorDatabase: VectorDatabase }) => {\n      try {\n        if (!options?.vectorDatabase) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n        if (options?.vectorDatabase.storage === VectorDatabaseStorageEnum.DataNode) {\n          throw new Error('DataNode storage is not supported for similarity search')\n        } else {\n          setLoading(true)\n          const result = await similaritySearchWithScoreFunction(\n            mainEmbeddingInfo?.embedding,\n            {\n              database: {\n                databaseId: options.vectorDatabase.id,\n              },\n            },\n            input,\n            options?.k,\n          )\n          return result\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [toast, t, similaritySearchWithScoreFunction, mainEmbeddingInfo?.embedding],\n  )\n\n  const indexData = useCallback(\n    async (\n      data: { id?: string; content?: string; documents?: Document[] },\n      options?: {\n        vectorDatabase: VectorDatabase\n        onProgressReport?: (info: { total: number; handled: number; handling: number }) => void\n      },\n    ) => {\n      try {\n        setLoading(true)\n        const documents = data.content\n          ? [\n              new Document({\n                pageContent: data.content,\n                id: data.id,\n                metadata: {\n                  id: data.id,\n                },\n              }),\n            ]\n          : data.documents\n\n        if (!documents?.length) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.content_not_found'),\n          })\n          return\n        }\n\n        if (!options?.vectorDatabase) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n\n        if (options?.vectorDatabase.storage === VectorDatabaseStorageEnum.DataNode) {\n          throw new Error('DataNode storage is not supported for indexing')\n        } else {\n          // DEFAULT OPTION IS INDEXING AND STORED DIRECTLY TO VECTOR DATABASE ENTITY\n          const chunkedDocuments = chunk(documents, 10)\n          let handledCount = 0\n\n          for (const partDocuments of chunkedDocuments) {\n            options?.onProgressReport?.({\n              handling: partDocuments.length,\n              handled: handledCount,\n              total: documents.length,\n            })\n            await indexFunction(\n              mainEmbeddingInfo?.embedding,\n              {\n                database: {\n                  databaseId: options.vectorDatabase.id,\n                },\n              },\n              partDocuments,\n            )\n            handledCount += partDocuments.length\n          }\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [toast, t, indexFunction, mainEmbeddingInfo?.embedding],\n  )\n\n  return {\n    loading,\n    indexData,\n    similaritySearchWithScore,\n  }\n}\n","import { useCallback, useMemo, useState } from 'react'\nimport { create, useModal } from '@ebay/nice-modal-react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { WebPDFLoader } from '@langchain/community/document_loaders/web/pdf'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from 'src/lib/shadcn/ui/tabs'\nimport { VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { cn } from 'src/lib/utils'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from 'src/lib/shadcn/ui/dialog'\nimport { VectorSearch } from 'src/components/flows/Nodes/VectorDatabaseNode/components/VectorSearch'\nimport IndexNewText from 'src/components/flows/Nodes/VectorDatabaseNode/components/IndexNewText'\nimport IndexNewFile from 'src/components/flows/Nodes/VectorDatabaseNode/components/IndexNewFile'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { decodeLine } from 'src/utils/string-data'\nimport { useVectorDatabaseActions } from 'src/components/pages/ChatApplication/hooks/use-vector-database-actions'\nimport { useChatApplicationData } from 'src/components/pages/ChatApplication/hooks/use-chat-application-data'\n\ntype VectorDatabaseDialogProps = {\n  retriverInfo: ReturnType<typeof useChatApplicationData>['retriverInfo'][number]\n  mainEmbeddingInfo?: ReturnType<typeof useChatApplicationData>['mainEmbeddingInfo']\n}\n\nconst VectorDatabaseDialog = create<VectorDatabaseDialogProps>(\n  ({ retriverInfo, mainEmbeddingInfo }) => {\n    const { t } = useTranslation('applications')\n    const { loading, similaritySearchWithScore, indexData } =\n      useVectorDatabaseActions(mainEmbeddingInfo)\n\n    const [mode, setMode] = useState('search')\n    const [progress, setProgress] = useState(0)\n    const currentModal = useModal()\n\n    const vectorDatabaseData = useMemo(() => {\n      if (!retriverInfo?.vectorDatabaseEntity?.raw) {\n        return {\n          headers: [],\n          rows: [],\n        }\n      }\n\n      const headers = ['content', 'embedding', 'metadata']\n      const lines = decodeLine(retriverInfo?.vectorDatabaseEntity?.raw)\n      return {\n        headers,\n        rows: lines.map((row) => {\n          try {\n            const data = JSON.parse(row)\n            return data\n          } catch {\n            return []\n          }\n        }),\n      }\n    }, [retriverInfo?.vectorDatabaseEntity?.raw])\n\n    const handleCreateData = useCallback(\n      async (...args: Parameters<typeof indexData>) => {\n        const [data, options] = args\n        await indexData(data, {\n          ...options,\n          vectorDatabase: retriverInfo.vectorDatabaseEntity,\n        })\n      },\n      [indexData, retriverInfo.vectorDatabaseEntity],\n    )\n\n    const handleSimilaritySearch = useCallback(\n      async (value: string, k?: number) => {\n        const input = value.trim()\n        const documents = await similaritySearchWithScore(input, {\n          k,\n          vectorDatabase: retriverInfo.vectorDatabaseEntity,\n        })\n        if (!documents?.length) {\n          return\n        }\n        return documents\n      },\n      [retriverInfo.vectorDatabaseEntity, similaritySearchWithScore],\n    )\n\n    const handleIndexPDF = useCallback(\n      async (file: File) => {\n        if (file.type.includes('text') || file.type.includes('txt')) {\n          const reader = new FileReader()\n          reader.onload = async (e) => {\n            const content = e.target?.result as string\n            await handleCreateData(\n              { content },\n              {\n                vectorDatabase: retriverInfo.vectorDatabaseEntity,\n              },\n            )\n          }\n          reader.readAsText(file)\n        } else if (file.type.endsWith('pdf')) {\n          // File to blob\n          const blob = new Blob([file], { type: 'application/pdf' })\n          const customBuildLoader = new WebPDFLoader(blob, {\n            // you may need to add `.then(m => m.default)` to the end of the import\n            pdfjs: async () => {\n              const pdfjs = await import('pdfjs-dist/legacy/build/pdf.min.mjs')\n              await import('pdfjs-dist/legacy/build/pdf.worker.min.mjs')\n              pdfjs.GlobalWorkerOptions.workerSrc = new URL(\n                'pdfjs-dist/build/pdf.worker.min.js',\n                import.meta.url,\n              ).toString()\n              return pdfjs\n            },\n            parsedItemSeparator: ' ',\n          })\n          const documents = await customBuildLoader.load()\n          await handleCreateData(\n            { documents },\n            {\n              vectorDatabase: retriverInfo.vectorDatabaseEntity,\n              onProgressReport: (info) => {\n                setProgress((info.handled + info.handling) / info.total)\n              },\n            },\n          )\n        }\n      },\n      [handleCreateData, retriverInfo.vectorDatabaseEntity],\n    )\n\n    const renderContent = useMemo(() => {\n      switch (mode) {\n        case 'search':\n          return (\n            <TabsContent value=\"search\">\n              <VectorSearch loading={loading} onSimilaritySearch={handleSimilaritySearch} />\n            </TabsContent>\n          )\n        case 'new':\n          return (\n            <TabsContent className=\"min-w-80\" value=\"new\">\n              <IndexNewText loading={loading} onCreateData={handleCreateData} />\n            </TabsContent>\n          )\n        case 'file':\n          return (\n            <TabsContent value=\"file\">\n              <IndexNewFile\n                loading={loading}\n                progress={progress}\n                onFileSubmit={handleIndexPDF}\n                fileOptions={{ accept: '.pdf,.txt,.text', maxSize: 1 }}\n              />\n            </TabsContent>\n          )\n        case 'view': {\n          return (\n            <TabsContent value=\"view\" className=\"max-h-full overflow-auto\">\n              <DataViewer\n                data={vectorDatabaseData.rows}\n                headers={vectorDatabaseData.headers}\n                limitLengthByColumns={{\n                  embedding: 32,\n                }}\n              />\n            </TabsContent>\n          )\n        }\n      }\n    }, [\n      handleCreateData,\n      handleIndexPDF,\n      handleSimilaritySearch,\n      loading,\n      mode,\n      progress,\n      vectorDatabaseData,\n    ])\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n        <DialogContent className=\"max-w-3xl\">\n          <DialogHeader>\n            <div className=\"flex\">\n              <LazyIcon name=\"file\" className=\"mr-2 h-4 w-4\" />\n              <DialogTitle>{t('chat.vector_database')}</DialogTitle>\n            </div>\n          </DialogHeader>\n          <div className=\"mx-auto w-full min-h-96 max-h-full overflow-hidden\">\n            <div className=\"w-full h-full\">\n              <Tabs\n                value={mode}\n                onValueChange={setMode}\n                defaultValue=\"search\"\n                className={cn('w-full h-full mt-4')}\n              >\n                <TabsList\n                  className={cn(\n                    'grid w-full grid-cols-3',\n                    retriverInfo?.vectorDatabaseEntity?.storage ===\n                      VectorDatabaseStorageEnum.DatabaseNode\n                      ? 'grid-cols-4'\n                      : 'grid-cols-3',\n                  )}\n                >\n                  <TabsTrigger value=\"search\">{t('chat.search')}</TabsTrigger>\n                  <TabsTrigger value=\"new\">{t('chat.text')}</TabsTrigger>\n                  <TabsTrigger value=\"file\">{t('chat.file')}</TabsTrigger>\n                  {retriverInfo?.vectorDatabaseEntity?.storage ===\n                  VectorDatabaseStorageEnum.DatabaseNode ? (\n                    <TabsTrigger value=\"view\">{t('chat.view')}</TabsTrigger>\n                  ) : undefined}\n                </TabsList>\n                {renderContent}\n              </Tabs>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default VectorDatabaseDialog\n","import { useCallback, useEffect, useState } from 'react'\nimport { useSessionState } from 'src/states/session'\nimport { FlowNode, JSONData } from 'src/services/database/types'\nimport { getRepository } from 'src/services/database'\nimport { In } from 'src/services/database/typeorm-wrapper'\nimport { findFlowNodesWithSource } from 'src/states/flow/actions'\n\nexport const useChatList = (threadNode?: FlowNode) => {\n  const [chatList, setChatList] = useState<{ node: FlowNode; entity: JSONData }[]>([])\n  const currentSession = useSessionState((state) => state.currentSession)\n\n  const getChatList = useCallback(async () => {\n    if (!threadNode || !currentSession?.id) {\n      return\n    }\n    const threadDataEdged = await getRepository('FlowEdge').find({\n      where: { session_id: currentSession.id, source: threadNode.id },\n      order: { id: 'DESC' },\n    })\n    const { flowNodes, flowNodeDatas } = await findFlowNodesWithSource({\n      where: {\n        session_id: currentSession.id,\n        id: In(threadDataEdged.map((edge) => edge.target)),\n        source_type: 'JSONData',\n      },\n      order: { updated_at: 'DESC' },\n      select: ['id', 'source_id', 'source_type', 'updated_at'],\n    })\n    setChatList(\n      flowNodes.reduce((all: { node: FlowNode; entity: JSONData }[], node) => {\n        const entity = flowNodeDatas[node.source_type]?.find((data) => data.id === node.source_id)\n        if (entity) {\n          all.push({\n            node,\n            entity: entity as JSONData,\n          })\n        }\n        return all\n      }, []),\n    )\n  }, [currentSession?.id, threadNode])\n  const deleteChat = useCallback(\n    async (node: FlowNode) => {\n      await getRepository('FlowNode').delete(node.id)\n      await getRepository('JSONData').delete(node.source_id)\n      const allEdges = await getRepository('FlowEdge').find({\n        where: [{ source: node.id }, { target: node.id }],\n      })\n      await Promise.all(\n        allEdges.map((edge) => {\n          return getRepository('FlowEdge').delete(edge.id)\n        }),\n      )\n\n      getChatList()\n    },\n    [getChatList],\n  )\n\n  useEffect(() => {\n    if (!threadNode) {\n      return\n    }\n    getChatList()\n  }, [getChatList, threadNode])\n\n  return {\n    chatList,\n    deleteChat,\n    getChatList,\n  }\n}\n","import * as React from 'react'\n\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from 'src/lib/shadcn/ui/sidebar'\nimport { useModal } from '@ebay/nice-modal-react'\nimport DeleteChatDataNodeDialog from 'src/components/dialogs/DeleteChatDataNodeDialog'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { FlowNode, Schema } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { convertToZodSchemaString } from 'src/utils/schema-format'\nimport MessageLoading from 'src/lib/shadcn/chat/message-loading'\nimport { cn } from 'src/lib/utils'\nimport { MarkdownViewer } from 'src/components/molecules/MarkdownViewer'\nimport { Card } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { LLMSetting } from 'src/components/atoms/LLMSetting'\n\nimport { ChatLLMInfo } from './ChatLLMInfo'\nimport VectorDatabaseDialog from './VectorDatabaseDialog'\nimport { useChatApplicationData } from '../hooks/use-chat-application-data'\nimport { useChatList } from '../hooks/use-chat-list'\nimport { useUpdateLLMOptions } from '../hooks/use-update-llm-options'\n\nexport function ChatPanel({\n  schema,\n  mainLLMInfo,\n  mainEmbeddingInfo,\n  loadLLM,\n  retriverInfo,\n  threadNode,\n  onSelectThread,\n  onAddNewThread,\n  currentDataNode,\n  setLLMInfo,\n  changeLLMOptions,\n  ...props\n}: React.ComponentProps<typeof Sidebar> & {\n  schema?: Schema\n  threadNode?: FlowNode\n  onAddNewThread?: () => void\n  onSelectThread: (node: FlowNode) => void\n  retriverInfo: ReturnType<typeof useChatApplicationData>['retriverInfo']\n  currentDataNode: ReturnType<typeof useChatApplicationData>['currentDataNode']\n  loadLLM: ReturnType<typeof useChatApplicationData>['loadLLM']\n  mainLLMInfo: ReturnType<typeof useChatApplicationData>['mainLLMInfo']\n  mainEmbeddingInfo?: ReturnType<typeof useChatApplicationData>['mainEmbeddingInfo']\n  setLLMInfo: ReturnType<typeof useChatApplicationData>['setLLMInfo']\n  changeLLMOptions: ReturnType<typeof useUpdateLLMOptions>['changeLLMOptions']\n}) {\n  const { t } = useTranslation('applications')\n  const [loading, setLoading] = React.useState(false)\n  const deleteChatDataNodeDialog = useModal(DeleteChatDataNodeDialog)\n  const vectorDatabaseDialog = useModal(VectorDatabaseDialog)\n  const { chatList, getChatList, deleteChat } = useChatList(threadNode)\n\n  const handleAddNewThread = React.useCallback(async () => {\n    try {\n      setLoading(true)\n      await onAddNewThread?.()\n      getChatList()\n    } finally {\n      setLoading(false)\n    }\n  }, [getChatList, onAddNewThread])\n\n  const handleShowVectorDatabase = React.useCallback(() => {\n    vectorDatabaseDialog.show({\n      retriverInfo: retriverInfo[0],\n      mainEmbeddingInfo: mainEmbeddingInfo,\n    })\n  }, [mainEmbeddingInfo, retriverInfo, vectorDatabaseDialog])\n\n  const handleDeleteDataNode = React.useCallback(\n    async (e: React.MouseEvent, node: FlowNode) => {\n      e.stopPropagation()\n      deleteChatDataNodeDialog.show({ onDelete: () => deleteChat(node) })\n    },\n    [deleteChat, deleteChatDataNodeDialog],\n  )\n\n  const handleChangeOptions = React.useCallback(\n    async (options: Record<string, unknown>) => {\n      if (!mainLLMInfo?.llm) {\n        return\n      }\n      await changeLLMOptions(mainLLMInfo?.llm, options)\n      setLLMInfo((pre) =>\n        pre\n          ? {\n              ...pre,\n              llm: {\n                ...pre.llm,\n                options,\n              },\n            }\n          : undefined,\n      )\n    },\n    [changeLLMOptions, mainLLMInfo?.llm, setLLMInfo],\n  )\n\n  const content = React.useMemo(() => {\n    return (\n      <MarkdownViewer\n        className={cn('overflow-hidden break-words whitespace-pre-wrap w-full rounded-lg')}\n        source={\n          schema?.schema_items?.length\n            ? `\\`\\`\\`javascript\\n${convertToZodSchemaString(schema?.schema_items || [])}\\n\\`\\`\\``\n            : ''\n        }\n      />\n    )\n  }, [schema?.schema_items])\n\n  return (\n    <Sidebar variant=\"sidebar\" side=\"right\" collapsible=\"none\" {...props}>\n      <div className=\"h-1\" />\n      <SidebarGroupLabel className=\"justify-between\">\n        <div className=\"text-sm pl-2\">{t('chat.history')}</div>\n        <LoadingButton\n          loading={loading}\n          onClick={handleAddNewThread}\n          variant=\"link\"\n          className=\"mr-[-6px]\"\n        >\n          <LazyIcon name=\"circle-plus\" />\n        </LoadingButton>\n      </SidebarGroupLabel>\n      <SidebarContent>\n        <SidebarGroup className=\"flex-1\">\n          <SidebarMenu>\n            {chatList.map(({ node }, index) => (\n              <SidebarMenuItem key={node.id} onClick={() => onSelectThread(node)}>\n                <SidebarMenuButton className=\"cursor-pointer\">\n                  <div className=\"flex flex-row justify-between items-center w-full\">\n                    <div className=\"flex gap-2\">\n                      <LazyIcon\n                        size={16}\n                        name={currentDataNode?.node?.id === node.id ? 'check' : 'chevron-right'}\n                        className=\"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90\"\n                      />\n                      <span>{`Thread ${index + 1}`}</span>\n                    </div>\n                    <LazyIcon\n                      onClick={(e) => handleDeleteDataNode(e, node)}\n                      size={16}\n                      name=\"trash-2\"\n                    />\n                  </div>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            ))}\n          </SidebarMenu>\n        </SidebarGroup>\n        {retriverInfo?.length ? (\n          <Card className=\"m-2 p-2 max-w-full\">\n            <pre className=\"overflow-auto\">\n              {retriverInfo.map((info, key) => (\n                <span key={`${key}`}>{info.promptEntity?.content || ''}</span>\n              ))}\n            </pre>\n            <Button onClick={handleShowVectorDatabase} className=\"w-full mt-4\">\n              {t('chat.vector_database')}\n            </Button>\n          </Card>\n        ) : undefined}\n        {schema?.schema_items?.length ? (\n          <div className=\"m-2 !mb-0\">\n            <React.Suspense fallback={<MessageLoading />}>{content}</React.Suspense>\n          </div>\n        ) : undefined}\n        <LLMSetting\n          options={mainLLMInfo?.llm?.options}\n          onChangeOptions={handleChangeOptions}\n          className=\"p-2\"\n        />\n        <ChatLLMInfo\n          llm={mainLLMInfo?.llm}\n          status={mainLLMInfo?.status}\n          progress={mainLLMInfo?.progress}\n          loadLLM={loadLLM}\n        />\n      </SidebarContent>\n    </Sidebar>\n  )\n}\n","\"use client\";\n\n// packages/react/avatar/src/Avatar.tsx\nimport * as React from \"react\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useCallbackRef } from \"@radix-ui/react-use-callback-ref\";\nimport { useLayoutEffect } from \"@radix-ui/react-use-layout-effect\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport { jsx } from \"react/jsx-runtime\";\nvar AVATAR_NAME = \"Avatar\";\nvar [createAvatarContext, createAvatarScope] = createContextScope(AVATAR_NAME);\nvar [AvatarProvider, useAvatarContext] = createAvatarContext(AVATAR_NAME);\nvar Avatar = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, ...avatarProps } = props;\n    const [imageLoadingStatus, setImageLoadingStatus] = React.useState(\"idle\");\n    return /* @__PURE__ */ jsx(\n      AvatarProvider,\n      {\n        scope: __scopeAvatar,\n        imageLoadingStatus,\n        onImageLoadingStatusChange: setImageLoadingStatus,\n        children: /* @__PURE__ */ jsx(Primitive.span, { ...avatarProps, ref: forwardedRef })\n      }\n    );\n  }\n);\nAvatar.displayName = AVATAR_NAME;\nvar IMAGE_NAME = \"AvatarImage\";\nvar AvatarImage = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, src, onLoadingStatusChange = () => {\n    }, ...imageProps } = props;\n    const context = useAvatarContext(IMAGE_NAME, __scopeAvatar);\n    const imageLoadingStatus = useImageLoadingStatus(src, imageProps.referrerPolicy);\n    const handleLoadingStatusChange = useCallbackRef((status) => {\n      onLoadingStatusChange(status);\n      context.onImageLoadingStatusChange(status);\n    });\n    useLayoutEffect(() => {\n      if (imageLoadingStatus !== \"idle\") {\n        handleLoadingStatusChange(imageLoadingStatus);\n      }\n    }, [imageLoadingStatus, handleLoadingStatusChange]);\n    return imageLoadingStatus === \"loaded\" ? /* @__PURE__ */ jsx(Primitive.img, { ...imageProps, ref: forwardedRef, src }) : null;\n  }\n);\nAvatarImage.displayName = IMAGE_NAME;\nvar FALLBACK_NAME = \"AvatarFallback\";\nvar AvatarFallback = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, delayMs, ...fallbackProps } = props;\n    const context = useAvatarContext(FALLBACK_NAME, __scopeAvatar);\n    const [canRender, setCanRender] = React.useState(delayMs === void 0);\n    React.useEffect(() => {\n      if (delayMs !== void 0) {\n        const timerId = window.setTimeout(() => setCanRender(true), delayMs);\n        return () => window.clearTimeout(timerId);\n      }\n    }, [delayMs]);\n    return canRender && context.imageLoadingStatus !== \"loaded\" ? /* @__PURE__ */ jsx(Primitive.span, { ...fallbackProps, ref: forwardedRef }) : null;\n  }\n);\nAvatarFallback.displayName = FALLBACK_NAME;\nfunction useImageLoadingStatus(src, referrerPolicy) {\n  const [loadingStatus, setLoadingStatus] = React.useState(\"idle\");\n  useLayoutEffect(() => {\n    if (!src) {\n      setLoadingStatus(\"error\");\n      return;\n    }\n    let isMounted = true;\n    const image = new window.Image();\n    const updateStatus = (status) => () => {\n      if (!isMounted) return;\n      setLoadingStatus(status);\n    };\n    setLoadingStatus(\"loading\");\n    image.onload = updateStatus(\"loaded\");\n    image.onerror = updateStatus(\"error\");\n    image.src = src;\n    if (referrerPolicy) {\n      image.referrerPolicy = referrerPolicy;\n    }\n    return () => {\n      isMounted = false;\n    };\n  }, [src, referrerPolicy]);\n  return loadingStatus;\n}\nvar Root = Avatar;\nvar Image = AvatarImage;\nvar Fallback = AvatarFallback;\nexport {\n  Avatar,\n  AvatarFallback,\n  AvatarImage,\n  Fallback,\n  Image,\n  Root,\n  createAvatarScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from 'react'\nimport * as AvatarPrimitive from '@radix-ui/react-avatar'\n\nimport { cn } from 'src/lib/utils'\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn('relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full', className)}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn('aspect-square h-full w-full', className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      'flex h-full w-full items-center justify-center rounded-full bg-muted',\n      className,\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","import * as React from 'react'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport { cn } from 'src/lib/utils'\nimport { Avatar, AvatarImage, AvatarFallback } from 'src/lib/shadcn/ui/avatar'\nimport MessageLoading from 'src/lib/shadcn/chat/message-loading'\nimport { Button, ButtonProps } from 'src/lib/shadcn/ui/button'\n\n// ChatBubble\nconst chatBubbleVariant = cva('flex gap-2 max-w-[60%] items-end relative group', {\n  variants: {\n    variant: {\n      received: 'self-start',\n      sent: 'self-end flex-row-reverse',\n    },\n    layout: {\n      default: '',\n      ai: 'max-w-full w-full items-center',\n    },\n  },\n  defaultVariants: {\n    variant: 'received',\n    layout: 'default',\n  },\n})\n\ninterface ChatBubbleProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof chatBubbleVariant> {\n  innerclassname?: string\n}\n\nconst ChatBubble = React.forwardRef<HTMLDivElement, ChatBubbleProps>(\n  ({ className, variant, layout, children, ...props }, ref) => (\n    <div\n      className={cn(chatBubbleVariant({ variant, layout, className }), 'relative group')}\n      ref={ref}\n      {...props}\n    >\n      {React.Children.map(children, (child) =>\n        React.isValidElement(child) && typeof child.type !== 'string'\n          ? React.cloneElement(child, {\n              variant,\n              layout,\n              className: props?.innerclassname,\n            } as React.ComponentProps<typeof child.type>)\n          : child,\n      )}\n    </div>\n  ),\n)\nChatBubble.displayName = 'ChatBubble'\n\n// ChatBubbleAvatar\ninterface ChatBubbleAvatarProps {\n  src?: string\n  fallback?: string\n  className?: string\n}\n\nconst ChatBubbleAvatar: React.FC<ChatBubbleAvatarProps> = ({ src, fallback, className }) => (\n  <Avatar className={className}>\n    <AvatarImage src={src} alt=\"Avatar\" />\n    <AvatarFallback>{fallback}</AvatarFallback>\n  </Avatar>\n)\n\n// ChatBubbleMessage\nconst chatBubbleMessageVariants = cva('p-4', {\n  variants: {\n    variant: {\n      received: 'bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg',\n      sent: 'border border-border rounded-l-lg rounded-tr-lg',\n    },\n    layout: {\n      default: '',\n      ai: 'border-t w-full rounded-none bg-transparent',\n    },\n  },\n  defaultVariants: {\n    variant: 'received',\n    layout: 'default',\n  },\n})\n\ninterface ChatBubbleMessageProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof chatBubbleMessageVariants> {\n  isLoading?: boolean\n}\n\nconst ChatBubbleMessage = React.forwardRef<HTMLDivElement, ChatBubbleMessageProps>(\n  ({ className, variant, layout, isLoading = false, children, ...props }, ref) => (\n    <div\n      className={cn(\n        chatBubbleMessageVariants({ variant, layout, className }),\n        'break-words max-w-full whitespace-pre-wrap',\n      )}\n      ref={ref}\n      {...props}\n    >\n      {isLoading ? (\n        <div className=\"flex items-center space-x-2\">\n          <MessageLoading />\n        </div>\n      ) : (\n        children\n      )}\n    </div>\n  ),\n)\nChatBubbleMessage.displayName = 'ChatBubbleMessage'\n\n// ChatBubbleTimestamp\ninterface ChatBubbleTimestampProps extends React.HTMLAttributes<HTMLDivElement> {\n  timestamp: string\n}\n\nconst ChatBubbleTimestamp: React.FC<ChatBubbleTimestampProps> = ({\n  timestamp,\n  className,\n  ...props\n}) => (\n  <div className={cn('text-xs mt-2 text-right', className)} {...props}>\n    {timestamp}\n  </div>\n)\n\n// ChatBubbleAction\ntype ChatBubbleActionProps = ButtonProps & {\n  icon: React.ReactNode\n}\n\nconst ChatBubbleAction: React.FC<ChatBubbleActionProps> = ({\n  icon,\n  onClick,\n  className,\n  variant = 'ghost',\n  size = 'icon',\n  ...props\n}) => (\n  <Button variant={variant} size={size} className={className} onClick={onClick} {...props}>\n    {icon}\n  </Button>\n)\n\ninterface ChatBubbleActionWrapperProps extends React.HTMLAttributes<HTMLDivElement> {\n  variant?: 'sent' | 'received'\n  className?: string\n}\n\nconst ChatBubbleActionWrapper = React.forwardRef<HTMLDivElement, ChatBubbleActionWrapperProps>(\n  ({ variant, className, children, ...props }, ref) => (\n    <div\n      ref={ref}\n      className={cn(\n        'absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200',\n        variant === 'sent'\n          ? '-left-1 -translate-x-full flex-row-reverse'\n          : '-right-1 translate-x-full',\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  ),\n)\nChatBubbleActionWrapper.displayName = 'ChatBubbleActionWrapper'\n\nexport {\n  ChatBubble,\n  ChatBubbleAvatar,\n  ChatBubbleMessage,\n  ChatBubbleTimestamp,\n  chatBubbleVariant,\n  chatBubbleMessageVariants,\n  ChatBubbleAction,\n  ChatBubbleActionWrapper,\n}\n","import { memo, Suspense, useMemo } from 'react'\nimport { Message } from 'ai/react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport {\n  ChatBubble,\n  ChatBubbleAction,\n  ChatBubbleAvatar,\n  ChatBubbleMessage,\n} from 'src/lib/shadcn/chat/chat-bubble'\nimport MessageLoading from 'src/lib/shadcn/chat/message-loading'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { MarkdownViewer } from 'src/components/molecules/MarkdownViewer'\n\nconst ChatAiIcons = [\n  {\n    icon: 'copy' as const,\n    label: 'Copy',\n  },\n  {\n    icon: 'refresh-ccw' as const,\n    label: 'Refresh',\n  },\n  {\n    icon: 'volume-2' as const,\n    label: 'Volume',\n  },\n]\n\nexport const ChatItem = memo(\n  ({\n    message,\n    index,\n    isLastMessage,\n    isGenerating,\n    isSchema,\n    onActionClick,\n  }: {\n    message: Message\n    index: number\n    isLastMessage: boolean\n    isGenerating?: boolean\n    isSchema?: boolean\n    onActionClick: (action: string, message: Message) => Promise<void>\n  }) => {\n    const content = useMemo(() => {\n      return (\n        <MarkdownViewer\n          style={{\n            color: 'unset !important',\n          }}\n          source={\n            message.content\n              ? isSchema\n                ? `\\`\\`\\`json\\n${message.content}\\n\\`\\`\\``\n                : message.content\n              : ''\n          }\n        />\n      )\n    }, [isSchema, message.content])\n    return (\n      <ChatBubble\n        innerclassname={message.role == 'system' ? '!bg-transparent font-semibold' : undefined}\n        key={index}\n        variant={message.role == 'user' ? 'sent' : 'received'}\n      >\n        {message.role === 'system' ? (\n          <div className=\"w-10 h-10\" />\n        ) : message.role === 'assistant' ? (\n          <ChatBubbleAvatar\n            src=\"\"\n            fallback={\n              message.data && typeof message.data === 'object' && 'injectedMessage' in message.data\n                ? '📂'\n                : '🤖'\n            }\n          />\n        ) : undefined}\n        <ChatBubbleMessage>\n          {isGenerating && isLastMessage && (!message.content || isSchema) ? (\n            <MessageLoading />\n          ) : (\n            <Suspense fallback={<MessageLoading />}>\n              {message.role === 'system' ? (\n                <Badge className=\"!text-sm mb-1\">System</Badge>\n              ) : undefined}\n              {content}\n            </Suspense>\n          )}\n          {message.role === 'assistant' && isLastMessage && (\n            <div className=\"flex items-center mt-1.5 gap-1\">\n              {!isGenerating && (\n                <>\n                  {ChatAiIcons.map((icon, iconIndex) => {\n                    return (\n                      <ChatBubbleAction\n                        variant=\"ghost\"\n                        className=\"size-5\"\n                        key={iconIndex}\n                        icon={<LazyIcon name={icon.icon} className=\"size-3\" />}\n                        onClick={() => onActionClick(icon.label, message)}\n                      />\n                    )\n                  })}\n                </>\n              )}\n            </div>\n          )}\n        </ChatBubbleMessage>\n      </ChatBubble>\n    )\n  },\n  () => false,\n)\n","import { useCallback } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { LLM } from 'src/services/database/types'\n\nexport const useUpdateLLMOptions = () => {\n  const changeLLMOptions = useCallback(async (llm: LLM, options: Record<string, unknown>) => {\n    if (llm) {\n      await getRepository('LLM').update(llm.id, { options })\n    }\n  }, [])\n\n  return {\n    changeLLMOptions,\n  }\n}\n","'use client'\n\nimport {\n  memo,\n  useEffect,\n  useRef,\n  useState,\n  KeyboardEvent,\n  MouseEvent,\n  useCallback,\n  useMemo,\n} from 'react'\nimport { nanoid } from 'nanoid'\nimport { useTranslation } from 'react-i18next'\nimport { ChatMessageList } from 'src/lib/shadcn/chat/chat-message-list'\nimport { Message, useChat } from 'ai/react'\nimport AIInput from 'src/lib/kokonutui/ai-input'\nimport { LLMStatusEnum } from 'src/services/database/types'\nimport textToSpeech from 'src/utils/text-to-speech'\nimport { SidebarInset, SidebarProvider } from 'src/lib/shadcn/ui/sidebar'\n\nimport { useChatApplicationData } from './hooks/use-chat-application-data'\nimport { useSendMessage } from './hooks/use-send-message'\nimport { ChatPanel } from './components/ChatPanel'\nimport { ChatItem } from './components/ChatItem'\nimport { useUpdateLLMOptions } from './hooks/use-update-llm-options'\n\nconst ChatApplication = memo(() => {\n  const { t } = useTranslation('applications')\n  const isScrolling = useRef(false)\n  const [isGenerating, setIsGenerating] = useState(false)\n\n  const scrollToBottom = useCallback(() => {\n    setTimeout(() => {\n      if (messagesRef.current) {\n        messagesRef.current.scrollTop = messagesRef.current.scrollHeight\n      }\n    }, 50)\n  }, [])\n\n  const chatApplicationData = useChatApplicationData()\n  const {\n    schema,\n    threadInfo,\n    mainLLMInfo,\n    retriverInfo,\n    currentDataNode,\n    loadLLM,\n    setLLMInfo,\n    addNewDataNode,\n    selectDataNode,\n    updateMessagesData,\n    onThreadMessagesLoaded,\n  } = chatApplicationData\n  const { changeLLMOptions } = useUpdateLLMOptions()\n  const { sendMessage } = useSendMessage(chatApplicationData)\n  const {\n    input,\n    messages,\n    isLoading,\n    reload,\n    setInput,\n    handleSubmit,\n    handleInputChange,\n    setMessages,\n  } = useChat({\n    fetch: async (_input: RequestInfo | URL, init?: RequestInit) => {\n      try {\n        setIsGenerating(true)\n        const body = JSON.parse(init?.body as string) as { messages: Message[] }\n        const newMessageId = nanoid()\n        const lastMessage = body.messages[body.messages.length - 1]\n        isScrolling.current = true\n        setMessages((messages) => [\n          ...messages,\n          { id: nanoid(), content: lastMessage.content, role: 'user' },\n        ])\n        await sendMessage(\n          lastMessage.content,\n          body.messages || [],\n          { retriverInfo },\n          {\n            schema,\n            onInjectedMessages: (injectedMessages) => {\n              if (injectedMessages.length) {\n                setMessages((messages) => [\n                  ...messages,\n                  ...injectedMessages.map((message) => {\n                    if (message._getType() === 'system') {\n                      return {\n                        id: nanoid(),\n                        content: `${message.content}`,\n                        role: 'system' as const,\n                        data: { injectedMessage: true },\n                      }\n                    } else if (message._getType() === 'human') {\n                      return {\n                        id: nanoid(),\n                        content: `${message.content}`,\n                        role: 'user' as const,\n                        data: { injectedMessage: true },\n                      }\n                    }\n                    return {\n                      id: nanoid(),\n                      content: `${message.content}`,\n                      role: 'assistant' as const,\n                      data: { injectedMessage: true },\n                    }\n                  }),\n                ])\n              }\n            },\n            onResponseMessageCreate: (content) => {\n              setMessages((messages) => [\n                ...messages,\n                { id: newMessageId, content: content || '', role: 'assistant' },\n              ])\n            },\n            onMessageUpdate: (info) => {\n              setMessages((messages) => {\n                const newMessages = [...messages]\n                const index = newMessages.findIndex((message) => message.id === newMessageId)\n                if (index !== -1) {\n                  newMessages[index] = {\n                    ...newMessages[index],\n                    content: info.nodeData.content || '',\n                  }\n                }\n                return newMessages\n              })\n              if (isScrolling.current) {\n                scrollToBottom()\n              }\n            },\n          },\n        )\n        setMessages((messages) => {\n          updateMessagesData(messages)\n          return messages\n        })\n        setIsGenerating(false)\n        setInput('')\n        if (isScrolling.current) {\n          scrollToBottom()\n        }\n        return new Response()\n      } finally {\n        setIsGenerating(false)\n      }\n    },\n  })\n\n  const messagesRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const cleandUp = onThreadMessagesLoaded((messages) => {\n      setMessages(messages || [])\n      scrollToBottom()\n    })\n    return () => {\n      cleandUp()\n    }\n  }, [setMessages, onThreadMessagesLoaded, scrollToBottom])\n\n  const onSubmit = async (\n    _value: string,\n    e: KeyboardEvent<HTMLTextAreaElement> | MouseEvent<HTMLButtonElement>,\n  ) => {\n    setIsGenerating(true)\n    await handleSubmit(e)\n    return true\n  }\n\n  const handleActionClick = useCallback(\n    async (action: string, message: Message) => {\n      if (action === 'Refresh') {\n        setIsGenerating(true)\n        try {\n          await reload()\n        } finally {\n          setIsGenerating(false)\n        }\n      }\n\n      if (action === 'Copy') {\n        if (message && message.role === 'assistant') {\n          navigator.clipboard.writeText(message.content)\n        }\n      }\n\n      if (action === 'Volume') {\n        if (message?.content) {\n          await textToSpeech.speak(message?.content || '')\n        }\n      }\n    },\n    [reload],\n  )\n\n  const handleStopScroll = useCallback(() => (isScrolling.current = false), [])\n\n  const messageList = useMemo(() => {\n    return (\n      messages &&\n      messages.map((message, index) => (\n        <ChatItem\n          key={message.id || `${index}`}\n          message={message}\n          index={index}\n          isLastMessage={index === messages.length - 1}\n          isGenerating={isGenerating}\n          isSchema={schema ? true : false}\n          onActionClick={handleActionClick}\n        />\n      ))\n    )\n  }, [messages, isGenerating, schema, handleActionClick])\n\n  return (\n    <SidebarProvider\n      onClick={handleStopScroll}\n      className=\"max-h-full !overflow-hidden !min-h-full\"\n      style={{ minHeight: 'unset' }}\n      defaultOpen={true}\n    >\n      <SidebarInset className=\"!max-h-full !overflow-hidden\" style={{ minHeight: 'unset' }}>\n        <main className=\"flex h-full w-full max-w-2xl flex-col items-center mx-auto overflow-hidden\">\n          <div className=\"flex-1 overflow-y-auto overflow-x-hidden min-w-full max-w-full\">\n            <ChatMessageList className=\"!max-h-full\" ref={messagesRef}>\n              {messageList}\n            </ChatMessageList>\n          </div>\n          <AIInput\n            className=\"!max-w-2xl px-4\"\n            onSubmit={onSubmit}\n            disabled={isLoading || isGenerating || mainLLMInfo?.status !== LLMStatusEnum.Loaded}\n            placeholder={t('chat.input_message_placeholder')}\n            value={input}\n            onChange={handleInputChange}\n          />\n        </main>\n      </SidebarInset>\n      <ChatPanel\n        schema={schema}\n        currentDataNode={currentDataNode}\n        threadNode={threadInfo?.threadNode}\n        loadLLM={loadLLM}\n        mainLLMInfo={mainLLMInfo}\n        mainEmbeddingInfo={chatApplicationData.mainEmbeddingInfo}\n        retriverInfo={retriverInfo}\n        onAddNewThread={addNewDataNode}\n        onSelectThread={selectDataNode}\n        changeLLMOptions={changeLLMOptions}\n        setLLMInfo={setLLMInfo}\n      />\n    </SidebarProvider>\n  )\n})\n\nexport default ChatApplication\n"],"file":"assets/ChatApplication-BTfVIPGy.js"}