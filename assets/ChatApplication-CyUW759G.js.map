{"version":3,"mappings":"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","names":["ChatMessageList","className","children","props","jsx","ref","useChatApplicationData","chatInfo","useState","mainEmbeddingInfo","setMainEmbeddingInfo","threadInfo","mainLLMInfo","setLLMInfo","onThreadMessagesLoadedRef","useRef","currentSession","useSessionState","loadModel","useLoadModel","sessionPassphraseDialogRef","useModalRef","SessionPassphraseDialog","dataNode","jsonData","setCurrentDataNode","addNewDataNode","sessionId","input","threadNode","prompt","getRepository","initialMessages","jsonDataNode","handleThreadData","useCallback","prompts","threadData","getRetrieveVectorDatabase","placeholderInfo","retriverInfo","info","connections","connection","result","item","promptNode","node","vectorDatabaseNode","nodeData","vectorDatabaseEntity","setRetriverInfo","thread","flowNodeDatas","findFlowNodesWithSource","In","threadConnections","threadConnectedNodes","schemaInfo","llm","llmInfo","FlowNodeTypeEnum","embeddingNode","embeddingEntity","schemaEntity","schemaItems","setChatInfo","promptInfo","sessionHandleStatus","pre","LLMStatusEnum","data","onThreadMessagesLoaded","callback","currentDataNode","useEffect","getChatApplicationData","updateMessagesData","selectDataNode","useSendMessage","similaritySearchWithScore","stream","content","placeholderRecord","k","minimalScore","chatApplicationData","documents","template","PromptTemplate","injectedMessages","AIMessage","score","doc","handlePlaceholders","message","onInjectedMessages","formatedMessages","SystemMessage","HumanMessage","onResponseMessageCreate","schema","onMessageUpdate","loading","create","onDelete","setLoading","useToast","t","currentModal","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","handleSubmit","MessageLoading","jsxs","memo","status","loadLLM","progress","hasModelInCache","functionCallingModelIds","prebuiltAppConfig","hasCache","useMemo","Card","handleLoadLLM","useVectorDatabaseActions","toast","indexFunction","similaritySearchWithScoreFunction","useEmbedding","options","indexData","Document","chunkedDocuments","chunk","partDocuments","handledCount","mode","setMode","setProgress","vectorDatabaseData","decodeLine","row","handleCreateData","value","handleIndexPDF","file","reader","WebPDFLoader","blob","pdfjs","VectorSearch","handleSimilaritySearch","TabsContent","IndexNewText","Dialog","DialogHeader","LazyIcon","DialogTitle","Tabs","TabsList","VectorDatabaseStorageEnum","useChatList","chatList","threadDataEdged","flowNodes","edge","all","entity","allEdges","getChatList","deleteChat","ChatPanel","onAddNewThread","useTranslation","React.useState","deleteChatDataNodeDialog","useModal","DeleteChatDataNodeDialog","vectorDatabaseDialog","VectorDatabaseDialog","React.useCallback","handleDeleteDataNode","e","handleChangeOptions","changeLLMOptions","React.useMemo","MarkdownViewer","cn","convertToZodSchemaString","Sidebar","SidebarGroupLabel","SidebarContent","SidebarMenu","index","SidebarMenuItem","onSelectThread","key","Button","React.Suspense","ChatLLMInfo","AVATAR_NAME","createAvatarContext","createAvatarScope","createContextScope","AvatarProvider","React.forwardRef","forwardedRef","avatarProps","imageLoadingStatus","setImageLoadingStatus","Avatar","AvatarImage","__scopeAvatar","src","onLoadingStatusChange","useAvatarContext","IMAGE_NAME","context","useLayoutEffect","handleLoadingStatusChange","Primitive","FALLBACK_NAME","AvatarFallback","canRender","setCanRender","delayMs","React.useEffect","timerId","fallbackProps","useImageLoadingStatus","loadingStatus","setLoadingStatus","updateStatus","image","referrerPolicy","Root","Image","Fallback","AvatarPrimitive.Root","AvatarPrimitive.Image","AvatarPrimitive.Fallback","chatBubbleVariant","ChatBubble","layout","variant","React.isValidElement","React.cloneElement","fallback","chatBubbleMessageVariants","isLoading","ChatBubbleMessage","size","onClick","ChatItem","isSchema","onActionClick","ChatBubbleAvatar","isGenerating","isLastMessage","Suspense","Fragment","ChatAiIcons","iconIndex","ChatBubbleAction","icon","useUpdateLLMOptions","ChatApplication","messagesRef","sendMessage","messages","setInput","setMessages","_input","init","setIsGenerating","body","nanoid","lastMessage","isScrolling","newMessages","newMessageId","scrollToBottom","cleandUp","onSubmit","_value","handleActionClick","action","reload","handleStopScroll","SidebarInset","AIInput"],"ignoreList":[10],"sources":["../../src/lib/shadcn/chat/chat-message-list.tsx","../../src/components/pages/ChatApplication/hooks/use-chat-application-data.ts","../../src/components/pages/ChatApplication/hooks/use-send-message.ts","../../src/components/dialogs/DeleteChatDataNodeDialog/index.tsx","../../src/lib/shadcn/chat/message-loading.tsx","../../src/components/pages/ChatApplication/components/ChatLLMInfo.tsx","../../src/components/pages/ChatApplication/hooks/use-vector-database-actions.ts","../../src/components/pages/ChatApplication/components/VectorDatabaseDialog/index.tsx","../../src/components/pages/ChatApplication/hooks/use-chat-list.ts","../../src/components/pages/ChatApplication/components/ChatPanel.tsx","../../node_modules/@radix-ui/react-avatar/dist/index.mjs","../../src/lib/shadcn/ui/avatar.tsx","../../src/lib/shadcn/chat/chat-bubble.tsx","../../src/components/pages/ChatApplication/components/ChatItem.tsx","../../src/components/pages/ChatApplication/hooks/use-update-llm-options.ts","../../src/components/pages/ChatApplication/ChatApplication.tsx"],"sourcesContent":["import * as React from 'react'\nimport { cn } from 'src/lib/utils'\n\ntype ChatMessageListProps = React.HTMLAttributes<HTMLDivElement>\n\nconst ChatMessageList = React.forwardRef<HTMLDivElement, ChatMessageListProps>(\n  ({ className, children, ...props }, ref) => (\n    <div\n      className={cn('flex flex-col w-full h-full p-4 gap-6 overflow-y-auto', className)}\n      ref={ref}\n      {...props}\n    >\n      {children}\n    </div>\n  ),\n)\n\nChatMessageList.displayName = 'ChatMessageList'\n\nexport { ChatMessageList }\n","import { useCallback, useEffect, useRef, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { findFlowNodesWithSource } from 'src/states/flow/actions'\nimport {\n  EntityTypes,\n  FlowEdge,\n  FlowNode,\n  FlowNodePlaceholder,\n  FlowNodeTypeEnum,\n  JSONData,\n  LLM,\n  LLMStatusEnum,\n  Prompt,\n  Schema,\n  Thread,\n  VectorDatabase,\n} from 'src/services/database/types'\nimport { In } from 'src/services/database/typeorm-wrapper'\nimport { Message } from 'ai/react'\nimport { useLoadModel } from 'src/hooks/mutations/use-load-model'\nimport SessionPassphraseDialog from 'src/components/dialogs/SessionPassphraseDialog'\nimport { passphraseConfirm } from 'src/utils/passphrase'\nimport { useModalRef } from 'src/hooks/use-modal-ref'\n\nexport const useChatApplicationData = () => {\n  const [chatInfo, setChatInfo] = useState<{\n    prompts?: Prompt[]\n    schema?: Schema\n  }>()\n  const [mainEmbeddingInfo, setMainEmbeddingInfo] = useState<{\n    embedding?: FlowNodePlaceholder\n  }>()\n  const [threadInfo, setThreadInfo] = useState<{ thread: Thread; threadNode: FlowNode }>()\n  const [mainLLMInfo, setLLMInfo] = useState<{\n    llm: LLM\n    status: `${LLMStatusEnum}`\n    progress?: string\n  }>()\n  const [retriverInfo, setRetriverInfo] = useState<\n    {\n      promptNode: FlowNode\n      vectorDatabaseNode: FlowNode\n      placeholderNode: FlowNode\n      placeholderEntity: FlowNodePlaceholder\n      promptEntity: Prompt\n      vectorDatabaseEntity: VectorDatabase\n    }[]\n  >([])\n  const [currentDataNode, setCurrentDataNode] = useState<{ node: FlowNode; enity: JSONData }>()\n  const onThreadMessagesLoadedRef = useRef<(messages: Message[]) => void>()\n  const sessionHandleStatus = useRef<{ handling?: string; handled?: string }>({})\n  const currentSession = useSessionState((state) => state.currentSession)\n  const { loadModel } = useLoadModel()\n  const { modalRef: sessionPassphraseDialogRef } = useModalRef(SessionPassphraseDialog)\n\n  const selectDataNode = useCallback(\n    async (dataNode: FlowNode) => {\n      if (!currentSession) {\n        return\n      }\n      const jsonData = await getRepository('JSONData').findOne({\n        where: { id: dataNode.source_id, session_id: currentSession?.id },\n      })\n      if (!jsonData) {\n        return\n      }\n      onThreadMessagesLoadedRef.current?.(\n        jsonData.data ? (jsonData.data as unknown as Message[]) : [],\n      )\n      setCurrentDataNode({\n        node: dataNode,\n        enity: jsonData,\n      })\n    },\n    [currentSession],\n  )\n\n  const addNewDataNode = useCallback(\n    async (input?: { sessionId?: string; threadNode?: FlowNode; prompts?: Prompt[] }) => {\n      const sessionId = input?.sessionId || currentSession?.id\n      const threadNode = input?.threadNode || threadInfo?.threadNode\n      const systemPrompt = input?.prompts || chatInfo?.prompts\n\n      if (!sessionId || !threadNode?.id) {\n        return\n      }\n      const initialMessages = systemPrompt\n        ?.map((prompt) => {\n          if (prompt.type === 'few_shot_example') {\n            return undefined\n          }\n          switch (prompt.role) {\n            case 'ai':\n            case 'assistant':\n            case 'tool':\n              return {\n                id: prompt.id,\n                content: prompt.content,\n                role: 'assistant',\n              }\n            case 'system':\n              return {\n                id: prompt.id,\n                content: prompt.content,\n                role: 'system',\n              }\n            default:\n              return {\n                id: prompt.id,\n                content: prompt.content,\n                role: 'user',\n              }\n          }\n        })\n        .filter(Boolean) as Message[]\n      const jsonData = await getRepository('JSONData').save({\n        headers: 'item',\n        session_id: sessionId,\n        json: '',\n        data: initialMessages,\n      })\n      if (!jsonData) {\n        return\n      }\n      const jsonDataNode = await getRepository('FlowNode').save({\n        session_id: sessionId,\n        source_id: jsonData.id,\n        source_type: 'JSONData',\n        node_type: 'JSON_DATA',\n        x: 0,\n        y: 0,\n      })\n      if (!jsonDataNode) {\n        return\n      }\n      await getRepository('FlowEdge').save({\n        session_id: sessionId,\n        source: threadNode.id,\n        target: jsonDataNode.id,\n      })\n      onThreadMessagesLoadedRef.current?.(initialMessages)\n      setCurrentDataNode({\n        node: jsonDataNode,\n        enity: jsonData,\n      })\n      return {\n        jsonData,\n        jsonDataNode,\n      }\n    },\n    [chatInfo?.prompts, currentSession?.id, threadInfo?.threadNode],\n  )\n\n  const handleThreadData = useCallback(\n    async (threadNode: FlowNode, prompts: Prompt[]) => {\n      if (!currentSession) {\n        return\n      }\n      const threadData = await getRepository('FlowEdge').findOne({\n        where: { session_id: currentSession.id, source: threadNode.id },\n        order: { id: 'DESC' },\n      })\n      if (!threadData) {\n        const result = await addNewDataNode({\n          sessionId: currentSession.id,\n          threadNode,\n          prompts: prompts || [],\n        })\n        if (!result) {\n          return\n        }\n      } else {\n        const dataNode = await getRepository('FlowNode').findOne({\n          where: { id: threadData.target, session_id: currentSession.id },\n        })\n        if (!dataNode) {\n          return\n        }\n        await selectDataNode(dataNode)\n      }\n    },\n    [addNewDataNode, currentSession, selectDataNode],\n  )\n\n  const getRetrieveVectorDatabase = useCallback(\n    async (\n      placeholderInfo: {\n        connection: FlowEdge\n        source: FlowNode\n        entity?: EntityTypes\n      }[],\n    ) => {\n      if (placeholderInfo?.length && currentSession?.id) {\n        const data = await Promise.all(\n          placeholderInfo.map(async (info) => {\n            return getRepository('FlowEdge')\n              .find({\n                where: {\n                  target: info.source.id,\n                },\n              })\n              .then((connections) => {\n                return findFlowNodesWithSource({\n                  where: {\n                    session_id: currentSession.id,\n                    id: In(connections.map((connection) => connection.source)),\n                  },\n                }).then((result) => ({\n                  ...result,\n                  ...info,\n                }))\n              })\n          }),\n        )\n        const retriverInfo = data\n          .map((item) => {\n            const promptNode = item.flowNodes.find((node) => node.source_type === 'Prompt')\n            const vectorDatabaseNode = item.flowNodes.find(\n              (node) => node.source_type === 'VectorDatabase',\n            )\n            if (!vectorDatabaseNode || !promptNode) {\n              return\n            }\n            const promptEntity = item.flowNodeDatas?.Prompt?.find(\n              (nodeData) => nodeData.id === promptNode.source_id,\n            )\n            const vectorDatabaseEntity = item.flowNodeDatas?.VectorDatabase?.find(\n              (nodeData) => nodeData.id === vectorDatabaseNode.source_id,\n            )\n            return {\n              promptNode,\n              vectorDatabaseNode,\n              placeholderNode: item.source,\n              placeholderEntity: item.entity,\n              promptEntity: promptEntity as Prompt,\n              vectorDatabaseEntity: vectorDatabaseEntity as VectorDatabase,\n            }\n          })\n          .filter(Boolean) as {\n          promptNode: FlowNode\n          vectorDatabaseNode: FlowNode\n          placeholderNode: FlowNode\n          placeholderEntity: FlowNodePlaceholder\n          promptEntity: Prompt\n          vectorDatabaseEntity: VectorDatabase\n        }[]\n        setRetriverInfo(retriverInfo)\n      }\n    },\n    [currentSession?.id],\n  )\n\n  const getChatApplicationData = useCallback(async () => {\n    try {\n      sessionHandleStatus.current.handling = currentSession?.id\n      if (\n        !currentSession?.id ||\n        !currentSession?.main_source_id ||\n        currentSession?.main_source_type !== 'Thread'\n      ) {\n        return\n      }\n      const [thread, threadNode] = await Promise.all([\n        getRepository('Thread').findOne({\n          where: { id: currentSession.main_source_id, session_id: currentSession.id },\n        }),\n        getRepository('FlowNode').findOne({\n          where: {\n            id: currentSession.main_node_id,\n          },\n        }),\n      ])\n      if (!thread || !threadNode) {\n        return\n      }\n      const threadConnections = await getRepository('FlowEdge').find({\n        where: { session_id: currentSession.id, target: threadNode.id },\n      })\n      const { flowNodes, flowNodeDatas } = await findFlowNodesWithSource({\n        where: {\n          session_id: currentSession.id,\n          id: In(threadConnections.map((connection) => connection.source)),\n        },\n      })\n      const allConnections = await getRepository('FlowEdge').find({\n        where: { session_id: currentSession.id },\n      })\n\n      const threadConnectedNodes = allConnections\n        .filter((connection) => connection.target === threadNode.id)\n        .map((connection) => {\n          const node = flowNodes.find((node) => node.id === connection.source)!\n          return {\n            connection,\n            source: node,\n            entity: flowNodeDatas?.[node.source_type]?.find(\n              (nodeData) => nodeData.id === node.source_id,\n            ),\n          }\n        })\n\n      const llmInfo = threadConnectedNodes.find((node) => node.source.source_type === 'LLM')\n      const promptInfo = threadConnectedNodes.filter((node) => node.source.source_type === 'Prompt')\n      const schemaInfo = threadConnectedNodes.find((node) => node.source.source_type === 'Schema')\n\n      const llm = llmInfo?.entity as LLM\n\n      if (!llm) {\n        return\n      }\n\n      if (currentSession.passphrase) {\n        await passphraseConfirm(currentSession.passphrase!, sessionPassphraseDialogRef.current)\n      }\n\n      const placeholderInfo = threadConnectedNodes.filter(\n        (node) => node.source.source_type === 'FlowNodePlaceholder',\n      )\n\n      await getRetrieveVectorDatabase(placeholderInfo)\n      await handleThreadData(threadNode, promptInfo?.map((info) => info.entity as Prompt) || [])\n\n      // Handle Embedding Node\n      const embeddingNode = await getRepository('FlowNode').findOne({\n        where: {\n          node_type: FlowNodeTypeEnum.DefaultEmbeddingModel,\n          source_type: 'FlowNodePlaceholder',\n        },\n      })\n\n      if (embeddingNode) {\n        const embeddingEntity = await getRepository('FlowNodePlaceholder').findOne({\n          where: { id: embeddingNode.source_id },\n        })\n        setMainEmbeddingInfo({\n          embedding: embeddingEntity,\n        })\n      }\n\n      setLLMInfo({\n        llm,\n        status: llm.status || LLMStatusEnum.Started,\n        progress: '',\n      })\n      setThreadInfo({\n        thread,\n        threadNode,\n      })\n      const schemaEntity = schemaInfo?.entity as Schema\n      if (schemaEntity) {\n        const schemaItems = await getRepository('SchemaItem').find({\n          where: { schema_id: schemaEntity.id },\n        })\n        schemaEntity.schema_items = schemaItems || []\n      }\n\n      setChatInfo({\n        prompts: promptInfo?.map((info) => info.entity as Prompt) || [],\n        schema: schemaEntity,\n      })\n\n      sessionHandleStatus.current.handled = currentSession.id\n    } finally {\n      sessionHandleStatus.current.handling = undefined\n    }\n  }, [\n    currentSession?.id,\n    currentSession?.main_node_id,\n    currentSession?.main_source_id,\n    currentSession?.main_source_type,\n    currentSession?.passphrase,\n    getRetrieveVectorDatabase,\n    handleThreadData,\n    sessionPassphraseDialogRef,\n  ])\n\n  const loadLLM = useCallback(async () => {\n    if (!mainLLMInfo?.llm?.name) {\n      return\n    }\n    try {\n      setLLMInfo((pre) => (pre ? { ...pre, status: LLMStatusEnum.Loading } : pre))\n      await loadModel(mainLLMInfo.llm.provider, mainLLMInfo?.llm.name, (data) => {\n        setLLMInfo((pre) => (pre ? { ...pre, progress: data.text } : pre))\n      })\n      setLLMInfo((pre) => (pre ? { ...pre, status: LLMStatusEnum.Loaded, progress: '' } : pre))\n    } catch {\n      setLLMInfo((pre) => (pre ? { ...pre, status: LLMStatusEnum.Started, progress: '' } : pre))\n    }\n  }, [mainLLMInfo?.llm?.name, mainLLMInfo?.llm?.provider, loadModel])\n\n  const onThreadMessagesLoaded = useCallback((callback: (messages: Message[]) => void) => {\n    onThreadMessagesLoadedRef.current = callback\n    return () => {\n      onThreadMessagesLoadedRef.current = undefined\n    }\n  }, [])\n\n  const updateMessagesData = useCallback(\n    async (messages: Message[]) => {\n      if (!currentDataNode?.node || !currentDataNode?.enity) {\n        return\n      }\n      await getRepository('JSONData').save({\n        ...currentDataNode.enity,\n        data: messages,\n      })\n    },\n    [currentDataNode?.enity, currentDataNode?.node],\n  )\n\n  useEffect(() => {\n    if (\n      sessionHandleStatus.current.handling ||\n      sessionHandleStatus?.current.handled === currentSession?.id\n    ) {\n      return\n    }\n    getChatApplicationData()\n  }, [currentSession?.id, getChatApplicationData])\n\n  return {\n    ...chatInfo,\n    loadLLM,\n    threadInfo,\n    mainLLMInfo,\n    mainEmbeddingInfo,\n    retriverInfo,\n    currentDataNode,\n    updateMessagesData,\n    addNewDataNode,\n    selectDataNode,\n    setLLMInfo,\n    onThreadMessagesLoaded,\n  }\n}\n","import { useCallback, useState } from 'react'\nimport { PromptTemplate } from '@langchain/core/prompts'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { FlowNodePlaceholderTypeEnum, LLMStatusEnum, Schema } from 'src/services/database/types'\nimport { AIMessage, BaseMessage, HumanMessage, SystemMessage } from '@langchain/core/messages'\nimport { Message } from 'ai/react'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\nimport { useChatApplicationData } from './use-chat-application-data'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\n\ntype CreateMessageOption = {\n  schema?: Schema\n  onMessageUpdate: (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => void\n  onResponseMessageCreate: (message?: string) => void\n  onInjectedMessages: (messages: BaseMessage[]) => void\n}\nexport const useSendMessage = (chatApplicationData: ReturnType<typeof useChatApplicationData>) => {\n  const [loading] = useState(false)\n  const { similaritySearchWithScore } = useEmbedding()\n  const { stream } = useLLM()\n\n  const handlePlaceholders = useCallback(\n    async (\n      content: string,\n      retriverInfo: ReturnType<typeof useChatApplicationData>['retriverInfo'],\n    ): Promise<BaseMessage[]> => {\n      if (!retriverInfo?.length) {\n        return []\n      }\n      const injectedMessages: BaseMessage[] = []\n      await Promise.all(\n        retriverInfo.map(async (item) => {\n          const placeholderRecord = item.placeholderEntity\n          if (!placeholderRecord) {\n            return\n          }\n          switch (placeholderRecord.placeholder_type) {\n            case FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER: {\n              if (\n                !item.promptNode ||\n                !item.promptEntity ||\n                !item.vectorDatabaseNode ||\n                !item.vectorDatabaseEntity\n              ) {\n                return\n              }\n              const k = placeholderRecord.metadata?.k ? +placeholderRecord.metadata?.k : 1\n              let minimalScore = placeholderRecord.metadata?.minimalScore\n                ? +placeholderRecord.metadata?.minimalScore\n                : undefined\n              if (minimalScore && minimalScore > 1) {\n                minimalScore = minimalScore / 100\n              }\n              const documents = await similaritySearchWithScore(\n                chatApplicationData?.mainEmbeddingInfo?.embedding,\n                {\n                  database: {\n                    databaseId: item.vectorDatabaseEntity.id,\n                  },\n                },\n                content,\n                k,\n              )\n              if (!documents) {\n                return []\n              }\n              const template = new PromptTemplate({\n                template: item.promptEntity.content,\n                inputVariables: ['context'],\n              })\n              injectedMessages.push(\n                new AIMessage(\n                  await template.format({\n                    context: !minimalScore\n                      ? documents.map(([doc]) => doc.pageContent).join('\\n')\n                      : documents\n                          .filter(([, score]) => score >= minimalScore)\n                          .map(([doc]) => doc.pageContent)\n                          .join('\\n'),\n                  }),\n                ),\n              )\n            }\n          }\n        }),\n      )\n      return injectedMessages\n    },\n    [similaritySearchWithScore, chatApplicationData?.mainEmbeddingInfo?.embedding],\n  )\n\n  const sendMessage = useCallback(\n    async (\n      message: string,\n      messages: Message[],\n      {\n        retriverInfo,\n      }: {\n        retriverInfo?: ReturnType<typeof useChatApplicationData>['retriverInfo']\n      },\n      { schema, onMessageUpdate, onResponseMessageCreate, onInjectedMessages }: CreateMessageOption,\n    ) => {\n      if (\n        !chatApplicationData.mainLLMInfo?.llm ||\n        chatApplicationData.mainLLMInfo?.status !== LLMStatusEnum.Loaded\n      ) {\n        throw new Error('LLM not found')\n      }\n\n      const injectedMessages: BaseMessage[] = []\n\n      if (retriverInfo?.length) {\n        injectedMessages.push(...(await handlePlaceholders(message, retriverInfo)))\n        onInjectedMessages?.(injectedMessages)\n      }\n\n      const formatedMessages = messages.map((message) => {\n        if (message.role === 'system') {\n          return new SystemMessage(message.content)\n        }\n        if (message.role === 'user') {\n          return new HumanMessage(message.content)\n        }\n        return new AIMessage(message.content)\n      })\n\n      onResponseMessageCreate?.()\n\n      const { content } = await stream(\n        chatApplicationData.mainLLMInfo.llm.provider,\n        [...injectedMessages, ...formatedMessages],\n        {\n          schemas: schema ? [schema] : undefined,\n          onMessageUpdate: ({ content }) => {\n            onMessageUpdate?.({\n              nodeData: {\n                loading: true,\n                content: content,\n              },\n            })\n          },\n          llm: chatApplicationData.mainLLMInfo.llm,\n        },\n      )\n\n      onMessageUpdate?.({\n        nodeData: {\n          content,\n        },\n      })\n      return content\n    },\n    [handlePlaceholders, stream, chatApplicationData.mainLLMInfo],\n  )\n\n  return {\n    loading,\n    sendMessage,\n  }\n}\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from 'src/lib/shadcn/ui/alert-dialog'\n\ntype DeleteSessionDialogProps = {\n  onDelete: () => Promise<void>\n}\nconst DeleteChatDataNodeDialog = create<DeleteSessionDialogProps>(({ onDelete }) => {\n  const { t } = useTranslation('dialogs')\n  const [loading, setLoading] = useState(false)\n  const currentModal = useModal()\n  const { toast } = useToast()\n\n  const handleSubmit = async () => {\n    try {\n      setLoading(true)\n      await onDelete()\n      currentModal.hide()\n    } catch {\n      toast({\n        variant: 'destructive',\n        description: t('delete_chat_data_node.errors.delete_failed'),\n      })\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <AlertDialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>{t('delete_chat_data_node.title')}</AlertDialogTitle>\n          <AlertDialogDescription>{t('delete_chat_data_node.description')}</AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel onClick={currentModal.hide}>\n            {t('delete_chat_data_node.cancel')}\n          </AlertDialogCancel>\n          <AlertDialogAction disabled={loading} onClick={handleSubmit}>\n            {t('delete_chat_data_node.delete')}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  )\n})\n\nexport default DeleteChatDataNodeDialog\n","// @hidden\nexport default function MessageLoading() {\n  return (\n    <svg\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className=\"text-foreground\"\n    >\n      <circle cx=\"4\" cy=\"12\" r=\"2\" fill=\"currentColor\">\n        <animate\n          id=\"spinner_qFRN\"\n          begin=\"0;spinner_OcgL.end+0.25s\"\n          attributeName=\"cy\"\n          calcMode=\"spline\"\n          dur=\"0.6s\"\n          values=\"12;6;12\"\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\n        />\n      </circle>\n      <circle cx=\"12\" cy=\"12\" r=\"2\" fill=\"currentColor\">\n        <animate\n          begin=\"spinner_qFRN.begin+0.1s\"\n          attributeName=\"cy\"\n          calcMode=\"spline\"\n          dur=\"0.6s\"\n          values=\"12;6;12\"\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\n        />\n      </circle>\n      <circle cx=\"20\" cy=\"12\" r=\"2\" fill=\"currentColor\">\n        <animate\n          id=\"spinner_OcgL\"\n          begin=\"spinner_qFRN.begin+0.2s\"\n          attributeName=\"cy\"\n          calcMode=\"spline\"\n          dur=\"0.6s\"\n          values=\"12;6;12\"\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\n        />\n      </circle>\n    </svg>\n  )\n}\n","import { memo, useCallback, useEffect, useMemo, useState } from 'react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { LLMStatusEnum } from 'src/services/database/types/llm'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\n\nimport { LLM } from 'src/services/database/types'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { Card } from 'src/lib/shadcn/ui/card'\n\nexport const ChatLLMInfo = memo(\n  ({\n    llm,\n    status,\n    loadLLM,\n    progress,\n  }: {\n    llm?: LLM\n    progress?: string\n    status?: `${LLMStatusEnum}`\n    loadLLM?: () => Promise<void>\n  }) => {\n    const { t } = useTranslation('flows')\n    const [llmInfo, setLLMInfo] = useState<\n      | { hasCache: boolean; isFunctionCalling: boolean; info?: ModelRecord; cloud?: boolean }\n      | undefined\n    >()\n\n    useEffect(() => {\n      if (llmInfo || !llm?.name) {\n        return\n      }\n      if (llm?.provider !== 'WebLLM') {\n        setLLMInfo({\n          hasCache: false,\n          cloud: true,\n          isFunctionCalling: true,\n          info: {\n            model_id: llm?.name,\n            model: llm?.name,\n            model_lib: llm?.provider,\n            model_type: 2,\n          },\n        })\n        return\n      }\n      import('@mlc-ai/web-llm').then(\n        async ({ hasModelInCache, functionCallingModelIds, prebuiltAppConfig }) => {\n          const hasCache = await hasModelInCache(llm?.name)\n          setLLMInfo({\n            hasCache,\n            isFunctionCalling: functionCallingModelIds.includes(llm?.name),\n            info: prebuiltAppConfig.model_list.find((item) => item.model_id === llm?.name),\n          })\n        },\n      )\n    }, [llm?.name, llmInfo])\n\n    const handleLoadLLM = useCallback(async () => {\n      await loadLLM?.()\n    }, [loadLLM])\n\n    const llmIcon = useMemo(() => {\n      switch (status) {\n        case LLMStatusEnum.Downloading:\n          return <LazyIcon className={'animate-spin w-7 h-7'} name={'arrow-big-down-dash'} />\n        case LLMStatusEnum.Loaded:\n          return <LLMIcon name={llm?.name || 'brain'} className=\"w-7 h-7\" />\n        default:\n          return <LLMIcon name={llm?.name || 'brain'} className=\"w-7 h-7\" />\n      }\n    }, [llm?.name, status])\n    return (\n      <Card className=\"flex justify-center !bg-inherit !p-2 max-w-full overflow-y-hidden !mb-2 m-2 !mt-0\">\n        <div className=\"ml-2 pt-1 max-w-full\">\n          <p className=\"flex gap-2 items-center pr-6 !text-sm font-semibold\">\n            {llmIcon}\n            {`${llm?.name || ''}`}\n          </p>\n          <div className=\"max-w-full mt-2 flex-wrap flex gap-1\">\n            <LLMInfo\n              model={llmInfo?.info}\n              isFunctionCalling={llmInfo?.isFunctionCalling || false}\n              name={llm?.name}\n              isCached={llmInfo?.hasCache || false}\n              cloud={llmInfo?.cloud || false}\n            />\n            {status !== LLMStatusEnum.Loaded ? (\n              progress ? (\n                <div className=\"text-sm break-words flex-wrap\">{progress}</div>\n              ) : (\n                <Button\n                  disabled={status === LLMStatusEnum.Loading}\n                  onClick={handleLoadLLM}\n                  className=\"mt-4 w-full\"\n                >\n                  {t(\n                    llmInfo?.hasCache\n                      ? 'llm_node.load_model_button'\n                      : 'llm_node.download_model_button',\n                  )}\n                </Button>\n              )\n            ) : undefined}\n          </div>\n        </div>\n      </Card>\n    )\n  },\n)\n","import { Document } from '@langchain/core/documents'\nimport chunk from 'lodash/chunk'\nimport { useCallback, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport type { VectorDatabase } from 'src/services/database/types'\nimport { VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { useChatApplicationData } from './use-chat-application-data'\n\nexport const useVectorDatabaseActions = (\n  mainEmbeddingInfo?: ReturnType<typeof useChatApplicationData>['mainEmbeddingInfo'],\n) => {\n  const [loading, setLoading] = useState(false)\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n\n  const { index: indexFunction, similaritySearchWithScore: similaritySearchWithScoreFunction } =\n    useEmbedding()\n  const similaritySearchWithScore = useCallback(\n    async (input: string, options?: { k?: number; vectorDatabase: VectorDatabase }) => {\n      try {\n        if (!options?.vectorDatabase) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n        if (options?.vectorDatabase.storage === VectorDatabaseStorageEnum.DataNode) {\n          throw new Error('DataNode storage is not supported for similarity search')\n        } else {\n          setLoading(true)\n          const result = await similaritySearchWithScoreFunction(\n            mainEmbeddingInfo?.embedding,\n            {\n              database: {\n                databaseId: options.vectorDatabase.id,\n              },\n            },\n            input,\n            options?.k,\n          )\n          return result\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [toast, t, similaritySearchWithScoreFunction, mainEmbeddingInfo?.embedding],\n  )\n\n  const indexData = useCallback(\n    async (\n      data: { id?: string; content?: string; documents?: Document[] },\n      options?: {\n        vectorDatabase: VectorDatabase\n        onProgressReport?: (info: { total: number; handled: number; handling: number }) => void\n      },\n    ) => {\n      try {\n        setLoading(true)\n        const documents = data.content\n          ? [\n              new Document({\n                pageContent: data.content,\n                id: data.id,\n                metadata: {\n                  id: data.id,\n                },\n              }),\n            ]\n          : data.documents\n\n        if (!documents?.length) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.content_not_found'),\n          })\n          return\n        }\n\n        if (!options?.vectorDatabase) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n\n        if (options?.vectorDatabase.storage === VectorDatabaseStorageEnum.DataNode) {\n          throw new Error('DataNode storage is not supported for indexing')\n        } else {\n          // DEFAULT OPTION IS INDEXING AND STORED DIRECTLY TO VECTOR DATABASE ENTITY\n          const chunkedDocuments = chunk(documents, 10)\n          let handledCount = 0\n\n          for (const partDocuments of chunkedDocuments) {\n            options?.onProgressReport?.({\n              handling: partDocuments.length,\n              handled: handledCount,\n              total: documents.length,\n            })\n            await indexFunction(\n              mainEmbeddingInfo?.embedding,\n              {\n                database: {\n                  databaseId: options.vectorDatabase.id,\n                },\n              },\n              partDocuments,\n            )\n            handledCount += partDocuments.length\n          }\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [toast, t, indexFunction, mainEmbeddingInfo?.embedding],\n  )\n\n  return {\n    loading,\n    indexData,\n    similaritySearchWithScore,\n  }\n}\n","import { useCallback, useMemo, useState } from 'react'\nimport { create, useModal } from '@ebay/nice-modal-react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { WebPDFLoader } from '@langchain/community/document_loaders/web/pdf'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from 'src/lib/shadcn/ui/tabs'\nimport { VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { cn } from 'src/lib/utils'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from 'src/lib/shadcn/ui/dialog'\nimport { VectorSearch } from 'src/components/flows/Nodes/VectorDatabaseNode/components/VectorSearch'\nimport IndexNewText from 'src/components/flows/Nodes/VectorDatabaseNode/components/IndexNewText'\nimport IndexNewFile from 'src/components/flows/Nodes/VectorDatabaseNode/components/IndexNewFile'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { decodeLine } from 'src/utils/string-data'\nimport { useVectorDatabaseActions } from 'src/components/pages/ChatApplication/hooks/use-vector-database-actions'\nimport { useChatApplicationData } from 'src/components/pages/ChatApplication/hooks/use-chat-application-data'\n\ntype VectorDatabaseDialogProps = {\n  retriverInfo: ReturnType<typeof useChatApplicationData>['retriverInfo'][number]\n  mainEmbeddingInfo?: ReturnType<typeof useChatApplicationData>['mainEmbeddingInfo']\n}\n\nconst VectorDatabaseDialog = create<VectorDatabaseDialogProps>(\n  ({ retriverInfo, mainEmbeddingInfo }) => {\n    const { t } = useTranslation('applications')\n    const { loading, similaritySearchWithScore, indexData } =\n      useVectorDatabaseActions(mainEmbeddingInfo)\n\n    const [mode, setMode] = useState('search')\n    const [progress, setProgress] = useState(0)\n    const currentModal = useModal()\n\n    const vectorDatabaseData = useMemo(() => {\n      if (!retriverInfo?.vectorDatabaseEntity?.raw) {\n        return {\n          headers: [],\n          rows: [],\n        }\n      }\n\n      const headers = ['content', 'embedding', 'metadata']\n      const lines = decodeLine(retriverInfo?.vectorDatabaseEntity?.raw)\n      return {\n        headers,\n        rows: lines.map((row) => {\n          try {\n            const data = JSON.parse(row)\n            return data\n          } catch {\n            return []\n          }\n        }),\n      }\n    }, [retriverInfo?.vectorDatabaseEntity?.raw])\n\n    const handleCreateData = useCallback(\n      async (...args: Parameters<typeof indexData>) => {\n        const [data, options] = args\n        await indexData(data, {\n          ...options,\n          vectorDatabase: retriverInfo.vectorDatabaseEntity,\n        })\n      },\n      [indexData, retriverInfo.vectorDatabaseEntity],\n    )\n\n    const handleSimilaritySearch = useCallback(\n      async (value: string, k?: number) => {\n        const input = value.trim()\n        const documents = await similaritySearchWithScore(input, {\n          k,\n          vectorDatabase: retriverInfo.vectorDatabaseEntity,\n        })\n        if (!documents?.length) {\n          return\n        }\n        return documents\n      },\n      [retriverInfo.vectorDatabaseEntity, similaritySearchWithScore],\n    )\n\n    const handleIndexPDF = useCallback(\n      async (file: File) => {\n        if (file.type.includes('text') || file.type.includes('txt')) {\n          const reader = new FileReader()\n          reader.onload = async (e) => {\n            const content = e.target?.result as string\n            await handleCreateData(\n              { content },\n              {\n                vectorDatabase: retriverInfo.vectorDatabaseEntity,\n              },\n            )\n          }\n          reader.readAsText(file)\n        } else if (file.type.endsWith('pdf')) {\n          // File to blob\n          const blob = new Blob([file], { type: 'application/pdf' })\n          const customBuildLoader = new WebPDFLoader(blob, {\n            // you may need to add `.then(m => m.default)` to the end of the import\n            pdfjs: async () => {\n              const pdfjs = await import('pdfjs-dist/legacy/build/pdf.min.mjs')\n              await import('pdfjs-dist/legacy/build/pdf.worker.min.mjs')\n              pdfjs.GlobalWorkerOptions.workerSrc = new URL(\n                'pdfjs-dist/build/pdf.worker.min.js',\n                import.meta.url,\n              ).toString()\n              return pdfjs\n            },\n            parsedItemSeparator: ' ',\n          })\n          const documents = await customBuildLoader.load()\n          await handleCreateData(\n            { documents },\n            {\n              vectorDatabase: retriverInfo.vectorDatabaseEntity,\n              onProgressReport: (info) => {\n                setProgress((info.handled + info.handling) / info.total)\n              },\n            },\n          )\n        }\n      },\n      [handleCreateData, retriverInfo.vectorDatabaseEntity],\n    )\n\n    const renderContent = useMemo(() => {\n      switch (mode) {\n        case 'search':\n          return (\n            <TabsContent value=\"search\">\n              <VectorSearch loading={loading} onSimilaritySearch={handleSimilaritySearch} />\n            </TabsContent>\n          )\n        case 'new':\n          return (\n            <TabsContent className=\"min-w-80\" value=\"new\">\n              <IndexNewText loading={loading} onCreateData={handleCreateData} />\n            </TabsContent>\n          )\n        case 'file':\n          return (\n            <TabsContent value=\"file\">\n              <IndexNewFile\n                loading={loading}\n                progress={progress}\n                onFileSubmit={handleIndexPDF}\n                fileOptions={{ accept: '.pdf,.txt,.text', maxSize: 1 }}\n              />\n            </TabsContent>\n          )\n        case 'view': {\n          return (\n            <TabsContent value=\"view\" className=\"max-h-full overflow-auto\">\n              <DataViewer\n                data={vectorDatabaseData.rows}\n                headers={vectorDatabaseData.headers}\n                limitLengthByColumns={{\n                  embedding: 32,\n                }}\n              />\n            </TabsContent>\n          )\n        }\n      }\n    }, [\n      handleCreateData,\n      handleIndexPDF,\n      handleSimilaritySearch,\n      loading,\n      mode,\n      progress,\n      vectorDatabaseData,\n    ])\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n        <DialogContent className=\"max-w-3xl\">\n          <DialogHeader>\n            <div className=\"flex\">\n              <LazyIcon name=\"file\" className=\"mr-2 h-4 w-4\" />\n              <DialogTitle>{t('chat.vector_database')}</DialogTitle>\n            </div>\n          </DialogHeader>\n          <div className=\"mx-auto w-full min-h-96 max-h-full overflow-hidden\">\n            <div className=\"w-full h-full\">\n              <Tabs\n                value={mode}\n                onValueChange={setMode}\n                defaultValue=\"search\"\n                className={cn('w-full h-full mt-4')}\n              >\n                <TabsList\n                  className={cn(\n                    'grid w-full grid-cols-3',\n                    retriverInfo?.vectorDatabaseEntity?.storage ===\n                      VectorDatabaseStorageEnum.DatabaseNode\n                      ? 'grid-cols-4'\n                      : 'grid-cols-3',\n                  )}\n                >\n                  <TabsTrigger value=\"search\">{t('chat.search')}</TabsTrigger>\n                  <TabsTrigger value=\"new\">{t('chat.text')}</TabsTrigger>\n                  <TabsTrigger value=\"file\">{t('chat.file')}</TabsTrigger>\n                  {retriverInfo?.vectorDatabaseEntity?.storage ===\n                  VectorDatabaseStorageEnum.DatabaseNode ? (\n                    <TabsTrigger value=\"view\">{t('chat.view')}</TabsTrigger>\n                  ) : undefined}\n                </TabsList>\n                {renderContent}\n              </Tabs>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default VectorDatabaseDialog\n","import { useCallback, useEffect, useState } from 'react'\nimport { useSessionState } from 'src/states/session'\nimport { FlowNode, JSONData } from 'src/services/database/types'\nimport { getRepository } from 'src/services/database'\nimport { In } from 'src/services/database/typeorm-wrapper'\nimport { findFlowNodesWithSource } from 'src/states/flow/actions'\n\nexport const useChatList = (threadNode?: FlowNode) => {\n  const [chatList, setChatList] = useState<{ node: FlowNode; entity: JSONData }[]>([])\n  const currentSession = useSessionState((state) => state.currentSession)\n\n  const getChatList = useCallback(async () => {\n    if (!threadNode || !currentSession?.id) {\n      return\n    }\n    const threadDataEdged = await getRepository('FlowEdge').find({\n      where: { session_id: currentSession.id, source: threadNode.id },\n      order: { id: 'DESC' },\n    })\n    const { flowNodes, flowNodeDatas } = await findFlowNodesWithSource({\n      where: {\n        session_id: currentSession.id,\n        id: In(threadDataEdged.map((edge) => edge.target)),\n        source_type: 'JSONData',\n      },\n      order: { updated_at: 'DESC' },\n      select: ['id', 'source_id', 'source_type', 'updated_at'],\n    })\n    setChatList(\n      flowNodes.reduce((all: { node: FlowNode; entity: JSONData }[], node) => {\n        const entity = flowNodeDatas[node.source_type]?.find((data) => data.id === node.source_id)\n        if (entity) {\n          all.push({\n            node,\n            entity: entity as JSONData,\n          })\n        }\n        return all\n      }, []),\n    )\n  }, [currentSession?.id, threadNode])\n  const deleteChat = useCallback(\n    async (node: FlowNode) => {\n      await getRepository('FlowNode').delete(node.id)\n      await getRepository('JSONData').delete(node.source_id)\n      const allEdges = await getRepository('FlowEdge').find({\n        where: [{ source: node.id }, { target: node.id }],\n      })\n      await Promise.all(\n        allEdges.map((edge) => {\n          return getRepository('FlowEdge').delete(edge.id)\n        }),\n      )\n\n      getChatList()\n    },\n    [getChatList],\n  )\n\n  useEffect(() => {\n    if (!threadNode) {\n      return\n    }\n    getChatList()\n  }, [getChatList, threadNode])\n\n  return {\n    chatList,\n    deleteChat,\n    getChatList,\n  }\n}\n","import * as React from 'react'\n\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from 'src/lib/shadcn/ui/sidebar'\nimport { useModal } from '@ebay/nice-modal-react'\nimport DeleteChatDataNodeDialog from 'src/components/dialogs/DeleteChatDataNodeDialog'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { FlowNode, Schema } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { convertToZodSchemaString } from 'src/utils/schema-format'\nimport MessageLoading from 'src/lib/shadcn/chat/message-loading'\nimport { cn } from 'src/lib/utils'\nimport { MarkdownViewer } from 'src/components/molecules/MarkdownViewer'\nimport { Card } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { LLMSetting } from 'src/components/atoms/LLMSetting'\n\nimport { ChatLLMInfo } from './ChatLLMInfo'\nimport VectorDatabaseDialog from './VectorDatabaseDialog'\nimport { useChatApplicationData } from '../hooks/use-chat-application-data'\nimport { useChatList } from '../hooks/use-chat-list'\nimport { useUpdateLLMOptions } from '../hooks/use-update-llm-options'\n\nexport function ChatPanel({\n  schema,\n  mainLLMInfo,\n  mainEmbeddingInfo,\n  loadLLM,\n  retriverInfo,\n  threadNode,\n  onSelectThread,\n  onAddNewThread,\n  currentDataNode,\n  setLLMInfo,\n  changeLLMOptions,\n  ...props\n}: React.ComponentProps<typeof Sidebar> & {\n  schema?: Schema\n  threadNode?: FlowNode\n  onAddNewThread?: () => void\n  onSelectThread: (node: FlowNode) => void\n  retriverInfo: ReturnType<typeof useChatApplicationData>['retriverInfo']\n  currentDataNode: ReturnType<typeof useChatApplicationData>['currentDataNode']\n  loadLLM: ReturnType<typeof useChatApplicationData>['loadLLM']\n  mainLLMInfo: ReturnType<typeof useChatApplicationData>['mainLLMInfo']\n  mainEmbeddingInfo?: ReturnType<typeof useChatApplicationData>['mainEmbeddingInfo']\n  setLLMInfo: ReturnType<typeof useChatApplicationData>['setLLMInfo']\n  changeLLMOptions: ReturnType<typeof useUpdateLLMOptions>['changeLLMOptions']\n}) {\n  const { t } = useTranslation('applications')\n  const [loading, setLoading] = React.useState(false)\n  const deleteChatDataNodeDialog = useModal(DeleteChatDataNodeDialog)\n  const vectorDatabaseDialog = useModal(VectorDatabaseDialog)\n  const { chatList, getChatList, deleteChat } = useChatList(threadNode)\n\n  const handleAddNewThread = React.useCallback(async () => {\n    try {\n      setLoading(true)\n      await onAddNewThread?.()\n      getChatList()\n    } finally {\n      setLoading(false)\n    }\n  }, [getChatList, onAddNewThread])\n\n  const handleShowVectorDatabase = React.useCallback(() => {\n    vectorDatabaseDialog.show({\n      retriverInfo: retriverInfo[0],\n      mainEmbeddingInfo: mainEmbeddingInfo,\n    })\n  }, [mainEmbeddingInfo, retriverInfo, vectorDatabaseDialog])\n\n  const handleDeleteDataNode = React.useCallback(\n    async (e: React.MouseEvent, node: FlowNode) => {\n      e.stopPropagation()\n      deleteChatDataNodeDialog.show({ onDelete: () => deleteChat(node) })\n    },\n    [deleteChat, deleteChatDataNodeDialog],\n  )\n\n  const handleChangeOptions = React.useCallback(\n    async (options: Record<string, unknown>) => {\n      if (!mainLLMInfo?.llm) {\n        return\n      }\n      await changeLLMOptions(mainLLMInfo?.llm, options)\n      setLLMInfo((pre) =>\n        pre\n          ? {\n              ...pre,\n              llm: {\n                ...pre.llm,\n                options,\n              },\n            }\n          : undefined,\n      )\n    },\n    [changeLLMOptions, mainLLMInfo?.llm, setLLMInfo],\n  )\n\n  const content = React.useMemo(() => {\n    return (\n      <MarkdownViewer\n        className={cn('overflow-hidden break-words whitespace-pre-wrap w-full rounded-lg')}\n        source={\n          schema?.schema_items?.length\n            ? `\\`\\`\\`javascript\\n${convertToZodSchemaString(schema?.schema_items || [])}\\n\\`\\`\\``\n            : ''\n        }\n      />\n    )\n  }, [schema?.schema_items])\n\n  return (\n    <Sidebar variant=\"sidebar\" side=\"right\" collapsible=\"none\" {...props}>\n      <div className=\"h-1\" />\n      <SidebarGroupLabel className=\"justify-between\">\n        <div className=\"text-sm pl-2\">{t('chat.history')}</div>\n        <LoadingButton\n          loading={loading}\n          onClick={handleAddNewThread}\n          variant=\"link\"\n          className=\"mr-[-6px]\"\n        >\n          <LazyIcon name=\"circle-plus\" />\n        </LoadingButton>\n      </SidebarGroupLabel>\n      <SidebarContent>\n        <SidebarGroup className=\"flex-1\">\n          <SidebarMenu>\n            {chatList.map(({ node }, index) => (\n              <SidebarMenuItem key={node.id} onClick={() => onSelectThread(node)}>\n                <SidebarMenuButton className=\"cursor-pointer\">\n                  <div className=\"flex flex-row justify-between items-center w-full\">\n                    <div className=\"flex gap-2\">\n                      <LazyIcon\n                        size={16}\n                        name={currentDataNode?.node?.id === node.id ? 'check' : 'chevron-right'}\n                        className=\"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90\"\n                      />\n                      <span>{`Thread ${index + 1}`}</span>\n                    </div>\n                    <LazyIcon\n                      onClick={(e) => handleDeleteDataNode(e, node)}\n                      size={16}\n                      name=\"trash-2\"\n                    />\n                  </div>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            ))}\n          </SidebarMenu>\n        </SidebarGroup>\n        {retriverInfo?.length ? (\n          <Card className=\"m-2 p-2 max-w-full\">\n            <pre className=\"overflow-auto\">\n              {retriverInfo.map((info, key) => (\n                <span key={`${key}`}>{info.promptEntity?.content || ''}</span>\n              ))}\n            </pre>\n            <Button onClick={handleShowVectorDatabase} className=\"w-full mt-4\">\n              {t('chat.vector_database')}\n            </Button>\n          </Card>\n        ) : undefined}\n        {schema?.schema_items?.length ? (\n          <div className=\"m-2 !mb-0\">\n            <React.Suspense fallback={<MessageLoading />}>{content}</React.Suspense>\n          </div>\n        ) : undefined}\n        <LLMSetting\n          options={mainLLMInfo?.llm?.options}\n          onChangeOptions={handleChangeOptions}\n          className=\"p-2\"\n        />\n        <ChatLLMInfo\n          llm={mainLLMInfo?.llm}\n          status={mainLLMInfo?.status}\n          progress={mainLLMInfo?.progress}\n          loadLLM={loadLLM}\n        />\n      </SidebarContent>\n    </Sidebar>\n  )\n}\n","\"use client\";\n\n// packages/react/avatar/src/Avatar.tsx\nimport * as React from \"react\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useCallbackRef } from \"@radix-ui/react-use-callback-ref\";\nimport { useLayoutEffect } from \"@radix-ui/react-use-layout-effect\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport { jsx } from \"react/jsx-runtime\";\nvar AVATAR_NAME = \"Avatar\";\nvar [createAvatarContext, createAvatarScope] = createContextScope(AVATAR_NAME);\nvar [AvatarProvider, useAvatarContext] = createAvatarContext(AVATAR_NAME);\nvar Avatar = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, ...avatarProps } = props;\n    const [imageLoadingStatus, setImageLoadingStatus] = React.useState(\"idle\");\n    return /* @__PURE__ */ jsx(\n      AvatarProvider,\n      {\n        scope: __scopeAvatar,\n        imageLoadingStatus,\n        onImageLoadingStatusChange: setImageLoadingStatus,\n        children: /* @__PURE__ */ jsx(Primitive.span, { ...avatarProps, ref: forwardedRef })\n      }\n    );\n  }\n);\nAvatar.displayName = AVATAR_NAME;\nvar IMAGE_NAME = \"AvatarImage\";\nvar AvatarImage = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, src, onLoadingStatusChange = () => {\n    }, ...imageProps } = props;\n    const context = useAvatarContext(IMAGE_NAME, __scopeAvatar);\n    const imageLoadingStatus = useImageLoadingStatus(src, imageProps.referrerPolicy);\n    const handleLoadingStatusChange = useCallbackRef((status) => {\n      onLoadingStatusChange(status);\n      context.onImageLoadingStatusChange(status);\n    });\n    useLayoutEffect(() => {\n      if (imageLoadingStatus !== \"idle\") {\n        handleLoadingStatusChange(imageLoadingStatus);\n      }\n    }, [imageLoadingStatus, handleLoadingStatusChange]);\n    return imageLoadingStatus === \"loaded\" ? /* @__PURE__ */ jsx(Primitive.img, { ...imageProps, ref: forwardedRef, src }) : null;\n  }\n);\nAvatarImage.displayName = IMAGE_NAME;\nvar FALLBACK_NAME = \"AvatarFallback\";\nvar AvatarFallback = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, delayMs, ...fallbackProps } = props;\n    const context = useAvatarContext(FALLBACK_NAME, __scopeAvatar);\n    const [canRender, setCanRender] = React.useState(delayMs === void 0);\n    React.useEffect(() => {\n      if (delayMs !== void 0) {\n        const timerId = window.setTimeout(() => setCanRender(true), delayMs);\n        return () => window.clearTimeout(timerId);\n      }\n    }, [delayMs]);\n    return canRender && context.imageLoadingStatus !== \"loaded\" ? /* @__PURE__ */ jsx(Primitive.span, { ...fallbackProps, ref: forwardedRef }) : null;\n  }\n);\nAvatarFallback.displayName = FALLBACK_NAME;\nfunction useImageLoadingStatus(src, referrerPolicy) {\n  const [loadingStatus, setLoadingStatus] = React.useState(\"idle\");\n  useLayoutEffect(() => {\n    if (!src) {\n      setLoadingStatus(\"error\");\n      return;\n    }\n    let isMounted = true;\n    const image = new window.Image();\n    const updateStatus = (status) => () => {\n      if (!isMounted) return;\n      setLoadingStatus(status);\n    };\n    setLoadingStatus(\"loading\");\n    image.onload = updateStatus(\"loaded\");\n    image.onerror = updateStatus(\"error\");\n    image.src = src;\n    if (referrerPolicy) {\n      image.referrerPolicy = referrerPolicy;\n    }\n    return () => {\n      isMounted = false;\n    };\n  }, [src, referrerPolicy]);\n  return loadingStatus;\n}\nvar Root = Avatar;\nvar Image = AvatarImage;\nvar Fallback = AvatarFallback;\nexport {\n  Avatar,\n  AvatarFallback,\n  AvatarImage,\n  Fallback,\n  Image,\n  Root,\n  createAvatarScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from 'react'\nimport * as AvatarPrimitive from '@radix-ui/react-avatar'\n\nimport { cn } from 'src/lib/utils'\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn('relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full', className)}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn('aspect-square h-full w-full', className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      'flex h-full w-full items-center justify-center rounded-full bg-muted',\n      className,\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","import * as React from 'react'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport { cn } from 'src/lib/utils'\nimport { Avatar, AvatarImage, AvatarFallback } from 'src/lib/shadcn/ui/avatar'\nimport MessageLoading from 'src/lib/shadcn/chat/message-loading'\nimport { Button, ButtonProps } from 'src/lib/shadcn/ui/button'\n\n// ChatBubble\nconst chatBubbleVariant = cva('flex gap-2 max-w-[60%] items-end relative group', {\n  variants: {\n    variant: {\n      received: 'self-start',\n      sent: 'self-end flex-row-reverse',\n    },\n    layout: {\n      default: '',\n      ai: 'max-w-full w-full items-center',\n    },\n  },\n  defaultVariants: {\n    variant: 'received',\n    layout: 'default',\n  },\n})\n\ninterface ChatBubbleProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof chatBubbleVariant> {\n  innerclassname?: string\n}\n\nconst ChatBubble = React.forwardRef<HTMLDivElement, ChatBubbleProps>(\n  ({ className, variant, layout, children, ...props }, ref) => (\n    <div\n      className={cn(chatBubbleVariant({ variant, layout, className }), 'relative group')}\n      ref={ref}\n      {...props}\n    >\n      {React.Children.map(children, (child) =>\n        React.isValidElement(child) && typeof child.type !== 'string'\n          ? React.cloneElement(child, {\n              variant,\n              layout,\n              className: props?.innerclassname,\n            } as React.ComponentProps<typeof child.type>)\n          : child,\n      )}\n    </div>\n  ),\n)\nChatBubble.displayName = 'ChatBubble'\n\n// ChatBubbleAvatar\ninterface ChatBubbleAvatarProps {\n  src?: string\n  fallback?: string\n  className?: string\n}\n\nconst ChatBubbleAvatar: React.FC<ChatBubbleAvatarProps> = ({ src, fallback, className }) => (\n  <Avatar className={className}>\n    <AvatarImage src={src} alt=\"Avatar\" />\n    <AvatarFallback>{fallback}</AvatarFallback>\n  </Avatar>\n)\n\n// ChatBubbleMessage\nconst chatBubbleMessageVariants = cva('p-4', {\n  variants: {\n    variant: {\n      received: 'bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg',\n      sent: 'border border-border rounded-l-lg rounded-tr-lg',\n    },\n    layout: {\n      default: '',\n      ai: 'border-t w-full rounded-none bg-transparent',\n    },\n  },\n  defaultVariants: {\n    variant: 'received',\n    layout: 'default',\n  },\n})\n\ninterface ChatBubbleMessageProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof chatBubbleMessageVariants> {\n  isLoading?: boolean\n}\n\nconst ChatBubbleMessage = React.forwardRef<HTMLDivElement, ChatBubbleMessageProps>(\n  ({ className, variant, layout, isLoading = false, children, ...props }, ref) => (\n    <div\n      className={cn(\n        chatBubbleMessageVariants({ variant, layout, className }),\n        'break-words max-w-full whitespace-pre-wrap',\n      )}\n      ref={ref}\n      {...props}\n    >\n      {isLoading ? (\n        <div className=\"flex items-center space-x-2\">\n          <MessageLoading />\n        </div>\n      ) : (\n        children\n      )}\n    </div>\n  ),\n)\nChatBubbleMessage.displayName = 'ChatBubbleMessage'\n\n// ChatBubbleTimestamp\ninterface ChatBubbleTimestampProps extends React.HTMLAttributes<HTMLDivElement> {\n  timestamp: string\n}\n\nconst ChatBubbleTimestamp: React.FC<ChatBubbleTimestampProps> = ({\n  timestamp,\n  className,\n  ...props\n}) => (\n  <div className={cn('text-xs mt-2 text-right', className)} {...props}>\n    {timestamp}\n  </div>\n)\n\n// ChatBubbleAction\ntype ChatBubbleActionProps = ButtonProps & {\n  icon: React.ReactNode\n}\n\nconst ChatBubbleAction: React.FC<ChatBubbleActionProps> = ({\n  icon,\n  onClick,\n  className,\n  variant = 'ghost',\n  size = 'icon',\n  ...props\n}) => (\n  <Button variant={variant} size={size} className={className} onClick={onClick} {...props}>\n    {icon}\n  </Button>\n)\n\ninterface ChatBubbleActionWrapperProps extends React.HTMLAttributes<HTMLDivElement> {\n  variant?: 'sent' | 'received'\n  className?: string\n}\n\nconst ChatBubbleActionWrapper = React.forwardRef<HTMLDivElement, ChatBubbleActionWrapperProps>(\n  ({ variant, className, children, ...props }, ref) => (\n    <div\n      ref={ref}\n      className={cn(\n        'absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200',\n        variant === 'sent'\n          ? '-left-1 -translate-x-full flex-row-reverse'\n          : '-right-1 translate-x-full',\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  ),\n)\nChatBubbleActionWrapper.displayName = 'ChatBubbleActionWrapper'\n\nexport {\n  ChatBubble,\n  ChatBubbleAvatar,\n  ChatBubbleMessage,\n  ChatBubbleTimestamp,\n  chatBubbleVariant,\n  chatBubbleMessageVariants,\n  ChatBubbleAction,\n  ChatBubbleActionWrapper,\n}\n","import { memo, Suspense, useMemo } from 'react'\nimport { Message } from 'ai/react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport {\n  ChatBubble,\n  ChatBubbleAction,\n  ChatBubbleAvatar,\n  ChatBubbleMessage,\n} from 'src/lib/shadcn/chat/chat-bubble'\nimport MessageLoading from 'src/lib/shadcn/chat/message-loading'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { MarkdownViewer } from 'src/components/molecules/MarkdownViewer'\n\nconst ChatAiIcons = [\n  {\n    icon: 'copy' as const,\n    label: 'Copy',\n  },\n  {\n    icon: 'refresh-ccw' as const,\n    label: 'Refresh',\n  },\n  {\n    icon: 'volume-2' as const,\n    label: 'Volume',\n  },\n]\n\nexport const ChatItem = memo(\n  ({\n    message,\n    index,\n    isLastMessage,\n    isGenerating,\n    isSchema,\n    onActionClick,\n  }: {\n    message: Message\n    index: number\n    isLastMessage: boolean\n    isGenerating?: boolean\n    isSchema?: boolean\n    onActionClick: (action: string, message: Message) => Promise<void>\n  }) => {\n    const content = useMemo(() => {\n      return (\n        <MarkdownViewer\n          style={{\n            color: 'unset !important',\n          }}\n          source={\n            message.content\n              ? isSchema\n                ? `\\`\\`\\`json\\n${message.content}\\n\\`\\`\\``\n                : message.content\n              : ''\n          }\n        />\n      )\n    }, [isSchema, message.content])\n    return (\n      <ChatBubble\n        innerclassname={message.role == 'system' ? '!bg-transparent font-semibold' : undefined}\n        key={index}\n        variant={message.role == 'user' ? 'sent' : 'received'}\n      >\n        {message.role === 'system' ? (\n          <div className=\"w-10 h-10\" />\n        ) : message.role === 'assistant' ? (\n          <ChatBubbleAvatar\n            src=\"\"\n            fallback={\n              message.data && typeof message.data === 'object' && 'injectedMessage' in message.data\n                ? ''\n                : ''\n            }\n          />\n        ) : undefined}\n        <ChatBubbleMessage>\n          {isGenerating && isLastMessage && (!message.content || isSchema) ? (\n            <MessageLoading />\n          ) : (\n            <Suspense fallback={<MessageLoading />}>\n              {message.role === 'system' ? (\n                <Badge className=\"!text-sm mb-1\">System</Badge>\n              ) : undefined}\n              {content}\n            </Suspense>\n          )}\n          {message.role === 'assistant' && isLastMessage && (\n            <div className=\"flex items-center mt-1.5 gap-1\">\n              {!isGenerating && (\n                <>\n                  {ChatAiIcons.map((icon, iconIndex) => {\n                    return (\n                      <ChatBubbleAction\n                        variant=\"ghost\"\n                        className=\"size-5\"\n                        key={iconIndex}\n                        icon={<LazyIcon name={icon.icon} className=\"size-3\" />}\n                        onClick={() => onActionClick(icon.label, message)}\n                      />\n                    )\n                  })}\n                </>\n              )}\n            </div>\n          )}\n        </ChatBubbleMessage>\n      </ChatBubble>\n    )\n  },\n  () => false,\n)\n","import { useCallback } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { LLM } from 'src/services/database/types'\n\nexport const useUpdateLLMOptions = () => {\n  const changeLLMOptions = useCallback(async (llm: LLM, options: Record<string, unknown>) => {\n    if (llm) {\n      await getRepository('LLM').update(llm.id, { options })\n    }\n  }, [])\n\n  return {\n    changeLLMOptions,\n  }\n}\n","'use client'\n\nimport {\n  memo,\n  useEffect,\n  useRef,\n  useState,\n  KeyboardEvent,\n  MouseEvent,\n  useCallback,\n  useMemo,\n} from 'react'\nimport { nanoid } from 'nanoid'\nimport { useTranslation } from 'react-i18next'\nimport { ChatMessageList } from 'src/lib/shadcn/chat/chat-message-list'\nimport { Message, useChat } from 'ai/react'\nimport AIInput from 'src/lib/kokonutui/ai-input'\nimport { LLMStatusEnum } from 'src/services/database/types'\nimport textToSpeech from 'src/utils/text-to-speech'\nimport { SidebarInset, SidebarProvider } from 'src/lib/shadcn/ui/sidebar'\n\nimport { useChatApplicationData } from './hooks/use-chat-application-data'\nimport { useSendMessage } from './hooks/use-send-message'\nimport { ChatPanel } from './components/ChatPanel'\nimport { ChatItem } from './components/ChatItem'\nimport { useUpdateLLMOptions } from './hooks/use-update-llm-options'\n\nconst ChatApplication = memo(() => {\n  const { t } = useTranslation('applications')\n  const isScrolling = useRef(false)\n  const [isGenerating, setIsGenerating] = useState(false)\n\n  const scrollToBottom = useCallback(() => {\n    setTimeout(() => {\n      if (messagesRef.current) {\n        messagesRef.current.scrollTop = messagesRef.current.scrollHeight\n      }\n    }, 50)\n  }, [])\n\n  const chatApplicationData = useChatApplicationData()\n  const {\n    schema,\n    threadInfo,\n    mainLLMInfo,\n    retriverInfo,\n    currentDataNode,\n    loadLLM,\n    setLLMInfo,\n    addNewDataNode,\n    selectDataNode,\n    updateMessagesData,\n    onThreadMessagesLoaded,\n  } = chatApplicationData\n  const { changeLLMOptions } = useUpdateLLMOptions()\n  const { sendMessage } = useSendMessage(chatApplicationData)\n  const {\n    input,\n    messages,\n    isLoading,\n    reload,\n    setInput,\n    handleSubmit,\n    handleInputChange,\n    setMessages,\n  } = useChat({\n    fetch: async (_input: RequestInfo | URL, init?: RequestInit) => {\n      try {\n        setIsGenerating(true)\n        const body = JSON.parse(init?.body as string) as { messages: Message[] }\n        const newMessageId = nanoid()\n        const lastMessage = body.messages[body.messages.length - 1]\n        isScrolling.current = true\n        setMessages((messages) => [\n          ...messages,\n          { id: nanoid(), content: lastMessage.content, role: 'user' },\n        ])\n        await sendMessage(\n          lastMessage.content,\n          body.messages || [],\n          { retriverInfo },\n          {\n            schema,\n            onInjectedMessages: (injectedMessages) => {\n              if (injectedMessages.length) {\n                setMessages((messages) => [\n                  ...messages,\n                  ...injectedMessages.map((message) => {\n                    if (message._getType() === 'system') {\n                      return {\n                        id: nanoid(),\n                        content: `${message.content}`,\n                        role: 'system' as const,\n                        data: { injectedMessage: true },\n                      }\n                    } else if (message._getType() === 'human') {\n                      return {\n                        id: nanoid(),\n                        content: `${message.content}`,\n                        role: 'user' as const,\n                        data: { injectedMessage: true },\n                      }\n                    }\n                    return {\n                      id: nanoid(),\n                      content: `${message.content}`,\n                      role: 'assistant' as const,\n                      data: { injectedMessage: true },\n                    }\n                  }),\n                ])\n              }\n            },\n            onResponseMessageCreate: (content) => {\n              setMessages((messages) => [\n                ...messages,\n                { id: newMessageId, content: content || '', role: 'assistant' },\n              ])\n            },\n            onMessageUpdate: (info) => {\n              setMessages((messages) => {\n                const newMessages = [...messages]\n                const index = newMessages.findIndex((message) => message.id === newMessageId)\n                if (index !== -1) {\n                  newMessages[index] = {\n                    ...newMessages[index],\n                    content: info.nodeData.content || '',\n                  }\n                }\n                return newMessages\n              })\n              if (isScrolling.current) {\n                scrollToBottom()\n              }\n            },\n          },\n        )\n        setMessages((messages) => {\n          updateMessagesData(messages)\n          return messages\n        })\n        setIsGenerating(false)\n        setInput('')\n        if (isScrolling.current) {\n          scrollToBottom()\n        }\n        return new Response()\n      } finally {\n        setIsGenerating(false)\n      }\n    },\n  })\n\n  const messagesRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const cleandUp = onThreadMessagesLoaded((messages) => {\n      setMessages(messages || [])\n      scrollToBottom()\n    })\n    return () => {\n      cleandUp()\n    }\n  }, [setMessages, onThreadMessagesLoaded, scrollToBottom])\n\n  const onSubmit = async (\n    _value: string,\n    e: KeyboardEvent<HTMLTextAreaElement> | MouseEvent<HTMLButtonElement>,\n  ) => {\n    setIsGenerating(true)\n    await handleSubmit(e)\n    return true\n  }\n\n  const handleActionClick = useCallback(\n    async (action: string, message: Message) => {\n      if (action === 'Refresh') {\n        setIsGenerating(true)\n        try {\n          await reload()\n        } finally {\n          setIsGenerating(false)\n        }\n      }\n\n      if (action === 'Copy') {\n        if (message && message.role === 'assistant') {\n          navigator.clipboard.writeText(message.content)\n        }\n      }\n\n      if (action === 'Volume') {\n        if (message?.content) {\n          await textToSpeech.speak(message?.content || '')\n        }\n      }\n    },\n    [reload],\n  )\n\n  const handleStopScroll = useCallback(() => (isScrolling.current = false), [])\n\n  const messageList = useMemo(() => {\n    return (\n      messages &&\n      messages.map((message, index) => (\n        <ChatItem\n          key={message.id || `${index}`}\n          message={message}\n          index={index}\n          isLastMessage={index === messages.length - 1}\n          isGenerating={isGenerating}\n          isSchema={schema ? true : false}\n          onActionClick={handleActionClick}\n        />\n      ))\n    )\n  }, [messages, isGenerating, schema, handleActionClick])\n\n  return (\n    <SidebarProvider\n      onClick={handleStopScroll}\n      className=\"max-h-full !overflow-hidden !min-h-full\"\n      style={{ minHeight: 'unset' }}\n      defaultOpen={true}\n    >\n      <SidebarInset className=\"!max-h-full !overflow-hidden\" style={{ minHeight: 'unset' }}>\n        <main className=\"flex h-full w-full max-w-2xl flex-col items-center mx-auto overflow-hidden\">\n          <div className=\"flex-1 overflow-y-auto overflow-x-hidden min-w-full max-w-full\">\n            <ChatMessageList className=\"!max-h-full\" ref={messagesRef}>\n              {messageList}\n            </ChatMessageList>\n          </div>\n          <AIInput\n            className=\"!max-w-2xl px-4\"\n            onSubmit={onSubmit}\n            disabled={isLoading || isGenerating || mainLLMInfo?.status !== LLMStatusEnum.Loaded}\n            placeholder={t('chat.input_message_placeholder')}\n            value={input}\n            onChange={handleInputChange}\n          />\n        </main>\n      </SidebarInset>\n      <ChatPanel\n        schema={schema}\n        currentDataNode={currentDataNode}\n        threadNode={threadInfo?.threadNode}\n        loadLLM={loadLLM}\n        mainLLMInfo={mainLLMInfo}\n        mainEmbeddingInfo={chatApplicationData.mainEmbeddingInfo}\n        retriverInfo={retriverInfo}\n        onAddNewThread={addNewDataNode}\n        onSelectThread={selectDataNode}\n        changeLLMOptions={changeLLMOptions}\n        setLLMInfo={setLLMInfo}\n      />\n    </SidebarProvider>\n  )\n})\n\nexport default ChatApplication\n"],"file":"assets/ChatApplication-CyUW759G.js"}