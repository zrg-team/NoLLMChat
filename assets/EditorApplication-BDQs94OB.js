const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cfl1ZIlk.js","assets/index-D_ELiTRG.js","assets/index-BHmW4Jet.css","assets/toNumber-DGeRjXqq.js","assets/routes-BC22d4F8.js","assets/use-prevent-pitch-zoom-Dmc7gmY8.js","assets/index-D5kc9bu3.js","assets/index-DQRWcfCS.js","assets/index-Dzfaeq0k.js","assets/link-CJ9RDnfE.js","assets/createLucideIcon-DAzac-JV.js","assets/trash-2-CFfFE2fS.js","assets/index-DyEjF3oh.js","assets/index-BtC1eaoi.js","assets/text-BFtjfuGS.js","assets/external-link-Up2-deJV.js","assets/unlink-Dtl3ubIQ.js","assets/index-DFww-FF2.js","assets/list-Bokvih1w.js","assets/list-ordered-D0vRO2Gi.js","assets/list-todo-PvGgyiNt.js","assets/indent-increase-CAoRbcQM.js","assets/pilcrow-DHedehqr.js","assets/heading-1-C5SqFK0J.js","assets/heading-2-DIeHuOQ3.js","assets/heading-3-B8c49HYz.js","assets/table-9Nyf78pw.js","assets/file-code-7Waci9Wl.js","assets/quote-BPVdT3JQ.js","assets/minus-DygWUEbw.js","assets/square-o25yDvB3.js","assets/chevron-right-BqJkiax2.js","assets/image-ih5E6ipV.js","assets/table-of-contents-CEwyW7tJ.js","assets/columns-3-BAFjqiCT.js","assets/link-2-Cq9ErkE2.js","assets/calendar-DYhWuMKN.js","assets/plus-NoJH7LNE.js","assets/wrap-text-De3pB5-A.js","assets/pen-CF_U6JBp.js","assets/eye-NWGYP9Y2.js","assets/indent-decrease-COsX2Ga_.js","assets/pointer-Bg2-t3gd.js","assets/wand-sparkles-CD8bMkhn.js","assets/bold-D7YxeWy_.js","assets/italic-7n3_l9KT.js","assets/underline-6tBWbjKc.js","assets/strikethrough-_bfq7Wp1.js","assets/code-xml-CkucUI4a.js","assets/baseline-CqaNHJBX.js","assets/paint-bucket-C0ARs-sR.js","assets/arrow-up-to-line-bQ8Pd2r3.js","assets/LLMIcon-mV0klbiM.js","assets/dot-BZFBpF5w.js","assets/index-BCYu3EnN.css"])))=>i.map(i=>d[i]);
import{r,o as N,y as E,_ as M,j as s,g as C,L as S,M as L,__tla as k}from"./index-D_ELiTRG.js";import{b as F,u as I,a as O,L as f,I as T,p as D,S as z,c as R,__tla as V}from"./LLMIcon-mV0klbiM.js";import{u as b,H as A,g as h,F as H,b2 as P,b3 as U,b4 as K,b5 as Y,__tla as q}from"./routes-BC22d4F8.js";import"./dot-BZFBpF5w.js";import"./createLucideIcon-DAzac-JV.js";let v,B=Promise.all([(()=>{try{return k}catch{}})(),(()=>{try{return V}catch{}})(),(()=>{try{return q}catch{}})()]).then(async()=>{let x,g,y;x=()=>{const[e,n]=r.useState(),a=b(i=>i.currentSession),{t:o}=N("flows"),{toast:d}=E(),{stream:l}=F(),{loadModel:c}=I(),{modalRef:u}=O(z),w=r.useCallback(async(i,_)=>{if(a!=null&&a.main_node_id){if(!(e!=null&&e.llm))return d({variant:"destructive",description:o("editor_node.errors.llm_not_found")});(e==null?void 0:e.status)!==f.Loaded&&(await c(e.llm.provider,e.llm.name,t=>{n(m=>m&&{...m,progress:t.text})}),n(t=>t&&{...t,status:f.Loaded,progress:""}));try{return(await l(e==null?void 0:e.llm.provider,typeof i=="string"?[new A(i)]:i,{onMessageUpdate:t=>{_==null||_(t.content)},llm:e==null?void 0:e.llm})).content}catch(t){if(t instanceof Error&&t.message.includes("LLM_NOT_LOADED_YET"))return d({title:o("editor_node.errors.llm_not_loaded_yet")});d({variant:"destructive",title:o("editor_node.errors.stream_message_failed")})}}},[a==null?void 0:a.main_node_id,e==null?void 0:e.llm,e==null?void 0:e.status,d,o,c,l]),p=r.useCallback(async()=>{if(!(a!=null&&a.main_node_id))return;const i=await h("FlowEdge").find({where:{target:a.main_node_id}}),_=(await h("FlowNode").find({where:{id:T(i.map(m=>m.source))}})).find(m=>m.source_type===H.LLM);if(!_)return;const t=await h("LLM").findOne({where:{id:_.source_id}});t&&(a.passphrase&&await D(a.passphrase,u.current),await c(t.provider,t.name,m=>{n(j=>j&&{...j,llm:t,progress:m.text})}),n({llm:t,status:f.Loaded}))},[a==null?void 0:a.main_node_id,a==null?void 0:a.passphrase,c,u]);return r.useEffect(()=>{a!=null&&a.main_node_id&&p()},[a==null?void 0:a.main_node_id,p]),{mainLLMInfo:e,createMessage:w}},g=()=>{const e=b(l=>l.currentSession),n=r.useRef(null),[a,o]=r.useState(),d=r.useCallback(async l=>{e!=null&&e.main_node_id&&(clearTimeout(n.current),n.current=setTimeout(async()=>{e!=null&&e.main_node_id&&await h("FlowNode").update(e.main_node_id,{data:l})},150))},[e]);return r.useEffect(()=>{e!=null&&e.main_node_id&&h("FlowNode").findOne({where:{id:e.main_node_id}}).then(l=>{o(l)})},[e]),{flowNode:a,updateEditorContent:d}},y=r.lazy(()=>M(()=>import("./index-Cfl1ZIlk.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]))),v=r.memo(()=>{var l,c,u,w,p;const{flowNode:e,updateEditorContent:n}=g(),{mainLLMInfo:a,createMessage:o}=x(),d=r.useCallback(i=>{n(i)},[n]);return s.jsxs("div",{className:"h-full w-full relative","data-registry":"plate",children:[s.jsx(P,{children:s.jsx(U,{children:s.jsxs("div",{className:C("flex absolute !z-[51] right-1 top-0 max-w-28 h-9 items-center justify-center flex-row"),children:[(a==null?void 0:a.status)===f.Loaded&&((l=a==null?void 0:a.llm)!=null&&l.name)?s.jsx(R,{name:(c=a==null?void 0:a.llm)==null?void 0:c.name,className:"w-5 h-5 mr-1"}):void 0,s.jsx(K,{className:"overflow-hidden !text-ellipsis w-full max-w-full max-h-full whitespace-nowrap text-sm",children:a!=null&&a.progress?a==null?void 0:a.progress:(a==null?void 0:a.status)===f.Loaded?(u=a==null?void 0:a.llm)==null?void 0:u.name:s.jsx(S,{size:16,name:"loader-circle",className:"animate-spin ml-2"})}),s.jsx(Y,{children:s.jsx("p",{children:(a==null?void 0:a.progress)||((w=a==null?void 0:a.llm)==null?void 0:w.name)||""})})]})})}),s.jsx(r.Suspense,{fallback:s.jsx(L,{simple:!0}),children:e?s.jsx(y,{defaultValue:e==null?void 0:e.data,onValueChange:d,copilotStream:o,hideDragIcon:!0,enableHistoryControl:!0},((p=a==null?void 0:a.llm)==null?void 0:p.name)||"default"):s.jsx(L,{simple:!0})})]})})});export{B as __tla,v as default};
