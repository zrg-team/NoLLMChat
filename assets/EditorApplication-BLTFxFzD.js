const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C7yn_S32.js","assets/index-Dm1R2z7R.js","assets/index-BHmW4Jet.css","assets/toNumber-BU9jO53P.js","assets/routes-BQtx4Swg.js","assets/use-prevent-pitch-zoom-CRhJfjI7.js","assets/index-Ck543mmG.js","assets/index-CkK3dOa3.js","assets/index-BohVFg5g.js","assets/link-bqe1Soi3.js","assets/createLucideIcon-B-o_1Xz_.js","assets/trash-2-Dr3QpDM-.js","assets/index-uPlhTHZf.js","assets/index-uEu2-lE9.js","assets/text-MCiekkJt.js","assets/external-link-D2Xo9RJm.js","assets/unlink-OnIkTQZo.js","assets/index-yTRa8vdE.js","assets/list-DuaSjwBt.js","assets/list-ordered-mMDsLiZN.js","assets/list-todo-Dq7PpD_H.js","assets/indent-increase-C9QTNXko.js","assets/pilcrow-Bx8qynvh.js","assets/heading-1-CZgiY8ue.js","assets/heading-2-BB43o2Kt.js","assets/heading-3-B-YlK6Ff.js","assets/table-CbZ3iAJn.js","assets/file-code-4L9yKPn_.js","assets/quote-BbRTHGm6.js","assets/minus-DN2hKd9J.js","assets/square-C9ktdT6z.js","assets/chevron-right-Y8OgkNl0.js","assets/image-CVdmAATJ.js","assets/table-of-contents-DhgboIYf.js","assets/columns-3-L0ibrh0z.js","assets/link-2-CDJfwbyV.js","assets/calendar-N2btT5Id.js","assets/plus-DrOgU6bW.js","assets/wrap-text-DcONBKlN.js","assets/pen-B5wcFn9n.js","assets/eye-BBp876to.js","assets/indent-decrease-ClI4GXwo.js","assets/pointer-DNpfDgLY.js","assets/wand-sparkles-aw-DUdGk.js","assets/bold-CQUo-EMw.js","assets/italic-BNNmeTK6.js","assets/underline-Bw0uuFTR.js","assets/strikethrough-_273d5T8.js","assets/code-xml-DG_uqMCL.js","assets/baseline-C7YVdYxi.js","assets/paint-bucket-aju9mTrs.js","assets/arrow-up-to-line-DW3l_5dH.js","assets/LLMIcon-8SFnyBlJ.js","assets/dot-C-EbcjRb.js","assets/index-BCYu3EnN.css"])))=>i.map(i=>d[i]);
import{r,q as L,o as E,v as b,w as f,$ as M,_ as C,j as s,g as S,L as k,X as v,__tla as O}from"./index-Dm1R2z7R.js";import{b as T,u as D,a as F,L as h,I,p as z,S as R,c as V,__tla as A}from"./LLMIcon-8SFnyBlJ.js";import{H,aZ as P,a_ as U,a$ as $,b0 as q,__tla as B}from"./routes-BQtx4Swg.js";import"./dot-C-EbcjRb.js";import"./createLucideIcon-B-o_1Xz_.js";let N,X=Promise.all([(()=>{try{return O}catch{}})(),(()=>{try{return A}catch{}})(),(()=>{try{return B}catch{}})()]).then(async()=>{let x,g,y;x=()=>{const[e,n]=r.useState(),a=L(i=>i.currentSession),{t:o}=E("flows"),{toast:d}=b(),{stream:l}=T(),{loadModel:c}=D(),{modalRef:u}=F(R),w=r.useCallback(async(i,_)=>{if(a!=null&&a.main_node_id){if(!(e!=null&&e.llm))return d({variant:"destructive",description:o("editor_node.errors.llm_not_found")});(e==null?void 0:e.status)!==h.Loaded&&(await c(e.llm.provider,e.llm.name,t=>{n(m=>m&&{...m,progress:t.text})}),n(t=>t&&{...t,status:h.Loaded,progress:""}));try{return(await l(e==null?void 0:e.llm.provider,typeof i=="string"?[new H(i)]:i,{onMessageUpdate:t=>{_==null||_(t.content)},llm:e==null?void 0:e.llm})).content}catch(t){if(t instanceof Error&&t.message.includes("LLM_NOT_LOADED_YET"))return d({title:o("editor_node.errors.llm_not_loaded_yet")});d({variant:"destructive",title:o("editor_node.errors.stream_message_failed")})}}},[a==null?void 0:a.main_node_id,e==null?void 0:e.llm,e==null?void 0:e.status,d,o,c,l]),p=r.useCallback(async()=>{if(!(a!=null&&a.main_node_id))return;const i=await f("FlowEdge").find({where:{target:a.main_node_id}}),_=(await f("FlowNode").find({where:{id:I(i.map(m=>m.source))}})).find(m=>m.source_type===M.LLM);if(!_)return;const t=await f("LLM").findOne({where:{id:_.source_id}});t&&(a.passphrase&&await z(a.passphrase,u.current),await c(t.provider,t.name,m=>{n(j=>j&&{...j,llm:t,progress:m.text})}),n({llm:t,status:h.Loaded}))},[a==null?void 0:a.main_node_id,a==null?void 0:a.passphrase,c,u]);return r.useEffect(()=>{a!=null&&a.main_node_id&&p()},[a==null?void 0:a.main_node_id,p]),{mainLLMInfo:e,createMessage:w}},g=()=>{const e=L(l=>l.currentSession),n=r.useRef(null),[a,o]=r.useState(),d=r.useCallback(async l=>{e!=null&&e.main_node_id&&(clearTimeout(n.current),n.current=setTimeout(async()=>{e!=null&&e.main_node_id&&await f("FlowNode").update(e.main_node_id,{data:l})},150))},[e]);return r.useEffect(()=>{e!=null&&e.main_node_id&&f("FlowNode").findOne({where:{id:e.main_node_id}}).then(l=>{o(l)})},[e]),{flowNode:a,updateEditorContent:d}},y=r.lazy(()=>C(()=>import("./index-C7yn_S32.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]))),N=r.memo(()=>{var l,c,u,w,p;const{flowNode:e,updateEditorContent:n}=g(),{mainLLMInfo:a,createMessage:o}=x(),d=r.useCallback(i=>{n(i)},[n]);return s.jsxs("div",{className:"h-full w-full relative","data-registry":"plate",children:[s.jsx(P,{children:s.jsx(U,{children:s.jsxs("div",{className:S("flex absolute !z-[51] right-1 top-0 max-w-28 h-9 items-center justify-center flex-row"),children:[(a==null?void 0:a.status)===h.Loaded&&((l=a==null?void 0:a.llm)!=null&&l.name)?s.jsx(V,{name:(c=a==null?void 0:a.llm)==null?void 0:c.name,className:"w-5 h-5 mr-1"}):void 0,s.jsx($,{className:"overflow-hidden !text-ellipsis w-full max-w-full max-h-full whitespace-nowrap text-sm",children:a!=null&&a.progress?a==null?void 0:a.progress:(a==null?void 0:a.status)===h.Loaded?(u=a==null?void 0:a.llm)==null?void 0:u.name:s.jsx(k,{size:16,name:"loader-circle",className:"animate-spin ml-2"})}),s.jsx(q,{children:s.jsx("p",{children:(a==null?void 0:a.progress)||((w=a==null?void 0:a.llm)==null?void 0:w.name)||""})})]})})}),s.jsx(r.Suspense,{fallback:s.jsx(v,{simple:!0}),children:e?s.jsx(y,{defaultValue:e==null?void 0:e.data,onValueChange:d,copilotStream:o,hideDragIcon:!0,enableHistoryControl:!0},((p=a==null?void 0:a.llm)==null?void 0:p.name)||"default"):s.jsx(v,{simple:!0})})]})})});export{X as __tla,N as default};
