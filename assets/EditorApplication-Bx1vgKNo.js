const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-aqDGyJvo.js","assets/index-RiB-44Db.js","assets/index-Vcso_2OS.css","assets/index-DCH3-DTm.js","assets/toNumber-Byg5v6VR.js","assets/routes-lkvfg71l.js","assets/index-D6I07IJE.js","assets/index-CZT-R8PE.js","assets/index-CxJpxJKc.js","assets/index-Dlu-JPPf.js","assets/link-J-3gHs7t.js","assets/createLucideIcon-BEhd4ns2.js","assets/trash-2-faLldhrw.js","assets/index-D-Bs0KoB.js","assets/text-Cp9BdIAb.js","assets/external-link-CuhsC77o.js","assets/unlink-Bww91ZQm.js","assets/list-an5AGIVW.js","assets/list-ordered-F1ynP-Sy.js","assets/list-todo-CLJ7x_pP.js","assets/indent-increase-zhqxcF5S.js","assets/pilcrow-oC4sGPow.js","assets/heading-1-rkQpRmbx.js","assets/heading-2-CijChg3e.js","assets/heading-3-D0XY7nMO.js","assets/table-Dqy8--Ya.js","assets/file-code-JY3hhaRN.js","assets/quote-BT0uh00C.js","assets/minus-BV20W55A.js","assets/square-KU_wM_PI.js","assets/chevron-right-B4mjbNvL.js","assets/image-DAyoLMHa.js","assets/table-of-contents-CahBhgzm.js","assets/columns-3-CSgup3LB.js","assets/link-2-CQ5EWKAT.js","assets/calendar-Bg46CB6M.js","assets/plus-D9ByS62q.js","assets/wrap-text-BQoX7xqn.js","assets/index-DV-zg8VY.js","assets/pen-oWu75mJ4.js","assets/eye-IXq9e1bp.js","assets/indent-decrease-BG35mPB-.js","assets/pointer-BhGk0cG8.js","assets/wand-sparkles-Crp_gJa6.js","assets/bold-xHKiSx0B.js","assets/italic-OQwdo7l1.js","assets/underline-0f4ABJYy.js","assets/strikethrough-B5yrajdI.js","assets/code-xml-B5QhfDTj.js","assets/baseline-BD9H9Pjn.js","assets/paint-bucket-UmueCbIL.js","assets/arrow-up-to-line-Dg7jKUnE.js","assets/LLMIcon-Bjn_z1Gm.js","assets/dot-C2v_uavk.js","assets/index-BCYu3EnN.css"])))=>i.map(i=>d[i]);
import{r as s,e as b,f as E,_ as M,j as r,c as C,L as k,D as j,__tla as S}from"./index-RiB-44Db.js";import{u as D,a as I,b as O,L as h,l as T,I as F,p as z,S as P,c as R,__tla as V}from"./LLMIcon-Bjn_z1Gm.js";import{u as L,H as A,g as w,F as H,e as U,f as Y,h as Q,i as q,__tla as B}from"./routes-lkvfg71l.js";import"./dot-C2v_uavk.js";import"./createLucideIcon-BEhd4ns2.js";let N,G=Promise.all([(()=>{try{return S}catch{}})(),(()=>{try{return V}catch{}})(),(()=>{try{return B}catch{}})()]).then(async()=>{let g,y,v;g=()=>{const[e,l]=s.useState(),a=L(i=>i.currentSession),{t:d}=b("flows"),{toast:m}=E(),{confirmPassphrase:n}=D(),{loadModel:c}=I(),{modalRef:u}=O(P),x=s.useCallback(async(i,_)=>{var o;if(a!=null&&a.main_node_id){if(!(e!=null&&e.llm))return m({variant:"destructive",description:d("editor_node.errors.llm_not_found")});(e==null?void 0:e.status)!==h.Loaded&&(await c(e.llm.provider,e.llm.name,{provider:e.llm.provider,callback:t=>{l(f=>f&&{...f,progress:t.text})}}),l(t=>t&&{...t,status:h.Loaded,progress:""}));try{return await n(),(o=await T.stream(e==null?void 0:e.llm.provider,typeof i=="string"?[new A(i)]:i,{onMessageUpdate:t=>{_==null||_(t.content)},llm:e==null?void 0:e.llm}))==null?void 0:o.content}catch(t){if(t instanceof Error&&t.message.includes("LLM_NOT_LOADED_YET"))return m({title:d("editor_node.errors.llm_not_loaded_yet")});m({variant:"destructive",title:d("editor_node.errors.stream_message_failed")})}}},[a==null?void 0:a.main_node_id,e==null?void 0:e.llm,e==null?void 0:e.status,m,d,c]),p=s.useCallback(async()=>{if(!(a!=null&&a.main_node_id))return;const i=await w("FlowEdge").find({where:{target:a.main_node_id}}),_=(await w("FlowNode").find({where:{id:F(i.map(t=>t.source))}})).find(t=>t.source_type===H.LLM);if(!_)return;const o=await w("LLM").findOne({where:{id:_.source_id}});o&&(a.passphrase&&await z(a.passphrase,u.current),await c(o.provider,o.name,{provider:o.provider,callback:t=>{l(f=>f&&{...f,llm:o,progress:t.text})}}),l({llm:o,status:h.Loaded}))},[a==null?void 0:a.main_node_id,a==null?void 0:a.passphrase,c,u]);return s.useEffect(()=>{a!=null&&a.main_node_id&&p()},[a==null?void 0:a.main_node_id,p]),{mainLLMInfo:e,createMessage:x}},y=()=>{const e=L(n=>n.currentSession),l=s.useRef(null),[a,d]=s.useState(),m=s.useCallback(async n=>{e!=null&&e.main_node_id&&(clearTimeout(l.current),l.current=setTimeout(async()=>{e!=null&&e.main_node_id&&await w("FlowNode").update(e.main_node_id,{data:n})},150))},[e]);return s.useEffect(()=>{e!=null&&e.main_node_id&&w("FlowNode").findOne({where:{id:e.main_node_id}}).then(n=>{d(n)})},[e]),{flowNode:a,updateEditorContent:m}},v=s.lazy(()=>M(()=>import("./index-aqDGyJvo.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]))),N=s.memo(()=>{var n,c,u,x,p;const{flowNode:e,updateEditorContent:l}=y(),{mainLLMInfo:a,createMessage:d}=g(),m=s.useCallback(i=>{l(i)},[l]);return r.jsxs("div",{className:"h-full w-full relative","data-registry":"plate",children:[r.jsx(U,{children:r.jsx(Y,{children:r.jsxs("div",{className:C("flex absolute !z-[51] right-1 top-0 max-w-28 h-9 items-center justify-center flex-row"),children:[(a==null?void 0:a.status)===h.Loaded&&((n=a==null?void 0:a.llm)!=null&&n.name)?r.jsx(R,{name:(c=a==null?void 0:a.llm)==null?void 0:c.name,className:"w-5 h-5 mr-1"}):void 0,r.jsx(Q,{className:"overflow-hidden !text-ellipsis w-full max-w-full max-h-full whitespace-nowrap text-sm",children:a!=null&&a.progress?a==null?void 0:a.progress:(a==null?void 0:a.status)===h.Loaded?(u=a==null?void 0:a.llm)==null?void 0:u.name:r.jsx(k,{size:16,name:"loader-circle",className:"animate-spin ml-2"})}),r.jsx(q,{children:r.jsx("p",{children:(a==null?void 0:a.progress)||((x=a==null?void 0:a.llm)==null?void 0:x.name)||""})})]})})}),r.jsx(s.Suspense,{fallback:r.jsx(j,{simple:!0}),children:e?r.jsx(v,{defaultValue:e==null?void 0:e.data,onValueChange:m,copilotStream:d,hideDragIcon:!0,enableHistoryControl:!0},((p=a==null?void 0:a.llm)==null?void 0:p.name)||"default"):r.jsx(j,{simple:!0})})]})})});export{G as __tla,N as default};
