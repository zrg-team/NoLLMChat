const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C2MnLp1u.js","assets/index-pm_YnrGh.js","assets/index-BHmW4Jet.css","assets/toNumber-CBpSBdsS.js","assets/index-DvM-YXfb.js","assets/use-prevent-pitch-zoom-D4Y157HE.js","assets/index-BKrrEZoY.js","assets/index-CmiUABeI.js","assets/index-oti-5Lj3.js","assets/link-CgmnxEo3.js","assets/createLucideIcon-DJguve4f.js","assets/trash-2-DDLEMR7J.js","assets/index-DdsIuvgb.js","assets/text-DqRczWP-.js","assets/external-link-Cpro1QBk.js","assets/unlink-C--FVh3J.js","assets/index-CAGplr8G.js","assets/list-B8usKuIg.js","assets/list-ordered-4eHddfcQ.js","assets/list-todo-Cy46whFe.js","assets/indent-increase-7GvKlIgE.js","assets/pilcrow-BfEqNBoF.js","assets/heading-1-My_VYhLz.js","assets/heading-2-BlLl9LVw.js","assets/heading-3-Cd-eqevT.js","assets/table-6zAYAKwr.js","assets/file-code-BR-ZGn4_.js","assets/quote-CkXUqubv.js","assets/minus-DnljVIvB.js","assets/square-CcJpAn-8.js","assets/chevron-right-BoYU_Yes.js","assets/image-Cbl1HC6O.js","assets/table-of-contents-B1S2CaNO.js","assets/columns-3-CAOsy3th.js","assets/link-2-C31pYwLM.js","assets/calendar-DcWG6_Bp.js","assets/plus-BxSgfgsE.js","assets/wrap-text-Bsx7vVGF.js","assets/pen-cH60O0DX.js","assets/eye-DzbCziCo.js","assets/indent-decrease-CoJxh5BV.js","assets/pointer-CMtoBkFa.js","assets/wand-sparkles-u9Wrd4lt.js","assets/bold-DzRA4rMh.js","assets/italic-CKgf8PC8.js","assets/underline-IMnA7e7q.js","assets/strikethrough-zN1EfgnL.js","assets/code-xml-CClg9bBK.js","assets/baseline-DAZTfEWl.js","assets/paint-bucket-CD3lW-xb.js","assets/arrow-up-to-line-cfDcyotY.js","assets/LLMIcon-Dy4TnfD2.js","assets/dot-BQCW_euz.js","assets/index-BCYu3EnN.css"])))=>i.map(i=>d[i]);
import{r as s,u as L,b as E,e as b,H as M,g as p,F as C,_ as S,j as r,U as k,W as F,c as I,X as O,L as T,Y as D,Z as v,__tla as z}from"./index-pm_YnrGh.js";import{b as R,u as V,a as A,L as h,I as H,p as P,S as U,c as Y,__tla as q}from"./LLMIcon-Dy4TnfD2.js";import{__tla as W}from"./dot-BQCW_euz.js";import{__tla as X}from"./createLucideIcon-DJguve4f.js";let N,Z=Promise.all([(()=>{try{return z}catch{}})(),(()=>{try{return q}catch{}})(),(()=>{try{return W}catch{}})(),(()=>{try{return X}catch{}})()]).then(async()=>{let x,g,y;x=()=>{const[e,n]=s.useState(),a=L(i=>i.currentSession),{t:o}=E("flows"),{toast:d}=b(),{stream:l}=R(),{loadModel:_}=V(),{modalRef:u}=A(U),w=s.useCallback(async(i,c)=>{if(a!=null&&a.main_node_id){if(!(e!=null&&e.llm))return d({variant:"destructive",description:o("editor_node.errors.llm_not_found")});(e==null?void 0:e.status)!==h.Loaded&&(await _(e.llm.provider,e.llm.name,t=>{n(m=>m&&{...m,progress:t.text})}),n(t=>t&&{...t,status:h.Loaded,progress:""}));try{return(await l(e==null?void 0:e.llm.provider,typeof i=="string"?[new M(i)]:i,{onMessageUpdate:t=>{c==null||c(t.content)},llm:e==null?void 0:e.llm})).content}catch(t){if(t instanceof Error&&t.message.includes("LLM_NOT_LOADED_YET"))return d({title:o("editor_node.errors.llm_not_loaded_yet")});d({variant:"destructive",title:o("editor_node.errors.stream_message_failed")})}}},[a==null?void 0:a.main_node_id,e==null?void 0:e.llm,e==null?void 0:e.status,d,o,_,l]),f=s.useCallback(async()=>{if(!(a!=null&&a.main_node_id))return;const i=await p("FlowEdge").find({where:{target:a.main_node_id}}),c=(await p("FlowNode").find({where:{id:H(i.map(m=>m.source))}})).find(m=>m.source_type===C.LLM);if(!c)return;const t=await p("LLM").findOne({where:{id:c.source_id}});t&&(a.passphrase&&await P(a.passphrase,u.current),await _(t.provider,t.name,m=>{n(j=>j&&{...j,llm:t,progress:m.text})}),n({llm:t,status:h.Loaded}))},[a==null?void 0:a.main_node_id,a==null?void 0:a.passphrase,_,u]);return s.useEffect(()=>{a!=null&&a.main_node_id&&f()},[a==null?void 0:a.main_node_id,f]),{mainLLMInfo:e,createMessage:w}},g=()=>{const e=L(l=>l.currentSession),n=s.useRef(null),[a,o]=s.useState(),d=s.useCallback(async l=>{e!=null&&e.main_node_id&&(clearTimeout(n.current),n.current=setTimeout(async()=>{e!=null&&e.main_node_id&&await p("FlowNode").update(e.main_node_id,{data:l})},150))},[e]);return s.useEffect(()=>{e!=null&&e.main_node_id&&p("FlowNode").findOne({where:{id:e.main_node_id}}).then(l=>{o(l)})},[e]),{flowNode:a,updateEditorContent:d}},y=s.lazy(()=>S(()=>import("./index-C2MnLp1u.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53]))),N=s.memo(()=>{var l,_,u,w,f;const{flowNode:e,updateEditorContent:n}=g(),{mainLLMInfo:a,createMessage:o}=x(),d=s.useCallback(i=>{n(i)},[n]);return r.jsxs("div",{className:"h-full w-full relative","data-registry":"plate",children:[r.jsx(k,{children:r.jsx(F,{children:r.jsxs("div",{className:I("flex absolute !z-[51] right-1 top-0 max-w-28 h-9 items-center justify-center flex-row"),children:[(a==null?void 0:a.status)===h.Loaded&&((l=a==null?void 0:a.llm)!=null&&l.name)?r.jsx(Y,{name:(_=a==null?void 0:a.llm)==null?void 0:_.name,className:"w-5 h-5 mr-1"}):void 0,r.jsx(O,{className:"overflow-hidden !text-ellipsis w-full max-w-full max-h-full whitespace-nowrap text-sm",children:a!=null&&a.progress?a==null?void 0:a.progress:(a==null?void 0:a.status)===h.Loaded?(u=a==null?void 0:a.llm)==null?void 0:u.name:r.jsx(T,{size:16,name:"loader-circle",className:"animate-spin ml-2"})}),r.jsx(D,{children:r.jsx("p",{children:(a==null?void 0:a.progress)||((w=a==null?void 0:a.llm)==null?void 0:w.name)||""})})]})})}),r.jsx(s.Suspense,{fallback:r.jsx(v,{simple:!0}),children:e?r.jsx(y,{defaultValue:e==null?void 0:e.data,onValueChange:d,copilotStream:o,hideDragIcon:!0,enableHistoryControl:!0},((f=a==null?void 0:a.llm)==null?void 0:f.name)||"default"):r.jsx(v,{simple:!0})})]})})});export{Z as __tla,N as default};
