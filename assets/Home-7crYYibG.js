const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CpUNJZhr.js","assets/LLMIcon-tZAM1-Q5.js","assets/index-CMO0DEG8.js","assets/index-Vcso_2OS.css","assets/routes-PTuNXW4r.js","assets/dot-DgXqs9Cs.js","assets/createLucideIcon-D9I8Id43.js","assets/CodeEditor-C0Uqhk7e.js","assets/index-DBo_-Wpu.js","assets/file-tree-BZDpw5jz.js","assets/pdf.min-CuXHMbRf.js","assets/pdf.worker.min-C3F6LUbf.js","assets/index-syQpUPxj.js","assets/index-D3ruEZVV.js","assets/index-h9WScZip.js","assets/chevron-right-CE9ClFSx.js","assets/check-Cxgq5B0K.js","assets/circle-Gl6SVW0H.js","assets/popover-D5bX1ZI1.js","assets/index-Ddm2im3W.js","assets/index-HSnfLTSA.css"])))=>i.map(i=>d[i]);
var Nj=Object.defineProperty;var Oj=(Or,lr,Ca)=>lr in Or?Nj(Or,lr,{enumerable:!0,configurable:!0,writable:!0,value:Ca}):Or[lr]=Ca;var Zt=(Or,lr,Ca)=>Oj(Or,typeof lr!="symbol"?lr+"":lr,Ca);import{m as ti,r as b,M as wm,$ as $j,p as xm,a0 as Rj,a1 as jm,a2 as Em,a3 as Tj,a4 as Ij,a5 as Lj,a6 as Hc,J as Mj,a as Dj,h as Aj,j as d,P as wr,u as Fj,b as Dr,c as Ve,L as we,T as zj,a7 as Zj,U as Uj,v as ri,w as ea,e as De,f as It,a8 as ta,_ as Lt,a9 as wa,I as xr,R as Qn,d as Sm,aa as Hj,s as km,l as Cm,ab as qj,X as Vj,z as Pm,g as qc,G as xa,B as Nm,ac as Vc,ad as Bc,ae as Om,af as Bj,__tla as Wj}from"./index-CMO0DEG8.js";import{l as Kj,m as Jj,u as _t,R as $m,L as ai,A as Ut,n as Qj,C as st,o as Et,p as Pt,q as St,S as jr,s as Er,t as Sr,v as kr,w as Nt,x as ra,y as Gj,z as Xj,E as Yj,G as eE,H as Rm,J as Tm,K as ni,N as Wc,O as Im,Q as Kc,d as si,U as tE,h as Cr,T as Pr,M as nn,X as rE,Y as Ke,Z as Yt,_ as ii,$ as aE,a0 as Lm,a1 as oi,F as sn,a2 as Nr,a3 as nE,k as aa,e as ja,P as sE,a4 as Mm,a5 as Dm,a6 as Ea,a7 as Am,j as iE,a8 as oE,g as Jc,a9 as cE,i as dE,D as Qc,a as Fm,W as lE,I as uE,b as hE,V as pE,aa as mE,ab as Gc,ac as fE,ad as vE,ae as gE,af as yE,ag as _E,ah as bE,ai as wE,aj as xE,ak as jE,al as EE,am as SE,an as kE,__tla as CE}from"./chunk-C-PGUsed.js";import{aU as PE,by as Xc,b3 as NE,bg as OE,bz as zm,aY as $E,bA as RE,bB as Zm,bC as TE,bD as Um,bE as IE,n as Hm,o as LE,q as ME,I as DE,bF as AE,bG as FE,bH as zE,bI as ZE,bJ as UE,bK as HE,bL as qE,bM as VE,bN as BE,bO as WE,bP as KE,bQ as JE,bR as QE,ad as Ar,bS as GE,bT as XE,e as ut,g as me,F as q,R as YE,P as eS,O as tS,C as rS,t as ci,v as di,w as li,x as ui,aN as qm,aO as Vm,B as tt,an as hi,u as Gn,ao as Se,ap as ft,L as er,bU as pi,bV as aS,bW as nS,V as na,bX as Bm,bY as sS,bZ as Xn,b_ as Yn,b$ as es,f as iS,h as Wm,i as Km,j as Jm,aB as Qm,ag as oS,aD as cS,c0 as dS,aE as lS,c1 as uS,aF as hS,U as Gm,H as sa,S as ts,c2 as Xm,A as mi,c3 as Yc,s as ed,c4 as td,r as Ym,af as Fr,p as Ie,c5 as fi,__tla as pS}from"./routes-PTuNXW4r.js";import{h as rd,B as mS,L as Le,b as kt,i as vi,j as fS,k as ef,m as on,n as vS,o as gS,q as tf,a as yS,u as Sa,c as zr,r as _S,f as bS,l as gi,I as ad,s as cn,__tla as wS}from"./LLMIcon-tZAM1-Q5.js";import{P as yi,b as _i,T as ka,a as xS,A as jS,__tla as ES}from"./popover-D5bX1ZI1.js";import{a as nd,__tla as SS}from"./index-Ddm2im3W.js";import{s as kS}from"./toNumber-DbuxrpaZ.js";import{R as rf,I as CS,S as af,r as sd,a as nf,b as sf,c as of,__tla as PS}from"./index-B1kffZBp.js";import{p as NS,S as OS}from"./plate-editor-DlZRjZIP.js";import{p as $S,a as RS,u as TS,__tla as IS}from"./file-tree-BZDpw5jz.js";import"./dot-DgXqs9Cs.js";import"./createLucideIcon-D9I8Id43.js";let cf,LS=Promise.all([(()=>{try{return Wj}catch{}})(),(()=>{try{return CE}catch{}})(),(()=>{try{return pS}catch{}})(),(()=>{try{return wS}catch{}})(),(()=>{try{return ES}catch{}})(),(()=>{try{return SS}catch{}})(),(()=>{try{return PS}catch{}})(),(()=>{try{return IS}catch{}})()]).then(async()=>{function Or(e){const t=ti(()=>$j(e)),{isStatic:a}=b.useContext(wm);if(a){const[,r]=b.useState(e);b.useEffect(()=>t.on("change",r),[])}return t}function lr(e,t){const a=Or(t()),r=()=>a.set(t());return r(),xm(()=>{const n=()=>jm.preRender(r,!1,!0),i=e.map(s=>s.on("change",n));return()=>{i.forEach(s=>s()),Rj(r)}}),a}function Ca(e,t={}){const{isStatic:a}=b.useContext(wm),r=b.useRef(null),n=ti(()=>Em(e)?e.get():e),i=ti(()=>typeof n=="string"?n.replace(/[\d.-]/g,""):void 0),s=Or(n),o=b.useRef(n),c=b.useRef(Tj),l=()=>{u(),r.current=Ij({keyframes:[hd(s.get()),hd(o.current)],velocity:s.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...t,onUpdate:c.current})},u=()=>{r.current&&r.current.stop()};return b.useInsertionEffect(()=>s.attach((p,h)=>a?h(p):(o.current=p,c.current=v=>h(ud(v,i)),jm.postRender(l),s.get()),u),[JSON.stringify(t)]),xm(()=>{if(Em(e))return e.on("change",p=>s.set(ud(p,i)))},[s,i]),s}function ud(e,t){return t?e+t:e}function hd(e){return typeof e=="number"?e:parseFloat(e)}const mf=e=>e&&typeof e=="object"&&e.mix,ff=e=>mf(e)?e.mix:void 0;function vf(...e){const t=!Array.isArray(e[0]),a=t?0:-1,r=e[0+a],n=e[1+a],i=e[2+a],s=e[3+a],o=Lj(n,i,{mixer:ff(i[0]),...s});return t?o(r):o}function gf(e){Hc.current=[],e();const t=lr(Hc.current,e);return Hc.current=void 0,t}function pd(e,t,a,r){if(typeof e=="function")return gf(e);const n=typeof t=="function"?t:vf(t,a,r);return Array.isArray(e)?md(e,n):md([e],([i])=>n(i))}function md(e,t){const a=ti(()=>[]);return lr(e,()=>{a.length=0;const r=e.length;for(let n=0;n<r;n++)a[n]=e[n].get();return t(a)})}var Ht=(e=>(e.Started="started",e.Inprogress="inprogress",e.Success="success",e.Failed="failed",e))(Ht||{}),qt=(e=>(e.Human="human",e.User="user",e.AI="ai",e.System="system",e.Assistant="assistant",e.Tool="tool",e.FewShotExample="few_shot_example",e))(qt||{}),as=(e=>(e.Started="started",e.Inprogress="inprogress",e.Done="done",e))(as||{}),Vt=(e=>(e.Chat="chat",e.FewShotExample="few_shot_example",e))(Vt||{});function tr(e){return encodeURI(yf(e))}function yf(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}const _f={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},bf={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},wf={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let xf=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function dn(e,t=Object.create(null),a=xf,r=""){if(e&&typeof e=="object"&&!Array.isArray(e)){const i=e.$id||e.id;if(i){const s=new URL(i,a.href);s.hash.length>1?t[s.href]=e:(s.hash="",r===""?a=s:dn(e,t,a))}}else if(e!==!0&&e!==!1)return t;const n=a.href+(r?"#"+r:"");if(t[n]!==void 0)throw new Error(`Duplicate schema URI "${n}".`);if(t[n]=e,e===!0||e===!1)return t;if(e.__absolute_uri__===void 0&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:n}),e.$ref&&e.__absolute_ref__===void 0){const i=new URL(e.$ref,a.href);i.hash=i.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:i.href})}if(e.$recursiveRef&&e.__absolute_recursive_ref__===void 0){const i=new URL(e.$recursiveRef,a.href);i.hash=i.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(e.$anchor){const i=new URL("#"+e.$anchor,a.href);t[i.href]=e}for(let i in e){if(wf[i])continue;const s=`${r}/${tr(i)}`,o=e[i];if(Array.isArray(o)){if(_f[i]){const c=o.length;for(let l=0;l<c;l++)dn(o[l],t,a,`${s}/${l}`)}}else if(bf[i])for(let c in o)dn(o[c],t,a,`${s}/${tr(c)}`);else dn(o,t,a,s)}return t}const jf=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Ef=[0,31,28,31,30,31,30,31,31,30,31,30,31],Sf=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,kf=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Cf=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Pf=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Nf=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Of=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,$f=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Rf=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Tf=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,If=e=>{if(e[0]==='"')return!1;const[t,a,...r]=e.split("@");return!t||!a||r.length!==0||t.length>64||a.length>253||t[0]==="."||t.endsWith(".")||t.includes("..")||!/^[a-z0-9.-]+$/i.test(a)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)?!1:a.split(".").every(n=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(n))},Lf=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Mf=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,Df=e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e));function ur(e){return e.test.bind(e)}const fd={date:vd,time:gd.bind(void 0,!1),"date-time":zf,duration:Df,uri:Hf,"uri-reference":ur(Cf),"uri-template":ur(Pf),url:ur(Nf),email:If,hostname:ur(kf),ipv4:ur(Lf),ipv6:ur(Mf),regex:Vf,uuid:ur(Of),"json-pointer":ur($f),"json-pointer-uri-fragment":ur(Rf),"relative-json-pointer":ur(Tf)};function Af(e){return e%4===0&&(e%100!==0||e%400===0)}function vd(e){const t=e.match(jf);if(!t)return!1;const a=+t[1],r=+t[2],n=+t[3];return r>=1&&r<=12&&n>=1&&n<=(r==2&&Af(a)?29:Ef[r])}function gd(e,t){const a=t.match(Sf);if(!a)return!1;const r=+a[1],n=+a[2],i=+a[3],s=!!a[5];return(r<=23&&n<=59&&i<=59||r==23&&n==59&&i==60)&&(!e||s)}const Ff=/t|\s/i;function zf(e){const t=e.split(Ff);return t.length==2&&vd(t[0])&&gd(!0,t[1])}const Zf=/\/|:/,Uf=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Hf(e){return Zf.test(e)&&Uf.test(e)}const qf=/[^\\]\\Z/;function Vf(e){if(qf.test(e))return!1;try{return new RegExp(e,"u"),!0}catch{return!1}}function Bf(e){let t=0,a=e.length,r=0,n;for(;r<a;)t++,n=e.charCodeAt(r++),n>=55296&&n<=56319&&r<a&&(n=e.charCodeAt(r),(n&64512)==56320&&r++);return t}function ct(e,t,a="2019-09",r=dn(t),n=!0,i=null,s="#",o="#",c=Object.create(null)){if(t===!0)return{valid:!0,errors:[]};if(t===!1)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};const l=typeof e;let u;switch(l){case"boolean":case"number":case"string":u=l;break;case"object":e===null?u="null":Array.isArray(e)?u="array":u="object";break;default:throw new Error(`Instances of "${l}" type are not supported.`)}const{$ref:p,$recursiveRef:h,$recursiveAnchor:v,type:f,const:m,enum:g,required:w,not:E,anyOf:O,allOf:x,oneOf:k,if:$,then:N,else:M,format:A,properties:I,patternProperties:R,additionalProperties:z,unevaluatedProperties:F,minProperties:U,maxProperties:V,propertyNames:re,dependentRequired:Q,dependentSchemas:oe,dependencies:ce,prefixItems:Re,items:Ze,additionalItems:K,unevaluatedItems:ae,contains:xe,minContains:ne,maxContains:_,minItems:C,maxItems:D,uniqueItems:W,minimum:Z,maximum:j,exclusiveMinimum:S,exclusiveMaximum:H,multipleOf:G,minLength:Ce,maxLength:he,pattern:ge,__absolute_ref__:Ue,__absolute_recursive_ref__:yt}=t,se=[];if(v===!0&&i===null&&(i=t),h==="#"){const pe=i===null?r[yt]:i,te=`${o}/$recursiveRef`,Ne=ct(e,i===null?t:i,a,r,n,pe,s,te,c);Ne.valid||se.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:te,error:"A subschema had errors."},...Ne.errors)}if(p!==void 0){const pe=r[Ue||p];if(pe===void 0){let de=`Unresolved $ref "${p}".`;throw Ue&&Ue!==p&&(de+=`  Absolute URI "${Ue}".`),de+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error(de)}const te=`${o}/$ref`,Ne=ct(e,pe,a,r,n,i,s,te,c);if(Ne.valid||se.push({instanceLocation:s,keyword:"$ref",keywordLocation:te,error:"A subschema had errors."},...Ne.errors),a==="4"||a==="7")return{valid:se.length===0,errors:se}}if(Array.isArray(f)){let pe=f.length,te=!1;for(let Ne=0;Ne<pe;Ne++)if(u===f[Ne]||f[Ne]==="integer"&&u==="number"&&e%1===0&&e===e){te=!0;break}te||se.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f.join('", "')}".`})}else f==="integer"?(u!=="number"||e%1||e!==e)&&se.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f}".`}):f!==void 0&&u!==f&&se.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f}".`});if(m!==void 0&&(u==="object"||u==="array"?rd(e,m)||se.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):e!==m&&se.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),g!==void 0&&(u==="object"||u==="array"?g.some(pe=>rd(e,pe))||se.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(pe=>e===pe)||se.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),E!==void 0){const pe=`${o}/not`;ct(e,E,a,r,n,i,s,pe).valid&&se.push({instanceLocation:s,keyword:"not",keywordLocation:pe,error:'Instance matched "not" schema.'})}let Xe=[];if(O!==void 0){const pe=`${o}/anyOf`,te=se.length;let Ne=!1;for(let de=0;de<O.length;de++){const ie=O[de],Ee=Object.create(c),je=ct(e,ie,a,r,n,v===!0?i:null,s,`${pe}/${de}`,Ee);se.push(...je.errors),Ne=Ne||je.valid,je.valid&&Xe.push(Ee)}Ne?se.length=te:se.splice(te,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:pe,error:"Instance does not match any subschemas."})}if(x!==void 0){const pe=`${o}/allOf`,te=se.length;let Ne=!0;for(let de=0;de<x.length;de++){const ie=x[de],Ee=Object.create(c),je=ct(e,ie,a,r,n,v===!0?i:null,s,`${pe}/${de}`,Ee);se.push(...je.errors),Ne=Ne&&je.valid,je.valid&&Xe.push(Ee)}Ne?se.length=te:se.splice(te,0,{instanceLocation:s,keyword:"allOf",keywordLocation:pe,error:"Instance does not match every subschema."})}if(k!==void 0){const pe=`${o}/oneOf`,te=se.length,Ne=k.filter((de,ie)=>{const Ee=Object.create(c),je=ct(e,de,a,r,n,v===!0?i:null,s,`${pe}/${ie}`,Ee);return se.push(...je.errors),je.valid&&Xe.push(Ee),je.valid}).length;Ne===1?se.length=te:se.splice(te,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:pe,error:`Instance does not match exactly one subschema (${Ne} matches).`})}if((u==="object"||u==="array")&&Object.assign(c,...Xe),$!==void 0){const pe=`${o}/if`;if(ct(e,$,a,r,n,i,s,pe,c).valid){if(N!==void 0){const te=ct(e,N,a,r,n,i,s,`${o}/then`,c);te.valid||se.push({instanceLocation:s,keyword:"if",keywordLocation:pe,error:'Instance does not match "then" schema.'},...te.errors)}}else if(M!==void 0){const te=ct(e,M,a,r,n,i,s,`${o}/else`,c);te.valid||se.push({instanceLocation:s,keyword:"if",keywordLocation:pe,error:'Instance does not match "else" schema.'},...te.errors)}}if(u==="object"){if(w!==void 0)for(const de of w)de in e||se.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${de}".`});const pe=Object.keys(e);if(U!==void 0&&pe.length<U&&se.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${U} properties.`}),V!==void 0&&pe.length>V&&se.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${V} properties.`}),re!==void 0){const de=`${o}/propertyNames`;for(const ie in e){const Ee=`${s}/${tr(ie)}`,je=ct(ie,re,a,r,n,i,Ee,de);je.valid||se.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:de,error:`Property name "${ie}" does not match schema.`},...je.errors)}}if(Q!==void 0){const de=`${o}/dependantRequired`;for(const ie in Q)if(ie in e){const Ee=Q[ie];for(const je of Ee)je in e||se.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:de,error:`Instance has "${ie}" but does not have "${je}".`})}}if(oe!==void 0)for(const de in oe){const ie=`${o}/dependentSchemas`;if(de in e){const Ee=ct(e,oe[de],a,r,n,i,s,`${ie}/${tr(de)}`,c);Ee.valid||se.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:ie,error:`Instance has "${de}" but does not match dependant schema.`},...Ee.errors)}}if(ce!==void 0){const de=`${o}/dependencies`;for(const ie in ce)if(ie in e){const Ee=ce[ie];if(Array.isArray(Ee))for(const je of Ee)je in e||se.push({instanceLocation:s,keyword:"dependencies",keywordLocation:de,error:`Instance has "${ie}" but does not have "${je}".`});else{const je=ct(e,Ee,a,r,n,i,s,`${de}/${tr(ie)}`);je.valid||se.push({instanceLocation:s,keyword:"dependencies",keywordLocation:de,error:`Instance has "${ie}" but does not match dependant schema.`},...je.errors)}}}const te=Object.create(null);let Ne=!1;if(I!==void 0){const de=`${o}/properties`;for(const ie in I){if(!(ie in e))continue;const Ee=`${s}/${tr(ie)}`,je=ct(e[ie],I[ie],a,r,n,i,Ee,`${de}/${tr(ie)}`);if(je.valid)c[ie]=te[ie]=!0;else if(Ne=n,se.push({instanceLocation:s,keyword:"properties",keywordLocation:de,error:`Property "${ie}" does not match schema.`},...je.errors),Ne)break}}if(!Ne&&R!==void 0){const de=`${o}/patternProperties`;for(const ie in R){const Ee=new RegExp(ie,"u"),je=R[ie];for(const ot in e){if(!Ee.test(ot))continue;const ga=`${s}/${tr(ot)}`,Wn=ct(e[ot],je,a,r,n,i,ga,`${de}/${tr(ie)}`);Wn.valid?c[ot]=te[ot]=!0:(Ne=n,se.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:de,error:`Property "${ot}" matches pattern "${ie}" but does not match associated schema.`},...Wn.errors))}}}if(!Ne&&z!==void 0){const de=`${o}/additionalProperties`;for(const ie in e){if(te[ie])continue;const Ee=`${s}/${tr(ie)}`,je=ct(e[ie],z,a,r,n,i,Ee,de);je.valid?c[ie]=!0:(Ne=n,se.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:de,error:`Property "${ie}" does not match additional properties schema.`},...je.errors))}}else if(!Ne&&F!==void 0){const de=`${o}/unevaluatedProperties`;for(const ie in e)if(!c[ie]){const Ee=`${s}/${tr(ie)}`,je=ct(e[ie],F,a,r,n,i,Ee,de);je.valid?c[ie]=!0:se.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:de,error:`Property "${ie}" does not match unevaluated properties schema.`},...je.errors)}}}else if(u==="array"){D!==void 0&&e.length>D&&se.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${D}).`}),C!==void 0&&e.length<C&&se.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${C}).`});const pe=e.length;let te=0,Ne=!1;if(Re!==void 0){const de=`${o}/prefixItems`,ie=Math.min(Re.length,pe);for(;te<ie;te++){const Ee=ct(e[te],Re[te],a,r,n,i,`${s}/${te}`,`${de}/${te}`);if(c[te]=!0,!Ee.valid&&(Ne=n,se.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:de,error:"Items did not match schema."},...Ee.errors),Ne))break}}if(Ze!==void 0){const de=`${o}/items`;if(Array.isArray(Ze)){const ie=Math.min(Ze.length,pe);for(;te<ie;te++){const Ee=ct(e[te],Ze[te],a,r,n,i,`${s}/${te}`,`${de}/${te}`);if(c[te]=!0,!Ee.valid&&(Ne=n,se.push({instanceLocation:s,keyword:"items",keywordLocation:de,error:"Items did not match schema."},...Ee.errors),Ne))break}}else for(;te<pe;te++){const ie=ct(e[te],Ze,a,r,n,i,`${s}/${te}`,de);if(c[te]=!0,!ie.valid&&(Ne=n,se.push({instanceLocation:s,keyword:"items",keywordLocation:de,error:"Items did not match schema."},...ie.errors),Ne))break}if(!Ne&&K!==void 0){const ie=`${o}/additionalItems`;for(;te<pe;te++){const Ee=ct(e[te],K,a,r,n,i,`${s}/${te}`,ie);c[te]=!0,Ee.valid||(Ne=n,se.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:ie,error:"Items did not match additional items schema."},...Ee.errors))}}}if(xe!==void 0)if(pe===0&&ne===void 0)se.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(ne!==void 0&&pe<ne)se.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${pe}) than minContains (${ne}).`});else{const de=`${o}/contains`,ie=se.length;let Ee=0;for(let je=0;je<pe;je++){const ot=ct(e[je],xe,a,r,n,i,`${s}/${je}`,de);ot.valid?(c[je]=!0,Ee++):se.push(...ot.errors)}Ee>=(ne||0)&&(se.length=ie),ne===void 0&&_===void 0&&Ee===0?se.splice(ie,0,{instanceLocation:s,keyword:"contains",keywordLocation:de,error:"Array does not contain item matching schema."}):ne!==void 0&&Ee<ne?se.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${ne} items matching schema. Only ${Ee} items were found.`}):_!==void 0&&Ee>_&&se.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${_} items matching schema. ${Ee} items were found.`})}if(!Ne&&ae!==void 0){const de=`${o}/unevaluatedItems`;for(te;te<pe;te++){if(c[te])continue;const ie=ct(e[te],ae,a,r,n,i,`${s}/${te}`,de);c[te]=!0,ie.valid||se.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:de,error:"Items did not match unevaluated items schema."},...ie.errors)}}if(W)for(let de=0;de<pe;de++){const ie=e[de],Ee=typeof ie=="object"&&ie!==null;for(let je=0;je<pe;je++){if(de===je)continue;const ot=e[je];(ie===ot||Ee&&typeof ot=="object"&&ot!==null&&rd(ie,ot))&&(se.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${de} and ${je}.`}),de=Number.MAX_SAFE_INTEGER,je=Number.MAX_SAFE_INTEGER)}}}else if(u==="number"){if(a==="4"?(Z!==void 0&&(S===!0&&e<=Z||e<Z)&&se.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${S?"or equal to ":""} ${Z}.`}),j!==void 0&&(H===!0&&e>=j||e>j)&&se.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${H?"or equal to ":""} ${j}.`})):(Z!==void 0&&e<Z&&se.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${Z}.`}),j!==void 0&&e>j&&se.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${j}.`}),S!==void 0&&e<=S&&se.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${S}.`}),H!==void 0&&e>=H&&se.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${H}.`})),G!==void 0){const pe=e%G;Math.abs(0-pe)>=11920929e-14&&Math.abs(G-pe)>=11920929e-14&&se.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${G}.`})}}else if(u==="string"){const pe=Ce===void 0&&he===void 0?0:Bf(e);Ce!==void 0&&pe<Ce&&se.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${pe} < ${Ce}).`}),he!==void 0&&pe>he&&se.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${pe} > ${he}).`}),ge!==void 0&&!new RegExp(ge,"u").test(e)&&se.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),A!==void 0&&fd[A]&&!fd[A](e)&&se.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${A}".`})}return{valid:se.length===0,errors:se}}var Wf=Object.defineProperty,Kf=(e,t,a)=>t in e?Wf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,ns=(e,t,a)=>Kf(e,typeof t!="symbol"?t+"":t,a);let yd=class extends Error{constructor(e,t){super(e),ns(this,"type"),ns(this,"field"),ns(this,"value"),ns(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function wi(e){}function Jf(e){const{onEvent:t=wi,onError:a=wi,onRetry:r=wi,onComment:n}=e;let i="",s=!0,o,c="",l="";function u(m){const g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[w,E]=Qf(`${i}${g}`);for(const O of w)p(O);i=E,s=!1}function p(m){if(m===""){v();return}if(m.startsWith(":")){n&&n(m.slice(m.startsWith(": ")?2:1));return}const g=m.indexOf(":");if(g!==-1){const w=m.slice(0,g),E=m[g+1]===" "?2:1,O=m.slice(g+E);h(w,O,m);return}h(m,"",m)}function h(m,g,w){switch(m){case"event":l=g;break;case"data":c=`${c}${g}
`;break;case"id":o=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?r(parseInt(g,10)):a(new yd(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:w}));break;default:a(new yd(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:w}));break}}function v(){c.length>0&&t({id:o,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),o=void 0,c="",l=""}function f(m={}){i&&m.consume&&p(i),o=void 0,c="",l="",i=""}return{feed:u,reset:f}}function Qf(e){const t=[];let a="";const r=e.length;for(let n=0;n<r;n++){const i=e[n];i==="\r"&&e[n+1]===`
`?(t.push(a),a="",n++):i==="\r"||i===`
`?(t.push(a),a=""):a+=i}return[t,a]}class Gf extends TransformStream{constructor({onError:t,onRetry:a,onComment:r}={}){let n;super({start(i){n=Jf({onEvent:s=>{i.enqueue(s)},onError(s){t==="terminate"?i.error(s):typeof t=="function"&&t(s)},onRetry:a,onComment:r})},transform(i){n.feed(i)}})}}const Xf=Symbol("Let zodToJsonSchema decide on which parser to use"),Yf={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},ev=e=>({...Yf,...e}),tv=e=>{const t=ev(e),a=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function _d(e,t,a,r){r!=null&&r.errorMessages&&a&&(e.errorMessage={...e.errorMessage,[t]:a})}function et(e,t,a,r,n){e[t]=a,_d(e,t,r,n)}var Be;(function(e){e.assertEqual=n=>n;function t(n){}e.assertIs=t;function a(n){throw new Error}e.assertNever=a,e.arrayToEnum=n=>{const i={};for(const s of n)i[s]=s;return i},e.getValidEnumValues=n=>{const i=e.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(const o of i)s[o]=n[o];return e.objectValues(s)},e.objectValues=n=>e.objectKeys(n).map(function(i){return n[i]}),e.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&i.push(s);return i},e.find=(n,i)=>{for(const s of n)if(i(s))return s},e.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,i=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}e.joinValues=r,e.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(Be||(Be={}));var xi;(function(e){e.mergeShapes=(t,a)=>({...t,...a})})(xi||(xi={}));const fe=Be.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Zr=e=>{switch(typeof e){case"undefined":return fe.undefined;case"string":return fe.string;case"number":return isNaN(e)?fe.nan:fe.number;case"boolean":return fe.boolean;case"function":return fe.function;case"bigint":return fe.bigint;case"symbol":return fe.symbol;case"object":return Array.isArray(e)?fe.array:e===null?fe.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?fe.promise:typeof Map<"u"&&e instanceof Map?fe.map:typeof Set<"u"&&e instanceof Set?fe.set:typeof Date<"u"&&e instanceof Date?fe.date:fe.object;default:return fe.unknown}},X=Be.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),rv=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");let rr=class df extends Error{constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const a=t||function(i){return i.message},r={_errors:[]},n=i=>{for(const s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(a(s));else{let o=r,c=0;for(;c<s.path.length;){const l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(a(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(t){if(!(t instanceof df))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Be.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=a=>a.message){const a={},r=[];for(const n of this.issues)n.path.length>0?(a[n.path[0]]=a[n.path[0]]||[],a[n.path[0]].push(t(n))):r.push(t(n));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};rr.create=e=>new rr(e);const Pa=(e,t)=>{let a;switch(e.code){case X.invalid_type:e.received===fe.undefined?a="Required":a=`Expected ${e.expected}, received ${e.received}`;break;case X.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(e.expected,Be.jsonStringifyReplacer)}`;break;case X.unrecognized_keys:a=`Unrecognized key(s) in object: ${Be.joinValues(e.keys,", ")}`;break;case X.invalid_union:a="Invalid input";break;case X.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${Be.joinValues(e.options)}`;break;case X.invalid_enum_value:a=`Invalid enum value. Expected ${Be.joinValues(e.options)}, received '${e.received}'`;break;case X.invalid_arguments:a="Invalid function arguments";break;case X.invalid_return_type:a="Invalid function return type";break;case X.invalid_date:a="Invalid date";break;case X.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(a=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?a=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?a=`Invalid input: must end with "${e.validation.endsWith}"`:Be.assertNever(e.validation):e.validation!=="regex"?a=`Invalid ${e.validation}`:a="Invalid";break;case X.too_small:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:a="Invalid input";break;case X.too_big:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?a=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:a="Invalid input";break;case X.custom:a="Invalid input";break;case X.invalid_intersection_types:a="Intersection results could not be merged";break;case X.not_multiple_of:a=`Number must be a multiple of ${e.multipleOf}`;break;case X.not_finite:a="Number must be finite";break;default:a=t.defaultError,Be.assertNever(e)}return{message:a}};let bd=Pa;function av(e){bd=e}function ss(){return bd}const is=e=>{const{data:t,path:a,errorMaps:r,issueData:n}=e,i=[...a,...n.path||[]],s={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const c=r.filter(l=>!!l).slice().reverse();for(const l of c)o=l(s,{data:t,defaultError:o}).message;return{...n,path:i,message:o}},nv=[];function le(e,t){const a=ss(),r=is({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,a,a===Pa?void 0:Pa].filter(n=>!!n)});e.common.issues.push(r)}let Mt=class lf{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,a){const r=[];for(const n of a){if(n.status==="aborted")return Oe;n.status==="dirty"&&t.dirty(),r.push(n.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,a){const r=[];for(const n of a){const i=await n.key,s=await n.value;r.push({key:i,value:s})}return lf.mergeObjectSync(t,r)}static mergeObjectSync(t,a){const r={};for(const n of a){const{key:i,value:s}=n;if(i.status==="aborted"||s.status==="aborted")return Oe;i.status==="dirty"&&t.dirty(),s.status==="dirty"&&t.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[i.value]=s.value)}return{status:t.value,value:r}}};const Oe=Object.freeze({status:"aborted"}),os=e=>({status:"dirty",value:e}),Ot=e=>({status:"valid",value:e}),ji=e=>e.status==="aborted",Ei=e=>e.status==="dirty",ln=e=>e.status==="valid",un=e=>typeof Promise<"u"&&e instanceof Promise;function cs(e,t,a,r){if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function wd(e,t,a,r,n){if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,a),a}var be;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(be||(be={}));var hn,pn;let hr=class{constructor(e,t,a,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=a,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const xd=(e,t)=>{if(ln(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const a=new rr(e.common.issues);return this._error=a,this._error}}};function Ae(e){if(!e)return{};const{errorMap:t,invalid_type_error:a,required_error:r,description:n}=e;if(t&&(a||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:n}:{errorMap:(i,s)=>{var o,c;const{message:l}=e;return i.code==="invalid_enum_value"?{message:l??s.defaultError}:typeof s.data>"u"?{message:(o=l??r)!==null&&o!==void 0?o:s.defaultError}:i.code!=="invalid_type"?{message:s.defaultError}:{message:(c=l??a)!==null&&c!==void 0?c:s.defaultError}},description:n}}let Fe=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Zr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Zr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Mt,ctx:{common:e.parent.common,data:e.data,parsedType:Zr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(un(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const a=this.safeParse(e,t);if(a.success)return a.data;throw a.error}safeParse(e,t){var a;const r={common:{issues:[],async:(a=t==null?void 0:t.async)!==null&&a!==void 0?a:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Zr(e)},n=this._parseSync({data:e,path:r.path,parent:r});return xd(r,n)}async parseAsync(e,t){const a=await this.safeParseAsync(e,t);if(a.success)return a.data;throw a.error}async safeParseAsync(e,t){const a={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Zr(e)},r=this._parse({data:e,path:a.path,parent:a}),n=await(un(r)?r:Promise.resolve(r));return xd(a,n)}refine(e,t){const a=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,n)=>{const i=e(r),s=()=>n.addIssue({code:X.custom,...a(r)});return typeof Promise<"u"&&i instanceof Promise?i.then(o=>o?!0:(s(),!1)):i?!0:(s(),!1)})}refinement(e,t){return this._refinement((a,r)=>e(a)?!0:(r.addIssue(typeof t=="function"?t(a,r):t),!1))}_refinement(e){return new ar({schema:this,typeName:Y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return pr.create(this,this._def)}nullable(){return qr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return oa.create(this,this._def)}promise(){return Ta.create(this,this._def)}or(e){return bn.create([this,e],this._def)}and(e){return wn.create(this,e,this._def)}transform(e){return new ar({...Ae(this._def),schema:this,typeName:Y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new kn({...Ae(this._def),innerType:this,defaultValue:t,typeName:Y.ZodDefault})}brand(){return new Ci({typeName:Y.ZodBranded,type:this,...Ae(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Cn({...Ae(this._def),innerType:this,catchValue:t,typeName:Y.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Pi.create(this,e)}readonly(){return Pn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const sv=/^c[^\s-]{8,}$/i,iv=/^[0-9a-z]+$/,ov=/^[0-9A-HJKMNP-TV-Z]{26}$/,cv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,dv=/^[a-z0-9_-]{21}$/i,lv=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,uv=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,hv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Si;const pv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,mv=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,fv=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,jd="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",vv=new RegExp(`^${jd}$`);function Ed(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function gv(e){return new RegExp(`^${Ed(e)}$`)}function Sd(e){let t=`${jd}T${Ed(e)}`;const a=[];return a.push(e.local?"Z?":"Z"),e.offset&&a.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${a.join("|")})`,new RegExp(`^${t}$`)}function yv(e,t){return!!((t==="v4"||!t)&&pv.test(e)||(t==="v6"||!t)&&mv.test(e))}let Na=class rs extends Fe{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==fe.string){const n=this._getOrReturnCtx(t);return le(n,{code:X.invalid_type,expected:fe.string,received:n.parsedType}),Oe}const a=new Mt;let r;for(const n of this._def.checks)if(n.kind==="min")t.data.length<n.value&&(r=this._getOrReturnCtx(t,r),le(r,{code:X.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")t.data.length>n.value&&(r=this._getOrReturnCtx(t,r),le(r,{code:X.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){const i=t.data.length>n.value,s=t.data.length<n.value;(i||s)&&(r=this._getOrReturnCtx(t,r),i?le(r,{code:X.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):s&&le(r,{code:X.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")uv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"email",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")Si||(Si=new RegExp(hv,"u")),Si.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"emoji",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")cv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"uuid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")dv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"nanoid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")sv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"cuid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")iv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"cuid2",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")ov.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"ulid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(t.data)}catch{r=this._getOrReturnCtx(t,r),le(r,{validation:"url",code:X.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"regex",code:X.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?t.data=t.data.trim():n.kind==="includes"?t.data.includes(n.value,n.position)||(r=this._getOrReturnCtx(t,r),le(r,{code:X.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?t.data=t.data.toLowerCase():n.kind==="toUpperCase"?t.data=t.data.toUpperCase():n.kind==="startsWith"?t.data.startsWith(n.value)||(r=this._getOrReturnCtx(t,r),le(r,{code:X.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?t.data.endsWith(n.value)||(r=this._getOrReturnCtx(t,r),le(r,{code:X.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?Sd(n).test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{code:X.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?vv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{code:X.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?gv(n).test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{code:X.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?lv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"duration",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?yv(t.data,n.version)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"ip",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?fv.test(t.data)||(r=this._getOrReturnCtx(t,r),le(r,{validation:"base64",code:X.invalid_string,message:n.message}),a.dirty()):Be.assertNever(n);return{status:a.value,value:t.data}}_regex(t,a,r){return this.refinement(n=>t.test(n),{validation:a,code:X.invalid_string,...be.errToObj(r)})}_addCheck(t){return new rs({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...be.errToObj(t)})}url(t){return this._addCheck({kind:"url",...be.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...be.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...be.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...be.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...be.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...be.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...be.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...be.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...be.errToObj(t)})}datetime(t){var a,r;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(a=t==null?void 0:t.offset)!==null&&a!==void 0?a:!1,local:(r=t==null?void 0:t.local)!==null&&r!==void 0?r:!1,...be.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...be.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...be.errToObj(t)})}regex(t,a){return this._addCheck({kind:"regex",regex:t,...be.errToObj(a)})}includes(t,a){return this._addCheck({kind:"includes",value:t,position:a==null?void 0:a.position,...be.errToObj(a==null?void 0:a.message)})}startsWith(t,a){return this._addCheck({kind:"startsWith",value:t,...be.errToObj(a)})}endsWith(t,a){return this._addCheck({kind:"endsWith",value:t,...be.errToObj(a)})}min(t,a){return this._addCheck({kind:"min",value:t,...be.errToObj(a)})}max(t,a){return this._addCheck({kind:"max",value:t,...be.errToObj(a)})}length(t,a){return this._addCheck({kind:"length",value:t,...be.errToObj(a)})}nonempty(t){return this.min(1,be.errToObj(t))}trim(){return new rs({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new rs({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new rs({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxLength(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}};Na.create=e=>{var t;return new Na({checks:[],typeName:Y.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...Ae(e)})};function _v(e,t){const a=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,n=a>r?a:r,i=parseInt(e.toFixed(n).replace(".","")),s=parseInt(t.toFixed(n).replace(".",""));return i%s/Math.pow(10,n)}let mn=class id extends Fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==fe.number){const n=this._getOrReturnCtx(t);return le(n,{code:X.invalid_type,expected:fe.number,received:n.parsedType}),Oe}let a;const r=new Mt;for(const n of this._def.checks)n.kind==="int"?Be.isInteger(t.data)||(a=this._getOrReturnCtx(t,a),le(a,{code:X.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):n.kind==="min"?(n.inclusive?t.data<n.value:t.data<=n.value)&&(a=this._getOrReturnCtx(t,a),le(a,{code:X.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):n.kind==="max"?(n.inclusive?t.data>n.value:t.data>=n.value)&&(a=this._getOrReturnCtx(t,a),le(a,{code:X.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):n.kind==="multipleOf"?_v(t.data,n.value)!==0&&(a=this._getOrReturnCtx(t,a),le(a,{code:X.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):n.kind==="finite"?Number.isFinite(t.data)||(a=this._getOrReturnCtx(t,a),le(a,{code:X.not_finite,message:n.message}),r.dirty()):Be.assertNever(n);return{status:r.value,value:t.data}}gte(t,a){return this.setLimit("min",t,!0,be.toString(a))}gt(t,a){return this.setLimit("min",t,!1,be.toString(a))}lte(t,a){return this.setLimit("max",t,!0,be.toString(a))}lt(t,a){return this.setLimit("max",t,!1,be.toString(a))}setLimit(t,a,r,n){return new id({...this._def,checks:[...this._def.checks,{kind:t,value:a,inclusive:r,message:be.toString(n)}]})}_addCheck(t){return new id({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:be.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:be.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:be.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:be.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:be.toString(t)})}multipleOf(t,a){return this._addCheck({kind:"multipleOf",value:t,message:be.toString(a)})}finite(t){return this._addCheck({kind:"finite",message:be.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:be.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:be.toString(t)})}get minValue(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxValue(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Be.isInteger(t.value))}get isFinite(){let t=null,a=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(a)&&Number.isFinite(t)}};mn.create=e=>new mn({checks:[],typeName:Y.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Ae(e)});let fn=class od extends Fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==fe.bigint){const n=this._getOrReturnCtx(t);return le(n,{code:X.invalid_type,expected:fe.bigint,received:n.parsedType}),Oe}let a;const r=new Mt;for(const n of this._def.checks)n.kind==="min"?(n.inclusive?t.data<n.value:t.data<=n.value)&&(a=this._getOrReturnCtx(t,a),le(a,{code:X.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):n.kind==="max"?(n.inclusive?t.data>n.value:t.data>=n.value)&&(a=this._getOrReturnCtx(t,a),le(a,{code:X.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):n.kind==="multipleOf"?t.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(t,a),le(a,{code:X.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):Be.assertNever(n);return{status:r.value,value:t.data}}gte(t,a){return this.setLimit("min",t,!0,be.toString(a))}gt(t,a){return this.setLimit("min",t,!1,be.toString(a))}lte(t,a){return this.setLimit("max",t,!0,be.toString(a))}lt(t,a){return this.setLimit("max",t,!1,be.toString(a))}setLimit(t,a,r,n){return new od({...this._def,checks:[...this._def.checks,{kind:t,value:a,inclusive:r,message:be.toString(n)}]})}_addCheck(t){return new od({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:be.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:be.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:be.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:be.toString(t)})}multipleOf(t,a){return this._addCheck({kind:"multipleOf",value:t,message:be.toString(a)})}get minValue(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxValue(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}};fn.create=e=>{var t;return new fn({checks:[],typeName:Y.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...Ae(e)})};let vn=class extends Fe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==fe.boolean){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:fe.boolean,received:t.parsedType}),Oe}return Ot(e.data)}};vn.create=e=>new vn({typeName:Y.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Ae(e)});let gn=class uf extends Fe{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==fe.date){const n=this._getOrReturnCtx(t);return le(n,{code:X.invalid_type,expected:fe.date,received:n.parsedType}),Oe}if(isNaN(t.data.getTime())){const n=this._getOrReturnCtx(t);return le(n,{code:X.invalid_date}),Oe}const a=new Mt;let r;for(const n of this._def.checks)n.kind==="min"?t.data.getTime()<n.value&&(r=this._getOrReturnCtx(t,r),le(r,{code:X.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?t.data.getTime()>n.value&&(r=this._getOrReturnCtx(t,r),le(r,{code:X.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):Be.assertNever(n);return{status:a.value,value:new Date(t.data.getTime())}}_addCheck(t){return new uf({...this._def,checks:[...this._def.checks,t]})}min(t,a){return this._addCheck({kind:"min",value:t.getTime(),message:be.toString(a)})}max(t,a){return this._addCheck({kind:"max",value:t.getTime(),message:be.toString(a)})}get minDate(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t!=null?new Date(t):null}};gn.create=e=>new gn({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Y.ZodDate,...Ae(e)});let ds=class extends Fe{_parse(e){if(this._getType(e)!==fe.symbol){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:fe.symbol,received:t.parsedType}),Oe}return Ot(e.data)}};ds.create=e=>new ds({typeName:Y.ZodSymbol,...Ae(e)});let yn=class extends Fe{_parse(e){if(this._getType(e)!==fe.undefined){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:fe.undefined,received:t.parsedType}),Oe}return Ot(e.data)}};yn.create=e=>new yn({typeName:Y.ZodUndefined,...Ae(e)});let _n=class extends Fe{_parse(e){if(this._getType(e)!==fe.null){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:fe.null,received:t.parsedType}),Oe}return Ot(e.data)}};_n.create=e=>new _n({typeName:Y.ZodNull,...Ae(e)});let Oa=class extends Fe{constructor(){super(...arguments),this._any=!0}_parse(e){return Ot(e.data)}};Oa.create=e=>new Oa({typeName:Y.ZodAny,...Ae(e)});let ia=class extends Fe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ot(e.data)}};ia.create=e=>new ia({typeName:Y.ZodUnknown,...Ae(e)});let $r=class extends Fe{_parse(e){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:fe.never,received:t.parsedType}),Oe}};$r.create=e=>new $r({typeName:Y.ZodNever,...Ae(e)});let ls=class extends Fe{_parse(e){if(this._getType(e)!==fe.undefined){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:fe.void,received:t.parsedType}),Oe}return Ot(e.data)}};ls.create=e=>new ls({typeName:Y.ZodVoid,...Ae(e)});let oa=class bi extends Fe{_parse(t){const{ctx:a,status:r}=this._processInputParams(t),n=this._def;if(a.parsedType!==fe.array)return le(a,{code:X.invalid_type,expected:fe.array,received:a.parsedType}),Oe;if(n.exactLength!==null){const s=a.data.length>n.exactLength.value,o=a.data.length<n.exactLength.value;(s||o)&&(le(a,{code:s?X.too_big:X.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&a.data.length<n.minLength.value&&(le(a,{code:X.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),n.maxLength!==null&&a.data.length>n.maxLength.value&&(le(a,{code:X.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((s,o)=>n.type._parseAsync(new hr(a,s,a.path,o)))).then(s=>Mt.mergeArray(r,s));const i=[...a.data].map((s,o)=>n.type._parseSync(new hr(a,s,a.path,o)));return Mt.mergeArray(r,i)}get element(){return this._def.type}min(t,a){return new bi({...this._def,minLength:{value:t,message:be.toString(a)}})}max(t,a){return new bi({...this._def,maxLength:{value:t,message:be.toString(a)}})}length(t,a){return new bi({...this._def,exactLength:{value:t,message:be.toString(a)}})}nonempty(t){return this.min(1,t)}};oa.create=(e,t)=>new oa({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Y.ZodArray,...Ae(t)});function $a(e){if(e instanceof Bt){const t={};for(const a in e.shape){const r=e.shape[a];t[a]=pr.create($a(r))}return new Bt({...e._def,shape:()=>t})}else return e instanceof oa?new oa({...e._def,type:$a(e.element)}):e instanceof pr?pr.create($a(e.unwrap())):e instanceof qr?qr.create($a(e.unwrap())):e instanceof Hr?Hr.create(e.items.map(t=>$a(t))):e}let Bt=class dr extends Fe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),a=Be.objectKeys(t);return this._cached={shape:t,keys:a}}_parse(t){if(this._getType(t)!==fe.object){const c=this._getOrReturnCtx(t);return le(c,{code:X.invalid_type,expected:fe.object,received:c.parsedType}),Oe}const{status:a,ctx:r}=this._processInputParams(t),{shape:n,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof $r&&this._def.unknownKeys==="strip"))for(const c in r.data)i.includes(c)||s.push(c);const o=[];for(const c of i){const l=n[c],u=r.data[c];o.push({key:{status:"valid",value:c},value:l._parse(new hr(r,u,r.path,c)),alwaysSet:c in r.data})}if(this._def.catchall instanceof $r){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of s)o.push({key:{status:"valid",value:l},value:{status:"valid",value:r.data[l]}});else if(c==="strict")s.length>0&&(le(r,{code:X.unrecognized_keys,keys:s}),a.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of s){const u=r.data[l];o.push({key:{status:"valid",value:l},value:c._parse(new hr(r,u,r.path,l)),alwaysSet:l in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of o){const u=await l.key,p=await l.value;c.push({key:u,value:p,alwaysSet:l.alwaysSet})}return c}).then(c=>Mt.mergeObjectSync(a,c)):Mt.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(t){return be.errToObj,new dr({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(a,r)=>{var n,i,s,o;const c=(s=(i=(n=this._def).errorMap)===null||i===void 0?void 0:i.call(n,a,r).message)!==null&&s!==void 0?s:r.defaultError;return a.code==="unrecognized_keys"?{message:(o=be.errToObj(t).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new dr({...this._def,unknownKeys:"strip"})}passthrough(){return new dr({...this._def,unknownKeys:"passthrough"})}extend(t){return new dr({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new dr({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Y.ZodObject})}setKey(t,a){return this.augment({[t]:a})}catchall(t){return new dr({...this._def,catchall:t})}pick(t){const a={};return Be.objectKeys(t).forEach(r=>{t[r]&&this.shape[r]&&(a[r]=this.shape[r])}),new dr({...this._def,shape:()=>a})}omit(t){const a={};return Be.objectKeys(this.shape).forEach(r=>{t[r]||(a[r]=this.shape[r])}),new dr({...this._def,shape:()=>a})}deepPartial(){return $a(this)}partial(t){const a={};return Be.objectKeys(this.shape).forEach(r=>{const n=this.shape[r];t&&!t[r]?a[r]=n:a[r]=n.optional()}),new dr({...this._def,shape:()=>a})}required(t){const a={};return Be.objectKeys(this.shape).forEach(r=>{if(t&&!t[r])a[r]=this.shape[r];else{let n=this.shape[r];for(;n instanceof pr;)n=n._def.innerType;a[r]=n}}),new dr({...this._def,shape:()=>a})}keyof(){return Cd(Be.objectKeys(this.shape))}};Bt.create=(e,t)=>new Bt({shape:()=>e,unknownKeys:"strip",catchall:$r.create(),typeName:Y.ZodObject,...Ae(t)}),Bt.strictCreate=(e,t)=>new Bt({shape:()=>e,unknownKeys:"strict",catchall:$r.create(),typeName:Y.ZodObject,...Ae(t)}),Bt.lazycreate=(e,t)=>new Bt({shape:e,unknownKeys:"strip",catchall:$r.create(),typeName:Y.ZodObject,...Ae(t)});let bn=class extends Fe{_parse(e){const{ctx:t}=this._processInputParams(e),a=this._def.options;function r(n){for(const s of n)if(s.result.status==="valid")return s.result;for(const s of n)if(s.result.status==="dirty")return t.common.issues.push(...s.ctx.common.issues),s.result;const i=n.map(s=>new rr(s.ctx.common.issues));return le(t,{code:X.invalid_union,unionErrors:i}),Oe}if(t.common.async)return Promise.all(a.map(async n=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await n._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(r);{let n;const i=[];for(const o of a){const c={...t,common:{...t.common,issues:[]},parent:null},l=o._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!n&&(n={result:l,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(n)return t.common.issues.push(...n.ctx.common.issues),n.result;const s=i.map(o=>new rr(o));return le(t,{code:X.invalid_union,unionErrors:s}),Oe}}get options(){return this._def.options}};bn.create=(e,t)=>new bn({options:e,typeName:Y.ZodUnion,...Ae(t)});const Ur=e=>e instanceof xn?Ur(e.schema):e instanceof ar?Ur(e.innerType()):e instanceof jn?[e.value]:e instanceof En?e.options:e instanceof Sn?Be.objectValues(e.enum):e instanceof kn?Ur(e._def.innerType):e instanceof yn?[void 0]:e instanceof _n?[null]:e instanceof pr?[void 0,...Ur(e.unwrap())]:e instanceof qr?[null,...Ur(e.unwrap())]:e instanceof Ci||e instanceof Pn?Ur(e.unwrap()):e instanceof Cn?Ur(e._def.innerType):[];class us extends Fe{_parse(t){const{ctx:a}=this._processInputParams(t);if(a.parsedType!==fe.object)return le(a,{code:X.invalid_type,expected:fe.object,received:a.parsedType}),Oe;const r=this.discriminator,n=a.data[r],i=this.optionsMap.get(n);return i?a.common.async?i._parseAsync({data:a.data,path:a.path,parent:a}):i._parseSync({data:a.data,path:a.path,parent:a}):(le(a,{code:X.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Oe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,a,r){const n=new Map;for(const i of a){const s=Ur(i.shape[t]);if(!s.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const o of s){if(n.has(o))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(o)}`);n.set(o,i)}}return new us({typeName:Y.ZodDiscriminatedUnion,discriminator:t,options:a,optionsMap:n,...Ae(r)})}}function ki(e,t){const a=Zr(e),r=Zr(t);if(e===t)return{valid:!0,data:e};if(a===fe.object&&r===fe.object){const n=Be.objectKeys(t),i=Be.objectKeys(e).filter(o=>n.indexOf(o)!==-1),s={...e,...t};for(const o of i){const c=ki(e[o],t[o]);if(!c.valid)return{valid:!1};s[o]=c.data}return{valid:!0,data:s}}else if(a===fe.array&&r===fe.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let i=0;i<e.length;i++){const s=e[i],o=t[i],c=ki(s,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return a===fe.date&&r===fe.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let wn=class extends Fe{_parse(e){const{status:t,ctx:a}=this._processInputParams(e),r=(n,i)=>{if(ji(n)||ji(i))return Oe;const s=ki(n.value,i.value);return s.valid?((Ei(n)||Ei(i))&&t.dirty(),{status:t.value,value:s.data}):(le(a,{code:X.invalid_intersection_types}),Oe)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([n,i])=>r(n,i)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};wn.create=(e,t,a)=>new wn({left:e,right:t,typeName:Y.ZodIntersection,...Ae(a)});let Hr=class hf extends Fe{_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.parsedType!==fe.array)return le(r,{code:X.invalid_type,expected:fe.array,received:r.parsedType}),Oe;if(r.data.length<this._def.items.length)return le(r,{code:X.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Oe;!this._def.rest&&r.data.length>this._def.items.length&&(le(r,{code:X.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());const n=[...r.data].map((i,s)=>{const o=this._def.items[s]||this._def.rest;return o?o._parse(new hr(r,i,r.path,s)):null}).filter(i=>!!i);return r.common.async?Promise.all(n).then(i=>Mt.mergeArray(a,i)):Mt.mergeArray(a,n)}get items(){return this._def.items}rest(t){return new hf({...this._def,rest:t})}};Hr.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Hr({items:e,typeName:Y.ZodTuple,rest:null,...Ae(t)})};let kd=class cd extends Fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.parsedType!==fe.object)return le(r,{code:X.invalid_type,expected:fe.object,received:r.parsedType}),Oe;const n=[],i=this._def.keyType,s=this._def.valueType;for(const o in r.data)n.push({key:i._parse(new hr(r,o,r.path,o)),value:s._parse(new hr(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Mt.mergeObjectAsync(a,n):Mt.mergeObjectSync(a,n)}get element(){return this._def.valueType}static create(t,a,r){return a instanceof Fe?new cd({keyType:t,valueType:a,typeName:Y.ZodRecord,...Ae(r)}):new cd({keyType:Na.create(),valueType:t,typeName:Y.ZodRecord,...Ae(a)})}},hs=class extends Fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==fe.map)return le(a,{code:X.invalid_type,expected:fe.map,received:a.parsedType}),Oe;const r=this._def.keyType,n=this._def.valueType,i=[...a.data.entries()].map(([s,o],c)=>({key:r._parse(new hr(a,s,a.path,[c,"key"])),value:n._parse(new hr(a,o,a.path,[c,"value"]))}));if(a.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const o of i){const c=await o.key,l=await o.value;if(c.status==="aborted"||l.status==="aborted")return Oe;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),s.set(c.value,l.value)}return{status:t.value,value:s}})}else{const s=new Map;for(const o of i){const c=o.key,l=o.value;if(c.status==="aborted"||l.status==="aborted")return Oe;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),s.set(c.value,l.value)}return{status:t.value,value:s}}}};hs.create=(e,t,a)=>new hs({valueType:t,keyType:e,typeName:Y.ZodMap,...Ae(a)});let ps=class dd extends Fe{_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.parsedType!==fe.set)return le(r,{code:X.invalid_type,expected:fe.set,received:r.parsedType}),Oe;const n=this._def;n.minSize!==null&&r.data.size<n.minSize.value&&(le(r,{code:X.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),a.dirty()),n.maxSize!==null&&r.data.size>n.maxSize.value&&(le(r,{code:X.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),a.dirty());const i=this._def.valueType;function s(c){const l=new Set;for(const u of c){if(u.status==="aborted")return Oe;u.status==="dirty"&&a.dirty(),l.add(u.value)}return{status:a.value,value:l}}const o=[...r.data.values()].map((c,l)=>i._parse(new hr(r,c,r.path,l)));return r.common.async?Promise.all(o).then(c=>s(c)):s(o)}min(t,a){return new dd({...this._def,minSize:{value:t,message:be.toString(a)}})}max(t,a){return new dd({...this._def,maxSize:{value:t,message:be.toString(a)}})}size(t,a){return this.min(t,a).max(t,a)}nonempty(t){return this.min(1,t)}};ps.create=(e,t)=>new ps({valueType:e,minSize:null,maxSize:null,typeName:Y.ZodSet,...Ae(t)});class Ra extends Fe{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:a}=this._processInputParams(t);if(a.parsedType!==fe.function)return le(a,{code:X.invalid_type,expected:fe.function,received:a.parsedType}),Oe;function r(o,c){return is({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,ss(),Pa].filter(l=>!!l),issueData:{code:X.invalid_arguments,argumentsError:c}})}function n(o,c){return is({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,ss(),Pa].filter(l=>!!l),issueData:{code:X.invalid_return_type,returnTypeError:c}})}const i={errorMap:a.common.contextualErrorMap},s=a.data;if(this._def.returns instanceof Ta){const o=this;return Ot(async function(...c){const l=new rr([]),u=await o._def.args.parseAsync(c,i).catch(h=>{throw l.addIssue(r(c,h)),l}),p=await Reflect.apply(s,this,u);return await o._def.returns._def.type.parseAsync(p,i).catch(h=>{throw l.addIssue(n(p,h)),l})})}else{const o=this;return Ot(function(...c){const l=o._def.args.safeParse(c,i);if(!l.success)throw new rr([r(c,l.error)]);const u=Reflect.apply(s,this,l.data),p=o._def.returns.safeParse(u,i);if(!p.success)throw new rr([n(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new Ra({...this._def,args:Hr.create(t).rest(ia.create())})}returns(t){return new Ra({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,a,r){return new Ra({args:t||Hr.create([]).rest(ia.create()),returns:a||ia.create(),typeName:Y.ZodFunction,...Ae(r)})}}let xn=class extends Fe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};xn.create=(e,t)=>new xn({getter:e,typeName:Y.ZodLazy,...Ae(t)});let jn=class extends Fe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return le(t,{received:t.data,code:X.invalid_literal,expected:this._def.value}),Oe}return{status:"valid",value:e.data}}get value(){return this._def.value}};jn.create=(e,t)=>new jn({value:e,typeName:Y.ZodLiteral,...Ae(t)});function Cd(e,t){return new En({values:e,typeName:Y.ZodEnum,...Ae(t)})}let En=class ld extends Fe{constructor(){super(...arguments),hn.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const a=this._getOrReturnCtx(t),r=this._def.values;return le(a,{expected:Be.joinValues(r),received:a.parsedType,code:X.invalid_type}),Oe}if(cs(this,hn)||wd(this,hn,new Set(this._def.values)),!cs(this,hn).has(t.data)){const a=this._getOrReturnCtx(t),r=this._def.values;return le(a,{received:a.data,code:X.invalid_enum_value,options:r}),Oe}return Ot(t.data)}get options(){return this._def.values}get enum(){const t={};for(const a of this._def.values)t[a]=a;return t}get Values(){const t={};for(const a of this._def.values)t[a]=a;return t}get Enum(){const t={};for(const a of this._def.values)t[a]=a;return t}extract(t,a=this._def){return ld.create(t,{...this._def,...a})}exclude(t,a=this._def){return ld.create(this.options.filter(r=>!t.includes(r)),{...this._def,...a})}};hn=new WeakMap,En.create=Cd;let Sn=class extends Fe{constructor(){super(...arguments),pn.set(this,void 0)}_parse(e){const t=Be.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==fe.string&&a.parsedType!==fe.number){const r=Be.objectValues(t);return le(a,{expected:Be.joinValues(r),received:a.parsedType,code:X.invalid_type}),Oe}if(cs(this,pn)||wd(this,pn,new Set(Be.getValidEnumValues(this._def.values))),!cs(this,pn).has(e.data)){const r=Be.objectValues(t);return le(a,{received:a.data,code:X.invalid_enum_value,options:r}),Oe}return Ot(e.data)}get enum(){return this._def.values}};pn=new WeakMap,Sn.create=(e,t)=>new Sn({values:e,typeName:Y.ZodNativeEnum,...Ae(t)});let Ta=class extends Fe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==fe.promise&&t.common.async===!1)return le(t,{code:X.invalid_type,expected:fe.promise,received:t.parsedType}),Oe;const a=t.parsedType===fe.promise?t.data:Promise.resolve(t.data);return Ot(a.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Ta.create=(e,t)=>new Ta({type:e,typeName:Y.ZodPromise,...Ae(t)});let ar=class extends Fe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:a}=this._processInputParams(e),r=this._def.effect||null,n={addIssue:i=>{le(a,i),i.fatal?t.abort():t.dirty()},get path(){return a.path}};if(n.addIssue=n.addIssue.bind(n),r.type==="preprocess"){const i=r.transform(a.data,n);if(a.common.async)return Promise.resolve(i).then(async s=>{if(t.value==="aborted")return Oe;const o=await this._def.schema._parseAsync({data:s,path:a.path,parent:a});return o.status==="aborted"?Oe:o.status==="dirty"||t.value==="dirty"?os(o.value):o});{if(t.value==="aborted")return Oe;const s=this._def.schema._parseSync({data:i,path:a.path,parent:a});return s.status==="aborted"?Oe:s.status==="dirty"||t.value==="dirty"?os(s.value):s}}if(r.type==="refinement"){const i=s=>{const o=r.refinement(s,n);if(a.common.async)return Promise.resolve(o);if(o instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(a.common.async===!1){const s=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return s.status==="aborted"?Oe:(s.status==="dirty"&&t.dirty(),i(s.value),{status:t.value,value:s.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(s=>s.status==="aborted"?Oe:(s.status==="dirty"&&t.dirty(),i(s.value).then(()=>({status:t.value,value:s.value}))))}if(r.type==="transform")if(a.common.async===!1){const i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!ln(i))return i;const s=r.transform(i.value,n);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>ln(i)?Promise.resolve(r.transform(i.value,n)).then(s=>({status:t.value,value:s})):i);Be.assertNever(r)}};ar.create=(e,t,a)=>new ar({schema:e,typeName:Y.ZodEffects,effect:t,...Ae(a)}),ar.createWithPreprocess=(e,t,a)=>new ar({schema:t,effect:{type:"preprocess",transform:e},typeName:Y.ZodEffects,...Ae(a)});let pr=class extends Fe{_parse(e){return this._getType(e)===fe.undefined?Ot(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};pr.create=(e,t)=>new pr({innerType:e,typeName:Y.ZodOptional,...Ae(t)});let qr=class extends Fe{_parse(e){return this._getType(e)===fe.null?Ot(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};qr.create=(e,t)=>new qr({innerType:e,typeName:Y.ZodNullable,...Ae(t)});let kn=class extends Fe{_parse(e){const{ctx:t}=this._processInputParams(e);let a=t.data;return t.parsedType===fe.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};kn.create=(e,t)=>new kn({innerType:e,typeName:Y.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ae(t)});let Cn=class extends Fe{_parse(e){const{ctx:t}=this._processInputParams(e),a={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return un(r)?r.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new rr(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new rr(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};Cn.create=(e,t)=>new Cn({innerType:e,typeName:Y.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ae(t)});let ms=class extends Fe{_parse(e){if(this._getType(e)!==fe.nan){const t=this._getOrReturnCtx(e);return le(t,{code:X.invalid_type,expected:fe.nan,received:t.parsedType}),Oe}return{status:"valid",value:e.data}}};ms.create=e=>new ms({typeName:Y.ZodNaN,...Ae(e)});const bv=Symbol("zod_brand");let Ci=class extends Fe{_parse(e){const{ctx:t}=this._processInputParams(e),a=t.data;return this._def.type._parse({data:a,path:t.path,parent:t})}unwrap(){return this._def.type}},Pi=class pf extends Fe{_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const n=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?Oe:n.status==="dirty"?(a.dirty(),os(n.value)):this._def.out._parseAsync({data:n.value,path:r.path,parent:r})})();{const n=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?Oe:n.status==="dirty"?(a.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:r.path,parent:r})}}static create(t,a){return new pf({in:t,out:a,typeName:Y.ZodPipeline})}},Pn=class extends Fe{_parse(e){const t=this._def.innerType._parse(e),a=r=>(ln(r)&&(r.value=Object.freeze(r.value)),r);return un(t)?t.then(r=>a(r)):a(t)}unwrap(){return this._def.innerType}};Pn.create=(e,t)=>new Pn({innerType:e,typeName:Y.ZodReadonly,...Ae(t)});function Pd(e,t={},a){return e?Oa.create().superRefine((r,n)=>{var i,s;if(!e(r)){const o=typeof t=="function"?t(r):typeof t=="string"?{message:t}:t,c=(s=(i=o.fatal)!==null&&i!==void 0?i:a)!==null&&s!==void 0?s:!0,l=typeof o=="string"?{message:o}:o;n.addIssue({code:"custom",...l,fatal:c})}}):Oa.create()}const wv={object:Bt.lazycreate};var Y;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Y||(Y={}));const xv=(e,t={message:`Input not instance of ${e.name}`})=>Pd(a=>a instanceof e,t),Nd=Na.create,Od=mn.create,jv=ms.create,Ev=fn.create,$d=vn.create,Sv=gn.create,kv=ds.create,Cv=yn.create,Pv=_n.create,Nv=Oa.create,Ov=ia.create,$v=$r.create,Rv=ls.create,Tv=oa.create,Iv=Bt.create,Lv=Bt.strictCreate,Mv=bn.create,Dv=us.create,Av=wn.create,Fv=Hr.create,zv=kd.create,Zv=hs.create,Uv=ps.create,Hv=Ra.create,qv=xn.create,Vv=jn.create,Bv=En.create,Wv=Sn.create,Kv=Ta.create,Rd=ar.create,Jv=pr.create,Qv=qr.create,Gv=ar.createWithPreprocess,Xv=Pi.create;var y=Object.freeze({__proto__:null,defaultErrorMap:Pa,setErrorMap:av,getErrorMap:ss,makeIssue:is,EMPTY_PATH:nv,addIssueToContext:le,ParseStatus:Mt,INVALID:Oe,DIRTY:os,OK:Ot,isAborted:ji,isDirty:Ei,isValid:ln,isAsync:un,get util(){return Be},get objectUtil(){return xi},ZodParsedType:fe,getParsedType:Zr,ZodType:Fe,datetimeRegex:Sd,ZodString:Na,ZodNumber:mn,ZodBigInt:fn,ZodBoolean:vn,ZodDate:gn,ZodSymbol:ds,ZodUndefined:yn,ZodNull:_n,ZodAny:Oa,ZodUnknown:ia,ZodNever:$r,ZodVoid:ls,ZodArray:oa,ZodObject:Bt,ZodUnion:bn,ZodDiscriminatedUnion:us,ZodIntersection:wn,ZodTuple:Hr,ZodRecord:kd,ZodMap:hs,ZodSet:ps,ZodFunction:Ra,ZodLazy:xn,ZodLiteral:jn,ZodEnum:En,ZodNativeEnum:Sn,ZodPromise:Ta,ZodEffects:ar,ZodTransformer:ar,ZodOptional:pr,ZodNullable:qr,ZodDefault:kn,ZodCatch:Cn,ZodNaN:ms,BRAND:bv,ZodBranded:Ci,ZodPipeline:Pi,ZodReadonly:Pn,custom:Pd,Schema:Fe,ZodSchema:Fe,late:wv,get ZodFirstPartyTypeKind(){return Y},coerce:{string:e=>Na.create({...e,coerce:!0}),number:e=>mn.create({...e,coerce:!0}),boolean:e=>vn.create({...e,coerce:!0}),bigint:e=>fn.create({...e,coerce:!0}),date:e=>gn.create({...e,coerce:!0})},any:Nv,array:Tv,bigint:Ev,boolean:$d,date:Sv,discriminatedUnion:Dv,effect:Rd,enum:Bv,function:Hv,instanceof:xv,intersection:Av,lazy:qv,literal:Vv,map:Zv,nan:jv,nativeEnum:Wv,never:$v,null:Pv,nullable:Qv,number:Od,object:Iv,oboolean:()=>$d().optional(),onumber:()=>Od().optional(),optional:Jv,ostring:()=>Nd().optional(),pipeline:Xv,preprocess:Gv,promise:Kv,record:zv,set:Uv,strictObject:Lv,string:Nd,symbol:kv,transformer:Rd,tuple:Fv,undefined:Cv,union:Mv,unknown:Ov,void:Rv,NEVER:Oe,ZodIssueCode:X,quotelessJson:rv,ZodError:rr});function Yv(){return{}}function eg(e,t){var r,n,i;const a={type:"array"};return(r=e.type)!=null&&r._def&&((i=(n=e.type)==null?void 0:n._def)==null?void 0:i.typeName)!==Y.ZodAny&&(a.items=Ge(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&et(a,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&et(a,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(et(a,"minItems",e.exactLength.value,e.exactLength.message,t),et(a,"maxItems",e.exactLength.value,e.exactLength.message,t)),a}function tg(e,t){const a={type:"integer",format:"int64"};if(!e.checks)return a;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?et(a,"minimum",r.value,r.message,t):et(a,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(a.exclusiveMinimum=!0),et(a,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?et(a,"maximum",r.value,r.message,t):et(a,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(a.exclusiveMaximum=!0),et(a,"maximum",r.value,r.message,t));break;case"multipleOf":et(a,"multipleOf",r.value,r.message,t);break}return a}function rg(){return{type:"boolean"}}function Td(e,t){return Ge(e.type._def,t)}const ag=(e,t)=>Ge(e.innerType._def,t);function Id(e,t,a){const r=a??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,i)=>Id(e,t,n))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ng(e,t)}}const ng=(e,t)=>{const a={type:"integer",format:"unix-time"};if(t.target==="openApi3")return a;for(const r of e.checks)switch(r.kind){case"min":et(a,"minimum",r.value,r.message,t);break;case"max":et(a,"maximum",r.value,r.message,t);break}return a};function sg(e,t){return{...Ge(e.innerType._def,t),default:e.defaultValue()}}function ig(e,t){return t.effectStrategy==="input"?Ge(e.schema._def,t):{}}function og(e){return{type:"string",enum:e.values}}const cg=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function dg(e,t){const a=[Ge(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Ge(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(i=>!!i);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const n=[];return a.forEach(i=>{if(cg(i))n.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let s=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...c}=i;s=c}else r=void 0;n.push(s)}}),n.length?{allOf:n,...r}:void 0}function lg(e,t){const a=typeof e.value;return a!=="bigint"&&a!=="number"&&a!=="boolean"&&a!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:a==="bigint"?"integer":a,enum:[e.value]}:{type:a==="bigint"?"integer":a,const:e.value}}let Ni;const ca={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ni===void 0&&(Ni=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ni),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Ld(e,t){const a={type:"string"};function r(n){return t.patternStrategy==="escape"?ug(n):n}if(e.checks)for(const n of e.checks)switch(n.kind){case"min":et(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,n.value):n.value,n.message,t);break;case"max":et(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":nr(a,"email",n.message,t);break;case"format:idn-email":nr(a,"idn-email",n.message,t);break;case"pattern:zod":sr(a,ca.email,n.message,t);break}break;case"url":nr(a,"uri",n.message,t);break;case"uuid":nr(a,"uuid",n.message,t);break;case"regex":sr(a,n.regex,n.message,t);break;case"cuid":sr(a,ca.cuid,n.message,t);break;case"cuid2":sr(a,ca.cuid2,n.message,t);break;case"startsWith":sr(a,RegExp(`^${r(n.value)}`),n.message,t);break;case"endsWith":sr(a,RegExp(`${r(n.value)}$`),n.message,t);break;case"datetime":nr(a,"date-time",n.message,t);break;case"date":nr(a,"date",n.message,t);break;case"time":nr(a,"time",n.message,t);break;case"duration":nr(a,"duration",n.message,t);break;case"length":et(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,n.value):n.value,n.message,t),et(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,n.value):n.value,n.message,t);break;case"includes":{sr(a,RegExp(r(n.value)),n.message,t);break}case"ip":{n.version!=="v6"&&nr(a,"ipv4",n.message,t),n.version!=="v4"&&nr(a,"ipv6",n.message,t);break}case"emoji":sr(a,ca.emoji,n.message,t);break;case"ulid":{sr(a,ca.ulid,n.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{nr(a,"binary",n.message,t);break}case"contentEncoding:base64":{et(a,"contentEncoding","base64",n.message,t);break}case"pattern:zod":{sr(a,ca.base64,n.message,t);break}}break}case"nanoid":sr(a,ca.nanoid,n.message,t)}return a}const ug=e=>Array.from(e).map(t=>/[a-zA-Z0-9]/.test(t)?t:`\\${t}`).join(""),nr=(e,t,a,r)=>{var n;e.format||(n=e.anyOf)!=null&&n.some(i=>i.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...a&&r.errorMessages&&{errorMessage:{format:a}}})):et(e,"format",t,a,r)},sr=(e,t,a,r)=>{var n;e.pattern||(n=e.allOf)!=null&&n.some(i=>i.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Md(t,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):et(e,"pattern",Md(t,r),a,r)},Md=(e,t)=>{var l;const a=typeof e=="function"?e():e;if(!t.applyRegexFlags||!a.flags)return a.source;const r={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},n=r.i?a.source.toLowerCase():a.source;let i="",s=!1,o=!1,c=!1;for(let u=0;u<n.length;u++){if(s){i+=n[u],s=!1;continue}if(r.i){if(o){if(n[u].match(/[a-z]/)){c?(i+=n[u],i+=`${n[u-2]}-${n[u]}`.toUpperCase(),c=!1):n[u+1]==="-"&&((l=n[u+2])!=null&&l.match(/[a-z]/))?(i+=n[u],c=!0):i+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){i+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(r.m){if(n[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&n[u]==="."){i+=o?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}i+=n[u],n[u]==="\\"?s=!0:o&&n[u]==="]"?o=!1:!o&&n[u]==="["&&(o=!0)}try{const u=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return i};function Dd(e,t){var r,n,i,s,o,c;if(t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===Y.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((l,u)=>({...l,[u]:Ge(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const a={type:"object",additionalProperties:Ge(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return a;if(((n=e.keyType)==null?void 0:n._def.typeName)===Y.ZodString&&((i=e.keyType._def.checks)!=null&&i.length)){const{type:l,...u}=Ld(e.keyType._def,t);return{...a,propertyNames:u}}else{if(((s=e.keyType)==null?void 0:s._def.typeName)===Y.ZodEnum)return{...a,propertyNames:{enum:e.keyType._def.values}};if(((o=e.keyType)==null?void 0:o._def.typeName)===Y.ZodBranded&&e.keyType._def.type._def.typeName===Y.ZodString&&((c=e.keyType._def.type._def.checks)!=null&&c.length)){const{type:l,...u}=Td(e.keyType._def,t);return{...a,propertyNames:u}}}return a}function hg(e,t){if(t.mapStrategy==="record")return Dd(e,t);const a=Ge(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},r=Ge(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[a,r],minItems:2,maxItems:2}}}function pg(e){const t=e.values,a=Object.keys(e.values).filter(n=>typeof t[t[n]]!="number").map(n=>t[n]),r=Array.from(new Set(a.map(n=>typeof n)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function mg(){return{not:{}}}function fg(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const fs={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function vg(e,t){if(t.target==="openApi3")return Ad(e,t);const a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every(r=>r._def.typeName in fs&&(!r._def.checks||!r._def.checks.length))){const r=a.reduce((n,i)=>{const s=fs[i._def.typeName];return s&&!n.includes(s)?[...n,s]:n},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=a.reduce((n,i)=>{const s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...n,s];case"bigint":return[...n,"integer"];case"object":if(i._def.value===null)return[...n,"null"];case"symbol":case"undefined":case"function":default:return n}},[]);if(r.length===a.length){const n=r.filter((i,s,o)=>o.indexOf(i)===s);return{type:n.length>1?n:n[0],enum:a.reduce((i,s)=>i.includes(s._def.value)?i:[...i,s._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,n)=>[...r,...n._def.values.filter(i=>!r.includes(i))],[])};return Ad(e,t)}const Ad=(e,t)=>{const a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,n)=>Ge(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function gg(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:fs[e.innerType._def.typeName],nullable:!0}:{type:[fs[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=Ge(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const a=Ge(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function yg(e,t){const a={type:"number"};if(!e.checks)return a;for(const r of e.checks)switch(r.kind){case"int":a.type="integer",_d(a,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?et(a,"minimum",r.value,r.message,t):et(a,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(a.exclusiveMinimum=!0),et(a,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?et(a,"maximum",r.value,r.message,t):et(a,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(a.exclusiveMaximum=!0),et(a,"maximum",r.value,r.message,t));break;case"multipleOf":et(a,"multipleOf",r.value,r.message,t);break}return a}function _g(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":Ge(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":Ge(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function bg(e,t){const a={type:"object",...Object.entries(e.shape()).reduce((r,[n,i])=>{if(i===void 0||i._def===void 0)return r;const s=Ge(i._def,{...t,currentPath:[...t.currentPath,"properties",n],propertyPath:[...t.currentPath,"properties",n]});return s===void 0?r:{properties:{...r.properties,[n]:s},required:i.isOptional()?r.required:[...r.required,n]}},{properties:{},required:[]}),additionalProperties:_g(e,t)};return a.required.length||delete a.required,a}const wg=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return Ge(e.innerType._def,t);const a=Ge(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return a?{anyOf:[{not:{}},a]}:{}},xg=(e,t)=>{if(t.pipeStrategy==="input")return Ge(e.in._def,t);if(t.pipeStrategy==="output")return Ge(e.out._def,t);const a=Ge(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=Ge(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,r].filter(n=>n!==void 0)}};function jg(e,t){return Ge(e.type._def,t)}function Eg(e,t){const a={type:"array",uniqueItems:!0,items:Ge(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&et(a,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&et(a,"maxItems",e.maxSize.value,e.maxSize.message,t),a}function Sg(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((a,r)=>Ge(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:Ge(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((a,r)=>Ge(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function kg(){return{not:{}}}function Cg(){return{}}const Pg=(e,t)=>Ge(e.innerType._def,t);function Ge(e,t,a=!1){var s;const r=t.seen.get(e);if(t.override){const o=(s=t.override)==null?void 0:s.call(t,e,t,r,a);if(o!==Xf)return o}if(r&&!a){const o=Ng(r,t);if(o!==void 0)return o}const n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);const i=$g(e,e.typeName,t);return i&&Rg(e,t,i),n.jsonSchema=i,i}const Ng=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Og(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((a,r)=>t.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},Og=(e,t)=>{let a=0;for(;a<e.length&&a<t.length&&e[a]===t[a];a++);return[(e.length-a).toString(),...t.slice(a)].join("/")},$g=(e,t,a)=>{switch(t){case Y.ZodString:return Ld(e,a);case Y.ZodNumber:return yg(e,a);case Y.ZodObject:return bg(e,a);case Y.ZodBigInt:return tg(e,a);case Y.ZodBoolean:return rg();case Y.ZodDate:return Id(e,a);case Y.ZodUndefined:return kg();case Y.ZodNull:return fg(a);case Y.ZodArray:return eg(e,a);case Y.ZodUnion:case Y.ZodDiscriminatedUnion:return vg(e,a);case Y.ZodIntersection:return dg(e,a);case Y.ZodTuple:return Sg(e,a);case Y.ZodRecord:return Dd(e,a);case Y.ZodLiteral:return lg(e,a);case Y.ZodEnum:return og(e);case Y.ZodNativeEnum:return pg(e);case Y.ZodNullable:return gg(e,a);case Y.ZodOptional:return wg(e,a);case Y.ZodMap:return hg(e,a);case Y.ZodSet:return Eg(e,a);case Y.ZodLazy:return Ge(e.getter()._def,a);case Y.ZodPromise:return jg(e,a);case Y.ZodNaN:case Y.ZodNever:return mg();case Y.ZodEffects:return ig(e,a);case Y.ZodAny:return Yv();case Y.ZodUnknown:return Cg();case Y.ZodDefault:return sg(e,a);case Y.ZodBranded:return Td(e,a);case Y.ZodReadonly:return Pg(e,a);case Y.ZodCatch:return ag(e,a);case Y.ZodPipeline:return xg(e,a);case Y.ZodFunction:case Y.ZodVoid:case Y.ZodSymbol:return;default:return(r=>{})()}},Rg=(e,t,a)=>(e.description&&(a.description=e.description,t.markdownDescription&&(a.markdownDescription=e.description)),a),Tg=(e,t)=>{const a=tv(t),r=void 0,n=t==null?void 0:t.name,i=Ge(e._def,a,!1)??{},s=n===void 0?r?{...i,[a.definitionPath]:r}:i:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,n].join("/"),[a.definitionPath]:{...r,[n]:i}};return a.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":a.target==="jsonSchema2019-09"&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),s};class Ig extends mS{get lc_namespace(){return["langchain","tools"]}constructor(t){super(t??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(t==null?void 0:t.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(t==null?void 0:t.responseFormat)??this.responseFormat}async invoke(t,a){let r,n=PE(a);return Xc(t)?(r=t.args,n={...n,toolCall:t}):r=t,this.call(r,n)}async call(t,a,r){var v;const n=Xc(t)?t.args:t;let i;if(NE(this.schema))try{i=await OE(this.schema,n)}catch(f){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${f.message}`),new zm(m,JSON.stringify(t))}else{const f=ct(n,this.schema);if(!f.valid){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${f.errors.map(g=>`${g.keywordLocation}: ${g.error}`).join(`
`)}`),new zm(m,JSON.stringify(t))}i=n}const s=Zm(a),o=await((v=$E.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}))==null?void 0:v.handleToolStart(this.toJSON(),typeof t=="string"?t:JSON.stringify(t),s.runId,void 0,void 0,void 0,s.runName));delete s.runId;let c;try{c=await this._call(i,o,s)}catch(f){throw await(o==null?void 0:o.handleToolError(f)),f}let l,u;if(this.responseFormat==="content_and_artifact")if(Array.isArray(c)&&c.length===2)[l,u]=c;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(c)}`);else l=c;let p;Xc(t)&&(p=t.id),!p&&RE(s)&&(p=s.toolCall.id);const h=Mg({content:l,artifact:u,toolCallId:p,name:this.name});return await(o==null?void 0:o.handleToolEnd(h)),h}}class Lg extends Ig{static lc_name(){return"DynamicStructuredTool"}constructor(t){super(t),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=t.name,this.description=t.description,this.func=t.func,this.returnDirect=t.returnDirect??this.returnDirect,this.schema=t.schema}async call(t,a,r){const n=Zm(a);return n.runName===void 0&&(n.runName=this.name),super.call(t,n,r)}_call(t,a,r){return this.func(t,a,r)}}function Mg(e){const{content:t,artifact:a,toolCallId:r}=e;return r&&!TE(t)?typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="object")?new Um({content:t,artifact:a,tool_call_id:r,name:e.name}):new Um({content:Dg(t),artifact:a,tool_call_id:r,name:e.name}):t}function Dg(e){try{return JSON.stringify(e,null,2)??""}catch{return`${e}`}}var vs="Menubar",[Oi,Ag,Fg]=Mj(vs),[Fd,ZS]=Dj(vs,[Fg,Hm]),$t=IE(),zd=Hm(),[zg,$i]=Fd(vs),Zd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,value:r,onValueChange:n,defaultValue:i,loop:s=!0,dir:o,...c}=e,l=LE(o),u=zd(a),[p="",h]=Aj({prop:r,onChange:n,defaultProp:i}),[v,f]=b.useState(null);return d.jsx(zg,{scope:a,value:p,onMenuOpen:b.useCallback(m=>{h(m),f(m)},[h]),onMenuClose:b.useCallback(()=>h(""),[h]),onMenuToggle:b.useCallback(m=>{h(g=>g?"":m),f(m)},[h]),dir:l,loop:s,children:d.jsx(Oi.Provider,{scope:a,children:d.jsx(Oi.Slot,{scope:a,children:d.jsx(ME,{asChild:!0,...u,orientation:"horizontal",loop:s,dir:l,currentTabStopId:v,onCurrentTabStopIdChange:f,children:d.jsx(wr.div,{role:"menubar",...c,ref:t})})})})})});Zd.displayName=vs;var Ri="MenubarMenu",[Zg,Ud]=Fd(Ri),Hd=e=>{const{__scopeMenubar:t,value:a,...r}=e,n=Ar(),i=a||n||"LEGACY_REACT_AUTO_VALUE",s=$i(Ri,t),o=$t(t),c=b.useRef(null),l=b.useRef(!1),u=s.value===i;return b.useEffect(()=>{u||(l.current=!1)},[u]),d.jsx(Zg,{scope:t,value:i,triggerId:Ar(),triggerRef:c,contentId:Ar(),wasKeyboardTriggerOpenRef:l,children:d.jsx(GE,{...o,open:u,onOpenChange:p=>{p||s.onMenuClose()},modal:!1,dir:s.dir,...r})})};Hd.displayName=Ri;var Ti="MenubarTrigger",qd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,disabled:r=!1,...n}=e,i=zd(a),s=$t(a),o=$i(Ti,a),c=Ud(Ti,a),l=b.useRef(null),u=Fj(t,l,c.triggerRef),[p,h]=b.useState(!1),v=o.value===c.value;return d.jsx(Oi.ItemSlot,{scope:a,value:c.value,disabled:r,children:d.jsx(DE,{asChild:!0,...i,focusable:!r,tabStopId:c.value,children:d.jsx(AE,{asChild:!0,...s,children:d.jsx(wr.button,{type:"button",role:"menuitem",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":v,"aria-controls":v?c.contentId:void 0,"data-highlighted":p?"":void 0,"data-state":v?"open":"closed","data-disabled":r?"":void 0,disabled:r,...n,ref:u,onPointerDown:Dr(e.onPointerDown,f=>{!r&&f.button===0&&f.ctrlKey===!1&&(o.onMenuOpen(c.value),v||f.preventDefault())}),onPointerEnter:Dr(e.onPointerEnter,()=>{var f;o.value&&!v&&(o.onMenuOpen(c.value),(f=l.current)==null||f.focus())}),onKeyDown:Dr(e.onKeyDown,f=>{r||(["Enter"," "].includes(f.key)&&o.onMenuToggle(c.value),f.key==="ArrowDown"&&o.onMenuOpen(c.value),["Enter"," ","ArrowDown"].includes(f.key)&&(c.wasKeyboardTriggerOpenRef.current=!0,f.preventDefault()))}),onFocus:Dr(e.onFocus,()=>h(!0)),onBlur:Dr(e.onBlur,()=>h(!1))})})})})});qd.displayName=Ti;var Ug="MenubarPortal",Vd=e=>{const{__scopeMenubar:t,...a}=e,r=$t(t);return d.jsx(XE,{...r,...a})};Vd.displayName=Ug;var Ii="MenubarContent",Bd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,align:r="start",...n}=e,i=$t(a),s=$i(Ii,a),o=Ud(Ii,a),c=Ag(a),l=b.useRef(!1);return d.jsx(FE,{id:o.contentId,"aria-labelledby":o.triggerId,"data-radix-menubar-content":"",...i,...n,ref:t,align:r,onCloseAutoFocus:Dr(e.onCloseAutoFocus,u=>{var p;!s.value&&!l.current&&((p=o.triggerRef.current)==null||p.focus()),l.current=!1,u.preventDefault()}),onFocusOutside:Dr(e.onFocusOutside,u=>{const p=u.target;c().some(h=>{var v;return(v=h.ref.current)==null?void 0:v.contains(p)})&&u.preventDefault()}),onInteractOutside:Dr(e.onInteractOutside,()=>{l.current=!0}),onEntryFocus:u=>{o.wasKeyboardTriggerOpenRef.current||u.preventDefault()},onKeyDown:Dr(e.onKeyDown,u=>{if(["ArrowRight","ArrowLeft"].includes(u.key)){const p=u.target,h=p.hasAttribute("data-radix-menubar-subtrigger"),v=p.closest("[data-radix-menubar-content]")!==u.currentTarget,f=(s.dir==="rtl"?"ArrowRight":"ArrowLeft")===u.key;if(!f&&h||v&&f)return;let m=c().filter(E=>!E.disabled).map(E=>E.value);f&&m.reverse();const g=m.indexOf(o.value);m=s.loop?ay(m,g+1):m.slice(g+1);const[w]=m;w&&s.onMenuOpen(w)}},{checkForDefaultPrevented:!1}),style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});Bd.displayName=Ii;var Hg="MenubarGroup",qg=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(zE,{...n,...r,ref:t})});qg.displayName=Hg;var Vg="MenubarLabel",Wd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(ZE,{...n,...r,ref:t})});Wd.displayName=Vg;var Bg="MenubarItem",Kd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(UE,{...n,...r,ref:t})});Kd.displayName=Bg;var Wg="MenubarCheckboxItem",Jd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(HE,{...n,...r,ref:t})});Jd.displayName=Wg;var Kg="MenubarRadioGroup",Jg=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(qE,{...n,...r,ref:t})});Jg.displayName=Kg;var Qg="MenubarRadioItem",Qd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(VE,{...n,...r,ref:t})});Qd.displayName=Qg;var Gg="MenubarItemIndicator",Gd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(BE,{...n,...r,ref:t})});Gd.displayName=Gg;var Xg="MenubarSeparator",Xd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(WE,{...n,...r,ref:t})});Xd.displayName=Xg;var Yg="MenubarArrow",ey=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(KE,{...n,...r,ref:t})});ey.displayName=Yg;var ty="MenubarSubTrigger",Yd=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(JE,{"data-radix-menubar-subtrigger":"",...n,...r,ref:t})});Yd.displayName=ty;var ry="MenubarSubContent",el=b.forwardRef((e,t)=>{const{__scopeMenubar:a,...r}=e,n=$t(a);return d.jsx(QE,{...n,"data-radix-menubar-content":"",...r,ref:t,style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});el.displayName=ry;function ay(e,t){return e.map((a,r)=>e[(t+r)%e.length])}var tl=Zd,ny=Hd,rl=qd,sy=Vd,al=Bd,nl=Wd,sl=Kd,il=Jd,ol=Qd,cl=Gd,dl=Xd,ll=Yd,ul=el;const Li=ny,hl=b.forwardRef(({className:e,...t},a)=>d.jsx(tl,{ref:a,className:Ve("flex h-10 items-center space-x-1 rounded-md border bg-background p-1",e),...t}));hl.displayName=tl.displayName;const Mi=b.forwardRef(({className:e,...t},a)=>d.jsx(rl,{ref:a,className:Ve("flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...t}));Mi.displayName=rl.displayName;const iy=b.forwardRef(({className:e,inset:t,children:a,...r},n)=>d.jsxs(ll,{ref:n,className:Ve("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...r,children:[a,d.jsx(we,{name:"chevron-right",className:"ml-auto h-4 w-4"})]}));iy.displayName=ll.displayName;const oy=b.forwardRef(({className:e,...t},a)=>d.jsx(ul,{ref:a,className:Ve("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));oy.displayName=ul.displayName;const pl=b.forwardRef(({className:e,align:t="start",alignOffset:a=-4,sideOffset:r=8,...n},i)=>d.jsx(sy,{children:d.jsx(al,{ref:i,align:t,alignOffset:a,sideOffset:r,className:Ve("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));pl.displayName=al.displayName;const ml=b.forwardRef(({className:e,inset:t,...a},r)=>d.jsx(sl,{ref:r,className:Ve("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...a}));ml.displayName=sl.displayName;const cy=b.forwardRef(({className:e,children:t,checked:a,...r},n)=>d.jsxs(il,{ref:n,className:Ve("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...r,children:[d.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:d.jsx(cl,{children:d.jsx(we,{name:"check",className:"h-4 w-4"})})}),t]}));cy.displayName=il.displayName;const dy=b.forwardRef(({className:e,children:t,...a},r)=>d.jsxs(ol,{ref:r,className:Ve("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[d.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:d.jsx(cl,{children:d.jsx(we,{name:"circle",className:"h-2 w-2 fill-current"})})}),t]}));dy.displayName=ol.displayName;const ly=b.forwardRef(({className:e,inset:t,...a},r)=>d.jsx(nl,{ref:r,className:Ve("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...a}));ly.displayName=nl.displayName;const uy=b.forwardRef(({className:e,...t},a)=>d.jsx(dl,{ref:a,className:Ve("-mx-1 my-1 h-px bg-muted",e),...t}));uy.displayName=dl.displayName;const ye=zj()(Zj(Uj((e,t)=>({...Kj,...Jj(e,t)})))),hy=()=>{const e=ut(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[t,a]=b.useState(!1),r=ye(s=>s.pushSyncNodeQueue),n=ye(s=>s.createOrUpdateFlowNode),i=b.useCallback(async(s,o)=>{try{if(!e)throw new Error("Session not found");if(!o.provider||!o.name)throw new Error("Provider and name are required");a(!0);const c=await me("LLM").findOne({where:{name:o.name,session_id:e}});return c?(r("LLM",{where:{source_type:"LLM",source_id:c.id}}),c):me("LLM").save({name:`${o.name}`,status:[Le.WebLLM,Le.Wllama].includes(o.provider)?kt.Started:kt.Loaded,session_id:e,provider:o.provider,metadata:JSON.stringify(o.metadata||{}),model_type:o.model_type||vi.LLM,parameters:o.parameters||void 0,encrypted:o.encrypted||void 0,...o}).then(async l=>{var u,p,h;return await n({source_id:l.id,source_type:"LLM",node_type:q.LLM,x:(u=s.position)==null?void 0:u.x,y:((p=s.position)==null?void 0:p.y)+(((h=s.measured)==null?void 0:h.height)||0)+30}),l})}finally{a(!1)}},[n,r,e]);return{loading:t,createLLM:i}};var fl=1,py=.9,my=.8,fy=.17,Di=.1,Ai=.999,vy=.9999,gy=.99,yy=/[\\\/_+.#"@\[\(\{&]/,_y=/[\\\/_+.#"@\[\(\{&]/g,by=/[\s-]/,vl=/[\s-]/g;function Fi(e,t,a,r,n,i,s){if(i===t.length)return n===e.length?fl:gy;var o=`${n},${i}`;if(s[o]!==void 0)return s[o];for(var c=r.charAt(i),l=a.indexOf(c,n),u=0,p,h,v,f;l>=0;)p=Fi(e,t,a,r,l+1,i+1,s),p>u&&(l===n?p*=fl:yy.test(e.charAt(l-1))?(p*=my,v=e.slice(n,l-1).match(_y),v&&n>0&&(p*=Math.pow(Ai,v.length))):by.test(e.charAt(l-1))?(p*=py,f=e.slice(n,l-1).match(vl),f&&n>0&&(p*=Math.pow(Ai,f.length))):(p*=fy,n>0&&(p*=Math.pow(Ai,l-n))),e.charAt(l)!==t.charAt(i)&&(p*=vy)),(p<Di&&a.charAt(l-1)===r.charAt(i+1)||r.charAt(i+1)===r.charAt(i)&&a.charAt(l-1)!==r.charAt(i))&&(h=Fi(e,t,a,r,l+1,i+2,s),h*Di>p&&(p=h*Di)),p>u&&(u=p),l=a.indexOf(c,l+1);return s[o]=u,u}function gl(e){return e.toLowerCase().replace(vl," ")}function wy(e,t,a){return e=a&&a.length>0?`${e+" "+a.join(" ")}`:e,Fi(e,t,gl(e),gl(t),0,0,{})}var Nn='[cmdk-group=""]',zi='[cmdk-group-items=""]',xy='[cmdk-group-heading=""]',Zi='[cmdk-item=""]',yl=`${Zi}:not([aria-disabled="true"])`,Ui="cmdk-item-select",da="data-value",jy=(e,t,a)=>wy(e,t,a),_l=b.createContext(void 0),On=()=>b.useContext(_l),bl=b.createContext(void 0),Hi=()=>b.useContext(bl),wl=b.createContext(void 0),xl=b.forwardRef((e,t)=>{let a=Ia(()=>{var K,ae;return{search:"",value:(ae=(K=e.value)!=null?K:e.defaultValue)!=null?ae:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=Ia(()=>new Set),n=Ia(()=>new Map),i=Ia(()=>new Map),s=Ia(()=>new Set),o=jl(e),{label:c,children:l,value:u,onValueChange:p,filter:h,shouldFilter:v,loop:f,disablePointerSelection:m=!1,vimBindings:g=!0,...w}=e,E=Ar(),O=Ar(),x=Ar(),k=b.useRef(null),$=Iy();la(()=>{if(u!==void 0){let K=u.trim();a.current.value=K,N.emit()}},[u]),la(()=>{$(6,F)},[]);let N=b.useMemo(()=>({subscribe:K=>(s.current.add(K),()=>s.current.delete(K)),snapshot:()=>a.current,setState:(K,ae,xe)=>{var ne,_,C;if(!Object.is(a.current[K],ae)){if(a.current[K]=ae,K==="search")z(),I(),$(1,R);else if(K==="value"&&(xe||$(5,F),((ne=o.current)==null?void 0:ne.value)!==void 0)){let D=ae??"";(C=(_=o.current).onValueChange)==null||C.call(_,D);return}N.emit()}},emit:()=>{s.current.forEach(K=>K())}}),[]),M=b.useMemo(()=>({value:(K,ae,xe)=>{var ne;ae!==((ne=i.current.get(K))==null?void 0:ne.value)&&(i.current.set(K,{value:ae,keywords:xe}),a.current.filtered.items.set(K,A(ae,xe)),$(2,()=>{I(),N.emit()}))},item:(K,ae)=>(r.current.add(K),ae&&(n.current.has(ae)?n.current.get(ae).add(K):n.current.set(ae,new Set([K]))),$(3,()=>{z(),I(),a.current.value||R(),N.emit()}),()=>{i.current.delete(K),r.current.delete(K),a.current.filtered.items.delete(K);let xe=U();$(4,()=>{z(),(xe==null?void 0:xe.getAttribute("id"))===K&&R(),N.emit()})}),group:K=>(n.current.has(K)||n.current.set(K,new Set),()=>{i.current.delete(K),n.current.delete(K)}),filter:()=>o.current.shouldFilter,label:c||e["aria-label"],getDisablePointerSelection:()=>o.current.disablePointerSelection,listId:E,inputId:x,labelId:O,listInnerRef:k}),[]);function A(K,ae){var xe,ne;let _=(ne=(xe=o.current)==null?void 0:xe.filter)!=null?ne:jy;return K?_(K,a.current.search,ae):0}function I(){if(!a.current.search||o.current.shouldFilter===!1)return;let K=a.current.filtered.items,ae=[];a.current.filtered.groups.forEach(ne=>{let _=n.current.get(ne),C=0;_.forEach(D=>{let W=K.get(D);C=Math.max(W,C)}),ae.push([ne,C])});let xe=k.current;V().sort((ne,_)=>{var C,D;let W=ne.getAttribute("id"),Z=_.getAttribute("id");return((C=K.get(Z))!=null?C:0)-((D=K.get(W))!=null?D:0)}).forEach(ne=>{let _=ne.closest(zi);_?_.appendChild(ne.parentElement===_?ne:ne.closest(`${zi} > *`)):xe.appendChild(ne.parentElement===xe?ne:ne.closest(`${zi} > *`))}),ae.sort((ne,_)=>_[1]-ne[1]).forEach(ne=>{var _;let C=(_=k.current)==null?void 0:_.querySelector(`${Nn}[${da}="${encodeURIComponent(ne[0])}"]`);C==null||C.parentElement.appendChild(C)})}function R(){let K=V().find(xe=>xe.getAttribute("aria-disabled")!=="true"),ae=K==null?void 0:K.getAttribute(da);N.setState("value",ae||void 0)}function z(){var K,ae,xe,ne;if(!a.current.search||o.current.shouldFilter===!1){a.current.filtered.count=r.current.size;return}a.current.filtered.groups=new Set;let _=0;for(let C of r.current){let D=(ae=(K=i.current.get(C))==null?void 0:K.value)!=null?ae:"",W=(ne=(xe=i.current.get(C))==null?void 0:xe.keywords)!=null?ne:[],Z=A(D,W);a.current.filtered.items.set(C,Z),Z>0&&_++}for(let[C,D]of n.current)for(let W of D)if(a.current.filtered.items.get(W)>0){a.current.filtered.groups.add(C);break}a.current.filtered.count=_}function F(){var K,ae,xe;let ne=U();ne&&(((K=ne.parentElement)==null?void 0:K.firstChild)===ne&&((xe=(ae=ne.closest(Nn))==null?void 0:ae.querySelector(xy))==null||xe.scrollIntoView({block:"nearest"})),ne.scrollIntoView({block:"nearest"}))}function U(){var K;return(K=k.current)==null?void 0:K.querySelector(`${Zi}[aria-selected="true"]`)}function V(){var K;return Array.from(((K=k.current)==null?void 0:K.querySelectorAll(yl))||[])}function re(K){let ae=V()[K];ae&&N.setState("value",ae.getAttribute(da))}function Q(K){var ae;let xe=U(),ne=V(),_=ne.findIndex(D=>D===xe),C=ne[_+K];(ae=o.current)!=null&&ae.loop&&(C=_+K<0?ne[ne.length-1]:_+K===ne.length?ne[0]:ne[_+K]),C&&N.setState("value",C.getAttribute(da))}function oe(K){let ae=U(),xe=ae==null?void 0:ae.closest(Nn),ne;for(;xe&&!ne;)xe=K>0?Ry(xe,Nn):Ty(xe,Nn),ne=xe==null?void 0:xe.querySelector(yl);ne?N.setState("value",ne.getAttribute(da)):Q(K)}let ce=()=>re(V().length-1),Re=K=>{K.preventDefault(),K.metaKey?ce():K.altKey?oe(1):Q(1)},Ze=K=>{K.preventDefault(),K.metaKey?re(0):K.altKey?oe(-1):Q(-1)};return b.createElement(wr.div,{ref:t,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:K=>{var ae;if((ae=w.onKeyDown)==null||ae.call(w,K),!K.defaultPrevented)switch(K.key){case"n":case"j":{g&&K.ctrlKey&&Re(K);break}case"ArrowDown":{Re(K);break}case"p":case"k":{g&&K.ctrlKey&&Ze(K);break}case"ArrowUp":{Ze(K);break}case"Home":{K.preventDefault(),re(0);break}case"End":{K.preventDefault(),ce();break}case"Enter":if(!K.nativeEvent.isComposing&&K.keyCode!==229){K.preventDefault();let xe=U();if(xe){let ne=new Event(Ui);xe.dispatchEvent(ne)}}}}},b.createElement("label",{"cmdk-label":"",htmlFor:M.inputId,id:M.labelId,style:My},c),gs(e,K=>b.createElement(bl.Provider,{value:N},b.createElement(_l.Provider,{value:M},K))))}),Ey=b.forwardRef((e,t)=>{var a,r;let n=Ar(),i=b.useRef(null),s=b.useContext(wl),o=On(),c=jl(e),l=(r=(a=c.current)==null?void 0:a.forceMount)!=null?r:s==null?void 0:s.forceMount;la(()=>{if(!l)return o.item(n,s==null?void 0:s.id)},[l]);let u=El(n,i,[e.value,e.children,i],e.keywords),p=Hi(),h=ua($=>$.value&&$.value===u.current),v=ua($=>l||o.filter()===!1?!0:$.search?$.filtered.items.get(n)>0:!0);b.useEffect(()=>{let $=i.current;if(!(!$||e.disabled))return $.addEventListener(Ui,f),()=>$.removeEventListener(Ui,f)},[v,e.onSelect,e.disabled]);function f(){var $,N;m(),(N=($=c.current).onSelect)==null||N.call($,u.current)}function m(){p.setState("value",u.current,!0)}if(!v)return null;let{disabled:g,value:w,onSelect:E,forceMount:O,keywords:x,...k}=e;return b.createElement(wr.div,{ref:$n([i,t]),...k,id:n,"cmdk-item":"",role:"option","aria-disabled":!!g,"aria-selected":!!h,"data-disabled":!!g,"data-selected":!!h,onPointerMove:g||o.getDisablePointerSelection()?void 0:m,onClick:g?void 0:f},e.children)}),Sy=b.forwardRef((e,t)=>{let{heading:a,children:r,forceMount:n,...i}=e,s=Ar(),o=b.useRef(null),c=b.useRef(null),l=Ar(),u=On(),p=ua(v=>n||u.filter()===!1?!0:v.search?v.filtered.groups.has(s):!0);la(()=>u.group(s),[]),El(s,o,[e.value,e.heading,c]);let h=b.useMemo(()=>({id:s,forceMount:n}),[n]);return b.createElement(wr.div,{ref:$n([o,t]),...i,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},a&&b.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:l},a),gs(e,v=>b.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?l:void 0},b.createElement(wl.Provider,{value:h},v))))}),ky=b.forwardRef((e,t)=>{let{alwaysRender:a,...r}=e,n=b.useRef(null),i=ua(s=>!s.search);return!a&&!i?null:b.createElement(wr.div,{ref:$n([n,t]),...r,"cmdk-separator":"",role:"separator"})}),Cy=b.forwardRef((e,t)=>{let{onValueChange:a,...r}=e,n=e.value!=null,i=Hi(),s=ua(u=>u.search),o=ua(u=>u.value),c=On(),l=b.useMemo(()=>{var u;let p=(u=c.listInnerRef.current)==null?void 0:u.querySelector(`${Zi}[${da}="${encodeURIComponent(o)}"]`);return p==null?void 0:p.getAttribute("id")},[]);return b.useEffect(()=>{e.value!=null&&i.setState("search",e.value)},[e.value]),b.createElement(wr.input,{ref:t,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":l,id:c.inputId,type:"text",value:n?e.value:s,onChange:u=>{n||i.setState("search",u.target.value),a==null||a(u.target.value)}})}),Py=b.forwardRef((e,t)=>{let{children:a,label:r="Suggestions",...n}=e,i=b.useRef(null),s=b.useRef(null),o=On();return b.useEffect(()=>{if(s.current&&i.current){let c=s.current,l=i.current,u,p=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let h=c.offsetHeight;l.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return p.observe(c),()=>{cancelAnimationFrame(u),p.unobserve(c)}}},[]),b.createElement(wr.div,{ref:$n([i,t]),...n,"cmdk-list":"",role:"listbox","aria-label":r,id:o.listId},gs(e,c=>b.createElement("div",{ref:$n([s,o.listInnerRef]),"cmdk-list-sizer":""},c)))}),Ny=b.forwardRef((e,t)=>{let{open:a,onOpenChange:r,overlayClassName:n,contentClassName:i,container:s,...o}=e;return b.createElement(YE,{open:a,onOpenChange:r},b.createElement(eS,{container:s},b.createElement(tS,{"cmdk-overlay":"",className:n}),b.createElement(rS,{"aria-label":e.label,"cmdk-dialog":"",className:i},b.createElement(xl,{ref:t,...o}))))}),Oy=b.forwardRef((e,t)=>ua(a=>a.filtered.count===0)?b.createElement(wr.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),$y=b.forwardRef((e,t)=>{let{progress:a,children:r,label:n="Loading...",...i}=e;return b.createElement(wr.div,{ref:t,...i,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},gs(e,s=>b.createElement("div",{"aria-hidden":!0},s)))}),Dt=Object.assign(xl,{List:Py,Item:Ey,Input:Cy,Group:Sy,Separator:ky,Dialog:Ny,Empty:Oy,Loading:$y});function Ry(e,t){let a=e.nextElementSibling;for(;a;){if(a.matches(t))return a;a=a.nextElementSibling}}function Ty(e,t){let a=e.previousElementSibling;for(;a;){if(a.matches(t))return a;a=a.previousElementSibling}}function jl(e){let t=b.useRef(e);return la(()=>{t.current=e}),t}var la=typeof window>"u"?b.useEffect:b.useLayoutEffect;function Ia(e){let t=b.useRef();return t.current===void 0&&(t.current=e()),t}function $n(e){return t=>{e.forEach(a=>{typeof a=="function"?a(t):a!=null&&(a.current=t)})}}function ua(e){let t=Hi(),a=()=>e(t.snapshot());return kS.useSyncExternalStore(t.subscribe,a,a)}function El(e,t,a,r=[]){let n=b.useRef(),i=On();return la(()=>{var s;let o=(()=>{var l;for(let u of a){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(l=u.current.textContent)==null?void 0:l.trim():n.current}})(),c=r.map(l=>l.trim());i.value(e,o,c),(s=t.current)==null||s.setAttribute(da,o),n.current=o}),n}var Iy=()=>{let[e,t]=b.useState(),a=Ia(()=>new Map);return la(()=>{a.current.forEach(r=>r()),a.current=new Map},[e]),(r,n)=>{a.current.set(r,n),t({})}};function Ly(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function gs({asChild:e,children:t},a){return e&&b.isValidElement(t)?b.cloneElement(Ly(t),{ref:t.ref},a(t.props.children)):a(t)}var My={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ys=b.forwardRef(({className:e,...t},a)=>d.jsx(Dt,{ref:a,className:Ve("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));ys.displayName=Dt.displayName;const _s=b.forwardRef(({className:e,...t},a)=>d.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[d.jsx(we,{name:"search",className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),d.jsx(Dt.Input,{ref:a,className:Ve("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));_s.displayName=Dt.Input.displayName;const bs=b.forwardRef(({className:e,...t},a)=>d.jsx(Dt.List,{ref:a,className:Ve("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));bs.displayName=Dt.List.displayName;const ws=b.forwardRef((e,t)=>d.jsx(Dt.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));ws.displayName=Dt.Empty.displayName;const xs=b.forwardRef(({className:e,...t},a)=>d.jsx(Dt.Group,{ref:a,className:Ve("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));xs.displayName=Dt.Group.displayName;const Dy=b.forwardRef(({className:e,...t},a)=>d.jsx(Dt.Separator,{ref:a,className:Ve("-mx-1 h-px bg-border",e),...t}));Dy.displayName=Dt.Separator.displayName;const La=b.forwardRef(({className:e,...t},a)=>d.jsx(Dt.Item,{ref:a,className:Ve("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...t}));La.displayName=Dt.Item.displayName;const qi=b.forwardRef(({className:e,...t},a)=>d.jsx(rf,{ref:a,className:Ve("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:d.jsx(CS,{className:Ve("flex items-center justify-center text-current"),children:d.jsx(we,{name:"check",className:"h-4 w-4"})})}));qi.displayName=rf.displayName;const Ay=["gpt-4.1","gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo"],Fy=["deepseek-r1-distill-llama-70b","llama-3.2-90b-vision-preview","llama-3.3-70b-versatile","llama-3.3-70b-specdec","llama3-70b-8192","gemma2-9b-it","llama3-8b-8192","mixtral-8x7b-32768"],zy=["llama-3.2-90b-vision-preview"],Zy=["gemini-2.0-flash-exp","gemini-1.5-flash","gemini-1.5-pro","gemini-1.5-flash-8b"],js="https://aistudio.google.com/app/apikey",Es="https://platform.openai.com/api-keys",Sl="https://console.groq.com/keys",Uy=[Le.WebLLM,Le.Wllama,Le.OpenAI,Le.GoogleGenerativeAI,Le.Groq],Hy=ri(({onConfirm:e,onCancel:t})=>{const a=ea(),{t:r}=De("dialogs"),[n,i]=b.useState(""),s=l=>{i(l)},o=async()=>{try{if((n==null?void 0:n.length)!==6)return;await(e==null?void 0:e(n)),i(""),a.resolve(!0),a.hide()}catch(l){a.reject(l)}},c=()=>{t==null||t(),i(""),a.resolve(!1),a.hide()};return d.jsx(ci,{open:a.visible,onOpenChange:c,children:d.jsxs(di,{className:"w-[330px]",children:[d.jsxs(li,{children:[d.jsx(ui,{children:r("create_session_passkey.title")}),d.jsx(qm,{children:r("create_session_passkey.description")})]}),d.jsx("div",{className:"py-4",children:d.jsxs(fS,{onChange:s,maxLength:6,children:[d.jsxs(ef,{children:[d.jsx(on,{index:0,hidden:!0}),d.jsx(on,{index:1,hidden:!0}),d.jsx(on,{index:2,hidden:!0})]}),d.jsx(vS,{}),d.jsxs(ef,{children:[d.jsx(on,{index:3,hidden:!0}),d.jsx(on,{index:4,hidden:!0}),d.jsx(on,{index:5,hidden:!0})]})]})}),d.jsx(Vm,{children:d.jsx(tt,{disabled:(n==null?void 0:n.length)!==6,onClick:o,type:"submit",children:r("create_session_passkey.confirm")})})]})})}),qy=()=>{const[e,t]=b.useState(!1),a=ut(i=>i.currentSession),r=ut(i=>i.setCurrentSession),n=b.useCallback(async i=>{if(!(!a||!i))try{t(!0);const s=await gS(),o=await tf(s,i);await me("Session").update(a.id,{passphrase:o});const c=await me("Session").findOne({where:{id:a.id}});return c&&r(c),{passphrase:s,encrypted:o}}finally{t(!1)}},[a,r]);return{loading:e,updateSessionPassphrase:n}},kl=()=>{const e=ut(n=>n.currentSession),{modalRef:t}=yS(Hy),{updateSessionPassphrase:a}=qy(),{confirmPassphrase:r}=Sa();return{confirmOrCreatePassphrase:b.useCallback(async()=>{if(e!=null&&e.passphrase)await r();else{let n="";if(await t.current.show({onConfirm:async s=>{n=s}}),!n)throw new Error("Passphrase is required");const i=await a(n);if(!i)throw new Error("Failed to update session passphrase");await hi.set("passphrase",i.passphrase)}return hi.get("passphrase")},[r,t,e==null?void 0:e.passphrase,a])}};function Vy(e){var xe,ne;const{id:t,setDialog:a}=e,{t:r}=De("components"),{toast:n}=It(),i=_t(t),[s,o]=b.useState(!1),[c,l]=b.useState(""),[u,p]=b.useState(!1),[h,v]=b.useState(""),[f,m]=b.useState(),[g,w]=b.useState(Le.WebLLM),[E,O]=b.useState(!1),[x,k]=b.useState(),$=b.useRef(),N=ut(_=>_.currentSession),M=Gn(_=>_.syncCachedLLMURLs),A=Gn(_=>_.cachedLLMURLs),{loading:I,createLLM:R}=hy();$.current=x;const{confirmOrCreatePassphrase:z}=kl();b.useEffect(()=>{M()},[M]);const F=b.useMemo(()=>c?![Le.WebLLM,Le.Wllama].includes(g):!1,[c,g]),U=b.useMemo(()=>!(x!=null&&x.functionCallingModelIds)||!(x!=null&&x.modelList)?[]:((h?x==null?void 0:x.modelList.filter(_=>_.model_id.toLowerCase().includes(h.toLowerCase())):x==null?void 0:x.modelList)||[]).sort((_,C)=>{const D=A.some(G=>G.includes(_.model_id)),W=A.some(G=>G.includes(C.model_id));if(D&&!W)return-1;if(!D&&W)return 1;const Z=$m.includes(_.model_id),j=$m.includes(C.model_id);if(Z&&!j)return-1;if(!Z&&j)return 1;const S=x==null?void 0:x.functionCallingModelIds.includes(_.model_id),H=x==null?void 0:x.functionCallingModelIds.includes(C.model_id);return S&&!H?-1:!S&&H?1:_.vram_required_MB&&C.vram_required_MB&&_.vram_required_MB!==C.vram_required_MB?_.vram_required_MB-C.vram_required_MB:_.model_id.localeCompare(C.model_id)}),[x==null?void 0:x.modelList,x==null?void 0:x.functionCallingModelIds,h,A]),V=b.useMemo(()=>{if(c)switch(g){case Le.Wllama:return x==null?void 0:x.modelList.find(_=>_.model_id===c);case Le.WebLLM:return(x==null?void 0:x.modelList)&&U.find(_=>_.model_id===c);case Le.Groq:return m({}),{model:c,model_id:c,model_type:zy.includes(c)?2:0,overrides:{}};case Le.OpenAI:return m({}),{model:c,model_id:c,model_type:2,overrides:{}};case Le.GoogleGenerativeAI:return m({}),{model:c,model_id:c,model_type:2,overrides:{}}}},[c,x==null?void 0:x.modelList,U,g]);b.useEffect(()=>{!(V!=null&&V.model_id)||!A||O(A.some(_=>_.includes(V.model_id)))},[A,V==null?void 0:V.model_id]),b.useEffect(()=>{N!=null&&N.id&&(w(Le.WebLLM),l(""),v(""),m({}))},[N==null?void 0:N.id]);const re=b.useCallback(_=>{l(_),p(!1)},[]),Q=b.useCallback(_=>{v(_)},[]),oe=b.useCallback(_=>{w(_),l(""),v(""),m({})},[]),ce=async()=>{var _;if(!(!i||!N))try{o(!0);let C;if(F){const D=await z();if(!D)throw new Error("Passphrase is not found");C=await _S(f||{},D)}await R(i,{name:c,model_type:Re(V==null?void 0:V.model_type),function_calling:V!=null&&V.model_id?(_=x==null?void 0:x.functionCallingModelIds)==null?void 0:_.includes(V==null?void 0:V.model_id):!1,encrypted:C,provider:g}),a==null||a(!1)}catch(C){ta("Create LLM",C),n({variant:"destructive",description:r("add_llm_card.errors.failed_to_create")})}finally{o(!1),w(Le.WebLLM),m({}),l(""),v("")}};b.useLayoutEffect(()=>{(async()=>{var _;try{if(g===Le.Wllama){const[C,D]=(c==null?void 0:c.split("/"))||[],W=`${C}/${D}`;if(!c||!C||!D){k({modelList:[],functionCallingModelIds:[]});return}else if(((_=$.current)==null?void 0:_.input)===W)return;const Z=await(await fetch(`https://huggingface.co/api/models/${W}`)).json();Z.siblings?k({input:W,modelList:Z.siblings.map(j=>j.rfilename).filter(j=>j.endsWith(".gguf")).map(j=>({model_id:`${W}/${j}`,model:`${W}/${j}`,model_lib:`${W}/${j}`,model_type:0,overrides:{}})),functionCallingModelIds:[]}):k({modelList:[],functionCallingModelIds:[]})}else g===Le.WebLLM&&Lt(()=>import("./index-CpUNJZhr.js").then(async C=>(await C.__tla,C)),__vite__mapDeps([0,1,2,3,4,5,6])).then(async({functionCallingModelIds:C,prebuiltAppConfig:D})=>{const W=D.model_list;k({modelList:W,functionCallingModelIds:C})})}catch{}})()},[g,c]);const Re=b.useCallback(_=>_===1?vi.embedding:_===2?vi.VLM:vi.LLM,[]),Ze=b.useMemo(()=>{switch(g){case Le.Wllama:case Le.WebLLM:return U.map(_=>{var C;return d.jsxs(La,{value:_.model_id,onSelect:re,children:[c===_.model_id?d.jsx(we,{name:"check",className:"mr-2 h-4 w-4"}):d.jsx("div",{className:"mr-2 h-4 w-4"}),d.jsxs("span",{className:"max-w-md",children:[d.jsxs("div",{className:"flex gap-2 mb-2",children:[d.jsx(zr,{name:_.model_id}),_.model_id]}),d.jsx("div",{className:"flex max-w-full flex-wrap gap-1",children:d.jsx(ai,{model:_,isFunctionCalling:((C=x==null?void 0:x.functionCallingModelIds)==null?void 0:C.includes(_.model_id))||!1,name:_.model_id,isCached:A.some(D=>D.includes(_.model_id))||!1,cloud:g!==Le.WebLLM})})]})]},_.model_id)});case Le.OpenAI:return Ay.map(_=>d.jsxs(La,{value:_,onSelect:re,children:[c===_?d.jsx(we,{name:"check",className:"h-4 w-4"}):d.jsx("div",{className:"w-4"}),d.jsx("span",{className:"max-w-md",children:d.jsxs("div",{className:"flex gap-3",children:[d.jsx(zr,{name:_}),_]})})]},_));case Le.GoogleGenerativeAI:return Zy.map(_=>d.jsxs(La,{value:_,onSelect:re,children:[c===_?d.jsx(we,{name:"check",className:"h-4 w-4"}):d.jsx("div",{className:"w-4"}),d.jsx("span",{className:"max-w-md",children:d.jsxs("div",{className:"flex gap-3",children:[d.jsx(zr,{name:_}),_]})})]},_));case Le.Groq:return Fy.map(_=>d.jsxs(La,{value:_,onSelect:re,children:[c===_?d.jsx(we,{name:"check",className:"h-4 w-4"}):d.jsx("div",{className:"w-4"}),d.jsx("span",{className:"max-w-md",children:d.jsxs("div",{className:"flex gap-3",children:[d.jsx(zr,{name:_}),_]})})]},_))}},[A,re,c,x==null?void 0:x.functionCallingModelIds,U,g]),K=b.useMemo(()=>{if(g===Le.Wllama){const[_,C]=(c==null?void 0:c.split("/"))||[];return d.jsxs(d.Fragment,{children:[d.jsx(Ut,{variant:"default",className:"mb-4",children:r("add_llm_card.wllama_description")}),d.jsx(Se,{children:r("add_llm_card.hugging_face_recommendation")}),d.jsxs(yi,{children:[d.jsx(nd,{asChild:!0,children:d.jsxs(tt,{variant:"outline",role:"combobox",className:"w-full justify-between max-w-full overflow-hidden",children:[_&&C?`${_}/${C}`:r("add_llm_card.select_model_placeholder"),d.jsx(we,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),d.jsx(_i,{className:"w-full p-0",children:d.jsxs(ys,{children:[d.jsx(_s,{placeholder:r("add_llm_card.search_placeholder")}),d.jsxs(bs,{children:[d.jsx(ws,{children:r("add_llm_card.no_model")}),d.jsx(xs,{children:Qj.map(D=>d.jsxs(La,{value:D,onSelect:re,children:[c===D?d.jsx(we,{name:"check",className:"h-4 w-4"}):d.jsx("div",{className:"w-4"}),d.jsx("span",{className:"max-w-md",children:d.jsxs("div",{className:"flex gap-3",children:[d.jsx(zr,{name:D}),D]})})]},D))})]})]})})]}),d.jsx(Se,{children:r("add_llm_card.hugging_face_repo")}),_&&C?d.jsxs("div",{className:"relative",children:[d.jsx(ft,{value:`${_}/${C}`,disabled:!0,placeholder:r("add_llm_card.hugging_face_repo_placeholder")}),d.jsx(we,{onClick:()=>l(""),name:"x",className:"h-4 w-4 absolute right-3 top-3 cursor-pointer"})]}):d.jsx(ft,{value:_?`${_}/${C}`:"",onChange:D=>l(D.target.value),placeholder:r("add_llm_card.hugging_face_repo_placeholder")}),d.jsx(Se,{children:r("add_llm_card.model_name")}),d.jsxs(yi,{open:u,onOpenChange:p,children:[d.jsx(nd,{asChild:!0,children:d.jsxs(tt,{variant:"outline",role:"combobox","aria-expanded":u,disabled:!_||!C,className:"w-full justify-between max-w-full overflow-hidden",children:[c&&V?V==null?void 0:V.model_id:r("add_llm_card.select_model_placeholder"),d.jsx(we,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),d.jsx(_i,{className:"w-full p-0",children:d.jsxs(ys,{children:[d.jsx(_s,{onValueChange:Q,placeholder:r("add_llm_card.search_placeholder")}),d.jsxs(bs,{children:[d.jsx(ws,{children:r("add_llm_card.no_model")}),d.jsx(xs,{children:Ze})]})]})})]})]})}return d.jsxs(d.Fragment,{children:[d.jsx(Se,{children:r("add_llm_card.model_name")}),d.jsxs(yi,{open:u,onOpenChange:p,children:[d.jsx(nd,{asChild:!0,children:d.jsxs(tt,{variant:"outline",role:"combobox","aria-expanded":u,className:"w-full justify-between",children:[c?V==null?void 0:V.model_id:r("add_llm_card.select_model_placeholder"),d.jsx(we,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),d.jsx(_i,{className:"w-full p-0",children:d.jsxs(ys,{children:[d.jsx(_s,{onValueChange:Q,placeholder:r("add_llm_card.search_placeholder")}),d.jsxs(bs,{children:[d.jsx(ws,{children:r("add_llm_card.no_model")}),d.jsx(xs,{children:Ze})]})]})})]})]})},[g,r,u,c,V,Q,Ze,re]),ae=b.useMemo(()=>{if(F)switch(g){case Le.Groq:case Le.OpenAI:return d.jsxs(d.Fragment,{children:[d.jsx(Ut,{variant:"destructive",className:"mt-4",children:r("add_llm_card.alert.session_passkey")}),d.jsxs("div",{className:"mt-4",children:[d.jsx(Se,{children:r("add_llm_card.encrypted_fields.api_key")}),d.jsx(tt,{variant:"link",className:"px-1",children:d.jsxs("a",{href:g===Le.OpenAI?Es:Sl,target:"_blank",rel:"noreferrer",children:["(",g===Le.OpenAI?Es:Sl,")"]})}),d.jsx(ft,{type:"password",value:(f==null?void 0:f.key)||"",onChange:_=>m(C=>({...C,key:_.target.value}))})]})]});case Le.GoogleGenerativeAI:return d.jsxs(d.Fragment,{children:[d.jsx(Ut,{variant:"destructive",className:"mt-4",children:r("add_llm_card.alert.session_passkey")}),d.jsxs("div",{className:"mt-4",children:[d.jsx(Se,{children:r("add_llm_card.encrypted_fields.api_key")}),d.jsx(tt,{variant:"link",className:"px-1",children:d.jsxs("a",{href:js,target:"_blank",rel:"noreferrer",children:["(",js,")"]})}),d.jsx(ft,{type:"password",value:(f==null?void 0:f.key)||"",onChange:_=>m(C=>({...C,key:_.target.value}))})]}),d.jsxs("div",{className:"mt-4 flex items-center",children:[d.jsx(Se,{children:r("add_llm_card.encrypted_fields.enabled_google_search_retreival")}),d.jsx(qi,{checked:!!(f!=null&&f.enabled_google_search_retreival),className:"ml-2",onCheckedChange:_=>{m(C=>({...C,enabled_google_search_retreival:_?"true":""}))}})]})]})}},[F,g,r,f]);return d.jsxs(st,{className:"max-w-lg",children:[d.jsx(Et,{children:d.jsx(Pt,{children:r("add_llm_card.title")})}),d.jsxs(St,{children:[d.jsxs("div",{className:"grid w-full gap-1.5",children:[d.jsx(Se,{children:r("add_llm_card.provider")}),d.jsxs(jr,{value:g,onValueChange:oe,children:[d.jsx(Er,{className:"w-full mb-4",children:d.jsx(Sr,{placeholder:r("add_llm_card.provider_select_placeholder")})}),d.jsx(kr,{children:Object.values(Uy).map(_=>d.jsx(Nt,{value:_,children:r(`add_llm_card.providers.${_.toLowerCase()}`)},_))})]}),K]}),V?d.jsxs("div",{className:"mt-4",children:[d.jsxs("div",{className:"mt-4 text-sm text-muted-foreground center flex max-w-full flex-wrap gap-1",children:[d.jsx(zr,{name:V.model_id,className:"mr-2"}),d.jsx(ai,{model:V,isFunctionCalling:((xe=x==null?void 0:x.functionCallingModelIds)==null?void 0:xe.includes(V.model_id))||!1,name:V.model_id,isCached:A.some(_=>_.includes(V.model_id))||!1,cloud:![Le.WebLLM,Le.Wllama].includes(g)})]}),d.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[d.jsx("span",{className:"font-bold mr-2",children:r("add_llm_card.model_url")}),V.model]}),V.model_lib?d.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[d.jsx("span",{className:"font-bold mr-2",children:r("add_llm_card.model_lib_url")}),V.model_lib]}):void 0,V.overrides&&((ne=Object.keys(V.overrides))!=null&&ne.length)?d.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[d.jsx("span",{className:"font-bold mr-2",children:r("add_llm_card.metadata")}),JSON.stringify(V.overrides)]}):void 0]}):null,ae]}),d.jsx(ra,{className:"flex justify-between",children:d.jsx(er,{loading:I||s,disabled:!(c!=null&&c.length),onClick:ce,className:"w-full",children:r(E?"add_llm_card.button_add":"add_llm_card.button_download_and_add")})})]})}const Cl=()=>{const e=ut(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,a]=b.useState(!1),r=ye(i=>i.createOrUpdateFlowNode),n=b.useCallback(async(i,s)=>{var o,c,l;try{if(!i||!e)throw new Error("Source or Session not found");a(!0);const u=((o=i.position)==null?void 0:o.x)||0,p=(((c=i.position)==null?void 0:c.y)||0)+(((l=i.measured)==null?void 0:l.height)||0),h=await me("Prompt").save({content:s.content,prefix:s.prefix,role:s.role||qt.System,status:Ht.Started,session_id:e,type:s.type||Vt.Chat});if(!h)throw new Error("Failed to save prompt");if(!await r({source_id:h.id,source_type:"Prompt",node_type:q.Prompt,x:u,y:p+20}))throw new Error("Failed to save prompt node")}finally{a(!1)}},[e,r]);return{loading:t,createPrompt:n}},By={[Vt.Chat]:{label:"add_prompt_card.prompt_types.chat",value:Vt.Chat},[Vt.FewShotExample]:{label:"add_prompt_card.prompt_types.few_shot_example",value:Vt.FewShotExample}},Wy={[qt.System]:{label:"add_prompt_card.prompt_roles.system",value:qt.System},[qt.Human]:{label:"add_prompt_card.prompt_roles.human",value:qt.Human},[qt.AI]:{label:"add_prompt_card.prompt_roles.ai",value:qt.AI}},Vi=b.memo(({defaultPromptContent:e,defaultPromptRole:t,defaultPromptType:a,hidePromptRole:r,hidePromptType:n,loading:i,onSubmit:s})=>{const[o,c]=b.useState(e||""),[l,u]=b.useState(a||Vt.Chat),[p,h]=b.useState(t),[v,f]=b.useState(""),{t:m}=De("components"),g=b.useCallback(k=>{c(k.target.value)},[]),w=b.useCallback(k=>{f(k.target.value)},[]),E=b.useCallback(k=>{k===Vt.FewShotExample&&c(`Question: {input}
Answer: {output}`),u(k)},[]),O=b.useCallback(k=>{h(k)},[]),x=async()=>{await s({content:o,role:p,prefix:v,type:l})&&(c(""),h(void 0),u("chat"),f(""))};return d.jsxs("div",{children:[d.jsxs("div",{className:"grid w-full gap-1.5",children:[n?void 0:d.jsxs(d.Fragment,{children:[d.jsx(Se,{children:m("add_prompt_card.prompt_type")}),d.jsxs(jr,{value:l,onValueChange:E,children:[d.jsx(Er,{className:"w-full mb-4",children:d.jsx(Sr,{placeholder:m("add_prompt_card.type_select_placeholder")})}),d.jsx(kr,{children:Object.values(By).map(k=>d.jsx(Nt,{value:k.value,children:m(k.label)},k.value))})]})]}),r?void 0:d.jsxs(d.Fragment,{children:[d.jsx(Se,{children:m("add_prompt_card.prompt_role")}),d.jsxs(jr,{value:p,onValueChange:O,children:[d.jsx(Er,{className:"w-full mb-4",children:d.jsx(Sr,{placeholder:m("add_prompt_card.role_select_placeholder")})}),d.jsx(kr,{children:Object.values(Wy).map(k=>d.jsx(Nt,{value:k.value,children:m(k.label)},k.value))})]})]}),l===Vt.FewShotExample&&d.jsxs(d.Fragment,{children:[d.jsx(Se,{children:m("add_prompt_card.prompt_prefix")}),d.jsx(ka,{value:v,onChange:w,disabled:!1,className:"h-20",placeholder:m("add_prompt_card.placeholder"),id:"message"}),d.jsx(Se,{children:m("add_prompt_card.prompt_content")}),d.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm justify-end items-center",children:[d.jsx(we,{name:"info",className:"mr-2",size:14}),m("add_prompt_card.few_shot_example_note")]})]}),d.jsx(ka,{value:o,onChange:g,disabled:!1,placeholder:m("add_prompt_card.placeholder"),id:"message"})]}),d.jsx("div",{children:d.jsx(er,{loading:i,disabled:!(o!=null&&o.length),onClick:x,className:"w-full mt-4",children:m("add_prompt_card.button")})})]})}),Ky=b.memo(e=>{const{id:t,thread:a,setDialog:r}=e,{t:n}=De("components"),{toast:i}=It(),s=_t(t),{createPrompt:o,loading:c}=Cl(),l=async u=>{if(s)try{if(!(u!=null&&u.content))throw new Error("Prompt data is missing");await o(s,{...u,content:u.content,thread:a}),r==null||r(!1)}catch(p){i({variant:"destructive",title:`${p}`})}};return d.jsxs(st,{className:"mw-full",children:[d.jsx(Et,{children:d.jsx(Pt,{children:n("add_prompt_card.title")})}),d.jsx(St,{children:d.jsx(Vi,{onSubmit:l,loading:c,defaultPromptRole:"system",defaultPromptType:"chat"})})]})}),Jy=()=>{const e=ut(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[t,a]=b.useState(!1),r=ye(s=>s.createOrUpdateFlowNode),n=b.useCallback((s,o,c,l)=>{var u;if(e){for(const p of o)(u=p.data)!=null&&u.length?n(s,p.data,c,p.id):c.push({name:p.name,type:p.type,enum:p.enum?JSON.stringify(p.enum):"",required:p.required,description:p.description,id:p.id||pi(),parent_id:l,schema_id:s,session_id:e});return c}},[e]),i=b.useCallback(async(s,o)=>{var c,l,u;try{if(!s||!e)throw new Error("Source or Session not found");a(!0);const p=((c=s.position)==null?void 0:c.x)||0,h=(((l=s.position)==null?void 0:l.y)||0)+(((u=s.measured)==null?void 0:u.height)||0),v=await me("Schema").save({name:"Untitled Schema",session_id:e});if(!v)throw new Error("Failed to save schema");const f=n(v.id,o,[],void 0);if(!(f!=null&&f.length))throw new Error("Failed to convert schema items");if(await me("SchemaItem").save(f),!await r({source_id:v.id,source_type:"Schema",node_type:q.Schema,x:p,y:h+20}))throw new Error("Failed to save schema node")}finally{a(!1)}},[e,n,r]);return{loading:t,createSchema:i}},Pl=b.memo(({setData:e,data:t,id:a})=>{const{t:r}=De("components"),[n,i]=b.useState({name:"",description:"",type:"string",required:!1,data:[]}),s=b.useMemo(()=>a&&t.find(m=>m.id===a)||n,[t,n,a]),o=b.useCallback(m=>{m.target.value&&!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(m.target.value)||(a?e(g=>[...g.map(w=>w.id===a?{...w,name:m.target.value||""}:w)]):i(g=>({...g,name:m.target.value||""})))},[a,e]),c=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,description:m.target.value||""}:w)]):i(g=>({...g,description:m.target.value||""}))},[a,e]),l=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,type:m||""}:w)]):i(g=>({...g,type:m||"string"}))},[a,e]),u=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,required:!!m||!1}:w)]):i(g=>({...g,required:!!m||!1}))},[a,e]),p=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,enum:m.target.value||""}:w)]):i(g=>({...g,enum:m.target.value||""}))},[a,e]),h=b.useCallback(()=>{if(t.find(m=>m.name===n.name))return wa({variant:"destructive",content:"Name already exists"});n.id=pi(),e(m=>[...m,{...n}]),i({name:"",description:"",type:"string",required:!1,id:pi(),parent:a||void 0,data:[]})},[t,n,e,a]),v=b.useCallback(m=>{e(g=>[...g.map(w=>w.id===a?{...w,data:m(w.data||[])}:w)])},[a,e]),f=["object","array"].includes(s.type);return d.jsxs("div",{className:"w-full p-1",children:[d.jsxs("div",{children:[d.jsx(Se,{children:r("add_schema_card.field.name")}),d.jsx(ft,{id:"name",onChange:o,placeholder:r("add_schema_card.field.name_placeholder"),value:(s==null?void 0:s.name)||""})]}),d.jsxs("div",{children:[d.jsx(Se,{children:r("add_schema_card.field.description")}),d.jsx(ft,{id:"description",placeholder:r("add_schema_card.field.description_placeholder"),onChange:c,value:(s==null?void 0:s.description)||""})]}),d.jsxs("div",{children:[d.jsx(Se,{children:r("add_schema_card.field.type")}),d.jsxs(jr,{onValueChange:l,value:(s==null?void 0:s.type)||"",children:[d.jsx(Er,{children:d.jsx(Sr,{placeholder:r("add_schema_card.field.type_placeholder")})}),d.jsxs(kr,{children:[d.jsx(Nt,{value:"string",children:r("add_schema_card.types.string")}),d.jsx(Nt,{value:"boolean",children:r("add_schema_card.types.boolean")}),d.jsx(Nt,{value:"number",children:r("add_schema_card.types.number")}),d.jsx(Nt,{value:"object",children:r("add_schema_card.types.object")}),d.jsx(Nt,{value:"array",children:r("add_schema_card.types.array")})]})]})]}),d.jsxs("div",{className:"flex items-center h-10",children:[d.jsx(Se,{children:r("add_schema_card.field.required")}),d.jsx(qi,{className:"ml-2","aria-label":"Select row",onCheckedChange:u,checked:s==null?void 0:s.required})]}),f?d.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[d.jsx(Se,{children:r("add_schema_card.children")}),d.jsx(Ss,{data:(s==null?void 0:s.data)||[],setData:v})]}):null,(s==null?void 0:s.type)==="enum"?d.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[d.jsx(Se,{children:r("add_schema_card.field.enum")}),d.jsx(ft,{id:"enum",onChange:p,placeholder:"Enum"})]}):null,a?null:d.jsx("div",{className:"w-full flex justify-end mt-2",children:d.jsx(tt,{variant:"secondary",disabled:!s.name||!s.description||!s.type,onClick:h,className:"w-full",children:r("add_schema_card.field.add_field")})})]})}),Ss=b.memo(({data:e,setData:t,className:a=""})=>{const r=b.useCallback(()=>{},[]),n=t||r;return d.jsxs(Gj,{type:"single",collapsible:!0,className:"mb-4",children:[e.map(i=>d.jsxs(Xj,{value:`${i.id}`,children:[d.jsx(Yj,{children:i.name}),d.jsx(eE,{children:d.jsx(Pl,{setData:n,data:e,id:i.id})})]},i.id||"new")),t?d.jsx(st,{className:Ve("p-2 mt-4",a),children:d.jsx(Pl,{setData:n,data:e})}):void 0]})}),Qy=b.memo(e=>{const{t}=De("components"),{id:a}=e,r=_t(a),[n,i]=b.useState([]),{createSchema:s,loading:o}=Jy(),c=async()=>{if(r&&(n!=null&&n.length))try{await s(r,n),i([])}catch(l){wa({variant:"destructive",title:`${l}`})}};return d.jsxs(st,{className:"max-w-lg",children:[d.jsx(Et,{children:d.jsx(Pt,{children:t("add_schema_card.title")})}),d.jsx(St,{className:"min-w-96",children:d.jsx(Ss,{setData:i,data:n})}),d.jsx(ra,{className:"flex justify-between",children:d.jsx(er,{loading:o,disabled:!(n!=null&&n.length),onClick:c,className:"w-full",children:t("add_schema_card.create")})})]})}),Nl=()=>{const e=ut(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,a]=b.useState(!1),r=ye(i=>i.createOrUpdateFlowNode),n=b.useCallback(async(i,s,o)=>{var c,l,u;try{if(!i||!e)throw new Error("Source or Session not found");a(!0);const p=((c=i.position)==null?void 0:c.x)||0,h=(((l=i.position)==null?void 0:l.y)||0)+(((u=i.measured)==null?void 0:u.height)||0),v=aS(s,o),f=await me("CSVData").save({headers:v.headers,csv:v.data,session_id:e});if(!f)throw new Error("Failed to save");if(!await r({source_id:f.id,source_type:"CSVData",node_type:q.CSVData,x:p,y:h+20}))throw new Error("Failed to save node")}finally{a(!1)}},[e,r]);return{loading:t,createCSVData:n}};function Gy({data:e}){const{t}=De("components");return d.jsxs(Rm,{className:"w-full",children:[d.jsx(Tm,{children:d.jsxs(ni,{children:[d.jsx(Wc,{children:t("add_few_shot_example_card.input")}),d.jsx(Wc,{children:t("add_few_shot_example_card.output")})]})}),d.jsx(Im,{children:e==null?void 0:e.map((a,r)=>d.jsxs(ni,{children:[d.jsx(Kc,{className:"p-4",children:a.input}),d.jsx(Kc,{className:"p-4",children:a.output})]},`${a.input}_${a.output}_${r}`))})]})}const Xy=b.memo(e=>{const{id:t}=e,{t:a}=De("components"),[r,n]=b.useState([]),[i,s]=b.useState(""),[o,c]=b.useState(""),l=_t(t),{createCSVData:u,loading:p}=Nl(),h=()=>{n(f=>[...f,{input:i,output:o}]),s(""),c("")},v=async()=>{l&&await u(l,["input","output"],r.map(f=>[f.input,f.output]))};return d.jsxs(st,{className:"mw-full",children:[d.jsx(Et,{children:d.jsx(Pt,{children:a("add_few_shot_example_card.title")})}),d.jsxs(St,{children:[d.jsxs("div",{className:"flex flex-col space-y-1.5",children:[d.jsx(Se,{htmlFor:"name",children:a("add_few_shot_example_card.input")}),d.jsx(ft,{value:i,onChange:f=>s(f.target.value||""),id:"name",placeholder:a("add_few_shot_example_card.input_placeholder")})]}),d.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[d.jsx(Se,{htmlFor:"name",children:a("add_few_shot_example_card.output")}),d.jsx(ka,{value:o,onChange:f=>c(f.target.value||""),placeholder:a("add_few_shot_example_card.output_placeholder")})]}),d.jsx("div",{className:"w-full flex mt-4 justify-end",children:d.jsx(tt,{disabled:!i||!o,onClick:h,className:"w-40",children:a("add_few_shot_example_card.add")})}),d.jsx(Gy,{data:r||[]})]}),d.jsx(ra,{className:"flex justify-between",children:d.jsx(er,{loading:p,disabled:!(r!=null&&r.length),onClick:v,className:"w-full",children:a("add_few_shot_example_card.create")})})]})}),Yy=()=>{const e=ut(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[t,a]=b.useState(!1),r=ye(s=>s.createOrUpdateFlowNode),n=ye(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async(s,o,c)=>{var l,u,p;try{if(!s||!e)throw new Error("Source or Session not found");if(!o.name||!o.description)throw new Error("Name is required");a(!0);const h=((l=s.position)==null?void 0:l.x)||0,v=(((u=s.position)==null?void 0:u.y)||0)+(((p=s.measured)==null?void 0:p.height)||0),f=await me("ToolDefinition").save({...o,name:`${o.name}`,description:`${o.description}`,session_id:e});if(!f)throw new Error("Failed create tool.");const m=await r({source_id:f.id,source_type:"ToolDefinition",node_type:q.ToolDefinition,x:h,y:v+20});if(!m)throw new Error("Failed to save node");c!=null&&c.schemaNode&&await n({source:c.schemaNode.id,target:m.id})}finally{a(!1)}},[e,r,n]);return{loading:t,createTool:i}},Ol=[{name:"speak",description:"Speak text using the browser's speech synthesis API.",handler:`
const text = input.text || '';
const voice = input.voice;
const utter = new window.SpeechSynthesisUtterance(text);
  if (voice) {
    const voices = window.speechSynthesis.getVoices();
    const match = voices.find((v) => v.name === voice);
    if (match) utter.voice = match;
  }
window.speechSynthesis.speak(utter);
  `,schema:[{name:"text",type:"string",description:"The text to speak.",required:!0},{name:"voice",type:"string",description:"The voice to use for speech synthesis.",required:!1}]},{name:"get_location",description:"Get the current location of the user.",handler:`
const location = await (new Promise((resolve, reject) => {
    if (!navigator.geolocation) {
      reject("Geolocation not supported.");
      return;
    }
    navigator.geolocation.getCurrentPosition(
      (pos) =>
        resolve({
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
        }),
      (err) => reject(err.message || "Geolocation error"),
    );
  }));
  return location;
`,schema:[]},{name:"sleep",description:"Sleep for a specified number of seconds.",handler:`
const seconds = input.seconds || 1;
await (new Promise((resolve) => setTimeout(resolve, seconds * 1000)));
`,schema:[{name:"seconds",type:"number",description:"The number of seconds to sleep.",required:!1}]},{name:"get_time",description:"Get the current date and time.",handler:`
const now = new Date();
return now.toISOString();
`,schema:[]},{name:"math_eval",description:"Evaluate a math expression.",handler:`
const expression = input.expression || '';
// Only allow numbers, spaces, and math symbols: + - * / % ( ) .
if (!/^[\\d\\s+\\-*/%.()]+$/.test(expression)) {
  throw new Error("Invalid characters in expression.");
}
return Function('"use strict";return (' + expression + ")")();
`,schema:[{name:"expression",type:"string",description:'he math expression (e.g., \\"2 + 2 * (3 - 1)\\").',required:!0}]}],e_=b.lazy(()=>Lt(()=>import("./CodeEditor-C0Uqhk7e.js"),__vite__mapDeps([7,2,3,8]))),t_=b.memo(e=>{const{t}=De("components"),{toast:a}=It(),{id:r}=e,n=_t(r),[i,s]=b.useState(""),[o,c]=b.useState(""),[l,u]=b.useState([]),[p,h]=b.useState(""),{createTool:v,loading:f}=Yy(),m=x=>{s(x.target.value)},g=x=>{c(x.target.value)},w=async()=>{if(n&&i&&o)try{await v(n,{name:i,description:o,schema:l,handler:p}),s(""),c("")}catch(x){xr("Create Tool",x),a({variant:"destructive",title:t("add_tool_card.errors.create_tool_failed")})}},E=x=>{if(x==="_EMPTY_"){s(""),c(""),u([]),h("");return}const k=Ol.find($=>$.name===x);k?(s(k.name),c(k.description),u(k.schema.map($=>({...$,id:$.id||pi()}))),h(k.handler)):(xr("Create Tool",`Predefined tool "${x}" not found`),a({variant:"destructive",title:t("add_tool_card.errors.predefine_tool_not_found")}))},O=b.useMemo(()=>({minimap:{enabled:!1}}),[]);return d.jsxs(st,{className:"mw-full",children:[d.jsx(Et,{children:d.jsx(Pt,{children:t("add_tool_card.title")})}),d.jsxs(St,{children:[d.jsxs("div",{className:"flex flex-col space-y-1.5",children:[d.jsx(Se,{htmlFor:"name",children:t("add_tool_card.tool_name")}),d.jsx(ft,{onChange:m,id:"name",placeholder:t("add_tool_card.name_placeholder")})]}),d.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[d.jsx(Se,{htmlFor:"name",children:t("add_tool_card.tool_description")}),d.jsx(ka,{onChange:g,placeholder:t("add_tool_card.description_placeholder")})]}),d.jsx("div",{className:"mt-4",children:d.jsxs(jr,{onValueChange:E,children:[d.jsx(Er,{className:"",children:d.jsx(Sr,{placeholder:t("add_tool_card.predefine_tool_placeholder")})}),d.jsxs(kr,{children:[d.jsx(Nt,{value:"_EMPTY_",children:"Empty"},"_EMPTY_"),Ol.map(x=>d.jsxs(Nt,{value:x.name,children:[x.name,d.jsx("br",{}),d.jsx("span",{className:"text-xs text-muted-foreground",children:x.description})]},x.name))]})]})}),d.jsxs(si,{defaultValue:"account",className:"w-full mt-4",children:[d.jsxs(tE,{className:"grid w-full grid-cols-2",children:[d.jsx(Cr,{value:"account",children:t("add_tool_card.tool_schema")}),d.jsx(Cr,{value:"password",children:t("add_tool_card.handler")})]}),d.jsx(Pr,{value:"account",children:d.jsx(st,{className:"p-4",children:d.jsx(Ss,{className:"mt-0",data:l,setData:u})})}),d.jsx(Pr,{value:"password",children:d.jsx(st,{className:"p-4 max-w-full",children:d.jsx(b.Suspense,{children:d.jsx(e_,{content:p,setContent:h,className:"h-40",language:"javascript",options:O})})})})]})]}),d.jsx(ra,{className:"flex justify-between",children:d.jsx(er,{loading:f,onClick:w,className:"w-full",children:t("add_tool_card.create")})})]})}),r_=()=>{const e=ut(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[t,a]=b.useState(!1),r=ye(s=>s.createOrUpdateFlowNode),n=ye(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async(s,o,c)=>{var l,u,p;try{if(!(o!=null&&o.name)||!s||!e)throw new Error("Source or Session not found");a(!0);const h=((l=s.position)==null?void 0:l.x)||0,v=(((u=s.position)==null?void 0:u.y)||0)+(((p=s.measured)==null?void 0:p.height)||0),f=await me("VectorDatabase").save({...o,name:`${o.name}`,type:o.type||nS.Local,storage:o.storage||na.DatabaseNode,raw:"",provider:o.provider||Bm.Memory,session_id:e,metadata:c?JSON.stringify({textSplitter:c}):void 0});if(!f)throw new Error("Failed to save vectorDatabase");const m=await r({source_id:f.id,source_type:"VectorDatabase",node_type:q.VectorDatabase,x:h,y:v+30});if(!m)throw new Error("Failed to save vectorDatabase node");if(o.storage===na.DataNode){const g=await me("JSONLData").save({headers:sS(["content","embedding","metadata"]),jsonl:"",session_id:e});if(!g)throw new Error("Failed to save databaseSource");const w=await r({source_id:g.id,source_type:"JSONLData",node_type:q.JSONLData,x:h+80,y:v+30});if(!w)throw new Error("Failed to save databaseSource node");await n({source:w.id,target:m.id})}return{vectorDatabase:f,vectorDatabaseNode:m}}finally{a(!1)}},[e,r,n]);return{loading:t,createVectorDatabase:i}},Rn=[Bm.Memory],Tn=[na.DatabaseNode],a_=["TokenTextSplitter","CharacterTextSplitter","RecursiveCharacterTextSplitter"],n_=b.memo(e=>{const{t}=De("components"),{id:a}=e,r=_t(a),{toast:n}=It(),[i,s]=b.useState(""),[o,c]=b.useState(Rn[0]),[l,u]=b.useState(Tn[0]),[p,h]=b.useState({}),{loading:v,createVectorDatabase:f}=r_(),m=b.useCallback($=>{c($)},[]),g=b.useCallback($=>{u($)},[]),w=b.useCallback($=>{h(N=>({...N,type:$,chunkSize:500,chunkOverlap:40}))},[]),E=b.useCallback($=>{s($.target.value||"")},[]),O=b.useCallback($=>{h(N=>({...N,chunkSize:Number($.target.value)}))},[]),x=b.useCallback($=>{h(N=>({...N,chunkOverlap:Number($.target.value)}))},[]),k=async()=>{try{if(!r)return;await f(r,{name:i,provider:o,storage:l},p!=null&&p.type?{type:p.type,chunkSize:p.chunkSize||500,chunkOverlap:p.chunkOverlap||0}:void 0),s(""),h({})}catch{n({variant:"destructive",description:t("create_vector_database_card.errors.create_failed")})}};return d.jsxs(st,{className:"mw-full",children:[d.jsx(Et,{children:d.jsx(Pt,{children:t("create_vector_database_card.title")})}),d.jsx(St,{children:d.jsxs("div",{className:"grid w-full gap-1.5",children:[d.jsx(Se,{children:t("create_vector_database_card.name")}),d.jsx(ft,{className:"mb-4",value:i,onChange:E}),(Tn==null?void 0:Tn.length)>1?d.jsxs(d.Fragment,{children:[d.jsx(Se,{children:t("create_vector_database_card.storage_type")}),d.jsxs(jr,{value:l,onValueChange:g,children:[d.jsx(Er,{className:"w-full mb-4",children:d.jsx(Sr,{placeholder:t("create_vector_database_card.provider_select_placeholder")})}),d.jsx(kr,{children:Object.values(Tn).map($=>d.jsx(Nt,{value:$,children:t(`create_vector_database_card.storage_types.${$.toLowerCase()}`)},$))})]})]}):void 0,(Rn==null?void 0:Rn.length)>1?d.jsxs(d.Fragment,{children:[d.jsx(Se,{children:t("create_vector_database_card.provider")}),d.jsxs(jr,{value:o,onValueChange:m,children:[d.jsx(Er,{className:"w-full mb-4",children:d.jsx(Sr,{placeholder:t("create_vector_database_card.provider_select_placeholder")})}),d.jsx(kr,{children:Object.values(Rn).map($=>d.jsx(Nt,{value:$,children:t(`create_vector_database_card.providers.${$.toLowerCase()}`)},$))})]})]}):void 0,d.jsx(Se,{children:t("create_vector_database_card.text_splitter")}),d.jsxs(jr,{value:p.type,onValueChange:w,children:[d.jsx(Er,{className:"w-full mb-4",children:d.jsx(Sr,{placeholder:t("create_vector_database_card.text_splitter_select_placeholder")})}),d.jsx(kr,{children:Object.values(a_).map($=>d.jsx(Nt,{value:$,children:t(`create_vector_database_card.text_splitters.${$.toLowerCase()}`)},$))})]}),p.type?d.jsxs(st,{children:[d.jsx(Et,{children:d.jsx(Pt,{children:t("create_vector_database_card.text_splitter_configuration")})}),d.jsxs(St,{children:[d.jsx(Se,{children:t("create_vector_database_card.text_splitter_chunksize")}),d.jsx(ft,{value:p.chunkSize,onChange:O,placeholder:t("create_vector_database_card.text_splitter_chunksize_placeholder")}),d.jsx(Se,{children:t("create_vector_database_card.text_splitter_chunkoverlap")}),d.jsx(ft,{value:p.chunkOverlap,onChange:x,placeholder:t("create_vector_database_card.text_splitter_chunkoverlap_placeholder")})]})]}):void 0]})}),d.jsx(ra,{className:"flex justify-between",children:d.jsx(er,{disabled:!p.type||!i,loading:v,onClick:k,className:"w-full",children:t("create_vector_database_card.create")})})]})});function s_({data:e}){const{t}=De("components");return d.jsxs(Rm,{className:"w-full",children:[d.jsx(Tm,{children:d.jsx(ni,{children:d.jsx(Wc,{children:t("add_text_data.text")})})}),d.jsx(Im,{children:e==null?void 0:e.map((a,r)=>d.jsx(ni,{children:d.jsx(Kc,{className:"p-4",children:a.text})},`${a.text}_${r}`))})]})}const i_=b.memo(e=>{const{id:t}=e,{t:a}=De("components"),[r,n]=b.useState([]),[i,s]=b.useState(""),o=_t(t),{createCSVData:c,loading:l}=Nl(),u=()=>{n(h=>[...h,{text:i}]),s("")},p=async()=>{o&&await c(o,["text"],r.map(h=>[h.text]))};return d.jsxs(st,{className:"mw-full",children:[d.jsx(Et,{children:d.jsx(Pt,{children:a("add_text_data.title")})}),d.jsxs(St,{children:[d.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[d.jsx(Se,{htmlFor:"name",children:a("add_text_data.text")}),d.jsx(ka,{value:i,onChange:h=>s(h.target.value||""),placeholder:a("add_text_data.text_placeholder")})]}),d.jsx("div",{className:"w-full flex mt-4 justify-end",children:d.jsx(tt,{disabled:!i,onClick:u,className:"w-40",children:a("add_text_data.add")})}),d.jsx(s_,{data:r||[]})]}),d.jsx(ra,{className:"flex justify-between",children:d.jsx(er,{loading:l,disabled:!(r!=null&&r.length),onClick:p,className:"w-full",children:a("add_text_data.create")})})]})});var ir=(e=>(e.ADD_LLM="ADD_LLM",e.ADD_PROMPT="ADD_PROMPT",e.ADD_TOOL_DEFINITION="ADD_TOOL_DEFINITION",e.ADD_SCHEMA="ADD_SCHEMA",e.ADD_FEW_SHOT_EXAMPLE="ADD_FEW_SHOT_EXAMPLE",e.ADD_VECTOR_DATABASE="ADD_VECTOR_DATABASE",e.ADD_TEXT_DATA="ADD_TEXT_DATA",e.ADD_MCP="ADD_MCP",e.ADD_BASIC_AGENT="ADD_BASIC_AGENT",e))(ir||{});const o_=["ADD_LLM","ADD_PROMPT","ADD_SCHEMA","ADD_VECTOR_DATABASE","ADD_BASIC_AGENT",{key:"more",label:"more",icon:"ellipsis",children:["ADD_TOOL_DEFINITION","ADD_MCP","ADD_FEW_SHOT_EXAMPLE"]}],c_=()=>{const e="_coolMode_effect",t=document.getElementById(e);if(t)return t;const a=document.createElement("div");return a.setAttribute("id",e),a.setAttribute("style","overflow:hidden; position:fixed; height:100%; top:0; left:0; right:0; bottom:0; pointer-events:none; z-index:2147483647"),document.body.appendChild(a),a};let $l=0;const d_=(e,t)=>{$l++;const a=(t==null?void 0:t.particle)||"circle",r=[15,20,25,35,45],n=45;let i=[],s=!1,o=0,c=0;const l=c_();function u(){const N=(t==null?void 0:t.size)||r[Math.floor(Math.random()*r.length)],M=(t==null?void 0:t.speedHorz)||Math.random()*10,A=(t==null?void 0:t.speedUp)||Math.random()*25,I=Math.random()*360,R=Math.random()*35*(Math.random()<=.5?-1:1),z=c-N/2,F=o-N/2,U=Math.random()<=.5?-1:1,V=document.createElement("div");if(a==="circle"){const re="http://www.w3.org/2000/svg",Q=document.createElementNS(re,"svg"),oe=document.createElementNS(re,"circle");oe.setAttributeNS(null,"cx",(N/2).toString()),oe.setAttributeNS(null,"cy",(N/2).toString()),oe.setAttributeNS(null,"r",(N/2).toString()),oe.setAttributeNS(null,"fill",`hsl(${Math.random()*360}, 70%, 50%)`),Q.appendChild(oe),Q.setAttribute("width",N.toString()),Q.setAttribute("height",N.toString()),V.appendChild(Q)}else V.innerHTML=`<img src="${a}" width="${N}" height="${N}" style="border-radius: 50%">`;V.style.position="absolute",V.style.transform=`translate3d(${F}px, ${z}px, 0px) rotate(${I}deg)`,l.appendChild(V),i.push({direction:U,element:V,left:F,size:N,speedHorz:M,speedUp:A,spinSpeed:R,spinVal:I,top:z})}function p(){i.forEach(N=>{N.left=N.left-N.speedHorz*N.direction,N.top=N.top-N.speedUp,N.speedUp=Math.min(N.size,N.speedUp-1),N.spinVal=N.spinVal+N.spinSpeed,N.top>=Math.max(window.innerHeight,document.body.clientHeight)+N.size&&(i=i.filter(M=>M!==N),N.element.remove()),N.element.setAttribute("style",["position:absolute","will-change:transform",`top:${N.top}px`,`left:${N.left}px`,`transform:rotate(${N.spinVal}deg)`].join(";"))})}let h,v=0;const f=30;function m(){const N=performance.now();s&&i.length<n&&N-v>f&&(u(),v=N),p(),h=requestAnimationFrame(m)}m();const g="ontouchstart"in window,w=g?"touchstart":"mousedown",E=g?"touchend":"mouseup",O=g?"touchmove":"mousemove",x=N=>{var M,A;"touches"in N?(o=(M=N.touches)==null?void 0:M[0].clientX,c=(A=N.touches)==null?void 0:A[0].clientY):(o=N.clientX,c=N.clientY)},k=N=>{x(N),s=!0},$=()=>{s=!1};return e.addEventListener(O,x,{passive:!0}),e.addEventListener(w,k,{passive:!0}),e.addEventListener(E,$,{passive:!0}),e.addEventListener("mouseleave",$,{passive:!0}),()=>{e.removeEventListener(O,x),e.removeEventListener(w,k),e.removeEventListener(E,$),e.removeEventListener("mouseleave",$);const N=setInterval(()=>{h&&i.length===0&&(cancelAnimationFrame(h),clearInterval(N),--$l===0&&l.remove())},500)}},l_=({children:e,options:t})=>{const a=b.useRef(null);return b.useEffect(()=>{if(a.current)return d_(a.current,t)},[t]),Qn.cloneElement(e,{ref:a})},u_=b.memo(({loading:e,onSubmit:t})=>{const[a,r]=b.useState(""),[n,i]=b.useState(""),{t:s}=De("components"),o=async()=>{await t({key:a,url:n})&&(r(""),i(""))};return d.jsxs("div",{children:[d.jsxs("div",{className:"grid w-full gap-1.5",children:[d.jsx(Se,{className:"mb-2",children:s("add_mcp_card.key")}),d.jsx(ft,{disabled:e,value:a||"",onChange:c=>r(c.target.value||""),className:"!text-foreground"}),d.jsx(Se,{className:"mb-2",children:s("add_mcp_card.url")}),d.jsx(ft,{disabled:e,value:n||"",onChange:c=>i(c.target.value||""),className:"!text-foreground"})]}),d.jsx("div",{children:d.jsx(er,{loading:e,disabled:!(a!=null&&a.length)||!(n!=null&&n.length),onClick:o,className:"w-full mt-4",children:s("add_mcp_card.button")})})]})}),h_=()=>{const e=ut(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,a]=b.useState(!1),r=ye(i=>i.createOrUpdateFlowNode),n=b.useCallback(async(i,s)=>{var o,c,l;try{if(!i||!e)throw new Error("Source or Session not found");if(!s.key||!s.url)throw new Error("MCP data is missing");a(!0);const u=((o=i.position)==null?void 0:o.x)||0,p=(((c=i.position)==null?void 0:c.y)||0)+(((l=i.measured)==null?void 0:l.height)||0),h=await me("Mcp").save({key:s.key,url:s.url,session_id:e});if(!h)throw new Error("Failed to save MCP");if(!await r({source_id:h.id,source_type:"Mcp",node_type:q.MCP,x:u,y:p+20}))throw new Error("Failed to save MCP node")}finally{a(!1)}},[e,r]);return{loading:t,createMcp:n}},p_=b.memo(e=>{const{id:t,setDialog:a}=e,{t:r}=De("components"),{toast:n}=It(),i=_t(t),{createMcp:s,loading:o}=h_(),c=async l=>{if(i)try{if(!(l!=null&&l.url)||!(l!=null&&l.key))throw new Error("MCP data is missing");await s(i,l),a==null||a(!1)}catch(u){n({variant:"destructive",title:`${u}`})}};return d.jsxs(st,{className:"mw-full",children:[d.jsx(Et,{children:d.jsx(Pt,{children:r("add_mcp_card.title")})}),d.jsxs(St,{className:"max-w-lg nodrag nowheel",children:[d.jsx(u_,{onSubmit:c,loading:o}),d.jsx(af,{className:"mt-4 mb-2"}),d.jsx(Se,{className:"text-lg",children:r("add_mcp_card.faq")}),d.jsx(af,{className:"mb-4 mt-2"}),d.jsx(Xn,{asChild:!0,className:"group/collapsible",children:d.jsxs("div",{children:[d.jsx(Yn,{asChild:!0,children:d.jsxs("div",{className:"flex justify-between py-2",children:[d.jsx("div",{children:d.jsx(Se,{children:r("add_mcp_card.note.title")})}),d.jsx("div",{children:d.jsx(we,{name:"chevron-down",className:"h-4 w-4"})})]})}),d.jsx(es,{children:d.jsx(nn,{source:r("add_mcp_card.note.detail")})})]})}),d.jsx(Xn,{asChild:!0,className:"group/collapsible",children:d.jsxs("div",{children:[d.jsx(Yn,{asChild:!0,children:d.jsxs("div",{className:"flex justify-between py-2",children:[d.jsx("div",{children:d.jsx(Se,{children:r("add_mcp_card.filesystem.title")})}),d.jsx("div",{children:d.jsx(we,{name:"chevron-down",className:"h-4 w-4"})})]})}),d.jsx(es,{children:d.jsx(nn,{source:r("add_mcp_card.filesystem.detail")})})]})}),d.jsx(Xn,{asChild:!0,className:"group/collapsible",children:d.jsxs("div",{children:[d.jsx(Yn,{asChild:!0,children:d.jsxs("div",{className:"flex justify-between py-2",children:[d.jsx("div",{children:d.jsx(Se,{children:r("add_mcp_card.memory.title")})}),d.jsx("div",{children:d.jsx(we,{name:"chevron-down",className:"h-4 w-4"})})]})}),d.jsx(es,{children:d.jsx(nn,{source:r("add_mcp_card.memory.detail")})})]})}),d.jsx(Xn,{asChild:!0,className:"group/collapsible",children:d.jsxs("div",{children:[d.jsx(Yn,{asChild:!0,children:d.jsxs("div",{className:"flex justify-between py-2",children:[d.jsx("div",{children:d.jsx(Se,{children:r("add_mcp_card.playwright.title")})}),d.jsx("div",{children:d.jsx(we,{name:"chevron-down",className:"h-4 w-4"})})]})}),d.jsx(es,{children:d.jsx(nn,{source:r("add_mcp_card.playwright.detail")})})]})}),d.jsx(Xn,{asChild:!0,className:"group/collapsible",children:d.jsxs("div",{children:[d.jsx(Yn,{asChild:!0,children:d.jsxs("div",{className:"flex justify-between py-2",children:[d.jsx("div",{children:d.jsx(Se,{children:r("add_mcp_card.figma.title")})}),d.jsx("div",{children:d.jsx(we,{name:"chevron-down",className:"h-4 w-4"})})]})}),d.jsx(es,{children:d.jsx(nn,{source:r("add_mcp_card.figma.detail")})})]})})]})]})}),m_=()=>{const e=ut(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,a]=b.useState(!1),r=ye(i=>i.createOrUpdateFlowNode),n=b.useCallback(async(i,s)=>{var o,c,l;try{if(!i||!e)throw new Error("Source or Session not found");if(!s.name.trim())throw new Error("Name is required");a(!0);const u=((o=i.position)==null?void 0:o.x)||0,p=(((c=i.position)==null?void 0:c.y)||0)+(((l=i.measured)==null?void 0:l.height)||0),h=await me("BasicAgent").save({name:s.name.trim(),description:s.description.trim(),system_prompt:s.system_prompt.trim(),max_iterations:s.max_iterations||10,session_id:e});if(!h)throw new Error("Failed to save basic agent");if(!await r({source_id:h.id,source_type:"BasicAgent",node_type:q.BasicAgent,x:u,y:p+20}))throw new Error("Failed to save basic agent node");return h}finally{a(!1)}},[e,r]);return{loading:t,createBasicAgent:n}},Rl=`You are helpful agents.
Use tools to solve user requirement.`,f_=b.memo(({loading:e,onSubmit:t})=>{const[a,r]=b.useState(""),[n,i]=b.useState(""),[s,o]=b.useState(Rl),[c,l]=b.useState(10),{t:u}=De("components"),p=b.useCallback(g=>{r(g.target.value)},[]),h=b.useCallback(g=>{i(g.target.value)},[]),v=b.useCallback(g=>{o(g.target.value)},[]),f=b.useCallback(g=>{const w=parseInt(g.target.value,10);!isNaN(w)&&w>0&&l(w)},[]),m=async()=>{a.trim()&&await t({name:a,description:n,system_prompt:s,max_iterations:c})&&(r(""),i(""),o(Rl),l(10))};return d.jsxs("div",{children:[d.jsxs("div",{className:"grid w-full gap-4",children:[d.jsxs("div",{className:"grid gap-1.5",children:[d.jsxs(Se,{htmlFor:"name",children:[u("add_basic_agent_card.name")," *"]}),d.jsx(ft,{id:"name",value:a,onChange:p,placeholder:u("add_basic_agent_card.name_placeholder"),required:!0})]}),d.jsxs("div",{className:"grid gap-1.5",children:[d.jsx(Se,{htmlFor:"description",children:u("add_basic_agent_card.description")}),d.jsx(ka,{id:"description",value:n,onChange:h,placeholder:u("add_basic_agent_card.description_placeholder"),className:"h-20"})]}),d.jsxs("div",{className:"grid gap-1.5",children:[d.jsx(Se,{htmlFor:"system_prompt",children:u("add_basic_agent_card.system_prompt")}),d.jsx(ka,{id:"system_prompt",value:s,onChange:v,placeholder:u("add_basic_agent_card.system_prompt_placeholder"),className:"h-32"})]}),d.jsxs("div",{className:"grid gap-1.5",children:[d.jsx(Se,{htmlFor:"max_iterations",children:u("add_basic_agent_card.max_iterations")}),d.jsx(ft,{id:"max_iterations",type:"number",min:"1",value:c,onChange:f,placeholder:"10"})]})]}),d.jsx("div",{children:d.jsx(er,{loading:e,disabled:!a.trim(),onClick:m,className:"w-full mt-4",children:u("add_basic_agent_card.button")})})]})}),v_=b.memo(e=>{const{id:t,setDialog:a}=e,{t:r}=De("components"),{toast:n}=It(),i=_t(t),{createBasicAgent:s,loading:o}=m_(),c=async l=>{var u;if(i)try{if(!((u=l==null?void 0:l.name)!=null&&u.trim()))throw new Error("Agent name is required");await s(i,{name:l.name,description:l.description,system_prompt:l.system_prompt,max_iterations:l.max_iterations}),a==null||a(!1)}catch(p){n({variant:"destructive",title:`${p}`})}};return d.jsxs(st,{className:"mw-full",children:[d.jsx(Et,{children:d.jsx(Pt,{children:r("add_basic_agent_card.title")})}),d.jsx(St,{children:d.jsx(f_,{onSubmit:c,loading:o})})]})}),g_=b.memo(e=>{const{t}=De("flows"),a=Sm(o=>o.theme),[r,n]=b.useState(`${ir.ADD_LLM}`),i=b.useMemo(()=>d.jsxs(hl,{children:[d.jsx(Li,{children:d.jsx(l_,{children:d.jsx(tt,{variant:"link",className:"!p-0 !pl-3",children:d.jsx(Hj,{width:32,height:32,className:Ve(a==="dark"?"fill-white":"fill-black")})})})}),o_.map(o=>typeof o=="object"?d.jsxs(Li,{children:[d.jsx(Mi,{children:o.icon?d.jsx(we,{name:o.icon}):t(`supported_nodes.${o.label}`)}),d.jsx(pl,{children:o.children.map(c=>d.jsx(ml,{onClick:()=>n(c),children:t(`supported_nodes.${c.toLowerCase()}`)},c))})]},o.key):d.jsx(Li,{children:d.jsx(Mi,{value:o,onClick:()=>n(o),children:t(`supported_nodes.${o.toLowerCase()}`)})},o))]}),[t,a]),s=b.useMemo(()=>{switch(r){case ir.ADD_LLM:return d.jsx(Vy,{...e});case ir.ADD_PROMPT:return d.jsx(Ky,{...e});case ir.ADD_SCHEMA:return d.jsx(Qy,{...e});case ir.ADD_FEW_SHOT_EXAMPLE:return d.jsx(Xy,{...e});case ir.ADD_TOOL_DEFINITION:return d.jsx(t_,{...e});case ir.ADD_VECTOR_DATABASE:return d.jsx(n_,{...e});case ir.ADD_TEXT_DATA:return d.jsx(i_,{...e});case ir.ADD_MCP:return d.jsx(p_,{...e});case ir.ADD_BASIC_AGENT:return d.jsx(v_,{...e})}},[e,r]);return d.jsxs(d.Fragment,{children:[i,d.jsx("div",{className:"mt-4",children:s})]})}),Tl=60,Il=140,y_=Cm("supports-backdrop-blur:bg-white/10 supports-backdrop-blur:dark:bg-black/10 mx-auto flex h-[58px] w-max gap-2 rounded-lg border p-2 backdrop-blur-md"),Ll=Qn.forwardRef(({className:e,children:t,magnification:a=Tl,distance:r=Il,direction:n="bottom",...i},s)=>{const o=Or(1/0),c=()=>Qn.Children.map(t,l=>Qn.isValidElement(l)&&l.type===ks?Qn.cloneElement(l,{...l.props,mouseX:o,magnification:a,distance:r}):l);return d.jsx(km.div,{ref:s,onMouseMove:l=>o.set(l.pageX),onMouseLeave:()=>o.set(1/0),...i,className:Ve(y_({className:e}),{"items-start":n==="top","items-center":n==="middle","items-end":n==="bottom"}),children:c()})});Ll.displayName="Dock";const ks=({magnification:e=Tl,distance:t=Il,mouseX:a,className:r,children:n,...i})=>{const s=b.useRef(null),o=pd(a||new qj(0),u=>{var h;const p=((h=s.current)==null?void 0:h.getBoundingClientRect())??{x:0,width:0};return u-p.x-p.width/2}),c=pd(o,[-t,0,t],[40,e,40]),l=Ca(c,{mass:.1,stiffness:150,damping:12});return d.jsx(km.div,{ref:s,style:{width:l},className:Ve("flex aspect-square cursor-pointer items-center justify-center rounded-full",r),...i,children:n})};ks.displayName="DockIcon";const __={[q.Shape]:{width:100,height:100},[q.CircleShape]:{width:100,height:100},[q.TriangleShape]:{width:100,height:100},[q.EditorApp]:{width:1240,height:400}},b_=e=>{const t=_t(e),a=ut(o=>o.currentSession),[r,n]=b.useState(!1),i=ye(o=>o.createOrUpdateFlowNode),s=b.useCallback(async o=>{var c,l,u;try{if(n(!0),t&&(a==null?void 0:a.id)){const p=((c=t.position)==null?void 0:c.x)||0,h=(((l=t.position)==null?void 0:l.y)||0)+(((u=t.measured)==null?void 0:u.height)||0),v=await me("FlowNodeData").save({data:{},session_id:a.id});if(!v)throw new Error("Failed to save node data");if(!await i({node_type:o,data:{},source_id:v.id,source_type:"FlowNodeData",x:p,y:h+20,...__[o]||{}}))throw new Error("Failed to save node")}}finally{n(!1)}},[i,a==null?void 0:a.id,t]);return{loading:r,createNode:s}},Ml={applications:[{key:q.EditorApp,image:NS,label:"application_bar.editor"},{key:q.VSLiteApp,icon:OS,label:"application_bar.vslite"}],shapes:[{key:q.Shape,icon:"square",label:"application_bar.square"},{key:q.CircleShape,icon:"circle",label:"application_bar.circle"},{key:q.TriangleShape,icon:"triangle",label:"application_bar.triangle"}]},w_=b.memo(e=>{const{t}=De("flows"),{toast:a}=It(),{loading:r,createNode:n}=b_(e.id),i=async s=>{try{if(r)return;await n(s)}catch{a({description:t("application_bar.errors.add_node_failed"),variant:"destructive"})}};return d.jsx(iS,{children:d.jsxs(Ll,{direction:"middle",children:[Ml.applications.map(s=>{const o=s.icon;return d.jsx(ks,{children:d.jsxs(Wm,{children:[d.jsxs(Km,{children:[o?d.jsx(o,{width:20,height:20,onClick:()=>i(s.key)}):void 0,s.image?d.jsx("img",{src:s.image,alt:t(s.label),className:"w-8 h-8 rounded-md",onClick:()=>i(s.key)}):void 0]}),d.jsx(Jm,{children:d.jsx("p",{children:t(s.label)})})]})},s.label)}),d.jsx(Qm,{orientation:"vertical",className:"h-full"}),Ml.shapes.map(s=>d.jsx(ks,{children:d.jsxs(Wm,{children:[d.jsx(Km,{children:d.jsx(we,{onClick:()=>i(s.key),name:s.icon})}),d.jsx(Jm,{children:d.jsx("p",{children:t(s.label)})})]})},s.label))]})})}),Je=b.memo(e=>{const{className:t,...a}=e;return d.jsx(rE,{className:Ve("!w-2 !h-2 !border-none !rounded-full !bg-slate-700",e.position===Ke.Top?"!top-[-2px]":"",t),...a})}),x_=b.memo(e=>{var p,h;const[t,a]=b.useState(!1),[r,n]=b.useState({}),[i,s]=b.useState({}),{confirmPassphrase:o}=Sa(),{t:c}=De("atoms"),l=async()=>{var v;if(t)n({}),s({});else{if((v=Object.keys(e.encrypted||{}))!=null&&v.length){await o();const f={},m=await hi.get("passphrase");if(!m)throw new Error("Passphrase is not found");await Promise.all(Object.keys(e.encrypted||{}).map(async g=>{var w,E;(w=e.encrypted)!=null&&w[g]&&(f[g]=await bS((E=e.encrypted)==null?void 0:E[g],m))})),s(f||{})}n({...e.options})}a(!t)},u=()=>{var v;(v=e.onChangeOptions)==null||v.call(e,r||{},i||{}),a(!1)};return d.jsx("div",{className:Ve("min-w-20 flex justify-end",e.className),children:d.jsxs(yi,{open:t,onOpenChange:a,children:[d.jsx(xS,{children:d.jsx("div",{className:"flex justify-end gap-2 !cursor-pointer",children:d.jsxs(tt,{onClick:l,variant:"link",className:"flex items-center px-0 !cursor-pointer",children:[d.jsx(we,{name:"settings"}),d.jsx(Se,{children:c("embedding_setting.title")})]})})}),d.jsx(_i,{className:"w-full p-0",children:t?d.jsxs(st,{className:"!border-none max-w-96 min-w-56",children:[d.jsx(Et,{children:d.jsx(Pt,{children:c("embedding_setting.title")})}),d.jsxs(St,{children:[d.jsxs(Se,{children:[c("embedding_setting.provider"),":"]}),d.jsxs(jr,{value:r!=null&&r.provider?`${r==null?void 0:r.provider}`:"local_transformers",onValueChange:v=>n({provider:v}),children:[d.jsx(Er,{className:"",children:d.jsx(Sr,{placeholder:c("embedding_setting.provider_placeholder")})}),d.jsxs(kr,{children:[d.jsx(Nt,{value:"local_transformers",children:c("embedding_setting.providers.local_transformers")},"local_transformers"),(p=e.supportedProviders)==null?void 0:p.map(v=>d.jsx(Nt,{value:v,children:c(`embedding_setting.providers.${v.toLowerCase()}`)},v))]})]}),(h=e.supportedProviders)!=null&&h.length?void 0:d.jsx(Se,{className:"text-red-500 !pt-2",children:c("embedding_setting.alerts.no_provider")}),d.jsx(d.Fragment,{children:r.provider&&r.provider!=="local_transformers"?d.jsxs(d.Fragment,{children:[d.jsx(Ut,{variant:"destructive",className:"mt-4",children:c("embedding_setting.alerts.session_passkey")}),d.jsxs("div",{className:"mt-4",children:[d.jsx(Se,{children:c("embedding_setting.encrypted_fields.api_key")}),d.jsx(tt,{variant:"link",className:"px-1",children:d.jsxs("a",{href:r.provider===Le.OpenAI?Es:js,target:"_blank",rel:"noreferrer",children:["(",r.provider===Le.OpenAI?Es:js,")"]})}),d.jsx(ft,{type:"password",value:i!=null&&i.key?`${i==null?void 0:i.key}`:"",onChange:v=>s(f=>({...f,key:v.target.value}))})]})]}):void 0})]}),d.jsx(ra,{className:"flex justify-end",children:d.jsx(tt,{variant:"secondary",onClick:u,children:c("embedding_setting.save")})})]}):void 0})]})})}),Ct=(e,t)=>{const[a,r]=b.useState(!1),[n,i]=b.useState([]),{deleteElements:s,getNode:o}=Yt();ii({type:"target",nodeId:e,onConnect:l=>{l!=null&&l.length&&i(u=>[...u,...aE(l)])}});const c=b.useCallback(async(l,u,p,h)=>{try{return await t({id:e,edgeId:l,source:u,target:p,connection:h})}catch{return{deleteEdgeId:l}}},[t,e]);b.useEffect(()=>{!(n!=null&&n.length)||a||(async()=>{try{r(!0);const l=[...n];i([]);const u=[],p=o(e);await Promise.all(l.map(async h=>{const v="edgeId"in h?h.edgeId:void 0,f=o(h.source);if(!f||!p)return;const m=await c(`${v}`,f,p,h);m!=null&&m.deleteEdgeId&&u.push(...Array.isArray(m.deleteEdgeId)?m.deleteEdgeId:[m.deleteEdgeId])})),u!=null&&u.length&&await s({edges:u.map(h=>({id:h}))})}finally{r(!1)}})()},[s,o,e,a,c,n])},j_=e=>{const t=b.useCallback(async({edgeId:a})=>({deleteEdgeId:a}),[]);Ct(e,t)},E_=e=>{const t=ut(o=>{var c;return(c=o.currentSession)==null?void 0:c.id}),a=_t(e),r=Lm(),n=ye(o=>o.updateNodes),{confirmOrCreatePassphrase:i}=kl(),s=b.useCallback(async(o,c)=>{var l;if(a&&t){let u=e!==oi.DEFAULT_EMBEDDING_MODEL?await me("FlowNode").findOne({where:{id:e}}):void 0;const p={};if((l=Object.keys(c||{}))!=null&&l.length){await i();const f=await hi.get("passphrase");if(!f)throw new Error("Passphrase is not found");await Promise.all(Object.keys(c||{}).map(async m=>{c!=null&&c[m]&&(p[m]=await tf(c[m],f))}))}let h;const v=[];u?(await me("FlowNodePlaceholder").update(u.source_id,{encrypted:p,data:o}),h=await me("FlowNodePlaceholder").findOne({where:{id:u.source_id}}),v.push({id:u.id,type:"replace",item:a})):(v.push({id:e,type:"remove"}),h=await me("FlowNodePlaceholder").save({placeholder_type:sn.DEFAULT_EMBEDDING_MODEL,encrypted:p,data:o,session_id:t}),u=await me("FlowNode").save({node_type:q.DefaultEmbeddingModel,session_id:t,source_type:"FlowNodePlaceholder",source_id:h.id,x:a.position.x,y:a.position.y}),v.push({type:"add",item:a})),a.data.entity=h,a.data.flowNode=u,n(v)}},[i,t,e,a,n]);return b.useEffect(()=>{e===oi.DEFAULT_EMBEDDING_MODEL&&r.find(o=>o.type===q.DefaultEmbeddingModel&&o.id!==oi.DEFAULT_EMBEDDING_MODEL)&&n([{id:e,type:"remove"}])},[e,r,n]),{changeLLMOptions:s}},S_=b.memo(e=>{var o,c,l,u;const{id:t,data:a,isConnectable:r}=e,{changeLLMOptions:n}=E_(t);j_(t);let i="brain",s=oS;switch(`${(c=(o=a==null?void 0:a.entity)==null?void 0:o.data)==null?void 0:c.provider}`){case Le.OpenAI:i="gpt",s="text-embedding-3-small";break;case Le.GoogleGenerativeAI:i="gemma",s="text-embedding-004";break}return d.jsxs("div",{children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsx("div",{children:d.jsxs(Ut,{className:"flex justify-center max-w-auto",variant:"default",children:[d.jsx(zr,{name:i,className:"w-7 h-7"}),d.jsxs("div",{className:"ml-2 pr-4 flex justify-center gap-1 flex-col",children:[d.jsx("div",{className:"min-h-8 flex items-center",children:d.jsx(Nr,{children:`${s||""}`})}),d.jsx(x_,{supportedProviders:[Le.OpenAI,Le.GoogleGenerativeAI],onChangeOptions:n,encrypted:(l=a.entity)==null?void 0:l.encrypted,options:(u=a.entity)==null?void 0:u.data})]})]})}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})}),Dl=e=>{const t=["Bytes","KB","MB","GB","TB"];if(e===void 0)return"Unknown size";if(e===0)return"0 Byte";const a=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,a))} ${t[a]}`},k_=b.memo(()=>{const{t:e}=De("flows"),[t,a]=b.useState(),r=Gn(h=>h.cachedLLMURLs),n=ut(h=>h.currentSession),[i,s]=b.useState(),[o,c]=b.useState(""),[,l]=b.useState();b.useEffect(()=>{Lt(async()=>{const{functionCallingModelIds:h,prebuiltAppConfig:v}=await import("./index-CpUNJZhr.js").then(async f=>(await f.__tla,f));return{functionCallingModelIds:h,prebuiltAppConfig:v}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({functionCallingModelIds:h,prebuiltAppConfig:v})=>{a(r==null?void 0:r.map(f=>{const m=v.model_list.find(g=>f.includes(g.model));if(m)return{model_id:(m==null?void 0:m.model_id)||"",info:m,isFunctionCalling:h.includes((m==null?void 0:m.model_id)||"")}}))})},[r,n==null?void 0:n.id]);const u=b.useCallback(async()=>{navigator.storage.estimate().then(h=>{h&&c(e("session_info_node.used_bytes",{used:Dl(h.usage),total:Dl(h==null?void 0:h.quota)}))}),n!=null&&n.id&&(Promise.all([me("FlowNode").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("FlowEdge").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("Thread").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("Prompt").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("LLM").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("Schema").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("ToolDefinition").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("VectorDatabase").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("JSONLData").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),me("CSVData").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}})]).then(h=>{const v=h.reduce((f,m)=>m!=null&&m.updated_at&&(!f||new Date(m.updated_at)>f)?new Date(m.updated_at):f,n.updated_at?new Date(n.updated_at):void 0);s(v)}),Promise.all([me("FlowNode").count({where:{session_id:n==null?void 0:n.id}}),me("FlowEdge").count({where:{session_id:n==null?void 0:n.id}}),me("Thread").count({where:{session_id:n==null?void 0:n.id}}),me("Prompt").count({where:{session_id:n==null?void 0:n.id}}),me("LLM").count({where:{session_id:n==null?void 0:n.id}}),me("ToolDefinition").count({where:{session_id:n==null?void 0:n.id}}),me("Schema").count({where:{session_id:n==null?void 0:n.id}}),me("VectorDatabase").count({where:{session_id:n==null?void 0:n.id}}),me("JSONLData").count({where:{session_id:n==null?void 0:n.id}}),me("CSVData").count({where:{session_id:n==null?void 0:n.id}})]).then(([h,v,f,m,g,w,E,O,x,k])=>{l([{name:e("session_info_node.count_info.title"),nodes:h||0,edges:v||0,threads:f||0,prompts:m||0,llms:g||0,tools:w||0,schemas:E||0,vectorDatabases:O||0,jsonlDatas:x||0,csvDatas:k||0}])}))},[n==null?void 0:n.id,n==null?void 0:n.updated_at,e]),p=b.useCallback(()=>{u()},[u]);return b.useEffect(()=>{u()},[u]),d.jsxs(st,{className:"w-96",children:[d.jsxs(Et,{children:[d.jsx(Pt,{children:e("session_info_node.title")}),d.jsx(nE,{children:i||n!=null&&n.updated_at?Vj(i||(n==null?void 0:n.updated_at)).fromNow():""})]}),d.jsxs(St,{className:"grid gap-4",children:[d.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:d.jsxs("div",{className:"flex-1 space-y-1",children:[d.jsx("p",{className:"text-sm font-medium leading-none",children:e("session_info_node.disk_size")}),d.jsx("p",{className:"text-sm text-muted-foreground",children:o})]})}),d.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:d.jsxs("div",{className:"flex-1 space-y-1",children:[d.jsxs("div",{className:"text-sm font-medium leading-none",children:[e("session_info_node.cached_llms"),d.jsx(aa,{className:"ml-2",children:(t==null?void 0:t.length)||0})]}),t==null?void 0:t.map(h=>d.jsxs("div",{className:"text-sm text-muted-foreground gap-1",children:[h==null?void 0:h.model_id,d.jsx("div",{className:"max-w-full gap-1 flex flex-wrap mt-1",children:d.jsx(ai,{model:h==null?void 0:h.info,isFunctionCalling:(h==null?void 0:h.isFunctionCalling)||!1,isCached:!0,cloud:!1})})]},h==null?void 0:h.model_id))]})}),d.jsx("div",{})]}),d.jsx(ra,{children:d.jsxs(tt,{className:"w-full",onClick:p,children:[d.jsx(we,{size:24,name:"refresh-ccw"}),e("session_info_node.reload")]})})]})}),Bi=b.memo(({tags:e,disabled:t,loading:a,onSubmit:r})=>{const{t:n}=De("components"),i=async s=>{try{return await r(s),!0}catch{return!1}};return d.jsxs(st,{className:"min-w-80",children:[d.jsx(Et,{children:d.jsx(Pt,{children:n("add_message_card.title")})}),d.jsxs(St,{children:[d.jsx("div",{className:"grid w-full gap-1.5",children:d.jsx(jS,{onSubmit:i,disabled:t||a,placeholder:n("add_message_card.placeholder")})}),e?d.jsx("div",{className:"mt-2 gap-1 flex flex-wrap",children:e}):null]})]})}),C_=()=>{const[e,t]=b.useState(!1),a=cS(),r=ut(s=>s.currentSession),n=b.useCallback(async(s,o,c,l)=>{var h;const u=(h=o.data)==null?void 0:h.entity;let p=o.type?dS[o.type]:void 0;if(p&&u&&o&&typeof u=="object"&&"id"in u&&!c.has(`${u.id}`)&&!l.has(`${o.id}`)){p=p;const v=await me(p).save({...u,...u&&typeof u=="object"&&"session_id"in u?{session_id:s.id}:{}});c.set(`${u.id}`,v.id);const f=await me("FlowNode").findOne({where:{id:o.data.flowNode.id}}),m=await me("FlowNode").save({...f||o.data.flowNode,session_id:s.id,id:void 0,source_type:p,source_id:v.id});return l.set(`${o.id}`,m.id),{entityName:p,entity:v,node:m}}else if(!l.has(`${o.id}`)){const v=await me("FlowNode").findOne({where:{id:o.data.flowNode.id}}),f=await me("FlowNode").save({...v||o.data.flowNode,node_type:o.type,session_id:s.id,id:void 0});return l.set(`${o.id}`,f.id),{node:f}}},[]),i=b.useCallback(async(s,o)=>{try{if(!r)throw new Error("No current session");t(!0);const c=await me("Session").save({type:lS.StandaloneApp,name:o.name||(r!=null&&r.name?`${r.name}`:"Standalone"),status:uS.Started,passphrase:r.passphrase});if(!c)throw new Error("Failed create standalone session");const l=new Map,u=new Map,p=await n(c,s,l,u);if(!p)throw new Error("Failed to clone main node");await me("Session").update(c.id,{main_node_id:p.node.id,main_source_id:p!=null&&p.entity?p.entity.id:void 0,main_source_type:p.entityName?p.entityName:void 0});for(const{node:h,connectedNodes:v}of o.connections)if(await n(c,h,l,u),v)for(const f of v)await n(c,f,l,u);for(const{connections:h}of o.connections)for(const v of h){const f=u.get(`${v.source}`),m=u.get(`${v.target}`);if(!f||!m)throw new Error("Failed to get connected flow node id");await me("FlowEdge").save({source:f,target:m,sourceHandle:v.sourceHandle,targetHandle:v.targetHandle,session_id:c.id})}return a(hS("application",{applicationId:c.id})),!0}finally{t(!1)}},[n,r,a]);return{loading:e,createStandaloneSession:i}},P_=()=>{const[e,t]=b.useState(!1),a=ye(i=>i.updateNodes),r=ye(i=>i.updateEdges),n=b.useCallback(async i=>{try{t(!0),await me("FlowNode").delete(i);const s=await me("FlowEdge").find({where:[{source:i},{target:i}]});return await Promise.all(s.map(o=>me("FlowEdge").delete(o.id))),await a([{id:i,type:"remove"}]),await r(s.map(o=>({id:o.id,type:"remove"}))),!0}catch{return!1}finally{t(!1)}},[r,a]);return{loading:e,deleteNodeFlow:n}},N_=ri(({cloneStandaloneSession:e})=>{const t=ea(),{t:a}=De("dialogs"),[r,n]=b.useState(""),{toast:i}=It(),s=c=>{n(c.target.value)},o=async()=>{try{t.hide(),await e(r),n("")}catch{i({variant:"destructive",description:a("create_standalone_application.errors.create_failed")})}};return d.jsx(ci,{open:t.visible,onOpenChange:t.hide,children:d.jsxs(di,{className:"sm:max-w-[425px]",children:[d.jsxs(li,{children:[d.jsx(ui,{children:a("create_session.title")}),d.jsx(qm,{children:a("create_standalone_application.description")})]}),d.jsx("div",{className:"grid gap-4 py-4",children:d.jsxs("div",{className:"flex flex-col space-y-1.5",children:[d.jsx(Se,{className:"mb-2",htmlFor:"name",children:a("create_standalone_application.name")}),d.jsx(ft,{onChange:s,id:"name",value:r,placeholder:a("create_standalone_application.name_placeholder")})]})}),d.jsx(Vm,{children:d.jsx(tt,{onClick:o,disabled:!r,type:"submit",children:a("create_standalone_application.create")})})]})})}),xt=b.memo(({id:e,className:t,enableToStandalone:a,getLinkedConnections:r})=>{const{t:n}=De("common"),{getNode:i}=Yt(),{loading:s,deleteNodeFlow:o}=P_(),{createStandaloneSession:c}=C_(),{toast:l}=It(),u=ea(N_),p=b.useCallback(async()=>{try{await o(e),l({description:n("deleted")})}catch{l({description:n("errors.delete_failed"),variant:"destructive"})}},[o,e,l,n]),h=b.useCallback(async f=>{try{const m=i(e);if(!m)throw new Error("No current node");const g=(r==null?void 0:r(e))||[];await c(m,{name:f,connections:g}),l({description:n("standalone_session_created")})}catch(m){ta("Clone Standalone Session",m),l({description:n("errors.create_standalone_session_failed"),variant:"destructive"})}},[i,e,r,c,l,n]),v=b.useCallback(()=>{u.show({cloneStandaloneSession:h})},[h,u]);return d.jsxs("div",{className:Ve("flex absolute z-[51] right-0 top-0 h-10",t),children:[a?d.jsx(tt,{className:"!rounded-none !px-2",onClick:v,variant:"ghost",children:d.jsx(we,{name:"package-plus",size:16})}):void 0,d.jsx(er,{loading:s,className:"!rounded-none !px-2",onClick:p,variant:"ghost",children:d.jsx(we,{name:"trash-2",size:16})})]})});var Vr=(e=>(e.IDLE="idle",e.RUNNING="running",e.COMPLETED="completed",e.FAILED="failed",e.PAUSED="paused",e))(Vr||{}),Wt=(e=>(e.PENDING="pending",e.RUNNING="running",e.COMPLETED="completed",e.FAILED="failed",e.SKIPPED="skipped",e))(Wt||{});class Ma{validate(t){return!0}onBeforeExecute(t,a){return Promise.resolve()}onAfterExecute(t,a,r){return Promise.resolve()}onError(t,a,r){return Promise.resolve()}}class ha{constructor(t="database",a){Zt(this,"mode");Zt(this,"reactFlowInstance");this.mode=t,this.reactFlowInstance=a}static forDatabase(){return new ha("database")}static forSession(t){return new ha("session",t)}setMode(t,a){this.mode=t,t==="session"&&a&&(this.reactFlowInstance=a)}async getConnectedNodes(t,a){return this.mode==="database"?this.getConnectedNodesFromDatabase(t,a):this.getConnectedNodesFromSession(t)}async getConnectedNodesFromDatabase(t,a){const[r,n]=await Promise.all([me("FlowNode").find({where:{session_id:a}}),me("FlowEdge").find({where:{session_id:a}})]);return this.buildConnectedGraph(t,r,n)}getConnectedNodesFromSession(t){if(!this.reactFlowInstance)throw new Error("ReactFlow instance required for session mode");const{getNodes:a,getEdges:r}=this.reactFlowInstance,n=a(),i=r(),s=this.reactNodesToFlowNodes(n),o=this.reactEdgesToFlowEdges(i);return this.buildConnectedGraph(t,s,o)}async getAllSessionNodes(t){const[a,r]=await Promise.all([me("FlowNode").find({where:{session_id:t}}),me("FlowEdge").find({where:{session_id:t}})]);return{nodes:a,edges:r}}async queryNodes(t){if(this.mode!=="database")throw new Error("Advanced querying only available in database mode");return me("FlowNode").find(t)}async queryEdges(t){if(this.mode!=="database")throw new Error("Advanced querying only available in database mode");return me("FlowEdge").find(t)}buildConnectedGraph(t,a,r){const n=new Set,i=new Map,s=new Map,o=new Map;r.forEach(l=>{const u=o.get(l.target)||[];u.push(l),o.set(l.target,u)});const c=l=>{if(n.has(l))return;n.add(l);const u=a.find(h=>h.id===l);u&&i.set(l,u);const p=o.get(l)||[];for(const h of p)s.set(h.id,h),c(h.source)};return c(t),this.buildFlowGraph(Array.from(i.values()),Array.from(s.values()))}buildFlowGraph(t,a){const r={nodes:new Map,edges:new Map,adjacencyList:new Map,reverseAdjacencyList:new Map};return t.forEach(n=>{r.nodes.set(n.id,n),r.adjacencyList.set(n.id,[]),r.reverseAdjacencyList.set(n.id,[])}),a.forEach(n=>{r.edges.set(n.id,n);const i=r.adjacencyList.get(n.source)||[];i.push(n.target),r.adjacencyList.set(n.source,i);const s=r.reverseAdjacencyList.get(n.target)||[];s.push(n.source),r.reverseAdjacencyList.set(n.target,s)}),r}reactNodesToFlowNodes(t){return t.map(a=>{var s,o,c;const r=a.data,n=(o=(s=r==null?void 0:r.entity)==null?void 0:s.constructor)==null?void 0:o.name;let i;switch(a.type){case"ThreadNode":case"THREAD":i=q.Thread;break;case"LLMNode":case"LLM":i=q.LLM;break;case"PromptNode":case"PROMPT":i=q.Prompt;break;case"MessageNode":case"MESSAGE":i=q.Message;break;case"SchemaNode":case"SCHEMA":i=q.Schema;break;case"VectorDatabaseNode":case"VECTOR_DATABASE":i=q.VectorDatabase;break;case"PlaceholderNode":case"PLACEHOLDER":i=q.PlaceHolder;break;default:xr(`\u{1F504} [FlowDataService] Unknown node type: ${a.type}, defaulting to NewMessage`),i=q.NewMessage}return{id:a.id,node_type:i,data:a.data,x:a.position.x,y:a.position.y,width:a.width||0,height:a.height||0,session_id:"",source_type:n||"FlowNode",source_id:((c=r==null?void 0:r.entity)==null?void 0:c.id)||a.id,created_at:new Date,updated_at:new Date}})}reactEdgesToFlowEdges(t){return t.map(a=>({id:a.id,source:a.source,target:a.target,session_id:"",created_at:new Date,updated_at:new Date}))}}class Al{constructor(t){Zt(this,"nodeHandlers",new Map);Zt(this,"dataService");Zt(this,"currentFullGraph");Zt(this,"currentDirectGraph");Zt(this,"currentRunState");this.dataService=t||ha.forDatabase()}registerNodeHandler(t){this.nodeHandlers.set(t.nodeType,t)}async prepare(t,a){if(this.currentFullGraph=await this.dataService.getConnectedNodes(t),!this.currentFullGraph.nodes.has(t))throw new Error(`Target node not found in connected graph: ${t}`);this.currentDirectGraph=this.getDirectlyConnectedNodes(this.currentFullGraph,t);const r=`run_${Gm()}`;this.currentRunState=this.createRunState(r,this.currentDirectGraph,t),a&&Object.entries(a).forEach(([i,s])=>{this.currentRunState.sessionState.set(i,s)});const n=this.createExecutionContext(this.currentRunState);await this.runPreparePhase(this.currentRunState,this.currentDirectGraph,n)}async execute(){if(!this.currentRunState||!this.currentDirectGraph||!this.currentFullGraph)throw new Error("Must call prepare() before execute()");const t=this.createExecutionContext(this.currentRunState);this.currentRunState.status=Vr.RUNNING;try{this.currentRunState.status===Vr.RUNNING&&await this.runExecutePhase(this.currentRunState,this.currentDirectGraph,t),this.currentRunState.status===Vr.RUNNING&&(this.currentRunState.status=Vr.COMPLETED,this.currentRunState.endTime=new Date)}catch(a){this.currentRunState.status=Vr.FAILED,this.currentRunState.error=a,this.currentRunState.endTime=new Date}return this.currentRunState}getSessionState(t){if(!this.currentRunState)throw new Error("Must call prepare() before accessing session state");return t?this.currentRunState.sessionState.get(t):this.currentRunState.sessionState.data}setSessionState(t,a){if(!this.currentRunState)throw new Error("Must call prepare() before accessing session state");this.currentRunState.sessionState.set(t,a)}createExecutionContext(t){return{sessionId:t.sessionState.sessionId,runId:t.id,sessionState:t.sessionState,getConnectedNodes:(a,r)=>{const n=this.currentFullGraph,i=u=>{const p=new Set,h=[...n.reverseAdjacencyList.get(u)||[]];for(;h.length;){const v=h.pop();if(p.has(v))continue;p.add(v);const f=n.reverseAdjacencyList.get(v)||[];for(const m of f)p.has(m)||h.push(m)}return p},s=u=>{const p=new Set,h=[...n.adjacencyList.get(u)||[]];for(;h.length;){const v=h.pop();if(p.has(v))continue;p.add(v);const f=n.adjacencyList.get(v)||[];for(const m of f)p.has(m)||h.push(m)}return p};let o=new Set;if(r)r==="target"?o=i(a):o=s(a);else{const u=i(a),p=s(a);o=new Set([...u,...p,a])}const c=this.buildFilteredGraph(n,o),l=this.topologicalSortFromNode(c,a);if(r==="target"){const u=l.indexOf(a);return(u===-1?l:l.slice(0,u)).map(p=>n.nodes.get(p)).filter(p=>p!==void 0)}if(r==="source"){const u=l.indexOf(a);return(u===-1?[]:l.slice(u+1)).map(p=>n.nodes.get(p)).filter(p=>p!==void 0)}return l.map(u=>n.nodes.get(u)).filter(u=>u!==void 0)},setState:(a,r)=>t.sessionState.set(a,r),getState:a=>t.sessionState.get(a)}}async runPreparePhase(t,a,r){const n=t.targetNodeId;if(!n){xr("\u26A0\uFE0F [FlowMachine] No target ID provided for prepare phase");return}const i=a.reverseAdjacencyList.get(n)||[];for(const s of i){const o=a.nodes.get(s),c=t.nodeExecutions.get(s);if(!o||!c){xr(`\u26A0\uFE0F [FlowMachine] Missing node or nodeExecution for: ${s}`);continue}if(await this.executeNodePrepare(o,c,r),c.status===Wt.FAILED){t.status=Vr.FAILED,t.error=c.error;break}}}async runExecutePhase(t,a,r){const n=t.targetNodeId;if(!n)return;const i=a.nodes.get(n),s=t.nodeExecutions.get(n);if(!(!i||!s)){if(!(a.reverseAdjacencyList.get(n)||[]).every(o=>{var c;return((c=t.nodeExecutions.get(o))==null?void 0:c.status)===Wt.COMPLETED})){s.status=Wt.SKIPPED;return}await this.executeNodeExecute(i,s,r)}}getDirectlyConnectedNodes(t,a){const r=this.collectUpstreamNodes(t,a);return this.buildFilteredGraph(t,r)}collectUpstreamNodes(t,a){const r=new Set([a]);return(t.reverseAdjacencyList.get(a)||[]).forEach(n=>{r.add(n)}),r}buildFilteredGraph(t,a){const r=new Map,n=new Map;a.forEach(o=>{const c=t.nodes.get(o);c&&r.set(o,c)}),t.edges.forEach(o=>{a.has(o.source)&&a.has(o.target)&&n.set(o.id,o)});const i=new Map,s=new Map;return r.forEach((o,c)=>{i.set(c,[]),s.set(c,[])}),n.forEach(o=>{var c,l;(c=i.get(o.source))==null||c.push(o.target),(l=s.get(o.target))==null||l.push(o.source)}),{nodes:r,edges:n,adjacencyList:i,reverseAdjacencyList:s}}createRunState(t,a,r){const n=`session_${Gm()}`,i={sessionId:n,data:new Map,step:0,get:c=>i.data.get(c),set:(c,l)=>i.data.set(c,l),increment:()=>++i.step},s=r?this.topologicalSortFromNode(a,r):this.topologicalSort(a),o=new Map;return s.forEach(c=>{o.set(c,{nodeId:c,status:Wt.PENDING,result:null})}),{id:t,sessionId:n,status:Vr.IDLE,startTime:new Date,sessionState:i,nodeExecutions:o,executionOrder:s,currentNodeIndex:0,targetNodeId:r}}async executeNodePrepare(t,a,r){const n=this.nodeHandlers.get(t.node_type);if(!n){a.status=Wt.FAILED,a.error=new Error(`No handler found for node type: ${t.node_type}`);return}if(n.validate&&!n.validate(t)){a.status=Wt.FAILED,a.error=new Error(`Node validation failed for node: ${t.id}`);return}a.status=Wt.RUNNING,a.startTime=new Date;try{let i=null;n.prepare&&(i=await n.prepare(t,r)),a.status=Wt.COMPLETED,a.endTime=new Date,a.result=i}catch(i){ta(`FlowMachine.executeNodePrepare failed for node: ${t.id}`,i),a.status=Wt.FAILED,a.endTime=new Date,a.error=i}}async executeNodeExecute(t,a,r){const n=this.nodeHandlers.get(t.node_type);if(!n){a.status=Wt.FAILED,a.error=new Error(`No handler found for node type: ${t.node_type}`);return}try{let i=null;n.execute&&(i=await n.execute(t,r)),i!==null&&(a.result=i),r.sessionState.increment()}catch(i){a.status=Wt.FAILED,a.endTime=new Date,a.error=i}}topologicalSort(t){const a=new Set,r=[],n=new Set,i=s=>{if(n.has(s))throw new Error(`Circular dependency detected involving node: ${s}`);a.has(s)||(n.add(s),(t.reverseAdjacencyList.get(s)||[]).forEach(o=>{t.nodes.has(o)&&i(o)}),n.delete(s),a.add(s),r.push(s))};return t.nodes.forEach((s,o)=>{a.has(o)||i(o)}),r}topologicalSortFromNode(t,a){const r=new Set,n=[],i=new Set,s=o=>{if(i.has(o))throw new Error(`Circular dependency detected involving node: ${o}`);r.has(o)||(i.add(o),(t.reverseAdjacencyList.get(o)||[]).forEach(c=>{t.nodes.has(c)&&s(c)}),i.delete(o),r.add(o),n.push(o))};return s(a),t.nodes.forEach((o,c)=>{r.has(c)||s(c)}),n}}class O_ extends Ma{constructor(){super(...arguments);Zt(this,"nodeType",q.Thread)}async prepare(a,r){return{finalState:{},readyForExecution:!1}}async execute(a,r){const n=r.getState("llm");if(!(n!=null&&n.isLoaded))throw new Error("LLM_NOT_LOADED_YET");const i=r.getState("messages")||[],s=r.getState("prompts")||[],o=r.getState("injectedMessages")||[],c=r.getState("userInput"),l=r.getState("schemas")||[],u=r.getState("tools")||[],p=[...i,...s,...o];c&&p.push(new sa(c));const h=this.reorderMessages(p),v=await this.executeLLMChat(n,h,l,u,r);return r.setState("finalResponse",v),v}async executeLLMChat(a,r,n,i,s){const o=s.getState("onMessageUpdate");let c="";return await this.streamLLM(a.llm.provider,r,a.llm,n,i,{onMessageUpdate:l=>{c=l.content,o&&o({nodeData:{content:l.content,loading:!0}})},onMessageFinish:l=>{c=l.content,o&&o({nodeData:{content:l.content,loading:!1}})}}),c}async streamLLM(a,r,n,i,s,o){await gi.stream(a,r,{llm:n,schemas:i,tools:s,onMessageUpdate:c=>{o.onMessageUpdate(c)},onMessageFinish:c=>{o.onMessageFinish(c)}})}validate(a){var r,n;return!!((n=(r=a.data)==null?void 0:r.entity)!=null&&n.id)}async onBeforeExecute(a,r){}async onAfterExecute(a,r,n){}async onError(a,r,n){}reorderMessages(a){const r=[],n=[];if(a.forEach(i=>{i instanceof ts?r.push(i):n.push(i)}),r.length===0)return n;if(r.length===1)return[r[0],...n];{const i=r.map(s=>s.content).filter(s=>s&&s.toString().trim()).join(`

`);return[new ts(i),...n]}}}class $_ extends Ma{constructor(){super(...arguments);Zt(this,"nodeType",q.LLM)}async prepare(a,r){const n=a.data,i=n.entity;if(!i)throw new Error(`No LLM entity found for node: ${a.id}`);const s=n.status===kt.Loaded||i.status===kt.Loaded,o=s&&!!i.connection_info,c={llm:i,status:n.status||i.status,isLoaded:s,isReady:o};r.setState("llm",c)}async execute(a,r){}validate(a){var n,i;const r=a.data;return!!((n=r==null?void 0:r.entity)!=null&&n.id&&((i=r==null?void 0:r.entity)!=null&&i.name))}async onBeforeExecute(a,r){}async onAfterExecute(a,r,n){}}class Fl extends Ma{constructor(){super(...arguments);Zt(this,"nodeType",q.Prompt)}async prepare(a,r){var p;const n=a.data.entity;if(!n)throw new Error(`No prompt entity found for node: ${a.id}`);const i=r.getConnectedNodes(a.id,"target").find(h=>h.node_type===q.CSVData),s={};n.variables&&n.variables.length>0&&n.variables.forEach(h=>{h.name&&h.value&&(s[h.name]=h.value)});const o=r.getState("prompt_variables")||{};Object.assign(s,o);let c=`${n.prefix?`${n.prefix}
`:""}`;if(n.type===Vt.FewShotExample&&i){const h=(p=i.data)==null?void 0:p.entity;if(h&&h.headers&&h.csv){const{rows:v}=Xm(h.headers,h.csv);v.forEach(f=>{c+=`${n.content.replace(/{([^{}]*)}/g,(m,g)=>`${f[g]}`)}
`})}}else c+=n.content;n.suffix&&(c+=`
${n.suffix}`),Object.keys(s).length>0&&Object.entries(s).forEach(([h,v])=>{const f=new RegExp(`{\\s*${h}\\s*}`,"g");c=c.replace(f,v);const m=new RegExp(`{{\\s*${h}\\s*}}`,"g");c=c.replace(m,v)});const l=[];switch(n.role){case"human":l.push(new sa(c));break;case"system":l.push(new ts(c));break;default:l.push(new mi(c));break}const u=r.getState("prompts")||[];u.push(...l),r.setState("prompts",u)}async execute(a,r){}validate(a){var r,n;return!!((n=(r=a.data)==null?void 0:r.entity)!=null&&n.content)}}class zl extends Ma{constructor(){super(...arguments);Zt(this,"nodeType",q.Message)}async prepare(a,r){const n=a.data,i=n.entity;if(!i)throw new Error(`No Message entity found for node: ${a.id}`);const s=r.getConnectedNodes(a.id).filter(u=>u.node_type===q.Message).map(u=>({node:u,connectedNodes:[]})),o=[];s.forEach(({node:u})=>{const p=u.data;if(p!=null&&p.entity){const h=p.entity;switch(h.role){case"human":o.push(new sa(h.content));break;case"ai":o.push(new mi(h.content));break}}});const c={message:i,content:i.content||n.content||"",role:i.role||n.role||"user",baseMessage:(()=>{switch(i.role){case"human":return new sa(i.content);case"ai":return new mi(i.content);default:return new sa(i.content)}})()},l=[...r.getState("messages")||[],...o];return r.setState("messages",l),c}async execute(a,r){}validate(a){var r,n;return!!((n=(r=a.data)==null?void 0:r.entity)!=null&&n.id)}async onBeforeExecute(a,r){}async onAfterExecute(a,r,n){}}class R_ extends Ma{constructor(){super(...arguments);Zt(this,"nodeType",q.PlaceHolder)}async prepare(a,r){var c,l,u,p,h,v,f,m,g;const n=(c=a.data)==null?void 0:c.entity;if(!n)throw new Error(`No Placeholder entity found for node: ${a.id}`);const i=[],s=[];switch(n.placeholder_type){case sn.VECTOR_DATABASE_RETREIVER:{const w=r.getConnectedNodes(a.id,"source"),E=r.getConnectedNodes(a.id),O=E.find(Q=>Q.node_type===q.VectorDatabase),x=E.find(Q=>Q.node_type===q.Prompt);let k=w;(O||x)&&(k=E);const $=k.find(Q=>Q.node_type===q.VectorDatabase),N=$?(l=$.data)==null?void 0:l.entity:void 0,M=k.find(Q=>Q.node_type===q.Prompt),A=M?(u=M.data)==null?void 0:u.entity:void 0;if(!A||!N||!$){xr("\u26A0\uFE0F [PlaceholderHandler] Missing required connections:",{hasPrompt:!!A,hasVector:!!N,hasVectorNode:!!$});break}const I=(p=n.metadata)!=null&&p.k?+((h=n.metadata)==null?void 0:h.k):1;let R=(v=n.metadata)!=null&&v.minimalScore?+((f=n.metadata)==null?void 0:f.minimalScore):void 0;R&&R>1&&(R=R/100);const z=r.getState("humanMessageContent")||r.getState("userInput");if(!z){xr("\u26A0\uFE0F [PlaceholderHandler] No humanMessageContent or userInput found in context state");break}const F=[];if(N.storage===na.DataNode){const Q=(g=(m=r.getConnectedNodes($.id,"target").find(ce=>ce.node_type&&[q.JSONLData,q.CSVData].includes(ce.node_type)))==null?void 0:m.data)==null?void 0:g.entity;if(!Q){xr("\u26A0\uFE0F [PlaceholderHandler] No data source found for DataNode storage");break}const oe=r.getState("embeddingEntity");try{const ce=await ja.similaritySearchWithScore(oe,{database:{databaseId:N.id,dataSourceId:Q.id,dataSourceType:Yc(Q)}},z,I);ce&&F.push(...ce)}catch(ce){ta("\u274C [PlaceholderHandler] Similarity search failed:",ce)}}else{const Q=r.getState("embeddingEntity");try{const oe=await ja.similaritySearchWithScore(Q,{database:{databaseId:N.id}},z,I);oe&&F.push(...oe)}catch(oe){ta("\u274C [PlaceholderHandler] Similarity search failed:",oe)}}if(!F.length){xr("\u26A0\uFE0F [PlaceholderHandler] No documents found, skipping message injection");break}const U=new sE({template:A.content,inputVariables:["context"]}),V=(R?F.filter(([,Q])=>Q>=R):F).map(([Q])=>Q.pageContent).join(`
`),re=await U.format({context:V});i.push(new ts(re)),s.push(...F.map(([Q])=>Q));break}default:xr(`\u26A0\uFE0F [PlaceholderHandler] Unsupported placeholder type: ${n.placeholder_type}`)}const o={placeholder:n,injectedMessages:i,vectorContext:s};if(i.length>0){const w=[...r.getState("injectedMessages")||[],...i];r.setState("injectedMessages",w)}return s.length>0&&r.setState("vectorContext",s),o}async execute(a,r){}validate(a){var n;const r=(n=a.data)==null?void 0:n.entity;return!!(r!=null&&r.id&&(r!=null&&r.placeholder_type)&&r.placeholder_type===sn.VECTOR_DATABASE_RETREIVER)}async onBeforeExecute(a,r){}async onAfterExecute(a,r,n){}}class T_ extends Ma{constructor(){super(...arguments);Zt(this,"nodeType",q.Schema)}async prepare(a,r){const n=a.data.entity;if(!n)throw new Error(`No schema entity found for node: ${a.id}`);const i=this.parseToOpenAIFormat(n),s=r.getState("schemas")||[];s.push(i),r.setState("schemas",s)}async execute(a,r){}parseToOpenAIFormat(a){const r={},n=[];return a.schema_items&&a.schema_items.length>0&&a.schema_items.forEach(i=>{if(i.name){const s=this.parseSchemaItem(i);r[i.name]=s,i.required&&n.push(i.name)}}),{name:a.name,schema:{type:"object",properties:r,...n.length>0&&{required:n},additionalProperties:!1}}}parseSchemaItem(a){const r={type:a.type.toLowerCase()};if(a.description&&(r.description=a.description),a.enum)try{r.enum=JSON.parse(a.enum)}catch{r.enum=a.enum.split(",").map(n=>n.trim())}if(a.type==="object"&&a.schemas&&a.schemas.length>0){r.properties={};const n=[];a.schemas.forEach(i=>{i.name&&r.properties&&(r.properties[i.name]=this.parseSchemaItem(i),i.required&&n.push(i.name))}),n.length>0&&(r.required=n)}return a.type==="array"&&a.schemas&&a.schemas.length>0&&(r.items=this.parseSchemaItem(a.schemas[0])),r}validate(a){var n,i;const r=a.data;return!!((n=r==null?void 0:r.entity)!=null&&n.id&&((i=r==null?void 0:r.entity)!=null&&i.name))}}const Zl=e=>{const[t,a]=b.useState(!1),{confirmPassphrase:r}=Sa(),{t:n}=De("create_new_message"),i=ut(l=>l.currentSession),s=ye(l=>l.createOrUpdateFlowNode),o=ye(l=>l.createOrUpdateFlowEdge),c=b.useCallback(async({content:l,threadId:u,sourceId:p,initialX:h,initialY:v,initialLLMId:f})=>{if(!i)throw new Error("Session is not found");const m=await me("Message").save({thread_id:u,content:l,role:qt.Human,status:Ht.Started,llm_id:f,session_id:i.id});if(!m)throw new Error("Failed to save message");const g=await s({source_id:m.id,source_type:"Message",node_type:q.Message,x:h,y:v+80});if(!g)throw new Error("Failed to save human message node");await o({source:p,target:g.id});const w=await me("Message").save({thread_id:u,content:n("initial_ai_message"),role:qt.AI,status:Ht.Inprogress,llm_id:f,parent_message_id:m.id,session_id:i.id});if(!w)throw new Error("Failed to save message");const E=await s({source_id:w.id,source_type:"Message",node_type:q.Message,x:h,y:v+250});if(!E)throw new Error("Failed to save ai message node");return await o({source:g.id,target:E.id}),{aiMessage:w,humanMessage:m,aiMessageNode:E,humanMessageNode:g}},[o,s,i,n]);return{createMessage:b.useCallback(async(l,u,p)=>{var f,m,g,w,E,O;if(!((f=l.data)!=null&&f.entity))throw new Error("Thread node missing entity data");const h=l.data.entity;if(!h)throw new Error("Thread entity is not found");let v;try{a(!0);const x=e?ha.forSession(e):ha.forDatabase(),k=new Al(x);k.registerNodeHandler(new O_),k.registerNodeHandler(new $_),k.registerNodeHandler(new Fl),k.registerNodeHandler(new T_),k.registerNodeHandler(new zl),k.registerNodeHandler(new R_);const $={userInput:u,messages:((m=p==null?void 0:p.initialState)==null?void 0:m.messages)||[]};if(await k.prepare(l.id,$),!((g=k.getSessionState("llm"))!=null&&g.isLoaded))throw new Error("LLM_NOT_LOADED_YET");await r();const N=(p==null?void 0:p.initialX)||((w=l.position)==null?void 0:w.x)||0,M=(p==null?void 0:p.initialY)||(((E=l.position)==null?void 0:E.y)||0)+(((O=l.measured)==null?void 0:O.height)||0);v=await c({content:u,initialX:N,initialY:M,sourceId:(p==null?void 0:p.sourceId)||l.id,threadId:h.id,initialLLMId:h.initial_llm_id}),k.setSessionState("onMessageUpdate",I=>{p.onMessageUpdate({id:v.aiMessageNode.id,nodeData:{content:I.nodeData.content,entity:{...v.aiMessage,content:I.nodeData.content,status:I.nodeData.loading?Ht.Inprogress:Ht.Success},loading:I.nodeData.loading}})});const A=(await k.execute()).sessionState.get("finalResponse")||"No response generated";return await me("Message").update(`${v.aiMessage.id}`,{status:Ht.Success,content:A}),v.aiMessage.status=Ht.Success,v.aiMessage.content=A,p.onMessageUpdate({id:v.aiMessageNode.id,nodeData:{entity:v.aiMessage,loading:!1}}),!0}catch(x){throw ta("FlowMachine message creation failed:",x),v!=null&&v.aiMessage&&await me("Message").update(`${v.aiMessage.id}`,{status:Ht.Failed,content:n("errors.ai_message_content_failed")}),v!=null&&v.aiMessageNode.id&&(p==null||p.onMessageUpdate({id:v.aiMessageNode.id,nodeData:{content:n("errors.ai_message_content_failed"),entity:{...v.aiMessage,status:Ht.Failed,content:n("errors.ai_message_content_failed")},loading:!1}})),x}finally{a(!1)}},[r,c,n]),loading:t}},I_=(e,t)=>{const a=t.getHandleConnections({nodeId:e.id,type:"target"}),r=a.map(p=>{const h=t.getNode(p.source);return h?{connections:t.getHandleConnections({nodeId:h.id,type:"target"}),node:h}:void 0}),n=r.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===q.Prompt}),i=[];n!=null&&n.length&&n.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>t.getNode(f.source)).filter(Boolean);i.push({node:p.node,connections:p.connections,connectedNodes:h})});const s=r.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===q.ToolDefinition}),o=[];s!=null&&s.length&&s.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>t.getNode(f.source)).filter(Boolean);h!=null&&h.find(f=>f.type===q.Schema)&&o.push({node:p.node,connections:p.connections,connectedNodes:h})});const c=r.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===q.PlaceHolder}),l=[];c!=null&&c.length&&c.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>t.getNode(f.source)).filter(Boolean);h&&l.push({node:p.node,connections:p.connections,connectedNodes:h})});const u=r.find(p=>{var h;return((h=p.node)==null?void 0:h.type)===q.Schema});return{thread:{node:e,connections:a},llm:r.find(p=>{var h;return((h=p.node)==null?void 0:h.type)===q.LLM}),schemas:u?[u]:[],prompts:i,tools:o,placeholders:l}},L_=(e,t)=>{const a=_t(e),{t:r}=De("flows"),n=Yt(),i=ye(v=>v.updateNodes),{createMessage:s,loading:o}=Zl(n),{getNode:c,getHandleConnections:l}=n,u=b.useCallback(v=>{const f=c(v);if(!f)return[];const m=[],g=I_(f,{getNode:c,getHandleConnections:l});return g.thread&&m.push({node:g.thread.node,connectedNodes:[],connections:g.thread.connections}),g.prompts&&m.push(...g.prompts.map(w=>({node:w.node,connectedNodes:w.connectedNodes,connections:w.connections}))),g.schemas&&m.push(...g.schemas.map(w=>({node:w.node,connectedNodes:[],connections:w.connections}))),g.placeholders&&g.placeholders.forEach(w=>{const E=w.connections.map(O=>c(O.source)).filter(Boolean);m.push({node:w.node,connectedNodes:E||[],connections:w.connections})}),g.llm&&m.push(g.llm),m},[l,c]),p=b.useCallback(v=>{if(!v.id)return;const f=c(v.id);!f||!v.nodeData||i([{id:f.id,type:"replace",item:{...f,data:{...f.data,...Mm(v.nodeData,Dm)}}}])},[c,i]),h=b.useCallback(async v=>{if(a&&t.entity)try{await s(a,v,{onMessageUpdate:p})}catch(f){if(ta("FlowMachine execution error:",f),f instanceof Error&&f.message.includes("LLM_NOT_LOADED_YET"))return wa({variant:"destructive",title:r("thread_node.errors.llm_not_loaded_yet")});wa({variant:"destructive",title:`FlowMachine Error: ${f}`})}},[a,t.entity,s,p,r]);return{loading:o,getLinkedConnections:u,createMessage:h}},M_=e=>{const t=ye(r=>r.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:r,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===q.Prompt&&(i==null?void 0:i.type)===q.Thread){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===q.LLM&&(i==null?void 0:i.type)===q.Thread){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===q.Schema&&(i==null?void 0:i.type)===q.Thread){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===q.ToolDefinition&&(i==null?void 0:i.type)===q.Thread){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===q.VectorDatabase&&(i==null?void 0:i.type)===q.Thread){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===q.PlaceHolder&&(i==null?void 0:i.type)===q.Thread&&n.data.entity.placeholder_type===sn.VECTOR_DATABASE_RETREIVER){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},D_=b.memo(e=>{const{id:t,data:a,isConnectable:r}=e,{t:n}=De("flows"),[i,s]=b.useState(!1),o=ii({type:"source"}),c=ii({type:"target"}),{getNode:l}=Yt(),{loading:u,createMessage:p,getLinkedConnections:h}=L_(t,a);M_(t);const v=b.useCallback(async(...w)=>(s(!1),await p(...w)),[p]),f=b.useMemo(()=>o.length>0,[o]),m=b.useCallback(()=>{s(w=>!w)},[]),g=b.useMemo(()=>{var E,O;const w=c.map((x,k)=>{var N;const $=l(x.source);if(($==null?void 0:$.type)===q.Schema)return d.jsx(aa,{children:n("thread_node.structured_output")},`${k}`);if(($==null?void 0:$.type)===q.Prompt){const M=$.data.entity;return d.jsx(aa,{children:n(M.type===Vt.FewShotExample?"thread_node.prompts.few_shot_example":`thread_node.prompts.${M.role.toLowerCase()}`)},`${k}`)}else if(($==null?void 0:$.type)===q.PlaceHolder&&((N=$.data.entity)==null?void 0:N.placeholder_type)===sn.VECTOR_DATABASE_RETREIVER)return d.jsx(aa,{children:n("thread_node.vector_database_retriever")},`${k}`)}).filter(Boolean);return e.data.entity&&!((O=(E=e.data.entity)==null?void 0:E.messages)!=null&&O.length)&&!f?d.jsx(Bi,{disabled:u,loading:u,onSubmit:v,tags:w}):w!=null&&w.length?d.jsxs(st,{className:"p-4 pt-2",children:[d.jsx(Pt,{className:"mb-2",children:n("thread_node.title")}),d.jsx("div",{className:"flex gap-1.5",children:w}),d.jsx("div",{className:"mt-4 w-full flex justify-end",children:d.jsxs(tt,{onClick:m,variant:"outline",children:[d.jsx(we,{name:i?"copy-minus":"copy-plus"}),n(i?"thread_node.hide":"thread_node.clone")]})})]}):d.jsx("div",{className:"w-12 h-10"})},[f,l,v,m,u,e.data.entity,i,n,c]);return d.jsxs("div",{children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsxs("div",{children:[d.jsx(xt,{id:t,enableToStandalone:!0,getLinkedConnections:h}),g,i?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),d.jsx("div",{className:"absolute mt-[30px] w-full",children:d.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:d.jsx(Bi,{disabled:u,loading:u,onSubmit:v})})})]}):void 0]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})});function A_({data:e,onNewThread:t,loading:a,showThread:r}){var i;const{t:n}=De("flows");return d.jsxs(Ut,{className:"flex min-w-52",children:[d.jsx(we,{size:24,name:"user"}),d.jsxs("div",{className:"ml-2 max-w-full w-full",children:[d.jsx(Nr,{children:"Human"}),d.jsx(Ea,{children:`${e.content||((i=e.entity)==null?void 0:i.content)||""}`}),t?d.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:d.jsxs(tt,{onClick:t,disabled:a,variant:"outline",children:[d.jsx(we,{name:r?"minus":"plus",size:16}),n(r?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]})]})}function F_({data:e,onNewThread:t,loading:a,showThread:r}){var c,l,u,p,h,v,f,m,g;const{t:n}=De("flows"),i=b.useMemo(()=>{var w;try{return JSON.parse(((w=e==null?void 0:e.entity)==null?void 0:w.metadata)||"{}")}catch{return{}}},[(c=e==null?void 0:e.entity)==null?void 0:c.metadata]),s=e.entity.status===Ht.Failed,o=d.jsx(nn,{source:`${e.content||((l=e.entity)==null?void 0:l.content)||""}`});return d.jsxs(Ut,{className:Ve("flex min-w-52",s?"bg-background":""),variant:s?"destructive":"default",children:[d.jsx(we,{className:Ve(e.loading?"animate-spin":void 0),size:24,name:e.loading?"loader-circle":"bot"}),d.jsx(we,{name:r?"minus":"plus",size:24}),d.jsxs("div",{className:"ml-2 w-full max-w-full",children:[d.jsx(Nr,{children:n(`message_node.message_roles.${(p=(u=e.entity)==null?void 0:u.role)==null?void 0:p.toLowerCase()}`)}),d.jsx(b.Suspense,{fallback:d.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:d.jsx(we,{name:"loader-circle",className:"animate-spin"})}),children:s?e.content||((h=e.entity)==null?void 0:h.content)||"":o}),Array.isArray((v=i==null?void 0:i.message)==null?void 0:v.tool_calls)&&((m=(f=i==null?void 0:i.message)==null?void 0:f.tool_calls)!=null&&m.length)?(g=i==null?void 0:i.message)==null?void 0:g.tool_calls.map((w,E)=>d.jsx(aa,{children:n("message_node.tool_call",{name:w.name,args:Object.entries(w.args).map(([O,x])=>`"${O}": "${x}"`).join(", ")})},`${w.name}_${E}`)):null,t?d.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:d.jsxs(tt,{onClick:t,disabled:a,variant:"outline",children:[d.jsx(we,{name:r?"minus":"plus",size:16}),n(r?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]}),e.loading?d.jsx(Am,{size:350,duration:10}):void 0]})}const z_=e=>{const{t}=De("flows"),a=_t(e),r=ye(f=>f.updateNodes),n=Yt(),{createMessage:i,loading:s}=Zl(n),{getNode:o,getNodes:c,getHandleConnections:l}=n,u=b.useCallback(f=>{const m=c();let g=f;const w=new Set;for(;g&&!w.has(g);){w.add(g);const E=m.find(x=>x.id===g);if(!E)break;if(E.type===q.Thread)return E;const O=l({type:"target",nodeId:g});if(O.length===0)break;g=O[0].source}return null},[c,l]),p=b.useCallback(async f=>{try{const m=ha.forSession(n),g=new Al(m);return g.registerNodeHandler(new zl),g.registerNodeHandler(new Fl),await g.prepare(f,{}),g.getSessionState("messages")||[]}catch(m){return console.error("Failed to collect conversation history:",m),[]}},[n]),h=b.useCallback(f=>{if(!f.id)return;const m=o(f.id);!m||!f.nodeData||r([{id:m.id,type:"replace",item:{...m,data:{...m.data,...Mm(f.nodeData,Dm)}}}])},[o,r]),v=b.useCallback(async f=>{var m,g,w;if(a)try{const E=u(a.id);if(!E)return wa({variant:"destructive",title:t("message_node.errors.thread_not_found")});const O=await p(a.id);await i(E,f,{onMessageUpdate:h,sourceId:a.id,initialState:{messages:O},initialX:(m=a.position)==null?void 0:m.x,initialY:((g=a.position)==null?void 0:g.y)+(((w=a.measured)==null?void 0:w.height)||0)+10})}catch(E){if(E instanceof Error&&E.message.includes("LLM_NOT_LOADED_YET"))return wa({variant:"destructive",title:t("message_node.errors.llm_not_loaded_yet")});wa({variant:"destructive",title:t("message_node.errors.create_message")})}},[a,t,i,h,u,p]);return{loading:s,createMessage:v}},Ul=()=>{const e=ut(r=>r.currentSession),t=ye(r=>r.createOrUpdateFlowNode),a=ye(r=>r.createOrUpdateFlowEdge);return{createIdieMessage:b.useCallback(async(r,n,i,s)=>{var f,m,g,w,E;if(!r||!n||!e)return;const o=(m=(f=s==null?void 0:s.promptNode)==null?void 0:f.data)==null?void 0:m.entity,c=((g=r.position)==null?void 0:g.x)||0,l=(((w=r.position)==null?void 0:w.y)||0)+(((E=r.measured)==null?void 0:E.height)||0),u=await me("Message").save({thread_id:n.id,content:i,role:(o==null?void 0:o.role)||qt.Human,status:Ht.Started,llm_id:n.initial_llm_id,session_id:e.id});if(!u)throw new Error("Failed to save message");const p=await t({source_id:u.id,source_type:"Message",node_type:q.Message,x:c,y:l});if(!p)throw new Error("Failed to save message node");const h=await a({source:r.id,target:p.id});let v;return s!=null&&s.promptNode&&(v=await a({source:s==null?void 0:s.promptNode.id,target:p.id})),{message:u,edgeToPrompt:v,messageNode:p,messageEdge:h}},[t,a])}},Z_=e=>{const{createIdieMessage:t}=Ul(),a=b.useCallback(async({edgeId:r,source:n,target:i})=>{var s,o;try{if((n==null?void 0:n.type)===q.Prompt&&(i==null?void 0:i.type)===q.Message){const c=(s=i==null?void 0:i.data)==null?void 0:s.entity,l=(o=n==null?void 0:n.data)==null?void 0:o.entity;if(!l||!c||!i)return{deleteEdgeId:r};await t(i,{id:c==null?void 0:c.thread_id,title:"",status:as.Started,initial_llm_id:c.llm_id,session_id:l.session_id},l.content,{promptNode:n});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},U_=b.memo(e=>{var O,x,k;const{id:t,data:a,isConnectable:r}=e,[n,i]=b.useState(!1),[s,o]=b.useState(!1),{t:c}=De("common"),l=ii({type:"source"}),{loading:u,createMessage:p}=z_(t),{toast:h}=It();Z_(t);const v=b.useCallback(async(...$)=>{const N=await p(...$);return i(!1),N},[p]),f=b.useMemo(()=>l.length===0,[l]),m=b.useCallback(()=>{var $;($=a.entity)!=null&&$.content&&(navigator.clipboard.writeText(a.entity.content),h({description:c("copied")}))},[h,a,c]),g=b.useCallback(async()=>{var $;try{if(s)return await Pm.stop(),o(!1);o(!0),await Pm.speak((($=a.entity)==null?void 0:$.content)||"")}catch{h({variant:"destructive",description:c("errors.speech_is_not_supported")})}finally{o(!1)}},[(O=a.entity)==null?void 0:O.content,s,c,h]),w=b.useCallback(()=>{i($=>!$)},[]),E=b.useMemo(()=>{var $;if(!(!f&&!n||a.loading||u||(($=a==null?void 0:a.entity)==null?void 0:$.status)==="inprogress"))return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),d.jsx("div",{className:"absolute mt-[30px] w-full",children:d.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:d.jsx(Bi,{disabled:u,loading:u,onSubmit:v})})})]})},[(x=a==null?void 0:a.entity)==null?void 0:x.status,a.loading,v,f,u,n]);return d.jsxs("div",{children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsxs("div",{className:"max-w-sm min-w-64",children:[d.jsxs("div",{className:"w-auto",children:[d.jsx(xt,{id:t}),d.jsx("div",{children:((k=a.entity)==null?void 0:k.role)===qt.Human?d.jsx(A_,{data:a,showThread:n,onNewThread:f?void 0:w}):d.jsx(F_,{data:a,showThread:n,loading:u,onNewThread:f?void 0:w})}),d.jsx(tt,{onClick:g,className:"absolute top-0 right-[68px] !px-2 !rounded-none",variant:"ghost",children:d.jsx(we,{name:s?"circle-stop":"speech",size:16})}),d.jsx(tt,{onClick:m,className:"absolute top-0 right-[36px] !px-2 !rounded-none",variant:"ghost",children:d.jsx(we,{name:"copy",size:16})})]}),E]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})}),Hl=()=>{const e=ut(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[t,a]=b.useState(!1),r=ye(s=>s.createOrUpdateFlowNode),n=ye(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async s=>{var o,c;a(!0);try{const l=(o=s.data)==null?void 0:o.entity;if(!l||!e)throw new Error("LLM or Session not found");const u=s.position.x,p=s.position.y+(((c=s.measured)==null?void 0:c.height)||0),h=await me("Thread").save({initial_llm_id:l.id,title:`New thread with ${l.name}`,status:as.Started,messages:[],session_id:e}),v=await r({source_id:h.id,source_type:"Thread",node_type:q.Thread,x:u,y:p+60});if(!v)throw new Error("Failed to create thread node");const f=await n({source:s.id,target:v.id});return{thread:h,flowNode:v,flowEdge:f}}finally{a(!1)}},[n,r,e]);return{loading:t,createThread:i}},H_=(e,t)=>{var E;const{t:a}=De("flows"),{toast:r}=It(),[n,i]=b.useState(!1),[s,o]=b.useState(!1),c=_t(e),{createThread:l,loading:u}=Hl(),p=ye(O=>O.updateNodes),h=ye(O=>O.pushSyncNodeQueue),{getNodes:v}=Yt(),f=b.useCallback(async()=>{try{if(o(!0),t.entity.id){const O=await me("Thread").find({where:{initial_llm_id:t.entity.id}});h("Thread",{where:{source_type:"Thread",source_id:ad(O.map(x=>x.id))}})}}finally{o(!1)}},[(E=t==null?void 0:t.entity)==null?void 0:E.id,h]),m=b.useCallback(async()=>{try{if(i(!0),t.entity&&c){await gi.loadModel(t.entity.provider,`${t.entity.name}`,{provider:t.entity.provider,callback:x=>{c.data.status=x.progress===100?kt.Loaded:kt.Loading,c.data.label=x.text,p([{id:e,type:"replace",item:c}])}});const O=v().filter(x=>x.type===q.LLM?x.data.entity.provider===Le.WebLLM:!1).map(x=>(x.data.status=kt.Started,{id:x.id,type:"replace",item:x}));c.data.label="",c.data.status=kt.Loaded,O.push({id:e,type:"replace",item:c}),p(O),await f()}}catch(O){ta("Load Model",O),r({variant:"destructive",description:a("llm_node.errors.loading_model")})}finally{i(!1)}},[t.entity,v,e,c,f,a,r,p]),g=b.useCallback(async()=>{t.entity&&c&&await(l==null?void 0:l(c))},[t.entity,c,l]),w=b.useCallback(async O=>{t.entity&&c&&(c.data.entity.options=O,await me("LLM").update(t.entity.id,{options:O}),p([{id:e,type:"replace",item:c}]))},[t.entity,e,c,p]);return b.useEffect(()=>{t.entity&&c&&t.entity.status!==t.status&&(c.data.status=t.entity.status,p([{id:e,type:"replace",item:c}]))},[]),{loadingModel:n,creatingThread:u,queringThreads:s,changeLLMOptions:w,loadModel:m,createThread:g,queryThreads:f}},q_=e=>{const t=b.useCallback(async()=>{},[]);Ct(e,t)},V_=b.memo(e=>{var w,E,O,x,k,$;const{id:t,data:a,isConnectable:r}=e,[n,i]=b.useState(),{t:s}=De("flows"),{createThread:o,loadModel:c,queringThreads:l,queryThreads:u,loadingModel:p,changeLLMOptions:h}=H_(t,a);q_(t);const v=[kt.Loading,kt.Downloading].includes(a.status);b.useEffect(()=>{var N,M,A,I,R,z,F,U,V;if(!(n||!((N=a==null?void 0:a.entity)!=null&&N.name))){if([Le.WebLLM,Le.Wllama].includes((M=a==null?void 0:a.entity)==null?void 0:M.provider)){if(Le.Wllama===((A=a==null?void 0:a.entity)==null?void 0:A.provider)){Lt(()=>import("./file-tree-BZDpw5jz.js").then(async re=>(await re.__tla,re)).then(re=>re.i),__vite__mapDeps([9,4,2,3])).then(async({ModelManager:re})=>{var oe,ce,Re;const Q=await new re().getModels();i({hasCache:!!Q.find(Ze=>{var K;return Ze.url.includes((K=a==null?void 0:a.entity)==null?void 0:K.name)}),cloud:!1,isFunctionCalling:!1,info:{model_id:(oe=a==null?void 0:a.entity)==null?void 0:oe.name,model:(ce=a==null?void 0:a.entity)==null?void 0:ce.name,model_lib:(Re=a==null?void 0:a.entity)==null?void 0:Re.provider,model_type:2}})}),i({hasCache:!1,cloud:!1,isFunctionCalling:!0,info:{model_id:(I=a==null?void 0:a.entity)==null?void 0:I.name,model:(R=a==null?void 0:a.entity)==null?void 0:R.name,model_lib:(z=a==null?void 0:a.entity)==null?void 0:z.provider,model_type:2}});return}}else{i({hasCache:!1,cloud:!0,isFunctionCalling:!0,info:{model_id:(F=a==null?void 0:a.entity)==null?void 0:F.name,model:(U=a==null?void 0:a.entity)==null?void 0:U.name,model_lib:(V=a==null?void 0:a.entity)==null?void 0:V.provider,model_type:2}});return}Lt(()=>import("./index-CpUNJZhr.js").then(async re=>(await re.__tla,re)),__vite__mapDeps([0,1,2,3,4,5,6])).then(async({hasModelInCache:re,functionCallingModelIds:Q,prebuiltAppConfig:oe})=>{var Re,Ze;const ce=await re((Re=a==null?void 0:a.entity)==null?void 0:Re.name);i({hasCache:ce,isFunctionCalling:Q.includes((Ze=a==null?void 0:a.entity)==null?void 0:Ze.name),info:oe.model_list.find(K=>{var ae;return K.model_id===((ae=a==null?void 0:a.entity)==null?void 0:ae.name)})})})}},[(w=a==null?void 0:a.entity)==null?void 0:w.name,(E=a==null?void 0:a.entity)==null?void 0:E.provider,n]);const f=b.useCallback(async N=>{await h(N)},[h]),m=b.useMemo(()=>{var N,M;switch(a.status){case kt.Downloading:return d.jsx(we,{className:"animate-spin w-7 h-7",name:"arrow-big-down-dash"});case kt.Loaded:return d.jsx(zr,{name:((N=a.entity)==null?void 0:N.name)||"brain",className:"w-7 h-7"});case kt.Loading:return d.jsx(we,{className:"animate-spin w-7 h-7",name:"loader-circle"});default:return d.jsx(zr,{name:((M=a.entity)==null?void 0:M.name)||"brain",className:"w-7 h-7"})}},[(O=a.entity)==null?void 0:O.name,a.status]),g=b.useMemo(()=>v?null:p?d.jsx(tt,{disabled:!0,className:"w-full mt-4",children:d.jsx(we,{className:"animate-spin",size:24,name:"loader-circle"})}):a.status===kt.Loaded?d.jsx(tt,{onClick:o,className:"mt-4 w-full",children:s("llm_node.create_thread_button")}):d.jsxs("div",{className:"flex gap-2 mt-4",children:[n!=null&&n.hasCache?d.jsx(er,{loading:l,onClick:u,children:d.jsx(we,{size:24,name:"message-square-more"})}):null,d.jsx(tt,{disabled:p,onClick:c,className:"w-full",children:s(n!=null&&n.hasCache?"llm_node.load_model_button":"llm_node.download_model_button")})]}),[v,p,a.status,n==null?void 0:n.hasCache,l,u,c,s,o]);return d.jsxs("div",{children:[d.jsxs("div",{children:[d.jsx(xt,{id:t}),d.jsxs(Ut,{className:"flex justify-center",children:[m,d.jsxs("div",{className:"ml-2 pt-1 max-w-lg",children:[d.jsx(Nr,{className:"flex gap-2 items-center pr-6",children:`${((x=a==null?void 0:a.entity)==null?void 0:x.name)||""}`}),d.jsx(Ea,{className:"max-w-full",children:`${a.label||""}`}),d.jsx("div",{className:"max-w-full mt-2 flex-wrap flex gap-1",children:d.jsx(ai,{model:n==null?void 0:n.info,isFunctionCalling:(n==null?void 0:n.isFunctionCalling)||!1,name:(k=a==null?void 0:a.entity)==null?void 0:k.name,isCached:(n==null?void 0:n.hasCache)||!1,cloud:(n==null?void 0:n.cloud)||!1})}),d.jsx(iE,{options:($=a==null?void 0:a.entity)==null?void 0:$.options,onChangeOptions:f,className:"mt-2"}),g]})]}),v?d.jsx(Am,{className:"rounded-lg"}):void 0]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})}),B_=e=>{const t=ye(n=>n.createOrUpdateFlowEdge),{createIdieMessage:a}=Ul(),r=b.useCallback(async({edgeId:n,source:i,target:s})=>{var o,c,l,u;try{const p=(o=s==null?void 0:s.data)==null?void 0:o.entity,h=(c=i==null?void 0:i.data)==null?void 0:c.entity;if((i==null?void 0:i.type)===q.Message&&(s==null?void 0:s.type)===q.Prompt){const v=(l=i==null?void 0:i.data)==null?void 0:l.entity,f=(u=s==null?void 0:s.data)==null?void 0:u.entity;if(!f||!v||!s)return{deleteEdgeId:n};await a(i,{id:v==null?void 0:v.thread_id,title:"",status:as.Started,initial_llm_id:v.llm_id,session_id:f.session_id},f.content,{promptNode:s});return}else if((i==null?void 0:i.type)===q.CSVData&&(s==null?void 0:s.type)===q.Prompt&&(p==null?void 0:p.type)===Vt.FewShotExample&&(h!=null&&h.headers.includes("input"))&&(h!=null&&h.headers.includes("output"))){await t({source:i.id,target:s.id});return}return{deleteEdgeId:n}}catch{return{deleteEdgeId:n}}},[a,t]);Ct(e,r)},W_=b.memo(e=>{var l,u,p;const{id:t,data:a,isConnectable:r}=e;B_(t);const n=ea(oE),i=b.useMemo(()=>{var h,v,f;return`${(h=a.entity)!=null&&h.prefix?`${(v=a.entity)==null?void 0:v.prefix}
`:""}${((f=a.entity)==null?void 0:f.content)||""}`},[(l=a.entity)==null?void 0:l.prefix,(u=a.entity)==null?void 0:u.content]),s=b.useMemo(()=>{var v;const h=/{(.*?)}/g;return((v=i.match(h))==null?void 0:v.map(f=>f.replace("{","").replace("}","")))||[]},[i]),o=i.length>990,c=()=>{n.show({title:"Prompt",content:i})};return d.jsxs("div",{className:"min-w-56",children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsxs("div",{children:[d.jsx(xt,{id:t}),d.jsxs(Ut,{className:"flex justify-center max-w-72",variant:"default",children:[d.jsx(we,{size:24,name:"notepad-text"}),d.jsxs("div",{className:"ml-2 max-w-full break-words break-all",children:[d.jsx(Nr,{children:`${((p=a.entity)==null?void 0:p.role)||""}`}),d.jsxs(Ea,{onClick:o?c:void 0,children:[o?`${i.slice(0,990)}...`:i,o?d.jsx("span",{className:"float-right",children:d.jsx(we,{name:"chevron-right"})}):void 0]}),s!=null&&s.length?s.map((h,v)=>d.jsx(aa,{className:"mt-2 mr-1",variant:"default",children:h},v)):void 0]})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})}),K_=e=>{const t=b.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);Ct(e,t)},J_=b.memo(e=>{var c,l;const{t}=De("flows"),{id:a,data:r,isConnectable:n}=e,i=b.useRef(!1),s=_t(a),o=ye(u=>u.updateNodes);return K_(a),b.useEffect(()=>{var p;const u=r==null?void 0:r.entity;!u||!s||i.current||(p=u==null?void 0:u.schema_items)!=null&&p.length||r.loaded||(i.current=!0,me("SchemaItem").find({where:{schema_id:u.id}}).then(h=>{o([{id:s.id,type:"replace",item:{...s,data:{...(s==null?void 0:s.data)||{},loaded:!0,entity:{...r.entity,schema_items:h}}}}])}).finally(()=>{i.current=!1}))},[r.entity,r.loaded,s,o]),d.jsxs("div",{children:[d.jsxs("div",{children:[d.jsx(xt,{id:a}),d.jsxs(si,{defaultValue:"account",className:"w-[400px]",children:[d.jsxs(Jc,{className:"grid w-full grid-cols-2",children:[d.jsx(Cr,{value:"account",children:t("schema_node.typescript")}),d.jsx(Cr,{value:"password",children:t("schema_node.zod")})]}),d.jsx(Pr,{value:"account",children:d.jsx(st,{className:"p-4",children:d.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:cE(((c=r==null?void 0:r.entity)==null?void 0:c.schema_items)||[])})})}),d.jsx(Pr,{value:"password",children:d.jsx(st,{className:"p-4 max-w-full",children:d.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:dE(((l=r==null?void 0:r.entity)==null?void 0:l.schema_items)||[])})})})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:n})]})}),Q_=e=>{const t=ye(r=>r.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:r,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===q.Schema&&(i==null?void 0:i.type)===q.ToolDefinition){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},G_=b.lazy(()=>Lt(()=>import("./CodeEditor-C0Uqhk7e.js"),__vite__mapDeps([7,2,3,8]))),X_=b.memo(({id:e,data:t,isConnectable:a})=>{var o,c,l,u;const{t:r}=De("components");Q_(e);const n=b.useMemo(()=>{var p;try{return((p=t.entity)==null?void 0:p.schema)||[]}catch{return[]}},[(o=t.entity)==null?void 0:o.schema]),i=b.useCallback(()=>{},[]),s=b.useMemo(()=>({readOnly:!0,minimap:{enabled:!1}}),[]);return d.jsxs("div",{children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:a}),d.jsx("div",{children:d.jsxs(Ut,{className:"flex justify-center",children:[d.jsx(xt,{id:e}),d.jsx(we,{size:24,name:"wrench"}),d.jsxs("div",{className:"ml-2",children:[d.jsx(Nr,{children:`${((c=t.entity)==null?void 0:c.name)||""}`}),d.jsx(Ea,{children:`${((l=t.entity)==null?void 0:l.description)||""}`}),d.jsxs(si,{defaultValue:"account",className:"w-full mt-4",children:[d.jsxs(Jc,{className:"grid w-full grid-cols-2",children:[d.jsx(Cr,{value:"account",children:r("add_tool_card.tool_schema")}),d.jsx(Cr,{value:"password",children:r("add_tool_card.handler")})]}),d.jsx(Pr,{value:"account",children:d.jsx(st,{className:"p-4",children:d.jsx(Ss,{className:"mt-0",data:n})})}),d.jsx(Pr,{value:"password",children:d.jsx(st,{className:"p-4 max-w-full",children:d.jsx(b.Suspense,{children:d.jsx(G_,{content:((u=t==null?void 0:t.entity)==null?void 0:u.handler)||"",setContent:i,className:"h-40",language:"javascript",options:s})})})})]})]})]})}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:a})]})}),Y_=b.memo(e=>{var i,s;const{id:t,data:a,isConnectable:r}=e,n=b.useMemo(()=>{if(!(a!=null&&a.entity))return{headers:[],rows:[]};const o=ed(a.entity.csv);return{headers:td(a.entity.headers),rows:o.map(c=>td(c))}},[a==null?void 0:a.entity]);return d.jsxs("div",{children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsxs("div",{children:[d.jsx(xt,{id:t}),d.jsxs(st,{className:"min-w-32 min-h-16 p-4",children:[d.jsx(Et,{className:"!p-0",children:d.jsxs("div",{className:"pt-2 flex !flex-row",children:[d.jsx(we,{name:"file-spreadsheet",className:"mr-2"}),d.jsxs(Se,{className:"!font-medium leading-none tracking-tight pr-8",children:[q.CSVData," ",(i=n==null?void 0:n.rows)!=null&&i.length?`(${((s=n==null?void 0:n.rows)==null?void 0:s.length)||0})`:""]})]})}),d.jsx(St,{className:"pb-0",children:d.jsx(Qc,{data:n.rows,headers:n.headers})})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})}),e0=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
Use three sentences maximum and keep the answer as concise as possible.

{context}
`,t0=ri(e=>{const{source:t,documents:a}=e,r=ea(),{toast:n}=It(),{t:i}=De("dialogs"),{loading:s,createPrompt:o}=Cl(),c=async l=>{try{if(!l.content||!l.content.includes("{context}")){n({title:i("create_vector_database_prompt.errors.fill_context"),variant:"destructive"});return}const u=l.content.replace("{context}",a.map(p=>`<document>${p.pageContent}</document>`).join(`
`));return await o(t,{...l,content:u}),r.hide(),!0}catch{n({title:i("create_vector_database_prompt.errors.create_failed"),variant:"destructive"})}};return d.jsx(ci,{open:r.visible,onOpenChange:r.hide,children:d.jsxs(di,{className:"sm:max-w-[425px]",children:[d.jsx(li,{children:d.jsxs("div",{className:"flex",children:[d.jsx(we,{name:"file",className:"mr-2 h-4 w-4"}),d.jsx(ui,{children:i("create_vector_database_prompt.title")})]})}),d.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[d.jsx(Vi,{onSubmit:c,loading:s,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:e0}),d.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[d.jsx(we,{name:"info",className:"mr-2",size:14}),i("create_vector_database_prompt.fill_content_note")]})]})]})})}),r0=()=>{const e=ut(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[t,a]=b.useState(!1),r=ye(s=>s.createOrUpdateFlowNode),n=ye(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async({prompt:s,source:o,metadata:c})=>{var l,u,p,h;try{const v=(l=o==null?void 0:o.data)==null?void 0:l.entity;if(!v||!e)throw new Error("Source or Session not found");a(!0);const f=((u=o.position)==null?void 0:u.x)||0,m=(((p=o.position)==null?void 0:p.y)||0)+(((h=o.measured)==null?void 0:h.height)||0),g=await me("Prompt").save({...s,status:(s==null?void 0:s.status)||Ht.Started,role:(s==null?void 0:s.role)||qt.System,type:(s==null?void 0:s.type)||Vt.Chat,content:(s==null?void 0:s.content)||"{context}",session_id:e});if(!g)throw new Error("Failed to save prompt");const w=await r({source_id:g.id,source_type:"Prompt",node_type:q.Prompt,x:f,y:m+20});if(!w)throw new Error("Failed to save prompt node");const E=await me("FlowNodePlaceholder").save({placeholder:`Retriever for ${v.name}`,placeholder_type:sn.VECTOR_DATABASE_RETREIVER,session_id:e,metadata:c});if(!E)throw new Error("Failed to save node placeholder");const O=await r({source_id:E.id,source_type:"FlowNodePlaceholder",node_type:q.PlaceHolder,x:f,y:m+40});if(!O)throw new Error("Failed to save node placeholder node");await n({source:w.id,target:O.id}),await n({source:o.id,target:O.id})}finally{a(!1)}},[e,r,n]);return{loading:t,createVectorDatabaseRetriever:i}},a0=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}
`,n0=ri(e=>{const{source:t}=e,a=ea(),{toast:r}=It(),{t:n}=De("dialogs"),[i,s]=b.useState(1),[o,c]=b.useState(void 0),{loading:l,createVectorDatabaseRetriever:u}=r0(),p=async f=>{try{const m=f.content;if(!m||!m.includes("{context}")){r({title:n("create_vector_database_retriever.errors.fill_context"),variant:"destructive"});return}return await u({source:t,prompt:{content:m},metadata:{k:i,minimalScore:o}}),s(1),c(void 0),a.hide(),!0}catch{r({title:n("create_vector_database_retriever.errors.create_failed"),variant:"destructive"})}},h=f=>{s(f.target.value?Number(f.target.value):void 0)},v=f=>{c(f.target.value?Number(f.target.value):void 0)};return d.jsx(ci,{open:a.visible,onOpenChange:a.hide,children:d.jsxs(di,{className:"sm:max-w-[425px]",children:[d.jsx(li,{children:d.jsxs("div",{className:"flex",children:[d.jsx(we,{name:"file",className:"mr-2 h-4 w-4"}),d.jsx(ui,{children:n("create_vector_database_retriever.title")})]})}),d.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[d.jsx(Vi,{onSubmit:p,loading:l,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:a0}),d.jsxs(st,{children:[d.jsx(Et,{children:d.jsx(Pt,{children:n("create_vector_database_retriever.retriever_settings")})}),d.jsxs(St,{children:[d.jsx(Se,{children:n("create_vector_database_retriever.retriever_k")}),d.jsx(ft,{value:i||"",type:"number",onChange:h,placeholder:n("create_vector_database_retriever.retriever_k_placeholder")}),d.jsx(Se,{children:n("create_vector_database_retriever.retriever_minimum_score")}),d.jsx(ft,{value:o||"",type:"number",onChange:v,placeholder:n("create_vector_database_retriever.retriever_minimum_score_placeholder")})]})]}),d.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[d.jsx(we,{name:"info",className:"mr-2",size:14}),n("create_vector_database_retriever.fill_content_note")]})]})]})})}),ql=()=>{const{getNodes:e}=Yt(),t=b.useCallback(()=>e().find(r=>r.type===q.DefaultEmbeddingModel),[e]),a=b.useCallback(()=>{var r,n;return(n=(r=t())==null?void 0:r.data)==null?void 0:n.entity},[t]);return{getFlowEmbeddingNode:t,getFlowEmbeddingEntity:a}},s0=e=>{const t=ye(i=>i.createOrUpdateFlowEdge),{getFlowEmbeddingEntity:a}=ql(),{confirmPassphrase:r}=Sa(),n=b.useCallback(async({edgeId:i,target:s,source:o})=>{var c,l;try{const u=(c=s==null?void 0:s.data)==null?void 0:c.entity;if((o==null?void 0:o.type)===q.CSVData&&(s==null?void 0:s.type)===q.VectorDatabase){const p=(l=o==null?void 0:o.data)==null?void 0:l.entity;if(!p||!u)return{deleteEdgeId:i};const{rows:h}=Xm(p.headers,p.csv),v=h.map(f=>new Ym({pageContent:`${f.text}`}));await r(),await ja.index(a(),{database:{databaseId:u.id,dataSourceId:p.id,dataSourceType:"CSVData"}},v),await t({source:o.id,target:s.id});return}return{deleteEdgeId:i}}catch{return{deleteEdgeId:i}}},[t,a,r]);Ct(e,n)},i0=e=>{const[t,a]=b.useState(!1),{t:r}=De("flows"),{toast:n}=It(),{getNode:i,getHandleConnections:s}=Yt(),o=ye(h=>h.updateNodes),{getFlowEmbeddingEntity:c}=ql(),{confirmPassphrase:l}=Sa(),u=b.useCallback(async(h,v)=>{var f,m,g;try{const w=i(e);if(!w)return;const E=(f=w.data)==null?void 0:f.entity;if(!E){n({variant:"destructive",title:r("vector_database_node.errors.vector_database_not_found")});return}const O=c();if(E.storage===na.DataNode){const x=(g=(m=s({nodeId:e,type:"target"}).map(k=>i(k.source)).find(k=>(k==null?void 0:k.type)&&[q.JSONLData,q.CSVData].includes(k==null?void 0:k.type)))==null?void 0:m.data)==null?void 0:g.entity;if(!x){n({variant:"destructive",title:r("vector_database_node.errors.data_node_not_found")});return}return a(!0),await l(),await ja.similaritySearchWithScore(O,{database:{databaseId:E.id,dataSourceId:x.id,dataSourceType:Yc(x)}},h,v==null?void 0:v.k)}else return a(!0),await l(),await ja.similaritySearchWithScore(O,{database:{databaseId:E.id}},h,v==null?void 0:v.k)}catch{n({variant:"destructive",title:r("vector_database_node.errors.similarity_search_failed")})}finally{a(!1)}},[i,e,c,n,r,s,l]),p=b.useCallback(async(h,v)=>{var f,m,g,w;try{const E=i(e);if(!E)return;a(!0);const O=h.content?[new Ym({pageContent:h.content,id:h.id,metadata:{id:h.id}})]:h.documents;if(!(O!=null&&O.length)){n({variant:"destructive",title:r("vector_database_node.errors.content_not_found")});return}const x=(f=E.data)==null?void 0:f.entity;if(!x||!E){n({variant:"destructive",title:r("vector_database_node.errors.vector_database_not_found")});return}const k=c();if(x.storage===na.DataNode){const $=s({nodeId:e,type:"target"}).map(R=>i(R.source)).find(R=>(R==null?void 0:R.type)&&[q.JSONLData,q.CSVData].includes(R==null?void 0:R.type)),N=(m=$==null?void 0:$.data)==null?void 0:m.entity;if(!N){n({variant:"destructive",title:r("vector_database_node.errors.data_node_not_found")});return}const M=Yc(N),A=Fm(O,10);let I=0;for(const R of A){if((g=v==null?void 0:v.onProgressReport)==null||g.call(v,{handling:R.length,handled:I,total:O.length}),await l(),await ja.index(k,{database:{databaseId:x.id,dataSourceId:N.id,dataSourceType:M}},R),M&&$){const z=await me(M).findOne({where:{id:N.id}});o([{type:"replace",id:$.id,item:{...$,data:{...$.data,entity:z}}}])}I+=R.length}}else{const $=Fm(O,10);let N=0;for(const M of $){(w=v==null?void 0:v.onProgressReport)==null||w.call(v,{handling:M.length,handled:N,total:O.length}),await l(),await ja.index(k,{database:{databaseId:x.id}},M);const A=await me("VectorDatabase").findOne({where:{id:`${x.id}`}});o([{type:"replace",id:E.id,item:{...E,data:{...E.data,entity:A}}}]),N+=M.length}}}catch{n({variant:"destructive",title:r("vector_database_node.errors.similarity_search_failed")})}finally{a(!1)}},[i,e,c,n,r,s,o,l]);return{loading:t,indexData:p,similaritySearchWithScore:u}},o0=b.memo(e=>{var $,N,M,A;const{t}=De("flows"),[a,r]=b.useState(0),[n,i]=b.useState("search"),s=_t(e.id),{id:o,data:c,isConnectable:l}=e,{loading:u,similaritySearchWithScore:p,indexData:h}=i0(o),v=ea(t0),f=ea(n0);s0(o);const m=b.useCallback(async(...I)=>{s&&await h(...I)},[h,s]),g=b.useCallback(async(I,R)=>{const z=I.trim(),F=await p(z,{k:R});if(F!=null&&F.length)return F},[p]),w=b.useCallback(I=>{v.show({source:s,documents:I.map(([R])=>R)})},[v,s]),E=b.useCallback(async()=>{f.show({source:s})},[f,s]),O=b.useCallback(async I=>{if(I.type.includes("text")||I.type.includes("txt")){const R=new FileReader;R.onload=async z=>{var U;const F=(U=z.target)==null?void 0:U.result;await m({content:F})},R.readAsText(I)}else if(I.type.endsWith("pdf")){const R=new Blob([I],{type:"application/pdf"}),z=await new lE(R,{pdfjs:async()=>{const F=await Lt(()=>import("./pdf.min-CuXHMbRf.js").then(async U=>(await U.__tla,U)),__vite__mapDeps([10,2,3,1,4,5,6]));return await Lt(()=>import("./pdf.worker.min-C3F6LUbf.js").then(async U=>(await U.__tla,U)),__vite__mapDeps([11,1,2,3,4,5,6])),F.GlobalWorkerOptions.workerSrc=new URL("pdfjs-dist/build/pdf.worker.min.js",import.meta.url).toString(),F},parsedItemSeparator:" "}).load();await m({documents:z},{onProgressReport:F=>{r((F.handled+F.handling)/F.total)}})}},[m]),x=b.useMemo(()=>{var z,F;if(!((z=c==null?void 0:c.entity)!=null&&z.raw))return{headers:[],rows:[]};const I=["content","embedding","metadata"],R=ed((F=c==null?void 0:c.entity)==null?void 0:F.raw);return{headers:I,rows:R.map(U=>{try{return JSON.parse(U)}catch{return[]}})}},[($=c==null?void 0:c.entity)==null?void 0:$.raw]),k=b.useMemo(()=>{switch(n){case"search":return d.jsx(Pr,{value:"search",children:d.jsx(pE,{loading:u,onSimilaritySearch:g,onCreatePrompt:w,onCreateRetriever:E})});case"new":return d.jsx(Pr,{className:"min-w-80",value:"new",children:d.jsx(hE,{loading:u,onCreateData:m})});case"file":return d.jsx(Pr,{value:"file",children:d.jsx(uE,{loading:u,progress:a,onFileSubmit:O,fileOptions:{accept:".pdf,.txt,.text",maxSize:15}})});case"view":return d.jsx(Pr,{value:"view",children:d.jsx(Qc,{data:x.rows,headers:x.headers,limitLengthByColumns:{embedding:32}})})}},[m,w,E,O,g,u,n,a,x]);return d.jsxs("div",{className:"min-w-72",children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:l}),d.jsxs("div",{className:"max-w-full",children:[d.jsx(xt,{id:o}),d.jsxs(Ut,{className:"flex justify-center",variant:"default",children:[d.jsx(we,{size:24,name:"database-zap"}),d.jsxs("div",{className:"ml-2 max-w-full",children:[d.jsx(Nr,{children:`${((N=c.entity)==null?void 0:N.name)||""}`}),d.jsxs(si,{value:n,onValueChange:i,defaultValue:"search",className:Ve("w-full mt-4"),children:[d.jsxs(Jc,{className:Ve("grid w-full grid-cols-3",((M=c.entity)==null?void 0:M.storage)===na.DatabaseNode?"grid-cols-4":"grid-cols-3"),children:[d.jsx(Cr,{value:"search",children:t("vector_database_node.search")}),d.jsx(Cr,{value:"new",children:t("vector_database_node.text")}),d.jsx(Cr,{value:"file",children:t("vector_database_node.file")}),((A=c.entity)==null?void 0:A.storage)===na.DatabaseNode?d.jsx(Cr,{value:"view",children:t("vector_database_node.view")}):void 0]}),k]})]})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:l})]})}),c0={embedding:32},d0=b.memo(e=>{var i,s,o;const{id:t,data:a,isConnectable:r}=e,n=b.useMemo(()=>{var u;if(!((u=a==null?void 0:a.entity)!=null&&u.jsonl))return{headers:[],rows:[]};const c=td(a.entity.headers||""),l=ed(a.entity.jsonl);return{headers:c,rows:l.map(p=>{try{return JSON.parse(p)}catch{return[]}})}},[(i=a==null?void 0:a.entity)==null?void 0:i.jsonl,a.entity.headers]);return d.jsxs("div",{className:"min-w-80",children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsxs("div",{children:[d.jsx(xt,{id:t}),d.jsxs(st,{className:"min-w-32 min-h-16 p-4",children:[d.jsx(Et,{className:"!p-0",children:d.jsxs("div",{className:"pt-2 flex !flex-row",children:[d.jsx(we,{name:"file-json",className:"mr-2"}),d.jsxs(Se,{className:"!font-medium leading-none tracking-tight pr-8",children:[q.JSONLData," ",(s=n==null?void 0:n.rows)!=null&&s.length?`(${((o=n==null?void 0:n.rows)==null?void 0:o.length)||0})`:""]})]})}),d.jsx(St,{className:"pb-0",children:d.jsx(Qc,{data:n.rows,headers:n.headers,limitLengthByColumns:c0})})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})}),l0=e=>{const t=b.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);Ct(e,t)},u0=b.memo(e=>{var s,o;const{id:t,data:a,isConnectable:r}=e,{t:n}=De("flows");l0(t);let i="";switch((s=a.entity)==null?void 0:s.placeholder_type){case"VECTOR_DATABASE_RETREIVER":i=n("placeholder_node.vector_database_retriever");break}return d.jsxs("div",{children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsxs(Ut,{className:"flex justify-center max-w-80",variant:"default",children:[d.jsx(xt,{id:t}),d.jsx(we,{name:"land-plot",className:"w-7 h-7"}),d.jsxs("div",{className:"ml-2 pr-4",children:[d.jsx(Nr,{children:`${((o=a.entity)==null?void 0:o.placeholder)||""}`}),d.jsx(Ea,{children:i?d.jsx(aa,{children:i}):void 0})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:r})]})}),h0=e=>{const t=b.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);Ct(e,t)},Vl=(e,t)=>e.anyOf.length?e.anyOf.length===1?wt(e.anyOf[0],{...t,path:[...t.path,"anyOf",0]}):`z.union([${e.anyOf.map((a,r)=>wt(a,{...t,path:[...t.path,"anyOf",r]})).join(", ")}])`:"z.any()",p0=e=>"z.boolean()",m0=e=>"z.any()",f0=(e,t)=>`z.union([${e.type.map(a=>wt({...e,type:a},{...t,withoutDefaults:!0})).join(", ")}])`,v0=(e,t)=>`z.any().refine((value) => !${wt(e.not,{...t,path:[...t.path,"not"]})}.safeParse(value).success, "Invalid input: Should NOT be valid against schema")`,g0=e=>"z.null()",y0=e=>[e.slice(0,e.length/2),e.slice(e.length/2)],In=Symbol("Original index"),_0=e=>{let t=[];for(let a=0;a<e.length;a++){const r=e[a];if(typeof r=="boolean")t.push(r?{[In]:a}:{[In]:a,not:{}});else{if(In in r)return e;t.push({...r,[In]:a})}}return t};function Cs(e,t){if(e.allOf.length===0)return"z.never()";if(e.allOf.length===1){const a=e.allOf[0];return wt(a,{...t,path:[...t.path,"allOf",a[In]]})}else{const[a,r]=y0(_0(e.allOf));return`z.intersection(${Cs({allOf:a},t)}, ${Cs({allOf:r},t)})`}}function bt(e,t,a){var i;const r=e[t];let n="";if(r!==void 0){const s=a({value:r,json:JSON.stringify(r)});if(s){const o=s[0],c=s.length===3?s[1]:"",l=s.length===3?s[2]:s[1];n+=o,((i=e.errorMessage)==null?void 0:i[t])!==void 0&&(n+=c+JSON.stringify(e.errorMessage[t])),n+=l}}return n}const b0=(e,t)=>{if(Array.isArray(e.items))return`z.tuple([${e.items.map((r,n)=>wt(r,{...t,path:[...t.path,"items",n]}))}])`;let a=e.items?`z.array(${wt(e.items,{...t,path:[...t.path,"items"]})})`:"z.array(z.any())";return a+=bt(e,"minItems",({json:r})=>[`.min(${r}`,", ",")"]),a+=bt(e,"maxItems",({json:r})=>[`.max(${r}`,", ",")"]),a},w0=e=>`z.literal(${JSON.stringify(e.const)})`,x0=e=>e.enum.length===0?"z.never()":e.enum.length===1?`z.literal(${JSON.stringify(e.enum[0])})`:e.enum.every(t=>typeof t=="string")?`z.enum([${e.enum.map(t=>JSON.stringify(t))}])`:`z.union([${e.enum.map(t=>`z.literal(${JSON.stringify(t)})`).join(", ")}])`,j0=(e,t)=>{const a=wt(e.if,{...t,path:[...t.path,"if"]}),r=wt(e.then,{...t,path:[...t.path,"then"]}),n=wt(e.else,{...t,path:[...t.path,"else"]});return`z.union([${r}, ${n}]).superRefine((value,ctx) => {
  const result = ${a}.safeParse(value).success
    ? ${r}.safeParse(value)
    : ${n}.safeParse(value);
  if (!result.success) {
    result.error.errors.forEach((error) => ctx.addIssue(error))
  }
})`},E0=e=>{let t="z.number()";return e.type==="integer"?t+=bt(e,"type",()=>[".int(",")"]):t+=bt(e,"format",({value:a})=>{if(a==="int64")return[".int(",")"]}),t+=bt(e,"multipleOf",({value:a,json:r})=>a===1?t.startsWith("z.number().int(")?void 0:[".int(",")"]:[`.multipleOf(${r}`,", ",")"]),typeof e.minimum=="number"?e.exclusiveMinimum===!0?t+=bt(e,"minimum",({json:a})=>[`.gt(${a}`,", ",")"]):t+=bt(e,"minimum",({json:a})=>[`.gte(${a}`,", ",")"]):typeof e.exclusiveMinimum=="number"&&(t+=bt(e,"exclusiveMinimum",({json:a})=>[`.gt(${a}`,", ",")"])),typeof e.maximum=="number"?e.exclusiveMaximum===!0?t+=bt(e,"maximum",({json:a})=>[`.lt(${a}`,", ",")"]):t+=bt(e,"maximum",({json:a})=>[`.lte(${a}`,", ",")"]):typeof e.exclusiveMaximum=="number"&&(t+=bt(e,"exclusiveMaximum",({json:a})=>[`.lt(${a}`,", ",")"])),t},Bl=(e,t)=>e.oneOf.length?e.oneOf.length===1?wt(e.oneOf[0],{...t,path:[...t.path,"oneOf",0]}):`z.any().superRefine((x, ctx) => {
    const schemas = [${e.oneOf.map((a,r)=>wt(a,{...t,path:[...t.path,"oneOf",r]})).join(", ")}];
    const errors = schemas.reduce<z.ZodError[]>(
      (errors, schema) =>
        ((result) =>
          result.error ? [...errors, result.error] : errors)(
          schema.safeParse(x),
        ),
      [],
    );
    if (schemas.length - errors.length !== 1) {
      ctx.addIssue({
        path: ctx.path,
        code: "invalid_union",
        unionErrors: errors,
        message: "Invalid input: Should pass single schema",
      });
    }
  })`:"z.any()",Wl=e=>{const t=e.split(`
`);return`/**${t.length===1?t[0]:`
${t.map(a=>`* ${a}`).join(`
`)}
`}*/
`},S0=(e,t)=>{const a=e.description;return a?`
${Wl(a)}${t}`:t};function k0(e,t){let a;e.properties&&(Object.keys(e.properties).length?(a="z.object({ ",a+=Object.keys(e.properties).map(s=>{const o=e.properties[s];let c=`${JSON.stringify(s)}: ${wt(o,{...t,path:[...t.path,"properties",s]})}`;t.withJsdocs&&typeof o=="object"&&(c=S0(o,c));const l=typeof o=="object"&&o.default!==void 0,u=Array.isArray(e.required)?e.required.includes(s):typeof o=="object"&&o.required===!0;return!l&&!u?`${c}.optional()`:c}).join(", "),a+=" })"):a="z.object({})");const r=e.additionalProperties!==void 0?wt(e.additionalProperties,{...t,path:[...t.path,"additionalProperties"]}):void 0;let n;if(e.patternProperties){const s=Object.fromEntries(Object.entries(e.patternProperties).map(([o,c])=>[o,wt(c,{...t,path:[...t.path,"patternProperties",o]})],{}));n="",a?r?n+=`.catchall(z.union([${[...Object.values(s),r].join(", ")}]))`:Object.keys(s).length>1?n+=`.catchall(z.union([${Object.values(s).join(", ")}]))`:n+=`.catchall(${Object.values(s)})`:r?n+=`z.record(z.union([${[...Object.values(s),r].join(", ")}]))`:Object.keys(s).length>1?n+=`z.record(z.union([${Object.values(s).join(", ")}]))`:n+=`z.record(${Object.values(s)})`,n+=`.superRefine((value, ctx) => {
`,n+=`for (const key in value) {
`,r&&(e.properties?n+=`let evaluated = [${Object.keys(e.properties).map(o=>JSON.stringify(o)).join(", ")}].includes(key)
`:n+=`let evaluated = false
`);for(const o in e.patternProperties)n+="if (key.match(new RegExp("+JSON.stringify(o)+`))) {
`,r&&(n+=`evaluated = true
`),n+="const result = "+s[o]+`.safeParse(value[key])
`,n+=`if (!result.success) {
`,n+=`ctx.addIssue({
          path: [...ctx.path, key],
          code: 'custom',
          message: \`Invalid input: Key matching regex /\${key}/ must match schema\`,
          params: {
            issues: result.error.issues
          }
        })
`,n+=`}
`,n+=`}
`;r&&(n+=`if (!evaluated) {
`,n+="const result = "+r+`.safeParse(value[key])
`,n+=`if (!result.success) {
`,n+=`ctx.addIssue({
          path: [...ctx.path, key],
          code: 'custom',
          message: \`Invalid input: must match catchall schema\`,
          params: {
            issues: result.error.issues
          }
        })
`,n+=`}
`,n+=`}
`),n+=`}
`,n+="})"}let i=a?n?a+n:r?r==="z.never()"?a+".strict()":a+`.catchall(${r})`:a:n||(r?`z.record(${r})`:"z.record(z.any())");return vt.an.anyOf(e)&&(i+=`.and(${Vl({...e,anyOf:e.anyOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},t)})`),vt.a.oneOf(e)&&(i+=`.and(${Bl({...e,oneOf:e.oneOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},t)})`),vt.an.allOf(e)&&(i+=`.and(${Cs({...e,allOf:e.allOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},t)})`),i}const C0=e=>{let t="z.string()";t+=bt(e,"format",({value:r})=>{switch(r){case"email":return[".email(",")"];case"ip":return[".ip(",")"];case"ipv4":return['.ip({ version: "v4"',", message: "," })"];case"ipv6":return['.ip({ version: "v6"',", message: "," })"];case"uri":return[".url(",")"];case"uuid":return[".uuid(",")"];case"date-time":return[".datetime({ offset: true",", message: "," })"];case"time":return[".time(",")"];case"date":return[".date(",")"];case"binary":return[".base64(",")"];case"duration":return[".duration(",")"]}}),t+=bt(e,"pattern",({json:r})=>[`.regex(new RegExp(${r})`,", ",")"]),t+=bt(e,"minLength",({json:r})=>[`.min(${r}`,", ",")"]),t+=bt(e,"maxLength",({json:r})=>[`.max(${r}`,", ",")"]),t+=bt(e,"contentEncoding",({value:r})=>{if(r==="base64")return[".base64(",")"]});const a=bt(e,"contentMediaType",({value:r})=>{if(r==="application/json")return['.transform((str, ctx) => { try { return JSON.parse(str); } catch (err) { ctx.addIssue({ code: "custom", message: "Invalid JSON" }); }}',", ",")"]});return a!=""&&(t+=a,t+=bt(e,"contentSchema",({value:r})=>{if(r&&r instanceof Object)return[`.pipe(${wt(r)}`,", ",")"]})),t},P0=(e,...t)=>Object.keys(e).reduce((a,r)=>(t.includes(r)||(a[r]=e[r]),a),{}),N0=(e,t)=>`${wt(P0(e,"nullable"),t,!0)}.nullable()`,wt=(e,t={seen:new Map,path:[]},a)=>{if(typeof e!="object")return e?"z.any()":"z.never()";if(t.parserOverride){const i=t.parserOverride(e,t);if(typeof i=="string")return i}let r=t.seen.get(e);if(r){if(r.r!==void 0)return r.r;if(t.depth===void 0||r.n>=t.depth)return"z.any()";r.n+=1}else r={r:void 0,n:0},t.seen.set(e,r);let n=T0(e,t);return a||(t.withoutDescribes||(n=O0(e,n)),t.withoutDefaults||(n=$0(e,n)),n=R0(e,n)),r.r=n,n},O0=(e,t)=>(e.description&&(t+=`.describe(${JSON.stringify(e.description)})`),t),$0=(e,t)=>(e.default!==void 0&&(t+=`.default(${JSON.stringify(e.default)})`),t),R0=(e,t)=>(e.readOnly&&(t+=".readonly()"),t),T0=(e,t)=>vt.a.nullable(e)?N0(e,t):vt.an.object(e)?k0(e,t):vt.an.array(e)?b0(e,t):vt.an.anyOf(e)?Vl(e,t):vt.an.allOf(e)?Cs(e,t):vt.a.oneOf(e)?Bl(e,t):vt.a.not(e)?v0(e,t):vt.an.enum(e)?x0(e):vt.a.const(e)?w0(e):vt.a.multipleType(e)?f0(e,t):vt.a.primitive(e,"string")?C0(e):vt.a.primitive(e,"number")||vt.a.primitive(e,"integer")?E0(e):vt.a.primitive(e,"boolean")?p0():vt.a.primitive(e,"null")?g0():vt.a.conditional(e)?j0(e,t):m0(),vt={an:{object:e=>e.type==="object",array:e=>e.type==="array",anyOf:e=>e.anyOf!==void 0,allOf:e=>e.allOf!==void 0,enum:e=>e.enum!==void 0},a:{nullable:e=>e.nullable===!0,multipleType:e=>Array.isArray(e.type),not:e=>e.not!==void 0,const:e=>e.const!==void 0,primitive:(e,t)=>e.type===t,conditional:e=>!!("if"in e&&e.if&&"then"in e&&"else"in e&&e.then&&e.else),oneOf:e=>e.oneOf!==void 0}},I0=(e,{module:t,name:a,type:r,noImport:n,...i}={})=>{if(r&&(!a||t!=="esm"))throw new Error("Option `type` requires `name` to be set and `module` to be `esm`");let s=wt(e,{module:t,name:a,path:[],seen:new Map,...i});const o=i.withJsdocs&&typeof e!="boolean"&&e.description?Wl(e.description):"";if(t==="cjs"?(s=`${o}module.exports = ${a?`{ ${JSON.stringify(a)}: ${s} }`:s}
`,n||(s=`${o}const { z } = require("zod")

${s}`)):t==="esm"?(s=`${o}export ${a?`const ${a} =`:"default"} ${s}
`,n||(s=`import { z } from "zod"

${s}`)):a&&(s=`${o}const ${a} = ${s}`),r&&a){let c=typeof r=="string"?r:`${a[0].toUpperCase()}${a.substring(1)}`;s+=`export type ${c} = z.infer<typeof ${a}>
`}return s},Ps="2025-06-18",L0=[Ps,"2025-03-26","2024-11-05","2024-10-07"],Ns="2.0",Kl=y.union([y.string(),y.number().int()]),Jl=y.string(),M0=y.object({progressToken:y.optional(Kl)}).passthrough(),Kt=y.object({_meta:y.optional(M0)}).passthrough(),At=y.object({method:y.string(),params:y.optional(Kt)}),Ln=y.object({_meta:y.optional(y.object({}).passthrough())}).passthrough(),mr=y.object({method:y.string(),params:y.optional(Ln)}),Jt=y.object({_meta:y.optional(y.object({}).passthrough())}).passthrough(),Os=y.union([y.string(),y.number().int()]),Ql=y.object({jsonrpc:y.literal(Ns),id:Os}).merge(At).strict(),Gl=e=>Ql.safeParse(e).success,Xl=y.object({jsonrpc:y.literal(Ns)}).merge(mr).strict(),D0=e=>Xl.safeParse(e).success,Yl=y.object({jsonrpc:y.literal(Ns),id:Os,result:Jt}).strict(),Wi=e=>Yl.safeParse(e).success;var fr;(function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"})(fr||(fr={}));const eu=y.object({jsonrpc:y.literal(Ns),id:Os,error:y.object({code:y.number().int(),message:y.string(),data:y.optional(y.unknown())})}).strict(),A0=e=>eu.safeParse(e).success,Mn=y.union([Ql,Xl,Yl,eu]),Da=Jt.strict(),Ki=mr.extend({method:y.literal("notifications/cancelled"),params:Ln.extend({requestId:Os,reason:y.string().optional()})}),Dn=y.object({name:y.string(),title:y.optional(y.string())}).passthrough(),tu=Dn.extend({version:y.string()}),F0=y.object({experimental:y.optional(y.object({}).passthrough()),sampling:y.optional(y.object({}).passthrough()),elicitation:y.optional(y.object({}).passthrough()),roots:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough())}).passthrough(),z0=At.extend({method:y.literal("initialize"),params:Kt.extend({protocolVersion:y.string(),capabilities:F0,clientInfo:tu})}),Z0=y.object({experimental:y.optional(y.object({}).passthrough()),logging:y.optional(y.object({}).passthrough()),completions:y.optional(y.object({}).passthrough()),prompts:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough()),resources:y.optional(y.object({subscribe:y.optional(y.boolean()),listChanged:y.optional(y.boolean())}).passthrough()),tools:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough())}).passthrough(),ru=Jt.extend({protocolVersion:y.string(),capabilities:Z0,serverInfo:tu,instructions:y.optional(y.string())}),au=mr.extend({method:y.literal("notifications/initialized")}),U0=e=>au.safeParse(e).success,Ji=At.extend({method:y.literal("ping")}),H0=y.object({progress:y.number(),total:y.optional(y.number()),message:y.optional(y.string())}).passthrough(),Qi=mr.extend({method:y.literal("notifications/progress"),params:Ln.merge(H0).extend({progressToken:Kl})}),$s=At.extend({params:Kt.extend({cursor:y.optional(Jl)}).optional()}),Rs=Jt.extend({nextCursor:y.optional(Jl)}),nu=y.object({uri:y.string(),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}).passthrough(),su=nu.extend({text:y.string()}),iu=nu.extend({blob:y.string().base64()}),ou=Dn.extend({uri:y.string(),description:y.optional(y.string()),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}),q0=Dn.extend({uriTemplate:y.string(),description:y.optional(y.string()),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}),V0=$s.extend({method:y.literal("resources/list")}),cu=Rs.extend({resources:y.array(ou)}),B0=$s.extend({method:y.literal("resources/templates/list")}),du=Rs.extend({resourceTemplates:y.array(q0)}),W0=At.extend({method:y.literal("resources/read"),params:Kt.extend({uri:y.string()})}),lu=Jt.extend({contents:y.array(y.union([su,iu]))}),K0=mr.extend({method:y.literal("notifications/resources/list_changed")}),J0=At.extend({method:y.literal("resources/subscribe"),params:Kt.extend({uri:y.string()})}),Q0=At.extend({method:y.literal("resources/unsubscribe"),params:Kt.extend({uri:y.string()})}),G0=mr.extend({method:y.literal("notifications/resources/updated"),params:Ln.extend({uri:y.string()})}),X0=y.object({name:y.string(),description:y.optional(y.string()),required:y.optional(y.boolean())}).passthrough(),Y0=Dn.extend({description:y.optional(y.string()),arguments:y.optional(y.array(X0)),_meta:y.optional(y.object({}).passthrough())}),eb=$s.extend({method:y.literal("prompts/list")}),uu=Rs.extend({prompts:y.array(Y0)}),tb=At.extend({method:y.literal("prompts/get"),params:Kt.extend({name:y.string(),arguments:y.optional(y.record(y.string()))})}),Gi=y.object({type:y.literal("text"),text:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Xi=y.object({type:y.literal("image"),data:y.string().base64(),mimeType:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Yi=y.object({type:y.literal("audio"),data:y.string().base64(),mimeType:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),rb=y.object({type:y.literal("resource"),resource:y.union([su,iu]),_meta:y.optional(y.object({}).passthrough())}).passthrough(),ab=ou.extend({type:y.literal("resource_link")}),hu=y.union([Gi,Xi,Yi,ab,rb]),nb=y.object({role:y.enum(["user","assistant"]),content:hu}).passthrough(),pu=Jt.extend({description:y.optional(y.string()),messages:y.array(nb)}),sb=mr.extend({method:y.literal("notifications/prompts/list_changed")}),ib=y.object({title:y.optional(y.string()),readOnlyHint:y.optional(y.boolean()),destructiveHint:y.optional(y.boolean()),idempotentHint:y.optional(y.boolean()),openWorldHint:y.optional(y.boolean())}).passthrough(),ob=Dn.extend({description:y.optional(y.string()),inputSchema:y.object({type:y.literal("object"),properties:y.optional(y.object({}).passthrough()),required:y.optional(y.array(y.string()))}).passthrough(),outputSchema:y.optional(y.object({type:y.literal("object"),properties:y.optional(y.object({}).passthrough()),required:y.optional(y.array(y.string()))}).passthrough()),annotations:y.optional(ib),_meta:y.optional(y.object({}).passthrough())}),cb=$s.extend({method:y.literal("tools/list")}),mu=Rs.extend({tools:y.array(ob)}),Ts=Jt.extend({content:y.array(hu).default([]),structuredContent:y.object({}).passthrough().optional(),isError:y.optional(y.boolean())});Ts.or(Jt.extend({toolResult:y.unknown()}));const db=At.extend({method:y.literal("tools/call"),params:Kt.extend({name:y.string(),arguments:y.optional(y.record(y.unknown()))})}),lb=mr.extend({method:y.literal("notifications/tools/list_changed")}),fu=y.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),ub=At.extend({method:y.literal("logging/setLevel"),params:Kt.extend({level:fu})}),hb=mr.extend({method:y.literal("notifications/message"),params:Ln.extend({level:fu,logger:y.optional(y.string()),data:y.unknown()})}),pb=y.object({name:y.string().optional()}).passthrough(),mb=y.object({hints:y.optional(y.array(pb)),costPriority:y.optional(y.number().min(0).max(1)),speedPriority:y.optional(y.number().min(0).max(1)),intelligencePriority:y.optional(y.number().min(0).max(1))}).passthrough(),fb=y.object({role:y.enum(["user","assistant"]),content:y.union([Gi,Xi,Yi])}).passthrough(),vb=At.extend({method:y.literal("sampling/createMessage"),params:Kt.extend({messages:y.array(fb),systemPrompt:y.optional(y.string()),includeContext:y.optional(y.enum(["none","thisServer","allServers"])),temperature:y.optional(y.number()),maxTokens:y.number().int(),stopSequences:y.optional(y.array(y.string())),metadata:y.optional(y.object({}).passthrough()),modelPreferences:y.optional(mb)})}),gb=Jt.extend({model:y.string(),stopReason:y.optional(y.enum(["endTurn","stopSequence","maxTokens"]).or(y.string())),role:y.enum(["user","assistant"]),content:y.discriminatedUnion("type",[Gi,Xi,Yi])}),yb=y.object({type:y.literal("boolean"),title:y.optional(y.string()),description:y.optional(y.string()),default:y.optional(y.boolean())}).passthrough(),_b=y.object({type:y.literal("string"),title:y.optional(y.string()),description:y.optional(y.string()),minLength:y.optional(y.number()),maxLength:y.optional(y.number()),format:y.optional(y.enum(["email","uri","date","date-time"]))}).passthrough(),bb=y.object({type:y.enum(["number","integer"]),title:y.optional(y.string()),description:y.optional(y.string()),minimum:y.optional(y.number()),maximum:y.optional(y.number())}).passthrough(),wb=y.object({type:y.literal("string"),title:y.optional(y.string()),description:y.optional(y.string()),enum:y.array(y.string()),enumNames:y.optional(y.array(y.string()))}).passthrough(),xb=y.union([yb,_b,bb,wb]),jb=At.extend({method:y.literal("elicitation/create"),params:Kt.extend({message:y.string(),requestedSchema:y.object({type:y.literal("object"),properties:y.record(y.string(),xb),required:y.optional(y.array(y.string()))}).passthrough()})}),Eb=Jt.extend({action:y.enum(["accept","decline","cancel"]),content:y.optional(y.record(y.string(),y.unknown()))}),Sb=y.object({type:y.literal("ref/resource"),uri:y.string()}).passthrough(),kb=y.object({type:y.literal("ref/prompt"),name:y.string()}).passthrough(),Cb=At.extend({method:y.literal("completion/complete"),params:Kt.extend({ref:y.union([kb,Sb]),argument:y.object({name:y.string(),value:y.string()}).passthrough(),context:y.optional(y.object({arguments:y.optional(y.record(y.string(),y.string()))}))})}),vu=Jt.extend({completion:y.object({values:y.array(y.string()).max(100),total:y.optional(y.number().int()),hasMore:y.optional(y.boolean())}).passthrough()}),Pb=y.object({uri:y.string().startsWith("file://"),name:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Nb=At.extend({method:y.literal("roots/list")}),Ob=Jt.extend({roots:y.array(Pb)}),$b=mr.extend({method:y.literal("notifications/roots/list_changed")});y.union([Ji,z0,Cb,ub,tb,eb,V0,B0,W0,J0,Q0,db,cb]),y.union([Ki,Qi,au,$b]),y.union([Da,gb,Eb,Ob]),y.union([Ji,vb,jb,Nb]),y.union([Ki,Qi,hb,G0,K0,lb,sb]),y.union([Da,ru,vu,pu,uu,cu,du,lu,Ts,mu]);class Br extends Error{constructor(t,a,r){super(`MCP error ${t}: ${a}`),this.code=t,this.data=r,this.name="McpError"}}const Rb=6e4;class Tb{constructor(t){this._options=t,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this.setNotificationHandler(Ki,a=>{const r=this._requestHandlerAbortControllers.get(a.params.requestId);r==null||r.abort(a.params.reason)}),this.setNotificationHandler(Qi,a=>{this._onprogress(a)}),this.setRequestHandler(Ji,a=>({}))}_setupTimeout(t,a,r,n,i=!1){this._timeoutInfo.set(t,{timeoutId:setTimeout(n,a),startTime:Date.now(),timeout:a,maxTotalTimeout:r,resetTimeoutOnProgress:i,onTimeout:n})}_resetTimeout(t){const a=this._timeoutInfo.get(t);if(!a)return!1;const r=Date.now()-a.startTime;if(a.maxTotalTimeout&&r>=a.maxTotalTimeout)throw this._timeoutInfo.delete(t),new Br(fr.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:a.maxTotalTimeout,totalElapsed:r});return clearTimeout(a.timeoutId),a.timeoutId=setTimeout(a.onTimeout,a.timeout),!0}_cleanupTimeout(t){const a=this._timeoutInfo.get(t);a&&(clearTimeout(a.timeoutId),this._timeoutInfo.delete(t))}async connect(t){var a,r,n;this._transport=t;const i=(a=this.transport)===null||a===void 0?void 0:a.onclose;this._transport.onclose=()=>{i==null||i(),this._onclose()};const s=(r=this.transport)===null||r===void 0?void 0:r.onerror;this._transport.onerror=c=>{s==null||s(c),this._onerror(c)};const o=(n=this._transport)===null||n===void 0?void 0:n.onmessage;this._transport.onmessage=(c,l)=>{o==null||o(c,l),Wi(c)||A0(c)?this._onresponse(c):Gl(c)?this._onrequest(c,l):D0(c)?this._onnotification(c):this._onerror(new Error(`Unknown message type: ${JSON.stringify(c)}`))},await this._transport.start()}_onclose(){var t;const a=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._pendingDebouncedNotifications.clear(),this._transport=void 0,(t=this.onclose)===null||t===void 0||t.call(this);const r=new Br(fr.ConnectionClosed,"Connection closed");for(const n of a.values())n(r)}_onerror(t){var a;(a=this.onerror)===null||a===void 0||a.call(this,t)}_onnotification(t){var a;const r=(a=this._notificationHandlers.get(t.method))!==null&&a!==void 0?a:this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(t)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(t,a){var r,n,i,s;const o=(r=this._requestHandlers.get(t.method))!==null&&r!==void 0?r:this.fallbackRequestHandler;if(o===void 0){(n=this._transport)===null||n===void 0||n.send({jsonrpc:"2.0",id:t.id,error:{code:fr.MethodNotFound,message:"Method not found"}}).catch(u=>this._onerror(new Error(`Failed to send an error response: ${u}`)));return}const c=new AbortController;this._requestHandlerAbortControllers.set(t.id,c);const l={signal:c.signal,sessionId:(i=this._transport)===null||i===void 0?void 0:i.sessionId,_meta:(s=t.params)===null||s===void 0?void 0:s._meta,sendNotification:u=>this.notification(u,{relatedRequestId:t.id}),sendRequest:(u,p,h)=>this.request(u,p,{...h,relatedRequestId:t.id}),authInfo:a==null?void 0:a.authInfo,requestId:t.id,requestInfo:a==null?void 0:a.requestInfo};Promise.resolve().then(()=>o(t,l)).then(u=>{var p;if(!c.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({result:u,jsonrpc:"2.0",id:t.id})},u=>{var p,h;if(!c.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({jsonrpc:"2.0",id:t.id,error:{code:Number.isSafeInteger(u.code)?u.code:fr.InternalError,message:(h=u.message)!==null&&h!==void 0?h:"Internal error"}})}).catch(u=>this._onerror(new Error(`Failed to send response: ${u}`))).finally(()=>{this._requestHandlerAbortControllers.delete(t.id)})}_onprogress(t){const{progressToken:a,...r}=t.params,n=Number(a),i=this._progressHandlers.get(n);if(!i){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(t)}`));return}const s=this._responseHandlers.get(n),o=this._timeoutInfo.get(n);if(o&&s&&o.resetTimeoutOnProgress)try{this._resetTimeout(n)}catch(c){s(c);return}i(r)}_onresponse(t){const a=Number(t.id),r=this._responseHandlers.get(a);if(r===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(t)}`));return}if(this._responseHandlers.delete(a),this._progressHandlers.delete(a),this._cleanupTimeout(a),Wi(t))r(t);else{const n=new Br(t.error.code,t.error.message,t.error.data);r(n)}}get transport(){return this._transport}async close(){var t;await((t=this._transport)===null||t===void 0?void 0:t.close())}request(t,a,r){const{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}=r??{};return new Promise((o,c)=>{var l,u,p,h,v,f;if(!this._transport){c(new Error("Not connected"));return}((l=this._options)===null||l===void 0?void 0:l.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(t.method),(u=r==null?void 0:r.signal)===null||u===void 0||u.throwIfAborted();const m=this._requestMessageId++,g={...t,jsonrpc:"2.0",id:m};r!=null&&r.onprogress&&(this._progressHandlers.set(m,r.onprogress),g.params={...t.params,_meta:{...((p=t.params)===null||p===void 0?void 0:p._meta)||{},progressToken:m}});const w=x=>{var k;this._responseHandlers.delete(m),this._progressHandlers.delete(m),this._cleanupTimeout(m),(k=this._transport)===null||k===void 0||k.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:m,reason:String(x)}},{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}).catch($=>this._onerror(new Error(`Failed to send cancellation: ${$}`))),c(x)};this._responseHandlers.set(m,x=>{var k;if(!(!((k=r==null?void 0:r.signal)===null||k===void 0)&&k.aborted)){if(x instanceof Error)return c(x);try{const $=a.parse(x.result);o($)}catch($){c($)}}}),(h=r==null?void 0:r.signal)===null||h===void 0||h.addEventListener("abort",()=>{var x;w((x=r==null?void 0:r.signal)===null||x===void 0?void 0:x.reason)});const E=(v=r==null?void 0:r.timeout)!==null&&v!==void 0?v:Rb,O=()=>w(new Br(fr.RequestTimeout,"Request timed out",{timeout:E}));this._setupTimeout(m,E,r==null?void 0:r.maxTotalTimeout,O,(f=r==null?void 0:r.resetTimeoutOnProgress)!==null&&f!==void 0?f:!1),this._transport.send(g,{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}).catch(x=>{this._cleanupTimeout(m),c(x)})})}async notification(t,a){var r,n;if(!this._transport)throw new Error("Not connected");if(this.assertNotificationCapability(t.method),((n=(r=this._options)===null||r===void 0?void 0:r.debouncedNotificationMethods)!==null&&n!==void 0?n:[]).includes(t.method)&&!t.params&&!(a!=null&&a.relatedRequestId)){if(this._pendingDebouncedNotifications.has(t.method))return;this._pendingDebouncedNotifications.add(t.method),Promise.resolve().then(()=>{var s;if(this._pendingDebouncedNotifications.delete(t.method),!this._transport)return;const o={...t,jsonrpc:"2.0"};(s=this._transport)===null||s===void 0||s.send(o,a).catch(c=>this._onerror(c))});return}const i={...t,jsonrpc:"2.0"};await this._transport.send(i,a)}setRequestHandler(t,a){const r=t.shape.method.value;this.assertRequestHandlerCapability(r),this._requestHandlers.set(r,(n,i)=>Promise.resolve(a(t.parse(n),i)))}removeRequestHandler(t){this._requestHandlers.delete(t)}assertCanSetRequestHandler(t){if(this._requestHandlers.has(t))throw new Error(`A request handler for ${t} already exists, which would be overridden`)}setNotificationHandler(t,a){this._notificationHandlers.set(t.shape.method.value,r=>Promise.resolve(a(t.parse(r))))}removeNotificationHandler(t){this._notificationHandlers.delete(t)}}function Ib(e,t){return Object.entries(t).reduce((a,[r,n])=>(n&&typeof n=="object"?a[r]=a[r]?{...a[r],...n}:n:a[r]=n,a),{...e})}var Is={exports:{}},Lb=Is.exports,gu;function Mb(){return gu||(gu=1,function(e,t){(function(a,r){r(t)})(Lb,function(a){function r(){for(var P=arguments.length,T=Array(P),L=0;L<P;L++)T[L]=arguments[L];if(T.length>1){T[0]=T[0].slice(0,-1);for(var B=T.length-1,J=1;J<B;++J)T[J]=T[J].slice(1,-1);return T[B]=T[B].slice(1),T.join("")}else return T[0]}function n(P){return"(?:"+P+")"}function i(P){return P===void 0?"undefined":P===null?"null":Object.prototype.toString.call(P).split(" ").pop().split("]").shift().toLowerCase()}function s(P){return P.toUpperCase()}function o(P){return P!=null?P instanceof Array?P:typeof P.length!="number"||P.split||P.setInterval||P.call?[P]:Array.prototype.slice.call(P):[]}function c(P,T){var L=P;if(T)for(var B in T)L[B]=T[B];return L}function l(P){var T="[A-Za-z]",L="[0-9]",B=r(L,"[A-Fa-f]"),J=n(n("%[EFef]"+B+"%"+B+B+"%"+B+B)+"|"+n("%[89A-Fa-f]"+B+"%"+B+B)+"|"+n("%"+B+B)),Pe="[\\:\\/\\?\\#\\[\\]\\@]",ke="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Ye=r(Pe,ke),pt=P?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",rt=P?"[\\uE000-\\uF8FF]":"[]",We=r(T,L,"[\\-\\.\\_\\~]",pt);n(T+r(T,L,"[\\+\\-\\.]")+"*"),n(n(J+"|"+r(We,ke,"[\\:]"))+"*");var nt=n(n("25[0-5]")+"|"+n("2[0-4]"+L)+"|"+n("1"+L+L)+"|"+n("0?[1-9]"+L)+"|0?0?"+L),ht=n(nt+"\\."+nt+"\\."+nt+"\\."+nt),Me=n(B+"{1,4}"),mt=n(n(Me+"\\:"+Me)+"|"+ht),at=n(n(Me+"\\:")+"{6}"+mt),Gt=n("\\:\\:"+n(Me+"\\:")+"{5}"+mt),an=n(n(Me)+"?\\:\\:"+n(Me+"\\:")+"{4}"+mt),cr=n(n(n(Me+"\\:")+"{0,1}"+Me)+"?\\:\\:"+n(Me+"\\:")+"{3}"+mt),Lr=n(n(n(Me+"\\:")+"{0,2}"+Me)+"?\\:\\:"+n(Me+"\\:")+"{2}"+mt),ya=n(n(n(Me+"\\:")+"{0,3}"+Me)+"?\\:\\:"+Me+"\\:"+mt),_a=n(n(n(Me+"\\:")+"{0,4}"+Me)+"?\\:\\:"+mt),Xt=n(n(n(Me+"\\:")+"{0,5}"+Me)+"?\\:\\:"+Me),Mr=n(n(n(Me+"\\:")+"{0,6}"+Me)+"?\\:\\:"),ba=n([at,Gt,an,cr,Lr,ya,_a,Xt,Mr].join("|")),br=n(n(We+"|"+J)+"+");n("[vV]"+B+"+\\."+r(We,ke,"[\\:]")+"+"),n(n(J+"|"+r(We,ke))+"*");var Gs=n(J+"|"+r(We,ke,"[\\:\\@]"));return n(n(J+"|"+r(We,ke,"[\\@]"))+"+"),n(n(Gs+"|"+r("[\\/\\?]",rt))+"*"),{NOT_SCHEME:new RegExp(r("[^]",T,L,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(r("[^\\%\\:]",We,ke),"g"),NOT_HOST:new RegExp(r("[^\\%\\[\\]\\:]",We,ke),"g"),NOT_PATH:new RegExp(r("[^\\%\\/\\:\\@]",We,ke),"g"),NOT_PATH_NOSCHEME:new RegExp(r("[^\\%\\/\\@]",We,ke),"g"),NOT_QUERY:new RegExp(r("[^\\%]",We,ke,"[\\:\\@\\/\\?]",rt),"g"),NOT_FRAGMENT:new RegExp(r("[^\\%]",We,ke,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(r("[^]",We,ke),"g"),UNRESERVED:new RegExp(We,"g"),OTHER_CHARS:new RegExp(r("[^\\%]",We,Ye),"g"),PCT_ENCODED:new RegExp(J,"g"),IPV4ADDRESS:new RegExp("^("+ht+")$"),IPV6ADDRESS:new RegExp("^\\[?("+ba+")"+n(n("\\%25|\\%(?!"+B+"{2})")+"("+br+")")+"?\\]?$")}}var u=l(!1),p=l(!0),h=function(){function P(T,L){var B=[],J=!0,Pe=!1,ke=void 0;try{for(var Ye=T[Symbol.iterator](),pt;!(J=(pt=Ye.next()).done)&&(B.push(pt.value),!(L&&B.length===L));J=!0);}catch(rt){Pe=!0,ke=rt}finally{try{!J&&Ye.return&&Ye.return()}finally{if(Pe)throw ke}}return B}return function(T,L){if(Array.isArray(T))return T;if(Symbol.iterator in Object(T))return P(T,L);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(P){if(Array.isArray(P)){for(var T=0,L=Array(P.length);T<P.length;T++)L[T]=P[T];return L}else return Array.from(P)},f=2147483647,m=36,g=1,w=26,E=38,O=700,x=72,k=128,$="-",N=/^xn--/,M=/[^\0-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},R=m-g,z=Math.floor,F=String.fromCharCode;function U(P){throw new RangeError(I[P])}function V(P,T){for(var L=[],B=P.length;B--;)L[B]=T(P[B]);return L}function re(P,T){var L=P.split("@"),B="";L.length>1&&(B=L[0]+"@",P=L[1]),P=P.replace(A,".");var J=P.split("."),Pe=V(J,T).join(".");return B+Pe}function Q(P){for(var T=[],L=0,B=P.length;L<B;){var J=P.charCodeAt(L++);if(J>=55296&&J<=56319&&L<B){var Pe=P.charCodeAt(L++);(Pe&64512)==56320?T.push(((J&1023)<<10)+(Pe&1023)+65536):(T.push(J),L--)}else T.push(J)}return T}var oe=function(P){return String.fromCodePoint.apply(String,v(P))},ce=function(P){return P-48<10?P-22:P-65<26?P-65:P-97<26?P-97:m},Re=function(P,T){return P+22+75*(P<26)-((T!=0)<<5)},Ze=function(P,T,L){var B=0;for(P=L?z(P/O):P>>1,P+=z(P/T);P>R*w>>1;B+=m)P=z(P/R);return z(B+(R+1)*P/(P+E))},K=function(P){var T=[],L=P.length,B=0,J=k,Pe=x,ke=P.lastIndexOf($);ke<0&&(ke=0);for(var Ye=0;Ye<ke;++Ye)P.charCodeAt(Ye)>=128&&U("not-basic"),T.push(P.charCodeAt(Ye));for(var pt=ke>0?ke+1:0;pt<L;){for(var rt=B,We=1,nt=m;;nt+=m){pt>=L&&U("invalid-input");var ht=ce(P.charCodeAt(pt++));(ht>=m||ht>z((f-B)/We))&&U("overflow"),B+=ht*We;var Me=nt<=Pe?g:nt>=Pe+w?w:nt-Pe;if(ht<Me)break;var mt=m-Me;We>z(f/mt)&&U("overflow"),We*=mt}var at=T.length+1;Pe=Ze(B-rt,at,rt==0),z(B/at)>f-J&&U("overflow"),J+=z(B/at),B%=at,T.splice(B++,0,J)}return String.fromCodePoint.apply(String,T)},ae=function(P){var T=[];P=Q(P);var L=P.length,B=k,J=0,Pe=x,ke=!0,Ye=!1,pt=void 0;try{for(var rt=P[Symbol.iterator](),We;!(ke=(We=rt.next()).done);ke=!0){var nt=We.value;nt<128&&T.push(F(nt))}}catch(Jn){Ye=!0,pt=Jn}finally{try{!ke&&rt.return&&rt.return()}finally{if(Ye)throw pt}}var ht=T.length,Me=ht;for(ht&&T.push($);Me<L;){var mt=f,at=!0,Gt=!1,an=void 0;try{for(var cr=P[Symbol.iterator](),Lr;!(at=(Lr=cr.next()).done);at=!0){var ya=Lr.value;ya>=B&&ya<mt&&(mt=ya)}}catch(Jn){Gt=!0,an=Jn}finally{try{!at&&cr.return&&cr.return()}finally{if(Gt)throw an}}var _a=Me+1;mt-B>z((f-J)/_a)&&U("overflow"),J+=(mt-B)*_a,B=mt;var Xt=!0,Mr=!1,ba=void 0;try{for(var br=P[Symbol.iterator](),Gs;!(Xt=(Gs=br.next()).done);Xt=!0){var ym=Gs.value;if(ym<B&&++J>f&&U("overflow"),ym==B){for(var Xs=J,Ys=m;;Ys+=m){var ei=Ys<=Pe?g:Ys>=Pe+w?w:Ys-Pe;if(Xs<ei)break;var _m=Xs-ei,bm=m-ei;T.push(F(Re(ei+_m%bm,0))),Xs=z(_m/bm)}T.push(F(Re(Xs,0))),Pe=Ze(J,_a,Me==ht),J=0,++Me}}}catch(Jn){Mr=!0,ba=Jn}finally{try{!Xt&&br.return&&br.return()}finally{if(Mr)throw ba}}++J,++B}return T.join("")},xe=function(P){return re(P,function(T){return N.test(T)?K(T.slice(4).toLowerCase()):T})},ne=function(P){return re(P,function(T){return M.test(T)?"xn--"+ae(T):T})},_={version:"2.1.0",ucs2:{decode:Q,encode:oe},decode:K,encode:ae,toASCII:ne,toUnicode:xe},C={};function D(P){var T=P.charCodeAt(0),L=void 0;return T<16?L="%0"+T.toString(16).toUpperCase():T<128?L="%"+T.toString(16).toUpperCase():T<2048?L="%"+(T>>6|192).toString(16).toUpperCase()+"%"+(T&63|128).toString(16).toUpperCase():L="%"+(T>>12|224).toString(16).toUpperCase()+"%"+(T>>6&63|128).toString(16).toUpperCase()+"%"+(T&63|128).toString(16).toUpperCase(),L}function W(P){for(var T="",L=0,B=P.length;L<B;){var J=parseInt(P.substr(L+1,2),16);if(J<128)T+=String.fromCharCode(J),L+=3;else if(J>=194&&J<224){if(B-L>=6){var Pe=parseInt(P.substr(L+4,2),16);T+=String.fromCharCode((J&31)<<6|Pe&63)}else T+=P.substr(L,6);L+=6}else if(J>=224){if(B-L>=9){var ke=parseInt(P.substr(L+4,2),16),Ye=parseInt(P.substr(L+7,2),16);T+=String.fromCharCode((J&15)<<12|(ke&63)<<6|Ye&63)}else T+=P.substr(L,9);L+=9}else T+=P.substr(L,3),L+=3}return T}function Z(P,T){function L(B){var J=W(B);return J.match(T.UNRESERVED)?J:B}return P.scheme&&(P.scheme=String(P.scheme).replace(T.PCT_ENCODED,L).toLowerCase().replace(T.NOT_SCHEME,"")),P.userinfo!==void 0&&(P.userinfo=String(P.userinfo).replace(T.PCT_ENCODED,L).replace(T.NOT_USERINFO,D).replace(T.PCT_ENCODED,s)),P.host!==void 0&&(P.host=String(P.host).replace(T.PCT_ENCODED,L).toLowerCase().replace(T.NOT_HOST,D).replace(T.PCT_ENCODED,s)),P.path!==void 0&&(P.path=String(P.path).replace(T.PCT_ENCODED,L).replace(P.scheme?T.NOT_PATH:T.NOT_PATH_NOSCHEME,D).replace(T.PCT_ENCODED,s)),P.query!==void 0&&(P.query=String(P.query).replace(T.PCT_ENCODED,L).replace(T.NOT_QUERY,D).replace(T.PCT_ENCODED,s)),P.fragment!==void 0&&(P.fragment=String(P.fragment).replace(T.PCT_ENCODED,L).replace(T.NOT_FRAGMENT,D).replace(T.PCT_ENCODED,s)),P}function j(P){return P.replace(/^0*(.*)/,"$1")||"0"}function S(P,T){var L=P.match(T.IPV4ADDRESS)||[],B=h(L,2),J=B[1];return J?J.split(".").map(j).join("."):P}function H(P,T){var L=P.match(T.IPV6ADDRESS)||[],B=h(L,3),J=B[1],Pe=B[2];if(J){for(var ke=J.toLowerCase().split("::").reverse(),Ye=h(ke,2),pt=Ye[0],rt=Ye[1],We=rt?rt.split(":").map(j):[],nt=pt.split(":").map(j),ht=T.IPV4ADDRESS.test(nt[nt.length-1]),Me=ht?7:8,mt=nt.length-Me,at=Array(Me),Gt=0;Gt<Me;++Gt)at[Gt]=We[Gt]||nt[mt+Gt]||"";ht&&(at[Me-1]=S(at[Me-1],T));var an=at.reduce(function(Xt,Mr,ba){if(!Mr||Mr==="0"){var br=Xt[Xt.length-1];br&&br.index+br.length===ba?br.length++:Xt.push({index:ba,length:1})}return Xt},[]),cr=an.sort(function(Xt,Mr){return Mr.length-Xt.length})[0],Lr=void 0;if(cr&&cr.length>1){var ya=at.slice(0,cr.index),_a=at.slice(cr.index+cr.length);Lr=ya.join(":")+"::"+_a.join(":")}else Lr=at.join(":");return Pe&&(Lr+="%"+Pe),Lr}else return P}var G=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Ce="".match(/(){0}/)[1]===void 0;function he(P){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L={},B=T.iri!==!1?p:u;T.reference==="suffix"&&(P=(T.scheme?T.scheme+":":"")+"//"+P);var J=P.match(G);if(J){Ce?(L.scheme=J[1],L.userinfo=J[3],L.host=J[4],L.port=parseInt(J[5],10),L.path=J[6]||"",L.query=J[7],L.fragment=J[8],isNaN(L.port)&&(L.port=J[5])):(L.scheme=J[1]||void 0,L.userinfo=P.indexOf("@")!==-1?J[3]:void 0,L.host=P.indexOf("//")!==-1?J[4]:void 0,L.port=parseInt(J[5],10),L.path=J[6]||"",L.query=P.indexOf("?")!==-1?J[7]:void 0,L.fragment=P.indexOf("#")!==-1?J[8]:void 0,isNaN(L.port)&&(L.port=P.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?J[4]:void 0)),L.host&&(L.host=H(S(L.host,B),B)),L.scheme===void 0&&L.userinfo===void 0&&L.host===void 0&&L.port===void 0&&!L.path&&L.query===void 0?L.reference="same-document":L.scheme===void 0?L.reference="relative":L.fragment===void 0?L.reference="absolute":L.reference="uri",T.reference&&T.reference!=="suffix"&&T.reference!==L.reference&&(L.error=L.error||"URI is not a "+T.reference+" reference.");var Pe=C[(T.scheme||L.scheme||"").toLowerCase()];if(!T.unicodeSupport&&(!Pe||!Pe.unicodeSupport)){if(L.host&&(T.domainHost||Pe&&Pe.domainHost))try{L.host=_.toASCII(L.host.replace(B.PCT_ENCODED,W).toLowerCase())}catch(ke){L.error=L.error||"Host's domain name can not be converted to ASCII via punycode: "+ke}Z(L,u)}else Z(L,B);Pe&&Pe.parse&&Pe.parse(L,T)}else L.error=L.error||"URI can not be parsed.";return L}function ge(P,T){var L=T.iri!==!1?p:u,B=[];return P.userinfo!==void 0&&(B.push(P.userinfo),B.push("@")),P.host!==void 0&&B.push(H(S(String(P.host),L),L).replace(L.IPV6ADDRESS,function(J,Pe,ke){return"["+Pe+(ke?"%25"+ke:"")+"]"})),(typeof P.port=="number"||typeof P.port=="string")&&(B.push(":"),B.push(String(P.port))),B.length?B.join(""):void 0}var Ue=/^\.\.?\//,yt=/^\/\.(\/|$)/,se=/^\/\.\.(\/|$)/,Xe=/^\/?(?:.|\n)*?(?=\/|$)/;function pe(P){for(var T=[];P.length;)if(P.match(Ue))P=P.replace(Ue,"");else if(P.match(yt))P=P.replace(yt,"/");else if(P.match(se))P=P.replace(se,"/"),T.pop();else if(P==="."||P==="..")P="";else{var L=P.match(Xe);if(L){var B=L[0];P=P.slice(B.length),T.push(B)}else throw new Error("Unexpected dot segment condition")}return T.join("")}function te(P){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=T.iri?p:u,B=[],J=C[(T.scheme||P.scheme||"").toLowerCase()];if(J&&J.serialize&&J.serialize(P,T),P.host&&!L.IPV6ADDRESS.test(P.host)&&(T.domainHost||J&&J.domainHost))try{P.host=T.iri?_.toUnicode(P.host):_.toASCII(P.host.replace(L.PCT_ENCODED,W).toLowerCase())}catch(Ye){P.error=P.error||"Host's domain name can not be converted to "+(T.iri?"Unicode":"ASCII")+" via punycode: "+Ye}Z(P,L),T.reference!=="suffix"&&P.scheme&&(B.push(P.scheme),B.push(":"));var Pe=ge(P,T);if(Pe!==void 0&&(T.reference!=="suffix"&&B.push("//"),B.push(Pe),P.path&&P.path.charAt(0)!=="/"&&B.push("/")),P.path!==void 0){var ke=P.path;!T.absolutePath&&(!J||!J.absolutePath)&&(ke=pe(ke)),Pe===void 0&&(ke=ke.replace(/^\/\//,"/%2F")),B.push(ke)}return P.query!==void 0&&(B.push("?"),B.push(P.query)),P.fragment!==void 0&&(B.push("#"),B.push(P.fragment)),B.join("")}function Ne(P,T){var L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments[3],J={};return B||(P=he(te(P,L),L),T=he(te(T,L),L)),L=L||{},!L.tolerant&&T.scheme?(J.scheme=T.scheme,J.userinfo=T.userinfo,J.host=T.host,J.port=T.port,J.path=pe(T.path||""),J.query=T.query):(T.userinfo!==void 0||T.host!==void 0||T.port!==void 0?(J.userinfo=T.userinfo,J.host=T.host,J.port=T.port,J.path=pe(T.path||""),J.query=T.query):(T.path?(T.path.charAt(0)==="/"?J.path=pe(T.path):((P.userinfo!==void 0||P.host!==void 0||P.port!==void 0)&&!P.path?J.path="/"+T.path:P.path?J.path=P.path.slice(0,P.path.lastIndexOf("/")+1)+T.path:J.path=T.path,J.path=pe(J.path)),J.query=T.query):(J.path=P.path,T.query!==void 0?J.query=T.query:J.query=P.query),J.userinfo=P.userinfo,J.host=P.host,J.port=P.port),J.scheme=P.scheme),J.fragment=T.fragment,J}function de(P,T,L){var B=c({scheme:"null"},L);return te(Ne(he(P,B),he(T,B),B,!0),B)}function ie(P,T){return typeof P=="string"?P=te(he(P,T),T):i(P)==="object"&&(P=he(te(P,T),T)),P}function Ee(P,T,L){return typeof P=="string"?P=te(he(P,L),L):i(P)==="object"&&(P=te(P,L)),typeof T=="string"?T=te(he(T,L),L):i(T)==="object"&&(T=te(T,L)),P===T}function je(P,T){return P&&P.toString().replace(!T||!T.iri?u.ESCAPE:p.ESCAPE,D)}function ot(P,T){return P&&P.toString().replace(!T||!T.iri?u.PCT_ENCODED:p.PCT_ENCODED,W)}var ga={scheme:"http",domainHost:!0,parse:function(P,T){return P.host||(P.error=P.error||"HTTP URIs must have a host."),P},serialize:function(P,T){var L=String(P.scheme).toLowerCase()==="https";return(P.port===(L?443:80)||P.port==="")&&(P.port=void 0),P.path||(P.path="/"),P}},Wn={scheme:"https",domainHost:ga.domainHost,parse:ga.parse,serialize:ga.serialize};function um(P){return typeof P.secure=="boolean"?P.secure:String(P.scheme).toLowerCase()==="wss"}var Kn={scheme:"ws",domainHost:!0,parse:function(P,T){var L=P;return L.secure=um(L),L.resourceName=(L.path||"/")+(L.query?"?"+L.query:""),L.path=void 0,L.query=void 0,L},serialize:function(P,T){if((P.port===(um(P)?443:80)||P.port==="")&&(P.port=void 0),typeof P.secure=="boolean"&&(P.scheme=P.secure?"wss":"ws",P.secure=void 0),P.resourceName){var L=P.resourceName.split("?"),B=h(L,2),J=B[0],Pe=B[1];P.path=J&&J!=="/"?J:void 0,P.query=Pe,P.resourceName=void 0}return P.fragment=void 0,P}},hm={scheme:"wss",domainHost:Kn.domainHost,parse:Kn.parse,serialize:Kn.serialize},yj={},pm="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",_r="[0-9A-Fa-f]",_j=n(n("%[EFef]"+_r+"%"+_r+_r+"%"+_r+_r)+"|"+n("%[89A-Fa-f]"+_r+"%"+_r+_r)+"|"+n("%"+_r+_r)),bj="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",wj="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",xj=r(wj,'[\\"\\\\]'),jj="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Ej=new RegExp(pm,"g"),rn=new RegExp(_j,"g"),Sj=new RegExp(r("[^]",bj,"[\\.]",'[\\"]',xj),"g"),mm=new RegExp(r("[^]",pm,jj),"g"),kj=mm;function Uc(P){var T=W(P);return T.match(Ej)?T:P}var fm={scheme:"mailto",parse:function(P,T){var L=P,B=L.to=L.path?L.path.split(","):[];if(L.path=void 0,L.query){for(var J=!1,Pe={},ke=L.query.split("&"),Ye=0,pt=ke.length;Ye<pt;++Ye){var rt=ke[Ye].split("=");switch(rt[0]){case"to":for(var We=rt[1].split(","),nt=0,ht=We.length;nt<ht;++nt)B.push(We[nt]);break;case"subject":L.subject=ot(rt[1],T);break;case"body":L.body=ot(rt[1],T);break;default:J=!0,Pe[ot(rt[0],T)]=ot(rt[1],T);break}}J&&(L.headers=Pe)}L.query=void 0;for(var Me=0,mt=B.length;Me<mt;++Me){var at=B[Me].split("@");if(at[0]=ot(at[0]),T.unicodeSupport)at[1]=ot(at[1],T).toLowerCase();else try{at[1]=_.toASCII(ot(at[1],T).toLowerCase())}catch(Gt){L.error=L.error||"Email address's domain name can not be converted to ASCII via punycode: "+Gt}B[Me]=at.join("@")}return L},serialize:function(P,T){var L=P,B=o(P.to);if(B){for(var J=0,Pe=B.length;J<Pe;++J){var ke=String(B[J]),Ye=ke.lastIndexOf("@"),pt=ke.slice(0,Ye).replace(rn,Uc).replace(rn,s).replace(Sj,D),rt=ke.slice(Ye+1);try{rt=T.iri?_.toUnicode(rt):_.toASCII(ot(rt,T).toLowerCase())}catch(Me){L.error=L.error||"Email address's domain name can not be converted to "+(T.iri?"Unicode":"ASCII")+" via punycode: "+Me}B[J]=pt+"@"+rt}L.path=B.join(",")}var We=P.headers=P.headers||{};P.subject&&(We.subject=P.subject),P.body&&(We.body=P.body);var nt=[];for(var ht in We)We[ht]!==yj[ht]&&nt.push(ht.replace(rn,Uc).replace(rn,s).replace(mm,D)+"="+We[ht].replace(rn,Uc).replace(rn,s).replace(kj,D));return nt.length&&(L.query=nt.join("&")),L}},Cj=/^([^\:]+)\:(.*)/,vm={scheme:"urn",parse:function(P,T){var L=P.path&&P.path.match(Cj),B=P;if(L){var J=T.scheme||B.scheme||"urn",Pe=L[1].toLowerCase(),ke=L[2],Ye=J+":"+(T.nid||Pe),pt=C[Ye];B.nid=Pe,B.nss=ke,B.path=void 0,pt&&(B=pt.parse(B,T))}else B.error=B.error||"URN can not be parsed.";return B},serialize:function(P,T){var L=T.scheme||P.scheme||"urn",B=P.nid,J=L+":"+(T.nid||B),Pe=C[J];Pe&&(P=Pe.serialize(P,T));var ke=P,Ye=P.nss;return ke.path=(B||T.nid)+":"+Ye,ke}},Pj=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,gm={scheme:"urn:uuid",parse:function(P,T){var L=P;return L.uuid=L.nss,L.nss=void 0,!T.tolerant&&(!L.uuid||!L.uuid.match(Pj))&&(L.error=L.error||"UUID is not valid."),L},serialize:function(P,T){var L=P;return L.nss=(P.uuid||"").toLowerCase(),L}};C[ga.scheme]=ga,C[Wn.scheme]=Wn,C[Kn.scheme]=Kn,C[hm.scheme]=hm,C[fm.scheme]=fm,C[vm.scheme]=vm,C[gm.scheme]=gm,a.SCHEMES=C,a.pctEncChar=D,a.pctDecChars=W,a.parse=he,a.removeDotSegments=pe,a.serialize=te,a.resolveComponents=Ne,a.resolve=de,a.normalize=ie,a.equal=Ee,a.escapeComponent=je,a.unescapeComponent=ot,Object.defineProperty(a,"__esModule",{value:!0})})}(Is,Is.exports)),Is.exports}var yu,_u;function Db(){return _u||(_u=1,yu=function(e){for(var t=0,a=e.length,r=0,n;r<a;)t++,n=e.charCodeAt(r++),n>=55296&&n<=56319&&r<a&&(n=e.charCodeAt(r),(n&64512)==56320&&r++);return t}),yu}var eo,bu;function Aa(){if(bu)return eo;bu=1,eo={copy:e,checkDataType:t,checkDataTypes:a,coerceToTypes:n,toHash:i,getProperty:c,escapeQuotes:l,equal:sd(),ucs2length:Db(),varOccurences:u,varReplace:p,schemaHasRules:h,schemaHasRulesExcept:v,schemaUnknownRules:f,toQuotedString:m,getPathExpr:g,getPath:w,getData:x,unescapeFragment:$,unescapeJsonPointer:A,escapeFragment:N,escapeJsonPointer:M};function e(I,R){R=R||{};for(var z in I)R[z]=I[z];return R}function t(I,R,z,F){var U=F?" !== ":" === ",V=F?" || ":" && ",re=F?"!":"",Q=F?"":"!";switch(I){case"null":return R+U+"null";case"array":return re+"Array.isArray("+R+")";case"object":return"("+re+R+V+"typeof "+R+U+'"object"'+V+Q+"Array.isArray("+R+"))";case"integer":return"(typeof "+R+U+'"number"'+V+Q+"("+R+" % 1)"+V+R+U+R+(z?V+re+"isFinite("+R+")":"")+")";case"number":return"(typeof "+R+U+'"'+I+'"'+(z?V+re+"isFinite("+R+")":"")+")";default:return"typeof "+R+U+'"'+I+'"'}}function a(I,R,z){switch(I.length){case 1:return t(I[0],R,z,!0);default:var F="",U=i(I);U.array&&U.object&&(F=U.null?"(":"(!"+R+" || ",F+="typeof "+R+' !== "object")',delete U.null,delete U.array,delete U.object),U.number&&delete U.integer;for(var V in U)F+=(F?" && ":"")+t(V,R,z,!0);return F}}var r=i(["string","number","integer","boolean","null"]);function n(I,R){if(Array.isArray(R)){for(var z=[],F=0;F<R.length;F++){var U=R[F];(r[U]||I==="array"&&U==="array")&&(z[z.length]=U)}if(z.length)return z}else{if(r[R])return[R];if(I==="array"&&R==="array")return["array"]}}function i(I){for(var R={},z=0;z<I.length;z++)R[I[z]]=!0;return R}var s=/^[a-z$_][a-z$_0-9]*$/i,o=/'|\\/g;function c(I){return typeof I=="number"?"["+I+"]":s.test(I)?"."+I:"['"+l(I)+"']"}function l(I){return I.replace(o,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function u(I,R){R+="[^0-9]";var z=I.match(new RegExp(R,"g"));return z?z.length:0}function p(I,R,z){return R+="([^0-9])",z=z.replace(/\$/g,"$$$$"),I.replace(new RegExp(R,"g"),z+"$1")}function h(I,R){if(typeof I=="boolean")return!I;for(var z in I)if(R[z])return!0}function v(I,R,z){if(typeof I=="boolean")return!I&&z!="not";for(var F in I)if(F!=z&&R[F])return!0}function f(I,R){if(typeof I!="boolean"){for(var z in I)if(!R[z])return z}}function m(I){return"'"+l(I)+"'"}function g(I,R,z,F){var U=z?"'/' + "+R+(F?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):F?"'[' + "+R+" + ']'":"'[\\'' + "+R+" + '\\']'";return k(I,U)}function w(I,R,z){var F=m(z?"/"+M(R):c(R));return k(I,F)}var E=/^\/(?:[^~]|~0|~1)*$/,O=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function x(I,R,z){var F,U,V,re;if(I==="")return"rootData";if(I[0]=="/"){if(!E.test(I))throw new Error("Invalid JSON-pointer: "+I);U=I,V="rootData"}else{if(re=I.match(O),!re)throw new Error("Invalid JSON-pointer: "+I);if(F=+re[1],U=re[2],U=="#"){if(F>=R)throw new Error("Cannot access property/index "+F+" levels up, current level is "+R);return z[R-F]}if(F>R)throw new Error("Cannot access data "+F+" levels up, current level is "+R);if(V="data"+(R-F||""),!U)return V}for(var Q=V,oe=U.split("/"),ce=0;ce<oe.length;ce++){var Re=oe[ce];Re&&(V+=c(A(Re)),Q+=" && "+V)}return Q}function k(I,R){return I=='""'?R:(I+" + "+R).replace(/([^\\])' \+ '/g,"$1")}function $(I){return A(decodeURIComponent(I))}function N(I){return encodeURIComponent(M(I))}function M(I){return I.replace(/~/g,"~0").replace(/\//g,"~1")}function A(I){return I.replace(/~1/g,"/").replace(/~0/g,"~")}return eo}var to,wu;function xu(){if(wu)return to;wu=1;var e=Aa();to=t;function t(a){e.copy(a,this)}return to}var ro={exports:{}},ju;function Ab(){if(ju)return ro.exports;ju=1;var e=ro.exports=function(r,n,i){typeof n=="function"&&(i=n,n={}),i=n.cb||i;var s=typeof i=="function"?i:i.pre||function(){},o=i.post||function(){};t(n,s,o,r,"",r)};e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function t(r,n,i,s,o,c,l,u,p,h){if(s&&typeof s=="object"&&!Array.isArray(s)){n(s,o,c,l,u,p,h);for(var v in s){var f=s[v];if(Array.isArray(f)){if(v in e.arrayKeywords)for(var m=0;m<f.length;m++)t(r,n,i,f[m],o+"/"+v+"/"+m,c,o,v,s,m)}else if(v in e.propsKeywords){if(f&&typeof f=="object")for(var g in f)t(r,n,i,f[g],o+"/"+v+"/"+a(g),c,o,v,s,g)}else(v in e.keywords||r.allKeys&&!(v in e.skipKeywords))&&t(r,n,i,f,o+"/"+v,c,o,v,s)}i(s,o,c,l,u,p,h)}}function a(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}return ro.exports}var ao,Eu;function no(){if(Eu)return ao;Eu=1;var e=Mb(),t=sd(),a=Aa(),r=xu(),n=Ab();ao=i,i.normalizeId=w,i.fullPath=f,i.url=E,i.ids=O,i.inlineRef=p,i.schema=s;function i(x,k,$){var N=this._refs[$];if(typeof N=="string")if(this._refs[N])N=this._refs[N];else return i.call(this,x,k,N);if(N=N||this._schemas[$],N instanceof r)return p(N.schema,this._opts.inlineRefs)?N.schema:N.validate||this._compile(N);var M=s.call(this,k,$),A,I,R;return M&&(A=M.schema,k=M.root,R=M.baseId),A instanceof r?I=A.validate||x.call(this,A.schema,k,void 0,R):A!==void 0&&(I=p(A,this._opts.inlineRefs)?A:x.call(this,A,k,void 0,R)),I}function s(x,k){var $=e.parse(k),N=m($),M=f(this._getId(x.schema));if(Object.keys(x.schema).length===0||N!==M){var A=w(N),I=this._refs[A];if(typeof I=="string")return o.call(this,x,I,$);if(I instanceof r)I.validate||this._compile(I),x=I;else if(I=this._schemas[A],I instanceof r){if(I.validate||this._compile(I),A==w(k))return{schema:I,root:x,baseId:M};x=I}else return;if(!x.schema)return;M=f(this._getId(x.schema))}return l.call(this,$,M,x.schema,x)}function o(x,k,$){var N=s.call(this,x,k);if(N){var M=N.schema,A=N.baseId;x=N.root;var I=this._getId(M);return I&&(A=E(A,I)),l.call(this,$,A,M,x)}}var c=a.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function l(x,k,$,N){if(x.fragment=x.fragment||"",x.fragment.slice(0,1)=="/"){for(var M=x.fragment.split("/"),A=1;A<M.length;A++){var I=M[A];if(I){if(I=a.unescapeFragment(I),$=$[I],$===void 0)break;var R;if(!c[I]&&(R=this._getId($),R&&(k=E(k,R)),$.$ref)){var z=E(k,$.$ref),F=s.call(this,N,z);F&&($=F.schema,N=F.root,k=F.baseId)}}}if($!==void 0&&$!==N.schema)return{schema:$,root:N,baseId:k}}}var u=a.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(x,k){if(k===!1)return!1;if(k===void 0||k===!0)return h(x);if(k)return v(x)<=k}function h(x){var k;if(Array.isArray(x)){for(var $=0;$<x.length;$++)if(k=x[$],typeof k=="object"&&!h(k))return!1}else for(var N in x)if(N=="$ref"||(k=x[N],typeof k=="object"&&!h(k)))return!1;return!0}function v(x){var k=0,$;if(Array.isArray(x)){for(var N=0;N<x.length;N++)if($=x[N],typeof $=="object"&&(k+=v($)),k==1/0)return 1/0}else for(var M in x){if(M=="$ref")return 1/0;if(u[M])k++;else if($=x[M],typeof $=="object"&&(k+=v($)+1),k==1/0)return 1/0}return k}function f(x,k){k!==!1&&(x=w(x));var $=e.parse(x);return m($)}function m(x){return e.serialize(x).split("#")[0]+"#"}var g=/#\/?$/;function w(x){return x?x.replace(g,""):""}function E(x,k){return k=w(k),e.resolve(x,k)}function O(x){var k=w(this._getId(x)),$={"":k},N={"":f(k,!1)},M={},A=this;return n(x,{allKeys:!0},function(I,R,z,F,U,V,re){if(R!==""){var Q=A._getId(I),oe=$[F],ce=N[F]+"/"+U;if(re!==void 0&&(ce+="/"+(typeof re=="number"?re:a.escapeFragment(re))),typeof Q=="string"){Q=oe=w(oe?e.resolve(oe,Q):Q);var Re=A._refs[Q];if(typeof Re=="string"&&(Re=A._refs[Re]),Re&&Re.schema){if(!t(I,Re.schema))throw new Error('id "'+Q+'" resolves to more than one schema')}else if(Q!=w(ce))if(Q[0]=="#"){if(M[Q]&&!t(I,M[Q]))throw new Error('id "'+Q+'" resolves to more than one schema');M[Q]=I}else A._refs[Q]=ce}$[R]=oe,N[R]=ce}}),M}return ao}var so,Su;function io(){if(Su)return so;Su=1;var e=no();so={Validation:r(t),MissingRef:r(a)};function t(n){this.message="validation failed",this.errors=n,this.ajv=this.validation=!0}a.message=function(n,i){return"can't resolve reference "+i+" from id "+n};function a(n,i,s){this.message=s||a.message(n,i),this.missingRef=e.url(n,i),this.missingSchema=e.normalizeId(e.fullPath(this.missingRef))}function r(n){return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}return so}var ku,Cu;function Pu(){return Cu||(Cu=1,ku=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var a=typeof t.cycles=="boolean"?t.cycles:!1,r=t.cmp&&function(i){return function(s){return function(o,c){var l={key:o,value:s[o]},u={key:c,value:s[c]};return i(l,u)}}}(t.cmp),n=[];return function i(s){if(s&&s.toJSON&&typeof s.toJSON=="function"&&(s=s.toJSON()),s!==void 0){if(typeof s=="number")return isFinite(s)?""+s:"null";if(typeof s!="object")return JSON.stringify(s);var o,c;if(Array.isArray(s)){for(c="[",o=0;o<s.length;o++)o&&(c+=","),c+=i(s[o])||"null";return c+"]"}if(s===null)return"null";if(n.indexOf(s)!==-1){if(a)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=n.push(s)-1,u=Object.keys(s).sort(r&&r(s));for(c="",o=0;o<u.length;o++){var p=u[o],h=i(s[p]);h&&(c&&(c+=","),c+=JSON.stringify(p)+":"+h)}return n.splice(l,1),"{"+c+"}"}}(e)}),ku}var Nu,Ou;function $u(){return Ou||(Ou=1,Nu=function(e,t,a){var r="",n=e.schema.$async===!0,i=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),s=e.self._getId(e.schema);if(e.opts.strictKeywords){var o=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(o){var c="unknown keyword: "+o;if(e.opts.strictKeywords==="log")e.logger.warn(c);else throw new Error(c)}}if(e.isTop&&(r+=" var validate = ",n&&(e.async=!0,r+="async "),r+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",s&&(e.opts.sourceCode||e.opts.processCode)&&(r+=" "+("/*# sourceURL="+s+" */")+" ")),typeof e.schema=="boolean"||!(i||e.schema.$ref)){var t="false schema",l=e.level,u=e.dataLevel,p=e.schema[t],h=e.schemaPath+e.util.getProperty(t),v=e.errSchemaPath+"/"+t,x=!e.opts.allErrors,N,f="data"+(u||""),O="valid"+l;if(e.schema===!1){e.isTop?x=!0:r+=" var "+O+" = false; ";var m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(N||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: {} ",e.opts.messages!==!1&&(r+=" , message: 'boolean schema is false' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),r+=" } "):r+=" {} ";var g=r;r=m.pop(),!e.compositeRule&&x?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?n?r+=" return data; ":r+=" validate.errors = null; return true; ":r+=" var "+O+" = true; ";return e.isTop&&(r+=" }; return validate; "),r}if(e.isTop){var w=e.isTop,l=e.level=0,u=e.dataLevel=0,f="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var E="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}r+=" var vErrors = null; ",r+=" var errors = 0;     ",r+=" if (rootData === undefined) rootData = data; "}else{var l=e.level,u=e.dataLevel,f="data"+(u||"");if(s&&(e.baseId=e.resolve.url(e.baseId,s)),n&&!e.async)throw new Error("async schema in sync schema");r+=" var errs_"+l+" = errors;"}var O="valid"+l,x=!e.opts.allErrors,k="",$="",N,M=e.schema.type,A=Array.isArray(M);if(M&&e.opts.nullable&&e.schema.nullable===!0&&(A?M.indexOf("null")==-1&&(M=M.concat("null")):M!="null"&&(M=[M,"null"],A=!0)),A&&M.length==1&&(M=M[0],A=!1),e.schema.$ref&&i){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(i=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(r+=" "+e.RULES.all.$comment.code(e,"$comment")),M){if(e.opts.coerceTypes)var I=e.util.coerceToTypes(e.opts.coerceTypes,M);var R=e.RULES.types[M];if(I||A||R===!0||R&&!Ue(R)){var h=e.schemaPath+".type",v=e.errSchemaPath+"/type",h=e.schemaPath+".type",v=e.errSchemaPath+"/type",z=A?"checkDataTypes":"checkDataType";if(r+=" if ("+e.util[z](M,f,e.opts.strictNumbers,!0)+") { ",I){var F="dataType"+l,U="coerced"+l;r+=" var "+F+" = typeof "+f+"; var "+U+" = undefined; ",e.opts.coerceTypes=="array"&&(r+=" if ("+F+" == 'object' && Array.isArray("+f+") && "+f+".length == 1) { "+f+" = "+f+"[0]; "+F+" = typeof "+f+"; if ("+e.util.checkDataType(e.schema.type,f,e.opts.strictNumbers)+") "+U+" = "+f+"; } "),r+=" if ("+U+" !== undefined) ; ";var V=I;if(V)for(var re,Q=-1,oe=V.length-1;Q<oe;)re=V[Q+=1],re=="string"?r+=" else if ("+F+" == 'number' || "+F+" == 'boolean') "+U+" = '' + "+f+"; else if ("+f+" === null) "+U+" = ''; ":re=="number"||re=="integer"?(r+=" else if ("+F+" == 'boolean' || "+f+" === null || ("+F+" == 'string' && "+f+" && "+f+" == +"+f+" ",re=="integer"&&(r+=" && !("+f+" % 1)"),r+=")) "+U+" = +"+f+"; "):re=="boolean"?r+=" else if ("+f+" === 'false' || "+f+" === 0 || "+f+" === null) "+U+" = false; else if ("+f+" === 'true' || "+f+" === 1) "+U+" = true; ":re=="null"?r+=" else if ("+f+" === '' || "+f+" === 0 || "+f+" === false) "+U+" = null; ":e.opts.coerceTypes=="array"&&re=="array"&&(r+=" else if ("+F+" == 'string' || "+F+" == 'number' || "+F+" == 'boolean' || "+f+" == null) "+U+" = ["+f+"]; ");r+=" else {   ";var m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",A?r+=""+M.join(","):r+=""+M,r+="' } ",e.opts.messages!==!1&&(r+=" , message: 'should be ",A?r+=""+M.join(","):r+=""+M,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),r+=" } "):r+=" {} ";var g=r;r=m.pop(),!e.compositeRule&&x?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } if ("+U+" !== undefined) {  ";var ce=u?"data"+(u-1||""):"parentData",Re=u?e.dataPathArr[u]:"parentDataProperty";r+=" "+f+" = "+U+"; ",u||(r+="if ("+ce+" !== undefined)"),r+=" "+ce+"["+Re+"] = "+U+"; } "}else{var m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",A?r+=""+M.join(","):r+=""+M,r+="' } ",e.opts.messages!==!1&&(r+=" , message: 'should be ",A?r+=""+M.join(","):r+=""+M,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),r+=" } "):r+=" {} ";var g=r;r=m.pop(),!e.compositeRule&&x?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}r+=" } "}}if(e.schema.$ref&&!i)r+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",x&&(r+=" } if (errors === ",w?r+="0":r+="errs_"+l,r+=") { ",$+="}");else{var Ze=e.RULES;if(Ze){for(var R,K=-1,ae=Ze.length-1;K<ae;)if(R=Ze[K+=1],Ue(R)){if(R.type&&(r+=" if ("+e.util.checkDataType(R.type,f,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(R.type=="object"&&e.schema.properties){var p=e.schema.properties,xe=Object.keys(p),ne=xe;if(ne)for(var _,C=-1,D=ne.length-1;C<D;){_=ne[C+=1];var W=p[_];if(W.default!==void 0){var Z=f+e.util.getProperty(_);if(e.compositeRule){if(e.opts.strictDefaults){var E="default is ignored for: "+Z;if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}}else r+=" if ("+Z+" === undefined ",e.opts.useDefaults=="empty"&&(r+=" || "+Z+" === null || "+Z+" === '' "),r+=" ) "+Z+" = ",e.opts.useDefaults=="shared"?r+=" "+e.useDefault(W.default)+" ":r+=" "+JSON.stringify(W.default)+" ",r+="; "}}}else if(R.type=="array"&&Array.isArray(e.schema.items)){var j=e.schema.items;if(j){for(var W,Q=-1,S=j.length-1;Q<S;)if(W=j[Q+=1],W.default!==void 0){var Z=f+"["+Q+"]";if(e.compositeRule){if(e.opts.strictDefaults){var E="default is ignored for: "+Z;if(e.opts.strictDefaults==="log")e.logger.warn(E);else throw new Error(E)}}else r+=" if ("+Z+" === undefined ",e.opts.useDefaults=="empty"&&(r+=" || "+Z+" === null || "+Z+" === '' "),r+=" ) "+Z+" = ",e.opts.useDefaults=="shared"?r+=" "+e.useDefault(W.default)+" ":r+=" "+JSON.stringify(W.default)+" ",r+="; "}}}}var H=R.rules;if(H){for(var G,Ce=-1,he=H.length-1;Ce<he;)if(G=H[Ce+=1],yt(G)){var ge=G.code(e,G.keyword,R.type);ge&&(r+=" "+ge+" ",x&&(k+="}"))}}if(x&&(r+=" "+k+" ",k=""),R.type&&(r+=" } ",M&&M===R.type&&!I)){r+=" else { ";var h=e.schemaPath+".type",v=e.errSchemaPath+"/type",m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",A?r+=""+M.join(","):r+=""+M,r+="' } ",e.opts.messages!==!1&&(r+=" , message: 'should be ",A?r+=""+M.join(","):r+=""+M,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),r+=" } "):r+=" {} ";var g=r;r=m.pop(),!e.compositeRule&&x?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } "}x&&(r+=" if (errors === ",w?r+="0":r+="errs_"+l,r+=") { ",$+="}")}}}x&&(r+=" "+$+" "),w?(n?(r+=" if (errors === 0) return data;           ",r+=" else throw new ValidationError(vErrors); "):(r+=" validate.errors = vErrors; ",r+=" return errors === 0;       "),r+=" }; return validate;"):r+=" var "+O+" = errors === errs_"+l+";";function Ue(Xe){for(var pe=Xe.rules,te=0;te<pe.length;te++)if(yt(pe[te]))return!0}function yt(Xe){return e.schema[Xe.keyword]!==void 0||Xe.implements&&se(Xe)}function se(Xe){for(var pe=Xe.implements,te=0;te<pe.length;te++)if(e.schema[pe[te]]!==void 0)return!0}return r}),Nu}var oo,Ru;function Fb(){if(Ru)return oo;Ru=1;var e=no(),t=Aa(),a=io(),r=Pu(),n=$u(),i=t.ucs2length,s=sd(),o=a.Validation;oo=c;function c(w,E,O,x){var k=this,$=this._opts,N=[void 0],M={},A=[],I={},R=[],z={},F=[];E=E||{schema:w,refVal:N,refs:M};var U=l.call(this,w,E,x),V=this._compilations[U.index];if(U.compiling)return V.callValidate=Re;var re=this._formats,Q=this.RULES;try{var oe=Ze(w,E,O,x);V.validate=oe;var ce=V.callValidate;return ce&&(ce.schema=oe.schema,ce.errors=null,ce.refs=oe.refs,ce.refVal=oe.refVal,ce.root=oe.root,ce.$async=oe.$async,$.sourceCode&&(ce.source=oe.source)),oe}finally{u.call(this,w,E,x)}function Re(){var Z=V.validate,j=Z.apply(this,arguments);return Re.errors=Z.errors,j}function Ze(Z,j,S,H){var G=!j||j&&j.schema==Z;if(j.schema!=E.schema)return c.call(k,Z,j,S,H);var Ce=Z.$async===!0,he=n({isTop:!0,schema:Z,isRoot:G,baseId:H,root:j,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:a.MissingRef,RULES:Q,validate:n,util:t,resolve:e,resolveRef:K,usePattern:C,useDefault:D,useCustomRule:W,opts:$,formats:re,logger:k.logger,self:k});he=g(N,f)+g(A,h)+g(R,v)+g(F,m)+he,$.processCode&&(he=$.processCode(he,Z));var ge;try{var Ue=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",he);ge=Ue(k,Q,re,E,N,R,F,s,i,o),N[0]=ge}catch(yt){throw k.logger.error("Error compiling schema, function code:",he),yt}return ge.schema=Z,ge.errors=null,ge.refs=M,ge.refVal=N,ge.root=G?ge:j,Ce&&(ge.$async=!0),$.sourceCode===!0&&(ge.source={code:he,patterns:A,defaults:R}),ge}function K(Z,j,S){j=e.url(Z,j);var H=M[j],G,Ce;if(H!==void 0)return G=N[H],Ce="refVal["+H+"]",_(G,Ce);if(!S&&E.refs){var he=E.refs[j];if(he!==void 0)return G=E.refVal[he],Ce=ae(j,G),_(G,Ce)}Ce=ae(j);var ge=e.call(k,Ze,E,j);if(ge===void 0){var Ue=O&&O[j];Ue&&(ge=e.inlineRef(Ue,$.inlineRefs)?Ue:c.call(k,Ue,E,O,Z))}if(ge===void 0)xe(j);else return ne(j,ge),_(ge,Ce)}function ae(Z,j){var S=N.length;return N[S]=j,M[Z]=S,"refVal"+S}function xe(Z){delete M[Z]}function ne(Z,j){var S=M[Z];N[S]=j}function _(Z,j){return typeof Z=="object"||typeof Z=="boolean"?{code:j,schema:Z,inline:!0}:{code:j,$async:Z&&!!Z.$async}}function C(Z){var j=I[Z];return j===void 0&&(j=I[Z]=A.length,A[j]=Z),"pattern"+j}function D(Z){switch(typeof Z){case"boolean":case"number":return""+Z;case"string":return t.toQuotedString(Z);case"object":if(Z===null)return"null";var j=r(Z),S=z[j];return S===void 0&&(S=z[j]=R.length,R[S]=Z),"default"+S}}function W(Z,j,S,H){if(k._opts.validateSchema!==!1){var G=Z.definition.dependencies;if(G&&!G.every(function(te){return Object.prototype.hasOwnProperty.call(S,te)}))throw new Error("parent schema must have all required keywords: "+G.join(","));var Ce=Z.definition.validateSchema;if(Ce){var he=Ce(j);if(!he){var ge="keyword schema is invalid: "+k.errorsText(Ce.errors);if(k._opts.validateSchema=="log")k.logger.error(ge);else throw new Error(ge)}}}var Ue=Z.definition.compile,yt=Z.definition.inline,se=Z.definition.macro,Xe;if(Ue)Xe=Ue.call(k,j,S,H);else if(se)Xe=se.call(k,j,S,H),$.validateSchema!==!1&&k.validateSchema(Xe,!0);else if(yt)Xe=yt.call(k,H,Z.keyword,j,S);else if(Xe=Z.definition.validate,!Xe)return;if(Xe===void 0)throw new Error('custom keyword "'+Z.keyword+'"failed to compile');var pe=F.length;return F[pe]=Xe,{code:"customRule"+pe,validate:Xe}}}function l(w,E,O){var x=p.call(this,w,E,O);return x>=0?{index:x,compiling:!0}:(x=this._compilations.length,this._compilations[x]={schema:w,root:E,baseId:O},{index:x,compiling:!1})}function u(w,E,O){var x=p.call(this,w,E,O);x>=0&&this._compilations.splice(x,1)}function p(w,E,O){for(var x=0;x<this._compilations.length;x++){var k=this._compilations[x];if(k.schema==w&&k.root==E&&k.baseId==O)return x}return-1}function h(w,E){return"var pattern"+w+" = new RegExp("+t.toQuotedString(E[w])+");"}function v(w){return"var default"+w+" = defaults["+w+"];"}function f(w,E){return E[w]===void 0?"":"var refVal"+w+" = refVal["+w+"];"}function m(w){return"var customRule"+w+" = customRules["+w+"];"}function g(w,E){if(!w.length)return"";for(var O="",x=0;x<w.length;x++)O+=E(x,w);return O}return oo}var co={exports:{}},Tu;function zb(){if(Tu)return co.exports;Tu=1;var e=co.exports=function(){this._cache={}};return e.prototype.put=function(t,a){this._cache[t]=a},e.prototype.get=function(t){return this._cache[t]},e.prototype.del=function(t){delete this._cache[t]},e.prototype.clear=function(){this._cache={}},co.exports}var lo,Iu;function Zb(){if(Iu)return lo;Iu=1;var e=Aa(),t=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,a=[0,31,28,31,30,31,30,31,31,30,31,30,31],r=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,n=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,i=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,s=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,c=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,l=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,u=/^(?:\/(?:[^~/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,h=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;lo=v;function v(N){return N=N=="full"?"full":"fast",e.copy(v[N])}v.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":o,url:c,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:n,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:$,uuid:l,"json-pointer":u,"json-pointer-uri-fragment":p,"relative-json-pointer":h},v.full={date:m,time:g,"date-time":E,uri:x,"uri-reference":s,"uri-template":o,url:c,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:n,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:$,uuid:l,"json-pointer":u,"json-pointer-uri-fragment":p,"relative-json-pointer":h};function f(N){return N%4===0&&(N%100!==0||N%400===0)}function m(N){var M=N.match(t);if(!M)return!1;var A=+M[1],I=+M[2],R=+M[3];return I>=1&&I<=12&&R>=1&&R<=(I==2&&f(A)?29:a[I])}function g(N,M){var A=N.match(r);if(!A)return!1;var I=A[1],R=A[2],z=A[3],F=A[5];return(I<=23&&R<=59&&z<=59||I==23&&R==59&&z==60)&&(!M||F)}var w=/t|\s/i;function E(N){var M=N.split(w);return M.length==2&&m(M[0])&&g(M[1],!0)}var O=/\/|:/;function x(N){return O.test(N)&&i.test(N)}var k=/[^\\]\\Z/;function $(N){if(k.test(N))return!1;try{return new RegExp(N),!0}catch{return!1}}return lo}var Lu,Mu;function Ub(){return Mu||(Mu=1,Lu=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,l="data"+(i||""),u="valid"+n,p,h;if(s=="#"||s=="#/")e.isRoot?(p=e.async,h="validate"):(p=e.root.schema.$async===!0,h="root.refVal[0]");else{var v=e.resolveRef(e.baseId,s,e.isRoot);if(v===void 0){var f=e.MissingRefError.message(e.baseId,s);if(e.opts.missingRefs=="fail"){e.logger.error(f);var m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(o)+" , params: { ref: '"+e.util.escapeQuotes(s)+"' } ",e.opts.messages!==!1&&(r+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(s)+"' "),e.opts.verbose&&(r+=" , schema: "+e.util.toQuotedString(s)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+l+" "),r+=" } "):r+=" {} ";var g=r;r=m.pop(),!e.compositeRule&&c?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(r+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(f),c&&(r+=" if (true) { ");else throw new e.MissingRefError(e.baseId,s,f)}else if(v.inline){var w=e.util.copy(e);w.level++;var E="valid"+w.level;w.schema=v.schema,w.schemaPath="",w.errSchemaPath=s;var O=e.validate(w).replace(/validate\.schema/g,v.code);r+=" "+O+" ",c&&(r+=" if ("+E+") { ")}else p=v.$async===!0||e.async&&v.$async!==!1,h=v.code}if(h){var m=m||[];m.push(r),r="",e.opts.passContext?r+=" "+h+".call(this, ":r+=" "+h+"( ",r+=" "+l+", (dataPath || '')",e.errorPath!='""'&&(r+=" + "+e.errorPath);var x=i?"data"+(i-1||""):"parentData",k=i?e.dataPathArr[i]:"parentDataProperty";r+=" , "+x+" , "+k+", rootData)  ";var $=r;if(r=m.pop(),p){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(r+=" var "+u+"; "),r+=" try { await "+$+"; ",c&&(r+=" "+u+" = true; "),r+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(r+=" "+u+" = false; "),r+=" } ",c&&(r+=" if ("+u+") { ")}else r+=" if (!"+$+") { if (vErrors === null) vErrors = "+h+".errors; else vErrors = vErrors.concat("+h+".errors); errors = vErrors.length; } ",c&&(r+=" else { ")}return r}),Lu}var Du,Au;function Hb(){return Au||(Au=1,Du=function(e,t,a){var r=" ",n=e.schema[t],i=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,o=!e.opts.allErrors,c=e.util.copy(e),l="";c.level++;var u="valid"+c.level,p=c.baseId,h=!0,v=n;if(v)for(var f,m=-1,g=v.length-1;m<g;)f=v[m+=1],(e.opts.strictKeywords?typeof f=="object"&&Object.keys(f).length>0||f===!1:e.util.schemaHasRules(f,e.RULES.all))&&(h=!1,c.schema=f,c.schemaPath=i+"["+m+"]",c.errSchemaPath=s+"/"+m,r+="  "+e.validate(c)+" ",c.baseId=p,o&&(r+=" if ("+u+") { ",l+="}"));return o&&(h?r+=" if (true) { ":r+=" "+l.slice(0,-1)+" "),r}),Du}var Fu,zu;function qb(){return zu||(zu=1,Fu=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g=s.every(function(N){return e.opts.strictKeywords?typeof N=="object"&&Object.keys(N).length>0||N===!1:e.util.schemaHasRules(N,e.RULES.all)});if(g){var w=v.baseId;r+=" var "+h+" = errors; var "+p+" = false;  ";var E=e.compositeRule;e.compositeRule=v.compositeRule=!0;var O=s;if(O)for(var x,k=-1,$=O.length-1;k<$;)x=O[k+=1],v.schema=x,v.schemaPath=o+"["+k+"]",v.errSchemaPath=c+"/"+k,r+="  "+e.validate(v)+" ",v.baseId=w,r+=" "+p+" = "+p+" || "+m+"; if (!"+p+") { ",f+="}";e.compositeRule=v.compositeRule=E,r+=" "+f+" if (!"+p+") {   var err =   ",e.createErrors!==!1?(r+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(r+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } ")}else l&&(r+=" if (true) { ");return r}),Fu}var Zu,Uu;function Vb(){return Uu||(Uu=1,Zu=function(e,t,a){var r=" ",n=e.schema[t],i=e.errSchemaPath+"/"+t;e.opts.allErrors;var s=e.util.toQuotedString(n);return e.opts.$comment===!0?r+=" console.log("+s+");":typeof e.opts.$comment=="function"&&(r+=" self._opts.$comment("+s+", "+e.util.toQuotedString(i)+", validate.root.schema);"),r}),Zu}var Hu,qu;function Bb(){return qu||(qu=1,Hu=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; "),h||(r+=" var schema"+n+" = validate.schema"+o+";"),r+="var "+p+" = equal("+u+", schema"+n+"); if (!"+p+") {   ";var v=v||[];v.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValue: schema"+n+" } ",e.opts.messages!==!1&&(r+=" , message: 'should be equal to constant' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var f=r;return r=v.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+f+"]); ":r+=" validate.errors = ["+f+"]; return false; ":r+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }",l&&(r+=" else { "),r}),Hu}var Vu,Bu;function Wb(){return Bu||(Bu=1,Vu=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g="i"+n,w=v.dataLevel=e.dataLevel+1,E="data"+w,O=e.baseId,x=e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all);if(r+="var "+h+" = errors;var "+p+";",x){var k=e.compositeRule;e.compositeRule=v.compositeRule=!0,v.schema=s,v.schemaPath=o,v.errSchemaPath=c,r+=" var "+m+" = false; for (var "+g+" = 0; "+g+" < "+u+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var $=u+"["+g+"]";v.dataPathArr[w]=g;var N=e.validate(v);v.baseId=O,e.util.varOccurences(N,E)<2?r+=" "+e.util.varReplace(N,E,$)+" ":r+=" var "+E+" = "+$+"; "+N+" ",r+=" if ("+m+") break; }  ",e.compositeRule=v.compositeRule=k,r+=" "+f+" if (!"+m+") {"}else r+=" if ("+u+".length == 0) {";var M=M||[];M.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(r+=" , message: 'should contain a valid item' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var A=r;return r=M.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+A+"]); ":r+=" validate.errors = ["+A+"]; return false; ":r+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { ",x&&(r+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(r+=" } "),r}),Vu}var Wu,Ku;function Kb(){return Ku||(Ku=1,Wu=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level,m={},g={},w=e.opts.ownProperties;for(k in s)if(k!="__proto__"){var E=s[k],O=Array.isArray(E)?g:m;O[k]=E}r+="var "+p+" = errors;";var x=e.errorPath;r+="var missing"+n+";";for(var k in g)if(O=g[k],O.length){if(r+=" if ( "+u+e.util.getProperty(k)+" !== undefined ",w&&(r+=" && Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(k)+"') "),l){r+=" && ( ";var $=O;if($)for(var N,M=-1,A=$.length-1;M<A;){N=$[M+=1],M&&(r+=" || ");var I=e.util.getProperty(N),R=u+I;r+=" ( ( "+R+" === undefined ",w&&(r+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(N)+"') "),r+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?N:I)+") ) "}r+=")) {  ";var z="missing"+n,F="' + "+z+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,z,!0):x+" + "+z);var U=U||[];U.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(k)+"', missingProperty: '"+F+"', depsCount: "+O.length+", deps: '"+e.util.escapeQuotes(O.length==1?O[0]:O.join(", "))+"' } ",e.opts.messages!==!1&&(r+=" , message: 'should have ",O.length==1?r+="property "+e.util.escapeQuotes(O[0]):r+="properties "+e.util.escapeQuotes(O.join(", ")),r+=" when property "+e.util.escapeQuotes(k)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var V=r;r=U.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+V+"]); ":r+=" validate.errors = ["+V+"]; return false; ":r+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{r+=" ) { ";var re=O;if(re)for(var N,Q=-1,oe=re.length-1;Q<oe;){N=re[Q+=1];var I=e.util.getProperty(N),F=e.util.escapeQuotes(N),R=u+I;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,N,e.opts.jsonPointers)),r+=" if ( "+R+" === undefined ",w&&(r+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(N)+"') "),r+=") {  var err =   ",e.createErrors!==!1?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(k)+"', missingProperty: '"+F+"', depsCount: "+O.length+", deps: '"+e.util.escapeQuotes(O.length==1?O[0]:O.join(", "))+"' } ",e.opts.messages!==!1&&(r+=" , message: 'should have ",O.length==1?r+="property "+e.util.escapeQuotes(O[0]):r+="properties "+e.util.escapeQuotes(O.join(", ")),r+=" when property "+e.util.escapeQuotes(k)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}r+=" }   ",l&&(v+="}",r+=" else { ")}e.errorPath=x;var ce=h.baseId;for(var k in m){var E=m[k];(e.opts.strictKeywords?typeof E=="object"&&Object.keys(E).length>0||E===!1:e.util.schemaHasRules(E,e.RULES.all))&&(r+=" "+f+" = true; if ( "+u+e.util.getProperty(k)+" !== undefined ",w&&(r+=" && Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(k)+"') "),r+=") { ",h.schema=E,h.schemaPath=o+e.util.getProperty(k),h.errSchemaPath=c+"/"+e.util.escapeFragment(k),r+="  "+e.validate(h)+" ",h.baseId=ce,r+=" }  ",l&&(r+=" if ("+f+") { ",v+="}"))}return l&&(r+="   "+v+" if ("+p+" == errors) {"),r}),Wu}var Ju,Qu;function Jb(){return Qu||(Qu=1,Ju=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ");var v="i"+n,f="schema"+n;h||(r+=" var "+f+" = validate.schema"+o+";"),r+="var "+p+";",h&&(r+=" if (schema"+n+" === undefined) "+p+" = true; else if (!Array.isArray(schema"+n+")) "+p+" = false; else {"),r+=""+p+" = false;for (var "+v+"=0; "+v+"<"+f+".length; "+v+"++) if (equal("+u+", "+f+"["+v+"])) { "+p+" = true; break; }",h&&(r+="  }  "),r+=" if (!"+p+") {   ";var m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValues: schema"+n+" } ",e.opts.messages!==!1&&(r+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var g=r;return r=m.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }",l&&(r+=" else { "),r}),Ju}var Gu,Xu;function Qb(){return Xu||(Xu=1,Gu=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||"");if(e.opts.format===!1)return l&&(r+=" if (true) { "),r;var p=e.opts.$data&&s&&s.$data,h;p?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=e.opts.unknownFormats,f=Array.isArray(v);if(p){var m="format"+n,g="isObject"+n,w="formatType"+n;r+=" var "+m+" = formats["+h+"]; var "+g+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+w+" = "+g+" && "+m+".type || 'string'; if ("+g+") { ",e.async&&(r+=" var async"+n+" = "+m+".async; "),r+=" "+m+" = "+m+".validate; } if (  ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),r+=" (",v!="ignore"&&(r+=" ("+h+" && !"+m+" ",f&&(r+=" && self._opts.unknownFormats.indexOf("+h+") == -1 "),r+=") || "),r+=" ("+m+" && "+w+" == '"+a+"' && !(typeof "+m+" == 'function' ? ",e.async?r+=" (async"+n+" ? await "+m+"("+u+") : "+m+"("+u+")) ":r+=" "+m+"("+u+") ",r+=" : "+m+".test("+u+"))))) {"}else{var m=e.formats[s];if(!m){if(v=="ignore")return e.logger.warn('unknown format "'+s+'" ignored in schema at path "'+e.errSchemaPath+'"'),l&&(r+=" if (true) { "),r;if(f&&v.indexOf(s)>=0)return l&&(r+=" if (true) { "),r;throw new Error('unknown format "'+s+'" is used in schema at path "'+e.errSchemaPath+'"')}var g=typeof m=="object"&&!(m instanceof RegExp)&&m.validate,w=g&&m.type||"string";if(g){var E=m.async===!0;m=m.validate}if(w!=a)return l&&(r+=" if (true) { "),r;if(E){if(!e.async)throw new Error("async format in sync schema");var O="formats"+e.util.getProperty(s)+".validate";r+=" if (!(await "+O+"("+u+"))) { "}else{r+=" if (! ";var O="formats"+e.util.getProperty(s);g&&(O+=".validate"),typeof m=="function"?r+=" "+O+"("+u+") ":r+=" "+O+".test("+u+") ",r+=") { "}}var x=x||[];x.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { format:  ",p?r+=""+h:r+=""+e.util.toQuotedString(s),r+="  } ",e.opts.messages!==!1&&(r+=` , message: 'should match format "`,p?r+="' + "+h+" + '":r+=""+e.util.escapeQuotes(s),r+=`"' `),e.opts.verbose&&(r+=" , schema:  ",p?r+="validate.schema"+o:r+=""+e.util.toQuotedString(s),r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var k=r;return r=x.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+k+"]); ":r+=" validate.errors = ["+k+"]; return false; ":r+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",l&&(r+=" else { "),r}),Gu}var Yu,eh;function Gb(){return eh||(eh=1,Yu=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e);v.level++;var f="valid"+v.level,m=e.schema.then,g=e.schema.else,w=m!==void 0&&(e.opts.strictKeywords?typeof m=="object"&&Object.keys(m).length>0||m===!1:e.util.schemaHasRules(m,e.RULES.all)),E=g!==void 0&&(e.opts.strictKeywords?typeof g=="object"&&Object.keys(g).length>0||g===!1:e.util.schemaHasRules(g,e.RULES.all)),O=v.baseId;if(w||E){var x;v.createErrors=!1,v.schema=s,v.schemaPath=o,v.errSchemaPath=c,r+=" var "+h+" = errors; var "+p+" = true;  ";var k=e.compositeRule;e.compositeRule=v.compositeRule=!0,r+="  "+e.validate(v)+" ",v.baseId=O,v.createErrors=!0,r+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }  ",e.compositeRule=v.compositeRule=k,w?(r+=" if ("+f+") {  ",v.schema=e.schema.then,v.schemaPath=e.schemaPath+".then",v.errSchemaPath=e.errSchemaPath+"/then",r+="  "+e.validate(v)+" ",v.baseId=O,r+=" "+p+" = "+f+"; ",w&&E?(x="ifClause"+n,r+=" var "+x+" = 'then'; "):x="'then'",r+=" } ",E&&(r+=" else { ")):r+=" if (!"+f+") { ",E&&(v.schema=e.schema.else,v.schemaPath=e.schemaPath+".else",v.errSchemaPath=e.errSchemaPath+"/else",r+="  "+e.validate(v)+" ",v.baseId=O,r+=" "+p+" = "+f+"; ",w&&E?(x="ifClause"+n,r+=" var "+x+" = 'else'; "):x="'else'",r+=" } "),r+=" if (!"+p+") {   var err =   ",e.createErrors!==!1?(r+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { failingKeyword: "+x+" } ",e.opts.messages!==!1&&(r+=` , message: 'should match "' + `+x+` + '" schema' `),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+=" }   ",l&&(r+=" else { ")}else l&&(r+=" if (true) { ");return r}),Yu}var th,rh;function Xb(){return rh||(rh=1,th=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g="i"+n,w=v.dataLevel=e.dataLevel+1,E="data"+w,O=e.baseId;if(r+="var "+h+" = errors;var "+p+";",Array.isArray(s)){var x=e.schema.additionalItems;if(x===!1){r+=" "+p+" = "+u+".length <= "+s.length+"; ";var k=c;c=e.errSchemaPath+"/additionalItems",r+="  if (!"+p+") {   ";var $=$||[];$.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+s.length+" } ",e.opts.messages!==!1&&(r+=" , message: 'should NOT have more than "+s.length+" items' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var N=r;r=$.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+N+"]); ":r+=" validate.errors = ["+N+"]; return false; ":r+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",c=k,l&&(f+="}",r+=" else { ")}var M=s;if(M){for(var A,I=-1,R=M.length-1;I<R;)if(A=M[I+=1],e.opts.strictKeywords?typeof A=="object"&&Object.keys(A).length>0||A===!1:e.util.schemaHasRules(A,e.RULES.all)){r+=" "+m+" = true; if ("+u+".length > "+I+") { ";var z=u+"["+I+"]";v.schema=A,v.schemaPath=o+"["+I+"]",v.errSchemaPath=c+"/"+I,v.errorPath=e.util.getPathExpr(e.errorPath,I,e.opts.jsonPointers,!0),v.dataPathArr[w]=I;var F=e.validate(v);v.baseId=O,e.util.varOccurences(F,E)<2?r+=" "+e.util.varReplace(F,E,z)+" ":r+=" var "+E+" = "+z+"; "+F+" ",r+=" }  ",l&&(r+=" if ("+m+") { ",f+="}")}}if(typeof x=="object"&&(e.opts.strictKeywords?typeof x=="object"&&Object.keys(x).length>0||x===!1:e.util.schemaHasRules(x,e.RULES.all))){v.schema=x,v.schemaPath=e.schemaPath+".additionalItems",v.errSchemaPath=e.errSchemaPath+"/additionalItems",r+=" "+m+" = true; if ("+u+".length > "+s.length+") {  for (var "+g+" = "+s.length+"; "+g+" < "+u+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var z=u+"["+g+"]";v.dataPathArr[w]=g;var F=e.validate(v);v.baseId=O,e.util.varOccurences(F,E)<2?r+=" "+e.util.varReplace(F,E,z)+" ":r+=" var "+E+" = "+z+"; "+F+" ",l&&(r+=" if (!"+m+") break; "),r+=" } }  ",l&&(r+=" if ("+m+") { ",f+="}")}}else if(e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){v.schema=s,v.schemaPath=o,v.errSchemaPath=c,r+="  for (var "+g+" = 0; "+g+" < "+u+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var z=u+"["+g+"]";v.dataPathArr[w]=g;var F=e.validate(v);v.baseId=O,e.util.varOccurences(F,E)<2?r+=" "+e.util.varReplace(F,E,z)+" ":r+=" var "+E+" = "+z+"; "+F+" ",l&&(r+=" if (!"+m+") break; "),r+=" }"}return l&&(r+=" "+f+" if ("+h+" == errors) {"),r}),th}var ah,nh;function sh(){return nh||(nh=1,ah=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,O,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;p?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=t=="maximum",f=v?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],g=e.opts.$data&&m&&m.$data,w=v?"<":">",E=v?">":"<",O=void 0;if(!(p||typeof s=="number"||s===void 0))throw new Error(t+" must be number");if(!(g||m===void 0||typeof m=="number"||typeof m=="boolean"))throw new Error(f+" must be number or boolean");if(g){var x=e.util.getData(m.$data,i,e.dataPathArr),k="exclusive"+n,$="exclType"+n,N="exclIsNumber"+n,M="op"+n,A="' + "+M+" + '";r+=" var schemaExcl"+n+" = "+x+"; ",x="schemaExcl"+n,r+=" var "+k+"; var "+$+" = typeof "+x+"; if ("+$+" != 'boolean' && "+$+" != 'undefined' && "+$+" != 'number') { ";var O=f,I=I||[];I.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(O||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(r+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var R=r;r=I.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+R+"]); ":r+=" validate.errors = ["+R+"]; return false; ":r+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else if ( ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),r+=" "+$+" == 'number' ? ( ("+k+" = "+h+" === undefined || "+x+" "+w+"= "+h+") ? "+u+" "+E+"= "+x+" : "+u+" "+E+" "+h+" ) : ( ("+k+" = "+x+" === true) ? "+u+" "+E+"= "+h+" : "+u+" "+E+" "+h+" ) || "+u+" !== "+u+") { var op"+n+" = "+k+" ? '"+w+"' : '"+w+"='; ",s===void 0&&(O=f,c=e.errSchemaPath+"/"+f,h=x,p=g)}else{var N=typeof m=="number",A=w;if(N&&p){var M="'"+A+"'";r+=" if ( ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),r+=" ( "+h+" === undefined || "+m+" "+w+"= "+h+" ? "+u+" "+E+"= "+m+" : "+u+" "+E+" "+h+" ) || "+u+" !== "+u+") { "}else{N&&s===void 0?(k=!0,O=f,c=e.errSchemaPath+"/"+f,h=m,E+="="):(N&&(h=Math[v?"min":"max"](m,s)),m===(N?h:!0)?(k=!0,O=f,c=e.errSchemaPath+"/"+f,E+="="):(k=!1,A+="="));var M="'"+A+"'";r+=" if ( ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),r+=" "+u+" "+E+" "+h+" || "+u+" !== "+u+") { "}}O=O||t;var I=I||[];I.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(O||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { comparison: "+M+", limit: "+h+", exclusive: "+k+" } ",e.opts.messages!==!1&&(r+=" , message: 'should be "+A+" ",p?r+="' + "+h:r+=""+h+"'"),e.opts.verbose&&(r+=" , schema:  ",p?r+="validate.schema"+o:r+=""+s,r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var R=r;return r=I.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+R+"]); ":r+=" validate.errors = ["+R+"]; return false; ":r+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",l&&(r+=" else { "),r}),ah}var ih,oh;function ch(){return oh||(oh=1,ih=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,f,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(t+" must be number");var v=t=="maxItems"?">":"<";r+="if ( ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),r+=" "+u+".length "+v+" "+h+") { ";var f=t,m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(r+=" , message: 'should NOT have ",t=="maxItems"?r+="more":r+="fewer",r+=" than ",p?r+="' + "+h+" + '":r+=""+s,r+=" items' "),e.opts.verbose&&(r+=" , schema:  ",p?r+="validate.schema"+o:r+=""+s,r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var g=r;return r=m.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+="} ",l&&(r+=" else { "),r}),ih}var dh,lh;function uh(){return lh||(lh=1,dh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,f,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(t+" must be number");var v=t=="maxLength"?">":"<";r+="if ( ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),e.opts.unicode===!1?r+=" "+u+".length ":r+=" ucs2length("+u+") ",r+=" "+v+" "+h+") { ";var f=t,m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(r+=" , message: 'should NOT be ",t=="maxLength"?r+="longer":r+="shorter",r+=" than ",p?r+="' + "+h+" + '":r+=""+s,r+=" characters' "),e.opts.verbose&&(r+=" , schema:  ",p?r+="validate.schema"+o:r+=""+s,r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var g=r;return r=m.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+="} ",l&&(r+=" else { "),r}),dh}var hh,ph;function mh(){return ph||(ph=1,hh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,f,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(t+" must be number");var v=t=="maxProperties"?">":"<";r+="if ( ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),r+=" Object.keys("+u+").length "+v+" "+h+") { ";var f=t,m=m||[];m.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(r+=" , message: 'should NOT have ",t=="maxProperties"?r+="more":r+="fewer",r+=" than ",p?r+="' + "+h+" + '":r+=""+s,r+=" properties' "),e.opts.verbose&&(r+=" , schema:  ",p?r+="validate.schema"+o:r+=""+s,r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var g=r;return r=m.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+="} ",l&&(r+=" else { "),r}),hh}var fh,vh;function Yb(){return vh||(vh=1,fh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(t+" must be number");r+="var division"+n+";if (",p&&(r+=" "+h+" !== undefined && ( typeof "+h+" != 'number' || "),r+=" (division"+n+" = "+u+" / "+h+", ",e.opts.multipleOfPrecision?r+=" Math.abs(Math.round(division"+n+") - division"+n+") > 1e-"+e.opts.multipleOfPrecision+" ":r+=" division"+n+" !== parseInt(division"+n+") ",r+=" ) ",p&&(r+="  )  "),r+=" ) {   ";var v=v||[];v.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { multipleOf: "+h+" } ",e.opts.messages!==!1&&(r+=" , message: 'should be multiple of ",p?r+="' + "+h:r+=""+h+"'"),e.opts.verbose&&(r+=" , schema:  ",p?r+="validate.schema"+o:r+=""+s,r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var f=r;return r=v.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+f+"]); ":r+=" validate.errors = ["+f+"]; return false; ":r+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+="} ",l&&(r+=" else { "),r}),fh}var gh,yh;function ew(){return yh||(yh=1,gh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e);h.level++;var v="valid"+h.level;if(e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){h.schema=s,h.schemaPath=o,h.errSchemaPath=c,r+=" var "+p+" = errors;  ";var f=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.createErrors=!1;var m;h.opts.allErrors&&(m=h.opts.allErrors,h.opts.allErrors=!1),r+=" "+e.validate(h)+" ",h.createErrors=!0,m&&(h.opts.allErrors=m),e.compositeRule=h.compositeRule=f,r+=" if ("+v+") {   ";var g=g||[];g.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var w=r;r=g.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+w+"]); ":r+=" validate.errors = ["+w+"]; return false; ":r+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else {  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } ")}else r+="  var err =   ",e.createErrors!==!1?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(r+=" if (false) { ");return r}),gh}var _h,bh;function tw(){return bh||(bh=1,_h=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g=v.baseId,w="prevValid"+n,E="passingSchemas"+n;r+="var "+h+" = errors , "+w+" = false , "+p+" = false , "+E+" = null; ";var O=e.compositeRule;e.compositeRule=v.compositeRule=!0;var x=s;if(x)for(var k,$=-1,N=x.length-1;$<N;)k=x[$+=1],(e.opts.strictKeywords?typeof k=="object"&&Object.keys(k).length>0||k===!1:e.util.schemaHasRules(k,e.RULES.all))?(v.schema=k,v.schemaPath=o+"["+$+"]",v.errSchemaPath=c+"/"+$,r+="  "+e.validate(v)+" ",v.baseId=g):r+=" var "+m+" = true; ",$&&(r+=" if ("+m+" && "+w+") { "+p+" = false; "+E+" = ["+E+", "+$+"]; } else { ",f+="}"),r+=" if ("+m+") { "+p+" = "+w+" = true; "+E+" = "+$+"; }";return e.compositeRule=v.compositeRule=O,r+=""+f+"if (!"+p+") {   var err =   ",e.createErrors!==!1?(r+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { passingSchemas: "+E+" } ",e.opts.messages!==!1&&(r+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",e.opts.allErrors&&(r+=" } "),r}),_h}var wh,xh;function rw(){return xh||(xh=1,wh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;p?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=p?"(new RegExp("+h+"))":e.usePattern(s);r+="if ( ",p&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),r+=" !"+v+".test("+u+") ) {   ";var f=f||[];f.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { pattern:  ",p?r+=""+h:r+=""+e.util.toQuotedString(s),r+="  } ",e.opts.messages!==!1&&(r+=` , message: 'should match pattern "`,p?r+="' + "+h+" + '":r+=""+e.util.escapeQuotes(s),r+=`"' `),e.opts.verbose&&(r+=" , schema:  ",p?r+="validate.schema"+o:r+=""+e.util.toQuotedString(s),r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var m=r;return r=f.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+m+"]); ":r+=" validate.errors = ["+m+"]; return false; ":r+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+="} ",l&&(r+=" else { "),r}),wh}var jh,Eh;function aw(){return Eh||(Eh=1,jh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level,m="key"+n,g="idx"+n,w=h.dataLevel=e.dataLevel+1,E="data"+w,O="dataProperties"+n,x=Object.keys(s||{}).filter(Q),k=e.schema.patternProperties||{},$=Object.keys(k).filter(Q),N=e.schema.additionalProperties,M=x.length||$.length,A=N===!1,I=typeof N=="object"&&Object.keys(N).length,R=e.opts.removeAdditional,z=A||I||R,F=e.opts.ownProperties,U=e.baseId,V=e.schema.required;if(V&&!(e.opts.$data&&V.$data)&&V.length<e.opts.loopRequired)var re=e.util.toHash(V);function Q(ie){return ie!=="__proto__"}if(r+="var "+p+" = errors;var "+f+" = true;",F&&(r+=" var "+O+" = undefined;"),z){if(F?r+=" "+O+" = "+O+" || Object.keys("+u+"); for (var "+g+"=0; "+g+"<"+O+".length; "+g+"++) { var "+m+" = "+O+"["+g+"]; ":r+=" for (var "+m+" in "+u+") { ",M){if(r+=" var isAdditional"+n+" = !(false ",x.length)if(x.length>8)r+=" || validate.schema"+o+".hasOwnProperty("+m+") ";else{var oe=x;if(oe)for(var ce,Re=-1,Ze=oe.length-1;Re<Ze;)ce=oe[Re+=1],r+=" || "+m+" == "+e.util.toQuotedString(ce)+" "}if($.length){var K=$;if(K)for(var ae,xe=-1,ne=K.length-1;xe<ne;)ae=K[xe+=1],r+=" || "+e.usePattern(ae)+".test("+m+") "}r+=" ); if (isAdditional"+n+") { "}if(R=="all")r+=" delete "+u+"["+m+"]; ";else{var _=e.errorPath,C="' + "+m+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers)),A)if(R)r+=" delete "+u+"["+m+"]; ";else{r+=" "+f+" = false; ";var D=c;c=e.errSchemaPath+"/additionalProperties";var W=W||[];W.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { additionalProperty: '"+C+"' } ",e.opts.messages!==!1&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is an invalid additional property":r+="should NOT have additional properties",r+="' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var Z=r;r=W.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+Z+"]); ":r+=" validate.errors = ["+Z+"]; return false; ":r+=" var err = "+Z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=D,l&&(r+=" break; ")}else if(I)if(R=="failing"){r+=" var "+p+" = errors;  ";var j=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=N,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var S=u+"["+m+"]";h.dataPathArr[w]=m;var H=e.validate(h);h.baseId=U,e.util.varOccurences(H,E)<2?r+=" "+e.util.varReplace(H,E,S)+" ":r+=" var "+E+" = "+S+"; "+H+" ",r+=" if (!"+f+") { errors = "+p+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+u+"["+m+"]; }  ",e.compositeRule=h.compositeRule=j}else{h.schema=N,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var S=u+"["+m+"]";h.dataPathArr[w]=m;var H=e.validate(h);h.baseId=U,e.util.varOccurences(H,E)<2?r+=" "+e.util.varReplace(H,E,S)+" ":r+=" var "+E+" = "+S+"; "+H+" ",l&&(r+=" if (!"+f+") break; ")}e.errorPath=_}M&&(r+=" } "),r+=" }  ",l&&(r+=" if ("+f+") { ",v+="}")}var G=e.opts.useDefaults&&!e.compositeRule;if(x.length){var Ce=x;if(Ce)for(var ce,he=-1,ge=Ce.length-1;he<ge;){ce=Ce[he+=1];var Ue=s[ce];if(e.opts.strictKeywords?typeof Ue=="object"&&Object.keys(Ue).length>0||Ue===!1:e.util.schemaHasRules(Ue,e.RULES.all)){var yt=e.util.getProperty(ce),S=u+yt,se=G&&Ue.default!==void 0;h.schema=Ue,h.schemaPath=o+yt,h.errSchemaPath=c+"/"+e.util.escapeFragment(ce),h.errorPath=e.util.getPath(e.errorPath,ce,e.opts.jsonPointers),h.dataPathArr[w]=e.util.toQuotedString(ce);var H=e.validate(h);if(h.baseId=U,e.util.varOccurences(H,E)<2){H=e.util.varReplace(H,E,S);var Xe=S}else{var Xe=E;r+=" var "+E+" = "+S+"; "}if(se)r+=" "+H+" ";else{if(re&&re[ce]){r+=" if ( "+Xe+" === undefined ",F&&(r+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(ce)+"') "),r+=") { "+f+" = false; ";var _=e.errorPath,D=c,pe=e.util.escapeQuotes(ce);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(_,ce,e.opts.jsonPointers)),c=e.errSchemaPath+"/required";var W=W||[];W.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+pe+"' } ",e.opts.messages!==!1&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+pe+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var Z=r;r=W.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+Z+"]); ":r+=" validate.errors = ["+Z+"]; return false; ":r+=" var err = "+Z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=D,e.errorPath=_,r+=" } else { "}else l?(r+=" if ( "+Xe+" === undefined ",F&&(r+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(ce)+"') "),r+=") { "+f+" = true; } else { "):(r+=" if ("+Xe+" !== undefined ",F&&(r+=" &&   Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(ce)+"') "),r+=" ) { ");r+=" "+H+" } "}}l&&(r+=" if ("+f+") { ",v+="}")}}if($.length){var te=$;if(te)for(var ae,Ne=-1,de=te.length-1;Ne<de;){ae=te[Ne+=1];var Ue=k[ae];if(e.opts.strictKeywords?typeof Ue=="object"&&Object.keys(Ue).length>0||Ue===!1:e.util.schemaHasRules(Ue,e.RULES.all)){h.schema=Ue,h.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ae),h.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ae),F?r+=" "+O+" = "+O+" || Object.keys("+u+"); for (var "+g+"=0; "+g+"<"+O+".length; "+g+"++) { var "+m+" = "+O+"["+g+"]; ":r+=" for (var "+m+" in "+u+") { ",r+=" if ("+e.usePattern(ae)+".test("+m+")) { ",h.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var S=u+"["+m+"]";h.dataPathArr[w]=m;var H=e.validate(h);h.baseId=U,e.util.varOccurences(H,E)<2?r+=" "+e.util.varReplace(H,E,S)+" ":r+=" var "+E+" = "+S+"; "+H+" ",l&&(r+=" if (!"+f+") break; "),r+=" } ",l&&(r+=" else "+f+" = true; "),r+=" }  ",l&&(r+=" if ("+f+") { ",v+="}")}}}return l&&(r+=" "+v+" if ("+p+" == errors) {"),r}),jh}var Sh,kh;function nw(){return kh||(kh=1,Sh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level;if(r+="var "+p+" = errors;",e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){h.schema=s,h.schemaPath=o,h.errSchemaPath=c;var m="key"+n,g="idx"+n,w="i"+n,E="' + "+m+" + '",O=h.dataLevel=e.dataLevel+1,x="data"+O,k="dataProperties"+n,$=e.opts.ownProperties,N=e.baseId;$&&(r+=" var "+k+" = undefined; "),$?r+=" "+k+" = "+k+" || Object.keys("+u+"); for (var "+g+"=0; "+g+"<"+k+".length; "+g+"++) { var "+m+" = "+k+"["+g+"]; ":r+=" for (var "+m+" in "+u+") { ",r+=" var startErrs"+n+" = errors; ";var M=m,A=e.compositeRule;e.compositeRule=h.compositeRule=!0;var I=e.validate(h);h.baseId=N,e.util.varOccurences(I,x)<2?r+=" "+e.util.varReplace(I,x,M)+" ":r+=" var "+x+" = "+M+"; "+I+" ",e.compositeRule=h.compositeRule=A,r+=" if (!"+f+") { for (var "+w+"=startErrs"+n+"; "+w+"<errors; "+w+"++) { vErrors["+w+"].propertyName = "+m+"; }   var err =   ",e.createErrors!==!1?(r+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { propertyName: '"+E+"' } ",e.opts.messages!==!1&&(r+=" , message: 'property name \\'"+E+"\\' is invalid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),l&&(r+=" break; "),r+=" } }"}return l&&(r+=" "+v+" if ("+p+" == errors) {"),r}),Sh}var Ch,Ph;function sw(){return Ph||(Ph=1,Ch=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ");var v="schema"+n;if(!h)if(s.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var O=[],f=s;if(f)for(var m,g=-1,w=f.length-1;g<w;){m=f[g+=1];var E=e.schema.properties[m];E&&(e.opts.strictKeywords?typeof E=="object"&&Object.keys(E).length>0||E===!1:e.util.schemaHasRules(E,e.RULES.all))||(O[O.length]=m)}}else var O=s;if(h||O.length){var x=e.errorPath,k=h||O.length>=e.opts.loopRequired,$=e.opts.ownProperties;if(l)if(r+=" var missing"+n+"; ",k){h||(r+=" var "+v+" = validate.schema"+o+"; ");var N="i"+n,M="schema"+n+"["+N+"]",A="' + "+M+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,M,e.opts.jsonPointers)),r+=" var "+p+" = true; ",h&&(r+=" if (schema"+n+" === undefined) "+p+" = true; else if (!Array.isArray(schema"+n+")) "+p+" = false; else {"),r+=" for (var "+N+" = 0; "+N+" < "+v+".length; "+N+"++) { "+p+" = "+u+"["+v+"["+N+"]] !== undefined ",$&&(r+=" &&   Object.prototype.hasOwnProperty.call("+u+", "+v+"["+N+"]) "),r+="; if (!"+p+") break; } ",h&&(r+="  }  "),r+="  if (!"+p+") {   ";var I=I||[];I.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+A+"' } ",e.opts.messages!==!1&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+A+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var R=r;r=I.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+R+"]); ":r+=" validate.errors = ["+R+"]; return false; ":r+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else{r+=" if ( ";var z=O;if(z)for(var F,N=-1,U=z.length-1;N<U;){F=z[N+=1],N&&(r+=" || ");var V=e.util.getProperty(F),re=u+V;r+=" ( ( "+re+" === undefined ",$&&(r+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(F)+"') "),r+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?F:V)+") ) "}r+=") {  ";var M="missing"+n,A="' + "+M+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,M,!0):x+" + "+M);var I=I||[];I.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+A+"' } ",e.opts.messages!==!1&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+A+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var R=r;r=I.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+R+"]); ":r+=" validate.errors = ["+R+"]; return false; ":r+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else if(k){h||(r+=" var "+v+" = validate.schema"+o+"; ");var N="i"+n,M="schema"+n+"["+N+"]",A="' + "+M+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,M,e.opts.jsonPointers)),h&&(r+=" if ("+v+" && !Array.isArray("+v+")) {  var err =   ",e.createErrors!==!1?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+A+"' } ",e.opts.messages!==!1&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+A+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+v+" !== undefined) { "),r+=" for (var "+N+" = 0; "+N+" < "+v+".length; "+N+"++) { if ("+u+"["+v+"["+N+"]] === undefined ",$&&(r+=" || ! Object.prototype.hasOwnProperty.call("+u+", "+v+"["+N+"]) "),r+=") {  var err =   ",e.createErrors!==!1?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+A+"' } ",e.opts.messages!==!1&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+A+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",h&&(r+="  }  ")}else{var Q=O;if(Q)for(var F,oe=-1,ce=Q.length-1;oe<ce;){F=Q[oe+=1];var V=e.util.getProperty(F),A=e.util.escapeQuotes(F),re=u+V;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,F,e.opts.jsonPointers)),r+=" if ( "+re+" === undefined ",$&&(r+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(F)+"') "),r+=") {  var err =   ",e.createErrors!==!1?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+A+"' } ",e.opts.messages!==!1&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+A+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=x}else l&&(r+=" if (true) {");return r}),Ch}var Nh,Oh;function iw(){return Oh||(Oh=1,Nh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data,v;if(h?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",v="schema"+n):v=s,(s||h)&&e.opts.uniqueItems!==!1){h&&(r+=" var "+p+"; if ("+v+" === false || "+v+" === undefined) "+p+" = true; else if (typeof "+v+" != 'boolean') "+p+" = false; else { "),r+=" var i = "+u+".length , "+p+" = true , j; if (i > 1) { ";var f=e.schema.items&&e.schema.items.type,m=Array.isArray(f);if(!f||f=="object"||f=="array"||m&&(f.indexOf("object")>=0||f.indexOf("array")>=0))r+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+u+"[i], "+u+"[j])) { "+p+" = false; break outer; } } } ";else{r+=" var itemIndices = {}, item; for (;i--;) { var item = "+u+"[i]; ";var g="checkDataType"+(m?"s":"");r+=" if ("+e.util[g](f,"item",e.opts.strictNumbers,!0)+") continue; ",m&&(r+=` if (typeof item == 'string') item = '"' + item; `),r+=" if (typeof itemIndices[item] == 'number') { "+p+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}r+=" } ",h&&(r+="  }  "),r+=" if (!"+p+") {   ";var w=w||[];w.push(r),r="",e.createErrors!==!1?(r+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(r+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(r+=" , schema:  ",h?r+="validate.schema"+o:r+=""+s,r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),r+=" } "):r+=" {} ";var E=r;r=w.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+E+"]); ":r+=" validate.errors = ["+E+"]; return false; ":r+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",l&&(r+=" else { ")}else l&&(r+=" if (true) { ");return r}),Nh}var $h,Rh;function ow(){return Rh||(Rh=1,$h={$ref:Ub(),allOf:Hb(),anyOf:qb(),$comment:Vb(),const:Bb(),contains:Wb(),dependencies:Kb(),enum:Jb(),format:Qb(),if:Gb(),items:Xb(),maximum:sh(),minimum:sh(),maxItems:ch(),minItems:ch(),maxLength:uh(),minLength:uh(),maxProperties:mh(),minProperties:mh(),multipleOf:Yb(),not:ew(),oneOf:tw(),pattern:rw(),properties:aw(),propertyNames:nw(),required:sw(),uniqueItems:iw(),validate:$u()}),$h}var uo,Th;function cw(){if(Th)return uo;Th=1;var e=ow(),t=Aa().toHash;return uo=function(){var a=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],r=["type","$comment"],n=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],i=["number","integer","string","array","object","boolean","null"];return a.all=t(r),a.types=t(i),a.forEach(function(s){s.rules=s.rules.map(function(o){var c;if(typeof o=="object"){var l=Object.keys(o)[0];c=o[l],o=l,c.forEach(function(p){r.push(p),a.all[p]=!0})}r.push(o);var u=a.all[o]={keyword:o,code:e[o],implements:c};return u}),a.all.$comment={keyword:"$comment",code:e.$comment},s.type&&(a.types[s.type]=s)}),a.keywords=t(r.concat(n)),a.custom={},a},uo}var ho,Ih;function dw(){if(Ih)return ho;Ih=1;var e=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];return ho=function(t,a){for(var r=0;r<a.length;r++){t=JSON.parse(JSON.stringify(t));var n=a[r].split("/"),i=t,s;for(s=1;s<n.length;s++)i=i[n[s]];for(s=0;s<e.length;s++){var o=e[s],c=i[o];c&&(i[o]={anyOf:[c,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return t},ho}var po,Lh;function lw(){if(Lh)return po;Lh=1;var e=io().MissingRef;po=t;function t(a,r,n){var i=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof r=="function"&&(n=r,r=void 0);var s=o(a).then(function(){var l=i._addSchema(a,void 0,r);return l.validate||c(l)});return n&&s.then(function(l){n(null,l)},n),s;function o(l){var u=l.$schema;return u&&!i.getSchema(u)?t.call(i,{$ref:u},!0):Promise.resolve()}function c(l){try{return i._compile(l)}catch(p){if(p instanceof e)return u(p);throw p}function u(p){var h=p.missingSchema;if(m(h))throw new Error("Schema "+h+" is loaded but "+p.missingRef+" cannot be resolved");var v=i._loadingSchemas[h];return v||(v=i._loadingSchemas[h]=i._opts.loadSchema(h),v.then(f,f)),v.then(function(g){if(!m(h))return o(g).then(function(){m(h)||i.addSchema(g,h,void 0,r)})}).then(function(){return c(l)});function f(){delete i._loadingSchemas[h]}function m(g){return i._refs[g]||i._schemas[g]}}}}return po}var Mh,Dh;function uw(){return Dh||(Dh=1,Mh=function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,s=e.schema[t],o=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,u,p="data"+(i||""),h="valid"+n,v="errs__"+n,f=e.opts.$data&&s&&s.$data,m;f?(r+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",m="schema"+n):m=s;var g=this,w="definition"+n,E=g.definition,O="",x,k,$,N,M;if(f&&E.$data){M="keywordValidate"+n;var A=E.validateSchema;r+=" var "+w+" = RULES.custom['"+t+"'].definition; var "+M+" = "+w+".validate;"}else{if(N=e.useCustomRule(g,s,e.schema,e),!N)return;m="validate.schema"+o,M=N.code,x=E.compile,k=E.inline,$=E.macro}var I=M+".errors",R="i"+n,z="ruleErr"+n,F=E.async;if(F&&!e.async)throw new Error("async keyword in sync schema");if(k||$||(r+=""+I+" = null;"),r+="var "+v+" = errors;var "+h+";",f&&E.$data&&(O+="}",r+=" if ("+m+" === undefined) { "+h+" = true; } else { ",A&&(O+="}",r+=" "+h+" = "+w+".validateSchema("+m+"); if ("+h+") { ")),k)E.statements?r+=" "+N.validate+" ":r+=" "+h+" = "+N.validate+"; ";else if($){var U=e.util.copy(e),O="";U.level++;var V="valid"+U.level;U.schema=N.validate,U.schemaPath="";var re=e.compositeRule;e.compositeRule=U.compositeRule=!0;var Q=e.validate(U).replace(/validate\.schema/g,M);e.compositeRule=U.compositeRule=re,r+=" "+Q}else{var oe=oe||[];oe.push(r),r="",r+="  "+M+".call( ",e.opts.passContext?r+="this":r+="self",x||E.schema===!1?r+=" , "+p+" ":r+=" , "+m+" , "+p+" , validate.schema"+e.schemaPath+" ",r+=" , (dataPath || '')",e.errorPath!='""'&&(r+=" + "+e.errorPath);var ce=i?"data"+(i-1||""):"parentData",Re=i?e.dataPathArr[i]:"parentDataProperty";r+=" , "+ce+" , "+Re+" , rootData )  ";var Ze=r;r=oe.pop(),E.errors===!1?(r+=" "+h+" = ",F&&(r+="await "),r+=""+Ze+"; "):F?(I="customErrors"+n,r+=" var "+I+" = null; try { "+h+" = await "+Ze+"; } catch (e) { "+h+" = false; if (e instanceof ValidationError) "+I+" = e.errors; else throw e; } "):r+=" "+I+" = null; "+h+" = "+Ze+"; "}if(E.modifying&&(r+=" if ("+ce+") "+p+" = "+ce+"["+Re+"];"),r+=""+O,E.valid)l&&(r+=" if (true) { ");else{r+=" if ( ",E.valid===void 0?(r+=" !",$?r+=""+V:r+=""+h):r+=" "+!E.valid+" ",r+=") { ",u=g.keyword;var oe=oe||[];oe.push(r),r="";var oe=oe||[];oe.push(r),r="",e.createErrors!==!1?(r+=" { keyword: '"+(u||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+g.keyword+"' } ",e.opts.messages!==!1&&(r+=` , message: 'should pass "`+g.keyword+`" keyword validation' `),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),r+=" } "):r+=" {} ";var K=r;r=oe.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+K+"]); ":r+=" validate.errors = ["+K+"]; return false; ":r+=" var err = "+K+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var ae=r;r=oe.pop(),k?E.errors?E.errors!="full"&&(r+="  for (var "+R+"="+v+"; "+R+"<errors; "+R+"++) { var "+z+" = vErrors["+R+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+z+".schemaPath === undefined) { "+z+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(r+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),r+=" } "):E.errors===!1?r+=" "+ae+" ":(r+=" if ("+v+" == errors) { "+ae+" } else {  for (var "+R+"="+v+"; "+R+"<errors; "+R+"++) { var "+z+" = vErrors["+R+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+z+".schemaPath === undefined) { "+z+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(r+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),r+=" } } "):$?(r+="   var err =   ",e.createErrors!==!1?(r+=" { keyword: '"+(u||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+g.keyword+"' } ",e.opts.messages!==!1&&(r+=` , message: 'should pass "`+g.keyword+`" keyword validation' `),e.opts.verbose&&(r+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; ")):E.errors===!1?r+=" "+ae+" ":(r+=" if (Array.isArray("+I+")) { if (vErrors === null) vErrors = "+I+"; else vErrors = vErrors.concat("+I+"); errors = vErrors.length;  for (var "+R+"="+v+"; "+R+"<errors; "+R+"++) { var "+z+" = vErrors["+R+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+";  "+z+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(r+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),r+=" } } else { "+ae+" } "),r+=" } ",l&&(r+=" else { ")}return r}),Mh}const hw="http://json-schema.org/draft-07/schema#",pw="http://json-schema.org/draft-07/schema#",mw="Core schema meta-schema",fw={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},vw=["object","boolean"],gw={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},Ah={$schema:hw,$id:pw,title:mw,definitions:fw,type:vw,properties:gw,default:!0};var mo,Fh;function yw(){if(Fh)return mo;Fh=1;var e=Ah;return mo={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:e.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:e.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}},mo}var fo,zh;function _w(){if(zh)return fo;zh=1;var e=/^[a-z_$][a-z0-9_$-]*$/i,t=uw(),a=yw();fo={add:r,get:n,remove:i,validate:s};function r(o,c){var l=this.RULES;if(l.keywords[o])throw new Error("Keyword "+o+" is already defined");if(!e.test(o))throw new Error("Keyword "+o+" is not a valid identifier");if(c){this.validateKeyword(c,!0);var u=c.type;if(Array.isArray(u))for(var p=0;p<u.length;p++)v(o,u[p],c);else v(o,u,c);var h=c.metaSchema;h&&(c.$data&&this._opts.$data&&(h={anyOf:[h,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),c.validateSchema=this.compile(h,!0))}l.keywords[o]=l.all[o]=!0;function v(f,m,g){for(var w,E=0;E<l.length;E++){var O=l[E];if(O.type==m){w=O;break}}w||(w={type:m,rules:[]},l.push(w));var x={keyword:f,definition:g,custom:!0,code:t,implements:g.implements};w.rules.push(x),l.custom[f]=x}return this}function n(o){var c=this.RULES.custom[o];return c?c.definition:this.RULES.keywords[o]||!1}function i(o){var c=this.RULES;delete c.keywords[o],delete c.all[o],delete c.custom[o];for(var l=0;l<c.length;l++)for(var u=c[l].rules,p=0;p<u.length;p++)if(u[p].keyword==o){u.splice(p,1);break}return this}function s(o,c){s.errors=null;var l=this._validateKeyword=this._validateKeyword||this.compile(a,!0);if(l(o))return!0;if(s.errors=l.errors,c)throw new Error("custom keyword definition is invalid: "+this.errorsText(l.errors));return!1}return fo}const bw="http://json-schema.org/draft-07/schema#",ww="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",xw="Meta-schema for $data reference (JSON Schema extension proposal)",jw="object",Ew=["$data"],Sw={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},kw=!1,Cw={$schema:bw,$id:ww,description:xw,type:jw,required:Ew,properties:Sw,additionalProperties:kw};var vo,Zh;function Pw(){if(Zh)return vo;Zh=1;var e=Fb(),t=no(),a=zb(),r=xu(),n=Pu(),i=Zb(),s=cw(),o=dw(),c=Aa();vo=f,f.prototype.validate=m,f.prototype.compile=g,f.prototype.addSchema=w,f.prototype.addMetaSchema=E,f.prototype.validateSchema=O,f.prototype.getSchema=k,f.prototype.removeSchema=M,f.prototype.addFormat=Q,f.prototype.errorsText=re,f.prototype._addSchema=I,f.prototype._compile=R,f.prototype.compileAsync=lw();var l=_w();f.prototype.addKeyword=l.add,f.prototype.getKeyword=l.get,f.prototype.removeKeyword=l.remove,f.prototype.validateKeyword=l.validate;var u=io();f.ValidationError=u.Validation,f.MissingRefError=u.MissingRef,f.$dataMetaSchema=o;var p="http://json-schema.org/draft-07/schema",h=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],v=["/properties"];function f(_){if(!(this instanceof f))return new f(_);_=this._opts=c.copy(_)||{},xe(this),this._schemas={},this._refs={},this._fragments={},this._formats=i(_.format),this._cache=_.cache||new a,this._loadingSchemas={},this._compilations=[],this.RULES=s(),this._getId=z(_),_.loopRequired=_.loopRequired||1/0,_.errorDataPath=="property"&&(_._errorDataPathProperty=!0),_.serialize===void 0&&(_.serialize=n),this._metaOpts=ae(this),_.formats&&Re(this),_.keywords&&Ze(this),oe(this),typeof _.meta=="object"&&this.addMetaSchema(_.meta),_.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),ce(this)}function m(_,C){var D;if(typeof _=="string"){if(D=this.getSchema(_),!D)throw new Error('no schema with key or ref "'+_+'"')}else{var W=this._addSchema(_);D=W.validate||this._compile(W)}var Z=D(C);return D.$async!==!0&&(this.errors=D.errors),Z}function g(_,C){var D=this._addSchema(_,void 0,C);return D.validate||this._compile(D)}function w(_,C,D,W){if(Array.isArray(_)){for(var Z=0;Z<_.length;Z++)this.addSchema(_[Z],void 0,D,W);return this}var j=this._getId(_);if(j!==void 0&&typeof j!="string")throw new Error("schema id must be string");return C=t.normalizeId(C||j),K(this,C),this._schemas[C]=this._addSchema(_,D,W,!0),this}function E(_,C,D){return this.addSchema(_,C,D,!0),this}function O(_,C){var D=_.$schema;if(D!==void 0&&typeof D!="string")throw new Error("$schema must be a string");if(D=D||this._opts.defaultMeta||x(this),!D)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var W=this.validate(D,_);if(!W&&C){var Z="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(Z);else throw new Error(Z)}return W}function x(_){var C=_._opts.meta;return _._opts.defaultMeta=typeof C=="object"?_._getId(C)||C:_.getSchema(p)?p:void 0,_._opts.defaultMeta}function k(_){var C=N(this,_);switch(typeof C){case"object":return C.validate||this._compile(C);case"string":return this.getSchema(C);case"undefined":return $(this,_)}}function $(_,C){var D=t.schema.call(_,{schema:{}},C);if(D){var W=D.schema,Z=D.root,j=D.baseId,S=e.call(_,W,Z,void 0,j);return _._fragments[C]=new r({ref:C,fragment:!0,schema:W,root:Z,baseId:j,validate:S}),S}}function N(_,C){return C=t.normalizeId(C),_._schemas[C]||_._refs[C]||_._fragments[C]}function M(_){if(_ instanceof RegExp)return A(this,this._schemas,_),A(this,this._refs,_),this;switch(typeof _){case"undefined":return A(this,this._schemas),A(this,this._refs),this._cache.clear(),this;case"string":var C=N(this,_);return C&&this._cache.del(C.cacheKey),delete this._schemas[_],delete this._refs[_],this;case"object":var D=this._opts.serialize,W=D?D(_):_;this._cache.del(W);var Z=this._getId(_);Z&&(Z=t.normalizeId(Z),delete this._schemas[Z],delete this._refs[Z])}return this}function A(_,C,D){for(var W in C){var Z=C[W];!Z.meta&&(!D||D.test(W))&&(_._cache.del(Z.cacheKey),delete C[W])}}function I(_,C,D,W){if(typeof _!="object"&&typeof _!="boolean")throw new Error("schema should be object or boolean");var Z=this._opts.serialize,j=Z?Z(_):_,S=this._cache.get(j);if(S)return S;W=W||this._opts.addUsedSchema!==!1;var H=t.normalizeId(this._getId(_));H&&W&&K(this,H);var G=this._opts.validateSchema!==!1&&!C,Ce;G&&!(Ce=H&&H==t.normalizeId(_.$schema))&&this.validateSchema(_,!0);var he=t.ids.call(this,_),ge=new r({id:H,schema:_,localRefs:he,cacheKey:j,meta:D});return H[0]!="#"&&W&&(this._refs[H]=ge),this._cache.put(j,ge),G&&Ce&&this.validateSchema(_,!0),ge}function R(_,C){if(_.compiling)return _.validate=Z,Z.schema=_.schema,Z.errors=null,Z.root=C||Z,_.schema.$async===!0&&(Z.$async=!0),Z;_.compiling=!0;var D;_.meta&&(D=this._opts,this._opts=this._metaOpts);var W;try{W=e.call(this,_.schema,C,_.localRefs)}catch(j){throw delete _.validate,j}finally{_.compiling=!1,_.meta&&(this._opts=D)}return _.validate=W,_.refs=W.refs,_.refVal=W.refVal,_.root=W.root,W;function Z(){var j=_.validate,S=j.apply(this,arguments);return Z.errors=j.errors,S}}function z(_){switch(_.schemaId){case"auto":return V;case"id":return F;default:return U}}function F(_){return _.$id&&this.logger.warn("schema $id ignored",_.$id),_.id}function U(_){return _.id&&this.logger.warn("schema id ignored",_.id),_.$id}function V(_){if(_.$id&&_.id&&_.$id!=_.id)throw new Error("schema $id is different from id");return _.$id||_.id}function re(_,C){if(_=_||this.errors,!_)return"No errors";C=C||{};for(var D=C.separator===void 0?", ":C.separator,W=C.dataVar===void 0?"data":C.dataVar,Z="",j=0;j<_.length;j++){var S=_[j];S&&(Z+=W+S.dataPath+" "+S.message+D)}return Z.slice(0,-D.length)}function Q(_,C){return typeof C=="string"&&(C=new RegExp(C)),this._formats[_]=C,this}function oe(_){var C;if(_._opts.$data&&(C=Cw,_.addMetaSchema(C,C.$id,!0)),_._opts.meta!==!1){var D=Ah;_._opts.$data&&(D=o(D,v)),_.addMetaSchema(D,p,!0),_._refs["http://json-schema.org/schema"]=p}}function ce(_){var C=_._opts.schemas;if(C)if(Array.isArray(C))_.addSchema(C);else for(var D in C)_.addSchema(C[D],D)}function Re(_){for(var C in _._opts.formats){var D=_._opts.formats[C];_.addFormat(C,D)}}function Ze(_){for(var C in _._opts.keywords){var D=_._opts.keywords[C];_.addKeyword(C,D)}}function K(_,C){if(_._schemas[C]||_._refs[C])throw new Error('schema with key or id "'+C+'" already exists')}function ae(_){for(var C=c.copy(_._opts),D=0;D<h.length;D++)delete C[h[D]];return C}function xe(_){var C=_._opts.logger;if(C===!1)_.logger={log:ne,warn:ne,error:ne};else{if(C===void 0&&(C=console),!(typeof C=="object"&&C.log&&C.warn&&C.error))throw new Error("logger must implement log, warn and error methods");_.logger=C}}function ne(){}return vo}var Nw=Pw();const Ow=qc(Nw);class go extends Tb{constructor(t,a){var r;super(a),this._clientInfo=t,this._cachedToolOutputValidators=new Map,this._capabilities=(r=a==null?void 0:a.capabilities)!==null&&r!==void 0?r:{},this._ajv=new Ow}registerCapabilities(t){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=Ib(this._capabilities,t)}assertCapability(t,a){var r;if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r[t]))throw new Error(`Server does not support ${t} (required for ${a})`)}async connect(t,a){if(await super.connect(t),t.sessionId===void 0)try{const r=await this.request({method:"initialize",params:{protocolVersion:Ps,capabilities:this._capabilities,clientInfo:this._clientInfo}},ru,a);if(r===void 0)throw new Error(`Server sent invalid initialize result: ${r}`);if(!L0.includes(r.protocolVersion))throw new Error(`Server's protocol version is not supported: ${r.protocolVersion}`);this._serverCapabilities=r.capabilities,this._serverVersion=r.serverInfo,t.setProtocolVersion&&t.setProtocolVersion(r.protocolVersion),this._instructions=r.instructions,await this.notification({method:"notifications/initialized"})}catch(r){throw this.close(),r}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(t){var a,r,n,i,s;switch(t){case"logging/setLevel":if(!(!((a=this._serverCapabilities)===null||a===void 0)&&a.logging))throw new Error(`Server does not support logging (required for ${t})`);break;case"prompts/get":case"prompts/list":if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r.prompts))throw new Error(`Server does not support prompts (required for ${t})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(!((n=this._serverCapabilities)===null||n===void 0)&&n.resources))throw new Error(`Server does not support resources (required for ${t})`);if(t==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${t})`);break;case"tools/call":case"tools/list":if(!(!((i=this._serverCapabilities)===null||i===void 0)&&i.tools))throw new Error(`Server does not support tools (required for ${t})`);break;case"completion/complete":if(!(!((s=this._serverCapabilities)===null||s===void 0)&&s.completions))throw new Error(`Server does not support completions (required for ${t})`);break}}assertNotificationCapability(t){var a;switch(t){case"notifications/roots/list_changed":if(!(!((a=this._capabilities.roots)===null||a===void 0)&&a.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${t})`);break}}assertRequestHandlerCapability(t){switch(t){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${t})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${t})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${t})`);break}}async ping(t){return this.request({method:"ping"},Da,t)}async complete(t,a){return this.request({method:"completion/complete",params:t},vu,a)}async setLoggingLevel(t,a){return this.request({method:"logging/setLevel",params:{level:t}},Da,a)}async getPrompt(t,a){return this.request({method:"prompts/get",params:t},pu,a)}async listPrompts(t,a){return this.request({method:"prompts/list",params:t},uu,a)}async listResources(t,a){return this.request({method:"resources/list",params:t},cu,a)}async listResourceTemplates(t,a){return this.request({method:"resources/templates/list",params:t},du,a)}async readResource(t,a){return this.request({method:"resources/read",params:t},lu,a)}async subscribeResource(t,a){return this.request({method:"resources/subscribe",params:t},Da,a)}async unsubscribeResource(t,a){return this.request({method:"resources/unsubscribe",params:t},Da,a)}async callTool(t,a=Ts,r){const n=await this.request({method:"tools/call",params:t},a,r),i=this.getToolOutputValidator(t.name);if(i){if(!n.structuredContent&&!n.isError)throw new Br(fr.InvalidRequest,`Tool ${t.name} has an output schema but did not return structured content`);if(n.structuredContent)try{if(!i(n.structuredContent))throw new Br(fr.InvalidParams,`Structured content does not match the tool's output schema: ${this._ajv.errorsText(i.errors)}`)}catch(s){throw s instanceof Br?s:new Br(fr.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return n}cacheToolOutputSchemas(t){this._cachedToolOutputValidators.clear();for(const a of t)if(a.outputSchema)try{const r=this._ajv.compile(a.outputSchema);this._cachedToolOutputValidators.set(a.name,r)}catch{}}getToolOutputValidator(t){return this._cachedToolOutputValidators.get(t)}async listTools(t,a){const r=await this.request({method:"tools/list",params:t},mu,a);return this.cacheToolOutputSchemas(r.tools),r}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}var pa={exports:{}},yo,Uh;function $w(){if(Uh)return yo;Uh=1;var e={};yo=n,n.sync=i;var t=Fr;function a(s,o){var c=o.pathExt!==void 0?o.pathExt:e.PATHEXT;if(!c||(c=c.split(";"),c.indexOf("")!==-1))return!0;for(var l=0;l<c.length;l++){var u=c[l].toLowerCase();if(u&&s.substr(-u.length).toLowerCase()===u)return!0}return!1}function r(s,o,c){return!s.isSymbolicLink()&&!s.isFile()?!1:a(o,c)}function n(s,o,c){t.stat(s,function(l,u){c(l,l?!1:r(u,s,o))})}function i(s,o){return r(t.statSync(s),s,o)}return yo}var _o,Hh;function Rw(){if(Hh)return _o;Hh=1,_o=t,t.sync=a;var e=Fr;function t(i,s,o){e.stat(i,function(c,l){o(c,c?!1:r(l,s))})}function a(i,s){return r(e.statSync(i),s)}function r(i,s){return i.isFile()&&n(i,s)}function n(i,s){var o=i.mode,c=i.uid,l=i.gid,u=s.uid!==void 0?s.uid:Ie.getuid&&Ie.getuid(),p=s.gid!==void 0?s.gid:Ie.getgid&&Ie.getgid(),h=parseInt("100",8),v=parseInt("010",8),f=parseInt("001",8),m=h|v,g=o&f||o&v&&l===p||o&h&&c===u||o&m&&u===0;return g}return _o}var bo,qh;function Tw(){if(qh)return bo;qh=1;var e;Ie.platform==="win32"||xa.TESTING_WINDOWS?e=$w():e=Rw(),bo=t,t.sync=a;function t(r,n,i){if(typeof n=="function"&&(i=n,n={}),!i){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,o){t(r,n||{},function(c,l){c?o(c):s(l)})})}e(r,n||{},function(s,o){s&&(s.code==="EACCES"||n&&n.ignoreErrors)&&(s=null,o=!1),i(s,o)})}function a(r,n){try{return e.sync(r,n||{})}catch(i){if(n&&n.ignoreErrors||i.code==="EACCES")return!1;throw i}}return bo}var wo,Vh;function Iw(){if(Vh)return wo;Vh=1;var e={};const t=Ie.platform==="win32"||e.OSTYPE==="cygwin"||e.OSTYPE==="msys",a=Fr,r=t?";":":",n=Tw(),i=l=>Object.assign(new Error(`not found: ${l}`),{code:"ENOENT"}),s=(l,u)=>{const p=u.colon||r,h=l.match(/\//)||t&&l.match(/\\/)?[""]:[...t?[Ie.cwd()]:[],...(u.path||e.PATH||"").split(p)],v=t?u.pathExt||e.PATHEXT||".EXE;.CMD;.BAT;.COM":"",f=t?v.split(p):[""];return t&&l.indexOf(".")!==-1&&f[0]!==""&&f.unshift(""),{pathEnv:h,pathExt:f,pathExtExe:v}},o=(l,u,p)=>{typeof u=="function"&&(p=u,u={}),u||(u={});const{pathEnv:h,pathExt:v,pathExtExe:f}=s(l,u),m=[],g=E=>new Promise((O,x)=>{if(E===h.length)return u.all&&m.length?O(m):x(i(l));const k=h[E],$=/^".*"$/.test(k)?k.slice(1,-1):k,N=a.join($,l),M=!$&&/^\.[\\\/]/.test(l)?l.slice(0,2)+N:N;O(w(M,E,0))}),w=(E,O,x)=>new Promise((k,$)=>{if(x===v.length)return k(g(O+1));const N=v[x];n(E+N,{pathExt:f},(M,A)=>{if(!M&&A)if(u.all)m.push(E+N);else return k(E+N);return k(w(E,O,x+1))})});return p?g(0).then(E=>p(null,E),p):g(0)},c=(l,u)=>{u=u||{};const{pathEnv:p,pathExt:h,pathExtExe:v}=s(l,u),f=[];for(let m=0;m<p.length;m++){const g=p[m],w=/^".*"$/.test(g)?g.slice(1,-1):g,E=a.join(w,l),O=!w&&/^\.[\\\/]/.test(l)?l.slice(0,2)+E:E;for(let x=0;x<h.length;x++){const k=O+h[x];try{if(n.sync(k,{pathExt:v}))if(u.all)f.push(k);else return k}catch{}}}if(u.all&&f.length)return f;if(u.nothrow)return null;throw i(l)};return wo=o,o.sync=c,wo}var Ls={exports:{}},Bh;function Lw(){if(Bh)return Ls.exports;Bh=1;var e={};const t=(a={})=>{const r=a.env||e;return(a.platform||Ie.platform)!=="win32"?"PATH":Object.keys(r).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};return Ls.exports=t,Ls.exports.default=t,Ls.exports}var xo,Wh;function Mw(){if(Wh)return xo;Wh=1;var e={};const t=Fr,a=Iw(),r=Lw();function n(s,o){const c=s.options.env||e,l=Ie.cwd(),u=s.options.cwd!=null,p=u&&Ie.chdir!==void 0&&!Ie.chdir.disabled;if(p)try{Ie.chdir(s.options.cwd)}catch{}let h;try{h=a.sync(s.command,{path:c[r({env:c})],pathExt:o?t.delimiter:void 0})}catch{}finally{p&&Ie.chdir(l)}return h&&(h=t.resolve(u?s.options.cwd:"",h)),h}function i(s){return n(s)||n(s,!0)}return xo=i,xo}var Ms={},Kh;function Dw(){if(Kh)return Ms;Kh=1;const e=/([()\][%!^"`<>&|;, *?])/g;function t(r){return r=r.replace(e,"^$1"),r}function a(r,n){return r=`${r}`,r=r.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),r=r.replace(/(?=(\\+?)?)\1$/,"$1$1"),r=`"${r}"`,r=r.replace(e,"^$1"),n&&(r=r.replace(e,"^$1")),r}return Ms.command=t,Ms.argument=a,Ms}var Jh,Qh;function Aw(){return Qh||(Qh=1,Jh=/^#!(.*)/),Jh}var jo,Gh;function Fw(){if(Gh)return jo;Gh=1;const e=Aw();return jo=(t="")=>{const a=t.match(e);if(!a)return null;const[r,n]=a[0].replace(/#! ?/,"").split(" "),i=r.split("/").pop();return i==="env"?n:n?`${i} ${n}`:i},jo}var Eo,Xh;function zw(){if(Xh)return Eo;Xh=1;const e=Fr,t=Fw();function a(r){const n=Nm.alloc(150);let i;try{i=e.openSync(r,"r"),e.readSync(i,n,0,150,0),e.closeSync(i)}catch{}return t(n.toString())}return Eo=a,Eo}var So,Yh;function Zw(){if(Yh)return So;Yh=1;var e={};const t=Fr,a=Mw(),r=Dw(),n=zw(),i=Ie.platform==="win32",s=/\.(?:com|exe)$/i,o=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function c(p){p.file=a(p);const h=p.file&&n(p.file);return h?(p.args.unshift(p.file),p.command=h,a(p)):p.file}function l(p){if(!i)return p;const h=c(p),v=!s.test(h);if(p.options.forceShell||v){const f=o.test(h);p.command=t.normalize(p.command),p.command=r.command(p.command),p.args=p.args.map(g=>r.argument(g,f));const m=[p.command].concat(p.args).join(" ");p.args=["/d","/s","/c",`"${m}"`],p.command=e.comspec||"cmd.exe",p.options.windowsVerbatimArguments=!0}return p}function u(p,h,v){h&&!Array.isArray(h)&&(v=h,h=null),h=h?h.slice(0):[],v=Object.assign({},v);const f={command:p,args:h,options:v,file:void 0,original:{command:p,args:h}};return v.shell?f:l(f)}return So=u,So}var ko,ep;function Uw(){if(ep)return ko;ep=1;const e=Ie.platform==="win32";function t(i,s){return Object.assign(new Error(`${s} ${i.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${s} ${i.command}`,path:i.command,spawnargs:i.args})}function a(i,s){if(!e)return;const o=i.emit;i.emit=function(c,l){if(c==="exit"){const u=r(l,s);if(u)return o.call(i,"error",u)}return o.apply(i,arguments)}}function r(i,s){return e&&i===1&&!s.file?t(s.original,"spawn"):null}function n(i,s){return e&&i===1&&!s.file?t(s.original,"spawnSync"):null}return ko={hookChildProcess:a,verifyENOENT:r,verifyENOENTSync:n,notFoundError:t},ko}var tp;function Hw(){if(tp)return pa.exports;tp=1;const e=Fr,t=Zw(),a=Uw();function r(i,s,o){const c=t(i,s,o),l=e.spawn(c.command,c.args,c.options);return a.hookChildProcess(l,c),l}function n(i,s,o){const c=t(i,s,o),l=e.spawnSync(c.command,c.args,c.options);return l.error=l.error||a.verifyENOENTSync(l.status,c),l}return pa.exports=r,pa.exports.spawn=r,pa.exports.sync=n,pa.exports._parse=t,pa.exports._enoent=a,pa.exports}var qw=Hw();const Vw=qc(qw);var rp,ap;function np(){return ap||(ap=1,rp=Vc().EventEmitter),rp}var Co,sp;function Bw(){if(sp)return Co;sp=1;function e(f,m){var g=Object.keys(f);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(f);m&&(w=w.filter(function(E){return Object.getOwnPropertyDescriptor(f,E).enumerable})),g.push.apply(g,w)}return g}function t(f){for(var m=1;m<arguments.length;m++){var g=arguments[m]!=null?arguments[m]:{};m%2?e(Object(g),!0).forEach(function(w){a(f,w,g[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(g)):e(Object(g)).forEach(function(w){Object.defineProperty(f,w,Object.getOwnPropertyDescriptor(g,w))})}return f}function a(f,m,g){return m=s(m),m in f?Object.defineProperty(f,m,{value:g,enumerable:!0,configurable:!0,writable:!0}):f[m]=g,f}function r(f,m){if(!(f instanceof m))throw new TypeError("Cannot call a class as a function")}function n(f,m){for(var g=0;g<m.length;g++){var w=m[g];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,s(w.key),w)}}function i(f,m,g){return m&&n(f.prototype,m),Object.defineProperty(f,"prototype",{writable:!1}),f}function s(f){var m=o(f,"string");return typeof m=="symbol"?m:String(m)}function o(f,m){if(typeof f!="object"||f===null)return f;var g=f[Symbol.toPrimitive];if(g!==void 0){var w=g.call(f,m||"default");if(typeof w!="object")return w;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(f)}var c=Bc(),l=c.Buffer,u=Fr,p=u.inspect,h=p&&p.custom||"inspect";function v(f,m,g){l.prototype.copy.call(f,m,g)}return Co=function(){function f(){r(this,f),this.head=null,this.tail=null,this.length=0}return i(f,[{key:"push",value:function(m){var g={data:m,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}},{key:"unshift",value:function(m){var g={data:m,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var g=this.head,w=""+g.data;g=g.next;)w+=m+g.data;return w}},{key:"concat",value:function(m){if(this.length===0)return l.alloc(0);for(var g=l.allocUnsafe(m>>>0),w=this.head,E=0;w;)v(w.data,g,E),E+=w.data.length,w=w.next;return g}},{key:"consume",value:function(m,g){var w;return m<this.head.data.length?(w=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):m===this.head.data.length?w=this.shift():w=g?this._getString(m):this._getBuffer(m),w}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var g=this.head,w=1,E=g.data;for(m-=E.length;g=g.next;){var O=g.data,x=m>O.length?O.length:m;if(x===O.length?E+=O:E+=O.slice(0,m),m-=x,m===0){x===O.length?(++w,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=O.slice(x));break}++w}return this.length-=w,E}},{key:"_getBuffer",value:function(m){var g=l.allocUnsafe(m),w=this.head,E=1;for(w.data.copy(g),m-=w.data.length;w=w.next;){var O=w.data,x=m>O.length?O.length:m;if(O.copy(g,g.length-m,0,x),m-=x,m===0){x===O.length?(++E,w.next?this.head=w.next:this.head=this.tail=null):(this.head=w,w.data=O.slice(x));break}++E}return this.length-=E,g}},{key:h,value:function(m,g){return p(this,t(t({},g),{},{depth:0,customInspect:!1}))}}]),f}(),Co}var Po,ip;function op(){if(ip)return Po;ip=1;function e(s,o){var c=this,l=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return l||u?(o?o(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Ie.nextTick(n,this,s)):Ie.nextTick(n,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(p){!o&&p?c._writableState?c._writableState.errorEmitted?Ie.nextTick(a,c):(c._writableState.errorEmitted=!0,Ie.nextTick(t,c,p)):Ie.nextTick(t,c,p):o?(Ie.nextTick(a,c),o(p)):Ie.nextTick(a,c)}),this)}function t(s,o){n(s,o),a(s)}function a(s){s._writableState&&!s._writableState.emitClose||s._readableState&&!s._readableState.emitClose||s.emit("close")}function r(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function n(s,o){s.emit("error",o)}function i(s,o){var c=s._readableState,l=s._writableState;c&&c.autoDestroy||l&&l.autoDestroy?s.destroy(o):s.emit("error",o)}return Po={destroy:e,undestroy:r,errorOrDestroy:i},Po}var No={},cp;function Fa(){if(cp)return No;cp=1;function e(o,c){o.prototype=Object.create(c.prototype),o.prototype.constructor=o,o.__proto__=c}var t={};function a(o,c,l){l||(l=Error);function u(h,v,f){return typeof c=="string"?c:c(h,v,f)}var p=function(h){e(v,h);function v(f,m,g){return h.call(this,u(f,m,g))||this}return v}(l);p.prototype.name=l.name,p.prototype.code=o,t[o]=p}function r(o,c){if(Array.isArray(o)){var l=o.length;return o=o.map(function(u){return String(u)}),l>2?"one of ".concat(c," ").concat(o.slice(0,l-1).join(", "),", or ")+o[l-1]:l===2?"one of ".concat(c," ").concat(o[0]," or ").concat(o[1]):"of ".concat(c," ").concat(o[0])}else return"of ".concat(c," ").concat(String(o))}function n(o,c,l){return o.substr(0,c.length)===c}function i(o,c,l){return(l===void 0||l>o.length)&&(l=o.length),o.substring(l-c.length,l)===c}function s(o,c,l){return typeof l!="number"&&(l=0),l+c.length>o.length?!1:o.indexOf(c,l)!==-1}return a("ERR_INVALID_OPT_VALUE",function(o,c){return'The value "'+c+'" is invalid for option "'+o+'"'},TypeError),a("ERR_INVALID_ARG_TYPE",function(o,c,l){var u;typeof c=="string"&&n(c,"not ")?(u="must not be",c=c.replace(/^not /,"")):u="must be";var p;if(i(o," argument"))p="The ".concat(o," ").concat(u," ").concat(r(c,"type"));else{var h=s(o,".")?"property":"argument";p='The "'.concat(o,'" ').concat(h," ").concat(u," ").concat(r(c,"type"))}return p+=". Received type ".concat(typeof l),p},TypeError),a("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),a("ERR_METHOD_NOT_IMPLEMENTED",function(o){return"The "+o+" method is not implemented"}),a("ERR_STREAM_PREMATURE_CLOSE","Premature close"),a("ERR_STREAM_DESTROYED",function(o){return"Cannot call "+o+" after a stream was destroyed"}),a("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),a("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),a("ERR_STREAM_WRITE_AFTER_END","write after end"),a("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),a("ERR_UNKNOWN_ENCODING",function(o){return"Unknown encoding: "+o},TypeError),a("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),No.codes=t,No}var Oo,dp;function lp(){if(dp)return Oo;dp=1;var e=Fa().codes.ERR_INVALID_OPT_VALUE;function t(r,n,i){return r.highWaterMark!=null?r.highWaterMark:n?r[i]:null}function a(r,n,i,s){var o=t(n,s,i);if(o!=null){if(!(isFinite(o)&&Math.floor(o)===o)||o<0){var c=s?i:"highWaterMark";throw new e(c,o)}return Math.floor(o)}return r.objectMode?16:16*1024}return Oo={getHighWaterMark:a},Oo}var $o,up;function Ww(){if(up)return $o;up=1,$o=e;function e(a,r){if(t("noDeprecation"))return a;var n=!1;function i(){if(!n){if(t("throwDeprecation"))throw new Error(r);t("traceDeprecation")?console.trace(r):console.warn(r),n=!0}return a.apply(this,arguments)}return i}function t(a){try{if(!xa.localStorage)return!1}catch{return!1}var r=xa.localStorage[a];return r==null?!1:String(r).toLowerCase()==="true"}return $o}var Ro,hp;function pp(){if(hp)return Ro;hp=1,Ro=M;function e(_){var C=this;this.next=null,this.entry=null,this.finish=function(){ne(C,_)}}var t;M.WritableState=$;var a={deprecate:Ww()},r=np(),n=Bc().Buffer,i=(typeof xa<"u"?xa:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(_){return n.from(_)}function o(_){return n.isBuffer(_)||_ instanceof i}var c=op(),l=lp(),u=l.getHighWaterMark,p=Fa().codes,h=p.ERR_INVALID_ARG_TYPE,v=p.ERR_METHOD_NOT_IMPLEMENTED,f=p.ERR_MULTIPLE_CALLBACK,m=p.ERR_STREAM_CANNOT_PIPE,g=p.ERR_STREAM_DESTROYED,w=p.ERR_STREAM_NULL_VALUES,E=p.ERR_STREAM_WRITE_AFTER_END,O=p.ERR_UNKNOWN_ENCODING,x=c.errorOrDestroy;cn()(M,r);function k(){}function $(_,C,D){t=t||za(),_=_||{},typeof D!="boolean"&&(D=C instanceof t),this.objectMode=!!_.objectMode,D&&(this.objectMode=this.objectMode||!!_.writableObjectMode),this.highWaterMark=u(this,_,"writableHighWaterMark",D),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var W=_.decodeStrings===!1;this.decodeStrings=!W,this.defaultEncoding=_.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Z){re(C,Z)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=_.emitClose!==!1,this.autoDestroy=!!_.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}$.prototype.getBuffer=function(){for(var _=this.bufferedRequest,C=[];_;)C.push(_),_=_.next;return C},function(){try{Object.defineProperty($.prototype,"buffer",{get:a.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var N;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(N=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(_){return N.call(this,_)?!0:this!==M?!1:_&&_._writableState instanceof $}})):N=function(_){return _ instanceof this};function M(_){t=t||za();var C=this instanceof t;if(!C&&!N.call(M,this))return new M(_);this._writableState=new $(_,this,C),this.writable=!0,_&&(typeof _.write=="function"&&(this._write=_.write),typeof _.writev=="function"&&(this._writev=_.writev),typeof _.destroy=="function"&&(this._destroy=_.destroy),typeof _.final=="function"&&(this._final=_.final)),r.call(this)}M.prototype.pipe=function(){x(this,new m)};function A(_,C){var D=new E;x(_,D),Ie.nextTick(C,D)}function I(_,C,D,W){var Z;return D===null?Z=new w:typeof D!="string"&&!C.objectMode&&(Z=new h("chunk",["string","Buffer"],D)),Z?(x(_,Z),Ie.nextTick(W,Z),!1):!0}M.prototype.write=function(_,C,D){var W=this._writableState,Z=!1,j=!W.objectMode&&o(_);return j&&!n.isBuffer(_)&&(_=s(_)),typeof C=="function"&&(D=C,C=null),j?C="buffer":C||(C=W.defaultEncoding),typeof D!="function"&&(D=k),W.ending?A(this,D):(j||I(this,W,_,D))&&(W.pendingcb++,Z=z(this,W,j,_,C,D)),Z},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){var _=this._writableState;_.corked&&(_.corked--,!_.writing&&!_.corked&&!_.bufferProcessing&&_.bufferedRequest&&ce(this,_))},M.prototype.setDefaultEncoding=function(_){if(typeof _=="string"&&(_=_.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((_+"").toLowerCase())>-1))throw new O(_);return this._writableState.defaultEncoding=_,this},Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function R(_,C,D){return!_.objectMode&&_.decodeStrings!==!1&&typeof C=="string"&&(C=n.from(C,D)),C}Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function z(_,C,D,W,Z,j){if(!D){var S=R(C,W,Z);W!==S&&(D=!0,Z="buffer",W=S)}var H=C.objectMode?1:W.length;C.length+=H;var G=C.length<C.highWaterMark;if(G||(C.needDrain=!0),C.writing||C.corked){var Ce=C.lastBufferedRequest;C.lastBufferedRequest={chunk:W,encoding:Z,isBuf:D,callback:j,next:null},Ce?Ce.next=C.lastBufferedRequest:C.bufferedRequest=C.lastBufferedRequest,C.bufferedRequestCount+=1}else F(_,C,!1,H,W,Z,j);return G}function F(_,C,D,W,Z,j,S){C.writelen=W,C.writecb=S,C.writing=!0,C.sync=!0,C.destroyed?C.onwrite(new g("write")):D?_._writev(Z,C.onwrite):_._write(Z,j,C.onwrite),C.sync=!1}function U(_,C,D,W,Z){--C.pendingcb,D?(Ie.nextTick(Z,W),Ie.nextTick(ae,_,C),_._writableState.errorEmitted=!0,x(_,W)):(Z(W),_._writableState.errorEmitted=!0,x(_,W),ae(_,C))}function V(_){_.writing=!1,_.writecb=null,_.length-=_.writelen,_.writelen=0}function re(_,C){var D=_._writableState,W=D.sync,Z=D.writecb;if(typeof Z!="function")throw new f;if(V(D),C)U(_,D,W,C,Z);else{var j=Re(D)||_.destroyed;!j&&!D.corked&&!D.bufferProcessing&&D.bufferedRequest&&ce(_,D),W?Ie.nextTick(Q,_,D,j,Z):Q(_,D,j,Z)}}function Q(_,C,D,W){D||oe(_,C),C.pendingcb--,W(),ae(_,C)}function oe(_,C){C.length===0&&C.needDrain&&(C.needDrain=!1,_.emit("drain"))}function ce(_,C){C.bufferProcessing=!0;var D=C.bufferedRequest;if(_._writev&&D&&D.next){var W=C.bufferedRequestCount,Z=new Array(W),j=C.corkedRequestsFree;j.entry=D;for(var S=0,H=!0;D;)Z[S]=D,D.isBuf||(H=!1),D=D.next,S+=1;Z.allBuffers=H,F(_,C,!0,C.length,Z,"",j.finish),C.pendingcb++,C.lastBufferedRequest=null,j.next?(C.corkedRequestsFree=j.next,j.next=null):C.corkedRequestsFree=new e(C),C.bufferedRequestCount=0}else{for(;D;){var G=D.chunk,Ce=D.encoding,he=D.callback,ge=C.objectMode?1:G.length;if(F(_,C,!1,ge,G,Ce,he),D=D.next,C.bufferedRequestCount--,C.writing)break}D===null&&(C.lastBufferedRequest=null)}C.bufferedRequest=D,C.bufferProcessing=!1}M.prototype._write=function(_,C,D){D(new v("_write()"))},M.prototype._writev=null,M.prototype.end=function(_,C,D){var W=this._writableState;return typeof _=="function"?(D=_,_=null,C=null):typeof C=="function"&&(D=C,C=null),_!=null&&this.write(_,C),W.corked&&(W.corked=1,this.uncork()),W.ending||xe(this,W,D),this},Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Re(_){return _.ending&&_.length===0&&_.bufferedRequest===null&&!_.finished&&!_.writing}function Ze(_,C){_._final(function(D){C.pendingcb--,D&&x(_,D),C.prefinished=!0,_.emit("prefinish"),ae(_,C)})}function K(_,C){!C.prefinished&&!C.finalCalled&&(typeof _._final=="function"&&!C.destroyed?(C.pendingcb++,C.finalCalled=!0,Ie.nextTick(Ze,_,C)):(C.prefinished=!0,_.emit("prefinish")))}function ae(_,C){var D=Re(C);if(D&&(K(_,C),C.pendingcb===0&&(C.finished=!0,_.emit("finish"),C.autoDestroy))){var W=_._readableState;(!W||W.autoDestroy&&W.endEmitted)&&_.destroy()}return D}function xe(_,C,D){C.ending=!0,ae(_,C),D&&(C.finished?Ie.nextTick(D):_.once("finish",D)),C.ended=!0,_.writable=!1}function ne(_,C,D){var W=_.entry;for(_.entry=null;W;){var Z=W.callback;C.pendingcb--,Z(D),W=W.next}C.corkedRequestsFree.next=_}return Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(_){this._writableState&&(this._writableState.destroyed=_)}}),M.prototype.destroy=c.destroy,M.prototype._undestroy=c.undestroy,M.prototype._destroy=function(_,C){C(_)},Ro}var To,mp;function za(){if(mp)return To;mp=1;var e=Object.keys||function(l){var u=[];for(var p in l)u.push(p);return u};To=s;var t=bp(),a=pp();cn()(s,t);for(var r=e(a.prototype),n=0;n<r.length;n++){var i=r[n];s.prototype[i]||(s.prototype[i]=a.prototype[i])}function s(l){if(!(this instanceof s))return new s(l);t.call(this,l),a.call(this,l),this.allowHalfOpen=!0,l&&(l.readable===!1&&(this.readable=!1),l.writable===!1&&(this.writable=!1),l.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",o)))}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o(){this._writableState.ended||Ie.nextTick(c,this)}function c(l){l.end()}return Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(l){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=l,this._writableState.destroyed=l)}}),To}var Io,fp;function Lo(){if(fp)return Io;fp=1;var e=Fa().codes.ERR_STREAM_PREMATURE_CLOSE;function t(i){var s=!1;return function(){if(!s){s=!0;for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];i.apply(this,c)}}}function a(){}function r(i){return i.setHeader&&typeof i.abort=="function"}function n(i,s,o){if(typeof s=="function")return n(i,null,s);s||(s={}),o=t(o||a);var c=s.readable||s.readable!==!1&&i.readable,l=s.writable||s.writable!==!1&&i.writable,u=function(){i.writable||h()},p=i._writableState&&i._writableState.finished,h=function(){l=!1,p=!0,c||o.call(i)},v=i._readableState&&i._readableState.endEmitted,f=function(){c=!1,v=!0,l||o.call(i)},m=function(E){o.call(i,E)},g=function(){var E;if(c&&!v)return(!i._readableState||!i._readableState.ended)&&(E=new e),o.call(i,E);if(l&&!p)return(!i._writableState||!i._writableState.ended)&&(E=new e),o.call(i,E)},w=function(){i.req.on("finish",h)};return r(i)?(i.on("complete",h),i.on("abort",g),i.req?w():i.on("request",w)):l&&!i._writableState&&(i.on("end",u),i.on("close",u)),i.on("end",f),i.on("finish",h),s.error!==!1&&i.on("error",m),i.on("close",g),function(){i.removeListener("complete",h),i.removeListener("abort",g),i.removeListener("request",w),i.req&&i.req.removeListener("finish",h),i.removeListener("end",u),i.removeListener("close",u),i.removeListener("finish",h),i.removeListener("end",f),i.removeListener("error",m),i.removeListener("close",g)}}return Io=n,Io}var Mo,vp;function Kw(){if(vp)return Mo;vp=1;var e;function t(O,x,k){return x=a(x),x in O?Object.defineProperty(O,x,{value:k,enumerable:!0,configurable:!0,writable:!0}):O[x]=k,O}function a(O){var x=r(O,"string");return typeof x=="symbol"?x:String(x)}function r(O,x){if(typeof O!="object"||O===null)return O;var k=O[Symbol.toPrimitive];if(k!==void 0){var $=k.call(O,x||"default");if(typeof $!="object")return $;throw new TypeError("@@toPrimitive must return a primitive value.")}return(x==="string"?String:Number)(O)}var n=Lo(),i=Symbol("lastResolve"),s=Symbol("lastReject"),o=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),u=Symbol("handlePromise"),p=Symbol("stream");function h(O,x){return{value:O,done:x}}function v(O){var x=O[i];if(x!==null){var k=O[p].read();k!==null&&(O[l]=null,O[i]=null,O[s]=null,x(h(k,!1)))}}function f(O){Ie.nextTick(v,O)}function m(O,x){return function(k,$){O.then(function(){if(x[c]){k(h(void 0,!0));return}x[u](k,$)},$)}}var g=Object.getPrototypeOf(function(){}),w=Object.setPrototypeOf((e={get stream(){return this[p]},next:function(){var O=this,x=this[o];if(x!==null)return Promise.reject(x);if(this[c])return Promise.resolve(h(void 0,!0));if(this[p].destroyed)return new Promise(function(M,A){Ie.nextTick(function(){O[o]?A(O[o]):M(h(void 0,!0))})});var k=this[l],$;if(k)$=new Promise(m(k,this));else{var N=this[p].read();if(N!==null)return Promise.resolve(h(N,!1));$=new Promise(this[u])}return this[l]=$,$}},t(e,Symbol.asyncIterator,function(){return this}),t(e,"return",function(){var O=this;return new Promise(function(x,k){O[p].destroy(null,function($){if($){k($);return}x(h(void 0,!0))})})}),e),g),E=function(O){var x,k=Object.create(w,(x={},t(x,p,{value:O,writable:!0}),t(x,i,{value:null,writable:!0}),t(x,s,{value:null,writable:!0}),t(x,o,{value:null,writable:!0}),t(x,c,{value:O._readableState.endEmitted,writable:!0}),t(x,u,{value:function($,N){var M=k[p].read();M?(k[l]=null,k[i]=null,k[s]=null,$(h(M,!1))):(k[i]=$,k[s]=N)},writable:!0}),x));return k[l]=null,n(O,function($){if($&&$.code!=="ERR_STREAM_PREMATURE_CLOSE"){var N=k[s];N!==null&&(k[l]=null,k[i]=null,k[s]=null,N($)),k[o]=$;return}var M=k[i];M!==null&&(k[l]=null,k[i]=null,k[s]=null,M(h(void 0,!0))),k[c]=!0}),O.on("readable",f.bind(null,k)),k};return Mo=E,Mo}var gp,yp;function Jw(){return yp||(yp=1,gp=function(){throw new Error("Readable.from is not available in the browser")}),gp}var Do,_p;function bp(){if(_p)return Do;_p=1,Do=A;var e;A.ReadableState=M,Vc().EventEmitter;var t=function(j,S){return j.listeners(S).length},a=np(),r=Bc().Buffer,n=(typeof xa<"u"?xa:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function i(j){return r.from(j)}function s(j){return r.isBuffer(j)||j instanceof n}var o=Fr,c;o&&o.debuglog?c=o.debuglog("stream"):c=function(){};var l=Bw(),u=op(),p=lp(),h=p.getHighWaterMark,v=Fa().codes,f=v.ERR_INVALID_ARG_TYPE,m=v.ERR_STREAM_PUSH_AFTER_EOF,g=v.ERR_METHOD_NOT_IMPLEMENTED,w=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,E,O,x;cn()(A,a);var k=u.errorOrDestroy,$=["error","close","destroy","pause","resume"];function N(j,S,H){if(typeof j.prependListener=="function")return j.prependListener(S,H);!j._events||!j._events[S]?j.on(S,H):Array.isArray(j._events[S])?j._events[S].unshift(H):j._events[S]=[H,j._events[S]]}function M(j,S,H){e=e||za(),j=j||{},typeof H!="boolean"&&(H=S instanceof e),this.objectMode=!!j.objectMode,H&&(this.objectMode=this.objectMode||!!j.readableObjectMode),this.highWaterMark=h(this,j,"readableHighWaterMark",H),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=j.emitClose!==!1,this.autoDestroy=!!j.autoDestroy,this.destroyed=!1,this.defaultEncoding=j.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,j.encoding&&(E||(E=Om().StringDecoder),this.decoder=new E(j.encoding),this.encoding=j.encoding)}function A(j){if(e=e||za(),!(this instanceof A))return new A(j);var S=this instanceof e;this._readableState=new M(j,this,S),this.readable=!0,j&&(typeof j.read=="function"&&(this._read=j.read),typeof j.destroy=="function"&&(this._destroy=j.destroy)),a.call(this)}Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(j){this._readableState&&(this._readableState.destroyed=j)}}),A.prototype.destroy=u.destroy,A.prototype._undestroy=u.undestroy,A.prototype._destroy=function(j,S){S(j)},A.prototype.push=function(j,S){var H=this._readableState,G;return H.objectMode?G=!0:typeof j=="string"&&(S=S||H.defaultEncoding,S!==H.encoding&&(j=r.from(j,S),S=""),G=!0),I(this,j,S,!1,G)},A.prototype.unshift=function(j){return I(this,j,null,!0,!1)};function I(j,S,H,G,Ce){c("readableAddChunk",S);var he=j._readableState;if(S===null)he.reading=!1,re(j,he);else{var ge;if(Ce||(ge=z(he,S)),ge)k(j,ge);else if(he.objectMode||S&&S.length>0)if(typeof S!="string"&&!he.objectMode&&Object.getPrototypeOf(S)!==r.prototype&&(S=i(S)),G)he.endEmitted?k(j,new w):R(j,he,S,!0);else if(he.ended)k(j,new m);else{if(he.destroyed)return!1;he.reading=!1,he.decoder&&!H?(S=he.decoder.write(S),he.objectMode||S.length!==0?R(j,he,S,!1):ce(j,he)):R(j,he,S,!1)}else G||(he.reading=!1,ce(j,he))}return!he.ended&&(he.length<he.highWaterMark||he.length===0)}function R(j,S,H,G){S.flowing&&S.length===0&&!S.sync?(S.awaitDrain=0,j.emit("data",H)):(S.length+=S.objectMode?1:H.length,G?S.buffer.unshift(H):S.buffer.push(H),S.needReadable&&Q(j)),ce(j,S)}function z(j,S){var H;return!s(S)&&typeof S!="string"&&S!==void 0&&!j.objectMode&&(H=new f("chunk",["string","Buffer","Uint8Array"],S)),H}A.prototype.isPaused=function(){return this._readableState.flowing===!1},A.prototype.setEncoding=function(j){E||(E=Om().StringDecoder);var S=new E(j);this._readableState.decoder=S,this._readableState.encoding=this._readableState.decoder.encoding;for(var H=this._readableState.buffer.head,G="";H!==null;)G+=S.write(H.data),H=H.next;return this._readableState.buffer.clear(),G!==""&&this._readableState.buffer.push(G),this._readableState.length=G.length,this};var F=1073741824;function U(j){return j>=F?j=F:(j--,j|=j>>>1,j|=j>>>2,j|=j>>>4,j|=j>>>8,j|=j>>>16,j++),j}function V(j,S){return j<=0||S.length===0&&S.ended?0:S.objectMode?1:j!==j?S.flowing&&S.length?S.buffer.head.data.length:S.length:(j>S.highWaterMark&&(S.highWaterMark=U(j)),j<=S.length?j:S.ended?S.length:(S.needReadable=!0,0))}A.prototype.read=function(j){c("read",j),j=parseInt(j,10);var S=this._readableState,H=j;if(j!==0&&(S.emittedReadable=!1),j===0&&S.needReadable&&((S.highWaterMark!==0?S.length>=S.highWaterMark:S.length>0)||S.ended))return c("read: emitReadable",S.length,S.ended),S.length===0&&S.ended?D(this):Q(this),null;if(j=V(j,S),j===0&&S.ended)return S.length===0&&D(this),null;var G=S.needReadable;c("need readable",G),(S.length===0||S.length-j<S.highWaterMark)&&(G=!0,c("length less than watermark",G)),S.ended||S.reading?(G=!1,c("reading or ended",G)):G&&(c("do read"),S.reading=!0,S.sync=!0,S.length===0&&(S.needReadable=!0),this._read(S.highWaterMark),S.sync=!1,S.reading||(j=V(H,S)));var Ce;return j>0?Ce=C(j,S):Ce=null,Ce===null?(S.needReadable=S.length<=S.highWaterMark,j=0):(S.length-=j,S.awaitDrain=0),S.length===0&&(S.ended||(S.needReadable=!0),H!==j&&S.ended&&D(this)),Ce!==null&&this.emit("data",Ce),Ce};function re(j,S){if(c("onEofChunk"),!S.ended){if(S.decoder){var H=S.decoder.end();H&&H.length&&(S.buffer.push(H),S.length+=S.objectMode?1:H.length)}S.ended=!0,S.sync?Q(j):(S.needReadable=!1,S.emittedReadable||(S.emittedReadable=!0,oe(j)))}}function Q(j){var S=j._readableState;c("emitReadable",S.needReadable,S.emittedReadable),S.needReadable=!1,S.emittedReadable||(c("emitReadable",S.flowing),S.emittedReadable=!0,Ie.nextTick(oe,j))}function oe(j){var S=j._readableState;c("emitReadable_",S.destroyed,S.length,S.ended),!S.destroyed&&(S.length||S.ended)&&(j.emit("readable"),S.emittedReadable=!1),S.needReadable=!S.flowing&&!S.ended&&S.length<=S.highWaterMark,_(j)}function ce(j,S){S.readingMore||(S.readingMore=!0,Ie.nextTick(Re,j,S))}function Re(j,S){for(;!S.reading&&!S.ended&&(S.length<S.highWaterMark||S.flowing&&S.length===0);){var H=S.length;if(c("maybeReadMore read 0"),j.read(0),H===S.length)break}S.readingMore=!1}A.prototype._read=function(j){k(this,new g("_read()"))},A.prototype.pipe=function(j,S){var H=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=j;break;case 1:G.pipes=[G.pipes,j];break;default:G.pipes.push(j);break}G.pipesCount+=1,c("pipe count=%d opts=%j",G.pipesCount,S);var Ce=(!S||S.end!==!1)&&j!==Ie.stdout&&j!==Ie.stderr,he=Ce?Ue:ie;G.endEmitted?Ie.nextTick(he):H.once("end",he),j.on("unpipe",ge);function ge(Ee,je){c("onunpipe"),Ee===H&&je&&je.hasUnpiped===!1&&(je.hasUnpiped=!0,Xe())}function Ue(){c("onend"),j.end()}var yt=Ze(H);j.on("drain",yt);var se=!1;function Xe(){c("cleanup"),j.removeListener("close",Ne),j.removeListener("finish",de),j.removeListener("drain",yt),j.removeListener("error",te),j.removeListener("unpipe",ge),H.removeListener("end",Ue),H.removeListener("end",ie),H.removeListener("data",pe),se=!0,G.awaitDrain&&(!j._writableState||j._writableState.needDrain)&&yt()}H.on("data",pe);function pe(Ee){c("ondata");var je=j.write(Ee);c("dest.write",je),je===!1&&((G.pipesCount===1&&G.pipes===j||G.pipesCount>1&&Z(G.pipes,j)!==-1)&&!se&&(c("false write response, pause",G.awaitDrain),G.awaitDrain++),H.pause())}function te(Ee){c("onerror",Ee),ie(),j.removeListener("error",te),t(j,"error")===0&&k(j,Ee)}N(j,"error",te);function Ne(){j.removeListener("finish",de),ie()}j.once("close",Ne);function de(){c("onfinish"),j.removeListener("close",Ne),ie()}j.once("finish",de);function ie(){c("unpipe"),H.unpipe(j)}return j.emit("pipe",H),G.flowing||(c("pipe resume"),H.resume()),j};function Ze(j){return function(){var S=j._readableState;c("pipeOnDrain",S.awaitDrain),S.awaitDrain&&S.awaitDrain--,S.awaitDrain===0&&t(j,"data")&&(S.flowing=!0,_(j))}}A.prototype.unpipe=function(j){var S=this._readableState,H={hasUnpiped:!1};if(S.pipesCount===0)return this;if(S.pipesCount===1)return j&&j!==S.pipes?this:(j||(j=S.pipes),S.pipes=null,S.pipesCount=0,S.flowing=!1,j&&j.emit("unpipe",this,H),this);if(!j){var G=S.pipes,Ce=S.pipesCount;S.pipes=null,S.pipesCount=0,S.flowing=!1;for(var he=0;he<Ce;he++)G[he].emit("unpipe",this,{hasUnpiped:!1});return this}var ge=Z(S.pipes,j);return ge===-1?this:(S.pipes.splice(ge,1),S.pipesCount-=1,S.pipesCount===1&&(S.pipes=S.pipes[0]),j.emit("unpipe",this,H),this)},A.prototype.on=function(j,S){var H=a.prototype.on.call(this,j,S),G=this._readableState;return j==="data"?(G.readableListening=this.listenerCount("readable")>0,G.flowing!==!1&&this.resume()):j==="readable"&&!G.endEmitted&&!G.readableListening&&(G.readableListening=G.needReadable=!0,G.flowing=!1,G.emittedReadable=!1,c("on readable",G.length,G.reading),G.length?Q(this):G.reading||Ie.nextTick(ae,this)),H},A.prototype.addListener=A.prototype.on,A.prototype.removeListener=function(j,S){var H=a.prototype.removeListener.call(this,j,S);return j==="readable"&&Ie.nextTick(K,this),H},A.prototype.removeAllListeners=function(j){var S=a.prototype.removeAllListeners.apply(this,arguments);return(j==="readable"||j===void 0)&&Ie.nextTick(K,this),S};function K(j){var S=j._readableState;S.readableListening=j.listenerCount("readable")>0,S.resumeScheduled&&!S.paused?S.flowing=!0:j.listenerCount("data")>0&&j.resume()}function ae(j){c("readable nexttick read 0"),j.read(0)}A.prototype.resume=function(){var j=this._readableState;return j.flowing||(c("resume"),j.flowing=!j.readableListening,xe(this,j)),j.paused=!1,this};function xe(j,S){S.resumeScheduled||(S.resumeScheduled=!0,Ie.nextTick(ne,j,S))}function ne(j,S){c("resume",S.reading),S.reading||j.read(0),S.resumeScheduled=!1,j.emit("resume"),_(j),S.flowing&&!S.reading&&j.read(0)}A.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function _(j){var S=j._readableState;for(c("flow",S.flowing);S.flowing&&j.read()!==null;);}A.prototype.wrap=function(j){var S=this,H=this._readableState,G=!1;j.on("end",function(){if(c("wrapped end"),H.decoder&&!H.ended){var ge=H.decoder.end();ge&&ge.length&&S.push(ge)}S.push(null)}),j.on("data",function(ge){if(c("wrapped data"),H.decoder&&(ge=H.decoder.write(ge)),!(H.objectMode&&ge==null)&&!(!H.objectMode&&(!ge||!ge.length))){var Ue=S.push(ge);Ue||(G=!0,j.pause())}});for(var Ce in j)this[Ce]===void 0&&typeof j[Ce]=="function"&&(this[Ce]=function(ge){return function(){return j[ge].apply(j,arguments)}}(Ce));for(var he=0;he<$.length;he++)j.on($[he],this.emit.bind(this,$[he]));return this._read=function(ge){c("wrapped _read",ge),G&&(G=!1,j.resume())},this},typeof Symbol=="function"&&(A.prototype[Symbol.asyncIterator]=function(){return O===void 0&&(O=Kw()),O(this)}),Object.defineProperty(A.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(A.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(A.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(j){this._readableState&&(this._readableState.flowing=j)}}),A._fromList=C,Object.defineProperty(A.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function C(j,S){if(S.length===0)return null;var H;return S.objectMode?H=S.buffer.shift():!j||j>=S.length?(S.decoder?H=S.buffer.join(""):S.buffer.length===1?H=S.buffer.first():H=S.buffer.concat(S.length),S.buffer.clear()):H=S.buffer.consume(j,S.decoder),H}function D(j){var S=j._readableState;c("endReadable",S.endEmitted),S.endEmitted||(S.ended=!0,Ie.nextTick(W,S,j))}function W(j,S){if(c("endReadableNT",j.endEmitted,j.length),!j.endEmitted&&j.length===0&&(j.endEmitted=!0,S.readable=!1,S.emit("end"),j.autoDestroy)){var H=S._writableState;(!H||H.autoDestroy&&H.finished)&&S.destroy()}}typeof Symbol=="function"&&(A.from=function(j,S){return x===void 0&&(x=Jw()),x(A,j,S)});function Z(j,S){for(var H=0,G=j.length;H<G;H++)if(j[H]===S)return H;return-1}return Do}var Ao,wp;function xp(){if(wp)return Ao;wp=1,Ao=o;var e=Fa().codes,t=e.ERR_METHOD_NOT_IMPLEMENTED,a=e.ERR_MULTIPLE_CALLBACK,r=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,n=e.ERR_TRANSFORM_WITH_LENGTH_0,i=za();cn()(o,i);function s(u,p){var h=this._transformState;h.transforming=!1;var v=h.writecb;if(v===null)return this.emit("error",new a);h.writechunk=null,h.writecb=null,p!=null&&this.push(p),v(u);var f=this._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&this._read(f.highWaterMark)}function o(u){if(!(this instanceof o))return new o(u);i.call(this,u),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,u&&(typeof u.transform=="function"&&(this._transform=u.transform),typeof u.flush=="function"&&(this._flush=u.flush)),this.on("prefinish",c)}function c(){var u=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(p,h){l(u,p,h)}):l(this,null,null)}o.prototype.push=function(u,p){return this._transformState.needTransform=!1,i.prototype.push.call(this,u,p)},o.prototype._transform=function(u,p,h){h(new t("_transform()"))},o.prototype._write=function(u,p,h){var v=this._transformState;if(v.writecb=h,v.writechunk=u,v.writeencoding=p,!v.transforming){var f=this._readableState;(v.needTransform||f.needReadable||f.length<f.highWaterMark)&&this._read(f.highWaterMark)}},o.prototype._read=function(u){var p=this._transformState;p.writechunk!==null&&!p.transforming?(p.transforming=!0,this._transform(p.writechunk,p.writeencoding,p.afterTransform)):p.needTransform=!0},o.prototype._destroy=function(u,p){i.prototype._destroy.call(this,u,function(h){p(h)})};function l(u,p,h){if(p)return u.emit("error",p);if(h!=null&&u.push(h),u._writableState.length)throw new n;if(u._transformState.transforming)throw new r;return u.push(null)}return Ao}var Fo,jp;function Qw(){if(jp)return Fo;jp=1,Fo=t;var e=xp();cn()(t,e);function t(a){if(!(this instanceof t))return new t(a);e.call(this,a)}return t.prototype._transform=function(a,r,n){n(null,a)},Fo}var zo,Ep;function Gw(){if(Ep)return zo;Ep=1;var e;function t(h){var v=!1;return function(){v||(v=!0,h.apply(void 0,arguments))}}var a=Fa().codes,r=a.ERR_MISSING_ARGS,n=a.ERR_STREAM_DESTROYED;function i(h){if(h)throw h}function s(h){return h.setHeader&&typeof h.abort=="function"}function o(h,v,f,m){m=t(m);var g=!1;h.on("close",function(){g=!0}),e===void 0&&(e=Lo()),e(h,{readable:v,writable:f},function(E){if(E)return m(E);g=!0,m()});var w=!1;return function(E){if(!g&&!w){if(w=!0,s(h))return h.abort();if(typeof h.destroy=="function")return h.destroy();m(E||new n("pipe"))}}}function c(h){h()}function l(h,v){return h.pipe(v)}function u(h){return!h.length||typeof h[h.length-1]!="function"?i:h.pop()}function p(){for(var h=arguments.length,v=new Array(h),f=0;f<h;f++)v[f]=arguments[f];var m=u(v);if(Array.isArray(v[0])&&(v=v[0]),v.length<2)throw new r("streams");var g,w=v.map(function(E,O){var x=O<v.length-1,k=O>0;return o(E,x,k,function($){g||(g=$),$&&w.forEach(c),!x&&(w.forEach(c),m(g))})});return v.reduce(l)}return zo=p,zo}var Zo,Sp;function Xw(){if(Sp)return Zo;Sp=1,Zo=a;var e=Vc().EventEmitter,t=cn();t(a,e),a.Readable=bp(),a.Writable=pp(),a.Duplex=za(),a.Transform=xp(),a.PassThrough=Qw(),a.finished=Lo(),a.pipeline=Gw(),a.Stream=a;function a(){e.call(this)}return a.prototype.pipe=function(r,n){var i=this;function s(v){r.writable&&r.write(v)===!1&&i.pause&&i.pause()}i.on("data",s);function o(){i.readable&&i.resume&&i.resume()}r.on("drain",o),!r._isStdio&&(!n||n.end!==!1)&&(i.on("end",l),i.on("close",u));var c=!1;function l(){c||(c=!0,r.end())}function u(){c||(c=!0,typeof r.destroy=="function"&&r.destroy())}function p(v){if(h(),e.listenerCount(this,"error")===0)throw v}i.on("error",p),r.on("error",p);function h(){i.removeListener("data",s),r.removeListener("drain",o),i.removeListener("end",l),i.removeListener("close",u),i.removeListener("error",p),r.removeListener("error",p),i.removeListener("end",h),i.removeListener("close",h),r.removeListener("close",h)}return i.on("end",h),i.on("close",h),r.on("close",h),r.emit("pipe",i),r},Zo}var Yw=Xw();class ex{append(t){this._buffer=this._buffer?Nm.concat([this._buffer,t]):t}readMessage(){if(!this._buffer)return null;const t=this._buffer.indexOf(`
`);if(t===-1)return null;const a=this._buffer.toString("utf8",0,t).replace(/\r$/,"");return this._buffer=this._buffer.subarray(t+1),tx(a)}clear(){this._buffer=void 0}}function tx(e){return Mn.parse(JSON.parse(e))}function rx(e){return JSON.stringify(e)+`
`}const ax=fi.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function nx(){const e={};for(const t of ax){const a=fi.env[t];a!==void 0&&(a.startsWith("()")||(e[t]=a))}return e}class sx{constructor(t){this._abortController=new AbortController,this._readBuffer=new ex,this._stderrStream=null,this._serverParams=t,(t.stderr==="pipe"||t.stderr==="overlapped")&&(this._stderrStream=new Yw.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((t,a)=>{var r,n,i,s,o;this._process=Vw(this._serverParams.command,(r=this._serverParams.args)!==null&&r!==void 0?r:[],{env:{...nx(),...this._serverParams.env},stdio:["pipe","pipe",(n=this._serverParams.stderr)!==null&&n!==void 0?n:"inherit"],shell:!1,signal:this._abortController.signal,windowsHide:fi.platform==="win32"&&ix(),cwd:this._serverParams.cwd}),this._process.on("error",c=>{var l,u;if(c.name==="AbortError"){(l=this.onclose)===null||l===void 0||l.call(this);return}a(c),(u=this.onerror)===null||u===void 0||u.call(this,c)}),this._process.on("spawn",()=>{t()}),this._process.on("close",c=>{var l;this._process=void 0,(l=this.onclose)===null||l===void 0||l.call(this)}),(i=this._process.stdin)===null||i===void 0||i.on("error",c=>{var l;(l=this.onerror)===null||l===void 0||l.call(this,c)}),(s=this._process.stdout)===null||s===void 0||s.on("data",c=>{this._readBuffer.append(c),this.processReadBuffer()}),(o=this._process.stdout)===null||o===void 0||o.on("error",c=>{var l;(l=this.onerror)===null||l===void 0||l.call(this,c)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){var t,a;return this._stderrStream?this._stderrStream:(a=(t=this._process)===null||t===void 0?void 0:t.stderr)!==null&&a!==void 0?a:null}get pid(){var t,a;return(a=(t=this._process)===null||t===void 0?void 0:t.pid)!==null&&a!==void 0?a:null}processReadBuffer(){for(var t,a;;)try{const r=this._readBuffer.readMessage();if(r===null)break;(t=this.onmessage)===null||t===void 0||t.call(this,r)}catch(r){(a=this.onerror)===null||a===void 0||a.call(this,r)}}async close(){this._abortController.abort(),this._process=void 0,this._readBuffer.clear()}send(t){return new Promise(a=>{var r;if(!(!((r=this._process)===null||r===void 0)&&r.stdin))throw new Error("Not connected");const n=rx(t);this._process.stdin.write(n)?a():this._process.stdin.once("drain",a)})}}function ix(){return"type"in fi}class kp extends Error{constructor(t,a){super(t),this.name="ParseError",this.type=a.type,this.field=a.field,this.value=a.value,this.line=a.line}}function Uo(e){}function ox(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=Uo,onError:a=Uo,onRetry:r=Uo,onComment:n}=e;let i="",s=!0,o,c="",l="";function u(m){const g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[w,E]=cx(`${i}${g}`);for(const O of w)p(O);i=E,s=!1}function p(m){if(m===""){v();return}if(m.startsWith(":")){n&&n(m.slice(m.startsWith(": ")?2:1));return}const g=m.indexOf(":");if(g!==-1){const w=m.slice(0,g),E=m[g+1]===" "?2:1,O=m.slice(g+E);h(w,O,m);return}h(m,"",m)}function h(m,g,w){switch(m){case"event":l=g;break;case"data":c=`${c}${g}
`;break;case"id":o=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?r(parseInt(g,10)):a(new kp(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:w}));break;default:a(new kp(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:w}));break}}function v(){c.length>0&&t({id:o,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),o=void 0,c="",l=""}function f(m={}){i&&m.consume&&p(i),s=!0,o=void 0,c="",l="",i=""}return{feed:u,reset:f}}function cx(e){const t=[];let a="",r=0;for(;r<e.length;){const n=e.indexOf("\r",r),i=e.indexOf(`
`,r);let s=-1;if(n!==-1&&i!==-1?s=Math.min(n,i):n!==-1?s=n:i!==-1&&(s=i),s===-1){a=e.slice(r);break}else{const o=e.slice(r,s);t.push(o),r=s+1,e[r-1]==="\r"&&e[r]===`
`&&r++}}return[t,a]}class Cp extends Event{constructor(t,a){var r,n;super(t),this.code=(r=a==null?void 0:a.code)!=null?r:void 0,this.message=(n=a==null?void 0:a.message)!=null?n:void 0}[Symbol.for("nodejs.util.inspect.custom")](t,a,r){return r(Pp(this),a)}[Symbol.for("Deno.customInspect")](t,a){return t(Pp(this),a)}}function dx(e){const t=globalThis.DOMException;return typeof t=="function"?new t(e,"SyntaxError"):new SyntaxError(e)}function Ho(e){return e instanceof Error?"errors"in e&&Array.isArray(e.errors)?e.errors.map(Ho).join(", "):"cause"in e&&e.cause instanceof Error?`${e}: ${Ho(e.cause)}`:e.message:`${e}`}function Pp(e){return{type:e.type,message:e.message,code:e.code,defaultPrevented:e.defaultPrevented,cancelable:e.cancelable,timeStamp:e.timeStamp}}var Np=e=>{throw TypeError(e)},qo=(e,t,a)=>t.has(e)||Np("Cannot "+a),He=(e,t,a)=>(qo(e,t,"read from private field"),a?a.call(e):t.get(e)),gt=(e,t,a)=>t.has(e)?Np("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a),it=(e,t,a,r)=>(qo(e,t,"write to private field"),t.set(e,a),a),Rr=(e,t,a)=>(qo(e,t,"access private method"),a),Ft,ma,Za,Ds,As,An,Ua,Fn,Wr,Ha,qa,Va,zn,or,Vo,Bo,Wo,Op,Ko,Jo,Zn,Qo,Go;class Fs extends EventTarget{constructor(t,a){var r,n;super(),gt(this,or),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,gt(this,Ft),gt(this,ma),gt(this,Za),gt(this,Ds),gt(this,As),gt(this,An),gt(this,Ua),gt(this,Fn,null),gt(this,Wr),gt(this,Ha),gt(this,qa,null),gt(this,Va,null),gt(this,zn,null),gt(this,Bo,async i=>{var s;He(this,Ha).reset();const{body:o,redirected:c,status:l,headers:u}=i;if(l===204){Rr(this,or,Zn).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(c?it(this,Za,new URL(i.url)):it(this,Za,void 0),l!==200){Rr(this,or,Zn).call(this,`Non-200 status code (${l})`,l);return}if(!(u.get("content-type")||"").startsWith("text/event-stream")){Rr(this,or,Zn).call(this,'Invalid content type, expected "text/event-stream"',l);return}if(He(this,Ft)===this.CLOSED)return;it(this,Ft,this.OPEN);const p=new Event("open");if((s=He(this,zn))==null||s.call(this,p),this.dispatchEvent(p),typeof o!="object"||!o||!("getReader"in o)){Rr(this,or,Zn).call(this,"Invalid response body, expected a web ReadableStream",l),this.close();return}const h=new TextDecoder,v=o.getReader();let f=!0;do{const{done:m,value:g}=await v.read();g&&He(this,Ha).feed(h.decode(g,{stream:!m})),m&&(f=!1,He(this,Ha).reset(),Rr(this,or,Qo).call(this))}while(f)}),gt(this,Wo,i=>{it(this,Wr,void 0),!(i.name==="AbortError"||i.type==="aborted")&&Rr(this,or,Qo).call(this,Ho(i))}),gt(this,Ko,i=>{typeof i.id=="string"&&it(this,Fn,i.id);const s=new MessageEvent(i.event||"message",{data:i.data,origin:He(this,Za)?He(this,Za).origin:He(this,ma).origin,lastEventId:i.id||""});He(this,Va)&&(!i.event||i.event==="message")&&He(this,Va).call(this,s),this.dispatchEvent(s)}),gt(this,Jo,i=>{it(this,An,i)}),gt(this,Go,()=>{it(this,Ua,void 0),He(this,Ft)===this.CONNECTING&&Rr(this,or,Vo).call(this)});try{if(t instanceof URL)it(this,ma,t);else if(typeof t=="string")it(this,ma,new URL(t,lx()));else throw new Error("Invalid URL")}catch{throw dx("An invalid or illegal string was specified")}it(this,Ha,ox({onEvent:He(this,Ko),onRetry:He(this,Jo)})),it(this,Ft,this.CONNECTING),it(this,An,3e3),it(this,As,(r=a==null?void 0:a.fetch)!=null?r:globalThis.fetch),it(this,Ds,(n=a==null?void 0:a.withCredentials)!=null?n:!1),Rr(this,or,Vo).call(this)}get readyState(){return He(this,Ft)}get url(){return He(this,ma).href}get withCredentials(){return He(this,Ds)}get onerror(){return He(this,qa)}set onerror(t){it(this,qa,t)}get onmessage(){return He(this,Va)}set onmessage(t){it(this,Va,t)}get onopen(){return He(this,zn)}set onopen(t){it(this,zn,t)}addEventListener(t,a,r){const n=a;super.addEventListener(t,n,r)}removeEventListener(t,a,r){const n=a;super.removeEventListener(t,n,r)}close(){He(this,Ua)&&clearTimeout(He(this,Ua)),He(this,Ft)!==this.CLOSED&&(He(this,Wr)&&He(this,Wr).abort(),it(this,Ft,this.CLOSED),it(this,Wr,void 0))}}Ft=new WeakMap,ma=new WeakMap,Za=new WeakMap,Ds=new WeakMap,As=new WeakMap,An=new WeakMap,Ua=new WeakMap,Fn=new WeakMap,Wr=new WeakMap,Ha=new WeakMap,qa=new WeakMap,Va=new WeakMap,zn=new WeakMap,or=new WeakSet,Vo=function(){it(this,Ft,this.CONNECTING),it(this,Wr,new AbortController),He(this,As)(He(this,ma),Rr(this,or,Op).call(this)).then(He(this,Bo)).catch(He(this,Wo))},Bo=new WeakMap,Wo=new WeakMap,Op=function(){var e;const t={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...He(this,Fn)?{"Last-Event-ID":He(this,Fn)}:void 0},cache:"no-store",signal:(e=He(this,Wr))==null?void 0:e.signal};return"window"in globalThis&&(t.credentials=this.withCredentials?"include":"same-origin"),t},Ko=new WeakMap,Jo=new WeakMap,Zn=function(e,t){var a;He(this,Ft)!==this.CLOSED&&it(this,Ft,this.CLOSED);const r=new Cp("error",{code:t,message:e});(a=He(this,qa))==null||a.call(this,r),this.dispatchEvent(r)},Qo=function(e,t){var a;if(He(this,Ft)===this.CLOSED)return;it(this,Ft,this.CONNECTING);const r=new Cp("error",{code:t,message:e});(a=He(this,qa))==null||a.call(this,r),this.dispatchEvent(r),it(this,Ua,setTimeout(He(this,Go),He(this,An)))},Go=new WeakMap,Fs.CONNECTING=0,Fs.OPEN=1,Fs.CLOSED=2;function lx(){const e="document"in globalThis?globalThis.document:void 0;return e&&typeof e=="object"&&"baseURI"in e&&typeof e.baseURI=="string"?e.baseURI:void 0}let Xo;Xo=globalThis.crypto;async function ux(e){return(await Xo).getRandomValues(new Uint8Array(e))}async function hx(e){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let a="";const r=await ux(e);for(let n=0;n<e;n++){const i=r[n]%t.length;a+=t[i]}return a}async function px(e){return await hx(e)}async function mx(e){const t=await(await Xo).subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function fx(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const t=await px(e),a=await mx(t);return{code_verifier:t,code_challenge:a}}const vx=y.object({resource:y.string().url(),authorization_servers:y.array(y.string().url()).optional(),jwks_uri:y.string().url().optional(),scopes_supported:y.array(y.string()).optional(),bearer_methods_supported:y.array(y.string()).optional(),resource_signing_alg_values_supported:y.array(y.string()).optional(),resource_name:y.string().optional(),resource_documentation:y.string().optional(),resource_policy_uri:y.string().url().optional(),resource_tos_uri:y.string().url().optional(),tls_client_certificate_bound_access_tokens:y.boolean().optional(),authorization_details_types_supported:y.array(y.string()).optional(),dpop_signing_alg_values_supported:y.array(y.string()).optional(),dpop_bound_access_tokens_required:y.boolean().optional()}).passthrough(),gx=y.object({issuer:y.string(),authorization_endpoint:y.string(),token_endpoint:y.string(),registration_endpoint:y.string().optional(),scopes_supported:y.array(y.string()).optional(),response_types_supported:y.array(y.string()),response_modes_supported:y.array(y.string()).optional(),grant_types_supported:y.array(y.string()).optional(),token_endpoint_auth_methods_supported:y.array(y.string()).optional(),token_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),service_documentation:y.string().optional(),revocation_endpoint:y.string().optional(),revocation_endpoint_auth_methods_supported:y.array(y.string()).optional(),revocation_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),introspection_endpoint:y.string().optional(),introspection_endpoint_auth_methods_supported:y.array(y.string()).optional(),introspection_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),code_challenge_methods_supported:y.array(y.string()).optional()}).passthrough(),$p=y.object({access_token:y.string(),id_token:y.string().optional(),token_type:y.string(),expires_in:y.number().optional(),scope:y.string().optional(),refresh_token:y.string().optional()}).strip(),yx=y.object({error:y.string(),error_description:y.string().optional(),error_uri:y.string().optional()}),_x=y.object({redirect_uris:y.array(y.string()).refine(e=>e.every(t=>URL.canParse(t)),{message:"redirect_uris must contain valid URLs"}),token_endpoint_auth_method:y.string().optional(),grant_types:y.array(y.string()).optional(),response_types:y.array(y.string()).optional(),client_name:y.string().optional(),client_uri:y.string().optional(),logo_uri:y.string().optional(),scope:y.string().optional(),contacts:y.array(y.string()).optional(),tos_uri:y.string().optional(),policy_uri:y.string().optional(),jwks_uri:y.string().optional(),jwks:y.any().optional(),software_id:y.string().optional(),software_version:y.string().optional(),software_statement:y.string().optional()}).strip(),bx=y.object({client_id:y.string(),client_secret:y.string().optional(),client_id_issued_at:y.number().optional(),client_secret_expires_at:y.number().optional()}).strip(),wx=_x.merge(bx);y.object({error:y.string(),error_description:y.string().optional()}).strip(),y.object({token:y.string(),token_type_hint:y.string().optional()}).strip();function xx(e){const t=typeof e=="string"?new URL(e):new URL(e.href);return t.hash="",t}function jx({requestedResource:e,configuredResource:t}){const a=typeof e=="string"?new URL(e):new URL(e.href),r=typeof t=="string"?new URL(t):new URL(t.href);if(a.origin!==r.origin||a.pathname.length<r.pathname.length)return!1;const n=a.pathname.endsWith("/")?a.pathname:a.pathname+"/",i=r.pathname.endsWith("/")?r.pathname:r.pathname+"/";return n.startsWith(i)}class jt extends Error{constructor(t,a){super(t),this.errorUri=a,this.name=this.constructor.name}toResponseObject(){const t={error:this.errorCode,error_description:this.message};return this.errorUri&&(t.error_uri=this.errorUri),t}get errorCode(){return this.constructor.errorCode}}class Yo extends jt{}Yo.errorCode="invalid_request";class zs extends jt{}zs.errorCode="invalid_client";class Zs extends jt{}Zs.errorCode="invalid_grant";class Us extends jt{}Us.errorCode="unauthorized_client";class ec extends jt{}ec.errorCode="unsupported_grant_type";class tc extends jt{}tc.errorCode="invalid_scope";class rc extends jt{}rc.errorCode="access_denied";class Ba extends jt{}Ba.errorCode="server_error";class ac extends jt{}ac.errorCode="temporarily_unavailable";class nc extends jt{}nc.errorCode="unsupported_response_type";class sc extends jt{}sc.errorCode="unsupported_token_type";class ic extends jt{}ic.errorCode="invalid_token";class oc extends jt{}oc.errorCode="method_not_allowed";class cc extends jt{}cc.errorCode="too_many_requests";class dc extends jt{}dc.errorCode="invalid_client_metadata";class lc extends jt{}lc.errorCode="insufficient_scope";const Ex={[Yo.errorCode]:Yo,[zs.errorCode]:zs,[Zs.errorCode]:Zs,[Us.errorCode]:Us,[ec.errorCode]:ec,[tc.errorCode]:tc,[rc.errorCode]:rc,[Ba.errorCode]:Ba,[ac.errorCode]:ac,[nc.errorCode]:nc,[sc.errorCode]:sc,[ic.errorCode]:ic,[oc.errorCode]:oc,[cc.errorCode]:cc,[dc.errorCode]:dc,[lc.errorCode]:lc};class vr extends Error{constructor(t){super(t??"Unauthorized")}}function Rp(e,t){const a=e.client_secret!==void 0;return t.length===0?a?"client_secret_post":"none":a&&t.includes("client_secret_basic")?"client_secret_basic":a&&t.includes("client_secret_post")?"client_secret_post":t.includes("none")?"none":a?"client_secret_post":"none"}function Tp(e,t,a,r){const{client_id:n,client_secret:i}=t;switch(e){case"client_secret_basic":Sx(n,i,a);return;case"client_secret_post":kx(n,i,r);return;case"none":Cx(n,r);return;default:throw new Error(`Unsupported client authentication method: ${e}`)}}function Sx(e,t,a){if(!t)throw new Error("client_secret_basic authentication requires a client_secret");const r=btoa(`${e}:${t}`);a.set("Authorization",`Basic ${r}`)}function kx(e,t,a){a.set("client_id",e),t&&a.set("client_secret",t)}function Cx(e,t){t.set("client_id",e)}async function uc(e){const t=e instanceof Response?e.status:void 0,a=e instanceof Response?await e.text():e;try{const r=yx.parse(JSON.parse(a)),{error:n,error_description:i,error_uri:s}=r,o=Ex[n]||Ba;return new o(i||"",s)}catch(r){const n=`${t?`HTTP ${t}: `:""}Invalid OAuth error response: ${r}. Raw body: ${a}`;return new Ba(n)}}async function Wa(e,t){var a,r;try{return await hc(e,t)}catch(n){if(n instanceof zs||n instanceof Us)return await((a=e.invalidateCredentials)===null||a===void 0?void 0:a.call(e,"all")),await hc(e,t);if(n instanceof Zs)return await((r=e.invalidateCredentials)===null||r===void 0?void 0:r.call(e,"tokens")),await hc(e,t);throw n}}async function hc(e,{serverUrl:t,authorizationCode:a,scope:r,resourceMetadataUrl:n,fetchFn:i}){let s,o=t;try{s=await Nx(t,{resourceMetadataUrl:n},i),s.authorization_servers&&s.authorization_servers.length>0&&(o=s.authorization_servers[0])}catch{}const c=await Px(t,e,s),l=await Rx(t,{authorizationServerUrl:o},i);let u=await Promise.resolve(e.clientInformation());if(!u){if(a!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");if(!e.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const m=await Mx(o,{metadata:l,clientMetadata:e.clientMetadata});await e.saveClientInformation(m),u=m}if(a!==void 0){const m=await e.codeVerifier(),g=await Ix(o,{metadata:l,clientInformation:u,authorizationCode:a,codeVerifier:m,redirectUri:e.redirectUrl,resource:c,addClientAuthentication:e.addClientAuthentication,fetchFn:i});return await e.saveTokens(g),"AUTHORIZED"}const p=await e.tokens();if(p!=null&&p.refresh_token)try{const m=await Lx(o,{metadata:l,clientInformation:u,refreshToken:p.refresh_token,resource:c,addClientAuthentication:e.addClientAuthentication});return await e.saveTokens(m),"AUTHORIZED"}catch(m){if(!(!(m instanceof jt)||m instanceof Ba))throw m}const h=e.state?await e.state():void 0,{authorizationUrl:v,codeVerifier:f}=await Tx(o,{metadata:l,clientInformation:u,state:h,redirectUrl:e.redirectUrl,scope:r||e.clientMetadata.scope,resource:c});return await e.saveCodeVerifier(f),await e.redirectToAuthorization(v),"REDIRECT"}async function Px(e,t,a){const r=xx(e);if(t.validateResourceURL)return await t.validateResourceURL(r,a==null?void 0:a.resource);if(a){if(!jx({requestedResource:r,configuredResource:a.resource}))throw new Error(`Protected resource ${a.resource} does not match expected ${r} (or origin)`);return new URL(a.resource)}}function pc(e){const t=e.headers.get("WWW-Authenticate");if(!t)return;const[a,r]=t.split(" ");if(a.toLowerCase()!=="bearer"||!r)return;const n=/resource_metadata="([^"]*)"/.exec(t);if(n)try{return new URL(n[1])}catch{return}}async function Nx(e,t,a=fetch){const r=await Mp(e,"oauth-protected-resource",a,{protocolVersion:t==null?void 0:t.protocolVersion,metadataUrl:t==null?void 0:t.resourceMetadataUrl});if(!r||r.status===404)throw new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!r.ok)throw new Error(`HTTP ${r.status} trying to load well-known OAuth protected resource metadata.`);return vx.parse(await r.json())}async function Ip(e,t,a=fetch){try{return await a(e,{headers:t})}catch(r){if(r instanceof TypeError)return t?Ip(e,void 0,a):void 0;throw r}}function Ox(e,t){let a=`/.well-known/${e}${t}`;return t.endsWith("/")&&(a=a.slice(0,-1)),a}async function Lp(e,t,a=fetch){return await Ip(e,{"MCP-Protocol-Version":t},a)}function $x(e,t){return!e||e.status===404&&t!=="/"}async function Mp(e,t,a,r){var n,i;const s=new URL(e),o=(n=r==null?void 0:r.protocolVersion)!==null&&n!==void 0?n:Ps;let c;if(r!=null&&r.metadataUrl)c=new URL(r.metadataUrl);else{const u=Ox(t,s.pathname);c=new URL(u,(i=r==null?void 0:r.metadataServerUrl)!==null&&i!==void 0?i:s),c.search=s.search}let l=await Lp(c,o,a);if(!(r!=null&&r.metadataUrl)&&$x(l,s.pathname)){const u=new URL(`/.well-known/${t}`,s);l=await Lp(u,o,a)}return l}async function Rx(e,{authorizationServerUrl:t,protocolVersion:a}={},r=fetch){typeof e=="string"&&(e=new URL(e)),t||(t=e),typeof t=="string"&&(t=new URL(t)),a??(a=Ps);const n=await Mp(t,"oauth-authorization-server",r,{protocolVersion:a,metadataServerUrl:t});if(!(!n||n.status===404)){if(!n.ok)throw new Error(`HTTP ${n.status} trying to load well-known OAuth metadata`);return gx.parse(await n.json())}}async function Tx(e,{metadata:t,clientInformation:a,redirectUrl:r,scope:n,state:i,resource:s}){const o="code",c="S256";let l;if(t){if(l=new URL(t.authorization_endpoint),!t.response_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support response type ${o}`);if(!t.code_challenge_methods_supported||!t.code_challenge_methods_supported.includes(c))throw new Error(`Incompatible auth server: does not support code challenge method ${c}`)}else l=new URL("/authorize",e);const u=await fx(),p=u.code_verifier,h=u.code_challenge;return l.searchParams.set("response_type",o),l.searchParams.set("client_id",a.client_id),l.searchParams.set("code_challenge",h),l.searchParams.set("code_challenge_method",c),l.searchParams.set("redirect_uri",String(r)),i&&l.searchParams.set("state",i),n&&l.searchParams.set("scope",n),n!=null&&n.includes("offline_access")&&l.searchParams.append("prompt","consent"),s&&l.searchParams.set("resource",s.href),{authorizationUrl:l,codeVerifier:p}}async function Ix(e,{metadata:t,clientInformation:a,authorizationCode:r,codeVerifier:n,redirectUri:i,resource:s,addClientAuthentication:o,fetchFn:c}){var l;const u="authorization_code",p=t!=null&&t.token_endpoint?new URL(t.token_endpoint):new URL("/token",e);if(t!=null&&t.grant_types_supported&&!t.grant_types_supported.includes(u))throw new Error(`Incompatible auth server: does not support grant type ${u}`);const h=new Headers({"Content-Type":"application/x-www-form-urlencoded"}),v=new URLSearchParams({grant_type:u,code:r,code_verifier:n,redirect_uri:String(i)});if(o)o(h,v,e,t);else{const m=(l=t==null?void 0:t.token_endpoint_auth_methods_supported)!==null&&l!==void 0?l:[],g=Rp(a,m);Tp(g,a,h,v)}s&&v.set("resource",s.href);const f=await(c??fetch)(p,{method:"POST",headers:h,body:v});if(!f.ok)throw await uc(f);return $p.parse(await f.json())}async function Lx(e,{metadata:t,clientInformation:a,refreshToken:r,resource:n,addClientAuthentication:i,fetchFn:s}){var o;const c="refresh_token";let l;if(t){if(l=new URL(t.token_endpoint),t.grant_types_supported&&!t.grant_types_supported.includes(c))throw new Error(`Incompatible auth server: does not support grant type ${c}`)}else l=new URL("/token",e);const u=new Headers({"Content-Type":"application/x-www-form-urlencoded"}),p=new URLSearchParams({grant_type:c,refresh_token:r});if(i)i(u,p,e,t);else{const v=(o=t==null?void 0:t.token_endpoint_auth_methods_supported)!==null&&o!==void 0?o:[],f=Rp(a,v);Tp(f,a,u,p)}n&&p.set("resource",n.href);const h=await(s??fetch)(l,{method:"POST",headers:u,body:p});if(!h.ok)throw await uc(h);return $p.parse({refresh_token:r,...await h.json()})}async function Mx(e,{metadata:t,clientMetadata:a,fetchFn:r}){let n;if(t){if(!t.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");n=new URL(t.registration_endpoint)}else n=new URL("/register",e);const i=await(r??fetch)(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)throw await uc(i);return wx.parse(await i.json())}class Dx extends Error{constructor(t,a,r){super(`SSE error: ${a}`),this.code=t,this.event=r}}class Ax{constructor(t,a){this._url=t,this._resourceMetadataUrl=void 0,this._eventSourceInit=a==null?void 0:a.eventSourceInit,this._requestInit=a==null?void 0:a.requestInit,this._authProvider=a==null?void 0:a.authProvider,this._fetch=a==null?void 0:a.fetch}async _authThenStart(){var t;if(!this._authProvider)throw new vr("No auth provider");let a;try{a=await Wa(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})}catch(r){throw(t=this.onerror)===null||t===void 0||t.call(this,r),r}if(a!=="AUTHORIZED")throw new vr;return await this._startOrAuth()}async _commonHeaders(){var t;const a={};if(this._authProvider){const r=await this._authProvider.tokens();r&&(a.Authorization=`Bearer ${r.access_token}`)}return this._protocolVersion&&(a["mcp-protocol-version"]=this._protocolVersion),new Headers({...a,...(t=this._requestInit)===null||t===void 0?void 0:t.headers})}_startOrAuth(){var t,a,r;const n=(r=(a=(t=this===null||this===void 0?void 0:this._eventSourceInit)===null||t===void 0?void 0:t.fetch)!==null&&a!==void 0?a:this._fetch)!==null&&r!==void 0?r:fetch;return new Promise((i,s)=>{this._eventSource=new Fs(this._url.href,{...this._eventSourceInit,fetch:async(o,c)=>{const l=await this._commonHeaders();l.set("Accept","text/event-stream");const u=await n(o,{...c,headers:l});return u.status===401&&u.headers.has("www-authenticate")&&(this._resourceMetadataUrl=pc(u)),u}}),this._abortController=new AbortController,this._eventSource.onerror=o=>{var c;if(o.code===401&&this._authProvider){this._authThenStart().then(i,s);return}const l=new Dx(o.code,o.message,o);s(l),(c=this.onerror)===null||c===void 0||c.call(this,l)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",o=>{var c;const l=o;try{if(this._endpoint=new URL(l.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(u){s(u),(c=this.onerror)===null||c===void 0||c.call(this,u),this.close();return}i()}),this._eventSource.onmessage=o=>{var c,l;const u=o;let p;try{p=Mn.parse(JSON.parse(u.data))}catch(h){(c=this.onerror)===null||c===void 0||c.call(this,h);return}(l=this.onmessage)===null||l===void 0||l.call(this,p)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(t){if(!this._authProvider)throw new vr("No auth provider");if(await Wa(this._authProvider,{serverUrl:this._url,authorizationCode:t,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new vr("Failed to authorize")}async close(){var t,a,r;(t=this._abortController)===null||t===void 0||t.abort(),(a=this._eventSource)===null||a===void 0||a.close(),(r=this.onclose)===null||r===void 0||r.call(this)}async send(t){var a,r,n;if(!this._endpoint)throw new Error("Not connected");try{const i=await this._commonHeaders();i.set("content-type","application/json");const s={...this._requestInit,method:"POST",headers:i,body:JSON.stringify(t),signal:(a=this._abortController)===null||a===void 0?void 0:a.signal},o=await((r=this._fetch)!==null&&r!==void 0?r:fetch)(this._endpoint,s);if(!o.ok){if(o.status===401&&this._authProvider){if(this._resourceMetadataUrl=pc(o),await Wa(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new vr;return this.send(t)}const c=await o.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${c}`)}}catch(i){throw(n=this.onerror)===null||n===void 0||n.call(this,i),i}}setProtocolVersion(t){this._protocolVersion=t}}const Fx={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class mc extends Error{constructor(t,a){super(`Streamable HTTP error: ${a}`),this.code=t}}class Dp{constructor(t,a){var r;this._url=t,this._resourceMetadataUrl=void 0,this._requestInit=a==null?void 0:a.requestInit,this._authProvider=a==null?void 0:a.authProvider,this._fetch=a==null?void 0:a.fetch,this._sessionId=a==null?void 0:a.sessionId,this._reconnectionOptions=(r=a==null?void 0:a.reconnectionOptions)!==null&&r!==void 0?r:Fx}async _authThenStart(){var t;if(!this._authProvider)throw new vr("No auth provider");let a;try{a=await Wa(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})}catch(r){throw(t=this.onerror)===null||t===void 0||t.call(this,r),r}if(a!=="AUTHORIZED")throw new vr;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){var t;const a={};if(this._authProvider){const n=await this._authProvider.tokens();n&&(a.Authorization=`Bearer ${n.access_token}`)}this._sessionId&&(a["mcp-session-id"]=this._sessionId),this._protocolVersion&&(a["mcp-protocol-version"]=this._protocolVersion);const r=this._normalizeHeaders((t=this._requestInit)===null||t===void 0?void 0:t.headers);return new Headers({...a,...r})}async _startOrAuthSse(t){var a,r,n;const{resumptionToken:i}=t;try{const s=await this._commonHeaders();s.set("Accept","text/event-stream"),i&&s.set("last-event-id",i);const o=await((a=this._fetch)!==null&&a!==void 0?a:fetch)(this._url,{method:"GET",headers:s,signal:(r=this._abortController)===null||r===void 0?void 0:r.signal});if(!o.ok){if(o.status===401&&this._authProvider)return await this._authThenStart();if(o.status===405)return;throw new mc(o.status,`Failed to open SSE stream: ${o.statusText}`)}this._handleSseStream(o.body,t,!0)}catch(s){throw(n=this.onerror)===null||n===void 0||n.call(this,s),s}}_getNextReconnectionDelay(t){const a=this._reconnectionOptions.initialReconnectionDelay,r=this._reconnectionOptions.reconnectionDelayGrowFactor,n=this._reconnectionOptions.maxReconnectionDelay;return Math.min(a*Math.pow(r,t),n)}_normalizeHeaders(t){return t?t instanceof Headers?Object.fromEntries(t.entries()):Array.isArray(t)?Object.fromEntries(t):{...t}:{}}_scheduleReconnection(t,a=0){var r;const n=this._reconnectionOptions.maxRetries;if(n>0&&a>=n){(r=this.onerror)===null||r===void 0||r.call(this,new Error(`Maximum reconnection attempts (${n}) exceeded.`));return}const i=this._getNextReconnectionDelay(a);setTimeout(()=>{this._startOrAuthSse(t).catch(s=>{var o;(o=this.onerror)===null||o===void 0||o.call(this,new Error(`Failed to reconnect SSE stream: ${s instanceof Error?s.message:String(s)}`)),this._scheduleReconnection(t,a+1)})},i)}_handleSseStream(t,a,r){if(!t)return;const{onresumptiontoken:n,replayMessageId:i}=a;let s;(async()=>{var o,c,l,u;try{const p=t.pipeThrough(new TextDecoderStream).pipeThrough(new Gf).getReader();for(;;){const{value:h,done:v}=await p.read();if(v)break;if(h.id&&(s=h.id,n==null||n(h.id)),!h.event||h.event==="message")try{const f=Mn.parse(JSON.parse(h.data));i!==void 0&&Wi(f)&&(f.id=i),(o=this.onmessage)===null||o===void 0||o.call(this,f)}catch(f){(c=this.onerror)===null||c===void 0||c.call(this,f)}}}catch(p){if((l=this.onerror)===null||l===void 0||l.call(this,new Error(`SSE stream disconnected: ${p}`)),r&&this._abortController&&!this._abortController.signal.aborted)try{this._scheduleReconnection({resumptionToken:s,onresumptiontoken:n,replayMessageId:i},0)}catch(h){(u=this.onerror)===null||u===void 0||u.call(this,new Error(`Failed to reconnect: ${h instanceof Error?h.message:String(h)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(t){if(!this._authProvider)throw new vr("No auth provider");if(await Wa(this._authProvider,{serverUrl:this._url,authorizationCode:t,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new vr("Failed to authorize")}async close(){var t,a;(t=this._abortController)===null||t===void 0||t.abort(),(a=this.onclose)===null||a===void 0||a.call(this)}async send(t,a){var r,n,i,s;try{const{resumptionToken:o,onresumptiontoken:c}=a||{};if(o){this._startOrAuthSse({resumptionToken:o,replayMessageId:Gl(t)?t.id:void 0}).catch(m=>{var g;return(g=this.onerror)===null||g===void 0?void 0:g.call(this,m)});return}const l=await this._commonHeaders();l.set("content-type","application/json"),l.set("accept","application/json, text/event-stream");const u={...this._requestInit,method:"POST",headers:l,body:JSON.stringify(t),signal:(r=this._abortController)===null||r===void 0?void 0:r.signal},p=await((n=this._fetch)!==null&&n!==void 0?n:fetch)(this._url,u),h=p.headers.get("mcp-session-id");if(h&&(this._sessionId=h),!p.ok){if(p.status===401&&this._authProvider){if(this._resourceMetadataUrl=pc(p),await Wa(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new vr;return this.send(t)}const m=await p.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${p.status}): ${m}`)}if(p.status===202){U0(t)&&this._startOrAuthSse({resumptionToken:void 0}).catch(m=>{var g;return(g=this.onerror)===null||g===void 0?void 0:g.call(this,m)});return}const v=(Array.isArray(t)?t:[t]).filter(m=>"method"in m&&"id"in m&&m.id!==void 0).length>0,f=p.headers.get("content-type");if(v)if(f!=null&&f.includes("text/event-stream"))this._handleSseStream(p.body,{onresumptiontoken:c},!1);else if(f!=null&&f.includes("application/json")){const m=await p.json(),g=Array.isArray(m)?m.map(w=>Mn.parse(w)):[Mn.parse(m)];for(const w of g)(i=this.onmessage)===null||i===void 0||i.call(this,w)}else throw new mc(-1,`Unexpected content type: ${f}`)}catch(o){throw(s=this.onerror)===null||s===void 0||s.call(this,o),o}}get sessionId(){return this._sessionId}async terminateSession(){var t,a,r;if(this._sessionId)try{const n=await this._commonHeaders(),i={...this._requestInit,method:"DELETE",headers:n,signal:(t=this._abortController)===null||t===void 0?void 0:t.signal},s=await((a=this._fetch)!==null&&a!==void 0?a:fetch)(this._url,i);if(!s.ok&&s.status!==405)throw new mc(s.status,`Failed to terminate session: ${s.statusText}`);this._sessionId=void 0}catch(n){throw(r=this.onerror)===null||r===void 0||r.call(this,n),n}}setProtocolVersion(t){this._protocolVersion=t}get protocolVersion(){return this._protocolVersion}}var fc={exports:{}},vc,Ap;function zx(){if(Ap)return vc;Ap=1;var e=1e3,t=e*60,a=t*60,r=a*24,n=r*7,i=r*365.25;vc=function(u,p){p=p||{};var h=typeof u;if(h==="string"&&u.length>0)return s(u);if(h==="number"&&isFinite(u))return p.long?c(u):o(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function s(u){if(u=String(u),!(u.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(p){var h=parseFloat(p[1]),v=(p[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return h*i;case"weeks":case"week":case"w":return h*n;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*a;case"minutes":case"minute":case"mins":case"min":case"m":return h*t;case"seconds":case"second":case"secs":case"sec":case"s":return h*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function o(u){var p=Math.abs(u);return p>=r?Math.round(u/r)+"d":p>=a?Math.round(u/a)+"h":p>=t?Math.round(u/t)+"m":p>=e?Math.round(u/e)+"s":u+"ms"}function c(u){var p=Math.abs(u);return p>=r?l(u,p,r,"day"):p>=a?l(u,p,a,"hour"):p>=t?l(u,p,t,"minute"):p>=e?l(u,p,e,"second"):u+" ms"}function l(u,p,h,v){var f=p>=h*1.5;return Math.round(u/h)+" "+v+(f?"s":"")}return vc}var gc,Fp;function Zx(){if(Fp)return gc;Fp=1;function e(t){r.debug=r,r.default=r,r.coerce=l,r.disable=o,r.enable=i,r.enabled=c,r.humanize=zx(),r.destroy=u,Object.keys(t).forEach(p=>{r[p]=t[p]}),r.names=[],r.skips=[],r.formatters={};function a(p){let h=0;for(let v=0;v<p.length;v++)h=(h<<5)-h+p.charCodeAt(v),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=a;function r(p){let h,v=null,f,m;function g(...w){if(!g.enabled)return;const E=g,O=Number(new Date),x=O-(h||O);E.diff=x,E.prev=h,E.curr=O,h=O,w[0]=r.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let k=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,($,N)=>{if($==="%%")return"%";k++;const M=r.formatters[N];if(typeof M=="function"){const A=w[k];$=M.call(E,A),w.splice(k,1),k--}return $}),r.formatArgs.call(E,w),(E.log||r.log).apply(E,w)}return g.namespace=p,g.useColors=r.useColors(),g.color=r.selectColor(p),g.extend=n,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>v!==null?v:(f!==r.namespaces&&(f=r.namespaces,m=r.enabled(p)),m),set:w=>{v=w}}),typeof r.init=="function"&&r.init(g),g}function n(p,h){const v=r(this.namespace+(typeof h>"u"?":":h)+p);return v.log=this.log,v}function i(p){r.save(p),r.namespaces=p,r.names=[],r.skips=[];const h=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const v of h)v[0]==="-"?r.skips.push(v.slice(1)):r.names.push(v)}function s(p,h){let v=0,f=0,m=-1,g=0;for(;v<p.length;)if(f<h.length&&(h[f]===p[v]||h[f]==="*"))h[f]==="*"?(m=f,g=v,f++):(v++,f++);else if(m!==-1)f=m+1,g++,v=g;else return!1;for(;f<h.length&&h[f]==="*";)f++;return f===h.length}function o(){const p=[...r.names,...r.skips.map(h=>"-"+h)].join(",");return r.enable(""),p}function c(p){for(const h of r.skips)if(s(p,h))return!1;for(const h of r.names)if(s(p,h))return!0;return!1}function l(p){return p instanceof Error?p.stack||p.message:p}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return gc=e,gc}var zp;function Ux(){return zp||(zp=1,function(e,t){var a={};t.formatArgs=n,t.save=i,t.load=s,t.useColors=r,t.storage=o(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let p=0,h=0;l[0].replace(/%[a-zA-Z%]/g,v=>{v!=="%%"&&(p++,v==="%c"&&(h=p))}),l.splice(h,0,u)}t.log=console.debug||console.log||(()=>{});function i(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function s(){let l;try{l=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!l&&typeof Ie<"u"&&"env"in Ie&&(l=a.DEBUG),l}function o(){try{return localStorage}catch{}}e.exports=Zx()(t);const{formatters:c}=e.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}(fc,fc.exports)),fc.exports}var Hx=Ux();const Zp=qc(Hx);var Qe;(function(e){e.assertEqual=n=>{};function t(n){}e.assertIs=t;function a(n){throw new Error}e.assertNever=a,e.arrayToEnum=n=>{const i={};for(const s of n)i[s]=s;return i},e.getValidEnumValues=n=>{const i=e.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(const o of i)s[o]=n[o];return e.objectValues(s)},e.objectValues=n=>e.objectKeys(n).map(function(i){return n[i]}),e.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&i.push(s);return i},e.find=(n,i)=>{for(const s of n)if(i(s))return s},e.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function r(n,i=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}e.joinValues=r,e.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(Qe||(Qe={}));var Up;(function(e){e.mergeShapes=(t,a)=>({...t,...a})})(Up||(Up={}));const ve=Qe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Kr=e=>{switch(typeof e){case"undefined":return ve.undefined;case"string":return ve.string;case"number":return Number.isNaN(e)?ve.nan:ve.number;case"boolean":return ve.boolean;case"function":return ve.function;case"bigint":return ve.bigint;case"symbol":return ve.symbol;case"object":return Array.isArray(e)?ve.array:e===null?ve.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?ve.promise:typeof Map<"u"&&e instanceof Map?ve.map:typeof Set<"u"&&e instanceof Set?ve.set:typeof Date<"u"&&e instanceof Date?ve.date:ve.object;default:return ve.unknown}},ee=Qe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Tr extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=t}format(t){const a=t||function(i){return i.message},r={_errors:[]},n=i=>{for(const s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)r._errors.push(a(s));else{let o=r,c=0;for(;c<s.path.length;){const l=s.path[c];c===s.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(a(s))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),r}static assert(t){if(!(t instanceof Tr))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Qe.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=a=>a.message){const a={},r=[];for(const n of this.issues)if(n.path.length>0){const i=n.path[0];a[i]=a[i]||[],a[i].push(t(n))}else r.push(t(n));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}}Tr.create=e=>new Tr(e);const yc=(e,t)=>{let a;switch(e.code){case ee.invalid_type:e.received===ve.undefined?a="Required":a=`Expected ${e.expected}, received ${e.received}`;break;case ee.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(e.expected,Qe.jsonStringifyReplacer)}`;break;case ee.unrecognized_keys:a=`Unrecognized key(s) in object: ${Qe.joinValues(e.keys,", ")}`;break;case ee.invalid_union:a="Invalid input";break;case ee.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${Qe.joinValues(e.options)}`;break;case ee.invalid_enum_value:a=`Invalid enum value. Expected ${Qe.joinValues(e.options)}, received '${e.received}'`;break;case ee.invalid_arguments:a="Invalid function arguments";break;case ee.invalid_return_type:a="Invalid function return type";break;case ee.invalid_date:a="Invalid date";break;case ee.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(a=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?a=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?a=`Invalid input: must end with "${e.validation.endsWith}"`:Qe.assertNever(e.validation):e.validation!=="regex"?a=`Invalid ${e.validation}`:a="Invalid";break;case ee.too_small:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?a=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:a="Invalid input";break;case ee.too_big:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?a=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:a="Invalid input";break;case ee.custom:a="Invalid input";break;case ee.invalid_intersection_types:a="Intersection results could not be merged";break;case ee.not_multiple_of:a=`Number must be a multiple of ${e.multipleOf}`;break;case ee.not_finite:a="Number must be finite";break;default:a=t.defaultError,Qe.assertNever(e)}return{message:a}};let qx=yc;function Vx(){return qx}const Bx=e=>{const{data:t,path:a,errorMaps:r,issueData:n}=e,i=[...a,...n.path||[]],s={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const c=r.filter(l=>!!l).slice().reverse();for(const l of c)o=l(s,{data:t,defaultError:o}).message;return{...n,path:i,message:o}};function ue(e,t){const a=Vx(),r=Bx({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,a,a===yc?void 0:yc].filter(n=>!!n)});e.common.issues.push(r)}class Rt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,a){const r=[];for(const n of a){if(n.status==="aborted")return Te;n.status==="dirty"&&t.dirty(),r.push(n.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,a){const r=[];for(const n of a){const i=await n.key,s=await n.value;r.push({key:i,value:s})}return Rt.mergeObjectSync(t,r)}static mergeObjectSync(t,a){const r={};for(const n of a){const{key:i,value:s}=n;if(i.status==="aborted"||s.status==="aborted")return Te;i.status==="dirty"&&t.dirty(),s.status==="dirty"&&t.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(r[i.value]=s.value)}return{status:t.value,value:r}}}const Te=Object.freeze({status:"aborted"}),_c=e=>({status:"dirty",value:e}),Qt=e=>({status:"valid",value:e}),Hp=e=>e.status==="aborted",qp=e=>e.status==="dirty",Ka=e=>e.status==="valid",Hs=e=>typeof Promise<"u"&&e instanceof Promise;var _e;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(_e||(_e={}));class gr{constructor(t,a,r,n){this._cachedPath=[],this.parent=t,this.data=a,this._path=r,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Vp=(e,t)=>{if(Ka(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const a=new Tr(e.common.issues);return this._error=a,this._error}}};function ze(e){if(!e)return{};const{errorMap:t,invalid_type_error:a,required_error:r,description:n}=e;if(t&&(a||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:n}:{errorMap:(i,s)=>{const{message:o}=e;return i.code==="invalid_enum_value"?{message:o??s.defaultError}:typeof s.data>"u"?{message:o??r??s.defaultError}:i.code!=="invalid_type"?{message:s.defaultError}:{message:o??a??s.defaultError}},description:n}}class qe{get description(){return this._def.description}_getType(t){return Kr(t.data)}_getOrReturnCtx(t,a){return a||{common:t.parent.common,data:t.data,parsedType:Kr(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Rt,ctx:{common:t.parent.common,data:t.data,parsedType:Kr(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const a=this._parse(t);if(Hs(a))throw new Error("Synchronous parse encountered promise.");return a}_parseAsync(t){const a=this._parse(t);return Promise.resolve(a)}parse(t,a){const r=this.safeParse(t,a);if(r.success)return r.data;throw r.error}safeParse(t,a){const r={common:{issues:[],async:(a==null?void 0:a.async)??!1,contextualErrorMap:a==null?void 0:a.errorMap},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Kr(t)},n=this._parseSync({data:t,path:r.path,parent:r});return Vp(r,n)}"~validate"(t){var r,n;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Kr(t)};if(!this["~standard"].async)try{const i=this._parseSync({data:t,path:[],parent:a});return Ka(i)?{value:i.value}:{issues:a.common.issues}}catch(i){(n=(r=i==null?void 0:i.message)==null?void 0:r.toLowerCase())!=null&&n.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:a}).then(i=>Ka(i)?{value:i.value}:{issues:a.common.issues})}async parseAsync(t,a){const r=await this.safeParseAsync(t,a);if(r.success)return r.data;throw r.error}async safeParseAsync(t,a){const r={common:{issues:[],contextualErrorMap:a==null?void 0:a.errorMap,async:!0},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Kr(t)},n=this._parse({data:t,path:r.path,parent:r}),i=await(Hs(n)?n:Promise.resolve(n));return Vp(r,i)}refine(t,a){const r=n=>typeof a=="string"||typeof a>"u"?{message:a}:typeof a=="function"?a(n):a;return this._refinement((n,i)=>{const s=t(n),o=()=>i.addIssue({code:ee.custom,...r(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(c=>c?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(t,a){return this._refinement((r,n)=>t(r)?!0:(n.addIssue(typeof a=="function"?a(r,n):a),!1))}_refinement(t){return new Qr({schema:this,typeName:$e.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return Gr.create(this,this._def)}nullable(){return en.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return yr.create(this)}promise(){return Ws.create(this,this._def)}or(t){return qs.create([this,t],this._def)}and(t){return Vs.create(this,t,this._def)}transform(t){return new Qr({...ze(this._def),schema:this,typeName:$e.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const a=typeof t=="function"?t:()=>t;return new Rc({...ze(this._def),innerType:this,defaultValue:a,typeName:$e.ZodDefault})}brand(){return new f1({typeName:$e.ZodBranded,type:this,...ze(this._def)})}catch(t){const a=typeof t=="function"?t:()=>t;return new Tc({...ze(this._def),innerType:this,catchValue:a,typeName:$e.ZodCatch})}describe(t){const a=this.constructor;return new a({...this._def,description:t})}pipe(t){return Lc.create(this,t)}readonly(){return Mc.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Wx=/^c[^\s-]{8,}$/i,Kx=/^[0-9a-z]+$/,Jx=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Qx=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Gx=/^[a-z0-9_-]{21}$/i,Xx=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Yx=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,e1=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,t1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let bc;const r1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,a1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,n1=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,s1=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,i1=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,o1=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Bp="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",c1=new RegExp(`^${Bp}$`);function Wp(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const a=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${a}`}function d1(e){return new RegExp(`^${Wp(e)}$`)}function l1(e){let t=`${Bp}T${Wp(e)}`;const a=[];return a.push(e.local?"Z?":"Z"),e.offset&&a.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${a.join("|")})`,new RegExp(`^${t}$`)}function u1(e,t){return!!((t==="v4"||!t)&&r1.test(e)||(t==="v6"||!t)&&n1.test(e))}function h1(e,t){if(!Xx.test(e))return!1;try{const[a]=e.split(".");if(!a)return!1;const r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||"typ"in n&&(n==null?void 0:n.typ)!=="JWT"||!n.alg||t&&n.alg!==t)}catch{return!1}}function p1(e,t){return!!((t==="v4"||!t)&&a1.test(e)||(t==="v6"||!t)&&s1.test(e))}class Ir extends qe{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ve.string){const n=this._getOrReturnCtx(t);return ue(n,{code:ee.invalid_type,expected:ve.string,received:n.parsedType}),Te}const a=new Rt;let r;for(const n of this._def.checks)if(n.kind==="min")t.data.length<n.value&&(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")t.data.length>n.value&&(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){const i=t.data.length>n.value,s=t.data.length<n.value;(i||s)&&(r=this._getOrReturnCtx(t,r),i?ue(r,{code:ee.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):s&&ue(r,{code:ee.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")e1.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"email",code:ee.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")bc||(bc=new RegExp(t1,"u")),bc.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"emoji",code:ee.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")Qx.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"uuid",code:ee.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")Gx.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"nanoid",code:ee.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")Wx.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"cuid",code:ee.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")Kx.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"cuid2",code:ee.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")Jx.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"ulid",code:ee.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(t.data)}catch{r=this._getOrReturnCtx(t,r),ue(r,{validation:"url",code:ee.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"regex",code:ee.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?t.data=t.data.trim():n.kind==="includes"?t.data.includes(n.value,n.position)||(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?t.data=t.data.toLowerCase():n.kind==="toUpperCase"?t.data=t.data.toUpperCase():n.kind==="startsWith"?t.data.startsWith(n.value)||(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?t.data.endsWith(n.value)||(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?l1(n).test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?c1.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?d1(n).test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?Yx.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"duration",code:ee.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?u1(t.data,n.version)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"ip",code:ee.invalid_string,message:n.message}),a.dirty()):n.kind==="jwt"?h1(t.data,n.alg)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"jwt",code:ee.invalid_string,message:n.message}),a.dirty()):n.kind==="cidr"?p1(t.data,n.version)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"cidr",code:ee.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?i1.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"base64",code:ee.invalid_string,message:n.message}),a.dirty()):n.kind==="base64url"?o1.test(t.data)||(r=this._getOrReturnCtx(t,r),ue(r,{validation:"base64url",code:ee.invalid_string,message:n.message}),a.dirty()):Qe.assertNever(n);return{status:a.value,value:t.data}}_regex(t,a,r){return this.refinement(n=>t.test(n),{validation:a,code:ee.invalid_string,..._e.errToObj(r)})}_addCheck(t){return new Ir({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",..._e.errToObj(t)})}url(t){return this._addCheck({kind:"url",..._e.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",..._e.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",..._e.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",..._e.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",..._e.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",..._e.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",..._e.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",..._e.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",..._e.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",..._e.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",..._e.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",..._e.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,..._e.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,..._e.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",..._e.errToObj(t)})}regex(t,a){return this._addCheck({kind:"regex",regex:t,..._e.errToObj(a)})}includes(t,a){return this._addCheck({kind:"includes",value:t,position:a==null?void 0:a.position,..._e.errToObj(a==null?void 0:a.message)})}startsWith(t,a){return this._addCheck({kind:"startsWith",value:t,..._e.errToObj(a)})}endsWith(t,a){return this._addCheck({kind:"endsWith",value:t,..._e.errToObj(a)})}min(t,a){return this._addCheck({kind:"min",value:t,..._e.errToObj(a)})}max(t,a){return this._addCheck({kind:"max",value:t,..._e.errToObj(a)})}length(t,a){return this._addCheck({kind:"length",value:t,..._e.errToObj(a)})}nonempty(t){return this.min(1,_e.errToObj(t))}trim(){return new Ir({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ir({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ir({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxLength(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}}Ir.create=e=>new Ir({checks:[],typeName:$e.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...ze(e)});function m1(e,t){const a=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,n=a>r?a:r,i=Number.parseInt(e.toFixed(n).replace(".","")),s=Number.parseInt(t.toFixed(n).replace(".",""));return i%s/10**n}class Ja extends qe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ve.number){const n=this._getOrReturnCtx(t);return ue(n,{code:ee.invalid_type,expected:ve.number,received:n.parsedType}),Te}let a;const r=new Rt;for(const n of this._def.checks)n.kind==="int"?Qe.isInteger(t.data)||(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):n.kind==="min"?(n.inclusive?t.data<n.value:t.data<=n.value)&&(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):n.kind==="max"?(n.inclusive?t.data>n.value:t.data>=n.value)&&(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):n.kind==="multipleOf"?m1(t.data,n.value)!==0&&(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):n.kind==="finite"?Number.isFinite(t.data)||(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.not_finite,message:n.message}),r.dirty()):Qe.assertNever(n);return{status:r.value,value:t.data}}gte(t,a){return this.setLimit("min",t,!0,_e.toString(a))}gt(t,a){return this.setLimit("min",t,!1,_e.toString(a))}lte(t,a){return this.setLimit("max",t,!0,_e.toString(a))}lt(t,a){return this.setLimit("max",t,!1,_e.toString(a))}setLimit(t,a,r,n){return new Ja({...this._def,checks:[...this._def.checks,{kind:t,value:a,inclusive:r,message:_e.toString(n)}]})}_addCheck(t){return new Ja({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:_e.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_e.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_e.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_e.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_e.toString(t)})}multipleOf(t,a){return this._addCheck({kind:"multipleOf",value:t,message:_e.toString(a)})}finite(t){return this._addCheck({kind:"finite",message:_e.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_e.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_e.toString(t)})}get minValue(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxValue(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Qe.isInteger(t.value))}get isFinite(){let t=null,a=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(a)&&Number.isFinite(t)}}Ja.create=e=>new Ja({checks:[],typeName:$e.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...ze(e)});class Qa extends qe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==ve.bigint)return this._getInvalidInput(t);let a;const r=new Rt;for(const n of this._def.checks)n.kind==="min"?(n.inclusive?t.data<n.value:t.data<=n.value)&&(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):n.kind==="max"?(n.inclusive?t.data>n.value:t.data>=n.value)&&(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):n.kind==="multipleOf"?t.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(t,a),ue(a,{code:ee.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):Qe.assertNever(n);return{status:r.value,value:t.data}}_getInvalidInput(t){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.bigint,received:a.parsedType}),Te}gte(t,a){return this.setLimit("min",t,!0,_e.toString(a))}gt(t,a){return this.setLimit("min",t,!1,_e.toString(a))}lte(t,a){return this.setLimit("max",t,!0,_e.toString(a))}lt(t,a){return this.setLimit("max",t,!1,_e.toString(a))}setLimit(t,a,r,n){return new Qa({...this._def,checks:[...this._def.checks,{kind:t,value:a,inclusive:r,message:_e.toString(n)}]})}_addCheck(t){return new Qa({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_e.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_e.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_e.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_e.toString(t)})}multipleOf(t,a){return this._addCheck({kind:"multipleOf",value:t,message:_e.toString(a)})}get minValue(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxValue(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}}Qa.create=e=>new Qa({checks:[],typeName:$e.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...ze(e)});class wc extends qe{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ve.boolean){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.boolean,received:a.parsedType}),Te}return Qt(t.data)}}wc.create=e=>new wc({typeName:$e.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...ze(e)});class Un extends qe{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ve.date){const n=this._getOrReturnCtx(t);return ue(n,{code:ee.invalid_type,expected:ve.date,received:n.parsedType}),Te}if(Number.isNaN(t.data.getTime())){const n=this._getOrReturnCtx(t);return ue(n,{code:ee.invalid_date}),Te}const a=new Rt;let r;for(const n of this._def.checks)n.kind==="min"?t.data.getTime()<n.value&&(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?t.data.getTime()>n.value&&(r=this._getOrReturnCtx(t,r),ue(r,{code:ee.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):Qe.assertNever(n);return{status:a.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Un({...this._def,checks:[...this._def.checks,t]})}min(t,a){return this._addCheck({kind:"min",value:t.getTime(),message:_e.toString(a)})}max(t,a){return this._addCheck({kind:"max",value:t.getTime(),message:_e.toString(a)})}get minDate(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t!=null?new Date(t):null}}Un.create=e=>new Un({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:$e.ZodDate,...ze(e)});class xc extends qe{_parse(t){if(this._getType(t)!==ve.symbol){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.symbol,received:a.parsedType}),Te}return Qt(t.data)}}xc.create=e=>new xc({typeName:$e.ZodSymbol,...ze(e)});class jc extends qe{_parse(t){if(this._getType(t)!==ve.undefined){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.undefined,received:a.parsedType}),Te}return Qt(t.data)}}jc.create=e=>new jc({typeName:$e.ZodUndefined,...ze(e)});class Ec extends qe{_parse(t){if(this._getType(t)!==ve.null){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.null,received:a.parsedType}),Te}return Qt(t.data)}}Ec.create=e=>new Ec({typeName:$e.ZodNull,...ze(e)});class Hn extends qe{constructor(){super(...arguments),this._any=!0}_parse(t){return Qt(t.data)}}Hn.create=e=>new Hn({typeName:$e.ZodAny,...ze(e)});class Sc extends qe{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Qt(t.data)}}Sc.create=e=>new Sc({typeName:$e.ZodUnknown,...ze(e)});class Jr extends qe{_parse(t){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.never,received:a.parsedType}),Te}}Jr.create=e=>new Jr({typeName:$e.ZodNever,...ze(e)});class kc extends qe{_parse(t){if(this._getType(t)!==ve.undefined){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.void,received:a.parsedType}),Te}return Qt(t.data)}}kc.create=e=>new kc({typeName:$e.ZodVoid,...ze(e)});class yr extends qe{_parse(t){const{ctx:a,status:r}=this._processInputParams(t),n=this._def;if(a.parsedType!==ve.array)return ue(a,{code:ee.invalid_type,expected:ve.array,received:a.parsedType}),Te;if(n.exactLength!==null){const s=a.data.length>n.exactLength.value,o=a.data.length<n.exactLength.value;(s||o)&&(ue(a,{code:s?ee.too_big:ee.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&a.data.length<n.minLength.value&&(ue(a,{code:ee.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),n.maxLength!==null&&a.data.length>n.maxLength.value&&(ue(a,{code:ee.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((s,o)=>n.type._parseAsync(new gr(a,s,a.path,o)))).then(s=>Rt.mergeArray(r,s));const i=[...a.data].map((s,o)=>n.type._parseSync(new gr(a,s,a.path,o)));return Rt.mergeArray(r,i)}get element(){return this._def.type}min(t,a){return new yr({...this._def,minLength:{value:t,message:_e.toString(a)}})}max(t,a){return new yr({...this._def,maxLength:{value:t,message:_e.toString(a)}})}length(t,a){return new yr({...this._def,exactLength:{value:t,message:_e.toString(a)}})}nonempty(t){return this.min(1,t)}}yr.create=(e,t)=>new yr({type:e,minLength:null,maxLength:null,exactLength:null,typeName:$e.ZodArray,...ze(t)});function Ga(e){if(e instanceof lt){const t={};for(const a in e.shape){const r=e.shape[a];t[a]=Gr.create(Ga(r))}return new lt({...e._def,shape:()=>t})}else return e instanceof yr?new yr({...e._def,type:Ga(e.element)}):e instanceof Gr?Gr.create(Ga(e.unwrap())):e instanceof en?en.create(Ga(e.unwrap())):e instanceof fa?fa.create(e.items.map(t=>Ga(t))):e}class lt extends qe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),a=Qe.objectKeys(t);return this._cached={shape:t,keys:a},this._cached}_parse(t){if(this._getType(t)!==ve.object){const c=this._getOrReturnCtx(t);return ue(c,{code:ee.invalid_type,expected:ve.object,received:c.parsedType}),Te}const{status:a,ctx:r}=this._processInputParams(t),{shape:n,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof Jr&&this._def.unknownKeys==="strip"))for(const c in r.data)i.includes(c)||s.push(c);const o=[];for(const c of i){const l=n[c],u=r.data[c];o.push({key:{status:"valid",value:c},value:l._parse(new gr(r,u,r.path,c)),alwaysSet:c in r.data})}if(this._def.catchall instanceof Jr){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of s)o.push({key:{status:"valid",value:l},value:{status:"valid",value:r.data[l]}});else if(c==="strict")s.length>0&&(ue(r,{code:ee.unrecognized_keys,keys:s}),a.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of s){const u=r.data[l];o.push({key:{status:"valid",value:l},value:c._parse(new gr(r,u,r.path,l)),alwaysSet:l in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of o){const u=await l.key,p=await l.value;c.push({key:u,value:p,alwaysSet:l.alwaysSet})}return c}).then(c=>Rt.mergeObjectSync(a,c)):Rt.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(t){return _e.errToObj,new lt({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(a,r)=>{var i,s;const n=((s=(i=this._def).errorMap)==null?void 0:s.call(i,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:_e.errToObj(t).message??n}:{message:n}}}:{}})}strip(){return new lt({...this._def,unknownKeys:"strip"})}passthrough(){return new lt({...this._def,unknownKeys:"passthrough"})}extend(t){return new lt({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new lt({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:$e.ZodObject})}setKey(t,a){return this.augment({[t]:a})}catchall(t){return new lt({...this._def,catchall:t})}pick(t){const a={};for(const r of Qe.objectKeys(t))t[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new lt({...this._def,shape:()=>a})}omit(t){const a={};for(const r of Qe.objectKeys(this.shape))t[r]||(a[r]=this.shape[r]);return new lt({...this._def,shape:()=>a})}deepPartial(){return Ga(this)}partial(t){const a={};for(const r of Qe.objectKeys(this.shape)){const n=this.shape[r];t&&!t[r]?a[r]=n:a[r]=n.optional()}return new lt({...this._def,shape:()=>a})}required(t){const a={};for(const r of Qe.objectKeys(this.shape))if(t&&!t[r])a[r]=this.shape[r];else{let n=this.shape[r];for(;n instanceof Gr;)n=n._def.innerType;a[r]=n}return new lt({...this._def,shape:()=>a})}keyof(){return Kp(Qe.objectKeys(this.shape))}}lt.create=(e,t)=>new lt({shape:()=>e,unknownKeys:"strip",catchall:Jr.create(),typeName:$e.ZodObject,...ze(t)}),lt.strictCreate=(e,t)=>new lt({shape:()=>e,unknownKeys:"strict",catchall:Jr.create(),typeName:$e.ZodObject,...ze(t)}),lt.lazycreate=(e,t)=>new lt({shape:e,unknownKeys:"strip",catchall:Jr.create(),typeName:$e.ZodObject,...ze(t)});class qs extends qe{_parse(t){const{ctx:a}=this._processInputParams(t),r=this._def.options;function n(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return a.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(o=>new Tr(o.ctx.common.issues));return ue(a,{code:ee.invalid_union,unionErrors:s}),Te}if(a.common.async)return Promise.all(r.map(async i=>{const s={...a,common:{...a.common,issues:[]},parent:null};return{result:await i._parseAsync({data:a.data,path:a.path,parent:s}),ctx:s}})).then(n);{let i;const s=[];for(const c of r){const l={...a,common:{...a.common,issues:[]},parent:null},u=c._parseSync({data:a.data,path:a.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:l}),l.common.issues.length&&s.push(l.common.issues)}if(i)return a.common.issues.push(...i.ctx.common.issues),i.result;const o=s.map(c=>new Tr(c));return ue(a,{code:ee.invalid_union,unionErrors:o}),Te}}get options(){return this._def.options}}qs.create=(e,t)=>new qs({options:e,typeName:$e.ZodUnion,...ze(t)});function Cc(e,t){const a=Kr(e),r=Kr(t);if(e===t)return{valid:!0,data:e};if(a===ve.object&&r===ve.object){const n=Qe.objectKeys(t),i=Qe.objectKeys(e).filter(o=>n.indexOf(o)!==-1),s={...e,...t};for(const o of i){const c=Cc(e[o],t[o]);if(!c.valid)return{valid:!1};s[o]=c.data}return{valid:!0,data:s}}else if(a===ve.array&&r===ve.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let i=0;i<e.length;i++){const s=e[i],o=t[i],c=Cc(s,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return a===ve.date&&r===ve.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Vs extends qe{_parse(t){const{status:a,ctx:r}=this._processInputParams(t),n=(i,s)=>{if(Hp(i)||Hp(s))return Te;const o=Cc(i.value,s.value);return o.valid?((qp(i)||qp(s))&&a.dirty(),{status:a.value,value:o.data}):(ue(r,{code:ee.invalid_intersection_types}),Te)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,s])=>n(i,s)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Vs.create=(e,t,a)=>new Vs({left:e,right:t,typeName:$e.ZodIntersection,...ze(a)});class fa extends qe{_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.parsedType!==ve.array)return ue(r,{code:ee.invalid_type,expected:ve.array,received:r.parsedType}),Te;if(r.data.length<this._def.items.length)return ue(r,{code:ee.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Te;!this._def.rest&&r.data.length>this._def.items.length&&(ue(r,{code:ee.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());const n=[...r.data].map((i,s)=>{const o=this._def.items[s]||this._def.rest;return o?o._parse(new gr(r,i,r.path,s)):null}).filter(i=>!!i);return r.common.async?Promise.all(n).then(i=>Rt.mergeArray(a,i)):Rt.mergeArray(a,n)}get items(){return this._def.items}rest(t){return new fa({...this._def,rest:t})}}fa.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new fa({items:e,typeName:$e.ZodTuple,rest:null,...ze(t)})};class Bs extends qe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.parsedType!==ve.object)return ue(r,{code:ee.invalid_type,expected:ve.object,received:r.parsedType}),Te;const n=[],i=this._def.keyType,s=this._def.valueType;for(const o in r.data)n.push({key:i._parse(new gr(r,o,r.path,o)),value:s._parse(new gr(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Rt.mergeObjectAsync(a,n):Rt.mergeObjectSync(a,n)}get element(){return this._def.valueType}static create(t,a,r){return a instanceof qe?new Bs({keyType:t,valueType:a,typeName:$e.ZodRecord,...ze(r)}):new Bs({keyType:Ir.create(),valueType:t,typeName:$e.ZodRecord,...ze(a)})}}class Pc extends qe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.parsedType!==ve.map)return ue(r,{code:ee.invalid_type,expected:ve.map,received:r.parsedType}),Te;const n=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([o,c],l)=>({key:n._parse(new gr(r,o,r.path,[l,"key"])),value:i._parse(new gr(r,c,r.path,[l,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of s){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return Te;(l.status==="dirty"||u.status==="dirty")&&a.dirty(),o.set(l.value,u.value)}return{status:a.value,value:o}})}else{const o=new Map;for(const c of s){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return Te;(l.status==="dirty"||u.status==="dirty")&&a.dirty(),o.set(l.value,u.value)}return{status:a.value,value:o}}}}Pc.create=(e,t,a)=>new Pc({valueType:t,keyType:e,typeName:$e.ZodMap,...ze(a)});class Xa extends qe{_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.parsedType!==ve.set)return ue(r,{code:ee.invalid_type,expected:ve.set,received:r.parsedType}),Te;const n=this._def;n.minSize!==null&&r.data.size<n.minSize.value&&(ue(r,{code:ee.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),a.dirty()),n.maxSize!==null&&r.data.size>n.maxSize.value&&(ue(r,{code:ee.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),a.dirty());const i=this._def.valueType;function s(c){const l=new Set;for(const u of c){if(u.status==="aborted")return Te;u.status==="dirty"&&a.dirty(),l.add(u.value)}return{status:a.value,value:l}}const o=[...r.data.values()].map((c,l)=>i._parse(new gr(r,c,r.path,l)));return r.common.async?Promise.all(o).then(c=>s(c)):s(o)}min(t,a){return new Xa({...this._def,minSize:{value:t,message:_e.toString(a)}})}max(t,a){return new Xa({...this._def,maxSize:{value:t,message:_e.toString(a)}})}size(t,a){return this.min(t,a).max(t,a)}nonempty(t){return this.min(1,t)}}Xa.create=(e,t)=>new Xa({valueType:e,minSize:null,maxSize:null,typeName:$e.ZodSet,...ze(t)});class Nc extends qe{get schema(){return this._def.getter()}_parse(t){const{ctx:a}=this._processInputParams(t);return this._def.getter()._parse({data:a.data,path:a.path,parent:a})}}Nc.create=(e,t)=>new Nc({getter:e,typeName:$e.ZodLazy,...ze(t)});class Oc extends qe{_parse(t){if(t.data!==this._def.value){const a=this._getOrReturnCtx(t);return ue(a,{received:a.data,code:ee.invalid_literal,expected:this._def.value}),Te}return{status:"valid",value:t.data}}get value(){return this._def.value}}Oc.create=(e,t)=>new Oc({value:e,typeName:$e.ZodLiteral,...ze(t)});function Kp(e,t){return new Ya({values:e,typeName:$e.ZodEnum,...ze(t)})}class Ya extends qe{_parse(t){if(typeof t.data!="string"){const a=this._getOrReturnCtx(t),r=this._def.values;return ue(a,{expected:Qe.joinValues(r),received:a.parsedType,code:ee.invalid_type}),Te}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const a=this._getOrReturnCtx(t),r=this._def.values;return ue(a,{received:a.data,code:ee.invalid_enum_value,options:r}),Te}return Qt(t.data)}get options(){return this._def.values}get enum(){const t={};for(const a of this._def.values)t[a]=a;return t}get Values(){const t={};for(const a of this._def.values)t[a]=a;return t}get Enum(){const t={};for(const a of this._def.values)t[a]=a;return t}extract(t,a=this._def){return Ya.create(t,{...this._def,...a})}exclude(t,a=this._def){return Ya.create(this.options.filter(r=>!t.includes(r)),{...this._def,...a})}}Ya.create=Kp;class $c extends qe{_parse(t){const a=Qe.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==ve.string&&r.parsedType!==ve.number){const n=Qe.objectValues(a);return ue(r,{expected:Qe.joinValues(n),received:r.parsedType,code:ee.invalid_type}),Te}if(this._cache||(this._cache=new Set(Qe.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const n=Qe.objectValues(a);return ue(r,{received:r.data,code:ee.invalid_enum_value,options:n}),Te}return Qt(t.data)}get enum(){return this._def.values}}$c.create=(e,t)=>new $c({values:e,typeName:$e.ZodNativeEnum,...ze(t)});class Ws extends qe{unwrap(){return this._def.type}_parse(t){const{ctx:a}=this._processInputParams(t);if(a.parsedType!==ve.promise&&a.common.async===!1)return ue(a,{code:ee.invalid_type,expected:ve.promise,received:a.parsedType}),Te;const r=a.parsedType===ve.promise?a.data:Promise.resolve(a.data);return Qt(r.then(n=>this._def.type.parseAsync(n,{path:a.path,errorMap:a.common.contextualErrorMap})))}}Ws.create=(e,t)=>new Ws({type:e,typeName:$e.ZodPromise,...ze(t)});class Qr extends qe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$e.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:a,ctx:r}=this._processInputParams(t),n=this._def.effect||null,i={addIssue:s=>{ue(r,s),s.fatal?a.abort():a.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const s=n.transform(r.data,i);if(r.common.async)return Promise.resolve(s).then(async o=>{if(a.value==="aborted")return Te;const c=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return c.status==="aborted"?Te:c.status==="dirty"||a.value==="dirty"?_c(c.value):c});{if(a.value==="aborted")return Te;const o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?Te:o.status==="dirty"||a.value==="dirty"?_c(o.value):o}}if(n.type==="refinement"){const s=o=>{const c=n.refinement(o,i);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?Te:(o.status==="dirty"&&a.dirty(),s(o.value),{status:a.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?Te:(o.status==="dirty"&&a.dirty(),s(o.value).then(()=>({status:a.value,value:o.value}))))}if(n.type==="transform")if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Ka(s))return Te;const o=n.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:a.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>Ka(s)?Promise.resolve(n.transform(s.value,i)).then(o=>({status:a.value,value:o})):Te);Qe.assertNever(n)}}Qr.create=(e,t,a)=>new Qr({schema:e,typeName:$e.ZodEffects,effect:t,...ze(a)}),Qr.createWithPreprocess=(e,t,a)=>new Qr({schema:t,effect:{type:"preprocess",transform:e},typeName:$e.ZodEffects,...ze(a)});class Gr extends qe{_parse(t){return this._getType(t)===ve.undefined?Qt(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Gr.create=(e,t)=>new Gr({innerType:e,typeName:$e.ZodOptional,...ze(t)});class en extends qe{_parse(t){return this._getType(t)===ve.null?Qt(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}en.create=(e,t)=>new en({innerType:e,typeName:$e.ZodNullable,...ze(t)});class Rc extends qe{_parse(t){const{ctx:a}=this._processInputParams(t);let r=a.data;return a.parsedType===ve.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:a.path,parent:a})}removeDefault(){return this._def.innerType}}Rc.create=(e,t)=>new Rc({innerType:e,typeName:$e.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ze(t)});class Tc extends qe{_parse(t){const{ctx:a}=this._processInputParams(t),r={...a,common:{...a.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Hs(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Tr(r.common.issues)},input:r.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Tr(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Tc.create=(e,t)=>new Tc({innerType:e,typeName:$e.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ze(t)});class Ic extends qe{_parse(t){if(this._getType(t)!==ve.nan){const a=this._getOrReturnCtx(t);return ue(a,{code:ee.invalid_type,expected:ve.nan,received:a.parsedType}),Te}return{status:"valid",value:t.data}}}Ic.create=e=>new Ic({typeName:$e.ZodNaN,...ze(e)});class f1 extends qe{_parse(t){const{ctx:a}=this._processInputParams(t),r=a.data;return this._def.type._parse({data:r,path:a.path,parent:a})}unwrap(){return this._def.type}}class Lc extends qe{_parse(t){const{status:a,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const n=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?Te:n.status==="dirty"?(a.dirty(),_c(n.value)):this._def.out._parseAsync({data:n.value,path:r.path,parent:r})})();{const n=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?Te:n.status==="dirty"?(a.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:r.path,parent:r})}}static create(t,a){return new Lc({in:t,out:a,typeName:$e.ZodPipeline})}}class Mc extends qe{_parse(t){const a=this._def.innerType._parse(t),r=n=>(Ka(n)&&(n.value=Object.freeze(n.value)),n);return Hs(a)?a.then(n=>r(n)):r(a)}unwrap(){return this._def.innerType}}Mc.create=(e,t)=>new Mc({innerType:e,typeName:$e.ZodReadonly,...ze(t)});function Jp(e,t){const a=typeof e=="function"?e(t):typeof e=="string"?{message:e}:e;return typeof a=="string"?{message:a}:a}function v1(e,t={},a){return e?Hn.create().superRefine((r,n)=>{const i=e(r);if(i instanceof Promise)return i.then(s=>{if(!s){const o=Jp(t,r),c=o.fatal??a??!0;n.addIssue({code:"custom",...o,fatal:c})}});if(!i){const s=Jp(t,r),o=s.fatal??a??!0;n.addIssue({code:"custom",...s,fatal:o})}}):Hn.create()}lt.lazycreate;var $e;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})($e||($e={}));const Xr=Ir.create,qn=Ja.create;Ic.create,Qa.create;const tn=wc.create;Un.create,xc.create,jc.create,Ec.create,Hn.create,Sc.create,Jr.create,kc.create;const g1=yr.create,va=lt.create;lt.strictCreate;const Yr=qs.create;Vs.create,fa.create;const Ks=Bs.create;Pc.create,Xa.create,Nc.create;const Tt=Oc.create;Ya.create,$c.create,Ws.create,Qr.create,Gr.create,en.create,Qr.createWithPreprocess;function y1(e){return typeof e=="object"&&e!==null&&"_def"in e&&e._def.typeName==="ZodObject"}function _1(e){return typeof e=="object"&&e!==null&&"_def"in e&&e._def.typeName==="ZodLiteral"}const b1=Ts.shape.content._def.innerType.element,Js=b1.options.map(e=>{if(y1(e)&&"type"in e.shape&&_1(e.shape.type))return e.shape.type.value;throw new Error("Internal error: Invalid option found in CallToolResultContentSchema's union. Expected ZodObject with ZodLiteral 'type'.")}),w1=Js.map(e=>Tt(e));Yr(w1);const x1=Yr([Tt("content").describe("Put tool output into the ToolMessage.content array"),Tt("artifact").describe("Put tool output into the ToolMessage.artifact array")]),j1=va(Object.fromEntries(Js.map(e=>[e,Yr([Tt("content").describe(`Put all ${e} tool output into the ToolMessage.content array`),Tt("artifact").describe(`Put all ${e} tool output into the ToolMessage.artifact array`)]).describe(`Where to place ${e} tool output in the LangChain ToolMessage`).optional()]))),E1=Yr([x1,j1]).describe("Defines where to place each tool output type in the LangChain ToolMessage.\n\nItems in the `content` field will be used as input context for the LLM, while the artifact field is\nused for capturing tool output that won't be shown to the model, to be used in some later workflow\nstep.\n\nFor example, imagine that you have a SQL query tool that can return huge result sets. Rather than\nsending these large outputs directly to the model, perhaps you want the model to be able to inspect\nthe output in a code execution environment. In this case, you would set the output handling for the\n`resource` type to `artifact` (it's default value), and then upon initialization of your code\nexecution environment, you would look through your message history for `ToolMessage`s with the\n`artifact` field set to `resource`, and use the `content` field during initialization of the\nenvironment."),S1=v1(e=>{if(!e||typeof e!="object")return!1;const t=["redirectUrl","clientMetadata","clientInformation","tokens","saveTokens"];if(!("redirectUrl"in e)||!("clientMetadata"in e))return!1;for(const a of t)if(!(a in e))return!1;return!0},{message:"Must be a valid OAuthClientProvider implementation with required properties: redirectUrl, clientMetadata, clientInformation, tokens, saveTokens"}),Dc=va({outputHandling:E1.optional(),defaultToolTimeout:qn().min(1).optional()}),k1=va({enabled:tn().describe("Whether to automatically restart the process if it exits").optional(),maxAttempts:qn().describe("The maximum number of restart attempts").optional(),delayMs:qn().describe("The delay in milliseconds between restart attempts").optional()}).describe("Configuration for stdio transport restart"),C1=va({transport:Tt("stdio").optional(),type:Tt("stdio").optional(),command:Xr().describe("The executable to run the server"),args:g1(Xr()).describe("Command line arguments to pass to the executable"),env:Ks(Xr()).describe("The environment to use when spawning the process").optional(),encoding:Xr().describe("The encoding to use when reading from the process").optional(),stderr:Yr([Tt("overlapped"),Tt("pipe"),Tt("ignore"),Tt("inherit")]).describe("How to handle stderr of the child process. This matches the semantics of Node's `child_process.spawn`").optional().default("inherit"),cwd:Xr().describe("The working directory to use when spawning the process").optional(),restart:k1.optional()}).and(Dc).describe("Configuration for stdio transport connection"),P1=va({enabled:tn().describe("Whether to automatically reconnect if the connection is lost").optional(),maxAttempts:qn().describe("The maximum number of reconnection attempts").optional(),delayMs:qn().describe("The delay in milliseconds between reconnection attempts").optional()}).describe("Configuration for streamable HTTP transport reconnection"),N1=va({transport:Yr([Tt("http"),Tt("sse")]).optional(),type:Yr([Tt("http"),Tt("sse")]).optional(),url:Xr().url(),headers:Ks(Xr()).optional(),authProvider:S1.optional(),reconnect:P1.optional(),automaticSSEFallback:tn().optional().default(!0)}).and(Dc).describe("Configuration for streamable HTTP transport connection"),Qp=Yr([C1,N1]).describe("Configuration for a single MCP server"),O1=va({mcpServers:Ks(Qp).describe("A map of server names to their configuration"),throwOnLoadError:tn().describe("Whether to throw an error if a tool fails to load").optional().default(!0),prefixToolNameWithServerName:tn().describe("Whether to prefix tool names with the server name").optional().default(!1),additionalToolNamePrefix:Xr().describe("An additional prefix to add to the tool name").optional().default(""),useStandardContentBlocks:tn().describe("If true, the tool will use LangChain's standard multimodal content blocks for tools that output\nimage or audio content. When true, embedded resources will be converted to `StandardFileBlock`\nobjects. When `false`, all artifacts are left in their MCP format, but embedded resources will\nbe converted to `StandardFileBlock` objects if `outputHandling` causes embedded resources to be\ntreated as content, as otherwise ChatModel providers will not be able to interpret them.").optional().default(!1)}).and(Dc).describe("Configuration for the MCP client");function Ac(e,t=!1){if(e==null)return{};if(typeof e=="string")return Object.fromEntries(Js.map(r=>[r,e]));const a={};for(const r of Js)(e[r]||t)&&(a[r]=e[r]??(r==="resource"?"artifact":"content"));return a}function $1(e,t){const a=Ac(e),r=Ac(t);return{...a,...r}}let Fc;function Vn(){return Fc||(Fc=Zp("@langchain/mcp-adapters:tools")),Fc}class Bn extends Error{constructor(t){super(t),this.name="ToolException"}}function R1(e){return typeof e=="object"&&e!==null&&"name"in e&&e.name==="ToolException"}function T1(e){return typeof e=="object"&&e!==null&&e.uri!=null&&e.blob==null&&e.text==null}async function*Gp(e,t){if(T1(e)){const a=await t.readResource({uri:e.uri});for(const r of a.contents)yield*Gp(r,t);return}e.blob!=null&&(yield{type:"file",source_type:"base64",data:e.blob,mime_type:e.mimeType,...e.uri!=null?{metadata:{uri:e.uri}}:{}}),e.text!=null&&(yield{type:"file",source_type:"text",mime_type:e.mimeType,text:e.text,...e.uri!=null?{metadata:{uri:e.uri}}:{}})}async function Xp(e,t,a,r,n){const i=[];switch(e.type){case"text":return[{type:"text",...t?{source_type:"text"}:{},text:e.text}];case"image":return t?[{type:"image",source_type:"base64",data:e.data,mime_type:e.mimeType}]:[{type:"image_url",image_url:{url:`data:${e.mimeType};base64,${e.data}`}}];case"audio":return[{type:"audio",source_type:"base64",data:e.data,mime_type:e.mimeType}];case"resource":for await(const s of Gp(e.resource,a))i.push(s);return i;default:throw new Bn(`MCP tool '${r}' on server '${n}' returned a content block with unexpected type "${e.type}." Expected one of "text", "image", or "audio".`)}}async function I1(e,t,a,r,n){return t?Xp(e,t,a,r,n):!e.blob&&!e.text&&e.uri?(await a.readResource({uri:e.resource.uri})).contents.map(i=>({type:"resource",resource:{...i}})):[e]}function Yp(e,t){return t==="content"||t==="artifact"?t:Ac(t)[e]??(e==="resource"?"artifact":"content")}async function L1({serverName:e,toolName:t,result:a,client:r,useStandardContentBlocks:n,outputHandling:i}){if(!a)throw new Bn(`MCP tool '${t}' on server '${e}' returned an invalid result - tool call response was undefined`);if(!Array.isArray(a.content))throw new Bn(`MCP tool '${t}' on server '${e}' returned an invalid result - expected an array of content, but was ${typeof a.content}`);if(a.isError)throw new Bn(`MCP tool '${t}' on server '${e}' returned an error: ${a.content.map(c=>c.text).join(`
`)}`);const s=(await Promise.all(a.content.filter(c=>Yp(c.type,i)==="content").map(c=>Xp(c,n,r,t,e)))).flat(),o=(await Promise.all(a.content.filter(c=>Yp(c.type,i)==="artifact").map(c=>I1(c,n,r,t,e)))).flat();return s.length===1&&s[0].type==="text"?[s[0].text,o]:[s,o]}async function M1({serverName:e,toolName:t,client:a,args:r,config:n,useStandardContentBlocks:i,outputHandling:s}){try{Vn()(`INFO: Calling tool ${t}(${JSON.stringify(r)})`);const o={...n!=null&&n.timeout?{timeout:n.timeout}:{},...n!=null&&n.signal?{signal:n.signal}:{}},c=[{name:t,arguments:r}];Object.keys(o).length>0&&(c.push(void 0),c.push(o));const l=await a.callTool(...c);return L1({serverName:e,toolName:t,result:l,client:a,useStandardContentBlocks:i,outputHandling:s})}catch(o){throw Vn()(`Error calling tool ${t}: ${String(o)}`),R1(o)?o:new Bn(`Error calling tool ${t}: ${String(o)}`)}}const D1={throwOnLoadError:!0,prefixToolNameWithServerName:!1,additionalToolNamePrefix:"",useStandardContentBlocks:!1};async function A1(e,t,a){const{throwOnLoadError:r,prefixToolNameWithServerName:n,additionalToolNamePrefix:i,useStandardContentBlocks:s,outputHandling:o,defaultToolTimeout:c}={...D1,...a??{}},l=[];let u;do u=await t.listTools({...u!=null&&u.nextCursor?{cursor:u.nextCursor}:{}}),l.push(...u.tools||[]);while(u.nextCursor);Vn()(`INFO: Found ${l.length} MCP tools`);const p=i?`${i}__`:"",h=n?`${e}__`:"",v=`${p}${h}`;return(await Promise.all(l.filter(f=>!!f.name).map(async f=>{try{f.inputSchema.properties||(f.inputSchema.properties={});const m=new Lg({name:`${v}${f.name}`,description:f.description||"",schema:f.inputSchema,responseFormat:"content_and_artifact",metadata:{annotations:f.annotations},defaultConfig:c?{timeout:c}:void 0,func:async(g,w,E)=>M1({serverName:e,toolName:f.name,client:t,args:g,config:E,useStandardContentBlocks:s,outputHandling:o})});return Vn()(`INFO: Successfully loaded tool: ${m.name}`),m}catch(m){if(Vn()(`ERROR: Failed to load tool "${f.name}":`,m),r)throw m;return null}}))).filter(Boolean)}var F1={};let zc;function dt(){return zc||(zc=Zp("@langchain/mcp-adapters:client")),zc}class zt extends Error{constructor(t,a){super(t),Object.defineProperty(this,"serverName",{enumerable:!0,configurable:!0,writable:!0,value:a}),this.name="MCPClientError"}}function em(e){return typeof e!="object"||e===null||Array.isArray(e)?!1:"transport"in e&&e.transport==="stdio"||"type"in e&&e.type==="stdio"||"command"in e&&typeof e.command=="string"}function tm(e){if(typeof e!="object"||e===null||Array.isArray(e))return!1;if("transport"in e&&typeof e.transport=="string"&&["http","sse"].includes(e.transport)||"type"in e&&typeof e.type=="string"&&["http","sse"].includes(e.type))return!0;if("url"in e&&typeof e.url=="string")try{return new URL(e.url),!0}catch{return!1}return!1}class z1{get config(){return JSON.parse(JSON.stringify(this._config))}constructor(t){Object.defineProperty(this,"_clients",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_serverNameToTools",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_connections",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_loadToolsOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_cleanupFunctions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_transportInstances",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let a;const r=O1;if("mcpServers"in t)a=r.parse(t);else{const n=Ks(Qp).parse(t);a=r.parse({mcpServers:n})}if(Object.keys(a.mcpServers).length===0)throw new zt("No MCP servers provided");for(const[n,i]of Object.entries(a.mcpServers)){const s=$1(a.outputHandling,i.outputHandling),o=a.defaultToolTimeout??i.defaultToolTimeout;this._loadToolsOptions[n]={throwOnLoadError:a.throwOnLoadError,prefixToolNameWithServerName:a.prefixToolNameWithServerName,additionalToolNamePrefix:a.additionalToolNamePrefix,useStandardContentBlocks:a.useStandardContentBlocks,...Object.keys(s).length>0?{outputHandling:s}:{},...o?{defaultToolTimeout:o}:{}}}this._config=a,this._connections=a.mcpServers}async initializeConnections(){if(!this._connections||Object.keys(this._connections).length===0)throw new zt("No connections to initialize");const t=Array.from(Object.entries(this._connections).filter(([a])=>this._clients[a]===void 0));for(const[a,r]of t)if(dt()(`INFO: Initializing connection to server "${a}"...`),em(r))await this._initializeStdioConnection(a,r);else if(tm(r))r.type==="sse"||r.transport==="sse"?await this._initializeSSEConnection(a,r):await this._initializeStreamableHTTPConnection(a,r);else throw new zt(`Unsupported transport type for server "${a}"`,a);return this._serverNameToTools}async getTools(...t){return await this.initializeConnections(),t.length===0?this._getAllToolsAsFlatArray():this._getToolsFromServers(t)}async getClient(t){return await this.initializeConnections(),this._clients[t]}async close(){dt()("INFO: Closing all MCP connections...");for(const t of this._cleanupFunctions)try{await t()}catch(a){dt()(`ERROR: Error during cleanup: ${a}`)}this._cleanupFunctions=[],this._clients={},this._serverNameToTools={},this._transportInstances={},dt()("INFO: All MCP connections closed")}async _initializeStdioConnection(t,a){const{command:r,args:n,env:i,restart:s,stderr:o}=a;dt()(`DEBUG: Creating stdio transport for server "${t}" with command: ${r} ${n.join(" ")}`);const c=new sx({command:r,args:n,stderr:o,...i?{env:{PATH:F1.PATH,...i}}:{}});this._transportInstances[t]=c;const l=new go({name:"langchain-mcp-adapter",version:"0.1.0"});try{await l.connect(c),s!=null&&s.enabled&&this._setupStdioRestart(t,c,a,s)}catch(p){throw new zt(`Failed to connect to stdio server "${t}": ${p}`,t)}this._clients[t]=l;const u=async()=>{dt()(`DEBUG: Closing stdio transport for server "${t}"`),await c.close()};this._cleanupFunctions.push(u),await this._loadToolsForServer(t,l)}_setupStdioRestart(t,a,r,n){const i=a.onclose;a.onclose=async()=>{i&&await i(),this._clients[t]&&(dt()(`INFO: Process for server "${t}" exited, attempting to restart...`),await this._attemptReconnect(t,r,n.maxAttempts,n.delayMs))}}_getHttpErrorCode(t){const a=t;let{code:r}=a;if(r==null){const n=a.message.match(/\(HTTP (\d\d\d)\)/);n&&n.length>1&&(r=parseInt(n[1],10))}return r}_createAuthenticationErrorMessage(t,a,r,n){return`Authentication failed for ${r} server "${t}" at ${a}. Please check your credentials, authorization headers, or OAuth configuration. Original error: ${n}`}_toSSEConnectionURL(t){const a=new URL(t),r=a.pathname.split("/"),n=r.at(-1);return n&&n==="mcp"&&(r[r.length-1]="sse"),a.pathname=r.join("/"),a.toString()}async _initializeStreamableHTTPConnection(t,a){const{url:r,headers:n,reconnect:i,type:s,transport:o,authProvider:c}=a,l=a.automaticSSEFallback??!0,u=s||o;if(dt()(`DEBUG: Creating Streamable HTTP transport for server "${t}" with URL: ${r}`),u==="http"||u==null){const p=await this._createStreamableHTTPTransport(t,r,n,i,c);this._transportInstances[t]=p;const h=new go({name:"langchain-mcp-adapter",version:"0.1.0"});try{await h.connect(p),this._clients[t]=h;const v=async()=>{dt()(`DEBUG: Closing streamable HTTP transport for server "${t}"`),await p.close()};this._cleanupFunctions.push(v),await this._loadToolsForServer(t,h)}catch(v){const f=this._getHttpErrorCode(v);if(l&&f!=null&&f>=400&&f<500)try{await this._initializeSSEConnection(t,a)}catch(m){const g=this._toSSEConnectionURL(r);if(g!==r)try{await this._initializeSSEConnection(t,{...a,url:g})}catch(w){throw f===401?new zt(this._createAuthenticationErrorMessage(t,r,"HTTP",`${v}. Also tried SSE fallback at ${r} and ${g}, but both failed with authentication errors.`),t):new zt(`Failed to connect to streamable HTTP server "${t}, url: ${r}": ${v}. Additionally, tried falling back to SSE at ${r} and ${g}, but this also failed: ${w}`,t)}else throw f===401?new zt(this._createAuthenticationErrorMessage(t,r,"HTTP",`${v}. Also tried SSE fallback at ${r}, but it failed with authentication error: ${m}`),t):new zt(`Failed to connect to streamable HTTP server after trying to fall back to SSE: "${t}, url: ${r}": ${v} (SSE fallback failed with error ${m})`,t)}else throw f===401?new zt(this._createAuthenticationErrorMessage(t,r,"HTTP",`${v}`),t):new zt(`Failed to connect to streamable HTTP server "${t}, url: ${r}": ${v}`,t)}}}async _initializeSSEConnection(t,a){const{url:r,headers:n,reconnect:i,authProvider:s}=a;try{const o=await this._createSSETransport(t,r,n,s);this._transportInstances[t]=o;const c=new go({name:"langchain-mcp-adapter",version:"0.1.0"});try{await c.connect(o),i!=null&&i.enabled&&this._setupSSEReconnect(t,o,a,i)}catch(u){throw u&&u.name==="MCPClientError"?u:u&&this._getHttpErrorCode(u)===401?new zt(this._createAuthenticationErrorMessage(t,r,"SSE",`${u}`),t):new zt(`Failed to create SSE transport for server "${t}, url: ${r}": ${u}`,t)}this._clients[t]=c;const l=async()=>{dt()(`DEBUG: Closing SSE transport for server "${t}"`),await o.close()};this._cleanupFunctions.push(l),await this._loadToolsForServer(t,c)}catch(o){throw new zt(`Failed to create SSE transport for server "${t}, url: ${r}": ${o}`,t)}}async _createSSETransport(t,a,r,n){const i={};return n&&(i.authProvider=n,dt()(`DEBUG: Using OAuth authentication for SSE transport to server "${t}"`)),r&&(i.eventSourceInit={fetch:async(s,o)=>{const c=new Headers(o==null?void 0:o.headers);if(n){const l=await n.tokens();l&&c.set("Authorization",`Bearer ${l.access_token}`)}return Object.entries(r).forEach(([l,u])=>{c.set(l,u)}),c.set("Accept","text/event-stream"),fetch(s,{...o,headers:c})}},i.requestInit={headers:r},dt()(`DEBUG: Using custom headers for SSE transport to server "${t}"`)),new Ax(new URL(a),i)}async _createStreamableHTTPTransport(t,a,r,n,i){var o;const s={...i?{authProvider:i}:{},...r?{requestInit:{headers:r}}:{}};if(n!=null){const c={initialReconnectionDelay:(n==null?void 0:n.delayMs)??1e3,maxReconnectionDelay:(n==null?void 0:n.delayMs)??3e4,maxRetries:(n==null?void 0:n.maxAttempts)??2,reconnectionDelayGrowFactor:1.5};n.enabled===!1&&(c.maxRetries=0),s.reconnectionOptions=c}return(o=s.requestInit)!=null&&o.headers&&dt()(`DEBUG: Using custom headers for SSE transport to server "${t}"`),s.authProvider&&dt()(`DEBUG: Using OAuth authentication for Streamable HTTP transport to server "${t}"`),s.reconnectionOptions&&(s.reconnectionOptions.maxRetries===0?dt()(`DEBUG: Disabling reconnection for Streamable HTTP transport to server "${t}"`):dt()(`DEBUG: Using custom reconnection options for Streamable HTTP transport to server "${t}"`)),Object.keys(s).length>0?new Dp(new URL(a),s):new Dp(new URL(a))}_setupSSEReconnect(t,a,r,n){const i=a.onclose;a.onclose=async()=>{i&&await i(),this._clients[t]&&(dt()(`INFO: HTTP connection for server "${t}" closed, attempting to reconnect...`),await this._attemptReconnect(t,r,n.maxAttempts,n.delayMs))}}async _loadToolsForServer(t,a){try{dt()(`DEBUG: Loading tools for server "${t}"...`);const r=await A1(t,a,this._loadToolsOptions[t]);this._serverNameToTools[t]=r,dt()(`INFO: Successfully loaded ${r.length} tools from server "${t}"`)}catch(r){throw new zt(`Failed to load tools from server "${t}": ${r}`)}}async _attemptReconnect(t,a,r=3,n=1e3){let i=!1,s=0;for(this._cleanupServerResources(t);!i&&(r===void 0||s<r);){s+=1,dt()(`INFO: Reconnection attempt ${s}${r?`/${r}`:""} for server "${t}"`);try{n&&await new Promise(o=>{setTimeout(o,n)}),em(a)?await this._initializeStdioConnection(t,a):tm(a)&&(a.type==="sse"||a.transport==="sse"?await this._initializeSSEConnection(t,a):await this._initializeStreamableHTTPConnection(t,a)),this._clients[t]&&(i=!0,dt()(`INFO: Successfully reconnected to server "${t}"`))}catch(o){dt()(`ERROR: Failed to reconnect to server "${t}" (attempt ${s}): ${o}`)}}i||dt()(`ERROR: Failed to reconnect to server "${t}" after ${s} attempts`)}_cleanupServerResources(t){delete this._clients[t],delete this._serverNameToTools[t],delete this._transportInstances[t]}_getAllToolsAsFlatArray(){const t=[];for(const a of Object.values(this._serverNameToTools))t.push(...a);return t}_getToolsFromServers(t){const a=[];for(const r of t){const n=this._serverNameToTools[r];n&&a.push(...n)}return a}}const Zc="sse",Z1=e=>{let t=e;switch(Zc){case"sse":t=e.endsWith("/")?`${e}sse`:`${e}/sse`;break;case"stdio":t=e.endsWith("/")?`${e}`:`${e}`;break}return t.replace(/\/\//g,"/")},U1=async(e,t)=>{try{const a=await new z1({throwOnLoadError:(t==null?void 0:t.throwOnLoadError)??!0,prefixToolNameWithServerName:(t==null?void 0:t.prefixToolNameWithServerName)??!0,additionalToolNamePrefix:(t==null?void 0:t.additionalToolNamePrefix)??"mcp",mcpServers:{...e.reduce((r,n)=>(r[n.key]={transport:Zc,url:Z1(n.url),type:Zc,headers:{},useNodeEventSource:!1,reconnect:{enabled:!1,maxAttempts:5,delayMs:2e3}},r),{})}}).getTools();for(const r in a){const n=a[r],i=new Function("z",`return (${I0(n.schema)});`)(y);n.schema=i}return a}catch(a){throw a}},H1=b.memo(e=>{var p,h,v,f;const{t}=De("flows"),{id:a,data:r,isConnectable:n}=e,[i,s]=b.useState(!1),o=b.useRef(!1),c=_t(a),l=ye(m=>m.updateNodes);h0(a),b.useEffect(()=>{const m=r==null?void 0:r.entity;!m||!c||o.current||r.loaded||(o.current=!0,U1([m],{globalThrowOnLoadError:!0}).then(g=>{o.current=!1,l([{id:c.id,type:"replace",item:{...c,data:{...(c==null?void 0:c.data)||{},loaded:!0,tools:g.map(w=>({name:`${w.name}`,description:w.description||"",schema:Tg(w.schema)}))}}}])}).catch(g=>{o.current=!1,l([{id:c.id,type:"replace",item:{...c,data:{...r,loaded:!0,error:g.message}}}])}))},[r.loaded,r==null?void 0:r.entity,c,t,l,r]);const u=b.useMemo(()=>!(r!=null&&r.tools)||!r.loaded?{tools:[],total:0}:i?{tools:r.tools,total:r.tools.length}:{tools:r.tools.slice(0,5),total:r.tools.length},[r==null?void 0:r.tools,r.loaded,i]);return d.jsxs("div",{children:[d.jsxs("div",{children:[d.jsx(xt,{id:a}),d.jsxs(Ut,{className:"flex justify-center max-w-md",variant:"default",children:[d.jsx(we,{size:24,name:"tool-case"}),d.jsxs("div",{className:"ml-2 max-w-full break-words break-all",children:[d.jsx(Nr,{children:`${((p=r.entity)==null?void 0:p.key)||""}`}),d.jsxs(Ea,{children:[d.jsx(Se,{children:`${((h=r.entity)==null?void 0:h.url)||""}`}),d.jsx(Qm,{className:"my-2"}),r.error?d.jsx(Se,{className:"text-red-500",children:r.error}):void 0,(v=u==null?void 0:u.tools)!=null&&v.length?d.jsxs("div",{children:[d.jsx("ul",{className:"list-disc pl-5",children:u.tools.map((m,g)=>d.jsx("li",{children:d.jsxs(Se,{children:[m.name,": ",m.description]})},g))}),u.total>((f=u==null?void 0:u.tools)==null?void 0:f.length)?d.jsxs(tt,{onClick:()=>s(!0),className:"align-self-center mt-2",variant:"ghost",children:[d.jsx(we,{name:"chevron-down",className:"mt-1"}),t("mcp_node.view_all",{count:u.total})]}):u.total>5?d.jsxs(tt,{onClick:()=>s(!1),className:"align-self-center mt-2",variant:"ghost",children:[d.jsx(we,{name:"chevron-up",className:"mt-1"}),t("mcp_node.view_less")]}):null]}):r!=null&&r.loaded&&!(r!=null&&r.error)?d.jsx(Se,{children:t("mcp_node.no_tools")}):r!=null&&r.error?void 0:d.jsx(Se,{children:t("mcp_node.loading_tools")})]})]})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:n})]})}),q1=e=>{const t=ye(i=>i.createOrUpdateFlowEdge),{getHandleConnections:a,getNode:r}=Yt(),n=b.useCallback(async({edgeId:i,source:s,target:o})=>{try{if(![q.Prompt,q.ToolDefinition,q.MCP,q.LLM,q.Thread].includes(s==null?void 0:s.type))return{deleteEdgeId:i};if((s==null?void 0:s.type)===q.LLM&&a({type:"target",nodeId:e}).filter(c=>{var l;return c.source===s.id?!1:((l=r(c.source))==null?void 0:l.type)===q.LLM}).length>0)return{deleteEdgeId:i};await t({source:s.id,target:o.id});return}catch{return{deleteEdgeId:i}}},[t,a,r,e]);Ct(e,n)},V1=(e,t)=>{const a=_t(e),{createThread:r,loading:n}=Hl(),i=b.useCallback(async()=>{t!=null&&t.entity&&a&&await r(a)},[t==null?void 0:t.entity,a,r]);return{creatingThread:n,createThread:i}},B1=b.memo(e=>{const{id:t,isConnectable:a,data:r}=e,n=r==null?void 0:r.entity,{t:i}=De("flows"),{createThread:s,creatingThread:o}=V1(t,r);q1(t);const c=n!=null&&n.system_prompt?n.system_prompt.length>100?`${n.system_prompt.substring(0,100)}...`:n.system_prompt:"No system prompt";return d.jsxs("div",{className:"min-w-56",children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:a}),d.jsxs("div",{children:[d.jsx(xt,{id:t}),d.jsxs(Ut,{className:"max-w-72",variant:"default",children:[d.jsx(we,{size:24,name:"bot"}),d.jsxs("div",{className:"ml-2 max-w-full",children:[d.jsx(Nr,{className:"break-words",children:(n==null?void 0:n.name)||"Unnamed Agent"}),d.jsxs(Ea,{className:"space-y-2",children:[(n==null?void 0:n.description)&&d.jsx("div",{className:"text-sm text-muted-foreground break-words",children:n.description}),d.jsxs("div",{className:"text-xs text-muted-foreground break-words",children:[d.jsx("strong",{children:"System:"})," ",c]}),d.jsx("div",{className:"flex items-center gap-2",children:d.jsxs(aa,{variant:"secondary",className:"text-xs",children:["Max: ",(n==null?void 0:n.max_iterations)||10," iterations"]})})]}),d.jsx("div",{className:"mt-4",children:d.jsxs(er,{loading:o,onClick:s,className:"w-full",size:"sm",children:[d.jsx(we,{size:16,name:"message-square-plus",className:"mr-2"}),i("basic_agent_node.create_thread_button")]})})]})]})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,id:"a",isConnectable:a})]})}),Qs=b.memo(e=>{const{lineClassName:t,handleClassName:a,...r}=e;return d.jsx(mE,{lineClassName:Ve("!border-1.5",t),handleClassName:Ve("!w-2 !h-2 !border-2 !rounded-full",a),...r})}),W1=e=>{const t=ye(r=>r.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:r,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===q.LLM&&(i==null?void 0:i.type)===q.EditorApp){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},K1=e=>{const t=_t(e),{t:a}=De("flows"),r=b.useRef(null),{toast:n}=It(),{getNode:i,getHandleConnections:s}=Yt(),{confirmPassphrase:o}=Sa(),c=b.useCallback(async p=>{t&&(clearTimeout(r.current),r.current=setTimeout(async()=>{await me("FlowNode").update(t.id,{data:p})},150))},[t]),l=b.useCallback(async(p,h)=>{var v,f;if(t){const m=s({nodeId:e,type:"target"}).find(E=>{var O;return((O=i(E.source))==null?void 0:O.type)===q.LLM}),g=m?i(m==null?void 0:m.source):void 0,w=(v=g==null?void 0:g.data)==null?void 0:v.entity;if(!g||!w)return n({variant:"destructive",description:a("editor_node.errors.llm_not_found")});if(g.data.status!==kt.Loaded)return n({variant:"destructive",description:a("editor_node.errors.llm_not_loaded_yet")});try{return await o(),(f=await gi.stream(w.provider,typeof p=="string"?[new sa(p)]:p,{onMessageUpdate:E=>{h==null||h(E.content)},llm:w}))==null?void 0:f.content}catch(E){if(E instanceof Error&&E.message.includes("LLM_NOT_LOADED_YET"))return n({title:a("editor_node.errors.llm_not_loaded_yet")});n({variant:"destructive",title:a("editor_node.errors.stream_message_failed")})}}},[t,s,e,i,n,a]),u=b.useCallback(p=>{if(!i(p))return[];const h=[];return s({nodeId:p,type:"target"}).forEach(v=>{const f=i(v.source);!f||f.type!==q.LLM||h.push({node:f,connections:[v]})}),h},[s,i]);return{createMessage:l,updateEditorContent:c,getLinkedConnections:u}},J1=b.lazy(()=>Lt(()=>import("./index-syQpUPxj.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([12,2,3]))),Q1=b.memo(e=>{var l;const{id:t,data:a,selected:r,isConnectable:n}=e;W1(t);const{createMessage:i,updateEditorContent:s,getLinkedConnections:o}=K1(t),c=b.useCallback(u=>{s(u)},[s]);return d.jsxs("div",{className:"w-full min-w-[1240px] h-full",children:[d.jsx(Qs,{isVisible:!!r,minWidth:1240,minHeight:400}),d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:n}),d.jsxs("div",{className:"min-w-10 min-h-10 w-full h-full rounded-lg border bg-background",children:[d.jsx(xt,{className:"!z-[100]",id:t,enableToStandalone:!0,getLinkedConnections:o}),d.jsx(b.Suspense,{fallback:d.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:d.jsx(we,{name:"loader-circle",className:"animate-spin"})}),children:d.jsx("div",{className:"h-full w-ful rounded-lg","data-registry":"plate",children:d.jsx(J1,{defaultValue:(l=a==null?void 0:a.flowNode)==null?void 0:l.data,onValueChange:c,copilotStream:i})})})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,isConnectable:n})]})}),G1=["empty-source","vite-vue","shadcn-react-vite","todo-app-react-vite","porfolio-nextjs"],X1=async e=>{switch(e){case"empty-source":return Lt(()=>import("./empty-source-Dw1dvL8s.js"),[]).then(t=>t.BASE);case"vite-vue":return Lt(()=>import("./vite-vue-Bmz2z3Fo.js"),[]).then(t=>t.BASE);case"shadcn-react-vite":return Lt(()=>import("./shadcn-react-vite-CDJ9BaE9.js"),[]).then(t=>t.BASE);case"todo-app-react-vite":return Lt(()=>import("./todo-app-react-vite-BBWBkRjR.js"),[]).then(t=>t.BASE);case"porfolio-nextjs":return Lt(()=>import("./porfolio-nextjs-DCkli5iW.js"),[]).then(t=>t.BASE);default:throw new Error(`Unknown source base: ${e}`)}},Y1=b.memo(({className:e,onUpdateSourceBase:t})=>{const{t:a}=De("components"),[r,n]=b.useState();return d.jsxs(st,{className:Ve("mw-full",e),children:[d.jsx(Et,{className:"p-4",children:d.jsx(Pt,{children:a("add_source_base.title")})}),d.jsx(St,{className:"p-4",children:d.jsxs("div",{className:"flex items-center justify-center w-full h-full flex-col",children:[d.jsxs(jr,{onValueChange:i=>n(i),children:[d.jsx(Er,{className:"w-full mb-4",children:d.jsx(Sr,{placeholder:a("add_source_base.source_base_select_placeholder")})}),d.jsx(kr,{children:G1.map(i=>d.jsx(Nt,{value:`${i}`,children:a(`add_source_base.sourcebases.${i.toLowerCase()}`)},`${i}`))})]}),d.jsx(tt,{className:"w-full",onClick:async()=>r&&t(await X1(r)),children:a("add_source_base.update_source")})]})})]})}),ej=()=>{const{getNode:e,getHandleConnections:t}=Yt(),{confirmPassphrase:a}=Sa(),r=b.useCallback(async(i,s)=>{await me("FlowNode").update(i,{raw:$S(s)})},[]),n=b.useCallback(i=>{if(!e(i))return[];const s=[];return t({nodeId:i,type:"target"}).forEach(o=>{const c=e(o.source);!c||c.type!==q.LLM||s.push({node:c,connections:[o]})}),s},[t,e]);return{sendMessage:b.useCallback(async(i,s,{onMessageUpdate:o,onResponseMessageCreate:c}={})=>{const l=s.map(p=>p.role==="system"?new ts(p.content):p.role==="user"?new sa(p.content):new mi(p.content));c==null||c(),await a();const u=await gi.stream(Le.WebLLM,[...l,new sa(i)],{onMessageUpdate:({content:p})=>{o==null||o({nodeData:{loading:!0,content:p}})},llm:void 0});return o==null||o({nodeData:{loading:!1,content:u==null?void 0:u.content}}),u==null?void 0:u.content},[]),getLinkedConnections:n,updateCodeContainerData:r}},tj=e=>{const t=ye(r=>r.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:r,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===q.LLM&&(i==null?void 0:i.type)===q.VSLiteApp){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},rj=b.lazy(()=>Lt(()=>import("./index-D3ruEZVV.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([13,2,3,4,8,14,15,6,16,17,18,19,20]))),aj=b.memo(e=>{var h,v,f,m;const{id:t,isConnectable:a,data:r}=e,[n,i]=b.useState((h=r==null?void 0:r.flowNode)!=null&&h.raw?RS(r.flowNode.raw):void 0),{updateCodeContainerData:s,getLinkedConnections:o,sendMessage:c}=ej();tj(t);const l=b.useCallback(async g=>{var w,E;(w=r==null?void 0:r.flowNode)!=null&&w.id&&(await s((E=r==null?void 0:r.flowNode)==null?void 0:E.id,g),i(g))},[(v=r==null?void 0:r.flowNode)==null?void 0:v.id,s]),u=b.useCallback(async(g,w)=>{var E;return(E=r==null?void 0:r.flowNode)!=null&&E.id?await c(g,w):void 0},[(f=r==null?void 0:r.flowNode)==null?void 0:f.id,c]),p=b.useCallback(async g=>{i(w=>{var O;const E=TS(w||{},g);return s((O=r==null?void 0:r.flowNode)==null?void 0:O.id,E),E})},[(m=r==null?void 0:r.flowNode)==null?void 0:m.id,s]);return n?d.jsxs("div",{className:"w-[1380px] h-[600px] rounded-lg border overflow-hidden shadow-sm",children:[d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:a}),d.jsxs("div",{className:"w-full h-full rounded-lg border bg-card overflow-hidden",children:[d.jsx(xt,{id:t,className:"z-50",enableToStandalone:!0,getLinkedConnections:o}),d.jsx(b.Suspense,{fallback:d.jsx("div",{className:"h-full w-full flex justify-center items-center",children:d.jsx(we,{name:"loader-circle",className:"animate-spin"})}),children:d.jsx(rj,{fileSystemTree:n,onUpdateFileContent:p,sendMessage:u})})]}),d.jsx(Je,{type:"source",position:Ke.Bottom,isConnectable:a})]}):d.jsx("div",{className:"h-full flex justify-center items-center",children:d.jsx(Y1,{className:"w-64",onUpdateSourceBase:l})})}),nj=e=>{const t=ye(r=>r.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:r,source:n,target:i,connection:s})=>{try{if([q.CircleShape,q.TriangleShape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===q.Shape){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},sj=b.memo(e=>{const{id:t,selected:a,isConnectable:r}=e;return nj(t),d.jsxs(d.Fragment,{children:[d.jsx(Qs,{isVisible:!!a,minWidth:40,minHeight:40}),d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border border",children:d.jsx(xt,{id:t})}),d.jsx(Je,{type:"source",position:Ke.Bottom,isConnectable:r})]})}),ij=e=>{const t=ye(r=>r.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:r,source:n,target:i,connection:s})=>{try{if([q.Shape,q.TriangleShape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===q.CircleShape){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},oj=b.memo(e=>{const{id:t,selected:a,isConnectable:r}=e;return ij(t),d.jsxs(d.Fragment,{children:[d.jsx(Qs,{isVisible:!!a,minWidth:40,minHeight:40}),d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:r}),d.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border rounded-full border",children:d.jsx(xt,{id:t})}),d.jsx(Je,{type:"source",position:Ke.Bottom,isConnectable:r})]})}),cj=e=>{const t=ye(r=>r.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:r,source:n,target:i,connection:s})=>{try{if([q.CircleShape,q.Shape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===q.TriangleShape){await t({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);Ct(e,a)},dj=b.memo(e=>{const{id:t,selected:a,width:r,height:n,isConnectable:i}=e;return cj(t),d.jsxs(d.Fragment,{children:[d.jsx(Qs,{isVisible:!!a,minWidth:40,minHeight:40}),d.jsx(Je,{type:"target",position:Ke.Top,isConnectable:i}),d.jsx("div",{className:"w-0 h-0 border-l-transparent border-r-transparent border-b-border",style:{borderLeftWidth:(r||0)/2,borderRightWidth:(r||0)/2,borderBottomWidth:n||0}}),d.jsx(xt,{id:t,className:"absolute top-0 right-0"}),d.jsx(Je,{type:"source",position:Ke.Bottom,isConnectable:i})]})}),lj={[q.LLM]:V_,[q.Toolbox]:g_,[q.Thread]:D_,[q.Message]:U_,[q.Prompt]:W_,[q.SessionInfo]:k_,[q.Schema]:J_,[q.CSVData]:Y_,[q.ToolDefinition]:X_,[q.DefaultEmbeddingModel]:S_,[q.VectorDatabase]:o0,[q.JSONLData]:d0,[q.ApplicationBar]:w_,[q.Shape]:sj,[q.CircleShape]:oj,[q.TriangleShape]:dj,[q.EditorApp]:Q1,[q.PlaceHolder]:u0,[q.VSLiteApp]:aj,[q.MCP]:H1,[q.BasicAgent]:B1},rm=Cm("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),uj=b.forwardRef(({className:e,variant:t,size:a,...r},n)=>d.jsx(nf,{ref:n,className:Ve(rm({variant:t,size:a,className:e})),...r}));uj.displayName=nf.displayName;const am=b.createContext({size:"default",variant:"default"}),nm=b.forwardRef(({className:e,variant:t,size:a,children:r,...n},i)=>d.jsx(sf,{ref:i,className:Ve("flex items-center justify-center gap-1",e),...n,children:d.jsx(am.Provider,{value:{variant:t,size:a},children:r})}));nm.displayName=sf.displayName;const sm=b.forwardRef(({className:e,children:t,variant:a,size:r,...n},i)=>{const s=b.useContext(am);return d.jsx(of,{ref:i,className:Ve(rm({variant:s.variant||a,size:s.size||r}),e),...n,children:t})});sm.displayName=of.displayName;function hj(){const e=fE(t=>`x: ${t.transform[0].toFixed(2)}, y: ${t.transform[1].toFixed(2)}, zoom: ${t.transform[2].toFixed(2)}`);return d.jsx("div",{children:e})}function pj({change:e}){var r,n,i,s;const t="id"in e?e.id:"-",{type:a}=e;return d.jsxs("div",{className:"mb-3",children:[d.jsxs("div",{children:["node id: ",t]}),d.jsxs("div",{children:[a==="add"?JSON.stringify(e.item,null,2):null,a==="dimensions"?`dimensions: ${(r=e.dimensions)==null?void 0:r.width} \xD7 ${(n=e.dimensions)==null?void 0:n.height}`:null,a==="position"?`position: ${(i=e.position)==null?void 0:i.x.toFixed(1)}, ${(s=e.position)==null?void 0:s.y.toFixed(1)}`:null,a==="remove"?"remove":null,a==="select"?e.selected?"select":"unselect":null]})]})}function mj({limit:e=20}){const[t,a]=b.useState([]),r=vE(),n=b.useCallback(s=>{a(o=>[...s,...o].slice(0,e))},[e]);b.useEffect(()=>(r.setState({onNodesChange:n}),()=>r.setState({onNodesChange:void 0})),[n,r]);const i=()=>d.jsx("div",{children:"No Changes Triggered"});return d.jsx(d.Fragment,{children:t.length===0?d.jsx(i,{}):t.map((s,o)=>d.jsx(pj,{change:s},o))})}function fj(){const{getInternalNode:e}=Yt(),t=Lm();return d.jsx(gE,{children:d.jsx("div",{className:"text-secondary-foreground",children:t.map(a=>{var i,s;const r=e(a.id);if(!r)return null;const n=r==null?void 0:r.internals.positionAbsolute;return d.jsx(vj,{id:a.id,selected:!!a.selected,type:a.type||"default",position:a.position,absPosition:n,width:((i=a.measured)==null?void 0:i.width)??0,height:((s=a.measured)==null?void 0:s.height)??0,data:a.data},a.id)})})})}function vj({id:e,type:t,selected:a,position:r,absPosition:n,width:i,height:s,data:o}){if(!i||!s)return null;const c=`translate(${n.x}px, ${n.y+s}px)`,l=`${r.x.toFixed(1)}, ${r.y.toFixed(1)}`,u=`${i} \xD7 ${s}`,p=a?"Selected":"Not Selected";return d.jsxs("div",{style:{position:"absolute",transform:c,width:i*2},className:"text-xs",children:[d.jsxs("div",{children:["id: ",e]}),d.jsxs("div",{children:["type: ",t]}),d.jsxs("div",{children:["selected: ",p]}),d.jsxs("div",{children:["position: ",l]}),d.jsxs("div",{children:["dimensions: ",u]}),d.jsxs("div",{children:["data: ",JSON.stringify(o,null,2)]})]})}function gj({tools:e}){return d.jsx(Gc,{position:"top-left",className:"bg-card p-1 border rounded shadow-sm",children:d.jsx(nm,{type:"multiple",children:e.map(({active:t,setActive:a,label:r,value:n})=>d.jsx(sm,{value:n,onClick:()=>a(i=>!i),"aria-pressed":t,className:"bg-card text-card-foreground transition-colors duration-300 hover:bg-secondary hover:text-secondary-foreground",children:r},n))})})}function im(){const[e,t]=b.useState(!1),[a,r]=b.useState(!1),[n,i]=b.useState(!1),s=[{active:e,setActive:t,label:"Node Inspector",value:"node-inspector"},{active:a,setActive:r,label:"Change Logger",value:"change-logger"},{active:n,setActive:i,label:"Viewport Logger",value:"viewport-logger"}];return d.jsxs(d.Fragment,{children:[d.jsx(gj,{tools:s}),a&&d.jsx(Gc,{className:"text-xs p-5 bg-white rounded shadow-md overflow-y-auto max-h-[50%] mt-20",position:"bottom-right",children:d.jsx(mj,{})}),e&&d.jsx(fj,{}),n&&d.jsx(Gc,{position:"bottom-left",className:"text-secondary-foreground",children:d.jsx(hj,{})})]})}im.displayName="DevTools";let om,cm,dm,lm;om=()=>{const e=b.useRef({}),t=b.useRef({}),a=b.useRef([]),r=ye(R=>R.flowEdges),n=ut(R=>R.currentSession),i=ye(R=>R.setNodes),s=ye(R=>R.updateNodes),o=ye(R=>R.updateEdges),c=ye(R=>R.addConnectionToEdges),l=ye(R=>R.reset),u=ye(R=>R.findFlowEdges),p=ye(R=>R.deleteFlowNode),h=ye(R=>R.deleteFlowEdge),v=ye(R=>R.updateFlowNode),f=ye(R=>R.getNodes),m=ye(R=>R.findFlowNodesWithSource),g=b.useRef(r),w=b.useRef(),[E,O]=b.useState({loading:!1});g.current=r;const x=b.useCallback(async(R,z)=>{try{w.current=R,l(),await(z==null?void 0:z())}catch{w.current=void 0}},[l]),k=b.useCallback(async R=>{try{if(!(n!=null&&n.id))return;O(U=>({...U,loading:!0}));const z=await m({...R,where:{...R.where,session_id:n.id}}),F=await u({where:[{source:ad(z.map(U=>U.id))},{target:ad(z.map(U=>U.id))}]});return{flowNodes:z,flowEdges:F}}finally{O(z=>({...z,loading:!1}))}},[m,u,n==null?void 0:n.id]),$=b.useCallback(async R=>{var z,F;for(const U of a.current){const V=await U(R);if(typeof V=="boolean"&&!V)return}for(const U of R)if("id"in U&&Object.values(oi).includes(U.id)&&U.type!=="remove")s([U]);else if(U.type==="position"&&U.position&&!isNaN(U.position.x)&&!isNaN(U.position.y)){s([U]);const V=U.position.x,re=U.position.y;clearTimeout(e.current[U.id]),e.current[U.id]=setTimeout(async()=>{e.current[U.id]=void 0,await v({id:U.id,x:V,y:re},{silent:!0})},200)}else if(U.type==="remove"){const V=(z=f([U.id]))==null?void 0:z[0];if(!(V!=null&&V.type)||yE.includes(V.type))return;await p({id:U.id})}else if(U.type==="dimensions"&&U.dimensions&&!isNaN(U.dimensions.width)&&!isNaN(U.dimensions.height)){const V=(F=f([U.id]))==null?void 0:F[0];if(!(V!=null&&V.width)&&!(V!=null&&V.height))return;s([U]),clearTimeout(t.current[U.id]);const re=U.dimensions.width,Q=U.dimensions.height;t.current[U.id]=setTimeout(async()=>{await v({id:U.id,width:re,height:Q},{silent:!0})},200)}else U.type==="select"&&s([U])},[s,v,f,p]),N=b.useCallback(R=>{Promise.all(R.map(async z=>{if(z.type==="remove")return h({id:z.id})})),o(R)},[h,o]),M=b.useCallback(R=>{c(R)},[c]),A=b.useCallback(R=>{i(z=>{var re,Q;let F;if(typeof R=="function"?F=R(z):F=R,!F)return z;const U=z==null?void 0:z.find(oe=>oe.id===F.id),V={id:F.id,item:U?_E(U,F):{...F,position:{x:((re=F.position)==null?void 0:re.x)||0,y:((Q=F.position)==null?void 0:Q.y)||0}},type:U?"replace":"add"};return bE([V],z)})},[i]),I=b.useCallback(R=>(a.current.push(R),()=>{a.current=a.current.filter(z=>z!==R)}),[]);return{initFlow:x,loadingState:E,prepareFlowInfo:k,updateNodeChanges:$,updateEdgeChanges:N,updateOrCreateNode:A,currentSessionIdRef:w,updateEdgeConnection:M,addOnNodeChangeHandler:I}},cm=e=>{const t=ut(p=>{var h;return(h=p.currentSession)==null?void 0:h.id}),{loadingState:a,prepareFlowInfo:r,initFlow:n,currentSessionIdRef:i}=e,s=ye(p=>p.ready),o=ye(p=>p.nodes),c=b.useRef(o),l=ye(p=>p.removeSyncNodeQueue),u=ye(p=>p.removeSyncEdgeQueue);c.current=o,b.useEffect(()=>{a.loading||!s||!t||i.current===t||n(t,async()=>{await r({where:{session_id:t}})})},[n,r,a.loading,i,s,t]),b.useEffect(()=>{const p=ye.subscribe(v=>v.syncNodeQueue,async(v,f)=>{const m=f.map(w=>w.timestamp),g=v.filter(w=>!m.includes(w.timestamp));g.length&&l(g.map(w=>w.timestamp))}),h=ye.subscribe(v=>v.syncEdgeQueue,async(v,f)=>{const m=f.map(w=>w.timestamp),g=v.filter(w=>!m.includes(w.timestamp));g.length&&u(g.map(w=>w.timestamp))});return()=>{p(),h()}},[r,u,l])},dm=()=>{const[e,t]=b.useState(!0),a=om(),r=Gn(u=>u.selectedModel),n=b.useRef(r),i=Gn(u=>u.setInitProgressCallback),{updateOrCreateNode:s,updateNodeChanges:o,updateEdgeChanges:c,updateEdgeConnection:l}=a;return cm(a),n.current=r,b.useEffect(()=>{const u=i==null?void 0:i(p=>{if(!n.current)return;const h=`${n.current}`;s(v=>{const f=v==null?void 0:v.find(m=>{var g;return(g=m.data)!=null&&g.entity&&typeof m.data.entity=="object"&&"name"in m.data.entity?m.data.entity.name===h:!1});if(f)return f.data.label=p.text,f.data.status=kt.Loading,p.progress===100&&(f.data.label="",f.data.status=kt.Loaded),f})});return()=>{u==null||u()}},[i,s]),b.useMemo(()=>({updateNodeChanges:o,updateEdgeChanges:c,initializing:e,setInitializing:t,updateEdgeConnection:l}),[o,c,e,t,l])},lm=()=>{const e=Sm(l=>l.theme),t=ye(l=>l.nodes),a=ye(l=>l.edges),{updateNodeChanges:r,updateEdgeChanges:n,updateEdgeConnection:i}=dm(),s=b.useCallback(l=>{r(l)},[r]),o=b.useCallback(l=>{n(l)},[n]),c=b.useCallback(l=>{i(l)},[i]);return d.jsxs(wE,{nodes:t,edges:a,nodeTypes:lj,onNodesChange:s,onEdgesChange:o,onConnect:c,panOnScroll:!0,panOnScrollMode:xE.Free,colorMode:e,fitView:!0,children:[d.jsx(jE,{variant:EE.Dots,gap:24,size:1}),d.jsx(SE,{}),d.jsx(kE,{}),Bj?d.jsx(im,{}):void 0]})},cf=b.memo(lm)});export{LS as __tla,cf as default};
