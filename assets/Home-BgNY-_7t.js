const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DCNC3sQs.js","assets/LLMIcon-DTzLaIG1.js","assets/index-DWQzdqsc.js","assets/index-Vcso_2OS.css","assets/routes-Bmso1xvj.js","assets/dot-CWbyRG3b.js","assets/createLucideIcon-ByB7ruez.js","assets/CodeEditor-Bbk9oTWl.js","assets/index-DxpaLr3Y.js","assets/file-tree-DH9c22tu.js","assets/pdf.min-86084oMr.js","assets/pdf.worker.min-ClXYzjno.js","assets/index-D_z_KQyS.js","assets/index-BTHjChhh.js","assets/index-DnF6nb4_.js","assets/chevron-right-RV_U_CF1.js","assets/check-DITHWRNn.js","assets/circle-DnbEUkhh.js","assets/popover-Qa2ZleT0.js","assets/index-BtRrMOaN.js","assets/index-HSnfLTSA.css"])))=>i.map(i=>d[i]);
var Jw=Object.defineProperty;var Kw=(cr,Bt,Xr)=>Bt in cr?Jw(cr,Bt,{enumerable:!0,configurable:!0,writable:!0,value:Xr}):cr[Bt]=Xr;var Nt=(cr,Bt,Xr)=>Kw(cr,typeof Bt!="symbol"?Bt+"":Bt,Xr);import{m as qn,r as w,M as Ch,Y as Xw,p as $h,Z as Yw,$ as Oh,a0 as Th,a1 as eb,a2 as tb,a3 as rb,a4 as bo,J as ab,a as nb,h as sb,j as c,P as er,u as ib,b as fr,c as Fe,L as ve,T as ob,a5 as lb,U as cb,v as Vn,w as Nr,e as Oe,f as xt,a6 as Cr,_ as jt,a7 as Wr,I as tr,R as Qa,d as Ih,a8 as db,s as Lh,l as Ah,a9 as ub,X as hb,z as Rh,g as xo,G as Zr,B as Fh,aa as jo,ab as So,ac as Dh,ad as pb,__tla as mb}from"./index-DWQzdqsc.js";import{k as fb,l as vb,u as lt,R as Mh,L as Bn,A as Ct,m as gb,C as Ge,n as pt,o as gt,p as mt,S as rr,q as ar,s as nr,t as sr,v as yt,w as $r,x as yb,y as _b,z as wb,E as bb,G as zh,H as Uh,J as Wn,K as Eo,N as Hh,O as ko,d as Zn,Q as xb,h as ir,T as or,M as ja,U as jb,X as Me,Y as Mt,Z as Gn,_ as Sb,$ as qh,a0 as Qn,F as Sa,a1 as lr,a2 as Eb,j as Or,e as Gr,P as kb,a3 as Vh,a4 as Bh,a5 as Qr,a6 as Wh,i as Pb,a7 as Nb,g as Po,D as No,a as Zh,W as Cb,I as $b,b as Ob,V as Tb,a8 as Ib,a9 as Co,aa as Lb,ab as Ab,ac as Rb,ad as Fb,ae as Db,af as Mb,ag as zb,ah as Ub,ai as Hb,aj as qb,ak as Vb,al as Bb,__tla as Wb}from"./chunk-0NskZGly.js";import{aF as Zb,aG as $o,aH as Gb,aI as Qb,aJ as Gh,aK as Jb,aL as Kb,aM as Qh,aN as Xb,aO as Jh,aP as Yb,l as Kh,m as ex,n as tx,I as rx,aQ as ax,aR as nx,aS as sx,aT as ix,aU as ox,aV as lx,aW as cx,aX as dx,aY as ux,aZ as hx,a_ as px,a$ as mx,b0 as fx,ab as vr,b1 as vx,b2 as gx,u as et,g as ue,F as V,R as yx,P as _x,O as wx,C as bx,r as Jn,s as Kn,t as Xn,v as Yn,b3 as Xh,b4 as Yh,B as Ve,al as es,b5 as Ja,am as we,an as nt,L as zt,b6 as ts,b7 as xx,b8 as jx,V as Tr,b9 as ep,ba as Sx,bb as Ka,bc as Xa,bd as Ya,e as Ex,f as tp,h as rp,i as ap,az as np,ae as kx,aB as Px,be as Nx,aC as Cx,bf as $x,aD as Ox,N as sp,H as Ir,S as en,bg as ip,A as rs,bh as Oo,q as To,bi as Io,o as op,ad as gr,p as Ne,bj as as,__tla as Tx}from"./routes-Bmso1xvj.js";import{i as Lo,B as Ix,j as Ce,L as ft,k as ns,m as Lx,n as lp,o as Ea,q as Ax,r as Rx,s as cp,b as Fx,u as Jr,c as yr,t as Dx,h as Mx,l as Ao,a as zx,I as Ro,v as Ux,d as Hx,z as y,x as ka,y as qx,__tla as Vx}from"./LLMIcon-DTzLaIG1.js";import{P as ss,b as is,T as Kr,a as Bx,A as Wx,__tla as Zx}from"./popover-Qa2ZleT0.js";import{a as Fo,__tla as Gx}from"./index-BtRrMOaN.js";import{s as Qx}from"./toNumber-Ca8lpn2y.js";import{R as dp,I as Jx,S as up,r as Do,a as hp,b as pp,c as mp,__tla as Kx}from"./index-ZqEu-5w_.js";import{p as Xx,S as Yx}from"./plate-editor-ArT3MpUu.js";import{p as e1,a as t1,u as r1,__tla as a1}from"./file-tree-DH9c22tu.js";import"./dot-CWbyRG3b.js";import"./createLucideIcon-ByB7ruez.js";let fp,n1=Promise.all([(()=>{try{return mb}catch{}})(),(()=>{try{return Wb}catch{}})(),(()=>{try{return Tx}catch{}})(),(()=>{try{return Vx}catch{}})(),(()=>{try{return Zx}catch{}})(),(()=>{try{return Gx}catch{}})(),(()=>{try{return Kx}catch{}})(),(()=>{try{return a1}catch{}})()]).then(async()=>{function cr(e){const r=qn(()=>Xw(e)),{isStatic:a}=w.useContext(Ch);if(a){const[,t]=w.useState(e);w.useEffect(()=>r.on("change",t),[])}return r}function Bt(e,r){const a=cr(r()),t=()=>a.set(r());return t(),$h(()=>{const n=()=>Oh.preRender(t,!1,!0),i=e.map(s=>s.on("change",n));return()=>{i.forEach(s=>s()),Yw(t)}}),a}function Xr(e,r={}){const{isStatic:a}=w.useContext(Ch),t=w.useRef(null),n=qn(()=>Th(e)?e.get():e),i=qn(()=>typeof n=="string"?n.replace(/[\d.-]/g,""):void 0),s=cr(n),o=w.useRef(n),l=w.useRef(eb),d=()=>{u(),t.current=tb({keyframes:[zo(s.get()),zo(o.current)],velocity:s.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...r,onUpdate:l.current})},u=()=>{t.current&&t.current.stop()};return w.useInsertionEffect(()=>s.attach((p,h)=>a?h(p):(o.current=p,l.current=v=>h(Mo(v,i)),Oh.postRender(d),s.get()),u),[JSON.stringify(r)]),$h(()=>{if(Th(e))return e.on("change",p=>s.set(Mo(p,i)))},[s,i]),s}function Mo(e,r){return r?e+r:e}function zo(e){return typeof e=="number"?e:parseFloat(e)}const vp=e=>e&&typeof e=="object"&&e.mix,gp=e=>vp(e)?e.mix:void 0;function yp(...e){const r=!Array.isArray(e[0]),a=r?0:-1,t=e[0+a],n=e[1+a],i=e[2+a],s=e[3+a],o=rb(n,i,{mixer:gp(i[0]),...s});return r?o(t):o}function _p(e){bo.current=[],e();const r=Bt(bo.current,e);return bo.current=void 0,r}function Uo(e,r,a,t){if(typeof e=="function")return _p(e);const n=typeof r=="function"?r:yp(r,a,t);return Array.isArray(e)?Ho(e,n):Ho([e],([i])=>n(i))}function Ho(e,r){const a=qn(()=>[]);return Bt(e,()=>{a.length=0;const t=e.length;for(let n=0;n<t;n++)a[n]=e[n].get();return r(a)})}var $t=(e=>(e.Started="started",e.Inprogress="inprogress",e.Success="success",e.Failed="failed",e))($t||{}),Ot=(e=>(e.Human="human",e.User="user",e.AI="ai",e.System="system",e.Assistant="assistant",e.Tool="tool",e.FewShotExample="few_shot_example",e))(Ot||{}),tn=(e=>(e.Started="started",e.Inprogress="inprogress",e.Done="done",e))(tn||{}),Tt=(e=>(e.Chat="chat",e.FewShotExample="few_shot_example",e))(Tt||{});function Ut(e){return encodeURI(wp(e))}function wp(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}const bp={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},xp={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},jp={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let Sp=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function Pa(e,r=Object.create(null),a=Sp,t=""){if(e&&typeof e=="object"&&!Array.isArray(e)){const i=e.$id||e.id;if(i){const s=new URL(i,a.href);s.hash.length>1?r[s.href]=e:(s.hash="",t===""?a=s:Pa(e,r,a))}}else if(e!==!0&&e!==!1)return r;const n=a.href+(t?"#"+t:"");if(r[n]!==void 0)throw new Error(`Duplicate schema URI "${n}".`);if(r[n]=e,e===!0||e===!1)return r;if(e.__absolute_uri__===void 0&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:n}),e.$ref&&e.__absolute_ref__===void 0){const i=new URL(e.$ref,a.href);i.hash=i.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:i.href})}if(e.$recursiveRef&&e.__absolute_recursive_ref__===void 0){const i=new URL(e.$recursiveRef,a.href);i.hash=i.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(e.$anchor){const i=new URL("#"+e.$anchor,a.href);r[i.href]=e}for(let i in e){if(jp[i])continue;const s=`${t}/${Ut(i)}`,o=e[i];if(Array.isArray(o)){if(bp[i]){const l=o.length;for(let d=0;d<l;d++)Pa(o[d],r,a,`${s}/${d}`)}}else if(xp[i])for(let l in o)Pa(o[l],r,a,`${s}/${Ut(l)}`);else Pa(o,r,a,s)}return r}const Ep=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,kp=[0,31,28,31,30,31,30,31,31,30,31,30,31],Pp=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Np=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Cp=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,$p=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Op=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Tp=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,Ip=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Lp=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Ap=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,Rp=e=>{if(e[0]==='"')return!1;const[r,a,...t]=e.split("@");return!r||!a||t.length!==0||r.length>64||a.length>253||r[0]==="."||r.endsWith(".")||r.includes("..")||!/^[a-z0-9.-]+$/i.test(a)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(r)?!1:a.split(".").every(n=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(n))},Fp=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Dp=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,Mp=e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e));function Wt(e){return e.test.bind(e)}const qo={date:Vo,time:Bo.bind(void 0,!1),"date-time":Hp,duration:Mp,uri:Bp,"uri-reference":Wt(Cp),"uri-template":Wt($p),url:Wt(Op),email:Rp,hostname:Wt(Np),ipv4:Wt(Fp),ipv6:Wt(Dp),regex:Zp,uuid:Wt(Tp),"json-pointer":Wt(Ip),"json-pointer-uri-fragment":Wt(Lp),"relative-json-pointer":Wt(Ap)};function zp(e){return e%4===0&&(e%100!==0||e%400===0)}function Vo(e){const r=e.match(Ep);if(!r)return!1;const a=+r[1],t=+r[2],n=+r[3];return t>=1&&t<=12&&n>=1&&n<=(t==2&&zp(a)?29:kp[t])}function Bo(e,r){const a=r.match(Pp);if(!a)return!1;const t=+a[1],n=+a[2],i=+a[3],s=!!a[5];return(t<=23&&n<=59&&i<=59||t==23&&n==59&&i==60)&&(!e||s)}const Up=/t|\s/i;function Hp(e){const r=e.split(Up);return r.length==2&&Vo(r[0])&&Bo(!0,r[1])}const qp=/\/|:/,Vp=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Bp(e){return qp.test(e)&&Vp.test(e)}const Wp=/[^\\]\\Z/;function Zp(e){if(Wp.test(e))return!1;try{return new RegExp(e,"u"),!0}catch{return!1}}function Gp(e){let r=0,a=e.length,t=0,n;for(;t<a;)r++,n=e.charCodeAt(t++),n>=55296&&n<=56319&&t<a&&(n=e.charCodeAt(t),(n&64512)==56320&&t++);return r}function Ke(e,r,a="2019-09",t=Pa(r),n=!0,i=null,s="#",o="#",l=Object.create(null)){if(r===!0)return{valid:!0,errors:[]};if(r===!1)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};const d=typeof e;let u;switch(d){case"boolean":case"number":case"string":u=d;break;case"object":e===null?u="null":Array.isArray(e)?u="array":u="object";break;default:throw new Error(`Instances of "${d}" type are not supported.`)}const{$ref:p,$recursiveRef:h,$recursiveAnchor:v,type:f,const:m,enum:g,required:b,not:S,anyOf:O,allOf:x,oneOf:E,if:$,then:C,else:R,format:D,properties:L,patternProperties:T,additionalProperties:z,unevaluatedProperties:M,minProperties:H,maxProperties:B,propertyNames:ee,dependentRequired:J,dependentSchemas:se,dependencies:ie,prefixItems:ke,items:Ie,additionalItems:G,unevaluatedItems:te,contains:ge,minContains:re,maxContains:_,minItems:P,maxItems:F,uniqueItems:Z,minimum:U,maximum:j,exclusiveMinimum:k,exclusiveMaximum:q,multipleOf:K,minLength:xe,maxLength:ce,pattern:pe,__absolute_ref__:Le,__absolute_recursive_ref__:ot}=r,ae=[];if(v===!0&&i===null&&(i=r),h==="#"){const de=i===null?t[ot]:i,Y=`${o}/$recursiveRef`,Se=Ke(e,i===null?r:i,a,t,n,de,s,Y,l);Se.valid||ae.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:Y,error:"A subschema had errors."},...Se.errors)}if(p!==void 0){const de=t[Le||p];if(de===void 0){let oe=`Unresolved $ref "${p}".`;throw Le&&Le!==p&&(oe+=`  Absolute URI "${Le}".`),oe+=`
Known schemas:
- ${Object.keys(t).join(`
- `)}`,new Error(oe)}const Y=`${o}/$ref`,Se=Ke(e,de,a,t,n,i,s,Y,l);if(Se.valid||ae.push({instanceLocation:s,keyword:"$ref",keywordLocation:Y,error:"A subschema had errors."},...Se.errors),a==="4"||a==="7")return{valid:ae.length===0,errors:ae}}if(Array.isArray(f)){let de=f.length,Y=!1;for(let Se=0;Se<de;Se++)if(u===f[Se]||f[Se]==="integer"&&u==="number"&&e%1===0&&e===e){Y=!0;break}Y||ae.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f.join('", "')}".`})}else f==="integer"?(u!=="number"||e%1||e!==e)&&ae.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f}".`}):f!==void 0&&u!==f&&ae.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${f}".`});if(m!==void 0&&(u==="object"||u==="array"?Lo(e,m)||ae.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):e!==m&&ae.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),g!==void 0&&(u==="object"||u==="array"?g.some(de=>Lo(e,de))||ae.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(de=>e===de)||ae.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),S!==void 0){const de=`${o}/not`;Ke(e,S,a,t,n,i,s,de).valid&&ae.push({instanceLocation:s,keyword:"not",keywordLocation:de,error:'Instance matched "not" schema.'})}let He=[];if(O!==void 0){const de=`${o}/anyOf`,Y=ae.length;let Se=!1;for(let oe=0;oe<O.length;oe++){const ne=O[oe],_e=Object.create(l),ye=Ke(e,ne,a,t,n,v===!0?i:null,s,`${de}/${oe}`,_e);ae.push(...ye.errors),Se=Se||ye.valid,ye.valid&&He.push(_e)}Se?ae.length=Y:ae.splice(Y,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:de,error:"Instance does not match any subschemas."})}if(x!==void 0){const de=`${o}/allOf`,Y=ae.length;let Se=!0;for(let oe=0;oe<x.length;oe++){const ne=x[oe],_e=Object.create(l),ye=Ke(e,ne,a,t,n,v===!0?i:null,s,`${de}/${oe}`,_e);ae.push(...ye.errors),Se=Se&&ye.valid,ye.valid&&He.push(_e)}Se?ae.length=Y:ae.splice(Y,0,{instanceLocation:s,keyword:"allOf",keywordLocation:de,error:"Instance does not match every subschema."})}if(E!==void 0){const de=`${o}/oneOf`,Y=ae.length,Se=E.filter((oe,ne)=>{const _e=Object.create(l),ye=Ke(e,oe,a,t,n,v===!0?i:null,s,`${de}/${ne}`,_e);return ae.push(...ye.errors),ye.valid&&He.push(_e),ye.valid}).length;Se===1?ae.length=Y:ae.splice(Y,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:de,error:`Instance does not match exactly one subschema (${Se} matches).`})}if((u==="object"||u==="array")&&Object.assign(l,...He),$!==void 0){const de=`${o}/if`;if(Ke(e,$,a,t,n,i,s,de,l).valid){if(C!==void 0){const Y=Ke(e,C,a,t,n,i,s,`${o}/then`,l);Y.valid||ae.push({instanceLocation:s,keyword:"if",keywordLocation:de,error:'Instance does not match "then" schema.'},...Y.errors)}}else if(R!==void 0){const Y=Ke(e,R,a,t,n,i,s,`${o}/else`,l);Y.valid||ae.push({instanceLocation:s,keyword:"if",keywordLocation:de,error:'Instance does not match "else" schema.'},...Y.errors)}}if(u==="object"){if(b!==void 0)for(const oe of b)oe in e||ae.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${oe}".`});const de=Object.keys(e);if(H!==void 0&&de.length<H&&ae.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${H} properties.`}),B!==void 0&&de.length>B&&ae.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${B} properties.`}),ee!==void 0){const oe=`${o}/propertyNames`;for(const ne in e){const _e=`${s}/${Ut(ne)}`,ye=Ke(ne,ee,a,t,n,i,_e,oe);ye.valid||ae.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:oe,error:`Property name "${ne}" does not match schema.`},...ye.errors)}}if(J!==void 0){const oe=`${o}/dependantRequired`;for(const ne in J)if(ne in e){const _e=J[ne];for(const ye of _e)ye in e||ae.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:oe,error:`Instance has "${ne}" but does not have "${ye}".`})}}if(se!==void 0)for(const oe in se){const ne=`${o}/dependentSchemas`;if(oe in e){const _e=Ke(e,se[oe],a,t,n,i,s,`${ne}/${Ut(oe)}`,l);_e.valid||ae.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:ne,error:`Instance has "${oe}" but does not match dependant schema.`},..._e.errors)}}if(ie!==void 0){const oe=`${o}/dependencies`;for(const ne in ie)if(ne in e){const _e=ie[ne];if(Array.isArray(_e))for(const ye of _e)ye in e||ae.push({instanceLocation:s,keyword:"dependencies",keywordLocation:oe,error:`Instance has "${ne}" but does not have "${ye}".`});else{const ye=Ke(e,_e,a,t,n,i,s,`${oe}/${Ut(ne)}`);ye.valid||ae.push({instanceLocation:s,keyword:"dependencies",keywordLocation:oe,error:`Instance has "${ne}" but does not match dependant schema.`},...ye.errors)}}}const Y=Object.create(null);let Se=!1;if(L!==void 0){const oe=`${o}/properties`;for(const ne in L){if(!(ne in e))continue;const _e=`${s}/${Ut(ne)}`,ye=Ke(e[ne],L[ne],a,t,n,i,_e,`${oe}/${Ut(ne)}`);if(ye.valid)l[ne]=Y[ne]=!0;else if(Se=n,ae.push({instanceLocation:s,keyword:"properties",keywordLocation:oe,error:`Property "${ne}" does not match schema.`},...ye.errors),Se)break}}if(!Se&&T!==void 0){const oe=`${o}/patternProperties`;for(const ne in T){const _e=new RegExp(ne,"u"),ye=T[ne];for(const Je in e){if(!_e.test(Je))continue;const Hr=`${s}/${Ut(Je)}`,Wa=Ke(e[Je],ye,a,t,n,i,Hr,`${oe}/${Ut(ne)}`);Wa.valid?l[Je]=Y[Je]=!0:(Se=n,ae.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:oe,error:`Property "${Je}" matches pattern "${ne}" but does not match associated schema.`},...Wa.errors))}}}if(!Se&&z!==void 0){const oe=`${o}/additionalProperties`;for(const ne in e){if(Y[ne])continue;const _e=`${s}/${Ut(ne)}`,ye=Ke(e[ne],z,a,t,n,i,_e,oe);ye.valid?l[ne]=!0:(Se=n,ae.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:oe,error:`Property "${ne}" does not match additional properties schema.`},...ye.errors))}}else if(!Se&&M!==void 0){const oe=`${o}/unevaluatedProperties`;for(const ne in e)if(!l[ne]){const _e=`${s}/${Ut(ne)}`,ye=Ke(e[ne],M,a,t,n,i,_e,oe);ye.valid?l[ne]=!0:ae.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:oe,error:`Property "${ne}" does not match unevaluated properties schema.`},...ye.errors)}}}else if(u==="array"){F!==void 0&&e.length>F&&ae.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${F}).`}),P!==void 0&&e.length<P&&ae.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${P}).`});const de=e.length;let Y=0,Se=!1;if(ke!==void 0){const oe=`${o}/prefixItems`,ne=Math.min(ke.length,de);for(;Y<ne;Y++){const _e=Ke(e[Y],ke[Y],a,t,n,i,`${s}/${Y}`,`${oe}/${Y}`);if(l[Y]=!0,!_e.valid&&(Se=n,ae.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:oe,error:"Items did not match schema."},..._e.errors),Se))break}}if(Ie!==void 0){const oe=`${o}/items`;if(Array.isArray(Ie)){const ne=Math.min(Ie.length,de);for(;Y<ne;Y++){const _e=Ke(e[Y],Ie[Y],a,t,n,i,`${s}/${Y}`,`${oe}/${Y}`);if(l[Y]=!0,!_e.valid&&(Se=n,ae.push({instanceLocation:s,keyword:"items",keywordLocation:oe,error:"Items did not match schema."},..._e.errors),Se))break}}else for(;Y<de;Y++){const ne=Ke(e[Y],Ie,a,t,n,i,`${s}/${Y}`,oe);if(l[Y]=!0,!ne.valid&&(Se=n,ae.push({instanceLocation:s,keyword:"items",keywordLocation:oe,error:"Items did not match schema."},...ne.errors),Se))break}if(!Se&&G!==void 0){const ne=`${o}/additionalItems`;for(;Y<de;Y++){const _e=Ke(e[Y],G,a,t,n,i,`${s}/${Y}`,ne);l[Y]=!0,_e.valid||(Se=n,ae.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:ne,error:"Items did not match additional items schema."},..._e.errors))}}}if(ge!==void 0)if(de===0&&re===void 0)ae.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(re!==void 0&&de<re)ae.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${de}) than minContains (${re}).`});else{const oe=`${o}/contains`,ne=ae.length;let _e=0;for(let ye=0;ye<de;ye++){const Je=Ke(e[ye],ge,a,t,n,i,`${s}/${ye}`,oe);Je.valid?(l[ye]=!0,_e++):ae.push(...Je.errors)}_e>=(re||0)&&(ae.length=ne),re===void 0&&_===void 0&&_e===0?ae.splice(ne,0,{instanceLocation:s,keyword:"contains",keywordLocation:oe,error:"Array does not contain item matching schema."}):re!==void 0&&_e<re?ae.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${re} items matching schema. Only ${_e} items were found.`}):_!==void 0&&_e>_&&ae.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${_} items matching schema. ${_e} items were found.`})}if(!Se&&te!==void 0){const oe=`${o}/unevaluatedItems`;for(Y;Y<de;Y++){if(l[Y])continue;const ne=Ke(e[Y],te,a,t,n,i,`${s}/${Y}`,oe);l[Y]=!0,ne.valid||ae.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:oe,error:"Items did not match unevaluated items schema."},...ne.errors)}}if(Z)for(let oe=0;oe<de;oe++){const ne=e[oe],_e=typeof ne=="object"&&ne!==null;for(let ye=0;ye<de;ye++){if(oe===ye)continue;const Je=e[ye];(ne===Je||_e&&typeof Je=="object"&&Je!==null&&Lo(ne,Je))&&(ae.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${oe} and ${ye}.`}),oe=Number.MAX_SAFE_INTEGER,ye=Number.MAX_SAFE_INTEGER)}}}else if(u==="number"){if(a==="4"?(U!==void 0&&(k===!0&&e<=U||e<U)&&ae.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${k?"or equal to ":""} ${U}.`}),j!==void 0&&(q===!0&&e>=j||e>j)&&ae.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${q?"or equal to ":""} ${j}.`})):(U!==void 0&&e<U&&ae.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${U}.`}),j!==void 0&&e>j&&ae.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${j}.`}),k!==void 0&&e<=k&&ae.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${k}.`}),q!==void 0&&e>=q&&ae.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${q}.`})),K!==void 0){const de=e%K;Math.abs(0-de)>=11920929e-14&&Math.abs(K-de)>=11920929e-14&&ae.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${K}.`})}}else if(u==="string"){const de=xe===void 0&&ce===void 0?0:Gp(e);xe!==void 0&&de<xe&&ae.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${de} < ${xe}).`}),ce!==void 0&&de>ce&&ae.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${de} > ${ce}).`}),pe!==void 0&&!new RegExp(pe,"u").test(e)&&ae.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),D!==void 0&&qo[D]&&!qo[D](e)&&ae.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${D}".`})}return{valid:ae.length===0,errors:ae}}var Qp=Object.defineProperty,Jp=(e,r,a)=>r in e?Qp(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,rn=(e,r,a)=>Jp(e,typeof r!="symbol"?r+"":r,a);let Wo=class extends Error{constructor(e,r){super(e),rn(this,"type"),rn(this,"field"),rn(this,"value"),rn(this,"line"),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}};function os(e){}function Kp(e){const{onEvent:r=os,onError:a=os,onRetry:t=os,onComment:n}=e;let i="",s=!0,o,l="",d="";function u(m){const g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[b,S]=Xp(`${i}${g}`);for(const O of b)p(O);i=S,s=!1}function p(m){if(m===""){v();return}if(m.startsWith(":")){n&&n(m.slice(m.startsWith(": ")?2:1));return}const g=m.indexOf(":");if(g!==-1){const b=m.slice(0,g),S=m[g+1]===" "?2:1,O=m.slice(g+S);h(b,O,m);return}h(m,"",m)}function h(m,g,b){switch(m){case"event":d=g;break;case"data":l=`${l}${g}
`;break;case"id":o=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?t(parseInt(g,10)):a(new Wo(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:b}));break;default:a(new Wo(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:b}));break}}function v(){l.length>0&&r({id:o,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",d=""}function f(m={}){i&&m.consume&&p(i),o=void 0,l="",d="",i=""}return{feed:u,reset:f}}function Xp(e){const r=[];let a="";const t=e.length;for(let n=0;n<t;n++){const i=e[n];i==="\r"&&e[n+1]===`
`?(r.push(a),a="",n++):i==="\r"||i===`
`?(r.push(a),a=""):a+=i}return[r,a]}class Yp extends TransformStream{constructor({onError:r,onRetry:a,onComment:t}={}){let n;super({start(i){n=Kp({onEvent:s=>{i.enqueue(s)},onError(s){r==="terminate"?i.error(s):typeof r=="function"&&r(s)},onRetry:a,onComment:t})},transform(i){n.feed(i)}})}}class em extends Ix{get lc_namespace(){return["langchain","tools"]}constructor(r){super(r??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(r==null?void 0:r.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(r==null?void 0:r.responseFormat)??this.responseFormat}async invoke(r,a){let t,n=Zb(a);return $o(r)?(t=r.args,n={...n,toolCall:r}):t=r,this.call(t,n)}async call(r,a,t){var v;const n=$o(r)?r.args:r;let i;if(Gb(this.schema))try{i=await Qb(this.schema,n)}catch(f){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${f.message}`),new Gh(m,JSON.stringify(r))}else{const f=Ke(n,this.schema);if(!f.valid){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${f.errors.map(g=>`${g.keywordLocation}: ${g.error}`).join(`
`)}`),new Gh(m,JSON.stringify(r))}i=n}const s=Qh(a),o=await((v=Jb.configure(s.callbacks,this.callbacks,s.tags||t,this.tags,s.metadata,this.metadata,{verbose:this.verbose}))==null?void 0:v.handleToolStart(this.toJSON(),typeof r=="string"?r:JSON.stringify(r),s.runId,void 0,void 0,void 0,s.runName));delete s.runId;let l;try{l=await this._call(i,o,s)}catch(f){throw await(o==null?void 0:o.handleToolError(f)),f}let d,u;if(this.responseFormat==="content_and_artifact")if(Array.isArray(l)&&l.length===2)[d,u]=l;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(l)}`);else d=l;let p;$o(r)&&(p=r.id),!p&&Kb(s)&&(p=s.toolCall.id);const h=rm({content:d,artifact:u,toolCallId:p,name:this.name});return await(o==null?void 0:o.handleToolEnd(h)),h}}class tm extends em{static lc_name(){return"DynamicStructuredTool"}constructor(r){super(r),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=r.name,this.description=r.description,this.func=r.func,this.returnDirect=r.returnDirect??this.returnDirect,this.schema=r.schema}async call(r,a,t){const n=Qh(a);return n.runName===void 0&&(n.runName=this.name),super.call(r,n,t)}_call(r,a,t){return this.func(r,a,t)}}function rm(e){const{content:r,artifact:a,toolCallId:t}=e;return t&&!Xb(r)?typeof r=="string"||Array.isArray(r)&&r.every(n=>typeof n=="object")?new Jh({content:r,artifact:a,tool_call_id:t,name:e.name}):new Jh({content:am(r),artifact:a,tool_call_id:t,name:e.name}):r}function am(e){try{return JSON.stringify(e,null,2)??""}catch{return`${e}`}}var an="Menubar",[ls,nm,sm]=ab(an),[Zo,s1]=nb(an,[sm,Kh]),_t=Yb(),Go=Kh(),[im,cs]=Zo(an),Qo=w.forwardRef((e,r)=>{const{__scopeMenubar:a,value:t,onValueChange:n,defaultValue:i,loop:s=!0,dir:o,...l}=e,d=ex(o),u=Go(a),[p="",h]=sb({prop:t,onChange:n,defaultProp:i}),[v,f]=w.useState(null);return c.jsx(im,{scope:a,value:p,onMenuOpen:w.useCallback(m=>{h(m),f(m)},[h]),onMenuClose:w.useCallback(()=>h(""),[h]),onMenuToggle:w.useCallback(m=>{h(g=>g?"":m),f(m)},[h]),dir:d,loop:s,children:c.jsx(ls.Provider,{scope:a,children:c.jsx(ls.Slot,{scope:a,children:c.jsx(tx,{asChild:!0,...u,orientation:"horizontal",loop:s,dir:d,currentTabStopId:v,onCurrentTabStopIdChange:f,children:c.jsx(er.div,{role:"menubar",...l,ref:r})})})})})});Qo.displayName=an;var ds="MenubarMenu",[om,Jo]=Zo(ds),Ko=e=>{const{__scopeMenubar:r,value:a,...t}=e,n=vr(),i=a||n||"LEGACY_REACT_AUTO_VALUE",s=cs(ds,r),o=_t(r),l=w.useRef(null),d=w.useRef(!1),u=s.value===i;return w.useEffect(()=>{u||(d.current=!1)},[u]),c.jsx(om,{scope:r,value:i,triggerId:vr(),triggerRef:l,contentId:vr(),wasKeyboardTriggerOpenRef:d,children:c.jsx(vx,{...o,open:u,onOpenChange:p=>{p||s.onMenuClose()},modal:!1,dir:s.dir,...t})})};Ko.displayName=ds;var us="MenubarTrigger",Xo=w.forwardRef((e,r)=>{const{__scopeMenubar:a,disabled:t=!1,...n}=e,i=Go(a),s=_t(a),o=cs(us,a),l=Jo(us,a),d=w.useRef(null),u=ib(r,d,l.triggerRef),[p,h]=w.useState(!1),v=o.value===l.value;return c.jsx(ls.ItemSlot,{scope:a,value:l.value,disabled:t,children:c.jsx(rx,{asChild:!0,...i,focusable:!t,tabStopId:l.value,children:c.jsx(ax,{asChild:!0,...s,children:c.jsx(er.button,{type:"button",role:"menuitem",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":v,"aria-controls":v?l.contentId:void 0,"data-highlighted":p?"":void 0,"data-state":v?"open":"closed","data-disabled":t?"":void 0,disabled:t,...n,ref:u,onPointerDown:fr(e.onPointerDown,f=>{!t&&f.button===0&&f.ctrlKey===!1&&(o.onMenuOpen(l.value),v||f.preventDefault())}),onPointerEnter:fr(e.onPointerEnter,()=>{var f;o.value&&!v&&(o.onMenuOpen(l.value),(f=d.current)==null||f.focus())}),onKeyDown:fr(e.onKeyDown,f=>{t||(["Enter"," "].includes(f.key)&&o.onMenuToggle(l.value),f.key==="ArrowDown"&&o.onMenuOpen(l.value),["Enter"," ","ArrowDown"].includes(f.key)&&(l.wasKeyboardTriggerOpenRef.current=!0,f.preventDefault()))}),onFocus:fr(e.onFocus,()=>h(!0)),onBlur:fr(e.onBlur,()=>h(!1))})})})})});Xo.displayName=us;var lm="MenubarPortal",Yo=e=>{const{__scopeMenubar:r,...a}=e,t=_t(r);return c.jsx(gx,{...t,...a})};Yo.displayName=lm;var hs="MenubarContent",el=w.forwardRef((e,r)=>{const{__scopeMenubar:a,align:t="start",...n}=e,i=_t(a),s=cs(hs,a),o=Jo(hs,a),l=nm(a),d=w.useRef(!1);return c.jsx(nx,{id:o.contentId,"aria-labelledby":o.triggerId,"data-radix-menubar-content":"",...i,...n,ref:r,align:t,onCloseAutoFocus:fr(e.onCloseAutoFocus,u=>{var p;!s.value&&!d.current&&((p=o.triggerRef.current)==null||p.focus()),d.current=!1,u.preventDefault()}),onFocusOutside:fr(e.onFocusOutside,u=>{const p=u.target;l().some(h=>{var v;return(v=h.ref.current)==null?void 0:v.contains(p)})&&u.preventDefault()}),onInteractOutside:fr(e.onInteractOutside,()=>{d.current=!0}),onEntryFocus:u=>{o.wasKeyboardTriggerOpenRef.current||u.preventDefault()},onKeyDown:fr(e.onKeyDown,u=>{if(["ArrowRight","ArrowLeft"].includes(u.key)){const p=u.target,h=p.hasAttribute("data-radix-menubar-subtrigger"),v=p.closest("[data-radix-menubar-content]")!==u.currentTarget,f=(s.dir==="rtl"?"ArrowRight":"ArrowLeft")===u.key;if(!f&&h||v&&f)return;let m=l().filter(S=>!S.disabled).map(S=>S.value);f&&m.reverse();const g=m.indexOf(o.value);m=s.loop?jm(m,g+1):m.slice(g+1);const[b]=m;b&&s.onMenuOpen(b)}},{checkForDefaultPrevented:!1}),style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});el.displayName=hs;var cm="MenubarGroup",dm=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(sx,{...n,...t,ref:r})});dm.displayName=cm;var um="MenubarLabel",tl=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(ix,{...n,...t,ref:r})});tl.displayName=um;var hm="MenubarItem",rl=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(ox,{...n,...t,ref:r})});rl.displayName=hm;var pm="MenubarCheckboxItem",al=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(lx,{...n,...t,ref:r})});al.displayName=pm;var mm="MenubarRadioGroup",fm=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(cx,{...n,...t,ref:r})});fm.displayName=mm;var vm="MenubarRadioItem",nl=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(dx,{...n,...t,ref:r})});nl.displayName=vm;var gm="MenubarItemIndicator",sl=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(ux,{...n,...t,ref:r})});sl.displayName=gm;var ym="MenubarSeparator",il=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(hx,{...n,...t,ref:r})});il.displayName=ym;var _m="MenubarArrow",wm=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(px,{...n,...t,ref:r})});wm.displayName=_m;var bm="MenubarSubTrigger",ol=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(mx,{"data-radix-menubar-subtrigger":"",...n,...t,ref:r})});ol.displayName=bm;var xm="MenubarSubContent",ll=w.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=_t(a);return c.jsx(fx,{...n,"data-radix-menubar-content":"",...t,ref:r,style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});ll.displayName=xm;function jm(e,r){return e.map((a,t)=>e[(r+t)%e.length])}var cl=Qo,Sm=Ko,dl=Xo,Em=Yo,ul=el,hl=tl,pl=rl,ml=al,fl=nl,vl=sl,gl=il,yl=ol,_l=ll;const ps=Sm,wl=w.forwardRef(({className:e,...r},a)=>c.jsx(cl,{ref:a,className:Fe("flex h-10 items-center space-x-1 rounded-md border bg-background p-1",e),...r}));wl.displayName=cl.displayName;const ms=w.forwardRef(({className:e,...r},a)=>c.jsx(dl,{ref:a,className:Fe("flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...r}));ms.displayName=dl.displayName;const km=w.forwardRef(({className:e,inset:r,children:a,...t},n)=>c.jsxs(yl,{ref:n,className:Fe("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",r&&"pl-8",e),...t,children:[a,c.jsx(ve,{name:"chevron-right",className:"ml-auto h-4 w-4"})]}));km.displayName=yl.displayName;const Pm=w.forwardRef(({className:e,...r},a)=>c.jsx(_l,{ref:a,className:Fe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));Pm.displayName=_l.displayName;const bl=w.forwardRef(({className:e,align:r="start",alignOffset:a=-4,sideOffset:t=8,...n},i)=>c.jsx(Em,{children:c.jsx(ul,{ref:i,align:r,alignOffset:a,sideOffset:t,className:Fe("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));bl.displayName=ul.displayName;const xl=w.forwardRef(({className:e,inset:r,...a},t)=>c.jsx(pl,{ref:t,className:Fe("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",e),...a}));xl.displayName=pl.displayName;const Nm=w.forwardRef(({className:e,children:r,checked:a,...t},n)=>c.jsxs(ml,{ref:n,className:Fe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(vl,{children:c.jsx(ve,{name:"check",className:"h-4 w-4"})})}),r]}));Nm.displayName=ml.displayName;const Cm=w.forwardRef(({className:e,children:r,...a},t)=>c.jsxs(fl,{ref:t,className:Fe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(vl,{children:c.jsx(ve,{name:"circle",className:"h-2 w-2 fill-current"})})}),r]}));Cm.displayName=fl.displayName;const $m=w.forwardRef(({className:e,inset:r,...a},t)=>c.jsx(hl,{ref:t,className:Fe("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",e),...a}));$m.displayName=hl.displayName;const Om=w.forwardRef(({className:e,...r},a)=>c.jsx(gl,{ref:a,className:Fe("-mx-1 my-1 h-px bg-muted",e),...r}));Om.displayName=gl.displayName;const me=ob()(lb(cb((e,r)=>({...fb,...vb(e,r)})))),Tm=()=>{const e=et(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=w.useState(!1),t=me(s=>s.pushSyncNodeQueue),n=me(s=>s.createOrUpdateFlowNode),i=w.useCallback(async(s,o)=>{try{if(!e)throw new Error("Session not found");if(!o.provider||!o.name)throw new Error("Provider and name are required");a(!0);const l=await ue("LLM").findOne({where:{name:o.name,session_id:e}});return l?(t("LLM",{where:{source_type:"LLM",source_id:l.id}}),l):ue("LLM").save({name:`${o.name}`,status:[Ce.WebLLM,Ce.Wllama].includes(o.provider)?ft.Started:ft.Loaded,session_id:e,provider:o.provider,metadata:JSON.stringify(o.metadata||{}),model_type:o.model_type||ns.LLM,parameters:o.parameters||void 0,encrypted:o.encrypted||void 0,...o}).then(async d=>{var u,p,h;return await n({source_id:d.id,source_type:"LLM",node_type:V.LLM,x:(u=s.position)==null?void 0:u.x,y:((p=s.position)==null?void 0:p.y)+(((h=s.measured)==null?void 0:h.height)||0)+30}),d})}finally{a(!1)}},[n,t,e]);return{loading:r,createLLM:i}};var jl=1,Im=.9,Lm=.8,Am=.17,fs=.1,vs=.999,Rm=.9999,Fm=.99,Dm=/[\\\/_+.#"@\[\(\{&]/,Mm=/[\\\/_+.#"@\[\(\{&]/g,zm=/[\s-]/,Sl=/[\s-]/g;function gs(e,r,a,t,n,i,s){if(i===r.length)return n===e.length?jl:Fm;var o=`${n},${i}`;if(s[o]!==void 0)return s[o];for(var l=t.charAt(i),d=a.indexOf(l,n),u=0,p,h,v,f;d>=0;)p=gs(e,r,a,t,d+1,i+1,s),p>u&&(d===n?p*=jl:Dm.test(e.charAt(d-1))?(p*=Lm,v=e.slice(n,d-1).match(Mm),v&&n>0&&(p*=Math.pow(vs,v.length))):zm.test(e.charAt(d-1))?(p*=Im,f=e.slice(n,d-1).match(Sl),f&&n>0&&(p*=Math.pow(vs,f.length))):(p*=Am,n>0&&(p*=Math.pow(vs,d-n))),e.charAt(d)!==r.charAt(i)&&(p*=Rm)),(p<fs&&a.charAt(d-1)===t.charAt(i+1)||t.charAt(i+1)===t.charAt(i)&&a.charAt(d-1)!==t.charAt(i))&&(h=gs(e,r,a,t,d+1,i+2,s),h*fs>p&&(p=h*fs)),p>u&&(u=p),d=a.indexOf(l,d+1);return s[o]=u,u}function El(e){return e.toLowerCase().replace(Sl," ")}function Um(e,r,a){return e=a&&a.length>0?`${e+" "+a.join(" ")}`:e,gs(e,r,El(e),El(r),0,0,{})}var Na='[cmdk-group=""]',ys='[cmdk-group-items=""]',Hm='[cmdk-group-heading=""]',_s='[cmdk-item=""]',kl=`${_s}:not([aria-disabled="true"])`,ws="cmdk-item-select",Lr="data-value",qm=(e,r,a)=>Um(e,r,a),Pl=w.createContext(void 0),Ca=()=>w.useContext(Pl),Nl=w.createContext(void 0),bs=()=>w.useContext(Nl),Cl=w.createContext(void 0),$l=w.forwardRef((e,r)=>{let a=Yr(()=>{var G,te;return{search:"",value:(te=(G=e.value)!=null?G:e.defaultValue)!=null?te:"",filtered:{count:0,items:new Map,groups:new Set}}}),t=Yr(()=>new Set),n=Yr(()=>new Map),i=Yr(()=>new Map),s=Yr(()=>new Set),o=Ol(e),{label:l,children:d,value:u,onValueChange:p,filter:h,shouldFilter:v,loop:f,disablePointerSelection:m=!1,vimBindings:g=!0,...b}=e,S=vr(),O=vr(),x=vr(),E=w.useRef(null),$=ef();Ar(()=>{if(u!==void 0){let G=u.trim();a.current.value=G,C.emit()}},[u]),Ar(()=>{$(6,M)},[]);let C=w.useMemo(()=>({subscribe:G=>(s.current.add(G),()=>s.current.delete(G)),snapshot:()=>a.current,setState:(G,te,ge)=>{var re,_,P;if(!Object.is(a.current[G],te)){if(a.current[G]=te,G==="search")z(),L(),$(1,T);else if(G==="value"&&(ge||$(5,M),((re=o.current)==null?void 0:re.value)!==void 0)){let F=te??"";(P=(_=o.current).onValueChange)==null||P.call(_,F);return}C.emit()}},emit:()=>{s.current.forEach(G=>G())}}),[]),R=w.useMemo(()=>({value:(G,te,ge)=>{var re;te!==((re=i.current.get(G))==null?void 0:re.value)&&(i.current.set(G,{value:te,keywords:ge}),a.current.filtered.items.set(G,D(te,ge)),$(2,()=>{L(),C.emit()}))},item:(G,te)=>(t.current.add(G),te&&(n.current.has(te)?n.current.get(te).add(G):n.current.set(te,new Set([G]))),$(3,()=>{z(),L(),a.current.value||T(),C.emit()}),()=>{i.current.delete(G),t.current.delete(G),a.current.filtered.items.delete(G);let ge=H();$(4,()=>{z(),(ge==null?void 0:ge.getAttribute("id"))===G&&T(),C.emit()})}),group:G=>(n.current.has(G)||n.current.set(G,new Set),()=>{i.current.delete(G),n.current.delete(G)}),filter:()=>o.current.shouldFilter,label:l||e["aria-label"],getDisablePointerSelection:()=>o.current.disablePointerSelection,listId:S,inputId:x,labelId:O,listInnerRef:E}),[]);function D(G,te){var ge,re;let _=(re=(ge=o.current)==null?void 0:ge.filter)!=null?re:qm;return G?_(G,a.current.search,te):0}function L(){if(!a.current.search||o.current.shouldFilter===!1)return;let G=a.current.filtered.items,te=[];a.current.filtered.groups.forEach(re=>{let _=n.current.get(re),P=0;_.forEach(F=>{let Z=G.get(F);P=Math.max(Z,P)}),te.push([re,P])});let ge=E.current;B().sort((re,_)=>{var P,F;let Z=re.getAttribute("id"),U=_.getAttribute("id");return((P=G.get(U))!=null?P:0)-((F=G.get(Z))!=null?F:0)}).forEach(re=>{let _=re.closest(ys);_?_.appendChild(re.parentElement===_?re:re.closest(`${ys} > *`)):ge.appendChild(re.parentElement===ge?re:re.closest(`${ys} > *`))}),te.sort((re,_)=>_[1]-re[1]).forEach(re=>{var _;let P=(_=E.current)==null?void 0:_.querySelector(`${Na}[${Lr}="${encodeURIComponent(re[0])}"]`);P==null||P.parentElement.appendChild(P)})}function T(){let G=B().find(ge=>ge.getAttribute("aria-disabled")!=="true"),te=G==null?void 0:G.getAttribute(Lr);C.setState("value",te||void 0)}function z(){var G,te,ge,re;if(!a.current.search||o.current.shouldFilter===!1){a.current.filtered.count=t.current.size;return}a.current.filtered.groups=new Set;let _=0;for(let P of t.current){let F=(te=(G=i.current.get(P))==null?void 0:G.value)!=null?te:"",Z=(re=(ge=i.current.get(P))==null?void 0:ge.keywords)!=null?re:[],U=D(F,Z);a.current.filtered.items.set(P,U),U>0&&_++}for(let[P,F]of n.current)for(let Z of F)if(a.current.filtered.items.get(Z)>0){a.current.filtered.groups.add(P);break}a.current.filtered.count=_}function M(){var G,te,ge;let re=H();re&&(((G=re.parentElement)==null?void 0:G.firstChild)===re&&((ge=(te=re.closest(Na))==null?void 0:te.querySelector(Hm))==null||ge.scrollIntoView({block:"nearest"})),re.scrollIntoView({block:"nearest"}))}function H(){var G;return(G=E.current)==null?void 0:G.querySelector(`${_s}[aria-selected="true"]`)}function B(){var G;return Array.from(((G=E.current)==null?void 0:G.querySelectorAll(kl))||[])}function ee(G){let te=B()[G];te&&C.setState("value",te.getAttribute(Lr))}function J(G){var te;let ge=H(),re=B(),_=re.findIndex(F=>F===ge),P=re[_+G];(te=o.current)!=null&&te.loop&&(P=_+G<0?re[re.length-1]:_+G===re.length?re[0]:re[_+G]),P&&C.setState("value",P.getAttribute(Lr))}function se(G){let te=H(),ge=te==null?void 0:te.closest(Na),re;for(;ge&&!re;)ge=G>0?Xm(ge,Na):Ym(ge,Na),re=ge==null?void 0:ge.querySelector(kl);re?C.setState("value",re.getAttribute(Lr)):J(G)}let ie=()=>ee(B().length-1),ke=G=>{G.preventDefault(),G.metaKey?ie():G.altKey?se(1):J(1)},Ie=G=>{G.preventDefault(),G.metaKey?ee(0):G.altKey?se(-1):J(-1)};return w.createElement(er.div,{ref:r,tabIndex:-1,...b,"cmdk-root":"",onKeyDown:G=>{var te;if((te=b.onKeyDown)==null||te.call(b,G),!G.defaultPrevented)switch(G.key){case"n":case"j":{g&&G.ctrlKey&&ke(G);break}case"ArrowDown":{ke(G);break}case"p":case"k":{g&&G.ctrlKey&&Ie(G);break}case"ArrowUp":{Ie(G);break}case"Home":{G.preventDefault(),ee(0);break}case"End":{G.preventDefault(),ie();break}case"Enter":if(!G.nativeEvent.isComposing&&G.keyCode!==229){G.preventDefault();let ge=H();if(ge){let re=new Event(ws);ge.dispatchEvent(re)}}}}},w.createElement("label",{"cmdk-label":"",htmlFor:R.inputId,id:R.labelId,style:rf},l),nn(e,G=>w.createElement(Nl.Provider,{value:C},w.createElement(Pl.Provider,{value:R},G))))}),Vm=w.forwardRef((e,r)=>{var a,t;let n=vr(),i=w.useRef(null),s=w.useContext(Cl),o=Ca(),l=Ol(e),d=(t=(a=l.current)==null?void 0:a.forceMount)!=null?t:s==null?void 0:s.forceMount;Ar(()=>{if(!d)return o.item(n,s==null?void 0:s.id)},[d]);let u=Tl(n,i,[e.value,e.children,i],e.keywords),p=bs(),h=Rr($=>$.value&&$.value===u.current),v=Rr($=>d||o.filter()===!1?!0:$.search?$.filtered.items.get(n)>0:!0);w.useEffect(()=>{let $=i.current;if(!(!$||e.disabled))return $.addEventListener(ws,f),()=>$.removeEventListener(ws,f)},[v,e.onSelect,e.disabled]);function f(){var $,C;m(),(C=($=l.current).onSelect)==null||C.call($,u.current)}function m(){p.setState("value",u.current,!0)}if(!v)return null;let{disabled:g,value:b,onSelect:S,forceMount:O,keywords:x,...E}=e;return w.createElement(er.div,{ref:$a([i,r]),...E,id:n,"cmdk-item":"",role:"option","aria-disabled":!!g,"aria-selected":!!h,"data-disabled":!!g,"data-selected":!!h,onPointerMove:g||o.getDisablePointerSelection()?void 0:m,onClick:g?void 0:f},e.children)}),Bm=w.forwardRef((e,r)=>{let{heading:a,children:t,forceMount:n,...i}=e,s=vr(),o=w.useRef(null),l=w.useRef(null),d=vr(),u=Ca(),p=Rr(v=>n||u.filter()===!1?!0:v.search?v.filtered.groups.has(s):!0);Ar(()=>u.group(s),[]),Tl(s,o,[e.value,e.heading,l]);let h=w.useMemo(()=>({id:s,forceMount:n}),[n]);return w.createElement(er.div,{ref:$a([o,r]),...i,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},a&&w.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:d},a),nn(e,v=>w.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?d:void 0},w.createElement(Cl.Provider,{value:h},v))))}),Wm=w.forwardRef((e,r)=>{let{alwaysRender:a,...t}=e,n=w.useRef(null),i=Rr(s=>!s.search);return!a&&!i?null:w.createElement(er.div,{ref:$a([n,r]),...t,"cmdk-separator":"",role:"separator"})}),Zm=w.forwardRef((e,r)=>{let{onValueChange:a,...t}=e,n=e.value!=null,i=bs(),s=Rr(u=>u.search),o=Rr(u=>u.value),l=Ca(),d=w.useMemo(()=>{var u;let p=(u=l.listInnerRef.current)==null?void 0:u.querySelector(`${_s}[${Lr}="${encodeURIComponent(o)}"]`);return p==null?void 0:p.getAttribute("id")},[]);return w.useEffect(()=>{e.value!=null&&i.setState("search",e.value)},[e.value]),w.createElement(er.input,{ref:r,...t,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":d,id:l.inputId,type:"text",value:n?e.value:s,onChange:u=>{n||i.setState("search",u.target.value),a==null||a(u.target.value)}})}),Gm=w.forwardRef((e,r)=>{let{children:a,label:t="Suggestions",...n}=e,i=w.useRef(null),s=w.useRef(null),o=Ca();return w.useEffect(()=>{if(s.current&&i.current){let l=s.current,d=i.current,u,p=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let h=l.offsetHeight;d.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return p.observe(l),()=>{cancelAnimationFrame(u),p.unobserve(l)}}},[]),w.createElement(er.div,{ref:$a([i,r]),...n,"cmdk-list":"",role:"listbox","aria-label":t,id:o.listId},nn(e,l=>w.createElement("div",{ref:$a([s,o.listInnerRef]),"cmdk-list-sizer":""},l)))}),Qm=w.forwardRef((e,r)=>{let{open:a,onOpenChange:t,overlayClassName:n,contentClassName:i,container:s,...o}=e;return w.createElement(yx,{open:a,onOpenChange:t},w.createElement(_x,{container:s},w.createElement(wx,{"cmdk-overlay":"",className:n}),w.createElement(bx,{"aria-label":e.label,"cmdk-dialog":"",className:i},w.createElement($l,{ref:r,...o}))))}),Jm=w.forwardRef((e,r)=>Rr(a=>a.filtered.count===0)?w.createElement(er.div,{ref:r,...e,"cmdk-empty":"",role:"presentation"}):null),Km=w.forwardRef((e,r)=>{let{progress:a,children:t,label:n="Loading...",...i}=e;return w.createElement(er.div,{ref:r,...i,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},nn(e,s=>w.createElement("div",{"aria-hidden":!0},s)))}),St=Object.assign($l,{List:Gm,Item:Vm,Input:Zm,Group:Bm,Separator:Wm,Dialog:Qm,Empty:Jm,Loading:Km});function Xm(e,r){let a=e.nextElementSibling;for(;a;){if(a.matches(r))return a;a=a.nextElementSibling}}function Ym(e,r){let a=e.previousElementSibling;for(;a;){if(a.matches(r))return a;a=a.previousElementSibling}}function Ol(e){let r=w.useRef(e);return Ar(()=>{r.current=e}),r}var Ar=typeof window>"u"?w.useEffect:w.useLayoutEffect;function Yr(e){let r=w.useRef();return r.current===void 0&&(r.current=e()),r}function $a(e){return r=>{e.forEach(a=>{typeof a=="function"?a(r):a!=null&&(a.current=r)})}}function Rr(e){let r=bs(),a=()=>e(r.snapshot());return Qx.useSyncExternalStore(r.subscribe,a,a)}function Tl(e,r,a,t=[]){let n=w.useRef(),i=Ca();return Ar(()=>{var s;let o=(()=>{var d;for(let u of a){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(d=u.current.textContent)==null?void 0:d.trim():n.current}})(),l=t.map(d=>d.trim());i.value(e,o,l),(s=r.current)==null||s.setAttribute(Lr,o),n.current=o}),n}var ef=()=>{let[e,r]=w.useState(),a=Yr(()=>new Map);return Ar(()=>{a.current.forEach(t=>t()),a.current=new Map},[e]),(t,n)=>{a.current.set(t,n),r({})}};function tf(e){let r=e.type;return typeof r=="function"?r(e.props):"render"in r?r.render(e.props):e}function nn({asChild:e,children:r},a){return e&&w.isValidElement(r)?w.cloneElement(tf(r),{ref:r.ref},a(r.props.children)):a(r)}var rf={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const sn=w.forwardRef(({className:e,...r},a)=>c.jsx(St,{ref:a,className:Fe("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...r}));sn.displayName=St.displayName;const on=w.forwardRef(({className:e,...r},a)=>c.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[c.jsx(ve,{name:"search",className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),c.jsx(St.Input,{ref:a,className:Fe("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...r})]}));on.displayName=St.Input.displayName;const ln=w.forwardRef(({className:e,...r},a)=>c.jsx(St.List,{ref:a,className:Fe("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...r}));ln.displayName=St.List.displayName;const cn=w.forwardRef((e,r)=>c.jsx(St.Empty,{ref:r,className:"py-6 text-center text-sm",...e}));cn.displayName=St.Empty.displayName;const dn=w.forwardRef(({className:e,...r},a)=>c.jsx(St.Group,{ref:a,className:Fe("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...r}));dn.displayName=St.Group.displayName;const af=w.forwardRef(({className:e,...r},a)=>c.jsx(St.Separator,{ref:a,className:Fe("-mx-1 h-px bg-border",e),...r}));af.displayName=St.Separator.displayName;const ea=w.forwardRef(({className:e,...r},a)=>c.jsx(St.Item,{ref:a,className:Fe("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...r}));ea.displayName=St.Item.displayName;const xs=w.forwardRef(({className:e,...r},a)=>c.jsx(dp,{ref:a,className:Fe("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:c.jsx(Jx,{className:Fe("flex items-center justify-center text-current"),children:c.jsx(ve,{name:"check",className:"h-4 w-4"})})}));xs.displayName=dp.displayName;const nf=["gpt-4.1","gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo"],sf=["deepseek-r1-distill-llama-70b","llama-3.2-90b-vision-preview","llama-3.3-70b-versatile","llama-3.3-70b-specdec","llama3-70b-8192","gemma2-9b-it","llama3-8b-8192","mixtral-8x7b-32768"],of=["llama-3.2-90b-vision-preview"],lf=["gemini-2.0-flash-exp","gemini-1.5-flash","gemini-1.5-pro","gemini-1.5-flash-8b"],un="https://aistudio.google.com/app/apikey",hn="https://platform.openai.com/api-keys",Il="https://console.groq.com/keys",cf=[Ce.WebLLM,Ce.Wllama,Ce.OpenAI,Ce.GoogleGenerativeAI,Ce.Groq],df=Vn(({onConfirm:e,onCancel:r})=>{const a=Nr(),{t}=Oe("dialogs"),[n,i]=w.useState(""),s=d=>{i(d)},o=async()=>{try{if((n==null?void 0:n.length)!==6)return;await(e==null?void 0:e(n)),i(""),a.resolve(!0),a.hide()}catch(d){a.reject(d)}},l=()=>{r==null||r(),i(""),a.resolve(!1),a.hide()};return c.jsx(Jn,{open:a.visible,onOpenChange:l,children:c.jsxs(Kn,{className:"w-[330px]",children:[c.jsxs(Xn,{children:[c.jsx(Yn,{children:t("create_session_passkey.title")}),c.jsx(Xh,{children:t("create_session_passkey.description")})]}),c.jsx("div",{className:"py-4",children:c.jsxs(Lx,{onChange:s,maxLength:6,children:[c.jsxs(lp,{children:[c.jsx(Ea,{index:0,hidden:!0}),c.jsx(Ea,{index:1,hidden:!0}),c.jsx(Ea,{index:2,hidden:!0})]}),c.jsx(Ax,{}),c.jsxs(lp,{children:[c.jsx(Ea,{index:3,hidden:!0}),c.jsx(Ea,{index:4,hidden:!0}),c.jsx(Ea,{index:5,hidden:!0})]})]})}),c.jsx(Yh,{children:c.jsx(Ve,{disabled:(n==null?void 0:n.length)!==6,onClick:o,type:"submit",children:t("create_session_passkey.confirm")})})]})})}),uf=()=>{const[e,r]=w.useState(!1),a=et(i=>i.currentSession),t=et(i=>i.setCurrentSession),n=w.useCallback(async i=>{if(!(!a||!i))try{r(!0);const s=await Rx(),o=await cp(s,i);await ue("Session").update(a.id,{passphrase:o});const l=await ue("Session").findOne({where:{id:a.id}});return l&&t(l),{passphrase:s,encrypted:o}}finally{r(!1)}},[a,t]);return{loading:e,updateSessionPassphrase:n}},Ll=()=>{const e=et(n=>n.currentSession),{modalRef:r}=Fx(df),{updateSessionPassphrase:a}=uf(),{confirmPassphrase:t}=Jr();return{confirmOrCreatePassphrase:w.useCallback(async()=>{if(e!=null&&e.passphrase)await t();else{let n="";if(await r.current.show({onConfirm:async s=>{n=s}}),!n)throw new Error("Passphrase is required");const i=await a(n);if(!i)throw new Error("Failed to update session passphrase");await es.set("passphrase",i.passphrase)}return es.get("passphrase")},[t,r,e==null?void 0:e.passphrase,a])}};function hf(e){var ge,re;const{id:r,setDialog:a}=e,{t}=Oe("components"),{toast:n}=xt(),i=lt(r),[s,o]=w.useState(!1),[l,d]=w.useState(""),[u,p]=w.useState(!1),[h,v]=w.useState(""),[f,m]=w.useState(),[g,b]=w.useState(Ce.WebLLM),[S,O]=w.useState(!1),[x,E]=w.useState(),$=w.useRef(),C=et(_=>_.currentSession),R=Ja(_=>_.syncCachedLLMURLs),D=Ja(_=>_.cachedLLMURLs),{loading:L,createLLM:T}=Tm();$.current=x;const{confirmOrCreatePassphrase:z}=Ll();w.useEffect(()=>{R()},[R]);const M=w.useMemo(()=>l?![Ce.WebLLM,Ce.Wllama].includes(g):!1,[l,g]),H=w.useMemo(()=>!(x!=null&&x.functionCallingModelIds)||!(x!=null&&x.modelList)?[]:((h?x==null?void 0:x.modelList.filter(_=>_.model_id.toLowerCase().includes(h.toLowerCase())):x==null?void 0:x.modelList)||[]).sort((_,P)=>{const F=D.some(K=>K.includes(_.model_id)),Z=D.some(K=>K.includes(P.model_id));if(F&&!Z)return-1;if(!F&&Z)return 1;const U=Mh.includes(_.model_id),j=Mh.includes(P.model_id);if(U&&!j)return-1;if(!U&&j)return 1;const k=x==null?void 0:x.functionCallingModelIds.includes(_.model_id),q=x==null?void 0:x.functionCallingModelIds.includes(P.model_id);return k&&!q?-1:!k&&q?1:_.vram_required_MB&&P.vram_required_MB&&_.vram_required_MB!==P.vram_required_MB?_.vram_required_MB-P.vram_required_MB:_.model_id.localeCompare(P.model_id)}),[x==null?void 0:x.modelList,x==null?void 0:x.functionCallingModelIds,h,D]),B=w.useMemo(()=>{if(l)switch(g){case Ce.Wllama:return x==null?void 0:x.modelList.find(_=>_.model_id===l);case Ce.WebLLM:return(x==null?void 0:x.modelList)&&H.find(_=>_.model_id===l);case Ce.Groq:return m({}),{model:l,model_id:l,model_type:of.includes(l)?2:0,overrides:{}};case Ce.OpenAI:return m({}),{model:l,model_id:l,model_type:2,overrides:{}};case Ce.GoogleGenerativeAI:return m({}),{model:l,model_id:l,model_type:2,overrides:{}}}},[l,x==null?void 0:x.modelList,H,g]);w.useEffect(()=>{!(B!=null&&B.model_id)||!D||O(D.some(_=>_.includes(B.model_id)))},[D,B==null?void 0:B.model_id]),w.useEffect(()=>{C!=null&&C.id&&(b(Ce.WebLLM),d(""),v(""),m({}))},[C==null?void 0:C.id]);const ee=w.useCallback(_=>{d(_),p(!1)},[]),J=w.useCallback(_=>{v(_)},[]),se=w.useCallback(_=>{b(_),d(""),v(""),m({})},[]),ie=async()=>{var _;if(!(!i||!C))try{o(!0);let P;if(M){const F=await z();if(!F)throw new Error("Passphrase is not found");P=await Dx(f||{},F)}await T(i,{name:l,model_type:ke(B==null?void 0:B.model_type),function_calling:B!=null&&B.model_id?(_=x==null?void 0:x.functionCallingModelIds)==null?void 0:_.includes(B==null?void 0:B.model_id):!1,encrypted:P,provider:g}),a==null||a(!1)}catch(P){Cr("Create LLM",P),n({variant:"destructive",description:t("add_llm_card.errors.failed_to_create")})}finally{o(!1),b(Ce.WebLLM),m({}),d(""),v("")}};w.useLayoutEffect(()=>{(async()=>{var _;try{if(g===Ce.Wllama){const[P,F]=(l==null?void 0:l.split("/"))||[],Z=`${P}/${F}`;if(!l||!P||!F){E({modelList:[],functionCallingModelIds:[]});return}else if(((_=$.current)==null?void 0:_.input)===Z)return;const U=await(await fetch(`https://huggingface.co/api/models/${Z}`)).json();U.siblings?E({input:Z,modelList:U.siblings.map(j=>j.rfilename).filter(j=>j.endsWith(".gguf")).map(j=>({model_id:`${Z}/${j}`,model:`${Z}/${j}`,model_lib:`${Z}/${j}`,model_type:0,overrides:{}})),functionCallingModelIds:[]}):E({modelList:[],functionCallingModelIds:[]})}else g===Ce.WebLLM&&jt(()=>import("./index-DCNC3sQs.js").then(async P=>(await P.__tla,P)),__vite__mapDeps([0,1,2,3,4,5,6])).then(async({functionCallingModelIds:P,prebuiltAppConfig:F})=>{const Z=F.model_list;E({modelList:Z,functionCallingModelIds:P})})}catch{}})()},[g,l]);const ke=w.useCallback(_=>_===1?ns.embedding:_===2?ns.VLM:ns.LLM,[]),Ie=w.useMemo(()=>{switch(g){case Ce.Wllama:case Ce.WebLLM:return H.map(_=>{var P;return c.jsxs(ea,{value:_.model_id,onSelect:ee,children:[l===_.model_id?c.jsx(ve,{name:"check",className:"mr-2 h-4 w-4"}):c.jsx("div",{className:"mr-2 h-4 w-4"}),c.jsxs("span",{className:"max-w-md",children:[c.jsxs("div",{className:"flex gap-2 mb-2",children:[c.jsx(yr,{name:_.model_id}),_.model_id]}),c.jsx("div",{className:"flex max-w-full flex-wrap gap-1",children:c.jsx(Bn,{model:_,isFunctionCalling:((P=x==null?void 0:x.functionCallingModelIds)==null?void 0:P.includes(_.model_id))||!1,name:_.model_id,isCached:D.some(F=>F.includes(_.model_id))||!1,cloud:g!==Ce.WebLLM})})]})]},_.model_id)});case Ce.OpenAI:return nf.map(_=>c.jsxs(ea,{value:_,onSelect:ee,children:[l===_?c.jsx(ve,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(yr,{name:_}),_]})})]},_));case Ce.GoogleGenerativeAI:return lf.map(_=>c.jsxs(ea,{value:_,onSelect:ee,children:[l===_?c.jsx(ve,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(yr,{name:_}),_]})})]},_));case Ce.Groq:return sf.map(_=>c.jsxs(ea,{value:_,onSelect:ee,children:[l===_?c.jsx(ve,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(yr,{name:_}),_]})})]},_))}},[D,ee,l,x==null?void 0:x.functionCallingModelIds,H,g]),G=w.useMemo(()=>{if(g===Ce.Wllama){const[_,P]=(l==null?void 0:l.split("/"))||[];return c.jsxs(c.Fragment,{children:[c.jsx(Ct,{variant:"default",className:"mb-4",children:t("add_llm_card.wllama_description")}),c.jsx(we,{children:t("add_llm_card.hugging_face_recommendation")}),c.jsxs(ss,{children:[c.jsx(Fo,{asChild:!0,children:c.jsxs(Ve,{variant:"outline",role:"combobox",className:"w-full justify-between max-w-full overflow-hidden",children:[_&&P?`${_}/${P}`:t("add_llm_card.select_model_placeholder"),c.jsx(ve,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),c.jsx(is,{className:"w-full p-0",children:c.jsxs(sn,{children:[c.jsx(on,{placeholder:t("add_llm_card.search_placeholder")}),c.jsxs(ln,{children:[c.jsx(cn,{children:t("add_llm_card.no_model")}),c.jsx(dn,{children:gb.map(F=>c.jsxs(ea,{value:F,onSelect:ee,children:[l===F?c.jsx(ve,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(yr,{name:F}),F]})})]},F))})]})]})})]}),c.jsx(we,{children:t("add_llm_card.hugging_face_repo")}),_&&P?c.jsxs("div",{className:"relative",children:[c.jsx(nt,{value:`${_}/${P}`,disabled:!0,placeholder:t("add_llm_card.hugging_face_repo_placeholder")}),c.jsx(ve,{onClick:()=>d(""),name:"x",className:"h-4 w-4 absolute right-3 top-3 cursor-pointer"})]}):c.jsx(nt,{value:_?`${_}/${P}`:"",onChange:F=>d(F.target.value),placeholder:t("add_llm_card.hugging_face_repo_placeholder")}),c.jsx(we,{children:t("add_llm_card.model_name")}),c.jsxs(ss,{open:u,onOpenChange:p,children:[c.jsx(Fo,{asChild:!0,children:c.jsxs(Ve,{variant:"outline",role:"combobox","aria-expanded":u,disabled:!_||!P,className:"w-full justify-between max-w-full overflow-hidden",children:[l&&B?B==null?void 0:B.model_id:t("add_llm_card.select_model_placeholder"),c.jsx(ve,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),c.jsx(is,{className:"w-full p-0",children:c.jsxs(sn,{children:[c.jsx(on,{onValueChange:J,placeholder:t("add_llm_card.search_placeholder")}),c.jsxs(ln,{children:[c.jsx(cn,{children:t("add_llm_card.no_model")}),c.jsx(dn,{children:Ie})]})]})})]})]})}return c.jsxs(c.Fragment,{children:[c.jsx(we,{children:t("add_llm_card.model_name")}),c.jsxs(ss,{open:u,onOpenChange:p,children:[c.jsx(Fo,{asChild:!0,children:c.jsxs(Ve,{variant:"outline",role:"combobox","aria-expanded":u,className:"w-full justify-between",children:[l?B==null?void 0:B.model_id:t("add_llm_card.select_model_placeholder"),c.jsx(ve,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),c.jsx(is,{className:"w-full p-0",children:c.jsxs(sn,{children:[c.jsx(on,{onValueChange:J,placeholder:t("add_llm_card.search_placeholder")}),c.jsxs(ln,{children:[c.jsx(cn,{children:t("add_llm_card.no_model")}),c.jsx(dn,{children:Ie})]})]})})]})]})},[g,t,u,l,B,J,Ie,ee]),te=w.useMemo(()=>{if(M)switch(g){case Ce.Groq:case Ce.OpenAI:return c.jsxs(c.Fragment,{children:[c.jsx(Ct,{variant:"destructive",className:"mt-4",children:t("add_llm_card.alert.session_passkey")}),c.jsxs("div",{className:"mt-4",children:[c.jsx(we,{children:t("add_llm_card.encrypted_fields.api_key")}),c.jsx(Ve,{variant:"link",className:"px-1",children:c.jsxs("a",{href:g===Ce.OpenAI?hn:Il,target:"_blank",rel:"noreferrer",children:["(",g===Ce.OpenAI?hn:Il,")"]})}),c.jsx(nt,{type:"password",value:(f==null?void 0:f.key)||"",onChange:_=>m(P=>({...P,key:_.target.value}))})]})]});case Ce.GoogleGenerativeAI:return c.jsxs(c.Fragment,{children:[c.jsx(Ct,{variant:"destructive",className:"mt-4",children:t("add_llm_card.alert.session_passkey")}),c.jsxs("div",{className:"mt-4",children:[c.jsx(we,{children:t("add_llm_card.encrypted_fields.api_key")}),c.jsx(Ve,{variant:"link",className:"px-1",children:c.jsxs("a",{href:un,target:"_blank",rel:"noreferrer",children:["(",un,")"]})}),c.jsx(nt,{type:"password",value:(f==null?void 0:f.key)||"",onChange:_=>m(P=>({...P,key:_.target.value}))})]}),c.jsxs("div",{className:"mt-4 flex items-center",children:[c.jsx(we,{children:t("add_llm_card.encrypted_fields.enabled_google_search_retreival")}),c.jsx(xs,{checked:!!(f!=null&&f.enabled_google_search_retreival),className:"ml-2",onCheckedChange:_=>{m(P=>({...P,enabled_google_search_retreival:_?"true":""}))}})]})]})}},[M,g,t,f]);return c.jsxs(Ge,{className:"max-w-lg",children:[c.jsx(pt,{children:c.jsx(gt,{children:t("add_llm_card.title")})}),c.jsxs(mt,{children:[c.jsxs("div",{className:"grid w-full gap-1.5",children:[c.jsx(we,{children:t("add_llm_card.provider")}),c.jsxs(rr,{value:g,onValueChange:se,children:[c.jsx(ar,{className:"w-full mb-4",children:c.jsx(nr,{placeholder:t("add_llm_card.provider_select_placeholder")})}),c.jsx(sr,{children:Object.values(cf).map(_=>c.jsx(yt,{value:_,children:t(`add_llm_card.providers.${_.toLowerCase()}`)},_))})]}),G]}),B?c.jsxs("div",{className:"mt-4",children:[c.jsxs("div",{className:"mt-4 text-sm text-muted-foreground center flex max-w-full flex-wrap gap-1",children:[c.jsx(yr,{name:B.model_id,className:"mr-2"}),c.jsx(Bn,{model:B,isFunctionCalling:((ge=x==null?void 0:x.functionCallingModelIds)==null?void 0:ge.includes(B.model_id))||!1,name:B.model_id,isCached:D.some(_=>_.includes(B.model_id))||!1,cloud:![Ce.WebLLM,Ce.Wllama].includes(g)})]}),c.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[c.jsx("span",{className:"font-bold mr-2",children:t("add_llm_card.model_url")}),B.model]}),B.model_lib?c.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[c.jsx("span",{className:"font-bold mr-2",children:t("add_llm_card.model_lib_url")}),B.model_lib]}):void 0,B.overrides&&((re=Object.keys(B.overrides))!=null&&re.length)?c.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[c.jsx("span",{className:"font-bold mr-2",children:t("add_llm_card.metadata")}),JSON.stringify(B.overrides)]}):void 0]}):null,te]}),c.jsx($r,{className:"flex justify-between",children:c.jsx(zt,{loading:L||s,disabled:!(l!=null&&l.length),onClick:ie,className:"w-full",children:t(S?"add_llm_card.button_add":"add_llm_card.button_download_and_add")})})]})}const Al=()=>{const e=et(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[r,a]=w.useState(!1),t=me(i=>i.createOrUpdateFlowNode),n=w.useCallback(async(i,s)=>{var o,l,d;try{if(!i||!e)throw new Error("Source or Session not found");a(!0);const u=((o=i.position)==null?void 0:o.x)||0,p=(((l=i.position)==null?void 0:l.y)||0)+(((d=i.measured)==null?void 0:d.height)||0),h=await ue("Prompt").save({content:s.content,prefix:s.prefix,role:s.role||Ot.System,status:$t.Started,session_id:e,type:s.type||Tt.Chat});if(!h)throw new Error("Failed to save prompt");if(!await t({source_id:h.id,source_type:"Prompt",node_type:V.Prompt,x:u,y:p+20}))throw new Error("Failed to save prompt node")}finally{a(!1)}},[e,t]);return{loading:r,createPrompt:n}},pf={[Tt.Chat]:{label:"add_prompt_card.prompt_types.chat",value:Tt.Chat},[Tt.FewShotExample]:{label:"add_prompt_card.prompt_types.few_shot_example",value:Tt.FewShotExample}},mf={[Ot.System]:{label:"add_prompt_card.prompt_roles.system",value:Ot.System},[Ot.Human]:{label:"add_prompt_card.prompt_roles.human",value:Ot.Human},[Ot.AI]:{label:"add_prompt_card.prompt_roles.ai",value:Ot.AI}},js=w.memo(({defaultPromptContent:e,defaultPromptRole:r,defaultPromptType:a,hidePromptRole:t,hidePromptType:n,loading:i,onSubmit:s})=>{const[o,l]=w.useState(e||""),[d,u]=w.useState(a||Tt.Chat),[p,h]=w.useState(r),[v,f]=w.useState(""),{t:m}=Oe("components"),g=w.useCallback(E=>{l(E.target.value)},[]),b=w.useCallback(E=>{f(E.target.value)},[]),S=w.useCallback(E=>{E===Tt.FewShotExample&&l(`Question: {input}
Answer: {output}`),u(E)},[]),O=w.useCallback(E=>{h(E)},[]),x=async()=>{await s({content:o,role:p,prefix:v,type:d})&&(l(""),h(void 0),u("chat"),f(""))};return c.jsxs("div",{children:[c.jsxs("div",{className:"grid w-full gap-1.5",children:[n?void 0:c.jsxs(c.Fragment,{children:[c.jsx(we,{children:m("add_prompt_card.prompt_type")}),c.jsxs(rr,{value:d,onValueChange:S,children:[c.jsx(ar,{className:"w-full mb-4",children:c.jsx(nr,{placeholder:m("add_prompt_card.type_select_placeholder")})}),c.jsx(sr,{children:Object.values(pf).map(E=>c.jsx(yt,{value:E.value,children:m(E.label)},E.value))})]})]}),t?void 0:c.jsxs(c.Fragment,{children:[c.jsx(we,{children:m("add_prompt_card.prompt_role")}),c.jsxs(rr,{value:p,onValueChange:O,children:[c.jsx(ar,{className:"w-full mb-4",children:c.jsx(nr,{placeholder:m("add_prompt_card.role_select_placeholder")})}),c.jsx(sr,{children:Object.values(mf).map(E=>c.jsx(yt,{value:E.value,children:m(E.label)},E.value))})]})]}),d===Tt.FewShotExample&&c.jsxs(c.Fragment,{children:[c.jsx(we,{children:m("add_prompt_card.prompt_prefix")}),c.jsx(Kr,{value:v,onChange:b,disabled:!1,className:"h-20",placeholder:m("add_prompt_card.placeholder"),id:"message"}),c.jsx(we,{children:m("add_prompt_card.prompt_content")}),c.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm justify-end items-center",children:[c.jsx(ve,{name:"info",className:"mr-2",size:14}),m("add_prompt_card.few_shot_example_note")]})]}),c.jsx(Kr,{value:o,onChange:g,disabled:!1,placeholder:m("add_prompt_card.placeholder"),id:"message"})]}),c.jsx("div",{children:c.jsx(zt,{loading:i,disabled:!(o!=null&&o.length),onClick:x,className:"w-full mt-4",children:m("add_prompt_card.button")})})]})}),ff=w.memo(e=>{const{id:r,thread:a,setDialog:t}=e,{t:n}=Oe("components"),{toast:i}=xt(),s=lt(r),{createPrompt:o,loading:l}=Al(),d=async u=>{if(s)try{if(!(u!=null&&u.content))throw new Error("Prompt data is missing");await o(s,{...u,content:u.content,thread:a}),t==null||t(!1)}catch(p){i({variant:"destructive",title:`${p}`})}};return c.jsxs(Ge,{className:"mw-full",children:[c.jsx(pt,{children:c.jsx(gt,{children:n("add_prompt_card.title")})}),c.jsx(mt,{children:c.jsx(js,{onSubmit:d,loading:l,defaultPromptRole:"system",defaultPromptType:"chat"})})]})}),vf=()=>{const e=et(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=w.useState(!1),t=me(s=>s.createOrUpdateFlowNode),n=w.useCallback((s,o,l,d)=>{var u;if(e){for(const p of o)(u=p.data)!=null&&u.length?n(s,p.data,l,p.id):l.push({name:p.name,type:p.type,enum:p.enum?JSON.stringify(p.enum):"",required:p.required,description:p.description,id:p.id||ts(),parent_id:d,schema_id:s,session_id:e});return l}},[e]),i=w.useCallback(async(s,o)=>{var l,d,u;try{if(!s||!e)throw new Error("Source or Session not found");a(!0);const p=((l=s.position)==null?void 0:l.x)||0,h=(((d=s.position)==null?void 0:d.y)||0)+(((u=s.measured)==null?void 0:u.height)||0),v=await ue("Schema").save({name:"Untitled Schema",session_id:e});if(!v)throw new Error("Failed to save schema");const f=n(v.id,o,[],void 0);if(!(f!=null&&f.length))throw new Error("Failed to convert schema items");if(await ue("SchemaItem").save(f),!await t({source_id:v.id,source_type:"Schema",node_type:V.Schema,x:p,y:h+20}))throw new Error("Failed to save schema node")}finally{a(!1)}},[e,n,t]);return{loading:r,createSchema:i}},Rl=w.memo(({setData:e,data:r,id:a})=>{const{t}=Oe("components"),[n,i]=w.useState({name:"",description:"",type:"string",required:!1,data:[]}),s=w.useMemo(()=>a&&r.find(m=>m.id===a)||n,[r,n,a]),o=w.useCallback(m=>{m.target.value&&!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(m.target.value)||(a?e(g=>[...g.map(b=>b.id===a?{...b,name:m.target.value||""}:b)]):i(g=>({...g,name:m.target.value||""})))},[a,e]),l=w.useCallback(m=>{a?e(g=>[...g.map(b=>b.id===a?{...b,description:m.target.value||""}:b)]):i(g=>({...g,description:m.target.value||""}))},[a,e]),d=w.useCallback(m=>{a?e(g=>[...g.map(b=>b.id===a?{...b,type:m||""}:b)]):i(g=>({...g,type:m||"string"}))},[a,e]),u=w.useCallback(m=>{a?e(g=>[...g.map(b=>b.id===a?{...b,required:!!m||!1}:b)]):i(g=>({...g,required:!!m||!1}))},[a,e]),p=w.useCallback(m=>{a?e(g=>[...g.map(b=>b.id===a?{...b,enum:m.target.value||""}:b)]):i(g=>({...g,enum:m.target.value||""}))},[a,e]),h=w.useCallback(()=>{if(r.find(m=>m.name===n.name))return Wr({variant:"destructive",content:"Name already exists"});n.id=ts(),e(m=>[...m,{...n}]),i({name:"",description:"",type:"string",required:!1,id:ts(),parent:a||void 0,data:[]})},[r,n,e,a]),v=w.useCallback(m=>{e(g=>[...g.map(b=>b.id===a?{...b,data:m(b.data||[])}:b)])},[a,e]),f=["object","array"].includes(s.type);return c.jsxs("div",{className:"w-full p-1",children:[c.jsxs("div",{children:[c.jsx(we,{children:t("add_schema_card.field.name")}),c.jsx(nt,{id:"name",onChange:o,placeholder:t("add_schema_card.field.name_placeholder"),value:(s==null?void 0:s.name)||""})]}),c.jsxs("div",{children:[c.jsx(we,{children:t("add_schema_card.field.description")}),c.jsx(nt,{id:"description",placeholder:t("add_schema_card.field.description_placeholder"),onChange:l,value:(s==null?void 0:s.description)||""})]}),c.jsxs("div",{children:[c.jsx(we,{children:t("add_schema_card.field.type")}),c.jsxs(rr,{onValueChange:d,value:(s==null?void 0:s.type)||"",children:[c.jsx(ar,{children:c.jsx(nr,{placeholder:t("add_schema_card.field.type_placeholder")})}),c.jsxs(sr,{children:[c.jsx(yt,{value:"string",children:t("add_schema_card.types.string")}),c.jsx(yt,{value:"boolean",children:t("add_schema_card.types.boolean")}),c.jsx(yt,{value:"number",children:t("add_schema_card.types.number")}),c.jsx(yt,{value:"object",children:t("add_schema_card.types.object")}),c.jsx(yt,{value:"array",children:t("add_schema_card.types.array")})]})]})]}),c.jsxs("div",{className:"flex items-center h-10",children:[c.jsx(we,{children:t("add_schema_card.field.required")}),c.jsx(xs,{className:"ml-2","aria-label":"Select row",onCheckedChange:u,checked:s==null?void 0:s.required})]}),f?c.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[c.jsx(we,{children:t("add_schema_card.children")}),c.jsx(pn,{data:(s==null?void 0:s.data)||[],setData:v})]}):null,(s==null?void 0:s.type)==="enum"?c.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[c.jsx(we,{children:t("add_schema_card.field.enum")}),c.jsx(nt,{id:"enum",onChange:p,placeholder:"Enum"})]}):null,a?null:c.jsx("div",{className:"w-full flex justify-end mt-2",children:c.jsx(Ve,{variant:"secondary",disabled:!s.name||!s.description||!s.type,onClick:h,className:"w-full",children:t("add_schema_card.field.add_field")})})]})}),pn=w.memo(({data:e,setData:r,className:a=""})=>{const t=w.useCallback(()=>{},[]),n=r||t;return c.jsxs(yb,{type:"single",collapsible:!0,className:"mb-4",children:[e.map(i=>c.jsxs(_b,{value:`${i.id}`,children:[c.jsx(wb,{children:i.name}),c.jsx(bb,{children:c.jsx(Rl,{setData:n,data:e,id:i.id})})]},i.id||"new")),r?c.jsx(Ge,{className:Fe("p-2 mt-4",a),children:c.jsx(Rl,{setData:n,data:e})}):void 0]})}),gf=w.memo(e=>{const{t:r}=Oe("components"),{id:a}=e,t=lt(a),[n,i]=w.useState([]),{createSchema:s,loading:o}=vf(),l=async()=>{if(t&&(n!=null&&n.length))try{await s(t,n),i([])}catch(d){Wr({variant:"destructive",title:`${d}`})}};return c.jsxs(Ge,{className:"max-w-lg",children:[c.jsx(pt,{children:c.jsx(gt,{children:r("add_schema_card.title")})}),c.jsx(mt,{className:"min-w-96",children:c.jsx(pn,{setData:i,data:n})}),c.jsx($r,{className:"flex justify-between",children:c.jsx(zt,{loading:o,disabled:!(n!=null&&n.length),onClick:l,className:"w-full",children:r("add_schema_card.create")})})]})}),Fl=()=>{const e=et(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[r,a]=w.useState(!1),t=me(i=>i.createOrUpdateFlowNode),n=w.useCallback(async(i,s,o)=>{var l,d,u;try{if(!i||!e)throw new Error("Source or Session not found");a(!0);const p=((l=i.position)==null?void 0:l.x)||0,h=(((d=i.position)==null?void 0:d.y)||0)+(((u=i.measured)==null?void 0:u.height)||0),v=xx(s,o),f=await ue("CSVData").save({headers:v.headers,csv:v.data,session_id:e});if(!f)throw new Error("Failed to save");if(!await t({source_id:f.id,source_type:"CSVData",node_type:V.CSVData,x:p,y:h+20}))throw new Error("Failed to save node")}finally{a(!1)}},[e,t]);return{loading:r,createCSVData:n}};function yf({data:e}){const{t:r}=Oe("components");return c.jsxs(zh,{className:"w-full",children:[c.jsx(Uh,{children:c.jsxs(Wn,{children:[c.jsx(Eo,{children:r("add_few_shot_example_card.input")}),c.jsx(Eo,{children:r("add_few_shot_example_card.output")})]})}),c.jsx(Hh,{children:e==null?void 0:e.map((a,t)=>c.jsxs(Wn,{children:[c.jsx(ko,{className:"p-4",children:a.input}),c.jsx(ko,{className:"p-4",children:a.output})]},`${a.input}_${a.output}_${t}`))})]})}const _f=w.memo(e=>{const{id:r}=e,{t:a}=Oe("components"),[t,n]=w.useState([]),[i,s]=w.useState(""),[o,l]=w.useState(""),d=lt(r),{createCSVData:u,loading:p}=Fl(),h=()=>{n(f=>[...f,{input:i,output:o}]),s(""),l("")},v=async()=>{d&&await u(d,["input","output"],t.map(f=>[f.input,f.output]))};return c.jsxs(Ge,{className:"mw-full",children:[c.jsx(pt,{children:c.jsx(gt,{children:a("add_few_shot_example_card.title")})}),c.jsxs(mt,{children:[c.jsxs("div",{className:"flex flex-col space-y-1.5",children:[c.jsx(we,{htmlFor:"name",children:a("add_few_shot_example_card.input")}),c.jsx(nt,{value:i,onChange:f=>s(f.target.value||""),id:"name",placeholder:a("add_few_shot_example_card.input_placeholder")})]}),c.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[c.jsx(we,{htmlFor:"name",children:a("add_few_shot_example_card.output")}),c.jsx(Kr,{value:o,onChange:f=>l(f.target.value||""),placeholder:a("add_few_shot_example_card.output_placeholder")})]}),c.jsx("div",{className:"w-full flex mt-4 justify-end",children:c.jsx(Ve,{disabled:!i||!o,onClick:h,className:"w-40",children:a("add_few_shot_example_card.add")})}),c.jsx(yf,{data:t||[]})]}),c.jsx($r,{className:"flex justify-between",children:c.jsx(zt,{loading:p,disabled:!(t!=null&&t.length),onClick:v,className:"w-full",children:a("add_few_shot_example_card.create")})})]})}),wf=()=>{const e=et(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=w.useState(!1),t=me(s=>s.createOrUpdateFlowNode),n=me(s=>s.createOrUpdateFlowEdge),i=w.useCallback(async(s,o,l)=>{var d,u,p;try{if(!s||!e)throw new Error("Source or Session not found");if(!o.name||!o.description)throw new Error("Name is required");a(!0);const h=((d=s.position)==null?void 0:d.x)||0,v=(((u=s.position)==null?void 0:u.y)||0)+(((p=s.measured)==null?void 0:p.height)||0),f=await ue("ToolDefinition").save({...o,name:`${o.name}`,description:`${o.description}`,session_id:e});if(!f)throw new Error("Failed create tool.");const m=await t({source_id:f.id,source_type:"ToolDefinition",node_type:V.ToolDefinition,x:h,y:v+20});if(!m)throw new Error("Failed to save node");l!=null&&l.schemaNode&&await n({source:l.schemaNode.id,target:m.id})}finally{a(!1)}},[e,t,n]);return{loading:r,createTool:i}},Dl=[{name:"speak",description:"Speak text using the browser's speech synthesis API.",handler:`
const text = input.text || '';
const voice = input.voice;
const utter = new window.SpeechSynthesisUtterance(text);
  if (voice) {
    const voices = window.speechSynthesis.getVoices();
    const match = voices.find((v) => v.name === voice);
    if (match) utter.voice = match;
  }
window.speechSynthesis.speak(utter);
  `,schema:[{name:"text",type:"string",description:"The text to speak.",required:!0},{name:"voice",type:"string",description:"The voice to use for speech synthesis.",required:!1}]},{name:"get_location",description:"Get the current location of the user.",handler:`
const location = await (new Promise((resolve, reject) => {
    if (!navigator.geolocation) {
      reject("Geolocation not supported.");
      return;
    }
    navigator.geolocation.getCurrentPosition(
      (pos) =>
        resolve({
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
        }),
      (err) => reject(err.message || "Geolocation error"),
    );
  }));
  return location;
`,schema:[]},{name:"sleep",description:"Sleep for a specified number of seconds.",handler:`
const seconds = input.seconds || 1;
await (new Promise((resolve) => setTimeout(resolve, seconds * 1000)));
`,schema:[{name:"seconds",type:"number",description:"The number of seconds to sleep.",required:!1}]},{name:"get_time",description:"Get the current date and time.",handler:`
const now = new Date();
return now.toISOString();
`,schema:[]},{name:"math_eval",description:"Evaluate a math expression.",handler:`
const expression = input.expression || '';
// Only allow numbers, spaces, and math symbols: + - * / % ( ) .
if (!/^[\\d\\s+\\-*/%.()]+$/.test(expression)) {
  throw new Error("Invalid characters in expression.");
}
return Function('"use strict";return (' + expression + ")")();
`,schema:[{name:"expression",type:"string",description:'he math expression (e.g., \\"2 + 2 * (3 - 1)\\").',required:!0}]}],bf=w.lazy(()=>jt(()=>import("./CodeEditor-Bbk9oTWl.js"),__vite__mapDeps([7,2,3,8]))),xf=w.memo(e=>{const{t:r}=Oe("components"),{toast:a}=xt(),{id:t}=e,n=lt(t),[i,s]=w.useState(""),[o,l]=w.useState(""),[d,u]=w.useState([]),[p,h]=w.useState(""),{createTool:v,loading:f}=wf(),m=x=>{s(x.target.value)},g=x=>{l(x.target.value)},b=async()=>{if(n&&i&&o)try{await v(n,{name:i,description:o,schema:d,handler:p}),s(""),l("")}catch(x){tr("Create Tool",x),a({variant:"destructive",title:r("add_tool_card.errors.create_tool_failed")})}},S=x=>{if(x==="_EMPTY_"){s(""),l(""),u([]),h("");return}const E=Dl.find($=>$.name===x);E?(s(E.name),l(E.description),u(E.schema.map($=>({...$,id:$.id||ts()}))),h(E.handler)):(tr("Create Tool",`Predefined tool "${x}" not found`),a({variant:"destructive",title:r("add_tool_card.errors.predefine_tool_not_found")}))},O=w.useMemo(()=>({minimap:{enabled:!1}}),[]);return c.jsxs(Ge,{className:"mw-full",children:[c.jsx(pt,{children:c.jsx(gt,{children:r("add_tool_card.title")})}),c.jsxs(mt,{children:[c.jsxs("div",{className:"flex flex-col space-y-1.5",children:[c.jsx(we,{htmlFor:"name",children:r("add_tool_card.tool_name")}),c.jsx(nt,{onChange:m,id:"name",placeholder:r("add_tool_card.name_placeholder")})]}),c.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[c.jsx(we,{htmlFor:"name",children:r("add_tool_card.tool_description")}),c.jsx(Kr,{onChange:g,placeholder:r("add_tool_card.description_placeholder")})]}),c.jsx("div",{className:"mt-4",children:c.jsxs(rr,{onValueChange:S,children:[c.jsx(ar,{className:"",children:c.jsx(nr,{placeholder:r("add_tool_card.predefine_tool_placeholder")})}),c.jsxs(sr,{children:[c.jsx(yt,{value:"_EMPTY_",children:"Empty"},"_EMPTY_"),Dl.map(x=>c.jsxs(yt,{value:x.name,children:[x.name,c.jsx("br",{}),c.jsx("span",{className:"text-xs text-muted-foreground",children:x.description})]},x.name))]})]})}),c.jsxs(Zn,{defaultValue:"account",className:"w-full mt-4",children:[c.jsxs(xb,{className:"grid w-full grid-cols-2",children:[c.jsx(ir,{value:"account",children:r("add_tool_card.tool_schema")}),c.jsx(ir,{value:"password",children:r("add_tool_card.handler")})]}),c.jsx(or,{value:"account",children:c.jsx(Ge,{className:"p-4",children:c.jsx(pn,{className:"mt-0",data:d,setData:u})})}),c.jsx(or,{value:"password",children:c.jsx(Ge,{className:"p-4 max-w-full",children:c.jsx(w.Suspense,{children:c.jsx(bf,{content:p,setContent:h,className:"h-40",language:"javascript",options:O})})})})]})]}),c.jsx($r,{className:"flex justify-between",children:c.jsx(zt,{loading:f,onClick:b,className:"w-full",children:r("add_tool_card.create")})})]})}),jf=()=>{const e=et(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=w.useState(!1),t=me(s=>s.createOrUpdateFlowNode),n=me(s=>s.createOrUpdateFlowEdge),i=w.useCallback(async(s,o,l)=>{var d,u,p;try{if(!(o!=null&&o.name)||!s||!e)throw new Error("Source or Session not found");a(!0);const h=((d=s.position)==null?void 0:d.x)||0,v=(((u=s.position)==null?void 0:u.y)||0)+(((p=s.measured)==null?void 0:p.height)||0),f=await ue("VectorDatabase").save({...o,name:`${o.name}`,type:o.type||jx.Local,storage:o.storage||Tr.DatabaseNode,raw:"",provider:o.provider||ep.Memory,session_id:e,metadata:l?JSON.stringify({textSplitter:l}):void 0});if(!f)throw new Error("Failed to save vectorDatabase");const m=await t({source_id:f.id,source_type:"VectorDatabase",node_type:V.VectorDatabase,x:h,y:v+30});if(!m)throw new Error("Failed to save vectorDatabase node");if(o.storage===Tr.DataNode){const g=await ue("JSONLData").save({headers:Sx(["content","embedding","metadata"]),jsonl:"",session_id:e});if(!g)throw new Error("Failed to save databaseSource");const b=await t({source_id:g.id,source_type:"JSONLData",node_type:V.JSONLData,x:h+80,y:v+30});if(!b)throw new Error("Failed to save databaseSource node");await n({source:b.id,target:m.id})}return{vectorDatabase:f,vectorDatabaseNode:m}}finally{a(!1)}},[e,t,n]);return{loading:r,createVectorDatabase:i}},Oa=[ep.Memory],Ta=[Tr.DatabaseNode],Sf=["TokenTextSplitter","CharacterTextSplitter","RecursiveCharacterTextSplitter"],Ef=w.memo(e=>{const{t:r}=Oe("components"),{id:a}=e,t=lt(a),{toast:n}=xt(),[i,s]=w.useState(""),[o,l]=w.useState(Oa[0]),[d,u]=w.useState(Ta[0]),[p,h]=w.useState({}),{loading:v,createVectorDatabase:f}=jf(),m=w.useCallback($=>{l($)},[]),g=w.useCallback($=>{u($)},[]),b=w.useCallback($=>{h(C=>({...C,type:$,chunkSize:500,chunkOverlap:40}))},[]),S=w.useCallback($=>{s($.target.value||"")},[]),O=w.useCallback($=>{h(C=>({...C,chunkSize:Number($.target.value)}))},[]),x=w.useCallback($=>{h(C=>({...C,chunkOverlap:Number($.target.value)}))},[]),E=async()=>{try{if(!t)return;await f(t,{name:i,provider:o,storage:d},p!=null&&p.type?{type:p.type,chunkSize:p.chunkSize||500,chunkOverlap:p.chunkOverlap||0}:void 0),s(""),h({})}catch{n({variant:"destructive",description:r("create_vector_database_card.errors.create_failed")})}};return c.jsxs(Ge,{className:"mw-full",children:[c.jsx(pt,{children:c.jsx(gt,{children:r("create_vector_database_card.title")})}),c.jsx(mt,{children:c.jsxs("div",{className:"grid w-full gap-1.5",children:[c.jsx(we,{children:r("create_vector_database_card.name")}),c.jsx(nt,{className:"mb-4",value:i,onChange:S}),(Ta==null?void 0:Ta.length)>1?c.jsxs(c.Fragment,{children:[c.jsx(we,{children:r("create_vector_database_card.storage_type")}),c.jsxs(rr,{value:d,onValueChange:g,children:[c.jsx(ar,{className:"w-full mb-4",children:c.jsx(nr,{placeholder:r("create_vector_database_card.provider_select_placeholder")})}),c.jsx(sr,{children:Object.values(Ta).map($=>c.jsx(yt,{value:$,children:r(`create_vector_database_card.storage_types.${$.toLowerCase()}`)},$))})]})]}):void 0,(Oa==null?void 0:Oa.length)>1?c.jsxs(c.Fragment,{children:[c.jsx(we,{children:r("create_vector_database_card.provider")}),c.jsxs(rr,{value:o,onValueChange:m,children:[c.jsx(ar,{className:"w-full mb-4",children:c.jsx(nr,{placeholder:r("create_vector_database_card.provider_select_placeholder")})}),c.jsx(sr,{children:Object.values(Oa).map($=>c.jsx(yt,{value:$,children:r(`create_vector_database_card.providers.${$.toLowerCase()}`)},$))})]})]}):void 0,c.jsx(we,{children:r("create_vector_database_card.text_splitter")}),c.jsxs(rr,{value:p.type,onValueChange:b,children:[c.jsx(ar,{className:"w-full mb-4",children:c.jsx(nr,{placeholder:r("create_vector_database_card.text_splitter_select_placeholder")})}),c.jsx(sr,{children:Object.values(Sf).map($=>c.jsx(yt,{value:$,children:r(`create_vector_database_card.text_splitters.${$.toLowerCase()}`)},$))})]}),p.type?c.jsxs(Ge,{children:[c.jsx(pt,{children:c.jsx(gt,{children:r("create_vector_database_card.text_splitter_configuration")})}),c.jsxs(mt,{children:[c.jsx(we,{children:r("create_vector_database_card.text_splitter_chunksize")}),c.jsx(nt,{value:p.chunkSize,onChange:O,placeholder:r("create_vector_database_card.text_splitter_chunksize_placeholder")}),c.jsx(we,{children:r("create_vector_database_card.text_splitter_chunkoverlap")}),c.jsx(nt,{value:p.chunkOverlap,onChange:x,placeholder:r("create_vector_database_card.text_splitter_chunkoverlap_placeholder")})]})]}):void 0]})}),c.jsx($r,{className:"flex justify-between",children:c.jsx(zt,{disabled:!p.type||!i,loading:v,onClick:E,className:"w-full",children:r("create_vector_database_card.create")})})]})});function kf({data:e}){const{t:r}=Oe("components");return c.jsxs(zh,{className:"w-full",children:[c.jsx(Uh,{children:c.jsx(Wn,{children:c.jsx(Eo,{children:r("add_text_data.text")})})}),c.jsx(Hh,{children:e==null?void 0:e.map((a,t)=>c.jsx(Wn,{children:c.jsx(ko,{className:"p-4",children:a.text})},`${a.text}_${t}`))})]})}const Pf=w.memo(e=>{const{id:r}=e,{t:a}=Oe("components"),[t,n]=w.useState([]),[i,s]=w.useState(""),o=lt(r),{createCSVData:l,loading:d}=Fl(),u=()=>{n(h=>[...h,{text:i}]),s("")},p=async()=>{o&&await l(o,["text"],t.map(h=>[h.text]))};return c.jsxs(Ge,{className:"mw-full",children:[c.jsx(pt,{children:c.jsx(gt,{children:a("add_text_data.title")})}),c.jsxs(mt,{children:[c.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[c.jsx(we,{htmlFor:"name",children:a("add_text_data.text")}),c.jsx(Kr,{value:i,onChange:h=>s(h.target.value||""),placeholder:a("add_text_data.text_placeholder")})]}),c.jsx("div",{className:"w-full flex mt-4 justify-end",children:c.jsx(Ve,{disabled:!i,onClick:u,className:"w-40",children:a("add_text_data.add")})}),c.jsx(kf,{data:t||[]})]}),c.jsx($r,{className:"flex justify-between",children:c.jsx(zt,{loading:d,disabled:!(t!=null&&t.length),onClick:p,className:"w-full",children:a("add_text_data.create")})})]})});var Ht=(e=>(e.ADD_LLM="ADD_LLM",e.ADD_PROMPT="ADD_PROMPT",e.ADD_TOOL_DEFINITION="ADD_TOOL_DEFINITION",e.ADD_SCHEMA="ADD_SCHEMA",e.ADD_FEW_SHOT_EXAMPLE="ADD_FEW_SHOT_EXAMPLE",e.ADD_VECTOR_DATABASE="ADD_VECTOR_DATABASE",e.ADD_TEXT_DATA="ADD_TEXT_DATA",e.ADD_MCP="ADD_MCP",e.ADD_BASIC_AGENT="ADD_BASIC_AGENT",e))(Ht||{});const Nf=["ADD_LLM","ADD_PROMPT","ADD_SCHEMA","ADD_VECTOR_DATABASE","ADD_BASIC_AGENT",{key:"more",label:"more",icon:"ellipsis",children:["ADD_TOOL_DEFINITION","ADD_MCP","ADD_FEW_SHOT_EXAMPLE"]}],Cf=()=>{const e="_coolMode_effect",r=document.getElementById(e);if(r)return r;const a=document.createElement("div");return a.setAttribute("id",e),a.setAttribute("style","overflow:hidden; position:fixed; height:100%; top:0; left:0; right:0; bottom:0; pointer-events:none; z-index:2147483647"),document.body.appendChild(a),a};let Ml=0;const $f=(e,r)=>{Ml++;const a=(r==null?void 0:r.particle)||"circle",t=[15,20,25,35,45],n=45;let i=[],s=!1,o=0,l=0;const d=Cf();function u(){const C=(r==null?void 0:r.size)||t[Math.floor(Math.random()*t.length)],R=(r==null?void 0:r.speedHorz)||Math.random()*10,D=(r==null?void 0:r.speedUp)||Math.random()*25,L=Math.random()*360,T=Math.random()*35*(Math.random()<=.5?-1:1),z=l-C/2,M=o-C/2,H=Math.random()<=.5?-1:1,B=document.createElement("div");if(a==="circle"){const ee="http://www.w3.org/2000/svg",J=document.createElementNS(ee,"svg"),se=document.createElementNS(ee,"circle");se.setAttributeNS(null,"cx",(C/2).toString()),se.setAttributeNS(null,"cy",(C/2).toString()),se.setAttributeNS(null,"r",(C/2).toString()),se.setAttributeNS(null,"fill",`hsl(${Math.random()*360}, 70%, 50%)`),J.appendChild(se),J.setAttribute("width",C.toString()),J.setAttribute("height",C.toString()),B.appendChild(J)}else B.innerHTML=`<img src="${a}" width="${C}" height="${C}" style="border-radius: 50%">`;B.style.position="absolute",B.style.transform=`translate3d(${M}px, ${z}px, 0px) rotate(${L}deg)`,d.appendChild(B),i.push({direction:H,element:B,left:M,size:C,speedHorz:R,speedUp:D,spinSpeed:T,spinVal:L,top:z})}function p(){i.forEach(C=>{C.left=C.left-C.speedHorz*C.direction,C.top=C.top-C.speedUp,C.speedUp=Math.min(C.size,C.speedUp-1),C.spinVal=C.spinVal+C.spinSpeed,C.top>=Math.max(window.innerHeight,document.body.clientHeight)+C.size&&(i=i.filter(R=>R!==C),C.element.remove()),C.element.setAttribute("style",["position:absolute","will-change:transform",`top:${C.top}px`,`left:${C.left}px`,`transform:rotate(${C.spinVal}deg)`].join(";"))})}let h,v=0;const f=30;function m(){const C=performance.now();s&&i.length<n&&C-v>f&&(u(),v=C),p(),h=requestAnimationFrame(m)}m();const g="ontouchstart"in window,b=g?"touchstart":"mousedown",S=g?"touchend":"mouseup",O=g?"touchmove":"mousemove",x=C=>{var R,D;"touches"in C?(o=(R=C.touches)==null?void 0:R[0].clientX,l=(D=C.touches)==null?void 0:D[0].clientY):(o=C.clientX,l=C.clientY)},E=C=>{x(C),s=!0},$=()=>{s=!1};return e.addEventListener(O,x,{passive:!0}),e.addEventListener(b,E,{passive:!0}),e.addEventListener(S,$,{passive:!0}),e.addEventListener("mouseleave",$,{passive:!0}),()=>{e.removeEventListener(O,x),e.removeEventListener(b,E),e.removeEventListener(S,$),e.removeEventListener("mouseleave",$);const C=setInterval(()=>{h&&i.length===0&&(cancelAnimationFrame(h),clearInterval(C),--Ml===0&&d.remove())},500)}},Of=({children:e,options:r})=>{const a=w.useRef(null);return w.useEffect(()=>{if(a.current)return $f(a.current,r)},[r]),Qa.cloneElement(e,{ref:a})},Tf=w.memo(({loading:e,onSubmit:r})=>{const[a,t]=w.useState(""),[n,i]=w.useState(""),{t:s}=Oe("components"),o=async()=>{await r({key:a,url:n})&&(t(""),i(""))};return c.jsxs("div",{children:[c.jsxs("div",{className:"grid w-full gap-1.5",children:[c.jsx(we,{className:"mb-2",children:s("add_mcp_card.key")}),c.jsx(nt,{disabled:e,value:a||"",onChange:l=>t(l.target.value||""),className:"!text-foreground"}),c.jsx(we,{className:"mb-2",children:s("add_mcp_card.url")}),c.jsx(nt,{disabled:e,value:n||"",onChange:l=>i(l.target.value||""),className:"!text-foreground"})]}),c.jsx("div",{children:c.jsx(zt,{loading:e,disabled:!(a!=null&&a.length)||!(n!=null&&n.length),onClick:o,className:"w-full mt-4",children:s("add_mcp_card.button")})})]})}),If=()=>{const e=et(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[r,a]=w.useState(!1),t=me(i=>i.createOrUpdateFlowNode),n=w.useCallback(async(i,s)=>{var o,l,d;try{if(!i||!e)throw new Error("Source or Session not found");if(!s.key||!s.url)throw new Error("MCP data is missing");a(!0);const u=((o=i.position)==null?void 0:o.x)||0,p=(((l=i.position)==null?void 0:l.y)||0)+(((d=i.measured)==null?void 0:d.height)||0),h=await ue("Mcp").save({key:s.key,url:s.url,session_id:e});if(!h)throw new Error("Failed to save MCP");if(!await t({source_id:h.id,source_type:"Mcp",node_type:V.MCP,x:u,y:p+20}))throw new Error("Failed to save MCP node")}finally{a(!1)}},[e,t]);return{loading:r,createMcp:n}},Lf=w.memo(e=>{const{id:r,setDialog:a}=e,{t}=Oe("components"),{toast:n}=xt(),i=lt(r),{createMcp:s,loading:o}=If(),l=async d=>{if(i)try{if(!(d!=null&&d.url)||!(d!=null&&d.key))throw new Error("MCP data is missing");await s(i,d),a==null||a(!1)}catch(u){n({variant:"destructive",title:`${u}`})}};return c.jsxs(Ge,{className:"mw-full",children:[c.jsx(pt,{children:c.jsx(gt,{children:t("add_mcp_card.title")})}),c.jsxs(mt,{className:"max-w-lg nodrag nowheel",children:[c.jsx(Tf,{onSubmit:l,loading:o}),c.jsx(up,{className:"mt-4 mb-2"}),c.jsx(we,{className:"text-lg",children:t("add_mcp_card.faq")}),c.jsx(up,{className:"mb-4 mt-2"}),c.jsx(Ka,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(Xa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(we,{children:t("add_mcp_card.note.title")})}),c.jsx("div",{children:c.jsx(ve,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Ya,{children:c.jsx(ja,{source:t("add_mcp_card.note.detail")})})]})}),c.jsx(Ka,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(Xa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(we,{children:t("add_mcp_card.filesystem.title")})}),c.jsx("div",{children:c.jsx(ve,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Ya,{children:c.jsx(ja,{source:t("add_mcp_card.filesystem.detail")})})]})}),c.jsx(Ka,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(Xa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(we,{children:t("add_mcp_card.memory.title")})}),c.jsx("div",{children:c.jsx(ve,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Ya,{children:c.jsx(ja,{source:t("add_mcp_card.memory.detail")})})]})}),c.jsx(Ka,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(Xa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(we,{children:t("add_mcp_card.playwright.title")})}),c.jsx("div",{children:c.jsx(ve,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Ya,{children:c.jsx(ja,{source:t("add_mcp_card.playwright.detail")})})]})}),c.jsx(Ka,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(Xa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(we,{children:t("add_mcp_card.figma.title")})}),c.jsx("div",{children:c.jsx(ve,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Ya,{children:c.jsx(ja,{source:t("add_mcp_card.figma.detail")})})]})})]})]})}),Af=()=>{const e=et(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[r,a]=w.useState(!1),t=me(i=>i.createOrUpdateFlowNode),n=w.useCallback(async(i,s)=>{var o,l,d;try{if(!i||!e)throw new Error("Source or Session not found");if(!s.name.trim())throw new Error("Name is required");a(!0);const u=((o=i.position)==null?void 0:o.x)||0,p=(((l=i.position)==null?void 0:l.y)||0)+(((d=i.measured)==null?void 0:d.height)||0),h=await ue("BasicAgent").save({name:s.name.trim(),description:s.description.trim(),system_prompt:s.system_prompt.trim(),max_iterations:s.max_iterations||10,session_id:e});if(!h)throw new Error("Failed to save basic agent");if(!await t({source_id:h.id,source_type:"BasicAgent",node_type:V.BasicAgent,x:u,y:p+20}))throw new Error("Failed to save basic agent node");return h}finally{a(!1)}},[e,t]);return{loading:r,createBasicAgent:n}},zl=`You are helpful agents.
Use tools to solve user requirement.`,Rf=w.memo(({loading:e,onSubmit:r})=>{const[a,t]=w.useState(""),[n,i]=w.useState(""),[s,o]=w.useState(zl),[l,d]=w.useState(10),{t:u}=Oe("components"),p=w.useCallback(g=>{t(g.target.value)},[]),h=w.useCallback(g=>{i(g.target.value)},[]),v=w.useCallback(g=>{o(g.target.value)},[]),f=w.useCallback(g=>{const b=parseInt(g.target.value,10);!isNaN(b)&&b>0&&d(b)},[]),m=async()=>{a.trim()&&await r({name:a,description:n,system_prompt:s,max_iterations:l})&&(t(""),i(""),o(zl),d(10))};return c.jsxs("div",{children:[c.jsxs("div",{className:"grid w-full gap-4",children:[c.jsxs("div",{className:"grid gap-1.5",children:[c.jsxs(we,{htmlFor:"name",children:[u("add_basic_agent_card.name")," *"]}),c.jsx(nt,{id:"name",value:a,onChange:p,placeholder:u("add_basic_agent_card.name_placeholder"),required:!0})]}),c.jsxs("div",{className:"grid gap-1.5",children:[c.jsx(we,{htmlFor:"description",children:u("add_basic_agent_card.description")}),c.jsx(Kr,{id:"description",value:n,onChange:h,placeholder:u("add_basic_agent_card.description_placeholder"),className:"h-20"})]}),c.jsxs("div",{className:"grid gap-1.5",children:[c.jsx(we,{htmlFor:"system_prompt",children:u("add_basic_agent_card.system_prompt")}),c.jsx(Kr,{id:"system_prompt",value:s,onChange:v,placeholder:u("add_basic_agent_card.system_prompt_placeholder"),className:"h-32"})]}),c.jsxs("div",{className:"grid gap-1.5",children:[c.jsx(we,{htmlFor:"max_iterations",children:u("add_basic_agent_card.max_iterations")}),c.jsx(nt,{id:"max_iterations",type:"number",min:"1",value:l,onChange:f,placeholder:"10"})]})]}),c.jsx("div",{children:c.jsx(zt,{loading:e,disabled:!a.trim(),onClick:m,className:"w-full mt-4",children:u("add_basic_agent_card.button")})})]})}),Ff=w.memo(e=>{const{id:r,setDialog:a}=e,{t}=Oe("components"),{toast:n}=xt(),i=lt(r),{createBasicAgent:s,loading:o}=Af(),l=async d=>{var u;if(i)try{if(!((u=d==null?void 0:d.name)!=null&&u.trim()))throw new Error("Agent name is required");await s(i,{name:d.name,description:d.description,system_prompt:d.system_prompt,max_iterations:d.max_iterations}),a==null||a(!1)}catch(p){n({variant:"destructive",title:`${p}`})}};return c.jsxs(Ge,{className:"mw-full",children:[c.jsx(pt,{children:c.jsx(gt,{children:t("add_basic_agent_card.title")})}),c.jsx(mt,{children:c.jsx(Rf,{onSubmit:l,loading:o})})]})}),Df=w.memo(e=>{const{t:r}=Oe("flows"),a=Ih(o=>o.theme),[t,n]=w.useState(`${Ht.ADD_LLM}`),i=w.useMemo(()=>c.jsxs(wl,{children:[c.jsx(ps,{children:c.jsx(Of,{children:c.jsx(Ve,{variant:"link",className:"!p-0 !pl-3",children:c.jsx(db,{width:32,height:32,className:Fe(a==="dark"?"fill-white":"fill-black")})})})}),Nf.map(o=>typeof o=="object"?c.jsxs(ps,{children:[c.jsx(ms,{children:o.icon?c.jsx(ve,{name:o.icon}):r(`supported_nodes.${o.label}`)}),c.jsx(bl,{children:o.children.map(l=>c.jsx(xl,{onClick:()=>n(l),children:r(`supported_nodes.${l.toLowerCase()}`)},l))})]},o.key):c.jsx(ps,{children:c.jsx(ms,{value:o,onClick:()=>n(o),children:r(`supported_nodes.${o.toLowerCase()}`)})},o))]}),[r,a]),s=w.useMemo(()=>{switch(t){case Ht.ADD_LLM:return c.jsx(hf,{...e});case Ht.ADD_PROMPT:return c.jsx(ff,{...e});case Ht.ADD_SCHEMA:return c.jsx(gf,{...e});case Ht.ADD_FEW_SHOT_EXAMPLE:return c.jsx(_f,{...e});case Ht.ADD_TOOL_DEFINITION:return c.jsx(xf,{...e});case Ht.ADD_VECTOR_DATABASE:return c.jsx(Ef,{...e});case Ht.ADD_TEXT_DATA:return c.jsx(Pf,{...e});case Ht.ADD_MCP:return c.jsx(Lf,{...e});case Ht.ADD_BASIC_AGENT:return c.jsx(Ff,{...e})}},[e,t]);return c.jsxs(c.Fragment,{children:[i,c.jsx("div",{className:"mt-4",children:s})]})}),Ul=60,Hl=140,Mf=Ah("supports-backdrop-blur:bg-white/10 supports-backdrop-blur:dark:bg-black/10 mx-auto flex h-[58px] w-max gap-2 rounded-lg border p-2 backdrop-blur-md"),ql=Qa.forwardRef(({className:e,children:r,magnification:a=Ul,distance:t=Hl,direction:n="bottom",...i},s)=>{const o=cr(1/0),l=()=>Qa.Children.map(r,d=>Qa.isValidElement(d)&&d.type===mn?Qa.cloneElement(d,{...d.props,mouseX:o,magnification:a,distance:t}):d);return c.jsx(Lh.div,{ref:s,onMouseMove:d=>o.set(d.pageX),onMouseLeave:()=>o.set(1/0),...i,className:Fe(Mf({className:e}),{"items-start":n==="top","items-center":n==="middle","items-end":n==="bottom"}),children:l()})});ql.displayName="Dock";const mn=({magnification:e=Ul,distance:r=Hl,mouseX:a,className:t,children:n,...i})=>{const s=w.useRef(null),o=Uo(a||new ub(0),u=>{var h;const p=((h=s.current)==null?void 0:h.getBoundingClientRect())??{x:0,width:0};return u-p.x-p.width/2}),l=Uo(o,[-r,0,r],[40,e,40]),d=Xr(l,{mass:.1,stiffness:150,damping:12});return c.jsx(Lh.div,{ref:s,style:{width:d},className:Fe("flex aspect-square cursor-pointer items-center justify-center rounded-full",t),...i,children:n})};mn.displayName="DockIcon";const zf={[V.Shape]:{width:100,height:100},[V.CircleShape]:{width:100,height:100},[V.TriangleShape]:{width:100,height:100},[V.EditorApp]:{width:1240,height:400}},Uf=e=>{const r=lt(e),a=et(o=>o.currentSession),[t,n]=w.useState(!1),i=me(o=>o.createOrUpdateFlowNode),s=w.useCallback(async o=>{var l,d,u;try{if(n(!0),r&&(a==null?void 0:a.id)){const p=((l=r.position)==null?void 0:l.x)||0,h=(((d=r.position)==null?void 0:d.y)||0)+(((u=r.measured)==null?void 0:u.height)||0),v=await ue("FlowNodeData").save({data:{},session_id:a.id});if(!v)throw new Error("Failed to save node data");if(!await i({node_type:o,data:{},source_id:v.id,source_type:"FlowNodeData",x:p,y:h+20,...zf[o]||{}}))throw new Error("Failed to save node")}}finally{n(!1)}},[i,a==null?void 0:a.id,r]);return{loading:t,createNode:s}},Vl={applications:[{key:V.EditorApp,image:Xx,label:"application_bar.editor"},{key:V.VSLiteApp,icon:Yx,label:"application_bar.vslite"}],shapes:[{key:V.Shape,icon:"square",label:"application_bar.square"},{key:V.CircleShape,icon:"circle",label:"application_bar.circle"},{key:V.TriangleShape,icon:"triangle",label:"application_bar.triangle"}]},Hf=w.memo(e=>{const{t:r}=Oe("flows"),{toast:a}=xt(),{loading:t,createNode:n}=Uf(e.id),i=async s=>{try{if(t)return;await n(s)}catch{a({description:r("application_bar.errors.add_node_failed"),variant:"destructive"})}};return c.jsx(Ex,{children:c.jsxs(ql,{direction:"middle",children:[Vl.applications.map(s=>{const o=s.icon;return c.jsx(mn,{children:c.jsxs(tp,{children:[c.jsxs(rp,{children:[o?c.jsx(o,{width:20,height:20,onClick:()=>i(s.key)}):void 0,s.image?c.jsx("img",{src:s.image,alt:r(s.label),className:"w-8 h-8 rounded-md",onClick:()=>i(s.key)}):void 0]}),c.jsx(ap,{children:c.jsx("p",{children:r(s.label)})})]})},s.label)}),c.jsx(np,{orientation:"vertical",className:"h-full"}),Vl.shapes.map(s=>c.jsx(mn,{children:c.jsxs(tp,{children:[c.jsx(rp,{children:c.jsx(ve,{onClick:()=>i(s.key),name:s.icon})}),c.jsx(ap,{children:c.jsx("p",{children:r(s.label)})})]})},s.label))]})})}),ze=w.memo(e=>{const{className:r,...a}=e;return c.jsx(jb,{className:Fe("!w-2 !h-2 !border-none !rounded-full !bg-slate-700",e.position===Me.Top?"!top-[-2px]":"",r),...a})}),qf=w.memo(e=>{var p,h;const[r,a]=w.useState(!1),[t,n]=w.useState({}),[i,s]=w.useState({}),{confirmPassphrase:o}=Jr(),{t:l}=Oe("atoms"),d=async()=>{var v;if(r)n({}),s({});else{if((v=Object.keys(e.encrypted||{}))!=null&&v.length){await o();const f={},m=await es.get("passphrase");if(!m)throw new Error("Passphrase is not found");await Promise.all(Object.keys(e.encrypted||{}).map(async g=>{var b,S;(b=e.encrypted)!=null&&b[g]&&(f[g]=await Mx((S=e.encrypted)==null?void 0:S[g],m))})),s(f||{})}n({...e.options})}a(!r)},u=()=>{var v;(v=e.onChangeOptions)==null||v.call(e,t||{},i||{}),a(!1)};return c.jsx("div",{className:Fe("min-w-20 flex justify-end",e.className),children:c.jsxs(ss,{open:r,onOpenChange:a,children:[c.jsx(Bx,{children:c.jsx("div",{className:"flex justify-end gap-2 !cursor-pointer",children:c.jsxs(Ve,{onClick:d,variant:"link",className:"flex items-center px-0 !cursor-pointer",children:[c.jsx(ve,{name:"settings"}),c.jsx(we,{children:l("embedding_setting.title")})]})})}),c.jsx(is,{className:"w-full p-0",children:r?c.jsxs(Ge,{className:"!border-none max-w-96 min-w-56",children:[c.jsx(pt,{children:c.jsx(gt,{children:l("embedding_setting.title")})}),c.jsxs(mt,{children:[c.jsxs(we,{children:[l("embedding_setting.provider"),":"]}),c.jsxs(rr,{value:t!=null&&t.provider?`${t==null?void 0:t.provider}`:"local_transformers",onValueChange:v=>n({provider:v}),children:[c.jsx(ar,{className:"",children:c.jsx(nr,{placeholder:l("embedding_setting.provider_placeholder")})}),c.jsxs(sr,{children:[c.jsx(yt,{value:"local_transformers",children:l("embedding_setting.providers.local_transformers")},"local_transformers"),(p=e.supportedProviders)==null?void 0:p.map(v=>c.jsx(yt,{value:v,children:l(`embedding_setting.providers.${v.toLowerCase()}`)},v))]})]}),(h=e.supportedProviders)!=null&&h.length?void 0:c.jsx(we,{className:"text-red-500 !pt-2",children:l("embedding_setting.alerts.no_provider")}),c.jsx(c.Fragment,{children:t.provider&&t.provider!=="local_transformers"?c.jsxs(c.Fragment,{children:[c.jsx(Ct,{variant:"destructive",className:"mt-4",children:l("embedding_setting.alerts.session_passkey")}),c.jsxs("div",{className:"mt-4",children:[c.jsx(we,{children:l("embedding_setting.encrypted_fields.api_key")}),c.jsx(Ve,{variant:"link",className:"px-1",children:c.jsxs("a",{href:t.provider===Ce.OpenAI?hn:un,target:"_blank",rel:"noreferrer",children:["(",t.provider===Ce.OpenAI?hn:un,")"]})}),c.jsx(nt,{type:"password",value:i!=null&&i.key?`${i==null?void 0:i.key}`:"",onChange:v=>s(f=>({...f,key:v.target.value}))})]})]}):void 0})]}),c.jsx($r,{className:"flex justify-end",children:c.jsx(Ve,{variant:"secondary",onClick:u,children:l("embedding_setting.save")})})]}):void 0})]})})}),vt=(e,r)=>{const[a,t]=w.useState(!1),[n,i]=w.useState([]),{deleteElements:s,getNode:o}=Mt();Gn({type:"target",nodeId:e,onConnect:d=>{d!=null&&d.length&&i(u=>[...u,...Sb(d)])}});const l=w.useCallback(async(d,u,p,h)=>{try{return await r({id:e,edgeId:d,source:u,target:p,connection:h})}catch{return{deleteEdgeId:d}}},[r,e]);w.useEffect(()=>{!(n!=null&&n.length)||a||(async()=>{try{t(!0);const d=[...n];i([]);const u=[],p=o(e);await Promise.all(d.map(async h=>{const v="edgeId"in h?h.edgeId:void 0,f=o(h.source);if(!f||!p)return;const m=await l(`${v}`,f,p,h);m!=null&&m.deleteEdgeId&&u.push(...Array.isArray(m.deleteEdgeId)?m.deleteEdgeId:[m.deleteEdgeId])})),u!=null&&u.length&&await s({edges:u.map(h=>({id:h}))})}finally{t(!1)}})()},[s,o,e,a,l,n])},Vf=e=>{const r=w.useCallback(async({edgeId:a})=>({deleteEdgeId:a}),[]);vt(e,r)},Bf=e=>{const r=et(o=>{var l;return(l=o.currentSession)==null?void 0:l.id}),a=lt(e),t=qh(),n=me(o=>o.updateNodes),{confirmOrCreatePassphrase:i}=Ll(),s=w.useCallback(async(o,l)=>{var d;if(a&&r){let u=e!==Qn.DEFAULT_EMBEDDING_MODEL?await ue("FlowNode").findOne({where:{id:e}}):void 0;const p={};if((d=Object.keys(l||{}))!=null&&d.length){await i();const f=await es.get("passphrase");if(!f)throw new Error("Passphrase is not found");await Promise.all(Object.keys(l||{}).map(async m=>{l!=null&&l[m]&&(p[m]=await cp(l[m],f))}))}let h;const v=[];u?(await ue("FlowNodePlaceholder").update(u.source_id,{encrypted:p,data:o}),h=await ue("FlowNodePlaceholder").findOne({where:{id:u.source_id}}),v.push({id:u.id,type:"replace",item:a})):(v.push({id:e,type:"remove"}),h=await ue("FlowNodePlaceholder").save({placeholder_type:Sa.DEFAULT_EMBEDDING_MODEL,encrypted:p,data:o,session_id:r}),u=await ue("FlowNode").save({node_type:V.DefaultEmbeddingModel,session_id:r,source_type:"FlowNodePlaceholder",source_id:h.id,x:a.position.x,y:a.position.y}),v.push({type:"add",item:a})),a.data.entity=h,a.data.flowNode=u,n(v)}},[i,r,e,a,n]);return w.useEffect(()=>{e===Qn.DEFAULT_EMBEDDING_MODEL&&t.find(o=>o.type===V.DefaultEmbeddingModel&&o.id!==Qn.DEFAULT_EMBEDDING_MODEL)&&n([{id:e,type:"remove"}])},[e,t,n]),{changeLLMOptions:s}},Wf=w.memo(e=>{var o,l,d,u;const{id:r,data:a,isConnectable:t}=e,{changeLLMOptions:n}=Bf(r);Vf(r);let i="brain",s=kx;switch(`${(l=(o=a==null?void 0:a.entity)==null?void 0:o.data)==null?void 0:l.provider}`){case Ce.OpenAI:i="gpt",s="text-embedding-3-small";break;case Ce.GoogleGenerativeAI:i="gemma",s="text-embedding-004";break}return c.jsxs("div",{children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsx("div",{children:c.jsxs(Ct,{className:"flex justify-center max-w-auto",variant:"default",children:[c.jsx(yr,{name:i,className:"w-7 h-7"}),c.jsxs("div",{className:"ml-2 pr-4 flex justify-center gap-1 flex-col",children:[c.jsx("div",{className:"min-h-8 flex items-center",children:c.jsx(lr,{children:`${s||""}`})}),c.jsx(qf,{supportedProviders:[Ce.OpenAI,Ce.GoogleGenerativeAI],onChangeOptions:n,encrypted:(d=a.entity)==null?void 0:d.encrypted,options:(u=a.entity)==null?void 0:u.data})]})]})}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})}),Bl=e=>{const r=["Bytes","KB","MB","GB","TB"];if(e===void 0)return"Unknown size";if(e===0)return"0 Byte";const a=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,a))} ${r[a]}`},Zf=w.memo(()=>{const{t:e}=Oe("flows"),[r,a]=w.useState(),t=Ja(h=>h.cachedLLMURLs),n=et(h=>h.currentSession),[i,s]=w.useState(),[o,l]=w.useState(""),[,d]=w.useState();w.useEffect(()=>{jt(async()=>{const{functionCallingModelIds:h,prebuiltAppConfig:v}=await import("./index-DCNC3sQs.js").then(async f=>(await f.__tla,f));return{functionCallingModelIds:h,prebuiltAppConfig:v}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({functionCallingModelIds:h,prebuiltAppConfig:v})=>{a(t==null?void 0:t.map(f=>{const m=v.model_list.find(g=>f.includes(g.model));if(m)return{model_id:(m==null?void 0:m.model_id)||"",info:m,isFunctionCalling:h.includes((m==null?void 0:m.model_id)||"")}}))})},[t,n==null?void 0:n.id]);const u=w.useCallback(async()=>{navigator.storage.estimate().then(h=>{h&&l(e("session_info_node.used_bytes",{used:Bl(h.usage),total:Bl(h==null?void 0:h.quota)}))}),n!=null&&n.id&&(Promise.all([ue("FlowNode").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("FlowEdge").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("Thread").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("Prompt").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("LLM").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("Schema").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("ToolDefinition").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("VectorDatabase").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("JSONLData").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),ue("CSVData").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}})]).then(h=>{const v=h.reduce((f,m)=>m!=null&&m.updated_at&&(!f||new Date(m.updated_at)>f)?new Date(m.updated_at):f,n.updated_at?new Date(n.updated_at):void 0);s(v)}),Promise.all([ue("FlowNode").count({where:{session_id:n==null?void 0:n.id}}),ue("FlowEdge").count({where:{session_id:n==null?void 0:n.id}}),ue("Thread").count({where:{session_id:n==null?void 0:n.id}}),ue("Prompt").count({where:{session_id:n==null?void 0:n.id}}),ue("LLM").count({where:{session_id:n==null?void 0:n.id}}),ue("ToolDefinition").count({where:{session_id:n==null?void 0:n.id}}),ue("Schema").count({where:{session_id:n==null?void 0:n.id}}),ue("VectorDatabase").count({where:{session_id:n==null?void 0:n.id}}),ue("JSONLData").count({where:{session_id:n==null?void 0:n.id}}),ue("CSVData").count({where:{session_id:n==null?void 0:n.id}})]).then(([h,v,f,m,g,b,S,O,x,E])=>{d([{name:e("session_info_node.count_info.title"),nodes:h||0,edges:v||0,threads:f||0,prompts:m||0,llms:g||0,tools:b||0,schemas:S||0,vectorDatabases:O||0,jsonlDatas:x||0,csvDatas:E||0}])}))},[n==null?void 0:n.id,n==null?void 0:n.updated_at,e]),p=w.useCallback(()=>{u()},[u]);return w.useEffect(()=>{u()},[u]),c.jsxs(Ge,{className:"w-96",children:[c.jsxs(pt,{children:[c.jsx(gt,{children:e("session_info_node.title")}),c.jsx(Eb,{children:i||n!=null&&n.updated_at?hb(i||(n==null?void 0:n.updated_at)).fromNow():""})]}),c.jsxs(mt,{className:"grid gap-4",children:[c.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:c.jsxs("div",{className:"flex-1 space-y-1",children:[c.jsx("p",{className:"text-sm font-medium leading-none",children:e("session_info_node.disk_size")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:o})]})}),c.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:c.jsxs("div",{className:"flex-1 space-y-1",children:[c.jsxs("div",{className:"text-sm font-medium leading-none",children:[e("session_info_node.cached_llms"),c.jsx(Or,{className:"ml-2",children:(r==null?void 0:r.length)||0})]}),r==null?void 0:r.map(h=>c.jsxs("div",{className:"text-sm text-muted-foreground gap-1",children:[h==null?void 0:h.model_id,c.jsx("div",{className:"max-w-full gap-1 flex flex-wrap mt-1",children:c.jsx(Bn,{model:h==null?void 0:h.info,isFunctionCalling:(h==null?void 0:h.isFunctionCalling)||!1,isCached:!0,cloud:!1})})]},h==null?void 0:h.model_id))]})}),c.jsx("div",{})]}),c.jsx($r,{children:c.jsxs(Ve,{className:"w-full",onClick:p,children:[c.jsx(ve,{size:24,name:"refresh-ccw"}),e("session_info_node.reload")]})})]})}),Ss=w.memo(({tags:e,disabled:r,loading:a,onSubmit:t})=>{const{t:n}=Oe("components"),i=async s=>{try{return await t(s),!0}catch{return!1}};return c.jsxs(Ge,{className:"min-w-80",children:[c.jsx(pt,{children:c.jsx(gt,{children:n("add_message_card.title")})}),c.jsxs(mt,{children:[c.jsx("div",{className:"grid w-full gap-1.5",children:c.jsx(Wx,{onSubmit:i,disabled:r||a,placeholder:n("add_message_card.placeholder")})}),e?c.jsx("div",{className:"mt-2 gap-1 flex flex-wrap",children:e}):null]})]})}),Gf=()=>{const[e,r]=w.useState(!1),a=Px(),t=et(s=>s.currentSession),n=w.useCallback(async(s,o,l,d)=>{var h;const u=(h=o.data)==null?void 0:h.entity;let p=o.type?Nx[o.type]:void 0;if(p&&u&&o&&typeof u=="object"&&"id"in u&&!l.has(`${u.id}`)&&!d.has(`${o.id}`)){p=p;const v=await ue(p).save({...u,...u&&typeof u=="object"&&"session_id"in u?{session_id:s.id}:{}});l.set(`${u.id}`,v.id);const f=await ue("FlowNode").findOne({where:{id:o.data.flowNode.id}}),m=await ue("FlowNode").save({...f||o.data.flowNode,session_id:s.id,id:void 0,source_type:p,source_id:v.id});return d.set(`${o.id}`,m.id),{entityName:p,entity:v,node:m}}else if(!d.has(`${o.id}`)){const v=await ue("FlowNode").findOne({where:{id:o.data.flowNode.id}}),f=await ue("FlowNode").save({...v||o.data.flowNode,node_type:o.type,session_id:s.id,id:void 0});return d.set(`${o.id}`,f.id),{node:f}}},[]),i=w.useCallback(async(s,o)=>{try{if(!t)throw new Error("No current session");r(!0);const l=await ue("Session").save({type:Cx.StandaloneApp,name:o.name||(t!=null&&t.name?`${t.name}`:"Standalone"),status:$x.Started,passphrase:t.passphrase});if(!l)throw new Error("Failed create standalone session");const d=new Map,u=new Map,p=await n(l,s,d,u);if(!p)throw new Error("Failed to clone main node");await ue("Session").update(l.id,{main_node_id:p.node.id,main_source_id:p!=null&&p.entity?p.entity.id:void 0,main_source_type:p.entityName?p.entityName:void 0});for(const{node:h,connectedNodes:v}of o.connections)if(await n(l,h,d,u),v)for(const f of v)await n(l,f,d,u);for(const{connections:h}of o.connections)for(const v of h){const f=u.get(`${v.source}`),m=u.get(`${v.target}`);if(!f||!m)throw new Error("Failed to get connected flow node id");await ue("FlowEdge").save({source:f,target:m,sourceHandle:v.sourceHandle,targetHandle:v.targetHandle,session_id:l.id})}return a(Ox("application",{applicationId:l.id})),!0}finally{r(!1)}},[n,t,a]);return{loading:e,createStandaloneSession:i}},Qf=()=>{const[e,r]=w.useState(!1),a=me(i=>i.updateNodes),t=me(i=>i.updateEdges),n=w.useCallback(async i=>{try{r(!0),await ue("FlowNode").delete(i);const s=await ue("FlowEdge").find({where:[{source:i},{target:i}]});return await Promise.all(s.map(o=>ue("FlowEdge").delete(o.id))),await a([{id:i,type:"remove"}]),await t(s.map(o=>({id:o.id,type:"remove"}))),!0}catch{return!1}finally{r(!1)}},[t,a]);return{loading:e,deleteNodeFlow:n}},Jf=Vn(({cloneStandaloneSession:e})=>{const r=Nr(),{t:a}=Oe("dialogs"),[t,n]=w.useState(""),{toast:i}=xt(),s=l=>{n(l.target.value)},o=async()=>{try{r.hide(),await e(t),n("")}catch{i({variant:"destructive",description:a("create_standalone_application.errors.create_failed")})}};return c.jsx(Jn,{open:r.visible,onOpenChange:r.hide,children:c.jsxs(Kn,{className:"sm:max-w-[425px]",children:[c.jsxs(Xn,{children:[c.jsx(Yn,{children:a("create_session.title")}),c.jsx(Xh,{children:a("create_standalone_application.description")})]}),c.jsx("div",{className:"grid gap-4 py-4",children:c.jsxs("div",{className:"flex flex-col space-y-1.5",children:[c.jsx(we,{className:"mb-2",htmlFor:"name",children:a("create_standalone_application.name")}),c.jsx(nt,{onChange:s,id:"name",value:t,placeholder:a("create_standalone_application.name_placeholder")})]})}),c.jsx(Yh,{children:c.jsx(Ve,{onClick:o,disabled:!t,type:"submit",children:a("create_standalone_application.create")})})]})})}),ut=w.memo(({id:e,className:r,enableToStandalone:a,getLinkedConnections:t})=>{const{t:n}=Oe("common"),{getNode:i}=Mt(),{loading:s,deleteNodeFlow:o}=Qf(),{createStandaloneSession:l}=Gf(),{toast:d}=xt(),u=Nr(Jf),p=w.useCallback(async()=>{try{await o(e),d({description:n("deleted")})}catch{d({description:n("errors.delete_failed"),variant:"destructive"})}},[o,e,d,n]),h=w.useCallback(async f=>{try{const m=i(e);if(!m)throw new Error("No current node");const g=(t==null?void 0:t(e))||[];await l(m,{name:f,connections:g}),d({description:n("standalone_session_created")})}catch(m){Cr("Clone Standalone Session",m),d({description:n("errors.create_standalone_session_failed"),variant:"destructive"})}},[i,e,t,l,d,n]),v=w.useCallback(()=>{u.show({cloneStandaloneSession:h})},[h,u]);return c.jsxs("div",{className:Fe("flex absolute z-[51] right-0 top-0 h-10",r),children:[a?c.jsx(Ve,{className:"!rounded-none !px-2",onClick:v,variant:"ghost",children:c.jsx(ve,{name:"package-plus",size:16})}):void 0,c.jsx(zt,{loading:s,className:"!rounded-none !px-2",onClick:p,variant:"ghost",children:c.jsx(ve,{name:"trash-2",size:16})})]})});var _r=(e=>(e.IDLE="idle",e.RUNNING="running",e.COMPLETED="completed",e.FAILED="failed",e.PAUSED="paused",e))(_r||{}),It=(e=>(e.PENDING="pending",e.RUNNING="running",e.COMPLETED="completed",e.FAILED="failed",e.SKIPPED="skipped",e))(It||{});class ta{validate(r){return!0}onBeforeExecute(r,a){return Promise.resolve()}onAfterExecute(r,a,t){return Promise.resolve()}onError(r,a,t){return Promise.resolve()}}class Fr{constructor(r="database",a){Nt(this,"mode");Nt(this,"reactFlowInstance");this.mode=r,this.reactFlowInstance=a}static forDatabase(){return new Fr("database")}static forSession(r){return new Fr("session",r)}setMode(r,a){this.mode=r,r==="session"&&a&&(this.reactFlowInstance=a)}async getConnectedNodes(r,a){return this.mode==="database"?this.getConnectedNodesFromDatabase(r,a):this.getConnectedNodesFromSession(r)}async getConnectedNodesFromDatabase(r,a){const[t,n]=await Promise.all([ue("FlowNode").find({where:{session_id:a}}),ue("FlowEdge").find({where:{session_id:a}})]);return this.buildConnectedGraph(r,t,n)}getConnectedNodesFromSession(r){if(!this.reactFlowInstance)throw new Error("ReactFlow instance required for session mode");const{getNodes:a,getEdges:t}=this.reactFlowInstance,n=a(),i=t(),s=this.reactNodesToFlowNodes(n),o=this.reactEdgesToFlowEdges(i);return this.buildConnectedGraph(r,s,o)}async getAllSessionNodes(r){const[a,t]=await Promise.all([ue("FlowNode").find({where:{session_id:r}}),ue("FlowEdge").find({where:{session_id:r}})]);return{nodes:a,edges:t}}async queryNodes(r){if(this.mode!=="database")throw new Error("Advanced querying only available in database mode");return ue("FlowNode").find(r)}async queryEdges(r){if(this.mode!=="database")throw new Error("Advanced querying only available in database mode");return ue("FlowEdge").find(r)}buildConnectedGraph(r,a,t){const n=new Set,i=new Map,s=new Map,o=new Map;t.forEach(d=>{const u=o.get(d.target)||[];u.push(d),o.set(d.target,u)});const l=d=>{if(n.has(d))return;n.add(d);const u=a.find(h=>h.id===d);u&&i.set(d,u);const p=o.get(d)||[];for(const h of p)s.set(h.id,h),l(h.source)};return l(r),this.buildFlowGraph(Array.from(i.values()),Array.from(s.values()))}buildFlowGraph(r,a){const t={nodes:new Map,edges:new Map,adjacencyList:new Map,reverseAdjacencyList:new Map};return r.forEach(n=>{t.nodes.set(n.id,n),t.adjacencyList.set(n.id,[]),t.reverseAdjacencyList.set(n.id,[])}),a.forEach(n=>{t.edges.set(n.id,n);const i=t.adjacencyList.get(n.source)||[];i.push(n.target),t.adjacencyList.set(n.source,i);const s=t.reverseAdjacencyList.get(n.target)||[];s.push(n.source),t.reverseAdjacencyList.set(n.target,s)}),t}reactNodesToFlowNodes(r){return r.map(a=>{var s,o,l;const t=a.data,n=(o=(s=t==null?void 0:t.entity)==null?void 0:s.constructor)==null?void 0:o.name;let i;switch(a.type){case"ThreadNode":case"THREAD":i=V.Thread;break;case"LLMNode":case"LLM":i=V.LLM;break;case"PromptNode":case"PROMPT":i=V.Prompt;break;case"MessageNode":case"MESSAGE":i=V.Message;break;case"SchemaNode":case"SCHEMA":i=V.Schema;break;case"VectorDatabaseNode":case"VECTOR_DATABASE":i=V.VectorDatabase;break;case"PlaceholderNode":case"PLACEHOLDER":i=V.PlaceHolder;break;default:tr(`\u{1F504} [FlowDataService] Unknown node type: ${a.type}, defaulting to NewMessage`),i=V.NewMessage}return{id:a.id,node_type:i,data:a.data,x:a.position.x,y:a.position.y,width:a.width||0,height:a.height||0,session_id:"",source_type:n||"FlowNode",source_id:((l=t==null?void 0:t.entity)==null?void 0:l.id)||a.id,created_at:new Date,updated_at:new Date}})}reactEdgesToFlowEdges(r){return r.map(a=>({id:a.id,source:a.source,target:a.target,session_id:"",created_at:new Date,updated_at:new Date}))}}class Wl{constructor(r){Nt(this,"nodeHandlers",new Map);Nt(this,"dataService");Nt(this,"currentFullGraph");Nt(this,"currentDirectGraph");Nt(this,"currentRunState");this.dataService=r||Fr.forDatabase()}registerNodeHandler(r){this.nodeHandlers.set(r.nodeType,r)}async prepare(r,a){if(this.currentFullGraph=await this.dataService.getConnectedNodes(r),!this.currentFullGraph.nodes.has(r))throw new Error(`Target node not found in connected graph: ${r}`);this.currentDirectGraph=this.getDirectlyConnectedNodes(this.currentFullGraph,r);const t=`run_${sp()}`;this.currentRunState=this.createRunState(t,this.currentDirectGraph,r),a&&Object.entries(a).forEach(([i,s])=>{this.currentRunState.sessionState.set(i,s)});const n=this.createExecutionContext(this.currentRunState);await this.runPreparePhase(this.currentRunState,this.currentDirectGraph,n)}async execute(){if(!this.currentRunState||!this.currentDirectGraph||!this.currentFullGraph)throw new Error("Must call prepare() before execute()");const r=this.createExecutionContext(this.currentRunState);this.currentRunState.status=_r.RUNNING;try{this.currentRunState.status===_r.RUNNING&&await this.runExecutePhase(this.currentRunState,this.currentDirectGraph,r),this.currentRunState.status===_r.RUNNING&&(this.currentRunState.status=_r.COMPLETED,this.currentRunState.endTime=new Date)}catch(a){this.currentRunState.status=_r.FAILED,this.currentRunState.error=a,this.currentRunState.endTime=new Date}return this.currentRunState}getSessionState(r){if(!this.currentRunState)throw new Error("Must call prepare() before accessing session state");return r?this.currentRunState.sessionState.get(r):this.currentRunState.sessionState.data}setSessionState(r,a){if(!this.currentRunState)throw new Error("Must call prepare() before accessing session state");this.currentRunState.sessionState.set(r,a)}createExecutionContext(r){return{sessionId:r.sessionState.sessionId,runId:r.id,sessionState:r.sessionState,getConnectedNodes:(a,t)=>{const n=this.currentFullGraph,i=u=>{const p=new Set,h=[...n.reverseAdjacencyList.get(u)||[]];for(;h.length;){const v=h.pop();if(p.has(v))continue;p.add(v);const f=n.reverseAdjacencyList.get(v)||[];for(const m of f)p.has(m)||h.push(m)}return p},s=u=>{const p=new Set,h=[...n.adjacencyList.get(u)||[]];for(;h.length;){const v=h.pop();if(p.has(v))continue;p.add(v);const f=n.adjacencyList.get(v)||[];for(const m of f)p.has(m)||h.push(m)}return p};let o=new Set;if(t)t==="target"?o=i(a):o=s(a);else{const u=i(a),p=s(a);o=new Set([...u,...p,a])}const l=this.buildFilteredGraph(n,o),d=this.topologicalSortFromNode(l,a);if(t==="target"){const u=d.indexOf(a);return(u===-1?d:d.slice(0,u)).map(p=>n.nodes.get(p)).filter(p=>p!==void 0)}if(t==="source"){const u=d.indexOf(a);return(u===-1?[]:d.slice(u+1)).map(p=>n.nodes.get(p)).filter(p=>p!==void 0)}return d.map(u=>n.nodes.get(u)).filter(u=>u!==void 0)},setState:(a,t)=>r.sessionState.set(a,t),getState:a=>r.sessionState.get(a)}}async runPreparePhase(r,a,t){const n=r.targetNodeId;if(!n){tr("\u26A0\uFE0F [FlowMachine] No target ID provided for prepare phase");return}const i=a.reverseAdjacencyList.get(n)||[];for(const s of i){const o=a.nodes.get(s),l=r.nodeExecutions.get(s);if(!o||!l){tr(`\u26A0\uFE0F [FlowMachine] Missing node or nodeExecution for: ${s}`);continue}if(await this.executeNodePrepare(o,l,t),l.status===It.FAILED){r.status=_r.FAILED,r.error=l.error;break}}}async runExecutePhase(r,a,t){const n=r.targetNodeId;if(!n)return;const i=a.nodes.get(n),s=r.nodeExecutions.get(n);if(!(!i||!s)){if(!(a.reverseAdjacencyList.get(n)||[]).every(o=>{var l;return((l=r.nodeExecutions.get(o))==null?void 0:l.status)===It.COMPLETED})){s.status=It.SKIPPED;return}await this.executeNodeExecute(i,s,t)}}getDirectlyConnectedNodes(r,a){const t=this.collectUpstreamNodes(r,a);return this.buildFilteredGraph(r,t)}collectUpstreamNodes(r,a){const t=new Set([a]);return(r.reverseAdjacencyList.get(a)||[]).forEach(n=>{t.add(n)}),t}buildFilteredGraph(r,a){const t=new Map,n=new Map;a.forEach(o=>{const l=r.nodes.get(o);l&&t.set(o,l)}),r.edges.forEach(o=>{a.has(o.source)&&a.has(o.target)&&n.set(o.id,o)});const i=new Map,s=new Map;return t.forEach((o,l)=>{i.set(l,[]),s.set(l,[])}),n.forEach(o=>{var l,d;(l=i.get(o.source))==null||l.push(o.target),(d=s.get(o.target))==null||d.push(o.source)}),{nodes:t,edges:n,adjacencyList:i,reverseAdjacencyList:s}}createRunState(r,a,t){const n=`session_${sp()}`,i={sessionId:n,data:new Map,step:0,get:l=>i.data.get(l),set:(l,d)=>i.data.set(l,d),increment:()=>++i.step},s=t?this.topologicalSortFromNode(a,t):this.topologicalSort(a),o=new Map;return s.forEach(l=>{o.set(l,{nodeId:l,status:It.PENDING,result:null})}),{id:r,sessionId:n,status:_r.IDLE,startTime:new Date,sessionState:i,nodeExecutions:o,executionOrder:s,currentNodeIndex:0,targetNodeId:t}}async executeNodePrepare(r,a,t){const n=this.nodeHandlers.get(r.node_type);if(!n){a.status=It.FAILED,a.error=new Error(`No handler found for node type: ${r.node_type}`);return}if(n.validate&&!n.validate(r)){a.status=It.FAILED,a.error=new Error(`Node validation failed for node: ${r.id}`);return}a.status=It.RUNNING,a.startTime=new Date;try{let i=null;n.prepare&&(i=await n.prepare(r,t)),a.status=It.COMPLETED,a.endTime=new Date,a.result=i}catch(i){Cr(`FlowMachine.executeNodePrepare failed for node: ${r.id}`,i),a.status=It.FAILED,a.endTime=new Date,a.error=i}}async executeNodeExecute(r,a,t){const n=this.nodeHandlers.get(r.node_type);if(!n){a.status=It.FAILED,a.error=new Error(`No handler found for node type: ${r.node_type}`);return}try{let i=null;n.execute&&(i=await n.execute(r,t)),i!==null&&(a.result=i),t.sessionState.increment()}catch(i){a.status=It.FAILED,a.endTime=new Date,a.error=i}}topologicalSort(r){const a=new Set,t=[],n=new Set,i=s=>{if(n.has(s))throw new Error(`Circular dependency detected involving node: ${s}`);a.has(s)||(n.add(s),(r.reverseAdjacencyList.get(s)||[]).forEach(o=>{r.nodes.has(o)&&i(o)}),n.delete(s),a.add(s),t.push(s))};return r.nodes.forEach((s,o)=>{a.has(o)||i(o)}),t}topologicalSortFromNode(r,a){const t=new Set,n=[],i=new Set,s=o=>{if(i.has(o))throw new Error(`Circular dependency detected involving node: ${o}`);t.has(o)||(i.add(o),(r.reverseAdjacencyList.get(o)||[]).forEach(l=>{r.nodes.has(l)&&s(l)}),i.delete(o),t.add(o),n.push(o))};return s(a),r.nodes.forEach((o,l)=>{t.has(l)||s(l)}),n}}class Kf extends ta{constructor(){super(...arguments);Nt(this,"nodeType",V.Thread)}async prepare(a,t){return{finalState:{},readyForExecution:!1}}async execute(a,t){const n=t.getState("llm");if(!(n!=null&&n.isLoaded))throw new Error("LLM_NOT_LOADED_YET");const i=t.getState("messages")||[],s=t.getState("prompts")||[],o=t.getState("injectedMessages")||[],l=t.getState("userInput"),d=t.getState("schemas")||[],u=[...i,...s,...o];l&&u.push(new Ir(l));const p=this.reorderMessages(u),h=await this.executeLLMChat(n,p,d,t);return t.setState("final_response",h),h}async executeLLMChat(a,t,n,i){const s=i.getState("onMessageUpdate");let o="";return await this.streamLLM(a.llm.provider,t,a.llm,n,{onMessageUpdate:l=>{o=l.content,s&&s({nodeData:{content:l.content,loading:!0}})},onMessageFinish:l=>{o=l.content,s&&s({nodeData:{content:l.content,loading:!1}})}}),o}async streamLLM(a,t,n,i,s){await Ao.stream(a,t,{llm:n,schemas:i,onMessageUpdate:o=>s.onMessageUpdate(o),onMessageFinish:o=>s.onMessageFinish(o)})}validate(a){var t,n;return!!((n=(t=a.data)==null?void 0:t.entity)!=null&&n.id)}async onBeforeExecute(a,t){}async onAfterExecute(a,t,n){}async onError(a,t,n){}reorderMessages(a){const t=[],n=[];if(a.forEach(i=>{i instanceof en?t.push(i):n.push(i)}),t.length===0)return n;if(t.length===1)return[t[0],...n];{const i=t.map(s=>s.content).filter(s=>s&&s.toString().trim()).join(`

`);return[new en(i),...n]}}}class Xf extends ta{constructor(){super(...arguments);Nt(this,"nodeType",V.LLM)}async prepare(a,t){const n=a.data,i=n.entity;if(!i)throw new Error(`No LLM entity found for node: ${a.id}`);const s=n.status===ft.Loaded||i.status===ft.Loaded,o=s&&!!i.connection_info,l={llm:i,status:n.status||i.status,isLoaded:s,isReady:o};t.setState("llm",l)}async execute(a,t){}validate(a){var n,i;const t=a.data;return!!((n=t==null?void 0:t.entity)!=null&&n.id&&((i=t==null?void 0:t.entity)!=null&&i.name))}async onBeforeExecute(a,t){}async onAfterExecute(a,t,n){}}class Zl extends ta{constructor(){super(...arguments);Nt(this,"nodeType",V.Prompt)}async prepare(a,t){var p;const n=a.data.entity;if(!n)throw new Error(`No prompt entity found for node: ${a.id}`);const i=t.getConnectedNodes(a.id,"target").find(h=>h.node_type===V.CSVData),s={};n.variables&&n.variables.length>0&&n.variables.forEach(h=>{h.name&&h.value&&(s[h.name]=h.value)});const o=t.getState("prompt_variables")||{};Object.assign(s,o);let l=`${n.prefix?`${n.prefix}
`:""}`;if(n.type===Tt.FewShotExample&&i){const h=(p=i.data)==null?void 0:p.entity;if(h&&h.headers&&h.csv){const{rows:v}=ip(h.headers,h.csv);v.forEach(f=>{l+=`${n.content.replace(/{([^{}]*)}/g,(m,g)=>`${f[g]}`)}
`})}}else l+=n.content;n.suffix&&(l+=`
${n.suffix}`),Object.keys(s).length>0&&Object.entries(s).forEach(([h,v])=>{const f=new RegExp(`{\\s*${h}\\s*}`,"g");l=l.replace(f,v);const m=new RegExp(`{{\\s*${h}\\s*}}`,"g");l=l.replace(m,v)});const d=[];switch(n.role){case"human":d.push(new Ir(l));break;case"system":d.push(new en(l));break;default:d.push(new rs(l));break}const u=t.getState("prompts")||[];u.push(...d),t.setState("prompts",u)}async execute(a,t){}validate(a){var t,n;return!!((n=(t=a.data)==null?void 0:t.entity)!=null&&n.content)}}class Gl extends ta{constructor(){super(...arguments);Nt(this,"nodeType",V.Message)}async prepare(a,t){const n=a.data,i=n.entity;if(!i)throw new Error(`No Message entity found for node: ${a.id}`);const s=t.getConnectedNodes(a.id).filter(u=>u.node_type===V.Message).map(u=>({node:u,connectedNodes:[]})),o=[];s.forEach(({node:u})=>{const p=u.data;if(p!=null&&p.entity){const h=p.entity;switch(h.role){case"human":o.push(new Ir(h.content));break;case"ai":o.push(new rs(h.content));break}}});const l={message:i,content:i.content||n.content||"",role:i.role||n.role||"user",baseMessage:(()=>{switch(i.role){case"human":return new Ir(i.content);case"ai":return new rs(i.content);default:return new Ir(i.content)}})()},d=[...t.getState("messages")||[],...o];return t.setState("messages",d),l}async execute(a,t){}validate(a){var t,n;return!!((n=(t=a.data)==null?void 0:t.entity)!=null&&n.id)}async onBeforeExecute(a,t){}async onAfterExecute(a,t,n){}}class Yf extends ta{constructor(){super(...arguments);Nt(this,"nodeType",V.PlaceHolder)}async prepare(a,t){var l,d,u,p,h,v,f,m,g;const n=(l=a.data)==null?void 0:l.entity;if(!n)throw new Error(`No Placeholder entity found for node: ${a.id}`);const i=[],s=[];switch(n.placeholder_type){case Sa.VECTOR_DATABASE_RETREIVER:{const b=t.getConnectedNodes(a.id,"source"),S=t.getConnectedNodes(a.id),O=S.find(J=>J.node_type===V.VectorDatabase),x=S.find(J=>J.node_type===V.Prompt);let E=b;(O||x)&&(E=S);const $=E.find(J=>J.node_type===V.VectorDatabase),C=$?(d=$.data)==null?void 0:d.entity:void 0,R=E.find(J=>J.node_type===V.Prompt),D=R?(u=R.data)==null?void 0:u.entity:void 0;if(!D||!C||!$){tr("\u26A0\uFE0F [PlaceholderHandler] Missing required connections:",{hasPrompt:!!D,hasVector:!!C,hasVectorNode:!!$});break}const L=(p=n.metadata)!=null&&p.k?+((h=n.metadata)==null?void 0:h.k):1;let T=(v=n.metadata)!=null&&v.minimalScore?+((f=n.metadata)==null?void 0:f.minimalScore):void 0;T&&T>1&&(T=T/100);const z=t.getState("humanMessageContent")||t.getState("userInput");if(!z){tr("\u26A0\uFE0F [PlaceholderHandler] No humanMessageContent or userInput found in context state");break}const M=[];if(C.storage===Tr.DataNode){const J=(g=(m=t.getConnectedNodes($.id,"target").find(ie=>ie.node_type&&[V.JSONLData,V.CSVData].includes(ie.node_type)))==null?void 0:m.data)==null?void 0:g.entity;if(!J){tr("\u26A0\uFE0F [PlaceholderHandler] No data source found for DataNode storage");break}const se=t.getState("embeddingEntity");try{const ie=await Gr.similaritySearchWithScore(se,{database:{databaseId:C.id,dataSourceId:J.id,dataSourceType:Oo(J)}},z,L);ie&&M.push(...ie)}catch(ie){Cr("\u274C [PlaceholderHandler] Similarity search failed:",ie)}}else{const J=t.getState("embeddingEntity");try{const se=await Gr.similaritySearchWithScore(J,{database:{databaseId:C.id}},z,L);se&&M.push(...se)}catch(se){Cr("\u274C [PlaceholderHandler] Similarity search failed:",se)}}if(!M.length){tr("\u26A0\uFE0F [PlaceholderHandler] No documents found, skipping message injection");break}const H=new kb({template:D.content,inputVariables:["context"]}),B=(T?M.filter(([,J])=>J>=T):M).map(([J])=>J.pageContent).join(`
`),ee=await H.format({context:B});i.push(new en(ee)),s.push(...M.map(([J])=>J));break}default:tr(`\u26A0\uFE0F [PlaceholderHandler] Unsupported placeholder type: ${n.placeholder_type}`)}const o={placeholder:n,injectedMessages:i,vectorContext:s};if(i.length>0){const b=[...t.getState("injectedMessages")||[],...i];t.setState("injectedMessages",b)}return s.length>0&&t.setState("vectorContext",s),o}async execute(a,t){}validate(a){var n;const t=(n=a.data)==null?void 0:n.entity;return!!(t!=null&&t.id&&(t!=null&&t.placeholder_type)&&t.placeholder_type===Sa.VECTOR_DATABASE_RETREIVER)}async onBeforeExecute(a,t){}async onAfterExecute(a,t,n){}}class ev extends ta{constructor(){super(...arguments);Nt(this,"nodeType",V.Schema)}async prepare(a,t){const n=a.data.entity;if(!n)throw new Error(`No schema entity found for node: ${a.id}`);const i=t.getState("schemas")||[];i.push(n),t.setState("schemas",i)}async execute(a,t){}validate(a){var n,i;const t=a.data;return!!((n=t==null?void 0:t.entity)!=null&&n.id&&((i=t==null?void 0:t.entity)!=null&&i.name))}}const Ql=e=>{const[r,a]=w.useState(!1),{confirmPassphrase:t}=Jr(),{t:n}=Oe("create_new_message"),i=et(d=>d.currentSession),s=me(d=>d.createOrUpdateFlowNode),o=me(d=>d.createOrUpdateFlowEdge),l=w.useCallback(async({content:d,threadId:u,sourceId:p,initialX:h,initialY:v,initialLLMId:f})=>{if(!i)throw new Error("Session is not found");const m=await ue("Message").save({thread_id:u,content:d,role:Ot.Human,status:$t.Started,llm_id:f,session_id:i.id});if(!m)throw new Error("Failed to save message");const g=await s({source_id:m.id,source_type:"Message",node_type:V.Message,x:h,y:v+80});if(!g)throw new Error("Failed to save human message node");await o({source:p,target:g.id});const b=await ue("Message").save({thread_id:u,content:n("initial_ai_message"),role:Ot.AI,status:$t.Inprogress,llm_id:f,parent_message_id:m.id,session_id:i.id});if(!b)throw new Error("Failed to save message");const S=await s({source_id:b.id,source_type:"Message",node_type:V.Message,x:h,y:v+250});if(!S)throw new Error("Failed to save ai message node");return await o({source:g.id,target:S.id}),{aiMessage:b,humanMessage:m,aiMessageNode:S,humanMessageNode:g}},[o,s,i,n]);return{createMessage:w.useCallback(async(d,u,p)=>{var f,m,g,b,S,O;if(!((f=d.data)!=null&&f.entity))throw new Error("Thread node missing entity data");const h=d.data.entity;if(!h)throw new Error("Thread entity is not found");let v;try{a(!0);const x=e?Fr.forSession(e):Fr.forDatabase(),E=new Wl(x);E.registerNodeHandler(new Kf),E.registerNodeHandler(new Xf),E.registerNodeHandler(new Zl),E.registerNodeHandler(new ev),E.registerNodeHandler(new Gl),E.registerNodeHandler(new Yf);const $={userInput:u,messages:((m=p==null?void 0:p.initialState)==null?void 0:m.messages)||[]};if(await E.prepare(d.id,$),!((g=E.getSessionState("llm"))!=null&&g.isLoaded))throw new Error("LLM_NOT_LOADED_YET");await t();const C=(p==null?void 0:p.initialX)||((b=d.position)==null?void 0:b.x)||0,R=(p==null?void 0:p.initialY)||(((S=d.position)==null?void 0:S.y)||0)+(((O=d.measured)==null?void 0:O.height)||0);v=await l({content:u,initialX:C,initialY:R,sourceId:(p==null?void 0:p.sourceId)||d.id,threadId:h.id,initialLLMId:h.initial_llm_id}),E.setSessionState("onMessageUpdate",L=>{p.onMessageUpdate({id:v.aiMessageNode.id,nodeData:{entity:{...v.aiMessage,content:L.nodeData.content,status:L.nodeData.loading?$t.Inprogress:$t.Success},loading:L.nodeData.loading}})});const D=(await E.execute()).sessionState.get("final_response")||"No response generated";return await ue("Message").update(`${v.aiMessage.id}`,{status:$t.Success,content:D}),v.aiMessage.status=$t.Success,v.aiMessage.content=D,p.onMessageUpdate({id:v.aiMessageNode.id,nodeData:{entity:v.aiMessage,loading:!1}}),!0}catch(x){throw Cr("FlowMachine message creation failed:",x),v!=null&&v.aiMessage&&await ue("Message").update(`${v.aiMessage.id}`,{status:$t.Failed,content:n("errors.ai_message_content_failed")}),v!=null&&v.aiMessageNode.id&&(p==null||p.onMessageUpdate({id:v.aiMessageNode.id,nodeData:{content:n("errors.ai_message_content_failed"),entity:{...v.aiMessage,status:$t.Failed,content:n("errors.ai_message_content_failed")},loading:!1}})),x}finally{a(!1)}},[t,l,n]),loading:r}},tv=(e,r)=>{const a=r.getHandleConnections({nodeId:e.id,type:"target"}),t=a.map(p=>{const h=r.getNode(p.source);return h?{connections:r.getHandleConnections({nodeId:h.id,type:"target"}),node:h}:void 0}),n=t.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===V.Prompt}),i=[];n!=null&&n.length&&n.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>r.getNode(f.source)).filter(Boolean);i.push({node:p.node,connections:p.connections,connectedNodes:h})});const s=t.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===V.ToolDefinition}),o=[];s!=null&&s.length&&s.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>r.getNode(f.source)).filter(Boolean);h!=null&&h.find(f=>f.type===V.Schema)&&o.push({node:p.node,connections:p.connections,connectedNodes:h})});const l=t.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===V.PlaceHolder}),d=[];l!=null&&l.length&&l.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>r.getNode(f.source)).filter(Boolean);h&&d.push({node:p.node,connections:p.connections,connectedNodes:h})});const u=t.find(p=>{var h;return((h=p.node)==null?void 0:h.type)===V.Schema});return{thread:{node:e,connections:a},llm:t.find(p=>{var h;return((h=p.node)==null?void 0:h.type)===V.LLM}),schemas:u?[u]:[],prompts:i,tools:o,placeholders:d}},rv=(e,r)=>{const a=lt(e),{t}=Oe("flows"),n=Mt(),i=me(v=>v.updateNodes),{createMessage:s,loading:o}=Ql(n),{getNode:l,getHandleConnections:d}=n,u=w.useCallback(v=>{const f=l(v);if(!f)return[];const m=[],g=tv(f,{getNode:l,getHandleConnections:d});return g.thread&&m.push({node:g.thread.node,connectedNodes:[],connections:g.thread.connections}),g.prompts&&m.push(...g.prompts.map(b=>({node:b.node,connectedNodes:b.connectedNodes,connections:b.connections}))),g.schemas&&m.push(...g.schemas.map(b=>({node:b.node,connectedNodes:[],connections:b.connections}))),g.placeholders&&g.placeholders.forEach(b=>{const S=b.connections.map(O=>l(O.source)).filter(Boolean);m.push({node:b.node,connectedNodes:S||[],connections:b.connections})}),g.llm&&m.push(g.llm),m},[d,l]),p=w.useCallback(v=>{if(!v.id)return;const f=l(v.id);!f||!v.nodeData||i([{id:f.id,type:"replace",item:{...f,data:{...f.data,...Vh(v.nodeData,Bh)}}}])},[l,i]),h=w.useCallback(async v=>{if(a&&r.entity)try{await s(a,v,{onMessageUpdate:p})}catch(f){if(Cr("FlowMachine execution error:",f),f instanceof Error&&f.message.includes("LLM_NOT_LOADED_YET"))return Wr({variant:"destructive",title:t("thread_node.errors.llm_not_loaded_yet")});Wr({variant:"destructive",title:`FlowMachine Error: ${f}`})}},[a,r.entity,s,p,t]);return{loading:o,getLinkedConnections:u,createMessage:h}},av=e=>{const r=me(t=>t.createOrUpdateFlowEdge),a=w.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===V.Prompt&&(i==null?void 0:i.type)===V.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===V.LLM&&(i==null?void 0:i.type)===V.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===V.Schema&&(i==null?void 0:i.type)===V.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===V.ToolDefinition&&(i==null?void 0:i.type)===V.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===V.VectorDatabase&&(i==null?void 0:i.type)===V.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===V.PlaceHolder&&(i==null?void 0:i.type)===V.Thread&&n.data.entity.placeholder_type===Sa.VECTOR_DATABASE_RETREIVER){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},nv=w.memo(e=>{const{id:r,data:a,isConnectable:t}=e,{t:n}=Oe("flows"),[i,s]=w.useState(!1),o=Gn({type:"source"}),l=Gn({type:"target"}),{getNode:d}=Mt(),{loading:u,createMessage:p,getLinkedConnections:h}=rv(r,a);av(r);const v=w.useCallback(async(...b)=>(s(!1),await p(...b)),[p]),f=w.useMemo(()=>o.length>0,[o]),m=w.useCallback(()=>{s(b=>!b)},[]),g=w.useMemo(()=>{var S,O;const b=l.map((x,E)=>{var C;const $=d(x.source);if(($==null?void 0:$.type)===V.Schema)return c.jsx(Or,{children:n("thread_node.structured_output")},`${E}`);if(($==null?void 0:$.type)===V.Prompt){const R=$.data.entity;return c.jsx(Or,{children:n(R.type===Tt.FewShotExample?"thread_node.prompts.few_shot_example":`thread_node.prompts.${R.role.toLowerCase()}`)},`${E}`)}else if(($==null?void 0:$.type)===V.PlaceHolder&&((C=$.data.entity)==null?void 0:C.placeholder_type)===Sa.VECTOR_DATABASE_RETREIVER)return c.jsx(Or,{children:n("thread_node.vector_database_retriever")},`${E}`)}).filter(Boolean);return e.data.entity&&!((O=(S=e.data.entity)==null?void 0:S.messages)!=null&&O.length)&&!f?c.jsx(Ss,{disabled:u,loading:u,onSubmit:v,tags:b}):b!=null&&b.length?c.jsxs(Ge,{className:"p-4 pt-2",children:[c.jsx(gt,{className:"mb-2",children:n("thread_node.title")}),c.jsx("div",{className:"flex gap-1.5",children:b}),c.jsx("div",{className:"mt-4 w-full flex justify-end",children:c.jsxs(Ve,{onClick:m,variant:"outline",children:[c.jsx(ve,{name:i?"copy-minus":"copy-plus"}),n(i?"thread_node.hide":"thread_node.clone")]})})]}):c.jsx("div",{className:"w-12 h-10"})},[f,d,v,m,u,e.data.entity,i,n,l]);return c.jsxs("div",{children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(ut,{id:r,enableToStandalone:!0,getLinkedConnections:h}),g,i?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),c.jsx("div",{className:"absolute mt-[30px] w-full",children:c.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:c.jsx(Ss,{disabled:u,loading:u,onSubmit:v})})})]}):void 0]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})});function sv({data:e,onNewThread:r,loading:a,showThread:t}){var i;const{t:n}=Oe("flows");return c.jsxs(Ct,{className:"flex min-w-52",children:[c.jsx(ve,{size:24,name:"user"}),c.jsxs("div",{className:"ml-2 max-w-full w-full",children:[c.jsx(lr,{children:"Human"}),c.jsx(Qr,{children:`${e.content||((i=e.entity)==null?void 0:i.content)||""}`}),r?c.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:c.jsxs(Ve,{onClick:r,disabled:a,variant:"outline",children:[c.jsx(ve,{name:t?"minus":"plus",size:16}),n(t?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]})]})}function iv({data:e,onNewThread:r,loading:a,showThread:t}){var l,d,u,p,h,v,f,m,g;const{t:n}=Oe("flows"),i=w.useMemo(()=>{var b;try{return JSON.parse(((b=e==null?void 0:e.entity)==null?void 0:b.metadata)||"{}")}catch{return{}}},[(l=e==null?void 0:e.entity)==null?void 0:l.metadata]),s=e.entity.status===$t.Failed,o=w.useMemo(()=>{var b;return c.jsx(ja,{source:`${e.content||((b=e.entity)==null?void 0:b.content)||""}`})},[e.content,(d=e.entity)==null?void 0:d.content]);return c.jsxs(Ct,{className:Fe("flex min-w-52",s?"bg-background":""),variant:s?"destructive":"default",children:[c.jsx(ve,{className:Fe(e.loading?"animate-spin":void 0),size:24,name:e.loading?"loader-circle":"bot"}),c.jsx(ve,{name:t?"minus":"plus",size:24}),c.jsxs("div",{className:"ml-2 w-full max-w-full",children:[c.jsx(lr,{children:n(`message_node.message_roles.${(p=(u=e.entity)==null?void 0:u.role)==null?void 0:p.toLowerCase()}`)}),c.jsx(w.Suspense,{fallback:c.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:c.jsx(ve,{name:"loader-circle",className:"animate-spin"})}),children:s?e.content||((h=e.entity)==null?void 0:h.content)||"":o}),Array.isArray((v=i==null?void 0:i.message)==null?void 0:v.tool_calls)&&((m=(f=i==null?void 0:i.message)==null?void 0:f.tool_calls)!=null&&m.length)?(g=i==null?void 0:i.message)==null?void 0:g.tool_calls.map((b,S)=>c.jsx(Or,{children:n("message_node.tool_call",{name:b.name,args:Object.entries(b.args).map(([O,x])=>`"${O}": "${x}"`).join(", ")})},`${b.name}_${S}`)):null,r?c.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:c.jsxs(Ve,{onClick:r,disabled:a,variant:"outline",children:[c.jsx(ve,{name:t?"minus":"plus",size:16}),n(t?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]}),e.loading?c.jsx(Wh,{size:350,duration:10}):void 0]})}const ov=e=>{const{t:r}=Oe("flows"),a=lt(e),t=me(f=>f.updateNodes),n=Mt(),{createMessage:i,loading:s}=Ql(n),{getNode:o,getNodes:l,getHandleConnections:d}=n,u=w.useCallback(f=>{const m=l();let g=f;const b=new Set;for(;g&&!b.has(g);){b.add(g);const S=m.find(x=>x.id===g);if(!S)break;if(S.type===V.Thread)return S;const O=d({type:"target",nodeId:g});if(O.length===0)break;g=O[0].source}return null},[l,d]),p=w.useCallback(async f=>{try{const m=Fr.forSession(n),g=new Wl(m);g.registerNodeHandler(new Gl),g.registerNodeHandler(new Zl),await g.prepare(f,{});const b=g.getSessionState("messages")||[];return console.log("messages>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",b),b}catch(m){return console.error("Failed to collect conversation history:",m),[]}},[n]),h=w.useCallback(f=>{if(!f.id)return;const m=o(f.id);!m||!f.nodeData||t([{id:m.id,type:"replace",item:{...m,data:{...m.data,...Vh(f.nodeData,Bh)}}}])},[o,t]),v=w.useCallback(async f=>{var m,g,b;if(a)try{const S=u(a.id);if(!S)return Wr({variant:"destructive",title:r("message_node.errors.thread_not_found")});const O=await p(a.id);await i(S,f,{onMessageUpdate:h,sourceId:a.id,initialState:{messages:O},initialX:(m=a.position)==null?void 0:m.x,initialY:((g=a.position)==null?void 0:g.y)+(((b=a.measured)==null?void 0:b.height)||0)+10})}catch(S){if(S instanceof Error&&S.message.includes("LLM_NOT_LOADED_YET"))return Wr({variant:"destructive",title:r("message_node.errors.llm_not_loaded_yet")});Wr({variant:"destructive",title:r("message_node.errors.create_message")})}},[a,r,i,h,u,p]);return{loading:s,createMessage:v}},Jl=()=>{const e=et(t=>t.currentSession),r=me(t=>t.createOrUpdateFlowNode),a=me(t=>t.createOrUpdateFlowEdge);return{createIdieMessage:w.useCallback(async(t,n,i,s)=>{var f,m,g,b,S;if(!t||!n||!e)return;const o=(m=(f=s==null?void 0:s.promptNode)==null?void 0:f.data)==null?void 0:m.entity,l=((g=t.position)==null?void 0:g.x)||0,d=(((b=t.position)==null?void 0:b.y)||0)+(((S=t.measured)==null?void 0:S.height)||0),u=await ue("Message").save({thread_id:n.id,content:i,role:(o==null?void 0:o.role)||Ot.Human,status:$t.Started,llm_id:n.initial_llm_id,session_id:e.id});if(!u)throw new Error("Failed to save message");const p=await r({source_id:u.id,source_type:"Message",node_type:V.Message,x:l,y:d});if(!p)throw new Error("Failed to save message node");const h=await a({source:t.id,target:p.id});let v;return s!=null&&s.promptNode&&(v=await a({source:s==null?void 0:s.promptNode.id,target:p.id})),{message:u,edgeToPrompt:v,messageNode:p,messageEdge:h}},[r,a])}},lv=e=>{const{createIdieMessage:r}=Jl(),a=w.useCallback(async({edgeId:t,source:n,target:i})=>{var s,o;try{if((n==null?void 0:n.type)===V.Prompt&&(i==null?void 0:i.type)===V.Message){const l=(s=i==null?void 0:i.data)==null?void 0:s.entity,d=(o=n==null?void 0:n.data)==null?void 0:o.entity;if(!d||!l||!i)return{deleteEdgeId:t};await r(i,{id:l==null?void 0:l.thread_id,title:"",status:tn.Started,initial_llm_id:l.llm_id,session_id:d.session_id},d.content,{promptNode:n});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},cv=w.memo(e=>{var O,x,E;const{id:r,data:a,isConnectable:t}=e,[n,i]=w.useState(!1),[s,o]=w.useState(!1),{t:l}=Oe("common"),d=Gn({type:"source"}),{loading:u,createMessage:p}=ov(r),{toast:h}=xt();lv(r);const v=w.useCallback(async(...$)=>{const C=await p(...$);return i(!1),C},[p]),f=w.useMemo(()=>d.length===0,[d]),m=w.useCallback(()=>{var $;($=a.entity)!=null&&$.content&&(navigator.clipboard.writeText(a.entity.content),h({description:l("copied")}))},[h,a,l]),g=w.useCallback(async()=>{var $;try{if(s)return await Rh.stop(),o(!1);o(!0),await Rh.speak((($=a.entity)==null?void 0:$.content)||"")}catch{h({variant:"destructive",description:l("errors.speech_is_not_supported")})}finally{o(!1)}},[(O=a.entity)==null?void 0:O.content,s,l,h]),b=w.useCallback(()=>{i($=>!$)},[]),S=w.useMemo(()=>{var $;if(!(!f&&!n||a.loading||u||(($=a==null?void 0:a.entity)==null?void 0:$.status)==="inprogress"))return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),c.jsx("div",{className:"absolute mt-[30px] w-full",children:c.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:c.jsx(Ss,{disabled:u,loading:u,onSubmit:v})})})]})},[(x=a==null?void 0:a.entity)==null?void 0:x.status,a.loading,v,f,u,n]);return c.jsxs("div",{children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsxs("div",{className:"max-w-sm min-w-64",children:[c.jsxs("div",{className:"w-auto",children:[c.jsx(ut,{id:r}),c.jsx("div",{children:((E=a.entity)==null?void 0:E.role)===Ot.Human?c.jsx(sv,{data:a,showThread:n,onNewThread:f?void 0:b}):c.jsx(iv,{data:a,showThread:n,loading:u,onNewThread:f?void 0:b})}),c.jsx(Ve,{onClick:g,className:"absolute top-0 right-[68px] !px-2 !rounded-none",variant:"ghost",children:c.jsx(ve,{name:s?"circle-stop":"speech",size:16})}),c.jsx(Ve,{onClick:m,className:"absolute top-0 right-[36px] !px-2 !rounded-none",variant:"ghost",children:c.jsx(ve,{name:"copy",size:16})})]}),S]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})}),Kl=()=>{const e=et(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=w.useState(!1),t=me(s=>s.createOrUpdateFlowNode),n=me(s=>s.createOrUpdateFlowEdge),i=w.useCallback(async s=>{var o,l;a(!0);try{const d=(o=s.data)==null?void 0:o.entity;if(!d||!e)throw new Error("LLM or Session not found");const u=s.position.x,p=s.position.y+(((l=s.measured)==null?void 0:l.height)||0),h=await ue("Thread").save({initial_llm_id:d.id,title:`New thread with ${d.name}`,status:tn.Started,messages:[],session_id:e}),v=await t({source_id:h.id,source_type:"Thread",node_type:V.Thread,x:u,y:p+60});if(!v)throw new Error("Failed to create thread node");const f=await n({source:s.id,target:v.id});return{thread:h,flowNode:v,flowEdge:f}}finally{a(!1)}},[n,t,e]);return{loading:r,createThread:i}},dv=(e,r)=>{var O;const{t:a}=Oe("flows"),{toast:t}=xt(),[n,i]=w.useState(!1),[s,o]=w.useState(!1),l=lt(e),{loadModel:d}=zx(),{createThread:u,loading:p}=Kl(),h=me(x=>x.updateNodes),v=me(x=>x.pushSyncNodeQueue),{getNodes:f}=Mt(),m=w.useCallback(async()=>{try{if(o(!0),r.entity.id){const x=await ue("Thread").find({where:{initial_llm_id:r.entity.id}});v("Thread",{where:{source_type:"Thread",source_id:Ro(x.map(E=>E.id))}})}}finally{o(!1)}},[(O=r==null?void 0:r.entity)==null?void 0:O.id,v]),g=w.useCallback(async()=>{try{if(i(!0),r.entity&&l){await(d==null?void 0:d(r.entity.provider,`${r.entity.name}`,{provider:r.entity.provider,callback:E=>{l.data.status=E.progress===100?ft.Loaded:ft.Loading,l.data.label=E.text,h([{id:e,type:"replace",item:l}])}}));const x=f().filter(E=>E.type===V.LLM?E.data.entity.provider===Ce.WebLLM:!1).map(E=>(E.data.status=ft.Started,{id:E.id,type:"replace",item:E}));l.data.label="",l.data.status=ft.Loaded,x.push({id:e,type:"replace",item:l}),h(x),await m()}}catch(x){Cr("Load Model",x),t({variant:"destructive",description:a("llm_node.errors.loading_model")})}finally{i(!1)}},[r.entity,f,e,d,l,m,a,t,h]),b=w.useCallback(async()=>{r.entity&&l&&await(u==null?void 0:u(l))},[r.entity,l,u]),S=w.useCallback(async x=>{r.entity&&l&&(l.data.entity.options=x,await ue("LLM").update(r.entity.id,{options:x}),h([{id:e,type:"replace",item:l}]))},[r.entity,e,l,h]);return w.useEffect(()=>{r.entity&&l&&r.entity.status!==r.status&&(l.data.status=r.entity.status,h([{id:e,type:"replace",item:l}]))},[]),{loadingModel:n,creatingThread:p,queringThreads:s,changeLLMOptions:S,loadModel:g,createThread:b,queryThreads:m}},uv=e=>{const r=w.useCallback(async()=>{},[]);vt(e,r)},hv=w.memo(e=>{var b,S,O,x,E,$;const{id:r,data:a,isConnectable:t}=e,[n,i]=w.useState(),{t:s}=Oe("flows"),{createThread:o,loadModel:l,queringThreads:d,queryThreads:u,loadingModel:p,changeLLMOptions:h}=dv(r,a);uv(r);const v=[ft.Loading,ft.Downloading].includes(a.status);w.useEffect(()=>{var C,R,D,L,T,z,M,H,B;if(!(n||!((C=a==null?void 0:a.entity)!=null&&C.name))){if([Ce.WebLLM,Ce.Wllama].includes((R=a==null?void 0:a.entity)==null?void 0:R.provider)){if(Ce.Wllama===((D=a==null?void 0:a.entity)==null?void 0:D.provider)){jt(()=>import("./file-tree-DH9c22tu.js").then(async ee=>(await ee.__tla,ee)).then(ee=>ee.i),__vite__mapDeps([9,4,2,3])).then(async({ModelManager:ee})=>{var se,ie,ke;const J=await new ee().getModels();i({hasCache:!!J.find(Ie=>{var G;return Ie.url.includes((G=a==null?void 0:a.entity)==null?void 0:G.name)}),cloud:!1,isFunctionCalling:!1,info:{model_id:(se=a==null?void 0:a.entity)==null?void 0:se.name,model:(ie=a==null?void 0:a.entity)==null?void 0:ie.name,model_lib:(ke=a==null?void 0:a.entity)==null?void 0:ke.provider,model_type:2}})}),i({hasCache:!1,cloud:!1,isFunctionCalling:!0,info:{model_id:(L=a==null?void 0:a.entity)==null?void 0:L.name,model:(T=a==null?void 0:a.entity)==null?void 0:T.name,model_lib:(z=a==null?void 0:a.entity)==null?void 0:z.provider,model_type:2}});return}}else{i({hasCache:!1,cloud:!0,isFunctionCalling:!0,info:{model_id:(M=a==null?void 0:a.entity)==null?void 0:M.name,model:(H=a==null?void 0:a.entity)==null?void 0:H.name,model_lib:(B=a==null?void 0:a.entity)==null?void 0:B.provider,model_type:2}});return}jt(()=>import("./index-DCNC3sQs.js").then(async ee=>(await ee.__tla,ee)),__vite__mapDeps([0,1,2,3,4,5,6])).then(async({hasModelInCache:ee,functionCallingModelIds:J,prebuiltAppConfig:se})=>{var ke,Ie;const ie=await ee((ke=a==null?void 0:a.entity)==null?void 0:ke.name);i({hasCache:ie,isFunctionCalling:J.includes((Ie=a==null?void 0:a.entity)==null?void 0:Ie.name),info:se.model_list.find(G=>{var te;return G.model_id===((te=a==null?void 0:a.entity)==null?void 0:te.name)})})})}},[(b=a==null?void 0:a.entity)==null?void 0:b.name,(S=a==null?void 0:a.entity)==null?void 0:S.provider,n]);const f=w.useCallback(async C=>{await h(C)},[h]),m=w.useMemo(()=>{var C,R;switch(a.status){case ft.Downloading:return c.jsx(ve,{className:"animate-spin w-7 h-7",name:"arrow-big-down-dash"});case ft.Loaded:return c.jsx(yr,{name:((C=a.entity)==null?void 0:C.name)||"brain",className:"w-7 h-7"});case ft.Loading:return c.jsx(ve,{className:"animate-spin w-7 h-7",name:"loader-circle"});default:return c.jsx(yr,{name:((R=a.entity)==null?void 0:R.name)||"brain",className:"w-7 h-7"})}},[(O=a.entity)==null?void 0:O.name,a.status]),g=w.useMemo(()=>v?null:p?c.jsx(Ve,{disabled:!0,className:"w-full mt-4",children:c.jsx(ve,{className:"animate-spin",size:24,name:"loader-circle"})}):a.status===ft.Loaded?c.jsx(Ve,{onClick:o,className:"mt-4 w-full",children:s("llm_node.create_thread_button")}):c.jsxs("div",{className:"flex gap-2 mt-4",children:[n!=null&&n.hasCache?c.jsx(zt,{loading:d,onClick:u,children:c.jsx(ve,{size:24,name:"message-square-more"})}):null,c.jsx(Ve,{disabled:p,onClick:l,className:"w-full",children:s(n!=null&&n.hasCache?"llm_node.load_model_button":"llm_node.download_model_button")})]}),[v,p,a.status,n==null?void 0:n.hasCache,d,u,l,s,o]);return c.jsxs("div",{children:[c.jsxs("div",{children:[c.jsx(ut,{id:r}),c.jsxs(Ct,{className:"flex justify-center",children:[m,c.jsxs("div",{className:"ml-2 pt-1 max-w-lg",children:[c.jsx(lr,{className:"flex gap-2 items-center pr-6",children:`${((x=a==null?void 0:a.entity)==null?void 0:x.name)||""}`}),c.jsx(Qr,{className:"max-w-full",children:`${a.label||""}`}),c.jsx("div",{className:"max-w-full mt-2 flex-wrap flex gap-1",children:c.jsx(Bn,{model:n==null?void 0:n.info,isFunctionCalling:(n==null?void 0:n.isFunctionCalling)||!1,name:(E=a==null?void 0:a.entity)==null?void 0:E.name,isCached:(n==null?void 0:n.hasCache)||!1,cloud:(n==null?void 0:n.cloud)||!1})}),c.jsx(Pb,{options:($=a==null?void 0:a.entity)==null?void 0:$.options,onChangeOptions:f,className:"mt-2"}),g]})]}),v?c.jsx(Wh,{className:"rounded-lg"}):void 0]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})}),pv=e=>{const r=me(n=>n.createOrUpdateFlowEdge),{createIdieMessage:a}=Jl(),t=w.useCallback(async({edgeId:n,source:i,target:s})=>{var o,l,d,u;try{const p=(o=s==null?void 0:s.data)==null?void 0:o.entity,h=(l=i==null?void 0:i.data)==null?void 0:l.entity;if((i==null?void 0:i.type)===V.Message&&(s==null?void 0:s.type)===V.Prompt){const v=(d=i==null?void 0:i.data)==null?void 0:d.entity,f=(u=s==null?void 0:s.data)==null?void 0:u.entity;if(!f||!v||!s)return{deleteEdgeId:n};await a(i,{id:v==null?void 0:v.thread_id,title:"",status:tn.Started,initial_llm_id:v.llm_id,session_id:f.session_id},f.content,{promptNode:s});return}else if((i==null?void 0:i.type)===V.CSVData&&(s==null?void 0:s.type)===V.Prompt&&(p==null?void 0:p.type)===Tt.FewShotExample&&(h!=null&&h.headers.includes("input"))&&(h!=null&&h.headers.includes("output"))){await r({source:i.id,target:s.id});return}return{deleteEdgeId:n}}catch{return{deleteEdgeId:n}}},[a,r]);vt(e,t)},mv=w.memo(e=>{var d,u,p;const{id:r,data:a,isConnectable:t}=e;pv(r);const n=Nr(Nb),i=w.useMemo(()=>{var h,v,f;return`${(h=a.entity)!=null&&h.prefix?`${(v=a.entity)==null?void 0:v.prefix}
`:""}${((f=a.entity)==null?void 0:f.content)||""}`},[(d=a.entity)==null?void 0:d.prefix,(u=a.entity)==null?void 0:u.content]),s=w.useMemo(()=>{var v;const h=/{(.*?)}/g;return((v=i.match(h))==null?void 0:v.map(f=>f.replace("{","").replace("}","")))||[]},[i]),o=i.length>990,l=()=>{n.show({title:"Prompt",content:i})};return c.jsxs("div",{className:"min-w-56",children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(ut,{id:r}),c.jsxs(Ct,{className:"flex justify-center max-w-72",variant:"default",children:[c.jsx(ve,{size:24,name:"notepad-text"}),c.jsxs("div",{className:"ml-2 max-w-full break-words break-all",children:[c.jsx(lr,{children:`${((p=a.entity)==null?void 0:p.role)||""}`}),c.jsxs(Qr,{onClick:o?l:void 0,children:[o?`${i.slice(0,990)}...`:i,o?c.jsx("span",{className:"float-right",children:c.jsx(ve,{name:"chevron-right"})}):void 0]}),s!=null&&s.length?s.map((h,v)=>c.jsx(Or,{className:"mt-2 mr-1",variant:"default",children:h},v)):void 0]})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})}),fv=e=>{const r=w.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);vt(e,r)},vv=w.memo(e=>{var l,d;const{t:r}=Oe("flows"),{id:a,data:t,isConnectable:n}=e,i=w.useRef(!1),s=lt(a),o=me(u=>u.updateNodes);return fv(a),w.useEffect(()=>{var p;const u=t==null?void 0:t.entity;!u||!s||i.current||(p=u==null?void 0:u.schema_items)!=null&&p.length||t.loaded||(i.current=!0,ue("SchemaItem").find({where:{schema_id:u.id}}).then(h=>{o([{id:s.id,type:"replace",item:{...s,data:{...(s==null?void 0:s.data)||{},loaded:!0,entity:{...t.entity,schema_items:h}}}}])}).finally(()=>{i.current=!1}))},[t.entity,t.loaded,s,o]),c.jsxs("div",{children:[c.jsxs("div",{children:[c.jsx(ut,{id:a}),c.jsxs(Zn,{defaultValue:"account",className:"w-[400px]",children:[c.jsxs(Po,{className:"grid w-full grid-cols-2",children:[c.jsx(ir,{value:"account",children:r("schema_node.typescript")}),c.jsx(ir,{value:"password",children:r("schema_node.zod")})]}),c.jsx(or,{value:"account",children:c.jsx(Ge,{className:"p-4",children:c.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:Ux(((l=t==null?void 0:t.entity)==null?void 0:l.schema_items)||[])})})}),c.jsx(or,{value:"password",children:c.jsx(Ge,{className:"p-4 max-w-full",children:c.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:Hx(((d=t==null?void 0:t.entity)==null?void 0:d.schema_items)||[])})})})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:n})]})}),gv=e=>{const r=me(t=>t.createOrUpdateFlowEdge),a=w.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===V.Schema&&(i==null?void 0:i.type)===V.ToolDefinition){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},yv=w.lazy(()=>jt(()=>import("./CodeEditor-Bbk9oTWl.js"),__vite__mapDeps([7,2,3,8]))),_v=w.memo(({id:e,data:r,isConnectable:a})=>{var o,l,d,u;const{t}=Oe("components");gv(e);const n=w.useMemo(()=>{var p;try{return((p=r.entity)==null?void 0:p.schema)||[]}catch{return[]}},[(o=r.entity)==null?void 0:o.schema]),i=w.useCallback(()=>{},[]),s=w.useMemo(()=>({readOnly:!0,minimap:{enabled:!1}}),[]);return c.jsxs("div",{children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:a}),c.jsx("div",{children:c.jsxs(Ct,{className:"flex justify-center",children:[c.jsx(ut,{id:e}),c.jsx(ve,{size:24,name:"wrench"}),c.jsxs("div",{className:"ml-2",children:[c.jsx(lr,{children:`${((l=r.entity)==null?void 0:l.name)||""}`}),c.jsx(Qr,{children:`${((d=r.entity)==null?void 0:d.description)||""}`}),c.jsxs(Zn,{defaultValue:"account",className:"w-full mt-4",children:[c.jsxs(Po,{className:"grid w-full grid-cols-2",children:[c.jsx(ir,{value:"account",children:t("add_tool_card.tool_schema")}),c.jsx(ir,{value:"password",children:t("add_tool_card.handler")})]}),c.jsx(or,{value:"account",children:c.jsx(Ge,{className:"p-4",children:c.jsx(pn,{className:"mt-0",data:n})})}),c.jsx(or,{value:"password",children:c.jsx(Ge,{className:"p-4 max-w-full",children:c.jsx(w.Suspense,{children:c.jsx(yv,{content:((u=r==null?void 0:r.entity)==null?void 0:u.handler)||"",setContent:i,className:"h-40",language:"javascript",options:s})})})})]})]})]})}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:a})]})}),wv=w.memo(e=>{var i,s;const{id:r,data:a,isConnectable:t}=e,n=w.useMemo(()=>{if(!(a!=null&&a.entity))return{headers:[],rows:[]};const o=To(a.entity.csv);return{headers:Io(a.entity.headers),rows:o.map(l=>Io(l))}},[a==null?void 0:a.entity]);return c.jsxs("div",{children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(ut,{id:r}),c.jsxs(Ge,{className:"min-w-32 min-h-16 p-4",children:[c.jsx(pt,{className:"!p-0",children:c.jsxs("div",{className:"pt-2 flex !flex-row",children:[c.jsx(ve,{name:"file-spreadsheet",className:"mr-2"}),c.jsxs(we,{className:"!font-medium leading-none tracking-tight pr-8",children:[V.CSVData," ",(i=n==null?void 0:n.rows)!=null&&i.length?`(${((s=n==null?void 0:n.rows)==null?void 0:s.length)||0})`:""]})]})}),c.jsx(mt,{className:"pb-0",children:c.jsx(No,{data:n.rows,headers:n.headers})})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})}),bv=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
Use three sentences maximum and keep the answer as concise as possible.

{context}
`,xv=Vn(e=>{const{source:r,documents:a}=e,t=Nr(),{toast:n}=xt(),{t:i}=Oe("dialogs"),{loading:s,createPrompt:o}=Al(),l=async d=>{try{if(!d.content||!d.content.includes("{context}")){n({title:i("create_vector_database_prompt.errors.fill_context"),variant:"destructive"});return}const u=d.content.replace("{context}",a.map(p=>`<document>${p.pageContent}</document>`).join(`
`));return await o(r,{...d,content:u}),t.hide(),!0}catch{n({title:i("create_vector_database_prompt.errors.create_failed"),variant:"destructive"})}};return c.jsx(Jn,{open:t.visible,onOpenChange:t.hide,children:c.jsxs(Kn,{className:"sm:max-w-[425px]",children:[c.jsx(Xn,{children:c.jsxs("div",{className:"flex",children:[c.jsx(ve,{name:"file",className:"mr-2 h-4 w-4"}),c.jsx(Yn,{children:i("create_vector_database_prompt.title")})]})}),c.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[c.jsx(js,{onSubmit:l,loading:s,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:bv}),c.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[c.jsx(ve,{name:"info",className:"mr-2",size:14}),i("create_vector_database_prompt.fill_content_note")]})]})]})})}),jv=()=>{const e=et(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=w.useState(!1),t=me(s=>s.createOrUpdateFlowNode),n=me(s=>s.createOrUpdateFlowEdge),i=w.useCallback(async({prompt:s,source:o,metadata:l})=>{var d,u,p,h;try{const v=(d=o==null?void 0:o.data)==null?void 0:d.entity;if(!v||!e)throw new Error("Source or Session not found");a(!0);const f=((u=o.position)==null?void 0:u.x)||0,m=(((p=o.position)==null?void 0:p.y)||0)+(((h=o.measured)==null?void 0:h.height)||0),g=await ue("Prompt").save({...s,status:(s==null?void 0:s.status)||$t.Started,role:(s==null?void 0:s.role)||Ot.System,type:(s==null?void 0:s.type)||Tt.Chat,content:(s==null?void 0:s.content)||"{context}",session_id:e});if(!g)throw new Error("Failed to save prompt");const b=await t({source_id:g.id,source_type:"Prompt",node_type:V.Prompt,x:f,y:m+20});if(!b)throw new Error("Failed to save prompt node");const S=await ue("FlowNodePlaceholder").save({placeholder:`Retriever for ${v.name}`,placeholder_type:Sa.VECTOR_DATABASE_RETREIVER,session_id:e,metadata:l});if(!S)throw new Error("Failed to save node placeholder");const O=await t({source_id:S.id,source_type:"FlowNodePlaceholder",node_type:V.PlaceHolder,x:f,y:m+40});if(!O)throw new Error("Failed to save node placeholder node");await n({source:b.id,target:O.id}),await n({source:o.id,target:O.id})}finally{a(!1)}},[e,t,n]);return{loading:r,createVectorDatabaseRetriever:i}},Sv=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}
`,Ev=Vn(e=>{const{source:r}=e,a=Nr(),{toast:t}=xt(),{t:n}=Oe("dialogs"),[i,s]=w.useState(1),[o,l]=w.useState(void 0),{loading:d,createVectorDatabaseRetriever:u}=jv(),p=async f=>{try{const m=f.content;if(!m||!m.includes("{context}")){t({title:n("create_vector_database_retriever.errors.fill_context"),variant:"destructive"});return}return await u({source:r,prompt:{content:m},metadata:{k:i,minimalScore:o}}),s(1),l(void 0),a.hide(),!0}catch{t({title:n("create_vector_database_retriever.errors.create_failed"),variant:"destructive"})}},h=f=>{s(f.target.value?Number(f.target.value):void 0)},v=f=>{l(f.target.value?Number(f.target.value):void 0)};return c.jsx(Jn,{open:a.visible,onOpenChange:a.hide,children:c.jsxs(Kn,{className:"sm:max-w-[425px]",children:[c.jsx(Xn,{children:c.jsxs("div",{className:"flex",children:[c.jsx(ve,{name:"file",className:"mr-2 h-4 w-4"}),c.jsx(Yn,{children:n("create_vector_database_retriever.title")})]})}),c.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[c.jsx(js,{onSubmit:p,loading:d,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:Sv}),c.jsxs(Ge,{children:[c.jsx(pt,{children:c.jsx(gt,{children:n("create_vector_database_retriever.retriever_settings")})}),c.jsxs(mt,{children:[c.jsx(we,{children:n("create_vector_database_retriever.retriever_k")}),c.jsx(nt,{value:i||"",type:"number",onChange:h,placeholder:n("create_vector_database_retriever.retriever_k_placeholder")}),c.jsx(we,{children:n("create_vector_database_retriever.retriever_minimum_score")}),c.jsx(nt,{value:o||"",type:"number",onChange:v,placeholder:n("create_vector_database_retriever.retriever_minimum_score_placeholder")})]})]}),c.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[c.jsx(ve,{name:"info",className:"mr-2",size:14}),n("create_vector_database_retriever.fill_content_note")]})]})]})})}),Xl=()=>{const{getNodes:e}=Mt(),r=w.useCallback(()=>e().find(t=>t.type===V.DefaultEmbeddingModel),[e]),a=w.useCallback(()=>{var t,n;return(n=(t=r())==null?void 0:t.data)==null?void 0:n.entity},[r]);return{getFlowEmbeddingNode:r,getFlowEmbeddingEntity:a}},kv=e=>{const r=me(i=>i.createOrUpdateFlowEdge),{getFlowEmbeddingEntity:a}=Xl(),{confirmPassphrase:t}=Jr(),n=w.useCallback(async({edgeId:i,target:s,source:o})=>{var l,d;try{const u=(l=s==null?void 0:s.data)==null?void 0:l.entity;if((o==null?void 0:o.type)===V.CSVData&&(s==null?void 0:s.type)===V.VectorDatabase){const p=(d=o==null?void 0:o.data)==null?void 0:d.entity;if(!p||!u)return{deleteEdgeId:i};const{rows:h}=ip(p.headers,p.csv),v=h.map(f=>new op({pageContent:`${f.text}`}));await t(),await Gr.index(a(),{database:{databaseId:u.id,dataSourceId:p.id,dataSourceType:"CSVData"}},v),await r({source:o.id,target:s.id});return}return{deleteEdgeId:i}}catch{return{deleteEdgeId:i}}},[r,a,t]);vt(e,n)},Pv=e=>{const[r,a]=w.useState(!1),{t}=Oe("flows"),{toast:n}=xt(),{getNode:i,getHandleConnections:s}=Mt(),o=me(h=>h.updateNodes),{getFlowEmbeddingEntity:l}=Xl(),{confirmPassphrase:d}=Jr(),u=w.useCallback(async(h,v)=>{var f,m,g;try{const b=i(e);if(!b)return;const S=(f=b.data)==null?void 0:f.entity;if(!S){n({variant:"destructive",title:t("vector_database_node.errors.vector_database_not_found")});return}const O=l();if(S.storage===Tr.DataNode){const x=(g=(m=s({nodeId:e,type:"target"}).map(E=>i(E.source)).find(E=>(E==null?void 0:E.type)&&[V.JSONLData,V.CSVData].includes(E==null?void 0:E.type)))==null?void 0:m.data)==null?void 0:g.entity;if(!x){n({variant:"destructive",title:t("vector_database_node.errors.data_node_not_found")});return}return a(!0),await d(),await Gr.similaritySearchWithScore(O,{database:{databaseId:S.id,dataSourceId:x.id,dataSourceType:Oo(x)}},h,v==null?void 0:v.k)}else return a(!0),await d(),await Gr.similaritySearchWithScore(O,{database:{databaseId:S.id}},h,v==null?void 0:v.k)}catch{n({variant:"destructive",title:t("vector_database_node.errors.similarity_search_failed")})}finally{a(!1)}},[i,e,l,n,t,s,d]),p=w.useCallback(async(h,v)=>{var f,m,g,b;try{const S=i(e);if(!S)return;a(!0);const O=h.content?[new op({pageContent:h.content,id:h.id,metadata:{id:h.id}})]:h.documents;if(!(O!=null&&O.length)){n({variant:"destructive",title:t("vector_database_node.errors.content_not_found")});return}const x=(f=S.data)==null?void 0:f.entity;if(!x||!S){n({variant:"destructive",title:t("vector_database_node.errors.vector_database_not_found")});return}const E=l();if(x.storage===Tr.DataNode){const $=s({nodeId:e,type:"target"}).map(T=>i(T.source)).find(T=>(T==null?void 0:T.type)&&[V.JSONLData,V.CSVData].includes(T==null?void 0:T.type)),C=(m=$==null?void 0:$.data)==null?void 0:m.entity;if(!C){n({variant:"destructive",title:t("vector_database_node.errors.data_node_not_found")});return}const R=Oo(C),D=Zh(O,10);let L=0;for(const T of D){if((g=v==null?void 0:v.onProgressReport)==null||g.call(v,{handling:T.length,handled:L,total:O.length}),await d(),await Gr.index(E,{database:{databaseId:x.id,dataSourceId:C.id,dataSourceType:R}},T),R&&$){const z=await ue(R).findOne({where:{id:C.id}});o([{type:"replace",id:$.id,item:{...$,data:{...$.data,entity:z}}}])}L+=T.length}}else{const $=Zh(O,10);let C=0;for(const R of $){(b=v==null?void 0:v.onProgressReport)==null||b.call(v,{handling:R.length,handled:C,total:O.length}),await d(),await Gr.index(E,{database:{databaseId:x.id}},R);const D=await ue("VectorDatabase").findOne({where:{id:`${x.id}`}});o([{type:"replace",id:S.id,item:{...S,data:{...S.data,entity:D}}}]),C+=R.length}}}catch{n({variant:"destructive",title:t("vector_database_node.errors.similarity_search_failed")})}finally{a(!1)}},[i,e,l,n,t,s,o,d]);return{loading:r,indexData:p,similaritySearchWithScore:u}},Nv=w.memo(e=>{var $,C,R,D;const{t:r}=Oe("flows"),[a,t]=w.useState(0),[n,i]=w.useState("search"),s=lt(e.id),{id:o,data:l,isConnectable:d}=e,{loading:u,similaritySearchWithScore:p,indexData:h}=Pv(o),v=Nr(xv),f=Nr(Ev);kv(o);const m=w.useCallback(async(...L)=>{s&&await h(...L)},[h,s]),g=w.useCallback(async(L,T)=>{const z=L.trim(),M=await p(z,{k:T});if(M!=null&&M.length)return M},[p]),b=w.useCallback(L=>{v.show({source:s,documents:L.map(([T])=>T)})},[v,s]),S=w.useCallback(async()=>{f.show({source:s})},[f,s]),O=w.useCallback(async L=>{if(L.type.includes("text")||L.type.includes("txt")){const T=new FileReader;T.onload=async z=>{var H;const M=(H=z.target)==null?void 0:H.result;await m({content:M})},T.readAsText(L)}else if(L.type.endsWith("pdf")){const T=new Blob([L],{type:"application/pdf"}),z=await new Cb(T,{pdfjs:async()=>{const M=await jt(()=>import("./pdf.min-86084oMr.js").then(async H=>(await H.__tla,H)),__vite__mapDeps([10,2,3,1,4,5,6]));return await jt(()=>import("./pdf.worker.min-ClXYzjno.js").then(async H=>(await H.__tla,H)),__vite__mapDeps([11,1,2,3,4,5,6])),M.GlobalWorkerOptions.workerSrc=new URL("pdfjs-dist/build/pdf.worker.min.js",import.meta.url).toString(),M},parsedItemSeparator:" "}).load();await m({documents:z},{onProgressReport:M=>{t((M.handled+M.handling)/M.total)}})}},[m]),x=w.useMemo(()=>{var z,M;if(!((z=l==null?void 0:l.entity)!=null&&z.raw))return{headers:[],rows:[]};const L=["content","embedding","metadata"],T=To((M=l==null?void 0:l.entity)==null?void 0:M.raw);return{headers:L,rows:T.map(H=>{try{return JSON.parse(H)}catch{return[]}})}},[($=l==null?void 0:l.entity)==null?void 0:$.raw]),E=w.useMemo(()=>{switch(n){case"search":return c.jsx(or,{value:"search",children:c.jsx(Tb,{loading:u,onSimilaritySearch:g,onCreatePrompt:b,onCreateRetriever:S})});case"new":return c.jsx(or,{className:"min-w-80",value:"new",children:c.jsx(Ob,{loading:u,onCreateData:m})});case"file":return c.jsx(or,{value:"file",children:c.jsx($b,{loading:u,progress:a,onFileSubmit:O,fileOptions:{accept:".pdf,.txt,.text",maxSize:15}})});case"view":return c.jsx(or,{value:"view",children:c.jsx(No,{data:x.rows,headers:x.headers,limitLengthByColumns:{embedding:32}})})}},[m,b,S,O,g,u,n,a,x]);return c.jsxs("div",{className:"min-w-72",children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:d}),c.jsxs("div",{className:"max-w-full",children:[c.jsx(ut,{id:o}),c.jsxs(Ct,{className:"flex justify-center",variant:"default",children:[c.jsx(ve,{size:24,name:"database-zap"}),c.jsxs("div",{className:"ml-2 max-w-full",children:[c.jsx(lr,{children:`${((C=l.entity)==null?void 0:C.name)||""}`}),c.jsxs(Zn,{value:n,onValueChange:i,defaultValue:"search",className:Fe("w-full mt-4"),children:[c.jsxs(Po,{className:Fe("grid w-full grid-cols-3",((R=l.entity)==null?void 0:R.storage)===Tr.DatabaseNode?"grid-cols-4":"grid-cols-3"),children:[c.jsx(ir,{value:"search",children:r("vector_database_node.search")}),c.jsx(ir,{value:"new",children:r("vector_database_node.text")}),c.jsx(ir,{value:"file",children:r("vector_database_node.file")}),((D=l.entity)==null?void 0:D.storage)===Tr.DatabaseNode?c.jsx(ir,{value:"view",children:r("vector_database_node.view")}):void 0]}),E]})]})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:d})]})}),Cv={embedding:32},$v=w.memo(e=>{var i,s,o;const{id:r,data:a,isConnectable:t}=e,n=w.useMemo(()=>{var u;if(!((u=a==null?void 0:a.entity)!=null&&u.jsonl))return{headers:[],rows:[]};const l=Io(a.entity.headers||""),d=To(a.entity.jsonl);return{headers:l,rows:d.map(p=>{try{return JSON.parse(p)}catch{return[]}})}},[(i=a==null?void 0:a.entity)==null?void 0:i.jsonl,a.entity.headers]);return c.jsxs("div",{className:"min-w-80",children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(ut,{id:r}),c.jsxs(Ge,{className:"min-w-32 min-h-16 p-4",children:[c.jsx(pt,{className:"!p-0",children:c.jsxs("div",{className:"pt-2 flex !flex-row",children:[c.jsx(ve,{name:"file-json",className:"mr-2"}),c.jsxs(we,{className:"!font-medium leading-none tracking-tight pr-8",children:[V.JSONLData," ",(s=n==null?void 0:n.rows)!=null&&s.length?`(${((o=n==null?void 0:n.rows)==null?void 0:o.length)||0})`:""]})]})}),c.jsx(mt,{className:"pb-0",children:c.jsx(No,{data:n.rows,headers:n.headers,limitLengthByColumns:Cv})})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})}),Ov=e=>{const r=w.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);vt(e,r)},Tv=w.memo(e=>{var s,o;const{id:r,data:a,isConnectable:t}=e,{t:n}=Oe("flows");Ov(r);let i="";switch((s=a.entity)==null?void 0:s.placeholder_type){case"VECTOR_DATABASE_RETREIVER":i=n("placeholder_node.vector_database_retriever");break}return c.jsxs("div",{children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsxs(Ct,{className:"flex justify-center max-w-80",variant:"default",children:[c.jsx(ut,{id:r}),c.jsx(ve,{name:"land-plot",className:"w-7 h-7"}),c.jsxs("div",{className:"ml-2 pr-4",children:[c.jsx(lr,{children:`${((o=a.entity)==null?void 0:o.placeholder)||""}`}),c.jsx(Qr,{children:i?c.jsx(Or,{children:i}):void 0})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:t})]})}),Iv=e=>{const r=w.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);vt(e,r)},Yl=(e,r)=>e.anyOf.length?e.anyOf.length===1?dt(e.anyOf[0],{...r,path:[...r.path,"anyOf",0]}):`z.union([${e.anyOf.map((a,t)=>dt(a,{...r,path:[...r.path,"anyOf",t]})).join(", ")}])`:"z.any()",Lv=e=>"z.boolean()",Av=e=>"z.any()",Rv=(e,r)=>`z.union([${e.type.map(a=>dt({...e,type:a},{...r,withoutDefaults:!0})).join(", ")}])`,Fv=(e,r)=>`z.any().refine((value) => !${dt(e.not,{...r,path:[...r.path,"not"]})}.safeParse(value).success, "Invalid input: Should NOT be valid against schema")`,Dv=e=>"z.null()",Mv=e=>[e.slice(0,e.length/2),e.slice(e.length/2)],Ia=Symbol("Original index"),zv=e=>{let r=[];for(let a=0;a<e.length;a++){const t=e[a];if(typeof t=="boolean")r.push(t?{[Ia]:a}:{[Ia]:a,not:{}});else{if(Ia in t)return e;r.push({...t,[Ia]:a})}}return r};function fn(e,r){if(e.allOf.length===0)return"z.never()";if(e.allOf.length===1){const a=e.allOf[0];return dt(a,{...r,path:[...r.path,"allOf",a[Ia]]})}else{const[a,t]=Mv(zv(e.allOf));return`z.intersection(${fn({allOf:a},r)}, ${fn({allOf:t},r)})`}}function ct(e,r,a){var i;const t=e[r];let n="";if(t!==void 0){const s=a({value:t,json:JSON.stringify(t)});if(s){const o=s[0],l=s.length===3?s[1]:"",d=s.length===3?s[2]:s[1];n+=o,((i=e.errorMessage)==null?void 0:i[r])!==void 0&&(n+=l+JSON.stringify(e.errorMessage[r])),n+=d}}return n}const Uv=(e,r)=>{if(Array.isArray(e.items))return`z.tuple([${e.items.map((t,n)=>dt(t,{...r,path:[...r.path,"items",n]}))}])`;let a=e.items?`z.array(${dt(e.items,{...r,path:[...r.path,"items"]})})`:"z.array(z.any())";return a+=ct(e,"minItems",({json:t})=>[`.min(${t}`,", ",")"]),a+=ct(e,"maxItems",({json:t})=>[`.max(${t}`,", ",")"]),a},Hv=e=>`z.literal(${JSON.stringify(e.const)})`,qv=e=>e.enum.length===0?"z.never()":e.enum.length===1?`z.literal(${JSON.stringify(e.enum[0])})`:e.enum.every(r=>typeof r=="string")?`z.enum([${e.enum.map(r=>JSON.stringify(r))}])`:`z.union([${e.enum.map(r=>`z.literal(${JSON.stringify(r)})`).join(", ")}])`,Vv=(e,r)=>{const a=dt(e.if,{...r,path:[...r.path,"if"]}),t=dt(e.then,{...r,path:[...r.path,"then"]}),n=dt(e.else,{...r,path:[...r.path,"else"]});return`z.union([${t}, ${n}]).superRefine((value,ctx) => {
  const result = ${a}.safeParse(value).success
    ? ${t}.safeParse(value)
    : ${n}.safeParse(value);
  if (!result.success) {
    result.error.errors.forEach((error) => ctx.addIssue(error))
  }
})`},Bv=e=>{let r="z.number()";return e.type==="integer"?r+=ct(e,"type",()=>[".int(",")"]):r+=ct(e,"format",({value:a})=>{if(a==="int64")return[".int(",")"]}),r+=ct(e,"multipleOf",({value:a,json:t})=>a===1?r.startsWith("z.number().int(")?void 0:[".int(",")"]:[`.multipleOf(${t}`,", ",")"]),typeof e.minimum=="number"?e.exclusiveMinimum===!0?r+=ct(e,"minimum",({json:a})=>[`.gt(${a}`,", ",")"]):r+=ct(e,"minimum",({json:a})=>[`.gte(${a}`,", ",")"]):typeof e.exclusiveMinimum=="number"&&(r+=ct(e,"exclusiveMinimum",({json:a})=>[`.gt(${a}`,", ",")"])),typeof e.maximum=="number"?e.exclusiveMaximum===!0?r+=ct(e,"maximum",({json:a})=>[`.lt(${a}`,", ",")"]):r+=ct(e,"maximum",({json:a})=>[`.lte(${a}`,", ",")"]):typeof e.exclusiveMaximum=="number"&&(r+=ct(e,"exclusiveMaximum",({json:a})=>[`.lt(${a}`,", ",")"])),r},ec=(e,r)=>e.oneOf.length?e.oneOf.length===1?dt(e.oneOf[0],{...r,path:[...r.path,"oneOf",0]}):`z.any().superRefine((x, ctx) => {
    const schemas = [${e.oneOf.map((a,t)=>dt(a,{...r,path:[...r.path,"oneOf",t]})).join(", ")}];
    const errors = schemas.reduce<z.ZodError[]>(
      (errors, schema) =>
        ((result) =>
          result.error ? [...errors, result.error] : errors)(
          schema.safeParse(x),
        ),
      [],
    );
    if (schemas.length - errors.length !== 1) {
      ctx.addIssue({
        path: ctx.path,
        code: "invalid_union",
        unionErrors: errors,
        message: "Invalid input: Should pass single schema",
      });
    }
  })`:"z.any()",tc=e=>{const r=e.split(`
`);return`/**${r.length===1?r[0]:`
${r.map(a=>`* ${a}`).join(`
`)}
`}*/
`},Wv=(e,r)=>{const a=e.description;return a?`
${tc(a)}${r}`:r};function Zv(e,r){let a;e.properties&&(Object.keys(e.properties).length?(a="z.object({ ",a+=Object.keys(e.properties).map(s=>{const o=e.properties[s];let l=`${JSON.stringify(s)}: ${dt(o,{...r,path:[...r.path,"properties",s]})}`;r.withJsdocs&&typeof o=="object"&&(l=Wv(o,l));const d=typeof o=="object"&&o.default!==void 0,u=Array.isArray(e.required)?e.required.includes(s):typeof o=="object"&&o.required===!0;return!d&&!u?`${l}.optional()`:l}).join(", "),a+=" })"):a="z.object({})");const t=e.additionalProperties!==void 0?dt(e.additionalProperties,{...r,path:[...r.path,"additionalProperties"]}):void 0;let n;if(e.patternProperties){const s=Object.fromEntries(Object.entries(e.patternProperties).map(([o,l])=>[o,dt(l,{...r,path:[...r.path,"patternProperties",o]})],{}));n="",a?t?n+=`.catchall(z.union([${[...Object.values(s),t].join(", ")}]))`:Object.keys(s).length>1?n+=`.catchall(z.union([${Object.values(s).join(", ")}]))`:n+=`.catchall(${Object.values(s)})`:t?n+=`z.record(z.union([${[...Object.values(s),t].join(", ")}]))`:Object.keys(s).length>1?n+=`z.record(z.union([${Object.values(s).join(", ")}]))`:n+=`z.record(${Object.values(s)})`,n+=`.superRefine((value, ctx) => {
`,n+=`for (const key in value) {
`,t&&(e.properties?n+=`let evaluated = [${Object.keys(e.properties).map(o=>JSON.stringify(o)).join(", ")}].includes(key)
`:n+=`let evaluated = false
`);for(const o in e.patternProperties)n+="if (key.match(new RegExp("+JSON.stringify(o)+`))) {
`,t&&(n+=`evaluated = true
`),n+="const result = "+s[o]+`.safeParse(value[key])
`,n+=`if (!result.success) {
`,n+=`ctx.addIssue({
          path: [...ctx.path, key],
          code: 'custom',
          message: \`Invalid input: Key matching regex /\${key}/ must match schema\`,
          params: {
            issues: result.error.issues
          }
        })
`,n+=`}
`,n+=`}
`;t&&(n+=`if (!evaluated) {
`,n+="const result = "+t+`.safeParse(value[key])
`,n+=`if (!result.success) {
`,n+=`ctx.addIssue({
          path: [...ctx.path, key],
          code: 'custom',
          message: \`Invalid input: must match catchall schema\`,
          params: {
            issues: result.error.issues
          }
        })
`,n+=`}
`,n+=`}
`),n+=`}
`,n+="})"}let i=a?n?a+n:t?t==="z.never()"?a+".strict()":a+`.catchall(${t})`:a:n||(t?`z.record(${t})`:"z.record(z.any())");return st.an.anyOf(e)&&(i+=`.and(${Yl({...e,anyOf:e.anyOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},r)})`),st.a.oneOf(e)&&(i+=`.and(${ec({...e,oneOf:e.oneOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},r)})`),st.an.allOf(e)&&(i+=`.and(${fn({...e,allOf:e.allOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},r)})`),i}const Gv=e=>{let r="z.string()";r+=ct(e,"format",({value:t})=>{switch(t){case"email":return[".email(",")"];case"ip":return[".ip(",")"];case"ipv4":return['.ip({ version: "v4"',", message: "," })"];case"ipv6":return['.ip({ version: "v6"',", message: "," })"];case"uri":return[".url(",")"];case"uuid":return[".uuid(",")"];case"date-time":return[".datetime({ offset: true",", message: "," })"];case"time":return[".time(",")"];case"date":return[".date(",")"];case"binary":return[".base64(",")"];case"duration":return[".duration(",")"]}}),r+=ct(e,"pattern",({json:t})=>[`.regex(new RegExp(${t})`,", ",")"]),r+=ct(e,"minLength",({json:t})=>[`.min(${t}`,", ",")"]),r+=ct(e,"maxLength",({json:t})=>[`.max(${t}`,", ",")"]),r+=ct(e,"contentEncoding",({value:t})=>{if(t==="base64")return[".base64(",")"]});const a=ct(e,"contentMediaType",({value:t})=>{if(t==="application/json")return['.transform((str, ctx) => { try { return JSON.parse(str); } catch (err) { ctx.addIssue({ code: "custom", message: "Invalid JSON" }); }}',", ",")"]});return a!=""&&(r+=a,r+=ct(e,"contentSchema",({value:t})=>{if(t&&t instanceof Object)return[`.pipe(${dt(t)}`,", ",")"]})),r},Qv=(e,...r)=>Object.keys(e).reduce((a,t)=>(r.includes(t)||(a[t]=e[t]),a),{}),Jv=(e,r)=>`${dt(Qv(e,"nullable"),r,!0)}.nullable()`,dt=(e,r={seen:new Map,path:[]},a)=>{if(typeof e!="object")return e?"z.any()":"z.never()";if(r.parserOverride){const i=r.parserOverride(e,r);if(typeof i=="string")return i}let t=r.seen.get(e);if(t){if(t.r!==void 0)return t.r;if(r.depth===void 0||t.n>=r.depth)return"z.any()";t.n+=1}else t={r:void 0,n:0},r.seen.set(e,t);let n=eg(e,r);return a||(r.withoutDescribes||(n=Kv(e,n)),r.withoutDefaults||(n=Xv(e,n)),n=Yv(e,n)),t.r=n,n},Kv=(e,r)=>(e.description&&(r+=`.describe(${JSON.stringify(e.description)})`),r),Xv=(e,r)=>(e.default!==void 0&&(r+=`.default(${JSON.stringify(e.default)})`),r),Yv=(e,r)=>(e.readOnly&&(r+=".readonly()"),r),eg=(e,r)=>st.a.nullable(e)?Jv(e,r):st.an.object(e)?Zv(e,r):st.an.array(e)?Uv(e,r):st.an.anyOf(e)?Yl(e,r):st.an.allOf(e)?fn(e,r):st.a.oneOf(e)?ec(e,r):st.a.not(e)?Fv(e,r):st.an.enum(e)?qv(e):st.a.const(e)?Hv(e):st.a.multipleType(e)?Rv(e,r):st.a.primitive(e,"string")?Gv(e):st.a.primitive(e,"number")||st.a.primitive(e,"integer")?Bv(e):st.a.primitive(e,"boolean")?Lv():st.a.primitive(e,"null")?Dv():st.a.conditional(e)?Vv(e,r):Av(),st={an:{object:e=>e.type==="object",array:e=>e.type==="array",anyOf:e=>e.anyOf!==void 0,allOf:e=>e.allOf!==void 0,enum:e=>e.enum!==void 0},a:{nullable:e=>e.nullable===!0,multipleType:e=>Array.isArray(e.type),not:e=>e.not!==void 0,const:e=>e.const!==void 0,primitive:(e,r)=>e.type===r,conditional:e=>!!("if"in e&&e.if&&"then"in e&&"else"in e&&e.then&&e.else),oneOf:e=>e.oneOf!==void 0}},tg=(e,{module:r,name:a,type:t,noImport:n,...i}={})=>{if(t&&(!a||r!=="esm"))throw new Error("Option `type` requires `name` to be set and `module` to be `esm`");let s=dt(e,{module:r,name:a,path:[],seen:new Map,...i});const o=i.withJsdocs&&typeof e!="boolean"&&e.description?tc(e.description):"";if(r==="cjs"?(s=`${o}module.exports = ${a?`{ ${JSON.stringify(a)}: ${s} }`:s}
`,n||(s=`${o}const { z } = require("zod")

${s}`)):r==="esm"?(s=`${o}export ${a?`const ${a} =`:"default"} ${s}
`,n||(s=`import { z } from "zod"

${s}`)):a&&(s=`${o}const ${a} = ${s}`),t&&a){let l=typeof t=="string"?t:`${a[0].toUpperCase()}${a.substring(1)}`;s+=`export type ${l} = z.infer<typeof ${a}>
`}return s},vn="2025-06-18",rg=[vn,"2025-03-26","2024-11-05","2024-10-07"],gn="2.0",rc=y.union([y.string(),y.number().int()]),ac=y.string(),ag=y.object({progressToken:y.optional(rc)}).passthrough(),Lt=y.object({_meta:y.optional(ag)}).passthrough(),Et=y.object({method:y.string(),params:y.optional(Lt)}),La=y.object({_meta:y.optional(y.object({}).passthrough())}).passthrough(),Zt=y.object({method:y.string(),params:y.optional(La)}),At=y.object({_meta:y.optional(y.object({}).passthrough())}).passthrough(),yn=y.union([y.string(),y.number().int()]),nc=y.object({jsonrpc:y.literal(gn),id:yn}).merge(Et).strict(),sc=e=>nc.safeParse(e).success,ic=y.object({jsonrpc:y.literal(gn)}).merge(Zt).strict(),ng=e=>ic.safeParse(e).success,oc=y.object({jsonrpc:y.literal(gn),id:yn,result:At}).strict(),Es=e=>oc.safeParse(e).success;var Gt;(function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"})(Gt||(Gt={}));const lc=y.object({jsonrpc:y.literal(gn),id:yn,error:y.object({code:y.number().int(),message:y.string(),data:y.optional(y.unknown())})}).strict(),sg=e=>lc.safeParse(e).success,Aa=y.union([nc,ic,oc,lc]),ra=At.strict(),ks=Zt.extend({method:y.literal("notifications/cancelled"),params:La.extend({requestId:yn,reason:y.string().optional()})}),Ra=y.object({name:y.string(),title:y.optional(y.string())}).passthrough(),cc=Ra.extend({version:y.string()}),ig=y.object({experimental:y.optional(y.object({}).passthrough()),sampling:y.optional(y.object({}).passthrough()),elicitation:y.optional(y.object({}).passthrough()),roots:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough())}).passthrough(),og=Et.extend({method:y.literal("initialize"),params:Lt.extend({protocolVersion:y.string(),capabilities:ig,clientInfo:cc})}),lg=y.object({experimental:y.optional(y.object({}).passthrough()),logging:y.optional(y.object({}).passthrough()),completions:y.optional(y.object({}).passthrough()),prompts:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough()),resources:y.optional(y.object({subscribe:y.optional(y.boolean()),listChanged:y.optional(y.boolean())}).passthrough()),tools:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough())}).passthrough(),dc=At.extend({protocolVersion:y.string(),capabilities:lg,serverInfo:cc,instructions:y.optional(y.string())}),uc=Zt.extend({method:y.literal("notifications/initialized")}),cg=e=>uc.safeParse(e).success,Ps=Et.extend({method:y.literal("ping")}),dg=y.object({progress:y.number(),total:y.optional(y.number()),message:y.optional(y.string())}).passthrough(),Ns=Zt.extend({method:y.literal("notifications/progress"),params:La.merge(dg).extend({progressToken:rc})}),_n=Et.extend({params:Lt.extend({cursor:y.optional(ac)}).optional()}),wn=At.extend({nextCursor:y.optional(ac)}),hc=y.object({uri:y.string(),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}).passthrough(),pc=hc.extend({text:y.string()}),mc=hc.extend({blob:y.string().base64()}),fc=Ra.extend({uri:y.string(),description:y.optional(y.string()),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}),ug=Ra.extend({uriTemplate:y.string(),description:y.optional(y.string()),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}),hg=_n.extend({method:y.literal("resources/list")}),vc=wn.extend({resources:y.array(fc)}),pg=_n.extend({method:y.literal("resources/templates/list")}),gc=wn.extend({resourceTemplates:y.array(ug)}),mg=Et.extend({method:y.literal("resources/read"),params:Lt.extend({uri:y.string()})}),yc=At.extend({contents:y.array(y.union([pc,mc]))}),fg=Zt.extend({method:y.literal("notifications/resources/list_changed")}),vg=Et.extend({method:y.literal("resources/subscribe"),params:Lt.extend({uri:y.string()})}),gg=Et.extend({method:y.literal("resources/unsubscribe"),params:Lt.extend({uri:y.string()})}),yg=Zt.extend({method:y.literal("notifications/resources/updated"),params:La.extend({uri:y.string()})}),_g=y.object({name:y.string(),description:y.optional(y.string()),required:y.optional(y.boolean())}).passthrough(),wg=Ra.extend({description:y.optional(y.string()),arguments:y.optional(y.array(_g)),_meta:y.optional(y.object({}).passthrough())}),bg=_n.extend({method:y.literal("prompts/list")}),_c=wn.extend({prompts:y.array(wg)}),xg=Et.extend({method:y.literal("prompts/get"),params:Lt.extend({name:y.string(),arguments:y.optional(y.record(y.string()))})}),Cs=y.object({type:y.literal("text"),text:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),$s=y.object({type:y.literal("image"),data:y.string().base64(),mimeType:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Os=y.object({type:y.literal("audio"),data:y.string().base64(),mimeType:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),jg=y.object({type:y.literal("resource"),resource:y.union([pc,mc]),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Sg=fc.extend({type:y.literal("resource_link")}),wc=y.union([Cs,$s,Os,Sg,jg]),Eg=y.object({role:y.enum(["user","assistant"]),content:wc}).passthrough(),bc=At.extend({description:y.optional(y.string()),messages:y.array(Eg)}),kg=Zt.extend({method:y.literal("notifications/prompts/list_changed")}),Pg=y.object({title:y.optional(y.string()),readOnlyHint:y.optional(y.boolean()),destructiveHint:y.optional(y.boolean()),idempotentHint:y.optional(y.boolean()),openWorldHint:y.optional(y.boolean())}).passthrough(),Ng=Ra.extend({description:y.optional(y.string()),inputSchema:y.object({type:y.literal("object"),properties:y.optional(y.object({}).passthrough()),required:y.optional(y.array(y.string()))}).passthrough(),outputSchema:y.optional(y.object({type:y.literal("object"),properties:y.optional(y.object({}).passthrough()),required:y.optional(y.array(y.string()))}).passthrough()),annotations:y.optional(Pg),_meta:y.optional(y.object({}).passthrough())}),Cg=_n.extend({method:y.literal("tools/list")}),xc=wn.extend({tools:y.array(Ng)}),bn=At.extend({content:y.array(wc).default([]),structuredContent:y.object({}).passthrough().optional(),isError:y.optional(y.boolean())});bn.or(At.extend({toolResult:y.unknown()}));const $g=Et.extend({method:y.literal("tools/call"),params:Lt.extend({name:y.string(),arguments:y.optional(y.record(y.unknown()))})}),Og=Zt.extend({method:y.literal("notifications/tools/list_changed")}),jc=y.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),Tg=Et.extend({method:y.literal("logging/setLevel"),params:Lt.extend({level:jc})}),Ig=Zt.extend({method:y.literal("notifications/message"),params:La.extend({level:jc,logger:y.optional(y.string()),data:y.unknown()})}),Lg=y.object({name:y.string().optional()}).passthrough(),Ag=y.object({hints:y.optional(y.array(Lg)),costPriority:y.optional(y.number().min(0).max(1)),speedPriority:y.optional(y.number().min(0).max(1)),intelligencePriority:y.optional(y.number().min(0).max(1))}).passthrough(),Rg=y.object({role:y.enum(["user","assistant"]),content:y.union([Cs,$s,Os])}).passthrough(),Fg=Et.extend({method:y.literal("sampling/createMessage"),params:Lt.extend({messages:y.array(Rg),systemPrompt:y.optional(y.string()),includeContext:y.optional(y.enum(["none","thisServer","allServers"])),temperature:y.optional(y.number()),maxTokens:y.number().int(),stopSequences:y.optional(y.array(y.string())),metadata:y.optional(y.object({}).passthrough()),modelPreferences:y.optional(Ag)})}),Dg=At.extend({model:y.string(),stopReason:y.optional(y.enum(["endTurn","stopSequence","maxTokens"]).or(y.string())),role:y.enum(["user","assistant"]),content:y.discriminatedUnion("type",[Cs,$s,Os])}),Mg=y.object({type:y.literal("boolean"),title:y.optional(y.string()),description:y.optional(y.string()),default:y.optional(y.boolean())}).passthrough(),zg=y.object({type:y.literal("string"),title:y.optional(y.string()),description:y.optional(y.string()),minLength:y.optional(y.number()),maxLength:y.optional(y.number()),format:y.optional(y.enum(["email","uri","date","date-time"]))}).passthrough(),Ug=y.object({type:y.enum(["number","integer"]),title:y.optional(y.string()),description:y.optional(y.string()),minimum:y.optional(y.number()),maximum:y.optional(y.number())}).passthrough(),Hg=y.object({type:y.literal("string"),title:y.optional(y.string()),description:y.optional(y.string()),enum:y.array(y.string()),enumNames:y.optional(y.array(y.string()))}).passthrough(),qg=y.union([Mg,zg,Ug,Hg]),Vg=Et.extend({method:y.literal("elicitation/create"),params:Lt.extend({message:y.string(),requestedSchema:y.object({type:y.literal("object"),properties:y.record(y.string(),qg),required:y.optional(y.array(y.string()))}).passthrough()})}),Bg=At.extend({action:y.enum(["accept","decline","cancel"]),content:y.optional(y.record(y.string(),y.unknown()))}),Wg=y.object({type:y.literal("ref/resource"),uri:y.string()}).passthrough(),Zg=y.object({type:y.literal("ref/prompt"),name:y.string()}).passthrough(),Gg=Et.extend({method:y.literal("completion/complete"),params:Lt.extend({ref:y.union([Zg,Wg]),argument:y.object({name:y.string(),value:y.string()}).passthrough(),context:y.optional(y.object({arguments:y.optional(y.record(y.string(),y.string()))}))})}),Sc=At.extend({completion:y.object({values:y.array(y.string()).max(100),total:y.optional(y.number().int()),hasMore:y.optional(y.boolean())}).passthrough()}),Qg=y.object({uri:y.string().startsWith("file://"),name:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Jg=Et.extend({method:y.literal("roots/list")}),Kg=At.extend({roots:y.array(Qg)}),Xg=Zt.extend({method:y.literal("notifications/roots/list_changed")});y.union([Ps,og,Gg,Tg,xg,bg,hg,pg,mg,vg,gg,$g,Cg]),y.union([ks,Ns,uc,Xg]),y.union([ra,Dg,Bg,Kg]),y.union([Ps,Fg,Vg,Jg]),y.union([ks,Ns,Ig,yg,fg,Og,kg]),y.union([ra,dc,Sc,bc,_c,vc,gc,yc,bn,xc]);class wr extends Error{constructor(r,a,t){super(`MCP error ${r}: ${a}`),this.code=r,this.data=t,this.name="McpError"}}const Yg=6e4;class ey{constructor(r){this._options=r,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this.setNotificationHandler(ks,a=>{const t=this._requestHandlerAbortControllers.get(a.params.requestId);t==null||t.abort(a.params.reason)}),this.setNotificationHandler(Ns,a=>{this._onprogress(a)}),this.setRequestHandler(Ps,a=>({}))}_setupTimeout(r,a,t,n,i=!1){this._timeoutInfo.set(r,{timeoutId:setTimeout(n,a),startTime:Date.now(),timeout:a,maxTotalTimeout:t,resetTimeoutOnProgress:i,onTimeout:n})}_resetTimeout(r){const a=this._timeoutInfo.get(r);if(!a)return!1;const t=Date.now()-a.startTime;if(a.maxTotalTimeout&&t>=a.maxTotalTimeout)throw this._timeoutInfo.delete(r),new wr(Gt.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:a.maxTotalTimeout,totalElapsed:t});return clearTimeout(a.timeoutId),a.timeoutId=setTimeout(a.onTimeout,a.timeout),!0}_cleanupTimeout(r){const a=this._timeoutInfo.get(r);a&&(clearTimeout(a.timeoutId),this._timeoutInfo.delete(r))}async connect(r){var a,t,n;this._transport=r;const i=(a=this.transport)===null||a===void 0?void 0:a.onclose;this._transport.onclose=()=>{i==null||i(),this._onclose()};const s=(t=this.transport)===null||t===void 0?void 0:t.onerror;this._transport.onerror=l=>{s==null||s(l),this._onerror(l)};const o=(n=this._transport)===null||n===void 0?void 0:n.onmessage;this._transport.onmessage=(l,d)=>{o==null||o(l,d),Es(l)||sg(l)?this._onresponse(l):sc(l)?this._onrequest(l,d):ng(l)?this._onnotification(l):this._onerror(new Error(`Unknown message type: ${JSON.stringify(l)}`))},await this._transport.start()}_onclose(){var r;const a=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._pendingDebouncedNotifications.clear(),this._transport=void 0,(r=this.onclose)===null||r===void 0||r.call(this);const t=new wr(Gt.ConnectionClosed,"Connection closed");for(const n of a.values())n(t)}_onerror(r){var a;(a=this.onerror)===null||a===void 0||a.call(this,r)}_onnotification(r){var a;const t=(a=this._notificationHandlers.get(r.method))!==null&&a!==void 0?a:this.fallbackNotificationHandler;t!==void 0&&Promise.resolve().then(()=>t(r)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(r,a){var t,n,i,s;const o=(t=this._requestHandlers.get(r.method))!==null&&t!==void 0?t:this.fallbackRequestHandler;if(o===void 0){(n=this._transport)===null||n===void 0||n.send({jsonrpc:"2.0",id:r.id,error:{code:Gt.MethodNotFound,message:"Method not found"}}).catch(u=>this._onerror(new Error(`Failed to send an error response: ${u}`)));return}const l=new AbortController;this._requestHandlerAbortControllers.set(r.id,l);const d={signal:l.signal,sessionId:(i=this._transport)===null||i===void 0?void 0:i.sessionId,_meta:(s=r.params)===null||s===void 0?void 0:s._meta,sendNotification:u=>this.notification(u,{relatedRequestId:r.id}),sendRequest:(u,p,h)=>this.request(u,p,{...h,relatedRequestId:r.id}),authInfo:a==null?void 0:a.authInfo,requestId:r.id,requestInfo:a==null?void 0:a.requestInfo};Promise.resolve().then(()=>o(r,d)).then(u=>{var p;if(!l.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({result:u,jsonrpc:"2.0",id:r.id})},u=>{var p,h;if(!l.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({jsonrpc:"2.0",id:r.id,error:{code:Number.isSafeInteger(u.code)?u.code:Gt.InternalError,message:(h=u.message)!==null&&h!==void 0?h:"Internal error"}})}).catch(u=>this._onerror(new Error(`Failed to send response: ${u}`))).finally(()=>{this._requestHandlerAbortControllers.delete(r.id)})}_onprogress(r){const{progressToken:a,...t}=r.params,n=Number(a),i=this._progressHandlers.get(n);if(!i){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(r)}`));return}const s=this._responseHandlers.get(n),o=this._timeoutInfo.get(n);if(o&&s&&o.resetTimeoutOnProgress)try{this._resetTimeout(n)}catch(l){s(l);return}i(t)}_onresponse(r){const a=Number(r.id),t=this._responseHandlers.get(a);if(t===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(r)}`));return}if(this._responseHandlers.delete(a),this._progressHandlers.delete(a),this._cleanupTimeout(a),Es(r))t(r);else{const n=new wr(r.error.code,r.error.message,r.error.data);t(n)}}get transport(){return this._transport}async close(){var r;await((r=this._transport)===null||r===void 0?void 0:r.close())}request(r,a,t){const{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}=t??{};return new Promise((o,l)=>{var d,u,p,h,v,f;if(!this._transport){l(new Error("Not connected"));return}((d=this._options)===null||d===void 0?void 0:d.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(r.method),(u=t==null?void 0:t.signal)===null||u===void 0||u.throwIfAborted();const m=this._requestMessageId++,g={...r,jsonrpc:"2.0",id:m};t!=null&&t.onprogress&&(this._progressHandlers.set(m,t.onprogress),g.params={...r.params,_meta:{...((p=r.params)===null||p===void 0?void 0:p._meta)||{},progressToken:m}});const b=x=>{var E;this._responseHandlers.delete(m),this._progressHandlers.delete(m),this._cleanupTimeout(m),(E=this._transport)===null||E===void 0||E.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:m,reason:String(x)}},{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}).catch($=>this._onerror(new Error(`Failed to send cancellation: ${$}`))),l(x)};this._responseHandlers.set(m,x=>{var E;if(!(!((E=t==null?void 0:t.signal)===null||E===void 0)&&E.aborted)){if(x instanceof Error)return l(x);try{const $=a.parse(x.result);o($)}catch($){l($)}}}),(h=t==null?void 0:t.signal)===null||h===void 0||h.addEventListener("abort",()=>{var x;b((x=t==null?void 0:t.signal)===null||x===void 0?void 0:x.reason)});const S=(v=t==null?void 0:t.timeout)!==null&&v!==void 0?v:Yg,O=()=>b(new wr(Gt.RequestTimeout,"Request timed out",{timeout:S}));this._setupTimeout(m,S,t==null?void 0:t.maxTotalTimeout,O,(f=t==null?void 0:t.resetTimeoutOnProgress)!==null&&f!==void 0?f:!1),this._transport.send(g,{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}).catch(x=>{this._cleanupTimeout(m),l(x)})})}async notification(r,a){var t,n;if(!this._transport)throw new Error("Not connected");if(this.assertNotificationCapability(r.method),((n=(t=this._options)===null||t===void 0?void 0:t.debouncedNotificationMethods)!==null&&n!==void 0?n:[]).includes(r.method)&&!r.params&&!(a!=null&&a.relatedRequestId)){if(this._pendingDebouncedNotifications.has(r.method))return;this._pendingDebouncedNotifications.add(r.method),Promise.resolve().then(()=>{var s;if(this._pendingDebouncedNotifications.delete(r.method),!this._transport)return;const o={...r,jsonrpc:"2.0"};(s=this._transport)===null||s===void 0||s.send(o,a).catch(l=>this._onerror(l))});return}const i={...r,jsonrpc:"2.0"};await this._transport.send(i,a)}setRequestHandler(r,a){const t=r.shape.method.value;this.assertRequestHandlerCapability(t),this._requestHandlers.set(t,(n,i)=>Promise.resolve(a(r.parse(n),i)))}removeRequestHandler(r){this._requestHandlers.delete(r)}assertCanSetRequestHandler(r){if(this._requestHandlers.has(r))throw new Error(`A request handler for ${r} already exists, which would be overridden`)}setNotificationHandler(r,a){this._notificationHandlers.set(r.shape.method.value,t=>Promise.resolve(a(r.parse(t))))}removeNotificationHandler(r){this._notificationHandlers.delete(r)}}function ty(e,r){return Object.entries(r).reduce((a,[t,n])=>(n&&typeof n=="object"?a[t]=a[t]?{...a[t],...n}:n:a[t]=n,a),{...e})}var xn={exports:{}},ry=xn.exports,Ec;function ay(){return Ec||(Ec=1,function(e,r){(function(a,t){t(r)})(ry,function(a){function t(){for(var N=arguments.length,I=Array(N),A=0;A<N;A++)I[A]=arguments[A];if(I.length>1){I[0]=I[0].slice(0,-1);for(var W=I.length-1,Q=1;Q<W;++Q)I[Q]=I[Q].slice(1,-1);return I[W]=I[W].slice(1),I.join("")}else return I[0]}function n(N){return"(?:"+N+")"}function i(N){return N===void 0?"undefined":N===null?"null":Object.prototype.toString.call(N).split(" ").pop().split("]").shift().toLowerCase()}function s(N){return N.toUpperCase()}function o(N){return N!=null?N instanceof Array?N:typeof N.length!="number"||N.split||N.setInterval||N.call?[N]:Array.prototype.slice.call(N):[]}function l(N,I){var A=N;if(I)for(var W in I)A[W]=I[W];return A}function d(N){var I="[A-Za-z]",A="[0-9]",W=t(A,"[A-Fa-f]"),Q=n(n("%[EFef]"+W+"%"+W+W+"%"+W+W)+"|"+n("%[89A-Fa-f]"+W+"%"+W+W)+"|"+n("%"+W+W)),je="[\\:\\/\\?\\#\\[\\]\\@]",be="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",qe=t(je,be),rt=N?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",Be=N?"[\\uE000-\\uF8FF]":"[]",De=t(I,A,"[\\-\\.\\_\\~]",rt);n(I+t(I,A,"[\\+\\-\\.]")+"*"),n(n(Q+"|"+t(De,be,"[\\:]"))+"*");var Ze=n(n("25[0-5]")+"|"+n("2[0-4]"+A)+"|"+n("1"+A+A)+"|"+n("0?[1-9]"+A)+"|0?0?"+A),tt=n(Ze+"\\."+Ze+"\\."+Ze+"\\."+Ze),$e=n(W+"{1,4}"),at=n(n($e+"\\:"+$e)+"|"+tt),We=n(n($e+"\\:")+"{6}"+at),Ft=n("\\:\\:"+n($e+"\\:")+"{5}"+at),xa=n(n($e)+"?\\:\\:"+n($e+"\\:")+"{4}"+at),Vt=n(n(n($e+"\\:")+"{0,1}"+$e)+"?\\:\\:"+n($e+"\\:")+"{3}"+at),pr=n(n(n($e+"\\:")+"{0,2}"+$e)+"?\\:\\:"+n($e+"\\:")+"{2}"+at),qr=n(n(n($e+"\\:")+"{0,3}"+$e)+"?\\:\\:"+$e+"\\:"+at),Vr=n(n(n($e+"\\:")+"{0,4}"+$e)+"?\\:\\:"+at),Dt=n(n(n($e+"\\:")+"{0,5}"+$e)+"?\\:\\:"+$e),mr=n(n(n($e+"\\:")+"{0,6}"+$e)+"?\\:\\:"),Br=n([We,Ft,xa,Vt,pr,qr,Vr,Dt,mr].join("|")),Yt=n(n(De+"|"+Q)+"+");n("[vV]"+W+"+\\."+t(De,be,"[\\:]")+"+"),n(n(Q+"|"+t(De,be))+"*");var Mn=n(Q+"|"+t(De,be,"[\\:\\@]"));return n(n(Q+"|"+t(De,be,"[\\@]"))+"+"),n(n(Mn+"|"+t("[\\/\\?]",Be))+"*"),{NOT_SCHEME:new RegExp(t("[^]",I,A,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",De,be),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",De,be),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",De,be),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",De,be),"g"),NOT_QUERY:new RegExp(t("[^\\%]",De,be,"[\\:\\@\\/\\?]",Be),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",De,be,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",De,be),"g"),UNRESERVED:new RegExp(De,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",De,qe),"g"),PCT_ENCODED:new RegExp(Q,"g"),IPV4ADDRESS:new RegExp("^("+tt+")$"),IPV6ADDRESS:new RegExp("^\\[?("+Br+")"+n(n("\\%25|\\%(?!"+W+"{2})")+"("+Yt+")")+"?\\]?$")}}var u=d(!1),p=d(!0),h=function(){function N(I,A){var W=[],Q=!0,je=!1,be=void 0;try{for(var qe=I[Symbol.iterator](),rt;!(Q=(rt=qe.next()).done)&&(W.push(rt.value),!(A&&W.length===A));Q=!0);}catch(Be){je=!0,be=Be}finally{try{!Q&&qe.return&&qe.return()}finally{if(je)throw be}}return W}return function(I,A){if(Array.isArray(I))return I;if(Symbol.iterator in Object(I))return N(I,A);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(N){if(Array.isArray(N)){for(var I=0,A=Array(N.length);I<N.length;I++)A[I]=N[I];return A}else return Array.from(N)},f=2147483647,m=36,g=1,b=26,S=38,O=700,x=72,E=128,$="-",C=/^xn--/,R=/[^\0-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,L={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=m-g,z=Math.floor,M=String.fromCharCode;function H(N){throw new RangeError(L[N])}function B(N,I){for(var A=[],W=N.length;W--;)A[W]=I(N[W]);return A}function ee(N,I){var A=N.split("@"),W="";A.length>1&&(W=A[0]+"@",N=A[1]),N=N.replace(D,".");var Q=N.split("."),je=B(Q,I).join(".");return W+je}function J(N){for(var I=[],A=0,W=N.length;A<W;){var Q=N.charCodeAt(A++);if(Q>=55296&&Q<=56319&&A<W){var je=N.charCodeAt(A++);(je&64512)==56320?I.push(((Q&1023)<<10)+(je&1023)+65536):(I.push(Q),A--)}else I.push(Q)}return I}var se=function(N){return String.fromCodePoint.apply(String,v(N))},ie=function(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:m},ke=function(N,I){return N+22+75*(N<26)-((I!=0)<<5)},Ie=function(N,I,A){var W=0;for(N=A?z(N/O):N>>1,N+=z(N/I);N>T*b>>1;W+=m)N=z(N/T);return z(W+(T+1)*N/(N+S))},G=function(N){var I=[],A=N.length,W=0,Q=E,je=x,be=N.lastIndexOf($);be<0&&(be=0);for(var qe=0;qe<be;++qe)N.charCodeAt(qe)>=128&&H("not-basic"),I.push(N.charCodeAt(qe));for(var rt=be>0?be+1:0;rt<A;){for(var Be=W,De=1,Ze=m;;Ze+=m){rt>=A&&H("invalid-input");var tt=ie(N.charCodeAt(rt++));(tt>=m||tt>z((f-W)/De))&&H("overflow"),W+=tt*De;var $e=Ze<=je?g:Ze>=je+b?b:Ze-je;if(tt<$e)break;var at=m-$e;De>z(f/at)&&H("overflow"),De*=at}var We=I.length+1;je=Ie(W-Be,We,Be==0),z(W/We)>f-Q&&H("overflow"),Q+=z(W/We),W%=We,I.splice(W++,0,Q)}return String.fromCodePoint.apply(String,I)},te=function(N){var I=[];N=J(N);var A=N.length,W=E,Q=0,je=x,be=!0,qe=!1,rt=void 0;try{for(var Be=N[Symbol.iterator](),De;!(be=(De=Be.next()).done);be=!0){var Ze=De.value;Ze<128&&I.push(M(Ze))}}catch(Ga){qe=!0,rt=Ga}finally{try{!be&&Be.return&&Be.return()}finally{if(qe)throw rt}}var tt=I.length,$e=tt;for(tt&&I.push($);$e<A;){var at=f,We=!0,Ft=!1,xa=void 0;try{for(var Vt=N[Symbol.iterator](),pr;!(We=(pr=Vt.next()).done);We=!0){var qr=pr.value;qr>=W&&qr<at&&(at=qr)}}catch(Ga){Ft=!0,xa=Ga}finally{try{!We&&Vt.return&&Vt.return()}finally{if(Ft)throw xa}}var Vr=$e+1;at-W>z((f-Q)/Vr)&&H("overflow"),Q+=(at-W)*Vr,W=at;var Dt=!0,mr=!1,Br=void 0;try{for(var Yt=N[Symbol.iterator](),Mn;!(Dt=(Mn=Yt.next()).done);Dt=!0){var kh=Mn.value;if(kh<W&&++Q>f&&H("overflow"),kh==W){for(var zn=Q,Un=m;;Un+=m){var Hn=Un<=je?g:Un>=je+b?b:Un-je;if(zn<Hn)break;var Ph=zn-Hn,Nh=m-Hn;I.push(M(ke(Hn+Ph%Nh,0))),zn=z(Ph/Nh)}I.push(M(ke(zn,0))),je=Ie(Q,Vr,$e==tt),Q=0,++$e}}}catch(Ga){mr=!0,Br=Ga}finally{try{!Dt&&Yt.return&&Yt.return()}finally{if(mr)throw Br}}++Q,++W}return I.join("")},ge=function(N){return ee(N,function(I){return C.test(I)?G(I.slice(4).toLowerCase()):I})},re=function(N){return ee(N,function(I){return R.test(I)?"xn--"+te(I):I})},_={version:"2.1.0",ucs2:{decode:J,encode:se},decode:G,encode:te,toASCII:re,toUnicode:ge},P={};function F(N){var I=N.charCodeAt(0),A=void 0;return I<16?A="%0"+I.toString(16).toUpperCase():I<128?A="%"+I.toString(16).toUpperCase():I<2048?A="%"+(I>>6|192).toString(16).toUpperCase()+"%"+(I&63|128).toString(16).toUpperCase():A="%"+(I>>12|224).toString(16).toUpperCase()+"%"+(I>>6&63|128).toString(16).toUpperCase()+"%"+(I&63|128).toString(16).toUpperCase(),A}function Z(N){for(var I="",A=0,W=N.length;A<W;){var Q=parseInt(N.substr(A+1,2),16);if(Q<128)I+=String.fromCharCode(Q),A+=3;else if(Q>=194&&Q<224){if(W-A>=6){var je=parseInt(N.substr(A+4,2),16);I+=String.fromCharCode((Q&31)<<6|je&63)}else I+=N.substr(A,6);A+=6}else if(Q>=224){if(W-A>=9){var be=parseInt(N.substr(A+4,2),16),qe=parseInt(N.substr(A+7,2),16);I+=String.fromCharCode((Q&15)<<12|(be&63)<<6|qe&63)}else I+=N.substr(A,9);A+=9}else I+=N.substr(A,3),A+=3}return I}function U(N,I){function A(W){var Q=Z(W);return Q.match(I.UNRESERVED)?Q:W}return N.scheme&&(N.scheme=String(N.scheme).replace(I.PCT_ENCODED,A).toLowerCase().replace(I.NOT_SCHEME,"")),N.userinfo!==void 0&&(N.userinfo=String(N.userinfo).replace(I.PCT_ENCODED,A).replace(I.NOT_USERINFO,F).replace(I.PCT_ENCODED,s)),N.host!==void 0&&(N.host=String(N.host).replace(I.PCT_ENCODED,A).toLowerCase().replace(I.NOT_HOST,F).replace(I.PCT_ENCODED,s)),N.path!==void 0&&(N.path=String(N.path).replace(I.PCT_ENCODED,A).replace(N.scheme?I.NOT_PATH:I.NOT_PATH_NOSCHEME,F).replace(I.PCT_ENCODED,s)),N.query!==void 0&&(N.query=String(N.query).replace(I.PCT_ENCODED,A).replace(I.NOT_QUERY,F).replace(I.PCT_ENCODED,s)),N.fragment!==void 0&&(N.fragment=String(N.fragment).replace(I.PCT_ENCODED,A).replace(I.NOT_FRAGMENT,F).replace(I.PCT_ENCODED,s)),N}function j(N){return N.replace(/^0*(.*)/,"$1")||"0"}function k(N,I){var A=N.match(I.IPV4ADDRESS)||[],W=h(A,2),Q=W[1];return Q?Q.split(".").map(j).join("."):N}function q(N,I){var A=N.match(I.IPV6ADDRESS)||[],W=h(A,3),Q=W[1],je=W[2];if(Q){for(var be=Q.toLowerCase().split("::").reverse(),qe=h(be,2),rt=qe[0],Be=qe[1],De=Be?Be.split(":").map(j):[],Ze=rt.split(":").map(j),tt=I.IPV4ADDRESS.test(Ze[Ze.length-1]),$e=tt?7:8,at=Ze.length-$e,We=Array($e),Ft=0;Ft<$e;++Ft)We[Ft]=De[Ft]||Ze[at+Ft]||"";tt&&(We[$e-1]=k(We[$e-1],I));var xa=We.reduce(function(Dt,mr,Br){if(!mr||mr==="0"){var Yt=Dt[Dt.length-1];Yt&&Yt.index+Yt.length===Br?Yt.length++:Dt.push({index:Br,length:1})}return Dt},[]),Vt=xa.sort(function(Dt,mr){return mr.length-Dt.length})[0],pr=void 0;if(Vt&&Vt.length>1){var qr=We.slice(0,Vt.index),Vr=We.slice(Vt.index+Vt.length);pr=qr.join(":")+"::"+Vr.join(":")}else pr=We.join(":");return je&&(pr+="%"+je),pr}else return N}var K=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,xe="".match(/(){0}/)[1]===void 0;function ce(N){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},A={},W=I.iri!==!1?p:u;I.reference==="suffix"&&(N=(I.scheme?I.scheme+":":"")+"//"+N);var Q=N.match(K);if(Q){xe?(A.scheme=Q[1],A.userinfo=Q[3],A.host=Q[4],A.port=parseInt(Q[5],10),A.path=Q[6]||"",A.query=Q[7],A.fragment=Q[8],isNaN(A.port)&&(A.port=Q[5])):(A.scheme=Q[1]||void 0,A.userinfo=N.indexOf("@")!==-1?Q[3]:void 0,A.host=N.indexOf("//")!==-1?Q[4]:void 0,A.port=parseInt(Q[5],10),A.path=Q[6]||"",A.query=N.indexOf("?")!==-1?Q[7]:void 0,A.fragment=N.indexOf("#")!==-1?Q[8]:void 0,isNaN(A.port)&&(A.port=N.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?Q[4]:void 0)),A.host&&(A.host=q(k(A.host,W),W)),A.scheme===void 0&&A.userinfo===void 0&&A.host===void 0&&A.port===void 0&&!A.path&&A.query===void 0?A.reference="same-document":A.scheme===void 0?A.reference="relative":A.fragment===void 0?A.reference="absolute":A.reference="uri",I.reference&&I.reference!=="suffix"&&I.reference!==A.reference&&(A.error=A.error||"URI is not a "+I.reference+" reference.");var je=P[(I.scheme||A.scheme||"").toLowerCase()];if(!I.unicodeSupport&&(!je||!je.unicodeSupport)){if(A.host&&(I.domainHost||je&&je.domainHost))try{A.host=_.toASCII(A.host.replace(W.PCT_ENCODED,Z).toLowerCase())}catch(be){A.error=A.error||"Host's domain name can not be converted to ASCII via punycode: "+be}U(A,u)}else U(A,W);je&&je.parse&&je.parse(A,I)}else A.error=A.error||"URI can not be parsed.";return A}function pe(N,I){var A=I.iri!==!1?p:u,W=[];return N.userinfo!==void 0&&(W.push(N.userinfo),W.push("@")),N.host!==void 0&&W.push(q(k(String(N.host),A),A).replace(A.IPV6ADDRESS,function(Q,je,be){return"["+je+(be?"%25"+be:"")+"]"})),(typeof N.port=="number"||typeof N.port=="string")&&(W.push(":"),W.push(String(N.port))),W.length?W.join(""):void 0}var Le=/^\.\.?\//,ot=/^\/\.(\/|$)/,ae=/^\/\.\.(\/|$)/,He=/^\/?(?:.|\n)*?(?=\/|$)/;function de(N){for(var I=[];N.length;)if(N.match(Le))N=N.replace(Le,"");else if(N.match(ot))N=N.replace(ot,"/");else if(N.match(ae))N=N.replace(ae,"/"),I.pop();else if(N==="."||N==="..")N="";else{var A=N.match(He);if(A){var W=A[0];N=N.slice(W.length),I.push(W)}else throw new Error("Unexpected dot segment condition")}return I.join("")}function Y(N){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},A=I.iri?p:u,W=[],Q=P[(I.scheme||N.scheme||"").toLowerCase()];if(Q&&Q.serialize&&Q.serialize(N,I),N.host&&!A.IPV6ADDRESS.test(N.host)&&(I.domainHost||Q&&Q.domainHost))try{N.host=I.iri?_.toUnicode(N.host):_.toASCII(N.host.replace(A.PCT_ENCODED,Z).toLowerCase())}catch(qe){N.error=N.error||"Host's domain name can not be converted to "+(I.iri?"Unicode":"ASCII")+" via punycode: "+qe}U(N,A),I.reference!=="suffix"&&N.scheme&&(W.push(N.scheme),W.push(":"));var je=pe(N,I);if(je!==void 0&&(I.reference!=="suffix"&&W.push("//"),W.push(je),N.path&&N.path.charAt(0)!=="/"&&W.push("/")),N.path!==void 0){var be=N.path;!I.absolutePath&&(!Q||!Q.absolutePath)&&(be=de(be)),je===void 0&&(be=be.replace(/^\/\//,"/%2F")),W.push(be)}return N.query!==void 0&&(W.push("?"),W.push(N.query)),N.fragment!==void 0&&(W.push("#"),W.push(N.fragment)),W.join("")}function Se(N,I){var A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},W=arguments[3],Q={};return W||(N=ce(Y(N,A),A),I=ce(Y(I,A),A)),A=A||{},!A.tolerant&&I.scheme?(Q.scheme=I.scheme,Q.userinfo=I.userinfo,Q.host=I.host,Q.port=I.port,Q.path=de(I.path||""),Q.query=I.query):(I.userinfo!==void 0||I.host!==void 0||I.port!==void 0?(Q.userinfo=I.userinfo,Q.host=I.host,Q.port=I.port,Q.path=de(I.path||""),Q.query=I.query):(I.path?(I.path.charAt(0)==="/"?Q.path=de(I.path):((N.userinfo!==void 0||N.host!==void 0||N.port!==void 0)&&!N.path?Q.path="/"+I.path:N.path?Q.path=N.path.slice(0,N.path.lastIndexOf("/")+1)+I.path:Q.path=I.path,Q.path=de(Q.path)),Q.query=I.query):(Q.path=N.path,I.query!==void 0?Q.query=I.query:Q.query=N.query),Q.userinfo=N.userinfo,Q.host=N.host,Q.port=N.port),Q.scheme=N.scheme),Q.fragment=I.fragment,Q}function oe(N,I,A){var W=l({scheme:"null"},A);return Y(Se(ce(N,W),ce(I,W),W,!0),W)}function ne(N,I){return typeof N=="string"?N=Y(ce(N,I),I):i(N)==="object"&&(N=ce(Y(N,I),I)),N}function _e(N,I,A){return typeof N=="string"?N=Y(ce(N,A),A):i(N)==="object"&&(N=Y(N,A)),typeof I=="string"?I=Y(ce(I,A),A):i(I)==="object"&&(I=Y(I,A)),N===I}function ye(N,I){return N&&N.toString().replace(!I||!I.iri?u.ESCAPE:p.ESCAPE,F)}function Je(N,I){return N&&N.toString().replace(!I||!I.iri?u.PCT_ENCODED:p.PCT_ENCODED,Z)}var Hr={scheme:"http",domainHost:!0,parse:function(N,I){return N.host||(N.error=N.error||"HTTP URIs must have a host."),N},serialize:function(N,I){var A=String(N.scheme).toLowerCase()==="https";return(N.port===(A?443:80)||N.port==="")&&(N.port=void 0),N.path||(N.path="/"),N}},Wa={scheme:"https",domainHost:Hr.domainHost,parse:Hr.parse,serialize:Hr.serialize};function _h(N){return typeof N.secure=="boolean"?N.secure:String(N.scheme).toLowerCase()==="wss"}var Za={scheme:"ws",domainHost:!0,parse:function(N,I){var A=N;return A.secure=_h(A),A.resourceName=(A.path||"/")+(A.query?"?"+A.query:""),A.path=void 0,A.query=void 0,A},serialize:function(N,I){if((N.port===(_h(N)?443:80)||N.port==="")&&(N.port=void 0),typeof N.secure=="boolean"&&(N.scheme=N.secure?"wss":"ws",N.secure=void 0),N.resourceName){var A=N.resourceName.split("?"),W=h(A,2),Q=W[0],je=W[1];N.path=Q&&Q!=="/"?Q:void 0,N.query=je,N.resourceName=void 0}return N.fragment=void 0,N}},wh={scheme:"wss",domainHost:Za.domainHost,parse:Za.parse,serialize:Za.serialize},Mw={},bh="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Xt="[0-9A-Fa-f]",zw=n(n("%[EFef]"+Xt+"%"+Xt+Xt+"%"+Xt+Xt)+"|"+n("%[89A-Fa-f]"+Xt+"%"+Xt+Xt)+"|"+n("%"+Xt+Xt)),Uw="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Hw="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",qw=t(Hw,'[\\"\\\\]'),Vw="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Bw=new RegExp(bh,"g"),ba=new RegExp(zw,"g"),Ww=new RegExp(t("[^]",Uw,"[\\.]",'[\\"]',qw),"g"),xh=new RegExp(t("[^]",bh,Vw),"g"),Zw=xh;function wo(N){var I=Z(N);return I.match(Bw)?I:N}var jh={scheme:"mailto",parse:function(N,I){var A=N,W=A.to=A.path?A.path.split(","):[];if(A.path=void 0,A.query){for(var Q=!1,je={},be=A.query.split("&"),qe=0,rt=be.length;qe<rt;++qe){var Be=be[qe].split("=");switch(Be[0]){case"to":for(var De=Be[1].split(","),Ze=0,tt=De.length;Ze<tt;++Ze)W.push(De[Ze]);break;case"subject":A.subject=Je(Be[1],I);break;case"body":A.body=Je(Be[1],I);break;default:Q=!0,je[Je(Be[0],I)]=Je(Be[1],I);break}}Q&&(A.headers=je)}A.query=void 0;for(var $e=0,at=W.length;$e<at;++$e){var We=W[$e].split("@");if(We[0]=Je(We[0]),I.unicodeSupport)We[1]=Je(We[1],I).toLowerCase();else try{We[1]=_.toASCII(Je(We[1],I).toLowerCase())}catch(Ft){A.error=A.error||"Email address's domain name can not be converted to ASCII via punycode: "+Ft}W[$e]=We.join("@")}return A},serialize:function(N,I){var A=N,W=o(N.to);if(W){for(var Q=0,je=W.length;Q<je;++Q){var be=String(W[Q]),qe=be.lastIndexOf("@"),rt=be.slice(0,qe).replace(ba,wo).replace(ba,s).replace(Ww,F),Be=be.slice(qe+1);try{Be=I.iri?_.toUnicode(Be):_.toASCII(Je(Be,I).toLowerCase())}catch($e){A.error=A.error||"Email address's domain name can not be converted to "+(I.iri?"Unicode":"ASCII")+" via punycode: "+$e}W[Q]=rt+"@"+Be}A.path=W.join(",")}var De=N.headers=N.headers||{};N.subject&&(De.subject=N.subject),N.body&&(De.body=N.body);var Ze=[];for(var tt in De)De[tt]!==Mw[tt]&&Ze.push(tt.replace(ba,wo).replace(ba,s).replace(xh,F)+"="+De[tt].replace(ba,wo).replace(ba,s).replace(Zw,F));return Ze.length&&(A.query=Ze.join("&")),A}},Gw=/^([^\:]+)\:(.*)/,Sh={scheme:"urn",parse:function(N,I){var A=N.path&&N.path.match(Gw),W=N;if(A){var Q=I.scheme||W.scheme||"urn",je=A[1].toLowerCase(),be=A[2],qe=Q+":"+(I.nid||je),rt=P[qe];W.nid=je,W.nss=be,W.path=void 0,rt&&(W=rt.parse(W,I))}else W.error=W.error||"URN can not be parsed.";return W},serialize:function(N,I){var A=I.scheme||N.scheme||"urn",W=N.nid,Q=A+":"+(I.nid||W),je=P[Q];je&&(N=je.serialize(N,I));var be=N,qe=N.nss;return be.path=(W||I.nid)+":"+qe,be}},Qw=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Eh={scheme:"urn:uuid",parse:function(N,I){var A=N;return A.uuid=A.nss,A.nss=void 0,!I.tolerant&&(!A.uuid||!A.uuid.match(Qw))&&(A.error=A.error||"UUID is not valid."),A},serialize:function(N,I){var A=N;return A.nss=(N.uuid||"").toLowerCase(),A}};P[Hr.scheme]=Hr,P[Wa.scheme]=Wa,P[Za.scheme]=Za,P[wh.scheme]=wh,P[jh.scheme]=jh,P[Sh.scheme]=Sh,P[Eh.scheme]=Eh,a.SCHEMES=P,a.pctEncChar=F,a.pctDecChars=Z,a.parse=ce,a.removeDotSegments=de,a.serialize=Y,a.resolveComponents=Se,a.resolve=oe,a.normalize=ne,a.equal=_e,a.escapeComponent=ye,a.unescapeComponent=Je,Object.defineProperty(a,"__esModule",{value:!0})})}(xn,xn.exports)),xn.exports}var kc,Pc;function ny(){return Pc||(Pc=1,kc=function(e){for(var r=0,a=e.length,t=0,n;t<a;)r++,n=e.charCodeAt(t++),n>=55296&&n<=56319&&t<a&&(n=e.charCodeAt(t),(n&64512)==56320&&t++);return r}),kc}var Ts,Nc;function aa(){if(Nc)return Ts;Nc=1,Ts={copy:e,checkDataType:r,checkDataTypes:a,coerceToTypes:n,toHash:i,getProperty:l,escapeQuotes:d,equal:Do(),ucs2length:ny(),varOccurences:u,varReplace:p,schemaHasRules:h,schemaHasRulesExcept:v,schemaUnknownRules:f,toQuotedString:m,getPathExpr:g,getPath:b,getData:x,unescapeFragment:$,unescapeJsonPointer:D,escapeFragment:C,escapeJsonPointer:R};function e(L,T){T=T||{};for(var z in L)T[z]=L[z];return T}function r(L,T,z,M){var H=M?" !== ":" === ",B=M?" || ":" && ",ee=M?"!":"",J=M?"":"!";switch(L){case"null":return T+H+"null";case"array":return ee+"Array.isArray("+T+")";case"object":return"("+ee+T+B+"typeof "+T+H+'"object"'+B+J+"Array.isArray("+T+"))";case"integer":return"(typeof "+T+H+'"number"'+B+J+"("+T+" % 1)"+B+T+H+T+(z?B+ee+"isFinite("+T+")":"")+")";case"number":return"(typeof "+T+H+'"'+L+'"'+(z?B+ee+"isFinite("+T+")":"")+")";default:return"typeof "+T+H+'"'+L+'"'}}function a(L,T,z){switch(L.length){case 1:return r(L[0],T,z,!0);default:var M="",H=i(L);H.array&&H.object&&(M=H.null?"(":"(!"+T+" || ",M+="typeof "+T+' !== "object")',delete H.null,delete H.array,delete H.object),H.number&&delete H.integer;for(var B in H)M+=(M?" && ":"")+r(B,T,z,!0);return M}}var t=i(["string","number","integer","boolean","null"]);function n(L,T){if(Array.isArray(T)){for(var z=[],M=0;M<T.length;M++){var H=T[M];(t[H]||L==="array"&&H==="array")&&(z[z.length]=H)}if(z.length)return z}else{if(t[T])return[T];if(L==="array"&&T==="array")return["array"]}}function i(L){for(var T={},z=0;z<L.length;z++)T[L[z]]=!0;return T}var s=/^[a-z$_][a-z$_0-9]*$/i,o=/'|\\/g;function l(L){return typeof L=="number"?"["+L+"]":s.test(L)?"."+L:"['"+d(L)+"']"}function d(L){return L.replace(o,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function u(L,T){T+="[^0-9]";var z=L.match(new RegExp(T,"g"));return z?z.length:0}function p(L,T,z){return T+="([^0-9])",z=z.replace(/\$/g,"$$$$"),L.replace(new RegExp(T,"g"),z+"$1")}function h(L,T){if(typeof L=="boolean")return!L;for(var z in L)if(T[z])return!0}function v(L,T,z){if(typeof L=="boolean")return!L&&z!="not";for(var M in L)if(M!=z&&T[M])return!0}function f(L,T){if(typeof L!="boolean"){for(var z in L)if(!T[z])return z}}function m(L){return"'"+d(L)+"'"}function g(L,T,z,M){var H=z?"'/' + "+T+(M?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):M?"'[' + "+T+" + ']'":"'[\\'' + "+T+" + '\\']'";return E(L,H)}function b(L,T,z){var M=m(z?"/"+R(T):l(T));return E(L,M)}var S=/^\/(?:[^~]|~0|~1)*$/,O=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function x(L,T,z){var M,H,B,ee;if(L==="")return"rootData";if(L[0]=="/"){if(!S.test(L))throw new Error("Invalid JSON-pointer: "+L);H=L,B="rootData"}else{if(ee=L.match(O),!ee)throw new Error("Invalid JSON-pointer: "+L);if(M=+ee[1],H=ee[2],H=="#"){if(M>=T)throw new Error("Cannot access property/index "+M+" levels up, current level is "+T);return z[T-M]}if(M>T)throw new Error("Cannot access data "+M+" levels up, current level is "+T);if(B="data"+(T-M||""),!H)return B}for(var J=B,se=H.split("/"),ie=0;ie<se.length;ie++){var ke=se[ie];ke&&(B+=l(D(ke)),J+=" && "+B)}return J}function E(L,T){return L=='""'?T:(L+" + "+T).replace(/([^\\])' \+ '/g,"$1")}function $(L){return D(decodeURIComponent(L))}function C(L){return encodeURIComponent(R(L))}function R(L){return L.replace(/~/g,"~0").replace(/\//g,"~1")}function D(L){return L.replace(/~1/g,"/").replace(/~0/g,"~")}return Ts}var Is,Cc;function $c(){if(Cc)return Is;Cc=1;var e=aa();Is=r;function r(a){e.copy(a,this)}return Is}var Ls={exports:{}},Oc;function sy(){if(Oc)return Ls.exports;Oc=1;var e=Ls.exports=function(t,n,i){typeof n=="function"&&(i=n,n={}),i=n.cb||i;var s=typeof i=="function"?i:i.pre||function(){},o=i.post||function(){};r(n,s,o,t,"",t)};e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function r(t,n,i,s,o,l,d,u,p,h){if(s&&typeof s=="object"&&!Array.isArray(s)){n(s,o,l,d,u,p,h);for(var v in s){var f=s[v];if(Array.isArray(f)){if(v in e.arrayKeywords)for(var m=0;m<f.length;m++)r(t,n,i,f[m],o+"/"+v+"/"+m,l,o,v,s,m)}else if(v in e.propsKeywords){if(f&&typeof f=="object")for(var g in f)r(t,n,i,f[g],o+"/"+v+"/"+a(g),l,o,v,s,g)}else(v in e.keywords||t.allKeys&&!(v in e.skipKeywords))&&r(t,n,i,f,o+"/"+v,l,o,v,s)}i(s,o,l,d,u,p,h)}}function a(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}return Ls.exports}var As,Tc;function Rs(){if(Tc)return As;Tc=1;var e=ay(),r=Do(),a=aa(),t=$c(),n=sy();As=i,i.normalizeId=b,i.fullPath=f,i.url=S,i.ids=O,i.inlineRef=p,i.schema=s;function i(x,E,$){var C=this._refs[$];if(typeof C=="string")if(this._refs[C])C=this._refs[C];else return i.call(this,x,E,C);if(C=C||this._schemas[$],C instanceof t)return p(C.schema,this._opts.inlineRefs)?C.schema:C.validate||this._compile(C);var R=s.call(this,E,$),D,L,T;return R&&(D=R.schema,E=R.root,T=R.baseId),D instanceof t?L=D.validate||x.call(this,D.schema,E,void 0,T):D!==void 0&&(L=p(D,this._opts.inlineRefs)?D:x.call(this,D,E,void 0,T)),L}function s(x,E){var $=e.parse(E),C=m($),R=f(this._getId(x.schema));if(Object.keys(x.schema).length===0||C!==R){var D=b(C),L=this._refs[D];if(typeof L=="string")return o.call(this,x,L,$);if(L instanceof t)L.validate||this._compile(L),x=L;else if(L=this._schemas[D],L instanceof t){if(L.validate||this._compile(L),D==b(E))return{schema:L,root:x,baseId:R};x=L}else return;if(!x.schema)return;R=f(this._getId(x.schema))}return d.call(this,$,R,x.schema,x)}function o(x,E,$){var C=s.call(this,x,E);if(C){var R=C.schema,D=C.baseId;x=C.root;var L=this._getId(R);return L&&(D=S(D,L)),d.call(this,$,D,R,x)}}var l=a.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function d(x,E,$,C){if(x.fragment=x.fragment||"",x.fragment.slice(0,1)=="/"){for(var R=x.fragment.split("/"),D=1;D<R.length;D++){var L=R[D];if(L){if(L=a.unescapeFragment(L),$=$[L],$===void 0)break;var T;if(!l[L]&&(T=this._getId($),T&&(E=S(E,T)),$.$ref)){var z=S(E,$.$ref),M=s.call(this,C,z);M&&($=M.schema,C=M.root,E=M.baseId)}}}if($!==void 0&&$!==C.schema)return{schema:$,root:C,baseId:E}}}var u=a.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(x,E){if(E===!1)return!1;if(E===void 0||E===!0)return h(x);if(E)return v(x)<=E}function h(x){var E;if(Array.isArray(x)){for(var $=0;$<x.length;$++)if(E=x[$],typeof E=="object"&&!h(E))return!1}else for(var C in x)if(C=="$ref"||(E=x[C],typeof E=="object"&&!h(E)))return!1;return!0}function v(x){var E=0,$;if(Array.isArray(x)){for(var C=0;C<x.length;C++)if($=x[C],typeof $=="object"&&(E+=v($)),E==1/0)return 1/0}else for(var R in x){if(R=="$ref")return 1/0;if(u[R])E++;else if($=x[R],typeof $=="object"&&(E+=v($)+1),E==1/0)return 1/0}return E}function f(x,E){E!==!1&&(x=b(x));var $=e.parse(x);return m($)}function m(x){return e.serialize(x).split("#")[0]+"#"}var g=/#\/?$/;function b(x){return x?x.replace(g,""):""}function S(x,E){return E=b(E),e.resolve(x,E)}function O(x){var E=b(this._getId(x)),$={"":E},C={"":f(E,!1)},R={},D=this;return n(x,{allKeys:!0},function(L,T,z,M,H,B,ee){if(T!==""){var J=D._getId(L),se=$[M],ie=C[M]+"/"+H;if(ee!==void 0&&(ie+="/"+(typeof ee=="number"?ee:a.escapeFragment(ee))),typeof J=="string"){J=se=b(se?e.resolve(se,J):J);var ke=D._refs[J];if(typeof ke=="string"&&(ke=D._refs[ke]),ke&&ke.schema){if(!r(L,ke.schema))throw new Error('id "'+J+'" resolves to more than one schema')}else if(J!=b(ie))if(J[0]=="#"){if(R[J]&&!r(L,R[J]))throw new Error('id "'+J+'" resolves to more than one schema');R[J]=L}else D._refs[J]=ie}$[T]=se,C[T]=ie}}),R}return As}var Fs,Ic;function Ds(){if(Ic)return Fs;Ic=1;var e=Rs();Fs={Validation:t(r),MissingRef:t(a)};function r(n){this.message="validation failed",this.errors=n,this.ajv=this.validation=!0}a.message=function(n,i){return"can't resolve reference "+i+" from id "+n};function a(n,i,s){this.message=s||a.message(n,i),this.missingRef=e.url(n,i),this.missingSchema=e.normalizeId(e.fullPath(this.missingRef))}function t(n){return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}return Fs}var Lc,Ac;function Rc(){return Ac||(Ac=1,Lc=function(e,r){r||(r={}),typeof r=="function"&&(r={cmp:r});var a=typeof r.cycles=="boolean"?r.cycles:!1,t=r.cmp&&function(i){return function(s){return function(o,l){var d={key:o,value:s[o]},u={key:l,value:s[l]};return i(d,u)}}}(r.cmp),n=[];return function i(s){if(s&&s.toJSON&&typeof s.toJSON=="function"&&(s=s.toJSON()),s!==void 0){if(typeof s=="number")return isFinite(s)?""+s:"null";if(typeof s!="object")return JSON.stringify(s);var o,l;if(Array.isArray(s)){for(l="[",o=0;o<s.length;o++)o&&(l+=","),l+=i(s[o])||"null";return l+"]"}if(s===null)return"null";if(n.indexOf(s)!==-1){if(a)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var d=n.push(s)-1,u=Object.keys(s).sort(t&&t(s));for(l="",o=0;o<u.length;o++){var p=u[o],h=i(s[p]);h&&(l&&(l+=","),l+=JSON.stringify(p)+":"+h)}return n.splice(d,1),"{"+l+"}"}}(e)}),Lc}var Fc,Dc;function Mc(){return Dc||(Dc=1,Fc=function(e,r,a){var t="",n=e.schema.$async===!0,i=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),s=e.self._getId(e.schema);if(e.opts.strictKeywords){var o=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(o){var l="unknown keyword: "+o;if(e.opts.strictKeywords==="log")e.logger.warn(l);else throw new Error(l)}}if(e.isTop&&(t+=" var validate = ",n&&(e.async=!0,t+="async "),t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",s&&(e.opts.sourceCode||e.opts.processCode)&&(t+=" "+("/*# sourceURL="+s+" */")+" ")),typeof e.schema=="boolean"||!(i||e.schema.$ref)){var r="false schema",d=e.level,u=e.dataLevel,p=e.schema[r],h=e.schemaPath+e.util.getProperty(r),v=e.errSchemaPath+"/"+r,x=!e.opts.allErrors,C,f="data"+(u||""),O="valid"+d;if(e.schema===!1){e.isTop?x=!0:t+=" var "+O+" = false; ";var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(C||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'boolean schema is false' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?n?t+=" return data; ":t+=" validate.errors = null; return true; ":t+=" var "+O+" = true; ";return e.isTop&&(t+=" }; return validate; "),t}if(e.isTop){var b=e.isTop,d=e.level=0,u=e.dataLevel=0,f="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var S="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(S);else throw new Error(S)}t+=" var vErrors = null; ",t+=" var errors = 0;     ",t+=" if (rootData === undefined) rootData = data; "}else{var d=e.level,u=e.dataLevel,f="data"+(u||"");if(s&&(e.baseId=e.resolve.url(e.baseId,s)),n&&!e.async)throw new Error("async schema in sync schema");t+=" var errs_"+d+" = errors;"}var O="valid"+d,x=!e.opts.allErrors,E="",$="",C,R=e.schema.type,D=Array.isArray(R);if(R&&e.opts.nullable&&e.schema.nullable===!0&&(D?R.indexOf("null")==-1&&(R=R.concat("null")):R!="null"&&(R=[R,"null"],D=!0)),D&&R.length==1&&(R=R[0],D=!1),e.schema.$ref&&i){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(i=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(t+=" "+e.RULES.all.$comment.code(e,"$comment")),R){if(e.opts.coerceTypes)var L=e.util.coerceToTypes(e.opts.coerceTypes,R);var T=e.RULES.types[R];if(L||D||T===!0||T&&!Le(T)){var h=e.schemaPath+".type",v=e.errSchemaPath+"/type",h=e.schemaPath+".type",v=e.errSchemaPath+"/type",z=D?"checkDataTypes":"checkDataType";if(t+=" if ("+e.util[z](R,f,e.opts.strictNumbers,!0)+") { ",L){var M="dataType"+d,H="coerced"+d;t+=" var "+M+" = typeof "+f+"; var "+H+" = undefined; ",e.opts.coerceTypes=="array"&&(t+=" if ("+M+" == 'object' && Array.isArray("+f+") && "+f+".length == 1) { "+f+" = "+f+"[0]; "+M+" = typeof "+f+"; if ("+e.util.checkDataType(e.schema.type,f,e.opts.strictNumbers)+") "+H+" = "+f+"; } "),t+=" if ("+H+" !== undefined) ; ";var B=L;if(B)for(var ee,J=-1,se=B.length-1;J<se;)ee=B[J+=1],ee=="string"?t+=" else if ("+M+" == 'number' || "+M+" == 'boolean') "+H+" = '' + "+f+"; else if ("+f+" === null) "+H+" = ''; ":ee=="number"||ee=="integer"?(t+=" else if ("+M+" == 'boolean' || "+f+" === null || ("+M+" == 'string' && "+f+" && "+f+" == +"+f+" ",ee=="integer"&&(t+=" && !("+f+" % 1)"),t+=")) "+H+" = +"+f+"; "):ee=="boolean"?t+=" else if ("+f+" === 'false' || "+f+" === 0 || "+f+" === null) "+H+" = false; else if ("+f+" === 'true' || "+f+" === 1) "+H+" = true; ":ee=="null"?t+=" else if ("+f+" === '' || "+f+" === 0 || "+f+" === false) "+H+" = null; ":e.opts.coerceTypes=="array"&&ee=="array"&&(t+=" else if ("+M+" == 'string' || "+M+" == 'number' || "+M+" == 'boolean' || "+f+" == null) "+H+" = ["+f+"]; ");t+=" else {   ";var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(C||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",D?t+=""+R.join(","):t+=""+R,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",D?t+=""+R.join(","):t+=""+R,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } if ("+H+" !== undefined) {  ";var ie=u?"data"+(u-1||""):"parentData",ke=u?e.dataPathArr[u]:"parentDataProperty";t+=" "+f+" = "+H+"; ",u||(t+="if ("+ie+" !== undefined)"),t+=" "+ie+"["+ke+"] = "+H+"; } "}else{var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(C||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",D?t+=""+R.join(","):t+=""+R,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",D?t+=""+R.join(","):t+=""+R,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(e.schema.$ref&&!i)t+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",x&&(t+=" } if (errors === ",b?t+="0":t+="errs_"+d,t+=") { ",$+="}");else{var Ie=e.RULES;if(Ie){for(var T,G=-1,te=Ie.length-1;G<te;)if(T=Ie[G+=1],Le(T)){if(T.type&&(t+=" if ("+e.util.checkDataType(T.type,f,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(T.type=="object"&&e.schema.properties){var p=e.schema.properties,ge=Object.keys(p),re=ge;if(re)for(var _,P=-1,F=re.length-1;P<F;){_=re[P+=1];var Z=p[_];if(Z.default!==void 0){var U=f+e.util.getProperty(_);if(e.compositeRule){if(e.opts.strictDefaults){var S="default is ignored for: "+U;if(e.opts.strictDefaults==="log")e.logger.warn(S);else throw new Error(S)}}else t+=" if ("+U+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+U+" === null || "+U+" === '' "),t+=" ) "+U+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(Z.default)+" ":t+=" "+JSON.stringify(Z.default)+" ",t+="; "}}}else if(T.type=="array"&&Array.isArray(e.schema.items)){var j=e.schema.items;if(j){for(var Z,J=-1,k=j.length-1;J<k;)if(Z=j[J+=1],Z.default!==void 0){var U=f+"["+J+"]";if(e.compositeRule){if(e.opts.strictDefaults){var S="default is ignored for: "+U;if(e.opts.strictDefaults==="log")e.logger.warn(S);else throw new Error(S)}}else t+=" if ("+U+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+U+" === null || "+U+" === '' "),t+=" ) "+U+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(Z.default)+" ":t+=" "+JSON.stringify(Z.default)+" ",t+="; "}}}}var q=T.rules;if(q){for(var K,xe=-1,ce=q.length-1;xe<ce;)if(K=q[xe+=1],ot(K)){var pe=K.code(e,K.keyword,T.type);pe&&(t+=" "+pe+" ",x&&(E+="}"))}}if(x&&(t+=" "+E+" ",E=""),T.type&&(t+=" } ",R&&R===T.type&&!L)){t+=" else { ";var h=e.schemaPath+".type",v=e.errSchemaPath+"/type",m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(C||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",D?t+=""+R.join(","):t+=""+R,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",D?t+=""+R.join(","):t+=""+R,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } "}x&&(t+=" if (errors === ",b?t+="0":t+="errs_"+d,t+=") { ",$+="}")}}}x&&(t+=" "+$+" "),b?(n?(t+=" if (errors === 0) return data;           ",t+=" else throw new ValidationError(vErrors); "):(t+=" validate.errors = vErrors; ",t+=" return errors === 0;       "),t+=" }; return validate;"):t+=" var "+O+" = errors === errs_"+d+";";function Le(He){for(var de=He.rules,Y=0;Y<de.length;Y++)if(ot(de[Y]))return!0}function ot(He){return e.schema[He.keyword]!==void 0||He.implements&&ae(He)}function ae(He){for(var de=He.implements,Y=0;Y<de.length;Y++)if(e.schema[de[Y]]!==void 0)return!0}return t}),Fc}var Ms,zc;function iy(){if(zc)return Ms;zc=1;var e=Rs(),r=aa(),a=Ds(),t=Rc(),n=Mc(),i=r.ucs2length,s=Do(),o=a.Validation;Ms=l;function l(b,S,O,x){var E=this,$=this._opts,C=[void 0],R={},D=[],L={},T=[],z={},M=[];S=S||{schema:b,refVal:C,refs:R};var H=d.call(this,b,S,x),B=this._compilations[H.index];if(H.compiling)return B.callValidate=ke;var ee=this._formats,J=this.RULES;try{var se=Ie(b,S,O,x);B.validate=se;var ie=B.callValidate;return ie&&(ie.schema=se.schema,ie.errors=null,ie.refs=se.refs,ie.refVal=se.refVal,ie.root=se.root,ie.$async=se.$async,$.sourceCode&&(ie.source=se.source)),se}finally{u.call(this,b,S,x)}function ke(){var U=B.validate,j=U.apply(this,arguments);return ke.errors=U.errors,j}function Ie(U,j,k,q){var K=!j||j&&j.schema==U;if(j.schema!=S.schema)return l.call(E,U,j,k,q);var xe=U.$async===!0,ce=n({isTop:!0,schema:U,isRoot:K,baseId:q,root:j,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:a.MissingRef,RULES:J,validate:n,util:r,resolve:e,resolveRef:G,usePattern:P,useDefault:F,useCustomRule:Z,opts:$,formats:ee,logger:E.logger,self:E});ce=g(C,f)+g(D,h)+g(T,v)+g(M,m)+ce,$.processCode&&(ce=$.processCode(ce,U));var pe;try{var Le=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",ce);pe=Le(E,J,ee,S,C,T,M,s,i,o),C[0]=pe}catch(ot){throw E.logger.error("Error compiling schema, function code:",ce),ot}return pe.schema=U,pe.errors=null,pe.refs=R,pe.refVal=C,pe.root=K?pe:j,xe&&(pe.$async=!0),$.sourceCode===!0&&(pe.source={code:ce,patterns:D,defaults:T}),pe}function G(U,j,k){j=e.url(U,j);var q=R[j],K,xe;if(q!==void 0)return K=C[q],xe="refVal["+q+"]",_(K,xe);if(!k&&S.refs){var ce=S.refs[j];if(ce!==void 0)return K=S.refVal[ce],xe=te(j,K),_(K,xe)}xe=te(j);var pe=e.call(E,Ie,S,j);if(pe===void 0){var Le=O&&O[j];Le&&(pe=e.inlineRef(Le,$.inlineRefs)?Le:l.call(E,Le,S,O,U))}if(pe===void 0)ge(j);else return re(j,pe),_(pe,xe)}function te(U,j){var k=C.length;return C[k]=j,R[U]=k,"refVal"+k}function ge(U){delete R[U]}function re(U,j){var k=R[U];C[k]=j}function _(U,j){return typeof U=="object"||typeof U=="boolean"?{code:j,schema:U,inline:!0}:{code:j,$async:U&&!!U.$async}}function P(U){var j=L[U];return j===void 0&&(j=L[U]=D.length,D[j]=U),"pattern"+j}function F(U){switch(typeof U){case"boolean":case"number":return""+U;case"string":return r.toQuotedString(U);case"object":if(U===null)return"null";var j=t(U),k=z[j];return k===void 0&&(k=z[j]=T.length,T[k]=U),"default"+k}}function Z(U,j,k,q){if(E._opts.validateSchema!==!1){var K=U.definition.dependencies;if(K&&!K.every(function(Y){return Object.prototype.hasOwnProperty.call(k,Y)}))throw new Error("parent schema must have all required keywords: "+K.join(","));var xe=U.definition.validateSchema;if(xe){var ce=xe(j);if(!ce){var pe="keyword schema is invalid: "+E.errorsText(xe.errors);if(E._opts.validateSchema=="log")E.logger.error(pe);else throw new Error(pe)}}}var Le=U.definition.compile,ot=U.definition.inline,ae=U.definition.macro,He;if(Le)He=Le.call(E,j,k,q);else if(ae)He=ae.call(E,j,k,q),$.validateSchema!==!1&&E.validateSchema(He,!0);else if(ot)He=ot.call(E,q,U.keyword,j,k);else if(He=U.definition.validate,!He)return;if(He===void 0)throw new Error('custom keyword "'+U.keyword+'"failed to compile');var de=M.length;return M[de]=He,{code:"customRule"+de,validate:He}}}function d(b,S,O){var x=p.call(this,b,S,O);return x>=0?{index:x,compiling:!0}:(x=this._compilations.length,this._compilations[x]={schema:b,root:S,baseId:O},{index:x,compiling:!1})}function u(b,S,O){var x=p.call(this,b,S,O);x>=0&&this._compilations.splice(x,1)}function p(b,S,O){for(var x=0;x<this._compilations.length;x++){var E=this._compilations[x];if(E.schema==b&&E.root==S&&E.baseId==O)return x}return-1}function h(b,S){return"var pattern"+b+" = new RegExp("+r.toQuotedString(S[b])+");"}function v(b){return"var default"+b+" = defaults["+b+"];"}function f(b,S){return S[b]===void 0?"":"var refVal"+b+" = refVal["+b+"];"}function m(b){return"var customRule"+b+" = customRules["+b+"];"}function g(b,S){if(!b.length)return"";for(var O="",x=0;x<b.length;x++)O+=S(x,b);return O}return Ms}var zs={exports:{}},Uc;function oy(){if(Uc)return zs.exports;Uc=1;var e=zs.exports=function(){this._cache={}};return e.prototype.put=function(r,a){this._cache[r]=a},e.prototype.get=function(r){return this._cache[r]},e.prototype.del=function(r){delete this._cache[r]},e.prototype.clear=function(){this._cache={}},zs.exports}var Us,Hc;function ly(){if(Hc)return Us;Hc=1;var e=aa(),r=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,a=[0,31,28,31,30,31,30,31,31,30,31,30,31],t=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,n=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,i=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,s=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,l=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,d=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,u=/^(?:\/(?:[^~/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,h=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;Us=v;function v(C){return C=C=="full"?"full":"fast",e.copy(v[C])}v.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":o,url:l,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:n,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:$,uuid:d,"json-pointer":u,"json-pointer-uri-fragment":p,"relative-json-pointer":h},v.full={date:m,time:g,"date-time":S,uri:x,"uri-reference":s,"uri-template":o,url:l,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:n,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:$,uuid:d,"json-pointer":u,"json-pointer-uri-fragment":p,"relative-json-pointer":h};function f(C){return C%4===0&&(C%100!==0||C%400===0)}function m(C){var R=C.match(r);if(!R)return!1;var D=+R[1],L=+R[2],T=+R[3];return L>=1&&L<=12&&T>=1&&T<=(L==2&&f(D)?29:a[L])}function g(C,R){var D=C.match(t);if(!D)return!1;var L=D[1],T=D[2],z=D[3],M=D[5];return(L<=23&&T<=59&&z<=59||L==23&&T==59&&z==60)&&(!R||M)}var b=/t|\s/i;function S(C){var R=C.split(b);return R.length==2&&m(R[0])&&g(R[1],!0)}var O=/\/|:/;function x(C){return O.test(C)&&i.test(C)}var E=/[^\\]\\Z/;function $(C){if(E.test(C))return!1;try{return new RegExp(C),!0}catch{return!1}}return Us}var qc,Vc;function cy(){return Vc||(Vc=1,qc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.errSchemaPath+"/"+r,l=!e.opts.allErrors,d="data"+(i||""),u="valid"+n,p,h;if(s=="#"||s=="#/")e.isRoot?(p=e.async,h="validate"):(p=e.root.schema.$async===!0,h="root.refVal[0]");else{var v=e.resolveRef(e.baseId,s,e.isRoot);if(v===void 0){var f=e.MissingRefError.message(e.baseId,s);if(e.opts.missingRefs=="fail"){e.logger.error(f);var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(o)+" , params: { ref: '"+e.util.escapeQuotes(s)+"' } ",e.opts.messages!==!1&&(t+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(s)+"' "),e.opts.verbose&&(t+=" , schema: "+e.util.toQuotedString(s)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&l?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(t+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(f),l&&(t+=" if (true) { ");else throw new e.MissingRefError(e.baseId,s,f)}else if(v.inline){var b=e.util.copy(e);b.level++;var S="valid"+b.level;b.schema=v.schema,b.schemaPath="",b.errSchemaPath=s;var O=e.validate(b).replace(/validate\.schema/g,v.code);t+=" "+O+" ",l&&(t+=" if ("+S+") { ")}else p=v.$async===!0||e.async&&v.$async!==!1,h=v.code}if(h){var m=m||[];m.push(t),t="",e.opts.passContext?t+=" "+h+".call(this, ":t+=" "+h+"( ",t+=" "+d+", (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var x=i?"data"+(i-1||""):"parentData",E=i?e.dataPathArr[i]:"parentDataProperty";t+=" , "+x+" , "+E+", rootData)  ";var $=t;if(t=m.pop(),p){if(!e.async)throw new Error("async schema referenced by sync schema");l&&(t+=" var "+u+"; "),t+=" try { await "+$+"; ",l&&(t+=" "+u+" = true; "),t+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",l&&(t+=" "+u+" = false; "),t+=" } ",l&&(t+=" if ("+u+") { ")}else t+=" if (!"+$+") { if (vErrors === null) vErrors = "+h+".errors; else vErrors = vErrors.concat("+h+".errors); errors = vErrors.length; } ",l&&(t+=" else { ")}return t}),qc}var Bc,Wc;function dy(){return Wc||(Wc=1,Bc=function(e,r,a){var t=" ",n=e.schema[r],i=e.schemaPath+e.util.getProperty(r),s=e.errSchemaPath+"/"+r,o=!e.opts.allErrors,l=e.util.copy(e),d="";l.level++;var u="valid"+l.level,p=l.baseId,h=!0,v=n;if(v)for(var f,m=-1,g=v.length-1;m<g;)f=v[m+=1],(e.opts.strictKeywords?typeof f=="object"&&Object.keys(f).length>0||f===!1:e.util.schemaHasRules(f,e.RULES.all))&&(h=!1,l.schema=f,l.schemaPath=i+"["+m+"]",l.errSchemaPath=s+"/"+m,t+="  "+e.validate(l)+" ",l.baseId=p,o&&(t+=" if ("+u+") { ",d+="}"));return o&&(h?t+=" if (true) { ":t+=" "+d.slice(0,-1)+" "),t}),Bc}var Zc,Gc;function uy(){return Gc||(Gc=1,Zc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g=s.every(function(C){return e.opts.strictKeywords?typeof C=="object"&&Object.keys(C).length>0||C===!1:e.util.schemaHasRules(C,e.RULES.all)});if(g){var b=v.baseId;t+=" var "+h+" = errors; var "+p+" = false;  ";var S=e.compositeRule;e.compositeRule=v.compositeRule=!0;var O=s;if(O)for(var x,E=-1,$=O.length-1;E<$;)x=O[E+=1],v.schema=x,v.schemaPath=o+"["+E+"]",v.errSchemaPath=l+"/"+E,t+="  "+e.validate(v)+" ",v.baseId=b,t+=" "+p+" = "+p+" || "+m+"; if (!"+p+") { ",f+="}";e.compositeRule=v.compositeRule=S,t+=" "+f+" if (!"+p+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else d&&(t+=" if (true) { ");return t}),Zc}var Qc,Jc;function hy(){return Jc||(Jc=1,Qc=function(e,r,a){var t=" ",n=e.schema[r],i=e.errSchemaPath+"/"+r;e.opts.allErrors;var s=e.util.toQuotedString(n);return e.opts.$comment===!0?t+=" console.log("+s+");":typeof e.opts.$comment=="function"&&(t+=" self._opts.$comment("+s+", "+e.util.toQuotedString(i)+", validate.root.schema);"),t}),Qc}var Kc,Xc;function py(){return Xc||(Xc=1,Kc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; "),h||(t+=" var schema"+n+" = validate.schema"+o+";"),t+="var "+p+" = equal("+u+", schema"+n+"); if (!"+p+") {   ";var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValue: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to constant' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var f=t;return t=v.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+f+"]); ":t+=" validate.errors = ["+f+"]; return false; ":t+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",d&&(t+=" else { "),t}),Kc}var Yc,ed;function my(){return ed||(ed=1,Yc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g="i"+n,b=v.dataLevel=e.dataLevel+1,S="data"+b,O=e.baseId,x=e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all);if(t+="var "+h+" = errors;var "+p+";",x){var E=e.compositeRule;e.compositeRule=v.compositeRule=!0,v.schema=s,v.schemaPath=o,v.errSchemaPath=l,t+=" var "+m+" = false; for (var "+g+" = 0; "+g+" < "+u+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var $=u+"["+g+"]";v.dataPathArr[b]=g;var C=e.validate(v);v.baseId=O,e.util.varOccurences(C,S)<2?t+=" "+e.util.varReplace(C,S,$)+" ":t+=" var "+S+" = "+$+"; "+C+" ",t+=" if ("+m+") break; }  ",e.compositeRule=v.compositeRule=E,t+=" "+f+" if (!"+m+") {"}else t+=" if ("+u+".length == 0) {";var R=R||[];R.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should contain a valid item' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var D=t;return t=R.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+D+"]); ":t+=" validate.errors = ["+D+"]; return false; ":t+=" var err = "+D+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { ",x&&(t+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(t+=" } "),t}),Yc}var td,rd;function fy(){return rd||(rd=1,td=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level,m={},g={},b=e.opts.ownProperties;for(E in s)if(E!="__proto__"){var S=s[E],O=Array.isArray(S)?g:m;O[E]=S}t+="var "+p+" = errors;";var x=e.errorPath;t+="var missing"+n+";";for(var E in g)if(O=g[E],O.length){if(t+=" if ( "+u+e.util.getProperty(E)+" !== undefined ",b&&(t+=" && Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(E)+"') "),d){t+=" && ( ";var $=O;if($)for(var C,R=-1,D=$.length-1;R<D;){C=$[R+=1],R&&(t+=" || ");var L=e.util.getProperty(C),T=u+L;t+=" ( ( "+T+" === undefined ",b&&(t+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(C)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?C:L)+") ) "}t+=")) {  ";var z="missing"+n,M="' + "+z+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,z,!0):x+" + "+z);var H=H||[];H.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(E)+"', missingProperty: '"+M+"', depsCount: "+O.length+", deps: '"+e.util.escapeQuotes(O.length==1?O[0]:O.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",O.length==1?t+="property "+e.util.escapeQuotes(O[0]):t+="properties "+e.util.escapeQuotes(O.join(", ")),t+=" when property "+e.util.escapeQuotes(E)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var B=t;t=H.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+B+"]); ":t+=" validate.errors = ["+B+"]; return false; ":t+=" var err = "+B+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{t+=" ) { ";var ee=O;if(ee)for(var C,J=-1,se=ee.length-1;J<se;){C=ee[J+=1];var L=e.util.getProperty(C),M=e.util.escapeQuotes(C),T=u+L;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,C,e.opts.jsonPointers)),t+=" if ( "+T+" === undefined ",b&&(t+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(C)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(E)+"', missingProperty: '"+M+"', depsCount: "+O.length+", deps: '"+e.util.escapeQuotes(O.length==1?O[0]:O.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",O.length==1?t+="property "+e.util.escapeQuotes(O[0]):t+="properties "+e.util.escapeQuotes(O.join(", ")),t+=" when property "+e.util.escapeQuotes(E)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}t+=" }   ",d&&(v+="}",t+=" else { ")}e.errorPath=x;var ie=h.baseId;for(var E in m){var S=m[E];(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all))&&(t+=" "+f+" = true; if ( "+u+e.util.getProperty(E)+" !== undefined ",b&&(t+=" && Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(E)+"') "),t+=") { ",h.schema=S,h.schemaPath=o+e.util.getProperty(E),h.errSchemaPath=l+"/"+e.util.escapeFragment(E),t+="  "+e.validate(h)+" ",h.baseId=ie,t+=" }  ",d&&(t+=" if ("+f+") { ",v+="}"))}return d&&(t+="   "+v+" if ("+p+" == errors) {"),t}),td}var ad,nd;function vy(){return nd||(nd=1,ad=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ");var v="i"+n,f="schema"+n;h||(t+=" var "+f+" = validate.schema"+o+";"),t+="var "+p+";",h&&(t+=" if (schema"+n+" === undefined) "+p+" = true; else if (!Array.isArray(schema"+n+")) "+p+" = false; else {"),t+=""+p+" = false;for (var "+v+"=0; "+v+"<"+f+".length; "+v+"++) if (equal("+u+", "+f+"["+v+"])) { "+p+" = true; break; }",h&&(t+="  }  "),t+=" if (!"+p+") {   ";var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",d&&(t+=" else { "),t}),ad}var sd,id;function gy(){return id||(id=1,sd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||"");if(e.opts.format===!1)return d&&(t+=" if (true) { "),t;var p=e.opts.$data&&s&&s.$data,h;p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=e.opts.unknownFormats,f=Array.isArray(v);if(p){var m="format"+n,g="isObject"+n,b="formatType"+n;t+=" var "+m+" = formats["+h+"]; var "+g+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+b+" = "+g+" && "+m+".type || 'string'; if ("+g+") { ",e.async&&(t+=" var async"+n+" = "+m+".async; "),t+=" "+m+" = "+m+".validate; } if (  ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),t+=" (",v!="ignore"&&(t+=" ("+h+" && !"+m+" ",f&&(t+=" && self._opts.unknownFormats.indexOf("+h+") == -1 "),t+=") || "),t+=" ("+m+" && "+b+" == '"+a+"' && !(typeof "+m+" == 'function' ? ",e.async?t+=" (async"+n+" ? await "+m+"("+u+") : "+m+"("+u+")) ":t+=" "+m+"("+u+") ",t+=" : "+m+".test("+u+"))))) {"}else{var m=e.formats[s];if(!m){if(v=="ignore")return e.logger.warn('unknown format "'+s+'" ignored in schema at path "'+e.errSchemaPath+'"'),d&&(t+=" if (true) { "),t;if(f&&v.indexOf(s)>=0)return d&&(t+=" if (true) { "),t;throw new Error('unknown format "'+s+'" is used in schema at path "'+e.errSchemaPath+'"')}var g=typeof m=="object"&&!(m instanceof RegExp)&&m.validate,b=g&&m.type||"string";if(g){var S=m.async===!0;m=m.validate}if(b!=a)return d&&(t+=" if (true) { "),t;if(S){if(!e.async)throw new Error("async format in sync schema");var O="formats"+e.util.getProperty(s)+".validate";t+=" if (!(await "+O+"("+u+"))) { "}else{t+=" if (! ";var O="formats"+e.util.getProperty(s);g&&(O+=".validate"),typeof m=="function"?t+=" "+O+"("+u+") ":t+=" "+O+".test("+u+") ",t+=") { "}}var x=x||[];x.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",p?t+=""+h:t+=""+e.util.toQuotedString(s),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match format "`,p?t+="' + "+h+" + '":t+=""+e.util.escapeQuotes(s),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+e.util.toQuotedString(s),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var E=t;return t=x.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+E+"]); ":t+=" validate.errors = ["+E+"]; return false; ":t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",d&&(t+=" else { "),t}),sd}var od,ld;function yy(){return ld||(ld=1,od=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e);v.level++;var f="valid"+v.level,m=e.schema.then,g=e.schema.else,b=m!==void 0&&(e.opts.strictKeywords?typeof m=="object"&&Object.keys(m).length>0||m===!1:e.util.schemaHasRules(m,e.RULES.all)),S=g!==void 0&&(e.opts.strictKeywords?typeof g=="object"&&Object.keys(g).length>0||g===!1:e.util.schemaHasRules(g,e.RULES.all)),O=v.baseId;if(b||S){var x;v.createErrors=!1,v.schema=s,v.schemaPath=o,v.errSchemaPath=l,t+=" var "+h+" = errors; var "+p+" = true;  ";var E=e.compositeRule;e.compositeRule=v.compositeRule=!0,t+="  "+e.validate(v)+" ",v.baseId=O,v.createErrors=!0,t+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }  ",e.compositeRule=v.compositeRule=E,b?(t+=" if ("+f+") {  ",v.schema=e.schema.then,v.schemaPath=e.schemaPath+".then",v.errSchemaPath=e.errSchemaPath+"/then",t+="  "+e.validate(v)+" ",v.baseId=O,t+=" "+p+" = "+f+"; ",b&&S?(x="ifClause"+n,t+=" var "+x+" = 'then'; "):x="'then'",t+=" } ",S&&(t+=" else { ")):t+=" if (!"+f+") { ",S&&(v.schema=e.schema.else,v.schemaPath=e.schemaPath+".else",v.errSchemaPath=e.errSchemaPath+"/else",t+="  "+e.validate(v)+" ",v.baseId=O,t+=" "+p+" = "+f+"; ",b&&S?(x="ifClause"+n,t+=" var "+x+" = 'else'; "):x="'else'",t+=" } "),t+=" if (!"+p+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+x+" } ",e.opts.messages!==!1&&(t+=` , message: 'should match "' + `+x+` + '" schema' `),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" }   ",d&&(t+=" else { ")}else d&&(t+=" if (true) { ");return t}),od}var cd,dd;function _y(){return dd||(dd=1,cd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g="i"+n,b=v.dataLevel=e.dataLevel+1,S="data"+b,O=e.baseId;if(t+="var "+h+" = errors;var "+p+";",Array.isArray(s)){var x=e.schema.additionalItems;if(x===!1){t+=" "+p+" = "+u+".length <= "+s.length+"; ";var E=l;l=e.errSchemaPath+"/additionalItems",t+="  if (!"+p+") {   ";var $=$||[];$.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+s.length+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have more than "+s.length+" items' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var C=t;t=$.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+C+"]); ":t+=" validate.errors = ["+C+"]; return false; ":t+=" var err = "+C+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",l=E,d&&(f+="}",t+=" else { ")}var R=s;if(R){for(var D,L=-1,T=R.length-1;L<T;)if(D=R[L+=1],e.opts.strictKeywords?typeof D=="object"&&Object.keys(D).length>0||D===!1:e.util.schemaHasRules(D,e.RULES.all)){t+=" "+m+" = true; if ("+u+".length > "+L+") { ";var z=u+"["+L+"]";v.schema=D,v.schemaPath=o+"["+L+"]",v.errSchemaPath=l+"/"+L,v.errorPath=e.util.getPathExpr(e.errorPath,L,e.opts.jsonPointers,!0),v.dataPathArr[b]=L;var M=e.validate(v);v.baseId=O,e.util.varOccurences(M,S)<2?t+=" "+e.util.varReplace(M,S,z)+" ":t+=" var "+S+" = "+z+"; "+M+" ",t+=" }  ",d&&(t+=" if ("+m+") { ",f+="}")}}if(typeof x=="object"&&(e.opts.strictKeywords?typeof x=="object"&&Object.keys(x).length>0||x===!1:e.util.schemaHasRules(x,e.RULES.all))){v.schema=x,v.schemaPath=e.schemaPath+".additionalItems",v.errSchemaPath=e.errSchemaPath+"/additionalItems",t+=" "+m+" = true; if ("+u+".length > "+s.length+") {  for (var "+g+" = "+s.length+"; "+g+" < "+u+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var z=u+"["+g+"]";v.dataPathArr[b]=g;var M=e.validate(v);v.baseId=O,e.util.varOccurences(M,S)<2?t+=" "+e.util.varReplace(M,S,z)+" ":t+=" var "+S+" = "+z+"; "+M+" ",d&&(t+=" if (!"+m+") break; "),t+=" } }  ",d&&(t+=" if ("+m+") { ",f+="}")}}else if(e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){v.schema=s,v.schemaPath=o,v.errSchemaPath=l,t+="  for (var "+g+" = 0; "+g+" < "+u+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var z=u+"["+g+"]";v.dataPathArr[b]=g;var M=e.validate(v);v.baseId=O,e.util.varOccurences(M,S)<2?t+=" "+e.util.varReplace(M,S,z)+" ":t+=" var "+S+" = "+z+"; "+M+" ",d&&(t+=" if (!"+m+") break; "),t+=" }"}return d&&(t+=" "+f+" if ("+h+" == errors) {"),t}),cd}var ud,hd;function pd(){return hd||(hd=1,ud=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,O,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=r=="maximum",f=v?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],g=e.opts.$data&&m&&m.$data,b=v?"<":">",S=v?">":"<",O=void 0;if(!(p||typeof s=="number"||s===void 0))throw new Error(r+" must be number");if(!(g||m===void 0||typeof m=="number"||typeof m=="boolean"))throw new Error(f+" must be number or boolean");if(g){var x=e.util.getData(m.$data,i,e.dataPathArr),E="exclusive"+n,$="exclType"+n,C="exclIsNumber"+n,R="op"+n,D="' + "+R+" + '";t+=" var schemaExcl"+n+" = "+x+"; ",x="schemaExcl"+n,t+=" var "+E+"; var "+$+" = typeof "+x+"; if ("+$+" != 'boolean' && "+$+" != 'undefined' && "+$+" != 'number') { ";var O=f,L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(O||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var T=t;t=L.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+T+"]); ":t+=" validate.errors = ["+T+"]; return false; ":t+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" "+$+" == 'number' ? ( ("+E+" = "+h+" === undefined || "+x+" "+b+"= "+h+") ? "+u+" "+S+"= "+x+" : "+u+" "+S+" "+h+" ) : ( ("+E+" = "+x+" === true) ? "+u+" "+S+"= "+h+" : "+u+" "+S+" "+h+" ) || "+u+" !== "+u+") { var op"+n+" = "+E+" ? '"+b+"' : '"+b+"='; ",s===void 0&&(O=f,l=e.errSchemaPath+"/"+f,h=x,p=g)}else{var C=typeof m=="number",D=b;if(C&&p){var R="'"+D+"'";t+=" if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" ( "+h+" === undefined || "+m+" "+b+"= "+h+" ? "+u+" "+S+"= "+m+" : "+u+" "+S+" "+h+" ) || "+u+" !== "+u+") { "}else{C&&s===void 0?(E=!0,O=f,l=e.errSchemaPath+"/"+f,h=m,S+="="):(C&&(h=Math[v?"min":"max"](m,s)),m===(C?h:!0)?(E=!0,O=f,l=e.errSchemaPath+"/"+f,S+="="):(E=!1,D+="="));var R="'"+D+"'";t+=" if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" "+u+" "+S+" "+h+" || "+u+" !== "+u+") { "}}O=O||r;var L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(O||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { comparison: "+R+", limit: "+h+", exclusive: "+E+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be "+D+" ",p?t+="' + "+h:t+=""+h+"'"),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var T=t;return t=L.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+T+"]); ":t+=" validate.errors = ["+T+"]; return false; ":t+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",d&&(t+=" else { "),t}),ud}var md,fd;function vd(){return fd||(fd=1,md=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");var v=r=="maxItems"?">":"<";t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" "+u+".length "+v+" "+h+") { ";var f=r,m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxItems"?t+="more":t+="fewer",t+=" than ",p?t+="' + "+h+" + '":t+=""+s,t+=" items' "),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}),md}var gd,yd;function _d(){return yd||(yd=1,gd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");var v=r=="maxLength"?">":"<";t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),e.opts.unicode===!1?t+=" "+u+".length ":t+=" ucs2length("+u+") ",t+=" "+v+" "+h+") { ";var f=r,m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be ",r=="maxLength"?t+="longer":t+="shorter",t+=" than ",p?t+="' + "+h+" + '":t+=""+s,t+=" characters' "),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}),gd}var wd,bd;function xd(){return bd||(bd=1,wd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,f,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");var v=r=="maxProperties"?">":"<";t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" Object.keys("+u+").length "+v+" "+h+") { ";var f=r,m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxProperties"?t+="more":t+="fewer",t+=" than ",p?t+="' + "+h+" + '":t+=""+s,t+=" properties' "),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}),wd}var jd,Sd;function wy(){return Sd||(Sd=1,jd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");t+="var division"+n+";if (",p&&(t+=" "+h+" !== undefined && ( typeof "+h+" != 'number' || "),t+=" (division"+n+" = "+u+" / "+h+", ",e.opts.multipleOfPrecision?t+=" Math.abs(Math.round(division"+n+") - division"+n+") > 1e-"+e.opts.multipleOfPrecision+" ":t+=" division"+n+" !== parseInt(division"+n+") ",t+=" ) ",p&&(t+="  )  "),t+=" ) {   ";var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { multipleOf: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be multiple of ",p?t+="' + "+h:t+=""+h+"'"),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var f=t;return t=v.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+f+"]); ":t+=" validate.errors = ["+f+"]; return false; ":t+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}),jd}var Ed,kd;function by(){return kd||(kd=1,Ed=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e);h.level++;var v="valid"+h.level;if(e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){h.schema=s,h.schemaPath=o,h.errSchemaPath=l,t+=" var "+p+" = errors;  ";var f=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.createErrors=!1;var m;h.opts.allErrors&&(m=h.opts.allErrors,h.opts.allErrors=!1),t+=" "+e.validate(h)+" ",h.createErrors=!0,m&&(h.opts.allErrors=m),e.compositeRule=h.compositeRule=f,t+=" if ("+v+") {   ";var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var b=t;t=g.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+b+"]); ":t+=" validate.errors = ["+b+"]; return false; ":t+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else {  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else t+="  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d&&(t+=" if (false) { ");return t}),Ed}var Pd,Nd;function xy(){return Nd||(Nd=1,Pd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g=v.baseId,b="prevValid"+n,S="passingSchemas"+n;t+="var "+h+" = errors , "+b+" = false , "+p+" = false , "+S+" = null; ";var O=e.compositeRule;e.compositeRule=v.compositeRule=!0;var x=s;if(x)for(var E,$=-1,C=x.length-1;$<C;)E=x[$+=1],(e.opts.strictKeywords?typeof E=="object"&&Object.keys(E).length>0||E===!1:e.util.schemaHasRules(E,e.RULES.all))?(v.schema=E,v.schemaPath=o+"["+$+"]",v.errSchemaPath=l+"/"+$,t+="  "+e.validate(v)+" ",v.baseId=g):t+=" var "+m+" = true; ",$&&(t+=" if ("+m+" && "+b+") { "+p+" = false; "+S+" = ["+S+", "+$+"]; } else { ",f+="}"),t+=" if ("+m+") { "+p+" = "+b+" = true; "+S+" = "+$+"; }";return e.compositeRule=v.compositeRule=O,t+=""+f+"if (!"+p+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { passingSchemas: "+S+" } ",e.opts.messages!==!1&&(t+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",e.opts.allErrors&&(t+=" } "),t}),Pd}var Cd,$d;function jy(){return $d||($d=1,Cd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=p?"(new RegExp("+h+"))":e.usePattern(s);t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),t+=" !"+v+".test("+u+") ) {   ";var f=f||[];f.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { pattern:  ",p?t+=""+h:t+=""+e.util.toQuotedString(s),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match pattern "`,p?t+="' + "+h+" + '":t+=""+e.util.escapeQuotes(s),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+e.util.toQuotedString(s),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var m=t;return t=f.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+m+"]); ":t+=" validate.errors = ["+m+"]; return false; ":t+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",d&&(t+=" else { "),t}),Cd}var Od,Td;function Sy(){return Td||(Td=1,Od=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level,m="key"+n,g="idx"+n,b=h.dataLevel=e.dataLevel+1,S="data"+b,O="dataProperties"+n,x=Object.keys(s||{}).filter(J),E=e.schema.patternProperties||{},$=Object.keys(E).filter(J),C=e.schema.additionalProperties,R=x.length||$.length,D=C===!1,L=typeof C=="object"&&Object.keys(C).length,T=e.opts.removeAdditional,z=D||L||T,M=e.opts.ownProperties,H=e.baseId,B=e.schema.required;if(B&&!(e.opts.$data&&B.$data)&&B.length<e.opts.loopRequired)var ee=e.util.toHash(B);function J(ne){return ne!=="__proto__"}if(t+="var "+p+" = errors;var "+f+" = true;",M&&(t+=" var "+O+" = undefined;"),z){if(M?t+=" "+O+" = "+O+" || Object.keys("+u+"); for (var "+g+"=0; "+g+"<"+O+".length; "+g+"++) { var "+m+" = "+O+"["+g+"]; ":t+=" for (var "+m+" in "+u+") { ",R){if(t+=" var isAdditional"+n+" = !(false ",x.length)if(x.length>8)t+=" || validate.schema"+o+".hasOwnProperty("+m+") ";else{var se=x;if(se)for(var ie,ke=-1,Ie=se.length-1;ke<Ie;)ie=se[ke+=1],t+=" || "+m+" == "+e.util.toQuotedString(ie)+" "}if($.length){var G=$;if(G)for(var te,ge=-1,re=G.length-1;ge<re;)te=G[ge+=1],t+=" || "+e.usePattern(te)+".test("+m+") "}t+=" ); if (isAdditional"+n+") { "}if(T=="all")t+=" delete "+u+"["+m+"]; ";else{var _=e.errorPath,P="' + "+m+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers)),D)if(T)t+=" delete "+u+"["+m+"]; ";else{t+=" "+f+" = false; ";var F=l;l=e.errSchemaPath+"/additionalProperties";var Z=Z||[];Z.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+P+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is an invalid additional property":t+="should NOT have additional properties",t+="' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var U=t;t=Z.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+U+"]); ":t+=" validate.errors = ["+U+"]; return false; ":t+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=F,d&&(t+=" break; ")}else if(L)if(T=="failing"){t+=" var "+p+" = errors;  ";var j=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=C,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var k=u+"["+m+"]";h.dataPathArr[b]=m;var q=e.validate(h);h.baseId=H,e.util.varOccurences(q,S)<2?t+=" "+e.util.varReplace(q,S,k)+" ":t+=" var "+S+" = "+k+"; "+q+" ",t+=" if (!"+f+") { errors = "+p+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+u+"["+m+"]; }  ",e.compositeRule=h.compositeRule=j}else{h.schema=C,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var k=u+"["+m+"]";h.dataPathArr[b]=m;var q=e.validate(h);h.baseId=H,e.util.varOccurences(q,S)<2?t+=" "+e.util.varReplace(q,S,k)+" ":t+=" var "+S+" = "+k+"; "+q+" ",d&&(t+=" if (!"+f+") break; ")}e.errorPath=_}R&&(t+=" } "),t+=" }  ",d&&(t+=" if ("+f+") { ",v+="}")}var K=e.opts.useDefaults&&!e.compositeRule;if(x.length){var xe=x;if(xe)for(var ie,ce=-1,pe=xe.length-1;ce<pe;){ie=xe[ce+=1];var Le=s[ie];if(e.opts.strictKeywords?typeof Le=="object"&&Object.keys(Le).length>0||Le===!1:e.util.schemaHasRules(Le,e.RULES.all)){var ot=e.util.getProperty(ie),k=u+ot,ae=K&&Le.default!==void 0;h.schema=Le,h.schemaPath=o+ot,h.errSchemaPath=l+"/"+e.util.escapeFragment(ie),h.errorPath=e.util.getPath(e.errorPath,ie,e.opts.jsonPointers),h.dataPathArr[b]=e.util.toQuotedString(ie);var q=e.validate(h);if(h.baseId=H,e.util.varOccurences(q,S)<2){q=e.util.varReplace(q,S,k);var He=k}else{var He=S;t+=" var "+S+" = "+k+"; "}if(ae)t+=" "+q+" ";else{if(ee&&ee[ie]){t+=" if ( "+He+" === undefined ",M&&(t+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(ie)+"') "),t+=") { "+f+" = false; ";var _=e.errorPath,F=l,de=e.util.escapeQuotes(ie);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(_,ie,e.opts.jsonPointers)),l=e.errSchemaPath+"/required";var Z=Z||[];Z.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+de+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+de+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var U=t;t=Z.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+U+"]); ":t+=" validate.errors = ["+U+"]; return false; ":t+=" var err = "+U+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=F,e.errorPath=_,t+=" } else { "}else d?(t+=" if ( "+He+" === undefined ",M&&(t+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(ie)+"') "),t+=") { "+f+" = true; } else { "):(t+=" if ("+He+" !== undefined ",M&&(t+=" &&   Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(ie)+"') "),t+=" ) { ");t+=" "+q+" } "}}d&&(t+=" if ("+f+") { ",v+="}")}}if($.length){var Y=$;if(Y)for(var te,Se=-1,oe=Y.length-1;Se<oe;){te=Y[Se+=1];var Le=E[te];if(e.opts.strictKeywords?typeof Le=="object"&&Object.keys(Le).length>0||Le===!1:e.util.schemaHasRules(Le,e.RULES.all)){h.schema=Le,h.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(te),h.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(te),M?t+=" "+O+" = "+O+" || Object.keys("+u+"); for (var "+g+"=0; "+g+"<"+O+".length; "+g+"++) { var "+m+" = "+O+"["+g+"]; ":t+=" for (var "+m+" in "+u+") { ",t+=" if ("+e.usePattern(te)+".test("+m+")) { ",h.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var k=u+"["+m+"]";h.dataPathArr[b]=m;var q=e.validate(h);h.baseId=H,e.util.varOccurences(q,S)<2?t+=" "+e.util.varReplace(q,S,k)+" ":t+=" var "+S+" = "+k+"; "+q+" ",d&&(t+=" if (!"+f+") break; "),t+=" } ",d&&(t+=" else "+f+" = true; "),t+=" }  ",d&&(t+=" if ("+f+") { ",v+="}")}}}return d&&(t+=" "+v+" if ("+p+" == errors) {"),t}),Od}var Id,Ld;function Ey(){return Ld||(Ld=1,Id=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level;if(t+="var "+p+" = errors;",e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){h.schema=s,h.schemaPath=o,h.errSchemaPath=l;var m="key"+n,g="idx"+n,b="i"+n,S="' + "+m+" + '",O=h.dataLevel=e.dataLevel+1,x="data"+O,E="dataProperties"+n,$=e.opts.ownProperties,C=e.baseId;$&&(t+=" var "+E+" = undefined; "),$?t+=" "+E+" = "+E+" || Object.keys("+u+"); for (var "+g+"=0; "+g+"<"+E+".length; "+g+"++) { var "+m+" = "+E+"["+g+"]; ":t+=" for (var "+m+" in "+u+") { ",t+=" var startErrs"+n+" = errors; ";var R=m,D=e.compositeRule;e.compositeRule=h.compositeRule=!0;var L=e.validate(h);h.baseId=C,e.util.varOccurences(L,x)<2?t+=" "+e.util.varReplace(L,x,R)+" ":t+=" var "+x+" = "+R+"; "+L+" ",e.compositeRule=h.compositeRule=D,t+=" if (!"+f+") { for (var "+b+"=startErrs"+n+"; "+b+"<errors; "+b+"++) { vErrors["+b+"].propertyName = "+m+"; }   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+S+"' } ",e.opts.messages!==!1&&(t+=" , message: 'property name \\'"+S+"\\' is invalid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),d&&(t+=" break; "),t+=" } }"}return d&&(t+=" "+v+" if ("+p+" == errors) {"),t}),Id}var Ad,Rd;function ky(){return Rd||(Rd=1,Ad=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ");var v="schema"+n;if(!h)if(s.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var O=[],f=s;if(f)for(var m,g=-1,b=f.length-1;g<b;){m=f[g+=1];var S=e.schema.properties[m];S&&(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all))||(O[O.length]=m)}}else var O=s;if(h||O.length){var x=e.errorPath,E=h||O.length>=e.opts.loopRequired,$=e.opts.ownProperties;if(d)if(t+=" var missing"+n+"; ",E){h||(t+=" var "+v+" = validate.schema"+o+"; ");var C="i"+n,R="schema"+n+"["+C+"]",D="' + "+R+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,R,e.opts.jsonPointers)),t+=" var "+p+" = true; ",h&&(t+=" if (schema"+n+" === undefined) "+p+" = true; else if (!Array.isArray(schema"+n+")) "+p+" = false; else {"),t+=" for (var "+C+" = 0; "+C+" < "+v+".length; "+C+"++) { "+p+" = "+u+"["+v+"["+C+"]] !== undefined ",$&&(t+=" &&   Object.prototype.hasOwnProperty.call("+u+", "+v+"["+C+"]) "),t+="; if (!"+p+") break; } ",h&&(t+="  }  "),t+="  if (!"+p+") {   ";var L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var T=t;t=L.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+T+"]); ":t+=" validate.errors = ["+T+"]; return false; ":t+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else{t+=" if ( ";var z=O;if(z)for(var M,C=-1,H=z.length-1;C<H;){M=z[C+=1],C&&(t+=" || ");var B=e.util.getProperty(M),ee=u+B;t+=" ( ( "+ee+" === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(M)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?M:B)+") ) "}t+=") {  ";var R="missing"+n,D="' + "+R+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,R,!0):x+" + "+R);var L=L||[];L.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var T=t;t=L.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+T+"]); ":t+=" validate.errors = ["+T+"]; return false; ":t+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else if(E){h||(t+=" var "+v+" = validate.schema"+o+"; ");var C="i"+n,R="schema"+n+"["+C+"]",D="' + "+R+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,R,e.opts.jsonPointers)),h&&(t+=" if ("+v+" && !Array.isArray("+v+")) {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+v+" !== undefined) { "),t+=" for (var "+C+" = 0; "+C+" < "+v+".length; "+C+"++) { if ("+u+"["+v+"["+C+"]] === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+u+", "+v+"["+C+"]) "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",h&&(t+="  }  ")}else{var J=O;if(J)for(var M,se=-1,ie=J.length-1;se<ie;){M=J[se+=1];var B=e.util.getProperty(M),D=e.util.escapeQuotes(M),ee=u+B;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,M,e.opts.jsonPointers)),t+=" if ( "+ee+" === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+u+", '"+e.util.escapeQuotes(M)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=x}else d&&(t+=" if (true) {");return t}),Ad}var Fd,Dd;function Py(){return Dd||(Dd=1,Fd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data,v;if(h?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",v="schema"+n):v=s,(s||h)&&e.opts.uniqueItems!==!1){h&&(t+=" var "+p+"; if ("+v+" === false || "+v+" === undefined) "+p+" = true; else if (typeof "+v+" != 'boolean') "+p+" = false; else { "),t+=" var i = "+u+".length , "+p+" = true , j; if (i > 1) { ";var f=e.schema.items&&e.schema.items.type,m=Array.isArray(f);if(!f||f=="object"||f=="array"||m&&(f.indexOf("object")>=0||f.indexOf("array")>=0))t+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+u+"[i], "+u+"[j])) { "+p+" = false; break outer; } } } ";else{t+=" var itemIndices = {}, item; for (;i--;) { var item = "+u+"[i]; ";var g="checkDataType"+(m?"s":"");t+=" if ("+e.util[g](f,"item",e.opts.strictNumbers,!0)+") continue; ",m&&(t+=` if (typeof item == 'string') item = '"' + item; `),t+=" if (typeof itemIndices[item] == 'number') { "+p+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}t+=" } ",h&&(t+="  }  "),t+=" if (!"+p+") {   ";var b=b||[];b.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(t+=" , schema:  ",h?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var S=t;t=b.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",d&&(t+=" else { ")}else d&&(t+=" if (true) { ");return t}),Fd}var Md,zd;function Ny(){return zd||(zd=1,Md={$ref:cy(),allOf:dy(),anyOf:uy(),$comment:hy(),const:py(),contains:my(),dependencies:fy(),enum:vy(),format:gy(),if:yy(),items:_y(),maximum:pd(),minimum:pd(),maxItems:vd(),minItems:vd(),maxLength:_d(),minLength:_d(),maxProperties:xd(),minProperties:xd(),multipleOf:wy(),not:by(),oneOf:xy(),pattern:jy(),properties:Sy(),propertyNames:Ey(),required:ky(),uniqueItems:Py(),validate:Mc()}),Md}var Hs,Ud;function Cy(){if(Ud)return Hs;Ud=1;var e=Ny(),r=aa().toHash;return Hs=function(){var a=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"],n=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],i=["number","integer","string","array","object","boolean","null"];return a.all=r(t),a.types=r(i),a.forEach(function(s){s.rules=s.rules.map(function(o){var l;if(typeof o=="object"){var d=Object.keys(o)[0];l=o[d],o=d,l.forEach(function(p){t.push(p),a.all[p]=!0})}t.push(o);var u=a.all[o]={keyword:o,code:e[o],implements:l};return u}),a.all.$comment={keyword:"$comment",code:e.$comment},s.type&&(a.types[s.type]=s)}),a.keywords=r(t.concat(n)),a.custom={},a},Hs}var qs,Hd;function $y(){if(Hd)return qs;Hd=1;var e=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];return qs=function(r,a){for(var t=0;t<a.length;t++){r=JSON.parse(JSON.stringify(r));var n=a[t].split("/"),i=r,s;for(s=1;s<n.length;s++)i=i[n[s]];for(s=0;s<e.length;s++){var o=e[s],l=i[o];l&&(i[o]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return r},qs}var Vs,qd;function Oy(){if(qd)return Vs;qd=1;var e=Ds().MissingRef;Vs=r;function r(a,t,n){var i=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof t=="function"&&(n=t,t=void 0);var s=o(a).then(function(){var d=i._addSchema(a,void 0,t);return d.validate||l(d)});return n&&s.then(function(d){n(null,d)},n),s;function o(d){var u=d.$schema;return u&&!i.getSchema(u)?r.call(i,{$ref:u},!0):Promise.resolve()}function l(d){try{return i._compile(d)}catch(p){if(p instanceof e)return u(p);throw p}function u(p){var h=p.missingSchema;if(m(h))throw new Error("Schema "+h+" is loaded but "+p.missingRef+" cannot be resolved");var v=i._loadingSchemas[h];return v||(v=i._loadingSchemas[h]=i._opts.loadSchema(h),v.then(f,f)),v.then(function(g){if(!m(h))return o(g).then(function(){m(h)||i.addSchema(g,h,void 0,t)})}).then(function(){return l(d)});function f(){delete i._loadingSchemas[h]}function m(g){return i._refs[g]||i._schemas[g]}}}}return Vs}var Vd,Bd;function Ty(){return Bd||(Bd=1,Vd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,d=!e.opts.allErrors,u,p="data"+(i||""),h="valid"+n,v="errs__"+n,f=e.opts.$data&&s&&s.$data,m;f?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",m="schema"+n):m=s;var g=this,b="definition"+n,S=g.definition,O="",x,E,$,C,R;if(f&&S.$data){R="keywordValidate"+n;var D=S.validateSchema;t+=" var "+b+" = RULES.custom['"+r+"'].definition; var "+R+" = "+b+".validate;"}else{if(C=e.useCustomRule(g,s,e.schema,e),!C)return;m="validate.schema"+o,R=C.code,x=S.compile,E=S.inline,$=S.macro}var L=R+".errors",T="i"+n,z="ruleErr"+n,M=S.async;if(M&&!e.async)throw new Error("async keyword in sync schema");if(E||$||(t+=""+L+" = null;"),t+="var "+v+" = errors;var "+h+";",f&&S.$data&&(O+="}",t+=" if ("+m+" === undefined) { "+h+" = true; } else { ",D&&(O+="}",t+=" "+h+" = "+b+".validateSchema("+m+"); if ("+h+") { ")),E)S.statements?t+=" "+C.validate+" ":t+=" "+h+" = "+C.validate+"; ";else if($){var H=e.util.copy(e),O="";H.level++;var B="valid"+H.level;H.schema=C.validate,H.schemaPath="";var ee=e.compositeRule;e.compositeRule=H.compositeRule=!0;var J=e.validate(H).replace(/validate\.schema/g,R);e.compositeRule=H.compositeRule=ee,t+=" "+J}else{var se=se||[];se.push(t),t="",t+="  "+R+".call( ",e.opts.passContext?t+="this":t+="self",x||S.schema===!1?t+=" , "+p+" ":t+=" , "+m+" , "+p+" , validate.schema"+e.schemaPath+" ",t+=" , (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var ie=i?"data"+(i-1||""):"parentData",ke=i?e.dataPathArr[i]:"parentDataProperty";t+=" , "+ie+" , "+ke+" , rootData )  ";var Ie=t;t=se.pop(),S.errors===!1?(t+=" "+h+" = ",M&&(t+="await "),t+=""+Ie+"; "):M?(L="customErrors"+n,t+=" var "+L+" = null; try { "+h+" = await "+Ie+"; } catch (e) { "+h+" = false; if (e instanceof ValidationError) "+L+" = e.errors; else throw e; } "):t+=" "+L+" = null; "+h+" = "+Ie+"; "}if(S.modifying&&(t+=" if ("+ie+") "+p+" = "+ie+"["+ke+"];"),t+=""+O,S.valid)d&&(t+=" if (true) { ");else{t+=" if ( ",S.valid===void 0?(t+=" !",$?t+=""+B:t+=""+h):t+=" "+!S.valid+" ",t+=") { ",u=g.keyword;var se=se||[];se.push(t),t="";var se=se||[];se.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(u||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { keyword: '"+g.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+g.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),t+=" } "):t+=" {} ";var G=t;t=se.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+G+"]); ":t+=" validate.errors = ["+G+"]; return false; ":t+=" var err = "+G+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var te=t;t=se.pop(),E?S.errors?S.errors!="full"&&(t+="  for (var "+T+"="+v+"; "+T+"<errors; "+T+"++) { var "+z+" = vErrors["+T+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+z+".schemaPath === undefined) { "+z+'.schemaPath = "'+l+'"; } ',e.opts.verbose&&(t+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),t+=" } "):S.errors===!1?t+=" "+te+" ":(t+=" if ("+v+" == errors) { "+te+" } else {  for (var "+T+"="+v+"; "+T+"<errors; "+T+"++) { var "+z+" = vErrors["+T+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+z+".schemaPath === undefined) { "+z+'.schemaPath = "'+l+'"; } ',e.opts.verbose&&(t+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),t+=" } } "):$?(t+="   var err =   ",e.createErrors!==!1?(t+=" { keyword: '"+(u||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { keyword: '"+g.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+g.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; ")):S.errors===!1?t+=" "+te+" ":(t+=" if (Array.isArray("+L+")) { if (vErrors === null) vErrors = "+L+"; else vErrors = vErrors.concat("+L+"); errors = vErrors.length;  for (var "+T+"="+v+"; "+T+"<errors; "+T+"++) { var "+z+" = vErrors["+T+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+";  "+z+'.schemaPath = "'+l+'";  ',e.opts.verbose&&(t+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),t+=" } } else { "+te+" } "),t+=" } ",d&&(t+=" else { ")}return t}),Vd}const Iy="http://json-schema.org/draft-07/schema#",Ly="http://json-schema.org/draft-07/schema#",Ay="Core schema meta-schema",Ry={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},Fy=["object","boolean"],Dy={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},Wd={$schema:Iy,$id:Ly,title:Ay,definitions:Ry,type:Fy,properties:Dy,default:!0};var Bs,Zd;function My(){if(Zd)return Bs;Zd=1;var e=Wd;return Bs={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:e.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:e.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}},Bs}var Ws,Gd;function zy(){if(Gd)return Ws;Gd=1;var e=/^[a-z_$][a-z0-9_$-]*$/i,r=Ty(),a=My();Ws={add:t,get:n,remove:i,validate:s};function t(o,l){var d=this.RULES;if(d.keywords[o])throw new Error("Keyword "+o+" is already defined");if(!e.test(o))throw new Error("Keyword "+o+" is not a valid identifier");if(l){this.validateKeyword(l,!0);var u=l.type;if(Array.isArray(u))for(var p=0;p<u.length;p++)v(o,u[p],l);else v(o,u,l);var h=l.metaSchema;h&&(l.$data&&this._opts.$data&&(h={anyOf:[h,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),l.validateSchema=this.compile(h,!0))}d.keywords[o]=d.all[o]=!0;function v(f,m,g){for(var b,S=0;S<d.length;S++){var O=d[S];if(O.type==m){b=O;break}}b||(b={type:m,rules:[]},d.push(b));var x={keyword:f,definition:g,custom:!0,code:r,implements:g.implements};b.rules.push(x),d.custom[f]=x}return this}function n(o){var l=this.RULES.custom[o];return l?l.definition:this.RULES.keywords[o]||!1}function i(o){var l=this.RULES;delete l.keywords[o],delete l.all[o],delete l.custom[o];for(var d=0;d<l.length;d++)for(var u=l[d].rules,p=0;p<u.length;p++)if(u[p].keyword==o){u.splice(p,1);break}return this}function s(o,l){s.errors=null;var d=this._validateKeyword=this._validateKeyword||this.compile(a,!0);if(d(o))return!0;if(s.errors=d.errors,l)throw new Error("custom keyword definition is invalid: "+this.errorsText(d.errors));return!1}return Ws}const Uy="http://json-schema.org/draft-07/schema#",Hy="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",qy="Meta-schema for $data reference (JSON Schema extension proposal)",Vy="object",By=["$data"],Wy={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},Zy=!1,Gy={$schema:Uy,$id:Hy,description:qy,type:Vy,required:By,properties:Wy,additionalProperties:Zy};var Zs,Qd;function Qy(){if(Qd)return Zs;Qd=1;var e=iy(),r=Rs(),a=oy(),t=$c(),n=Rc(),i=ly(),s=Cy(),o=$y(),l=aa();Zs=f,f.prototype.validate=m,f.prototype.compile=g,f.prototype.addSchema=b,f.prototype.addMetaSchema=S,f.prototype.validateSchema=O,f.prototype.getSchema=E,f.prototype.removeSchema=R,f.prototype.addFormat=J,f.prototype.errorsText=ee,f.prototype._addSchema=L,f.prototype._compile=T,f.prototype.compileAsync=Oy();var d=zy();f.prototype.addKeyword=d.add,f.prototype.getKeyword=d.get,f.prototype.removeKeyword=d.remove,f.prototype.validateKeyword=d.validate;var u=Ds();f.ValidationError=u.Validation,f.MissingRefError=u.MissingRef,f.$dataMetaSchema=o;var p="http://json-schema.org/draft-07/schema",h=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],v=["/properties"];function f(_){if(!(this instanceof f))return new f(_);_=this._opts=l.copy(_)||{},ge(this),this._schemas={},this._refs={},this._fragments={},this._formats=i(_.format),this._cache=_.cache||new a,this._loadingSchemas={},this._compilations=[],this.RULES=s(),this._getId=z(_),_.loopRequired=_.loopRequired||1/0,_.errorDataPath=="property"&&(_._errorDataPathProperty=!0),_.serialize===void 0&&(_.serialize=n),this._metaOpts=te(this),_.formats&&ke(this),_.keywords&&Ie(this),se(this),typeof _.meta=="object"&&this.addMetaSchema(_.meta),_.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),ie(this)}function m(_,P){var F;if(typeof _=="string"){if(F=this.getSchema(_),!F)throw new Error('no schema with key or ref "'+_+'"')}else{var Z=this._addSchema(_);F=Z.validate||this._compile(Z)}var U=F(P);return F.$async!==!0&&(this.errors=F.errors),U}function g(_,P){var F=this._addSchema(_,void 0,P);return F.validate||this._compile(F)}function b(_,P,F,Z){if(Array.isArray(_)){for(var U=0;U<_.length;U++)this.addSchema(_[U],void 0,F,Z);return this}var j=this._getId(_);if(j!==void 0&&typeof j!="string")throw new Error("schema id must be string");return P=r.normalizeId(P||j),G(this,P),this._schemas[P]=this._addSchema(_,F,Z,!0),this}function S(_,P,F){return this.addSchema(_,P,F,!0),this}function O(_,P){var F=_.$schema;if(F!==void 0&&typeof F!="string")throw new Error("$schema must be a string");if(F=F||this._opts.defaultMeta||x(this),!F)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var Z=this.validate(F,_);if(!Z&&P){var U="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(U);else throw new Error(U)}return Z}function x(_){var P=_._opts.meta;return _._opts.defaultMeta=typeof P=="object"?_._getId(P)||P:_.getSchema(p)?p:void 0,_._opts.defaultMeta}function E(_){var P=C(this,_);switch(typeof P){case"object":return P.validate||this._compile(P);case"string":return this.getSchema(P);case"undefined":return $(this,_)}}function $(_,P){var F=r.schema.call(_,{schema:{}},P);if(F){var Z=F.schema,U=F.root,j=F.baseId,k=e.call(_,Z,U,void 0,j);return _._fragments[P]=new t({ref:P,fragment:!0,schema:Z,root:U,baseId:j,validate:k}),k}}function C(_,P){return P=r.normalizeId(P),_._schemas[P]||_._refs[P]||_._fragments[P]}function R(_){if(_ instanceof RegExp)return D(this,this._schemas,_),D(this,this._refs,_),this;switch(typeof _){case"undefined":return D(this,this._schemas),D(this,this._refs),this._cache.clear(),this;case"string":var P=C(this,_);return P&&this._cache.del(P.cacheKey),delete this._schemas[_],delete this._refs[_],this;case"object":var F=this._opts.serialize,Z=F?F(_):_;this._cache.del(Z);var U=this._getId(_);U&&(U=r.normalizeId(U),delete this._schemas[U],delete this._refs[U])}return this}function D(_,P,F){for(var Z in P){var U=P[Z];!U.meta&&(!F||F.test(Z))&&(_._cache.del(U.cacheKey),delete P[Z])}}function L(_,P,F,Z){if(typeof _!="object"&&typeof _!="boolean")throw new Error("schema should be object or boolean");var U=this._opts.serialize,j=U?U(_):_,k=this._cache.get(j);if(k)return k;Z=Z||this._opts.addUsedSchema!==!1;var q=r.normalizeId(this._getId(_));q&&Z&&G(this,q);var K=this._opts.validateSchema!==!1&&!P,xe;K&&!(xe=q&&q==r.normalizeId(_.$schema))&&this.validateSchema(_,!0);var ce=r.ids.call(this,_),pe=new t({id:q,schema:_,localRefs:ce,cacheKey:j,meta:F});return q[0]!="#"&&Z&&(this._refs[q]=pe),this._cache.put(j,pe),K&&xe&&this.validateSchema(_,!0),pe}function T(_,P){if(_.compiling)return _.validate=U,U.schema=_.schema,U.errors=null,U.root=P||U,_.schema.$async===!0&&(U.$async=!0),U;_.compiling=!0;var F;_.meta&&(F=this._opts,this._opts=this._metaOpts);var Z;try{Z=e.call(this,_.schema,P,_.localRefs)}catch(j){throw delete _.validate,j}finally{_.compiling=!1,_.meta&&(this._opts=F)}return _.validate=Z,_.refs=Z.refs,_.refVal=Z.refVal,_.root=Z.root,Z;function U(){var j=_.validate,k=j.apply(this,arguments);return U.errors=j.errors,k}}function z(_){switch(_.schemaId){case"auto":return B;case"id":return M;default:return H}}function M(_){return _.$id&&this.logger.warn("schema $id ignored",_.$id),_.id}function H(_){return _.id&&this.logger.warn("schema id ignored",_.id),_.$id}function B(_){if(_.$id&&_.id&&_.$id!=_.id)throw new Error("schema $id is different from id");return _.$id||_.id}function ee(_,P){if(_=_||this.errors,!_)return"No errors";P=P||{};for(var F=P.separator===void 0?", ":P.separator,Z=P.dataVar===void 0?"data":P.dataVar,U="",j=0;j<_.length;j++){var k=_[j];k&&(U+=Z+k.dataPath+" "+k.message+F)}return U.slice(0,-F.length)}function J(_,P){return typeof P=="string"&&(P=new RegExp(P)),this._formats[_]=P,this}function se(_){var P;if(_._opts.$data&&(P=Gy,_.addMetaSchema(P,P.$id,!0)),_._opts.meta!==!1){var F=Wd;_._opts.$data&&(F=o(F,v)),_.addMetaSchema(F,p,!0),_._refs["http://json-schema.org/schema"]=p}}function ie(_){var P=_._opts.schemas;if(P)if(Array.isArray(P))_.addSchema(P);else for(var F in P)_.addSchema(P[F],F)}function ke(_){for(var P in _._opts.formats){var F=_._opts.formats[P];_.addFormat(P,F)}}function Ie(_){for(var P in _._opts.keywords){var F=_._opts.keywords[P];_.addKeyword(P,F)}}function G(_,P){if(_._schemas[P]||_._refs[P])throw new Error('schema with key or id "'+P+'" already exists')}function te(_){for(var P=l.copy(_._opts),F=0;F<h.length;F++)delete P[h[F]];return P}function ge(_){var P=_._opts.logger;if(P===!1)_.logger={log:re,warn:re,error:re};else{if(P===void 0&&(P=console),!(typeof P=="object"&&P.log&&P.warn&&P.error))throw new Error("logger must implement log, warn and error methods");_.logger=P}}function re(){}return Zs}var Jy=Qy();const Ky=xo(Jy);class Gs extends ey{constructor(r,a){var t;super(a),this._clientInfo=r,this._cachedToolOutputValidators=new Map,this._capabilities=(t=a==null?void 0:a.capabilities)!==null&&t!==void 0?t:{},this._ajv=new Ky}registerCapabilities(r){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=ty(this._capabilities,r)}assertCapability(r,a){var t;if(!(!((t=this._serverCapabilities)===null||t===void 0)&&t[r]))throw new Error(`Server does not support ${r} (required for ${a})`)}async connect(r,a){if(await super.connect(r),r.sessionId===void 0)try{const t=await this.request({method:"initialize",params:{protocolVersion:vn,capabilities:this._capabilities,clientInfo:this._clientInfo}},dc,a);if(t===void 0)throw new Error(`Server sent invalid initialize result: ${t}`);if(!rg.includes(t.protocolVersion))throw new Error(`Server's protocol version is not supported: ${t.protocolVersion}`);this._serverCapabilities=t.capabilities,this._serverVersion=t.serverInfo,r.setProtocolVersion&&r.setProtocolVersion(t.protocolVersion),this._instructions=t.instructions,await this.notification({method:"notifications/initialized"})}catch(t){throw this.close(),t}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(r){var a,t,n,i,s;switch(r){case"logging/setLevel":if(!(!((a=this._serverCapabilities)===null||a===void 0)&&a.logging))throw new Error(`Server does not support logging (required for ${r})`);break;case"prompts/get":case"prompts/list":if(!(!((t=this._serverCapabilities)===null||t===void 0)&&t.prompts))throw new Error(`Server does not support prompts (required for ${r})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(!((n=this._serverCapabilities)===null||n===void 0)&&n.resources))throw new Error(`Server does not support resources (required for ${r})`);if(r==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${r})`);break;case"tools/call":case"tools/list":if(!(!((i=this._serverCapabilities)===null||i===void 0)&&i.tools))throw new Error(`Server does not support tools (required for ${r})`);break;case"completion/complete":if(!(!((s=this._serverCapabilities)===null||s===void 0)&&s.completions))throw new Error(`Server does not support completions (required for ${r})`);break}}assertNotificationCapability(r){var a;switch(r){case"notifications/roots/list_changed":if(!(!((a=this._capabilities.roots)===null||a===void 0)&&a.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${r})`);break}}assertRequestHandlerCapability(r){switch(r){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${r})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${r})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${r})`);break}}async ping(r){return this.request({method:"ping"},ra,r)}async complete(r,a){return this.request({method:"completion/complete",params:r},Sc,a)}async setLoggingLevel(r,a){return this.request({method:"logging/setLevel",params:{level:r}},ra,a)}async getPrompt(r,a){return this.request({method:"prompts/get",params:r},bc,a)}async listPrompts(r,a){return this.request({method:"prompts/list",params:r},_c,a)}async listResources(r,a){return this.request({method:"resources/list",params:r},vc,a)}async listResourceTemplates(r,a){return this.request({method:"resources/templates/list",params:r},gc,a)}async readResource(r,a){return this.request({method:"resources/read",params:r},yc,a)}async subscribeResource(r,a){return this.request({method:"resources/subscribe",params:r},ra,a)}async unsubscribeResource(r,a){return this.request({method:"resources/unsubscribe",params:r},ra,a)}async callTool(r,a=bn,t){const n=await this.request({method:"tools/call",params:r},a,t),i=this.getToolOutputValidator(r.name);if(i){if(!n.structuredContent&&!n.isError)throw new wr(Gt.InvalidRequest,`Tool ${r.name} has an output schema but did not return structured content`);if(n.structuredContent)try{if(!i(n.structuredContent))throw new wr(Gt.InvalidParams,`Structured content does not match the tool's output schema: ${this._ajv.errorsText(i.errors)}`)}catch(s){throw s instanceof wr?s:new wr(Gt.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return n}cacheToolOutputSchemas(r){this._cachedToolOutputValidators.clear();for(const a of r)if(a.outputSchema)try{const t=this._ajv.compile(a.outputSchema);this._cachedToolOutputValidators.set(a.name,t)}catch{}}getToolOutputValidator(r){return this._cachedToolOutputValidators.get(r)}async listTools(r,a){const t=await this.request({method:"tools/list",params:r},xc,a);return this.cacheToolOutputSchemas(t.tools),t}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}var Dr={exports:{}},Qs,Jd;function Xy(){if(Jd)return Qs;Jd=1;var e={};Qs=n,n.sync=i;var r=gr;function a(s,o){var l=o.pathExt!==void 0?o.pathExt:e.PATHEXT;if(!l||(l=l.split(";"),l.indexOf("")!==-1))return!0;for(var d=0;d<l.length;d++){var u=l[d].toLowerCase();if(u&&s.substr(-u.length).toLowerCase()===u)return!0}return!1}function t(s,o,l){return!s.isSymbolicLink()&&!s.isFile()?!1:a(o,l)}function n(s,o,l){r.stat(s,function(d,u){l(d,d?!1:t(u,s,o))})}function i(s,o){return t(r.statSync(s),s,o)}return Qs}var Js,Kd;function Yy(){if(Kd)return Js;Kd=1,Js=r,r.sync=a;var e=gr;function r(i,s,o){e.stat(i,function(l,d){o(l,l?!1:t(d,s))})}function a(i,s){return t(e.statSync(i),s)}function t(i,s){return i.isFile()&&n(i,s)}function n(i,s){var o=i.mode,l=i.uid,d=i.gid,u=s.uid!==void 0?s.uid:Ne.getuid&&Ne.getuid(),p=s.gid!==void 0?s.gid:Ne.getgid&&Ne.getgid(),h=parseInt("100",8),v=parseInt("010",8),f=parseInt("001",8),m=h|v,g=o&f||o&v&&d===p||o&h&&l===u||o&m&&u===0;return g}return Js}var Ks,Xd;function e_(){if(Xd)return Ks;Xd=1;var e;Ne.platform==="win32"||Zr.TESTING_WINDOWS?e=Xy():e=Yy(),Ks=r,r.sync=a;function r(t,n,i){if(typeof n=="function"&&(i=n,n={}),!i){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,o){r(t,n||{},function(l,d){l?o(l):s(d)})})}e(t,n||{},function(s,o){s&&(s.code==="EACCES"||n&&n.ignoreErrors)&&(s=null,o=!1),i(s,o)})}function a(t,n){try{return e.sync(t,n||{})}catch(i){if(n&&n.ignoreErrors||i.code==="EACCES")return!1;throw i}}return Ks}var Xs,Yd;function t_(){if(Yd)return Xs;Yd=1;var e={};const r=Ne.platform==="win32"||e.OSTYPE==="cygwin"||e.OSTYPE==="msys",a=gr,t=r?";":":",n=e_(),i=d=>Object.assign(new Error(`not found: ${d}`),{code:"ENOENT"}),s=(d,u)=>{const p=u.colon||t,h=d.match(/\//)||r&&d.match(/\\/)?[""]:[...r?[Ne.cwd()]:[],...(u.path||e.PATH||"").split(p)],v=r?u.pathExt||e.PATHEXT||".EXE;.CMD;.BAT;.COM":"",f=r?v.split(p):[""];return r&&d.indexOf(".")!==-1&&f[0]!==""&&f.unshift(""),{pathEnv:h,pathExt:f,pathExtExe:v}},o=(d,u,p)=>{typeof u=="function"&&(p=u,u={}),u||(u={});const{pathEnv:h,pathExt:v,pathExtExe:f}=s(d,u),m=[],g=S=>new Promise((O,x)=>{if(S===h.length)return u.all&&m.length?O(m):x(i(d));const E=h[S],$=/^".*"$/.test(E)?E.slice(1,-1):E,C=a.join($,d),R=!$&&/^\.[\\\/]/.test(d)?d.slice(0,2)+C:C;O(b(R,S,0))}),b=(S,O,x)=>new Promise((E,$)=>{if(x===v.length)return E(g(O+1));const C=v[x];n(S+C,{pathExt:f},(R,D)=>{if(!R&&D)if(u.all)m.push(S+C);else return E(S+C);return E(b(S,O,x+1))})});return p?g(0).then(S=>p(null,S),p):g(0)},l=(d,u)=>{u=u||{};const{pathEnv:p,pathExt:h,pathExtExe:v}=s(d,u),f=[];for(let m=0;m<p.length;m++){const g=p[m],b=/^".*"$/.test(g)?g.slice(1,-1):g,S=a.join(b,d),O=!b&&/^\.[\\\/]/.test(d)?d.slice(0,2)+S:S;for(let x=0;x<h.length;x++){const E=O+h[x];try{if(n.sync(E,{pathExt:v}))if(u.all)f.push(E);else return E}catch{}}}if(u.all&&f.length)return f;if(u.nothrow)return null;throw i(d)};return Xs=o,o.sync=l,Xs}var jn={exports:{}},eu;function r_(){if(eu)return jn.exports;eu=1;var e={};const r=(a={})=>{const t=a.env||e;return(a.platform||Ne.platform)!=="win32"?"PATH":Object.keys(t).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};return jn.exports=r,jn.exports.default=r,jn.exports}var Ys,tu;function a_(){if(tu)return Ys;tu=1;var e={};const r=gr,a=t_(),t=r_();function n(s,o){const l=s.options.env||e,d=Ne.cwd(),u=s.options.cwd!=null,p=u&&Ne.chdir!==void 0&&!Ne.chdir.disabled;if(p)try{Ne.chdir(s.options.cwd)}catch{}let h;try{h=a.sync(s.command,{path:l[t({env:l})],pathExt:o?r.delimiter:void 0})}catch{}finally{p&&Ne.chdir(d)}return h&&(h=r.resolve(u?s.options.cwd:"",h)),h}function i(s){return n(s)||n(s,!0)}return Ys=i,Ys}var Sn={},ru;function n_(){if(ru)return Sn;ru=1;const e=/([()\][%!^"`<>&|;, *?])/g;function r(t){return t=t.replace(e,"^$1"),t}function a(t,n){return t=`${t}`,t=t.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),t=t.replace(/(?=(\\+?)?)\1$/,"$1$1"),t=`"${t}"`,t=t.replace(e,"^$1"),n&&(t=t.replace(e,"^$1")),t}return Sn.command=r,Sn.argument=a,Sn}var au,nu;function s_(){return nu||(nu=1,au=/^#!(.*)/),au}var ei,su;function i_(){if(su)return ei;su=1;const e=s_();return ei=(r="")=>{const a=r.match(e);if(!a)return null;const[t,n]=a[0].replace(/#! ?/,"").split(" "),i=t.split("/").pop();return i==="env"?n:n?`${i} ${n}`:i},ei}var ti,iu;function o_(){if(iu)return ti;iu=1;const e=gr,r=i_();function a(t){const n=Fh.alloc(150);let i;try{i=e.openSync(t,"r"),e.readSync(i,n,0,150,0),e.closeSync(i)}catch{}return r(n.toString())}return ti=a,ti}var ri,ou;function l_(){if(ou)return ri;ou=1;var e={};const r=gr,a=a_(),t=n_(),n=o_(),i=Ne.platform==="win32",s=/\.(?:com|exe)$/i,o=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function l(p){p.file=a(p);const h=p.file&&n(p.file);return h?(p.args.unshift(p.file),p.command=h,a(p)):p.file}function d(p){if(!i)return p;const h=l(p),v=!s.test(h);if(p.options.forceShell||v){const f=o.test(h);p.command=r.normalize(p.command),p.command=t.command(p.command),p.args=p.args.map(g=>t.argument(g,f));const m=[p.command].concat(p.args).join(" ");p.args=["/d","/s","/c",`"${m}"`],p.command=e.comspec||"cmd.exe",p.options.windowsVerbatimArguments=!0}return p}function u(p,h,v){h&&!Array.isArray(h)&&(v=h,h=null),h=h?h.slice(0):[],v=Object.assign({},v);const f={command:p,args:h,options:v,file:void 0,original:{command:p,args:h}};return v.shell?f:d(f)}return ri=u,ri}var ai,lu;function c_(){if(lu)return ai;lu=1;const e=Ne.platform==="win32";function r(i,s){return Object.assign(new Error(`${s} ${i.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${s} ${i.command}`,path:i.command,spawnargs:i.args})}function a(i,s){if(!e)return;const o=i.emit;i.emit=function(l,d){if(l==="exit"){const u=t(d,s);if(u)return o.call(i,"error",u)}return o.apply(i,arguments)}}function t(i,s){return e&&i===1&&!s.file?r(s.original,"spawn"):null}function n(i,s){return e&&i===1&&!s.file?r(s.original,"spawnSync"):null}return ai={hookChildProcess:a,verifyENOENT:t,verifyENOENTSync:n,notFoundError:r},ai}var cu;function d_(){if(cu)return Dr.exports;cu=1;const e=gr,r=l_(),a=c_();function t(i,s,o){const l=r(i,s,o),d=e.spawn(l.command,l.args,l.options);return a.hookChildProcess(d,l),d}function n(i,s,o){const l=r(i,s,o),d=e.spawnSync(l.command,l.args,l.options);return d.error=d.error||a.verifyENOENTSync(d.status,l),d}return Dr.exports=t,Dr.exports.spawn=t,Dr.exports.sync=n,Dr.exports._parse=r,Dr.exports._enoent=a,Dr.exports}var u_=d_();const h_=xo(u_);var du,uu;function hu(){return uu||(uu=1,du=jo().EventEmitter),du}var ni,pu;function p_(){if(pu)return ni;pu=1;function e(f,m){var g=Object.keys(f);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(f);m&&(b=b.filter(function(S){return Object.getOwnPropertyDescriptor(f,S).enumerable})),g.push.apply(g,b)}return g}function r(f){for(var m=1;m<arguments.length;m++){var g=arguments[m]!=null?arguments[m]:{};m%2?e(Object(g),!0).forEach(function(b){a(f,b,g[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(g)):e(Object(g)).forEach(function(b){Object.defineProperty(f,b,Object.getOwnPropertyDescriptor(g,b))})}return f}function a(f,m,g){return m=s(m),m in f?Object.defineProperty(f,m,{value:g,enumerable:!0,configurable:!0,writable:!0}):f[m]=g,f}function t(f,m){if(!(f instanceof m))throw new TypeError("Cannot call a class as a function")}function n(f,m){for(var g=0;g<m.length;g++){var b=m[g];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(f,s(b.key),b)}}function i(f,m,g){return m&&n(f.prototype,m),Object.defineProperty(f,"prototype",{writable:!1}),f}function s(f){var m=o(f,"string");return typeof m=="symbol"?m:String(m)}function o(f,m){if(typeof f!="object"||f===null)return f;var g=f[Symbol.toPrimitive];if(g!==void 0){var b=g.call(f,m||"default");if(typeof b!="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(f)}var l=So(),d=l.Buffer,u=gr,p=u.inspect,h=p&&p.custom||"inspect";function v(f,m,g){d.prototype.copy.call(f,m,g)}return ni=function(){function f(){t(this,f),this.head=null,this.tail=null,this.length=0}return i(f,[{key:"push",value:function(m){var g={data:m,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}},{key:"unshift",value:function(m){var g={data:m,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var g=this.head,b=""+g.data;g=g.next;)b+=m+g.data;return b}},{key:"concat",value:function(m){if(this.length===0)return d.alloc(0);for(var g=d.allocUnsafe(m>>>0),b=this.head,S=0;b;)v(b.data,g,S),S+=b.data.length,b=b.next;return g}},{key:"consume",value:function(m,g){var b;return m<this.head.data.length?(b=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):m===this.head.data.length?b=this.shift():b=g?this._getString(m):this._getBuffer(m),b}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var g=this.head,b=1,S=g.data;for(m-=S.length;g=g.next;){var O=g.data,x=m>O.length?O.length:m;if(x===O.length?S+=O:S+=O.slice(0,m),m-=x,m===0){x===O.length?(++b,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=O.slice(x));break}++b}return this.length-=b,S}},{key:"_getBuffer",value:function(m){var g=d.allocUnsafe(m),b=this.head,S=1;for(b.data.copy(g),m-=b.data.length;b=b.next;){var O=b.data,x=m>O.length?O.length:m;if(O.copy(g,g.length-m,0,x),m-=x,m===0){x===O.length?(++S,b.next?this.head=b.next:this.head=this.tail=null):(this.head=b,b.data=O.slice(x));break}++S}return this.length-=S,g}},{key:h,value:function(m,g){return p(this,r(r({},g),{},{depth:0,customInspect:!1}))}}]),f}(),ni}var si,mu;function fu(){if(mu)return si;mu=1;function e(s,o){var l=this,d=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return d||u?(o?o(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Ne.nextTick(n,this,s)):Ne.nextTick(n,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(p){!o&&p?l._writableState?l._writableState.errorEmitted?Ne.nextTick(a,l):(l._writableState.errorEmitted=!0,Ne.nextTick(r,l,p)):Ne.nextTick(r,l,p):o?(Ne.nextTick(a,l),o(p)):Ne.nextTick(a,l)}),this)}function r(s,o){n(s,o),a(s)}function a(s){s._writableState&&!s._writableState.emitClose||s._readableState&&!s._readableState.emitClose||s.emit("close")}function t(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function n(s,o){s.emit("error",o)}function i(s,o){var l=s._readableState,d=s._writableState;l&&l.autoDestroy||d&&d.autoDestroy?s.destroy(o):s.emit("error",o)}return si={destroy:e,undestroy:t,errorOrDestroy:i},si}var ii={},vu;function na(){if(vu)return ii;vu=1;function e(o,l){o.prototype=Object.create(l.prototype),o.prototype.constructor=o,o.__proto__=l}var r={};function a(o,l,d){d||(d=Error);function u(h,v,f){return typeof l=="string"?l:l(h,v,f)}var p=function(h){e(v,h);function v(f,m,g){return h.call(this,u(f,m,g))||this}return v}(d);p.prototype.name=d.name,p.prototype.code=o,r[o]=p}function t(o,l){if(Array.isArray(o)){var d=o.length;return o=o.map(function(u){return String(u)}),d>2?"one of ".concat(l," ").concat(o.slice(0,d-1).join(", "),", or ")+o[d-1]:d===2?"one of ".concat(l," ").concat(o[0]," or ").concat(o[1]):"of ".concat(l," ").concat(o[0])}else return"of ".concat(l," ").concat(String(o))}function n(o,l,d){return o.substr(0,l.length)===l}function i(o,l,d){return(d===void 0||d>o.length)&&(d=o.length),o.substring(d-l.length,d)===l}function s(o,l,d){return typeof d!="number"&&(d=0),d+l.length>o.length?!1:o.indexOf(l,d)!==-1}return a("ERR_INVALID_OPT_VALUE",function(o,l){return'The value "'+l+'" is invalid for option "'+o+'"'},TypeError),a("ERR_INVALID_ARG_TYPE",function(o,l,d){var u;typeof l=="string"&&n(l,"not ")?(u="must not be",l=l.replace(/^not /,"")):u="must be";var p;if(i(o," argument"))p="The ".concat(o," ").concat(u," ").concat(t(l,"type"));else{var h=s(o,".")?"property":"argument";p='The "'.concat(o,'" ').concat(h," ").concat(u," ").concat(t(l,"type"))}return p+=". Received type ".concat(typeof d),p},TypeError),a("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),a("ERR_METHOD_NOT_IMPLEMENTED",function(o){return"The "+o+" method is not implemented"}),a("ERR_STREAM_PREMATURE_CLOSE","Premature close"),a("ERR_STREAM_DESTROYED",function(o){return"Cannot call "+o+" after a stream was destroyed"}),a("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),a("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),a("ERR_STREAM_WRITE_AFTER_END","write after end"),a("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),a("ERR_UNKNOWN_ENCODING",function(o){return"Unknown encoding: "+o},TypeError),a("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),ii.codes=r,ii}var oi,gu;function yu(){if(gu)return oi;gu=1;var e=na().codes.ERR_INVALID_OPT_VALUE;function r(t,n,i){return t.highWaterMark!=null?t.highWaterMark:n?t[i]:null}function a(t,n,i,s){var o=r(n,s,i);if(o!=null){if(!(isFinite(o)&&Math.floor(o)===o)||o<0){var l=s?i:"highWaterMark";throw new e(l,o)}return Math.floor(o)}return t.objectMode?16:16*1024}return oi={getHighWaterMark:a},oi}var li,_u;function m_(){if(_u)return li;_u=1,li=e;function e(a,t){if(r("noDeprecation"))return a;var n=!1;function i(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return a.apply(this,arguments)}return i}function r(a){try{if(!Zr.localStorage)return!1}catch{return!1}var t=Zr.localStorage[a];return t==null?!1:String(t).toLowerCase()==="true"}return li}var ci,wu;function bu(){if(wu)return ci;wu=1,ci=R;function e(_){var P=this;this.next=null,this.entry=null,this.finish=function(){re(P,_)}}var r;R.WritableState=$;var a={deprecate:m_()},t=hu(),n=So().Buffer,i=(typeof Zr<"u"?Zr:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(_){return n.from(_)}function o(_){return n.isBuffer(_)||_ instanceof i}var l=fu(),d=yu(),u=d.getHighWaterMark,p=na().codes,h=p.ERR_INVALID_ARG_TYPE,v=p.ERR_METHOD_NOT_IMPLEMENTED,f=p.ERR_MULTIPLE_CALLBACK,m=p.ERR_STREAM_CANNOT_PIPE,g=p.ERR_STREAM_DESTROYED,b=p.ERR_STREAM_NULL_VALUES,S=p.ERR_STREAM_WRITE_AFTER_END,O=p.ERR_UNKNOWN_ENCODING,x=l.errorOrDestroy;ka()(R,t);function E(){}function $(_,P,F){r=r||sa(),_=_||{},typeof F!="boolean"&&(F=P instanceof r),this.objectMode=!!_.objectMode,F&&(this.objectMode=this.objectMode||!!_.writableObjectMode),this.highWaterMark=u(this,_,"writableHighWaterMark",F),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Z=_.decodeStrings===!1;this.decodeStrings=!Z,this.defaultEncoding=_.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(U){ee(P,U)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=_.emitClose!==!1,this.autoDestroy=!!_.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}$.prototype.getBuffer=function(){for(var _=this.bufferedRequest,P=[];_;)P.push(_),_=_.next;return P},function(){try{Object.defineProperty($.prototype,"buffer",{get:a.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var C;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(C=Function.prototype[Symbol.hasInstance],Object.defineProperty(R,Symbol.hasInstance,{value:function(_){return C.call(this,_)?!0:this!==R?!1:_&&_._writableState instanceof $}})):C=function(_){return _ instanceof this};function R(_){r=r||sa();var P=this instanceof r;if(!P&&!C.call(R,this))return new R(_);this._writableState=new $(_,this,P),this.writable=!0,_&&(typeof _.write=="function"&&(this._write=_.write),typeof _.writev=="function"&&(this._writev=_.writev),typeof _.destroy=="function"&&(this._destroy=_.destroy),typeof _.final=="function"&&(this._final=_.final)),t.call(this)}R.prototype.pipe=function(){x(this,new m)};function D(_,P){var F=new S;x(_,F),Ne.nextTick(P,F)}function L(_,P,F,Z){var U;return F===null?U=new b:typeof F!="string"&&!P.objectMode&&(U=new h("chunk",["string","Buffer"],F)),U?(x(_,U),Ne.nextTick(Z,U),!1):!0}R.prototype.write=function(_,P,F){var Z=this._writableState,U=!1,j=!Z.objectMode&&o(_);return j&&!n.isBuffer(_)&&(_=s(_)),typeof P=="function"&&(F=P,P=null),j?P="buffer":P||(P=Z.defaultEncoding),typeof F!="function"&&(F=E),Z.ending?D(this,F):(j||L(this,Z,_,F))&&(Z.pendingcb++,U=z(this,Z,j,_,P,F)),U},R.prototype.cork=function(){this._writableState.corked++},R.prototype.uncork=function(){var _=this._writableState;_.corked&&(_.corked--,!_.writing&&!_.corked&&!_.bufferProcessing&&_.bufferedRequest&&ie(this,_))},R.prototype.setDefaultEncoding=function(_){if(typeof _=="string"&&(_=_.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((_+"").toLowerCase())>-1))throw new O(_);return this._writableState.defaultEncoding=_,this},Object.defineProperty(R.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function T(_,P,F){return!_.objectMode&&_.decodeStrings!==!1&&typeof P=="string"&&(P=n.from(P,F)),P}Object.defineProperty(R.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function z(_,P,F,Z,U,j){if(!F){var k=T(P,Z,U);Z!==k&&(F=!0,U="buffer",Z=k)}var q=P.objectMode?1:Z.length;P.length+=q;var K=P.length<P.highWaterMark;if(K||(P.needDrain=!0),P.writing||P.corked){var xe=P.lastBufferedRequest;P.lastBufferedRequest={chunk:Z,encoding:U,isBuf:F,callback:j,next:null},xe?xe.next=P.lastBufferedRequest:P.bufferedRequest=P.lastBufferedRequest,P.bufferedRequestCount+=1}else M(_,P,!1,q,Z,U,j);return K}function M(_,P,F,Z,U,j,k){P.writelen=Z,P.writecb=k,P.writing=!0,P.sync=!0,P.destroyed?P.onwrite(new g("write")):F?_._writev(U,P.onwrite):_._write(U,j,P.onwrite),P.sync=!1}function H(_,P,F,Z,U){--P.pendingcb,F?(Ne.nextTick(U,Z),Ne.nextTick(te,_,P),_._writableState.errorEmitted=!0,x(_,Z)):(U(Z),_._writableState.errorEmitted=!0,x(_,Z),te(_,P))}function B(_){_.writing=!1,_.writecb=null,_.length-=_.writelen,_.writelen=0}function ee(_,P){var F=_._writableState,Z=F.sync,U=F.writecb;if(typeof U!="function")throw new f;if(B(F),P)H(_,F,Z,P,U);else{var j=ke(F)||_.destroyed;!j&&!F.corked&&!F.bufferProcessing&&F.bufferedRequest&&ie(_,F),Z?Ne.nextTick(J,_,F,j,U):J(_,F,j,U)}}function J(_,P,F,Z){F||se(_,P),P.pendingcb--,Z(),te(_,P)}function se(_,P){P.length===0&&P.needDrain&&(P.needDrain=!1,_.emit("drain"))}function ie(_,P){P.bufferProcessing=!0;var F=P.bufferedRequest;if(_._writev&&F&&F.next){var Z=P.bufferedRequestCount,U=new Array(Z),j=P.corkedRequestsFree;j.entry=F;for(var k=0,q=!0;F;)U[k]=F,F.isBuf||(q=!1),F=F.next,k+=1;U.allBuffers=q,M(_,P,!0,P.length,U,"",j.finish),P.pendingcb++,P.lastBufferedRequest=null,j.next?(P.corkedRequestsFree=j.next,j.next=null):P.corkedRequestsFree=new e(P),P.bufferedRequestCount=0}else{for(;F;){var K=F.chunk,xe=F.encoding,ce=F.callback,pe=P.objectMode?1:K.length;if(M(_,P,!1,pe,K,xe,ce),F=F.next,P.bufferedRequestCount--,P.writing)break}F===null&&(P.lastBufferedRequest=null)}P.bufferedRequest=F,P.bufferProcessing=!1}R.prototype._write=function(_,P,F){F(new v("_write()"))},R.prototype._writev=null,R.prototype.end=function(_,P,F){var Z=this._writableState;return typeof _=="function"?(F=_,_=null,P=null):typeof P=="function"&&(F=P,P=null),_!=null&&this.write(_,P),Z.corked&&(Z.corked=1,this.uncork()),Z.ending||ge(this,Z,F),this},Object.defineProperty(R.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ke(_){return _.ending&&_.length===0&&_.bufferedRequest===null&&!_.finished&&!_.writing}function Ie(_,P){_._final(function(F){P.pendingcb--,F&&x(_,F),P.prefinished=!0,_.emit("prefinish"),te(_,P)})}function G(_,P){!P.prefinished&&!P.finalCalled&&(typeof _._final=="function"&&!P.destroyed?(P.pendingcb++,P.finalCalled=!0,Ne.nextTick(Ie,_,P)):(P.prefinished=!0,_.emit("prefinish")))}function te(_,P){var F=ke(P);if(F&&(G(_,P),P.pendingcb===0&&(P.finished=!0,_.emit("finish"),P.autoDestroy))){var Z=_._readableState;(!Z||Z.autoDestroy&&Z.endEmitted)&&_.destroy()}return F}function ge(_,P,F){P.ending=!0,te(_,P),F&&(P.finished?Ne.nextTick(F):_.once("finish",F)),P.ended=!0,_.writable=!1}function re(_,P,F){var Z=_.entry;for(_.entry=null;Z;){var U=Z.callback;P.pendingcb--,U(F),Z=Z.next}P.corkedRequestsFree.next=_}return Object.defineProperty(R.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(_){this._writableState&&(this._writableState.destroyed=_)}}),R.prototype.destroy=l.destroy,R.prototype._undestroy=l.undestroy,R.prototype._destroy=function(_,P){P(_)},ci}var di,xu;function sa(){if(xu)return di;xu=1;var e=Object.keys||function(d){var u=[];for(var p in d)u.push(p);return u};di=s;var r=Nu(),a=bu();ka()(s,r);for(var t=e(a.prototype),n=0;n<t.length;n++){var i=t[n];s.prototype[i]||(s.prototype[i]=a.prototype[i])}function s(d){if(!(this instanceof s))return new s(d);r.call(this,d),a.call(this,d),this.allowHalfOpen=!0,d&&(d.readable===!1&&(this.readable=!1),d.writable===!1&&(this.writable=!1),d.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",o)))}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o(){this._writableState.ended||Ne.nextTick(l,this)}function l(d){d.end()}return Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(d){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=d,this._writableState.destroyed=d)}}),di}var ui,ju;function hi(){if(ju)return ui;ju=1;var e=na().codes.ERR_STREAM_PREMATURE_CLOSE;function r(i){var s=!1;return function(){if(!s){s=!0;for(var o=arguments.length,l=new Array(o),d=0;d<o;d++)l[d]=arguments[d];i.apply(this,l)}}}function a(){}function t(i){return i.setHeader&&typeof i.abort=="function"}function n(i,s,o){if(typeof s=="function")return n(i,null,s);s||(s={}),o=r(o||a);var l=s.readable||s.readable!==!1&&i.readable,d=s.writable||s.writable!==!1&&i.writable,u=function(){i.writable||h()},p=i._writableState&&i._writableState.finished,h=function(){d=!1,p=!0,l||o.call(i)},v=i._readableState&&i._readableState.endEmitted,f=function(){l=!1,v=!0,d||o.call(i)},m=function(S){o.call(i,S)},g=function(){var S;if(l&&!v)return(!i._readableState||!i._readableState.ended)&&(S=new e),o.call(i,S);if(d&&!p)return(!i._writableState||!i._writableState.ended)&&(S=new e),o.call(i,S)},b=function(){i.req.on("finish",h)};return t(i)?(i.on("complete",h),i.on("abort",g),i.req?b():i.on("request",b)):d&&!i._writableState&&(i.on("end",u),i.on("close",u)),i.on("end",f),i.on("finish",h),s.error!==!1&&i.on("error",m),i.on("close",g),function(){i.removeListener("complete",h),i.removeListener("abort",g),i.removeListener("request",b),i.req&&i.req.removeListener("finish",h),i.removeListener("end",u),i.removeListener("close",u),i.removeListener("finish",h),i.removeListener("end",f),i.removeListener("error",m),i.removeListener("close",g)}}return ui=n,ui}var pi,Su;function f_(){if(Su)return pi;Su=1;var e;function r(O,x,E){return x=a(x),x in O?Object.defineProperty(O,x,{value:E,enumerable:!0,configurable:!0,writable:!0}):O[x]=E,O}function a(O){var x=t(O,"string");return typeof x=="symbol"?x:String(x)}function t(O,x){if(typeof O!="object"||O===null)return O;var E=O[Symbol.toPrimitive];if(E!==void 0){var $=E.call(O,x||"default");if(typeof $!="object")return $;throw new TypeError("@@toPrimitive must return a primitive value.")}return(x==="string"?String:Number)(O)}var n=hi(),i=Symbol("lastResolve"),s=Symbol("lastReject"),o=Symbol("error"),l=Symbol("ended"),d=Symbol("lastPromise"),u=Symbol("handlePromise"),p=Symbol("stream");function h(O,x){return{value:O,done:x}}function v(O){var x=O[i];if(x!==null){var E=O[p].read();E!==null&&(O[d]=null,O[i]=null,O[s]=null,x(h(E,!1)))}}function f(O){Ne.nextTick(v,O)}function m(O,x){return function(E,$){O.then(function(){if(x[l]){E(h(void 0,!0));return}x[u](E,$)},$)}}var g=Object.getPrototypeOf(function(){}),b=Object.setPrototypeOf((e={get stream(){return this[p]},next:function(){var O=this,x=this[o];if(x!==null)return Promise.reject(x);if(this[l])return Promise.resolve(h(void 0,!0));if(this[p].destroyed)return new Promise(function(R,D){Ne.nextTick(function(){O[o]?D(O[o]):R(h(void 0,!0))})});var E=this[d],$;if(E)$=new Promise(m(E,this));else{var C=this[p].read();if(C!==null)return Promise.resolve(h(C,!1));$=new Promise(this[u])}return this[d]=$,$}},r(e,Symbol.asyncIterator,function(){return this}),r(e,"return",function(){var O=this;return new Promise(function(x,E){O[p].destroy(null,function($){if($){E($);return}x(h(void 0,!0))})})}),e),g),S=function(O){var x,E=Object.create(b,(x={},r(x,p,{value:O,writable:!0}),r(x,i,{value:null,writable:!0}),r(x,s,{value:null,writable:!0}),r(x,o,{value:null,writable:!0}),r(x,l,{value:O._readableState.endEmitted,writable:!0}),r(x,u,{value:function($,C){var R=E[p].read();R?(E[d]=null,E[i]=null,E[s]=null,$(h(R,!1))):(E[i]=$,E[s]=C)},writable:!0}),x));return E[d]=null,n(O,function($){if($&&$.code!=="ERR_STREAM_PREMATURE_CLOSE"){var C=E[s];C!==null&&(E[d]=null,E[i]=null,E[s]=null,C($)),E[o]=$;return}var R=E[i];R!==null&&(E[d]=null,E[i]=null,E[s]=null,R(h(void 0,!0))),E[l]=!0}),O.on("readable",f.bind(null,E)),E};return pi=S,pi}var Eu,ku;function v_(){return ku||(ku=1,Eu=function(){throw new Error("Readable.from is not available in the browser")}),Eu}var mi,Pu;function Nu(){if(Pu)return mi;Pu=1,mi=D;var e;D.ReadableState=R,jo().EventEmitter;var r=function(j,k){return j.listeners(k).length},a=hu(),t=So().Buffer,n=(typeof Zr<"u"?Zr:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function i(j){return t.from(j)}function s(j){return t.isBuffer(j)||j instanceof n}var o=gr,l;o&&o.debuglog?l=o.debuglog("stream"):l=function(){};var d=p_(),u=fu(),p=yu(),h=p.getHighWaterMark,v=na().codes,f=v.ERR_INVALID_ARG_TYPE,m=v.ERR_STREAM_PUSH_AFTER_EOF,g=v.ERR_METHOD_NOT_IMPLEMENTED,b=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,S,O,x;ka()(D,a);var E=u.errorOrDestroy,$=["error","close","destroy","pause","resume"];function C(j,k,q){if(typeof j.prependListener=="function")return j.prependListener(k,q);!j._events||!j._events[k]?j.on(k,q):Array.isArray(j._events[k])?j._events[k].unshift(q):j._events[k]=[q,j._events[k]]}function R(j,k,q){e=e||sa(),j=j||{},typeof q!="boolean"&&(q=k instanceof e),this.objectMode=!!j.objectMode,q&&(this.objectMode=this.objectMode||!!j.readableObjectMode),this.highWaterMark=h(this,j,"readableHighWaterMark",q),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=j.emitClose!==!1,this.autoDestroy=!!j.autoDestroy,this.destroyed=!1,this.defaultEncoding=j.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,j.encoding&&(S||(S=Dh().StringDecoder),this.decoder=new S(j.encoding),this.encoding=j.encoding)}function D(j){if(e=e||sa(),!(this instanceof D))return new D(j);var k=this instanceof e;this._readableState=new R(j,this,k),this.readable=!0,j&&(typeof j.read=="function"&&(this._read=j.read),typeof j.destroy=="function"&&(this._destroy=j.destroy)),a.call(this)}Object.defineProperty(D.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(j){this._readableState&&(this._readableState.destroyed=j)}}),D.prototype.destroy=u.destroy,D.prototype._undestroy=u.undestroy,D.prototype._destroy=function(j,k){k(j)},D.prototype.push=function(j,k){var q=this._readableState,K;return q.objectMode?K=!0:typeof j=="string"&&(k=k||q.defaultEncoding,k!==q.encoding&&(j=t.from(j,k),k=""),K=!0),L(this,j,k,!1,K)},D.prototype.unshift=function(j){return L(this,j,null,!0,!1)};function L(j,k,q,K,xe){l("readableAddChunk",k);var ce=j._readableState;if(k===null)ce.reading=!1,ee(j,ce);else{var pe;if(xe||(pe=z(ce,k)),pe)E(j,pe);else if(ce.objectMode||k&&k.length>0)if(typeof k!="string"&&!ce.objectMode&&Object.getPrototypeOf(k)!==t.prototype&&(k=i(k)),K)ce.endEmitted?E(j,new b):T(j,ce,k,!0);else if(ce.ended)E(j,new m);else{if(ce.destroyed)return!1;ce.reading=!1,ce.decoder&&!q?(k=ce.decoder.write(k),ce.objectMode||k.length!==0?T(j,ce,k,!1):ie(j,ce)):T(j,ce,k,!1)}else K||(ce.reading=!1,ie(j,ce))}return!ce.ended&&(ce.length<ce.highWaterMark||ce.length===0)}function T(j,k,q,K){k.flowing&&k.length===0&&!k.sync?(k.awaitDrain=0,j.emit("data",q)):(k.length+=k.objectMode?1:q.length,K?k.buffer.unshift(q):k.buffer.push(q),k.needReadable&&J(j)),ie(j,k)}function z(j,k){var q;return!s(k)&&typeof k!="string"&&k!==void 0&&!j.objectMode&&(q=new f("chunk",["string","Buffer","Uint8Array"],k)),q}D.prototype.isPaused=function(){return this._readableState.flowing===!1},D.prototype.setEncoding=function(j){S||(S=Dh().StringDecoder);var k=new S(j);this._readableState.decoder=k,this._readableState.encoding=this._readableState.decoder.encoding;for(var q=this._readableState.buffer.head,K="";q!==null;)K+=k.write(q.data),q=q.next;return this._readableState.buffer.clear(),K!==""&&this._readableState.buffer.push(K),this._readableState.length=K.length,this};var M=1073741824;function H(j){return j>=M?j=M:(j--,j|=j>>>1,j|=j>>>2,j|=j>>>4,j|=j>>>8,j|=j>>>16,j++),j}function B(j,k){return j<=0||k.length===0&&k.ended?0:k.objectMode?1:j!==j?k.flowing&&k.length?k.buffer.head.data.length:k.length:(j>k.highWaterMark&&(k.highWaterMark=H(j)),j<=k.length?j:k.ended?k.length:(k.needReadable=!0,0))}D.prototype.read=function(j){l("read",j),j=parseInt(j,10);var k=this._readableState,q=j;if(j!==0&&(k.emittedReadable=!1),j===0&&k.needReadable&&((k.highWaterMark!==0?k.length>=k.highWaterMark:k.length>0)||k.ended))return l("read: emitReadable",k.length,k.ended),k.length===0&&k.ended?F(this):J(this),null;if(j=B(j,k),j===0&&k.ended)return k.length===0&&F(this),null;var K=k.needReadable;l("need readable",K),(k.length===0||k.length-j<k.highWaterMark)&&(K=!0,l("length less than watermark",K)),k.ended||k.reading?(K=!1,l("reading or ended",K)):K&&(l("do read"),k.reading=!0,k.sync=!0,k.length===0&&(k.needReadable=!0),this._read(k.highWaterMark),k.sync=!1,k.reading||(j=B(q,k)));var xe;return j>0?xe=P(j,k):xe=null,xe===null?(k.needReadable=k.length<=k.highWaterMark,j=0):(k.length-=j,k.awaitDrain=0),k.length===0&&(k.ended||(k.needReadable=!0),q!==j&&k.ended&&F(this)),xe!==null&&this.emit("data",xe),xe};function ee(j,k){if(l("onEofChunk"),!k.ended){if(k.decoder){var q=k.decoder.end();q&&q.length&&(k.buffer.push(q),k.length+=k.objectMode?1:q.length)}k.ended=!0,k.sync?J(j):(k.needReadable=!1,k.emittedReadable||(k.emittedReadable=!0,se(j)))}}function J(j){var k=j._readableState;l("emitReadable",k.needReadable,k.emittedReadable),k.needReadable=!1,k.emittedReadable||(l("emitReadable",k.flowing),k.emittedReadable=!0,Ne.nextTick(se,j))}function se(j){var k=j._readableState;l("emitReadable_",k.destroyed,k.length,k.ended),!k.destroyed&&(k.length||k.ended)&&(j.emit("readable"),k.emittedReadable=!1),k.needReadable=!k.flowing&&!k.ended&&k.length<=k.highWaterMark,_(j)}function ie(j,k){k.readingMore||(k.readingMore=!0,Ne.nextTick(ke,j,k))}function ke(j,k){for(;!k.reading&&!k.ended&&(k.length<k.highWaterMark||k.flowing&&k.length===0);){var q=k.length;if(l("maybeReadMore read 0"),j.read(0),q===k.length)break}k.readingMore=!1}D.prototype._read=function(j){E(this,new g("_read()"))},D.prototype.pipe=function(j,k){var q=this,K=this._readableState;switch(K.pipesCount){case 0:K.pipes=j;break;case 1:K.pipes=[K.pipes,j];break;default:K.pipes.push(j);break}K.pipesCount+=1,l("pipe count=%d opts=%j",K.pipesCount,k);var xe=(!k||k.end!==!1)&&j!==Ne.stdout&&j!==Ne.stderr,ce=xe?Le:ne;K.endEmitted?Ne.nextTick(ce):q.once("end",ce),j.on("unpipe",pe);function pe(_e,ye){l("onunpipe"),_e===q&&ye&&ye.hasUnpiped===!1&&(ye.hasUnpiped=!0,He())}function Le(){l("onend"),j.end()}var ot=Ie(q);j.on("drain",ot);var ae=!1;function He(){l("cleanup"),j.removeListener("close",Se),j.removeListener("finish",oe),j.removeListener("drain",ot),j.removeListener("error",Y),j.removeListener("unpipe",pe),q.removeListener("end",Le),q.removeListener("end",ne),q.removeListener("data",de),ae=!0,K.awaitDrain&&(!j._writableState||j._writableState.needDrain)&&ot()}q.on("data",de);function de(_e){l("ondata");var ye=j.write(_e);l("dest.write",ye),ye===!1&&((K.pipesCount===1&&K.pipes===j||K.pipesCount>1&&U(K.pipes,j)!==-1)&&!ae&&(l("false write response, pause",K.awaitDrain),K.awaitDrain++),q.pause())}function Y(_e){l("onerror",_e),ne(),j.removeListener("error",Y),r(j,"error")===0&&E(j,_e)}C(j,"error",Y);function Se(){j.removeListener("finish",oe),ne()}j.once("close",Se);function oe(){l("onfinish"),j.removeListener("close",Se),ne()}j.once("finish",oe);function ne(){l("unpipe"),q.unpipe(j)}return j.emit("pipe",q),K.flowing||(l("pipe resume"),q.resume()),j};function Ie(j){return function(){var k=j._readableState;l("pipeOnDrain",k.awaitDrain),k.awaitDrain&&k.awaitDrain--,k.awaitDrain===0&&r(j,"data")&&(k.flowing=!0,_(j))}}D.prototype.unpipe=function(j){var k=this._readableState,q={hasUnpiped:!1};if(k.pipesCount===0)return this;if(k.pipesCount===1)return j&&j!==k.pipes?this:(j||(j=k.pipes),k.pipes=null,k.pipesCount=0,k.flowing=!1,j&&j.emit("unpipe",this,q),this);if(!j){var K=k.pipes,xe=k.pipesCount;k.pipes=null,k.pipesCount=0,k.flowing=!1;for(var ce=0;ce<xe;ce++)K[ce].emit("unpipe",this,{hasUnpiped:!1});return this}var pe=U(k.pipes,j);return pe===-1?this:(k.pipes.splice(pe,1),k.pipesCount-=1,k.pipesCount===1&&(k.pipes=k.pipes[0]),j.emit("unpipe",this,q),this)},D.prototype.on=function(j,k){var q=a.prototype.on.call(this,j,k),K=this._readableState;return j==="data"?(K.readableListening=this.listenerCount("readable")>0,K.flowing!==!1&&this.resume()):j==="readable"&&!K.endEmitted&&!K.readableListening&&(K.readableListening=K.needReadable=!0,K.flowing=!1,K.emittedReadable=!1,l("on readable",K.length,K.reading),K.length?J(this):K.reading||Ne.nextTick(te,this)),q},D.prototype.addListener=D.prototype.on,D.prototype.removeListener=function(j,k){var q=a.prototype.removeListener.call(this,j,k);return j==="readable"&&Ne.nextTick(G,this),q},D.prototype.removeAllListeners=function(j){var k=a.prototype.removeAllListeners.apply(this,arguments);return(j==="readable"||j===void 0)&&Ne.nextTick(G,this),k};function G(j){var k=j._readableState;k.readableListening=j.listenerCount("readable")>0,k.resumeScheduled&&!k.paused?k.flowing=!0:j.listenerCount("data")>0&&j.resume()}function te(j){l("readable nexttick read 0"),j.read(0)}D.prototype.resume=function(){var j=this._readableState;return j.flowing||(l("resume"),j.flowing=!j.readableListening,ge(this,j)),j.paused=!1,this};function ge(j,k){k.resumeScheduled||(k.resumeScheduled=!0,Ne.nextTick(re,j,k))}function re(j,k){l("resume",k.reading),k.reading||j.read(0),k.resumeScheduled=!1,j.emit("resume"),_(j),k.flowing&&!k.reading&&j.read(0)}D.prototype.pause=function(){return l("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(l("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function _(j){var k=j._readableState;for(l("flow",k.flowing);k.flowing&&j.read()!==null;);}D.prototype.wrap=function(j){var k=this,q=this._readableState,K=!1;j.on("end",function(){if(l("wrapped end"),q.decoder&&!q.ended){var pe=q.decoder.end();pe&&pe.length&&k.push(pe)}k.push(null)}),j.on("data",function(pe){if(l("wrapped data"),q.decoder&&(pe=q.decoder.write(pe)),!(q.objectMode&&pe==null)&&!(!q.objectMode&&(!pe||!pe.length))){var Le=k.push(pe);Le||(K=!0,j.pause())}});for(var xe in j)this[xe]===void 0&&typeof j[xe]=="function"&&(this[xe]=function(pe){return function(){return j[pe].apply(j,arguments)}}(xe));for(var ce=0;ce<$.length;ce++)j.on($[ce],this.emit.bind(this,$[ce]));return this._read=function(pe){l("wrapped _read",pe),K&&(K=!1,j.resume())},this},typeof Symbol=="function"&&(D.prototype[Symbol.asyncIterator]=function(){return O===void 0&&(O=f_()),O(this)}),Object.defineProperty(D.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(D.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(D.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(j){this._readableState&&(this._readableState.flowing=j)}}),D._fromList=P,Object.defineProperty(D.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function P(j,k){if(k.length===0)return null;var q;return k.objectMode?q=k.buffer.shift():!j||j>=k.length?(k.decoder?q=k.buffer.join(""):k.buffer.length===1?q=k.buffer.first():q=k.buffer.concat(k.length),k.buffer.clear()):q=k.buffer.consume(j,k.decoder),q}function F(j){var k=j._readableState;l("endReadable",k.endEmitted),k.endEmitted||(k.ended=!0,Ne.nextTick(Z,k,j))}function Z(j,k){if(l("endReadableNT",j.endEmitted,j.length),!j.endEmitted&&j.length===0&&(j.endEmitted=!0,k.readable=!1,k.emit("end"),j.autoDestroy)){var q=k._writableState;(!q||q.autoDestroy&&q.finished)&&k.destroy()}}typeof Symbol=="function"&&(D.from=function(j,k){return x===void 0&&(x=v_()),x(D,j,k)});function U(j,k){for(var q=0,K=j.length;q<K;q++)if(j[q]===k)return q;return-1}return mi}var fi,Cu;function $u(){if(Cu)return fi;Cu=1,fi=o;var e=na().codes,r=e.ERR_METHOD_NOT_IMPLEMENTED,a=e.ERR_MULTIPLE_CALLBACK,t=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,n=e.ERR_TRANSFORM_WITH_LENGTH_0,i=sa();ka()(o,i);function s(u,p){var h=this._transformState;h.transforming=!1;var v=h.writecb;if(v===null)return this.emit("error",new a);h.writechunk=null,h.writecb=null,p!=null&&this.push(p),v(u);var f=this._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&this._read(f.highWaterMark)}function o(u){if(!(this instanceof o))return new o(u);i.call(this,u),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,u&&(typeof u.transform=="function"&&(this._transform=u.transform),typeof u.flush=="function"&&(this._flush=u.flush)),this.on("prefinish",l)}function l(){var u=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(p,h){d(u,p,h)}):d(this,null,null)}o.prototype.push=function(u,p){return this._transformState.needTransform=!1,i.prototype.push.call(this,u,p)},o.prototype._transform=function(u,p,h){h(new r("_transform()"))},o.prototype._write=function(u,p,h){var v=this._transformState;if(v.writecb=h,v.writechunk=u,v.writeencoding=p,!v.transforming){var f=this._readableState;(v.needTransform||f.needReadable||f.length<f.highWaterMark)&&this._read(f.highWaterMark)}},o.prototype._read=function(u){var p=this._transformState;p.writechunk!==null&&!p.transforming?(p.transforming=!0,this._transform(p.writechunk,p.writeencoding,p.afterTransform)):p.needTransform=!0},o.prototype._destroy=function(u,p){i.prototype._destroy.call(this,u,function(h){p(h)})};function d(u,p,h){if(p)return u.emit("error",p);if(h!=null&&u.push(h),u._writableState.length)throw new n;if(u._transformState.transforming)throw new t;return u.push(null)}return fi}var vi,Ou;function g_(){if(Ou)return vi;Ou=1,vi=r;var e=$u();ka()(r,e);function r(a){if(!(this instanceof r))return new r(a);e.call(this,a)}return r.prototype._transform=function(a,t,n){n(null,a)},vi}var gi,Tu;function y_(){if(Tu)return gi;Tu=1;var e;function r(h){var v=!1;return function(){v||(v=!0,h.apply(void 0,arguments))}}var a=na().codes,t=a.ERR_MISSING_ARGS,n=a.ERR_STREAM_DESTROYED;function i(h){if(h)throw h}function s(h){return h.setHeader&&typeof h.abort=="function"}function o(h,v,f,m){m=r(m);var g=!1;h.on("close",function(){g=!0}),e===void 0&&(e=hi()),e(h,{readable:v,writable:f},function(S){if(S)return m(S);g=!0,m()});var b=!1;return function(S){if(!g&&!b){if(b=!0,s(h))return h.abort();if(typeof h.destroy=="function")return h.destroy();m(S||new n("pipe"))}}}function l(h){h()}function d(h,v){return h.pipe(v)}function u(h){return!h.length||typeof h[h.length-1]!="function"?i:h.pop()}function p(){for(var h=arguments.length,v=new Array(h),f=0;f<h;f++)v[f]=arguments[f];var m=u(v);if(Array.isArray(v[0])&&(v=v[0]),v.length<2)throw new t("streams");var g,b=v.map(function(S,O){var x=O<v.length-1,E=O>0;return o(S,x,E,function($){g||(g=$),$&&b.forEach(l),!x&&(b.forEach(l),m(g))})});return v.reduce(d)}return gi=p,gi}var yi,Iu;function __(){if(Iu)return yi;Iu=1,yi=a;var e=jo().EventEmitter,r=ka();r(a,e),a.Readable=Nu(),a.Writable=bu(),a.Duplex=sa(),a.Transform=$u(),a.PassThrough=g_(),a.finished=hi(),a.pipeline=y_(),a.Stream=a;function a(){e.call(this)}return a.prototype.pipe=function(t,n){var i=this;function s(v){t.writable&&t.write(v)===!1&&i.pause&&i.pause()}i.on("data",s);function o(){i.readable&&i.resume&&i.resume()}t.on("drain",o),!t._isStdio&&(!n||n.end!==!1)&&(i.on("end",d),i.on("close",u));var l=!1;function d(){l||(l=!0,t.end())}function u(){l||(l=!0,typeof t.destroy=="function"&&t.destroy())}function p(v){if(h(),e.listenerCount(this,"error")===0)throw v}i.on("error",p),t.on("error",p);function h(){i.removeListener("data",s),t.removeListener("drain",o),i.removeListener("end",d),i.removeListener("close",u),i.removeListener("error",p),t.removeListener("error",p),i.removeListener("end",h),i.removeListener("close",h),t.removeListener("close",h)}return i.on("end",h),i.on("close",h),t.on("close",h),t.emit("pipe",i),t},yi}var w_=__();class b_{append(r){this._buffer=this._buffer?Fh.concat([this._buffer,r]):r}readMessage(){if(!this._buffer)return null;const r=this._buffer.indexOf(`
`);if(r===-1)return null;const a=this._buffer.toString("utf8",0,r).replace(/\r$/,"");return this._buffer=this._buffer.subarray(r+1),x_(a)}clear(){this._buffer=void 0}}function x_(e){return Aa.parse(JSON.parse(e))}function j_(e){return JSON.stringify(e)+`
`}const S_=as.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function E_(){const e={};for(const r of S_){const a=as.env[r];a!==void 0&&(a.startsWith("()")||(e[r]=a))}return e}class k_{constructor(r){this._abortController=new AbortController,this._readBuffer=new b_,this._stderrStream=null,this._serverParams=r,(r.stderr==="pipe"||r.stderr==="overlapped")&&(this._stderrStream=new w_.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((r,a)=>{var t,n,i,s,o;this._process=h_(this._serverParams.command,(t=this._serverParams.args)!==null&&t!==void 0?t:[],{env:{...E_(),...this._serverParams.env},stdio:["pipe","pipe",(n=this._serverParams.stderr)!==null&&n!==void 0?n:"inherit"],shell:!1,signal:this._abortController.signal,windowsHide:as.platform==="win32"&&P_(),cwd:this._serverParams.cwd}),this._process.on("error",l=>{var d,u;if(l.name==="AbortError"){(d=this.onclose)===null||d===void 0||d.call(this);return}a(l),(u=this.onerror)===null||u===void 0||u.call(this,l)}),this._process.on("spawn",()=>{r()}),this._process.on("close",l=>{var d;this._process=void 0,(d=this.onclose)===null||d===void 0||d.call(this)}),(i=this._process.stdin)===null||i===void 0||i.on("error",l=>{var d;(d=this.onerror)===null||d===void 0||d.call(this,l)}),(s=this._process.stdout)===null||s===void 0||s.on("data",l=>{this._readBuffer.append(l),this.processReadBuffer()}),(o=this._process.stdout)===null||o===void 0||o.on("error",l=>{var d;(d=this.onerror)===null||d===void 0||d.call(this,l)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){var r,a;return this._stderrStream?this._stderrStream:(a=(r=this._process)===null||r===void 0?void 0:r.stderr)!==null&&a!==void 0?a:null}get pid(){var r,a;return(a=(r=this._process)===null||r===void 0?void 0:r.pid)!==null&&a!==void 0?a:null}processReadBuffer(){for(var r,a;;)try{const t=this._readBuffer.readMessage();if(t===null)break;(r=this.onmessage)===null||r===void 0||r.call(this,t)}catch(t){(a=this.onerror)===null||a===void 0||a.call(this,t)}}async close(){this._abortController.abort(),this._process=void 0,this._readBuffer.clear()}send(r){return new Promise(a=>{var t;if(!(!((t=this._process)===null||t===void 0)&&t.stdin))throw new Error("Not connected");const n=j_(r);this._process.stdin.write(n)?a():this._process.stdin.once("drain",a)})}}function P_(){return"type"in as}class Lu extends Error{constructor(r,a){super(r),this.name="ParseError",this.type=a.type,this.field=a.field,this.value=a.value,this.line=a.line}}function _i(e){}function N_(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:r=_i,onError:a=_i,onRetry:t=_i,onComment:n}=e;let i="",s=!0,o,l="",d="";function u(m){const g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[b,S]=C_(`${i}${g}`);for(const O of b)p(O);i=S,s=!1}function p(m){if(m===""){v();return}if(m.startsWith(":")){n&&n(m.slice(m.startsWith(": ")?2:1));return}const g=m.indexOf(":");if(g!==-1){const b=m.slice(0,g),S=m[g+1]===" "?2:1,O=m.slice(g+S);h(b,O,m);return}h(m,"",m)}function h(m,g,b){switch(m){case"event":d=g;break;case"data":l=`${l}${g}
`;break;case"id":o=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?t(parseInt(g,10)):a(new Lu(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:b}));break;default:a(new Lu(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:b}));break}}function v(){l.length>0&&r({id:o,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",d=""}function f(m={}){i&&m.consume&&p(i),s=!0,o=void 0,l="",d="",i=""}return{feed:u,reset:f}}function C_(e){const r=[];let a="",t=0;for(;t<e.length;){const n=e.indexOf("\r",t),i=e.indexOf(`
`,t);let s=-1;if(n!==-1&&i!==-1?s=Math.min(n,i):n!==-1?s=n:i!==-1&&(s=i),s===-1){a=e.slice(t);break}else{const o=e.slice(t,s);r.push(o),t=s+1,e[t-1]==="\r"&&e[t]===`
`&&t++}}return[r,a]}class Au extends Event{constructor(r,a){var t,n;super(r),this.code=(t=a==null?void 0:a.code)!=null?t:void 0,this.message=(n=a==null?void 0:a.message)!=null?n:void 0}[Symbol.for("nodejs.util.inspect.custom")](r,a,t){return t(Ru(this),a)}[Symbol.for("Deno.customInspect")](r,a){return r(Ru(this),a)}}function $_(e){const r=globalThis.DOMException;return typeof r=="function"?new r(e,"SyntaxError"):new SyntaxError(e)}function wi(e){return e instanceof Error?"errors"in e&&Array.isArray(e.errors)?e.errors.map(wi).join(", "):"cause"in e&&e.cause instanceof Error?`${e}: ${wi(e.cause)}`:e.message:`${e}`}function Ru(e){return{type:e.type,message:e.message,code:e.code,defaultPrevented:e.defaultPrevented,cancelable:e.cancelable,timeStamp:e.timeStamp}}var Fu=e=>{throw TypeError(e)},bi=(e,r,a)=>r.has(e)||Fu("Cannot "+a),Ae=(e,r,a)=>(bi(e,r,"read from private field"),a?a.call(e):r.get(e)),it=(e,r,a)=>r.has(e)?Fu("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,a),Qe=(e,r,a,t)=>(bi(e,r,"write to private field"),r.set(e,a),a),dr=(e,r,a)=>(bi(e,r,"access private method"),a),kt,Mr,ia,En,kn,Fa,oa,Da,br,la,ca,da,Ma,qt,xi,ji,Si,Du,Ei,ki,za,Pi,Ni;class Pn extends EventTarget{constructor(r,a){var t,n;super(),it(this,qt),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,it(this,kt),it(this,Mr),it(this,ia),it(this,En),it(this,kn),it(this,Fa),it(this,oa),it(this,Da,null),it(this,br),it(this,la),it(this,ca,null),it(this,da,null),it(this,Ma,null),it(this,ji,async i=>{var s;Ae(this,la).reset();const{body:o,redirected:l,status:d,headers:u}=i;if(d===204){dr(this,qt,za).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(l?Qe(this,ia,new URL(i.url)):Qe(this,ia,void 0),d!==200){dr(this,qt,za).call(this,`Non-200 status code (${d})`,d);return}if(!(u.get("content-type")||"").startsWith("text/event-stream")){dr(this,qt,za).call(this,'Invalid content type, expected "text/event-stream"',d);return}if(Ae(this,kt)===this.CLOSED)return;Qe(this,kt,this.OPEN);const p=new Event("open");if((s=Ae(this,Ma))==null||s.call(this,p),this.dispatchEvent(p),typeof o!="object"||!o||!("getReader"in o)){dr(this,qt,za).call(this,"Invalid response body, expected a web ReadableStream",d),this.close();return}const h=new TextDecoder,v=o.getReader();let f=!0;do{const{done:m,value:g}=await v.read();g&&Ae(this,la).feed(h.decode(g,{stream:!m})),m&&(f=!1,Ae(this,la).reset(),dr(this,qt,Pi).call(this))}while(f)}),it(this,Si,i=>{Qe(this,br,void 0),!(i.name==="AbortError"||i.type==="aborted")&&dr(this,qt,Pi).call(this,wi(i))}),it(this,Ei,i=>{typeof i.id=="string"&&Qe(this,Da,i.id);const s=new MessageEvent(i.event||"message",{data:i.data,origin:Ae(this,ia)?Ae(this,ia).origin:Ae(this,Mr).origin,lastEventId:i.id||""});Ae(this,da)&&(!i.event||i.event==="message")&&Ae(this,da).call(this,s),this.dispatchEvent(s)}),it(this,ki,i=>{Qe(this,Fa,i)}),it(this,Ni,()=>{Qe(this,oa,void 0),Ae(this,kt)===this.CONNECTING&&dr(this,qt,xi).call(this)});try{if(r instanceof URL)Qe(this,Mr,r);else if(typeof r=="string")Qe(this,Mr,new URL(r,O_()));else throw new Error("Invalid URL")}catch{throw $_("An invalid or illegal string was specified")}Qe(this,la,N_({onEvent:Ae(this,Ei),onRetry:Ae(this,ki)})),Qe(this,kt,this.CONNECTING),Qe(this,Fa,3e3),Qe(this,kn,(t=a==null?void 0:a.fetch)!=null?t:globalThis.fetch),Qe(this,En,(n=a==null?void 0:a.withCredentials)!=null?n:!1),dr(this,qt,xi).call(this)}get readyState(){return Ae(this,kt)}get url(){return Ae(this,Mr).href}get withCredentials(){return Ae(this,En)}get onerror(){return Ae(this,ca)}set onerror(r){Qe(this,ca,r)}get onmessage(){return Ae(this,da)}set onmessage(r){Qe(this,da,r)}get onopen(){return Ae(this,Ma)}set onopen(r){Qe(this,Ma,r)}addEventListener(r,a,t){const n=a;super.addEventListener(r,n,t)}removeEventListener(r,a,t){const n=a;super.removeEventListener(r,n,t)}close(){Ae(this,oa)&&clearTimeout(Ae(this,oa)),Ae(this,kt)!==this.CLOSED&&(Ae(this,br)&&Ae(this,br).abort(),Qe(this,kt,this.CLOSED),Qe(this,br,void 0))}}kt=new WeakMap,Mr=new WeakMap,ia=new WeakMap,En=new WeakMap,kn=new WeakMap,Fa=new WeakMap,oa=new WeakMap,Da=new WeakMap,br=new WeakMap,la=new WeakMap,ca=new WeakMap,da=new WeakMap,Ma=new WeakMap,qt=new WeakSet,xi=function(){Qe(this,kt,this.CONNECTING),Qe(this,br,new AbortController),Ae(this,kn)(Ae(this,Mr),dr(this,qt,Du).call(this)).then(Ae(this,ji)).catch(Ae(this,Si))},ji=new WeakMap,Si=new WeakMap,Du=function(){var e;const r={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...Ae(this,Da)?{"Last-Event-ID":Ae(this,Da)}:void 0},cache:"no-store",signal:(e=Ae(this,br))==null?void 0:e.signal};return"window"in globalThis&&(r.credentials=this.withCredentials?"include":"same-origin"),r},Ei=new WeakMap,ki=new WeakMap,za=function(e,r){var a;Ae(this,kt)!==this.CLOSED&&Qe(this,kt,this.CLOSED);const t=new Au("error",{code:r,message:e});(a=Ae(this,ca))==null||a.call(this,t),this.dispatchEvent(t)},Pi=function(e,r){var a;if(Ae(this,kt)===this.CLOSED)return;Qe(this,kt,this.CONNECTING);const t=new Au("error",{code:r,message:e});(a=Ae(this,ca))==null||a.call(this,t),this.dispatchEvent(t),Qe(this,oa,setTimeout(Ae(this,Ni),Ae(this,Fa)))},Ni=new WeakMap,Pn.CONNECTING=0,Pn.OPEN=1,Pn.CLOSED=2;function O_(){const e="document"in globalThis?globalThis.document:void 0;return e&&typeof e=="object"&&"baseURI"in e&&typeof e.baseURI=="string"?e.baseURI:void 0}let Ci;Ci=globalThis.crypto;async function T_(e){return(await Ci).getRandomValues(new Uint8Array(e))}async function I_(e){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let a="";const t=await T_(e);for(let n=0;n<e;n++){const i=t[n]%r.length;a+=r[i]}return a}async function L_(e){return await I_(e)}async function A_(e){const r=await(await Ci).subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(r))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function R_(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const r=await L_(e),a=await A_(r);return{code_verifier:r,code_challenge:a}}const F_=y.object({resource:y.string().url(),authorization_servers:y.array(y.string().url()).optional(),jwks_uri:y.string().url().optional(),scopes_supported:y.array(y.string()).optional(),bearer_methods_supported:y.array(y.string()).optional(),resource_signing_alg_values_supported:y.array(y.string()).optional(),resource_name:y.string().optional(),resource_documentation:y.string().optional(),resource_policy_uri:y.string().url().optional(),resource_tos_uri:y.string().url().optional(),tls_client_certificate_bound_access_tokens:y.boolean().optional(),authorization_details_types_supported:y.array(y.string()).optional(),dpop_signing_alg_values_supported:y.array(y.string()).optional(),dpop_bound_access_tokens_required:y.boolean().optional()}).passthrough(),D_=y.object({issuer:y.string(),authorization_endpoint:y.string(),token_endpoint:y.string(),registration_endpoint:y.string().optional(),scopes_supported:y.array(y.string()).optional(),response_types_supported:y.array(y.string()),response_modes_supported:y.array(y.string()).optional(),grant_types_supported:y.array(y.string()).optional(),token_endpoint_auth_methods_supported:y.array(y.string()).optional(),token_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),service_documentation:y.string().optional(),revocation_endpoint:y.string().optional(),revocation_endpoint_auth_methods_supported:y.array(y.string()).optional(),revocation_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),introspection_endpoint:y.string().optional(),introspection_endpoint_auth_methods_supported:y.array(y.string()).optional(),introspection_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),code_challenge_methods_supported:y.array(y.string()).optional()}).passthrough(),Mu=y.object({access_token:y.string(),id_token:y.string().optional(),token_type:y.string(),expires_in:y.number().optional(),scope:y.string().optional(),refresh_token:y.string().optional()}).strip(),M_=y.object({error:y.string(),error_description:y.string().optional(),error_uri:y.string().optional()}),z_=y.object({redirect_uris:y.array(y.string()).refine(e=>e.every(r=>URL.canParse(r)),{message:"redirect_uris must contain valid URLs"}),token_endpoint_auth_method:y.string().optional(),grant_types:y.array(y.string()).optional(),response_types:y.array(y.string()).optional(),client_name:y.string().optional(),client_uri:y.string().optional(),logo_uri:y.string().optional(),scope:y.string().optional(),contacts:y.array(y.string()).optional(),tos_uri:y.string().optional(),policy_uri:y.string().optional(),jwks_uri:y.string().optional(),jwks:y.any().optional(),software_id:y.string().optional(),software_version:y.string().optional(),software_statement:y.string().optional()}).strip(),U_=y.object({client_id:y.string(),client_secret:y.string().optional(),client_id_issued_at:y.number().optional(),client_secret_expires_at:y.number().optional()}).strip(),H_=z_.merge(U_);y.object({error:y.string(),error_description:y.string().optional()}).strip(),y.object({token:y.string(),token_type_hint:y.string().optional()}).strip();function q_(e){const r=typeof e=="string"?new URL(e):new URL(e.href);return r.hash="",r}function V_({requestedResource:e,configuredResource:r}){const a=typeof e=="string"?new URL(e):new URL(e.href),t=typeof r=="string"?new URL(r):new URL(r.href);if(a.origin!==t.origin||a.pathname.length<t.pathname.length)return!1;const n=a.pathname.endsWith("/")?a.pathname:a.pathname+"/",i=t.pathname.endsWith("/")?t.pathname:t.pathname+"/";return n.startsWith(i)}class ht extends Error{constructor(r,a){super(r),this.errorUri=a,this.name=this.constructor.name}toResponseObject(){const r={error:this.errorCode,error_description:this.message};return this.errorUri&&(r.error_uri=this.errorUri),r}get errorCode(){return this.constructor.errorCode}}class $i extends ht{}$i.errorCode="invalid_request";class Nn extends ht{}Nn.errorCode="invalid_client";class Cn extends ht{}Cn.errorCode="invalid_grant";class $n extends ht{}$n.errorCode="unauthorized_client";class Oi extends ht{}Oi.errorCode="unsupported_grant_type";class Ti extends ht{}Ti.errorCode="invalid_scope";class Ii extends ht{}Ii.errorCode="access_denied";class ua extends ht{}ua.errorCode="server_error";class Li extends ht{}Li.errorCode="temporarily_unavailable";class Ai extends ht{}Ai.errorCode="unsupported_response_type";class Ri extends ht{}Ri.errorCode="unsupported_token_type";class Fi extends ht{}Fi.errorCode="invalid_token";class Di extends ht{}Di.errorCode="method_not_allowed";class Mi extends ht{}Mi.errorCode="too_many_requests";class zi extends ht{}zi.errorCode="invalid_client_metadata";class Ui extends ht{}Ui.errorCode="insufficient_scope";const B_={[$i.errorCode]:$i,[Nn.errorCode]:Nn,[Cn.errorCode]:Cn,[$n.errorCode]:$n,[Oi.errorCode]:Oi,[Ti.errorCode]:Ti,[Ii.errorCode]:Ii,[ua.errorCode]:ua,[Li.errorCode]:Li,[Ai.errorCode]:Ai,[Ri.errorCode]:Ri,[Fi.errorCode]:Fi,[Di.errorCode]:Di,[Mi.errorCode]:Mi,[zi.errorCode]:zi,[Ui.errorCode]:Ui};class Qt extends Error{constructor(r){super(r??"Unauthorized")}}function zu(e,r){const a=e.client_secret!==void 0;return r.length===0?a?"client_secret_post":"none":a&&r.includes("client_secret_basic")?"client_secret_basic":a&&r.includes("client_secret_post")?"client_secret_post":r.includes("none")?"none":a?"client_secret_post":"none"}function Uu(e,r,a,t){const{client_id:n,client_secret:i}=r;switch(e){case"client_secret_basic":W_(n,i,a);return;case"client_secret_post":Z_(n,i,t);return;case"none":G_(n,t);return;default:throw new Error(`Unsupported client authentication method: ${e}`)}}function W_(e,r,a){if(!r)throw new Error("client_secret_basic authentication requires a client_secret");const t=btoa(`${e}:${r}`);a.set("Authorization",`Basic ${t}`)}function Z_(e,r,a){a.set("client_id",e),r&&a.set("client_secret",r)}function G_(e,r){r.set("client_id",e)}async function Hi(e){const r=e instanceof Response?e.status:void 0,a=e instanceof Response?await e.text():e;try{const t=M_.parse(JSON.parse(a)),{error:n,error_description:i,error_uri:s}=t,o=B_[n]||ua;return new o(i||"",s)}catch(t){const n=`${r?`HTTP ${r}: `:""}Invalid OAuth error response: ${t}. Raw body: ${a}`;return new ua(n)}}async function ha(e,r){var a,t;try{return await qi(e,r)}catch(n){if(n instanceof Nn||n instanceof $n)return await((a=e.invalidateCredentials)===null||a===void 0?void 0:a.call(e,"all")),await qi(e,r);if(n instanceof Cn)return await((t=e.invalidateCredentials)===null||t===void 0?void 0:t.call(e,"tokens")),await qi(e,r);throw n}}async function qi(e,{serverUrl:r,authorizationCode:a,scope:t,resourceMetadataUrl:n,fetchFn:i}){let s,o=r;try{s=await J_(r,{resourceMetadataUrl:n},i),s.authorization_servers&&s.authorization_servers.length>0&&(o=s.authorization_servers[0])}catch{}const l=await Q_(r,e,s),d=await Y_(r,{authorizationServerUrl:o},i);let u=await Promise.resolve(e.clientInformation());if(!u){if(a!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");if(!e.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const m=await a0(o,{metadata:d,clientMetadata:e.clientMetadata});await e.saveClientInformation(m),u=m}if(a!==void 0){const m=await e.codeVerifier(),g=await t0(o,{metadata:d,clientInformation:u,authorizationCode:a,codeVerifier:m,redirectUri:e.redirectUrl,resource:l,addClientAuthentication:e.addClientAuthentication,fetchFn:i});return await e.saveTokens(g),"AUTHORIZED"}const p=await e.tokens();if(p!=null&&p.refresh_token)try{const m=await r0(o,{metadata:d,clientInformation:u,refreshToken:p.refresh_token,resource:l,addClientAuthentication:e.addClientAuthentication});return await e.saveTokens(m),"AUTHORIZED"}catch(m){if(!(!(m instanceof ht)||m instanceof ua))throw m}const h=e.state?await e.state():void 0,{authorizationUrl:v,codeVerifier:f}=await e0(o,{metadata:d,clientInformation:u,state:h,redirectUrl:e.redirectUrl,scope:t||e.clientMetadata.scope,resource:l});return await e.saveCodeVerifier(f),await e.redirectToAuthorization(v),"REDIRECT"}async function Q_(e,r,a){const t=q_(e);if(r.validateResourceURL)return await r.validateResourceURL(t,a==null?void 0:a.resource);if(a){if(!V_({requestedResource:t,configuredResource:a.resource}))throw new Error(`Protected resource ${a.resource} does not match expected ${t} (or origin)`);return new URL(a.resource)}}function Vi(e){const r=e.headers.get("WWW-Authenticate");if(!r)return;const[a,t]=r.split(" ");if(a.toLowerCase()!=="bearer"||!t)return;const n=/resource_metadata="([^"]*)"/.exec(r);if(n)try{return new URL(n[1])}catch{return}}async function J_(e,r,a=fetch){const t=await Vu(e,"oauth-protected-resource",a,{protocolVersion:r==null?void 0:r.protocolVersion,metadataUrl:r==null?void 0:r.resourceMetadataUrl});if(!t||t.status===404)throw new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!t.ok)throw new Error(`HTTP ${t.status} trying to load well-known OAuth protected resource metadata.`);return F_.parse(await t.json())}async function Hu(e,r,a=fetch){try{return await a(e,{headers:r})}catch(t){if(t instanceof TypeError)return r?Hu(e,void 0,a):void 0;throw t}}function K_(e,r){let a=`/.well-known/${e}${r}`;return r.endsWith("/")&&(a=a.slice(0,-1)),a}async function qu(e,r,a=fetch){return await Hu(e,{"MCP-Protocol-Version":r},a)}function X_(e,r){return!e||e.status===404&&r!=="/"}async function Vu(e,r,a,t){var n,i;const s=new URL(e),o=(n=t==null?void 0:t.protocolVersion)!==null&&n!==void 0?n:vn;let l;if(t!=null&&t.metadataUrl)l=new URL(t.metadataUrl);else{const u=K_(r,s.pathname);l=new URL(u,(i=t==null?void 0:t.metadataServerUrl)!==null&&i!==void 0?i:s),l.search=s.search}let d=await qu(l,o,a);if(!(t!=null&&t.metadataUrl)&&X_(d,s.pathname)){const u=new URL(`/.well-known/${r}`,s);d=await qu(u,o,a)}return d}async function Y_(e,{authorizationServerUrl:r,protocolVersion:a}={},t=fetch){typeof e=="string"&&(e=new URL(e)),r||(r=e),typeof r=="string"&&(r=new URL(r)),a??(a=vn);const n=await Vu(r,"oauth-authorization-server",t,{protocolVersion:a,metadataServerUrl:r});if(!(!n||n.status===404)){if(!n.ok)throw new Error(`HTTP ${n.status} trying to load well-known OAuth metadata`);return D_.parse(await n.json())}}async function e0(e,{metadata:r,clientInformation:a,redirectUrl:t,scope:n,state:i,resource:s}){const o="code",l="S256";let d;if(r){if(d=new URL(r.authorization_endpoint),!r.response_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support response type ${o}`);if(!r.code_challenge_methods_supported||!r.code_challenge_methods_supported.includes(l))throw new Error(`Incompatible auth server: does not support code challenge method ${l}`)}else d=new URL("/authorize",e);const u=await R_(),p=u.code_verifier,h=u.code_challenge;return d.searchParams.set("response_type",o),d.searchParams.set("client_id",a.client_id),d.searchParams.set("code_challenge",h),d.searchParams.set("code_challenge_method",l),d.searchParams.set("redirect_uri",String(t)),i&&d.searchParams.set("state",i),n&&d.searchParams.set("scope",n),n!=null&&n.includes("offline_access")&&d.searchParams.append("prompt","consent"),s&&d.searchParams.set("resource",s.href),{authorizationUrl:d,codeVerifier:p}}async function t0(e,{metadata:r,clientInformation:a,authorizationCode:t,codeVerifier:n,redirectUri:i,resource:s,addClientAuthentication:o,fetchFn:l}){var d;const u="authorization_code",p=r!=null&&r.token_endpoint?new URL(r.token_endpoint):new URL("/token",e);if(r!=null&&r.grant_types_supported&&!r.grant_types_supported.includes(u))throw new Error(`Incompatible auth server: does not support grant type ${u}`);const h=new Headers({"Content-Type":"application/x-www-form-urlencoded"}),v=new URLSearchParams({grant_type:u,code:t,code_verifier:n,redirect_uri:String(i)});if(o)o(h,v,e,r);else{const m=(d=r==null?void 0:r.token_endpoint_auth_methods_supported)!==null&&d!==void 0?d:[],g=zu(a,m);Uu(g,a,h,v)}s&&v.set("resource",s.href);const f=await(l??fetch)(p,{method:"POST",headers:h,body:v});if(!f.ok)throw await Hi(f);return Mu.parse(await f.json())}async function r0(e,{metadata:r,clientInformation:a,refreshToken:t,resource:n,addClientAuthentication:i,fetchFn:s}){var o;const l="refresh_token";let d;if(r){if(d=new URL(r.token_endpoint),r.grant_types_supported&&!r.grant_types_supported.includes(l))throw new Error(`Incompatible auth server: does not support grant type ${l}`)}else d=new URL("/token",e);const u=new Headers({"Content-Type":"application/x-www-form-urlencoded"}),p=new URLSearchParams({grant_type:l,refresh_token:t});if(i)i(u,p,e,r);else{const v=(o=r==null?void 0:r.token_endpoint_auth_methods_supported)!==null&&o!==void 0?o:[],f=zu(a,v);Uu(f,a,u,p)}n&&p.set("resource",n.href);const h=await(s??fetch)(d,{method:"POST",headers:u,body:p});if(!h.ok)throw await Hi(h);return Mu.parse({refresh_token:t,...await h.json()})}async function a0(e,{metadata:r,clientMetadata:a,fetchFn:t}){let n;if(r){if(!r.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");n=new URL(r.registration_endpoint)}else n=new URL("/register",e);const i=await(t??fetch)(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)throw await Hi(i);return H_.parse(await i.json())}class n0 extends Error{constructor(r,a,t){super(`SSE error: ${a}`),this.code=r,this.event=t}}class s0{constructor(r,a){this._url=r,this._resourceMetadataUrl=void 0,this._eventSourceInit=a==null?void 0:a.eventSourceInit,this._requestInit=a==null?void 0:a.requestInit,this._authProvider=a==null?void 0:a.authProvider,this._fetch=a==null?void 0:a.fetch}async _authThenStart(){var r;if(!this._authProvider)throw new Qt("No auth provider");let a;try{a=await ha(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})}catch(t){throw(r=this.onerror)===null||r===void 0||r.call(this,t),t}if(a!=="AUTHORIZED")throw new Qt;return await this._startOrAuth()}async _commonHeaders(){var r;const a={};if(this._authProvider){const t=await this._authProvider.tokens();t&&(a.Authorization=`Bearer ${t.access_token}`)}return this._protocolVersion&&(a["mcp-protocol-version"]=this._protocolVersion),new Headers({...a,...(r=this._requestInit)===null||r===void 0?void 0:r.headers})}_startOrAuth(){var r,a,t;const n=(t=(a=(r=this===null||this===void 0?void 0:this._eventSourceInit)===null||r===void 0?void 0:r.fetch)!==null&&a!==void 0?a:this._fetch)!==null&&t!==void 0?t:fetch;return new Promise((i,s)=>{this._eventSource=new Pn(this._url.href,{...this._eventSourceInit,fetch:async(o,l)=>{const d=await this._commonHeaders();d.set("Accept","text/event-stream");const u=await n(o,{...l,headers:d});return u.status===401&&u.headers.has("www-authenticate")&&(this._resourceMetadataUrl=Vi(u)),u}}),this._abortController=new AbortController,this._eventSource.onerror=o=>{var l;if(o.code===401&&this._authProvider){this._authThenStart().then(i,s);return}const d=new n0(o.code,o.message,o);s(d),(l=this.onerror)===null||l===void 0||l.call(this,d)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",o=>{var l;const d=o;try{if(this._endpoint=new URL(d.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(u){s(u),(l=this.onerror)===null||l===void 0||l.call(this,u),this.close();return}i()}),this._eventSource.onmessage=o=>{var l,d;const u=o;let p;try{p=Aa.parse(JSON.parse(u.data))}catch(h){(l=this.onerror)===null||l===void 0||l.call(this,h);return}(d=this.onmessage)===null||d===void 0||d.call(this,p)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(r){if(!this._authProvider)throw new Qt("No auth provider");if(await ha(this._authProvider,{serverUrl:this._url,authorizationCode:r,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Qt("Failed to authorize")}async close(){var r,a,t;(r=this._abortController)===null||r===void 0||r.abort(),(a=this._eventSource)===null||a===void 0||a.close(),(t=this.onclose)===null||t===void 0||t.call(this)}async send(r){var a,t,n;if(!this._endpoint)throw new Error("Not connected");try{const i=await this._commonHeaders();i.set("content-type","application/json");const s={...this._requestInit,method:"POST",headers:i,body:JSON.stringify(r),signal:(a=this._abortController)===null||a===void 0?void 0:a.signal},o=await((t=this._fetch)!==null&&t!==void 0?t:fetch)(this._endpoint,s);if(!o.ok){if(o.status===401&&this._authProvider){if(this._resourceMetadataUrl=Vi(o),await ha(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Qt;return this.send(r)}const l=await o.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${l}`)}}catch(i){throw(n=this.onerror)===null||n===void 0||n.call(this,i),i}}setProtocolVersion(r){this._protocolVersion=r}}const i0={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class Bi extends Error{constructor(r,a){super(`Streamable HTTP error: ${a}`),this.code=r}}class Bu{constructor(r,a){var t;this._url=r,this._resourceMetadataUrl=void 0,this._requestInit=a==null?void 0:a.requestInit,this._authProvider=a==null?void 0:a.authProvider,this._fetch=a==null?void 0:a.fetch,this._sessionId=a==null?void 0:a.sessionId,this._reconnectionOptions=(t=a==null?void 0:a.reconnectionOptions)!==null&&t!==void 0?t:i0}async _authThenStart(){var r;if(!this._authProvider)throw new Qt("No auth provider");let a;try{a=await ha(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})}catch(t){throw(r=this.onerror)===null||r===void 0||r.call(this,t),t}if(a!=="AUTHORIZED")throw new Qt;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){var r;const a={};if(this._authProvider){const n=await this._authProvider.tokens();n&&(a.Authorization=`Bearer ${n.access_token}`)}this._sessionId&&(a["mcp-session-id"]=this._sessionId),this._protocolVersion&&(a["mcp-protocol-version"]=this._protocolVersion);const t=this._normalizeHeaders((r=this._requestInit)===null||r===void 0?void 0:r.headers);return new Headers({...a,...t})}async _startOrAuthSse(r){var a,t,n;const{resumptionToken:i}=r;try{const s=await this._commonHeaders();s.set("Accept","text/event-stream"),i&&s.set("last-event-id",i);const o=await((a=this._fetch)!==null&&a!==void 0?a:fetch)(this._url,{method:"GET",headers:s,signal:(t=this._abortController)===null||t===void 0?void 0:t.signal});if(!o.ok){if(o.status===401&&this._authProvider)return await this._authThenStart();if(o.status===405)return;throw new Bi(o.status,`Failed to open SSE stream: ${o.statusText}`)}this._handleSseStream(o.body,r,!0)}catch(s){throw(n=this.onerror)===null||n===void 0||n.call(this,s),s}}_getNextReconnectionDelay(r){const a=this._reconnectionOptions.initialReconnectionDelay,t=this._reconnectionOptions.reconnectionDelayGrowFactor,n=this._reconnectionOptions.maxReconnectionDelay;return Math.min(a*Math.pow(t,r),n)}_normalizeHeaders(r){return r?r instanceof Headers?Object.fromEntries(r.entries()):Array.isArray(r)?Object.fromEntries(r):{...r}:{}}_scheduleReconnection(r,a=0){var t;const n=this._reconnectionOptions.maxRetries;if(n>0&&a>=n){(t=this.onerror)===null||t===void 0||t.call(this,new Error(`Maximum reconnection attempts (${n}) exceeded.`));return}const i=this._getNextReconnectionDelay(a);setTimeout(()=>{this._startOrAuthSse(r).catch(s=>{var o;(o=this.onerror)===null||o===void 0||o.call(this,new Error(`Failed to reconnect SSE stream: ${s instanceof Error?s.message:String(s)}`)),this._scheduleReconnection(r,a+1)})},i)}_handleSseStream(r,a,t){if(!r)return;const{onresumptiontoken:n,replayMessageId:i}=a;let s;(async()=>{var o,l,d,u;try{const p=r.pipeThrough(new TextDecoderStream).pipeThrough(new Yp).getReader();for(;;){const{value:h,done:v}=await p.read();if(v)break;if(h.id&&(s=h.id,n==null||n(h.id)),!h.event||h.event==="message")try{const f=Aa.parse(JSON.parse(h.data));i!==void 0&&Es(f)&&(f.id=i),(o=this.onmessage)===null||o===void 0||o.call(this,f)}catch(f){(l=this.onerror)===null||l===void 0||l.call(this,f)}}}catch(p){if((d=this.onerror)===null||d===void 0||d.call(this,new Error(`SSE stream disconnected: ${p}`)),t&&this._abortController&&!this._abortController.signal.aborted)try{this._scheduleReconnection({resumptionToken:s,onresumptiontoken:n,replayMessageId:i},0)}catch(h){(u=this.onerror)===null||u===void 0||u.call(this,new Error(`Failed to reconnect: ${h instanceof Error?h.message:String(h)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(r){if(!this._authProvider)throw new Qt("No auth provider");if(await ha(this._authProvider,{serverUrl:this._url,authorizationCode:r,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Qt("Failed to authorize")}async close(){var r,a;(r=this._abortController)===null||r===void 0||r.abort(),(a=this.onclose)===null||a===void 0||a.call(this)}async send(r,a){var t,n,i,s;try{const{resumptionToken:o,onresumptiontoken:l}=a||{};if(o){this._startOrAuthSse({resumptionToken:o,replayMessageId:sc(r)?r.id:void 0}).catch(m=>{var g;return(g=this.onerror)===null||g===void 0?void 0:g.call(this,m)});return}const d=await this._commonHeaders();d.set("content-type","application/json"),d.set("accept","application/json, text/event-stream");const u={...this._requestInit,method:"POST",headers:d,body:JSON.stringify(r),signal:(t=this._abortController)===null||t===void 0?void 0:t.signal},p=await((n=this._fetch)!==null&&n!==void 0?n:fetch)(this._url,u),h=p.headers.get("mcp-session-id");if(h&&(this._sessionId=h),!p.ok){if(p.status===401&&this._authProvider){if(this._resourceMetadataUrl=Vi(p),await ha(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Qt;return this.send(r)}const m=await p.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${p.status}): ${m}`)}if(p.status===202){cg(r)&&this._startOrAuthSse({resumptionToken:void 0}).catch(m=>{var g;return(g=this.onerror)===null||g===void 0?void 0:g.call(this,m)});return}const v=(Array.isArray(r)?r:[r]).filter(m=>"method"in m&&"id"in m&&m.id!==void 0).length>0,f=p.headers.get("content-type");if(v)if(f!=null&&f.includes("text/event-stream"))this._handleSseStream(p.body,{onresumptiontoken:l},!1);else if(f!=null&&f.includes("application/json")){const m=await p.json(),g=Array.isArray(m)?m.map(b=>Aa.parse(b)):[Aa.parse(m)];for(const b of g)(i=this.onmessage)===null||i===void 0||i.call(this,b)}else throw new Bi(-1,`Unexpected content type: ${f}`)}catch(o){throw(s=this.onerror)===null||s===void 0||s.call(this,o),o}}get sessionId(){return this._sessionId}async terminateSession(){var r,a,t;if(this._sessionId)try{const n=await this._commonHeaders(),i={...this._requestInit,method:"DELETE",headers:n,signal:(r=this._abortController)===null||r===void 0?void 0:r.signal},s=await((a=this._fetch)!==null&&a!==void 0?a:fetch)(this._url,i);if(!s.ok&&s.status!==405)throw new Bi(s.status,`Failed to terminate session: ${s.statusText}`);this._sessionId=void 0}catch(n){throw(t=this.onerror)===null||t===void 0||t.call(this,n),n}}setProtocolVersion(r){this._protocolVersion=r}get protocolVersion(){return this._protocolVersion}}var Wi={exports:{}},Zi,Wu;function o0(){if(Wu)return Zi;Wu=1;var e=1e3,r=e*60,a=r*60,t=a*24,n=t*7,i=t*365.25;Zi=function(u,p){p=p||{};var h=typeof u;if(h==="string"&&u.length>0)return s(u);if(h==="number"&&isFinite(u))return p.long?l(u):o(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function s(u){if(u=String(u),!(u.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(p){var h=parseFloat(p[1]),v=(p[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return h*i;case"weeks":case"week":case"w":return h*n;case"days":case"day":case"d":return h*t;case"hours":case"hour":case"hrs":case"hr":case"h":return h*a;case"minutes":case"minute":case"mins":case"min":case"m":return h*r;case"seconds":case"second":case"secs":case"sec":case"s":return h*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function o(u){var p=Math.abs(u);return p>=t?Math.round(u/t)+"d":p>=a?Math.round(u/a)+"h":p>=r?Math.round(u/r)+"m":p>=e?Math.round(u/e)+"s":u+"ms"}function l(u){var p=Math.abs(u);return p>=t?d(u,p,t,"day"):p>=a?d(u,p,a,"hour"):p>=r?d(u,p,r,"minute"):p>=e?d(u,p,e,"second"):u+" ms"}function d(u,p,h,v){var f=p>=h*1.5;return Math.round(u/h)+" "+v+(f?"s":"")}return Zi}var Gi,Zu;function l0(){if(Zu)return Gi;Zu=1;function e(r){t.debug=t,t.default=t,t.coerce=d,t.disable=o,t.enable=i,t.enabled=l,t.humanize=o0(),t.destroy=u,Object.keys(r).forEach(p=>{t[p]=r[p]}),t.names=[],t.skips=[],t.formatters={};function a(p){let h=0;for(let v=0;v<p.length;v++)h=(h<<5)-h+p.charCodeAt(v),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=a;function t(p){let h,v=null,f,m;function g(...b){if(!g.enabled)return;const S=g,O=Number(new Date),x=O-(h||O);S.diff=x,S.prev=h,S.curr=O,h=O,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let E=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,($,C)=>{if($==="%%")return"%";E++;const R=t.formatters[C];if(typeof R=="function"){const D=b[E];$=R.call(S,D),b.splice(E,1),E--}return $}),t.formatArgs.call(S,b),(S.log||t.log).apply(S,b)}return g.namespace=p,g.useColors=t.useColors(),g.color=t.selectColor(p),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>v!==null?v:(f!==t.namespaces&&(f=t.namespaces,m=t.enabled(p)),m),set:b=>{v=b}}),typeof t.init=="function"&&t.init(g),g}function n(p,h){const v=t(this.namespace+(typeof h>"u"?":":h)+p);return v.log=this.log,v}function i(p){t.save(p),t.namespaces=p,t.names=[],t.skips=[];const h=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const v of h)v[0]==="-"?t.skips.push(v.slice(1)):t.names.push(v)}function s(p,h){let v=0,f=0,m=-1,g=0;for(;v<p.length;)if(f<h.length&&(h[f]===p[v]||h[f]==="*"))h[f]==="*"?(m=f,g=v,f++):(v++,f++);else if(m!==-1)f=m+1,g++,v=g;else return!1;for(;f<h.length&&h[f]==="*";)f++;return f===h.length}function o(){const p=[...t.names,...t.skips.map(h=>"-"+h)].join(",");return t.enable(""),p}function l(p){for(const h of t.skips)if(s(p,h))return!1;for(const h of t.names)if(s(p,h))return!0;return!1}function d(p){return p instanceof Error?p.stack||p.message:p}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return Gi=e,Gi}var Gu;function c0(){return Gu||(Gu=1,function(e,r){var a={};r.formatArgs=n,r.save=i,r.load=s,r.useColors=t,r.storage=o(),r.destroy=(()=>{let d=!1;return()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let d;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(d=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(d[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;d.splice(1,0,u,"color: inherit");let p=0,h=0;d[0].replace(/%[a-zA-Z%]/g,v=>{v!=="%%"&&(p++,v==="%c"&&(h=p))}),d.splice(h,0,u)}r.log=console.debug||console.log||(()=>{});function i(d){try{d?r.storage.setItem("debug",d):r.storage.removeItem("debug")}catch{}}function s(){let d;try{d=r.storage.getItem("debug")||r.storage.getItem("DEBUG")}catch{}return!d&&typeof Ne<"u"&&"env"in Ne&&(d=a.DEBUG),d}function o(){try{return localStorage}catch{}}e.exports=l0()(r);const{formatters:l}=e.exports;l.j=function(d){try{return JSON.stringify(d)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}(Wi,Wi.exports)),Wi.exports}var d0=c0();const Qu=xo(d0);var Ue;(function(e){e.assertEqual=n=>{};function r(n){}e.assertIs=r;function a(n){throw new Error}e.assertNever=a,e.arrayToEnum=n=>{const i={};for(const s of n)i[s]=s;return i},e.getValidEnumValues=n=>{const i=e.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(const o of i)s[o]=n[o];return e.objectValues(s)},e.objectValues=n=>e.objectKeys(n).map(function(i){return n[i]}),e.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&i.push(s);return i},e.find=(n,i)=>{for(const s of n)if(i(s))return s},e.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function t(n,i=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}e.joinValues=t,e.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(Ue||(Ue={}));var Ju;(function(e){e.mergeShapes=(r,a)=>({...r,...a})})(Ju||(Ju={}));const he=Ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),xr=e=>{switch(typeof e){case"undefined":return he.undefined;case"string":return he.string;case"number":return Number.isNaN(e)?he.nan:he.number;case"boolean":return he.boolean;case"function":return he.function;case"bigint":return he.bigint;case"symbol":return he.symbol;case"object":return Array.isArray(e)?he.array:e===null?he.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?he.promise:typeof Map<"u"&&e instanceof Map?he.map:typeof Set<"u"&&e instanceof Set?he.set:typeof Date<"u"&&e instanceof Date?he.date:he.object;default:return he.unknown}},X=Ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ur extends Error{get errors(){return this.issues}constructor(r){super(),this.issues=[],this.addIssue=t=>{this.issues=[...this.issues,t]},this.addIssues=(t=[])=>{this.issues=[...this.issues,...t]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=r}format(r){const a=r||function(i){return i.message},t={_errors:[]},n=i=>{for(const s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)t._errors.push(a(s));else{let o=t,l=0;for(;l<s.path.length;){const d=s.path[l];l===s.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(a(s))):o[d]=o[d]||{_errors:[]},o=o[d],l++}}};return n(this),t}static assert(r){if(!(r instanceof ur))throw new Error(`Not a ZodError: ${r}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=a=>a.message){const a={},t=[];for(const n of this.issues)if(n.path.length>0){const i=n.path[0];a[i]=a[i]||[],a[i].push(r(n))}else t.push(r(n));return{formErrors:t,fieldErrors:a}}get formErrors(){return this.flatten()}}ur.create=e=>new ur(e);const Qi=(e,r)=>{let a;switch(e.code){case X.invalid_type:e.received===he.undefined?a="Required":a=`Expected ${e.expected}, received ${e.received}`;break;case X.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(e.expected,Ue.jsonStringifyReplacer)}`;break;case X.unrecognized_keys:a=`Unrecognized key(s) in object: ${Ue.joinValues(e.keys,", ")}`;break;case X.invalid_union:a="Invalid input";break;case X.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${Ue.joinValues(e.options)}`;break;case X.invalid_enum_value:a=`Invalid enum value. Expected ${Ue.joinValues(e.options)}, received '${e.received}'`;break;case X.invalid_arguments:a="Invalid function arguments";break;case X.invalid_return_type:a="Invalid function return type";break;case X.invalid_date:a="Invalid date";break;case X.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(a=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?a=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?a=`Invalid input: must end with "${e.validation.endsWith}"`:Ue.assertNever(e.validation):e.validation!=="regex"?a=`Invalid ${e.validation}`:a="Invalid";break;case X.too_small:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?a=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:a="Invalid input";break;case X.too_big:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?a=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:a="Invalid input";break;case X.custom:a="Invalid input";break;case X.invalid_intersection_types:a="Intersection results could not be merged";break;case X.not_multiple_of:a=`Number must be a multiple of ${e.multipleOf}`;break;case X.not_finite:a="Number must be finite";break;default:a=r.defaultError,Ue.assertNever(e)}return{message:a}};let u0=Qi;function h0(){return u0}const p0=e=>{const{data:r,path:a,errorMaps:t,issueData:n}=e,i=[...a,...n.path||[]],s={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const l=t.filter(d=>!!d).slice().reverse();for(const d of l)o=d(s,{data:r,defaultError:o}).message;return{...n,path:i,message:o}};function le(e,r){const a=h0(),t=p0({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,a,a===Qi?void 0:Qi].filter(n=>!!n)});e.common.issues.push(t)}class wt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,a){const t=[];for(const n of a){if(n.status==="aborted")return Pe;n.status==="dirty"&&r.dirty(),t.push(n.value)}return{status:r.value,value:t}}static async mergeObjectAsync(r,a){const t=[];for(const n of a){const i=await n.key,s=await n.value;t.push({key:i,value:s})}return wt.mergeObjectSync(r,t)}static mergeObjectSync(r,a){const t={};for(const n of a){const{key:i,value:s}=n;if(i.status==="aborted"||s.status==="aborted")return Pe;i.status==="dirty"&&r.dirty(),s.status==="dirty"&&r.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(t[i.value]=s.value)}return{status:r.value,value:t}}}const Pe=Object.freeze({status:"aborted"}),Ji=e=>({status:"dirty",value:e}),Rt=e=>({status:"valid",value:e}),Ku=e=>e.status==="aborted",Xu=e=>e.status==="dirty",pa=e=>e.status==="valid",On=e=>typeof Promise<"u"&&e instanceof Promise;var fe;(function(e){e.errToObj=r=>typeof r=="string"?{message:r}:r||{},e.toString=r=>typeof r=="string"?r:r==null?void 0:r.message})(fe||(fe={}));class Jt{constructor(r,a,t,n){this._cachedPath=[],this.parent=r,this.data=a,this._path=t,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Yu=(e,r)=>{if(pa(r))return{success:!0,data:r.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const a=new ur(e.common.issues);return this._error=a,this._error}}};function Te(e){if(!e)return{};const{errorMap:r,invalid_type_error:a,required_error:t,description:n}=e;if(r&&(a||t))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:n}:{errorMap:(i,s)=>{const{message:o}=e;return i.code==="invalid_enum_value"?{message:o??s.defaultError}:typeof s.data>"u"?{message:o??t??s.defaultError}:i.code!=="invalid_type"?{message:s.defaultError}:{message:o??a??s.defaultError}},description:n}}class Re{get description(){return this._def.description}_getType(r){return xr(r.data)}_getOrReturnCtx(r,a){return a||{common:r.parent.common,data:r.data,parsedType:xr(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new wt,ctx:{common:r.parent.common,data:r.data,parsedType:xr(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){const a=this._parse(r);if(On(a))throw new Error("Synchronous parse encountered promise.");return a}_parseAsync(r){const a=this._parse(r);return Promise.resolve(a)}parse(r,a){const t=this.safeParse(r,a);if(t.success)return t.data;throw t.error}safeParse(r,a){const t={common:{issues:[],async:(a==null?void 0:a.async)??!1,contextualErrorMap:a==null?void 0:a.errorMap},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:xr(r)},n=this._parseSync({data:r,path:t.path,parent:t});return Yu(t,n)}"~validate"(r){var t,n;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:xr(r)};if(!this["~standard"].async)try{const i=this._parseSync({data:r,path:[],parent:a});return pa(i)?{value:i.value}:{issues:a.common.issues}}catch(i){(n=(t=i==null?void 0:i.message)==null?void 0:t.toLowerCase())!=null&&n.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:r,path:[],parent:a}).then(i=>pa(i)?{value:i.value}:{issues:a.common.issues})}async parseAsync(r,a){const t=await this.safeParseAsync(r,a);if(t.success)return t.data;throw t.error}async safeParseAsync(r,a){const t={common:{issues:[],contextualErrorMap:a==null?void 0:a.errorMap,async:!0},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:xr(r)},n=this._parse({data:r,path:t.path,parent:t}),i=await(On(n)?n:Promise.resolve(n));return Yu(t,i)}refine(r,a){const t=n=>typeof a=="string"||typeof a>"u"?{message:a}:typeof a=="function"?a(n):a;return this._refinement((n,i)=>{const s=r(n),o=()=>i.addIssue({code:X.custom,...t(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(l=>l?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(r,a){return this._refinement((t,n)=>r(t)?!0:(n.addIssue(typeof a=="function"?a(t,n):a),!1))}_refinement(r){return new Sr({schema:this,typeName:Ee.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return Er.create(this,this._def)}nullable(){return _a.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Kt.create(this)}promise(){return An.create(this,this._def)}or(r){return Tn.create([this,r],this._def)}and(r){return In.create(this,r,this._def)}transform(r){return new Sr({...Te(this._def),schema:this,typeName:Ee.ZodEffects,effect:{type:"transform",transform:r}})}default(r){const a=typeof r=="function"?r:()=>r;return new co({...Te(this._def),innerType:this,defaultValue:a,typeName:Ee.ZodDefault})}brand(){return new R0({typeName:Ee.ZodBranded,type:this,...Te(this._def)})}catch(r){const a=typeof r=="function"?r:()=>r;return new uo({...Te(this._def),innerType:this,catchValue:a,typeName:Ee.ZodCatch})}describe(r){const a=this.constructor;return new a({...this._def,description:r})}pipe(r){return po.create(this,r)}readonly(){return mo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const m0=/^c[^\s-]{8,}$/i,f0=/^[0-9a-z]+$/,v0=/^[0-9A-HJKMNP-TV-Z]{26}$/i,g0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,y0=/^[a-z0-9_-]{21}$/i,_0=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,w0=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,b0=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,x0="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ki;const j0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,S0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,E0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,k0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,P0=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N0=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,eh="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",C0=new RegExp(`^${eh}$`);function th(e){let r="[0-5]\\d";e.precision?r=`${r}\\.\\d{${e.precision}}`:e.precision==null&&(r=`${r}(\\.\\d+)?`);const a=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${r})${a}`}function $0(e){return new RegExp(`^${th(e)}$`)}function O0(e){let r=`${eh}T${th(e)}`;const a=[];return a.push(e.local?"Z?":"Z"),e.offset&&a.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${a.join("|")})`,new RegExp(`^${r}$`)}function T0(e,r){return!!((r==="v4"||!r)&&j0.test(e)||(r==="v6"||!r)&&E0.test(e))}function I0(e,r){if(!_0.test(e))return!1;try{const[a]=e.split(".");if(!a)return!1;const t=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),n=JSON.parse(atob(t));return!(typeof n!="object"||n===null||"typ"in n&&(n==null?void 0:n.typ)!=="JWT"||!n.alg||r&&n.alg!==r)}catch{return!1}}function L0(e,r){return!!((r==="v4"||!r)&&S0.test(e)||(r==="v6"||!r)&&k0.test(e))}class hr extends Re{_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==he.string){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_type,expected:he.string,received:n.parsedType}),Pe}const a=new wt;let t;for(const n of this._def.checks)if(n.kind==="min")r.data.length<n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")r.data.length>n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){const i=r.data.length>n.value,s=r.data.length<n.value;(i||s)&&(t=this._getOrReturnCtx(r,t),i?le(t,{code:X.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):s&&le(t,{code:X.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")b0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"email",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")Ki||(Ki=new RegExp(x0,"u")),Ki.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"emoji",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")g0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"uuid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")y0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"nanoid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")m0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"cuid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")f0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"cuid2",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")v0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"ulid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(r.data)}catch{t=this._getOrReturnCtx(r,t),le(t,{validation:"url",code:X.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"regex",code:X.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?r.data=r.data.trim():n.kind==="includes"?r.data.includes(n.value,n.position)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?r.data=r.data.toLowerCase():n.kind==="toUpperCase"?r.data=r.data.toUpperCase():n.kind==="startsWith"?r.data.startsWith(n.value)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?r.data.endsWith(n.value)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?O0(n).test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?C0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?$0(n).test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?w0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"duration",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?T0(r.data,n.version)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"ip",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="jwt"?I0(r.data,n.alg)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"jwt",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="cidr"?L0(r.data,n.version)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"cidr",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?P0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"base64",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="base64url"?N0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"base64url",code:X.invalid_string,message:n.message}),a.dirty()):Ue.assertNever(n);return{status:a.value,value:r.data}}_regex(r,a,t){return this.refinement(n=>r.test(n),{validation:a,code:X.invalid_string,...fe.errToObj(t)})}_addCheck(r){return new hr({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...fe.errToObj(r)})}url(r){return this._addCheck({kind:"url",...fe.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...fe.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...fe.errToObj(r)})}nanoid(r){return this._addCheck({kind:"nanoid",...fe.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...fe.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...fe.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...fe.errToObj(r)})}base64(r){return this._addCheck({kind:"base64",...fe.errToObj(r)})}base64url(r){return this._addCheck({kind:"base64url",...fe.errToObj(r)})}jwt(r){return this._addCheck({kind:"jwt",...fe.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...fe.errToObj(r)})}cidr(r){return this._addCheck({kind:"cidr",...fe.errToObj(r)})}datetime(r){return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof(r==null?void 0:r.precision)>"u"?null:r==null?void 0:r.precision,offset:(r==null?void 0:r.offset)??!1,local:(r==null?void 0:r.local)??!1,...fe.errToObj(r==null?void 0:r.message)})}date(r){return this._addCheck({kind:"date",message:r})}time(r){return typeof r=="string"?this._addCheck({kind:"time",precision:null,message:r}):this._addCheck({kind:"time",precision:typeof(r==null?void 0:r.precision)>"u"?null:r==null?void 0:r.precision,...fe.errToObj(r==null?void 0:r.message)})}duration(r){return this._addCheck({kind:"duration",...fe.errToObj(r)})}regex(r,a){return this._addCheck({kind:"regex",regex:r,...fe.errToObj(a)})}includes(r,a){return this._addCheck({kind:"includes",value:r,position:a==null?void 0:a.position,...fe.errToObj(a==null?void 0:a.message)})}startsWith(r,a){return this._addCheck({kind:"startsWith",value:r,...fe.errToObj(a)})}endsWith(r,a){return this._addCheck({kind:"endsWith",value:r,...fe.errToObj(a)})}min(r,a){return this._addCheck({kind:"min",value:r,...fe.errToObj(a)})}max(r,a){return this._addCheck({kind:"max",value:r,...fe.errToObj(a)})}length(r,a){return this._addCheck({kind:"length",value:r,...fe.errToObj(a)})}nonempty(r){return this.min(1,fe.errToObj(r))}trim(){return new hr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new hr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new hr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isDate(){return!!this._def.checks.find(r=>r.kind==="date")}get isTime(){return!!this._def.checks.find(r=>r.kind==="time")}get isDuration(){return!!this._def.checks.find(r=>r.kind==="duration")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(r=>r.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get isCIDR(){return!!this._def.checks.find(r=>r.kind==="cidr")}get isBase64(){return!!this._def.checks.find(r=>r.kind==="base64")}get isBase64url(){return!!this._def.checks.find(r=>r.kind==="base64url")}get minLength(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxLength(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}}hr.create=e=>new hr({checks:[],typeName:Ee.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Te(e)});function A0(e,r){const a=(e.toString().split(".")[1]||"").length,t=(r.toString().split(".")[1]||"").length,n=a>t?a:t,i=Number.parseInt(e.toFixed(n).replace(".","")),s=Number.parseInt(r.toFixed(n).replace(".",""));return i%s/10**n}class ma extends Re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==he.number){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_type,expected:he.number,received:n.parsedType}),Pe}let a;const t=new wt;for(const n of this._def.checks)n.kind==="int"?Ue.isInteger(r.data)||(a=this._getOrReturnCtx(r,a),le(a,{code:X.invalid_type,expected:"integer",received:"float",message:n.message}),t.dirty()):n.kind==="min"?(n.inclusive?r.data<n.value:r.data<=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?r.data>n.value:r.data>=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="multipleOf"?A0(r.data,n.value)!==0&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):n.kind==="finite"?Number.isFinite(r.data)||(a=this._getOrReturnCtx(r,a),le(a,{code:X.not_finite,message:n.message}),t.dirty()):Ue.assertNever(n);return{status:t.value,value:r.data}}gte(r,a){return this.setLimit("min",r,!0,fe.toString(a))}gt(r,a){return this.setLimit("min",r,!1,fe.toString(a))}lte(r,a){return this.setLimit("max",r,!0,fe.toString(a))}lt(r,a){return this.setLimit("max",r,!1,fe.toString(a))}setLimit(r,a,t,n){return new ma({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:t,message:fe.toString(n)}]})}_addCheck(r){return new ma({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:fe.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:fe.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:fe.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:fe.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:fe.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:fe.toString(a)})}finite(r){return this._addCheck({kind:"finite",message:fe.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:fe.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:fe.toString(r)})}get minValue(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&Ue.isInteger(r.value))}get isFinite(){let r=null,a=null;for(const t of this._def.checks){if(t.kind==="finite"||t.kind==="int"||t.kind==="multipleOf")return!0;t.kind==="min"?(a===null||t.value>a)&&(a=t.value):t.kind==="max"&&(r===null||t.value<r)&&(r=t.value)}return Number.isFinite(a)&&Number.isFinite(r)}}ma.create=e=>new ma({checks:[],typeName:Ee.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Te(e)});class fa extends Re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce)try{r.data=BigInt(r.data)}catch{return this._getInvalidInput(r)}if(this._getType(r)!==he.bigint)return this._getInvalidInput(r);let a;const t=new wt;for(const n of this._def.checks)n.kind==="min"?(n.inclusive?r.data<n.value:r.data<=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?r.data>n.value:r.data>=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="multipleOf"?r.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):Ue.assertNever(n);return{status:t.value,value:r.data}}_getInvalidInput(r){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.bigint,received:a.parsedType}),Pe}gte(r,a){return this.setLimit("min",r,!0,fe.toString(a))}gt(r,a){return this.setLimit("min",r,!1,fe.toString(a))}lte(r,a){return this.setLimit("max",r,!0,fe.toString(a))}lt(r,a){return this.setLimit("max",r,!1,fe.toString(a))}setLimit(r,a,t,n){return new fa({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:t,message:fe.toString(n)}]})}_addCheck(r){return new fa({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:fe.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:fe.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:fe.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:fe.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:fe.toString(a)})}get minValue(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}}fa.create=e=>new fa({checks:[],typeName:Ee.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Te(e)});class Xi extends Re{_parse(r){if(this._def.coerce&&(r.data=!!r.data),this._getType(r)!==he.boolean){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.boolean,received:a.parsedType}),Pe}return Rt(r.data)}}Xi.create=e=>new Xi({typeName:Ee.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Te(e)});class Ua extends Re{_parse(r){if(this._def.coerce&&(r.data=new Date(r.data)),this._getType(r)!==he.date){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_type,expected:he.date,received:n.parsedType}),Pe}if(Number.isNaN(r.data.getTime())){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_date}),Pe}const a=new wt;let t;for(const n of this._def.checks)n.kind==="min"?r.data.getTime()<n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?r.data.getTime()>n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):Ue.assertNever(n);return{status:a.value,value:new Date(r.data.getTime())}}_addCheck(r){return new Ua({...this._def,checks:[...this._def.checks,r]})}min(r,a){return this._addCheck({kind:"min",value:r.getTime(),message:fe.toString(a)})}max(r,a){return this._addCheck({kind:"max",value:r.getTime(),message:fe.toString(a)})}get minDate(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r!=null?new Date(r):null}get maxDate(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r!=null?new Date(r):null}}Ua.create=e=>new Ua({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Ee.ZodDate,...Te(e)});class Yi extends Re{_parse(r){if(this._getType(r)!==he.symbol){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.symbol,received:a.parsedType}),Pe}return Rt(r.data)}}Yi.create=e=>new Yi({typeName:Ee.ZodSymbol,...Te(e)});class eo extends Re{_parse(r){if(this._getType(r)!==he.undefined){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.undefined,received:a.parsedType}),Pe}return Rt(r.data)}}eo.create=e=>new eo({typeName:Ee.ZodUndefined,...Te(e)});class to extends Re{_parse(r){if(this._getType(r)!==he.null){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.null,received:a.parsedType}),Pe}return Rt(r.data)}}to.create=e=>new to({typeName:Ee.ZodNull,...Te(e)});class Ha extends Re{constructor(){super(...arguments),this._any=!0}_parse(r){return Rt(r.data)}}Ha.create=e=>new Ha({typeName:Ee.ZodAny,...Te(e)});class ro extends Re{constructor(){super(...arguments),this._unknown=!0}_parse(r){return Rt(r.data)}}ro.create=e=>new ro({typeName:Ee.ZodUnknown,...Te(e)});class jr extends Re{_parse(r){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.never,received:a.parsedType}),Pe}}jr.create=e=>new jr({typeName:Ee.ZodNever,...Te(e)});class ao extends Re{_parse(r){if(this._getType(r)!==he.undefined){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.void,received:a.parsedType}),Pe}return Rt(r.data)}}ao.create=e=>new ao({typeName:Ee.ZodVoid,...Te(e)});class Kt extends Re{_parse(r){const{ctx:a,status:t}=this._processInputParams(r),n=this._def;if(a.parsedType!==he.array)return le(a,{code:X.invalid_type,expected:he.array,received:a.parsedType}),Pe;if(n.exactLength!==null){const s=a.data.length>n.exactLength.value,o=a.data.length<n.exactLength.value;(s||o)&&(le(a,{code:s?X.too_big:X.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),t.dirty())}if(n.minLength!==null&&a.data.length<n.minLength.value&&(le(a,{code:X.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),t.dirty()),n.maxLength!==null&&a.data.length>n.maxLength.value&&(le(a,{code:X.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),t.dirty()),a.common.async)return Promise.all([...a.data].map((s,o)=>n.type._parseAsync(new Jt(a,s,a.path,o)))).then(s=>wt.mergeArray(t,s));const i=[...a.data].map((s,o)=>n.type._parseSync(new Jt(a,s,a.path,o)));return wt.mergeArray(t,i)}get element(){return this._def.type}min(r,a){return new Kt({...this._def,minLength:{value:r,message:fe.toString(a)}})}max(r,a){return new Kt({...this._def,maxLength:{value:r,message:fe.toString(a)}})}length(r,a){return new Kt({...this._def,exactLength:{value:r,message:fe.toString(a)}})}nonempty(r){return this.min(1,r)}}Kt.create=(e,r)=>new Kt({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Ee.ZodArray,...Te(r)});function va(e){if(e instanceof Ye){const r={};for(const a in e.shape){const t=e.shape[a];r[a]=Er.create(va(t))}return new Ye({...e._def,shape:()=>r})}else return e instanceof Kt?new Kt({...e._def,type:va(e.element)}):e instanceof Er?Er.create(va(e.unwrap())):e instanceof _a?_a.create(va(e.unwrap())):e instanceof zr?zr.create(e.items.map(r=>va(r))):e}class Ye extends Re{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const r=this._def.shape(),a=Ue.objectKeys(r);return this._cached={shape:r,keys:a},this._cached}_parse(r){if(this._getType(r)!==he.object){const l=this._getOrReturnCtx(r);return le(l,{code:X.invalid_type,expected:he.object,received:l.parsedType}),Pe}const{status:a,ctx:t}=this._processInputParams(r),{shape:n,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof jr&&this._def.unknownKeys==="strip"))for(const l in t.data)i.includes(l)||s.push(l);const o=[];for(const l of i){const d=n[l],u=t.data[l];o.push({key:{status:"valid",value:l},value:d._parse(new Jt(t,u,t.path,l)),alwaysSet:l in t.data})}if(this._def.catchall instanceof jr){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of s)o.push({key:{status:"valid",value:d},value:{status:"valid",value:t.data[d]}});else if(l==="strict")s.length>0&&(le(t,{code:X.unrecognized_keys,keys:s}),a.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of s){const u=t.data[d];o.push({key:{status:"valid",value:d},value:l._parse(new Jt(t,u,t.path,d)),alwaysSet:d in t.data})}}return t.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of o){const u=await d.key,p=await d.value;l.push({key:u,value:p,alwaysSet:d.alwaysSet})}return l}).then(l=>wt.mergeObjectSync(a,l)):wt.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(r){return fe.errToObj,new Ye({...this._def,unknownKeys:"strict",...r!==void 0?{errorMap:(a,t)=>{var i,s;const n=((s=(i=this._def).errorMap)==null?void 0:s.call(i,a,t).message)??t.defaultError;return a.code==="unrecognized_keys"?{message:fe.errToObj(r).message??n}:{message:n}}}:{}})}strip(){return new Ye({...this._def,unknownKeys:"strip"})}passthrough(){return new Ye({...this._def,unknownKeys:"passthrough"})}extend(r){return new Ye({...this._def,shape:()=>({...this._def.shape(),...r})})}merge(r){return new Ye({unknownKeys:r._def.unknownKeys,catchall:r._def.catchall,shape:()=>({...this._def.shape(),...r._def.shape()}),typeName:Ee.ZodObject})}setKey(r,a){return this.augment({[r]:a})}catchall(r){return new Ye({...this._def,catchall:r})}pick(r){const a={};for(const t of Ue.objectKeys(r))r[t]&&this.shape[t]&&(a[t]=this.shape[t]);return new Ye({...this._def,shape:()=>a})}omit(r){const a={};for(const t of Ue.objectKeys(this.shape))r[t]||(a[t]=this.shape[t]);return new Ye({...this._def,shape:()=>a})}deepPartial(){return va(this)}partial(r){const a={};for(const t of Ue.objectKeys(this.shape)){const n=this.shape[t];r&&!r[t]?a[t]=n:a[t]=n.optional()}return new Ye({...this._def,shape:()=>a})}required(r){const a={};for(const t of Ue.objectKeys(this.shape))if(r&&!r[t])a[t]=this.shape[t];else{let n=this.shape[t];for(;n instanceof Er;)n=n._def.innerType;a[t]=n}return new Ye({...this._def,shape:()=>a})}keyof(){return rh(Ue.objectKeys(this.shape))}}Ye.create=(e,r)=>new Ye({shape:()=>e,unknownKeys:"strip",catchall:jr.create(),typeName:Ee.ZodObject,...Te(r)}),Ye.strictCreate=(e,r)=>new Ye({shape:()=>e,unknownKeys:"strict",catchall:jr.create(),typeName:Ee.ZodObject,...Te(r)}),Ye.lazycreate=(e,r)=>new Ye({shape:e,unknownKeys:"strip",catchall:jr.create(),typeName:Ee.ZodObject,...Te(r)});class Tn extends Re{_parse(r){const{ctx:a}=this._processInputParams(r),t=this._def.options;function n(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return a.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(o=>new ur(o.ctx.common.issues));return le(a,{code:X.invalid_union,unionErrors:s}),Pe}if(a.common.async)return Promise.all(t.map(async i=>{const s={...a,common:{...a.common,issues:[]},parent:null};return{result:await i._parseAsync({data:a.data,path:a.path,parent:s}),ctx:s}})).then(n);{let i;const s=[];for(const l of t){const d={...a,common:{...a.common,issues:[]},parent:null},u=l._parseSync({data:a.data,path:a.path,parent:d});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:d}),d.common.issues.length&&s.push(d.common.issues)}if(i)return a.common.issues.push(...i.ctx.common.issues),i.result;const o=s.map(l=>new ur(l));return le(a,{code:X.invalid_union,unionErrors:o}),Pe}}get options(){return this._def.options}}Tn.create=(e,r)=>new Tn({options:e,typeName:Ee.ZodUnion,...Te(r)});function no(e,r){const a=xr(e),t=xr(r);if(e===r)return{valid:!0,data:e};if(a===he.object&&t===he.object){const n=Ue.objectKeys(r),i=Ue.objectKeys(e).filter(o=>n.indexOf(o)!==-1),s={...e,...r};for(const o of i){const l=no(e[o],r[o]);if(!l.valid)return{valid:!1};s[o]=l.data}return{valid:!0,data:s}}else if(a===he.array&&t===he.array){if(e.length!==r.length)return{valid:!1};const n=[];for(let i=0;i<e.length;i++){const s=e[i],o=r[i],l=no(s,o);if(!l.valid)return{valid:!1};n.push(l.data)}return{valid:!0,data:n}}else return a===he.date&&t===he.date&&+e==+r?{valid:!0,data:e}:{valid:!1}}class In extends Re{_parse(r){const{status:a,ctx:t}=this._processInputParams(r),n=(i,s)=>{if(Ku(i)||Ku(s))return Pe;const o=no(i.value,s.value);return o.valid?((Xu(i)||Xu(s))&&a.dirty(),{status:a.value,value:o.data}):(le(t,{code:X.invalid_intersection_types}),Pe)};return t.common.async?Promise.all([this._def.left._parseAsync({data:t.data,path:t.path,parent:t}),this._def.right._parseAsync({data:t.data,path:t.path,parent:t})]).then(([i,s])=>n(i,s)):n(this._def.left._parseSync({data:t.data,path:t.path,parent:t}),this._def.right._parseSync({data:t.data,path:t.path,parent:t}))}}In.create=(e,r,a)=>new In({left:e,right:r,typeName:Ee.ZodIntersection,...Te(a)});class zr extends Re{_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==he.array)return le(t,{code:X.invalid_type,expected:he.array,received:t.parsedType}),Pe;if(t.data.length<this._def.items.length)return le(t,{code:X.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Pe;!this._def.rest&&t.data.length>this._def.items.length&&(le(t,{code:X.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());const n=[...t.data].map((i,s)=>{const o=this._def.items[s]||this._def.rest;return o?o._parse(new Jt(t,i,t.path,s)):null}).filter(i=>!!i);return t.common.async?Promise.all(n).then(i=>wt.mergeArray(a,i)):wt.mergeArray(a,n)}get items(){return this._def.items}rest(r){return new zr({...this._def,rest:r})}}zr.create=(e,r)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new zr({items:e,typeName:Ee.ZodTuple,rest:null,...Te(r)})};class Ln extends Re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==he.object)return le(t,{code:X.invalid_type,expected:he.object,received:t.parsedType}),Pe;const n=[],i=this._def.keyType,s=this._def.valueType;for(const o in t.data)n.push({key:i._parse(new Jt(t,o,t.path,o)),value:s._parse(new Jt(t,t.data[o],t.path,o)),alwaysSet:o in t.data});return t.common.async?wt.mergeObjectAsync(a,n):wt.mergeObjectSync(a,n)}get element(){return this._def.valueType}static create(r,a,t){return a instanceof Re?new Ln({keyType:r,valueType:a,typeName:Ee.ZodRecord,...Te(t)}):new Ln({keyType:hr.create(),valueType:r,typeName:Ee.ZodRecord,...Te(a)})}}class so extends Re{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==he.map)return le(t,{code:X.invalid_type,expected:he.map,received:t.parsedType}),Pe;const n=this._def.keyType,i=this._def.valueType,s=[...t.data.entries()].map(([o,l],d)=>({key:n._parse(new Jt(t,o,t.path,[d,"key"])),value:i._parse(new Jt(t,l,t.path,[d,"value"]))}));if(t.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of s){const d=await l.key,u=await l.value;if(d.status==="aborted"||u.status==="aborted")return Pe;(d.status==="dirty"||u.status==="dirty")&&a.dirty(),o.set(d.value,u.value)}return{status:a.value,value:o}})}else{const o=new Map;for(const l of s){const d=l.key,u=l.value;if(d.status==="aborted"||u.status==="aborted")return Pe;(d.status==="dirty"||u.status==="dirty")&&a.dirty(),o.set(d.value,u.value)}return{status:a.value,value:o}}}}so.create=(e,r,a)=>new so({valueType:r,keyType:e,typeName:Ee.ZodMap,...Te(a)});class ga extends Re{_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==he.set)return le(t,{code:X.invalid_type,expected:he.set,received:t.parsedType}),Pe;const n=this._def;n.minSize!==null&&t.data.size<n.minSize.value&&(le(t,{code:X.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),a.dirty()),n.maxSize!==null&&t.data.size>n.maxSize.value&&(le(t,{code:X.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),a.dirty());const i=this._def.valueType;function s(l){const d=new Set;for(const u of l){if(u.status==="aborted")return Pe;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}const o=[...t.data.values()].map((l,d)=>i._parse(new Jt(t,l,t.path,d)));return t.common.async?Promise.all(o).then(l=>s(l)):s(o)}min(r,a){return new ga({...this._def,minSize:{value:r,message:fe.toString(a)}})}max(r,a){return new ga({...this._def,maxSize:{value:r,message:fe.toString(a)}})}size(r,a){return this.min(r,a).max(r,a)}nonempty(r){return this.min(1,r)}}ga.create=(e,r)=>new ga({valueType:e,minSize:null,maxSize:null,typeName:Ee.ZodSet,...Te(r)});class io extends Re{get schema(){return this._def.getter()}_parse(r){const{ctx:a}=this._processInputParams(r);return this._def.getter()._parse({data:a.data,path:a.path,parent:a})}}io.create=(e,r)=>new io({getter:e,typeName:Ee.ZodLazy,...Te(r)});class oo extends Re{_parse(r){if(r.data!==this._def.value){const a=this._getOrReturnCtx(r);return le(a,{received:a.data,code:X.invalid_literal,expected:this._def.value}),Pe}return{status:"valid",value:r.data}}get value(){return this._def.value}}oo.create=(e,r)=>new oo({value:e,typeName:Ee.ZodLiteral,...Te(r)});function rh(e,r){return new ya({values:e,typeName:Ee.ZodEnum,...Te(r)})}class ya extends Re{_parse(r){if(typeof r.data!="string"){const a=this._getOrReturnCtx(r),t=this._def.values;return le(a,{expected:Ue.joinValues(t),received:a.parsedType,code:X.invalid_type}),Pe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(r.data)){const a=this._getOrReturnCtx(r),t=this._def.values;return le(a,{received:a.data,code:X.invalid_enum_value,options:t}),Pe}return Rt(r.data)}get options(){return this._def.values}get enum(){const r={};for(const a of this._def.values)r[a]=a;return r}get Values(){const r={};for(const a of this._def.values)r[a]=a;return r}get Enum(){const r={};for(const a of this._def.values)r[a]=a;return r}extract(r,a=this._def){return ya.create(r,{...this._def,...a})}exclude(r,a=this._def){return ya.create(this.options.filter(t=>!r.includes(t)),{...this._def,...a})}}ya.create=rh;class lo extends Re{_parse(r){const a=Ue.getValidEnumValues(this._def.values),t=this._getOrReturnCtx(r);if(t.parsedType!==he.string&&t.parsedType!==he.number){const n=Ue.objectValues(a);return le(t,{expected:Ue.joinValues(n),received:t.parsedType,code:X.invalid_type}),Pe}if(this._cache||(this._cache=new Set(Ue.getValidEnumValues(this._def.values))),!this._cache.has(r.data)){const n=Ue.objectValues(a);return le(t,{received:t.data,code:X.invalid_enum_value,options:n}),Pe}return Rt(r.data)}get enum(){return this._def.values}}lo.create=(e,r)=>new lo({values:e,typeName:Ee.ZodNativeEnum,...Te(r)});class An extends Re{unwrap(){return this._def.type}_parse(r){const{ctx:a}=this._processInputParams(r);if(a.parsedType!==he.promise&&a.common.async===!1)return le(a,{code:X.invalid_type,expected:he.promise,received:a.parsedType}),Pe;const t=a.parsedType===he.promise?a.data:Promise.resolve(a.data);return Rt(t.then(n=>this._def.type.parseAsync(n,{path:a.path,errorMap:a.common.contextualErrorMap})))}}An.create=(e,r)=>new An({type:e,typeName:Ee.ZodPromise,...Te(r)});class Sr extends Re{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ee.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){const{status:a,ctx:t}=this._processInputParams(r),n=this._def.effect||null,i={addIssue:s=>{le(t,s),s.fatal?a.abort():a.dirty()},get path(){return t.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const s=n.transform(t.data,i);if(t.common.async)return Promise.resolve(s).then(async o=>{if(a.value==="aborted")return Pe;const l=await this._def.schema._parseAsync({data:o,path:t.path,parent:t});return l.status==="aborted"?Pe:l.status==="dirty"||a.value==="dirty"?Ji(l.value):l});{if(a.value==="aborted")return Pe;const o=this._def.schema._parseSync({data:s,path:t.path,parent:t});return o.status==="aborted"?Pe:o.status==="dirty"||a.value==="dirty"?Ji(o.value):o}}if(n.type==="refinement"){const s=o=>{const l=n.refinement(o,i);if(t.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(t.common.async===!1){const o=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});return o.status==="aborted"?Pe:(o.status==="dirty"&&a.dirty(),s(o.value),{status:a.value,value:o.value})}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(o=>o.status==="aborted"?Pe:(o.status==="dirty"&&a.dirty(),s(o.value).then(()=>({status:a.value,value:o.value}))))}if(n.type==="transform")if(t.common.async===!1){const s=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});if(!pa(s))return Pe;const o=n.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:a.value,value:o}}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(s=>pa(s)?Promise.resolve(n.transform(s.value,i)).then(o=>({status:a.value,value:o})):Pe);Ue.assertNever(n)}}Sr.create=(e,r,a)=>new Sr({schema:e,typeName:Ee.ZodEffects,effect:r,...Te(a)}),Sr.createWithPreprocess=(e,r,a)=>new Sr({schema:r,effect:{type:"preprocess",transform:e},typeName:Ee.ZodEffects,...Te(a)});class Er extends Re{_parse(r){return this._getType(r)===he.undefined?Rt(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}Er.create=(e,r)=>new Er({innerType:e,typeName:Ee.ZodOptional,...Te(r)});class _a extends Re{_parse(r){return this._getType(r)===he.null?Rt(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}_a.create=(e,r)=>new _a({innerType:e,typeName:Ee.ZodNullable,...Te(r)});class co extends Re{_parse(r){const{ctx:a}=this._processInputParams(r);let t=a.data;return a.parsedType===he.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:a.path,parent:a})}removeDefault(){return this._def.innerType}}co.create=(e,r)=>new co({innerType:e,typeName:Ee.ZodDefault,defaultValue:typeof r.default=="function"?r.default:()=>r.default,...Te(r)});class uo extends Re{_parse(r){const{ctx:a}=this._processInputParams(r),t={...a,common:{...a.common,issues:[]}},n=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return On(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ur(t.common.issues)},input:t.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new ur(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}}uo.create=(e,r)=>new uo({innerType:e,typeName:Ee.ZodCatch,catchValue:typeof r.catch=="function"?r.catch:()=>r.catch,...Te(r)});class ho extends Re{_parse(r){if(this._getType(r)!==he.nan){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:he.nan,received:a.parsedType}),Pe}return{status:"valid",value:r.data}}}ho.create=e=>new ho({typeName:Ee.ZodNaN,...Te(e)});class R0 extends Re{_parse(r){const{ctx:a}=this._processInputParams(r),t=a.data;return this._def.type._parse({data:t,path:a.path,parent:a})}unwrap(){return this._def.type}}class po extends Re{_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.common.async)return(async()=>{const n=await this._def.in._parseAsync({data:t.data,path:t.path,parent:t});return n.status==="aborted"?Pe:n.status==="dirty"?(a.dirty(),Ji(n.value)):this._def.out._parseAsync({data:n.value,path:t.path,parent:t})})();{const n=this._def.in._parseSync({data:t.data,path:t.path,parent:t});return n.status==="aborted"?Pe:n.status==="dirty"?(a.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:t.path,parent:t})}}static create(r,a){return new po({in:r,out:a,typeName:Ee.ZodPipeline})}}class mo extends Re{_parse(r){const a=this._def.innerType._parse(r),t=n=>(pa(n)&&(n.value=Object.freeze(n.value)),n);return On(a)?a.then(n=>t(n)):t(a)}unwrap(){return this._def.innerType}}mo.create=(e,r)=>new mo({innerType:e,typeName:Ee.ZodReadonly,...Te(r)});function ah(e,r){const a=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e;return typeof a=="string"?{message:a}:a}function F0(e,r={},a){return e?Ha.create().superRefine((t,n)=>{const i=e(t);if(i instanceof Promise)return i.then(s=>{if(!s){const o=ah(r,t),l=o.fatal??a??!0;n.addIssue({code:"custom",...o,fatal:l})}});if(!i){const s=ah(r,t),o=s.fatal??a??!0;n.addIssue({code:"custom",...s,fatal:o})}}):Ha.create()}Ye.lazycreate;var Ee;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Ee||(Ee={}));const kr=hr.create,qa=ma.create;ho.create,fa.create;const wa=Xi.create;Ua.create,Yi.create,eo.create,to.create,Ha.create,ro.create,jr.create,ao.create;const D0=Kt.create,Ur=Ye.create;Ye.strictCreate;const Pr=Tn.create;In.create,zr.create;const Rn=Ln.create;so.create,ga.create,io.create;const bt=oo.create;ya.create,lo.create,An.create,Sr.create,Er.create,_a.create,Sr.createWithPreprocess;function M0(e){return typeof e=="object"&&e!==null&&"_def"in e&&e._def.typeName==="ZodObject"}function z0(e){return typeof e=="object"&&e!==null&&"_def"in e&&e._def.typeName==="ZodLiteral"}const U0=bn.shape.content._def.innerType.element,Fn=U0.options.map(e=>{if(M0(e)&&"type"in e.shape&&z0(e.shape.type))return e.shape.type.value;throw new Error("Internal error: Invalid option found in CallToolResultContentSchema's union. Expected ZodObject with ZodLiteral 'type'.")}),H0=Fn.map(e=>bt(e));Pr(H0);const q0=Pr([bt("content").describe("Put tool output into the ToolMessage.content array"),bt("artifact").describe("Put tool output into the ToolMessage.artifact array")]),V0=Ur(Object.fromEntries(Fn.map(e=>[e,Pr([bt("content").describe(`Put all ${e} tool output into the ToolMessage.content array`),bt("artifact").describe(`Put all ${e} tool output into the ToolMessage.artifact array`)]).describe(`Where to place ${e} tool output in the LangChain ToolMessage`).optional()]))),B0=Pr([q0,V0]).describe("Defines where to place each tool output type in the LangChain ToolMessage.\n\nItems in the `content` field will be used as input context for the LLM, while the artifact field is\nused for capturing tool output that won't be shown to the model, to be used in some later workflow\nstep.\n\nFor example, imagine that you have a SQL query tool that can return huge result sets. Rather than\nsending these large outputs directly to the model, perhaps you want the model to be able to inspect\nthe output in a code execution environment. In this case, you would set the output handling for the\n`resource` type to `artifact` (it's default value), and then upon initialization of your code\nexecution environment, you would look through your message history for `ToolMessage`s with the\n`artifact` field set to `resource`, and use the `content` field during initialization of the\nenvironment."),W0=F0(e=>{if(!e||typeof e!="object")return!1;const r=["redirectUrl","clientMetadata","clientInformation","tokens","saveTokens"];if(!("redirectUrl"in e)||!("clientMetadata"in e))return!1;for(const a of r)if(!(a in e))return!1;return!0},{message:"Must be a valid OAuthClientProvider implementation with required properties: redirectUrl, clientMetadata, clientInformation, tokens, saveTokens"}),fo=Ur({outputHandling:B0.optional(),defaultToolTimeout:qa().min(1).optional()}),Z0=Ur({enabled:wa().describe("Whether to automatically restart the process if it exits").optional(),maxAttempts:qa().describe("The maximum number of restart attempts").optional(),delayMs:qa().describe("The delay in milliseconds between restart attempts").optional()}).describe("Configuration for stdio transport restart"),G0=Ur({transport:bt("stdio").optional(),type:bt("stdio").optional(),command:kr().describe("The executable to run the server"),args:D0(kr()).describe("Command line arguments to pass to the executable"),env:Rn(kr()).describe("The environment to use when spawning the process").optional(),encoding:kr().describe("The encoding to use when reading from the process").optional(),stderr:Pr([bt("overlapped"),bt("pipe"),bt("ignore"),bt("inherit")]).describe("How to handle stderr of the child process. This matches the semantics of Node's `child_process.spawn`").optional().default("inherit"),cwd:kr().describe("The working directory to use when spawning the process").optional(),restart:Z0.optional()}).and(fo).describe("Configuration for stdio transport connection"),Q0=Ur({enabled:wa().describe("Whether to automatically reconnect if the connection is lost").optional(),maxAttempts:qa().describe("The maximum number of reconnection attempts").optional(),delayMs:qa().describe("The delay in milliseconds between reconnection attempts").optional()}).describe("Configuration for streamable HTTP transport reconnection"),J0=Ur({transport:Pr([bt("http"),bt("sse")]).optional(),type:Pr([bt("http"),bt("sse")]).optional(),url:kr().url(),headers:Rn(kr()).optional(),authProvider:W0.optional(),reconnect:Q0.optional(),automaticSSEFallback:wa().optional().default(!0)}).and(fo).describe("Configuration for streamable HTTP transport connection"),nh=Pr([G0,J0]).describe("Configuration for a single MCP server"),K0=Ur({mcpServers:Rn(nh).describe("A map of server names to their configuration"),throwOnLoadError:wa().describe("Whether to throw an error if a tool fails to load").optional().default(!0),prefixToolNameWithServerName:wa().describe("Whether to prefix tool names with the server name").optional().default(!1),additionalToolNamePrefix:kr().describe("An additional prefix to add to the tool name").optional().default(""),useStandardContentBlocks:wa().describe("If true, the tool will use LangChain's standard multimodal content blocks for tools that output\nimage or audio content. When true, embedded resources will be converted to `StandardFileBlock`\nobjects. When `false`, all artifacts are left in their MCP format, but embedded resources will\nbe converted to `StandardFileBlock` objects if `outputHandling` causes embedded resources to be\ntreated as content, as otherwise ChatModel providers will not be able to interpret them.").optional().default(!1)}).and(fo).describe("Configuration for the MCP client");function vo(e,r=!1){if(e==null)return{};if(typeof e=="string")return Object.fromEntries(Fn.map(t=>[t,e]));const a={};for(const t of Fn)(e[t]||r)&&(a[t]=e[t]??(t==="resource"?"artifact":"content"));return a}function X0(e,r){const a=vo(e),t=vo(r);return{...a,...t}}let go;function Va(){return go||(go=Qu("@langchain/mcp-adapters:tools")),go}class Ba extends Error{constructor(r){super(r),this.name="ToolException"}}function Y0(e){return typeof e=="object"&&e!==null&&"name"in e&&e.name==="ToolException"}function ew(e){return typeof e=="object"&&e!==null&&e.uri!=null&&e.blob==null&&e.text==null}async function*sh(e,r){if(ew(e)){const a=await r.readResource({uri:e.uri});for(const t of a.contents)yield*sh(t,r);return}e.blob!=null&&(yield{type:"file",source_type:"base64",data:e.blob,mime_type:e.mimeType,...e.uri!=null?{metadata:{uri:e.uri}}:{}}),e.text!=null&&(yield{type:"file",source_type:"text",mime_type:e.mimeType,text:e.text,...e.uri!=null?{metadata:{uri:e.uri}}:{}})}async function ih(e,r,a,t,n){const i=[];switch(e.type){case"text":return[{type:"text",...r?{source_type:"text"}:{},text:e.text}];case"image":return r?[{type:"image",source_type:"base64",data:e.data,mime_type:e.mimeType}]:[{type:"image_url",image_url:{url:`data:${e.mimeType};base64,${e.data}`}}];case"audio":return[{type:"audio",source_type:"base64",data:e.data,mime_type:e.mimeType}];case"resource":for await(const s of sh(e.resource,a))i.push(s);return i;default:throw new Ba(`MCP tool '${t}' on server '${n}' returned a content block with unexpected type "${e.type}." Expected one of "text", "image", or "audio".`)}}async function tw(e,r,a,t,n){return r?ih(e,r,a,t,n):!e.blob&&!e.text&&e.uri?(await a.readResource({uri:e.resource.uri})).contents.map(i=>({type:"resource",resource:{...i}})):[e]}function oh(e,r){return r==="content"||r==="artifact"?r:vo(r)[e]??(e==="resource"?"artifact":"content")}async function rw({serverName:e,toolName:r,result:a,client:t,useStandardContentBlocks:n,outputHandling:i}){if(!a)throw new Ba(`MCP tool '${r}' on server '${e}' returned an invalid result - tool call response was undefined`);if(!Array.isArray(a.content))throw new Ba(`MCP tool '${r}' on server '${e}' returned an invalid result - expected an array of content, but was ${typeof a.content}`);if(a.isError)throw new Ba(`MCP tool '${r}' on server '${e}' returned an error: ${a.content.map(l=>l.text).join(`
`)}`);const s=(await Promise.all(a.content.filter(l=>oh(l.type,i)==="content").map(l=>ih(l,n,t,r,e)))).flat(),o=(await Promise.all(a.content.filter(l=>oh(l.type,i)==="artifact").map(l=>tw(l,n,t,r,e)))).flat();return s.length===1&&s[0].type==="text"?[s[0].text,o]:[s,o]}async function aw({serverName:e,toolName:r,client:a,args:t,config:n,useStandardContentBlocks:i,outputHandling:s}){try{Va()(`INFO: Calling tool ${r}(${JSON.stringify(t)})`);const o={...n!=null&&n.timeout?{timeout:n.timeout}:{},...n!=null&&n.signal?{signal:n.signal}:{}},l=[{name:r,arguments:t}];Object.keys(o).length>0&&(l.push(void 0),l.push(o));const d=await a.callTool(...l);return rw({serverName:e,toolName:r,result:d,client:a,useStandardContentBlocks:i,outputHandling:s})}catch(o){throw Va()(`Error calling tool ${r}: ${String(o)}`),Y0(o)?o:new Ba(`Error calling tool ${r}: ${String(o)}`)}}const nw={throwOnLoadError:!0,prefixToolNameWithServerName:!1,additionalToolNamePrefix:"",useStandardContentBlocks:!1};async function sw(e,r,a){const{throwOnLoadError:t,prefixToolNameWithServerName:n,additionalToolNamePrefix:i,useStandardContentBlocks:s,outputHandling:o,defaultToolTimeout:l}={...nw,...a??{}},d=[];let u;do u=await r.listTools({...u!=null&&u.nextCursor?{cursor:u.nextCursor}:{}}),d.push(...u.tools||[]);while(u.nextCursor);Va()(`INFO: Found ${d.length} MCP tools`);const p=i?`${i}__`:"",h=n?`${e}__`:"",v=`${p}${h}`;return(await Promise.all(d.filter(f=>!!f.name).map(async f=>{try{f.inputSchema.properties||(f.inputSchema.properties={});const m=new tm({name:`${v}${f.name}`,description:f.description||"",schema:f.inputSchema,responseFormat:"content_and_artifact",metadata:{annotations:f.annotations},defaultConfig:l?{timeout:l}:void 0,func:async(g,b,S)=>aw({serverName:e,toolName:f.name,client:r,args:g,config:S,useStandardContentBlocks:s,outputHandling:o})});return Va()(`INFO: Successfully loaded tool: ${m.name}`),m}catch(m){if(Va()(`ERROR: Failed to load tool "${f.name}":`,m),t)throw m;return null}}))).filter(Boolean)}var iw={};let yo;function Xe(){return yo||(yo=Qu("@langchain/mcp-adapters:client")),yo}class Pt extends Error{constructor(r,a){super(r),Object.defineProperty(this,"serverName",{enumerable:!0,configurable:!0,writable:!0,value:a}),this.name="MCPClientError"}}function lh(e){return typeof e!="object"||e===null||Array.isArray(e)?!1:"transport"in e&&e.transport==="stdio"||"type"in e&&e.type==="stdio"||"command"in e&&typeof e.command=="string"}function ch(e){if(typeof e!="object"||e===null||Array.isArray(e))return!1;if("transport"in e&&typeof e.transport=="string"&&["http","sse"].includes(e.transport)||"type"in e&&typeof e.type=="string"&&["http","sse"].includes(e.type))return!0;if("url"in e&&typeof e.url=="string")try{return new URL(e.url),!0}catch{return!1}return!1}class ow{get config(){return JSON.parse(JSON.stringify(this._config))}constructor(r){Object.defineProperty(this,"_clients",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_serverNameToTools",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_connections",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_loadToolsOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_cleanupFunctions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_transportInstances",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let a;const t=K0;if("mcpServers"in r)a=t.parse(r);else{const n=Rn(nh).parse(r);a=t.parse({mcpServers:n})}if(Object.keys(a.mcpServers).length===0)throw new Pt("No MCP servers provided");for(const[n,i]of Object.entries(a.mcpServers)){const s=X0(a.outputHandling,i.outputHandling),o=a.defaultToolTimeout??i.defaultToolTimeout;this._loadToolsOptions[n]={throwOnLoadError:a.throwOnLoadError,prefixToolNameWithServerName:a.prefixToolNameWithServerName,additionalToolNamePrefix:a.additionalToolNamePrefix,useStandardContentBlocks:a.useStandardContentBlocks,...Object.keys(s).length>0?{outputHandling:s}:{},...o?{defaultToolTimeout:o}:{}}}this._config=a,this._connections=a.mcpServers}async initializeConnections(){if(!this._connections||Object.keys(this._connections).length===0)throw new Pt("No connections to initialize");const r=Array.from(Object.entries(this._connections).filter(([a])=>this._clients[a]===void 0));for(const[a,t]of r)if(Xe()(`INFO: Initializing connection to server "${a}"...`),lh(t))await this._initializeStdioConnection(a,t);else if(ch(t))t.type==="sse"||t.transport==="sse"?await this._initializeSSEConnection(a,t):await this._initializeStreamableHTTPConnection(a,t);else throw new Pt(`Unsupported transport type for server "${a}"`,a);return this._serverNameToTools}async getTools(...r){return await this.initializeConnections(),r.length===0?this._getAllToolsAsFlatArray():this._getToolsFromServers(r)}async getClient(r){return await this.initializeConnections(),this._clients[r]}async close(){Xe()("INFO: Closing all MCP connections...");for(const r of this._cleanupFunctions)try{await r()}catch(a){Xe()(`ERROR: Error during cleanup: ${a}`)}this._cleanupFunctions=[],this._clients={},this._serverNameToTools={},this._transportInstances={},Xe()("INFO: All MCP connections closed")}async _initializeStdioConnection(r,a){const{command:t,args:n,env:i,restart:s,stderr:o}=a;Xe()(`DEBUG: Creating stdio transport for server "${r}" with command: ${t} ${n.join(" ")}`);const l=new k_({command:t,args:n,stderr:o,...i?{env:{PATH:iw.PATH,...i}}:{}});this._transportInstances[r]=l;const d=new Gs({name:"langchain-mcp-adapter",version:"0.1.0"});try{await d.connect(l),s!=null&&s.enabled&&this._setupStdioRestart(r,l,a,s)}catch(p){throw new Pt(`Failed to connect to stdio server "${r}": ${p}`,r)}this._clients[r]=d;const u=async()=>{Xe()(`DEBUG: Closing stdio transport for server "${r}"`),await l.close()};this._cleanupFunctions.push(u),await this._loadToolsForServer(r,d)}_setupStdioRestart(r,a,t,n){const i=a.onclose;a.onclose=async()=>{i&&await i(),this._clients[r]&&(Xe()(`INFO: Process for server "${r}" exited, attempting to restart...`),await this._attemptReconnect(r,t,n.maxAttempts,n.delayMs))}}_getHttpErrorCode(r){const a=r;let{code:t}=a;if(t==null){const n=a.message.match(/\(HTTP (\d\d\d)\)/);n&&n.length>1&&(t=parseInt(n[1],10))}return t}_createAuthenticationErrorMessage(r,a,t,n){return`Authentication failed for ${t} server "${r}" at ${a}. Please check your credentials, authorization headers, or OAuth configuration. Original error: ${n}`}_toSSEConnectionURL(r){const a=new URL(r),t=a.pathname.split("/"),n=t.at(-1);return n&&n==="mcp"&&(t[t.length-1]="sse"),a.pathname=t.join("/"),a.toString()}async _initializeStreamableHTTPConnection(r,a){const{url:t,headers:n,reconnect:i,type:s,transport:o,authProvider:l}=a,d=a.automaticSSEFallback??!0,u=s||o;if(Xe()(`DEBUG: Creating Streamable HTTP transport for server "${r}" with URL: ${t}`),u==="http"||u==null){const p=await this._createStreamableHTTPTransport(r,t,n,i,l);this._transportInstances[r]=p;const h=new Gs({name:"langchain-mcp-adapter",version:"0.1.0"});try{await h.connect(p),this._clients[r]=h;const v=async()=>{Xe()(`DEBUG: Closing streamable HTTP transport for server "${r}"`),await p.close()};this._cleanupFunctions.push(v),await this._loadToolsForServer(r,h)}catch(v){const f=this._getHttpErrorCode(v);if(d&&f!=null&&f>=400&&f<500)try{await this._initializeSSEConnection(r,a)}catch(m){const g=this._toSSEConnectionURL(t);if(g!==t)try{await this._initializeSSEConnection(r,{...a,url:g})}catch(b){throw f===401?new Pt(this._createAuthenticationErrorMessage(r,t,"HTTP",`${v}. Also tried SSE fallback at ${t} and ${g}, but both failed with authentication errors.`),r):new Pt(`Failed to connect to streamable HTTP server "${r}, url: ${t}": ${v}. Additionally, tried falling back to SSE at ${t} and ${g}, but this also failed: ${b}`,r)}else throw f===401?new Pt(this._createAuthenticationErrorMessage(r,t,"HTTP",`${v}. Also tried SSE fallback at ${t}, but it failed with authentication error: ${m}`),r):new Pt(`Failed to connect to streamable HTTP server after trying to fall back to SSE: "${r}, url: ${t}": ${v} (SSE fallback failed with error ${m})`,r)}else throw f===401?new Pt(this._createAuthenticationErrorMessage(r,t,"HTTP",`${v}`),r):new Pt(`Failed to connect to streamable HTTP server "${r}, url: ${t}": ${v}`,r)}}}async _initializeSSEConnection(r,a){const{url:t,headers:n,reconnect:i,authProvider:s}=a;try{const o=await this._createSSETransport(r,t,n,s);this._transportInstances[r]=o;const l=new Gs({name:"langchain-mcp-adapter",version:"0.1.0"});try{await l.connect(o),i!=null&&i.enabled&&this._setupSSEReconnect(r,o,a,i)}catch(u){throw u&&u.name==="MCPClientError"?u:u&&this._getHttpErrorCode(u)===401?new Pt(this._createAuthenticationErrorMessage(r,t,"SSE",`${u}`),r):new Pt(`Failed to create SSE transport for server "${r}, url: ${t}": ${u}`,r)}this._clients[r]=l;const d=async()=>{Xe()(`DEBUG: Closing SSE transport for server "${r}"`),await o.close()};this._cleanupFunctions.push(d),await this._loadToolsForServer(r,l)}catch(o){throw new Pt(`Failed to create SSE transport for server "${r}, url: ${t}": ${o}`,r)}}async _createSSETransport(r,a,t,n){const i={};return n&&(i.authProvider=n,Xe()(`DEBUG: Using OAuth authentication for SSE transport to server "${r}"`)),t&&(i.eventSourceInit={fetch:async(s,o)=>{const l=new Headers(o==null?void 0:o.headers);if(n){const d=await n.tokens();d&&l.set("Authorization",`Bearer ${d.access_token}`)}return Object.entries(t).forEach(([d,u])=>{l.set(d,u)}),l.set("Accept","text/event-stream"),fetch(s,{...o,headers:l})}},i.requestInit={headers:t},Xe()(`DEBUG: Using custom headers for SSE transport to server "${r}"`)),new s0(new URL(a),i)}async _createStreamableHTTPTransport(r,a,t,n,i){var o;const s={...i?{authProvider:i}:{},...t?{requestInit:{headers:t}}:{}};if(n!=null){const l={initialReconnectionDelay:(n==null?void 0:n.delayMs)??1e3,maxReconnectionDelay:(n==null?void 0:n.delayMs)??3e4,maxRetries:(n==null?void 0:n.maxAttempts)??2,reconnectionDelayGrowFactor:1.5};n.enabled===!1&&(l.maxRetries=0),s.reconnectionOptions=l}return(o=s.requestInit)!=null&&o.headers&&Xe()(`DEBUG: Using custom headers for SSE transport to server "${r}"`),s.authProvider&&Xe()(`DEBUG: Using OAuth authentication for Streamable HTTP transport to server "${r}"`),s.reconnectionOptions&&(s.reconnectionOptions.maxRetries===0?Xe()(`DEBUG: Disabling reconnection for Streamable HTTP transport to server "${r}"`):Xe()(`DEBUG: Using custom reconnection options for Streamable HTTP transport to server "${r}"`)),Object.keys(s).length>0?new Bu(new URL(a),s):new Bu(new URL(a))}_setupSSEReconnect(r,a,t,n){const i=a.onclose;a.onclose=async()=>{i&&await i(),this._clients[r]&&(Xe()(`INFO: HTTP connection for server "${r}" closed, attempting to reconnect...`),await this._attemptReconnect(r,t,n.maxAttempts,n.delayMs))}}async _loadToolsForServer(r,a){try{Xe()(`DEBUG: Loading tools for server "${r}"...`);const t=await sw(r,a,this._loadToolsOptions[r]);this._serverNameToTools[r]=t,Xe()(`INFO: Successfully loaded ${t.length} tools from server "${r}"`)}catch(t){throw new Pt(`Failed to load tools from server "${r}": ${t}`)}}async _attemptReconnect(r,a,t=3,n=1e3){let i=!1,s=0;for(this._cleanupServerResources(r);!i&&(t===void 0||s<t);){s+=1,Xe()(`INFO: Reconnection attempt ${s}${t?`/${t}`:""} for server "${r}"`);try{n&&await new Promise(o=>{setTimeout(o,n)}),lh(a)?await this._initializeStdioConnection(r,a):ch(a)&&(a.type==="sse"||a.transport==="sse"?await this._initializeSSEConnection(r,a):await this._initializeStreamableHTTPConnection(r,a)),this._clients[r]&&(i=!0,Xe()(`INFO: Successfully reconnected to server "${r}"`))}catch(o){Xe()(`ERROR: Failed to reconnect to server "${r}" (attempt ${s}): ${o}`)}}i||Xe()(`ERROR: Failed to reconnect to server "${r}" after ${s} attempts`)}_cleanupServerResources(r){delete this._clients[r],delete this._serverNameToTools[r],delete this._transportInstances[r]}_getAllToolsAsFlatArray(){const r=[];for(const a of Object.values(this._serverNameToTools))r.push(...a);return r}_getToolsFromServers(r){const a=[];for(const t of r){const n=this._serverNameToTools[t];n&&a.push(...n)}return a}}const _o="sse",lw=e=>{let r=e;switch(_o){case"sse":r=e.endsWith("/")?`${e}sse`:`${e}/sse`;break;case"stdio":r=e.endsWith("/")?`${e}`:`${e}`;break}return r.replace(/\/\//g,"/")},cw=async(e,r)=>{try{const a=await new ow({throwOnLoadError:(r==null?void 0:r.throwOnLoadError)??!0,prefixToolNameWithServerName:(r==null?void 0:r.prefixToolNameWithServerName)??!0,additionalToolNamePrefix:(r==null?void 0:r.additionalToolNamePrefix)??"mcp",mcpServers:{...e.reduce((t,n)=>(t[n.key]={transport:_o,url:lw(n.url),type:_o,headers:{},useNodeEventSource:!1,reconnect:{enabled:!1,maxAttempts:5,delayMs:2e3}},t),{})}}).getTools();for(const t in a){const n=a[t],i=new Function("z",`return (${tg(n.schema)});`)(y);n.schema=i}return a}catch(a){throw a}},dw=w.memo(e=>{var p,h,v,f;const{t:r}=Oe("flows"),{id:a,data:t,isConnectable:n}=e,[i,s]=w.useState(!1),o=w.useRef(!1),l=lt(a),d=me(m=>m.updateNodes);Iv(a),w.useEffect(()=>{const m=t==null?void 0:t.entity;!m||!l||o.current||t.loaded||(o.current=!0,cw([m],{globalThrowOnLoadError:!0}).then(g=>{o.current=!1,d([{id:l.id,type:"replace",item:{...l,data:{...(l==null?void 0:l.data)||{},loaded:!0,tools:g.map(b=>({name:`${b.name}`,description:b.description||"",schema:qx(b.schema)}))}}}])}).catch(g=>{o.current=!1,d([{id:l.id,type:"replace",item:{...l,data:{...t,loaded:!0,error:g.message}}}])}))},[t.loaded,t==null?void 0:t.entity,l,r,d,t]);const u=w.useMemo(()=>!(t!=null&&t.tools)||!t.loaded?{tools:[],total:0}:i?{tools:t.tools,total:t.tools.length}:{tools:t.tools.slice(0,5),total:t.tools.length},[t==null?void 0:t.tools,t.loaded,i]);return c.jsxs("div",{children:[c.jsxs("div",{children:[c.jsx(ut,{id:a}),c.jsxs(Ct,{className:"flex justify-center max-w-md",variant:"default",children:[c.jsx(ve,{size:24,name:"tool-case"}),c.jsxs("div",{className:"ml-2 max-w-full break-words break-all",children:[c.jsx(lr,{children:`${((p=t.entity)==null?void 0:p.key)||""}`}),c.jsxs(Qr,{children:[c.jsx(we,{children:`${((h=t.entity)==null?void 0:h.url)||""}`}),c.jsx(np,{className:"my-2"}),t.error?c.jsx(we,{className:"text-red-500",children:t.error}):void 0,(v=u==null?void 0:u.tools)!=null&&v.length?c.jsxs("div",{children:[c.jsx("ul",{className:"list-disc pl-5",children:u.tools.map((m,g)=>c.jsx("li",{children:c.jsxs(we,{children:[m.name,": ",m.description]})},g))}),u.total>((f=u==null?void 0:u.tools)==null?void 0:f.length)?c.jsxs(Ve,{onClick:()=>s(!0),className:"align-self-center mt-2",variant:"ghost",children:[c.jsx(ve,{name:"chevron-down",className:"mt-1"}),r("mcp_node.view_all",{count:u.total})]}):u.total>5?c.jsxs(Ve,{onClick:()=>s(!1),className:"align-self-center mt-2",variant:"ghost",children:[c.jsx(ve,{name:"chevron-up",className:"mt-1"}),r("mcp_node.view_less")]}):null]}):t!=null&&t.loaded&&!(t!=null&&t.error)?c.jsx(we,{children:r("mcp_node.no_tools")}):t!=null&&t.error?void 0:c.jsx(we,{children:r("mcp_node.loading_tools")})]})]})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:n})]})}),uw=e=>{const r=me(i=>i.createOrUpdateFlowEdge),{getHandleConnections:a,getNode:t}=Mt(),n=w.useCallback(async({edgeId:i,source:s,target:o})=>{try{if(![V.Prompt,V.ToolDefinition,V.MCP,V.LLM,V.Thread].includes(s==null?void 0:s.type))return{deleteEdgeId:i};if((s==null?void 0:s.type)===V.LLM&&a({type:"target",nodeId:e}).filter(l=>{var d;return l.source===s.id?!1:((d=t(l.source))==null?void 0:d.type)===V.LLM}).length>0)return{deleteEdgeId:i};await r({source:s.id,target:o.id});return}catch{return{deleteEdgeId:i}}},[r,a,t,e]);vt(e,n)},hw=(e,r)=>{const a=lt(e),{createThread:t,loading:n}=Kl(),i=w.useCallback(async()=>{r!=null&&r.entity&&a&&await t(a)},[r==null?void 0:r.entity,a,t]);return{creatingThread:n,createThread:i}},pw=w.memo(e=>{const{id:r,isConnectable:a,data:t}=e,n=t==null?void 0:t.entity,{t:i}=Oe("flows"),{createThread:s,creatingThread:o}=hw(r,t);uw(r);const l=n!=null&&n.system_prompt?n.system_prompt.length>100?`${n.system_prompt.substring(0,100)}...`:n.system_prompt:"No system prompt";return c.jsxs("div",{className:"min-w-56",children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:a}),c.jsxs("div",{children:[c.jsx(ut,{id:r}),c.jsxs(Ct,{className:"max-w-72",variant:"default",children:[c.jsx(ve,{size:24,name:"bot"}),c.jsxs("div",{className:"ml-2 max-w-full",children:[c.jsx(lr,{className:"break-words",children:(n==null?void 0:n.name)||"Unnamed Agent"}),c.jsxs(Qr,{className:"space-y-2",children:[(n==null?void 0:n.description)&&c.jsx("div",{className:"text-sm text-muted-foreground break-words",children:n.description}),c.jsxs("div",{className:"text-xs text-muted-foreground break-words",children:[c.jsx("strong",{children:"System:"})," ",l]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsxs(Or,{variant:"secondary",className:"text-xs",children:["Max: ",(n==null?void 0:n.max_iterations)||10," iterations"]})})]}),c.jsx("div",{className:"mt-4",children:c.jsxs(zt,{loading:o,onClick:s,className:"w-full",size:"sm",children:[c.jsx(ve,{size:16,name:"message-square-plus",className:"mr-2"}),i("basic_agent_node.create_thread_button")]})})]})]})]}),c.jsx(ze,{type:"source",position:Me.Bottom,id:"a",isConnectable:a})]})}),Dn=w.memo(e=>{const{lineClassName:r,handleClassName:a,...t}=e;return c.jsx(Ib,{lineClassName:Fe("!border-1.5",r),handleClassName:Fe("!w-2 !h-2 !border-2 !rounded-full",a),...t})}),mw=e=>{const r=me(t=>t.createOrUpdateFlowEdge),a=w.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===V.LLM&&(i==null?void 0:i.type)===V.EditorApp){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},fw=e=>{const r=lt(e),{t:a}=Oe("flows"),t=w.useRef(null),{toast:n}=xt(),{getNode:i,getHandleConnections:s}=Mt(),{confirmPassphrase:o}=Jr(),l=w.useCallback(async p=>{r&&(clearTimeout(t.current),t.current=setTimeout(async()=>{await ue("FlowNode").update(r.id,{data:p})},150))},[r]),d=w.useCallback(async(p,h)=>{var v,f;if(r){const m=s({nodeId:e,type:"target"}).find(S=>{var O;return((O=i(S.source))==null?void 0:O.type)===V.LLM}),g=m?i(m==null?void 0:m.source):void 0,b=(v=g==null?void 0:g.data)==null?void 0:v.entity;if(!g||!b)return n({variant:"destructive",description:a("editor_node.errors.llm_not_found")});if(g.data.status!==ft.Loaded)return n({variant:"destructive",description:a("editor_node.errors.llm_not_loaded_yet")});try{return await o(),(f=await Ao.stream(b.provider,typeof p=="string"?[new Ir(p)]:p,{onMessageUpdate:S=>{h==null||h(S.content)},llm:b}))==null?void 0:f.content}catch(S){if(S instanceof Error&&S.message.includes("LLM_NOT_LOADED_YET"))return n({title:a("editor_node.errors.llm_not_loaded_yet")});n({variant:"destructive",title:a("editor_node.errors.stream_message_failed")})}}},[r,s,e,i,n,a]),u=w.useCallback(p=>{if(!i(p))return[];const h=[];return s({nodeId:p,type:"target"}).forEach(v=>{const f=i(v.source);!f||f.type!==V.LLM||h.push({node:f,connections:[v]})}),h},[s,i]);return{createMessage:d,updateEditorContent:l,getLinkedConnections:u}},vw=w.lazy(()=>jt(()=>import("./index-D_z_KQyS.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([12,2,3]))),gw=w.memo(e=>{var d;const{id:r,data:a,selected:t,isConnectable:n}=e;mw(r);const{createMessage:i,updateEditorContent:s,getLinkedConnections:o}=fw(r),l=w.useCallback(u=>{s(u)},[s]);return c.jsxs("div",{className:"w-full min-w-[1240px] h-full",children:[c.jsx(Dn,{isVisible:!!t,minWidth:1240,minHeight:400}),c.jsx(ze,{type:"target",position:Me.Top,isConnectable:n}),c.jsxs("div",{className:"min-w-10 min-h-10 w-full h-full rounded-lg border bg-background",children:[c.jsx(ut,{className:"!z-[100]",id:r,enableToStandalone:!0,getLinkedConnections:o}),c.jsx(w.Suspense,{fallback:c.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:c.jsx(ve,{name:"loader-circle",className:"animate-spin"})}),children:c.jsx("div",{className:"h-full w-ful rounded-lg","data-registry":"plate",children:c.jsx(vw,{defaultValue:(d=a==null?void 0:a.flowNode)==null?void 0:d.data,onValueChange:l,copilotStream:i})})})]}),c.jsx(ze,{type:"source",position:Me.Bottom,isConnectable:n})]})}),yw=["empty-source","vite-vue","shadcn-react-vite","todo-app-react-vite","porfolio-nextjs"],_w=async e=>{switch(e){case"empty-source":return jt(()=>import("./empty-source-Dw1dvL8s.js"),[]).then(r=>r.BASE);case"vite-vue":return jt(()=>import("./vite-vue-Bmz2z3Fo.js"),[]).then(r=>r.BASE);case"shadcn-react-vite":return jt(()=>import("./shadcn-react-vite-CDJ9BaE9.js"),[]).then(r=>r.BASE);case"todo-app-react-vite":return jt(()=>import("./todo-app-react-vite-BBWBkRjR.js"),[]).then(r=>r.BASE);case"porfolio-nextjs":return jt(()=>import("./porfolio-nextjs-DCkli5iW.js"),[]).then(r=>r.BASE);default:throw new Error(`Unknown source base: ${e}`)}},ww=w.memo(({className:e,onUpdateSourceBase:r})=>{const{t:a}=Oe("components"),[t,n]=w.useState();return c.jsxs(Ge,{className:Fe("mw-full",e),children:[c.jsx(pt,{className:"p-4",children:c.jsx(gt,{children:a("add_source_base.title")})}),c.jsx(mt,{className:"p-4",children:c.jsxs("div",{className:"flex items-center justify-center w-full h-full flex-col",children:[c.jsxs(rr,{onValueChange:i=>n(i),children:[c.jsx(ar,{className:"w-full mb-4",children:c.jsx(nr,{placeholder:a("add_source_base.source_base_select_placeholder")})}),c.jsx(sr,{children:yw.map(i=>c.jsx(yt,{value:`${i}`,children:a(`add_source_base.sourcebases.${i.toLowerCase()}`)},`${i}`))})]}),c.jsx(Ve,{className:"w-full",onClick:async()=>t&&r(await _w(t)),children:a("add_source_base.update_source")})]})})]})}),bw=()=>{const{getNode:e,getHandleConnections:r}=Mt(),{confirmPassphrase:a}=Jr(),t=w.useCallback(async(i,s)=>{await ue("FlowNode").update(i,{raw:e1(s)})},[]),n=w.useCallback(i=>{if(!e(i))return[];const s=[];return r({nodeId:i,type:"target"}).forEach(o=>{const l=e(o.source);!l||l.type!==V.LLM||s.push({node:l,connections:[o]})}),s},[r,e]);return{sendMessage:w.useCallback(async(i,s,{onMessageUpdate:o,onResponseMessageCreate:l}={})=>{const d=s.map(p=>p.role==="system"?new en(p.content):p.role==="user"?new Ir(p.content):new rs(p.content));l==null||l(),await a();const u=await Ao.stream(Ce.WebLLM,[...d,new Ir(i)],{onMessageUpdate:({content:p})=>{o==null||o({nodeData:{loading:!0,content:p}})},llm:void 0});return o==null||o({nodeData:{loading:!1,content:u==null?void 0:u.content}}),u==null?void 0:u.content},[]),getLinkedConnections:n,updateCodeContainerData:t}},xw=e=>{const r=me(t=>t.createOrUpdateFlowEdge),a=w.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===V.LLM&&(i==null?void 0:i.type)===V.VSLiteApp){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},jw=w.lazy(()=>jt(()=>import("./index-BTHjChhh.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([13,2,3,4,8,14,15,6,16,17,18,19,20]))),Sw=w.memo(e=>{var h,v,f,m;const{id:r,isConnectable:a,data:t}=e,[n,i]=w.useState((h=t==null?void 0:t.flowNode)!=null&&h.raw?t1(t.flowNode.raw):void 0),{updateCodeContainerData:s,getLinkedConnections:o,sendMessage:l}=bw();xw(r);const d=w.useCallback(async g=>{var b,S;(b=t==null?void 0:t.flowNode)!=null&&b.id&&(await s((S=t==null?void 0:t.flowNode)==null?void 0:S.id,g),i(g))},[(v=t==null?void 0:t.flowNode)==null?void 0:v.id,s]),u=w.useCallback(async(g,b)=>{var S;return(S=t==null?void 0:t.flowNode)!=null&&S.id?await l(g,b):void 0},[(f=t==null?void 0:t.flowNode)==null?void 0:f.id,l]),p=w.useCallback(async g=>{i(b=>{var O;const S=r1(b||{},g);return s((O=t==null?void 0:t.flowNode)==null?void 0:O.id,S),S})},[(m=t==null?void 0:t.flowNode)==null?void 0:m.id,s]);return n?c.jsxs("div",{className:"w-[1380px] h-[600px] rounded-lg border overflow-hidden shadow-sm",children:[c.jsx(ze,{type:"target",position:Me.Top,isConnectable:a}),c.jsxs("div",{className:"w-full h-full rounded-lg border bg-card overflow-hidden",children:[c.jsx(ut,{id:r,className:"z-50",enableToStandalone:!0,getLinkedConnections:o}),c.jsx(w.Suspense,{fallback:c.jsx("div",{className:"h-full w-full flex justify-center items-center",children:c.jsx(ve,{name:"loader-circle",className:"animate-spin"})}),children:c.jsx(jw,{fileSystemTree:n,onUpdateFileContent:p,sendMessage:u})})]}),c.jsx(ze,{type:"source",position:Me.Bottom,isConnectable:a})]}):c.jsx("div",{className:"h-full flex justify-center items-center",children:c.jsx(ww,{className:"w-64",onUpdateSourceBase:d})})}),Ew=e=>{const r=me(t=>t.createOrUpdateFlowEdge),a=w.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if([V.CircleShape,V.TriangleShape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===V.Shape){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},kw=w.memo(e=>{const{id:r,selected:a,isConnectable:t}=e;return Ew(r),c.jsxs(c.Fragment,{children:[c.jsx(Dn,{isVisible:!!a,minWidth:40,minHeight:40}),c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border border",children:c.jsx(ut,{id:r})}),c.jsx(ze,{type:"source",position:Me.Bottom,isConnectable:t})]})}),Pw=e=>{const r=me(t=>t.createOrUpdateFlowEdge),a=w.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if([V.Shape,V.TriangleShape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===V.CircleShape){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},Nw=w.memo(e=>{const{id:r,selected:a,isConnectable:t}=e;return Pw(r),c.jsxs(c.Fragment,{children:[c.jsx(Dn,{isVisible:!!a,minWidth:40,minHeight:40}),c.jsx(ze,{type:"target",position:Me.Top,isConnectable:t}),c.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border rounded-full border",children:c.jsx(ut,{id:r})}),c.jsx(ze,{type:"source",position:Me.Bottom,isConnectable:t})]})}),Cw=e=>{const r=me(t=>t.createOrUpdateFlowEdge),a=w.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if([V.CircleShape,V.Shape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===V.TriangleShape){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);vt(e,a)},$w=w.memo(e=>{const{id:r,selected:a,width:t,height:n,isConnectable:i}=e;return Cw(r),c.jsxs(c.Fragment,{children:[c.jsx(Dn,{isVisible:!!a,minWidth:40,minHeight:40}),c.jsx(ze,{type:"target",position:Me.Top,isConnectable:i}),c.jsx("div",{className:"w-0 h-0 border-l-transparent border-r-transparent border-b-border",style:{borderLeftWidth:(t||0)/2,borderRightWidth:(t||0)/2,borderBottomWidth:n||0}}),c.jsx(ut,{id:r,className:"absolute top-0 right-0"}),c.jsx(ze,{type:"source",position:Me.Bottom,isConnectable:i})]})}),Ow={[V.LLM]:hv,[V.Toolbox]:Df,[V.Thread]:nv,[V.Message]:cv,[V.Prompt]:mv,[V.SessionInfo]:Zf,[V.Schema]:vv,[V.CSVData]:wv,[V.ToolDefinition]:_v,[V.DefaultEmbeddingModel]:Wf,[V.VectorDatabase]:Nv,[V.JSONLData]:$v,[V.ApplicationBar]:Hf,[V.Shape]:kw,[V.CircleShape]:Nw,[V.TriangleShape]:$w,[V.EditorApp]:gw,[V.PlaceHolder]:Tv,[V.VSLiteApp]:Sw,[V.MCP]:dw,[V.BasicAgent]:pw},dh=Ah("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),Tw=w.forwardRef(({className:e,variant:r,size:a,...t},n)=>c.jsx(hp,{ref:n,className:Fe(dh({variant:r,size:a,className:e})),...t}));Tw.displayName=hp.displayName;const uh=w.createContext({size:"default",variant:"default"}),hh=w.forwardRef(({className:e,variant:r,size:a,children:t,...n},i)=>c.jsx(pp,{ref:i,className:Fe("flex items-center justify-center gap-1",e),...n,children:c.jsx(uh.Provider,{value:{variant:r,size:a},children:t})}));hh.displayName=pp.displayName;const ph=w.forwardRef(({className:e,children:r,variant:a,size:t,...n},i)=>{const s=w.useContext(uh);return c.jsx(mp,{ref:i,className:Fe(dh({variant:s.variant||a,size:s.size||t}),e),...n,children:r})});ph.displayName=mp.displayName;function Iw(){const e=Lb(r=>`x: ${r.transform[0].toFixed(2)}, y: ${r.transform[1].toFixed(2)}, zoom: ${r.transform[2].toFixed(2)}`);return c.jsx("div",{children:e})}function Lw({change:e}){var t,n,i,s;const r="id"in e?e.id:"-",{type:a}=e;return c.jsxs("div",{className:"mb-3",children:[c.jsxs("div",{children:["node id: ",r]}),c.jsxs("div",{children:[a==="add"?JSON.stringify(e.item,null,2):null,a==="dimensions"?`dimensions: ${(t=e.dimensions)==null?void 0:t.width} \xD7 ${(n=e.dimensions)==null?void 0:n.height}`:null,a==="position"?`position: ${(i=e.position)==null?void 0:i.x.toFixed(1)}, ${(s=e.position)==null?void 0:s.y.toFixed(1)}`:null,a==="remove"?"remove":null,a==="select"?e.selected?"select":"unselect":null]})]})}function Aw({limit:e=20}){const[r,a]=w.useState([]),t=Ab(),n=w.useCallback(s=>{a(o=>[...s,...o].slice(0,e))},[e]);w.useEffect(()=>(t.setState({onNodesChange:n}),()=>t.setState({onNodesChange:void 0})),[n,t]);const i=()=>c.jsx("div",{children:"No Changes Triggered"});return c.jsx(c.Fragment,{children:r.length===0?c.jsx(i,{}):r.map((s,o)=>c.jsx(Lw,{change:s},o))})}function Rw(){const{getInternalNode:e}=Mt(),r=qh();return c.jsx(Rb,{children:c.jsx("div",{className:"text-secondary-foreground",children:r.map(a=>{var i,s;const t=e(a.id);if(!t)return null;const n=t==null?void 0:t.internals.positionAbsolute;return c.jsx(Fw,{id:a.id,selected:!!a.selected,type:a.type||"default",position:a.position,absPosition:n,width:((i=a.measured)==null?void 0:i.width)??0,height:((s=a.measured)==null?void 0:s.height)??0,data:a.data},a.id)})})})}function Fw({id:e,type:r,selected:a,position:t,absPosition:n,width:i,height:s,data:o}){if(!i||!s)return null;const l=`translate(${n.x}px, ${n.y+s}px)`,d=`${t.x.toFixed(1)}, ${t.y.toFixed(1)}`,u=`${i} \xD7 ${s}`,p=a?"Selected":"Not Selected";return c.jsxs("div",{style:{position:"absolute",transform:l,width:i*2},className:"text-xs",children:[c.jsxs("div",{children:["id: ",e]}),c.jsxs("div",{children:["type: ",r]}),c.jsxs("div",{children:["selected: ",p]}),c.jsxs("div",{children:["position: ",d]}),c.jsxs("div",{children:["dimensions: ",u]}),c.jsxs("div",{children:["data: ",JSON.stringify(o,null,2)]})]})}function Dw({tools:e}){return c.jsx(Co,{position:"top-left",className:"bg-card p-1 border rounded shadow-sm",children:c.jsx(hh,{type:"multiple",children:e.map(({active:r,setActive:a,label:t,value:n})=>c.jsx(ph,{value:n,onClick:()=>a(i=>!i),"aria-pressed":r,className:"bg-card text-card-foreground transition-colors duration-300 hover:bg-secondary hover:text-secondary-foreground",children:t},n))})})}function mh(){const[e,r]=w.useState(!1),[a,t]=w.useState(!1),[n,i]=w.useState(!1),s=[{active:e,setActive:r,label:"Node Inspector",value:"node-inspector"},{active:a,setActive:t,label:"Change Logger",value:"change-logger"},{active:n,setActive:i,label:"Viewport Logger",value:"viewport-logger"}];return c.jsxs(c.Fragment,{children:[c.jsx(Dw,{tools:s}),a&&c.jsx(Co,{className:"text-xs p-5 bg-white rounded shadow-md overflow-y-auto max-h-[50%] mt-20",position:"bottom-right",children:c.jsx(Aw,{})}),e&&c.jsx(Rw,{}),n&&c.jsx(Co,{position:"bottom-left",className:"text-secondary-foreground",children:c.jsx(Iw,{})})]})}mh.displayName="DevTools";let fh,vh,gh,yh;fh=()=>{const e=w.useRef({}),r=w.useRef({}),a=w.useRef([]),t=me(T=>T.flowEdges),n=et(T=>T.currentSession),i=me(T=>T.setNodes),s=me(T=>T.updateNodes),o=me(T=>T.updateEdges),l=me(T=>T.addConnectionToEdges),d=me(T=>T.reset),u=me(T=>T.findFlowEdges),p=me(T=>T.deleteFlowNode),h=me(T=>T.deleteFlowEdge),v=me(T=>T.updateFlowNode),f=me(T=>T.getNodes),m=me(T=>T.findFlowNodesWithSource),g=w.useRef(t),b=w.useRef(),[S,O]=w.useState({loading:!1});g.current=t;const x=w.useCallback(async(T,z)=>{try{b.current=T,d(),await(z==null?void 0:z())}catch{b.current=void 0}},[d]),E=w.useCallback(async T=>{try{if(!(n!=null&&n.id))return;O(H=>({...H,loading:!0}));const z=await m({...T,where:{...T.where,session_id:n.id}}),M=await u({where:[{source:Ro(z.map(H=>H.id))},{target:Ro(z.map(H=>H.id))}]});return{flowNodes:z,flowEdges:M}}finally{O(z=>({...z,loading:!1}))}},[m,u,n==null?void 0:n.id]),$=w.useCallback(async T=>{var z,M;for(const H of a.current){const B=await H(T);if(typeof B=="boolean"&&!B)return}for(const H of T)if("id"in H&&Object.values(Qn).includes(H.id)&&H.type!=="remove")s([H]);else if(H.type==="position"&&H.position&&!isNaN(H.position.x)&&!isNaN(H.position.y)){s([H]);const B=H.position.x,ee=H.position.y;clearTimeout(e.current[H.id]),e.current[H.id]=setTimeout(async()=>{e.current[H.id]=void 0,await v({id:H.id,x:B,y:ee},{silent:!0})},200)}else if(H.type==="remove"){const B=(z=f([H.id]))==null?void 0:z[0];if(!(B!=null&&B.type)||Fb.includes(B.type))return;await p({id:H.id})}else if(H.type==="dimensions"&&H.dimensions&&!isNaN(H.dimensions.width)&&!isNaN(H.dimensions.height)){const B=(M=f([H.id]))==null?void 0:M[0];if(!(B!=null&&B.width)&&!(B!=null&&B.height))return;s([H]),clearTimeout(r.current[H.id]);const ee=H.dimensions.width,J=H.dimensions.height;r.current[H.id]=setTimeout(async()=>{await v({id:H.id,width:ee,height:J},{silent:!0})},200)}else H.type==="select"&&s([H])},[s,v,f,p]),C=w.useCallback(T=>{Promise.all(T.map(async z=>{if(z.type==="remove")return h({id:z.id})})),o(T)},[h,o]),R=w.useCallback(T=>{l(T)},[l]),D=w.useCallback(T=>{i(z=>{var ee,J;let M;if(typeof T=="function"?M=T(z):M=T,!M)return z;const H=z==null?void 0:z.find(se=>se.id===M.id),B={id:M.id,item:H?Db(H,M):{...M,position:{x:((ee=M.position)==null?void 0:ee.x)||0,y:((J=M.position)==null?void 0:J.y)||0}},type:H?"replace":"add"};return Mb([B],z)})},[i]),L=w.useCallback(T=>(a.current.push(T),()=>{a.current=a.current.filter(z=>z!==T)}),[]);return{initFlow:x,loadingState:S,prepareFlowInfo:E,updateNodeChanges:$,updateEdgeChanges:C,updateOrCreateNode:D,currentSessionIdRef:b,updateEdgeConnection:R,addOnNodeChangeHandler:L}},vh=e=>{const r=et(p=>{var h;return(h=p.currentSession)==null?void 0:h.id}),{loadingState:a,prepareFlowInfo:t,initFlow:n,currentSessionIdRef:i}=e,s=me(p=>p.ready),o=me(p=>p.nodes),l=w.useRef(o),d=me(p=>p.removeSyncNodeQueue),u=me(p=>p.removeSyncEdgeQueue);l.current=o,w.useEffect(()=>{a.loading||!s||!r||i.current===r||n(r,async()=>{await t({where:{session_id:r}})})},[n,t,a.loading,i,s,r]),w.useEffect(()=>{const p=me.subscribe(v=>v.syncNodeQueue,async(v,f)=>{const m=f.map(b=>b.timestamp),g=v.filter(b=>!m.includes(b.timestamp));g.length&&d(g.map(b=>b.timestamp))}),h=me.subscribe(v=>v.syncEdgeQueue,async(v,f)=>{const m=f.map(b=>b.timestamp),g=v.filter(b=>!m.includes(b.timestamp));g.length&&u(g.map(b=>b.timestamp))});return()=>{p(),h()}},[t,u,d])},gh=()=>{const[e,r]=w.useState(!0),a=fh(),t=Ja(u=>u.selectedModel),n=w.useRef(t),i=Ja(u=>u.setInitProgressCallback),{updateOrCreateNode:s,updateNodeChanges:o,updateEdgeChanges:l,updateEdgeConnection:d}=a;return vh(a),n.current=t,w.useEffect(()=>{const u=i==null?void 0:i(p=>{if(!n.current)return;const h=`${n.current}`;s(v=>{const f=v==null?void 0:v.find(m=>{var g;return(g=m.data)!=null&&g.entity&&typeof m.data.entity=="object"&&"name"in m.data.entity?m.data.entity.name===h:!1});if(f)return f.data.label=p.text,f.data.status=ft.Loading,p.progress===100&&(f.data.label="",f.data.status=ft.Loaded),f})});return()=>{u==null||u()}},[i,s]),w.useMemo(()=>({updateNodeChanges:o,updateEdgeChanges:l,initializing:e,setInitializing:r,updateEdgeConnection:d}),[o,l,e,r,d])},yh=()=>{const e=Ih(d=>d.theme),r=me(d=>d.nodes),a=me(d=>d.edges),{updateNodeChanges:t,updateEdgeChanges:n,updateEdgeConnection:i}=gh(),s=w.useCallback(d=>{t(d)},[t]),o=w.useCallback(d=>{n(d)},[n]),l=w.useCallback(d=>{i(d)},[i]);return c.jsxs(zb,{nodes:r,edges:a,nodeTypes:Ow,onNodesChange:s,onEdgesChange:o,onConnect:l,panOnScroll:!0,panOnScrollMode:Ub.Free,colorMode:e,fitView:!0,children:[c.jsx(Hb,{variant:qb.Dots,gap:24,size:1}),c.jsx(Vb,{}),c.jsx(Bb,{}),pb?c.jsx(mh,{}):void 0]})},fp=w.memo(yh)});export{n1 as __tla,fp as default};
