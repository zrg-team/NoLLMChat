{"version":3,"mappings":"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","names":["useMotionValue","motionValue","initial","useState","useEffect","setLatest","value","useCombineMotionValues","values","combineValues","updateValue","useIsomorphicLayoutEffect","scheduleUpdate","frame","subscriptions","v","unsubscribe","cancelFrame","config","isStatic","useContext","activeSpringAnimation","useRef","useConstant","source","unit","initialValue","noop","startAnimation","asNumber","latestValue","latestSetter","stopAnimation","useInsertionEffect","set","latest","parseValue","isMotionValue","isCustomValueType","transform","inputValue","args","argOffset","outputRange","options","interpolate","inputRange","getMixer","interpolator","useComputed","compute","collectMotionValues","useTransform","input","inputRangeOrTransformer","useListTransform","transformer","numValues","i","MessageStatusEnum","MessageRoleEnum","ThreadStatusEnum","PromptTypeEnum","Collection","useCollection","MENUBAR_NAME","createContextScope","useRovingFocusGroupScope","MenubarContextProvider","createMenubarContext","Menubar","React.forwardRef","props","forwardedRef","__scopeMenubar","valueProp","defaultValue","menubarProps","direction","useDirection","onValueChange","setCurrentTabStopId","React.useState","React.useCallback","value2","setValue","prevValue","loop","jsx","rovingFocusGroupScope","MENU_NAME","useId","autoValue","useMenubarContext","useMenuScope","triggerRef","React.useRef","open","React.useEffect","MenubarMenuProvider","wasKeyboardTriggerOpenRef","menuScope","open2","context","menuProps","MenubarMenu","MenubarTrigger","disabled","triggerProps","TRIGGER_NAME","menuContext","useMenubarMenuContext","ref","useComposedRefs","isFocused","setIsFocused","RovingFocusGroup.Item","MenuPrimitive.Anchor","composedRefs","composeEventHandlers","event","PORTAL_NAME","MenubarPortal","MenuPrimitive.Portal","CONTENT_NAME","MenubarContent","align","contentProps","hasInteractedOutsideRef","getItems","item","target","isKeyDownInsideSubMenu","isPrevKey","targetIsSubTrigger","currentIndex","candidateValues","wrapArray","GROUP_NAME","MenuPrimitive.Group","MenubarLabel","MenubarItem","MenuPrimitive.Item","checkboxItemProps","MenuPrimitive.CheckboxItem","CHECKBOX_ITEM_NAME","RADIO_GROUP_NAME","radioGroupProps","MenuPrimitive.RadioGroup","MenubarRadioGroup","RADIO_ITEM_NAME","MenubarRadioItem","MenuPrimitive.RadioItem","INDICATOR_NAME","MenubarItemIndicator","MenuPrimitive.ItemIndicator","SEPARATOR_NAME","MenubarSeparator","MenuPrimitive.Separator","ARROW_NAME","MenubarArrow","arrowProps","MenuPrimitive.Arrow","SUB_TRIGGER_NAME","MenubarSubTrigger","subTriggerProps","MenuPrimitive.SubTrigger","SUB_CONTENT_NAME","MenubarSubContent","subContentProps","MenuPrimitive.SubContent","startIndex","array","_","index","Root3","Menu","Trigger","Label2","Item3","CheckboxItem2","MenubarCheckboxItem","Separator2","MenubarPrimitive.Menu","className","cn","MenubarPrimitive.Root","MenubarPrimitive.Trigger","inset","MenubarPrimitive.SubContent","sideOffset","MenubarPrimitive.Content","MenubarPrimitive.Item","children","MenubarPrimitive.CheckboxItem","checked","LazyIcon","jsxs","MenubarPrimitive.ItemIndicator","MenubarPrimitive.RadioItem","MenubarPrimitive.Label","MenubarPrimitive.Separator","useFlowState","subscribeWithSelector","get","defaultFlowState","getFlowStateActions","useCreateLLM","sessionId","useSessionState","state","pushSyncNodeQueue","record","setLoading","existed","LLMProviderEnum","LLMStatusEnum","llm","createOrUpdateFlowNode","FlowNodeTypeEnum","loading","createLLM","H","J","p","$","k","B","C","h","O","A","U","P","c","L","E","N","R","M","G","f","S","m","u","K","T","D","X","W","be","le","I","he","r","o","t","ce","ue","n.createContext","n.useContext","de","ee","fe","me","n.forwardRef","e","s","pe","b","y","ge","te","F","x","n.useRef","Te","l","re","n.useMemo","a","g","ne","z","V","Q","Z","oe","Ie","ie","ae","se","Y","n.createElement","q","Le","j","ye","d","ve","n.useEffect","Ce","xe","Pe","w.Portal","w.Overlay","Ve","Se","we","Me","n.useLayoutEffect","Re","n.useState","ke","Command","CommandPrimitive","CommandInput","CommandList","CommandEmpty","CommandGroup","CommandSeparator","CommandItem","Checkbox","CheckboxPrimitive.Root","OPEN_AI_MODELS","GROQ_MODELS","GROQ_VISION_MODELS","GOOGLE_GENERATIVE_AI_MODELS","GOOGLE_GENERATIVE_AI_API_KEY_LINK","GROQ_API_KEY_LINK","SUPPORTED_PROVIDERS","create","onCancel","useModal","useTranslation","name","setName","handleChangeOTP","newValue","handleSubmit","onConfirm","currentModal","handleHide","DialogHeader","DialogTitle","InputOTP","InputOTPSlot","InputOTPGroup","DialogFooter","Button","useUpdateSessionPassphrase","currentSession","setCurrentSession","useCallback","passkey","passphrase","getRepository","session","updateSessionPassphrase","useConfirmOrCreatePassphrase","createSessionPassphraseDialogRef","useModalRef","CreateSessionPassphraseDialog","useConfirmPassphrase","confirmPassphrase","keyInfo","secureSession","useToast","useInternalNode","id","setModelId","setOpen","search","setSearch","encryptedInfo","setEncryptedInfo","llmsInfo","setLLMsInfo","llmInfoRef","syncCachedLLMURLs","cachedLLMURLs","useLocalLLMState","confirmOrCreatePassphrase","isRequiredSessionPasskey","useMemo","modelId","provider","modelList","pre","next","preInCache","nextInCache","preInRecommended","RECOMMENDATION_LOCAL_LLMS","nextInRecommended","preInFunctionCalling","nextInFunctionCalling","model","selectedModel","setHasCache","handleOnchange","currentValue","handleSearchChange","hanldeSubmit","node","encrypted","encryptData","modelTypeToLLMType","setDialog","logError","setProvider","useLayoutEffect","repoInfo","repo","data","__vitePreload","functionCallingModelIds","modelType","LLMModelTypeEnum","LLMIcon","LLMInfo","modelSelection","username","Alert","Input","Label","Popover","PopoverTrigger","PopoverContent","Fragment","modelItems","encryptedFields","OPEN_AI_API_KEY_LINK","CardHeader","CardTitle","SelectValue","SelectContent","LoadingButton","createPrompt","initialY","prompt","PROMPT_TYPES","PROMPT_ROLES","defaultPromptType","hidePromptRole","setInput","defaultPromptContent","promptType","setPromptType","setPromptPrefix","handleOnchangePrefix","handleOnSelectRole","setPromptRole","onSubmit","promptRole","promptPrefix","hidePromptType","Select","handleOnSelectType","SelectTrigger","SelectItem","Textarea","CreatePromptCard","memo","thread","toast","error","Card","PromptForm","toSchemaItem","parent","result","generateUUID","initialX","schema","schemaItems","createSchema","NewOrUpdateField","setData","currentRow","empty","handleChangeName","previous","setEmpty","handleChangeDescription","handleChangeType","handleChangeRequired","handleChangeEnum","items","previousData","func","shouldShowChildData","FieldList","handleAddNew","Accordion","row","AccordionItem","AccordionTrigger","AccordionContent","useCreateSchema","createCSVData","encodedData","encodeCSVData","headers","csvData","ExampleTable","Table","TableRow","TableHead","TableBody","TableCell","prevData","output","handleCreateCSVData","CardContent","setOutput","useCreateTool","createOrUpdateFlowEdge","tool","toolNode","CreateToolCard","description","setDescription","createTool","useCreateVectorDatabase","textSplitter","VectorDatabaseTypeEnum","VectorDatabaseProviderEnum","vectorDatabase","vectorDatabaseNode","VectorDatabaseStorageEnum","databaseSource","encodeSplitter","databaseSourceNode","SUPPORTED_VECTOR_DATABASE_PROVIDERS","SUPPORTED_TEXT_SPLITTERS","SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE","handleOnSelectStorageType","setStorageType","handleOnSelectTextSplitter","prev","handleOnChangeName","handleOnChangeChunkOverlap","createVectorDatabase","setTextSplitter","storageType","CardFooter","DataTable","setText","text","SupportedAddNodeEnum","SUPPORTED_MODES","getContainer","existingContainer","container","instanceCounter","autoAddParticle","size","sizes","spinVal","spinSpeed","left","mouseX","circle","svgNS","circleSVG","particle","particles","speedUp","refreshParticles","animationFrame","particleGenerationDelay","limit","currentTime","lastParticleTimestamp","tapEnd","isTouchInteraction","updateMousePosition","mouseY","move","tap","tapHandler","element","disableAutoAddParticle","interval","CoolMode","applyParticleEffect","theme","menu","Logo","mode","setMode","child","modeToComponent","CreateLLMCard","CreateSchemaCard","CreateFewShotExampleCard","CreateTextDataCard","useCreateStandaloneSession","useNavigate","newSession","newEntityIDMap","newFlowNodeIDMap","entity","flowNodeTypeToEntity","entityName","cloneEntity","currentFlowNode","cloneFlowNode","createStandaloneSession","SessionTypeEnum","SessionStatusEnum","mainNodeInfo","cloneNode","standaloneSession","connectedNodes","connectedNode","connections","sourceId","targetId","connection","navigate","useDeleteNodeFlow","updateNode","updateEdges","deleteNodeFlow","edges","edge","CreateStandaloneApplicationDialog","NodeHeader","enableToStandalone","deleting","handleDelete","getNode","getLinkedConnections","currentNode","DefaultHandle","useCreateThread","createThread","flowNode","flowEdge","loadingModel","setLoadingModel","queringThreads","setQueringThreads","useLoadModel","creatingThread","updateNodes","queryThreadsFromModel","In","loadModel","initProgress","llmNodeChanges","getNodes","handleCreateThread","changeLLMOptions","handleLoadModel","handlerFunction","newTargetConnection","deleteElements","useReactFlow","useHandleConnections","newConnections","edgeId","setHandling","handlingConnections","setNewTargetConnection","response","removeEdgeIds","connectionHandler","useConnectionToHandler","useBaseConnectionToHandler","handleConnectionTo","llmInfo","isLoading","n","ModelManager","models","prebuiltAppConfig","hasModelInCache","hasCache","onChangeOptions","llmIcon","queryThreads","actions","BorderBeam","isConnectable","tags","AIInput","threadConversationTraveling","list","nodes","functions","runningNodes","nodeConnections","handledIds","prepareThreadConnections","threadNode","threadConnections","threadPromptNodeResult","threadPromptNodes","promptConnectedNodes","threadToolsNodes","threadConnectionInfos","threadToolNodeResult","toolConnectedNodes","threadPlaceholderNodes","threadPlaceholderNodeResult","placeholderConnectedNodes","schemaNode","message","HumanMessage","AIMessage","content","decodeCSVData","rows","key","histories","SystemMessage","prepareThreadHistory","messageNodes","systems","threadPromptNode","buildHistories","toLocalLLMToolCallingInput","tools","all","toolEntity","toolSchemaEnity","useFlowEmbeddingNode","getFlowEmbeddingNode","getFlowEmbeddingEntity","useCreateMessage","insertMessages","initialLLMId","humanMessage","currenSession","humanMessageNode","aiMessage","aiMessageNode","handlePlaceholders","messagesInfo","threadConnection","placeholders","placeholderRecord","FlowNodePlaceholderTypeEnum","vectorNode","vector","minimalScore","documents","getHandleConnections","similaritySearchWithScoreFunction","dataSource","getStorageDataSource","template","PromptTemplate","score","doc","injectedMessages","invokeMessage","threadConversionNodes","onMessageUpdate","llmEntity","MessageHistory","prompts","schemaEntities","schemas","stream","messages","createMessage","info","omitBy","createMessageFunction","linkedConnections","ThreadNode","showThread","setShowThread","useActions","handleCreateMessage","targetConnections","Badge","handleNewThread","inner","NewMessageCard","HumanMessageComponent","onNewThread","AlertTitle","AlertDescription","AIMessageComponent","isError","MarkdownViewer","Suspense","messageMetadata","isUndefined","newMessage","newMessageNode","edgeToNewMessage","edgeToPrompt","useCreateIdieMessage","MessageNode","handleCopy","handleSpeech","textToSpeech","setSpeaking","newMessageCard","isEnd","Position","createIdieMessage","targetEntity","sourceEntity","viewDetailDialog","ViewDataDetailDialog","regex","match","isOverLimit","handleOpenDetail","promptArguments","argument","bytes","cachedModdels","latestUpdate","setLatestUpdate","usedBytes","setCountInfo","setCachedModels","url","fetchSessionInfo","estimate","setUsedBytes","acc","maxUpdatedAt","threads","llms","jsonlDatas","csvDatas","handleReload","dayjs","SchemaNode","loadingRef","Tabs","TabsTrigger","TabsContent","convertToZodSchemaString","CSVDataNode","csv","decodeLine","DataViewer","EmbeddingSetting","show","setShow","setOptions","setEncrypted","decrypted","hanleSubmit","SYSTEM_NODE_IDS","inputEncrypted","changes","flowNodePlaceholder","currentSessionId","modelName","DEFAULT_PROMPT","CreateVectorDatabasePromptDialog","useCreatePrompt","Dialog","DialogContent","useCreateVectorDatabaseRetriever","createVectorDatabaseRetriever","systempPrompt","systemPromptNode","metadata","retriever","retrieverNode","CreateVectorDatabaseRetrieverDialog","setK","setMinimalScore","handleOnChangeK","handleOnChangeMinimalScore","indexFunction","useEmbedding","Document","similaritySearchWithScore","embbedingEntity","indexData","dataSourceNode","dataSourceType","chunk","partDocuments","updatedDataNode","handledCount","chunkedDocuments","VectorDatabaseNode","createPromptDialog","CreatePromptDialog","createRetrieverDialog","CreateRetrieverDialog","handleSimilaritySearch","handleCreatePrompt","handleIndexPDF","file","reader","handleCreateData","blob","pdfjs","setProgress","vectorDatabaseData","lines","renderContent","VectorSearch","handleCreateRetriever","IndexNewText","IndexNewFile","progress","LIMIT_LENGTH_BY_COLUMNS","JSONLDataNode","jsonl","DEFAULT_MAGNIFICATION","DEFAULT_DISTANCE","dockVariants","cva","React","magnification","distance","renderChildren","DockIcon","motion","Dock","distanceCalc","val","bounds","widthSync","useSpring","width","createNode","nodeType","nodeData","DEFAULT_NODE_SIZE","handleAddNode","Tooltip","TooltipTrigger","Icon","Separator","DATA","TooltipContent","DefaultNodeResizer","lineClassName","handleClassName","rest","NodeResizer","ShapeNode","selected","CircleNode","TriangleNode","height","refDebounce","useLLM","updateEditorContent","llmConnection","llmNode","PlateAppEditor","lazy","EditorAppNode","handleChangeContent","placeholder","SOURCE_BASES","getSourceBase","sourceBase","module","CreateSourcebaseCard","sourcebase","setSourcebase","onUpdateSourceBase","updateCodeContainerData","parseFileSystemTreeToJSONL","onResponseMessageCreate","formatedMessages","parseJSONLToFileSystemTree","sendMessage","handleUpdateCodeContainerData","tree","handleSendMessage","handleUpdateCodeContainerFile","setFileSystemTree","nodeTypes","LLMNode","ToolbarNode","ToolNode","EmbeddingNode","ApplicationBarNode","Toggle","variant","TogglePrimitive.Root","toggleVariants","React.createContext","ToggleGroupPrimitive.Root","ToggleGroupContext","ToggleGroup","React.useContext","ToggleGroupPrimitive.Item","ViewportLogger","viewport","useStore","change","type","ChangeLogger","store","useStoreApi","handleNodeChanges","setChanges","prevChanges","newChanges","NoChanges","NodeInspector","getInternalNode","ViewportPortal","internalNode","absPosition","absoluteTransform","formattedPosition","selectionStatus","formattedDimensions","DevToolsToggle","Panel","active","setActive","label","ToggleGroupItem","DevTools","nodeInspectorActive","setNodeInspectorActive","changeLoggerActive","setChangeLoggerActive","viewportLoggerActive","setViewportLoggerActive","updatePositionRef","flowEdges","setNodes","addConnectionToEdges","findFlowEdges","deleteFlowNode","deleteFlowEdge","updateFlowNode","flowEdgesRef","currentSessionIdRef","loadingState","setLoadingState","prepareFlowInfo","query","findFlowNodesWithSource","flowNodes","handler","updateDimensionsRef","updateEdgeConnection","updatingNode","deepmerge","applyNodeChanges","addOnNodeChangeHandler","onNodesChangesRef","updateNodeChanges","updateEdgeChanges","useAutomaticallyRenderFlows","flowManager","flowNodesRef","flowStateReady","initFlow","syncNodeQueue","previousSyncNodeQueue","lastTimestamps","handlingQueueItems","unsubEdgeHandler","syncEdgeQueue","previousSyncEdgeQueue","removeSyncEdgeQueue","unsubNodeHandler","removeSyncNodeQueue","useHomePage","initializing","useFlowManager","selectedModelRef","setInitProgressCallback","updateOrCreateNode","nodeRefs","callbackRemoval","setInitializing","HomeInner","useAppState","onNodesChange","onEdgesChange","onConnect","PanOnScrollMode","Background","Controls"],"ignoreList":[0,1,2,3,4,5,9,13,14],"sources":["../../node_modules/framer-motion/dist/es/value/use-motion-value.mjs","../../node_modules/framer-motion/dist/es/value/use-combine-values.mjs","../../node_modules/framer-motion/dist/es/value/use-spring.mjs","../../node_modules/framer-motion/dist/es/utils/transform.mjs","../../node_modules/framer-motion/dist/es/value/use-computed.mjs","../../node_modules/framer-motion/dist/es/value/use-transform.mjs","../../src/services/database/types/message.ts","../../src/services/database/types/thread.ts","../../src/services/database/types/prompt.ts","../../node_modules/@radix-ui/react-menubar/dist/index.mjs","../../src/lib/shadcn/ui/menubar.tsx","../../src/states/flow/index.ts","../../src/hooks/flows/mutations/use-create-llm.ts","../../node_modules/cmdk/dist/chunk-NZJY6EH4.mjs","../../node_modules/cmdk/dist/index.mjs","../../src/lib/shadcn/ui/command.tsx","../../src/lib/shadcn/ui/checkbox.tsx","../../src/constants/llm.ts","../../src/components/molecules/CreateLLMCard/constants.ts","../../src/components/dialogs/CreateSessionPassphraseDialog/index.tsx","../../src/hooks/mutations/use-update-session-passphrase.ts","../../src/hooks/mutations/use-confirm-or-create-passphrase.ts","../../src/components/molecules/CreateLLMCard/index.tsx","../../src/hooks/flows/mutations/use-create-prompt.ts","../../src/components/molecules/CreatePromptCard/constants.ts","../../src/components/molecules/CreatePromptCard/PromptForm.tsx","../../src/components/molecules/CreatePromptCard/index.tsx","../../src/hooks/flows/mutations/use-create-schema.ts","../../src/components/molecules/CreateSchemaCard/Field/NewOrUpdateField.tsx","../../src/components/molecules/CreateSchemaCard/Field/FieldList.tsx","../../src/components/molecules/CreateSchemaCard/index.tsx","../../src/hooks/flows/mutations/use-create-csv-data.ts","../../src/components/molecules/CreateFewShotExampleCard/ExampleTable/index.tsx","../../src/components/molecules/CreateFewShotExampleCard/index.tsx","../../src/hooks/flows/mutations/use-create-tool.ts","../../src/components/molecules/CreateToolCard/index.tsx","../../src/hooks/flows/mutations/use-create-vector-database.ts","../../src/components/molecules/CreateVectorDatabaseCard/constants.ts","../../src/components/molecules/CreateVectorDatabaseCard/index.tsx","../../src/components/molecules/CreateTextDataCard/DataTable/index.tsx","../../src/components/molecules/CreateTextDataCard/index.tsx","../../src/components/flows/Nodes/ToolboxNode/constants.ts","../../src/lib/shadcn/ui/cool-mode.tsx","../../src/components/flows/Nodes/ToolboxNode/ToolBarNode.tsx","../../src/hooks/mutations/use-create-standalone-session.ts","../../src/hooks/flows/mutations/use-delete-node-flow.ts","../../src/components/dialogs/CreateStandaloneApplicationDialog/index.tsx","../../src/components/flows/NodeHeader/NodeHeader.tsx","../../src/components/flows/DefaultHandle/DefaultHandle.tsx","../../src/hooks/flows/mutations/use-create-thread.ts","../../src/components/flows/Nodes/LLMNode/hooks/use-actions.ts","../../src/hooks/flows/handlers/use-base-connection-to-handler.ts","../../src/components/flows/Nodes/LLMNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/LLMNode/LLMNode.tsx","../../src/components/molecules/NewMessageCard/index.tsx","../../src/utils/thread-conversation-traveling.ts","../../src/utils/build-message-history.ts","../../src/utils/flow-to-local-llm.ts","../../src/hooks/flows/use-flow-embedding-node.ts","../../src/hooks/flows/mutations/use-create-message.ts","../../src/components/flows/Nodes/ThreadNode/hooks/use-actions.ts","../../src/components/flows/Nodes/ThreadNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/ThreadNode/ThreadNode.tsx","../../src/components/flows/Nodes/MessageNode/components/HumanMessage.tsx","../../src/components/flows/Nodes/MessageNode/components/AIMessage.tsx","../../src/components/flows/Nodes/MessageNode/hooks/use-actions.ts","../../src/hooks/flows/mutations/use-create-idie-message.ts","../../src/components/flows/Nodes/MessageNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/MessageNode/MessageNode.tsx","../../src/components/flows/Nodes/PromptNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/PromptNode/PromptNode.tsx","../../src/utils/bytes-format.ts","../../src/components/flows/Nodes/SessionInfoNode/SessionInfoNode.tsx","../../src/components/flows/Nodes/SchemaNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/SchemaNode/SchemaNode.tsx","../../src/components/flows/Nodes/CSVDataNode/CSVDataNode.tsx","../../src/components/flows/Nodes/ToolNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/ToolNode/ToolNode.tsx","../../src/components/atoms/EmbeddingSetting.tsx","../../src/components/flows/Nodes/EmbeddingNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/EmbeddingNode/hooks/use-actions.ts","../../src/components/flows/Nodes/EmbeddingNode/EmbeddingNode.tsx","../../src/components/dialogs/CreateVectorDatabasePromptDialog/index.tsx","../../src/hooks/flows/mutations/use-create-vector-database-retriever.ts","../../src/components/dialogs/CreateVectorDatabaseRetrieverDialog/index.tsx","../../src/components/flows/Nodes/VectorDatabaseNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/VectorDatabaseNode/hooks/use-actions.ts","../../src/components/flows/Nodes/VectorDatabaseNode/VectorDatabaseNode.tsx","../../src/components/flows/Nodes/JSONLDataNode/JSONLDataNode.tsx","../../src/lib/shadcn/ui/dock.tsx","../../src/components/flows/Nodes/ApplicationBarNode/constants.ts","../../src/components/flows/Nodes/ApplicationBarNode/hooks/use-actions.ts","../../src/components/flows/Nodes/ApplicationBarNode/ApplicationBarNode.tsx","../../src/components/flows/DefaultNodeResizer/DefaultNodeResizer.tsx","../../src/components/flows/Nodes/ShapeNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/ShapeNode/ShapeNode.tsx","../../src/components/flows/Nodes/CircleNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/CircleNode/CircleNode.tsx","../../src/components/flows/Nodes/TriangleNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/TriangleNode/TriangleNode.tsx","../../src/components/flows/Nodes/EditorAppNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/EditorAppNode/hooks/use-actions.ts","../../src/components/flows/Nodes/EditorAppNode/EditorAppNode.tsx","../../src/components/flows/Nodes/PlaceholderNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/PlaceholderNode/PlaceholderNode.tsx","../../src/services/web-container/source-bases/index.ts","../../src/components/molecules/CreateSourcebaseCard/index.tsx","../../src/components/flows/Nodes/VSLiteAppNode/hooks/use-actions.ts","../../src/components/flows/Nodes/VSLiteAppNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/VSLiteAppNode/VSLiteAppNode.tsx","../../src/components/flows/Nodes/index.tsx","../../src/lib/shadcn/ui/toggle.tsx","../../src/lib/shadcn/ui/toggle-group.tsx","../../src/lib/shadcn/devtools.tsx","../../src/hooks/flows/handlers/use-flow-manager.ts","../../src/hooks/flows/handlers/use-automatically-render-flow.ts","../../src/components/pages/Home/hooks/use-home-page.ts","../../src/components/pages/Home/Home.tsx"],"sourcesContent":["import { motionValue } from 'motion-dom';\nimport { useContext, useState, useEffect } from 'react';\nimport { MotionConfigContext } from '../context/MotionConfigContext.mjs';\nimport { useConstant } from '../utils/use-constant.mjs';\n\n/**\n * Creates a `MotionValue` to track the state and velocity of a value.\n *\n * Usually, these are created automatically. For advanced use-cases, like use with `useTransform`, you can create `MotionValue`s externally and pass them into the animated component via the `style` prop.\n *\n * ```jsx\n * export const MyComponent = () => {\n *   const scale = useMotionValue(1)\n *\n *   return <motion.div style={{ scale }} />\n * }\n * ```\n *\n * @param initial - The initial state.\n *\n * @public\n */\nfunction useMotionValue(initial) {\n    const value = useConstant(() => motionValue(initial));\n    /**\n     * If this motion value is being used in static mode, like on\n     * the Framer canvas, force components to rerender when the motion\n     * value is updated.\n     */\n    const { isStatic } = useContext(MotionConfigContext);\n    if (isStatic) {\n        const [, setLatest] = useState(initial);\n        useEffect(() => value.on(\"change\", setLatest), []);\n    }\n    return value;\n}\n\nexport { useMotionValue };\n","import { cancelFrame, frame } from 'motion-dom';\nimport { useIsomorphicLayoutEffect } from '../utils/use-isomorphic-effect.mjs';\nimport { useMotionValue } from './use-motion-value.mjs';\n\nfunction useCombineMotionValues(values, combineValues) {\n    /**\n     * Initialise the returned motion value. This remains the same between renders.\n     */\n    const value = useMotionValue(combineValues());\n    /**\n     * Create a function that will update the template motion value with the latest values.\n     * This is pre-bound so whenever a motion value updates it can schedule its\n     * execution in Framesync. If it's already been scheduled it won't be fired twice\n     * in a single frame.\n     */\n    const updateValue = () => value.set(combineValues());\n    /**\n     * Synchronously update the motion value with the latest values during the render.\n     * This ensures that within a React render, the styles applied to the DOM are up-to-date.\n     */\n    updateValue();\n    /**\n     * Subscribe to all motion values found within the template. Whenever any of them change,\n     * schedule an update.\n     */\n    useIsomorphicLayoutEffect(() => {\n        const scheduleUpdate = () => frame.preRender(updateValue, false, true);\n        const subscriptions = values.map((v) => v.on(\"change\", scheduleUpdate));\n        return () => {\n            subscriptions.forEach((unsubscribe) => unsubscribe());\n            cancelFrame(updateValue);\n        };\n    });\n    return value;\n}\n\nexport { useCombineMotionValues };\n","import { frame } from 'motion-dom';\nimport { noop } from 'motion-utils';\nimport { useContext, useRef, useInsertionEffect } from 'react';\nimport { animateValue } from '../animation/animators/MainThreadAnimation.mjs';\nimport { MotionConfigContext } from '../context/MotionConfigContext.mjs';\nimport { useConstant } from '../utils/use-constant.mjs';\nimport { useIsomorphicLayoutEffect } from '../utils/use-isomorphic-effect.mjs';\nimport { useMotionValue } from './use-motion-value.mjs';\nimport { isMotionValue } from './utils/is-motion-value.mjs';\n\nfunction useSpring(source, config = {}) {\n    const { isStatic } = useContext(MotionConfigContext);\n    const activeSpringAnimation = useRef(null);\n    const initialValue = useConstant(() => isMotionValue(source) ? source.get() : source);\n    const unit = useConstant(() => typeof initialValue === \"string\"\n        ? initialValue.replace(/[\\d.-]/g, \"\")\n        : undefined);\n    const value = useMotionValue(initialValue);\n    const latestValue = useRef(initialValue);\n    const latestSetter = useRef(noop);\n    const startAnimation = () => {\n        stopAnimation();\n        activeSpringAnimation.current = animateValue({\n            keyframes: [asNumber(value.get()), asNumber(latestValue.current)],\n            velocity: value.getVelocity(),\n            type: \"spring\",\n            restDelta: 0.001,\n            restSpeed: 0.01,\n            ...config,\n            onUpdate: latestSetter.current,\n        });\n    };\n    const stopAnimation = () => {\n        if (activeSpringAnimation.current) {\n            activeSpringAnimation.current.stop();\n        }\n    };\n    useInsertionEffect(() => {\n        return value.attach((v, set) => {\n            if (isStatic)\n                return set(v);\n            latestValue.current = v;\n            latestSetter.current = (latest) => set(parseValue(latest, unit));\n            frame.postRender(startAnimation);\n            return value.get();\n        }, stopAnimation);\n    }, [JSON.stringify(config)]);\n    useIsomorphicLayoutEffect(() => {\n        if (isMotionValue(source)) {\n            return source.on(\"change\", (v) => value.set(parseValue(v, unit)));\n        }\n    }, [value, unit]);\n    return value;\n}\nfunction parseValue(v, unit) {\n    return unit ? v + unit : v;\n}\nfunction asNumber(v) {\n    return typeof v === \"number\" ? v : parseFloat(v);\n}\n\nexport { useSpring };\n","import { interpolate } from './interpolate.mjs';\n\nconst isCustomValueType = (v) => {\n    return v && typeof v === \"object\" && v.mix;\n};\nconst getMixer = (v) => (isCustomValueType(v) ? v.mix : undefined);\nfunction transform(...args) {\n    const useImmediate = !Array.isArray(args[0]);\n    const argOffset = useImmediate ? 0 : -1;\n    const inputValue = args[0 + argOffset];\n    const inputRange = args[1 + argOffset];\n    const outputRange = args[2 + argOffset];\n    const options = args[3 + argOffset];\n    const interpolator = interpolate(inputRange, outputRange, {\n        mixer: getMixer(outputRange[0]),\n        ...options,\n    });\n    return useImmediate ? interpolator(inputValue) : interpolator;\n}\n\nexport { transform };\n","import { collectMotionValues } from 'motion-dom';\nimport { useCombineMotionValues } from './use-combine-values.mjs';\n\nfunction useComputed(compute) {\n    /**\n     * Open session of collectMotionValues. Any MotionValue that calls get()\n     * will be saved into this array.\n     */\n    collectMotionValues.current = [];\n    compute();\n    const value = useCombineMotionValues(collectMotionValues.current, compute);\n    /**\n     * Synchronously close session of collectMotionValues.\n     */\n    collectMotionValues.current = undefined;\n    return value;\n}\n\nexport { useComputed };\n","import { transform } from '../utils/transform.mjs';\nimport { useConstant } from '../utils/use-constant.mjs';\nimport { useCombineMotionValues } from './use-combine-values.mjs';\nimport { useComputed } from './use-computed.mjs';\n\nfunction useTransform(input, inputRangeOrTransformer, outputRange, options) {\n    if (typeof input === \"function\") {\n        return useComputed(input);\n    }\n    const transformer = typeof inputRangeOrTransformer === \"function\"\n        ? inputRangeOrTransformer\n        : transform(inputRangeOrTransformer, outputRange, options);\n    return Array.isArray(input)\n        ? useListTransform(input, transformer)\n        : useListTransform([input], ([latest]) => transformer(latest));\n}\nfunction useListTransform(values, transformer) {\n    const latest = useConstant(() => []);\n    return useCombineMotionValues(values, () => {\n        latest.length = 0;\n        const numValues = values.length;\n        for (let i = 0; i < numValues; i++) {\n            latest[i] = values[i].get();\n        }\n        return transformer(latest);\n    });\n}\n\nexport { useTransform };\n","export enum MessageStatusEnum {\n  Started = 'started',\n  Inprogress = 'inprogress',\n  Success = 'success',\n  Failed = 'failed',\n}\n\nexport enum MessageRoleEnum {\n  Human = 'human',\n  User = 'user',\n  AI = 'ai',\n  System = 'system',\n  Assistant = 'assistant',\n  Tool = 'tool',\n  FewShotExample = 'few_shot_example',\n}\n","export enum ThreadStatusEnum {\n  Started = 'started',\n  Inprogress = 'inprogress',\n  Done = 'done',\n}\n","export enum PromptStatusEnum {\n  Started = 'started',\n  Fromated = 'fromated',\n}\n\nexport enum PromptTypeEnum {\n  Chat = 'chat',\n  FewShotExample = 'few_shot_example',\n}\n","\"use client\";\n\n// packages/react/menubar/src/Menubar.tsx\nimport * as React from \"react\";\nimport { createCollection } from \"@radix-ui/react-collection\";\nimport { useDirection } from \"@radix-ui/react-direction\";\nimport { composeEventHandlers } from \"@radix-ui/primitive\";\nimport { useComposedRefs } from \"@radix-ui/react-compose-refs\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useId } from \"@radix-ui/react-id\";\nimport * as MenuPrimitive from \"@radix-ui/react-menu\";\nimport { createMenuScope } from \"@radix-ui/react-menu\";\nimport * as RovingFocusGroup from \"@radix-ui/react-roving-focus\";\nimport { createRovingFocusGroupScope } from \"@radix-ui/react-roving-focus\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport { useControllableState } from \"@radix-ui/react-use-controllable-state\";\nimport { jsx } from \"react/jsx-runtime\";\nvar MENUBAR_NAME = \"Menubar\";\nvar [Collection, useCollection, createCollectionScope] = createCollection(MENUBAR_NAME);\nvar [createMenubarContext, createMenubarScope] = createContextScope(MENUBAR_NAME, [\n  createCollectionScope,\n  createRovingFocusGroupScope\n]);\nvar useMenuScope = createMenuScope();\nvar useRovingFocusGroupScope = createRovingFocusGroupScope();\nvar [MenubarContextProvider, useMenubarContext] = createMenubarContext(MENUBAR_NAME);\nvar Menubar = React.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeMenubar,\n      value: valueProp,\n      onValueChange,\n      defaultValue,\n      loop = true,\n      dir,\n      ...menubarProps\n    } = props;\n    const direction = useDirection(dir);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenubar);\n    const [value = \"\", setValue] = useControllableState({\n      prop: valueProp,\n      onChange: onValueChange,\n      defaultProp: defaultValue\n    });\n    const [currentTabStopId, setCurrentTabStopId] = React.useState(null);\n    return /* @__PURE__ */ jsx(\n      MenubarContextProvider,\n      {\n        scope: __scopeMenubar,\n        value,\n        onMenuOpen: React.useCallback(\n          (value2) => {\n            setValue(value2);\n            setCurrentTabStopId(value2);\n          },\n          [setValue]\n        ),\n        onMenuClose: React.useCallback(() => setValue(\"\"), [setValue]),\n        onMenuToggle: React.useCallback(\n          (value2) => {\n            setValue((prevValue) => Boolean(prevValue) ? \"\" : value2);\n            setCurrentTabStopId(value2);\n          },\n          [setValue]\n        ),\n        dir: direction,\n        loop,\n        children: /* @__PURE__ */ jsx(Collection.Provider, { scope: __scopeMenubar, children: /* @__PURE__ */ jsx(Collection.Slot, { scope: __scopeMenubar, children: /* @__PURE__ */ jsx(\n          RovingFocusGroup.Root,\n          {\n            asChild: true,\n            ...rovingFocusGroupScope,\n            orientation: \"horizontal\",\n            loop,\n            dir: direction,\n            currentTabStopId,\n            onCurrentTabStopIdChange: setCurrentTabStopId,\n            children: /* @__PURE__ */ jsx(Primitive.div, { role: \"menubar\", ...menubarProps, ref: forwardedRef })\n          }\n        ) }) })\n      }\n    );\n  }\n);\nMenubar.displayName = MENUBAR_NAME;\nvar MENU_NAME = \"MenubarMenu\";\nvar [MenubarMenuProvider, useMenubarMenuContext] = createMenubarContext(MENU_NAME);\nvar MenubarMenu = (props) => {\n  const { __scopeMenubar, value: valueProp, ...menuProps } = props;\n  const autoValue = useId();\n  const value = valueProp || autoValue || \"LEGACY_REACT_AUTO_VALUE\";\n  const context = useMenubarContext(MENU_NAME, __scopeMenubar);\n  const menuScope = useMenuScope(__scopeMenubar);\n  const triggerRef = React.useRef(null);\n  const wasKeyboardTriggerOpenRef = React.useRef(false);\n  const open = context.value === value;\n  React.useEffect(() => {\n    if (!open) wasKeyboardTriggerOpenRef.current = false;\n  }, [open]);\n  return /* @__PURE__ */ jsx(\n    MenubarMenuProvider,\n    {\n      scope: __scopeMenubar,\n      value,\n      triggerId: useId(),\n      triggerRef,\n      contentId: useId(),\n      wasKeyboardTriggerOpenRef,\n      children: /* @__PURE__ */ jsx(\n        MenuPrimitive.Root,\n        {\n          ...menuScope,\n          open,\n          onOpenChange: (open2) => {\n            if (!open2) context.onMenuClose();\n          },\n          modal: false,\n          dir: context.dir,\n          ...menuProps\n        }\n      )\n    }\n  );\n};\nMenubarMenu.displayName = MENU_NAME;\nvar TRIGGER_NAME = \"MenubarTrigger\";\nvar MenubarTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, disabled = false, ...triggerProps } = props;\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenubar);\n    const menuScope = useMenuScope(__scopeMenubar);\n    const context = useMenubarContext(TRIGGER_NAME, __scopeMenubar);\n    const menuContext = useMenubarMenuContext(TRIGGER_NAME, __scopeMenubar);\n    const ref = React.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref, menuContext.triggerRef);\n    const [isFocused, setIsFocused] = React.useState(false);\n    const open = context.value === menuContext.value;\n    return /* @__PURE__ */ jsx(Collection.ItemSlot, { scope: __scopeMenubar, value: menuContext.value, disabled, children: /* @__PURE__ */ jsx(\n      RovingFocusGroup.Item,\n      {\n        asChild: true,\n        ...rovingFocusGroupScope,\n        focusable: !disabled,\n        tabStopId: menuContext.value,\n        children: /* @__PURE__ */ jsx(MenuPrimitive.Anchor, { asChild: true, ...menuScope, children: /* @__PURE__ */ jsx(\n          Primitive.button,\n          {\n            type: \"button\",\n            role: \"menuitem\",\n            id: menuContext.triggerId,\n            \"aria-haspopup\": \"menu\",\n            \"aria-expanded\": open,\n            \"aria-controls\": open ? menuContext.contentId : void 0,\n            \"data-highlighted\": isFocused ? \"\" : void 0,\n            \"data-state\": open ? \"open\" : \"closed\",\n            \"data-disabled\": disabled ? \"\" : void 0,\n            disabled,\n            ...triggerProps,\n            ref: composedRefs,\n            onPointerDown: composeEventHandlers(props.onPointerDown, (event) => {\n              if (!disabled && event.button === 0 && event.ctrlKey === false) {\n                context.onMenuOpen(menuContext.value);\n                if (!open) event.preventDefault();\n              }\n            }),\n            onPointerEnter: composeEventHandlers(props.onPointerEnter, () => {\n              const menubarOpen = Boolean(context.value);\n              if (menubarOpen && !open) {\n                context.onMenuOpen(menuContext.value);\n                ref.current?.focus();\n              }\n            }),\n            onKeyDown: composeEventHandlers(props.onKeyDown, (event) => {\n              if (disabled) return;\n              if ([\"Enter\", \" \"].includes(event.key)) context.onMenuToggle(menuContext.value);\n              if (event.key === \"ArrowDown\") context.onMenuOpen(menuContext.value);\n              if ([\"Enter\", \" \", \"ArrowDown\"].includes(event.key)) {\n                menuContext.wasKeyboardTriggerOpenRef.current = true;\n                event.preventDefault();\n              }\n            }),\n            onFocus: composeEventHandlers(props.onFocus, () => setIsFocused(true)),\n            onBlur: composeEventHandlers(props.onBlur, () => setIsFocused(false))\n          }\n        ) })\n      }\n    ) });\n  }\n);\nMenubarTrigger.displayName = TRIGGER_NAME;\nvar PORTAL_NAME = \"MenubarPortal\";\nvar MenubarPortal = (props) => {\n  const { __scopeMenubar, ...portalProps } = props;\n  const menuScope = useMenuScope(__scopeMenubar);\n  return /* @__PURE__ */ jsx(MenuPrimitive.Portal, { ...menuScope, ...portalProps });\n};\nMenubarPortal.displayName = PORTAL_NAME;\nvar CONTENT_NAME = \"MenubarContent\";\nvar MenubarContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, align = \"start\", ...contentProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    const context = useMenubarContext(CONTENT_NAME, __scopeMenubar);\n    const menuContext = useMenubarMenuContext(CONTENT_NAME, __scopeMenubar);\n    const getItems = useCollection(__scopeMenubar);\n    const hasInteractedOutsideRef = React.useRef(false);\n    return /* @__PURE__ */ jsx(\n      MenuPrimitive.Content,\n      {\n        id: menuContext.contentId,\n        \"aria-labelledby\": menuContext.triggerId,\n        \"data-radix-menubar-content\": \"\",\n        ...menuScope,\n        ...contentProps,\n        ref: forwardedRef,\n        align,\n        onCloseAutoFocus: composeEventHandlers(props.onCloseAutoFocus, (event) => {\n          const menubarOpen = Boolean(context.value);\n          if (!menubarOpen && !hasInteractedOutsideRef.current) {\n            menuContext.triggerRef.current?.focus();\n          }\n          hasInteractedOutsideRef.current = false;\n          event.preventDefault();\n        }),\n        onFocusOutside: composeEventHandlers(props.onFocusOutside, (event) => {\n          const target = event.target;\n          const isMenubarTrigger = getItems().some((item) => item.ref.current?.contains(target));\n          if (isMenubarTrigger) event.preventDefault();\n        }),\n        onInteractOutside: composeEventHandlers(props.onInteractOutside, () => {\n          hasInteractedOutsideRef.current = true;\n        }),\n        onEntryFocus: (event) => {\n          if (!menuContext.wasKeyboardTriggerOpenRef.current) event.preventDefault();\n        },\n        onKeyDown: composeEventHandlers(\n          props.onKeyDown,\n          (event) => {\n            if ([\"ArrowRight\", \"ArrowLeft\"].includes(event.key)) {\n              const target = event.target;\n              const targetIsSubTrigger = target.hasAttribute(\"data-radix-menubar-subtrigger\");\n              const isKeyDownInsideSubMenu = target.closest(\"[data-radix-menubar-content]\") !== event.currentTarget;\n              const prevMenuKey = context.dir === \"rtl\" ? \"ArrowRight\" : \"ArrowLeft\";\n              const isPrevKey = prevMenuKey === event.key;\n              const isNextKey = !isPrevKey;\n              if (isNextKey && targetIsSubTrigger) return;\n              if (isKeyDownInsideSubMenu && isPrevKey) return;\n              const items = getItems().filter((item) => !item.disabled);\n              let candidateValues = items.map((item) => item.value);\n              if (isPrevKey) candidateValues.reverse();\n              const currentIndex = candidateValues.indexOf(menuContext.value);\n              candidateValues = context.loop ? wrapArray(candidateValues, currentIndex + 1) : candidateValues.slice(currentIndex + 1);\n              const [nextValue] = candidateValues;\n              if (nextValue) context.onMenuOpen(nextValue);\n            }\n          },\n          { checkForDefaultPrevented: false }\n        ),\n        style: {\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            \"--radix-menubar-content-transform-origin\": \"var(--radix-popper-transform-origin)\",\n            \"--radix-menubar-content-available-width\": \"var(--radix-popper-available-width)\",\n            \"--radix-menubar-content-available-height\": \"var(--radix-popper-available-height)\",\n            \"--radix-menubar-trigger-width\": \"var(--radix-popper-anchor-width)\",\n            \"--radix-menubar-trigger-height\": \"var(--radix-popper-anchor-height)\"\n          }\n        }\n      }\n    );\n  }\n);\nMenubarContent.displayName = CONTENT_NAME;\nvar GROUP_NAME = \"MenubarGroup\";\nvar MenubarGroup = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...groupProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Group, { ...menuScope, ...groupProps, ref: forwardedRef });\n  }\n);\nMenubarGroup.displayName = GROUP_NAME;\nvar LABEL_NAME = \"MenubarLabel\";\nvar MenubarLabel = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...labelProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Label, { ...menuScope, ...labelProps, ref: forwardedRef });\n  }\n);\nMenubarLabel.displayName = LABEL_NAME;\nvar ITEM_NAME = \"MenubarItem\";\nvar MenubarItem = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...itemProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Item, { ...menuScope, ...itemProps, ref: forwardedRef });\n  }\n);\nMenubarItem.displayName = ITEM_NAME;\nvar CHECKBOX_ITEM_NAME = \"MenubarCheckboxItem\";\nvar MenubarCheckboxItem = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...checkboxItemProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.CheckboxItem, { ...menuScope, ...checkboxItemProps, ref: forwardedRef });\n  }\n);\nMenubarCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\nvar RADIO_GROUP_NAME = \"MenubarRadioGroup\";\nvar MenubarRadioGroup = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...radioGroupProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.RadioGroup, { ...menuScope, ...radioGroupProps, ref: forwardedRef });\n  }\n);\nMenubarRadioGroup.displayName = RADIO_GROUP_NAME;\nvar RADIO_ITEM_NAME = \"MenubarRadioItem\";\nvar MenubarRadioItem = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...radioItemProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.RadioItem, { ...menuScope, ...radioItemProps, ref: forwardedRef });\n  }\n);\nMenubarRadioItem.displayName = RADIO_ITEM_NAME;\nvar INDICATOR_NAME = \"MenubarItemIndicator\";\nvar MenubarItemIndicator = React.forwardRef((props, forwardedRef) => {\n  const { __scopeMenubar, ...itemIndicatorProps } = props;\n  const menuScope = useMenuScope(__scopeMenubar);\n  return /* @__PURE__ */ jsx(MenuPrimitive.ItemIndicator, { ...menuScope, ...itemIndicatorProps, ref: forwardedRef });\n});\nMenubarItemIndicator.displayName = INDICATOR_NAME;\nvar SEPARATOR_NAME = \"MenubarSeparator\";\nvar MenubarSeparator = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...separatorProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Separator, { ...menuScope, ...separatorProps, ref: forwardedRef });\n  }\n);\nMenubarSeparator.displayName = SEPARATOR_NAME;\nvar ARROW_NAME = \"MenubarArrow\";\nvar MenubarArrow = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...arrowProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Arrow, { ...menuScope, ...arrowProps, ref: forwardedRef });\n  }\n);\nMenubarArrow.displayName = ARROW_NAME;\nvar SUB_NAME = \"MenubarSub\";\nvar MenubarSub = (props) => {\n  const { __scopeMenubar, children, open: openProp, onOpenChange, defaultOpen } = props;\n  const menuScope = useMenuScope(__scopeMenubar);\n  const [open = false, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange\n  });\n  return /* @__PURE__ */ jsx(MenuPrimitive.Sub, { ...menuScope, open, onOpenChange: setOpen, children });\n};\nMenubarSub.displayName = SUB_NAME;\nvar SUB_TRIGGER_NAME = \"MenubarSubTrigger\";\nvar MenubarSubTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...subTriggerProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(\n      MenuPrimitive.SubTrigger,\n      {\n        \"data-radix-menubar-subtrigger\": \"\",\n        ...menuScope,\n        ...subTriggerProps,\n        ref: forwardedRef\n      }\n    );\n  }\n);\nMenubarSubTrigger.displayName = SUB_TRIGGER_NAME;\nvar SUB_CONTENT_NAME = \"MenubarSubContent\";\nvar MenubarSubContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...subContentProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(\n      MenuPrimitive.SubContent,\n      {\n        ...menuScope,\n        \"data-radix-menubar-content\": \"\",\n        ...subContentProps,\n        ref: forwardedRef,\n        style: {\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            \"--radix-menubar-content-transform-origin\": \"var(--radix-popper-transform-origin)\",\n            \"--radix-menubar-content-available-width\": \"var(--radix-popper-available-width)\",\n            \"--radix-menubar-content-available-height\": \"var(--radix-popper-available-height)\",\n            \"--radix-menubar-trigger-width\": \"var(--radix-popper-anchor-width)\",\n            \"--radix-menubar-trigger-height\": \"var(--radix-popper-anchor-height)\"\n          }\n        }\n      }\n    );\n  }\n);\nMenubarSubContent.displayName = SUB_CONTENT_NAME;\nfunction wrapArray(array, startIndex) {\n  return array.map((_, index) => array[(startIndex + index) % array.length]);\n}\nvar Root3 = Menubar;\nvar Menu = MenubarMenu;\nvar Trigger = MenubarTrigger;\nvar Portal2 = MenubarPortal;\nvar Content2 = MenubarContent;\nvar Group2 = MenubarGroup;\nvar Label2 = MenubarLabel;\nvar Item3 = MenubarItem;\nvar CheckboxItem2 = MenubarCheckboxItem;\nvar RadioGroup2 = MenubarRadioGroup;\nvar RadioItem2 = MenubarRadioItem;\nvar ItemIndicator2 = MenubarItemIndicator;\nvar Separator2 = MenubarSeparator;\nvar Arrow2 = MenubarArrow;\nvar Sub2 = MenubarSub;\nvar SubTrigger2 = MenubarSubTrigger;\nvar SubContent2 = MenubarSubContent;\nexport {\n  Arrow2 as Arrow,\n  CheckboxItem2 as CheckboxItem,\n  Content2 as Content,\n  Group2 as Group,\n  Item3 as Item,\n  ItemIndicator2 as ItemIndicator,\n  Label2 as Label,\n  Menu,\n  Menubar,\n  MenubarArrow,\n  MenubarCheckboxItem,\n  MenubarContent,\n  MenubarGroup,\n  MenubarItem,\n  MenubarItemIndicator,\n  MenubarLabel,\n  MenubarMenu,\n  MenubarPortal,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarSeparator,\n  MenubarSub,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarTrigger,\n  Portal2 as Portal,\n  RadioGroup2 as RadioGroup,\n  RadioItem2 as RadioItem,\n  Root3 as Root,\n  Separator2 as Separator,\n  Sub2 as Sub,\n  SubContent2 as SubContent,\n  SubTrigger2 as SubTrigger,\n  Trigger,\n  createMenubarScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from 'react'\nimport * as MenubarPrimitive from '@radix-ui/react-menubar'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { cn } from 'src/lib/utils'\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      'flex h-10 items-center space-x-1 rounded-md border bg-background p-1',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      'flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      'flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',\n      inset && 'pl-8',\n      className,\n    )}\n    {...props}\n  >\n    {children}\n    <LazyIcon name=\"chevron-right\" className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      'z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(({ className, align = 'start', alignOffset = -4, sideOffset = 8, ...props }, ref) => (\n  <MenubarPrimitive.Portal>\n    <MenubarPrimitive.Content\n      ref={ref}\n      align={align}\n      alignOffset={alignOffset}\n      sideOffset={sideOffset}\n      className={cn(\n        'z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',\n        className,\n      )}\n      {...props}\n    />\n  </MenubarPrimitive.Portal>\n))\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      inset && 'pl-8',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      className,\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <LazyIcon name=\"check\" className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      className,\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <LazyIcon name=\"circle\" className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn('px-2 py-1.5 text-sm font-semibold', inset && 'pl-8', className)}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn('-mx-1 my-1 h-px bg-muted', className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn('ml-auto text-xs tracking-widest text-muted-foreground', className)}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = 'MenubarShortcut'\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","import { create } from 'zustand'\nimport { devtools, subscribeWithSelector } from 'zustand/middleware'\nimport { FlowStateActions, getFlowStateActions } from './actions'\nimport { FlowState, defaultFlowState } from './state'\n\nexport const useFlowState = create<FlowState & FlowStateActions>()(\n  subscribeWithSelector(\n    devtools((set, get) => ({\n      ...defaultFlowState,\n      ...getFlowStateActions(set, get),\n    })),\n  ),\n)\n","import { useCallback, useState } from 'react'\nimport { Node } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  LLM,\n  LLMModelTypeEnum,\n  LLMProviderEnum,\n  LLMStatusEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateLLM = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n\n  const pushSyncNodeQueue = useFlowState((state) => state.pushSyncNodeQueue)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createLLM = useCallback(\n    async (source: Node, record: Partial<LLM>) => {\n      try {\n        if (!sessionId) {\n          throw new Error('Session not found')\n        }\n        if (!record.provider || !record.name) {\n          throw new Error('Provider and name are required')\n        }\n        setLoading(true)\n        const existed = await getRepository('LLM').findOne({\n          where: {\n            name: record.name,\n            session_id: sessionId,\n          },\n        })\n        if (existed) {\n          pushSyncNodeQueue('LLM', {\n            where: {\n              source_type: 'LLM',\n              source_id: existed.id,\n            },\n          })\n          return existed\n        }\n        return getRepository('LLM')\n          .save({\n            name: `${record.name}`,\n            // NOTE: No need to load cloud LLM\n            status: [LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(\n              record.provider as LLMProviderEnum,\n            )\n              ? LLMStatusEnum.Started\n              : LLMStatusEnum.Loaded,\n            session_id: sessionId,\n            provider: record.provider,\n            metadata: JSON.stringify(record.metadata || {}),\n            model_type: record.model_type || LLMModelTypeEnum.LLM,\n            parameters: record.parameters || undefined,\n            encrypted: record.encrypted || undefined,\n            ...record,\n          })\n          .then(async (llm) => {\n            await createOrUpdateFlowNode({\n              source_id: llm.id,\n              source_type: 'LLM',\n              node_type: FlowNodeTypeEnum.LLM,\n              x: source.position?.x,\n              y: source.position?.y + (source.measured?.height || 0) + 30,\n            })\n            return llm\n          })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [createOrUpdateFlowNode, pushSyncNodeQueue, sessionId],\n  )\n\n  return {\n    loading,\n    createLLM,\n  }\n}\n","var U=1,Y=.9,H=.8,J=.17,p=.1,u=.999,$=.9999;var k=.99,m=/[\\\\\\/_+.#\"@\\[\\(\\{&]/,B=/[\\\\\\/_+.#\"@\\[\\(\\{&]/g,K=/[\\s-]/,X=/[\\s-]/g;function G(_,C,h,P,A,f,O){if(f===C.length)return A===_.length?U:k;var T=`${A},${f}`;if(O[T]!==void 0)return O[T];for(var L=P.charAt(f),c=h.indexOf(L,A),S=0,E,N,R,M;c>=0;)E=G(_,C,h,P,c+1,f+1,O),E>S&&(c===A?E*=U:m.test(_.charAt(c-1))?(E*=H,R=_.slice(A,c-1).match(B),R&&A>0&&(E*=Math.pow(u,R.length))):K.test(_.charAt(c-1))?(E*=Y,M=_.slice(A,c-1).match(X),M&&A>0&&(E*=Math.pow(u,M.length))):(E*=J,A>0&&(E*=Math.pow(u,c-A))),_.charAt(c)!==C.charAt(f)&&(E*=$)),(E<p&&h.charAt(c-1)===P.charAt(f+1)||P.charAt(f+1)===P.charAt(f)&&h.charAt(c-1)!==P.charAt(f))&&(N=G(_,C,h,P,c+1,f+2,O),N*p>E&&(E=N*p)),E>S&&(S=E),c=h.indexOf(L,c+1);return O[T]=S,S}function D(_){return _.toLowerCase().replace(X,\" \")}function W(_,C,h){return _=h&&h.length>0?`${_+\" \"+h.join(\" \")}`:_,G(_,C,D(_),D(C),0,0,{})}export{W as a};\n","\"use client\";import{a as ce}from\"./chunk-NZJY6EH4.mjs\";import*as w from\"@radix-ui/react-dialog\";import*as n from\"react\";import{Primitive as D}from\"@radix-ui/react-primitive\";import{useId as L}from\"@radix-ui/react-id\";import{useSyncExternalStore as Re}from\"use-sync-external-store/shim/index.js\";var N='[cmdk-group=\"\"]',Q='[cmdk-group-items=\"\"]',be='[cmdk-group-heading=\"\"]',Z='[cmdk-item=\"\"]',le=`${Z}:not([aria-disabled=\"true\"])`,Y=\"cmdk-item-select\",I=\"data-value\",he=(r,o,t)=>ce(r,o,t),ue=n.createContext(void 0),K=()=>n.useContext(ue),de=n.createContext(void 0),ee=()=>n.useContext(de),fe=n.createContext(void 0);var me=n.forwardRef((r,o)=>{let t=k(()=>{var e,s;return{search:\"\",value:(s=(e=r.value)!=null?e:r.defaultValue)!=null?s:\"\",filtered:{count:0,items:new Map,groups:new Set}}}),u=k(()=>new Set),c=k(()=>new Map),d=k(()=>new Map),f=k(()=>new Set),p=pe(r),{label:v,children:b,value:l,onValueChange:y,filter:E,shouldFilter:C,loop:H,disablePointerSelection:ge=!1,vimBindings:$=!0,...O}=r,te=L(),B=L(),F=L(),x=n.useRef(null),R=Te();M(()=>{if(l!==void 0){let e=l.trim();t.current.value=e,h.emit()}},[l]),M(()=>{R(6,re)},[]);let h=n.useMemo(()=>({subscribe:e=>(f.current.add(e),()=>f.current.delete(e)),snapshot:()=>t.current,setState:(e,s,i)=>{var a,m,g;if(!Object.is(t.current[e],s)){if(t.current[e]=s,e===\"search\")W(),U(),R(1,z);else if(e===\"value\"&&(i||R(5,re),((a=p.current)==null?void 0:a.value)!==void 0)){let S=s!=null?s:\"\";(g=(m=p.current).onValueChange)==null||g.call(m,S);return}h.emit()}},emit:()=>{f.current.forEach(e=>e())}}),[]),q=n.useMemo(()=>({value:(e,s,i)=>{var a;s!==((a=d.current.get(e))==null?void 0:a.value)&&(d.current.set(e,{value:s,keywords:i}),t.current.filtered.items.set(e,ne(s,i)),R(2,()=>{U(),h.emit()}))},item:(e,s)=>(u.current.add(e),s&&(c.current.has(s)?c.current.get(s).add(e):c.current.set(s,new Set([e]))),R(3,()=>{W(),U(),t.current.value||z(),h.emit()}),()=>{d.current.delete(e),u.current.delete(e),t.current.filtered.items.delete(e);let i=A();R(4,()=>{W(),(i==null?void 0:i.getAttribute(\"id\"))===e&&z(),h.emit()})}),group:e=>(c.current.has(e)||c.current.set(e,new Set),()=>{d.current.delete(e),c.current.delete(e)}),filter:()=>p.current.shouldFilter,label:v||r[\"aria-label\"],getDisablePointerSelection:()=>p.current.disablePointerSelection,listId:te,inputId:F,labelId:B,listInnerRef:x}),[]);function ne(e,s){var a,m;let i=(m=(a=p.current)==null?void 0:a.filter)!=null?m:he;return e?i(e,t.current.search,s):0}function U(){if(!t.current.search||p.current.shouldFilter===!1)return;let e=t.current.filtered.items,s=[];t.current.filtered.groups.forEach(a=>{let m=c.current.get(a),g=0;m.forEach(S=>{let P=e.get(S);g=Math.max(P,g)}),s.push([a,g])});let i=x.current;_().sort((a,m)=>{var P,V;let g=a.getAttribute(\"id\"),S=m.getAttribute(\"id\");return((P=e.get(S))!=null?P:0)-((V=e.get(g))!=null?V:0)}).forEach(a=>{let m=a.closest(Q);m?m.appendChild(a.parentElement===m?a:a.closest(`${Q} > *`)):i.appendChild(a.parentElement===i?a:a.closest(`${Q} > *`))}),s.sort((a,m)=>m[1]-a[1]).forEach(a=>{var g;let m=(g=x.current)==null?void 0:g.querySelector(`${N}[${I}=\"${encodeURIComponent(a[0])}\"]`);m==null||m.parentElement.appendChild(m)})}function z(){let e=_().find(i=>i.getAttribute(\"aria-disabled\")!==\"true\"),s=e==null?void 0:e.getAttribute(I);h.setState(\"value\",s||void 0)}function W(){var s,i,a,m;if(!t.current.search||p.current.shouldFilter===!1){t.current.filtered.count=u.current.size;return}t.current.filtered.groups=new Set;let e=0;for(let g of u.current){let S=(i=(s=d.current.get(g))==null?void 0:s.value)!=null?i:\"\",P=(m=(a=d.current.get(g))==null?void 0:a.keywords)!=null?m:[],V=ne(S,P);t.current.filtered.items.set(g,V),V>0&&e++}for(let[g,S]of c.current)for(let P of S)if(t.current.filtered.items.get(P)>0){t.current.filtered.groups.add(g);break}t.current.filtered.count=e}function re(){var s,i,a;let e=A();e&&(((s=e.parentElement)==null?void 0:s.firstChild)===e&&((a=(i=e.closest(N))==null?void 0:i.querySelector(be))==null||a.scrollIntoView({block:\"nearest\"})),e.scrollIntoView({block:\"nearest\"}))}function A(){var e;return(e=x.current)==null?void 0:e.querySelector(`${Z}[aria-selected=\"true\"]`)}function _(){var e;return Array.from(((e=x.current)==null?void 0:e.querySelectorAll(le))||[])}function J(e){let i=_()[e];i&&h.setState(\"value\",i.getAttribute(I))}function X(e){var g;let s=A(),i=_(),a=i.findIndex(S=>S===s),m=i[a+e];(g=p.current)!=null&&g.loop&&(m=a+e<0?i[i.length-1]:a+e===i.length?i[0]:i[a+e]),m&&h.setState(\"value\",m.getAttribute(I))}function oe(e){let s=A(),i=s==null?void 0:s.closest(N),a;for(;i&&!a;)i=e>0?Ie(i,N):Me(i,N),a=i==null?void 0:i.querySelector(le);a?h.setState(\"value\",a.getAttribute(I)):X(e)}let ie=()=>J(_().length-1),ae=e=>{e.preventDefault(),e.metaKey?ie():e.altKey?oe(1):X(1)},se=e=>{e.preventDefault(),e.metaKey?J(0):e.altKey?oe(-1):X(-1)};return n.createElement(D.div,{ref:o,tabIndex:-1,...O,\"cmdk-root\":\"\",onKeyDown:e=>{var s;if((s=O.onKeyDown)==null||s.call(O,e),!e.defaultPrevented)switch(e.key){case\"n\":case\"j\":{$&&e.ctrlKey&&ae(e);break}case\"ArrowDown\":{ae(e);break}case\"p\":case\"k\":{$&&e.ctrlKey&&se(e);break}case\"ArrowUp\":{se(e);break}case\"Home\":{e.preventDefault(),J(0);break}case\"End\":{e.preventDefault(),ie();break}case\"Enter\":if(!e.nativeEvent.isComposing&&e.keyCode!==229){e.preventDefault();let i=A();if(i){let a=new Event(Y);i.dispatchEvent(a)}}}}},n.createElement(\"label\",{\"cmdk-label\":\"\",htmlFor:q.inputId,id:q.labelId,style:Le},v),j(r,e=>n.createElement(de.Provider,{value:h},n.createElement(ue.Provider,{value:q},e))))}),ye=n.forwardRef((r,o)=>{var F,x;let t=L(),u=n.useRef(null),c=n.useContext(fe),d=K(),f=pe(r),p=(x=(F=f.current)==null?void 0:F.forceMount)!=null?x:c==null?void 0:c.forceMount;M(()=>{if(!p)return d.item(t,c==null?void 0:c.id)},[p]);let v=ve(t,u,[r.value,r.children,u],r.keywords),b=ee(),l=T(R=>R.value&&R.value===v.current),y=T(R=>p||d.filter()===!1?!0:R.search?R.filtered.items.get(t)>0:!0);n.useEffect(()=>{let R=u.current;if(!(!R||r.disabled))return R.addEventListener(Y,E),()=>R.removeEventListener(Y,E)},[y,r.onSelect,r.disabled]);function E(){var R,h;C(),(h=(R=f.current).onSelect)==null||h.call(R,v.current)}function C(){b.setState(\"value\",v.current,!0)}if(!y)return null;let{disabled:H,value:ge,onSelect:$,forceMount:O,keywords:te,...B}=r;return n.createElement(D.div,{ref:G([u,o]),...B,id:t,\"cmdk-item\":\"\",role:\"option\",\"aria-disabled\":!!H,\"aria-selected\":!!l,\"data-disabled\":!!H,\"data-selected\":!!l,onPointerMove:H||d.getDisablePointerSelection()?void 0:C,onClick:H?void 0:E},r.children)}),Se=n.forwardRef((r,o)=>{let{heading:t,children:u,forceMount:c,...d}=r,f=L(),p=n.useRef(null),v=n.useRef(null),b=L(),l=K(),y=T(C=>c||l.filter()===!1?!0:C.search?C.filtered.groups.has(f):!0);M(()=>l.group(f),[]),ve(f,p,[r.value,r.heading,v]);let E=n.useMemo(()=>({id:f,forceMount:c}),[c]);return n.createElement(D.div,{ref:G([p,o]),...d,\"cmdk-group\":\"\",role:\"presentation\",hidden:y?void 0:!0},t&&n.createElement(\"div\",{ref:v,\"cmdk-group-heading\":\"\",\"aria-hidden\":!0,id:b},t),j(r,C=>n.createElement(\"div\",{\"cmdk-group-items\":\"\",role:\"group\",\"aria-labelledby\":t?b:void 0},n.createElement(fe.Provider,{value:E},C))))}),Ee=n.forwardRef((r,o)=>{let{alwaysRender:t,...u}=r,c=n.useRef(null),d=T(f=>!f.search);return!t&&!d?null:n.createElement(D.div,{ref:G([c,o]),...u,\"cmdk-separator\":\"\",role:\"separator\"})}),Ce=n.forwardRef((r,o)=>{let{onValueChange:t,...u}=r,c=r.value!=null,d=ee(),f=T(l=>l.search),p=T(l=>l.value),v=K(),b=n.useMemo(()=>{var y;let l=(y=v.listInnerRef.current)==null?void 0:y.querySelector(`${Z}[${I}=\"${encodeURIComponent(p)}\"]`);return l==null?void 0:l.getAttribute(\"id\")},[]);return n.useEffect(()=>{r.value!=null&&d.setState(\"search\",r.value)},[r.value]),n.createElement(D.input,{ref:o,...u,\"cmdk-input\":\"\",autoComplete:\"off\",autoCorrect:\"off\",spellCheck:!1,\"aria-autocomplete\":\"list\",role:\"combobox\",\"aria-expanded\":!0,\"aria-controls\":v.listId,\"aria-labelledby\":v.labelId,\"aria-activedescendant\":b,id:v.inputId,type:\"text\",value:c?r.value:f,onChange:l=>{c||d.setState(\"search\",l.target.value),t==null||t(l.target.value)}})}),xe=n.forwardRef((r,o)=>{let{children:t,label:u=\"Suggestions\",...c}=r,d=n.useRef(null),f=n.useRef(null),p=K();return n.useEffect(()=>{if(f.current&&d.current){let v=f.current,b=d.current,l,y=new ResizeObserver(()=>{l=requestAnimationFrame(()=>{let E=v.offsetHeight;b.style.setProperty(\"--cmdk-list-height\",E.toFixed(1)+\"px\")})});return y.observe(v),()=>{cancelAnimationFrame(l),y.unobserve(v)}}},[]),n.createElement(D.div,{ref:G([d,o]),...c,\"cmdk-list\":\"\",role:\"listbox\",\"aria-label\":u,id:p.listId},j(r,v=>n.createElement(\"div\",{ref:G([f,p.listInnerRef]),\"cmdk-list-sizer\":\"\"},v)))}),Pe=n.forwardRef((r,o)=>{let{open:t,onOpenChange:u,overlayClassName:c,contentClassName:d,container:f,...p}=r;return n.createElement(w.Root,{open:t,onOpenChange:u},n.createElement(w.Portal,{container:f},n.createElement(w.Overlay,{\"cmdk-overlay\":\"\",className:c}),n.createElement(w.Content,{\"aria-label\":r.label,\"cmdk-dialog\":\"\",className:d},n.createElement(me,{ref:o,...p}))))}),we=n.forwardRef((r,o)=>T(u=>u.filtered.count===0)?n.createElement(D.div,{ref:o,...r,\"cmdk-empty\":\"\",role:\"presentation\"}):null),De=n.forwardRef((r,o)=>{let{progress:t,children:u,label:c=\"Loading...\",...d}=r;return n.createElement(D.div,{ref:o,...d,\"cmdk-loading\":\"\",role:\"progressbar\",\"aria-valuenow\":t,\"aria-valuemin\":0,\"aria-valuemax\":100,\"aria-label\":c},j(r,f=>n.createElement(\"div\",{\"aria-hidden\":!0},f)))}),Ve=Object.assign(me,{List:xe,Item:ye,Input:Ce,Group:Se,Separator:Ee,Dialog:Pe,Empty:we,Loading:De});function Ie(r,o){let t=r.nextElementSibling;for(;t;){if(t.matches(o))return t;t=t.nextElementSibling}}function Me(r,o){let t=r.previousElementSibling;for(;t;){if(t.matches(o))return t;t=t.previousElementSibling}}function pe(r){let o=n.useRef(r);return M(()=>{o.current=r}),o}var M=typeof window==\"undefined\"?n.useEffect:n.useLayoutEffect;function k(r){let o=n.useRef();return o.current===void 0&&(o.current=r()),o}function G(r){return o=>{r.forEach(t=>{typeof t==\"function\"?t(o):t!=null&&(t.current=o)})}}function T(r){let o=ee(),t=()=>r(o.snapshot());return Re(o.subscribe,t,t)}function ve(r,o,t,u=[]){let c=n.useRef(),d=K();return M(()=>{var v;let f=(()=>{var b;for(let l of t){if(typeof l==\"string\")return l.trim();if(typeof l==\"object\"&&\"current\"in l)return l.current?(b=l.current.textContent)==null?void 0:b.trim():c.current}})(),p=u.map(b=>b.trim());d.value(r,f,p),(v=o.current)==null||v.setAttribute(I,f),c.current=f}),c}var Te=()=>{let[r,o]=n.useState(),t=k(()=>new Map);return M(()=>{t.current.forEach(u=>u()),t.current=new Map},[r]),(u,c)=>{t.current.set(u,c),o({})}};function ke(r){let o=r.type;return typeof o==\"function\"?o(r.props):\"render\"in o?o.render(r.props):r}function j({asChild:r,children:o},t){return r&&n.isValidElement(o)?n.cloneElement(ke(o),{ref:o.ref},t(o.props.children)):t(o)}var Le={position:\"absolute\",width:\"1px\",height:\"1px\",padding:\"0\",margin:\"-1px\",overflow:\"hidden\",clip:\"rect(0, 0, 0, 0)\",whiteSpace:\"nowrap\",borderWidth:\"0\"};export{Ve as Command,Pe as CommandDialog,we as CommandEmpty,Se as CommandGroup,Ce as CommandInput,ye as CommandItem,xe as CommandList,De as CommandLoading,me as CommandRoot,Ee as CommandSeparator,he as defaultFilter,T as useCommandState};\n","import * as React from 'react'\nimport { type DialogProps } from '@radix-ui/react-dialog'\nimport { Command as CommandPrimitive } from 'cmdk'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { cn } from 'src/lib/utils'\nimport { Dialog, DialogContent } from 'src/lib/shadcn/ui/dialog'\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      'flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground',\n      className,\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ntype CommandDialogProps = DialogProps\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <LazyIcon name=\"search\" className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        'flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn('max-h-[300px] overflow-y-auto overflow-x-hidden', className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      'overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground',\n      className,\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn('-mx-1 h-px bg-border', className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0',\n      className,\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn('ml-auto text-xs tracking-widest text-muted-foreground', className)}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = 'CommandShortcut'\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","import * as React from 'react'\nimport * as CheckboxPrimitive from '@radix-ui/react-checkbox'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { cn } from 'src/lib/utils'\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      'peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground',\n      className,\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator className={cn('flex items-center justify-center text-current')}>\n      <LazyIcon name=\"check\" className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","export const OPEN_AI_MODELS = ['gpt-4o', 'gpt-4o-mini', 'gpt-4-turbo', 'gpt-4', 'gpt-3.5-turbo']\nexport const GROQ_MODELS = [\n  'deepseek-r1-distill-llama-70b',\n  'llama-3.2-90b-vision-preview',\n  'llama-3.3-70b-versatile',\n  'llama-3.3-70b-specdec',\n  'llama3-70b-8192',\n  'gemma2-9b-it',\n  'llama3-8b-8192',\n  'mixtral-8x7b-32768',\n]\nexport const GROQ_VISION_MODELS = ['llama-3.2-90b-vision-preview']\nexport const GOOGLE_GENERATIVE_AI_MODELS = [\n  'gemini-2.0-flash-exp',\n  'gemini-1.5-flash',\n  'gemini-1.5-pro',\n  'gemini-1.5-flash-8b',\n]\nexport const GOOGLE_GENERATIVE_AI_API_KEY_LINK = 'https://aistudio.google.com/app/apikey'\nexport const OPEN_AI_API_KEY_LINK = 'https://platform.openai.com/api-keys'\nexport const GROQ_API_KEY_LINK = 'https://console.groq.com/keys'\n","import { LLMProviderEnum } from 'src/services/database/types'\n\nexport const SUPPORTED_PROVIDERS = [\n  LLMProviderEnum.WebLLM,\n  LLMProviderEnum.Wllama,\n  LLMProviderEnum.OpenAI,\n  LLMProviderEnum.GoogleGenerativeAI,\n  LLMProviderEnum.Groq,\n]\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from 'src/lib/shadcn/ui/dialog'\nimport {\n  InputOTP,\n  InputOTPGroup,\n  InputOTPSeparator,\n  InputOTPSlot,\n} from 'src/lib/shadcn/ui/input-otp'\n\ntype CreateSessionPassphraseDialogProps = {\n  className: string\n  onConfirm: (newValue: string) => Promise<unknown>\n  onCancel: () => void\n}\n\nconst CreateSessionPassphraseDialog = create<CreateSessionPassphraseDialogProps>(\n  ({ onConfirm, onCancel }) => {\n    const currentModal = useModal()\n    const { t } = useTranslation('dialogs')\n    const [name, setName] = useState('')\n\n    const handleChangeOTP = (newValue: string) => {\n      setName(newValue)\n    }\n\n    const handleSubmit = async () => {\n      try {\n        if (name?.length !== 6) {\n          return\n        }\n        await onConfirm?.(name)\n        setName('')\n        currentModal.resolve(true)\n        currentModal.hide()\n      } catch (e) {\n        currentModal.reject(e)\n      }\n    }\n\n    const handleHide = () => {\n      onCancel?.()\n      setName('')\n      currentModal.resolve(false)\n      currentModal.hide()\n    }\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={handleHide}>\n        <DialogContent className=\"w-[330px]\">\n          <DialogHeader>\n            <DialogTitle>{t('create_session_passkey.title')}</DialogTitle>\n            <DialogDescription>{t('create_session_passkey.description')}</DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <InputOTP onChange={handleChangeOTP} maxLength={6}>\n              <InputOTPGroup>\n                <InputOTPSlot index={0} hidden />\n                <InputOTPSlot index={1} hidden />\n                <InputOTPSlot index={2} hidden />\n              </InputOTPGroup>\n              <InputOTPSeparator />\n              <InputOTPGroup>\n                <InputOTPSlot index={3} hidden />\n                <InputOTPSlot index={4} hidden />\n                <InputOTPSlot index={5} hidden />\n              </InputOTPGroup>\n            </InputOTP>\n          </div>\n          <DialogFooter>\n            <Button disabled={name?.length !== 6} onClick={handleSubmit} type=\"submit\">\n              {t('create_session_passkey.confirm')}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default CreateSessionPassphraseDialog\n","import { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { encryptSymmetric, generatePassphrase } from 'src/utils/aes'\n\nexport const useUpdateSessionPassphrase = () => {\n  const [loading, setLoading] = useState(false)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const setCurrentSession = useSessionState((state) => state.setCurrentSession)\n\n  const updateSessionPassphrase = useCallback(\n    async (passkey: string) => {\n      if (!currentSession || !passkey) {\n        return\n      }\n      try {\n        setLoading(true)\n\n        const passphrase = await generatePassphrase()\n        const encrypted = await encryptSymmetric(passphrase, passkey)\n        await getRepository('Session').update(currentSession.id, {\n          passphrase: encrypted,\n        })\n        const session = await getRepository('Session').findOne({ where: { id: currentSession.id } })\n        if (session) {\n          setCurrentSession(session)\n        }\n        return {\n          passphrase,\n          encrypted,\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [currentSession, setCurrentSession],\n  )\n\n  return {\n    loading,\n    updateSessionPassphrase,\n  }\n}\n","import { useCallback } from 'react'\nimport { useSessionState } from 'src/states/session'\nimport secureSession from 'src/utils/secure-session'\nimport { useModalRef } from 'src/hooks/use-modal-ref'\nimport CreateSessionPassphraseDialog from 'src/components/dialogs/CreateSessionPassphraseDialog'\nimport { useUpdateSessionPassphrase } from 'src/hooks/mutations/use-update-session-passphrase'\nimport { useConfirmPassphrase } from './use-confirm-passphrase'\n\nexport const useConfirmOrCreatePassphrase = () => {\n  const currentSession = useSessionState((state) => state.currentSession)\n  const { modalRef: createSessionPassphraseDialogRef } = useModalRef(CreateSessionPassphraseDialog)\n  const { updateSessionPassphrase } = useUpdateSessionPassphrase()\n  const { confirmPassphrase } = useConfirmPassphrase()\n\n  const confirmOrCreatePassphrase = useCallback(async () => {\n    if (!currentSession?.passphrase) {\n      let passkey = ''\n      await createSessionPassphraseDialogRef.current.show({\n        onConfirm: async (input: string) => {\n          passkey = input\n        },\n      })\n      if (!passkey) {\n        throw new Error('Passphrase is required')\n      }\n      const keyInfo = await updateSessionPassphrase(passkey)\n      if (!keyInfo) {\n        throw new Error('Failed to update session passphrase')\n      }\n      await secureSession.set('passphrase', keyInfo.passphrase)\n    } else {\n      await confirmPassphrase()\n    }\n    return secureSession.get('passphrase')\n  }, [\n    confirmPassphrase,\n    createSessionPassphraseDialogRef,\n    currentSession?.passphrase,\n    updateSessionPassphrase,\n  ])\n\n  return {\n    confirmOrCreatePassphrase,\n  }\n}\n","import { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useCreateLLM } from 'src/hooks/flows/mutations/use-create-llm'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useTranslation } from 'react-i18next'\nimport { Popover, PopoverContent } from 'src/lib/shadcn/ui/popover'\nimport { PopoverTrigger } from '@radix-ui/react-popover'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from 'src/lib/shadcn/ui/command'\nimport { LLMModelTypeEnum, LLMProviderEnum } from 'src/services/database/types'\nimport { useLocalLLMState } from 'src/services/local-llm'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { RECOMMENDATION_LOCAL_LLMS } from 'src/constants/local-llm'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { Alert } from 'src/lib/shadcn/ui/alert'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { logError } from 'src/utils/logger'\nimport { useSessionState } from 'src/states/session'\nimport { encryptData } from 'src/utils/passphrase'\nimport { Checkbox } from 'src/lib/shadcn/ui/checkbox'\nimport {\n  GROQ_API_KEY_LINK,\n  GROQ_MODELS,\n  GROQ_VISION_MODELS,\n  OPEN_AI_API_KEY_LINK,\n  OPEN_AI_MODELS,\n  GOOGLE_GENERATIVE_AI_API_KEY_LINK,\n  GOOGLE_GENERATIVE_AI_MODELS,\n} from 'src/constants/llm'\n\nimport { SUPPORTED_PROVIDERS } from './constants'\nimport { useConfirmOrCreatePassphrase } from 'src/hooks/mutations/use-confirm-or-create-passphrase'\n\nfunction CreateLLMCard(props: NodeProps & { setDialog?: (value: boolean) => void }) {\n  const { id, setDialog } = props\n  const { t } = useTranslation('components')\n  const { toast } = useToast()\n  const node = useInternalNode(id)\n  const [loading, setLoading] = useState(false)\n  const [modelId, setModelId] = useState('')\n  const [open, setOpen] = useState(false)\n  const [search, setSearch] = useState('')\n  const [encryptedInfo, setEncryptedInfo] = useState<Record<string, string>>()\n  const [provider, setProvider] = useState<`${LLMProviderEnum}`>(LLMProviderEnum.WebLLM)\n  const [hasCache, setHasCache] = useState(false)\n  const [llmsInfo, setLLMsInfo] = useState<{\n    input?: string\n    modelList: ModelRecord[]\n    functionCallingModelIds: string[]\n  }>()\n  const llmInfoRef = useRef<{\n    input?: string\n    modelList: ModelRecord[]\n    functionCallingModelIds: string[]\n  }>()\n  const currentSession = useSessionState((state) => state.currentSession)\n  const syncCachedLLMURLs = useLocalLLMState((state) => state.syncCachedLLMURLs)\n  const cachedLLMURLs = useLocalLLMState((state) => state.cachedLLMURLs)\n  const { loading: creatingLLM, createLLM } = useCreateLLM()\n\n  llmInfoRef.current = llmsInfo\n\n  const { confirmOrCreatePassphrase } = useConfirmOrCreatePassphrase()\n\n  useEffect(() => {\n    syncCachedLLMURLs()\n  }, [syncCachedLLMURLs])\n\n  const isRequiredSessionPasskey = useMemo(() => {\n    if (!modelId) return false\n    return ![LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(provider as LLMProviderEnum)\n  }, [modelId, provider])\n\n  const modelList = useMemo(() => {\n    if (!llmsInfo?.functionCallingModelIds || !llmsInfo?.modelList) return []\n\n    const data = !search\n      ? llmsInfo?.modelList\n      : llmsInfo?.modelList.filter((model) =>\n          model.model_id.toLowerCase().includes(search.toLowerCase()),\n        )\n\n    return (data || []).sort((pre, next) => {\n      // Check if models are in cachedLLMURLs\n      const preInCache = cachedLLMURLs.some((item) => item.includes(pre.model_id))\n      const nextInCache = cachedLLMURLs.some((item) => item.includes(next.model_id))\n\n      // Prioritize models in cachedLLMURLs\n      if (preInCache && !nextInCache) {\n        return -1\n      }\n      if (!preInCache && nextInCache) {\n        return 1\n      }\n\n      const preInRecommended = RECOMMENDATION_LOCAL_LLMS.includes(pre.model_id)\n      const nextInRecommended = RECOMMENDATION_LOCAL_LLMS.includes(next.model_id)\n\n      // Prioritize models in RECOMMENDATION_LOCAL_LLMS\n      if (preInRecommended && !nextInRecommended) {\n        return -1\n      }\n      if (!preInRecommended && nextInRecommended) {\n        return 1\n      }\n\n      // Check if models are in functionCallingModelIds\n      const preInFunctionCalling = llmsInfo?.functionCallingModelIds.includes(pre.model_id)\n      const nextInFunctionCalling = llmsInfo?.functionCallingModelIds.includes(next.model_id)\n\n      // Prioritize models in functionCallingModelIds\n      if (preInFunctionCalling && !nextInFunctionCalling) {\n        return -1\n      }\n      if (!preInFunctionCalling && nextInFunctionCalling) {\n        return 1\n      }\n\n      // Compare buffer_size_required_bytes\n      if (\n        pre.vram_required_MB &&\n        next.vram_required_MB &&\n        pre.vram_required_MB !== next.vram_required_MB\n      ) {\n        return pre.vram_required_MB - next.vram_required_MB\n      }\n\n      return pre.model_id.localeCompare(next.model_id)\n    })\n  }, [llmsInfo?.modelList, llmsInfo?.functionCallingModelIds, search, cachedLLMURLs])\n\n  const selectedModel = useMemo<ModelRecord | undefined>(() => {\n    if (!modelId) return\n\n    switch (provider) {\n      case LLMProviderEnum.Wllama:\n        return llmsInfo?.modelList.find((model) => model.model_id === modelId)\n      case LLMProviderEnum.WebLLM:\n        return llmsInfo?.modelList && modelList.find((model) => model.model_id === modelId)\n      case LLMProviderEnum.Groq:\n        setEncryptedInfo({})\n        return {\n          model: modelId,\n          model_id: modelId,\n          model_type: GROQ_VISION_MODELS.includes(modelId) ? 2 : 0,\n          overrides: {},\n        } as ModelRecord\n      case LLMProviderEnum.OpenAI:\n        setEncryptedInfo({})\n        return {\n          model: modelId,\n          model_id: modelId,\n          model_type: 2,\n          overrides: {},\n        } as ModelRecord\n      case LLMProviderEnum.GoogleGenerativeAI:\n        setEncryptedInfo({})\n        return {\n          model: modelId,\n          model_id: modelId,\n          model_type: 2,\n          overrides: {},\n        } as ModelRecord\n    }\n  }, [modelId, llmsInfo?.modelList, modelList, provider])\n\n  useEffect(() => {\n    if (!selectedModel?.model_id || !cachedLLMURLs) return\n\n    setHasCache(cachedLLMURLs.some((item) => item.includes(selectedModel.model_id)))\n  }, [cachedLLMURLs, selectedModel?.model_id])\n  useEffect(() => {\n    if (!currentSession?.id) return\n\n    setProvider(LLMProviderEnum.WebLLM)\n    setModelId('')\n    setSearch('')\n    setEncryptedInfo({})\n  }, [currentSession?.id])\n\n  const handleOnchange = useCallback((currentValue: string) => {\n    setModelId(currentValue)\n    setOpen(false)\n  }, [])\n  const handleSearchChange = useCallback((value: string) => {\n    setSearch(value)\n  }, [])\n  const handleOnSelectProvider = useCallback((value: `${LLMProviderEnum}`) => {\n    setProvider(value)\n    setModelId('')\n    setSearch('')\n    setEncryptedInfo({})\n  }, [])\n  const hanldeSubmit = async () => {\n    if (!node || !currentSession) return\n    try {\n      setLoading(true)\n      let encrypted: Record<string, unknown> | undefined\n\n      if (isRequiredSessionPasskey) {\n        const passphrase = await confirmOrCreatePassphrase()\n        if (!passphrase) {\n          throw new Error('Passphrase is not found')\n        }\n        encrypted = await encryptData(encryptedInfo || {}, passphrase)\n      }\n      await createLLM(node, {\n        name: modelId,\n        model_type: modelTypeToLLMType(selectedModel?.model_type),\n        function_calling: selectedModel?.model_id\n          ? llmsInfo?.functionCallingModelIds?.includes(selectedModel?.model_id)\n          : false,\n        encrypted,\n        provider,\n      })\n      setDialog?.(false)\n    } catch (error) {\n      logError('Create LLM', error)\n      toast({\n        variant: 'destructive',\n        description: t('add_llm_card.errors.failed_to_create'),\n      })\n    } finally {\n      setLoading(false)\n      setProvider(LLMProviderEnum.WebLLM)\n      setEncryptedInfo({})\n      setModelId('')\n      setSearch('')\n    }\n  }\n\n  useLayoutEffect(() => {\n    const getModelInfo = async () => {\n      try {\n        if (provider === LLMProviderEnum.Wllama) {\n          const [username, repo] = modelId?.split('/') || []\n          const repoInfo = `${username}/${repo}`\n          if (!modelId || !username || !repo) {\n            setLLMsInfo({\n              modelList: [],\n              functionCallingModelIds: [],\n            })\n            return\n          } else if (llmInfoRef.current?.input === repoInfo) {\n            return\n          }\n          const res = await fetch(`https://huggingface.co/api/models/${repoInfo}`)\n          const data: { siblings?: { rfilename: string }[] } = await res.json()\n          if (data.siblings) {\n            setLLMsInfo({\n              input: repoInfo,\n              modelList: data.siblings\n                .map((s) => s.rfilename)\n                .filter((f) => f.endsWith('.gguf'))\n                .map((item) => {\n                  return {\n                    model_id: `${repoInfo}/${item}`,\n                    model: `${repoInfo}/${item}`,\n                    model_lib: `${repoInfo}/${item}`,\n                    model_type: 0,\n                    overrides: {},\n                  }\n                }),\n              functionCallingModelIds: [],\n            })\n          } else {\n            setLLMsInfo({\n              modelList: [],\n              functionCallingModelIds: [],\n            })\n          }\n        } else if (provider === LLMProviderEnum.WebLLM) {\n          import('@mlc-ai/web-llm').then(async ({ functionCallingModelIds, prebuiltAppConfig }) => {\n            const modelList = prebuiltAppConfig.model_list\n            setLLMsInfo({ modelList, functionCallingModelIds })\n          })\n        }\n      } catch {\n        // TODO: handle error\n      }\n    }\n    getModelInfo()\n  }, [provider, modelId])\n\n  const modelTypeToLLMType = useCallback((modelType?: unknown) => {\n    if (modelType === 1) {\n      return LLMModelTypeEnum.embedding\n    }\n    if (modelType === 2) {\n      return LLMModelTypeEnum.VLM\n    }\n    return LLMModelTypeEnum.LLM\n  }, [])\n\n  const modelItems = useMemo(() => {\n    switch (provider) {\n      case LLMProviderEnum.Wllama:\n      case LLMProviderEnum.WebLLM:\n        return modelList.map((model) => (\n          <CommandItem key={model.model_id} value={model.model_id} onSelect={handleOnchange}>\n            {modelId === model.model_id ? (\n              <LazyIcon name=\"check\" className={'mr-2 h-4 w-4'} />\n            ) : (\n              <div className=\"mr-2 h-4 w-4\" />\n            )}\n            <span className=\"max-w-md\">\n              <div className=\"flex gap-2 mb-2\">\n                <LLMIcon name={model.model_id} />\n                {model.model_id}\n              </div>\n              <div className=\"flex max-w-full flex-wrap gap-1\">\n                <LLMInfo\n                  model={model}\n                  isFunctionCalling={\n                    llmsInfo?.functionCallingModelIds?.includes(model.model_id) || false\n                  }\n                  name={model.model_id}\n                  isCached={cachedLLMURLs.some((item) => item.includes(model.model_id)) || false}\n                  cloud={provider !== LLMProviderEnum.WebLLM}\n                />\n              </div>\n            </span>\n          </CommandItem>\n        ))\n      case LLMProviderEnum.OpenAI:\n        return OPEN_AI_MODELS.map((model) => {\n          return (\n            <CommandItem key={model} value={model} onSelect={handleOnchange}>\n              {modelId === model ? (\n                <LazyIcon name=\"check\" className={'h-4 w-4'} />\n              ) : (\n                <div className=\"w-4\" />\n              )}\n              <span className=\"max-w-md\">\n                <div className=\"flex gap-3\">\n                  <LLMIcon name={model} />\n                  {model}\n                </div>\n              </span>\n            </CommandItem>\n          )\n        })\n      case LLMProviderEnum.GoogleGenerativeAI:\n        return GOOGLE_GENERATIVE_AI_MODELS.map((model) => {\n          return (\n            <CommandItem key={model} value={model} onSelect={handleOnchange}>\n              {modelId === model ? (\n                <LazyIcon name=\"check\" className={'h-4 w-4'} />\n              ) : (\n                <div className=\"w-4\" />\n              )}\n              <span className=\"max-w-md\">\n                <div className=\"flex gap-3\">\n                  <LLMIcon name={model} />\n                  {model}\n                </div>\n              </span>\n            </CommandItem>\n          )\n        })\n      case LLMProviderEnum.Groq:\n        return GROQ_MODELS.map((model) => {\n          return (\n            <CommandItem key={model} value={model} onSelect={handleOnchange}>\n              {modelId === model ? (\n                <LazyIcon name=\"check\" className={'h-4 w-4'} />\n              ) : (\n                <div className=\"w-4\" />\n              )}\n              <span className=\"max-w-md\">\n                <div className=\"flex gap-3\">\n                  <LLMIcon name={model} />\n                  {model}\n                </div>\n              </span>\n            </CommandItem>\n          )\n        })\n    }\n    return\n  }, [\n    cachedLLMURLs,\n    handleOnchange,\n    modelId,\n    llmsInfo?.functionCallingModelIds,\n    modelList,\n    provider,\n  ])\n\n  const modelSelection = useMemo(() => {\n    if (provider === LLMProviderEnum.Wllama) {\n      const [username, repo] = modelId?.split('/') || []\n      return (\n        <>\n          <Alert variant=\"default\" className=\"mb-4\">\n            {t('add_llm_card.wllama_description')}\n          </Alert>\n          <Label>{t('add_llm_card.hugging_face_repo')}</Label>\n          {username && repo ? (\n            <div className=\"relative\">\n              <Input\n                value={`${username}/${repo}`}\n                disabled\n                placeholder={t('add_llm_card.hugging_face_repo_placeholder')}\n              />\n              <LazyIcon\n                onClick={() => setModelId('')}\n                name=\"x\"\n                className=\"h-4 w-4 absolute right-3 top-3 cursor-pointer\"\n              />\n            </div>\n          ) : (\n            <Input\n              value={username ? `${username}/${repo}` : ''}\n              onChange={(e) => setModelId(e.target.value)}\n              placeholder={t('add_llm_card.hugging_face_repo_placeholder')}\n            />\n          )}\n          <Label>{t('add_llm_card.model_name')}</Label>\n          <Popover open={open} onOpenChange={setOpen}>\n            <PopoverTrigger asChild>\n              <Button\n                variant=\"outline\"\n                role=\"combobox\"\n                aria-expanded={open}\n                disabled={!username || !repo}\n                className=\"w-full justify-between max-w-full overflow-hidden\"\n              >\n                {modelId && selectedModel\n                  ? selectedModel?.model_id\n                  : t('add_llm_card.select_model_placeholder')}\n                <LazyIcon name=\"chevrons-up-down\" className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-full p-0\">\n              <Command>\n                <CommandInput\n                  onValueChange={handleSearchChange}\n                  placeholder={t('add_llm_card.search_placeholder')}\n                />\n                <CommandList>\n                  <CommandEmpty>{t('add_llm_card.no_model')}</CommandEmpty>\n                  <CommandGroup>{modelItems}</CommandGroup>\n                </CommandList>\n              </Command>\n            </PopoverContent>\n          </Popover>\n        </>\n      )\n    }\n    return (\n      <>\n        <Label>{t('add_llm_card.model_name')}</Label>\n        <Popover open={open} onOpenChange={setOpen}>\n          <PopoverTrigger asChild>\n            <Button\n              variant=\"outline\"\n              role=\"combobox\"\n              aria-expanded={open}\n              className=\"w-full justify-between\"\n            >\n              {modelId ? selectedModel?.model_id : t('add_llm_card.select_model_placeholder')}\n              <LazyIcon name=\"chevrons-up-down\" className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-full p-0\">\n            <Command>\n              <CommandInput\n                onValueChange={handleSearchChange}\n                placeholder={t('add_llm_card.search_placeholder')}\n              />\n              <CommandList>\n                <CommandEmpty>{t('add_llm_card.no_model')}</CommandEmpty>\n                <CommandGroup>{modelItems}</CommandGroup>\n              </CommandList>\n            </Command>\n          </PopoverContent>\n        </Popover>\n      </>\n    )\n  }, [modelId, provider, modelItems, open, setOpen, handleSearchChange])\n\n  const encryptedFields = useMemo(() => {\n    if (!isRequiredSessionPasskey) return undefined\n\n    switch (provider) {\n      case LLMProviderEnum.Groq:\n      case LLMProviderEnum.OpenAI:\n        return (\n          <>\n            <Alert variant=\"destructive\" className=\"mt-4\">\n              {t('add_llm_card.alert.session_passkey')}\n            </Alert>\n            <div className=\"mt-4\">\n              <Label>{t('add_llm_card.encrypted_fields.api_key')}</Label>\n              <Button variant=\"link\" className=\"px-1\">\n                <a\n                  href={\n                    provider === LLMProviderEnum.OpenAI ? OPEN_AI_API_KEY_LINK : GROQ_API_KEY_LINK\n                  }\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                >\n                  ({provider === LLMProviderEnum.OpenAI ? OPEN_AI_API_KEY_LINK : GROQ_API_KEY_LINK})\n                </a>\n              </Button>\n              <Input\n                type=\"password\"\n                value={encryptedInfo?.key || ''}\n                onChange={(e) =>\n                  setEncryptedInfo((pre) => ({\n                    ...pre,\n                    key: e.target.value,\n                  }))\n                }\n              />\n            </div>\n          </>\n        )\n      case LLMProviderEnum.GoogleGenerativeAI:\n        return (\n          <>\n            <Alert variant=\"destructive\" className=\"mt-4\">\n              {t('add_llm_card.alert.session_passkey')}\n            </Alert>\n            <div className=\"mt-4\">\n              <Label>{t('add_llm_card.encrypted_fields.api_key')}</Label>\n              <Button variant=\"link\" className=\"px-1\">\n                <a href={GOOGLE_GENERATIVE_AI_API_KEY_LINK} target=\"_blank\" rel=\"noreferrer\">\n                  ({GOOGLE_GENERATIVE_AI_API_KEY_LINK})\n                </a>\n              </Button>\n              <Input\n                type=\"password\"\n                value={encryptedInfo?.key || ''}\n                onChange={(e) =>\n                  setEncryptedInfo((pre) => ({\n                    ...pre,\n                    key: e.target.value,\n                  }))\n                }\n              />\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <Label>{t('add_llm_card.encrypted_fields.enabled_google_search_retreival')}</Label>\n              <Checkbox\n                checked={!!encryptedInfo?.enabled_google_search_retreival}\n                className=\"ml-2\"\n                onCheckedChange={(e) => {\n                  setEncryptedInfo((pre) => ({\n                    ...pre,\n                    enabled_google_search_retreival: !e ? '' : `true`,\n                  }))\n                }}\n              />\n            </div>\n          </>\n        )\n    }\n  }, [isRequiredSessionPasskey, provider, t, encryptedInfo])\n\n  return (\n    <Card className=\"max-w-lg\">\n      <CardHeader>\n        <CardTitle>{t('add_llm_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid w-full gap-1.5\">\n          <Label>{t('add_llm_card.provider')}</Label>\n          <Select value={provider} onValueChange={handleOnSelectProvider}>\n            <SelectTrigger className=\"w-full mb-4\">\n              <SelectValue placeholder={t('add_llm_card.provider_select_placeholder')} />\n            </SelectTrigger>\n            <SelectContent>\n              {Object.values(SUPPORTED_PROVIDERS).map((item) => {\n                return (\n                  <SelectItem key={item} value={item}>\n                    {t(`add_llm_card.providers.${item.toLowerCase()}`)}\n                  </SelectItem>\n                )\n              })}\n            </SelectContent>\n          </Select>\n          {modelSelection}\n        </div>\n        {selectedModel ? (\n          <div className=\"mt-4\">\n            <div className=\"mt-4 text-sm text-muted-foreground center flex max-w-full flex-wrap gap-1\">\n              <LLMIcon name={selectedModel.model_id} className=\"mr-2\" />\n              <LLMInfo\n                model={selectedModel}\n                isFunctionCalling={\n                  llmsInfo?.functionCallingModelIds?.includes(selectedModel.model_id) || false\n                }\n                name={selectedModel.model_id}\n                isCached={\n                  cachedLLMURLs.some((item) => item.includes(selectedModel.model_id)) || false\n                }\n                cloud={\n                  ![LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(\n                    provider as LLMProviderEnum,\n                  )\n                }\n              />\n            </div>\n            <div className=\"mt-2 text-sm text-muted-foreground\">\n              <span className=\"font-bold mr-2\">{t('add_llm_card.model_url')}</span>\n              {selectedModel.model}\n            </div>\n            {selectedModel.model_lib ? (\n              <div className=\"mt-2 text-sm text-muted-foreground center flex\">\n                <span className=\"font-bold mr-2\">{t('add_llm_card.model_lib_url')}</span>\n                {selectedModel.model_lib}\n              </div>\n            ) : undefined}\n            {selectedModel.overrides && Object.keys(selectedModel.overrides)?.length ? (\n              <div className=\"mt-2 text-sm text-muted-foreground center flex\">\n                <span className=\"font-bold mr-2\">{t('add_llm_card.metadata')}</span>\n                {JSON.stringify(selectedModel.overrides)}\n              </div>\n            ) : undefined}\n          </div>\n        ) : null}\n        {encryptedFields}\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={creatingLLM || loading}\n          disabled={!modelId?.length}\n          onClick={hanldeSubmit}\n          className=\"w-full\"\n        >\n          {hasCache ? t('add_llm_card.button_add') : t('add_llm_card.button_download_and_add')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n}\n\nexport default CreateLLMCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  PromptTypeEnum,\n  Thread,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreatePrompt = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const createPrompt = useCallback(\n    async (\n      source: Node,\n      options: {\n        content: string\n        prefix?: string\n        type?: `${PromptTypeEnum}`\n        role?: `${MessageRoleEnum}`\n        thread?: Thread\n      },\n    ) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const prompt = await getRepository('Prompt').save({\n          content: options.content,\n          prefix: options.prefix,\n          role: options.role || MessageRoleEnum.System,\n          status: MessageStatusEnum.Started,\n          session_id: sessionId,\n          type: options.type || PromptTypeEnum.Chat,\n        })\n        if (!prompt) {\n          throw new Error('Failed to save prompt')\n        }\n        const promptNode = await createOrUpdateFlowNode({\n          source_id: prompt.id,\n          source_type: 'Prompt',\n          node_type: FlowNodeTypeEnum.Prompt,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!promptNode) {\n          throw new Error('Failed to save prompt node')\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode],\n  )\n\n  return {\n    loading,\n    createPrompt,\n  }\n}\n","import { MessageRoleEnum, PromptTypeEnum } from 'src/services/database/types'\n\nexport const PROMPT_TYPES = {\n  [PromptTypeEnum.Chat]: {\n    label: 'add_prompt_card.prompt_types.chat',\n    value: PromptTypeEnum.Chat,\n  },\n  [PromptTypeEnum.FewShotExample]: {\n    label: 'add_prompt_card.prompt_types.few_shot_example',\n    value: PromptTypeEnum.FewShotExample,\n  },\n}\nexport const PROMPT_ROLES = {\n  [MessageRoleEnum.System]: {\n    label: 'add_prompt_card.prompt_roles.system',\n    value: MessageRoleEnum.System,\n  },\n  [MessageRoleEnum.Human]: {\n    label: 'add_prompt_card.prompt_roles.human',\n    value: MessageRoleEnum.Human,\n  },\n  [MessageRoleEnum.AI]: { label: 'add_prompt_card.prompt_roles.ai', value: MessageRoleEnum.AI },\n}\n","import { memo, useCallback, useState } from 'react'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { MessageRoleEnum, Prompt, PromptTypeEnum } from 'src/services/database/types'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { PROMPT_ROLES, PROMPT_TYPES } from './constants'\n\nconst PromptForm = memo(\n  ({\n    defaultPromptContent,\n    defaultPromptRole,\n    defaultPromptType,\n    hidePromptRole,\n    hidePromptType,\n    loading,\n    onSubmit,\n  }: {\n    onSubmit: (prompt: Partial<Prompt>) => Promise<unknown>\n    loading?: boolean\n    defaultPromptType?: `${PromptTypeEnum}`\n    defaultPromptRole?: `${MessageRoleEnum}`\n    defaultPromptContent?: string\n    hidePromptType?: boolean\n    hidePromptRole?: boolean\n  }) => {\n    const [input, setInput] = useState(defaultPromptContent || '')\n    const [promptType, setPromptType] = useState<`${PromptTypeEnum}`>(\n      defaultPromptType || PromptTypeEnum.Chat,\n    )\n    const [promptRole, setPromptRole] = useState<`${MessageRoleEnum}` | undefined>(\n      defaultPromptRole,\n    )\n    const [promptPrefix, setPromptPrefix] = useState('')\n\n    const { t } = useTranslation('components')\n\n    const handleOnchange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      setInput(e.target.value)\n    }, [])\n\n    const handleOnchangePrefix = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      setPromptPrefix(e.target.value)\n    }, [])\n\n    const handleOnSelectType = useCallback((value: `${PromptTypeEnum}`) => {\n      if (value === PromptTypeEnum.FewShotExample) {\n        setInput('Question: {input}\\nAnswer: {output}')\n      }\n      setPromptType(value)\n    }, [])\n\n    const handleOnSelectRole = useCallback((value: `${MessageRoleEnum}`) => {\n      setPromptRole(value)\n    }, [])\n\n    const handleSubmit = async () => {\n      const result = await onSubmit({\n        content: input,\n        role: promptRole,\n        prefix: promptPrefix,\n        type: promptType,\n      })\n      if (!result) {\n        return\n      }\n      setInput('')\n      setPromptRole(undefined)\n      setPromptType('chat')\n      setPromptPrefix('')\n    }\n\n    return (\n      <div>\n        <div className=\"grid w-full gap-1.5\">\n          {!hidePromptType ? (\n            <>\n              <Label>{t('add_prompt_card.prompt_type')}</Label>\n              <Select value={promptType} onValueChange={handleOnSelectType}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue placeholder={t('add_prompt_card.type_select_placeholder')} />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(PROMPT_TYPES).map((item) => {\n                    return (\n                      <SelectItem key={item.value} value={item.value}>\n                        {t(item.label)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          {!hidePromptRole ? (\n            <>\n              <Label>{t('add_prompt_card.prompt_role')}</Label>\n              <Select value={promptRole} onValueChange={handleOnSelectRole}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue placeholder={t('add_prompt_card.role_select_placeholder')} />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(PROMPT_ROLES).map((item) => {\n                    return (\n                      <SelectItem key={item.value} value={item.value}>\n                        {t(item.label)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          {promptType === PromptTypeEnum.FewShotExample && (\n            <>\n              <Label>{t('add_prompt_card.prompt_prefix')}</Label>\n              <Textarea\n                value={promptPrefix}\n                onChange={handleOnchangePrefix}\n                disabled={false}\n                className=\"h-20\"\n                placeholder={t('add_prompt_card.placeholder')}\n                id=\"message\"\n              />\n              <Label>{t('add_prompt_card.prompt_content')}</Label>\n              <div className=\"w-full border-0 text-gray-700 flex text-sm justify-end items-center\">\n                <LazyIcon name=\"info\" className=\"mr-2\" size={14} />\n                {t('add_prompt_card.few_shot_example_note')}\n              </div>\n            </>\n          )}\n          <Textarea\n            value={input}\n            onChange={handleOnchange}\n            disabled={false}\n            placeholder={t('add_prompt_card.placeholder')}\n            id=\"message\"\n          />\n        </div>\n        <div>\n          <LoadingButton\n            loading={loading}\n            disabled={!input?.length}\n            onClick={handleSubmit}\n            className=\"w-full mt-4\"\n          >\n            {t('add_prompt_card.button')}\n          </LoadingButton>\n        </div>\n      </div>\n    )\n  },\n)\n\nexport default PromptForm\n","import { memo } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Prompt, Thread } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { useCreatePrompt } from 'src/hooks/flows/mutations/use-create-prompt'\n\nimport PromptForm from './PromptForm'\n\nconst CreatePromptCard = memo(\n  (\n    props: Omit<NodeProps, 'data'> & {\n      data?: { ready?: boolean }\n      thread?: Thread\n      setDialog?: (value: boolean) => void\n    },\n  ) => {\n    const { id, thread, setDialog } = props\n\n    const { t } = useTranslation('components')\n    const { toast } = useToast()\n    const node = useInternalNode(id)\n    const { createPrompt, loading } = useCreatePrompt()\n\n    const handleSubmit = async (data: Partial<Prompt>) => {\n      if (node) {\n        try {\n          if (!data?.content) {\n            throw new Error('Prompt data is missing')\n          }\n          await createPrompt(node, {\n            ...data,\n            content: data.content,\n            thread,\n          })\n          setDialog?.(false)\n        } catch (error) {\n          toast({\n            variant: 'destructive',\n            title: `${error}`,\n          })\n        }\n      }\n    }\n\n    return (\n      <Card className=\"mw-full\">\n        <CardHeader>\n          <CardTitle>{t('add_prompt_card.title')}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <PromptForm\n            onSubmit={handleSubmit}\n            loading={loading}\n            defaultPromptRole=\"system\"\n            defaultPromptType=\"chat\"\n          />\n        </CardContent>\n      </Card>\n    )\n  },\n)\n\nexport default CreatePromptCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { SchemaItemType } from 'src/components/molecules/CreateSchemaCard/Field/type'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum, SchemaItem } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\nimport { EntityType } from 'src/utils/orm-type'\nimport { generateUUID } from 'src/utils/uuid'\n\nexport const useCreateSchema = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const toSchemaItem = useCallback(\n    (\n      schemaId: string,\n      input: SchemaItemType[],\n      result: EntityType<SchemaItem>[],\n      parent?: string,\n    ) => {\n      if (!sessionId) {\n        return\n      }\n      for (const item of input) {\n        if (item.data?.length) {\n          toSchemaItem(schemaId, item.data, result, item.id)\n        } else {\n          result.push({\n            name: item.name,\n            type: item.type,\n            enum: item.enum ? JSON.stringify(item.enum) : '',\n            required: item.required,\n            description: item.description,\n            id: item.id || generateUUID(),\n            parent_id: parent,\n            schema_id: schemaId,\n            session_id: sessionId,\n          })\n        }\n      }\n      return result\n    },\n    [sessionId],\n  )\n\n  const createSchema = useCallback(\n    async (source: Node, input: SchemaItemType[]) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const schema = await getRepository('Schema').save({\n          name: 'Untitled Schema',\n          session_id: sessionId,\n        })\n        if (!schema) {\n          throw new Error('Failed to save schema')\n        }\n\n        const schemaItems = toSchemaItem(schema.id, input, [], undefined)\n        if (!schemaItems?.length) {\n          throw new Error('Failed to convert schema items')\n        }\n        await getRepository('SchemaItem').save(schemaItems)\n        const promptNode = await createOrUpdateFlowNode({\n          source_id: schema.id,\n          source_type: 'Schema',\n          node_type: FlowNodeTypeEnum.Schema,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!promptNode) {\n          throw new Error('Failed to save schema node')\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, toSchemaItem, createOrUpdateFlowNode],\n  )\n\n  return {\n    loading,\n    createSchema,\n  }\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { useTranslation } from 'react-i18next'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Checkbox } from 'src/lib/shadcn/ui/checkbox'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport FieldList from './FieldList'\nimport { SchemaItemType } from './type'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport { generateUUID } from 'src/utils/uuid'\n\nconst NewOrUpdateField = memo(\n  ({\n    setData,\n    data,\n    id,\n  }: {\n    id?: string\n    setData: (func: (data: SchemaItemType[]) => SchemaItemType[]) => void\n    data: SchemaItemType[]\n  }) => {\n    const { t } = useTranslation('components')\n    const [empty, setEmpty] = useState<SchemaItemType>({\n      name: '',\n      description: '',\n      type: 'string',\n      required: false,\n      data: [],\n    })\n\n    const currentRow = useMemo(() => {\n      return id ? data.find((item) => item.id === id) || empty : empty\n    }, [data, empty, id])\n\n    const handleChangeName = useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (e.target.value && !/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e.target.value)) {\n          return\n        }\n        if (!id) {\n          setEmpty((item) => ({ ...item, name: e.target.value || '' }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      name: e.target.value || '',\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeDescription = useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, description: e.target.value || '' }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      description: e.target.value || '',\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeType = useCallback(\n      (e: string) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, type: (e || 'string') as SchemaItemType['type'] }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      type: (e || '') as SchemaItemType['type'],\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeRequired = useCallback(\n      (e: string | boolean) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, required: !!e || false }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      required: !!e || false,\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeEnum = useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, enum: e.target.value || '' }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      enum: e.target.value || '',\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleAddNew = useCallback(() => {\n      if (data.find((item) => item.name === empty.name)) {\n        return toast({\n          variant: 'destructive',\n          content: 'Name already exists',\n        })\n      }\n      empty.id = generateUUID()\n      setData((items) => {\n        return [...items, { ...empty }]\n      })\n      setEmpty({\n        name: '',\n        description: '',\n        type: 'string',\n        required: false,\n        id: generateUUID(),\n        parent: id || undefined,\n        data: [],\n      })\n    }, [data, empty, setData, id])\n\n    const handleSetChildData = useCallback(\n      (func: (previous: SchemaItemType[]) => SchemaItemType[]) => {\n        setData((previousData) => {\n          return [\n            ...previousData.map((item) =>\n              item.id === id\n                ? {\n                    ...item,\n                    data: func(item.data || []),\n                  }\n                : item,\n            ),\n          ]\n        })\n      },\n      [id, setData],\n    )\n\n    const shouldShowChildData = ['object', 'array'].includes(currentRow.type)\n\n    return (\n      <div className=\"w-full p-1\">\n        <div>\n          <Label>{t('add_schema_card.field.name')}</Label>\n          <Input\n            id=\"name\"\n            onChange={handleChangeName}\n            placeholder={t('add_schema_card.field.name_placeholder')}\n            value={currentRow?.name || ''}\n          />\n        </div>\n        <div>\n          <Label>{t('add_schema_card.field.description')}</Label>\n          <Input\n            id=\"description\"\n            placeholder={t('add_schema_card.field.description_placeholder')}\n            onChange={handleChangeDescription}\n            value={currentRow?.description || ''}\n          />\n        </div>\n        <div>\n          <Label>{t('add_schema_card.field.type')}</Label>\n          <Select onValueChange={handleChangeType} value={currentRow?.type || ''}>\n            <SelectTrigger>\n              <SelectValue placeholder={t('add_schema_card.field.type_placeholder')} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"string\">{t('add_schema_card.types.string')}</SelectItem>\n              <SelectItem value=\"boolean\">{t('add_schema_card.types.boolean')}</SelectItem>\n              <SelectItem value=\"number\">{t('add_schema_card.types.number')}</SelectItem>\n              <SelectItem value=\"object\">{t('add_schema_card.types.object')}</SelectItem>\n              <SelectItem value=\"array\">{t('add_schema_card.types.array')}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"flex items-center h-10\">\n          <Label>{t('add_schema_card.field.required')}</Label>\n          <Checkbox\n            className=\"ml-2\"\n            aria-label=\"Select row\"\n            onCheckedChange={handleChangeRequired}\n            checked={currentRow?.required}\n          />\n        </div>\n        {shouldShowChildData ? (\n          <div className=\"mt-2 flex flex-col gap-2\">\n            <Label>{t('add_schema_card.children')}</Label>\n            <FieldList data={currentRow?.data || []} setData={handleSetChildData} />\n          </div>\n        ) : null}\n        {currentRow?.type === 'enum' ? (\n          <div className=\"mt-2 flex flex-col gap-2\">\n            <Label>{t('add_schema_card.field.enum')}</Label>\n            <Input id=\"enum\" onChange={handleChangeEnum} placeholder=\"Enum\" />\n          </div>\n        ) : null}\n        {!id ? (\n          <div className=\"w-full flex justify-end mt-2\">\n            <Button\n              variant=\"secondary\"\n              disabled={!currentRow.name || !currentRow.description || !currentRow.type}\n              onClick={handleAddNew}\n              className=\"w-full\"\n            >\n              {t('add_schema_card.field.add_field')}\n            </Button>\n          </div>\n        ) : null}\n      </div>\n    )\n  },\n)\n\nexport default NewOrUpdateField\n","// import { z } from 'zod'\nimport { memo } from 'react'\nimport { SchemaItemType } from './type'\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from 'src/lib/shadcn/ui/accordion'\nimport { Card } from 'src/lib/shadcn/ui/card'\nimport NewOrUpdateField from './NewOrUpdateField'\n\nconst FieldList = memo(\n  ({\n    data,\n    setData,\n  }: {\n    data: SchemaItemType[]\n    setData: (func: (data: SchemaItemType[]) => SchemaItemType[]) => void\n  }) => {\n    return (\n      <Accordion type=\"single\" collapsible>\n        {data.map((row) => {\n          return (\n            <AccordionItem key={row.id || 'new'} value={`${row.id}`}>\n              <AccordionTrigger>{row.name}</AccordionTrigger>\n              <AccordionContent>\n                <NewOrUpdateField setData={setData} data={data} id={row.id} />\n              </AccordionContent>\n            </AccordionItem>\n          )\n        })}\n        <Card className=\"p-2 mt-4\">\n          <NewOrUpdateField setData={setData} data={data} />\n        </Card>\n      </Accordion>\n    )\n  },\n)\n\nexport default FieldList\n","import { memo, useState } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\nimport { useCreateSchema } from 'src/hooks/flows/mutations/use-create-schema'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { SchemaItemType } from './Field/type'\nimport FieldList from './Field/FieldList'\n\nconst CreateSchemaCard = memo((props: NodeProps) => {\n  const { t } = useTranslation('components')\n  const { id } = props\n  const node = useInternalNode(id)\n\n  const [data, setData] = useState<SchemaItemType[]>([])\n\n  const { createSchema, loading } = useCreateSchema()\n\n  const handleSubmit = async () => {\n    if (node && data?.length) {\n      try {\n        await createSchema(node, data)\n        setData([])\n      } catch (error) {\n        toast({\n          variant: 'destructive',\n          title: `${error}`,\n        })\n      }\n    }\n  }\n  return (\n    <Card className=\"max-w-lg\">\n      <CardHeader>\n        <CardTitle>{t('add_schema_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent className=\"min-w-96\">\n        <FieldList setData={setData} data={data} />\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={loading}\n          disabled={!data?.length}\n          onClick={handleSubmit}\n          className=\"w-full\"\n        >\n          {t('add_schema_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateSchemaCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\nimport { encodeCSVData } from 'src/utils/string-data'\n\nexport const useCreateCSVData = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const createCSVData = useCallback(\n    async (source: Node, headers: string[], data: string[][]) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const encodedData = encodeCSVData(headers, data)\n        const csvData = await getRepository('CSVData').save({\n          headers: encodedData.headers,\n          csv: encodedData.data,\n          session_id: sessionId,\n        })\n        if (!csvData) {\n          throw new Error('Failed to save')\n        }\n        const dataNode = await createOrUpdateFlowNode({\n          source_id: csvData.id,\n          source_type: 'CSVData',\n          node_type: FlowNodeTypeEnum.CSVData,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!dataNode) {\n          throw new Error('Failed to save node')\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode],\n  )\n\n  return {\n    loading,\n    createCSVData,\n  }\n}\n","import { useTranslation } from 'react-i18next'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from 'src/lib/shadcn/ui/table'\n\nexport function ExampleTable({ data }: { data: { input: string; output: string }[] }) {\n  const { t } = useTranslation('components')\n  return (\n    <Table className=\"w-full\">\n      <TableHeader>\n        <TableRow>\n          <TableHead>{t('add_few_shot_example_card.input')}</TableHead>\n          <TableHead>{t('add_few_shot_example_card.output')}</TableHead>\n        </TableRow>\n      </TableHeader>\n      <TableBody>\n        {data?.map((item, index) => (\n          <TableRow key={`${item.input}_${item.output}_${index}`}>\n            <TableCell className=\"p-4\">{item.input}</TableCell>\n            <TableCell className=\"p-4\">{item.output}</TableCell>\n          </TableRow>\n        ))}\n      </TableBody>\n    </Table>\n  )\n}\n","import { memo, useState } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { useCreateCSVData } from 'src/hooks/flows/mutations/use-create-csv-data'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { ExampleTable } from './ExampleTable'\n\nconst CreateFewShotExampleCard = memo((props: NodeProps) => {\n  const { id } = props\n  const { t } = useTranslation('components')\n  const [data, setData] = useState<{ input: string; output: string }[]>([])\n  const [input, setInput] = useState('')\n  const [output, setOutput] = useState('')\n  const node = useInternalNode(id)\n  const { createCSVData, loading } = useCreateCSVData()\n\n  const handleAdd = () => {\n    setData((prevData) => [...prevData, { input, output }])\n    setInput('')\n    setOutput('')\n  }\n  const handleCreateCSVData = async () => {\n    if (node) {\n      await createCSVData(\n        node,\n        ['input', 'output'],\n        data.map((item) => [item.input, item.output]),\n      )\n    }\n  }\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('add_few_shot_example_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col space-y-1.5\">\n          <Label htmlFor=\"name\">{t('add_few_shot_example_card.input')}</Label>\n          <Input\n            value={input}\n            onChange={(e) => setInput(e.target.value || '')}\n            id=\"name\"\n            placeholder={t('add_few_shot_example_card.input_placeholder')}\n          />\n        </div>\n        <div className=\"flex flex-col space-y-1.5 mt-3\">\n          <Label htmlFor=\"name\">{t('add_few_shot_example_card.output')}</Label>\n          <Textarea\n            value={output}\n            onChange={(e) => setOutput(e.target.value || '')}\n            placeholder={t('add_few_shot_example_card.output_placeholder')}\n          />\n        </div>\n        <div className=\"w-full flex mt-4 justify-end\">\n          <Button disabled={!input || !output} onClick={handleAdd} className=\"w-40\">\n            {t('add_few_shot_example_card.add')}\n          </Button>\n        </div>\n        <ExampleTable data={data || []} />\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={loading}\n          disabled={!data?.length}\n          onClick={handleCreateCSVData}\n          className=\"w-full\"\n        >\n          {t('add_few_shot_example_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateFewShotExampleCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum, ToolDefinition } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateTool = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createTool = useCallback(\n    async (\n      source: Node,\n      data: Partial<ToolDefinition>,\n      options?: {\n        schemaNode?: Node\n      },\n    ) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        if (!data.name || !data.description) {\n          throw new Error('Name is required')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const tool = await getRepository('ToolDefinition').save({\n          ...data,\n          name: `${data.name}`,\n          description: `${data.description}`,\n          session_id: sessionId,\n        })\n        if (!tool) {\n          throw new Error('Failed create tool.')\n        }\n        const toolNode = await createOrUpdateFlowNode({\n          source_id: tool.id,\n          source_type: 'ToolDefinition',\n          node_type: FlowNodeTypeEnum.ToolDefinition,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!toolNode) {\n          throw new Error('Failed to save node')\n        }\n        if (options?.schemaNode) {\n          await createOrUpdateFlowEdge({\n            source: options.schemaNode.id,\n            target: toolNode.id,\n          })\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    loading,\n    createTool,\n  }\n}\n","import { memo, useState } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { useCreateTool } from 'src/hooks/flows/mutations/use-create-tool'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { logWarn } from 'src/utils/logger'\n\nconst CreateToolCard = memo((props: NodeProps) => {\n  const { t } = useTranslation('components')\n  const { toast } = useToast()\n  const { id } = props\n  const node = useInternalNode(id)\n  const [name, setName] = useState('')\n  const [description, setDescription] = useState('')\n\n  const { createTool, loading } = useCreateTool()\n\n  const handleChangeName = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setName(e.target.value)\n  }\n\n  const handleChangeDescription = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setDescription(e.target.value)\n  }\n\n  const handleSubmit = async () => {\n    if (node && name && description) {\n      try {\n        await createTool(node, { name, description })\n        setName('')\n        setDescription('')\n      } catch (error) {\n        logWarn('Create Tool', error)\n        toast({\n          variant: 'destructive',\n          title: t('add_tool_card.errors.create_tool_failed'),\n        })\n      }\n    }\n  }\n\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('add_tool_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col space-y-1.5\">\n          <Label htmlFor=\"name\">{t('add_tool_card.tool_name')}</Label>\n          <Input\n            onChange={handleChangeName}\n            id=\"name\"\n            placeholder={t('add_tool_card.name_placeholder')}\n          />\n        </div>\n        <div className=\"flex flex-col space-y-1.5 mt-3\">\n          <Label htmlFor=\"name\">{t('add_tool_card.tool_description')}</Label>\n          <Textarea\n            onChange={handleChangeDescription}\n            placeholder={t('add_tool_card.description_placeholder')}\n          />\n        </div>\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton loading={loading} onClick={handleSubmit} className=\"w-full\">\n          {t('add_tool_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateToolCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  VectorDatabase,\n  VectorDatabaseProviderEnum,\n  VectorDatabaseStorageEnum,\n  VectorDatabaseTypeEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\nimport { encodeSplitter } from 'src/utils/string-data'\n\nexport const useCreateVectorDatabase = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createVectorDatabase = useCallback(\n    async (\n      source: Node,\n      data: Partial<VectorDatabase>,\n      textSplitter?: {\n        type: string\n        chunkSize: number\n        chunkOverlap: number\n      },\n    ) => {\n      try {\n        if (!data?.name || !source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const vectorDatabase = await getRepository('VectorDatabase').save({\n          ...data,\n          name: `${data.name}`,\n          type: data.type || VectorDatabaseTypeEnum.Local,\n          storage: data.storage || VectorDatabaseStorageEnum.DatabaseNode,\n          raw: '',\n          provider: data.provider || VectorDatabaseProviderEnum.Memory,\n          session_id: sessionId,\n          metadata: textSplitter ? JSON.stringify({ textSplitter }) : undefined,\n        })\n\n        if (!vectorDatabase) {\n          throw new Error('Failed to save vectorDatabase')\n        }\n\n        const vectorDatabaseNode = await createOrUpdateFlowNode({\n          source_id: vectorDatabase.id,\n          source_type: 'VectorDatabase',\n          node_type: FlowNodeTypeEnum.VectorDatabase,\n          x: initialX,\n          y: initialY + 30,\n        })\n        if (!vectorDatabaseNode) {\n          throw new Error('Failed to save vectorDatabase node')\n        }\n\n        if (data.storage === VectorDatabaseStorageEnum.DataNode) {\n          // Default JSONLData source\n          const databaseSource = await getRepository('JSONLData').save({\n            headers: encodeSplitter(['content', 'embedding', 'metadata']),\n            jsonl: '',\n            session_id: sessionId,\n          })\n          if (!databaseSource) {\n            throw new Error('Failed to save databaseSource')\n          }\n          const databaseSourceNode = await createOrUpdateFlowNode({\n            source_id: databaseSource.id,\n            source_type: 'JSONLData',\n            node_type: FlowNodeTypeEnum.JSONLData,\n            x: initialX + 80,\n            y: initialY + 30,\n          })\n          if (!databaseSourceNode) {\n            throw new Error('Failed to save databaseSource node')\n          }\n\n          await createOrUpdateFlowEdge({\n            source: databaseSourceNode.id,\n            target: vectorDatabaseNode.id,\n          })\n        }\n\n        return {\n          vectorDatabase,\n          vectorDatabaseNode,\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    loading,\n    createVectorDatabase,\n  }\n}\n","import { VectorDatabaseProviderEnum, VectorDatabaseStorageEnum } from 'src/services/database/types'\n\nexport const SUPPORTED_VECTOR_DATABASE_PROVIDERS = [VectorDatabaseProviderEnum.Memory]\n\nexport const SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE = [VectorDatabaseStorageEnum.DatabaseNode]\n\nexport const SUPPORTED_TEXT_SPLITTERS = [\n  'TokenTextSplitter',\n  'CharacterTextSplitter',\n  'RecursiveCharacterTextSplitter',\n]\n","import { memo, useCallback, useState } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { VectorDatabaseProviderEnum, VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { useCreateVectorDatabase } from 'src/hooks/flows/mutations/use-create-vector-database'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport {\n  SUPPORTED_TEXT_SPLITTERS,\n  SUPPORTED_VECTOR_DATABASE_PROVIDERS,\n  SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE,\n} from './constants'\n\nconst CreateVectorDatabaseCard = memo((props: NodeProps) => {\n  const { t } = useTranslation('components')\n  const { id } = props\n  const node = useInternalNode(id)\n  const { toast } = useToast()\n  const [name, setName] = useState('')\n  const [provider, setProvider] = useState<`${VectorDatabaseProviderEnum}`>(\n    SUPPORTED_VECTOR_DATABASE_PROVIDERS[0],\n  )\n  const [storageType, setStorageType] = useState<`${VectorDatabaseStorageEnum}`>(\n    SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE[0],\n  )\n  const [textSplitter, setTextSplitter] = useState<{\n    type?: string\n    chunkSize?: number\n    chunkOverlap?: number\n  }>({})\n  const { loading, createVectorDatabase } = useCreateVectorDatabase()\n\n  const handleOnSelectProvider = useCallback((value: `${VectorDatabaseProviderEnum}`) => {\n    setProvider(value)\n  }, [])\n\n  const handleOnSelectStorageType = useCallback((value: `${VectorDatabaseStorageEnum}`) => {\n    setStorageType(value)\n  }, [])\n\n  const handleOnSelectTextSplitter = useCallback((value: string) => {\n    setTextSplitter((prev) => ({ ...prev, type: value, chunkSize: 500, chunkOverlap: 40 }))\n  }, [])\n\n  const handleOnChangeName = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setName(e.target.value || '')\n  }, [])\n\n  const handleOnChangeChunkSize = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setTextSplitter((prev) => ({ ...prev, chunkSize: Number(e.target.value) }))\n  }, [])\n\n  const handleOnChangeChunkOverlap = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setTextSplitter((prev) => ({ ...prev, chunkOverlap: Number(e.target.value) }))\n  }, [])\n\n  const handleSubmit = async () => {\n    try {\n      if (!node) {\n        return\n      }\n      await createVectorDatabase(\n        node,\n        {\n          name,\n          provider,\n          storage: storageType,\n        },\n        textSplitter?.type\n          ? {\n              type: textSplitter.type,\n              chunkSize: textSplitter.chunkSize || 500,\n              chunkOverlap: textSplitter.chunkOverlap || 0,\n            }\n          : undefined,\n      )\n      setName('')\n      setTextSplitter({})\n    } catch {\n      toast({\n        variant: 'destructive',\n        description: t('create_vector_database_card.errors.create_failed'),\n      })\n    }\n  }\n\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('create_vector_database_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid w-full gap-1.5\">\n          <Label>{t('create_vector_database_card.name')}</Label>\n          <Input className=\"mb-4\" value={name} onChange={handleOnChangeName} />\n          {SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE?.length > 1 ? (\n            <>\n              <Label>{t('create_vector_database_card.storage_type')}</Label>\n              <Select value={storageType} onValueChange={handleOnSelectStorageType}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue\n                    placeholder={t('create_vector_database_card.provider_select_placeholder')}\n                  />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE).map((item) => {\n                    return (\n                      <SelectItem key={item} value={item}>\n                        {t(`create_vector_database_card.storage_types.${item.toLowerCase()}`)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          {SUPPORTED_VECTOR_DATABASE_PROVIDERS?.length > 1 ? (\n            <>\n              <Label>{t('create_vector_database_card.provider')}</Label>\n              <Select value={provider} onValueChange={handleOnSelectProvider}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue\n                    placeholder={t('create_vector_database_card.provider_select_placeholder')}\n                  />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(SUPPORTED_VECTOR_DATABASE_PROVIDERS).map((item) => {\n                    return (\n                      <SelectItem key={item} value={item}>\n                        {t(`create_vector_database_card.providers.${item.toLowerCase()}`)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          <Label>{t('create_vector_database_card.text_splitter')}</Label>\n          <Select value={textSplitter.type} onValueChange={handleOnSelectTextSplitter}>\n            <SelectTrigger className=\"w-full mb-4\">\n              <SelectValue\n                placeholder={t('create_vector_database_card.text_splitter_select_placeholder')}\n              />\n            </SelectTrigger>\n            <SelectContent>\n              {Object.values(SUPPORTED_TEXT_SPLITTERS).map((item) => {\n                return (\n                  <SelectItem key={item} value={item}>\n                    {t(`create_vector_database_card.text_splitters.${item.toLowerCase()}`)}\n                  </SelectItem>\n                )\n              })}\n            </SelectContent>\n          </Select>\n          {textSplitter.type ? (\n            <Card>\n              <CardHeader>\n                <CardTitle>\n                  {t('create_vector_database_card.text_splitter_configuration')}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Label>{t('create_vector_database_card.text_splitter_chunksize')}</Label>\n                <Input\n                  value={textSplitter.chunkSize}\n                  onChange={handleOnChangeChunkSize}\n                  placeholder={t('create_vector_database_card.text_splitter_chunksize_placeholder')}\n                />\n                <Label>{t('create_vector_database_card.text_splitter_chunkoverlap')}</Label>\n                <Input\n                  value={textSplitter.chunkOverlap}\n                  onChange={handleOnChangeChunkOverlap}\n                  placeholder={t(\n                    'create_vector_database_card.text_splitter_chunkoverlap_placeholder',\n                  )}\n                />\n              </CardContent>\n            </Card>\n          ) : undefined}\n        </div>\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          disabled={!textSplitter.type || !name}\n          loading={loading}\n          onClick={handleSubmit}\n          className=\"w-full\"\n        >\n          {t('create_vector_database_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateVectorDatabaseCard\n","import { useTranslation } from 'react-i18next'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from 'src/lib/shadcn/ui/table'\n\nexport function DataTable({ data }: { data: { text: string }[] }) {\n  const { t } = useTranslation('components')\n  return (\n    <Table className=\"w-full\">\n      <TableHeader>\n        <TableRow>\n          <TableHead>{t('add_text_data.text')}</TableHead>\n        </TableRow>\n      </TableHeader>\n      <TableBody>\n        {data?.map((item, index) => (\n          <TableRow key={`${item.text}_${index}`}>\n            <TableCell className=\"p-4\">{item.text}</TableCell>\n          </TableRow>\n        ))}\n      </TableBody>\n    </Table>\n  )\n}\n","import { memo, useState } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { useCreateCSVData } from 'src/hooks/flows/mutations/use-create-csv-data'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { DataTable } from './DataTable'\n\nconst CreateTextDataCard = memo((props: NodeProps) => {\n  const { id } = props\n  const { t } = useTranslation('components')\n  const [data, setData] = useState<{ text: string }[]>([])\n  const [text, setText] = useState('')\n  const node = useInternalNode(id)\n  const { createCSVData, loading } = useCreateCSVData()\n\n  const handleAdd = () => {\n    setData((prevData) => [...prevData, { text }])\n    setText('')\n  }\n  const handleCreateCSVData = async () => {\n    if (node) {\n      await createCSVData(\n        node,\n        ['text'],\n        data.map((item) => [item.text]),\n      )\n    }\n  }\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('add_text_data.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col space-y-1.5 mt-3\">\n          <Label htmlFor=\"name\">{t('add_text_data.text')}</Label>\n          <Textarea\n            value={text}\n            onChange={(e) => setText(e.target.value || '')}\n            placeholder={t('add_text_data.text_placeholder')}\n          />\n        </div>\n        <div className=\"w-full flex mt-4 justify-end\">\n          <Button disabled={!text} onClick={handleAdd} className=\"w-40\">\n            {t('add_text_data.add')}\n          </Button>\n        </div>\n        <DataTable data={data || []} />\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={loading}\n          disabled={!data?.length}\n          onClick={handleCreateCSVData}\n          className=\"w-full\"\n        >\n          {t('add_text_data.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateTextDataCard\n","export enum SupportedAddNodeEnum {\n  ADD_LLM = 'ADD_LLM',\n  ADD_PROMPT = 'ADD_PROMPT',\n  ADD_TOOL_DEFINITION = 'ADD_TOOL_DEFINITION',\n  ADD_SCHEMA = 'ADD_SCHEMA',\n  ADD_FEW_SHOT_EXAMPLE = 'ADD_FEW_SHOT_EXAMPLE',\n  ADD_VECTOR_DATABASE = 'ADD_VECTOR_DATABASE',\n  ADD_TEXT_DATA = 'ADD_TEXT_DATA',\n}\nexport const SUPPORTED_MODES = [\n  SupportedAddNodeEnum.ADD_LLM,\n  SupportedAddNodeEnum.ADD_PROMPT,\n  SupportedAddNodeEnum.ADD_SCHEMA,\n  SupportedAddNodeEnum.ADD_VECTOR_DATABASE,\n  {\n    key: 'more',\n    label: 'more',\n    icon: 'ellipsis' as const,\n    children: [SupportedAddNodeEnum.ADD_TOOL_DEFINITION, SupportedAddNodeEnum.ADD_FEW_SHOT_EXAMPLE],\n  },\n]\n","import React, { ReactNode, useEffect, useRef } from 'react'\n\nexport interface BaseParticle {\n  element: HTMLElement | SVGSVGElement\n  left: number\n  size: number\n  top: number\n}\n\nexport interface BaseParticleOptions {\n  particle?: string\n  size?: number\n}\n\nexport interface CoolParticle extends BaseParticle {\n  direction: number\n  speedHorz: number\n  speedUp: number\n  spinSpeed: number\n  spinVal: number\n}\n\nexport interface CoolParticleOptions extends BaseParticleOptions {\n  particleCount?: number\n  speedHorz?: number\n  speedUp?: number\n}\n\nconst getContainer = () => {\n  const id = '_coolMode_effect'\n  const existingContainer = document.getElementById(id)\n\n  if (existingContainer) {\n    return existingContainer\n  }\n\n  const container = document.createElement('div')\n  container.setAttribute('id', id)\n  container.setAttribute(\n    'style',\n    'overflow:hidden; position:fixed; height:100%; top:0; left:0; right:0; bottom:0; pointer-events:none; z-index:2147483647',\n  )\n\n  document.body.appendChild(container)\n\n  return container\n}\n\nlet instanceCounter = 0\n\nconst applyParticleEffect = (element: HTMLElement, options?: CoolParticleOptions): (() => void) => {\n  instanceCounter++\n\n  const defaultParticle = 'circle'\n  const particleType = options?.particle || defaultParticle\n  const sizes = [15, 20, 25, 35, 45]\n  const limit = 45\n\n  let particles: CoolParticle[] = []\n  let autoAddParticle = false\n  let mouseX = 0\n  let mouseY = 0\n\n  const container = getContainer()\n\n  function generateParticle() {\n    const size = options?.size || sizes[Math.floor(Math.random() * sizes.length)]\n    const speedHorz = options?.speedHorz || Math.random() * 10\n    const speedUp = options?.speedUp || Math.random() * 25\n    const spinVal = Math.random() * 360\n    const spinSpeed = Math.random() * 35 * (Math.random() <= 0.5 ? -1 : 1)\n    const top = mouseY - size / 2\n    const left = mouseX - size / 2\n    const direction = Math.random() <= 0.5 ? -1 : 1\n\n    const particle = document.createElement('div')\n\n    if (particleType === 'circle') {\n      const svgNS = 'http://www.w3.org/2000/svg'\n      const circleSVG = document.createElementNS(svgNS, 'svg')\n      const circle = document.createElementNS(svgNS, 'circle')\n      circle.setAttributeNS(null, 'cx', (size / 2).toString())\n      circle.setAttributeNS(null, 'cy', (size / 2).toString())\n      circle.setAttributeNS(null, 'r', (size / 2).toString())\n      circle.setAttributeNS(null, 'fill', `hsl(${Math.random() * 360}, 70%, 50%)`)\n\n      circleSVG.appendChild(circle)\n      circleSVG.setAttribute('width', size.toString())\n      circleSVG.setAttribute('height', size.toString())\n\n      particle.appendChild(circleSVG)\n    } else {\n      particle.innerHTML = `<img src=\"${particleType}\" width=\"${size}\" height=\"${size}\" style=\"border-radius: 50%\">`\n    }\n\n    particle.style.position = 'absolute'\n    particle.style.transform = `translate3d(${left}px, ${top}px, 0px) rotate(${spinVal}deg)`\n\n    container.appendChild(particle)\n\n    particles.push({\n      direction,\n      element: particle,\n      left,\n      size,\n      speedHorz,\n      speedUp,\n      spinSpeed,\n      spinVal,\n      top,\n    })\n  }\n\n  function refreshParticles() {\n    particles.forEach((p) => {\n      p.left = p.left - p.speedHorz * p.direction\n      p.top = p.top - p.speedUp\n      p.speedUp = Math.min(p.size, p.speedUp - 1)\n      p.spinVal = p.spinVal + p.spinSpeed\n\n      if (p.top >= Math.max(window.innerHeight, document.body.clientHeight) + p.size) {\n        particles = particles.filter((o) => o !== p)\n        p.element.remove()\n      }\n\n      p.element.setAttribute(\n        'style',\n        [\n          'position:absolute',\n          'will-change:transform',\n          `top:${p.top}px`,\n          `left:${p.left}px`,\n          `transform:rotate(${p.spinVal}deg)`,\n        ].join(';'),\n      )\n    })\n  }\n\n  let animationFrame: number | undefined\n\n  let lastParticleTimestamp = 0\n  const particleGenerationDelay = 30\n\n  function loop() {\n    const currentTime = performance.now()\n    if (\n      autoAddParticle &&\n      particles.length < limit &&\n      currentTime - lastParticleTimestamp > particleGenerationDelay\n    ) {\n      generateParticle()\n      lastParticleTimestamp = currentTime\n    }\n\n    refreshParticles()\n    animationFrame = requestAnimationFrame(loop)\n  }\n\n  loop()\n\n  const isTouchInteraction = 'ontouchstart' in window\n\n  const tap = isTouchInteraction ? 'touchstart' : 'mousedown'\n  const tapEnd = isTouchInteraction ? 'touchend' : 'mouseup'\n  const move = isTouchInteraction ? 'touchmove' : 'mousemove'\n\n  const updateMousePosition = (e: MouseEvent | TouchEvent) => {\n    if ('touches' in e) {\n      mouseX = e.touches?.[0].clientX\n      mouseY = e.touches?.[0].clientY\n    } else {\n      mouseX = e.clientX\n      mouseY = e.clientY\n    }\n  }\n\n  const tapHandler = (e: MouseEvent | TouchEvent) => {\n    updateMousePosition(e)\n    autoAddParticle = true\n  }\n\n  const disableAutoAddParticle = () => {\n    autoAddParticle = false\n  }\n\n  element.addEventListener(move, updateMousePosition, { passive: true })\n  element.addEventListener(tap, tapHandler, { passive: true })\n  element.addEventListener(tapEnd, disableAutoAddParticle, { passive: true })\n  element.addEventListener('mouseleave', disableAutoAddParticle, {\n    passive: true,\n  })\n\n  return () => {\n    element.removeEventListener(move, updateMousePosition)\n    element.removeEventListener(tap, tapHandler)\n    element.removeEventListener(tapEnd, disableAutoAddParticle)\n    element.removeEventListener('mouseleave', disableAutoAddParticle)\n\n    const interval = setInterval(() => {\n      if (animationFrame && particles.length === 0) {\n        cancelAnimationFrame(animationFrame)\n        clearInterval(interval)\n\n        if (--instanceCounter === 0) {\n          container.remove()\n        }\n      }\n    }, 500)\n  }\n}\n\ninterface CoolModeProps {\n  children: ReactNode\n  options?: CoolParticleOptions\n}\n\nexport const CoolMode: React.FC<CoolModeProps> = ({ children, options }) => {\n  const ref = useRef<HTMLElement>(null)\n\n  useEffect(() => {\n    if (ref.current) {\n      return applyParticleEffect(ref.current, options)\n    }\n  }, [options])\n\n  return React.cloneElement(children as React.ReactElement, { ref })\n}\n","import { NodeProps } from '@xyflow/react'\nimport { memo, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport {\n  Menubar,\n  MenubarContent,\n  MenubarItem,\n  MenubarMenu,\n  MenubarTrigger,\n} from 'src/lib/shadcn/ui/menubar'\nimport CreateLLMCard from 'src/components/molecules/CreateLLMCard'\nimport CreatePromptCard from 'src/components/molecules/CreatePromptCard'\nimport CreateSchemaCard from 'src/components/molecules/CreateSchemaCard'\nimport CreateFewShotExampleCard from 'src/components/molecules/CreateFewShotExampleCard'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport CreateToolCard from 'src/components/molecules/CreateToolCard'\nimport CreateVectorDatabaseCard from 'src/components/molecules/CreateVectorDatabaseCard'\nimport Logo from 'src/assets/svgs/logo.svg?react'\nimport CreateTextDataCard from 'src/components/molecules/CreateTextDataCard'\nimport { useAppState } from 'src/states/app'\nimport { cn } from 'src/lib/utils'\n\nimport { SUPPORTED_MODES, SupportedAddNodeEnum } from './constants'\nimport { CoolMode } from 'src/lib/shadcn/ui/cool-mode'\nimport { Button } from 'src/lib/shadcn/ui/button'\n\nexport const ToolbarNode = memo((props: NodeProps) => {\n  const { t } = useTranslation('flows')\n  const theme = useAppState((state) => state.theme)\n  const [mode, setMode] = useState(`${SupportedAddNodeEnum.ADD_LLM}`)\n\n  const menu = useMemo(() => {\n    return (\n      <Menubar>\n        <MenubarMenu>\n          <CoolMode>\n            <Button variant=\"link\" className=\"!p-0 !pl-3\">\n              <Logo\n                width={32}\n                height={32}\n                className={cn(theme === 'dark' ? 'fill-white' : 'fill-black')}\n              />\n            </Button>\n          </CoolMode>\n        </MenubarMenu>\n        {SUPPORTED_MODES.map((mode) => {\n          if (typeof mode === 'object') {\n            return (\n              <MenubarMenu key={mode.key}>\n                <MenubarTrigger>\n                  {mode.icon ? <LazyIcon name={mode.icon} /> : t(`supported_nodes.${mode.label}`)}\n                </MenubarTrigger>\n                <MenubarContent>\n                  {mode.children.map((child) => {\n                    return (\n                      <MenubarItem key={child} onClick={() => setMode(child)}>\n                        {t(`supported_nodes.${child.toLowerCase()}`)}\n                      </MenubarItem>\n                    )\n                  })}\n                </MenubarContent>\n              </MenubarMenu>\n            )\n          }\n          return (\n            <MenubarMenu key={mode}>\n              <MenubarTrigger value={mode} onClick={() => setMode(mode)}>\n                {t(`supported_nodes.${mode.toLowerCase()}`)}\n              </MenubarTrigger>\n            </MenubarMenu>\n          )\n        })}\n      </Menubar>\n    )\n  }, [t, theme])\n\n  const modeToComponent = useMemo(() => {\n    switch (mode) {\n      case SupportedAddNodeEnum.ADD_LLM:\n        return <CreateLLMCard {...props} />\n      case SupportedAddNodeEnum.ADD_PROMPT:\n        return <CreatePromptCard {...props} />\n      case SupportedAddNodeEnum.ADD_SCHEMA:\n        return <CreateSchemaCard {...props} />\n      case SupportedAddNodeEnum.ADD_FEW_SHOT_EXAMPLE:\n        return <CreateFewShotExampleCard {...props} />\n      case SupportedAddNodeEnum.ADD_TOOL_DEFINITION:\n        return <CreateToolCard {...props} />\n      case SupportedAddNodeEnum.ADD_VECTOR_DATABASE:\n        return <CreateVectorDatabaseCard {...props} />\n      case SupportedAddNodeEnum.ADD_TEXT_DATA:\n        return <CreateTextDataCard {...props} />\n    }\n  }, [props, mode])\n  return (\n    <>\n      {menu}\n      <div className=\"mt-4\">{modeToComponent}</div>\n    </>\n  )\n})\n","import { useCallback, useState } from 'react'\nimport { Connection, Node } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport {\n  AppEntityNames,\n  FlowNodeTypeEnum,\n  flowNodeTypeToEntity,\n  Session,\n  SessionStatusEnum,\n  SessionTypeEnum,\n} from 'src/services/database/types'\nimport { EntityType } from 'src/utils/orm-type'\nimport { DefaultNodeData } from 'src/utils/flow-node'\nimport { useNavigate } from 'react-router-dom'\nimport { getRouteURL } from 'src/utils/routes'\n\nexport const useCreateStandaloneSession = () => {\n  const [loading, setLoading] = useState(false)\n  const navigate = useNavigate()\n  const currentSession = useSessionState((state) => state.currentSession)\n\n  const cloneNode = useCallback(\n    async (\n      newSession: Session,\n      node: Node<DefaultNodeData>,\n      newEntityIDMap: Map<string, string>,\n      newFlowNodeIDMap: Map<string, string>,\n    ) => {\n      const entity = node.data?.entity\n      let entityName = node.type ? flowNodeTypeToEntity[node.type as FlowNodeTypeEnum] : undefined\n      if (\n        entityName &&\n        entity &&\n        node &&\n        typeof entity === 'object' &&\n        'id' in entity &&\n        !newEntityIDMap.has(`${entity.id}`) &&\n        !newFlowNodeIDMap.has(`${node.id}`)\n      ) {\n        entityName = entityName as AppEntityNames\n        const cloneEntity = await getRepository(entityName).save({\n          ...entity,\n          ...(entity && typeof entity === 'object' && 'session_id' in entity\n            ? { session_id: newSession.id }\n            : {}),\n        } as EntityType<unknown>)\n        newEntityIDMap.set(`${entity.id}`, cloneEntity.id)\n        const currentFlowNode = await getRepository('FlowNode').findOne({\n          where: {\n            id: node.data.flowNode.id,\n          },\n        })\n        const cloneFlowNode = await getRepository('FlowNode').save({\n          ...(currentFlowNode || node.data.flowNode),\n          session_id: newSession.id,\n          id: undefined,\n          source_type: entityName,\n          source_id: cloneEntity.id,\n        })\n        newFlowNodeIDMap.set(`${node.id}`, cloneFlowNode.id)\n        return {\n          entityName,\n          entity: cloneEntity,\n          node: cloneFlowNode,\n        }\n      } else if (!newFlowNodeIDMap.has(`${node.id}`)) {\n        const currentFlowNode = await getRepository('FlowNode').findOne({\n          where: {\n            id: node.data.flowNode.id,\n          },\n        })\n        const cloneFlowNode = await getRepository('FlowNode').save({\n          ...(currentFlowNode || node.data.flowNode),\n          node_type: node.type as FlowNodeTypeEnum,\n          session_id: newSession.id,\n          id: undefined,\n        })\n        newFlowNodeIDMap.set(`${node.id}`, cloneFlowNode.id)\n        return {\n          node: cloneFlowNode,\n        }\n      }\n    },\n    [],\n  )\n\n  const createStandaloneSession = useCallback(\n    async (\n      node: Node<DefaultNodeData>,\n      options: {\n        name?: string\n        connections: {\n          node: Node<DefaultNodeData>\n          connections: Connection[]\n          connectedNodes?: Node<DefaultNodeData>[]\n        }[]\n      },\n    ) => {\n      try {\n        if (!currentSession) {\n          throw new Error('No current session')\n        }\n        setLoading(true)\n        const standaloneSession = await getRepository('Session').save({\n          type: SessionTypeEnum.StandaloneApp,\n          name: options.name || (currentSession?.name ? `${currentSession.name}` : 'Standalone'),\n          status: SessionStatusEnum.Started,\n          passphrase: currentSession.passphrase,\n        })\n        if (!standaloneSession) {\n          throw new Error('Failed create standalone session')\n        }\n        const newEntityIDMap = new Map<string, string>()\n        const newFlowNodeIDMap = new Map<string, string>()\n        // Clone node\n        const mainNodeInfo = await cloneNode(\n          standaloneSession,\n          node,\n          newEntityIDMap,\n          newFlowNodeIDMap,\n        )\n        if (!mainNodeInfo) {\n          throw new Error('Failed to clone main node')\n        }\n        await getRepository('Session').update(standaloneSession.id, {\n          main_node_id: mainNodeInfo.node.id,\n          main_source_id: mainNodeInfo?.entity ? mainNodeInfo.entity.id : undefined,\n          main_source_type: mainNodeInfo.entityName ? mainNodeInfo.entityName : undefined,\n        })\n        // Clone connected nodes\n        for (const { node, connectedNodes } of options.connections) {\n          await cloneNode(standaloneSession, node, newEntityIDMap, newFlowNodeIDMap)\n          // Clone Connected Nodes\n          if (connectedNodes) {\n            for (const connectedNode of connectedNodes) {\n              await cloneNode(standaloneSession, connectedNode, newEntityIDMap, newFlowNodeIDMap)\n            }\n          }\n        }\n        // Clone connections\n        for (const { connections } of options.connections) {\n          for (const connection of connections) {\n            const sourceId = newFlowNodeIDMap.get(`${connection.source}`)\n            const targetId = newFlowNodeIDMap.get(`${connection.target}`)\n            if (!sourceId || !targetId) {\n              throw new Error('Failed to get connected flow node id')\n            }\n            await getRepository('FlowEdge').save({\n              source: sourceId,\n              target: targetId,\n              sourceHandle: connection.sourceHandle,\n              targetHandle: connection.targetHandle,\n              session_id: standaloneSession.id,\n            })\n          }\n        }\n\n        navigate(getRouteURL('application', { applicationId: standaloneSession.id }))\n        return true\n      } finally {\n        setLoading(false)\n      }\n    },\n    [cloneNode, currentSession, navigate],\n  )\n\n  return {\n    loading,\n    createStandaloneSession,\n  }\n}\n","import { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { useFlowState } from 'src/states/flow'\n\nexport const useDeleteNodeFlow = () => {\n  const [loading, setLoading] = useState(false)\n  const updateNode = useFlowState((state) => state.updateNodes)\n  const updateEdges = useFlowState((state) => state.updateEdges)\n\n  const deleteNodeFlow = useCallback(\n    async (id: string) => {\n      try {\n        setLoading(true)\n        await getRepository('FlowNode').delete(id)\n        const edges = await getRepository('FlowEdge').find({\n          where: [{ source: id }, { target: id }],\n        })\n        await Promise.all(edges.map((edge) => getRepository('FlowEdge').delete(edge.id)))\n        await updateNode([{ id, type: 'remove' as const }])\n        await updateEdges(edges.map((edge) => ({ id: edge.id, type: 'remove' as const })))\n        return true\n      } catch {\n        return false\n      } finally {\n        setLoading(false)\n      }\n    },\n    [updateEdges, updateNode],\n  )\n\n  return {\n    loading,\n    deleteNodeFlow,\n  }\n}\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from 'src/lib/shadcn/ui/dialog'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { Label } from 'src/lib/shadcn/ui/label'\n\ntype CreateSessionProps = {\n  className: string\n  cloneStandaloneSession: (name?: string) => Promise<void>\n}\n\nconst CreateStandaloneApplicationDialog = create<CreateSessionProps>(\n  ({ cloneStandaloneSession }) => {\n    const currentModal = useModal()\n    const { t } = useTranslation('dialogs')\n    const [name, setName] = useState('')\n\n    const { toast } = useToast()\n\n    const handleChangeName = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setName(e.target.value)\n    }\n\n    const handleSubmit = async () => {\n      try {\n        currentModal.hide()\n        await cloneStandaloneSession(name)\n        setName('')\n      } catch {\n        toast({\n          variant: 'destructive',\n          description: t('create_standalone_application.errors.create_failed'),\n        })\n      }\n    }\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>{t('create_session.title')}</DialogTitle>\n            <DialogDescription>{t('create_standalone_application.description')}</DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"flex flex-col space-y-1.5\">\n              <Label className=\"mb-2\" htmlFor=\"name\">\n                {t('create_standalone_application.name')}\n              </Label>\n              <Input\n                onChange={handleChangeName}\n                id=\"name\"\n                value={name}\n                placeholder={t('create_standalone_application.name_placeholder')}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button onClick={handleSubmit} disabled={!name} type=\"submit\">\n              {t('create_standalone_application.create')}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default CreateStandaloneApplicationDialog\n","import { memo, useCallback } from 'react'\nimport { Node, Connection, useReactFlow } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { useCreateStandaloneSession } from 'src/hooks/mutations/use-create-standalone-session'\nimport { useDeleteNodeFlow } from 'src/hooks/flows/mutations/use-delete-node-flow'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { cn } from 'src/lib/utils'\nimport { DefaultNodeData, DefaultNodeProps } from 'src/utils/flow-node'\nimport { EntityType } from 'src/utils/orm-type'\nimport { logError } from 'src/utils/logger'\nimport { useModal } from '@ebay/nice-modal-react'\nimport CreateStandaloneApplicationDialog from 'src/components/dialogs/CreateStandaloneApplicationDialog'\n\nexport const NodeHeader = memo(\n  ({\n    id,\n    className,\n    enableToStandalone,\n    getLinkedConnections,\n  }: {\n    id: string\n    className?: string\n    enableToStandalone?: boolean\n    getLinkedConnections?: (id: string) => {\n      node: Node<DefaultNodeProps<{ entity: EntityType<unknown> }>['data']>\n      connections: Connection[]\n      connectedNodes?: Node<DefaultNodeProps<{ entity: EntityType<unknown> }>['data']>[]\n    }[]\n  }) => {\n    const { t } = useTranslation('common')\n    const { getNode } = useReactFlow<Node<DefaultNodeData>>()\n    const { loading: deleting, deleteNodeFlow } = useDeleteNodeFlow()\n    const { createStandaloneSession } = useCreateStandaloneSession()\n    const { toast } = useToast()\n    const createStandaloneApplicationDialog = useModal(CreateStandaloneApplicationDialog)\n\n    const handleDelete = useCallback(async () => {\n      try {\n        await deleteNodeFlow(id)\n        toast({\n          description: t('deleted'),\n        })\n      } catch {\n        toast({\n          description: t('errors.delete_failed'),\n          variant: 'destructive',\n        })\n      }\n    }, [deleteNodeFlow, id, toast, t])\n\n    const cloneStandaloneSession = useCallback(\n      async (name?: string) => {\n        try {\n          const currentNode = getNode(id)\n          if (!currentNode) {\n            throw new Error('No current node')\n          }\n          const connections = getLinkedConnections?.(id) || []\n          await createStandaloneSession(currentNode, { name, connections })\n          toast({\n            description: t('standalone_session_created'),\n          })\n        } catch (error) {\n          logError('Clone Standalone Session', error)\n          toast({\n            description: t('errors.create_standalone_session_failed'),\n            variant: 'destructive',\n          })\n        }\n      },\n      [getNode, id, getLinkedConnections, createStandaloneSession, toast, t],\n    )\n\n    const handleCreateStandaloneApplication = useCallback(() => {\n      createStandaloneApplicationDialog.show({\n        cloneStandaloneSession,\n      })\n    }, [cloneStandaloneSession, createStandaloneApplicationDialog])\n\n    return (\n      <div className={cn('flex absolute z-[51] right-0 top-0 h-10', className)}>\n        {enableToStandalone ? (\n          <Button\n            className=\"!rounded-none !px-2\"\n            onClick={handleCreateStandaloneApplication}\n            variant=\"ghost\"\n          >\n            <LazyIcon name=\"package-plus\" size={16} />\n          </Button>\n        ) : undefined}\n        <LoadingButton\n          loading={deleting}\n          className=\"!rounded-none !px-2\"\n          onClick={handleDelete}\n          variant=\"ghost\"\n        >\n          <LazyIcon name=\"trash-2\" size={16} />\n        </LoadingButton>\n      </div>\n    )\n  },\n)\n","import { memo } from 'react'\nimport { Handle, HandleProps, Position } from '@xyflow/react'\nimport { cn } from 'src/lib/utils'\n\nexport const DefaultHandle = memo((props: HandleProps) => {\n  const { className, ...rest } = props\n  return (\n    <Handle\n      className={cn(\n        '!w-2 !h-2 !border-none !rounded-full !bg-slate-700',\n        props.position === Position.Top ? '!top-[-2px]' : '',\n        className,\n      )}\n      {...rest}\n    />\n  )\n})\n","import { useState, useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum, LLM } from 'src/services/database/types'\nimport { ThreadStatusEnum } from 'src/services/database/types/thread'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateThread = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const createThread = useCallback(\n    async (source: Node) => {\n      setLoading(true)\n      try {\n        const llm = source.data?.entity as LLM\n        if (!llm || !sessionId) {\n          throw new Error('LLM or Session not found')\n        }\n\n        const initialX = source.position.x\n        const initialY = source.position.y + (source.measured?.height || 0)\n        const thread = await getRepository('Thread').save({\n          initial_llm_id: llm.id,\n          title: `New thread with ${llm.name}`,\n          status: ThreadStatusEnum.Started,\n          messages: [],\n          session_id: sessionId,\n        })\n        const flowNode = await createOrUpdateFlowNode({\n          source_id: thread.id,\n          source_type: 'Thread',\n          node_type: FlowNodeTypeEnum.Thread,\n          x: initialX,\n          y: initialY + 60,\n        })\n        if (!flowNode) {\n          throw new Error('Failed to create thread node')\n        }\n        // Create connection from source to threadNode\n        const flowEdge = await createOrUpdateFlowEdge({\n          source: source.id,\n          target: flowNode.id,\n        })\n\n        return {\n          thread,\n          flowNode,\n          flowEdge,\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [createOrUpdateFlowEdge, createOrUpdateFlowNode, sessionId],\n  )\n\n  return {\n    loading,\n    createThread,\n  }\n}\n","import { useCallback, useEffect, useState } from 'react'\nimport { Node, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { FlowNodeTypeEnum, LLM, LLMProviderEnum, LLMStatusEnum } from 'src/services/database/types'\nimport { useCreateThread } from 'src/hooks/flows/mutations/use-create-thread'\nimport { useFlowState } from 'src/states/flow'\nimport { getRepository } from 'src/services/database'\nimport { In } from 'src/services/database/typeorm-wrapper'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { logError } from 'src/utils/logger'\nimport { useLoadModel } from 'src/hooks/mutations/use-load-model'\n\nimport { LLMNodeProps } from '../type'\n\nexport const useActions = (id: string, data: LLMNodeProps['data']) => {\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n  const [loadingModel, setLoadingModel] = useState(false)\n  const [queringThreads, setQueringThreads] = useState(false)\n  const node = useInternalNode(id) as Node<LLMNodeProps['data']>\n  const { loadModel } = useLoadModel()\n  const { createThread, loading: creatingThread } = useCreateThread()\n\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const pushSyncNodeQueue = useFlowState((state) => state.pushSyncNodeQueue)\n\n  const { getNodes } = useReactFlow()\n\n  const queryThreadsFromModel = useCallback(async () => {\n    try {\n      setQueringThreads(true)\n      if (data.entity.id) {\n        const threads = await getRepository('Thread').find({\n          where: {\n            initial_llm_id: data.entity.id,\n          },\n        })\n        pushSyncNodeQueue('Thread', {\n          where: {\n            source_type: 'Thread',\n            source_id: In(threads.map((thread) => thread.id)),\n          },\n        })\n      }\n    } finally {\n      setQueringThreads(false)\n    }\n  }, [data?.entity?.id, pushSyncNodeQueue])\n\n  const handleLoadModel = useCallback(async () => {\n    try {\n      setLoadingModel(true)\n      if (data.entity && node) {\n        await loadModel?.(data.entity.provider, `${data.entity.name}`, {\n          provider: data.entity.provider,\n          callback: (initProgress) => {\n            node.data.status =\n              initProgress.progress === 100 ? LLMStatusEnum.Loaded : LLMStatusEnum.Loading\n\n            node.data.label = initProgress.text\n            updateNodes([{ id, type: 'replace' as const, item: node }])\n          },\n        })\n        const llmNodeChanges = getNodes()\n          .filter((node) => {\n            const isLLMNode = node.type === FlowNodeTypeEnum.LLM\n            if (isLLMNode) {\n              const entity = node.data.entity as LLM\n              return entity.provider === LLMProviderEnum.WebLLM\n            }\n            return false\n          })\n          .map((node) => {\n            node.data.status = LLMStatusEnum.Started\n            return { id: node.id, type: 'replace' as const, item: node }\n          })\n        node.data.label = ''\n        node.data.status = LLMStatusEnum.Loaded\n        llmNodeChanges.push({\n          id,\n          type: 'replace' as const,\n          item: node,\n        })\n        updateNodes(llmNodeChanges)\n        await queryThreadsFromModel()\n      }\n    } catch (error) {\n      logError('Load Model', error)\n      toast({\n        variant: 'destructive',\n        description: t('llm_node.errors.loading_model'),\n      })\n    } finally {\n      setLoadingModel(false)\n    }\n  }, [data.entity, getNodes, id, loadModel, node, queryThreadsFromModel, t, toast, updateNodes])\n\n  const handleCreateThread = useCallback(async () => {\n    if (data.entity && node) {\n      await createThread?.(node)\n    }\n  }, [data.entity, node, createThread])\n\n  const changeLLMOptions = useCallback(\n    async (options: Record<string, unknown>) => {\n      if (data.entity && node) {\n        node.data.entity.options = options\n        await getRepository('LLM').update(data.entity.id, { options })\n        updateNodes([{ id, type: 'replace' as const, item: node }])\n      }\n    },\n    [data.entity, id, node, updateNodes],\n  )\n\n  useEffect(() => {\n    if (data.entity && node && data.entity.status !== data.status) {\n      node.data.status = data.entity.status as LLMStatusEnum\n      updateNodes([{ id, type: 'replace' as const, item: node }])\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  return {\n    loadingModel,\n    creatingThread,\n    queringThreads,\n    changeLLMOptions,\n    loadModel: handleLoadModel,\n    createThread: handleCreateThread,\n    queryThreads: queryThreadsFromModel,\n  }\n}\n","import { useCallback, useEffect, useState } from 'react'\nimport { Node, Connection, useHandleConnections, useReactFlow } from '@xyflow/react'\n\nimport { filterUserConnections } from 'src/utils/flow'\n\nexport const useBaseConnectionToHandler = (\n  id: string,\n  handlerFunction: (input: {\n    id: string\n    edgeId: string\n    source: Node\n    target: Node\n    connection: Connection\n  }) => Promise<{ deleteEdgeId: string | string[] } | undefined>,\n) => {\n  const [handling, setHandling] = useState(false)\n  const [newTargetConnection, setNewTargetConnection] = useState<Connection[]>([])\n  const { deleteElements, getNode } = useReactFlow()\n\n  useHandleConnections({\n    type: 'target',\n    nodeId: id,\n    onConnect: (newConnections) => {\n      if (newConnections?.length) {\n        setNewTargetConnection((pre) => [...pre, ...filterUserConnections(newConnections)])\n      }\n    },\n  })\n\n  const connectionHandler = useCallback(\n    async (edgeId: string, source: Node, target: Node, connection: Connection) => {\n      try {\n        const result = await handlerFunction({\n          id,\n          edgeId,\n          source,\n          target,\n          connection,\n        })\n\n        return result\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [handlerFunction, id],\n  )\n\n  useEffect(() => {\n    if (!newTargetConnection?.length || handling) {\n      return\n    }\n    const handle = async () => {\n      try {\n        setHandling(true)\n        const handlingConnections = [...newTargetConnection]\n        setNewTargetConnection([])\n        const removeEdgeIds: string[] = []\n        const target = getNode(id)\n        await Promise.all(\n          handlingConnections.map(async (connection) => {\n            const edgeId = 'edgeId' in connection ? connection.edgeId : undefined\n            const source = getNode(connection.source)\n            if (!source || !target) {\n              return\n            }\n\n            const response = await connectionHandler(`${edgeId}`, source, target, connection)\n\n            if (response?.deleteEdgeId) {\n              removeEdgeIds.push(\n                ...(Array.isArray(response.deleteEdgeId)\n                  ? response.deleteEdgeId\n                  : [response.deleteEdgeId]),\n              )\n            }\n          }),\n        )\n        if (removeEdgeIds?.length) {\n          await deleteElements({\n            edges: removeEdgeIds.map((id) => ({ id })),\n          })\n        }\n      } finally {\n        setHandling(false)\n      }\n    }\n    handle()\n  }, [deleteElements, getNode, id, handling, connectionHandler, newTargetConnection])\n}\n","import { useCallback } from 'react'\n\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const handleConnectionTo = useCallback(async () => {\n    return undefined\n  }, [])\n  useBaseConnectionToHandler(id, handleConnectionTo)\n}\n","import { memo, useCallback, useEffect, useMemo, useState } from 'react'\nimport { Position } from '@xyflow/react'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { LLMProviderEnum, LLMStatusEnum } from 'src/services/database/types/llm'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { BorderBeam } from 'src/lib/shadcn/ui/border-beam'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { LLMNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { LLMSetting } from 'src/components/atoms/LLMSetting'\n\nexport const LLMNode = memo((props: LLMNodeProps) => {\n  const { id, data, isConnectable } = props\n  const [llmInfo, setLLMInfo] = useState<\n    | { hasCache: boolean; isFunctionCalling: boolean; info?: ModelRecord; cloud?: boolean }\n    | undefined\n  >()\n  const { t } = useTranslation('flows')\n\n  const { createThread, loadModel, queringThreads, queryThreads, loadingModel, changeLLMOptions } =\n    useActions(id, data)\n  useConnectionToHandler(id)\n\n  const isLoading = [LLMStatusEnum.Loading, LLMStatusEnum.Downloading].includes(data.status)\n\n  useEffect(() => {\n    if (llmInfo || !data?.entity?.name) {\n      return\n    }\n    if (\n      ![LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(\n        data?.entity?.provider as LLMProviderEnum,\n      )\n    ) {\n      setLLMInfo({\n        hasCache: false,\n        cloud: true,\n        isFunctionCalling: true,\n        info: {\n          model_id: data?.entity?.name,\n          model: data?.entity?.name,\n          model_lib: data?.entity?.provider,\n          model_type: 2,\n        },\n      })\n      return\n    } else if (LLMProviderEnum.Wllama === data?.entity?.provider) {\n      import('@wllama/wllama').then(async ({ ModelManager }) => {\n        const modelManager = new ModelManager()\n        const models = await modelManager.getModels()\n        setLLMInfo({\n          hasCache: !!models.find((item) => item.url.includes(data?.entity?.name)),\n          cloud: false,\n          isFunctionCalling: false,\n          info: {\n            model_id: data?.entity?.name,\n            model: data?.entity?.name,\n            model_lib: data?.entity?.provider,\n            model_type: 2,\n          },\n        })\n      })\n      setLLMInfo({\n        hasCache: false,\n        cloud: false,\n        isFunctionCalling: true,\n        info: {\n          model_id: data?.entity?.name,\n          model: data?.entity?.name,\n          model_lib: data?.entity?.provider,\n          model_type: 2,\n        },\n      })\n      return\n    }\n\n    import('@mlc-ai/web-llm').then(\n      async ({ hasModelInCache, functionCallingModelIds, prebuiltAppConfig }) => {\n        const hasCache = await hasModelInCache(data?.entity?.name)\n        setLLMInfo({\n          hasCache,\n          isFunctionCalling: functionCallingModelIds.includes(data?.entity?.name),\n          info: prebuiltAppConfig.model_list.find((item) => item.model_id === data?.entity?.name),\n        })\n      },\n    )\n  }, [data?.entity?.name, data?.entity?.provider, llmInfo])\n\n  const onChangeOptions = useCallback(\n    async (options: Record<string, unknown>) => {\n      await changeLLMOptions(options)\n    },\n    [changeLLMOptions],\n  )\n\n  const llmIcon = useMemo(() => {\n    switch (data.status) {\n      case LLMStatusEnum.Downloading:\n        return <LazyIcon className={'animate-spin w-7 h-7'} name={'arrow-big-down-dash'} />\n      case LLMStatusEnum.Loaded:\n        return <LLMIcon name={data.entity?.name || 'brain'} className=\"w-7 h-7\" />\n      case LLMStatusEnum.Loading:\n        return <LazyIcon className={'animate-spin w-7 h-7'} name={'loader-circle'} />\n      default:\n        return <LLMIcon name={data.entity?.name || 'brain'} className=\"w-7 h-7\" />\n    }\n  }, [data.entity?.name, data.status])\n\n  const actions = useMemo(() => {\n    if (isLoading) {\n      return null\n    }\n    if (loadingModel) {\n      return (\n        <Button disabled={true} className=\"w-full mt-4\">\n          <LazyIcon className={'animate-spin'} size={24} name={'loader-circle'} />\n        </Button>\n      )\n    }\n    if (data.status === LLMStatusEnum.Loaded) {\n      return (\n        <Button onClick={createThread} className=\"mt-4 w-full\">\n          {t('llm_node.create_thread_button')}\n        </Button>\n      )\n    }\n    return (\n      <div className=\"flex gap-2 mt-4\">\n        {llmInfo?.hasCache ? (\n          <LoadingButton loading={queringThreads} onClick={queryThreads}>\n            <LazyIcon size={24} name={'message-square-more'} />\n          </LoadingButton>\n        ) : null}\n        <Button disabled={loadingModel} onClick={loadModel} className=\"w-full\">\n          {t(llmInfo?.hasCache ? 'llm_node.load_model_button' : 'llm_node.download_model_button')}\n        </Button>\n      </div>\n    )\n  }, [\n    isLoading,\n    loadingModel,\n    data.status,\n    llmInfo?.hasCache,\n    queringThreads,\n    queryThreads,\n    loadModel,\n    t,\n    createThread,\n  ])\n  return (\n    <div>\n      <div>\n        <NodeHeader id={id} />\n        <Alert className=\"flex justify-center\">\n          {llmIcon}\n          <div className=\"ml-2 pt-1 max-w-lg\">\n            <AlertTitle className=\"flex gap-2 items-center pr-6\">\n              {`${data?.entity?.name || ''}`}\n            </AlertTitle>\n            <AlertDescription className=\"max-w-full\">{`${data.label || ''}`}</AlertDescription>\n            <div className=\"max-w-full mt-2 flex-wrap flex gap-1\">\n              <LLMInfo\n                model={llmInfo?.info}\n                isFunctionCalling={llmInfo?.isFunctionCalling || false}\n                name={data?.entity?.name}\n                isCached={llmInfo?.hasCache || false}\n                cloud={llmInfo?.cloud || false}\n              />\n            </div>\n            <LLMSetting\n              options={data?.entity?.options}\n              onChangeOptions={onChangeOptions}\n              className=\"mt-2\"\n            />\n            {actions}\n          </div>\n        </Alert>\n        {isLoading ? <BorderBeam className=\"rounded-lg\" /> : undefined}\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\nimport AIInput from 'src/lib/kokonutui/ai-input'\n\nconst NewMessageCard = memo(\n  ({\n    tags,\n    disabled,\n    loading,\n    onSubmit,\n  }: {\n    tags?: React.ReactNode\n    disabled?: boolean\n    loading?: boolean\n    onSubmit: (input: string) => void\n  }) => {\n    const { t } = useTranslation('components')\n\n    const hanldeSubmit = async (input: string) => {\n      try {\n        await onSubmit(input)\n        return true\n      } catch {\n        return false\n      }\n    }\n\n    return (\n      <Card className=\"min-w-80\">\n        <CardHeader>\n          <CardTitle>{t('add_message_card.title')}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid w-full gap-1.5\">\n            <AIInput\n              onSubmit={hanldeSubmit}\n              disabled={disabled || loading}\n              placeholder={t('add_message_card.placeholder')}\n            />\n          </div>\n          {tags ? <div className=\"mt-2 gap-1 flex flex-wrap\">{tags}</div> : null}\n        </CardContent>\n      </Card>\n    )\n  },\n)\n\nexport default NewMessageCard\n","import type { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types/flow-node'\n\nimport type { DefaultNodeData } from './flow-node'\n\nexport const threadConversationTraveling = (\n  list: string[],\n  nodes: Node<DefaultNodeData>[],\n  connections: Connection[],\n  handledIds: string[] = [],\n  functions: {\n    getNode: (id: string) => Node<DefaultNodeData> | undefined\n    getHandleConnections: (props: { type: 'source' | 'target'; nodeId: string }) => Connection[]\n  },\n) => {\n  const runningNodes = list.map((id) => functions.getNode(id))\n  for (const node of runningNodes) {\n    if (!node) {\n      continue\n    }\n\n    const nodeConnections = functions.getHandleConnections({\n      type: 'target',\n      nodeId: node.id,\n    })\n    connections.push(...nodeConnections)\n\n    if (node.type === FlowNodeTypeEnum.Thread) {\n      handledIds.push(node.id)\n      nodes.push(node)\n      continue\n    } else if (node.type !== FlowNodeTypeEnum.Message) {\n      handledIds.push(node.id)\n      continue\n    } else if (handledIds.includes(node.id)) {\n      continue\n    }\n\n    handledIds.push(node.id)\n    nodes.push(node)\n    if (nodeConnections.length) {\n      threadConversationTraveling(\n        nodeConnections.map((c) => c.source),\n        nodes,\n        connections,\n        handledIds,\n        functions,\n      )\n    }\n  }\n\n  return {\n    nodes,\n    connections,\n  }\n}\n\nexport const prepareThreadConnections = (\n  threadNode: Node<DefaultNodeData>,\n  functions: {\n    getNode: (id: string) => Node<DefaultNodeData> | undefined\n    getHandleConnections: (props: { type: 'source' | 'target'; nodeId: string }) => Connection[]\n  },\n) => {\n  const threadConnections = functions.getHandleConnections({\n    nodeId: threadNode.id,\n    type: 'target',\n  })\n  const threadConnectionInfos = threadConnections.map((connection) => {\n    const node = functions.getNode(connection.source)\n    if (!node) {\n      return\n    }\n    const connections = functions.getHandleConnections({\n      nodeId: node.id,\n      type: 'target',\n    })\n    return {\n      connections,\n      node,\n    }\n  }) as { connections: Connection[]; node: Node<DefaultNodeData> }[]\n  // Prompt connection\n  const threadPromptNodes = threadConnectionInfos.filter((item) => {\n    return item.node?.type === FlowNodeTypeEnum.Prompt\n  })\n  const threadPromptNodeResult: {\n    node: Node<DefaultNodeData>\n    connectedNodes?: Node<DefaultNodeData>[]\n    connections: Connection[]\n  }[] = []\n  if (threadPromptNodes?.length) {\n    threadPromptNodes.forEach((item) => {\n      const promptConnectedNodes = item.connections\n        ?.map((connection) => {\n          return functions.getNode(connection.source)\n        })\n        .filter(Boolean) as Node<DefaultNodeData>[]\n      threadPromptNodeResult.push({\n        node: item.node,\n        connections: item.connections,\n        connectedNodes: promptConnectedNodes,\n      })\n    })\n  }\n  // Tool connection\n  const threadToolsNodes = threadConnectionInfos.filter((item) => {\n    return item.node?.type === FlowNodeTypeEnum.ToolDefinition\n  })\n  const threadToolNodeResult: {\n    node: Node<DefaultNodeData>\n    connectedNodes?: Node<DefaultNodeData>[]\n    connections: Connection[]\n  }[] = []\n  if (threadToolsNodes?.length) {\n    threadToolsNodes.forEach((item) => {\n      const toolConnectedNodes = item.connections\n        ?.map((connection) => {\n          return functions.getNode(connection.source)\n        })\n        .filter(Boolean) as Node<DefaultNodeData>[]\n      if (toolConnectedNodes?.find((node) => node.type === FlowNodeTypeEnum.Schema)) {\n        threadToolNodeResult.push({\n          node: item.node,\n          connections: item.connections,\n          connectedNodes: toolConnectedNodes,\n        })\n      }\n    })\n  }\n  // placeholder node connection\n  const threadPlaceholderNodes = threadConnectionInfos.filter((item) => {\n    return item.node?.type === FlowNodeTypeEnum.PlaceHolder\n  })\n  const threadPlaceholderNodeResult: {\n    node: Node<DefaultNodeData>\n    connectedNodes?: Node<DefaultNodeData>[]\n    connections: Connection[]\n  }[] = []\n  if (threadPlaceholderNodes?.length) {\n    threadPlaceholderNodes.forEach((item) => {\n      const placeholderConnectedNodes = item.connections\n        ?.map((connection) => {\n          return functions.getNode(connection.source)\n        })\n        .filter(Boolean) as Node<DefaultNodeData>[]\n      if (placeholderConnectedNodes) {\n        threadPlaceholderNodeResult.push({\n          node: item.node,\n          connections: item.connections,\n          connectedNodes: placeholderConnectedNodes,\n        })\n      }\n    })\n  }\n  // Schema connection\n  const schemaNode = threadConnectionInfos.find((item) => {\n    return item.node?.type === FlowNodeTypeEnum.Schema\n  })\n\n  return {\n    thread: {\n      node: threadNode,\n      connections: threadConnections,\n    },\n    llm: threadConnectionInfos.find((item) => {\n      return item.node?.type === FlowNodeTypeEnum.LLM\n    }),\n    schemas: schemaNode ? [schemaNode] : [],\n    prompts: threadPromptNodeResult,\n    tools: threadToolNodeResult,\n    placeholders: threadPlaceholderNodeResult,\n  }\n}\n","import { Node } from '@xyflow/react'\nimport { AIMessage, BaseMessage, HumanMessage, SystemMessage } from '@langchain/core/messages'\nimport {\n  CSVData,\n  FlowNodeTypeEnum,\n  Message,\n  Prompt,\n  PromptTypeEnum,\n} from 'src/services/database/types'\nimport { decodeCSVData } from './string-data'\n\nexport const buildHistories = (nodes: { node: Node; connectedNodes: Node[] }[]) => {\n  const histories: BaseMessage[] = []\n  nodes.forEach((item) => {\n    const { node, connectedNodes } = item\n    if (!node.data?.entity) {\n      return\n    }\n    if (node.type === FlowNodeTypeEnum.Message) {\n      const message = node.data.entity as Message\n      switch (message.role) {\n        case 'human':\n          histories.push(new HumanMessage(message.content))\n          break\n        case 'ai':\n          histories.push(new AIMessage(message.content))\n          break\n      }\n    } else if (node.type === FlowNodeTypeEnum.Prompt) {\n      // Prompt\n      const prompt = node.data.entity as Prompt\n\n      let content = `${prompt.prefix ? `${prompt.prefix}\\n` : ''}`\n      if (prompt.type === PromptTypeEnum.FewShotExample) {\n        const connectedDataNode = connectedNodes.find((n) => n.type === FlowNodeTypeEnum.CSVData)\n        const csvData = connectedDataNode?.data?.entity as CSVData\n        if (csvData) {\n          const { rows } = decodeCSVData(csvData.headers, csvData.csv)\n          rows.forEach((row: Record<string, unknown>) => {\n            content += `${prompt.content.replace(/{([^{}]*)}/g, (_, key) => `${row[key as keyof typeof row]}`)}\\n`\n          })\n        }\n      } else {\n        content += prompt.content\n      }\n      if (prompt.suffix) {\n        content += `\\n${prompt.suffix}`\n      }\n\n      switch (prompt.role) {\n        case 'human':\n          histories.push(new HumanMessage(content))\n          break\n        case 'system':\n          histories.push(new SystemMessage(content))\n          break\n        default:\n          histories.push(new AIMessage(content))\n          break\n      }\n    }\n  })\n  return histories\n}\n\nexport const prepareThreadHistory = (\n  connectedNodes: Node[],\n  threadPromptNodes: { node: Node; connectedNodes?: Node[] }[],\n) => {\n  const messageNodes =\n    connectedNodes\n      ?.filter((node) => node.type === FlowNodeTypeEnum.Message)\n      .map((node) => ({ node: node, connectedNodes: [] as Node[] }))\n      .reverse() || []\n\n  const systems: { node: Node; connectedNodes: Node[] }[] = []\n  threadPromptNodes.forEach(async (threadPromptNode) => {\n    systems.unshift({\n      node: threadPromptNode.node,\n      connectedNodes: threadPromptNode.connectedNodes || [],\n    })\n  })\n  return {\n    history: buildHistories(messageNodes),\n    systems: buildHistories(systems),\n  }\n}\n","import { Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum, Schema, SchemaItem, ToolDefinition } from 'src/services/database/types'\nimport { DefaultNode } from './flow-node'\n\nexport const toLocalLLMToolCallingInput = (\n  tools?: {\n    node: DefaultNode\n    connectedNodes?: DefaultNode[]\n    connections: Connection[]\n  }[],\n): {\n  name: string\n  description: string\n  schemaItems: SchemaItem[]\n}[] => {\n  if (!tools) {\n    return []\n  }\n  return tools.reduce(\n    (all: { name: string; description: string; schemaItems: SchemaItem[] }[], item) => {\n      const toolEntity = item.node.data?.entity as ToolDefinition\n      const toolSchemaEnity = item?.connectedNodes?.find(\n        (node) => node.type === FlowNodeTypeEnum.Schema,\n      )?.data?.entity as Schema\n      if (toolEntity && toolSchemaEnity?.schema_items?.length) {\n        all.push({\n          name: toolEntity.name,\n          description: toolEntity.description,\n          schemaItems: toolSchemaEnity.schema_items,\n        })\n      }\n      return all\n    },\n    [],\n  )\n}\n","import { useReactFlow } from '@xyflow/react'\nimport { useCallback } from 'react'\nimport { FlowNodePlaceholder, FlowNodeTypeEnum } from 'src/services/database/types'\n\nexport const useFlowEmbeddingNode = () => {\n  const { getNodes } = useReactFlow()\n\n  const getFlowEmbeddingNode = useCallback(() => {\n    const embeddingNode = getNodes().find(\n      (node) => node.type === FlowNodeTypeEnum.DefaultEmbeddingModel,\n    )\n    return embeddingNode\n  }, [getNodes])\n\n  const getFlowEmbeddingEntity = useCallback(() => {\n    const embeddingNode = getFlowEmbeddingNode()\n    const embbedingEntity = embeddingNode?.data?.entity as FlowNodePlaceholder\n\n    return embbedingEntity\n  }, [getFlowEmbeddingNode])\n\n  return {\n    getFlowEmbeddingNode,\n    getFlowEmbeddingEntity,\n  }\n}\n","import { Node, useReactFlow } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { PromptTemplate } from '@langchain/core/prompts'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { getRepository } from 'src/services/database'\nimport {\n  CSVData,\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n  JSONData,\n  JSONLData,\n  LLM,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  Prompt,\n  Schema,\n  Thread,\n  VectorDatabase,\n  VectorDatabaseStorageEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport {\n  prepareThreadConnections,\n  threadConversationTraveling,\n} from 'src/utils/thread-conversation-traveling'\nimport { prepareThreadHistory } from 'src/utils/build-message-history'\nimport { AIMessage, BaseMessage, HumanMessage } from '@langchain/core/messages'\nimport { getStorageDataSource } from 'src/utils/vector-storage'\nimport { DefaultNodeData } from 'src/utils/flow-node'\nimport { toLocalLLMToolCallingInput } from 'src/utils/flow-to-local-llm'\nimport { useSessionState } from 'src/states/session'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\nimport { logError } from 'src/utils/logger'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useFlowEmbeddingNode } from 'src/hooks/flows/use-flow-embedding-node'\n\ntype CreateMessageOption = {\n  onMessageUpdate: (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => void\n}\nexport const useCreateMessage = ({\n  getNode,\n  getHandleConnections,\n}: Pick<\n  ReturnType<typeof useReactFlow<Node<DefaultNodeData>>>,\n  'getNode' | 'getHandleConnections'\n>) => {\n  const { t } = useTranslation('create_new_message')\n  const [loading, setLoading] = useState(false)\n\n  const currenSession = useSessionState((state) => state.currentSession)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const { similaritySearchWithScore: similaritySearchWithScoreFunction } = useEmbedding()\n  const { getFlowEmbeddingEntity } = useFlowEmbeddingNode()\n\n  const { stream } = useLLM()\n\n  const insertMessages = useCallback(\n    async ({\n      content,\n      threadId,\n      sourceId,\n      initialX,\n      initialY,\n      initialLLMId,\n    }: {\n      content: string\n      threadId: string\n      sourceId: string\n      initialX: number\n      initialY: number\n      initialLLMId: string\n    }) => {\n      if (!currenSession) {\n        throw new Error('Session is not found')\n      }\n      const humanMessage = await getRepository('Message').save({\n        thread_id: threadId,\n        content,\n        role: MessageRoleEnum.Human,\n        status: MessageStatusEnum.Started,\n        llm_id: initialLLMId,\n        session_id: currenSession.id,\n      })\n      if (!humanMessage) {\n        throw new Error('Failed to save message')\n      }\n\n      const humanMessageNode = await createOrUpdateFlowNode({\n        source_id: humanMessage.id,\n        source_type: 'Message',\n        node_type: FlowNodeTypeEnum.Message,\n        x: initialX,\n        y: initialY + 80,\n      })\n      if (!humanMessageNode) {\n        throw new Error('Failed to save human message node')\n      }\n      await createOrUpdateFlowEdge({\n        source: sourceId,\n        target: humanMessageNode.id,\n      })\n      const aiMessage = await getRepository('Message').save({\n        thread_id: threadId,\n        content: t('initial_ai_message'),\n        role: MessageRoleEnum.AI,\n        status: MessageStatusEnum.Inprogress,\n        llm_id: initialLLMId,\n        parent_message_id: humanMessage.id,\n        session_id: currenSession.id,\n      })\n      if (!aiMessage) {\n        throw new Error('Failed to save message')\n      }\n      const aiMessageNode = await createOrUpdateFlowNode({\n        source_id: aiMessage.id,\n        source_type: 'Message',\n        node_type: FlowNodeTypeEnum.Message,\n        x: initialX,\n        y: initialY + 250,\n      })\n      if (!aiMessageNode) {\n        throw new Error('Failed to save ai message node')\n      }\n      await createOrUpdateFlowEdge({\n        source: humanMessageNode.id,\n        target: aiMessageNode.id,\n      })\n\n      return {\n        aiMessage,\n        humanMessage,\n        aiMessageNode,\n        humanMessageNode,\n      }\n    },\n    [createOrUpdateFlowEdge, createOrUpdateFlowNode, currenSession, t],\n  )\n\n  const handlePlaceholders = useCallback(\n    async (\n      messagesInfo: Awaited<ReturnType<typeof insertMessages>>,\n      threadConnection: ReturnType<typeof prepareThreadConnections>,\n    ): Promise<BaseMessage[]> => {\n      const { placeholders } = threadConnection\n      if (!placeholders?.length) {\n        return []\n      }\n      const injectedMessages: BaseMessage[] = []\n      await Promise.all(\n        placeholders.map(async (item) => {\n          const placeholderRecord = item.node.data?.entity as FlowNodePlaceholder\n          if (!placeholderRecord) {\n            return\n          }\n          switch (placeholderRecord.placeholder_type) {\n            case FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER: {\n              const vectorNode = item.connectedNodes?.find(\n                (node) => node.type === FlowNodeTypeEnum.VectorDatabase,\n              )\n              const vector = vectorNode?.data?.entity as VectorDatabase\n              const prompt = item.connectedNodes?.find(\n                (node) => node.type === FlowNodeTypeEnum.Prompt,\n              )?.data?.entity as Prompt\n              if (!prompt || !vector || !vectorNode) {\n                return\n              }\n\n              const k = placeholderRecord.metadata?.k ? +placeholderRecord.metadata?.k : 1\n              let minimalScore = placeholderRecord.metadata?.minimalScore\n                ? +placeholderRecord.metadata?.minimalScore\n                : undefined\n              if (minimalScore && minimalScore > 1) {\n                minimalScore = minimalScore / 100\n              }\n\n              const documents: Awaited<ReturnType<typeof similaritySearchWithScoreFunction>> = []\n\n              if (vector.storage === VectorDatabaseStorageEnum.DataNode) {\n                const connections = getHandleConnections({\n                  nodeId: vectorNode.id,\n                  type: 'target',\n                })\n                const dataSourceNode = connections\n                  .map((connection) => getNode(connection.source))\n                  .find(\n                    (node) =>\n                      node?.type &&\n                      [FlowNodeTypeEnum.JSONLData, FlowNodeTypeEnum.CSVData].includes(\n                        node?.type as FlowNodeTypeEnum,\n                      ),\n                  )\n                const dataSource = dataSourceNode?.data?.entity as CSVData | JSONData | JSONLData\n                if (!dataSource) {\n                  return\n                }\n                documents.push(\n                  ...((await similaritySearchWithScoreFunction(\n                    getFlowEmbeddingEntity(),\n                    {\n                      database: {\n                        databaseId: vector.id,\n                        dataSourceId: dataSource.id,\n                        dataSourceType: getStorageDataSource(dataSource),\n                      },\n                    },\n                    messagesInfo.humanMessage.content,\n                    k,\n                  )) || []),\n                )\n              } else {\n                documents.push(\n                  ...((await similaritySearchWithScoreFunction(\n                    getFlowEmbeddingEntity(),\n                    {\n                      database: {\n                        databaseId: vector.id,\n                      },\n                    },\n                    messagesInfo.humanMessage.content,\n                    k,\n                  )) || []),\n                )\n              }\n              if (!documents) {\n                return []\n              }\n              const template = new PromptTemplate({\n                template: prompt.content,\n                inputVariables: ['context'],\n              })\n\n              injectedMessages.push(\n                new AIMessage(\n                  await template.format({\n                    context: !minimalScore\n                      ? documents.map(([doc]) => doc.pageContent).join('\\n')\n                      : documents\n                          .filter(([, score]) => score >= minimalScore)\n                          .map(([doc]) => doc.pageContent)\n                          .join('\\n'),\n                  }),\n                ),\n              )\n            }\n          }\n        }),\n      )\n      return injectedMessages\n    },\n    [getFlowEmbeddingEntity, getHandleConnections, getNode, similaritySearchWithScoreFunction],\n  )\n\n  const invokeMessage = useCallback(\n    async (\n      messagesInfo: Awaited<ReturnType<typeof insertMessages>>,\n      threadConnection: ReturnType<typeof prepareThreadConnections>,\n      threadConversionNodes: Node[],\n      { onMessageUpdate }: CreateMessageOption,\n    ) => {\n      const { prompts, tools, schemas, placeholders, llm } = threadConnection\n\n      const llmEntity = llm?.node.data?.entity as LLM\n\n      if (!llmEntity) {\n        throw new Error('LLM is not found')\n      }\n\n      const injectedMessages: BaseMessage[] = []\n\n      if (placeholders?.length) {\n        injectedMessages.push(...(await handlePlaceholders(messagesInfo, threadConnection)))\n      }\n\n      const { history: MessageHistory, systems } = prepareThreadHistory(\n        threadConversionNodes,\n        prompts,\n      )\n      const messages = [\n        ...systems,\n        ...injectedMessages,\n        ...MessageHistory,\n        new HumanMessage(messagesInfo.humanMessage.content),\n      ]\n\n      const schemaEntities = schemas\n        .map((schemaNode) => schemaNode.node.data?.entity as Schema)\n        .filter(Boolean) as Schema[]\n      const response = await stream(llmEntity.provider, messages, {\n        tools: toLocalLLMToolCallingInput(tools),\n        schemas: schemaEntities,\n        llm: llmEntity,\n        onMessageUpdate: ({ content }) => {\n          onMessageUpdate?.({\n            id: messagesInfo.aiMessageNode.id,\n            nodeData: {\n              loading: true,\n              content: content,\n            },\n          })\n        },\n      })\n\n      messagesInfo.aiMessage.content = response?.content || ''\n      messagesInfo.aiMessage.metadata = JSON.stringify({\n        message: response?.lastChunk,\n      })\n      onMessageUpdate?.({\n        id: messagesInfo.aiMessageNode.id,\n        nodeData: {\n          content: response?.content,\n          loading: false,\n          entity: messagesInfo.aiMessage,\n        },\n      })\n      if (messagesInfo.aiMessage.id) {\n        await getRepository('Message').update(messagesInfo.aiMessage.id, {\n          content: response?.content,\n          metadata: JSON.stringify({\n            message: response?.lastChunk,\n          }),\n        })\n      }\n      return response?.content\n    },\n    [handlePlaceholders, stream],\n  )\n\n  const createMessage = useCallback(\n    async (source: Node, content: string, options: CreateMessageOption) => {\n      const { nodes: threadConversionNodes } = threadConversationTraveling(\n        [source.id],\n        [],\n        [],\n        [],\n        {\n          getNode,\n          getHandleConnections,\n        },\n      )\n\n      const threadNode = threadConversionNodes.find((node) => node.type === FlowNodeTypeEnum.Thread)\n      const thread = threadNode?.data.entity as Thread\n      if (!source || !thread || !threadNode) {\n        throw new Error('Source or thread is not found')\n      }\n      const threadConnections = prepareThreadConnections(threadNode, {\n        getNode,\n        getHandleConnections,\n      })\n      if (!threadConnections?.thread) {\n        throw new Error('Thread node is not found')\n      }\n\n      let messagesInfo: Awaited<ReturnType<typeof insertMessages>> | undefined\n      try {\n        setLoading(true)\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        messagesInfo = await insertMessages({\n          content,\n          initialX,\n          initialY,\n          sourceId: source.id,\n          threadId: thread.id,\n          initialLLMId: thread.initial_llm_id,\n        })\n        await invokeMessage(messagesInfo, threadConnections, threadConversionNodes, options)\n        await getRepository('Message').update(`${messagesInfo.aiMessage.id}`, {\n          status: MessageStatusEnum.Success,\n        })\n        messagesInfo.aiMessage.status = MessageStatusEnum.Success\n        options.onMessageUpdate({\n          id: messagesInfo.aiMessageNode.id,\n          nodeData: {\n            entity: messagesInfo.aiMessage,\n            loading: false,\n          },\n        })\n        return true\n      } catch (error) {\n        logError('Create Message', error)\n        if (messagesInfo?.aiMessage) {\n          await getRepository('Message').update(`${messagesInfo.aiMessage.id}`, {\n            status: MessageStatusEnum.Failed,\n            content: t('errors.ai_message_content_failed'),\n          })\n        }\n        if (messagesInfo?.aiMessageNode.id) {\n          options?.onMessageUpdate({\n            id: messagesInfo.aiMessageNode.id,\n            nodeData: {\n              content: t('errors.ai_message_content_failed'),\n              entity: {\n                ...messagesInfo.aiMessage,\n                status: MessageStatusEnum.Failed,\n                content: t('errors.ai_message_content_failed'),\n              },\n              loading: false,\n            },\n          })\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [getHandleConnections, getNode, insertMessages, invokeMessage, t],\n  )\n\n  return {\n    loading,\n    createMessage,\n  }\n}\n","import { useCallback } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport omitBy from 'lodash/omitBy'\nimport isUndefined from 'lodash/isUndefined'\nimport { Node, Connection, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { useCreateMessage } from 'src/hooks/flows/mutations/use-create-message'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport { useFlowState } from 'src/states/flow'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { prepareThreadConnections } from 'src/utils/thread-conversation-traveling'\nimport { DefaultNodeData } from 'src/utils/flow-node'\n\nimport { ThreadNodeProps } from '../type'\n\nexport const useActions = (id: string, data: ThreadNodeProps['data']) => {\n  const node = useInternalNode(id)\n  const { t } = useTranslation('flows')\n  const { getNode, getHandleConnections } = useReactFlow<Node<DefaultNodeData>>()\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { createMessage: createMessageFunction, loading } = useCreateMessage({\n    getNode,\n    getHandleConnections,\n  })\n\n  const onMessageUpdate = useCallback(\n    (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => {\n      if (!info.id) {\n        return\n      }\n      const item = getNode(info.id)\n      if (!item || !info.nodeData) {\n        return\n      }\n      updateNodes([\n        {\n          id: item.id,\n          type: 'replace',\n          item: {\n            ...item,\n            data: {\n              ...item.data,\n              ...omitBy(info.nodeData, isUndefined),\n            },\n          },\n        },\n      ])\n    },\n    [getNode, updateNodes],\n  )\n  const createMessage = useCallback(\n    async (input: string) => {\n      if (node && data.entity) {\n        try {\n          await createMessageFunction(node, input, {\n            onMessageUpdate,\n          })\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('LLM_NOT_LOADED_YET')) {\n            return toast({\n              variant: 'destructive',\n              title: t('thread_node.errors.llm_not_loaded_yet'),\n            })\n          }\n          toast({\n            variant: 'destructive',\n            title: `${error}`,\n          })\n        }\n      }\n    },\n    [node, data.entity, createMessageFunction, onMessageUpdate, t],\n  )\n\n  const getLinkedConnections = useCallback(\n    (id: string) => {\n      const currentNode = getNode(id)\n      if (!currentNode) {\n        return []\n      }\n      const linkedConnections: {\n        node: Node<DefaultNodeData>\n        connections: Connection[]\n        connectedNodes?: Node<DefaultNodeData>[]\n      }[] = []\n      const threadConnections = prepareThreadConnections(currentNode as Node<DefaultNodeData>, {\n        getNode,\n        getHandleConnections,\n      })\n      if (threadConnections.thread) {\n        linkedConnections.push({\n          node: threadConnections.thread.node as Node<DefaultNodeData>,\n          connectedNodes: [],\n          connections: threadConnections.thread.connections,\n        })\n      }\n      if (threadConnections.prompts) {\n        linkedConnections.push(\n          ...threadConnections.prompts.map((item) => {\n            return {\n              node: item.node,\n              connectedNodes: item.connectedNodes,\n              connections: item.connections,\n            }\n          }),\n        )\n      }\n      if (threadConnections.schemas) {\n        linkedConnections.push(\n          ...threadConnections.schemas.map((item) => {\n            return {\n              node: item.node,\n              connectedNodes: [],\n              connections: item.connections,\n            }\n          }),\n        )\n      }\n      if (threadConnections.placeholders) {\n        threadConnections.placeholders.forEach((item) => {\n          const connectedNodes = item.connections\n            .map((connection) => {\n              return getNode(connection.source)\n            })\n            .filter(Boolean) as Node<DefaultNodeData>[]\n          linkedConnections.push({\n            node: item.node,\n            connectedNodes: connectedNodes || [],\n            connections: item.connections,\n          })\n        })\n      }\n      if (threadConnections.llm) {\n        linkedConnections.push(threadConnections.llm)\n      }\n      return linkedConnections\n    },\n    [getHandleConnections, getNode],\n  )\n\n  return { loading, createMessage, getLinkedConnections }\n}\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport {\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.Prompt && target?.type === FlowNodeTypeEnum.Thread) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.LLM &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.Schema &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.ToolDefinition &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.VectorDatabase &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.PlaceHolder &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          const sourceEntity = source.data.entity as FlowNodePlaceholder\n          if (\n            sourceEntity.placeholder_type === FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER\n          ) {\n            await createOrUpdateFlowEdge({\n              source: connection.source,\n              target: connection.target,\n              sourceHandle: connection.sourceHandle,\n              targetHandle: connection.targetHandle,\n            })\n            return\n          }\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { Position, useHandleConnections, useReactFlow } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport NewMessageCard from 'src/components/molecules/NewMessageCard'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Card, CardTitle } from 'src/lib/shadcn/ui/card'\nimport {\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n  Prompt,\n  PromptTypeEnum,\n} from 'src/services/database/types'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { ThreadNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const ThreadNode = memo((props: ThreadNodeProps) => {\n  const { id, data, isConnectable } = props\n  const { t } = useTranslation('flows')\n  const [showThread, setShowThread] = useState(false)\n  const connections = useHandleConnections({\n    type: 'source',\n  })\n  const targetConnections = useHandleConnections({\n    type: 'target',\n  })\n  const { getNode } = useReactFlow()\n  const { loading, createMessage, getLinkedConnections } = useActions(id, data)\n\n  useConnectionToHandler(id)\n\n  const handleCreateMessage = useCallback(\n    async (...args: Parameters<typeof createMessage>) => {\n      setShowThread(false)\n      const result = await createMessage(...args)\n      return result\n    },\n    [createMessage],\n  )\n\n  const containMessage = useMemo(() => {\n    return connections.length > 0\n  }, [connections])\n\n  const handleNewThread = useCallback(() => {\n    setShowThread((pre) => !pre)\n  }, [])\n\n  const inner = useMemo(() => {\n    const tags = targetConnections\n      .map((connection, index) => {\n        const source = getNode(connection.source)\n        if (source?.type === FlowNodeTypeEnum.Schema) {\n          return <Badge key={`${index}`}>{t('thread_node.structured_output')}</Badge>\n        } else if (source?.type === FlowNodeTypeEnum.Prompt) {\n          const entity = source.data.entity as Prompt\n          return (\n            <Badge key={`${index}`}>\n              {t(\n                entity.type === PromptTypeEnum.FewShotExample\n                  ? 'thread_node.prompts.few_shot_example'\n                  : `thread_node.prompts.${entity.role.toLowerCase()}`,\n              )}\n            </Badge>\n          )\n        } else if (source?.type === FlowNodeTypeEnum.PlaceHolder) {\n          const entity = source.data.entity as FlowNodePlaceholder\n          if (entity?.placeholder_type === FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER) {\n            return <Badge key={`${index}`}>{t('thread_node.vector_database_retriever')}</Badge>\n          }\n        }\n        return undefined\n      })\n      .filter(Boolean)\n\n    if (props.data.entity && !props.data.entity?.messages?.length && !containMessage) {\n      return (\n        <NewMessageCard\n          disabled={loading}\n          loading={loading}\n          onSubmit={handleCreateMessage}\n          tags={tags}\n        />\n      )\n    }\n\n    if (!tags?.length) {\n      return <div className=\"w-12 h-10\" />\n    }\n\n    return (\n      <Card className=\"p-4 pt-2\">\n        <CardTitle className=\"mb-2\">{t('thread_node.title')}</CardTitle>\n        <div className=\"flex gap-1.5\">{tags}</div>\n        <div className=\"mt-4 w-full flex justify-end\">\n          <Button onClick={handleNewThread} variant=\"outline\">\n            <LazyIcon name={showThread ? 'copy-minus' : 'copy-plus'} />\n            {showThread ? t('thread_node.hide') : t('thread_node.clone')}\n          </Button>\n        </div>\n      </Card>\n    )\n  }, [\n    containMessage,\n    getNode,\n    handleCreateMessage,\n    handleNewThread,\n    loading,\n    props.data.entity,\n    showThread,\n    t,\n    targetConnections,\n  ])\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} enableToStandalone getLinkedConnections={getLinkedConnections} />\n        {inner}\n        {showThread ? (\n          <>\n            <div className=\"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500\" />\n            <div className=\"absolute mt-[30px] w-full\">\n              <div className=\"ml-[10%] w-80 animate-in slide-in-from-bottom-5\">\n                <NewMessageCard\n                  disabled={loading}\n                  loading={loading}\n                  onSubmit={handleCreateMessage}\n                />\n              </div>\n            </div>\n          </>\n        ) : undefined}\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\n\nimport { MessageNodeProps } from '../type'\n\nexport function HumanMessageComponent({\n  data,\n  onNewThread,\n  loading,\n  showThread,\n}: {\n  data: MessageNodeProps['data']\n  onNewThread?: () => void\n  loading?: boolean\n  showThread: boolean\n}) {\n  const { t } = useTranslation('flows')\n  return (\n    <Alert className=\"flex min-w-52\">\n      <LazyIcon size={24} name=\"user\" />\n      <div className=\"ml-2 max-w-full w-full\">\n        <AlertTitle>{`Human`}</AlertTitle>\n        <AlertDescription>{`${data.content || data.entity?.content || ''}`}</AlertDescription>\n        {onNewThread ? (\n          <div className=\"w-full mt-2 flex items-center justify-end\">\n            <Button onClick={onNewThread} disabled={loading} variant=\"outline\">\n              <LazyIcon name={!showThread ? 'plus' : 'minus'} size={16} />\n              {!showThread ? t(`message_node.new_thread`) : t(`message_node.hide_thread`)}\n            </Button>\n          </div>\n        ) : undefined}\n      </div>\n    </Alert>\n  )\n}\n","import { Suspense, useMemo } from 'react'\nimport { Alert, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { cn } from 'src/lib/utils'\nimport { useTranslation } from 'react-i18next'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { BorderBeam } from 'src/lib/shadcn/ui/border-beam'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { MessageStatusEnum } from 'src/services/database/types'\nimport { MarkdownViewer } from 'src/components/molecules/MarkdownViewer'\n\nimport { MessageNodeProps } from '../type'\n\nexport function AIMessageComponent({\n  data,\n  onNewThread,\n  loading,\n  showThread,\n}: {\n  data: MessageNodeProps['data']\n  onNewThread?: () => void\n  loading?: boolean\n  showThread: boolean\n}) {\n  const { t } = useTranslation('flows')\n  const messageMetadata = useMemo<{ message: Record<string, unknown> }>(() => {\n    try {\n      return JSON.parse(data?.entity?.metadata || '{}')\n    } catch {\n      return {}\n    }\n  }, [data?.entity?.metadata])\n\n  const isError = data.entity.status === MessageStatusEnum.Failed\n\n  const content = useMemo(() => {\n    return <MarkdownViewer source={`${data.content || data.entity?.content || ''}`} />\n  }, [data.content, data.entity?.content])\n\n  return (\n    <Alert\n      className={cn('flex min-w-52', isError ? 'bg-background' : '')}\n      variant={isError ? 'destructive' : 'default'}\n    >\n      <LazyIcon\n        className={cn(data.loading ? 'animate-spin' : undefined)}\n        size={24}\n        name={data.loading ? 'loader-circle' : 'bot'}\n      />\n      <LazyIcon name={!showThread ? 'plus' : 'minus'} size={24} />\n      <div className=\"ml-2 w-full max-w-full\">\n        <AlertTitle>\n          {t(`message_node.message_roles.${data.entity?.role?.toLowerCase()}`)}\n        </AlertTitle>\n        <Suspense\n          fallback={\n            <div className=\"h-full w-ful rounded-lg flex justify-center items-center\">\n              <LazyIcon name=\"loader-circle\" className=\"animate-spin\" />\n            </div>\n          }\n        >\n          {isError ? data.content || data.entity?.content || '' : content}\n        </Suspense>\n        {Array.isArray(messageMetadata?.message?.tool_calls) &&\n        messageMetadata?.message?.tool_calls?.length\n          ? messageMetadata?.message?.tool_calls.map((item, index) => {\n              return (\n                <Badge key={`${item.name}_${index}`}>\n                  {t('message_node.tool_call', {\n                    name: item.name,\n                    args: Object.entries(item.args)\n                      .map(([key, value]) => `\"${key}\": \"${value}\"`)\n                      .join(', '),\n                  })}\n                </Badge>\n              )\n            })\n          : null}\n        {onNewThread ? (\n          <div className=\"w-full mt-2 flex items-center justify-end\">\n            <Button onClick={onNewThread} disabled={loading} variant=\"outline\">\n              <LazyIcon name={!showThread ? 'plus' : 'minus'} size={16} />\n              {!showThread ? t(`message_node.new_thread`) : t(`message_node.hide_thread`)}\n            </Button>\n          </div>\n        ) : undefined}\n      </div>\n      {data.loading ? <BorderBeam size={350} duration={10} /> : undefined}\n    </Alert>\n  )\n}\n","import { useCallback } from 'react'\nimport omitBy from 'lodash/omitBy'\nimport isUndefined from 'lodash/isUndefined'\nimport { useTranslation } from 'react-i18next'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport { Node, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { useCreateMessage } from 'src/hooks/flows/mutations/use-create-message'\nimport { useFlowState } from 'src/states/flow'\n\nimport { MessageNodeProps } from '../type'\n\nexport const useActions = (id: string) => {\n  const { t } = useTranslation('flows')\n  const node = useInternalNode(id)\n\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { getNode, getHandleConnections } = useReactFlow<Node<MessageNodeProps['data']>>()\n  const { createMessage: createMessageFunction, loading } = useCreateMessage({\n    getNode,\n    getHandleConnections,\n  })\n\n  const onMessageUpdate = useCallback(\n    (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => {\n      if (!info.id) {\n        return\n      }\n      const item = getNode(info.id)\n      if (!item || !info.nodeData) {\n        return\n      }\n      updateNodes([\n        {\n          id: item.id,\n          type: 'replace',\n          item: {\n            ...item,\n            data: {\n              ...item.data,\n              ...omitBy(info.nodeData, isUndefined),\n            },\n          },\n        },\n      ])\n    },\n    [getNode, updateNodes],\n  )\n\n  const createMessage = useCallback(\n    async (input: string) => {\n      if (node) {\n        try {\n          await createMessageFunction(node, input, {\n            onMessageUpdate,\n          })\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('LLM_NOT_LOADED_YET')) {\n            return toast({\n              variant: 'destructive',\n              title: t('message_node.errors.llm_not_loaded_yet'),\n            })\n          }\n          toast({\n            variant: 'destructive',\n            title: t('message_node.errors.create_message'),\n          })\n        }\n      }\n    },\n    [node, t, createMessageFunction, onMessageUpdate],\n  )\n\n  return {\n    loading,\n    createMessage,\n  }\n}\n","import { Node } from '@xyflow/react'\nimport { useCallback } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  Prompt,\n  Thread,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateIdieMessage = () => {\n  const currenSession = useSessionState((state) => state.currentSession)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createIdieMessage = useCallback(\n    async (\n      source: Node,\n      thread: Thread,\n      input: string,\n      options?: {\n        promptNode?: Node\n      },\n    ) => {\n      if (!source || !thread || !currenSession) {\n        return\n      }\n      const prompt = options?.promptNode?.data?.entity as Prompt\n      // This is node thead replaced with message node\n      const initialX = source.position?.x || 0\n      const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n      const newMessage = await getRepository('Message').save({\n        thread_id: thread.id,\n        content: input,\n        role: prompt?.role || MessageRoleEnum.Human,\n        status: MessageStatusEnum.Started,\n        llm_id: thread.initial_llm_id,\n        session_id: currenSession.id,\n      })\n      if (!newMessage) {\n        throw new Error('Failed to save message')\n      }\n      const newMessageNode = await createOrUpdateFlowNode({\n        source_id: newMessage.id,\n        source_type: 'Message',\n        node_type: FlowNodeTypeEnum.Message,\n        x: initialX,\n        y: initialY,\n      })\n      if (!newMessageNode) {\n        throw new Error('Failed to save message node')\n      }\n      const edgeToNewMessage = await createOrUpdateFlowEdge({\n        source: source.id,\n        target: newMessageNode.id,\n      })\n      let edgeToPrompt\n      if (options?.promptNode) {\n        edgeToPrompt = await createOrUpdateFlowEdge({\n          source: options?.promptNode.id,\n          target: newMessageNode.id,\n        })\n      }\n      return {\n        message: newMessage,\n        edgeToPrompt,\n        messageNode: newMessageNode,\n        messageEdge: edgeToNewMessage,\n      }\n    },\n    [createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    createIdieMessage,\n  }\n}\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { FlowNodeTypeEnum, Message, Prompt, ThreadStatusEnum } from 'src/services/database/types'\n\nimport { useCreateIdieMessage } from 'src/hooks/flows/mutations/use-create-idie-message'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const { createIdieMessage } = useCreateIdieMessage()\n\n  const connectionHandler = useCallback(\n    async ({ edgeId, source, target }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.Prompt && target?.type === FlowNodeTypeEnum.Message) {\n          const message = target?.data?.entity as Message\n          const prompt = source?.data?.entity as Prompt\n          if (!prompt || !message || !target) {\n            return {\n              deleteEdgeId: edgeId,\n            }\n          }\n          await createIdieMessage(\n            target,\n            {\n              id: message?.thread_id,\n              title: '',\n              status: ThreadStatusEnum.Started,\n              initial_llm_id: message.llm_id,\n              session_id: prompt.session_id,\n            },\n            prompt.content,\n            {\n              promptNode: source,\n            },\n          )\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createIdieMessage],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Position, useHandleConnections } from '@xyflow/react'\nimport NewMessageCard from 'src/components/molecules/NewMessageCard'\nimport { MessageRoleEnum } from 'src/services/database/types'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport textToSpeech from 'src/utils/text-to-speech'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { HumanMessageComponent } from './components/HumanMessage'\nimport { AIMessageComponent } from './components/AIMessage'\nimport { MessageNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const MessageNode = memo((props: MessageNodeProps) => {\n  const { id, data, isConnectable } = props\n  const [showThread, setShowThread] = useState(false)\n  const [speaking, setSpeaking] = useState(false)\n  const { t } = useTranslation('common')\n  const connections = useHandleConnections({\n    type: 'source',\n  })\n  const { loading, createMessage } = useActions(id)\n  const { toast } = useToast()\n\n  useConnectionToHandler(id)\n\n  const handleCreateMessage = useCallback(\n    async (...args: Parameters<typeof createMessage>) => {\n      const result = await createMessage(...args)\n      setShowThread(false)\n      return result\n    },\n    [createMessage],\n  )\n\n  const isEnd = useMemo(() => {\n    return connections.length === 0\n  }, [connections])\n\n  const handleCopy = useCallback(() => {\n    if (!data.entity?.content) {\n      return\n    }\n    navigator.clipboard.writeText(data.entity.content)\n    toast({\n      description: t('copied'),\n    })\n  }, [toast, data, t])\n\n  const handleSpeech = useCallback(async () => {\n    try {\n      if (speaking) {\n        await textToSpeech.stop()\n        return setSpeaking(false)\n      }\n      setSpeaking(true)\n      await textToSpeech.speak(data.entity?.content || '')\n    } catch {\n      toast({\n        variant: 'destructive',\n        description: t('errors.speech_is_not_supported'),\n      })\n    } finally {\n      setSpeaking(false)\n    }\n  }, [data.entity?.content, speaking, t, toast])\n\n  const handleNewThread = useCallback(() => {\n    setShowThread((pre) => !pre)\n  }, [])\n\n  const newMessageCard = useMemo(() => {\n    if (\n      (!isEnd && !showThread) ||\n      data.loading ||\n      loading ||\n      data?.entity?.status === 'inprogress'\n    ) {\n      return undefined\n    }\n    return (\n      <>\n        <div className=\"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500\" />\n        <div className=\"absolute mt-[30px] w-full\">\n          <div className=\"ml-[10%] w-80 animate-in slide-in-from-bottom-5\">\n            <NewMessageCard disabled={loading} loading={loading} onSubmit={handleCreateMessage} />\n          </div>\n        </div>\n      </>\n    )\n  }, [data?.entity?.status, data.loading, handleCreateMessage, isEnd, loading, showThread])\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"max-w-sm min-w-64\">\n        <div className=\"w-auto\">\n          <NodeHeader id={id} />\n          <div>\n            {data.entity?.role === MessageRoleEnum.Human ? (\n              <HumanMessageComponent\n                data={data}\n                showThread={showThread}\n                onNewThread={!isEnd ? handleNewThread : undefined}\n              />\n            ) : (\n              <AIMessageComponent\n                data={data}\n                showThread={showThread}\n                loading={loading}\n                onNewThread={!isEnd ? handleNewThread : undefined}\n              />\n            )}\n          </div>\n          <Button\n            onClick={handleSpeech}\n            className=\"absolute top-0 right-[68px] !px-2 !rounded-none\"\n            variant=\"ghost\"\n          >\n            <LazyIcon name={speaking ? 'circle-stop' : 'speech'} size={16} />\n          </Button>\n          <Button\n            onClick={handleCopy}\n            className=\"absolute top-0 right-[36px] !px-2 !rounded-none\"\n            variant=\"ghost\"\n          >\n            <LazyIcon name=\"copy\" size={16} />\n          </Button>\n        </div>\n        {newMessageCard}\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport {\n  CSVData,\n  FlowNodeTypeEnum,\n  Message,\n  Prompt,\n  PromptTypeEnum,\n  ThreadStatusEnum,\n} from 'src/services/database/types'\nimport { useCreateIdieMessage } from 'src/hooks/flows/mutations/use-create-idie-message'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\nimport { useFlowState } from 'src/states/flow'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const { createIdieMessage } = useCreateIdieMessage()\n\n  const connectionHandler = useCallback(\n    async ({ edgeId, source, target }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        const targetEntity = target?.data?.entity as Prompt\n        const sourceEntity = source?.data?.entity as CSVData\n        if (source?.type === FlowNodeTypeEnum.Message && target?.type === FlowNodeTypeEnum.Prompt) {\n          const message = source?.data?.entity as Message\n          const prompt = target?.data?.entity as Prompt\n          if (!prompt || !message || !target) {\n            return {\n              deleteEdgeId: edgeId,\n            }\n          }\n          await createIdieMessage(\n            source,\n            {\n              id: message?.thread_id,\n              title: '',\n              status: ThreadStatusEnum.Started,\n              initial_llm_id: message.llm_id,\n              session_id: prompt.session_id,\n            },\n            prompt.content,\n            {\n              promptNode: target,\n            },\n          )\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.CSVData &&\n          target?.type === FlowNodeTypeEnum.Prompt &&\n          targetEntity?.type === PromptTypeEnum.FewShotExample &&\n          sourceEntity?.headers.includes('input') &&\n          sourceEntity?.headers.includes('output')\n        ) {\n          await createOrUpdateFlowEdge({\n            source: source.id,\n            target: target.id,\n          })\n          return\n        }\n\n        // Need to delete edge\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createIdieMessage, createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useMemo } from 'react'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport { Position } from '@xyflow/react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { useModal } from '@ebay/nice-modal-react'\nimport ViewDataDetailDialog from 'src/components/dialogs/ViewDataDetailDialog'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { PromptNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const PromptNode = memo((props: PromptNodeProps) => {\n  const { id, data, isConnectable } = props\n\n  useConnectionToHandler(id)\n\n  const viewDetailDialog = useModal(ViewDataDetailDialog)\n\n  const content = useMemo(() => {\n    return `${data.entity?.prefix ? `${data.entity?.prefix}\\n` : ''}${data.entity?.content || ''}`\n  }, [data.entity?.prefix, data.entity?.content])\n\n  const promptArguments = useMemo(() => {\n    const regex = /{(.*?)}/g\n    const matches = content.match(regex)\n    return matches?.map((match) => match.replace('{', '').replace('}', '')) || []\n  }, [content])\n\n  const isOverLimit = content.length > 990\n\n  const handleOpenDetail = () => {\n    viewDetailDialog.show({ title: 'Prompt', content })\n  }\n\n  return (\n    <div className=\"min-w-56\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} />\n        <Alert className=\"flex justify-center max-w-72\" variant=\"default\">\n          <LazyIcon size={24} name={'notepad-text'} />\n          <div className=\"ml-2 max-w-full break-words break-all\">\n            <AlertTitle>{`${data.entity?.role || ''}`}</AlertTitle>\n            <AlertDescription onClick={isOverLimit ? handleOpenDetail : undefined}>\n              {isOverLimit ? `${content.slice(0, 990)}...` : content}\n              {isOverLimit ? (\n                <span className=\"float-right\">\n                  <LazyIcon name=\"chevron-right\" />\n                </span>\n              ) : undefined}\n            </AlertDescription>\n            {promptArguments?.length\n              ? promptArguments.map((argument, index) => {\n                  return (\n                    <Badge key={index} className=\"mt-2 mr-1\" variant=\"default\">\n                      {argument}\n                    </Badge>\n                  )\n                })\n              : undefined}\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","export const formatBytes = (bytes?: number) => {\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\n  if (bytes === undefined) return 'Unknown size'\n  if (bytes === 0) return '0 Byte'\n  const i = Math.floor(Math.log(bytes) / Math.log(1024))\n  return `${Math.round(bytes / Math.pow(1024, i))} ${sizes[i]}`\n}\n","import dayjs from 'dayjs'\nimport { memo, useCallback, useEffect, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\n// import { Bar, XAxis, CartesianGrid, BarChart } from 'recharts'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from 'src/lib/shadcn/ui/card'\n// import {\n//   ChartConfig,\n//   ChartContainer,\n//   ChartTooltip,\n//   ChartTooltipContent,\n// } from 'src/lib/shadcn/ui/chart'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { formatBytes } from 'src/utils/bytes-format'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useLocalLLMState } from 'src/services/local-llm'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\n\nexport const SessionInfoNode = memo(() => {\n  const { t } = useTranslation('flows')\n  const [cachedModdels, setCachedModels] =\n    useState<{ model_id: string; info: ModelRecord; isFunctionCalling: boolean }[]>()\n  const cachedLLMURLs = useLocalLLMState((state) => state.cachedLLMURLs)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const [latestUpdate, setLatestUpdate] = useState<Date>()\n  const [usedBytes, setUsedBytes] = useState('')\n  const [, setCountInfo] = useState<\n    [\n      {\n        name: string\n        nodes: number\n        edges: number\n        llms?: number\n        threads?: number\n        prompts?: number\n        schemas?: number\n        tools?: number\n        vectorDatabases?: number\n        jsonlDatas?: number\n        csvDatas?: number\n      },\n    ]\n  >()\n\n  // const chartConfig = useMemo(() => {\n  //   return {\n  //     nodes: {\n  //       label: t('session_info_node.entities.nodes'),\n  //       color: '#2563eb', // Original color\n  //     },\n  //     edges: {\n  //       label: t('session_info_node.entities.edges'),\n  //       color: '#34d399', // New color\n  //     },\n  //     threads: {\n  //       label: t('session_info_node.entities.threads'),\n  //       color: '#fbbf24', // New color\n  //     },\n  //     llms: {\n  //       label: t('session_info_node.entities.llms'),\n  //       color: '#f87171', // New color\n  //     },\n  //     prompts: {\n  //       label: t('session_info_node.entities.prompts'),\n  //       color: '#a78bfa', // New color\n  //     },\n  //     tools: {\n  //       label: t('session_info_node.entities.tools'),\n  //       color: '#ffcccb', // Lighter and more colorful\n  //     },\n  //     schemas: {\n  //       label: t('session_info_node.entities.schemas'),\n  //       color: '#ffb6c1', // Lighter and more colorful\n  //     },\n  //     vectorDatabases: {\n  //       label: t('session_info_node.entities.vector_databases'),\n  //       color: '#ff69b4', // Lighter and more colorful\n  //     },\n  //     jsonlDatas: {\n  //       label: t('session_info_node.entities.jsonl_data'),\n  //       color: '#ff1493', // Lighter and more colorful\n  //     },\n  //     csvDatas: {\n  //       label: t('session_info_node.entities.csv_data'),\n  //       color: '#db7093', // Lighter and more colorful\n  //     },\n  //   } satisfies ChartConfig\n  // }, [t])\n\n  useEffect(() => {\n    import('@mlc-ai/web-llm').then(({ functionCallingModelIds, prebuiltAppConfig }) => {\n      setCachedModels(\n        cachedLLMURLs?.map((url) => {\n          const item = prebuiltAppConfig.model_list.find((model) => url.includes(model.model))\n          if (!item) {\n            return\n          }\n          return {\n            model_id: item?.model_id || '',\n            info: item,\n            isFunctionCalling: functionCallingModelIds.includes(item?.model_id || ''),\n          }\n        }) as { model_id: string; info: ModelRecord; isFunctionCalling: boolean }[],\n      )\n    })\n  }, [cachedLLMURLs, currentSession?.id])\n\n  const fetchSessionInfo = useCallback(async () => {\n    navigator.storage.estimate().then((estimate) => {\n      if (estimate) {\n        setUsedBytes(\n          t('session_info_node.used_bytes', {\n            used: formatBytes(estimate.usage),\n            total: formatBytes(estimate?.quota),\n          }),\n        )\n      }\n    })\n    if (!currentSession?.id) {\n      return\n    }\n\n    Promise.all([\n      getRepository('FlowNode').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('FlowEdge').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('Thread').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('Prompt').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('LLM').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('Schema').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('ToolDefinition').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('VectorDatabase').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('JSONLData').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('CSVData').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n    ]).then((response) => {\n      const maxUpdatedAt = response.reduce(\n        (acc, item) => {\n          if (item?.updated_at && (!acc || new Date(item.updated_at) > acc)) {\n            return new Date(item.updated_at)\n          }\n          return acc\n        },\n        currentSession.updated_at ? new Date(currentSession.updated_at) : undefined,\n      )\n      setLatestUpdate(maxUpdatedAt)\n    })\n\n    Promise.all([\n      getRepository('FlowNode').count({ where: { session_id: currentSession?.id } }),\n      getRepository('FlowEdge').count({ where: { session_id: currentSession?.id } }),\n      getRepository('Thread').count({ where: { session_id: currentSession?.id } }),\n      getRepository('Prompt').count({ where: { session_id: currentSession?.id } }),\n      getRepository('LLM').count({ where: { session_id: currentSession?.id } }),\n      getRepository('ToolDefinition').count({ where: { session_id: currentSession?.id } }),\n      getRepository('Schema').count({ where: { session_id: currentSession?.id } }),\n      getRepository('VectorDatabase').count({ where: { session_id: currentSession?.id } }),\n      getRepository('JSONLData').count({ where: { session_id: currentSession?.id } }),\n      getRepository('CSVData').count({ where: { session_id: currentSession?.id } }),\n    ]).then(\n      ([\n        nodes,\n        edges,\n        threads,\n        prompts,\n        llms,\n        tools,\n        schemas,\n        vectorDatabases,\n        jsonlDatas,\n        csvDatas,\n      ]) => {\n        setCountInfo([\n          {\n            name: t('session_info_node.count_info.title'),\n            nodes: nodes || 0,\n            edges: edges || 0,\n            threads: threads || 0,\n            prompts: prompts || 0,\n            llms: llms || 0,\n            tools: tools || 0,\n            schemas: schemas || 0,\n            vectorDatabases: vectorDatabases || 0,\n            jsonlDatas: jsonlDatas || 0,\n            csvDatas: csvDatas || 0,\n          },\n        ])\n      },\n    )\n  }, [currentSession?.id, currentSession?.updated_at, t])\n\n  const handleReload = useCallback(() => {\n    fetchSessionInfo()\n  }, [fetchSessionInfo])\n\n  useEffect(() => {\n    fetchSessionInfo()\n  }, [fetchSessionInfo])\n  return (\n    <Card className=\"w-96\">\n      <CardHeader>\n        <CardTitle>{t('session_info_node.title')}</CardTitle>\n        <CardDescription>\n          {latestUpdate || currentSession?.updated_at\n            ? dayjs(latestUpdate || currentSession?.updated_at).fromNow()\n            : ''}\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"grid gap-4\">\n        <div className=\"flex items-center space-x-4 rounded-md border p-4\">\n          <div className=\"flex-1 space-y-1\">\n            <p className=\"text-sm font-medium leading-none\">{t('session_info_node.disk_size')}</p>\n            <p className=\"text-sm text-muted-foreground\">{usedBytes}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center space-x-4 rounded-md border p-4\">\n          <div className=\"flex-1 space-y-1\">\n            <div className=\"text-sm font-medium leading-none\">\n              {t('session_info_node.cached_llms')}\n              <Badge className=\"ml-2\">{cachedModdels?.length || 0}</Badge>\n            </div>\n            {cachedModdels?.map((llm) => (\n              <div key={llm?.model_id} className=\"text-sm text-muted-foreground gap-1\">\n                {llm?.model_id}\n                <div className=\"max-w-full gap-1 flex flex-wrap mt-1\">\n                  <LLMInfo\n                    model={llm?.info}\n                    isFunctionCalling={llm?.isFunctionCalling || false}\n                    isCached={true}\n                    cloud={false}\n                  />\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div>\n          {/* Production build failed */}\n          {/* <ChartContainer config={chartConfig} className=\"min-h-28 w-full\">\n            <BarChart accessibilityLayer data={countInfo}>\n              <CartesianGrid vertical={false} />\n              <XAxis dataKey=\"name\" tickLine={false} tickMargin={10} axisLine={false} />\n              <ChartTooltip content={<ChartTooltipContent />} />\n              {Object.entries(chartConfig).map(([key]) => (\n                <Bar key={key} dataKey={key} fill={'#ffb6c1'} radius={4} />\n              ))}\n            </BarChart>\n          </ChartContainer> */}\n        </div>\n      </CardContent>\n      <CardFooter>\n        <Button className=\"w-full\" onClick={handleReload}>\n          <LazyIcon size={24} name={'refresh-ccw'} />\n          {t('session_info_node.reload')}\n        </Button>\n      </CardFooter>\n    </Card>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const connectionHandler = useCallback(\n    async ({ edgeId }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useEffect, useRef } from 'react'\nimport { Position, useInternalNode } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport { getRepository } from 'src/services/database'\nimport { useFlowState } from 'src/states/flow'\nimport { convertToTypeScriptInterface, convertToZodSchemaString } from 'src/utils/schema-format'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from 'src/lib/shadcn/ui/tabs'\nimport { Card } from 'src/lib/shadcn/ui/card'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { SchemaNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const SchemaNode = memo((props: SchemaNodeProps) => {\n  const { t } = useTranslation('flows')\n  const { id, data, isConnectable } = props\n  const loadingRef = useRef(false)\n  const node = useInternalNode(id)\n  const updateNodes = useFlowState((state) => state.updateNodes)\n\n  useConnectionToHandler(id)\n\n  useEffect(() => {\n    const schema = data?.entity\n    if (!schema || !node || loadingRef.current || schema?.schema_items?.length || data.loaded)\n      return\n\n    loadingRef.current = true\n    getRepository('SchemaItem')\n      .find({\n        where: {\n          schema_id: schema.id,\n        },\n      })\n      .then((schemaItems) => {\n        updateNodes([\n          {\n            id: node.id,\n            type: 'replace',\n            item: {\n              ...node,\n              data: {\n                ...(node?.data || {}),\n                loaded: true,\n                entity: {\n                  ...data.entity,\n                  schema_items: schemaItems,\n                },\n              },\n            },\n          },\n        ])\n      })\n      .finally(() => {\n        loadingRef.current = false\n      })\n  }, [data.entity, data.loaded, node, updateNodes])\n\n  return (\n    <div>\n      <div>\n        <NodeHeader id={id} />\n        <Tabs defaultValue=\"account\" className=\"w-[400px]\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"account\">{t('schema_node.typescript')}</TabsTrigger>\n            <TabsTrigger value=\"password\">{t('schema_node.zod')}</TabsTrigger>\n          </TabsList>\n          <TabsContent value=\"account\">\n            <Card className=\"p-4\">\n              <pre className=\"overflow-hidden break-words whitespace-pre-wrap\">\n                {convertToTypeScriptInterface(data?.entity?.schema_items || [])}\n              </pre>\n            </Card>\n          </TabsContent>\n          <TabsContent value=\"password\">\n            <Card className=\"p-4 max-w-full\">\n              <pre className=\"overflow-hidden break-words whitespace-pre-wrap\">\n                {convertToZodSchemaString(data?.entity?.schema_items || [])}\n              </pre>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo, useMemo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Card, CardContent, CardHeader } from 'src/lib/shadcn/ui/card'\nimport { decodeLine, decodeSplitter } from 'src/utils/string-data'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { CSVDataNodeProps } from './type'\n\nexport const CSVDataNode = memo((props: CSVDataNodeProps) => {\n  const { id, data, isConnectable } = props\n\n  const csv = useMemo(() => {\n    if (!data?.entity) {\n      return {\n        headers: [],\n        rows: [],\n      }\n    }\n\n    const lines = decodeLine(data.entity.csv)\n\n    return {\n      headers: decodeSplitter(data.entity.headers),\n      rows: lines.map((row) => decodeSplitter(row)),\n    }\n  }, [data?.entity])\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} />\n        <Card className=\"min-w-32 min-h-16 p-4\">\n          <CardHeader className=\"!p-0\">\n            <div className=\"pt-2 flex !flex-row\">\n              <LazyIcon name=\"file-spreadsheet\" className=\"mr-2\" />\n              <Label className=\"!font-medium leading-none tracking-tight pr-8\">\n                {FlowNodeTypeEnum.CSVData} {csv?.rows?.length ? `(${csv?.rows?.length || 0})` : ''}\n              </Label>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pb-0\">\n            <DataViewer data={csv.rows} headers={csv.headers} />\n          </CardContent>\n        </Card>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          source?.type === FlowNodeTypeEnum.Schema &&\n          target?.type === FlowNodeTypeEnum.ToolDefinition\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { ToolNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const ToolNode = memo(({ id, data, isConnectable }: ToolNodeProps) => {\n  useConnectionToHandler(id)\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <Alert className=\"flex justify-center\">\n          <LazyIcon size={24} name=\"wrench\" />\n          <div className=\"ml-2\">\n            <AlertTitle>{`${data.entity?.name || ''}`}</AlertTitle>\n            <AlertDescription>{`${data.entity?.description || ''}`}</AlertDescription>\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport LazyIcon from './LazyIcon'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Popover, PopoverContent, PopoverTrigger } from 'src/lib/shadcn/ui/popover'\nimport { cn } from 'src/lib/utils'\nimport { Alert } from 'src/lib/shadcn/ui/alert'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { LLMProviderEnum } from 'src/services/database/types'\nimport { GOOGLE_GENERATIVE_AI_API_KEY_LINK, OPEN_AI_API_KEY_LINK } from 'src/constants/llm'\nimport { useConfirmPassphrase } from 'src/hooks/mutations/use-confirm-passphrase'\nimport secureSession from 'src/utils/secure-session'\nimport { decryptSymmetric } from 'src/utils/aes'\n\nexport const EmbeddingSetting = memo(\n  (props: {\n    name?: string\n    className?: string\n    encrypted?: Record<string, unknown>\n    options?: Record<string, unknown>\n    supportedProviders?: string[]\n    onChangeOptions?: (\n      options: Record<string, unknown>,\n      encrypted?: Record<string, unknown>,\n    ) => Promise<void>\n  }) => {\n    const [show, setShow] = useState(false)\n    const [options, setOptions] = useState<Record<string, unknown>>({})\n    const [encrypted, setEncrypted] = useState<Record<string, unknown>>({})\n    const { confirmPassphrase } = useConfirmPassphrase()\n    const { t } = useTranslation('atoms')\n\n    const handleOpenChange = async () => {\n      if (!show) {\n        if (Object.keys(props.encrypted || {})?.length) {\n          await confirmPassphrase()\n          const decrypted: Record<string, unknown> = {}\n          const passphrase = await secureSession.get('passphrase')\n          if (!passphrase) {\n            throw new Error('Passphrase is not found')\n          }\n          await Promise.all(\n            Object.keys(props.encrypted || {}).map(async (key) => {\n              if (props.encrypted?.[key]) {\n                decrypted[key] = await decryptSymmetric(\n                  props.encrypted?.[key] as string,\n                  passphrase!,\n                )\n              }\n            }),\n          )\n          setEncrypted(decrypted || {})\n        }\n        setOptions({ ...props.options })\n      } else {\n        setOptions({})\n        setEncrypted({})\n      }\n      setShow(!show)\n    }\n\n    const hanleSubmit = () => {\n      props.onChangeOptions?.(options || {}, encrypted || {})\n      setShow(false)\n    }\n\n    return (\n      <div className={cn('min-w-20 flex justify-end', props.className)}>\n        <Popover open={show} onOpenChange={setShow}>\n          <PopoverTrigger>\n            <div className=\"flex justify-end gap-2 !cursor-pointer\">\n              <Button\n                onClick={handleOpenChange}\n                variant=\"link\"\n                className=\"flex items-center px-0 !cursor-pointer\"\n              >\n                <LazyIcon name=\"settings\" />\n                <Label>{t('embedding_setting.title')}</Label>\n              </Button>\n            </div>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-full p-0\">\n            {show ? (\n              <Card className=\"!border-none max-w-96 min-w-56\">\n                <CardHeader>\n                  <CardTitle>{t('embedding_setting.title')}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <Label>{t('embedding_setting.provider')}:</Label>\n                  <Select\n                    value={options?.provider ? `${options?.provider}` : 'local_transformers'}\n                    onValueChange={(value) => setOptions({ provider: value })}\n                  >\n                    <SelectTrigger className=\"\">\n                      <SelectValue placeholder={t('embedding_setting.provider_placeholder')} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem key=\"local_transformers\" value=\"local_transformers\">\n                        {t('embedding_setting.providers.local_transformers')}\n                      </SelectItem>\n                      {props.supportedProviders?.map((provider) => (\n                        <SelectItem key={provider} value={provider}>\n                          {t(`embedding_setting.providers.${provider.toLowerCase()}`)}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  {!props.supportedProviders?.length ? (\n                    <Label className=\"text-red-500 !pt-2\">\n                      {t('embedding_setting.alerts.no_provider')}\n                    </Label>\n                  ) : undefined}\n                  <>\n                    {options.provider && options.provider !== 'local_transformers' ? (\n                      <>\n                        <Alert variant=\"destructive\" className=\"mt-4\">\n                          {t('embedding_setting.alerts.session_passkey')}\n                        </Alert>\n                        <div className=\"mt-4\">\n                          <Label>{t('embedding_setting.encrypted_fields.api_key')}</Label>\n                          <Button variant=\"link\" className=\"px-1\">\n                            <a\n                              href={\n                                options.provider === LLMProviderEnum.OpenAI\n                                  ? OPEN_AI_API_KEY_LINK\n                                  : GOOGLE_GENERATIVE_AI_API_KEY_LINK\n                              }\n                              target=\"_blank\"\n                              rel=\"noreferrer\"\n                            >\n                              (\n                              {options.provider === LLMProviderEnum.OpenAI\n                                ? OPEN_AI_API_KEY_LINK\n                                : GOOGLE_GENERATIVE_AI_API_KEY_LINK}\n                              )\n                            </a>\n                          </Button>\n                          <Input\n                            type=\"password\"\n                            value={encrypted?.key ? `${encrypted?.key}` : ''}\n                            onChange={(e) =>\n                              setEncrypted((pre) => ({\n                                ...pre,\n                                key: e.target.value,\n                              }))\n                            }\n                          />\n                        </div>\n                      </>\n                    ) : undefined}\n                  </>\n                </CardContent>\n                <CardFooter className=\"flex justify-end\">\n                  <Button variant=\"secondary\" onClick={hanleSubmit}>\n                    {t('embedding_setting.save')}\n                  </Button>\n                </CardFooter>\n              </Card>\n            ) : undefined}\n          </PopoverContent>\n        </Popover>\n      </div>\n    )\n  },\n)\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const connectionHandler = useCallback(\n    async ({ edgeId }: { edgeId: string; source: Node; target: Node }) => {\n      return {\n        deleteEdgeId: edgeId,\n      }\n    },\n    [],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { useCallback, useEffect } from 'react'\nimport { NodeChange, useInternalNode, useNodes, Node } from '@xyflow/react'\nimport {\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { SYSTEM_NODE_IDS } from 'src/constants/nodes'\nimport secureSession from 'src/utils/secure-session'\nimport { encryptSymmetric } from 'src/utils/aes'\nimport { useConfirmOrCreatePassphrase } from 'src/hooks/mutations/use-confirm-or-create-passphrase'\n\nexport const useActions = (id: string) => {\n  const currentSessionId = useSessionState((state) => state.currentSession?.id)\n  const node = useInternalNode(id)\n  const nodes = useNodes()\n\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { confirmOrCreatePassphrase } = useConfirmOrCreatePassphrase()\n\n  const changeLLMOptions = useCallback(\n    async (input: Record<string, unknown>, inputEncrypted?: Record<string, unknown>) => {\n      if (node && currentSessionId) {\n        let flowNode =\n          id !== SYSTEM_NODE_IDS.DEFAULT_EMBEDDING_MODEL\n            ? await getRepository('FlowNode').findOne({\n                where: { id },\n              })\n            : undefined\n\n        const encrypted: Record<string, unknown> = {}\n        if (Object.keys(inputEncrypted || {})?.length) {\n          await confirmOrCreatePassphrase()\n          const passphrase = await secureSession.get('passphrase')\n          if (!passphrase) {\n            throw new Error('Passphrase is not found')\n          }\n          await Promise.all(\n            Object.keys(inputEncrypted || {}).map(async (key) => {\n              if (inputEncrypted?.[key]) {\n                encrypted[key] = await encryptSymmetric(inputEncrypted[key] as string, passphrase!)\n              }\n            }),\n          )\n        }\n        let flowNodePlaceholder: FlowNodePlaceholder | undefined\n        const changes: NodeChange<Node>[] = []\n        if (!flowNode) {\n          changes.push({ id, type: 'remove' })\n          flowNodePlaceholder = await getRepository('FlowNodePlaceholder').save({\n            placeholder_type: FlowNodePlaceholderTypeEnum.DEFAULT_EMBEDDING_MODEL,\n            encrypted,\n            data: input,\n            session_id: currentSessionId,\n          })\n          flowNode = await getRepository('FlowNode').save({\n            node_type: FlowNodeTypeEnum.DefaultEmbeddingModel,\n            session_id: currentSessionId,\n            source_type: 'FlowNodePlaceholder',\n            source_id: flowNodePlaceholder.id,\n            x: node.position.x,\n            y: node.position.y,\n          })\n          changes.push({ type: 'add', item: node })\n        } else {\n          await getRepository('FlowNodePlaceholder').update(flowNode.source_id, {\n            encrypted,\n            data: input,\n          })\n          flowNodePlaceholder = await getRepository('FlowNodePlaceholder').findOne({\n            where: { id: flowNode.source_id },\n          })\n          changes.push({ id: flowNode.id, type: 'replace', item: node })\n        }\n        node.data.entity = flowNodePlaceholder\n        node.data.flowNode = flowNode\n        updateNodes(changes)\n      }\n    },\n    [confirmOrCreatePassphrase, currentSessionId, id, node, updateNodes],\n  )\n\n  useEffect(() => {\n    if (id !== SYSTEM_NODE_IDS.DEFAULT_EMBEDDING_MODEL) return\n\n    const embeddingNode = nodes.find(\n      (n) =>\n        n.type === FlowNodeTypeEnum.DefaultEmbeddingModel &&\n        n.id !== SYSTEM_NODE_IDS.DEFAULT_EMBEDDING_MODEL,\n    )\n    if (embeddingNode) {\n      updateNodes([{ id, type: 'remove' as const }])\n    }\n  }, [id, nodes, updateNodes])\n\n  return {\n    changeLLMOptions,\n  }\n}\n","import { memo } from 'react'\nimport { Alert, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport { Position } from '@xyflow/react'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { EmbeddingSetting } from 'src/components/atoms/EmbeddingSetting'\nimport { LLMProviderEnum } from 'src/services/database/types'\nimport { DEFAULT_EMBEDDING_MODEL } from 'src/constants/embedding'\n\nimport { EmbeddingNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useActions } from './hooks/use-actions'\n\nexport const EmbeddingNode = memo((props: EmbeddingNodeProps) => {\n  const { id, data, isConnectable } = props\n  const { changeLLMOptions } = useActions(id)\n\n  useConnectionToHandler(id)\n\n  let model = 'brain'\n  let modelName = DEFAULT_EMBEDDING_MODEL\n  switch (`${data?.entity?.data?.provider}`) {\n    case LLMProviderEnum.OpenAI:\n      model = 'gpt'\n      modelName = 'text-embedding-3-small'\n      break\n    case LLMProviderEnum.GoogleGenerativeAI:\n      model = 'gemma'\n      modelName = 'text-embedding-004'\n      break\n  }\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <Alert className=\"flex justify-center max-w-auto\" variant=\"default\">\n          <LLMIcon name={model} className=\"w-7 h-7\" />\n          <div className=\"ml-2 pr-4 flex justify-center gap-1 flex-col\">\n            <div className=\"min-h-8 flex items-center\">\n              <AlertTitle>{`${modelName || ''}`}</AlertTitle>\n            </div>\n            <EmbeddingSetting\n              supportedProviders={[LLMProviderEnum.OpenAI, LLMProviderEnum.GoogleGenerativeAI]}\n              onChangeOptions={changeLLMOptions}\n              encrypted={data.entity?.encrypted}\n              options={data.entity?.data}\n            />\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { Node } from '@xyflow/react'\nimport type { Document } from '@langchain/core/documents'\nimport { useTranslation } from 'react-i18next'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from 'src/lib/shadcn/ui/dialog'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useCreatePrompt } from 'src/hooks/flows/mutations/use-create-prompt'\nimport { Prompt } from 'src/services/database/types'\nimport PromptForm from 'src/components/molecules/CreatePromptCard/PromptForm'\nimport { useToast } from 'src/lib/hooks/use-toast'\n\nconst DEFAULT_PROMPT = `Use the following pieces of context to answer the question at the end.\nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\nUse three sentences maximum and keep the answer as concise as possible.\n\n{context}\n`\n\ntype CreateVectorDatabasePromptProps = {\n  className: string\n  source: Node\n  documents: Document[]\n}\n\nconst CreateVectorDatabasePromptDialog = create<CreateVectorDatabasePromptProps>((props) => {\n  const { source, documents } = props\n  const currentModal = useModal()\n  const { toast } = useToast()\n  const { t } = useTranslation('dialogs')\n  const { loading, createPrompt } = useCreatePrompt()\n\n  const handleSubmit = async (data: Partial<Prompt>) => {\n    try {\n      if (!data.content || !data.content.includes(`{context}`)) {\n        toast({\n          title: t('create_vector_database_prompt.errors.fill_context'),\n          variant: 'destructive',\n        })\n        return\n      }\n      // NOTE: No need to use Prompt template because it will automatically added role prefix\n      const content = data.content.replace(\n        '{context}',\n        documents.map((doc) => `<document>${doc.pageContent}</document>`).join('\\n'),\n      )\n      await createPrompt(source, {\n        ...data,\n        content,\n      })\n      currentModal.hide()\n      return true\n    } catch {\n      toast({\n        title: t('create_vector_database_prompt.errors.create_failed'),\n        variant: 'destructive',\n      })\n    }\n  }\n\n  return (\n    <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <div className=\"flex\">\n            <LazyIcon name=\"file\" className=\"mr-2 h-4 w-4\" />\n            <DialogTitle>{t('create_vector_database_prompt.title')}</DialogTitle>\n          </div>\n        </DialogHeader>\n        <div className=\"flex gap-4 py-4 flex-col\">\n          <PromptForm\n            onSubmit={handleSubmit}\n            loading={loading}\n            hidePromptType\n            defaultPromptRole=\"system\"\n            defaultPromptContent={DEFAULT_PROMPT}\n          />\n          <div className=\"w-full border-0 text-gray-700 flex text-sm items-center\">\n            <LazyIcon name=\"info\" className=\"mr-2\" size={14} />\n            {t('create_vector_database_prompt.fill_content_note')}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n})\n\nexport default CreateVectorDatabasePromptDialog\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  Prompt,\n  PromptTypeEnum,\n  VectorDatabase,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateVectorDatabaseRetriever = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createVectorDatabaseRetriever = useCallback(\n    async ({\n      prompt,\n      source,\n      metadata,\n    }: {\n      source: Node\n      prompt?: Partial<Prompt>\n      metadata?: Record<string, unknown>\n    }) => {\n      try {\n        const vectorDatabase = source?.data?.entity as VectorDatabase\n        if (!vectorDatabase || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const systempPrompt = await getRepository('Prompt').save({\n          ...prompt,\n          status: prompt?.status || MessageStatusEnum.Started,\n          role: prompt?.role || MessageRoleEnum.System,\n          type: prompt?.type || PromptTypeEnum.Chat,\n          content: prompt?.content || '{context}',\n          session_id: sessionId,\n        })\n        if (!systempPrompt) {\n          throw new Error('Failed to save prompt')\n        }\n        const systemPromptNode = await createOrUpdateFlowNode({\n          source_id: systempPrompt.id,\n          source_type: 'Prompt',\n          node_type: FlowNodeTypeEnum.Prompt,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!systemPromptNode) {\n          throw new Error('Failed to save prompt node')\n        }\n        const retriever = await getRepository('FlowNodePlaceholder').save({\n          placeholder: `Retriever for ${vectorDatabase.name}`,\n          placeholder_type: FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER,\n          session_id: sessionId,\n          metadata,\n        })\n        if (!retriever) {\n          throw new Error('Failed to save node placeholder')\n        }\n        const retrieverNode = await createOrUpdateFlowNode({\n          source_id: retriever.id,\n          source_type: 'FlowNodePlaceholder',\n          node_type: FlowNodeTypeEnum.PlaceHolder,\n          x: initialX,\n          y: initialY + 40,\n        })\n        if (!retrieverNode) {\n          throw new Error('Failed to save node placeholder node')\n        }\n        await createOrUpdateFlowEdge({\n          source: systemPromptNode.id,\n          target: retrieverNode.id,\n        })\n        await createOrUpdateFlowEdge({\n          source: source.id,\n          target: retrieverNode.id,\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    loading,\n    createVectorDatabaseRetriever,\n  }\n}\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { Node } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from 'src/lib/shadcn/ui/dialog'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Prompt } from 'src/services/database/types'\nimport PromptForm from 'src/components/molecules/CreatePromptCard/PromptForm'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { useCreateVectorDatabaseRetriever } from 'src/hooks/flows/mutations/use-create-vector-database-retriever'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { useState } from 'react'\n\nconst DEFAULT_PROMPT = `Use the following pieces of context to answer the question at the end.\nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}\n`\n\ntype CreateVectorDatabaseRetrieverDialogProps = {\n  className: string\n  source: Node\n}\n\nconst CreateVectorDatabaseRetrieverDialog = create<CreateVectorDatabaseRetrieverDialogProps>(\n  (props) => {\n    const { source } = props\n    const currentModal = useModal()\n    const { toast } = useToast()\n    const { t } = useTranslation('dialogs')\n    const [k, setK] = useState<number | undefined>(1)\n    const [minimalScore, setMinimalScore] = useState<number | undefined>(undefined)\n    const { loading, createVectorDatabaseRetriever } = useCreateVectorDatabaseRetriever()\n\n    const handleSubmit = async (data: Partial<Prompt>) => {\n      try {\n        const content = data.content\n        if (!content || !content.includes(`{context}`)) {\n          toast({\n            title: t('create_vector_database_retriever.errors.fill_context'),\n            variant: 'destructive',\n          })\n          return\n        }\n        await createVectorDatabaseRetriever({\n          source,\n          prompt: {\n            content: content,\n          },\n          metadata: {\n            k,\n            minimalScore,\n          },\n        })\n        setK(1)\n        setMinimalScore(undefined)\n        currentModal.hide()\n        return true\n      } catch {\n        toast({\n          title: t('create_vector_database_retriever.errors.create_failed'),\n          variant: 'destructive',\n        })\n      }\n    }\n\n    const handleOnChangeK = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setK(e.target.value ? Number(e.target.value) : undefined)\n    }\n\n    const handleOnChangeMinimalScore = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setMinimalScore(e.target.value ? Number(e.target.value) : undefined)\n    }\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <div className=\"flex\">\n              <LazyIcon name=\"file\" className=\"mr-2 h-4 w-4\" />\n              <DialogTitle>{t('create_vector_database_retriever.title')}</DialogTitle>\n            </div>\n          </DialogHeader>\n          <div className=\"flex gap-4 py-4 flex-col\">\n            <PromptForm\n              onSubmit={handleSubmit}\n              loading={loading}\n              hidePromptType\n              defaultPromptRole=\"system\"\n              defaultPromptContent={DEFAULT_PROMPT}\n            />\n            <Card>\n              <CardHeader>\n                <CardTitle>{t('create_vector_database_retriever.retriever_settings')}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Label>{t('create_vector_database_retriever.retriever_k')}</Label>\n                <Input\n                  value={k || ''}\n                  type=\"number\"\n                  onChange={handleOnChangeK}\n                  placeholder={t('create_vector_database_retriever.retriever_k_placeholder')}\n                />\n                <Label>{t('create_vector_database_retriever.retriever_minimum_score')}</Label>\n                <Input\n                  value={minimalScore || ''}\n                  type=\"number\"\n                  onChange={handleOnChangeMinimalScore}\n                  placeholder={t(\n                    'create_vector_database_retriever.retriever_minimum_score_placeholder',\n                  )}\n                />\n              </CardContent>\n            </Card>\n            <div className=\"w-full border-0 text-gray-700 flex text-sm items-center\">\n              <LazyIcon name=\"info\" className=\"mr-2\" size={14} />\n              {t('create_vector_database_retriever.fill_content_note')}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default CreateVectorDatabaseRetrieverDialog\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\nimport { useFlowState } from 'src/states/flow'\nimport { CSVData, FlowNodeTypeEnum, VectorDatabase } from 'src/services/database/types'\nimport { decodeCSVData } from 'src/utils/string-data'\nimport { Document } from '@langchain/core/documents'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useFlowEmbeddingNode } from 'src/hooks/flows/use-flow-embedding-node'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const { getFlowEmbeddingEntity } = useFlowEmbeddingNode()\n  const { index: indexFunction } = useEmbedding()\n\n  const connectionHandler = useCallback(\n    async ({ edgeId, target, source }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        const targetEntity = target?.data?.entity as VectorDatabase\n        if (\n          source?.type === FlowNodeTypeEnum.CSVData &&\n          target?.type === FlowNodeTypeEnum.VectorDatabase\n        ) {\n          const csvData = source?.data?.entity as CSVData\n          if (!csvData || !targetEntity) {\n            return {\n              deleteEdgeId: edgeId,\n            }\n          }\n          const { rows } = decodeCSVData(csvData.headers, csvData.csv)\n          const documents = rows.map(\n            (row) =>\n              new Document({\n                pageContent: `${row.text}`,\n              }),\n          )\n          await indexFunction(\n            getFlowEmbeddingEntity(),\n            {\n              database: {\n                databaseId: targetEntity.id,\n                dataSourceId: csvData.id,\n                dataSourceType: 'CSVData',\n              },\n            },\n            documents,\n          )\n          await createOrUpdateFlowEdge({\n            source: source.id,\n            target: target.id,\n          })\n          return\n        }\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge, getFlowEmbeddingEntity, indexFunction],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { Document } from '@langchain/core/documents'\nimport chunk from 'lodash/chunk'\nimport { useReactFlow } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { getRepository } from 'src/services/database'\nimport type { VectorDatabase } from 'src/services/database/types'\nimport {\n  FlowNodeTypeEnum,\n  CSVData,\n  JSONData,\n  JSONLData,\n  VectorDatabaseStorageEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { getStorageDataSource } from 'src/utils/vector-storage'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useFlowEmbeddingNode } from 'src/hooks/flows/use-flow-embedding-node'\n\nexport const useActions = (id: string) => {\n  const [loading, setLoading] = useState(false)\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n\n  const { getNode, getHandleConnections } = useReactFlow()\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { getFlowEmbeddingEntity } = useFlowEmbeddingNode()\n  const { index: indexFunction, similaritySearchWithScore: similaritySearchWithScoreFunction } =\n    useEmbedding()\n  const similaritySearchWithScore = useCallback(\n    async (input: string, options?: { k?: number }) => {\n      try {\n        const vectorDatabaseNode = getNode(id)\n        if (!vectorDatabaseNode) {\n          return\n        }\n        const entity = vectorDatabaseNode.data?.entity as VectorDatabase\n        if (!entity) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n        const embbedingEntity = getFlowEmbeddingEntity()\n        if (entity.storage === VectorDatabaseStorageEnum.DataNode) {\n          const connections = getHandleConnections({\n            nodeId: id,\n            type: 'target',\n          })\n          const dataSourceNode = connections\n            .map((connection) => getNode(connection.source))\n            .find(\n              (node) =>\n                node?.type &&\n                [FlowNodeTypeEnum.JSONLData, FlowNodeTypeEnum.CSVData].includes(\n                  node?.type as FlowNodeTypeEnum,\n                ),\n            )\n          const dataSource = dataSourceNode?.data?.entity as CSVData | JSONData | JSONLData\n          if (!dataSource) {\n            toast({\n              variant: 'destructive',\n              title: t('vector_database_node.errors.data_node_not_found'),\n            })\n            return\n          }\n          setLoading(true)\n          const result = await similaritySearchWithScoreFunction(\n            embbedingEntity,\n            {\n              database: {\n                databaseId: entity.id,\n                dataSourceId: dataSource.id,\n                dataSourceType: getStorageDataSource(dataSource),\n              },\n            },\n            input,\n            options?.k,\n          )\n          return result\n        } else {\n          setLoading(true)\n          const result = await similaritySearchWithScoreFunction(\n            embbedingEntity,\n            {\n              database: {\n                databaseId: entity.id,\n              },\n            },\n            input,\n            options?.k,\n          )\n          return result\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [\n      getNode,\n      id,\n      getFlowEmbeddingEntity,\n      toast,\n      t,\n      getHandleConnections,\n      similaritySearchWithScoreFunction,\n    ],\n  )\n\n  const indexData = useCallback(\n    async (\n      data: { id?: string; content?: string; documents?: Document[] },\n      options?: {\n        onProgressReport?: (info: { total: number; handled: number; handling: number }) => void\n      },\n    ) => {\n      try {\n        const vectorDatabaseNode = getNode(id)\n        if (!vectorDatabaseNode) {\n          return\n        }\n        setLoading(true)\n        const documents = data.content\n          ? [\n              new Document({\n                pageContent: data.content,\n                id: data.id,\n                metadata: {\n                  id: data.id,\n                },\n              }),\n            ]\n          : data.documents\n\n        if (!documents?.length) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.content_not_found'),\n          })\n          return\n        }\n\n        const entity = vectorDatabaseNode.data?.entity as VectorDatabase\n        if (!entity || !vectorDatabaseNode) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n\n        const embbedingEntity = getFlowEmbeddingEntity()\n\n        if (entity.storage === VectorDatabaseStorageEnum.DataNode) {\n          const connections = getHandleConnections({\n            nodeId: id,\n            type: 'target',\n          })\n          const dataSourceNode = connections\n            .map((connection) => getNode(connection.source))\n            .find(\n              (node) =>\n                node?.type &&\n                [FlowNodeTypeEnum.JSONLData, FlowNodeTypeEnum.CSVData].includes(\n                  node?.type as FlowNodeTypeEnum,\n                ),\n            )\n\n          const dataSource = dataSourceNode?.data?.entity as CSVData | JSONData | JSONLData\n          if (!dataSource) {\n            toast({\n              variant: 'destructive',\n              title: t('vector_database_node.errors.data_node_not_found'),\n            })\n            return\n          }\n          const dataSourceType = getStorageDataSource(dataSource)\n\n          const chunkedDocuments = chunk(documents, 10)\n          let handledCount = 0\n\n          for (const partDocuments of chunkedDocuments) {\n            options?.onProgressReport?.({\n              handling: partDocuments.length,\n              handled: handledCount,\n              total: documents.length,\n            })\n            await indexFunction(\n              embbedingEntity,\n              {\n                database: {\n                  databaseId: entity.id,\n                  dataSourceId: dataSource.id,\n                  dataSourceType,\n                },\n              },\n              partDocuments,\n            )\n            if (dataSourceType && dataSourceNode) {\n              const updatedDataNode = await getRepository(dataSourceType).findOne({\n                where: { id: dataSource.id },\n              })\n              updateNodes([\n                {\n                  type: 'replace',\n                  id: dataSourceNode.id,\n                  item: {\n                    ...dataSourceNode,\n                    data: {\n                      ...dataSourceNode.data,\n                      entity: updatedDataNode,\n                    },\n                  },\n                },\n              ])\n            }\n            handledCount += partDocuments.length\n          }\n        } else {\n          // DEFAULT OPTION IS INDEXING AND STORED DIRECTLY TO VECTOR DATABASE ENTITY\n          const chunkedDocuments = chunk(documents, 10)\n          let handledCount = 0\n\n          for (const partDocuments of chunkedDocuments) {\n            options?.onProgressReport?.({\n              handling: partDocuments.length,\n              handled: handledCount,\n              total: documents.length,\n            })\n            await indexFunction(\n              embbedingEntity,\n              {\n                database: {\n                  databaseId: entity.id,\n                },\n              },\n              partDocuments,\n            )\n            const updatedDataNode = await getRepository('VectorDatabase').findOne({\n              where: { id: `${entity.id}` },\n            })\n            updateNodes([\n              {\n                type: 'replace',\n                id: vectorDatabaseNode.id,\n                item: {\n                  ...vectorDatabaseNode,\n                  data: {\n                    ...vectorDatabaseNode.data,\n                    entity: updatedDataNode,\n                  },\n                },\n              },\n            ])\n            handledCount += partDocuments.length\n          }\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [\n      getNode,\n      id,\n      getFlowEmbeddingEntity,\n      toast,\n      t,\n      getHandleConnections,\n      indexFunction,\n      updateNodes,\n    ],\n  )\n\n  return {\n    loading,\n    indexData,\n    similaritySearchWithScore,\n  }\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { Alert, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport type { Document } from '@langchain/core/documents'\nimport { Position, useInternalNode } from '@xyflow/react'\nimport { WebPDFLoader } from '@langchain/community/document_loaders/web/pdf'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { useTranslation } from 'react-i18next'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from 'src/lib/shadcn/ui/tabs'\nimport { useModal } from '@ebay/nice-modal-react'\nimport CreatePromptDialog from 'src/components/dialogs/CreateVectorDatabasePromptDialog'\nimport CreateRetrieverDialog from 'src/components/dialogs/CreateVectorDatabaseRetrieverDialog'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { cn } from 'src/lib/utils'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { decodeLine } from 'src/utils/string-data'\n\nimport { VectorDatabaseNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useActions } from './hooks/use-actions'\nimport { VectorSearch } from './components/VectorSearch'\nimport IndexNewText from './components/IndexNewText'\nimport IndexNewFile from './components/IndexNewFile'\n\nexport const VectorDatabaseNode = memo((props: VectorDatabaseNodeProps) => {\n  const { t } = useTranslation('flows')\n  const [progress, setProgress] = useState(0)\n  const [mode, setMode] = useState('search')\n  const node = useInternalNode(props.id)\n  const { id, data, isConnectable } = props\n  const { loading, similaritySearchWithScore, indexData } = useActions(id)\n\n  const createPromptDialog = useModal(CreatePromptDialog)\n  const createRetrieverDialog = useModal(CreateRetrieverDialog)\n\n  useConnectionToHandler(id)\n\n  const handleCreateData = useCallback(\n    async (...args: Parameters<typeof indexData>) => {\n      if (node) {\n        await indexData(...args)\n      }\n    },\n    [indexData, node],\n  )\n\n  const handleSimilaritySearch = useCallback(\n    async (value: string, k?: number) => {\n      const input = value.trim()\n      const documents = await similaritySearchWithScore(input, { k })\n      if (!documents?.length) {\n        return\n      }\n      return documents\n    },\n    [similaritySearchWithScore],\n  )\n\n  const handleCreatePrompt = useCallback(\n    (content: [Document, number][]) => {\n      createPromptDialog.show({\n        source: node,\n        documents: content.map(([doc]) => doc),\n      })\n    },\n    [createPromptDialog, node],\n  )\n\n  const handleCreateRetriever = useCallback(async () => {\n    createRetrieverDialog.show({\n      source: node,\n    })\n  }, [createRetrieverDialog, node])\n\n  const handleIndexPDF = useCallback(\n    async (file: File) => {\n      if (file.type.includes('text') || file.type.includes('txt')) {\n        const reader = new FileReader()\n        reader.onload = async (e) => {\n          const content = e.target?.result as string\n          await handleCreateData({ content })\n        }\n        reader.readAsText(file)\n      } else if (file.type.endsWith('pdf')) {\n        // File to blob\n        const blob = new Blob([file], { type: 'application/pdf' })\n        const customBuildLoader = new WebPDFLoader(blob, {\n          // you may need to add `.then(m => m.default)` to the end of the import\n          pdfjs: async () => {\n            const pdfjs = await import('pdfjs-dist/legacy/build/pdf.min.mjs')\n            await import('pdfjs-dist/legacy/build/pdf.worker.min.mjs')\n            pdfjs.GlobalWorkerOptions.workerSrc = new URL(\n              'pdfjs-dist/build/pdf.worker.min.js',\n              import.meta.url,\n            ).toString()\n            return pdfjs\n          },\n          parsedItemSeparator: ' ',\n        })\n        const documents = await customBuildLoader.load()\n        await handleCreateData(\n          { documents },\n          {\n            onProgressReport: (info) => {\n              setProgress((info.handled + info.handling) / info.total)\n            },\n          },\n        )\n      }\n    },\n    [handleCreateData],\n  )\n\n  const vectorDatabaseData = useMemo(() => {\n    if (!data?.entity?.raw) {\n      return {\n        headers: [],\n        rows: [],\n      }\n    }\n\n    const headers = ['content', 'embedding', 'metadata']\n    const lines = decodeLine(data?.entity?.raw)\n    return {\n      headers,\n      rows: lines.map((row) => {\n        try {\n          const data = JSON.parse(row)\n          return data\n        } catch {\n          return []\n        }\n      }),\n    }\n  }, [data?.entity?.raw])\n\n  const renderContent = useMemo(() => {\n    switch (mode) {\n      case 'search':\n        return (\n          <TabsContent value=\"search\">\n            <VectorSearch\n              loading={loading}\n              onSimilaritySearch={handleSimilaritySearch}\n              onCreatePrompt={handleCreatePrompt}\n              onCreateRetriever={handleCreateRetriever}\n            />\n          </TabsContent>\n        )\n      case 'new':\n        return (\n          <TabsContent className=\"min-w-80\" value=\"new\">\n            <IndexNewText loading={loading} onCreateData={handleCreateData} />\n          </TabsContent>\n        )\n      case 'file':\n        return (\n          <TabsContent value=\"file\">\n            <IndexNewFile\n              loading={loading}\n              progress={progress}\n              onFileSubmit={handleIndexPDF}\n              fileOptions={{ accept: '.pdf,.txt,.text', maxSize: 15 }}\n            />\n          </TabsContent>\n        )\n      case 'view': {\n        return (\n          <TabsContent value=\"view\">\n            <DataViewer\n              data={vectorDatabaseData.rows}\n              headers={vectorDatabaseData.headers}\n              limitLengthByColumns={{\n                embedding: 32,\n              }}\n            />\n          </TabsContent>\n        )\n      }\n    }\n  }, [\n    handleCreateData,\n    handleCreatePrompt,\n    handleCreateRetriever,\n    handleIndexPDF,\n    handleSimilaritySearch,\n    loading,\n    mode,\n    progress,\n    vectorDatabaseData,\n  ])\n\n  return (\n    <div className=\"min-w-72\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"max-w-full\">\n        <NodeHeader id={id} />\n        <Alert className=\"flex justify-center\" variant=\"default\">\n          <LazyIcon size={24} name={'database-zap'} />\n          <div className=\"ml-2 max-w-full\">\n            <AlertTitle>{`${data.entity?.name || ''}`}</AlertTitle>\n            <Tabs\n              value={mode}\n              onValueChange={setMode}\n              defaultValue=\"search\"\n              className={cn('w-full mt-4')}\n            >\n              <TabsList\n                className={cn(\n                  'grid w-full grid-cols-3',\n                  data.entity?.storage === VectorDatabaseStorageEnum.DatabaseNode\n                    ? 'grid-cols-4'\n                    : 'grid-cols-3',\n                )}\n              >\n                <TabsTrigger value=\"search\">{t('vector_database_node.search')}</TabsTrigger>\n                <TabsTrigger value=\"new\">{t('vector_database_node.text')}</TabsTrigger>\n                <TabsTrigger value=\"file\">{t('vector_database_node.file')}</TabsTrigger>\n                {data.entity?.storage === VectorDatabaseStorageEnum.DatabaseNode ? (\n                  <TabsTrigger value=\"view\">{t('vector_database_node.view')}</TabsTrigger>\n                ) : undefined}\n              </TabsList>\n              {renderContent}\n            </Tabs>\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo, useMemo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Card, CardContent, CardHeader } from 'src/lib/shadcn/ui/card'\nimport { decodeLine, decodeSplitter } from 'src/utils/string-data'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { JSONLDataNodeProps } from './type'\n\nconst LIMIT_LENGTH_BY_COLUMNS = {\n  embedding: 32,\n}\nexport const JSONLDataNode = memo((props: JSONLDataNodeProps) => {\n  const { id, data, isConnectable } = props\n\n  const jsonl = useMemo(() => {\n    if (!data?.entity?.jsonl) {\n      return {\n        headers: [],\n        rows: [],\n      }\n    }\n\n    const headers = decodeSplitter(data.entity.headers || '')\n    const lines = decodeLine(data.entity.jsonl)\n    return {\n      headers,\n      rows: lines.map((row) => {\n        try {\n          const data = JSON.parse(row)\n          return data\n        } catch {\n          return []\n        }\n      }),\n    }\n  }, [data?.entity?.jsonl, data.entity.headers])\n\n  return (\n    <div className=\"min-w-80\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} />\n        <Card className=\"min-w-32 min-h-16 p-4\">\n          <CardHeader className=\"!p-0\">\n            <div className=\"pt-2 flex !flex-row\">\n              <LazyIcon name=\"file-json\" className=\"mr-2\" />\n              <Label className=\"!font-medium leading-none tracking-tight pr-8\">\n                {FlowNodeTypeEnum.JSONLData}{' '}\n                {jsonl?.rows?.length ? `(${jsonl?.rows?.length || 0})` : ''}\n              </Label>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pb-0\">\n            <DataViewer\n              data={jsonl.rows}\n              headers={jsonl.headers}\n              limitLengthByColumns={LIMIT_LENGTH_BY_COLUMNS}\n            />\n          </CardContent>\n        </Card>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","'use client'\n\nimport React, { PropsWithChildren, useRef } from 'react'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport { motion, MotionValue, useMotionValue, useSpring, useTransform } from 'framer-motion'\n\nimport { cn } from 'src/lib/utils'\n\nexport interface DockProps extends VariantProps<typeof dockVariants> {\n  className?: string\n  magnification?: number\n  distance?: number\n  direction?: 'top' | 'middle' | 'bottom'\n  children: React.ReactNode\n}\n\nconst DEFAULT_MAGNIFICATION = 60\nconst DEFAULT_DISTANCE = 140\n\nconst dockVariants = cva(\n  'supports-backdrop-blur:bg-white/10 supports-backdrop-blur:dark:bg-black/10 mx-auto flex h-[58px] w-max gap-2 rounded-lg border p-2 backdrop-blur-md',\n)\n\nconst Dock = React.forwardRef<HTMLDivElement, DockProps>(\n  (\n    {\n      className,\n      children,\n      magnification = DEFAULT_MAGNIFICATION,\n      distance = DEFAULT_DISTANCE,\n      direction = 'bottom',\n      ...props\n    },\n    ref,\n  ) => {\n    const mouseX = useMotionValue(Infinity)\n\n    const renderChildren = () => {\n      return React.Children.map(children, (child) => {\n        if (React.isValidElement(child) && child.type === DockIcon) {\n          return React.cloneElement(child, {\n            ...child.props,\n            mouseX: mouseX,\n            magnification: magnification,\n            distance: distance,\n          })\n        }\n        return child\n      })\n    }\n\n    return (\n      <motion.div\n        ref={ref}\n        onMouseMove={(e) => mouseX.set(e.pageX)}\n        onMouseLeave={() => mouseX.set(Infinity)}\n        {...props}\n        className={cn(dockVariants({ className }), {\n          'items-start': direction === 'top',\n          'items-center': direction === 'middle',\n          'items-end': direction === 'bottom',\n        })}\n      >\n        {renderChildren()}\n      </motion.div>\n    )\n  },\n)\n\nDock.displayName = 'Dock'\n\nexport interface DockIconProps {\n  size?: number\n  magnification?: number\n  distance?: number\n  mouseX?: MotionValue<number>\n  className?: string\n  children?: React.ReactNode\n  props?: PropsWithChildren\n}\n\nconst DockIcon = ({\n  magnification = DEFAULT_MAGNIFICATION,\n  distance = DEFAULT_DISTANCE,\n  mouseX,\n  className,\n  children,\n  ...props\n}: DockIconProps) => {\n  const ref = useRef<HTMLDivElement>(null)\n\n  const distanceCalc = useTransform(mouseX || new MotionValue(0), (val: number) => {\n    const bounds = ref.current?.getBoundingClientRect() ?? { x: 0, width: 0 }\n\n    return val - bounds.x - bounds.width / 2\n  })\n\n  const widthSync = useTransform(distanceCalc, [-distance, 0, distance], [40, magnification, 40])\n\n  const width = useSpring(widthSync, {\n    mass: 0.1,\n    stiffness: 150,\n    damping: 12,\n  })\n\n  return (\n    <motion.div\n      ref={ref}\n      style={{ width }}\n      className={cn(\n        'flex aspect-square cursor-pointer items-center justify-center rounded-full',\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </motion.div>\n  )\n}\n\nDockIcon.displayName = 'DockIcon'\n\nexport { Dock, DockIcon, dockVariants }\n","import { FlowNodeTypeEnum } from 'src/services/database/types'\n\nexport const DEFAULT_NODE_SIZE: Partial<{\n  [key in FlowNodeTypeEnum]: { width: number; height: number }\n}> = {\n  [FlowNodeTypeEnum.Shape]: { width: 100, height: 100 },\n  [FlowNodeTypeEnum.CircleShape]: { width: 100, height: 100 },\n  [FlowNodeTypeEnum.TriangleShape]: { width: 100, height: 100 },\n  [FlowNodeTypeEnum.EditorApp]: { width: 1240, height: 400 },\n}\n","import { useCallback, useState } from 'react'\nimport { useInternalNode } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\n\nimport { DEFAULT_NODE_SIZE } from '../constants'\n\nexport const useActions = (id: string) => {\n  const node = useInternalNode(id)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const createNode = useCallback(\n    async (nodeType: FlowNodeTypeEnum) => {\n      try {\n        setLoading(true)\n        if (node && currentSession?.id) {\n          const initialX = node.position?.x || 0\n          const initialY = (node.position?.y || 0) + (node.measured?.height || 0)\n\n          const nodeData = await getRepository('FlowNodeData').save({\n            data: {},\n            session_id: currentSession.id,\n          })\n\n          if (!nodeData) {\n            throw new Error('Failed to save node data')\n          }\n\n          const newNode = await createOrUpdateFlowNode({\n            node_type: nodeType,\n            data: {},\n            source_id: nodeData.id,\n            source_type: 'FlowNodeData',\n            x: initialX,\n            y: initialY + 20,\n            ...(DEFAULT_NODE_SIZE[nodeType] || {}),\n          })\n          if (!newNode) {\n            throw new Error('Failed to save node')\n          }\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [createOrUpdateFlowNode, currentSession?.id, node],\n  )\n\n  return {\n    loading,\n    createNode,\n  }\n}\n","import { memo } from 'react'\n\nimport { Separator } from 'src/lib/shadcn/ui/separator'\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from 'src/lib/shadcn/ui/tooltip'\nimport { Dock, DockIcon } from 'src/lib/shadcn/ui/dock'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useTranslation } from 'react-i18next'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { NodeProps } from '@xyflow/react'\nimport VisualStudioCodeSvg from 'src/assets/svgs/visual-studio-code.svg?react'\nimport plateEditorIcon from 'src/assets/images/plate-editor.png'\nimport { useToast } from 'src/lib/hooks/use-toast'\n\nimport { useActions } from './hooks/use-actions'\n\nconst DATA = {\n  applications: [\n    {\n      key: FlowNodeTypeEnum.EditorApp,\n      image: plateEditorIcon,\n      label: 'application_bar.editor',\n    },\n    {\n      key: FlowNodeTypeEnum.VSLiteApp,\n      icon: VisualStudioCodeSvg,\n      label: 'application_bar.vslite',\n    },\n  ],\n  shapes: [\n    { key: FlowNodeTypeEnum.Shape, icon: 'square' as const, label: 'application_bar.square' },\n    { key: FlowNodeTypeEnum.CircleShape, icon: 'circle' as const, label: 'application_bar.circle' },\n    {\n      key: FlowNodeTypeEnum.TriangleShape,\n      icon: 'triangle' as const,\n      label: 'application_bar.triangle',\n    },\n  ],\n}\n\nexport const ApplicationBarNode = memo((props: NodeProps) => {\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n  const { loading, createNode } = useActions(props.id)\n  const handleAddNode = async (nodeType: FlowNodeTypeEnum) => {\n    try {\n      if (loading) {\n        return\n      }\n      await createNode(nodeType)\n    } catch {\n      toast({\n        description: t('application_bar.errors.add_node_failed'),\n        variant: 'destructive',\n      })\n    }\n  }\n  return (\n    <TooltipProvider>\n      <Dock direction=\"middle\">\n        {DATA.applications.map((item) => {\n          const Icon = item.icon\n          return (\n            <DockIcon key={item.label}>\n              <Tooltip>\n                <TooltipTrigger>\n                  {Icon ? (\n                    <Icon width={20} height={20} onClick={() => handleAddNode(item.key)} />\n                  ) : undefined}\n                  {item.image ? (\n                    <img\n                      src={item.image}\n                      alt={t(item.label)}\n                      className=\"w-8 h-8 rounded-md\"\n                      onClick={() => handleAddNode(item.key)}\n                    />\n                  ) : undefined}\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>{t(item.label)}</p>\n                </TooltipContent>\n              </Tooltip>\n            </DockIcon>\n          )\n        })}\n        <Separator orientation=\"vertical\" className=\"h-full\" />\n        {DATA.shapes.map((item) => (\n          <DockIcon key={item.label}>\n            <Tooltip>\n              <TooltipTrigger>\n                <LazyIcon onClick={() => handleAddNode(item.key)} name={item.icon} />\n              </TooltipTrigger>\n              <TooltipContent>\n                <p>{t(item.label)}</p>\n              </TooltipContent>\n            </Tooltip>\n          </DockIcon>\n        ))}\n      </Dock>\n    </TooltipProvider>\n  )\n})\n","import { memo } from 'react'\nimport { NodeResizer, NodeResizerProps } from '@xyflow/react'\nimport { cn } from 'src/lib/utils'\n\nexport const DefaultNodeResizer = memo((props: NodeResizerProps) => {\n  const { lineClassName, handleClassName, ...rest } = props\n  return (\n    <NodeResizer\n      lineClassName={cn('!border-1.5', lineClassName)}\n      handleClassName={cn('!w-2 !h-2 !border-2 !rounded-full', handleClassName)}\n      {...rest}\n    />\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          [FlowNodeTypeEnum.CircleShape, FlowNodeTypeEnum.TriangleShape].includes(\n            source?.type as FlowNodeTypeEnum,\n          ) &&\n          target?.type === FlowNodeTypeEnum.Shape\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position, NodeProps } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const ShapeNode = memo((props: NodeProps) => {\n  const { id, selected, isConnectable } = props\n  useConnectionToHandler(id)\n  return (\n    <>\n      <DefaultNodeResizer isVisible={!!selected} minWidth={40} minHeight={40} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"min-w-10 min-h-10 w-full h-full bg-border border\">\n        <NodeHeader id={id} />\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          [FlowNodeTypeEnum.Shape, FlowNodeTypeEnum.TriangleShape].includes(\n            source?.type as FlowNodeTypeEnum,\n          ) &&\n          target?.type === FlowNodeTypeEnum.CircleShape\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position, NodeProps } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const CircleNode = memo((props: NodeProps) => {\n  const { id, selected, isConnectable } = props\n  useConnectionToHandler(id)\n  return (\n    <>\n      <DefaultNodeResizer isVisible={!!selected} minWidth={40} minHeight={40} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"min-w-10 min-h-10 w-full h-full bg-border rounded-full border\">\n        <NodeHeader id={id} />\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          [FlowNodeTypeEnum.CircleShape, FlowNodeTypeEnum.Shape].includes(\n            source?.type as FlowNodeTypeEnum,\n          ) &&\n          target?.type === FlowNodeTypeEnum.TriangleShape\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position, NodeProps } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const TriangleNode = memo((props: NodeProps) => {\n  const { id, selected, width, height, isConnectable } = props\n  useConnectionToHandler(id)\n  return (\n    <>\n      <DefaultNodeResizer isVisible={!!selected} minWidth={40} minHeight={40} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div\n        className=\"w-0 h-0 border-l-transparent border-r-transparent border-b-border\"\n        style={{\n          borderLeftWidth: (width || 0) / 2,\n          borderRightWidth: (width || 0) / 2,\n          borderBottomWidth: height || 0,\n        }}\n      />\n      <NodeHeader id={id} className=\"absolute top-0 right-0\" />\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.LLM && target?.type === FlowNodeTypeEnum.EditorApp) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { useCallback, useRef } from 'react'\nimport { HumanMessage, type BaseMessage } from '@langchain/core/messages'\nimport { Connection, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { FlowNodeTypeEnum, LLM, LLMStatusEnum } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { DefaultNode } from 'src/utils/flow-node'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\n\nexport const useActions = (id: string) => {\n  const node = useInternalNode(id)\n  const { t } = useTranslation('flows')\n  const refDebounce = useRef<number | null>(null)\n  const { toast } = useToast()\n  const { getNode, getHandleConnections } = useReactFlow()\n  const { stream } = useLLM()\n\n  const updateEditorContent = useCallback(\n    async (value: unknown[]) => {\n      if (!node) return\n      clearTimeout(refDebounce.current!)\n      refDebounce.current = setTimeout(async () => {\n        await getRepository('FlowNode').update(node.id, {\n          data: value,\n        })\n      }, 150) as unknown as number\n    },\n    [node],\n  )\n\n  const createMessage = useCallback(\n    async (input: string | BaseMessage[], onMessageUpdate: (chunk: string) => void) => {\n      if (node) {\n        const connections = getHandleConnections({\n          nodeId: id,\n          type: 'target',\n        })\n        const llmConnection = connections.find((connection) => {\n          const currentNode = getNode(connection.source)\n          return currentNode?.type === FlowNodeTypeEnum.LLM\n        })\n        const llmNode = llmConnection ? getNode(llmConnection?.source as string) : undefined\n        const llm = llmNode?.data?.entity as LLM\n        if (!llmNode || !llm) {\n          return toast({\n            variant: 'destructive',\n            description: t('editor_node.errors.llm_not_found'),\n          })\n        } else if (llmNode.data.status !== LLMStatusEnum.Loaded) {\n          return toast({\n            variant: 'destructive',\n            description: t('editor_node.errors.llm_not_loaded_yet'),\n          })\n        }\n        try {\n          const streamResponse = await stream(\n            llm.provider,\n            typeof input === 'string' ? [new HumanMessage(input)] : input,\n            {\n              onMessageUpdate: (data) => {\n                onMessageUpdate?.(data.content)\n              },\n              llm,\n            },\n          )\n          return streamResponse?.content\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('LLM_NOT_LOADED_YET')) {\n            return toast({\n              title: t('editor_node.errors.llm_not_loaded_yet'),\n            })\n          }\n          toast({\n            variant: 'destructive',\n            title: t('editor_node.errors.stream_message_failed'),\n          })\n        }\n      }\n    },\n    [node, getHandleConnections, id, getNode, toast, t, stream],\n  )\n\n  const getLinkedConnections = useCallback(\n    (id: string) => {\n      const currentNode = getNode(id)\n      if (!currentNode) {\n        return []\n      }\n      const linkedConnections: {\n        node: DefaultNode\n        connections: Connection[]\n        connectedNodes?: DefaultNode[]\n      }[] = []\n      const connections = getHandleConnections({\n        nodeId: id,\n        type: 'target',\n      })\n      connections.forEach((connection) => {\n        const node = getNode(connection.source)\n        if (!node || node.type !== FlowNodeTypeEnum.LLM) {\n          return\n        }\n        linkedConnections.push({\n          node: node as DefaultNode,\n          connections: [connection],\n        })\n      })\n      return linkedConnections\n    },\n    [getHandleConnections, getNode],\n  )\n\n  return {\n    createMessage,\n    updateEditorContent,\n    getLinkedConnections,\n  }\n}\n","import { lazy, memo, Suspense, useCallback } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useActions } from './hooks/use-actions'\nimport { EditorAppNodeProps } from './type'\n\nconst PlateAppEditor = lazy(() => import('src/components/organisms/PlateEditor'))\n\nexport const EditorAppNode = memo((props: EditorAppNodeProps) => {\n  const { id, data, selected, isConnectable } = props\n  useConnectionToHandler(id)\n  const { createMessage, updateEditorContent, getLinkedConnections } = useActions(id)\n\n  const handleChangeContent = useCallback(\n    (value: unknown[]) => {\n      updateEditorContent(value)\n    },\n    [updateEditorContent],\n  )\n\n  return (\n    <div className=\"w-full min-w-[1240px] h-full\">\n      <DefaultNodeResizer isVisible={!!selected} minWidth={1240} minHeight={400} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"min-w-10 min-h-10 w-full h-full rounded-lg border bg-background\">\n        <NodeHeader\n          className=\"!z-[100]\"\n          id={id}\n          enableToStandalone\n          getLinkedConnections={getLinkedConnections}\n        />\n        <Suspense\n          fallback={\n            <div className=\"h-full w-ful rounded-lg flex justify-center items-center\">\n              <LazyIcon name=\"loader-circle\" className=\"animate-spin\" />\n            </div>\n          }\n        >\n          <div className=\"h-full w-ful rounded-lg\" data-registry=\"plate\">\n            <PlateAppEditor\n              defaultValue={data?.flowNode?.data}\n              onValueChange={handleChangeContent}\n              copilotStream={createMessage}\n            />\n          </div>\n        </Suspense>\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </div>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const connectionHandler = useCallback(\n    async ({ edgeId }: { edgeId: string; source: Node; target: Node; connection: Connection }) => {\n      try {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { PlaceholderNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useTranslation } from 'react-i18next'\n\nexport const PlaceholderNode = memo((props: PlaceholderNodeProps) => {\n  const { id, data, isConnectable } = props\n  const { t } = useTranslation('flows')\n\n  useConnectionToHandler(id)\n\n  let placeholder = ''\n  switch (data.entity?.placeholder_type) {\n    case 'VECTOR_DATABASE_RETREIVER':\n      placeholder = t('placeholder_node.vector_database_retriever')\n      break\n  }\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <Alert className=\"flex justify-center max-w-80\" variant=\"default\">\n        <NodeHeader id={id} />\n        <LazyIcon name={'land-plot'} className=\"w-7 h-7\" />\n        <div className=\"ml-2 pr-4\">\n          <AlertTitle>{`${data.entity?.placeholder || ''}`}</AlertTitle>\n          <AlertDescription>\n            {placeholder ? <Badge>{placeholder}</Badge> : undefined}\n          </AlertDescription>\n        </div>\n      </Alert>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import type { FileSystemTree } from '@webcontainer/api'\n\nexport const SOURCE_BASES = [\n  'empty-source',\n  'vite-vue',\n  'shadcn-react-vite',\n  'todo-app-react-vite',\n  'porfolio-nextjs',\n] as const\n\nexport const getSourceBase = async (sourceBase: string): Promise<FileSystemTree> => {\n  switch (sourceBase) {\n    case 'empty-source':\n      return import('./empty-source').then((module) => module.BASE)\n    case 'vite-vue':\n      return import('./vite-vue').then((module) => module.BASE)\n    case 'shadcn-react-vite':\n      return import('./shadcn-react-vite').then((module) => module.BASE)\n    case 'todo-app-react-vite':\n      return import('./todo-app-react-vite').then((module) => module.BASE)\n    case 'porfolio-nextjs':\n      return import('./porfolio-nextjs').then((module) => module.BASE)\n    default:\n      throw new Error(`Unknown source base: ${sourceBase}`)\n  }\n}\n","import { memo, useState } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\n\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { getSourceBase, SOURCE_BASES } from 'src/services/web-container/source-bases'\nimport { cn } from 'src/lib/utils'\n\nconst CreateSourcebaseCard = memo(\n  ({\n    className,\n    onUpdateSourceBase,\n  }: {\n    className?: string\n    onUpdateSourceBase: (data: Awaited<ReturnType<typeof getSourceBase>>) => void\n  }) => {\n    const { t } = useTranslation('components')\n    const [sourcebase, setSourcebase] = useState<string>()\n    return (\n      <Card className={cn('mw-full', className)}>\n        <CardHeader className=\"p-4\">\n          <CardTitle>{t('add_source_base.title')}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-center w-full h-full flex-col\">\n            <Select onValueChange={(value) => setSourcebase(value)}>\n              <SelectTrigger className=\"w-full mb-4\">\n                <SelectValue placeholder={t('add_source_base.source_base_select_placeholder')} />\n              </SelectTrigger>\n              <SelectContent>\n                {SOURCE_BASES.map((key) => {\n                  return (\n                    <SelectItem key={`${key}`} value={`${key}`}>\n                      {t(`add_source_base.sourcebases.${key.toLowerCase()}`)}\n                    </SelectItem>\n                  )\n                })}\n              </SelectContent>\n            </Select>\n            <Button\n              className=\"w-full\"\n              onClick={async () =>\n                sourcebase && onUpdateSourceBase(await getSourceBase(sourcebase))\n              }\n            >\n              {t('add_source_base.update_source')}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    )\n  },\n)\n\nexport default CreateSourcebaseCard\n","import { useCallback } from 'react'\nimport { Connection, useReactFlow } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport type { FileSystemTree } from '@webcontainer/api'\nimport { parseFileSystemTreeToJSONL } from 'src/services/web-container/utils/file-tree'\nimport { DefaultNode } from 'src/utils/flow-node'\nimport { FlowNodeTypeEnum, LLMProviderEnum } from 'src/services/database/types'\nimport { AIMessage, HumanMessage, SystemMessage } from '@langchain/core/messages'\nimport { Message } from 'ai/react'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\n\ntype CreateMessageOption = {\n  onMessageUpdate?: (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => void\n  onResponseMessageCreate?: (message?: string) => void\n}\nexport const useActions = () => {\n  const { getNode, getHandleConnections } = useReactFlow()\n  const { stream } = useLLM()\n\n  const updateCodeContainerData = useCallback(async (id: string, data: FileSystemTree) => {\n    await getRepository('FlowNode').update(id, {\n      raw: parseFileSystemTreeToJSONL(data),\n    })\n  }, [])\n\n  const getLinkedConnections = useCallback(\n    (id: string) => {\n      const currentNode = getNode(id)\n      if (!currentNode) {\n        return []\n      }\n      const linkedConnections: {\n        node: DefaultNode\n        connections: Connection[]\n        connectedNodes?: DefaultNode[]\n      }[] = []\n      const connections = getHandleConnections({\n        nodeId: id,\n        type: 'target',\n      })\n      connections.forEach((connection) => {\n        const node = getNode(connection.source)\n        if (!node || node.type !== FlowNodeTypeEnum.LLM) {\n          return\n        }\n        linkedConnections.push({\n          node: node as DefaultNode,\n          connections: [connection],\n        })\n      })\n      return linkedConnections\n    },\n    [getHandleConnections, getNode],\n  )\n\n  const sendMessage = useCallback(\n    async (\n      message: string,\n      messages: Message[],\n      { onMessageUpdate, onResponseMessageCreate }: CreateMessageOption = {},\n    ) => {\n      const formatedMessages = messages.map((message) => {\n        if (message.role === 'system') {\n          return new SystemMessage(message.content)\n        }\n        if (message.role === 'user') {\n          return new HumanMessage(message.content)\n        }\n        return new AIMessage(message.content)\n      })\n\n      onResponseMessageCreate?.()\n\n      const response = await stream(\n        LLMProviderEnum.WebLLM,\n        [...formatedMessages, new HumanMessage(message)],\n        {\n          onMessageUpdate: ({ content }) => {\n            onMessageUpdate?.({\n              nodeData: {\n                loading: true,\n                content: content,\n              },\n            })\n          },\n          llm: undefined,\n        },\n      )\n\n      onMessageUpdate?.({\n        nodeData: {\n          loading: false,\n          content: response?.content,\n        },\n      })\n      return response?.content\n    },\n    [stream],\n  )\n\n  return {\n    sendMessage,\n    getLinkedConnections,\n    updateCodeContainerData,\n  }\n}\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.LLM && target?.type === FlowNodeTypeEnum.VSLiteApp) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { lazy, memo, Suspense, useCallback, useState } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport {\n  FileSystemTreeChange,\n  parseJSONLToFileSystemTree,\n  updateFileSystemTree,\n} from 'src/services/web-container/utils/file-tree'\nimport CreateSourcebaseCard from 'src/components/molecules/CreateSourcebaseCard'\nimport type { FileSystemTree } from '@webcontainer/api'\n\nimport { EditorAppNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { Message } from 'ai/react'\n\nconst VSLiteApp = lazy(() => import('src/lib/vslite/index'))\n\nexport const VSLiteAppNode = memo((props: EditorAppNodeProps) => {\n  const { id, isConnectable, data } = props\n  const [fileSystemTree, setFileSystemTree] = useState(\n    data?.flowNode?.raw ? parseJSONLToFileSystemTree(data.flowNode.raw) : undefined,\n  )\n  const { updateCodeContainerData, getLinkedConnections, sendMessage } = useActions()\n  useConnectionToHandler(id)\n\n  const handleUpdateCodeContainerData = useCallback(\n    async (tree: FileSystemTree) => {\n      if (!data?.flowNode?.id) return\n\n      await updateCodeContainerData(data?.flowNode?.id, tree)\n      setFileSystemTree(tree)\n    },\n    [data?.flowNode?.id, updateCodeContainerData],\n  )\n\n  const handleSendMessage = useCallback(\n    async (message: string, messages: Message[]) => {\n      if (!data?.flowNode?.id) return\n\n      const result = await sendMessage(message, messages)\n      return result\n    },\n    [data?.flowNode?.id, sendMessage],\n  )\n\n  const handleUpdateCodeContainerFile = useCallback(\n    async (changes: FileSystemTreeChange[]) => {\n      setFileSystemTree((prev) => {\n        const result = updateFileSystemTree(prev || {}, changes)\n        updateCodeContainerData(data?.flowNode?.id, result)\n        return result\n      })\n    },\n    [data?.flowNode?.id, updateCodeContainerData],\n  )\n\n  if (!fileSystemTree) {\n    return (\n      <div className=\"h-full flex justify-center items-center\">\n        <CreateSourcebaseCard className=\"w-64\" onUpdateSourceBase={handleUpdateCodeContainerData} />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-[1380px] h-[600px] rounded-lg border overflow-hidden shadow-sm\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"w-full h-full rounded-lg border bg-card overflow-hidden\">\n        <NodeHeader\n          id={id}\n          className=\"z-50\"\n          enableToStandalone\n          getLinkedConnections={getLinkedConnections}\n        />\n        <Suspense\n          fallback={\n            <div className=\"h-full w-full flex justify-center items-center\">\n              <LazyIcon name=\"loader-circle\" className=\"animate-spin\" />\n            </div>\n          }\n        >\n          <VSLiteApp\n            fileSystemTree={fileSystemTree}\n            onUpdateFileContent={handleUpdateCodeContainerFile}\n            sendMessage={handleSendMessage}\n          />\n        </Suspense>\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </div>\n  )\n})\n","import { FlowNodeTypeEnum } from 'src/services/database/types'\n\nimport { ToolbarNode } from './ToolboxNode'\nimport { LLMNode } from './LLMNode/LLMNode'\nimport { ThreadNode } from './ThreadNode'\nimport { MessageNode } from './MessageNode'\nimport { PromptNode } from './PromptNode'\nimport { SessionInfoNode } from './SessionInfoNode'\nimport { SchemaNode } from './SchemaNode'\nimport { CSVDataNode } from './CSVDataNode'\nimport { ToolNode } from './ToolNode'\nimport { EmbeddingNode } from './EmbeddingNode'\nimport { VectorDatabaseNode } from './VectorDatabaseNode'\nimport { JSONLDataNode } from './JSONLDataNode'\nimport { ApplicationBarNode } from './ApplicationBarNode'\nimport { ShapeNode } from './ShapeNode'\nimport { CircleNode } from './CircleNode'\nimport { TriangleNode } from './TriangleNode'\nimport { EditorAppNode } from './EditorAppNode'\nimport { PlaceholderNode } from './PlaceholderNode'\nimport { VSLiteAppNode } from './VSLiteAppNode'\n\nexport const nodeTypes = {\n  [FlowNodeTypeEnum.LLM]: LLMNode,\n  [FlowNodeTypeEnum.Toolbox]: ToolbarNode,\n  [FlowNodeTypeEnum.Thread]: ThreadNode,\n  [FlowNodeTypeEnum.Message]: MessageNode,\n  [FlowNodeTypeEnum.Prompt]: PromptNode,\n  [FlowNodeTypeEnum.SessionInfo]: SessionInfoNode,\n  [FlowNodeTypeEnum.Schema]: SchemaNode,\n  [FlowNodeTypeEnum.CSVData]: CSVDataNode,\n  [FlowNodeTypeEnum.ToolDefinition]: ToolNode,\n  [FlowNodeTypeEnum.DefaultEmbeddingModel]: EmbeddingNode,\n  [FlowNodeTypeEnum.VectorDatabase]: VectorDatabaseNode,\n  [FlowNodeTypeEnum.JSONLData]: JSONLDataNode,\n  [FlowNodeTypeEnum.ApplicationBar]: ApplicationBarNode,\n  [FlowNodeTypeEnum.Shape]: ShapeNode,\n  [FlowNodeTypeEnum.CircleShape]: CircleNode,\n  [FlowNodeTypeEnum.TriangleShape]: TriangleNode,\n  [FlowNodeTypeEnum.EditorApp]: EditorAppNode,\n  [FlowNodeTypeEnum.PlaceHolder]: PlaceholderNode,\n  [FlowNodeTypeEnum.VSLiteApp]: VSLiteAppNode,\n}\n","'use client'\n\nimport * as React from 'react'\nimport * as TogglePrimitive from '@radix-ui/react-toggle'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from 'src/lib/utils'\n\nconst toggleVariants = cva(\n  'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2',\n  {\n    variants: {\n      variant: {\n        default: 'bg-transparent',\n        outline: 'border border-input bg-transparent hover:bg-accent hover:text-accent-foreground',\n      },\n      size: {\n        default: 'h-10 px-3 min-w-10',\n        sm: 'h-9 px-2.5 min-w-9',\n        lg: 'h-11 px-5 min-w-11',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","import * as React from 'react'\nimport * as ToggleGroupPrimitive from '@radix-ui/react-toggle-group'\nimport { type VariantProps } from 'class-variance-authority'\n\nimport { cn } from 'src/lib/utils'\nimport { toggleVariants } from 'src/lib/shadcn/ui/toggle'\n\nconst ToggleGroupContext = React.createContext<VariantProps<typeof toggleVariants>>({\n  size: 'default',\n  variant: 'default',\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn('flex items-center justify-center gap-1', className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>{children}</ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","import { useEffect, useState, type Dispatch, type SetStateAction, useCallback } from 'react'\n\nimport {\n  useNodes,\n  Panel,\n  useStore,\n  useStoreApi,\n  type OnNodesChange,\n  type NodeChange,\n  type XYPosition,\n  ViewportPortal,\n  useReactFlow,\n} from '@xyflow/react'\n\nimport { ToggleGroup, ToggleGroupItem } from 'src/lib/shadcn/ui/toggle-group'\n\nexport function ViewportLogger() {\n  const viewport = useStore(\n    (s) =>\n      `x: ${s.transform[0].toFixed(2)}, y: ${s.transform[1].toFixed(2)}, zoom: ${s.transform[2].toFixed(2)}`,\n  )\n\n  return <div>{viewport}</div>\n}\n\ntype ChangeLoggerProps = {\n  color?: string\n  limit?: number\n}\n\ntype ChangeInfoProps = {\n  change: NodeChange\n}\n\nfunction ChangeInfo({ change }: ChangeInfoProps) {\n  const id = 'id' in change ? change.id : '-'\n  const { type } = change\n\n  return (\n    <div className=\"mb-3\">\n      <div>node id: {id}</div>\n      <div>\n        {type === 'add' ? JSON.stringify(change.item, null, 2) : null}\n        {type === 'dimensions'\n          ? `dimensions: ${change.dimensions?.width} × ${change.dimensions?.height}`\n          : null}\n        {type === 'position'\n          ? `position: ${change.position?.x.toFixed(1)}, ${change.position?.y.toFixed(1)}`\n          : null}\n        {type === 'remove' ? 'remove' : null}\n        {type === 'select' ? (change.selected ? 'select' : 'unselect') : null}\n      </div>\n    </div>\n  )\n}\n\nexport function ChangeLogger({ limit = 20 }: ChangeLoggerProps) {\n  const [changes, setChanges] = useState<NodeChange[]>([])\n  const store = useStoreApi()\n\n  // Memoize the callback for handling node changes\n  const handleNodeChanges: OnNodesChange = useCallback(\n    (newChanges: NodeChange[]) => {\n      setChanges((prevChanges) => [...newChanges, ...prevChanges].slice(0, limit))\n    },\n    [limit],\n  )\n\n  useEffect(() => {\n    store.setState({ onNodesChange: handleNodeChanges })\n\n    return () => store.setState({ onNodesChange: undefined })\n  }, [handleNodeChanges, store])\n\n  const NoChanges = () => <div>No Changes Triggered</div>\n\n  return (\n    <>\n      {changes.length === 0 ? (\n        <NoChanges />\n      ) : (\n        changes.map((change, index) => <ChangeInfo key={index} change={change} />)\n      )}\n    </>\n  )\n}\n\nexport function NodeInspector() {\n  const { getInternalNode } = useReactFlow()\n  const nodes = useNodes()\n\n  return (\n    <ViewportPortal>\n      <div className=\"text-secondary-foreground\">\n        {nodes.map((node) => {\n          const internalNode = getInternalNode(node.id)\n          if (!internalNode) {\n            return null\n          }\n\n          const absPosition = internalNode?.internals.positionAbsolute\n\n          return (\n            <NodeInfo\n              key={node.id}\n              id={node.id}\n              selected={!!node.selected}\n              type={node.type || 'default'}\n              position={node.position}\n              absPosition={absPosition}\n              width={node.measured?.width ?? 0}\n              height={node.measured?.height ?? 0}\n              data={node.data}\n            />\n          )\n        })}\n      </div>\n    </ViewportPortal>\n  )\n}\n\ntype NodeInfoProps = {\n  id: string\n  type: string\n  selected: boolean\n  position: XYPosition\n  absPosition: XYPosition\n  width?: number\n  height?: number\n\n  data: unknown\n}\n\nfunction NodeInfo({\n  id,\n  type,\n  selected,\n  position,\n  absPosition,\n  width,\n  height,\n  data,\n}: NodeInfoProps) {\n  if (!width || !height) return null\n\n  const absoluteTransform = `translate(${absPosition.x}px, ${absPosition.y + height}px)`\n  const formattedPosition = `${position.x.toFixed(1)}, ${position.y.toFixed(1)}`\n  const formattedDimensions = `${width} × ${height}`\n  const selectionStatus = selected ? 'Selected' : 'Not Selected'\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        transform: absoluteTransform,\n        width: width * 2,\n      }}\n      className=\"text-xs\"\n    >\n      <div>id: {id}</div>\n      <div>type: {type}</div>\n      <div>selected: {selectionStatus}</div>\n      <div>position: {formattedPosition}</div>\n      <div>dimensions: {formattedDimensions}</div>\n      <div>data: {JSON.stringify(data, null, 2)}</div>\n    </div>\n  )\n}\n\ntype Tool = {\n  active: boolean\n  setActive: Dispatch<SetStateAction<boolean>>\n  label: string\n  value: string\n}\n\ntype DevToolsToggleProps = {\n  tools: Tool[]\n}\n\nfunction DevToolsToggle({ tools }: DevToolsToggleProps) {\n  return (\n    <Panel position=\"top-left\" className=\"bg-card p-1 border rounded shadow-sm\">\n      <ToggleGroup type=\"multiple\">\n        {tools.map(({ active, setActive, label, value }) => (\n          <ToggleGroupItem\n            key={value}\n            value={value}\n            onClick={() => setActive((prev) => !prev)}\n            aria-pressed={active}\n            className=\"bg-card text-card-foreground transition-colors duration-300 hover:bg-secondary hover:text-secondary-foreground\"\n          >\n            {label}\n          </ToggleGroupItem>\n        ))}\n      </ToggleGroup>\n    </Panel>\n  )\n}\n\nexport function DevTools() {\n  const [nodeInspectorActive, setNodeInspectorActive] = useState(false)\n  const [changeLoggerActive, setChangeLoggerActive] = useState(false)\n  const [viewportLoggerActive, setViewportLoggerActive] = useState(false)\n\n  const tools = [\n    {\n      active: nodeInspectorActive,\n      setActive: setNodeInspectorActive,\n      label: 'Node Inspector',\n      value: 'node-inspector',\n    },\n    {\n      active: changeLoggerActive,\n      setActive: setChangeLoggerActive,\n      label: 'Change Logger',\n      value: 'change-logger',\n    },\n    {\n      active: viewportLoggerActive,\n      setActive: setViewportLoggerActive,\n      label: 'Viewport Logger',\n      value: 'viewport-logger',\n    },\n  ]\n\n  return (\n    <>\n      <DevToolsToggle tools={tools} />\n\n      {changeLoggerActive && (\n        <Panel\n          className=\"text-xs p-5 bg-white rounded shadow-md overflow-y-auto max-h-[50%] mt-20\"\n          position=\"bottom-right\"\n        >\n          <ChangeLogger />\n        </Panel>\n      )}\n\n      {nodeInspectorActive && <NodeInspector />}\n\n      {viewportLoggerActive && (\n        <Panel position=\"bottom-left\" className=\"text-secondary-foreground\">\n          <ViewportLogger />\n        </Panel>\n      )}\n    </>\n  )\n}\n\nDevTools.displayName = 'DevTools'\n","import { useCallback, useRef, useState } from 'react'\nimport deepmerge from 'deepmerge'\nimport { applyNodeChanges, Connection, Edge, EdgeChange, Node, NodeChange } from '@xyflow/react'\nimport { FlowNode, FlowNodeTypeEnum } from 'src/services/database/types'\nimport { In, type FindManyOptions } from 'src/services/database/typeorm-wrapper'\nimport { useFlowState } from 'src/states/flow'\nimport { DISABLED_DELETE_NODE_TYPES, SYSTEM_NODE_IDS } from 'src/constants/nodes'\nimport { useSessionState } from 'src/states/session'\n\nexport const useFlowManager = () => {\n  const updatePositionRef = useRef<Record<string, number | undefined>>({})\n  const updateDimensionsRef = useRef<Record<string, number>>({})\n  const onNodesChangesRef = useRef<\n    ((changes: NodeChange<Node>[]) => Promise<boolean | void | undefined>)[]\n  >([])\n\n  const flowEdges = useFlowState((state) => state.flowEdges)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const setNodes = useFlowState((state) => state.setNodes)\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const updateEdges = useFlowState((state) => state.updateEdges)\n  const addConnectionToEdges = useFlowState((state) => state.addConnectionToEdges)\n\n  const resetFlows = useFlowState((state) => state.reset)\n  const findFlowEdges = useFlowState((state) => state.findFlowEdges)\n  const deleteFlowNode = useFlowState((state) => state.deleteFlowNode)\n  const deleteFlowEdge = useFlowState((state) => state.deleteFlowEdge)\n  const updateFlowNode = useFlowState((state) => state.updateFlowNode)\n  const getNodes = useFlowState((state) => state.getNodes)\n  const findFlowNodesWithSource = useFlowState((state) => state.findFlowNodesWithSource)\n\n  const flowEdgesRef = useRef(flowEdges)\n  const currentSessionIdRef = useRef<string | null>()\n  const [loadingState, setLoadingState] = useState({ loading: false })\n\n  flowEdgesRef.current = flowEdges\n\n  const initFlow = useCallback(\n    async (currentSessionId: string, func?: () => Promise<void>) => {\n      try {\n        currentSessionIdRef.current = currentSessionId\n        resetFlows()\n        await func?.()\n      } catch {\n        currentSessionIdRef.current = undefined\n      }\n    },\n    [resetFlows],\n  )\n\n  const prepareFlowInfo = useCallback(\n    async (query: FindManyOptions<FlowNode>) => {\n      try {\n        if (!currentSession?.id) {\n          return\n        }\n        setLoadingState((loading) => ({ ...loading, loading: true }))\n        const flowNodes = await findFlowNodesWithSource({\n          ...query,\n          where: {\n            ...query.where,\n            session_id: currentSession.id,\n          },\n        })\n        const flowEdges = await findFlowEdges({\n          where: [\n            { source: In(flowNodes.map((node) => node.id)) },\n            { target: In(flowNodes.map((node) => node.id)) },\n          ],\n        })\n        return {\n          flowNodes,\n          flowEdges,\n        }\n      } finally {\n        setLoadingState((loading) => ({ ...loading, loading: false }))\n      }\n    },\n    [findFlowNodesWithSource, findFlowEdges, currentSession?.id],\n  )\n\n  const updateNodeChanges = useCallback(\n    async (changes: NodeChange<Node>[]) => {\n      for (const handler of onNodesChangesRef.current) {\n        const result = await handler(changes)\n        if (typeof result === 'boolean' && !result) {\n          return\n        }\n      }\n      for (const change of changes) {\n        if (\n          'id' in change &&\n          Object.values(SYSTEM_NODE_IDS).includes(change.id) &&\n          change.type !== 'remove'\n        ) {\n          updateNodes([change])\n        } else if (\n          change.type === 'position' &&\n          change.position &&\n          !isNaN(change.position.x) &&\n          !isNaN(change.position.y)\n        ) {\n          updateNodes([change])\n\n          const x = change.position.x\n          const y = change.position.y\n          clearTimeout(updatePositionRef.current[change.id])\n          updatePositionRef.current[change.id] = setTimeout(async () => {\n            updatePositionRef.current[change.id] = undefined\n            await updateFlowNode(\n              {\n                id: change.id,\n                x,\n                y,\n              },\n              { silent: true },\n            )\n          }, 200) as unknown as number\n        } else if (change.type === 'remove') {\n          // DISABLED: delete node\n          const node = getNodes([change.id])?.[0]\n          if (!node?.type || DISABLED_DELETE_NODE_TYPES.includes(node.type as FlowNodeTypeEnum)) {\n            return\n          }\n          await deleteFlowNode({ id: change.id })\n        } else if (\n          change.type === 'dimensions' &&\n          change.dimensions &&\n          !isNaN(change.dimensions.width) &&\n          !isNaN(change.dimensions.height)\n        ) {\n          const node = getNodes([change.id])?.[0]\n          if (!node?.width && !node?.height) {\n            return\n          }\n          updateNodes([change])\n\n          clearTimeout(updateDimensionsRef.current[change.id])\n          const width = change.dimensions.width\n          const height = change.dimensions.height\n          updateDimensionsRef.current[change.id] = setTimeout(async () => {\n            await updateFlowNode(\n              {\n                id: change.id,\n                width,\n                height,\n              },\n              { silent: true },\n            )\n          }, 200) as unknown as number\n        } else if (change.type === 'select') {\n          updateNodes([change])\n        }\n      }\n    },\n    [updateNodes, updateFlowNode, getNodes, deleteFlowNode],\n  )\n\n  const updateEdgeChanges = useCallback(\n    (changes: EdgeChange<Edge>[]) => {\n      Promise.all(\n        changes.map(async (change) => {\n          if (change.type === 'remove') {\n            return deleteFlowEdge({ id: change.id })\n          }\n        }),\n      )\n      updateEdges(changes)\n    },\n    [deleteFlowEdge, updateEdges],\n  )\n\n  const updateEdgeConnection = useCallback(\n    (connection: Connection) => {\n      addConnectionToEdges(connection)\n    },\n    [addConnectionToEdges],\n  )\n\n  const updateOrCreateNode = useCallback(\n    (input: Node | ((node: Node[]) => Node | undefined)) => {\n      setNodes((nodes) => {\n        let updatingNode\n        if (typeof input === 'function') {\n          updatingNode = input(nodes)\n        } else {\n          updatingNode = input\n        }\n        if (!updatingNode) {\n          return nodes\n        }\n        const node = nodes?.find((n) => n.id === updatingNode.id)\n        const change: NodeChange<Node> = {\n          id: updatingNode.id,\n          item: node\n            ? deepmerge(node, updatingNode)\n            : {\n                ...updatingNode,\n                position: {\n                  x: updatingNode.position?.x || 0,\n                  y: updatingNode.position?.y || 0,\n                },\n              },\n          type: node ? 'replace' : 'add',\n        }\n        return applyNodeChanges([change], nodes)\n      })\n    },\n    [setNodes],\n  )\n\n  const addOnNodeChangeHandler = useCallback(\n    (func: (changes: NodeChange<Node>[]) => Promise<boolean | void | undefined>) => {\n      onNodesChangesRef.current.push(func)\n      return () => {\n        onNodesChangesRef.current = onNodesChangesRef.current.filter((handler) => handler !== func)\n      }\n    },\n    [],\n  )\n\n  return {\n    initFlow,\n    loadingState,\n    prepareFlowInfo,\n    updateNodeChanges,\n    updateEdgeChanges,\n    updateOrCreateNode,\n    currentSessionIdRef,\n    updateEdgeConnection,\n    addOnNodeChangeHandler,\n  }\n}\n","import { useEffect, useRef } from 'react'\nimport { useFlowManager } from 'src/hooks/flows/handlers/use-flow-manager'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useAutomaticallyRenderFlows = (flowManager: ReturnType<typeof useFlowManager>) => {\n  const currentSessionId = useSessionState((state) => state.currentSession?.id)\n  const { loadingState, prepareFlowInfo, initFlow, currentSessionIdRef } = flowManager\n\n  const flowStateReady = useFlowState((state) => state.ready)\n  const nodes = useFlowState((state) => state.nodes)\n\n  const flowNodesRef = useRef(nodes)\n  const removeSyncNodeQueue = useFlowState((state) => state.removeSyncNodeQueue)\n  const removeSyncEdgeQueue = useFlowState((state) => state.removeSyncEdgeQueue)\n  flowNodesRef.current = nodes\n\n  useEffect(() => {\n    if (\n      loadingState.loading ||\n      !flowStateReady ||\n      !currentSessionId ||\n      currentSessionIdRef.current === currentSessionId\n    ) {\n      return\n    }\n    initFlow(currentSessionId, async () => {\n      await prepareFlowInfo({\n        where: {\n          session_id: currentSessionId,\n        },\n      })\n    })\n  }, [\n    initFlow,\n    prepareFlowInfo,\n    loadingState.loading,\n    currentSessionIdRef,\n    flowStateReady,\n    currentSessionId,\n  ])\n\n  useEffect(() => {\n    const unsubNodeHandler = useFlowState.subscribe(\n      (state) => state.syncNodeQueue,\n      async (syncNodeQueue, previousSyncNodeQueue) => {\n        const lastTimestamps = previousSyncNodeQueue.map((node) => node.timestamp)\n        const handlingQueueItems = syncNodeQueue.filter(\n          (item) => !lastTimestamps.includes(item.timestamp),\n        )\n        if (handlingQueueItems.length) {\n          removeSyncNodeQueue(handlingQueueItems.map((item) => item.timestamp))\n        }\n      },\n    )\n    const unsubEdgeHandler = useFlowState.subscribe(\n      (state) => state.syncEdgeQueue,\n      async (syncEdgeQueue, previousSyncEdgeQueue) => {\n        const lastTimestamps = previousSyncEdgeQueue.map((node) => node.timestamp)\n        const handlingQueueItems = syncEdgeQueue.filter(\n          (item) => !lastTimestamps.includes(item.timestamp),\n        )\n        if (handlingQueueItems.length) {\n          removeSyncEdgeQueue(handlingQueueItems.map((item) => item.timestamp))\n        }\n      },\n    )\n\n    return () => {\n      unsubNodeHandler()\n      unsubEdgeHandler()\n    }\n  }, [prepareFlowInfo, removeSyncEdgeQueue, removeSyncNodeQueue])\n}\n","import { useEffect, useMemo, useRef, useState } from 'react'\nimport { LLMStatusEnum } from 'src/services/database/types/llm'\nimport { useFlowManager } from 'src/hooks/flows/handlers/use-flow-manager'\n\nimport { useAutomaticallyRenderFlows } from 'src/hooks/flows/handlers/use-automatically-render-flow'\nimport { useLocalLLMState } from 'src/services/local-llm'\n\nexport const useHomePage = () => {\n  const [initializing, setInitializing] = useState(true)\n  const flowManager = useFlowManager()\n  const selectedModel = useLocalLLMState((state) => state.selectedModel)\n  const selectedModelRef = useRef(selectedModel)\n  const setInitProgressCallback = useLocalLLMState((state) => state.setInitProgressCallback)\n  const { updateOrCreateNode, updateNodeChanges, updateEdgeChanges, updateEdgeConnection } =\n    flowManager\n  useAutomaticallyRenderFlows(flowManager)\n\n  selectedModelRef.current = selectedModel\n\n  useEffect(() => {\n    const callbackRemoval = setInitProgressCallback?.((input) => {\n      if (!selectedModelRef.current) {\n        return\n      }\n      const modelName = `${selectedModelRef.current}`\n      updateOrCreateNode((nodeRefs) => {\n        const flowNode = nodeRefs?.find((node) => {\n          if (\n            node.data?.entity &&\n            typeof node.data.entity === 'object' &&\n            'name' in node.data.entity\n          ) {\n            return node.data.entity.name === modelName\n          }\n          return false\n        })\n        if (!flowNode) return\n\n        flowNode.data.label = input.text\n        flowNode.data.status = LLMStatusEnum.Loading\n        if (input.progress === 100) {\n          flowNode.data.label = ``\n          flowNode.data.status = LLMStatusEnum.Loaded\n        }\n\n        return flowNode\n      })\n    })\n\n    return () => {\n      callbackRemoval?.()\n    }\n  }, [setInitProgressCallback, updateOrCreateNode])\n\n  const contextValue = useMemo(\n    () => ({\n      updateNodeChanges,\n      updateEdgeChanges,\n      initializing,\n      setInitializing,\n      updateEdgeConnection,\n    }),\n    [updateNodeChanges, updateEdgeChanges, initializing, setInitializing, updateEdgeConnection],\n  )\n\n  return contextValue\n}\n","import { memo, useCallback } from 'react'\nimport {\n  ReactFlow,\n  MiniMap,\n  Controls,\n  Background,\n  BackgroundVariant,\n  Node,\n  NodeChange,\n  Edge,\n  EdgeChange,\n  Connection,\n  PanOnScrollMode,\n} from '@xyflow/react'\nimport { nodeTypes } from 'src/components/flows/Nodes'\nimport { useFlowState } from 'src/states/flow'\nimport { useAppState } from 'src/states/app'\nimport { DevTools } from 'src/lib/shadcn/devtools'\nimport { isDev } from 'src/constants/dev'\nimport { useHomePage } from './hooks/use-home-page'\n\nconst HomeInner = () => {\n  const theme = useAppState((state) => state.theme)\n  const nodes = useFlowState((state) => state.nodes)\n  const edges = useFlowState((state) => state.edges)\n  const { updateNodeChanges, updateEdgeChanges, updateEdgeConnection } = useHomePage()\n\n  const onNodesChange = useCallback(\n    (changes: NodeChange<Node>[]) => {\n      updateNodeChanges(changes)\n    },\n    [updateNodeChanges],\n  )\n\n  const onEdgesChange = useCallback(\n    (changes: EdgeChange<Edge>[]) => {\n      updateEdgeChanges(changes)\n    },\n    [updateEdgeChanges],\n  )\n\n  const onConnect = useCallback(\n    (connection: Connection) => {\n      updateEdgeConnection(connection)\n    },\n    [updateEdgeConnection],\n  )\n\n  return (\n    <ReactFlow\n      nodes={nodes}\n      edges={edges}\n      nodeTypes={nodeTypes}\n      onNodesChange={onNodesChange}\n      onEdgesChange={onEdgesChange}\n      onConnect={onConnect}\n      panOnScroll\n      panOnScrollMode={PanOnScrollMode.Free}\n      colorMode={theme}\n      fitView\n    >\n      <Background variant={BackgroundVariant.Dots} gap={24} size={1} />\n      <Controls />\n      <MiniMap />\n      {isDev ? <DevTools /> : undefined}\n    </ReactFlow>\n  )\n}\n\nexport default memo(HomeInner)\n"],"file":"assets/Home-KS1yAoZg.js"}