const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DYRICXF3.js","assets/LLMIcon-CUYaTADE.js","assets/index-8-pJaDMF.js","assets/index-B2Kz5wtG.css","assets/routes-u3SNg5Jg.js","assets/dot-DA86Xfyx.js","assets/createLucideIcon-BjNtZP9Y.js","assets/file-tree-C9uE9TJK.js","assets/pdf.min-BsZY-3z9.js","assets/pdf.worker.min-C-VRZ2BQ.js","assets/index-9jyfFUfd.js","assets/index-BxLP9ldF.js","assets/toNumber-Dhkog0VQ.js","assets/index-CQfOAXIj.js","assets/index-DQzMhCjN.js","assets/index-D95kcCxR.js","assets/index-B7J2WeK0.js","assets/link-Cn47cq0W.js","assets/trash-2-_EFJAz3K.js","assets/index-B4pmjXxc.js","assets/text-67fZR8OK.js","assets/external-link-HBKMEz4B.js","assets/unlink-PobCnz9f.js","assets/list-oBY-w9lN.js","assets/list-ordered-LOqhoJEk.js","assets/list-todo-Dunj1k4J.js","assets/indent-increase-Dnhi9pQ3.js","assets/pilcrow-Do_KUhdn.js","assets/heading-1-CSv5LVPt.js","assets/heading-2-DhNnh10B.js","assets/heading-3-CwINcHBr.js","assets/table-DeUKhiAh.js","assets/file-code-CCTBUHDv.js","assets/quote-KnnrUp7j.js","assets/minus-BqHz6fLn.js","assets/square-DNvRYTj-.js","assets/chevron-right-BPVHu3y5.js","assets/image-4D1a0S38.js","assets/table-of-contents-BM3CY1Gl.js","assets/columns-3-D11LTyM6.js","assets/link-2-Cytd9SRK.js","assets/calendar-BuGlqpuZ.js","assets/plus-DBox_a8v.js","assets/wrap-text-DWp5_3JR.js","assets/index-BY5y6-oJ.js","assets/eye-DcB6LpHD.js","assets/pen-_ia7m8tu.js","assets/indent-decrease-CkcPeHA2.js","assets/pointer-B_ytWyIe.js","assets/wand-sparkles-DTZx1snf.js","assets/bold-wWMNBHTt.js","assets/italic-D-1u3ymm.js","assets/underline-C57kXT12.js","assets/strikethrough-B5euLFtJ.js","assets/code-xml-C0t45vJc.js","assets/baseline-CmQAsWYG.js","assets/paint-bucket-DNB_Dd_j.js","assets/arrow-up-to-line-DLlmvNDu.js","assets/index-BCYu3EnN.css","assets/index-B8gu1rAU.js","assets/check-CJbr5D_B.js","assets/circle-BZm5rTYk.js","assets/popover-O6xj8nF7.js","assets/index-BI4fBi-W.css"])))=>i.map(i=>d[i]);
import{f as Ln,Y as $w,r as b,M as $h,i as Oh,Z as Rh,$ as Ow,a0 as Ih,a1 as Rw,a2 as Iw,a3 as Tw,a4 as oo,a as Aw,j as c,l as Lw,J as Fw,n as tr,u as Dw,b as lr,c as Me,L as _e,T as Mw,a5 as zw,U as Uw,w as Fn,x as Er,d as Te,e as Pt,_ as Rt,a6 as Dn,a7 as ca,I as Hw,R as za,v as Th,a8 as Vw,A as Ah,X as qw,m as Lh,q as Fh,a9 as Zw,g as lo,H as Mr,B as Dh,aa as co,ab as uo,ac as Mh,ad as Bw,__tla as Ww}from"./index-8-pJaDMF.js";import{j as Kw,k as Qw,l as mt,R as zh,L as Mn,A as It,m as Gw,C as it,n as ft,o as xt,p as vt,S as cr,q as dr,s as ur,t as hr,v as Nt,w as Sr,x as Jw,y as Xw,z as Yw,E as ex,G as Uh,H as Hh,J as zn,K as ho,N as Vh,O as po,M as da,Q as Zt,U as tx,X as He,Y as Un,Z as rx,_ as pr,$ as ua,h as ax,a0 as qh,u as mo,F as Ua,P as nx,a1 as Zh,a2 as Bh,i as zr,a3 as sx,a4 as ix,d as Wh,e as Kh,g as ha,T as pa,D as fo,a5 as Qh,a6 as Hn,a as Gh,W as ox,I as lx,b as cx,V as dx,a7 as ux,a8 as vo,a9 as hx,aa as px,ab as mx,ac as fx,ad as vx,ae as gx,af as yx,ag as _x,ah as bx,ai as wx,aj as xx,ak as jx,__tla as Ex}from"./chunk-Cxe1YmVi.js";import{aC as Jh,aD as Sx,aE as go,aF as kx,aG as Cx,aH as Xh,aI as Px,aJ as Nx,aK as $x,aL as Yh,a6 as mr,aM as Ox,aN as Rx,m as Ix,l as ep,n as Tx,I as Ax,aO as Lx,aP as Fx,aQ as Dx,aR as Mx,aS as zx,aT as Ux,aU as Hx,aV as Vx,aW as qx,aX as Zx,aY as Bx,aZ as Wx,a_ as Kx,a$ as Qx,u as rt,g as he,F as Q,R as Gx,P as Jx,O as Xx,C as Yx,r as Vn,s as qn,t as Zn,v as Bn,b0 as tp,b1 as rp,B as We,ah as Wn,b2 as Ha,aj as je,ak as ht,L as rr,b3 as yo,b4 as e1,b5 as ap,V as kr,b6 as t1,b7 as r1,b8 as Va,b9 as qa,ba as Za,az as a1,bb as n1,bc as s1,aA as i1,aB as o1,A as Kn,H as ma,bd as np,S as sp,be as _o,q as bo,bf as wo,ab as l1,o as ip,e as c1,f as op,h as lp,i as cp,aw as dp,aa as fr,p as Ne,bg as Qn,__tla as d1}from"./routes-u3SNg5Jg.js";import{k as xo,B as u1,l as Gn,j as $e,L as jt,m as h1,n as up,o as fa,q as p1,r as m1,s as hp,b as f1,h as pp,c as vr,t as v1,a as g1,I as jo,u as Eo,v as y1,d as _1,i as b1,z as y,x as va,Z as Re,__tla as w1}from"./LLMIcon-CUYaTADE.js";import{P as Jn,b as Xn,T as Ba,A as x1,a as j1,__tla as E1}from"./popover-O6xj8nF7.js";import{a as So,__tla as S1}from"./index-B7J2WeK0.js";import{s as k1,R as mp,I as C1,S as fp,r as ko,a as vp,b as gp,c as yp,__tla as P1}from"./index-BxLP9ldF.js";import{p as N1,S as $1}from"./plate-editor-DeEZx9uS.js";import{p as O1,a as R1,u as I1,__tla as T1}from"./file-tree-C9uE9TJK.js";import"./toNumber-Dhkog0VQ.js";import"./dot-DA86Xfyx.js";import"./createLucideIcon-BjNtZP9Y.js";let _p,A1=Promise.all([(()=>{try{return Ww}catch{}})(),(()=>{try{return Ex}catch{}})(),(()=>{try{return d1}catch{}})(),(()=>{try{return w1}catch{}})(),(()=>{try{return E1}catch{}})(),(()=>{try{return S1}catch{}})(),(()=>{try{return P1}catch{}})(),(()=>{try{return T1}catch{}})()]).then(async()=>{function Yn(e){const r=Ln(()=>$w(e)),{isStatic:a}=b.useContext($h);if(a){const[,t]=b.useState(e);b.useEffect(()=>r.on("change",t),[])}return r}function Co(e,r){const a=Yn(r()),t=()=>a.set(r());return t(),Oh(()=>{const n=()=>Rh.preRender(t,!1,!0),i=e.map(s=>s.on("change",n));return()=>{i.forEach(s=>s()),Ow(t)}}),a}function bp(e,r={}){const{isStatic:a}=b.useContext($h),t=b.useRef(null),n=Ln(()=>Ih(e)?e.get():e),i=Ln(()=>typeof n=="string"?n.replace(/[\d.-]/g,""):void 0),s=Yn(n),o=b.useRef(n),l=b.useRef(Rw),u=()=>{d(),t.current=Iw({keyframes:[No(s.get()),No(o.current)],velocity:s.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...r,onUpdate:l.current})},d=()=>{t.current&&t.current.stop()};return b.useInsertionEffect(()=>s.attach((p,h)=>a?h(p):(o.current=p,l.current=v=>h(Po(v,i)),Rh.postRender(u),s.get()),d),[JSON.stringify(r)]),Oh(()=>{if(Ih(e))return e.on("change",p=>s.set(Po(p,i)))},[s,i]),s}function Po(e,r){return r?e+r:e}function No(e){return typeof e=="number"?e:parseFloat(e)}const wp=e=>e&&typeof e=="object"&&e.mix,xp=e=>wp(e)?e.mix:void 0;function jp(...e){const r=!Array.isArray(e[0]),a=r?0:-1,t=e[0+a],n=e[1+a],i=e[2+a],s=e[3+a],o=Tw(n,i,{mixer:xp(i[0]),...s});return r?o(t):o}function Ep(e){oo.current=[],e();const r=Co(oo.current,e);return oo.current=void 0,r}function $o(e,r,a,t){if(typeof e=="function")return Ep(e);const n=typeof r=="function"?r:jp(r,a,t);return Array.isArray(e)?Oo(e,n):Oo([e],([i])=>n(i))}function Oo(e,r){const a=Ln(()=>[]);return Co(e,()=>{a.length=0;const t=e.length;for(let n=0;n<t;n++)a[n]=e[n].get();return r(a)})}var Mt=(e=>(e.Started="started",e.Inprogress="inprogress",e.Success="success",e.Failed="failed",e))(Mt||{}),$t=(e=>(e.Human="human",e.User="user",e.AI="ai",e.System="system",e.Assistant="assistant",e.Tool="tool",e.FewShotExample="few_shot_example",e))($t||{}),Wa=(e=>(e.Started="started",e.Inprogress="inprogress",e.Done="done",e))(Wa||{}),Ot=(e=>(e.Chat="chat",e.FewShotExample="few_shot_example",e))(Ot||{});function zt(e){return encodeURI(Sp(e))}function Sp(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}const kp={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},Cp={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},Pp={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let Np=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function ga(e,r=Object.create(null),a=Np,t=""){if(e&&typeof e=="object"&&!Array.isArray(e)){const i=e.$id||e.id;if(i){const s=new URL(i,a.href);s.hash.length>1?r[s.href]=e:(s.hash="",t===""?a=s:ga(e,r,a))}}else if(e!==!0&&e!==!1)return r;const n=a.href+(t?"#"+t:"");if(r[n]!==void 0)throw new Error(`Duplicate schema URI "${n}".`);if(r[n]=e,e===!0||e===!1)return r;if(e.__absolute_uri__===void 0&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:n}),e.$ref&&e.__absolute_ref__===void 0){const i=new URL(e.$ref,a.href);i.hash=i.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:i.href})}if(e.$recursiveRef&&e.__absolute_recursive_ref__===void 0){const i=new URL(e.$recursiveRef,a.href);i.hash=i.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(e.$anchor){const i=new URL("#"+e.$anchor,a.href);r[i.href]=e}for(let i in e){if(Pp[i])continue;const s=`${t}/${zt(i)}`,o=e[i];if(Array.isArray(o)){if(kp[i]){const l=o.length;for(let u=0;u<l;u++)ga(o[u],r,a,`${s}/${u}`)}}else if(Cp[i])for(let l in o)ga(o[l],r,a,`${s}/${zt(l)}`);else ga(o,r,a,s)}return r}const $p=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Op=[0,31,28,31,30,31,30,31,31,30,31,30,31],Rp=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Ip=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Tp=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Ap=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Lp=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Fp=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,Dp=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Mp=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,zp=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,Up=e=>{if(e[0]==='"')return!1;const[r,a,...t]=e.split("@");return!r||!a||t.length!==0||r.length>64||a.length>253||r[0]==="."||r.endsWith(".")||r.includes("..")||!/^[a-z0-9.-]+$/i.test(a)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(r)?!1:a.split(".").every(n=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(n))},Hp=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Vp=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,qp=e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e));function Bt(e){return e.test.bind(e)}const Ro={date:Io,time:To.bind(void 0,!1),"date-time":Wp,duration:qp,uri:Gp,"uri-reference":Bt(Tp),"uri-template":Bt(Ap),url:Bt(Lp),email:Up,hostname:Bt(Ip),ipv4:Bt(Hp),ipv6:Bt(Vp),regex:Xp,uuid:Bt(Fp),"json-pointer":Bt(Dp),"json-pointer-uri-fragment":Bt(Mp),"relative-json-pointer":Bt(zp)};function Zp(e){return e%4===0&&(e%100!==0||e%400===0)}function Io(e){const r=e.match($p);if(!r)return!1;const a=+r[1],t=+r[2],n=+r[3];return t>=1&&t<=12&&n>=1&&n<=(t==2&&Zp(a)?29:Op[t])}function To(e,r){const a=r.match(Rp);if(!a)return!1;const t=+a[1],n=+a[2],i=+a[3],s=!!a[5];return(t<=23&&n<=59&&i<=59||t==23&&n==59&&i==60)&&(!e||s)}const Bp=/t|\s/i;function Wp(e){const r=e.split(Bp);return r.length==2&&Io(r[0])&&To(!0,r[1])}const Kp=/\/|:/,Qp=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Gp(e){return Kp.test(e)&&Qp.test(e)}const Jp=/[^\\]\\Z/;function Xp(e){if(Jp.test(e))return!1;try{return new RegExp(e,"u"),!0}catch{return!1}}function Yp(e){let r=0,a=e.length,t=0,n;for(;t<a;)r++,n=e.charCodeAt(t++),n>=55296&&n<=56319&&t<a&&(n=e.charCodeAt(t),(n&64512)==56320&&t++);return r}function Ye(e,r,a="2019-09",t=ga(r),n=!0,i=null,s="#",o="#",l=Object.create(null)){if(r===!0)return{valid:!0,errors:[]};if(r===!1)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};const u=typeof e;let d;switch(u){case"boolean":case"number":case"string":d=u;break;case"object":e===null?d="null":Array.isArray(e)?d="array":d="object";break;default:throw new Error(`Instances of "${u}" type are not supported.`)}const{$ref:p,$recursiveRef:h,$recursiveAnchor:v,type:f,const:m,enum:g,required:w,not:S,anyOf:O,allOf:x,oneOf:E,if:$,then:N,else:T,format:D,properties:A,patternProperties:R,additionalProperties:z,unevaluatedProperties:U,minProperties:M,maxProperties:q,propertyNames:J,dependentRequired:Y,dependentSchemas:se,dependencies:oe,prefixItems:Se,items:Ce,additionalItems:Z,unevaluatedItems:re,contains:ue,minContains:ee,maxContains:_,minItems:C,maxItems:F,uniqueItems:W,minimum:H,maximum:j,exclusiveMinimum:k,exclusiveMaximum:V,multipleOf:G,minLength:we,maxLength:ce,pattern:me,__absolute_ref__:Ae,__absolute_recursive_ref__:ct}=r,ae=[];if(v===!0&&i===null&&(i=r),h==="#"){const de=i===null?t[ct]:i,te=`${o}/$recursiveRef`,Ee=Ye(e,i===null?r:i,a,t,n,de,s,te,l);Ee.valid||ae.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:te,error:"A subschema had errors."},...Ee.errors)}if(p!==void 0){const de=t[Ae||p];if(de===void 0){let ie=`Unresolved $ref "${p}".`;throw Ae&&Ae!==p&&(ie+=`  Absolute URI "${Ae}".`),ie+=`
Known schemas:
- ${Object.keys(t).join(`
- `)}`,new Error(ie)}const te=`${o}/$ref`,Ee=Ye(e,de,a,t,n,i,s,te,l);if(Ee.valid||ae.push({instanceLocation:s,keyword:"$ref",keywordLocation:te,error:"A subschema had errors."},...Ee.errors),a==="4"||a==="7")return{valid:ae.length===0,errors:ae}}if(Array.isArray(f)){let de=f.length,te=!1;for(let Ee=0;Ee<de;Ee++)if(d===f[Ee]||f[Ee]==="integer"&&d==="number"&&e%1===0&&e===e){te=!0;break}te||ae.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${f.join('", "')}".`})}else f==="integer"?(d!=="number"||e%1||e!==e)&&ae.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${f}".`}):f!==void 0&&d!==f&&ae.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${f}".`});if(m!==void 0&&(d==="object"||d==="array"?xo(e,m)||ae.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):e!==m&&ae.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),g!==void 0&&(d==="object"||d==="array"?g.some(de=>xo(e,de))||ae.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(de=>e===de)||ae.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),S!==void 0){const de=`${o}/not`;Ye(e,S,a,t,n,i,s,de).valid&&ae.push({instanceLocation:s,keyword:"not",keywordLocation:de,error:'Instance matched "not" schema.'})}let qe=[];if(O!==void 0){const de=`${o}/anyOf`,te=ae.length;let Ee=!1;for(let ie=0;ie<O.length;ie++){const ne=O[ie],ye=Object.create(l),ge=Ye(e,ne,a,t,n,v===!0?i:null,s,`${de}/${ie}`,ye);ae.push(...ge.errors),Ee=Ee||ge.valid,ge.valid&&qe.push(ye)}Ee?ae.length=te:ae.splice(te,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:de,error:"Instance does not match any subschemas."})}if(x!==void 0){const de=`${o}/allOf`,te=ae.length;let Ee=!0;for(let ie=0;ie<x.length;ie++){const ne=x[ie],ye=Object.create(l),ge=Ye(e,ne,a,t,n,v===!0?i:null,s,`${de}/${ie}`,ye);ae.push(...ge.errors),Ee=Ee&&ge.valid,ge.valid&&qe.push(ye)}Ee?ae.length=te:ae.splice(te,0,{instanceLocation:s,keyword:"allOf",keywordLocation:de,error:"Instance does not match every subschema."})}if(E!==void 0){const de=`${o}/oneOf`,te=ae.length,Ee=E.filter((ie,ne)=>{const ye=Object.create(l),ge=Ye(e,ie,a,t,n,v===!0?i:null,s,`${de}/${ne}`,ye);return ae.push(...ge.errors),ge.valid&&qe.push(ye),ge.valid}).length;Ee===1?ae.length=te:ae.splice(te,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:de,error:`Instance does not match exactly one subschema (${Ee} matches).`})}if((d==="object"||d==="array")&&Object.assign(l,...qe),$!==void 0){const de=`${o}/if`;if(Ye(e,$,a,t,n,i,s,de,l).valid){if(N!==void 0){const te=Ye(e,N,a,t,n,i,s,`${o}/then`,l);te.valid||ae.push({instanceLocation:s,keyword:"if",keywordLocation:de,error:'Instance does not match "then" schema.'},...te.errors)}}else if(T!==void 0){const te=Ye(e,T,a,t,n,i,s,`${o}/else`,l);te.valid||ae.push({instanceLocation:s,keyword:"if",keywordLocation:de,error:'Instance does not match "else" schema.'},...te.errors)}}if(d==="object"){if(w!==void 0)for(const ie of w)ie in e||ae.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${ie}".`});const de=Object.keys(e);if(M!==void 0&&de.length<M&&ae.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${M} properties.`}),q!==void 0&&de.length>q&&ae.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${q} properties.`}),J!==void 0){const ie=`${o}/propertyNames`;for(const ne in e){const ye=`${s}/${zt(ne)}`,ge=Ye(ne,J,a,t,n,i,ye,ie);ge.valid||ae.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:ie,error:`Property name "${ne}" does not match schema.`},...ge.errors)}}if(Y!==void 0){const ie=`${o}/dependantRequired`;for(const ne in Y)if(ne in e){const ye=Y[ne];for(const ge of ye)ge in e||ae.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:ie,error:`Instance has "${ne}" but does not have "${ge}".`})}}if(se!==void 0)for(const ie in se){const ne=`${o}/dependentSchemas`;if(ie in e){const ye=Ye(e,se[ie],a,t,n,i,s,`${ne}/${zt(ie)}`,l);ye.valid||ae.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:ne,error:`Instance has "${ie}" but does not match dependant schema.`},...ye.errors)}}if(oe!==void 0){const ie=`${o}/dependencies`;for(const ne in oe)if(ne in e){const ye=oe[ne];if(Array.isArray(ye))for(const ge of ye)ge in e||ae.push({instanceLocation:s,keyword:"dependencies",keywordLocation:ie,error:`Instance has "${ne}" but does not have "${ge}".`});else{const ge=Ye(e,ye,a,t,n,i,s,`${ie}/${zt(ne)}`);ge.valid||ae.push({instanceLocation:s,keyword:"dependencies",keywordLocation:ie,error:`Instance has "${ne}" but does not match dependant schema.`},...ge.errors)}}}const te=Object.create(null);let Ee=!1;if(A!==void 0){const ie=`${o}/properties`;for(const ne in A){if(!(ne in e))continue;const ye=`${s}/${zt(ne)}`,ge=Ye(e[ne],A[ne],a,t,n,i,ye,`${ie}/${zt(ne)}`);if(ge.valid)l[ne]=te[ne]=!0;else if(Ee=n,ae.push({instanceLocation:s,keyword:"properties",keywordLocation:ie,error:`Property "${ne}" does not match schema.`},...ge.errors),Ee)break}}if(!Ee&&R!==void 0){const ie=`${o}/patternProperties`;for(const ne in R){const ye=new RegExp(ne,"u"),ge=R[ne];for(const Xe in e){if(!ye.test(Xe))continue;const Ar=`${s}/${zt(Xe)}`,Fa=Ye(e[Xe],ge,a,t,n,i,Ar,`${ie}/${zt(ne)}`);Fa.valid?l[Xe]=te[Xe]=!0:(Ee=n,ae.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:ie,error:`Property "${Xe}" matches pattern "${ne}" but does not match associated schema.`},...Fa.errors))}}}if(!Ee&&z!==void 0){const ie=`${o}/additionalProperties`;for(const ne in e){if(te[ne])continue;const ye=`${s}/${zt(ne)}`,ge=Ye(e[ne],z,a,t,n,i,ye,ie);ge.valid?l[ne]=!0:(Ee=n,ae.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:ie,error:`Property "${ne}" does not match additional properties schema.`},...ge.errors))}}else if(!Ee&&U!==void 0){const ie=`${o}/unevaluatedProperties`;for(const ne in e)if(!l[ne]){const ye=`${s}/${zt(ne)}`,ge=Ye(e[ne],U,a,t,n,i,ye,ie);ge.valid?l[ne]=!0:ae.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:ie,error:`Property "${ne}" does not match unevaluated properties schema.`},...ge.errors)}}}else if(d==="array"){F!==void 0&&e.length>F&&ae.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${F}).`}),C!==void 0&&e.length<C&&ae.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${C}).`});const de=e.length;let te=0,Ee=!1;if(Se!==void 0){const ie=`${o}/prefixItems`,ne=Math.min(Se.length,de);for(;te<ne;te++){const ye=Ye(e[te],Se[te],a,t,n,i,`${s}/${te}`,`${ie}/${te}`);if(l[te]=!0,!ye.valid&&(Ee=n,ae.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:ie,error:"Items did not match schema."},...ye.errors),Ee))break}}if(Ce!==void 0){const ie=`${o}/items`;if(Array.isArray(Ce)){const ne=Math.min(Ce.length,de);for(;te<ne;te++){const ye=Ye(e[te],Ce[te],a,t,n,i,`${s}/${te}`,`${ie}/${te}`);if(l[te]=!0,!ye.valid&&(Ee=n,ae.push({instanceLocation:s,keyword:"items",keywordLocation:ie,error:"Items did not match schema."},...ye.errors),Ee))break}}else for(;te<de;te++){const ne=Ye(e[te],Ce,a,t,n,i,`${s}/${te}`,ie);if(l[te]=!0,!ne.valid&&(Ee=n,ae.push({instanceLocation:s,keyword:"items",keywordLocation:ie,error:"Items did not match schema."},...ne.errors),Ee))break}if(!Ee&&Z!==void 0){const ne=`${o}/additionalItems`;for(;te<de;te++){const ye=Ye(e[te],Z,a,t,n,i,`${s}/${te}`,ne);l[te]=!0,ye.valid||(Ee=n,ae.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:ne,error:"Items did not match additional items schema."},...ye.errors))}}}if(ue!==void 0)if(de===0&&ee===void 0)ae.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(ee!==void 0&&de<ee)ae.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${de}) than minContains (${ee}).`});else{const ie=`${o}/contains`,ne=ae.length;let ye=0;for(let ge=0;ge<de;ge++){const Xe=Ye(e[ge],ue,a,t,n,i,`${s}/${ge}`,ie);Xe.valid?(l[ge]=!0,ye++):ae.push(...Xe.errors)}ye>=(ee||0)&&(ae.length=ne),ee===void 0&&_===void 0&&ye===0?ae.splice(ne,0,{instanceLocation:s,keyword:"contains",keywordLocation:ie,error:"Array does not contain item matching schema."}):ee!==void 0&&ye<ee?ae.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${ee} items matching schema. Only ${ye} items were found.`}):_!==void 0&&ye>_&&ae.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${_} items matching schema. ${ye} items were found.`})}if(!Ee&&re!==void 0){const ie=`${o}/unevaluatedItems`;for(te;te<de;te++){if(l[te])continue;const ne=Ye(e[te],re,a,t,n,i,`${s}/${te}`,ie);l[te]=!0,ne.valid||ae.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:ie,error:"Items did not match unevaluated items schema."},...ne.errors)}}if(W)for(let ie=0;ie<de;ie++){const ne=e[ie],ye=typeof ne=="object"&&ne!==null;for(let ge=0;ge<de;ge++){if(ie===ge)continue;const Xe=e[ge];(ne===Xe||ye&&typeof Xe=="object"&&Xe!==null&&xo(ne,Xe))&&(ae.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${ie} and ${ge}.`}),ie=Number.MAX_SAFE_INTEGER,ge=Number.MAX_SAFE_INTEGER)}}}else if(d==="number"){if(a==="4"?(H!==void 0&&(k===!0&&e<=H||e<H)&&ae.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${k?"or equal to ":""} ${H}.`}),j!==void 0&&(V===!0&&e>=j||e>j)&&ae.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${V?"or equal to ":""} ${j}.`})):(H!==void 0&&e<H&&ae.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${H}.`}),j!==void 0&&e>j&&ae.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${j}.`}),k!==void 0&&e<=k&&ae.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${k}.`}),V!==void 0&&e>=V&&ae.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${V}.`})),G!==void 0){const de=e%G;Math.abs(0-de)>=11920929e-14&&Math.abs(G-de)>=11920929e-14&&ae.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${G}.`})}}else if(d==="string"){const de=we===void 0&&ce===void 0?0:Yp(e);we!==void 0&&de<we&&ae.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${de} < ${we}).`}),ce!==void 0&&de>ce&&ae.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${de} > ${ce}).`}),me!==void 0&&!new RegExp(me,"u").test(e)&&ae.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),D!==void 0&&Ro[D]&&!Ro[D](e)&&ae.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${D}".`})}return{valid:ae.length===0,errors:ae}}class em extends u1{get lc_namespace(){return["langchain","tools"]}constructor(r){super(r??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(r==null?void 0:r.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(r==null?void 0:r.responseFormat)??this.responseFormat}async invoke(r,a){let t,n=Sx(a);return go(r)?(t=r.args,n={...n,toolCall:r}):t=r,this.call(t,n)}async call(r,a,t){var v;const n=go(r)?r.args:r;let i;if(kx(this.schema))try{i=await Cx(this.schema,n)}catch(f){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${f.message}`),new Xh(m,JSON.stringify(r))}else{const f=Ye(n,this.schema);if(!f.valid){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${f.errors.map(g=>`${g.keywordLocation}: ${g.error}`).join(`
`)}`),new Xh(m,JSON.stringify(r))}i=n}const s=Jh(a),o=await((v=Px.configure(s.callbacks,this.callbacks,s.tags||t,this.tags,s.metadata,this.metadata,{verbose:this.verbose}))==null?void 0:v.handleToolStart(this.toJSON(),typeof r=="string"?r:JSON.stringify(r),s.runId,void 0,void 0,void 0,s.runName));delete s.runId;let l;try{l=await this._call(i,o,s)}catch(f){throw await(o==null?void 0:o.handleToolError(f)),f}let u,d;if(this.responseFormat==="content_and_artifact")if(Array.isArray(l)&&l.length===2)[u,d]=l;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(l)}`);else u=l;let p;go(r)&&(p=r.id),!p&&Nx(s)&&(p=s.toolCall.id);const h=rm({content:u,artifact:d,toolCallId:p,name:this.name});return await(o==null?void 0:o.handleToolEnd(h)),h}}class tm extends em{static lc_name(){return"DynamicStructuredTool"}constructor(r){super(r),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=r.name,this.description=r.description,this.func=r.func,this.returnDirect=r.returnDirect??this.returnDirect,this.schema=r.schema}async call(r,a,t){const n=Jh(a);return n.runName===void 0&&(n.runName=this.name),super.call(r,n,t)}_call(r,a,t){return this.func(r,a,t)}}function rm(e){const{content:r,artifact:a,toolCallId:t}=e;return t&&!$x(r)?typeof r=="string"||Array.isArray(r)&&r.every(n=>typeof n=="object")?new Yh({content:r,artifact:a,tool_call_id:t,name:e.name}):new Yh({content:am(r),artifact:a,tool_call_id:t,name:e.name}):r}function am(e){try{return JSON.stringify(e,null,2)??""}catch{return`${e}`}}var Ka="Menubar",[es,nm,sm]=Fw(Ka),[Ao,L1]=Aw(Ka,[sm,ep]),gt=Ox(),Lo=ep(),[im,ts]=Ao(Ka),Fo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,value:t,onValueChange:n,defaultValue:i,loop:s=!0,dir:o,...l}=e,u=Ix(o),d=Lo(a),[p="",h]=Lw({prop:t,onChange:n,defaultProp:i}),[v,f]=b.useState(null);return c.jsx(im,{scope:a,value:p,onMenuOpen:b.useCallback(m=>{h(m),f(m)},[h]),onMenuClose:b.useCallback(()=>h(""),[h]),onMenuToggle:b.useCallback(m=>{h(g=>g?"":m),f(m)},[h]),dir:u,loop:s,children:c.jsx(es.Provider,{scope:a,children:c.jsx(es.Slot,{scope:a,children:c.jsx(Tx,{asChild:!0,...d,orientation:"horizontal",loop:s,dir:u,currentTabStopId:v,onCurrentTabStopIdChange:f,children:c.jsx(tr.div,{role:"menubar",...l,ref:r})})})})})});Fo.displayName=Ka;var rs="MenubarMenu",[om,Do]=Ao(rs),Mo=e=>{const{__scopeMenubar:r,value:a,...t}=e,n=mr(),i=a||n||"LEGACY_REACT_AUTO_VALUE",s=ts(rs,r),o=gt(r),l=b.useRef(null),u=b.useRef(!1),d=s.value===i;return b.useEffect(()=>{d||(u.current=!1)},[d]),c.jsx(om,{scope:r,value:i,triggerId:mr(),triggerRef:l,contentId:mr(),wasKeyboardTriggerOpenRef:u,children:c.jsx(Rx,{...o,open:d,onOpenChange:p=>{p||s.onMenuClose()},modal:!1,dir:s.dir,...t})})};Mo.displayName=rs;var as="MenubarTrigger",zo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,disabled:t=!1,...n}=e,i=Lo(a),s=gt(a),o=ts(as,a),l=Do(as,a),u=b.useRef(null),d=Dw(r,u,l.triggerRef),[p,h]=b.useState(!1),v=o.value===l.value;return c.jsx(es.ItemSlot,{scope:a,value:l.value,disabled:t,children:c.jsx(Ax,{asChild:!0,...i,focusable:!t,tabStopId:l.value,children:c.jsx(Lx,{asChild:!0,...s,children:c.jsx(tr.button,{type:"button",role:"menuitem",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":v,"aria-controls":v?l.contentId:void 0,"data-highlighted":p?"":void 0,"data-state":v?"open":"closed","data-disabled":t?"":void 0,disabled:t,...n,ref:d,onPointerDown:lr(e.onPointerDown,f=>{!t&&f.button===0&&f.ctrlKey===!1&&(o.onMenuOpen(l.value),v||f.preventDefault())}),onPointerEnter:lr(e.onPointerEnter,()=>{var f;o.value&&!v&&(o.onMenuOpen(l.value),(f=u.current)==null||f.focus())}),onKeyDown:lr(e.onKeyDown,f=>{t||(["Enter"," "].includes(f.key)&&o.onMenuToggle(l.value),f.key==="ArrowDown"&&o.onMenuOpen(l.value),["Enter"," ","ArrowDown"].includes(f.key)&&(l.wasKeyboardTriggerOpenRef.current=!0,f.preventDefault()))}),onFocus:lr(e.onFocus,()=>h(!0)),onBlur:lr(e.onBlur,()=>h(!1))})})})})});zo.displayName=as;var lm="MenubarPortal",Uo=e=>{const{__scopeMenubar:r,...a}=e,t=gt(r);return c.jsx(Fx,{...t,...a})};Uo.displayName=lm;var ns="MenubarContent",Ho=b.forwardRef((e,r)=>{const{__scopeMenubar:a,align:t="start",...n}=e,i=gt(a),s=ts(ns,a),o=Do(ns,a),l=nm(a),u=b.useRef(!1);return c.jsx(Dx,{id:o.contentId,"aria-labelledby":o.triggerId,"data-radix-menubar-content":"",...i,...n,ref:r,align:t,onCloseAutoFocus:lr(e.onCloseAutoFocus,d=>{var p;!s.value&&!u.current&&((p=o.triggerRef.current)==null||p.focus()),u.current=!1,d.preventDefault()}),onFocusOutside:lr(e.onFocusOutside,d=>{const p=d.target;l().some(h=>{var v;return(v=h.ref.current)==null?void 0:v.contains(p)})&&d.preventDefault()}),onInteractOutside:lr(e.onInteractOutside,()=>{u.current=!0}),onEntryFocus:d=>{o.wasKeyboardTriggerOpenRef.current||d.preventDefault()},onKeyDown:lr(e.onKeyDown,d=>{if(["ArrowRight","ArrowLeft"].includes(d.key)){const p=d.target,h=p.hasAttribute("data-radix-menubar-subtrigger"),v=p.closest("[data-radix-menubar-content]")!==d.currentTarget,f=(s.dir==="rtl"?"ArrowRight":"ArrowLeft")===d.key;if(!f&&h||v&&f)return;let m=l().filter(S=>!S.disabled).map(S=>S.value);f&&m.reverse();const g=m.indexOf(o.value);m=s.loop?jm(m,g+1):m.slice(g+1);const[w]=m;w&&s.onMenuOpen(w)}},{checkForDefaultPrevented:!1}),style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});Ho.displayName=ns;var cm="MenubarGroup",dm=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(zx,{...n,...t,ref:r})});dm.displayName=cm;var um="MenubarLabel",Vo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Ux,{...n,...t,ref:r})});Vo.displayName=um;var hm="MenubarItem",qo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Mx,{...n,...t,ref:r})});qo.displayName=hm;var pm="MenubarCheckboxItem",Zo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Hx,{...n,...t,ref:r})});Zo.displayName=pm;var mm="MenubarRadioGroup",fm=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Vx,{...n,...t,ref:r})});fm.displayName=mm;var vm="MenubarRadioItem",Bo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(qx,{...n,...t,ref:r})});Bo.displayName=vm;var gm="MenubarItemIndicator",Wo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Zx,{...n,...t,ref:r})});Wo.displayName=gm;var ym="MenubarSeparator",Ko=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Bx,{...n,...t,ref:r})});Ko.displayName=ym;var _m="MenubarArrow",bm=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Wx,{...n,...t,ref:r})});bm.displayName=_m;var wm="MenubarSubTrigger",Qo=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Kx,{"data-radix-menubar-subtrigger":"",...n,...t,ref:r})});Qo.displayName=wm;var xm="MenubarSubContent",Go=b.forwardRef((e,r)=>{const{__scopeMenubar:a,...t}=e,n=gt(a);return c.jsx(Qx,{...n,"data-radix-menubar-content":"",...t,ref:r,style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});Go.displayName=xm;function jm(e,r){return e.map((a,t)=>e[(r+t)%e.length])}var Jo=Fo,Em=Mo,Xo=zo,Sm=Uo,Yo=Ho,el=Vo,tl=qo,rl=Zo,al=Bo,nl=Wo,sl=Ko,il=Qo,ol=Go;const ss=Em,ll=b.forwardRef(({className:e,...r},a)=>c.jsx(Jo,{ref:a,className:Me("flex h-10 items-center space-x-1 rounded-md border bg-background p-1",e),...r}));ll.displayName=Jo.displayName;const is=b.forwardRef(({className:e,...r},a)=>c.jsx(Xo,{ref:a,className:Me("flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...r}));is.displayName=Xo.displayName;const km=b.forwardRef(({className:e,inset:r,children:a,...t},n)=>c.jsxs(il,{ref:n,className:Me("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",r&&"pl-8",e),...t,children:[a,c.jsx(_e,{name:"chevron-right",className:"ml-auto h-4 w-4"})]}));km.displayName=il.displayName;const Cm=b.forwardRef(({className:e,...r},a)=>c.jsx(ol,{ref:a,className:Me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));Cm.displayName=ol.displayName;const cl=b.forwardRef(({className:e,align:r="start",alignOffset:a=-4,sideOffset:t=8,...n},i)=>c.jsx(Sm,{children:c.jsx(Yo,{ref:i,align:r,alignOffset:a,sideOffset:t,className:Me("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));cl.displayName=Yo.displayName;const dl=b.forwardRef(({className:e,inset:r,...a},t)=>c.jsx(tl,{ref:t,className:Me("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",e),...a}));dl.displayName=tl.displayName;const Pm=b.forwardRef(({className:e,children:r,checked:a,...t},n)=>c.jsxs(rl,{ref:n,className:Me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(nl,{children:c.jsx(_e,{name:"check",className:"h-4 w-4"})})}),r]}));Pm.displayName=rl.displayName;const Nm=b.forwardRef(({className:e,children:r,...a},t)=>c.jsxs(al,{ref:t,className:Me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(nl,{children:c.jsx(_e,{name:"circle",className:"h-2 w-2 fill-current"})})}),r]}));Nm.displayName=al.displayName;const $m=b.forwardRef(({className:e,inset:r,...a},t)=>c.jsx(el,{ref:t,className:Me("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",e),...a}));$m.displayName=el.displayName;const Om=b.forwardRef(({className:e,...r},a)=>c.jsx(sl,{ref:a,className:Me("-mx-1 my-1 h-px bg-muted",e),...r}));Om.displayName=sl.displayName;const ve=Mw()(zw(Uw((e,r)=>({...Qw,...Kw(e,r)})))),Rm=()=>{const e=rt(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=b.useState(!1),t=ve(s=>s.pushSyncNodeQueue),n=ve(s=>s.createOrUpdateFlowNode),i=b.useCallback(async(s,o)=>{try{if(!e)throw new Error("Session not found");if(!o.provider||!o.name)throw new Error("Provider and name are required");a(!0);const l=await he("LLM").findOne({where:{name:o.name,session_id:e}});return l?(t("LLM",{where:{source_type:"LLM",source_id:l.id}}),l):he("LLM").save({name:`${o.name}`,status:[$e.WebLLM,$e.Wllama].includes(o.provider)?jt.Started:jt.Loaded,session_id:e,provider:o.provider,metadata:JSON.stringify(o.metadata||{}),model_type:o.model_type||Gn.LLM,parameters:o.parameters||void 0,encrypted:o.encrypted||void 0,...o}).then(async u=>{var d,p,h;return await n({source_id:u.id,source_type:"LLM",node_type:Q.LLM,x:(d=s.position)==null?void 0:d.x,y:((p=s.position)==null?void 0:p.y)+(((h=s.measured)==null?void 0:h.height)||0)+30}),u})}finally{a(!1)}},[n,t,e]);return{loading:r,createLLM:i}};var ul=1,Im=.9,Tm=.8,Am=.17,os=.1,ls=.999,Lm=.9999,Fm=.99,Dm=/[\\\/_+.#"@\[\(\{&]/,Mm=/[\\\/_+.#"@\[\(\{&]/g,zm=/[\s-]/,hl=/[\s-]/g;function cs(e,r,a,t,n,i,s){if(i===r.length)return n===e.length?ul:Fm;var o=`${n},${i}`;if(s[o]!==void 0)return s[o];for(var l=t.charAt(i),u=a.indexOf(l,n),d=0,p,h,v,f;u>=0;)p=cs(e,r,a,t,u+1,i+1,s),p>d&&(u===n?p*=ul:Dm.test(e.charAt(u-1))?(p*=Tm,v=e.slice(n,u-1).match(Mm),v&&n>0&&(p*=Math.pow(ls,v.length))):zm.test(e.charAt(u-1))?(p*=Im,f=e.slice(n,u-1).match(hl),f&&n>0&&(p*=Math.pow(ls,f.length))):(p*=Am,n>0&&(p*=Math.pow(ls,u-n))),e.charAt(u)!==r.charAt(i)&&(p*=Lm)),(p<os&&a.charAt(u-1)===t.charAt(i+1)||t.charAt(i+1)===t.charAt(i)&&a.charAt(u-1)!==t.charAt(i))&&(h=cs(e,r,a,t,u+1,i+2,s),h*os>p&&(p=h*os)),p>d&&(d=p),u=a.indexOf(l,u+1);return s[o]=d,d}function pl(e){return e.toLowerCase().replace(hl," ")}function Um(e,r,a){return e=a&&a.length>0?`${e+" "+a.join(" ")}`:e,cs(e,r,pl(e),pl(r),0,0,{})}var ya='[cmdk-group=""]',ds='[cmdk-group-items=""]',Hm='[cmdk-group-heading=""]',us='[cmdk-item=""]',ml=`${us}:not([aria-disabled="true"])`,hs="cmdk-item-select",Cr="data-value",Vm=(e,r,a)=>Um(e,r,a),fl=b.createContext(void 0),_a=()=>b.useContext(fl),vl=b.createContext(void 0),ps=()=>b.useContext(vl),gl=b.createContext(void 0),yl=b.forwardRef((e,r)=>{let a=Ur(()=>{var Z,re;return{search:"",value:(re=(Z=e.value)!=null?Z:e.defaultValue)!=null?re:"",filtered:{count:0,items:new Map,groups:new Set}}}),t=Ur(()=>new Set),n=Ur(()=>new Map),i=Ur(()=>new Map),s=Ur(()=>new Set),o=_l(e),{label:l,children:u,value:d,onValueChange:p,filter:h,shouldFilter:v,loop:f,disablePointerSelection:m=!1,vimBindings:g=!0,...w}=e,S=mr(),O=mr(),x=mr(),E=b.useRef(null),$=ef();Pr(()=>{if(d!==void 0){let Z=d.trim();a.current.value=Z,N.emit()}},[d]),Pr(()=>{$(6,U)},[]);let N=b.useMemo(()=>({subscribe:Z=>(s.current.add(Z),()=>s.current.delete(Z)),snapshot:()=>a.current,setState:(Z,re,ue)=>{var ee,_,C;if(!Object.is(a.current[Z],re)){if(a.current[Z]=re,Z==="search")z(),A(),$(1,R);else if(Z==="value"&&(ue||$(5,U),((ee=o.current)==null?void 0:ee.value)!==void 0)){let F=re??"";(C=(_=o.current).onValueChange)==null||C.call(_,F);return}N.emit()}},emit:()=>{s.current.forEach(Z=>Z())}}),[]),T=b.useMemo(()=>({value:(Z,re,ue)=>{var ee;re!==((ee=i.current.get(Z))==null?void 0:ee.value)&&(i.current.set(Z,{value:re,keywords:ue}),a.current.filtered.items.set(Z,D(re,ue)),$(2,()=>{A(),N.emit()}))},item:(Z,re)=>(t.current.add(Z),re&&(n.current.has(re)?n.current.get(re).add(Z):n.current.set(re,new Set([Z]))),$(3,()=>{z(),A(),a.current.value||R(),N.emit()}),()=>{i.current.delete(Z),t.current.delete(Z),a.current.filtered.items.delete(Z);let ue=M();$(4,()=>{z(),(ue==null?void 0:ue.getAttribute("id"))===Z&&R(),N.emit()})}),group:Z=>(n.current.has(Z)||n.current.set(Z,new Set),()=>{i.current.delete(Z),n.current.delete(Z)}),filter:()=>o.current.shouldFilter,label:l||e["aria-label"],getDisablePointerSelection:()=>o.current.disablePointerSelection,listId:S,inputId:x,labelId:O,listInnerRef:E}),[]);function D(Z,re){var ue,ee;let _=(ee=(ue=o.current)==null?void 0:ue.filter)!=null?ee:Vm;return Z?_(Z,a.current.search,re):0}function A(){if(!a.current.search||o.current.shouldFilter===!1)return;let Z=a.current.filtered.items,re=[];a.current.filtered.groups.forEach(ee=>{let _=n.current.get(ee),C=0;_.forEach(F=>{let W=Z.get(F);C=Math.max(W,C)}),re.push([ee,C])});let ue=E.current;q().sort((ee,_)=>{var C,F;let W=ee.getAttribute("id"),H=_.getAttribute("id");return((C=Z.get(H))!=null?C:0)-((F=Z.get(W))!=null?F:0)}).forEach(ee=>{let _=ee.closest(ds);_?_.appendChild(ee.parentElement===_?ee:ee.closest(`${ds} > *`)):ue.appendChild(ee.parentElement===ue?ee:ee.closest(`${ds} > *`))}),re.sort((ee,_)=>_[1]-ee[1]).forEach(ee=>{var _;let C=(_=E.current)==null?void 0:_.querySelector(`${ya}[${Cr}="${encodeURIComponent(ee[0])}"]`);C==null||C.parentElement.appendChild(C)})}function R(){let Z=q().find(ue=>ue.getAttribute("aria-disabled")!=="true"),re=Z==null?void 0:Z.getAttribute(Cr);N.setState("value",re||void 0)}function z(){var Z,re,ue,ee;if(!a.current.search||o.current.shouldFilter===!1){a.current.filtered.count=t.current.size;return}a.current.filtered.groups=new Set;let _=0;for(let C of t.current){let F=(re=(Z=i.current.get(C))==null?void 0:Z.value)!=null?re:"",W=(ee=(ue=i.current.get(C))==null?void 0:ue.keywords)!=null?ee:[],H=D(F,W);a.current.filtered.items.set(C,H),H>0&&_++}for(let[C,F]of n.current)for(let W of F)if(a.current.filtered.items.get(W)>0){a.current.filtered.groups.add(C);break}a.current.filtered.count=_}function U(){var Z,re,ue;let ee=M();ee&&(((Z=ee.parentElement)==null?void 0:Z.firstChild)===ee&&((ue=(re=ee.closest(ya))==null?void 0:re.querySelector(Hm))==null||ue.scrollIntoView({block:"nearest"})),ee.scrollIntoView({block:"nearest"}))}function M(){var Z;return(Z=E.current)==null?void 0:Z.querySelector(`${us}[aria-selected="true"]`)}function q(){var Z;return Array.from(((Z=E.current)==null?void 0:Z.querySelectorAll(ml))||[])}function J(Z){let re=q()[Z];re&&N.setState("value",re.getAttribute(Cr))}function Y(Z){var re;let ue=M(),ee=q(),_=ee.findIndex(F=>F===ue),C=ee[_+Z];(re=o.current)!=null&&re.loop&&(C=_+Z<0?ee[ee.length-1]:_+Z===ee.length?ee[0]:ee[_+Z]),C&&N.setState("value",C.getAttribute(Cr))}function se(Z){let re=M(),ue=re==null?void 0:re.closest(ya),ee;for(;ue&&!ee;)ue=Z>0?Xm(ue,ya):Ym(ue,ya),ee=ue==null?void 0:ue.querySelector(ml);ee?N.setState("value",ee.getAttribute(Cr)):Y(Z)}let oe=()=>J(q().length-1),Se=Z=>{Z.preventDefault(),Z.metaKey?oe():Z.altKey?se(1):Y(1)},Ce=Z=>{Z.preventDefault(),Z.metaKey?J(0):Z.altKey?se(-1):Y(-1)};return b.createElement(tr.div,{ref:r,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:Z=>{var re;if((re=w.onKeyDown)==null||re.call(w,Z),!Z.defaultPrevented)switch(Z.key){case"n":case"j":{g&&Z.ctrlKey&&Se(Z);break}case"ArrowDown":{Se(Z);break}case"p":case"k":{g&&Z.ctrlKey&&Ce(Z);break}case"ArrowUp":{Ce(Z);break}case"Home":{Z.preventDefault(),J(0);break}case"End":{Z.preventDefault(),oe();break}case"Enter":if(!Z.nativeEvent.isComposing&&Z.keyCode!==229){Z.preventDefault();let ue=M();if(ue){let ee=new Event(hs);ue.dispatchEvent(ee)}}}}},b.createElement("label",{"cmdk-label":"",htmlFor:T.inputId,id:T.labelId,style:rf},l),Qa(e,Z=>b.createElement(vl.Provider,{value:N},b.createElement(fl.Provider,{value:T},Z))))}),qm=b.forwardRef((e,r)=>{var a,t;let n=mr(),i=b.useRef(null),s=b.useContext(gl),o=_a(),l=_l(e),u=(t=(a=l.current)==null?void 0:a.forceMount)!=null?t:s==null?void 0:s.forceMount;Pr(()=>{if(!u)return o.item(n,s==null?void 0:s.id)},[u]);let d=bl(n,i,[e.value,e.children,i],e.keywords),p=ps(),h=Nr($=>$.value&&$.value===d.current),v=Nr($=>u||o.filter()===!1?!0:$.search?$.filtered.items.get(n)>0:!0);b.useEffect(()=>{let $=i.current;if(!(!$||e.disabled))return $.addEventListener(hs,f),()=>$.removeEventListener(hs,f)},[v,e.onSelect,e.disabled]);function f(){var $,N;m(),(N=($=l.current).onSelect)==null||N.call($,d.current)}function m(){p.setState("value",d.current,!0)}if(!v)return null;let{disabled:g,value:w,onSelect:S,forceMount:O,keywords:x,...E}=e;return b.createElement(tr.div,{ref:ba([i,r]),...E,id:n,"cmdk-item":"",role:"option","aria-disabled":!!g,"aria-selected":!!h,"data-disabled":!!g,"data-selected":!!h,onPointerMove:g||o.getDisablePointerSelection()?void 0:m,onClick:g?void 0:f},e.children)}),Zm=b.forwardRef((e,r)=>{let{heading:a,children:t,forceMount:n,...i}=e,s=mr(),o=b.useRef(null),l=b.useRef(null),u=mr(),d=_a(),p=Nr(v=>n||d.filter()===!1?!0:v.search?v.filtered.groups.has(s):!0);Pr(()=>d.group(s),[]),bl(s,o,[e.value,e.heading,l]);let h=b.useMemo(()=>({id:s,forceMount:n}),[n]);return b.createElement(tr.div,{ref:ba([o,r]),...i,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},a&&b.createElement("div",{ref:l,"cmdk-group-heading":"","aria-hidden":!0,id:u},a),Qa(e,v=>b.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?u:void 0},b.createElement(gl.Provider,{value:h},v))))}),Bm=b.forwardRef((e,r)=>{let{alwaysRender:a,...t}=e,n=b.useRef(null),i=Nr(s=>!s.search);return!a&&!i?null:b.createElement(tr.div,{ref:ba([n,r]),...t,"cmdk-separator":"",role:"separator"})}),Wm=b.forwardRef((e,r)=>{let{onValueChange:a,...t}=e,n=e.value!=null,i=ps(),s=Nr(d=>d.search),o=Nr(d=>d.value),l=_a(),u=b.useMemo(()=>{var d;let p=(d=l.listInnerRef.current)==null?void 0:d.querySelector(`${us}[${Cr}="${encodeURIComponent(o)}"]`);return p==null?void 0:p.getAttribute("id")},[]);return b.useEffect(()=>{e.value!=null&&i.setState("search",e.value)},[e.value]),b.createElement(tr.input,{ref:r,...t,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":l.listId,"aria-labelledby":l.labelId,"aria-activedescendant":u,id:l.inputId,type:"text",value:n?e.value:s,onChange:d=>{n||i.setState("search",d.target.value),a==null||a(d.target.value)}})}),Km=b.forwardRef((e,r)=>{let{children:a,label:t="Suggestions",...n}=e,i=b.useRef(null),s=b.useRef(null),o=_a();return b.useEffect(()=>{if(s.current&&i.current){let l=s.current,u=i.current,d,p=new ResizeObserver(()=>{d=requestAnimationFrame(()=>{let h=l.offsetHeight;u.style.setProperty("--cmdk-list-height",h.toFixed(1)+"px")})});return p.observe(l),()=>{cancelAnimationFrame(d),p.unobserve(l)}}},[]),b.createElement(tr.div,{ref:ba([i,r]),...n,"cmdk-list":"",role:"listbox","aria-label":t,id:o.listId},Qa(e,l=>b.createElement("div",{ref:ba([s,o.listInnerRef]),"cmdk-list-sizer":""},l)))}),Qm=b.forwardRef((e,r)=>{let{open:a,onOpenChange:t,overlayClassName:n,contentClassName:i,container:s,...o}=e;return b.createElement(Gx,{open:a,onOpenChange:t},b.createElement(Jx,{container:s},b.createElement(Xx,{"cmdk-overlay":"",className:n}),b.createElement(Yx,{"aria-label":e.label,"cmdk-dialog":"",className:i},b.createElement(yl,{ref:r,...o}))))}),Gm=b.forwardRef((e,r)=>Nr(a=>a.filtered.count===0)?b.createElement(tr.div,{ref:r,...e,"cmdk-empty":"",role:"presentation"}):null),Jm=b.forwardRef((e,r)=>{let{progress:a,children:t,label:n="Loading...",...i}=e;return b.createElement(tr.div,{ref:r,...i,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},Qa(e,s=>b.createElement("div",{"aria-hidden":!0},s)))}),Et=Object.assign(yl,{List:Km,Item:qm,Input:Wm,Group:Zm,Separator:Bm,Dialog:Qm,Empty:Gm,Loading:Jm});function Xm(e,r){let a=e.nextElementSibling;for(;a;){if(a.matches(r))return a;a=a.nextElementSibling}}function Ym(e,r){let a=e.previousElementSibling;for(;a;){if(a.matches(r))return a;a=a.previousElementSibling}}function _l(e){let r=b.useRef(e);return Pr(()=>{r.current=e}),r}var Pr=typeof window>"u"?b.useEffect:b.useLayoutEffect;function Ur(e){let r=b.useRef();return r.current===void 0&&(r.current=e()),r}function ba(e){return r=>{e.forEach(a=>{typeof a=="function"?a(r):a!=null&&(a.current=r)})}}function Nr(e){let r=ps(),a=()=>e(r.snapshot());return k1.useSyncExternalStore(r.subscribe,a,a)}function bl(e,r,a,t=[]){let n=b.useRef(),i=_a();return Pr(()=>{var s;let o=(()=>{var u;for(let d of a){if(typeof d=="string")return d.trim();if(typeof d=="object"&&"current"in d)return d.current?(u=d.current.textContent)==null?void 0:u.trim():n.current}})(),l=t.map(u=>u.trim());i.value(e,o,l),(s=r.current)==null||s.setAttribute(Cr,o),n.current=o}),n}var ef=()=>{let[e,r]=b.useState(),a=Ur(()=>new Map);return Pr(()=>{a.current.forEach(t=>t()),a.current=new Map},[e]),(t,n)=>{a.current.set(t,n),r({})}};function tf(e){let r=e.type;return typeof r=="function"?r(e.props):"render"in r?r.render(e.props):e}function Qa({asChild:e,children:r},a){return e&&b.isValidElement(r)?b.cloneElement(tf(r),{ref:r.ref},a(r.props.children)):a(r)}var rf={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ga=b.forwardRef(({className:e,...r},a)=>c.jsx(Et,{ref:a,className:Me("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...r}));Ga.displayName=Et.displayName;const Ja=b.forwardRef(({className:e,...r},a)=>c.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[c.jsx(_e,{name:"search",className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),c.jsx(Et.Input,{ref:a,className:Me("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...r})]}));Ja.displayName=Et.Input.displayName;const Xa=b.forwardRef(({className:e,...r},a)=>c.jsx(Et.List,{ref:a,className:Me("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...r}));Xa.displayName=Et.List.displayName;const Ya=b.forwardRef((e,r)=>c.jsx(Et.Empty,{ref:r,className:"py-6 text-center text-sm",...e}));Ya.displayName=Et.Empty.displayName;const en=b.forwardRef(({className:e,...r},a)=>c.jsx(Et.Group,{ref:a,className:Me("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...r}));en.displayName=Et.Group.displayName;const af=b.forwardRef(({className:e,...r},a)=>c.jsx(Et.Separator,{ref:a,className:Me("-mx-1 h-px bg-border",e),...r}));af.displayName=Et.Separator.displayName;const Hr=b.forwardRef(({className:e,...r},a)=>c.jsx(Et.Item,{ref:a,className:Me("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...r}));Hr.displayName=Et.Item.displayName;const ms=b.forwardRef(({className:e,...r},a)=>c.jsx(mp,{ref:a,className:Me("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:c.jsx(C1,{className:Me("flex items-center justify-center text-current"),children:c.jsx(_e,{name:"check",className:"h-4 w-4"})})}));ms.displayName=mp.displayName;const nf=["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo"],sf=["deepseek-r1-distill-llama-70b","llama-3.2-90b-vision-preview","llama-3.3-70b-versatile","llama-3.3-70b-specdec","llama3-70b-8192","gemma2-9b-it","llama3-8b-8192","mixtral-8x7b-32768"],of=["llama-3.2-90b-vision-preview"],lf=["gemini-2.0-flash-exp","gemini-1.5-flash","gemini-1.5-pro","gemini-1.5-flash-8b"],tn="https://aistudio.google.com/app/apikey",rn="https://platform.openai.com/api-keys",wl="https://console.groq.com/keys",cf=[$e.WebLLM,$e.Wllama,$e.OpenAI,$e.GoogleGenerativeAI,$e.Groq],df=Fn(({onConfirm:e,onCancel:r})=>{const a=Er(),{t}=Te("dialogs"),[n,i]=b.useState(""),s=u=>{i(u)},o=async()=>{try{if((n==null?void 0:n.length)!==6)return;await(e==null?void 0:e(n)),i(""),a.resolve(!0),a.hide()}catch(u){a.reject(u)}},l=()=>{r==null||r(),i(""),a.resolve(!1),a.hide()};return c.jsx(Vn,{open:a.visible,onOpenChange:l,children:c.jsxs(qn,{className:"w-[330px]",children:[c.jsxs(Zn,{children:[c.jsx(Bn,{children:t("create_session_passkey.title")}),c.jsx(tp,{children:t("create_session_passkey.description")})]}),c.jsx("div",{className:"py-4",children:c.jsxs(h1,{onChange:s,maxLength:6,children:[c.jsxs(up,{children:[c.jsx(fa,{index:0,hidden:!0}),c.jsx(fa,{index:1,hidden:!0}),c.jsx(fa,{index:2,hidden:!0})]}),c.jsx(p1,{}),c.jsxs(up,{children:[c.jsx(fa,{index:3,hidden:!0}),c.jsx(fa,{index:4,hidden:!0}),c.jsx(fa,{index:5,hidden:!0})]})]})}),c.jsx(rp,{children:c.jsx(We,{disabled:(n==null?void 0:n.length)!==6,onClick:o,type:"submit",children:t("create_session_passkey.confirm")})})]})})}),uf=()=>{const[e,r]=b.useState(!1),a=rt(i=>i.currentSession),t=rt(i=>i.setCurrentSession),n=b.useCallback(async i=>{if(!(!a||!i))try{r(!0);const s=await m1(),o=await hp(s,i);await he("Session").update(a.id,{passphrase:o});const l=await he("Session").findOne({where:{id:a.id}});return l&&t(l),{passphrase:s,encrypted:o}}finally{r(!1)}},[a,t]);return{loading:e,updateSessionPassphrase:n}},xl=()=>{const e=rt(n=>n.currentSession),{modalRef:r}=f1(df),{updateSessionPassphrase:a}=uf(),{confirmPassphrase:t}=pp();return{confirmOrCreatePassphrase:b.useCallback(async()=>{if(e!=null&&e.passphrase)await t();else{let n="";if(await r.current.show({onConfirm:async s=>{n=s}}),!n)throw new Error("Passphrase is required");const i=await a(n);if(!i)throw new Error("Failed to update session passphrase");await Wn.set("passphrase",i.passphrase)}return Wn.get("passphrase")},[t,r,e==null?void 0:e.passphrase,a])}};function hf(e){var ue,ee;const{id:r,setDialog:a}=e,{t}=Te("components"),{toast:n}=Pt(),i=mt(r),[s,o]=b.useState(!1),[l,u]=b.useState(""),[d,p]=b.useState(!1),[h,v]=b.useState(""),[f,m]=b.useState(),[g,w]=b.useState($e.WebLLM),[S,O]=b.useState(!1),[x,E]=b.useState(),$=b.useRef(),N=rt(_=>_.currentSession),T=Ha(_=>_.syncCachedLLMURLs),D=Ha(_=>_.cachedLLMURLs),{loading:A,createLLM:R}=Rm();$.current=x;const{confirmOrCreatePassphrase:z}=xl();b.useEffect(()=>{T()},[T]);const U=b.useMemo(()=>l?![$e.WebLLM,$e.Wllama].includes(g):!1,[l,g]),M=b.useMemo(()=>!(x!=null&&x.functionCallingModelIds)||!(x!=null&&x.modelList)?[]:((h?x==null?void 0:x.modelList.filter(_=>_.model_id.toLowerCase().includes(h.toLowerCase())):x==null?void 0:x.modelList)||[]).sort((_,C)=>{const F=D.some(G=>G.includes(_.model_id)),W=D.some(G=>G.includes(C.model_id));if(F&&!W)return-1;if(!F&&W)return 1;const H=zh.includes(_.model_id),j=zh.includes(C.model_id);if(H&&!j)return-1;if(!H&&j)return 1;const k=x==null?void 0:x.functionCallingModelIds.includes(_.model_id),V=x==null?void 0:x.functionCallingModelIds.includes(C.model_id);return k&&!V?-1:!k&&V?1:_.vram_required_MB&&C.vram_required_MB&&_.vram_required_MB!==C.vram_required_MB?_.vram_required_MB-C.vram_required_MB:_.model_id.localeCompare(C.model_id)}),[x==null?void 0:x.modelList,x==null?void 0:x.functionCallingModelIds,h,D]),q=b.useMemo(()=>{if(l)switch(g){case $e.Wllama:return x==null?void 0:x.modelList.find(_=>_.model_id===l);case $e.WebLLM:return(x==null?void 0:x.modelList)&&M.find(_=>_.model_id===l);case $e.Groq:return m({}),{model:l,model_id:l,model_type:of.includes(l)?2:0,overrides:{}};case $e.OpenAI:return m({}),{model:l,model_id:l,model_type:2,overrides:{}};case $e.GoogleGenerativeAI:return m({}),{model:l,model_id:l,model_type:2,overrides:{}}}},[l,x==null?void 0:x.modelList,M,g]);b.useEffect(()=>{!(q!=null&&q.model_id)||!D||O(D.some(_=>_.includes(q.model_id)))},[D,q==null?void 0:q.model_id]),b.useEffect(()=>{N!=null&&N.id&&(w($e.WebLLM),u(""),v(""),m({}))},[N==null?void 0:N.id]);const J=b.useCallback(_=>{u(_),p(!1)},[]),Y=b.useCallback(_=>{v(_)},[]),se=b.useCallback(_=>{w(_),u(""),v(""),m({})},[]),oe=async()=>{var _;if(!(!i||!N))try{o(!0);let C;if(U){const F=await z();if(!F)throw new Error("Passphrase is not found");C=await v1(f||{},F)}await R(i,{name:l,model_type:Se(q==null?void 0:q.model_type),function_calling:q!=null&&q.model_id?(_=x==null?void 0:x.functionCallingModelIds)==null?void 0:_.includes(q==null?void 0:q.model_id):!1,encrypted:C,provider:g}),a==null||a(!1)}catch(C){Dn("Create LLM",C),n({variant:"destructive",description:t("add_llm_card.errors.failed_to_create")})}finally{o(!1),w($e.WebLLM),m({}),u(""),v("")}};b.useLayoutEffect(()=>{(async()=>{var _;try{if(g===$e.Wllama){const[C,F]=(l==null?void 0:l.split("/"))||[],W=`${C}/${F}`;if(!l||!C||!F){E({modelList:[],functionCallingModelIds:[]});return}else if(((_=$.current)==null?void 0:_.input)===W)return;const H=await(await fetch(`https://huggingface.co/api/models/${W}`)).json();H.siblings?E({input:W,modelList:H.siblings.map(j=>j.rfilename).filter(j=>j.endsWith(".gguf")).map(j=>({model_id:`${W}/${j}`,model:`${W}/${j}`,model_lib:`${W}/${j}`,model_type:0,overrides:{}})),functionCallingModelIds:[]}):E({modelList:[],functionCallingModelIds:[]})}else g===$e.WebLLM&&Rt(()=>import("./index-DYRICXF3.js").then(async C=>(await C.__tla,C)),__vite__mapDeps([0,1,2,3,4,5,6])).then(async({functionCallingModelIds:C,prebuiltAppConfig:F})=>{const W=F.model_list;E({modelList:W,functionCallingModelIds:C})})}catch{}})()},[g,l]);const Se=b.useCallback(_=>_===1?Gn.embedding:_===2?Gn.VLM:Gn.LLM,[]),Ce=b.useMemo(()=>{switch(g){case $e.Wllama:case $e.WebLLM:return M.map(_=>{var C;return c.jsxs(Hr,{value:_.model_id,onSelect:J,children:[l===_.model_id?c.jsx(_e,{name:"check",className:"mr-2 h-4 w-4"}):c.jsx("div",{className:"mr-2 h-4 w-4"}),c.jsxs("span",{className:"max-w-md",children:[c.jsxs("div",{className:"flex gap-2 mb-2",children:[c.jsx(vr,{name:_.model_id}),_.model_id]}),c.jsx("div",{className:"flex max-w-full flex-wrap gap-1",children:c.jsx(Mn,{model:_,isFunctionCalling:((C=x==null?void 0:x.functionCallingModelIds)==null?void 0:C.includes(_.model_id))||!1,name:_.model_id,isCached:D.some(F=>F.includes(_.model_id))||!1,cloud:g!==$e.WebLLM})})]})]},_.model_id)});case $e.OpenAI:return nf.map(_=>c.jsxs(Hr,{value:_,onSelect:J,children:[l===_?c.jsx(_e,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(vr,{name:_}),_]})})]},_));case $e.GoogleGenerativeAI:return lf.map(_=>c.jsxs(Hr,{value:_,onSelect:J,children:[l===_?c.jsx(_e,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(vr,{name:_}),_]})})]},_));case $e.Groq:return sf.map(_=>c.jsxs(Hr,{value:_,onSelect:J,children:[l===_?c.jsx(_e,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(vr,{name:_}),_]})})]},_))}},[D,J,l,x==null?void 0:x.functionCallingModelIds,M,g]),Z=b.useMemo(()=>{if(g===$e.Wllama){const[_,C]=(l==null?void 0:l.split("/"))||[];return c.jsxs(c.Fragment,{children:[c.jsx(It,{variant:"default",className:"mb-4",children:t("add_llm_card.wllama_description")}),c.jsx(je,{children:t("add_llm_card.hugging_face_recommendation")}),c.jsxs(Jn,{children:[c.jsx(So,{asChild:!0,children:c.jsxs(We,{variant:"outline",role:"combobox",className:"w-full justify-between max-w-full overflow-hidden",children:[_&&C?`${_}/${C}`:t("add_llm_card.select_model_placeholder"),c.jsx(_e,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),c.jsx(Xn,{className:"w-full p-0",children:c.jsxs(Ga,{children:[c.jsx(Ja,{placeholder:t("add_llm_card.search_placeholder")}),c.jsxs(Xa,{children:[c.jsx(Ya,{children:t("add_llm_card.no_model")}),c.jsx(en,{children:Gw.map(F=>c.jsxs(Hr,{value:F,onSelect:J,children:[l===F?c.jsx(_e,{name:"check",className:"h-4 w-4"}):c.jsx("div",{className:"w-4"}),c.jsx("span",{className:"max-w-md",children:c.jsxs("div",{className:"flex gap-3",children:[c.jsx(vr,{name:F}),F]})})]},F))})]})]})})]}),c.jsx(je,{children:t("add_llm_card.hugging_face_repo")}),_&&C?c.jsxs("div",{className:"relative",children:[c.jsx(ht,{value:`${_}/${C}`,disabled:!0,placeholder:t("add_llm_card.hugging_face_repo_placeholder")}),c.jsx(_e,{onClick:()=>u(""),name:"x",className:"h-4 w-4 absolute right-3 top-3 cursor-pointer"})]}):c.jsx(ht,{value:_?`${_}/${C}`:"",onChange:F=>u(F.target.value),placeholder:t("add_llm_card.hugging_face_repo_placeholder")}),c.jsx(je,{children:t("add_llm_card.model_name")}),c.jsxs(Jn,{open:d,onOpenChange:p,children:[c.jsx(So,{asChild:!0,children:c.jsxs(We,{variant:"outline",role:"combobox","aria-expanded":d,disabled:!_||!C,className:"w-full justify-between max-w-full overflow-hidden",children:[l&&q?q==null?void 0:q.model_id:t("add_llm_card.select_model_placeholder"),c.jsx(_e,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),c.jsx(Xn,{className:"w-full p-0",children:c.jsxs(Ga,{children:[c.jsx(Ja,{onValueChange:Y,placeholder:t("add_llm_card.search_placeholder")}),c.jsxs(Xa,{children:[c.jsx(Ya,{children:t("add_llm_card.no_model")}),c.jsx(en,{children:Ce})]})]})})]})]})}return c.jsxs(c.Fragment,{children:[c.jsx(je,{children:t("add_llm_card.model_name")}),c.jsxs(Jn,{open:d,onOpenChange:p,children:[c.jsx(So,{asChild:!0,children:c.jsxs(We,{variant:"outline",role:"combobox","aria-expanded":d,className:"w-full justify-between",children:[l?q==null?void 0:q.model_id:t("add_llm_card.select_model_placeholder"),c.jsx(_e,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),c.jsx(Xn,{className:"w-full p-0",children:c.jsxs(Ga,{children:[c.jsx(Ja,{onValueChange:Y,placeholder:t("add_llm_card.search_placeholder")}),c.jsxs(Xa,{children:[c.jsx(Ya,{children:t("add_llm_card.no_model")}),c.jsx(en,{children:Ce})]})]})})]})]})},[g,t,d,l,q,Y,Ce,J]),re=b.useMemo(()=>{if(U)switch(g){case $e.Groq:case $e.OpenAI:return c.jsxs(c.Fragment,{children:[c.jsx(It,{variant:"destructive",className:"mt-4",children:t("add_llm_card.alert.session_passkey")}),c.jsxs("div",{className:"mt-4",children:[c.jsx(je,{children:t("add_llm_card.encrypted_fields.api_key")}),c.jsx(We,{variant:"link",className:"px-1",children:c.jsxs("a",{href:g===$e.OpenAI?rn:wl,target:"_blank",rel:"noreferrer",children:["(",g===$e.OpenAI?rn:wl,")"]})}),c.jsx(ht,{type:"password",value:(f==null?void 0:f.key)||"",onChange:_=>m(C=>({...C,key:_.target.value}))})]})]});case $e.GoogleGenerativeAI:return c.jsxs(c.Fragment,{children:[c.jsx(It,{variant:"destructive",className:"mt-4",children:t("add_llm_card.alert.session_passkey")}),c.jsxs("div",{className:"mt-4",children:[c.jsx(je,{children:t("add_llm_card.encrypted_fields.api_key")}),c.jsx(We,{variant:"link",className:"px-1",children:c.jsxs("a",{href:tn,target:"_blank",rel:"noreferrer",children:["(",tn,")"]})}),c.jsx(ht,{type:"password",value:(f==null?void 0:f.key)||"",onChange:_=>m(C=>({...C,key:_.target.value}))})]}),c.jsxs("div",{className:"mt-4 flex items-center",children:[c.jsx(je,{children:t("add_llm_card.encrypted_fields.enabled_google_search_retreival")}),c.jsx(ms,{checked:!!(f!=null&&f.enabled_google_search_retreival),className:"ml-2",onCheckedChange:_=>{m(C=>({...C,enabled_google_search_retreival:_?"true":""}))}})]})]})}},[U,g,t,f]);return c.jsxs(it,{className:"max-w-lg",children:[c.jsx(ft,{children:c.jsx(xt,{children:t("add_llm_card.title")})}),c.jsxs(vt,{children:[c.jsxs("div",{className:"grid w-full gap-1.5",children:[c.jsx(je,{children:t("add_llm_card.provider")}),c.jsxs(cr,{value:g,onValueChange:se,children:[c.jsx(dr,{className:"w-full mb-4",children:c.jsx(ur,{placeholder:t("add_llm_card.provider_select_placeholder")})}),c.jsx(hr,{children:Object.values(cf).map(_=>c.jsx(Nt,{value:_,children:t(`add_llm_card.providers.${_.toLowerCase()}`)},_))})]}),Z]}),q?c.jsxs("div",{className:"mt-4",children:[c.jsxs("div",{className:"mt-4 text-sm text-muted-foreground center flex max-w-full flex-wrap gap-1",children:[c.jsx(vr,{name:q.model_id,className:"mr-2"}),c.jsx(Mn,{model:q,isFunctionCalling:((ue=x==null?void 0:x.functionCallingModelIds)==null?void 0:ue.includes(q.model_id))||!1,name:q.model_id,isCached:D.some(_=>_.includes(q.model_id))||!1,cloud:![$e.WebLLM,$e.Wllama].includes(g)})]}),c.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[c.jsx("span",{className:"font-bold mr-2",children:t("add_llm_card.model_url")}),q.model]}),q.model_lib?c.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[c.jsx("span",{className:"font-bold mr-2",children:t("add_llm_card.model_lib_url")}),q.model_lib]}):void 0,q.overrides&&((ee=Object.keys(q.overrides))!=null&&ee.length)?c.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[c.jsx("span",{className:"font-bold mr-2",children:t("add_llm_card.metadata")}),JSON.stringify(q.overrides)]}):void 0]}):null,re]}),c.jsx(Sr,{className:"flex justify-between",children:c.jsx(rr,{loading:A||s,disabled:!(l!=null&&l.length),onClick:oe,className:"w-full",children:t(S?"add_llm_card.button_add":"add_llm_card.button_download_and_add")})})]})}const jl=()=>{const e=rt(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[r,a]=b.useState(!1),t=ve(i=>i.createOrUpdateFlowNode),n=b.useCallback(async(i,s)=>{var o,l,u;try{if(!i||!e)throw new Error("Source or Session not found");a(!0);const d=((o=i.position)==null?void 0:o.x)||0,p=(((l=i.position)==null?void 0:l.y)||0)+(((u=i.measured)==null?void 0:u.height)||0),h=await he("Prompt").save({content:s.content,prefix:s.prefix,role:s.role||$t.System,status:Mt.Started,session_id:e,type:s.type||Ot.Chat});if(!h)throw new Error("Failed to save prompt");if(!await t({source_id:h.id,source_type:"Prompt",node_type:Q.Prompt,x:d,y:p+20}))throw new Error("Failed to save prompt node")}finally{a(!1)}},[e,t]);return{loading:r,createPrompt:n}},pf={[Ot.Chat]:{label:"add_prompt_card.prompt_types.chat",value:Ot.Chat},[Ot.FewShotExample]:{label:"add_prompt_card.prompt_types.few_shot_example",value:Ot.FewShotExample}},mf={[$t.System]:{label:"add_prompt_card.prompt_roles.system",value:$t.System},[$t.Human]:{label:"add_prompt_card.prompt_roles.human",value:$t.Human},[$t.AI]:{label:"add_prompt_card.prompt_roles.ai",value:$t.AI}},fs=b.memo(({defaultPromptContent:e,defaultPromptRole:r,defaultPromptType:a,hidePromptRole:t,hidePromptType:n,loading:i,onSubmit:s})=>{const[o,l]=b.useState(e||""),[u,d]=b.useState(a||Ot.Chat),[p,h]=b.useState(r),[v,f]=b.useState(""),{t:m}=Te("components"),g=b.useCallback(E=>{l(E.target.value)},[]),w=b.useCallback(E=>{f(E.target.value)},[]),S=b.useCallback(E=>{E===Ot.FewShotExample&&l(`Question: {input}
Answer: {output}`),d(E)},[]),O=b.useCallback(E=>{h(E)},[]),x=async()=>{await s({content:o,role:p,prefix:v,type:u})&&(l(""),h(void 0),d("chat"),f(""))};return c.jsxs("div",{children:[c.jsxs("div",{className:"grid w-full gap-1.5",children:[n?void 0:c.jsxs(c.Fragment,{children:[c.jsx(je,{children:m("add_prompt_card.prompt_type")}),c.jsxs(cr,{value:u,onValueChange:S,children:[c.jsx(dr,{className:"w-full mb-4",children:c.jsx(ur,{placeholder:m("add_prompt_card.type_select_placeholder")})}),c.jsx(hr,{children:Object.values(pf).map(E=>c.jsx(Nt,{value:E.value,children:m(E.label)},E.value))})]})]}),t?void 0:c.jsxs(c.Fragment,{children:[c.jsx(je,{children:m("add_prompt_card.prompt_role")}),c.jsxs(cr,{value:p,onValueChange:O,children:[c.jsx(dr,{className:"w-full mb-4",children:c.jsx(ur,{placeholder:m("add_prompt_card.role_select_placeholder")})}),c.jsx(hr,{children:Object.values(mf).map(E=>c.jsx(Nt,{value:E.value,children:m(E.label)},E.value))})]})]}),u===Ot.FewShotExample&&c.jsxs(c.Fragment,{children:[c.jsx(je,{children:m("add_prompt_card.prompt_prefix")}),c.jsx(Ba,{value:v,onChange:w,disabled:!1,className:"h-20",placeholder:m("add_prompt_card.placeholder"),id:"message"}),c.jsx(je,{children:m("add_prompt_card.prompt_content")}),c.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm justify-end items-center",children:[c.jsx(_e,{name:"info",className:"mr-2",size:14}),m("add_prompt_card.few_shot_example_note")]})]}),c.jsx(Ba,{value:o,onChange:g,disabled:!1,placeholder:m("add_prompt_card.placeholder"),id:"message"})]}),c.jsx("div",{children:c.jsx(rr,{loading:i,disabled:!(o!=null&&o.length),onClick:x,className:"w-full mt-4",children:m("add_prompt_card.button")})})]})}),ff=b.memo(e=>{const{id:r,thread:a,setDialog:t}=e,{t:n}=Te("components"),{toast:i}=Pt(),s=mt(r),{createPrompt:o,loading:l}=jl(),u=async d=>{if(s)try{if(!(d!=null&&d.content))throw new Error("Prompt data is missing");await o(s,{...d,content:d.content,thread:a}),t==null||t(!1)}catch(p){i({variant:"destructive",title:`${p}`})}};return c.jsxs(it,{className:"mw-full",children:[c.jsx(ft,{children:c.jsx(xt,{children:n("add_prompt_card.title")})}),c.jsx(vt,{children:c.jsx(fs,{onSubmit:u,loading:l,defaultPromptRole:"system",defaultPromptType:"chat"})})]})}),vf=()=>{const e=rt(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=b.useState(!1),t=ve(s=>s.createOrUpdateFlowNode),n=b.useCallback((s,o,l,u)=>{var d;if(e){for(const p of o)(d=p.data)!=null&&d.length?n(s,p.data,l,p.id):l.push({name:p.name,type:p.type,enum:p.enum?JSON.stringify(p.enum):"",required:p.required,description:p.description,id:p.id||yo(),parent_id:u,schema_id:s,session_id:e});return l}},[e]),i=b.useCallback(async(s,o)=>{var l,u,d;try{if(!s||!e)throw new Error("Source or Session not found");a(!0);const p=((l=s.position)==null?void 0:l.x)||0,h=(((u=s.position)==null?void 0:u.y)||0)+(((d=s.measured)==null?void 0:d.height)||0),v=await he("Schema").save({name:"Untitled Schema",session_id:e});if(!v)throw new Error("Failed to save schema");const f=n(v.id,o,[],void 0);if(!(f!=null&&f.length))throw new Error("Failed to convert schema items");if(await he("SchemaItem").save(f),!await t({source_id:v.id,source_type:"Schema",node_type:Q.Schema,x:p,y:h+20}))throw new Error("Failed to save schema node")}finally{a(!1)}},[e,n,t]);return{loading:r,createSchema:i}},El=b.memo(({setData:e,data:r,id:a})=>{const{t}=Te("components"),[n,i]=b.useState({name:"",description:"",type:"string",required:!1,data:[]}),s=b.useMemo(()=>a&&r.find(m=>m.id===a)||n,[r,n,a]),o=b.useCallback(m=>{m.target.value&&!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(m.target.value)||(a?e(g=>[...g.map(w=>w.id===a?{...w,name:m.target.value||""}:w)]):i(g=>({...g,name:m.target.value||""})))},[a,e]),l=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,description:m.target.value||""}:w)]):i(g=>({...g,description:m.target.value||""}))},[a,e]),u=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,type:m||""}:w)]):i(g=>({...g,type:m||"string"}))},[a,e]),d=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,required:!!m||!1}:w)]):i(g=>({...g,required:!!m||!1}))},[a,e]),p=b.useCallback(m=>{a?e(g=>[...g.map(w=>w.id===a?{...w,enum:m.target.value||""}:w)]):i(g=>({...g,enum:m.target.value||""}))},[a,e]),h=b.useCallback(()=>{if(r.find(m=>m.name===n.name))return ca({variant:"destructive",content:"Name already exists"});n.id=yo(),e(m=>[...m,{...n}]),i({name:"",description:"",type:"string",required:!1,id:yo(),parent:a||void 0,data:[]})},[r,n,e,a]),v=b.useCallback(m=>{e(g=>[...g.map(w=>w.id===a?{...w,data:m(w.data||[])}:w)])},[a,e]),f=["object","array"].includes(s.type);return c.jsxs("div",{className:"w-full p-1",children:[c.jsxs("div",{children:[c.jsx(je,{children:t("add_schema_card.field.name")}),c.jsx(ht,{id:"name",onChange:o,placeholder:t("add_schema_card.field.name_placeholder"),value:(s==null?void 0:s.name)||""})]}),c.jsxs("div",{children:[c.jsx(je,{children:t("add_schema_card.field.description")}),c.jsx(ht,{id:"description",placeholder:t("add_schema_card.field.description_placeholder"),onChange:l,value:(s==null?void 0:s.description)||""})]}),c.jsxs("div",{children:[c.jsx(je,{children:t("add_schema_card.field.type")}),c.jsxs(cr,{onValueChange:u,value:(s==null?void 0:s.type)||"",children:[c.jsx(dr,{children:c.jsx(ur,{placeholder:t("add_schema_card.field.type_placeholder")})}),c.jsxs(hr,{children:[c.jsx(Nt,{value:"string",children:t("add_schema_card.types.string")}),c.jsx(Nt,{value:"boolean",children:t("add_schema_card.types.boolean")}),c.jsx(Nt,{value:"number",children:t("add_schema_card.types.number")}),c.jsx(Nt,{value:"object",children:t("add_schema_card.types.object")}),c.jsx(Nt,{value:"array",children:t("add_schema_card.types.array")})]})]})]}),c.jsxs("div",{className:"flex items-center h-10",children:[c.jsx(je,{children:t("add_schema_card.field.required")}),c.jsx(ms,{className:"ml-2","aria-label":"Select row",onCheckedChange:d,checked:s==null?void 0:s.required})]}),f?c.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[c.jsx(je,{children:t("add_schema_card.children")}),c.jsx(vs,{data:(s==null?void 0:s.data)||[],setData:v})]}):null,(s==null?void 0:s.type)==="enum"?c.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[c.jsx(je,{children:t("add_schema_card.field.enum")}),c.jsx(ht,{id:"enum",onChange:p,placeholder:"Enum"})]}):null,a?null:c.jsx("div",{className:"w-full flex justify-end mt-2",children:c.jsx(We,{variant:"secondary",disabled:!s.name||!s.description||!s.type,onClick:h,className:"w-full",children:t("add_schema_card.field.add_field")})})]})}),vs=b.memo(({data:e,setData:r})=>c.jsxs(Jw,{type:"single",collapsible:!0,children:[e.map(a=>c.jsxs(Xw,{value:`${a.id}`,children:[c.jsx(Yw,{children:a.name}),c.jsx(ex,{children:c.jsx(El,{setData:r,data:e,id:a.id})})]},a.id||"new")),c.jsx(it,{className:"p-2 mt-4",children:c.jsx(El,{setData:r,data:e})})]})),gf=b.memo(e=>{const{t:r}=Te("components"),{id:a}=e,t=mt(a),[n,i]=b.useState([]),{createSchema:s,loading:o}=vf(),l=async()=>{if(t&&(n!=null&&n.length))try{await s(t,n),i([])}catch(u){ca({variant:"destructive",title:`${u}`})}};return c.jsxs(it,{className:"max-w-lg",children:[c.jsx(ft,{children:c.jsx(xt,{children:r("add_schema_card.title")})}),c.jsx(vt,{className:"min-w-96",children:c.jsx(vs,{setData:i,data:n})}),c.jsx(Sr,{className:"flex justify-between",children:c.jsx(rr,{loading:o,disabled:!(n!=null&&n.length),onClick:l,className:"w-full",children:r("add_schema_card.create")})})]})}),Sl=()=>{const e=rt(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[r,a]=b.useState(!1),t=ve(i=>i.createOrUpdateFlowNode),n=b.useCallback(async(i,s,o)=>{var l,u,d;try{if(!i||!e)throw new Error("Source or Session not found");a(!0);const p=((l=i.position)==null?void 0:l.x)||0,h=(((u=i.position)==null?void 0:u.y)||0)+(((d=i.measured)==null?void 0:d.height)||0),v=e1(s,o),f=await he("CSVData").save({headers:v.headers,csv:v.data,session_id:e});if(!f)throw new Error("Failed to save");if(!await t({source_id:f.id,source_type:"CSVData",node_type:Q.CSVData,x:p,y:h+20}))throw new Error("Failed to save node")}finally{a(!1)}},[e,t]);return{loading:r,createCSVData:n}};function yf({data:e}){const{t:r}=Te("components");return c.jsxs(Uh,{className:"w-full",children:[c.jsx(Hh,{children:c.jsxs(zn,{children:[c.jsx(ho,{children:r("add_few_shot_example_card.input")}),c.jsx(ho,{children:r("add_few_shot_example_card.output")})]})}),c.jsx(Vh,{children:e==null?void 0:e.map((a,t)=>c.jsxs(zn,{children:[c.jsx(po,{className:"p-4",children:a.input}),c.jsx(po,{className:"p-4",children:a.output})]},`${a.input}_${a.output}_${t}`))})]})}const _f=b.memo(e=>{const{id:r}=e,{t:a}=Te("components"),[t,n]=b.useState([]),[i,s]=b.useState(""),[o,l]=b.useState(""),u=mt(r),{createCSVData:d,loading:p}=Sl(),h=()=>{n(f=>[...f,{input:i,output:o}]),s(""),l("")},v=async()=>{u&&await d(u,["input","output"],t.map(f=>[f.input,f.output]))};return c.jsxs(it,{className:"mw-full",children:[c.jsx(ft,{children:c.jsx(xt,{children:a("add_few_shot_example_card.title")})}),c.jsxs(vt,{children:[c.jsxs("div",{className:"flex flex-col space-y-1.5",children:[c.jsx(je,{htmlFor:"name",children:a("add_few_shot_example_card.input")}),c.jsx(ht,{value:i,onChange:f=>s(f.target.value||""),id:"name",placeholder:a("add_few_shot_example_card.input_placeholder")})]}),c.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[c.jsx(je,{htmlFor:"name",children:a("add_few_shot_example_card.output")}),c.jsx(Ba,{value:o,onChange:f=>l(f.target.value||""),placeholder:a("add_few_shot_example_card.output_placeholder")})]}),c.jsx("div",{className:"w-full flex mt-4 justify-end",children:c.jsx(We,{disabled:!i||!o,onClick:h,className:"w-40",children:a("add_few_shot_example_card.add")})}),c.jsx(yf,{data:t||[]})]}),c.jsx(Sr,{className:"flex justify-between",children:c.jsx(rr,{loading:p,disabled:!(t!=null&&t.length),onClick:v,className:"w-full",children:a("add_few_shot_example_card.create")})})]})}),bf=()=>{const e=rt(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=b.useState(!1),t=ve(s=>s.createOrUpdateFlowNode),n=ve(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async(s,o,l)=>{var u,d,p;try{if(!s||!e)throw new Error("Source or Session not found");if(!o.name||!o.description)throw new Error("Name is required");a(!0);const h=((u=s.position)==null?void 0:u.x)||0,v=(((d=s.position)==null?void 0:d.y)||0)+(((p=s.measured)==null?void 0:p.height)||0),f=await he("ToolDefinition").save({...o,name:`${o.name}`,description:`${o.description}`,session_id:e});if(!f)throw new Error("Failed create tool.");const m=await t({source_id:f.id,source_type:"ToolDefinition",node_type:Q.ToolDefinition,x:h,y:v+20});if(!m)throw new Error("Failed to save node");l!=null&&l.schemaNode&&await n({source:l.schemaNode.id,target:m.id})}finally{a(!1)}},[e,t,n]);return{loading:r,createTool:i}},wf=b.memo(e=>{const{t:r}=Te("components"),{toast:a}=Pt(),{id:t}=e,n=mt(t),[i,s]=b.useState(""),[o,l]=b.useState(""),[u,d]=b.useState([]),{createTool:p,loading:h}=bf(),v=g=>{s(g.target.value)},f=g=>{l(g.target.value)},m=async()=>{if(n&&i&&o)try{await p(n,{name:i,description:o}),s(""),l("")}catch(g){Hw("Create Tool",g),a({variant:"destructive",title:r("add_tool_card.errors.create_tool_failed")})}};return c.jsxs(it,{className:"mw-full",children:[c.jsx(ft,{children:c.jsx(xt,{children:r("add_tool_card.title")})}),c.jsxs(vt,{children:[c.jsxs("div",{className:"flex flex-col space-y-1.5",children:[c.jsx(je,{htmlFor:"name",children:r("add_tool_card.tool_name")}),c.jsx(ht,{onChange:v,id:"name",placeholder:r("add_tool_card.name_placeholder")})]}),c.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[c.jsx(je,{htmlFor:"name",children:r("add_tool_card.tool_description")}),c.jsx(Ba,{onChange:f,placeholder:r("add_tool_card.description_placeholder")})]}),c.jsx("div",{children:c.jsx(vs,{data:u,setData:d})})]}),c.jsx(Sr,{className:"flex justify-between",children:c.jsx(rr,{loading:h,onClick:m,className:"w-full",children:r("add_tool_card.create")})})]})}),xf=()=>{const e=rt(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=b.useState(!1),t=ve(s=>s.createOrUpdateFlowNode),n=ve(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async(s,o,l)=>{var u,d,p;try{if(!(o!=null&&o.name)||!s||!e)throw new Error("Source or Session not found");a(!0);const h=((u=s.position)==null?void 0:u.x)||0,v=(((d=s.position)==null?void 0:d.y)||0)+(((p=s.measured)==null?void 0:p.height)||0),f=await he("VectorDatabase").save({...o,name:`${o.name}`,type:o.type||t1.Local,storage:o.storage||kr.DatabaseNode,raw:"",provider:o.provider||ap.Memory,session_id:e,metadata:l?JSON.stringify({textSplitter:l}):void 0});if(!f)throw new Error("Failed to save vectorDatabase");const m=await t({source_id:f.id,source_type:"VectorDatabase",node_type:Q.VectorDatabase,x:h,y:v+30});if(!m)throw new Error("Failed to save vectorDatabase node");if(o.storage===kr.DataNode){const g=await he("JSONLData").save({headers:r1(["content","embedding","metadata"]),jsonl:"",session_id:e});if(!g)throw new Error("Failed to save databaseSource");const w=await t({source_id:g.id,source_type:"JSONLData",node_type:Q.JSONLData,x:h+80,y:v+30});if(!w)throw new Error("Failed to save databaseSource node");await n({source:w.id,target:m.id})}return{vectorDatabase:f,vectorDatabaseNode:m}}finally{a(!1)}},[e,t,n]);return{loading:r,createVectorDatabase:i}},wa=[ap.Memory],xa=[kr.DatabaseNode],jf=["TokenTextSplitter","CharacterTextSplitter","RecursiveCharacterTextSplitter"],Ef=b.memo(e=>{const{t:r}=Te("components"),{id:a}=e,t=mt(a),{toast:n}=Pt(),[i,s]=b.useState(""),[o,l]=b.useState(wa[0]),[u,d]=b.useState(xa[0]),[p,h]=b.useState({}),{loading:v,createVectorDatabase:f}=xf(),m=b.useCallback($=>{l($)},[]),g=b.useCallback($=>{d($)},[]),w=b.useCallback($=>{h(N=>({...N,type:$,chunkSize:500,chunkOverlap:40}))},[]),S=b.useCallback($=>{s($.target.value||"")},[]),O=b.useCallback($=>{h(N=>({...N,chunkSize:Number($.target.value)}))},[]),x=b.useCallback($=>{h(N=>({...N,chunkOverlap:Number($.target.value)}))},[]),E=async()=>{try{if(!t)return;await f(t,{name:i,provider:o,storage:u},p!=null&&p.type?{type:p.type,chunkSize:p.chunkSize||500,chunkOverlap:p.chunkOverlap||0}:void 0),s(""),h({})}catch{n({variant:"destructive",description:r("create_vector_database_card.errors.create_failed")})}};return c.jsxs(it,{className:"mw-full",children:[c.jsx(ft,{children:c.jsx(xt,{children:r("create_vector_database_card.title")})}),c.jsx(vt,{children:c.jsxs("div",{className:"grid w-full gap-1.5",children:[c.jsx(je,{children:r("create_vector_database_card.name")}),c.jsx(ht,{className:"mb-4",value:i,onChange:S}),(xa==null?void 0:xa.length)>1?c.jsxs(c.Fragment,{children:[c.jsx(je,{children:r("create_vector_database_card.storage_type")}),c.jsxs(cr,{value:u,onValueChange:g,children:[c.jsx(dr,{className:"w-full mb-4",children:c.jsx(ur,{placeholder:r("create_vector_database_card.provider_select_placeholder")})}),c.jsx(hr,{children:Object.values(xa).map($=>c.jsx(Nt,{value:$,children:r(`create_vector_database_card.storage_types.${$.toLowerCase()}`)},$))})]})]}):void 0,(wa==null?void 0:wa.length)>1?c.jsxs(c.Fragment,{children:[c.jsx(je,{children:r("create_vector_database_card.provider")}),c.jsxs(cr,{value:o,onValueChange:m,children:[c.jsx(dr,{className:"w-full mb-4",children:c.jsx(ur,{placeholder:r("create_vector_database_card.provider_select_placeholder")})}),c.jsx(hr,{children:Object.values(wa).map($=>c.jsx(Nt,{value:$,children:r(`create_vector_database_card.providers.${$.toLowerCase()}`)},$))})]})]}):void 0,c.jsx(je,{children:r("create_vector_database_card.text_splitter")}),c.jsxs(cr,{value:p.type,onValueChange:w,children:[c.jsx(dr,{className:"w-full mb-4",children:c.jsx(ur,{placeholder:r("create_vector_database_card.text_splitter_select_placeholder")})}),c.jsx(hr,{children:Object.values(jf).map($=>c.jsx(Nt,{value:$,children:r(`create_vector_database_card.text_splitters.${$.toLowerCase()}`)},$))})]}),p.type?c.jsxs(it,{children:[c.jsx(ft,{children:c.jsx(xt,{children:r("create_vector_database_card.text_splitter_configuration")})}),c.jsxs(vt,{children:[c.jsx(je,{children:r("create_vector_database_card.text_splitter_chunksize")}),c.jsx(ht,{value:p.chunkSize,onChange:O,placeholder:r("create_vector_database_card.text_splitter_chunksize_placeholder")}),c.jsx(je,{children:r("create_vector_database_card.text_splitter_chunkoverlap")}),c.jsx(ht,{value:p.chunkOverlap,onChange:x,placeholder:r("create_vector_database_card.text_splitter_chunkoverlap_placeholder")})]})]}):void 0]})}),c.jsx(Sr,{className:"flex justify-between",children:c.jsx(rr,{disabled:!p.type||!i,loading:v,onClick:E,className:"w-full",children:r("create_vector_database_card.create")})})]})});function Sf({data:e}){const{t:r}=Te("components");return c.jsxs(Uh,{className:"w-full",children:[c.jsx(Hh,{children:c.jsx(zn,{children:c.jsx(ho,{children:r("add_text_data.text")})})}),c.jsx(Vh,{children:e==null?void 0:e.map((a,t)=>c.jsx(zn,{children:c.jsx(po,{className:"p-4",children:a.text})},`${a.text}_${t}`))})]})}const kf=b.memo(e=>{const{id:r}=e,{t:a}=Te("components"),[t,n]=b.useState([]),[i,s]=b.useState(""),o=mt(r),{createCSVData:l,loading:u}=Sl(),d=()=>{n(h=>[...h,{text:i}]),s("")},p=async()=>{o&&await l(o,["text"],t.map(h=>[h.text]))};return c.jsxs(it,{className:"mw-full",children:[c.jsx(ft,{children:c.jsx(xt,{children:a("add_text_data.title")})}),c.jsxs(vt,{children:[c.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[c.jsx(je,{htmlFor:"name",children:a("add_text_data.text")}),c.jsx(Ba,{value:i,onChange:h=>s(h.target.value||""),placeholder:a("add_text_data.text_placeholder")})]}),c.jsx("div",{className:"w-full flex mt-4 justify-end",children:c.jsx(We,{disabled:!i,onClick:d,className:"w-40",children:a("add_text_data.add")})}),c.jsx(Sf,{data:t||[]})]}),c.jsx(Sr,{className:"flex justify-between",children:c.jsx(rr,{loading:u,disabled:!(t!=null&&t.length),onClick:p,className:"w-full",children:a("add_text_data.create")})})]})});var Wt=(e=>(e.ADD_LLM="ADD_LLM",e.ADD_PROMPT="ADD_PROMPT",e.ADD_TOOL_DEFINITION="ADD_TOOL_DEFINITION",e.ADD_SCHEMA="ADD_SCHEMA",e.ADD_FEW_SHOT_EXAMPLE="ADD_FEW_SHOT_EXAMPLE",e.ADD_VECTOR_DATABASE="ADD_VECTOR_DATABASE",e.ADD_TEXT_DATA="ADD_TEXT_DATA",e.ADD_MCP="ADD_MCP",e))(Wt||{});const Cf=["ADD_LLM","ADD_PROMPT","ADD_SCHEMA","ADD_VECTOR_DATABASE","ADD_MCP",{key:"more",label:"more",icon:"ellipsis",children:["ADD_TOOL_DEFINITION","ADD_FEW_SHOT_EXAMPLE"]}],Pf=()=>{const e="_coolMode_effect",r=document.getElementById(e);if(r)return r;const a=document.createElement("div");return a.setAttribute("id",e),a.setAttribute("style","overflow:hidden; position:fixed; height:100%; top:0; left:0; right:0; bottom:0; pointer-events:none; z-index:2147483647"),document.body.appendChild(a),a};let kl=0;const Nf=(e,r)=>{kl++;const a=(r==null?void 0:r.particle)||"circle",t=[15,20,25,35,45],n=45;let i=[],s=!1,o=0,l=0;const u=Pf();function d(){const N=(r==null?void 0:r.size)||t[Math.floor(Math.random()*t.length)],T=(r==null?void 0:r.speedHorz)||Math.random()*10,D=(r==null?void 0:r.speedUp)||Math.random()*25,A=Math.random()*360,R=Math.random()*35*(Math.random()<=.5?-1:1),z=l-N/2,U=o-N/2,M=Math.random()<=.5?-1:1,q=document.createElement("div");if(a==="circle"){const J="http://www.w3.org/2000/svg",Y=document.createElementNS(J,"svg"),se=document.createElementNS(J,"circle");se.setAttributeNS(null,"cx",(N/2).toString()),se.setAttributeNS(null,"cy",(N/2).toString()),se.setAttributeNS(null,"r",(N/2).toString()),se.setAttributeNS(null,"fill",`hsl(${Math.random()*360}, 70%, 50%)`),Y.appendChild(se),Y.setAttribute("width",N.toString()),Y.setAttribute("height",N.toString()),q.appendChild(Y)}else q.innerHTML=`<img src="${a}" width="${N}" height="${N}" style="border-radius: 50%">`;q.style.position="absolute",q.style.transform=`translate3d(${U}px, ${z}px, 0px) rotate(${A}deg)`,u.appendChild(q),i.push({direction:M,element:q,left:U,size:N,speedHorz:T,speedUp:D,spinSpeed:R,spinVal:A,top:z})}function p(){i.forEach(N=>{N.left=N.left-N.speedHorz*N.direction,N.top=N.top-N.speedUp,N.speedUp=Math.min(N.size,N.speedUp-1),N.spinVal=N.spinVal+N.spinSpeed,N.top>=Math.max(window.innerHeight,document.body.clientHeight)+N.size&&(i=i.filter(T=>T!==N),N.element.remove()),N.element.setAttribute("style",["position:absolute","will-change:transform",`top:${N.top}px`,`left:${N.left}px`,`transform:rotate(${N.spinVal}deg)`].join(";"))})}let h,v=0;const f=30;function m(){const N=performance.now();s&&i.length<n&&N-v>f&&(d(),v=N),p(),h=requestAnimationFrame(m)}m();const g="ontouchstart"in window,w=g?"touchstart":"mousedown",S=g?"touchend":"mouseup",O=g?"touchmove":"mousemove",x=N=>{var T,D;"touches"in N?(o=(T=N.touches)==null?void 0:T[0].clientX,l=(D=N.touches)==null?void 0:D[0].clientY):(o=N.clientX,l=N.clientY)},E=N=>{x(N),s=!0},$=()=>{s=!1};return e.addEventListener(O,x,{passive:!0}),e.addEventListener(w,E,{passive:!0}),e.addEventListener(S,$,{passive:!0}),e.addEventListener("mouseleave",$,{passive:!0}),()=>{e.removeEventListener(O,x),e.removeEventListener(w,E),e.removeEventListener(S,$),e.removeEventListener("mouseleave",$);const N=setInterval(()=>{h&&i.length===0&&(cancelAnimationFrame(h),clearInterval(N),--kl===0&&u.remove())},500)}},$f=({children:e,options:r})=>{const a=b.useRef(null);return b.useEffect(()=>{if(a.current)return Nf(a.current,r)},[r]),za.cloneElement(e,{ref:a})},Of=b.memo(({loading:e,onSubmit:r})=>{const[a,t]=b.useState(""),[n,i]=b.useState(""),{t:s}=Te("components"),o=async()=>{await r({key:a,url:n})&&(t(""),i(""))};return c.jsxs("div",{children:[c.jsxs("div",{className:"grid w-full gap-1.5",children:[c.jsx(je,{className:"mb-2",children:s("add_mcp_card.key")}),c.jsx(ht,{disabled:e,value:a||"",onChange:l=>t(l.target.value||""),className:"!text-foreground"}),c.jsx(je,{className:"mb-2",children:s("add_mcp_card.url")}),c.jsx(ht,{disabled:e,value:n||"",onChange:l=>i(l.target.value||""),className:"!text-foreground"})]}),c.jsx("div",{children:c.jsx(rr,{loading:e,disabled:!(a!=null&&a.length)||!(n!=null&&n.length),onClick:o,className:"w-full mt-4",children:s("add_mcp_card.button")})})]})}),Rf=()=>{const e=rt(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[r,a]=b.useState(!1),t=ve(i=>i.createOrUpdateFlowNode),n=b.useCallback(async(i,s)=>{var o,l,u;try{if(!i||!e)throw new Error("Source or Session not found");if(!s.key||!s.url)throw new Error("MCP data is missing");a(!0);const d=((o=i.position)==null?void 0:o.x)||0,p=(((l=i.position)==null?void 0:l.y)||0)+(((u=i.measured)==null?void 0:u.height)||0),h=await he("Mcp").save({key:s.key,url:s.url,session_id:e});if(!h)throw new Error("Failed to save MCP");if(!await t({source_id:h.id,source_type:"Mcp",node_type:Q.MCP,x:d,y:p+20}))throw new Error("Failed to save MCP node")}finally{a(!1)}},[e,t]);return{loading:r,createMcp:n}},If=b.memo(e=>{const{id:r,setDialog:a}=e,{t}=Te("components"),{toast:n}=Pt(),i=mt(r),{createMcp:s,loading:o}=Rf(),l=async u=>{if(i)try{if(!(u!=null&&u.url)||!(u!=null&&u.key))throw new Error("MCP data is missing");await s(i,u),a==null||a(!1)}catch(d){n({variant:"destructive",title:`${d}`})}};return c.jsxs(it,{className:"mw-full",children:[c.jsx(ft,{children:c.jsx(xt,{children:t("add_mcp_card.title")})}),c.jsxs(vt,{className:"max-w-lg nodrag nowheel",children:[c.jsx(Of,{onSubmit:l,loading:o}),c.jsx(fp,{className:"mt-4 mb-2"}),c.jsx(je,{className:"text-lg",children:t("add_mcp_card.faq")}),c.jsx(fp,{className:"mb-4 mt-2"}),c.jsx(Va,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(qa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(je,{children:t("add_mcp_card.note.title")})}),c.jsx("div",{children:c.jsx(_e,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Za,{children:c.jsx(da,{source:t("add_mcp_card.note.detail")})})]})}),c.jsx(Va,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(qa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(je,{children:t("add_mcp_card.filesystem.title")})}),c.jsx("div",{children:c.jsx(_e,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Za,{children:c.jsx(da,{source:t("add_mcp_card.filesystem.detail")})})]})}),c.jsx(Va,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(qa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(je,{children:t("add_mcp_card.memory.title")})}),c.jsx("div",{children:c.jsx(_e,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Za,{children:c.jsx(da,{source:t("add_mcp_card.memory.detail")})})]})}),c.jsx(Va,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(qa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(je,{children:t("add_mcp_card.playwright.title")})}),c.jsx("div",{children:c.jsx(_e,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Za,{children:c.jsx(da,{source:t("add_mcp_card.playwright.detail")})})]})}),c.jsx(Va,{asChild:!0,className:"group/collapsible",children:c.jsxs("div",{children:[c.jsx(qa,{asChild:!0,children:c.jsxs("div",{className:"flex justify-between py-2",children:[c.jsx("div",{children:c.jsx(je,{children:t("add_mcp_card.figma.title")})}),c.jsx("div",{children:c.jsx(_e,{name:"chevron-down",className:"h-4 w-4"})})]})}),c.jsx(Za,{children:c.jsx(da,{source:t("add_mcp_card.figma.detail")})})]})})]})]})}),Tf=b.memo(e=>{const{t:r}=Te("flows"),a=Th(o=>o.theme),[t,n]=b.useState(`${Wt.ADD_LLM}`),i=b.useMemo(()=>c.jsxs(ll,{children:[c.jsx(ss,{children:c.jsx($f,{children:c.jsx(We,{variant:"link",className:"!p-0 !pl-3",children:c.jsx(Vw,{width:32,height:32,className:Me(a==="dark"?"fill-white":"fill-black")})})})}),Cf.map(o=>typeof o=="object"?c.jsxs(ss,{children:[c.jsx(is,{children:o.icon?c.jsx(_e,{name:o.icon}):r(`supported_nodes.${o.label}`)}),c.jsx(cl,{children:o.children.map(l=>c.jsx(dl,{onClick:()=>n(l),children:r(`supported_nodes.${l.toLowerCase()}`)},l))})]},o.key):c.jsx(ss,{children:c.jsx(is,{value:o,onClick:()=>n(o),children:r(`supported_nodes.${o.toLowerCase()}`)})},o))]}),[r,a]),s=b.useMemo(()=>{switch(t){case Wt.ADD_LLM:return c.jsx(hf,{...e});case Wt.ADD_PROMPT:return c.jsx(ff,{...e});case Wt.ADD_SCHEMA:return c.jsx(gf,{...e});case Wt.ADD_FEW_SHOT_EXAMPLE:return c.jsx(_f,{...e});case Wt.ADD_TOOL_DEFINITION:return c.jsx(wf,{...e});case Wt.ADD_VECTOR_DATABASE:return c.jsx(Ef,{...e});case Wt.ADD_TEXT_DATA:return c.jsx(kf,{...e});case Wt.ADD_MCP:return c.jsx(If,{...e})}},[e,t]);return c.jsxs(c.Fragment,{children:[i,c.jsx("div",{className:"mt-4",children:s})]})}),Af=()=>{const[e,r]=b.useState(!1),a=a1(),t=rt(s=>s.currentSession),n=b.useCallback(async(s,o,l,u)=>{var h;const d=(h=o.data)==null?void 0:h.entity;let p=o.type?n1[o.type]:void 0;if(p&&d&&o&&typeof d=="object"&&"id"in d&&!l.has(`${d.id}`)&&!u.has(`${o.id}`)){p=p;const v=await he(p).save({...d,...d&&typeof d=="object"&&"session_id"in d?{session_id:s.id}:{}});l.set(`${d.id}`,v.id);const f=await he("FlowNode").findOne({where:{id:o.data.flowNode.id}}),m=await he("FlowNode").save({...f||o.data.flowNode,session_id:s.id,id:void 0,source_type:p,source_id:v.id});return u.set(`${o.id}`,m.id),{entityName:p,entity:v,node:m}}else if(!u.has(`${o.id}`)){const v=await he("FlowNode").findOne({where:{id:o.data.flowNode.id}}),f=await he("FlowNode").save({...v||o.data.flowNode,node_type:o.type,session_id:s.id,id:void 0});return u.set(`${o.id}`,f.id),{node:f}}},[]),i=b.useCallback(async(s,o)=>{try{if(!t)throw new Error("No current session");r(!0);const l=await he("Session").save({type:i1.StandaloneApp,name:o.name||(t!=null&&t.name?`${t.name}`:"Standalone"),status:s1.Started,passphrase:t.passphrase});if(!l)throw new Error("Failed create standalone session");const u=new Map,d=new Map,p=await n(l,s,u,d);if(!p)throw new Error("Failed to clone main node");await he("Session").update(l.id,{main_node_id:p.node.id,main_source_id:p!=null&&p.entity?p.entity.id:void 0,main_source_type:p.entityName?p.entityName:void 0});for(const{node:h,connectedNodes:v}of o.connections)if(await n(l,h,u,d),v)for(const f of v)await n(l,f,u,d);for(const{connections:h}of o.connections)for(const v of h){const f=d.get(`${v.source}`),m=d.get(`${v.target}`);if(!f||!m)throw new Error("Failed to get connected flow node id");await he("FlowEdge").save({source:f,target:m,sourceHandle:v.sourceHandle,targetHandle:v.targetHandle,session_id:l.id})}return a(o1("application",{applicationId:l.id})),!0}finally{r(!1)}},[n,t,a]);return{loading:e,createStandaloneSession:i}},Lf=()=>{const[e,r]=b.useState(!1),a=ve(i=>i.updateNodes),t=ve(i=>i.updateEdges),n=b.useCallback(async i=>{try{r(!0),await he("FlowNode").delete(i);const s=await he("FlowEdge").find({where:[{source:i},{target:i}]});return await Promise.all(s.map(o=>he("FlowEdge").delete(o.id))),await a([{id:i,type:"remove"}]),await t(s.map(o=>({id:o.id,type:"remove"}))),!0}catch{return!1}finally{r(!1)}},[t,a]);return{loading:e,deleteNodeFlow:n}},Ff=Fn(({cloneStandaloneSession:e})=>{const r=Er(),{t:a}=Te("dialogs"),[t,n]=b.useState(""),{toast:i}=Pt(),s=l=>{n(l.target.value)},o=async()=>{try{r.hide(),await e(t),n("")}catch{i({variant:"destructive",description:a("create_standalone_application.errors.create_failed")})}};return c.jsx(Vn,{open:r.visible,onOpenChange:r.hide,children:c.jsxs(qn,{className:"sm:max-w-[425px]",children:[c.jsxs(Zn,{children:[c.jsx(Bn,{children:a("create_session.title")}),c.jsx(tp,{children:a("create_standalone_application.description")})]}),c.jsx("div",{className:"grid gap-4 py-4",children:c.jsxs("div",{className:"flex flex-col space-y-1.5",children:[c.jsx(je,{className:"mb-2",htmlFor:"name",children:a("create_standalone_application.name")}),c.jsx(ht,{onChange:s,id:"name",value:t,placeholder:a("create_standalone_application.name_placeholder")})]})}),c.jsx(rp,{children:c.jsx(We,{onClick:o,disabled:!t,type:"submit",children:a("create_standalone_application.create")})})]})})}),yt=b.memo(({id:e,className:r,enableToStandalone:a,getLinkedConnections:t})=>{const{t:n}=Te("common"),{getNode:i}=Zt(),{loading:s,deleteNodeFlow:o}=Lf(),{createStandaloneSession:l}=Af(),{toast:u}=Pt(),d=Er(Ff),p=b.useCallback(async()=>{try{await o(e),u({description:n("deleted")})}catch{u({description:n("errors.delete_failed"),variant:"destructive"})}},[o,e,u,n]),h=b.useCallback(async f=>{try{const m=i(e);if(!m)throw new Error("No current node");const g=(t==null?void 0:t(e))||[];await l(m,{name:f,connections:g}),u({description:n("standalone_session_created")})}catch(m){Dn("Clone Standalone Session",m),u({description:n("errors.create_standalone_session_failed"),variant:"destructive"})}},[i,e,t,l,u,n]),v=b.useCallback(()=>{d.show({cloneStandaloneSession:h})},[h,d]);return c.jsxs("div",{className:Me("flex absolute z-[51] right-0 top-0 h-10",r),children:[a?c.jsx(We,{className:"!rounded-none !px-2",onClick:v,variant:"ghost",children:c.jsx(_e,{name:"package-plus",size:16})}):void 0,c.jsx(rr,{loading:s,className:"!rounded-none !px-2",onClick:p,variant:"ghost",children:c.jsx(_e,{name:"trash-2",size:16})})]})}),Ve=b.memo(e=>{const{className:r,...a}=e;return c.jsx(tx,{className:Me("!w-2 !h-2 !border-none !rounded-full !bg-slate-700",e.position===He.Top?"!top-[-2px]":"",r),...a})}),Df=()=>{const e=rt(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=b.useState(!1),t=ve(s=>s.createOrUpdateFlowNode),n=ve(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async s=>{var o,l;a(!0);try{const u=(o=s.data)==null?void 0:o.entity;if(!u||!e)throw new Error("LLM or Session not found");const d=s.position.x,p=s.position.y+(((l=s.measured)==null?void 0:l.height)||0),h=await he("Thread").save({initial_llm_id:u.id,title:`New thread with ${u.name}`,status:Wa.Started,messages:[],session_id:e}),v=await t({source_id:h.id,source_type:"Thread",node_type:Q.Thread,x:d,y:p+60});if(!v)throw new Error("Failed to create thread node");const f=await n({source:s.id,target:v.id});return{thread:h,flowNode:v,flowEdge:f}}finally{a(!1)}},[n,t,e]);return{loading:r,createThread:i}},Mf=(e,r)=>{var O;const{t:a}=Te("flows"),{toast:t}=Pt(),[n,i]=b.useState(!1),[s,o]=b.useState(!1),l=mt(e),{loadModel:u}=g1(),{createThread:d,loading:p}=Df(),h=ve(x=>x.updateNodes),v=ve(x=>x.pushSyncNodeQueue),{getNodes:f}=Zt(),m=b.useCallback(async()=>{try{if(o(!0),r.entity.id){const x=await he("Thread").find({where:{initial_llm_id:r.entity.id}});v("Thread",{where:{source_type:"Thread",source_id:jo(x.map(E=>E.id))}})}}finally{o(!1)}},[(O=r==null?void 0:r.entity)==null?void 0:O.id,v]),g=b.useCallback(async()=>{try{if(i(!0),r.entity&&l){await(u==null?void 0:u(r.entity.provider,`${r.entity.name}`,{provider:r.entity.provider,callback:E=>{l.data.status=E.progress===100?jt.Loaded:jt.Loading,l.data.label=E.text,h([{id:e,type:"replace",item:l}])}}));const x=f().filter(E=>E.type===Q.LLM?E.data.entity.provider===$e.WebLLM:!1).map(E=>(E.data.status=jt.Started,{id:E.id,type:"replace",item:E}));l.data.label="",l.data.status=jt.Loaded,x.push({id:e,type:"replace",item:l}),h(x),await m()}}catch(x){Dn("Load Model",x),t({variant:"destructive",description:a("llm_node.errors.loading_model")})}finally{i(!1)}},[r.entity,f,e,u,l,m,a,t,h]),w=b.useCallback(async()=>{r.entity&&l&&await(d==null?void 0:d(l))},[r.entity,l,d]),S=b.useCallback(async x=>{r.entity&&l&&(l.data.entity.options=x,await he("LLM").update(r.entity.id,{options:x}),h([{id:e,type:"replace",item:l}]))},[r.entity,e,l,h]);return b.useEffect(()=>{r.entity&&l&&r.entity.status!==r.status&&(l.data.status=r.entity.status,h([{id:e,type:"replace",item:l}]))},[]),{loadingModel:n,creatingThread:p,queringThreads:s,changeLLMOptions:S,loadModel:g,createThread:w,queryThreads:m}},_t=(e,r)=>{const[a,t]=b.useState(!1),[n,i]=b.useState([]),{deleteElements:s,getNode:o}=Zt();Un({type:"target",nodeId:e,onConnect:u=>{u!=null&&u.length&&i(d=>[...d,...rx(u)])}});const l=b.useCallback(async(u,d,p,h)=>{try{return await r({id:e,edgeId:u,source:d,target:p,connection:h})}catch{return{deleteEdgeId:u}}},[r,e]);b.useEffect(()=>{!(n!=null&&n.length)||a||(async()=>{try{t(!0);const u=[...n];i([]);const d=[],p=o(e);await Promise.all(u.map(async h=>{const v="edgeId"in h?h.edgeId:void 0,f=o(h.source);if(!f||!p)return;const m=await l(`${v}`,f,p,h);m!=null&&m.deleteEdgeId&&d.push(...Array.isArray(m.deleteEdgeId)?m.deleteEdgeId:[m.deleteEdgeId])})),d!=null&&d.length&&await s({edges:d.map(h=>({id:h}))})}finally{t(!1)}})()},[s,o,e,a,l,n])},zf=e=>{const r=b.useCallback(async()=>{},[]);_t(e,r)},Uf=b.memo(e=>{var w,S,O,x,E,$;const{id:r,data:a,isConnectable:t}=e,[n,i]=b.useState(),{t:s}=Te("flows"),{createThread:o,loadModel:l,queringThreads:u,queryThreads:d,loadingModel:p,changeLLMOptions:h}=Mf(r,a);zf(r);const v=[jt.Loading,jt.Downloading].includes(a.status);b.useEffect(()=>{var N,T,D,A,R,z,U,M,q;if(!(n||!((N=a==null?void 0:a.entity)!=null&&N.name))){if([$e.WebLLM,$e.Wllama].includes((T=a==null?void 0:a.entity)==null?void 0:T.provider)){if($e.Wllama===((D=a==null?void 0:a.entity)==null?void 0:D.provider)){Rt(()=>import("./file-tree-C9uE9TJK.js").then(async J=>(await J.__tla,J)).then(J=>J.i),__vite__mapDeps([7,4,2,3])).then(async({ModelManager:J})=>{var se,oe,Se;const Y=await new J().getModels();i({hasCache:!!Y.find(Ce=>{var Z;return Ce.url.includes((Z=a==null?void 0:a.entity)==null?void 0:Z.name)}),cloud:!1,isFunctionCalling:!1,info:{model_id:(se=a==null?void 0:a.entity)==null?void 0:se.name,model:(oe=a==null?void 0:a.entity)==null?void 0:oe.name,model_lib:(Se=a==null?void 0:a.entity)==null?void 0:Se.provider,model_type:2}})}),i({hasCache:!1,cloud:!1,isFunctionCalling:!0,info:{model_id:(A=a==null?void 0:a.entity)==null?void 0:A.name,model:(R=a==null?void 0:a.entity)==null?void 0:R.name,model_lib:(z=a==null?void 0:a.entity)==null?void 0:z.provider,model_type:2}});return}}else{i({hasCache:!1,cloud:!0,isFunctionCalling:!0,info:{model_id:(U=a==null?void 0:a.entity)==null?void 0:U.name,model:(M=a==null?void 0:a.entity)==null?void 0:M.name,model_lib:(q=a==null?void 0:a.entity)==null?void 0:q.provider,model_type:2}});return}Rt(()=>import("./index-DYRICXF3.js").then(async J=>(await J.__tla,J)),__vite__mapDeps([0,1,2,3,4,5,6])).then(async({hasModelInCache:J,functionCallingModelIds:Y,prebuiltAppConfig:se})=>{var Se,Ce;const oe=await J((Se=a==null?void 0:a.entity)==null?void 0:Se.name);i({hasCache:oe,isFunctionCalling:Y.includes((Ce=a==null?void 0:a.entity)==null?void 0:Ce.name),info:se.model_list.find(Z=>{var re;return Z.model_id===((re=a==null?void 0:a.entity)==null?void 0:re.name)})})})}},[(w=a==null?void 0:a.entity)==null?void 0:w.name,(S=a==null?void 0:a.entity)==null?void 0:S.provider,n]);const f=b.useCallback(async N=>{await h(N)},[h]),m=b.useMemo(()=>{var N,T;switch(a.status){case jt.Downloading:return c.jsx(_e,{className:"animate-spin w-7 h-7",name:"arrow-big-down-dash"});case jt.Loaded:return c.jsx(vr,{name:((N=a.entity)==null?void 0:N.name)||"brain",className:"w-7 h-7"});case jt.Loading:return c.jsx(_e,{className:"animate-spin w-7 h-7",name:"loader-circle"});default:return c.jsx(vr,{name:((T=a.entity)==null?void 0:T.name)||"brain",className:"w-7 h-7"})}},[(O=a.entity)==null?void 0:O.name,a.status]),g=b.useMemo(()=>v?null:p?c.jsx(We,{disabled:!0,className:"w-full mt-4",children:c.jsx(_e,{className:"animate-spin",size:24,name:"loader-circle"})}):a.status===jt.Loaded?c.jsx(We,{onClick:o,className:"mt-4 w-full",children:s("llm_node.create_thread_button")}):c.jsxs("div",{className:"flex gap-2 mt-4",children:[n!=null&&n.hasCache?c.jsx(rr,{loading:u,onClick:d,children:c.jsx(_e,{size:24,name:"message-square-more"})}):null,c.jsx(We,{disabled:p,onClick:l,className:"w-full",children:s(n!=null&&n.hasCache?"llm_node.load_model_button":"llm_node.download_model_button")})]}),[v,p,a.status,n==null?void 0:n.hasCache,u,d,l,s,o]);return c.jsxs("div",{children:[c.jsxs("div",{children:[c.jsx(yt,{id:r}),c.jsxs(It,{className:"flex justify-center",children:[m,c.jsxs("div",{className:"ml-2 pt-1 max-w-lg",children:[c.jsx(pr,{className:"flex gap-2 items-center pr-6",children:`${((x=a==null?void 0:a.entity)==null?void 0:x.name)||""}`}),c.jsx(ua,{className:"max-w-full",children:`${a.label||""}`}),c.jsx("div",{className:"max-w-full mt-2 flex-wrap flex gap-1",children:c.jsx(Mn,{model:n==null?void 0:n.info,isFunctionCalling:(n==null?void 0:n.isFunctionCalling)||!1,name:(E=a==null?void 0:a.entity)==null?void 0:E.name,isCached:(n==null?void 0:n.hasCache)||!1,cloud:(n==null?void 0:n.cloud)||!1})}),c.jsx(ax,{options:($=a==null?void 0:a.entity)==null?void 0:$.options,onChangeOptions:f,className:"mt-2"}),g]})]}),v?c.jsx(qh,{className:"rounded-lg"}):void 0]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})}),gs=b.memo(({tags:e,disabled:r,loading:a,onSubmit:t})=>{const{t:n}=Te("components"),i=async s=>{try{return await t(s),!0}catch{return!1}};return c.jsxs(it,{className:"min-w-80",children:[c.jsx(ft,{children:c.jsx(xt,{children:n("add_message_card.title")})}),c.jsxs(vt,{children:[c.jsx("div",{className:"grid w-full gap-1.5",children:c.jsx(x1,{onSubmit:i,disabled:r||a,placeholder:n("add_message_card.placeholder")})}),e?c.jsx("div",{className:"mt-2 gap-1 flex flex-wrap",children:e}):null]})]})}),Cl=(e,r,a,t=[],n)=>{const i=e.map(s=>n.getNode(s));for(const s of i){if(!s)continue;const o=n.getHandleConnections({type:"target",nodeId:s.id});if(a.push(...o),s.type===Q.Thread){t.push(s.id),r.push(s);continue}else if(s.type!==Q.Message){t.push(s.id);continue}else if(t.includes(s.id))continue;t.push(s.id),r.push(s),o.length&&Cl(o.map(l=>l.source),r,a,t,n)}return{nodes:r,connections:a}},Pl=(e,r)=>{const a=r.getHandleConnections({nodeId:e.id,type:"target"}),t=a.map(p=>{const h=r.getNode(p.source);return h?{connections:r.getHandleConnections({nodeId:h.id,type:"target"}),node:h}:void 0}),n=t.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===Q.Prompt}),i=[];n!=null&&n.length&&n.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>r.getNode(f.source)).filter(Boolean);i.push({node:p.node,connections:p.connections,connectedNodes:h})});const s=t.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===Q.ToolDefinition}),o=[];s!=null&&s.length&&s.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>r.getNode(f.source)).filter(Boolean);h!=null&&h.find(f=>f.type===Q.Schema)&&o.push({node:p.node,connections:p.connections,connectedNodes:h})});const l=t.filter(p=>{var h;return((h=p.node)==null?void 0:h.type)===Q.PlaceHolder}),u=[];l!=null&&l.length&&l.forEach(p=>{var v;const h=(v=p.connections)==null?void 0:v.map(f=>r.getNode(f.source)).filter(Boolean);h&&u.push({node:p.node,connections:p.connections,connectedNodes:h})});const d=t.find(p=>{var h;return((h=p.node)==null?void 0:h.type)===Q.Schema});return{thread:{node:e,connections:a},llm:t.find(p=>{var h;return((h=p.node)==null?void 0:h.type)===Q.LLM}),schemas:d?[d]:[],prompts:i,tools:o,placeholders:u}},Nl=e=>{const r=[];return e.forEach(a=>{var i,s,o;const{node:t,connectedNodes:n}=a;if((i=t.data)!=null&&i.entity){if(t.type===Q.Message){const l=t.data.entity;switch(l.role){case"human":r.push(new ma(l.content));break;case"ai":r.push(new Kn(l.content));break}}else if(t.type===Q.Prompt){const l=t.data.entity;let u=`${l.prefix?`${l.prefix}
`:""}`;if(l.type===Ot.FewShotExample){const d=(o=(s=n.find(p=>p.type===Q.CSVData))==null?void 0:s.data)==null?void 0:o.entity;if(d){const{rows:p}=np(d.headers,d.csv);p.forEach(h=>{u+=`${l.content.replace(/{([^{}]*)}/g,(v,f)=>`${h[f]}`)}
`})}}else u+=l.content;switch(l.suffix&&(u+=`
${l.suffix}`),l.role){case"human":r.push(new ma(u));break;case"system":r.push(new sp(u));break;default:r.push(new Kn(u));break}}}}),r},Hf=(e,r)=>{const a=(e==null?void 0:e.filter(n=>n.type===Q.Message).map(n=>({node:n,connectedNodes:[]})).reverse())||[],t=[];return r.forEach(async n=>{t.unshift({node:n.node,connectedNodes:n.connectedNodes||[]})}),{history:Nl(a),systems:Nl(t)}},Vf=e=>e?e.reduce((r,a)=>{var i,s,o,l,u;const t=(i=a.node.data)==null?void 0:i.entity,n=(l=(o=(s=a==null?void 0:a.connectedNodes)==null?void 0:s.find(d=>d.type===Q.Schema))==null?void 0:o.data)==null?void 0:l.entity;return t&&((u=n==null?void 0:n.schema_items)!=null&&u.length)&&r.push({name:t.name,description:t.description,schemaItems:n.schema_items}),r},[]):[],ys=()=>{const{getNodes:e}=Zt(),r=b.useCallback(()=>e().find(t=>t.type===Q.DefaultEmbeddingModel),[e]),a=b.useCallback(()=>{var t,n;return(n=(t=r())==null?void 0:t.data)==null?void 0:n.entity},[r]);return{getFlowEmbeddingNode:r,getFlowEmbeddingEntity:a}},$l=({getNode:e,getHandleConnections:r})=>{const{t:a}=Te("create_new_message"),[t,n]=b.useState(!1),i=rt(m=>m.currentSession),s=ve(m=>m.createOrUpdateFlowNode),o=ve(m=>m.createOrUpdateFlowEdge),{similaritySearchWithScore:l}=mo(),{getFlowEmbeddingEntity:u}=ys(),{stream:d}=Eo(),p=b.useCallback(async({content:m,threadId:g,sourceId:w,initialX:S,initialY:O,initialLLMId:x})=>{if(!i)throw new Error("Session is not found");const E=await he("Message").save({thread_id:g,content:m,role:$t.Human,status:Mt.Started,llm_id:x,session_id:i.id});if(!E)throw new Error("Failed to save message");const $=await s({source_id:E.id,source_type:"Message",node_type:Q.Message,x:S,y:O+80});if(!$)throw new Error("Failed to save human message node");await o({source:w,target:$.id});const N=await he("Message").save({thread_id:g,content:a("initial_ai_message"),role:$t.AI,status:Mt.Inprogress,llm_id:x,parent_message_id:E.id,session_id:i.id});if(!N)throw new Error("Failed to save message");const T=await s({source_id:N.id,source_type:"Message",node_type:Q.Message,x:S,y:O+250});if(!T)throw new Error("Failed to save ai message node");return await o({source:$.id,target:T.id}),{aiMessage:N,humanMessage:E,aiMessageNode:T,humanMessageNode:$}},[o,s,i,a]),h=b.useCallback(async(m,g)=>{const{placeholders:w}=g;if(!(w!=null&&w.length))return[];const S=[];return await Promise.all(w.map(async O=>{var E,$,N,T,D,A,R,z,U,M,q,J;const x=(E=O.node.data)==null?void 0:E.entity;if(x)switch(x.placeholder_type){case Ua.VECTOR_DATABASE_RETREIVER:{const Y=($=O.connectedNodes)==null?void 0:$.find(ue=>ue.type===Q.VectorDatabase),se=(N=Y==null?void 0:Y.data)==null?void 0:N.entity,oe=(A=(D=(T=O.connectedNodes)==null?void 0:T.find(ue=>ue.type===Q.Prompt))==null?void 0:D.data)==null?void 0:A.entity;if(!oe||!se||!Y)return;const Se=(R=x.metadata)!=null&&R.k?+((z=x.metadata)==null?void 0:z.k):1;let Ce=(U=x.metadata)!=null&&U.minimalScore?+((M=x.metadata)==null?void 0:M.minimalScore):void 0;Ce&&Ce>1&&(Ce=Ce/100);const Z=[];if(se.storage===kr.DataNode){const ue=(J=(q=r({nodeId:Y.id,type:"target"}).map(ee=>e(ee.source)).find(ee=>(ee==null?void 0:ee.type)&&[Q.JSONLData,Q.CSVData].includes(ee==null?void 0:ee.type)))==null?void 0:q.data)==null?void 0:J.entity;if(!ue)return;Z.push(...await l(u(),{database:{databaseId:se.id,dataSourceId:ue.id,dataSourceType:_o(ue)}},m.humanMessage.content,Se)||[])}else Z.push(...await l(u(),{database:{databaseId:se.id}},m.humanMessage.content,Se)||[]);if(!Z)return[];const re=new nx({template:oe.content,inputVariables:["context"]});S.push(new Kn(await re.format({context:Ce?Z.filter(([,ue])=>ue>=Ce).map(([ue])=>ue.pageContent).join(`
`):Z.map(([ue])=>ue.pageContent).join(`
`)})))}}})),S},[u,r,e,l]),v=b.useCallback(async(m,g,w,{onMessageUpdate:S})=>{var q;const{prompts:O,tools:x,schemas:E,placeholders:$,llm:N}=g,T=(q=N==null?void 0:N.node.data)==null?void 0:q.entity;if(!T)throw new Error("LLM is not found");const D=[];$!=null&&$.length&&D.push(...await h(m,g));const{history:A,systems:R}=Hf(w,O),z=[...R,...D,...A,new ma(m.humanMessage.content)],U=E.map(J=>{var Y;return(Y=J.node.data)==null?void 0:Y.entity}).filter(Boolean),M=await d(T.provider,z,{tools:Vf(x),schemas:U,llm:T,onMessageUpdate:({content:J})=>{S==null||S({id:m.aiMessageNode.id,nodeData:{loading:!0,content:J}})}});return m.aiMessage.content=(M==null?void 0:M.content)||"",m.aiMessage.metadata=JSON.stringify({message:M==null?void 0:M.lastChunk}),S==null||S({id:m.aiMessageNode.id,nodeData:{content:M==null?void 0:M.content,loading:!1,entity:m.aiMessage}}),m.aiMessage.id&&await he("Message").update(m.aiMessage.id,{content:M==null?void 0:M.content,metadata:JSON.stringify({message:M==null?void 0:M.lastChunk})}),M==null?void 0:M.content},[h,d]),f=b.useCallback(async(m,g,w)=>{var N,T,D;const{nodes:S}=Cl([m.id],[],[],[],{getNode:e,getHandleConnections:r}),O=S.find(A=>A.type===Q.Thread),x=O==null?void 0:O.data.entity;if(!m||!x||!O)throw new Error("Source or thread is not found");const E=Pl(O,{getNode:e,getHandleConnections:r});if(!(E!=null&&E.thread))throw new Error("Thread node is not found");let $;try{n(!0);const A=((N=m.position)==null?void 0:N.x)||0,R=(((T=m.position)==null?void 0:T.y)||0)+(((D=m.measured)==null?void 0:D.height)||0);return $=await p({content:g,initialX:A,initialY:R,sourceId:m.id,threadId:x.id,initialLLMId:x.initial_llm_id}),await v($,E,S,w),await he("Message").update(`${$.aiMessage.id}`,{status:Mt.Success}),$.aiMessage.status=Mt.Success,w.onMessageUpdate({id:$.aiMessageNode.id,nodeData:{entity:$.aiMessage,loading:!1}}),!0}catch(A){Dn("Create Message",A),$!=null&&$.aiMessage&&await he("Message").update(`${$.aiMessage.id}`,{status:Mt.Failed,content:a("errors.ai_message_content_failed")}),$!=null&&$.aiMessageNode.id&&(w==null||w.onMessageUpdate({id:$.aiMessageNode.id,nodeData:{content:a("errors.ai_message_content_failed"),entity:{...$.aiMessage,status:Mt.Failed,content:a("errors.ai_message_content_failed")},loading:!1}}))}finally{n(!1)}},[r,e,p,v,a]);return{loading:t,createMessage:f}},qf=(e,r)=>{const a=mt(e),{t}=Te("flows"),{getNode:n,getHandleConnections:i}=Zt(),s=ve(h=>h.updateNodes),{createMessage:o,loading:l}=$l({getNode:n,getHandleConnections:i}),u=b.useCallback(h=>{if(!h.id)return;const v=n(h.id);!v||!h.nodeData||s([{id:v.id,type:"replace",item:{...v,data:{...v.data,...Zh(h.nodeData,Bh)}}}])},[n,s]),d=b.useCallback(async h=>{if(a&&r.entity)try{await o(a,h,{onMessageUpdate:u})}catch(v){if(v instanceof Error&&v.message.includes("LLM_NOT_LOADED_YET"))return ca({variant:"destructive",title:t("thread_node.errors.llm_not_loaded_yet")});ca({variant:"destructive",title:`${v}`})}},[a,r.entity,o,u,t]),p=b.useCallback(h=>{const v=n(h);if(!v)return[];const f=[],m=Pl(v,{getNode:n,getHandleConnections:i});return m.thread&&f.push({node:m.thread.node,connectedNodes:[],connections:m.thread.connections}),m.prompts&&f.push(...m.prompts.map(g=>({node:g.node,connectedNodes:g.connectedNodes,connections:g.connections}))),m.schemas&&f.push(...m.schemas.map(g=>({node:g.node,connectedNodes:[],connections:g.connections}))),m.placeholders&&m.placeholders.forEach(g=>{const w=g.connections.map(S=>n(S.source)).filter(Boolean);f.push({node:g.node,connectedNodes:w||[],connections:g.connections})}),m.llm&&f.push(m.llm),f},[i,n]);return{loading:l,createMessage:d,getLinkedConnections:p}},Zf=e=>{const r=ve(t=>t.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===Q.Prompt&&(i==null?void 0:i.type)===Q.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===Q.LLM&&(i==null?void 0:i.type)===Q.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===Q.Schema&&(i==null?void 0:i.type)===Q.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===Q.ToolDefinition&&(i==null?void 0:i.type)===Q.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===Q.VectorDatabase&&(i==null?void 0:i.type)===Q.Thread){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}else if((n==null?void 0:n.type)===Q.PlaceHolder&&(i==null?void 0:i.type)===Q.Thread&&n.data.entity.placeholder_type===Ua.VECTOR_DATABASE_RETREIVER){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},Bf=b.memo(e=>{const{id:r,data:a,isConnectable:t}=e,{t:n}=Te("flows"),[i,s]=b.useState(!1),o=Un({type:"source"}),l=Un({type:"target"}),{getNode:u}=Zt(),{loading:d,createMessage:p,getLinkedConnections:h}=qf(r,a);Zf(r);const v=b.useCallback(async(...w)=>(s(!1),await p(...w)),[p]),f=b.useMemo(()=>o.length>0,[o]),m=b.useCallback(()=>{s(w=>!w)},[]),g=b.useMemo(()=>{var S,O;const w=l.map((x,E)=>{var N;const $=u(x.source);if(($==null?void 0:$.type)===Q.Schema)return c.jsx(zr,{children:n("thread_node.structured_output")},`${E}`);if(($==null?void 0:$.type)===Q.Prompt){const T=$.data.entity;return c.jsx(zr,{children:n(T.type===Ot.FewShotExample?"thread_node.prompts.few_shot_example":`thread_node.prompts.${T.role.toLowerCase()}`)},`${E}`)}else if(($==null?void 0:$.type)===Q.PlaceHolder&&((N=$.data.entity)==null?void 0:N.placeholder_type)===Ua.VECTOR_DATABASE_RETREIVER)return c.jsx(zr,{children:n("thread_node.vector_database_retriever")},`${E}`)}).filter(Boolean);return e.data.entity&&!((O=(S=e.data.entity)==null?void 0:S.messages)!=null&&O.length)&&!f?c.jsx(gs,{disabled:d,loading:d,onSubmit:v,tags:w}):w!=null&&w.length?c.jsxs(it,{className:"p-4 pt-2",children:[c.jsx(xt,{className:"mb-2",children:n("thread_node.title")}),c.jsx("div",{className:"flex gap-1.5",children:w}),c.jsx("div",{className:"mt-4 w-full flex justify-end",children:c.jsxs(We,{onClick:m,variant:"outline",children:[c.jsx(_e,{name:i?"copy-minus":"copy-plus"}),n(i?"thread_node.hide":"thread_node.clone")]})})]}):c.jsx("div",{className:"w-12 h-10"})},[f,u,v,m,d,e.data.entity,i,n,l]);return c.jsxs("div",{children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(yt,{id:r,enableToStandalone:!0,getLinkedConnections:h}),g,i?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),c.jsx("div",{className:"absolute mt-[30px] w-full",children:c.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:c.jsx(gs,{disabled:d,loading:d,onSubmit:v})})})]}):void 0]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})});function Wf({data:e,onNewThread:r,loading:a,showThread:t}){var i;const{t:n}=Te("flows");return c.jsxs(It,{className:"flex min-w-52",children:[c.jsx(_e,{size:24,name:"user"}),c.jsxs("div",{className:"ml-2 max-w-full w-full",children:[c.jsx(pr,{children:"Human"}),c.jsx(ua,{children:`${e.content||((i=e.entity)==null?void 0:i.content)||""}`}),r?c.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:c.jsxs(We,{onClick:r,disabled:a,variant:"outline",children:[c.jsx(_e,{name:t?"minus":"plus",size:16}),n(t?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]})]})}function Kf({data:e,onNewThread:r,loading:a,showThread:t}){var l,u,d,p,h,v,f,m,g;const{t:n}=Te("flows"),i=b.useMemo(()=>{var w;try{return JSON.parse(((w=e==null?void 0:e.entity)==null?void 0:w.metadata)||"{}")}catch{return{}}},[(l=e==null?void 0:e.entity)==null?void 0:l.metadata]),s=e.entity.status===Mt.Failed,o=b.useMemo(()=>{var w;return c.jsx(da,{source:`${e.content||((w=e.entity)==null?void 0:w.content)||""}`})},[e.content,(u=e.entity)==null?void 0:u.content]);return c.jsxs(It,{className:Me("flex min-w-52",s?"bg-background":""),variant:s?"destructive":"default",children:[c.jsx(_e,{className:Me(e.loading?"animate-spin":void 0),size:24,name:e.loading?"loader-circle":"bot"}),c.jsx(_e,{name:t?"minus":"plus",size:24}),c.jsxs("div",{className:"ml-2 w-full max-w-full",children:[c.jsx(pr,{children:n(`message_node.message_roles.${(p=(d=e.entity)==null?void 0:d.role)==null?void 0:p.toLowerCase()}`)}),c.jsx(b.Suspense,{fallback:c.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:c.jsx(_e,{name:"loader-circle",className:"animate-spin"})}),children:s?e.content||((h=e.entity)==null?void 0:h.content)||"":o}),Array.isArray((v=i==null?void 0:i.message)==null?void 0:v.tool_calls)&&((m=(f=i==null?void 0:i.message)==null?void 0:f.tool_calls)!=null&&m.length)?(g=i==null?void 0:i.message)==null?void 0:g.tool_calls.map((w,S)=>c.jsx(zr,{children:n("message_node.tool_call",{name:w.name,args:Object.entries(w.args).map(([O,x])=>`"${O}": "${x}"`).join(", ")})},`${w.name}_${S}`)):null,r?c.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:c.jsxs(We,{onClick:r,disabled:a,variant:"outline",children:[c.jsx(_e,{name:t?"minus":"plus",size:16}),n(t?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]}),e.loading?c.jsx(qh,{size:350,duration:10}):void 0]})}const Qf=e=>{const{t:r}=Te("flows"),a=mt(e),t=ve(d=>d.updateNodes),{getNode:n,getHandleConnections:i}=Zt(),{createMessage:s,loading:o}=$l({getNode:n,getHandleConnections:i}),l=b.useCallback(d=>{if(!d.id)return;const p=n(d.id);!p||!d.nodeData||t([{id:p.id,type:"replace",item:{...p,data:{...p.data,...Zh(d.nodeData,Bh)}}}])},[n,t]),u=b.useCallback(async d=>{if(a)try{await s(a,d,{onMessageUpdate:l})}catch(p){if(p instanceof Error&&p.message.includes("LLM_NOT_LOADED_YET"))return ca({variant:"destructive",title:r("message_node.errors.llm_not_loaded_yet")});ca({variant:"destructive",title:r("message_node.errors.create_message")})}},[a,r,s,l]);return{loading:o,createMessage:u}},Ol=()=>{const e=rt(t=>t.currentSession),r=ve(t=>t.createOrUpdateFlowNode),a=ve(t=>t.createOrUpdateFlowEdge);return{createIdieMessage:b.useCallback(async(t,n,i,s)=>{var f,m,g,w,S;if(!t||!n||!e)return;const o=(m=(f=s==null?void 0:s.promptNode)==null?void 0:f.data)==null?void 0:m.entity,l=((g=t.position)==null?void 0:g.x)||0,u=(((w=t.position)==null?void 0:w.y)||0)+(((S=t.measured)==null?void 0:S.height)||0),d=await he("Message").save({thread_id:n.id,content:i,role:(o==null?void 0:o.role)||$t.Human,status:Mt.Started,llm_id:n.initial_llm_id,session_id:e.id});if(!d)throw new Error("Failed to save message");const p=await r({source_id:d.id,source_type:"Message",node_type:Q.Message,x:l,y:u});if(!p)throw new Error("Failed to save message node");const h=await a({source:t.id,target:p.id});let v;return s!=null&&s.promptNode&&(v=await a({source:s==null?void 0:s.promptNode.id,target:p.id})),{message:d,edgeToPrompt:v,messageNode:p,messageEdge:h}},[r,a])}},Gf=e=>{const{createIdieMessage:r}=Ol(),a=b.useCallback(async({edgeId:t,source:n,target:i})=>{var s,o;try{if((n==null?void 0:n.type)===Q.Prompt&&(i==null?void 0:i.type)===Q.Message){const l=(s=i==null?void 0:i.data)==null?void 0:s.entity,u=(o=n==null?void 0:n.data)==null?void 0:o.entity;if(!u||!l||!i)return{deleteEdgeId:t};await r(i,{id:l==null?void 0:l.thread_id,title:"",status:Wa.Started,initial_llm_id:l.llm_id,session_id:u.session_id},u.content,{promptNode:n});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},Jf=b.memo(e=>{var O,x,E;const{id:r,data:a,isConnectable:t}=e,[n,i]=b.useState(!1),[s,o]=b.useState(!1),{t:l}=Te("common"),u=Un({type:"source"}),{loading:d,createMessage:p}=Qf(r),{toast:h}=Pt();Gf(r);const v=b.useCallback(async(...$)=>{const N=await p(...$);return i(!1),N},[p]),f=b.useMemo(()=>u.length===0,[u]),m=b.useCallback(()=>{var $;($=a.entity)!=null&&$.content&&(navigator.clipboard.writeText(a.entity.content),h({description:l("copied")}))},[h,a,l]),g=b.useCallback(async()=>{var $;try{if(s)return await Ah.stop(),o(!1);o(!0),await Ah.speak((($=a.entity)==null?void 0:$.content)||"")}catch{h({variant:"destructive",description:l("errors.speech_is_not_supported")})}finally{o(!1)}},[(O=a.entity)==null?void 0:O.content,s,l,h]),w=b.useCallback(()=>{i($=>!$)},[]),S=b.useMemo(()=>{var $;if(!(!f&&!n||a.loading||d||(($=a==null?void 0:a.entity)==null?void 0:$.status)==="inprogress"))return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),c.jsx("div",{className:"absolute mt-[30px] w-full",children:c.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:c.jsx(gs,{disabled:d,loading:d,onSubmit:v})})})]})},[(x=a==null?void 0:a.entity)==null?void 0:x.status,a.loading,v,f,d,n]);return c.jsxs("div",{children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsxs("div",{className:"max-w-sm min-w-64",children:[c.jsxs("div",{className:"w-auto",children:[c.jsx(yt,{id:r}),c.jsx("div",{children:((E=a.entity)==null?void 0:E.role)===$t.Human?c.jsx(Wf,{data:a,showThread:n,onNewThread:f?void 0:w}):c.jsx(Kf,{data:a,showThread:n,loading:d,onNewThread:f?void 0:w})}),c.jsx(We,{onClick:g,className:"absolute top-0 right-[68px] !px-2 !rounded-none",variant:"ghost",children:c.jsx(_e,{name:s?"circle-stop":"speech",size:16})}),c.jsx(We,{onClick:m,className:"absolute top-0 right-[36px] !px-2 !rounded-none",variant:"ghost",children:c.jsx(_e,{name:"copy",size:16})})]}),S]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})}),Xf=e=>{const r=ve(n=>n.createOrUpdateFlowEdge),{createIdieMessage:a}=Ol(),t=b.useCallback(async({edgeId:n,source:i,target:s})=>{var o,l,u,d;try{const p=(o=s==null?void 0:s.data)==null?void 0:o.entity,h=(l=i==null?void 0:i.data)==null?void 0:l.entity;if((i==null?void 0:i.type)===Q.Message&&(s==null?void 0:s.type)===Q.Prompt){const v=(u=i==null?void 0:i.data)==null?void 0:u.entity,f=(d=s==null?void 0:s.data)==null?void 0:d.entity;if(!f||!v||!s)return{deleteEdgeId:n};await a(i,{id:v==null?void 0:v.thread_id,title:"",status:Wa.Started,initial_llm_id:v.llm_id,session_id:f.session_id},f.content,{promptNode:s});return}else if((i==null?void 0:i.type)===Q.CSVData&&(s==null?void 0:s.type)===Q.Prompt&&(p==null?void 0:p.type)===Ot.FewShotExample&&(h!=null&&h.headers.includes("input"))&&(h!=null&&h.headers.includes("output"))){await r({source:i.id,target:s.id});return}return{deleteEdgeId:n}}catch{return{deleteEdgeId:n}}},[a,r]);_t(e,t)},Yf=b.memo(e=>{var u,d,p;const{id:r,data:a,isConnectable:t}=e;Xf(r);const n=Er(sx),i=b.useMemo(()=>{var h,v,f;return`${(h=a.entity)!=null&&h.prefix?`${(v=a.entity)==null?void 0:v.prefix}
`:""}${((f=a.entity)==null?void 0:f.content)||""}`},[(u=a.entity)==null?void 0:u.prefix,(d=a.entity)==null?void 0:d.content]),s=b.useMemo(()=>{var v;const h=/{(.*?)}/g;return((v=i.match(h))==null?void 0:v.map(f=>f.replace("{","").replace("}","")))||[]},[i]),o=i.length>990,l=()=>{n.show({title:"Prompt",content:i})};return c.jsxs("div",{className:"min-w-56",children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(yt,{id:r}),c.jsxs(It,{className:"flex justify-center max-w-72",variant:"default",children:[c.jsx(_e,{size:24,name:"notepad-text"}),c.jsxs("div",{className:"ml-2 max-w-full break-words break-all",children:[c.jsx(pr,{children:`${((p=a.entity)==null?void 0:p.role)||""}`}),c.jsxs(ua,{onClick:o?l:void 0,children:[o?`${i.slice(0,990)}...`:i,o?c.jsx("span",{className:"float-right",children:c.jsx(_e,{name:"chevron-right"})}):void 0]}),s!=null&&s.length?s.map((h,v)=>c.jsx(zr,{className:"mt-2 mr-1",variant:"default",children:h},v)):void 0]})]})]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})}),Rl=e=>{const r=["Bytes","KB","MB","GB","TB"];if(e===void 0)return"Unknown size";if(e===0)return"0 Byte";const a=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,a))} ${r[a]}`},ev=b.memo(()=>{const{t:e}=Te("flows"),[r,a]=b.useState(),t=Ha(h=>h.cachedLLMURLs),n=rt(h=>h.currentSession),[i,s]=b.useState(),[o,l]=b.useState(""),[,u]=b.useState();b.useEffect(()=>{Rt(async()=>{const{functionCallingModelIds:h,prebuiltAppConfig:v}=await import("./index-DYRICXF3.js").then(async f=>(await f.__tla,f));return{functionCallingModelIds:h,prebuiltAppConfig:v}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({functionCallingModelIds:h,prebuiltAppConfig:v})=>{a(t==null?void 0:t.map(f=>{const m=v.model_list.find(g=>f.includes(g.model));if(m)return{model_id:(m==null?void 0:m.model_id)||"",info:m,isFunctionCalling:h.includes((m==null?void 0:m.model_id)||"")}}))})},[t,n==null?void 0:n.id]);const d=b.useCallback(async()=>{navigator.storage.estimate().then(h=>{h&&l(e("session_info_node.used_bytes",{used:Rl(h.usage),total:Rl(h==null?void 0:h.quota)}))}),n!=null&&n.id&&(Promise.all([he("FlowNode").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("FlowEdge").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("Thread").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("Prompt").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("LLM").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("Schema").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("ToolDefinition").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("VectorDatabase").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("JSONLData").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}}),he("CSVData").findOne({where:{session_id:n==null?void 0:n.id},order:{updated_at:"DESC"}})]).then(h=>{const v=h.reduce((f,m)=>m!=null&&m.updated_at&&(!f||new Date(m.updated_at)>f)?new Date(m.updated_at):f,n.updated_at?new Date(n.updated_at):void 0);s(v)}),Promise.all([he("FlowNode").count({where:{session_id:n==null?void 0:n.id}}),he("FlowEdge").count({where:{session_id:n==null?void 0:n.id}}),he("Thread").count({where:{session_id:n==null?void 0:n.id}}),he("Prompt").count({where:{session_id:n==null?void 0:n.id}}),he("LLM").count({where:{session_id:n==null?void 0:n.id}}),he("ToolDefinition").count({where:{session_id:n==null?void 0:n.id}}),he("Schema").count({where:{session_id:n==null?void 0:n.id}}),he("VectorDatabase").count({where:{session_id:n==null?void 0:n.id}}),he("JSONLData").count({where:{session_id:n==null?void 0:n.id}}),he("CSVData").count({where:{session_id:n==null?void 0:n.id}})]).then(([h,v,f,m,g,w,S,O,x,E])=>{u([{name:e("session_info_node.count_info.title"),nodes:h||0,edges:v||0,threads:f||0,prompts:m||0,llms:g||0,tools:w||0,schemas:S||0,vectorDatabases:O||0,jsonlDatas:x||0,csvDatas:E||0}])}))},[n==null?void 0:n.id,n==null?void 0:n.updated_at,e]),p=b.useCallback(()=>{d()},[d]);return b.useEffect(()=>{d()},[d]),c.jsxs(it,{className:"w-96",children:[c.jsxs(ft,{children:[c.jsx(xt,{children:e("session_info_node.title")}),c.jsx(ix,{children:i||n!=null&&n.updated_at?qw(i||(n==null?void 0:n.updated_at)).fromNow():""})]}),c.jsxs(vt,{className:"grid gap-4",children:[c.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:c.jsxs("div",{className:"flex-1 space-y-1",children:[c.jsx("p",{className:"text-sm font-medium leading-none",children:e("session_info_node.disk_size")}),c.jsx("p",{className:"text-sm text-muted-foreground",children:o})]})}),c.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:c.jsxs("div",{className:"flex-1 space-y-1",children:[c.jsxs("div",{className:"text-sm font-medium leading-none",children:[e("session_info_node.cached_llms"),c.jsx(zr,{className:"ml-2",children:(r==null?void 0:r.length)||0})]}),r==null?void 0:r.map(h=>c.jsxs("div",{className:"text-sm text-muted-foreground gap-1",children:[h==null?void 0:h.model_id,c.jsx("div",{className:"max-w-full gap-1 flex flex-wrap mt-1",children:c.jsx(Mn,{model:h==null?void 0:h.info,isFunctionCalling:(h==null?void 0:h.isFunctionCalling)||!1,isCached:!0,cloud:!1})})]},h==null?void 0:h.model_id))]})}),c.jsx("div",{})]}),c.jsx(Sr,{children:c.jsxs(We,{className:"w-full",onClick:p,children:[c.jsx(_e,{size:24,name:"refresh-ccw"}),e("session_info_node.reload")]})})]})}),tv=e=>{const r=b.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);_t(e,r)},rv=b.memo(e=>{var l,u;const{t:r}=Te("flows"),{id:a,data:t,isConnectable:n}=e,i=b.useRef(!1),s=mt(a),o=ve(d=>d.updateNodes);return tv(a),b.useEffect(()=>{var p;const d=t==null?void 0:t.entity;!d||!s||i.current||(p=d==null?void 0:d.schema_items)!=null&&p.length||t.loaded||(i.current=!0,he("SchemaItem").find({where:{schema_id:d.id}}).then(h=>{o([{id:s.id,type:"replace",item:{...s,data:{...(s==null?void 0:s.data)||{},loaded:!0,entity:{...t.entity,schema_items:h}}}}])}).finally(()=>{i.current=!1}))},[t.entity,t.loaded,s,o]),c.jsxs("div",{children:[c.jsxs("div",{children:[c.jsx(yt,{id:a}),c.jsxs(Wh,{defaultValue:"account",className:"w-[400px]",children:[c.jsxs(Kh,{className:"grid w-full grid-cols-2",children:[c.jsx(ha,{value:"account",children:r("schema_node.typescript")}),c.jsx(ha,{value:"password",children:r("schema_node.zod")})]}),c.jsx(pa,{value:"account",children:c.jsx(it,{className:"p-4",children:c.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:y1(((l=t==null?void 0:t.entity)==null?void 0:l.schema_items)||[])})})}),c.jsx(pa,{value:"password",children:c.jsx(it,{className:"p-4 max-w-full",children:c.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:_1(((u=t==null?void 0:t.entity)==null?void 0:u.schema_items)||[])})})})]})]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:n})]})}),av=b.memo(e=>{var i,s;const{id:r,data:a,isConnectable:t}=e,n=b.useMemo(()=>{if(!(a!=null&&a.entity))return{headers:[],rows:[]};const o=bo(a.entity.csv);return{headers:wo(a.entity.headers),rows:o.map(l=>wo(l))}},[a==null?void 0:a.entity]);return c.jsxs("div",{children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(yt,{id:r}),c.jsxs(it,{className:"min-w-32 min-h-16 p-4",children:[c.jsx(ft,{className:"!p-0",children:c.jsxs("div",{className:"pt-2 flex !flex-row",children:[c.jsx(_e,{name:"file-spreadsheet",className:"mr-2"}),c.jsxs(je,{className:"!font-medium leading-none tracking-tight pr-8",children:[Q.CSVData," ",(i=n==null?void 0:n.rows)!=null&&i.length?`(${((s=n==null?void 0:n.rows)==null?void 0:s.length)||0})`:""]})]})}),c.jsx(vt,{className:"pb-0",children:c.jsx(fo,{data:n.rows,headers:n.headers})})]})]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})}),nv=e=>{const r=ve(t=>t.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===Q.Schema&&(i==null?void 0:i.type)===Q.ToolDefinition){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},sv=b.memo(({id:e,data:r,isConnectable:a})=>{var t,n;return nv(e),c.jsxs("div",{children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:a}),c.jsx("div",{children:c.jsxs(It,{className:"flex justify-center",children:[c.jsx(_e,{size:24,name:"wrench"}),c.jsxs("div",{className:"ml-2",children:[c.jsx(pr,{children:`${((t=r.entity)==null?void 0:t.name)||""}`}),c.jsx(ua,{children:`${((n=r.entity)==null?void 0:n.description)||""}`})]})]})}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:a})]})}),iv=b.memo(e=>{var p,h;const[r,a]=b.useState(!1),[t,n]=b.useState({}),[i,s]=b.useState({}),{confirmPassphrase:o}=pp(),{t:l}=Te("atoms"),u=async()=>{var v;if(r)n({}),s({});else{if((v=Object.keys(e.encrypted||{}))!=null&&v.length){await o();const f={},m=await Wn.get("passphrase");if(!m)throw new Error("Passphrase is not found");await Promise.all(Object.keys(e.encrypted||{}).map(async g=>{var w,S;(w=e.encrypted)!=null&&w[g]&&(f[g]=await b1((S=e.encrypted)==null?void 0:S[g],m))})),s(f||{})}n({...e.options})}a(!r)},d=()=>{var v;(v=e.onChangeOptions)==null||v.call(e,t||{},i||{}),a(!1)};return c.jsx("div",{className:Me("min-w-20 flex justify-end",e.className),children:c.jsxs(Jn,{open:r,onOpenChange:a,children:[c.jsx(j1,{children:c.jsx("div",{className:"flex justify-end gap-2 !cursor-pointer",children:c.jsxs(We,{onClick:u,variant:"link",className:"flex items-center px-0 !cursor-pointer",children:[c.jsx(_e,{name:"settings"}),c.jsx(je,{children:l("embedding_setting.title")})]})})}),c.jsx(Xn,{className:"w-full p-0",children:r?c.jsxs(it,{className:"!border-none max-w-96 min-w-56",children:[c.jsx(ft,{children:c.jsx(xt,{children:l("embedding_setting.title")})}),c.jsxs(vt,{children:[c.jsxs(je,{children:[l("embedding_setting.provider"),":"]}),c.jsxs(cr,{value:t!=null&&t.provider?`${t==null?void 0:t.provider}`:"local_transformers",onValueChange:v=>n({provider:v}),children:[c.jsx(dr,{className:"",children:c.jsx(ur,{placeholder:l("embedding_setting.provider_placeholder")})}),c.jsxs(hr,{children:[c.jsx(Nt,{value:"local_transformers",children:l("embedding_setting.providers.local_transformers")},"local_transformers"),(p=e.supportedProviders)==null?void 0:p.map(v=>c.jsx(Nt,{value:v,children:l(`embedding_setting.providers.${v.toLowerCase()}`)},v))]})]}),(h=e.supportedProviders)!=null&&h.length?void 0:c.jsx(je,{className:"text-red-500 !pt-2",children:l("embedding_setting.alerts.no_provider")}),c.jsx(c.Fragment,{children:t.provider&&t.provider!=="local_transformers"?c.jsxs(c.Fragment,{children:[c.jsx(It,{variant:"destructive",className:"mt-4",children:l("embedding_setting.alerts.session_passkey")}),c.jsxs("div",{className:"mt-4",children:[c.jsx(je,{children:l("embedding_setting.encrypted_fields.api_key")}),c.jsx(We,{variant:"link",className:"px-1",children:c.jsxs("a",{href:t.provider===$e.OpenAI?rn:tn,target:"_blank",rel:"noreferrer",children:["(",t.provider===$e.OpenAI?rn:tn,")"]})}),c.jsx(ht,{type:"password",value:i!=null&&i.key?`${i==null?void 0:i.key}`:"",onChange:v=>s(f=>({...f,key:v.target.value}))})]})]}):void 0})]}),c.jsx(Sr,{className:"flex justify-end",children:c.jsx(We,{variant:"secondary",onClick:d,children:l("embedding_setting.save")})})]}):void 0})]})})}),ov=e=>{const r=b.useCallback(async({edgeId:a})=>({deleteEdgeId:a}),[]);_t(e,r)},lv=e=>{const r=rt(o=>{var l;return(l=o.currentSession)==null?void 0:l.id}),a=mt(e),t=Qh(),n=ve(o=>o.updateNodes),{confirmOrCreatePassphrase:i}=xl(),s=b.useCallback(async(o,l)=>{var u;if(a&&r){let d=e!==Hn.DEFAULT_EMBEDDING_MODEL?await he("FlowNode").findOne({where:{id:e}}):void 0;const p={};if((u=Object.keys(l||{}))!=null&&u.length){await i();const f=await Wn.get("passphrase");if(!f)throw new Error("Passphrase is not found");await Promise.all(Object.keys(l||{}).map(async m=>{l!=null&&l[m]&&(p[m]=await hp(l[m],f))}))}let h;const v=[];d?(await he("FlowNodePlaceholder").update(d.source_id,{encrypted:p,data:o}),h=await he("FlowNodePlaceholder").findOne({where:{id:d.source_id}}),v.push({id:d.id,type:"replace",item:a})):(v.push({id:e,type:"remove"}),h=await he("FlowNodePlaceholder").save({placeholder_type:Ua.DEFAULT_EMBEDDING_MODEL,encrypted:p,data:o,session_id:r}),d=await he("FlowNode").save({node_type:Q.DefaultEmbeddingModel,session_id:r,source_type:"FlowNodePlaceholder",source_id:h.id,x:a.position.x,y:a.position.y}),v.push({type:"add",item:a})),a.data.entity=h,a.data.flowNode=d,n(v)}},[i,r,e,a,n]);return b.useEffect(()=>{e===Hn.DEFAULT_EMBEDDING_MODEL&&t.find(o=>o.type===Q.DefaultEmbeddingModel&&o.id!==Hn.DEFAULT_EMBEDDING_MODEL)&&n([{id:e,type:"remove"}])},[e,t,n]),{changeLLMOptions:s}},cv=b.memo(e=>{var o,l,u,d;const{id:r,data:a,isConnectable:t}=e,{changeLLMOptions:n}=lv(r);ov(r);let i="brain",s=l1;switch(`${(l=(o=a==null?void 0:a.entity)==null?void 0:o.data)==null?void 0:l.provider}`){case $e.OpenAI:i="gpt",s="text-embedding-3-small";break;case $e.GoogleGenerativeAI:i="gemma",s="text-embedding-004";break}return c.jsxs("div",{children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsx("div",{children:c.jsxs(It,{className:"flex justify-center max-w-auto",variant:"default",children:[c.jsx(vr,{name:i,className:"w-7 h-7"}),c.jsxs("div",{className:"ml-2 pr-4 flex justify-center gap-1 flex-col",children:[c.jsx("div",{className:"min-h-8 flex items-center",children:c.jsx(pr,{children:`${s||""}`})}),c.jsx(iv,{supportedProviders:[$e.OpenAI,$e.GoogleGenerativeAI],onChangeOptions:n,encrypted:(u=a.entity)==null?void 0:u.encrypted,options:(d=a.entity)==null?void 0:d.data})]})]})}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})}),dv=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
Use three sentences maximum and keep the answer as concise as possible.

{context}
`,uv=Fn(e=>{const{source:r,documents:a}=e,t=Er(),{toast:n}=Pt(),{t:i}=Te("dialogs"),{loading:s,createPrompt:o}=jl(),l=async u=>{try{if(!u.content||!u.content.includes("{context}")){n({title:i("create_vector_database_prompt.errors.fill_context"),variant:"destructive"});return}const d=u.content.replace("{context}",a.map(p=>`<document>${p.pageContent}</document>`).join(`
`));return await o(r,{...u,content:d}),t.hide(),!0}catch{n({title:i("create_vector_database_prompt.errors.create_failed"),variant:"destructive"})}};return c.jsx(Vn,{open:t.visible,onOpenChange:t.hide,children:c.jsxs(qn,{className:"sm:max-w-[425px]",children:[c.jsx(Zn,{children:c.jsxs("div",{className:"flex",children:[c.jsx(_e,{name:"file",className:"mr-2 h-4 w-4"}),c.jsx(Bn,{children:i("create_vector_database_prompt.title")})]})}),c.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[c.jsx(fs,{onSubmit:l,loading:s,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:dv}),c.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[c.jsx(_e,{name:"info",className:"mr-2",size:14}),i("create_vector_database_prompt.fill_content_note")]})]})]})})}),hv=()=>{const e=rt(s=>{var o;return(o=s.currentSession)==null?void 0:o.id}),[r,a]=b.useState(!1),t=ve(s=>s.createOrUpdateFlowNode),n=ve(s=>s.createOrUpdateFlowEdge),i=b.useCallback(async({prompt:s,source:o,metadata:l})=>{var u,d,p,h;try{const v=(u=o==null?void 0:o.data)==null?void 0:u.entity;if(!v||!e)throw new Error("Source or Session not found");a(!0);const f=((d=o.position)==null?void 0:d.x)||0,m=(((p=o.position)==null?void 0:p.y)||0)+(((h=o.measured)==null?void 0:h.height)||0),g=await he("Prompt").save({...s,status:(s==null?void 0:s.status)||Mt.Started,role:(s==null?void 0:s.role)||$t.System,type:(s==null?void 0:s.type)||Ot.Chat,content:(s==null?void 0:s.content)||"{context}",session_id:e});if(!g)throw new Error("Failed to save prompt");const w=await t({source_id:g.id,source_type:"Prompt",node_type:Q.Prompt,x:f,y:m+20});if(!w)throw new Error("Failed to save prompt node");const S=await he("FlowNodePlaceholder").save({placeholder:`Retriever for ${v.name}`,placeholder_type:Ua.VECTOR_DATABASE_RETREIVER,session_id:e,metadata:l});if(!S)throw new Error("Failed to save node placeholder");const O=await t({source_id:S.id,source_type:"FlowNodePlaceholder",node_type:Q.PlaceHolder,x:f,y:m+40});if(!O)throw new Error("Failed to save node placeholder node");await n({source:w.id,target:O.id}),await n({source:o.id,target:O.id})}finally{a(!1)}},[e,t,n]);return{loading:r,createVectorDatabaseRetriever:i}},pv=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}
`,mv=Fn(e=>{const{source:r}=e,a=Er(),{toast:t}=Pt(),{t:n}=Te("dialogs"),[i,s]=b.useState(1),[o,l]=b.useState(void 0),{loading:u,createVectorDatabaseRetriever:d}=hv(),p=async f=>{try{const m=f.content;if(!m||!m.includes("{context}")){t({title:n("create_vector_database_retriever.errors.fill_context"),variant:"destructive"});return}return await d({source:r,prompt:{content:m},metadata:{k:i,minimalScore:o}}),s(1),l(void 0),a.hide(),!0}catch{t({title:n("create_vector_database_retriever.errors.create_failed"),variant:"destructive"})}},h=f=>{s(f.target.value?Number(f.target.value):void 0)},v=f=>{l(f.target.value?Number(f.target.value):void 0)};return c.jsx(Vn,{open:a.visible,onOpenChange:a.hide,children:c.jsxs(qn,{className:"sm:max-w-[425px]",children:[c.jsx(Zn,{children:c.jsxs("div",{className:"flex",children:[c.jsx(_e,{name:"file",className:"mr-2 h-4 w-4"}),c.jsx(Bn,{children:n("create_vector_database_retriever.title")})]})}),c.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[c.jsx(fs,{onSubmit:p,loading:u,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:pv}),c.jsxs(it,{children:[c.jsx(ft,{children:c.jsx(xt,{children:n("create_vector_database_retriever.retriever_settings")})}),c.jsxs(vt,{children:[c.jsx(je,{children:n("create_vector_database_retriever.retriever_k")}),c.jsx(ht,{value:i||"",type:"number",onChange:h,placeholder:n("create_vector_database_retriever.retriever_k_placeholder")}),c.jsx(je,{children:n("create_vector_database_retriever.retriever_minimum_score")}),c.jsx(ht,{value:o||"",type:"number",onChange:v,placeholder:n("create_vector_database_retriever.retriever_minimum_score_placeholder")})]})]}),c.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[c.jsx(_e,{name:"info",className:"mr-2",size:14}),n("create_vector_database_retriever.fill_content_note")]})]})]})})}),fv=e=>{const r=ve(i=>i.createOrUpdateFlowEdge),{getFlowEmbeddingEntity:a}=ys(),{index:t}=mo(),n=b.useCallback(async({edgeId:i,target:s,source:o})=>{var l,u;try{const d=(l=s==null?void 0:s.data)==null?void 0:l.entity;if((o==null?void 0:o.type)===Q.CSVData&&(s==null?void 0:s.type)===Q.VectorDatabase){const p=(u=o==null?void 0:o.data)==null?void 0:u.entity;if(!p||!d)return{deleteEdgeId:i};const{rows:h}=np(p.headers,p.csv),v=h.map(f=>new ip({pageContent:`${f.text}`}));await t(a(),{database:{databaseId:d.id,dataSourceId:p.id,dataSourceType:"CSVData"}},v),await r({source:o.id,target:s.id});return}return{deleteEdgeId:i}}catch{return{deleteEdgeId:i}}},[r,a,t]);_t(e,n)},vv=e=>{const[r,a]=b.useState(!1),{t}=Te("flows"),{toast:n}=Pt(),{getNode:i,getHandleConnections:s}=Zt(),o=ve(v=>v.updateNodes),{getFlowEmbeddingEntity:l}=ys(),{index:u,similaritySearchWithScore:d}=mo(),p=b.useCallback(async(v,f)=>{var m,g,w;try{const S=i(e);if(!S)return;const O=(m=S.data)==null?void 0:m.entity;if(!O){n({variant:"destructive",title:t("vector_database_node.errors.vector_database_not_found")});return}const x=l();if(O.storage===kr.DataNode){const E=(w=(g=s({nodeId:e,type:"target"}).map($=>i($.source)).find($=>($==null?void 0:$.type)&&[Q.JSONLData,Q.CSVData].includes($==null?void 0:$.type)))==null?void 0:g.data)==null?void 0:w.entity;if(!E){n({variant:"destructive",title:t("vector_database_node.errors.data_node_not_found")});return}return a(!0),await d(x,{database:{databaseId:O.id,dataSourceId:E.id,dataSourceType:_o(E)}},v,f==null?void 0:f.k)}else return a(!0),await d(x,{database:{databaseId:O.id}},v,f==null?void 0:f.k)}catch{n({variant:"destructive",title:t("vector_database_node.errors.similarity_search_failed")})}finally{a(!1)}},[i,e,l,n,t,s,d]),h=b.useCallback(async(v,f)=>{var m,g,w,S;try{const O=i(e);if(!O)return;a(!0);const x=v.content?[new ip({pageContent:v.content,id:v.id,metadata:{id:v.id}})]:v.documents;if(!(x!=null&&x.length)){n({variant:"destructive",title:t("vector_database_node.errors.content_not_found")});return}const E=(m=O.data)==null?void 0:m.entity;if(!E||!O){n({variant:"destructive",title:t("vector_database_node.errors.vector_database_not_found")});return}const $=l();if(E.storage===kr.DataNode){const N=s({nodeId:e,type:"target"}).map(z=>i(z.source)).find(z=>(z==null?void 0:z.type)&&[Q.JSONLData,Q.CSVData].includes(z==null?void 0:z.type)),T=(g=N==null?void 0:N.data)==null?void 0:g.entity;if(!T){n({variant:"destructive",title:t("vector_database_node.errors.data_node_not_found")});return}const D=_o(T),A=Gh(x,10);let R=0;for(const z of A){if((w=f==null?void 0:f.onProgressReport)==null||w.call(f,{handling:z.length,handled:R,total:x.length}),await u($,{database:{databaseId:E.id,dataSourceId:T.id,dataSourceType:D}},z),D&&N){const U=await he(D).findOne({where:{id:T.id}});o([{type:"replace",id:N.id,item:{...N,data:{...N.data,entity:U}}}])}R+=z.length}}else{const N=Gh(x,10);let T=0;for(const D of N){(S=f==null?void 0:f.onProgressReport)==null||S.call(f,{handling:D.length,handled:T,total:x.length}),await u($,{database:{databaseId:E.id}},D);const A=await he("VectorDatabase").findOne({where:{id:`${E.id}`}});o([{type:"replace",id:O.id,item:{...O,data:{...O.data,entity:A}}}]),T+=D.length}}}catch{n({variant:"destructive",title:t("vector_database_node.errors.similarity_search_failed")})}finally{a(!1)}},[i,e,l,n,t,s,u,o]);return{loading:r,indexData:h,similaritySearchWithScore:p}},gv=b.memo(e=>{var $,N,T,D;const{t:r}=Te("flows"),[a,t]=b.useState(0),[n,i]=b.useState("search"),s=mt(e.id),{id:o,data:l,isConnectable:u}=e,{loading:d,similaritySearchWithScore:p,indexData:h}=vv(o),v=Er(uv),f=Er(mv);fv(o);const m=b.useCallback(async(...A)=>{s&&await h(...A)},[h,s]),g=b.useCallback(async(A,R)=>{const z=A.trim(),U=await p(z,{k:R});if(U!=null&&U.length)return U},[p]),w=b.useCallback(A=>{v.show({source:s,documents:A.map(([R])=>R)})},[v,s]),S=b.useCallback(async()=>{f.show({source:s})},[f,s]),O=b.useCallback(async A=>{if(A.type.includes("text")||A.type.includes("txt")){const R=new FileReader;R.onload=async z=>{var M;const U=(M=z.target)==null?void 0:M.result;await m({content:U})},R.readAsText(A)}else if(A.type.endsWith("pdf")){const R=new Blob([A],{type:"application/pdf"}),z=await new ox(R,{pdfjs:async()=>{const U=await Rt(()=>import("./pdf.min-BsZY-3z9.js").then(async M=>(await M.__tla,M)),__vite__mapDeps([8,2,3,1,4,5,6]));return await Rt(()=>import("./pdf.worker.min-C-VRZ2BQ.js").then(async M=>(await M.__tla,M)),__vite__mapDeps([9,1,2,3,4,5,6])),U.GlobalWorkerOptions.workerSrc=new URL("pdfjs-dist/build/pdf.worker.min.js",import.meta.url).toString(),U},parsedItemSeparator:" "}).load();await m({documents:z},{onProgressReport:U=>{t((U.handled+U.handling)/U.total)}})}},[m]),x=b.useMemo(()=>{var z,U;if(!((z=l==null?void 0:l.entity)!=null&&z.raw))return{headers:[],rows:[]};const A=["content","embedding","metadata"],R=bo((U=l==null?void 0:l.entity)==null?void 0:U.raw);return{headers:A,rows:R.map(M=>{try{return JSON.parse(M)}catch{return[]}})}},[($=l==null?void 0:l.entity)==null?void 0:$.raw]),E=b.useMemo(()=>{switch(n){case"search":return c.jsx(pa,{value:"search",children:c.jsx(dx,{loading:d,onSimilaritySearch:g,onCreatePrompt:w,onCreateRetriever:S})});case"new":return c.jsx(pa,{className:"min-w-80",value:"new",children:c.jsx(cx,{loading:d,onCreateData:m})});case"file":return c.jsx(pa,{value:"file",children:c.jsx(lx,{loading:d,progress:a,onFileSubmit:O,fileOptions:{accept:".pdf,.txt,.text",maxSize:15}})});case"view":return c.jsx(pa,{value:"view",children:c.jsx(fo,{data:x.rows,headers:x.headers,limitLengthByColumns:{embedding:32}})})}},[m,w,S,O,g,d,n,a,x]);return c.jsxs("div",{className:"min-w-72",children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:u}),c.jsxs("div",{className:"max-w-full",children:[c.jsx(yt,{id:o}),c.jsxs(It,{className:"flex justify-center",variant:"default",children:[c.jsx(_e,{size:24,name:"database-zap"}),c.jsxs("div",{className:"ml-2 max-w-full",children:[c.jsx(pr,{children:`${((N=l.entity)==null?void 0:N.name)||""}`}),c.jsxs(Wh,{value:n,onValueChange:i,defaultValue:"search",className:Me("w-full mt-4"),children:[c.jsxs(Kh,{className:Me("grid w-full grid-cols-3",((T=l.entity)==null?void 0:T.storage)===kr.DatabaseNode?"grid-cols-4":"grid-cols-3"),children:[c.jsx(ha,{value:"search",children:r("vector_database_node.search")}),c.jsx(ha,{value:"new",children:r("vector_database_node.text")}),c.jsx(ha,{value:"file",children:r("vector_database_node.file")}),((D=l.entity)==null?void 0:D.storage)===kr.DatabaseNode?c.jsx(ha,{value:"view",children:r("vector_database_node.view")}):void 0]}),E]})]})]})]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:u})]})}),yv={embedding:32},_v=b.memo(e=>{var i,s,o;const{id:r,data:a,isConnectable:t}=e,n=b.useMemo(()=>{var d;if(!((d=a==null?void 0:a.entity)!=null&&d.jsonl))return{headers:[],rows:[]};const l=wo(a.entity.headers||""),u=bo(a.entity.jsonl);return{headers:l,rows:u.map(p=>{try{return JSON.parse(p)}catch{return[]}})}},[(i=a==null?void 0:a.entity)==null?void 0:i.jsonl,a.entity.headers]);return c.jsxs("div",{className:"min-w-80",children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsxs("div",{children:[c.jsx(yt,{id:r}),c.jsxs(it,{className:"min-w-32 min-h-16 p-4",children:[c.jsx(ft,{className:"!p-0",children:c.jsxs("div",{className:"pt-2 flex !flex-row",children:[c.jsx(_e,{name:"file-json",className:"mr-2"}),c.jsxs(je,{className:"!font-medium leading-none tracking-tight pr-8",children:[Q.JSONLData," ",(s=n==null?void 0:n.rows)!=null&&s.length?`(${((o=n==null?void 0:n.rows)==null?void 0:o.length)||0})`:""]})]})}),c.jsx(vt,{className:"pb-0",children:c.jsx(fo,{data:n.rows,headers:n.headers,limitLengthByColumns:yv})})]})]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})}),Il=60,Tl=140,bv=Fh("supports-backdrop-blur:bg-white/10 supports-backdrop-blur:dark:bg-black/10 mx-auto flex h-[58px] w-max gap-2 rounded-lg border p-2 backdrop-blur-md"),Al=za.forwardRef(({className:e,children:r,magnification:a=Il,distance:t=Tl,direction:n="bottom",...i},s)=>{const o=Yn(1/0),l=()=>za.Children.map(r,u=>za.isValidElement(u)&&u.type===an?za.cloneElement(u,{...u.props,mouseX:o,magnification:a,distance:t}):u);return c.jsx(Lh.div,{ref:s,onMouseMove:u=>o.set(u.pageX),onMouseLeave:()=>o.set(1/0),...i,className:Me(bv({className:e}),{"items-start":n==="top","items-center":n==="middle","items-end":n==="bottom"}),children:l()})});Al.displayName="Dock";const an=({magnification:e=Il,distance:r=Tl,mouseX:a,className:t,children:n,...i})=>{const s=b.useRef(null),o=$o(a||new Zw(0),d=>{var h;const p=((h=s.current)==null?void 0:h.getBoundingClientRect())??{x:0,width:0};return d-p.x-p.width/2}),l=$o(o,[-r,0,r],[40,e,40]),u=bp(l,{mass:.1,stiffness:150,damping:12});return c.jsx(Lh.div,{ref:s,style:{width:u},className:Me("flex aspect-square cursor-pointer items-center justify-center rounded-full",t),...i,children:n})};an.displayName="DockIcon";const wv={[Q.Shape]:{width:100,height:100},[Q.CircleShape]:{width:100,height:100},[Q.TriangleShape]:{width:100,height:100},[Q.EditorApp]:{width:1240,height:400}},xv=e=>{const r=mt(e),a=rt(o=>o.currentSession),[t,n]=b.useState(!1),i=ve(o=>o.createOrUpdateFlowNode),s=b.useCallback(async o=>{var l,u,d;try{if(n(!0),r&&(a==null?void 0:a.id)){const p=((l=r.position)==null?void 0:l.x)||0,h=(((u=r.position)==null?void 0:u.y)||0)+(((d=r.measured)==null?void 0:d.height)||0),v=await he("FlowNodeData").save({data:{},session_id:a.id});if(!v)throw new Error("Failed to save node data");if(!await i({node_type:o,data:{},source_id:v.id,source_type:"FlowNodeData",x:p,y:h+20,...wv[o]||{}}))throw new Error("Failed to save node")}}finally{n(!1)}},[i,a==null?void 0:a.id,r]);return{loading:t,createNode:s}},Ll={applications:[{key:Q.EditorApp,image:N1,label:"application_bar.editor"},{key:Q.VSLiteApp,icon:$1,label:"application_bar.vslite"}],shapes:[{key:Q.Shape,icon:"square",label:"application_bar.square"},{key:Q.CircleShape,icon:"circle",label:"application_bar.circle"},{key:Q.TriangleShape,icon:"triangle",label:"application_bar.triangle"}]},jv=b.memo(e=>{const{t:r}=Te("flows"),{toast:a}=Pt(),{loading:t,createNode:n}=xv(e.id),i=async s=>{try{if(t)return;await n(s)}catch{a({description:r("application_bar.errors.add_node_failed"),variant:"destructive"})}};return c.jsx(c1,{children:c.jsxs(Al,{direction:"middle",children:[Ll.applications.map(s=>{const o=s.icon;return c.jsx(an,{children:c.jsxs(op,{children:[c.jsxs(lp,{children:[o?c.jsx(o,{width:20,height:20,onClick:()=>i(s.key)}):void 0,s.image?c.jsx("img",{src:s.image,alt:r(s.label),className:"w-8 h-8 rounded-md",onClick:()=>i(s.key)}):void 0]}),c.jsx(cp,{children:c.jsx("p",{children:r(s.label)})})]})},s.label)}),c.jsx(dp,{orientation:"vertical",className:"h-full"}),Ll.shapes.map(s=>c.jsx(an,{children:c.jsxs(op,{children:[c.jsx(lp,{children:c.jsx(_e,{onClick:()=>i(s.key),name:s.icon})}),c.jsx(cp,{children:c.jsx("p",{children:r(s.label)})})]})},s.label))]})})}),nn=b.memo(e=>{const{lineClassName:r,handleClassName:a,...t}=e;return c.jsx(ux,{lineClassName:Me("!border-1.5",r),handleClassName:Me("!w-2 !h-2 !border-2 !rounded-full",a),...t})}),Ev=e=>{const r=ve(t=>t.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if([Q.CircleShape,Q.TriangleShape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===Q.Shape){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},Sv=b.memo(e=>{const{id:r,selected:a,isConnectable:t}=e;return Ev(r),c.jsxs(c.Fragment,{children:[c.jsx(nn,{isVisible:!!a,minWidth:40,minHeight:40}),c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border border",children:c.jsx(yt,{id:r})}),c.jsx(Ve,{type:"source",position:He.Bottom,isConnectable:t})]})}),kv=e=>{const r=ve(t=>t.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if([Q.Shape,Q.TriangleShape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===Q.CircleShape){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},Cv=b.memo(e=>{const{id:r,selected:a,isConnectable:t}=e;return kv(r),c.jsxs(c.Fragment,{children:[c.jsx(nn,{isVisible:!!a,minWidth:40,minHeight:40}),c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border rounded-full border",children:c.jsx(yt,{id:r})}),c.jsx(Ve,{type:"source",position:He.Bottom,isConnectable:t})]})}),Pv=e=>{const r=ve(t=>t.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if([Q.CircleShape,Q.Shape].includes(n==null?void 0:n.type)&&(i==null?void 0:i.type)===Q.TriangleShape){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},Nv=b.memo(e=>{const{id:r,selected:a,width:t,height:n,isConnectable:i}=e;return Pv(r),c.jsxs(c.Fragment,{children:[c.jsx(nn,{isVisible:!!a,minWidth:40,minHeight:40}),c.jsx(Ve,{type:"target",position:He.Top,isConnectable:i}),c.jsx("div",{className:"w-0 h-0 border-l-transparent border-r-transparent border-b-border",style:{borderLeftWidth:(t||0)/2,borderRightWidth:(t||0)/2,borderBottomWidth:n||0}}),c.jsx(yt,{id:r,className:"absolute top-0 right-0"}),c.jsx(Ve,{type:"source",position:He.Bottom,isConnectable:i})]})}),$v=e=>{const r=ve(t=>t.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===Q.LLM&&(i==null?void 0:i.type)===Q.EditorApp){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},Ov=e=>{const r=mt(e),{t:a}=Te("flows"),t=b.useRef(null),{toast:n}=Pt(),{getNode:i,getHandleConnections:s}=Zt(),{stream:o}=Eo(),l=b.useCallback(async p=>{r&&(clearTimeout(t.current),t.current=setTimeout(async()=>{await he("FlowNode").update(r.id,{data:p})},150))},[r]),u=b.useCallback(async(p,h)=>{var v,f;if(r){const m=s({nodeId:e,type:"target"}).find(S=>{var O;return((O=i(S.source))==null?void 0:O.type)===Q.LLM}),g=m?i(m==null?void 0:m.source):void 0,w=(v=g==null?void 0:g.data)==null?void 0:v.entity;if(!g||!w)return n({variant:"destructive",description:a("editor_node.errors.llm_not_found")});if(g.data.status!==jt.Loaded)return n({variant:"destructive",description:a("editor_node.errors.llm_not_loaded_yet")});try{return(f=await o(w.provider,typeof p=="string"?[new ma(p)]:p,{onMessageUpdate:S=>{h==null||h(S.content)},llm:w}))==null?void 0:f.content}catch(S){if(S instanceof Error&&S.message.includes("LLM_NOT_LOADED_YET"))return n({title:a("editor_node.errors.llm_not_loaded_yet")});n({variant:"destructive",title:a("editor_node.errors.stream_message_failed")})}}},[r,s,e,i,n,a,o]),d=b.useCallback(p=>{if(!i(p))return[];const h=[];return s({nodeId:p,type:"target"}).forEach(v=>{const f=i(v.source);!f||f.type!==Q.LLM||h.push({node:f,connections:[v]})}),h},[s,i]);return{createMessage:u,updateEditorContent:l,getLinkedConnections:d}},Rv=b.lazy(()=>Rt(()=>import("./index-9jyfFUfd.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([10,2,3,11,12,4,13,14,15,16,17,6,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,1,5,58]))),Iv=b.memo(e=>{var u;const{id:r,data:a,selected:t,isConnectable:n}=e;$v(r);const{createMessage:i,updateEditorContent:s,getLinkedConnections:o}=Ov(r),l=b.useCallback(d=>{s(d)},[s]);return c.jsxs("div",{className:"w-full min-w-[1240px] h-full",children:[c.jsx(nn,{isVisible:!!t,minWidth:1240,minHeight:400}),c.jsx(Ve,{type:"target",position:He.Top,isConnectable:n}),c.jsxs("div",{className:"min-w-10 min-h-10 w-full h-full rounded-lg border bg-background",children:[c.jsx(yt,{className:"!z-[100]",id:r,enableToStandalone:!0,getLinkedConnections:o}),c.jsx(b.Suspense,{fallback:c.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:c.jsx(_e,{name:"loader-circle",className:"animate-spin"})}),children:c.jsx("div",{className:"h-full w-ful rounded-lg","data-registry":"plate",children:c.jsx(Rv,{defaultValue:(u=a==null?void 0:a.flowNode)==null?void 0:u.data,onValueChange:l,copilotStream:i})})})]}),c.jsx(Ve,{type:"source",position:He.Bottom,isConnectable:n})]})}),Tv=e=>{const r=b.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);_t(e,r)},Av=b.memo(e=>{var s,o;const{id:r,data:a,isConnectable:t}=e,{t:n}=Te("flows");Tv(r);let i="";switch((s=a.entity)==null?void 0:s.placeholder_type){case"VECTOR_DATABASE_RETREIVER":i=n("placeholder_node.vector_database_retriever");break}return c.jsxs("div",{children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:t}),c.jsxs(It,{className:"flex justify-center max-w-80",variant:"default",children:[c.jsx(yt,{id:r}),c.jsx(_e,{name:"land-plot",className:"w-7 h-7"}),c.jsxs("div",{className:"ml-2 pr-4",children:[c.jsx(pr,{children:`${((o=a.entity)==null?void 0:o.placeholder)||""}`}),c.jsx(ua,{children:i?c.jsx(zr,{children:i}):void 0})]})]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:t})]})}),Lv=["empty-source","vite-vue","shadcn-react-vite","todo-app-react-vite","porfolio-nextjs"],Fv=async e=>{switch(e){case"empty-source":return Rt(()=>import("./empty-source-Dw1dvL8s.js"),[]).then(r=>r.BASE);case"vite-vue":return Rt(()=>import("./vite-vue-Bmz2z3Fo.js"),[]).then(r=>r.BASE);case"shadcn-react-vite":return Rt(()=>import("./shadcn-react-vite-CDJ9BaE9.js"),[]).then(r=>r.BASE);case"todo-app-react-vite":return Rt(()=>import("./todo-app-react-vite-BBWBkRjR.js"),[]).then(r=>r.BASE);case"porfolio-nextjs":return Rt(()=>import("./porfolio-nextjs-DCkli5iW.js"),[]).then(r=>r.BASE);default:throw new Error(`Unknown source base: ${e}`)}},Dv=b.memo(({className:e,onUpdateSourceBase:r})=>{const{t:a}=Te("components"),[t,n]=b.useState();return c.jsxs(it,{className:Me("mw-full",e),children:[c.jsx(ft,{className:"p-4",children:c.jsx(xt,{children:a("add_source_base.title")})}),c.jsx(vt,{className:"p-4",children:c.jsxs("div",{className:"flex items-center justify-center w-full h-full flex-col",children:[c.jsxs(cr,{onValueChange:i=>n(i),children:[c.jsx(dr,{className:"w-full mb-4",children:c.jsx(ur,{placeholder:a("add_source_base.source_base_select_placeholder")})}),c.jsx(hr,{children:Lv.map(i=>c.jsx(Nt,{value:`${i}`,children:a(`add_source_base.sourcebases.${i.toLowerCase()}`)},`${i}`))})]}),c.jsx(We,{className:"w-full",onClick:async()=>t&&r(await Fv(t)),children:a("add_source_base.update_source")})]})})]})}),Mv=()=>{const{getNode:e,getHandleConnections:r}=Zt(),{stream:a}=Eo(),t=b.useCallback(async(i,s)=>{await he("FlowNode").update(i,{raw:O1(s)})},[]),n=b.useCallback(i=>{if(!e(i))return[];const s=[];return r({nodeId:i,type:"target"}).forEach(o=>{const l=e(o.source);!l||l.type!==Q.LLM||s.push({node:l,connections:[o]})}),s},[r,e]);return{sendMessage:b.useCallback(async(i,s,{onMessageUpdate:o,onResponseMessageCreate:l}={})=>{const u=s.map(p=>p.role==="system"?new sp(p.content):p.role==="user"?new ma(p.content):new Kn(p.content));l==null||l();const d=await a($e.WebLLM,[...u,new ma(i)],{onMessageUpdate:({content:p})=>{o==null||o({nodeData:{loading:!0,content:p}})},llm:void 0});return o==null||o({nodeData:{loading:!1,content:d==null?void 0:d.content}}),d==null?void 0:d.content},[a]),getLinkedConnections:n,updateCodeContainerData:t}},zv=e=>{const r=ve(t=>t.createOrUpdateFlowEdge),a=b.useCallback(async({edgeId:t,source:n,target:i,connection:s})=>{try{if((n==null?void 0:n.type)===Q.LLM&&(i==null?void 0:i.type)===Q.VSLiteApp){await r({source:s.source,target:s.target,sourceHandle:s.sourceHandle,targetHandle:s.targetHandle});return}return{deleteEdgeId:t}}catch{return{deleteEdgeId:t}}},[r]);_t(e,a)},Uv=b.lazy(()=>Rt(()=>import("./index-B8gu1rAU.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([59,2,3,4,13,36,6,60,61,62,16,63]))),Hv=b.memo(e=>{var h,v,f,m;const{id:r,isConnectable:a,data:t}=e,[n,i]=b.useState((h=t==null?void 0:t.flowNode)!=null&&h.raw?R1(t.flowNode.raw):void 0),{updateCodeContainerData:s,getLinkedConnections:o,sendMessage:l}=Mv();zv(r);const u=b.useCallback(async g=>{var w,S;(w=t==null?void 0:t.flowNode)!=null&&w.id&&(await s((S=t==null?void 0:t.flowNode)==null?void 0:S.id,g),i(g))},[(v=t==null?void 0:t.flowNode)==null?void 0:v.id,s]),d=b.useCallback(async(g,w)=>{var S;return(S=t==null?void 0:t.flowNode)!=null&&S.id?await l(g,w):void 0},[(f=t==null?void 0:t.flowNode)==null?void 0:f.id,l]),p=b.useCallback(async g=>{i(w=>{var O;const S=I1(w||{},g);return s((O=t==null?void 0:t.flowNode)==null?void 0:O.id,S),S})},[(m=t==null?void 0:t.flowNode)==null?void 0:m.id,s]);return n?c.jsxs("div",{className:"w-[1380px] h-[600px] rounded-lg border overflow-hidden shadow-sm",children:[c.jsx(Ve,{type:"target",position:He.Top,isConnectable:a}),c.jsxs("div",{className:"w-full h-full rounded-lg border bg-card overflow-hidden",children:[c.jsx(yt,{id:r,className:"z-50",enableToStandalone:!0,getLinkedConnections:o}),c.jsx(b.Suspense,{fallback:c.jsx("div",{className:"h-full w-full flex justify-center items-center",children:c.jsx(_e,{name:"loader-circle",className:"animate-spin"})}),children:c.jsx(Uv,{fileSystemTree:n,onUpdateFileContent:p,sendMessage:d})})]}),c.jsx(Ve,{type:"source",position:He.Bottom,isConnectable:a})]}):c.jsx("div",{className:"h-full flex justify-center items-center",children:c.jsx(Dv,{className:"w-64",onUpdateSourceBase:u})})}),Vv=e=>{const r=b.useCallback(async({edgeId:a})=>{try{return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[]);_t(e,r)},Fl=(e,r)=>e.anyOf.length?e.anyOf.length===1?ut(e.anyOf[0],{...r,path:[...r.path,"anyOf",0]}):`z.union([${e.anyOf.map((a,t)=>ut(a,{...r,path:[...r.path,"anyOf",t]})).join(", ")}])`:"z.any()",qv=e=>"z.boolean()",Zv=e=>"z.any()",Bv=(e,r)=>`z.union([${e.type.map(a=>ut({...e,type:a},{...r,withoutDefaults:!0})).join(", ")}])`,Wv=(e,r)=>`z.any().refine((value) => !${ut(e.not,{...r,path:[...r.path,"not"]})}.safeParse(value).success, "Invalid input: Should NOT be valid against schema")`,Kv=e=>"z.null()",Qv=e=>[e.slice(0,e.length/2),e.slice(e.length/2)],ja=Symbol("Original index"),Gv=e=>{let r=[];for(let a=0;a<e.length;a++){const t=e[a];if(typeof t=="boolean")r.push(t?{[ja]:a}:{[ja]:a,not:{}});else{if(ja in t)return e;r.push({...t,[ja]:a})}}return r};function sn(e,r){if(e.allOf.length===0)return"z.never()";if(e.allOf.length===1){const a=e.allOf[0];return ut(a,{...r,path:[...r.path,"allOf",a[ja]]})}else{const[a,t]=Qv(Gv(e.allOf));return`z.intersection(${sn({allOf:a},r)}, ${sn({allOf:t},r)})`}}function dt(e,r,a){var i;const t=e[r];let n="";if(t!==void 0){const s=a({value:t,json:JSON.stringify(t)});if(s){const o=s[0],l=s.length===3?s[1]:"",u=s.length===3?s[2]:s[1];n+=o,((i=e.errorMessage)==null?void 0:i[r])!==void 0&&(n+=l+JSON.stringify(e.errorMessage[r])),n+=u}}return n}const Jv=(e,r)=>{if(Array.isArray(e.items))return`z.tuple([${e.items.map((t,n)=>ut(t,{...r,path:[...r.path,"items",n]}))}])`;let a=e.items?`z.array(${ut(e.items,{...r,path:[...r.path,"items"]})})`:"z.array(z.any())";return a+=dt(e,"minItems",({json:t})=>[`.min(${t}`,", ",")"]),a+=dt(e,"maxItems",({json:t})=>[`.max(${t}`,", ",")"]),a},Xv=e=>`z.literal(${JSON.stringify(e.const)})`,Yv=e=>e.enum.length===0?"z.never()":e.enum.length===1?`z.literal(${JSON.stringify(e.enum[0])})`:e.enum.every(r=>typeof r=="string")?`z.enum([${e.enum.map(r=>JSON.stringify(r))}])`:`z.union([${e.enum.map(r=>`z.literal(${JSON.stringify(r)})`).join(", ")}])`,eg=(e,r)=>{const a=ut(e.if,{...r,path:[...r.path,"if"]}),t=ut(e.then,{...r,path:[...r.path,"then"]}),n=ut(e.else,{...r,path:[...r.path,"else"]});return`z.union([${t}, ${n}]).superRefine((value,ctx) => {
  const result = ${a}.safeParse(value).success
    ? ${t}.safeParse(value)
    : ${n}.safeParse(value);
  if (!result.success) {
    result.error.errors.forEach((error) => ctx.addIssue(error))
  }
})`},tg=e=>{let r="z.number()";return e.type==="integer"?r+=dt(e,"type",()=>[".int(",")"]):r+=dt(e,"format",({value:a})=>{if(a==="int64")return[".int(",")"]}),r+=dt(e,"multipleOf",({value:a,json:t})=>a===1?r.startsWith("z.number().int(")?void 0:[".int(",")"]:[`.multipleOf(${t}`,", ",")"]),typeof e.minimum=="number"?e.exclusiveMinimum===!0?r+=dt(e,"minimum",({json:a})=>[`.gt(${a}`,", ",")"]):r+=dt(e,"minimum",({json:a})=>[`.gte(${a}`,", ",")"]):typeof e.exclusiveMinimum=="number"&&(r+=dt(e,"exclusiveMinimum",({json:a})=>[`.gt(${a}`,", ",")"])),typeof e.maximum=="number"?e.exclusiveMaximum===!0?r+=dt(e,"maximum",({json:a})=>[`.lt(${a}`,", ",")"]):r+=dt(e,"maximum",({json:a})=>[`.lte(${a}`,", ",")"]):typeof e.exclusiveMaximum=="number"&&(r+=dt(e,"exclusiveMaximum",({json:a})=>[`.lt(${a}`,", ",")"])),r},Dl=(e,r)=>e.oneOf.length?e.oneOf.length===1?ut(e.oneOf[0],{...r,path:[...r.path,"oneOf",0]}):`z.any().superRefine((x, ctx) => {
    const schemas = [${e.oneOf.map((a,t)=>ut(a,{...r,path:[...r.path,"oneOf",t]})).join(", ")}];
    const errors = schemas.reduce<z.ZodError[]>(
      (errors, schema) =>
        ((result) =>
          result.error ? [...errors, result.error] : errors)(
          schema.safeParse(x),
        ),
      [],
    );
    if (schemas.length - errors.length !== 1) {
      ctx.addIssue({
        path: ctx.path,
        code: "invalid_union",
        unionErrors: errors,
        message: "Invalid input: Should pass single schema",
      });
    }
  })`:"z.any()",Ml=e=>{const r=e.split(`
`);return`/**${r.length===1?r[0]:`
${r.map(a=>`* ${a}`).join(`
`)}
`}*/
`},rg=(e,r)=>{const a=e.description;return a?`
${Ml(a)}${r}`:r};function ag(e,r){let a;e.properties&&(Object.keys(e.properties).length?(a="z.object({ ",a+=Object.keys(e.properties).map(s=>{const o=e.properties[s];let l=`${JSON.stringify(s)}: ${ut(o,{...r,path:[...r.path,"properties",s]})}`;r.withJsdocs&&typeof o=="object"&&(l=rg(o,l));const u=typeof o=="object"&&o.default!==void 0,d=Array.isArray(e.required)?e.required.includes(s):typeof o=="object"&&o.required===!0;return!u&&!d?`${l}.optional()`:l}).join(", "),a+=" })"):a="z.object({})");const t=e.additionalProperties!==void 0?ut(e.additionalProperties,{...r,path:[...r.path,"additionalProperties"]}):void 0;let n;if(e.patternProperties){const s=Object.fromEntries(Object.entries(e.patternProperties).map(([o,l])=>[o,ut(l,{...r,path:[...r.path,"patternProperties",o]})],{}));n="",a?t?n+=`.catchall(z.union([${[...Object.values(s),t].join(", ")}]))`:Object.keys(s).length>1?n+=`.catchall(z.union([${Object.values(s).join(", ")}]))`:n+=`.catchall(${Object.values(s)})`:t?n+=`z.record(z.union([${[...Object.values(s),t].join(", ")}]))`:Object.keys(s).length>1?n+=`z.record(z.union([${Object.values(s).join(", ")}]))`:n+=`z.record(${Object.values(s)})`,n+=`.superRefine((value, ctx) => {
`,n+=`for (const key in value) {
`,t&&(e.properties?n+=`let evaluated = [${Object.keys(e.properties).map(o=>JSON.stringify(o)).join(", ")}].includes(key)
`:n+=`let evaluated = false
`);for(const o in e.patternProperties)n+="if (key.match(new RegExp("+JSON.stringify(o)+`))) {
`,t&&(n+=`evaluated = true
`),n+="const result = "+s[o]+`.safeParse(value[key])
`,n+=`if (!result.success) {
`,n+=`ctx.addIssue({
          path: [...ctx.path, key],
          code: 'custom',
          message: \`Invalid input: Key matching regex /\${key}/ must match schema\`,
          params: {
            issues: result.error.issues
          }
        })
`,n+=`}
`,n+=`}
`;t&&(n+=`if (!evaluated) {
`,n+="const result = "+t+`.safeParse(value[key])
`,n+=`if (!result.success) {
`,n+=`ctx.addIssue({
          path: [...ctx.path, key],
          code: 'custom',
          message: \`Invalid input: must match catchall schema\`,
          params: {
            issues: result.error.issues
          }
        })
`,n+=`}
`,n+=`}
`),n+=`}
`,n+="})"}let i=a?n?a+n:t?t==="z.never()"?a+".strict()":a+`.catchall(${t})`:a:n||(t?`z.record(${t})`:"z.record(z.any())");return ot.an.anyOf(e)&&(i+=`.and(${Fl({...e,anyOf:e.anyOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},r)})`),ot.a.oneOf(e)&&(i+=`.and(${Dl({...e,oneOf:e.oneOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},r)})`),ot.an.allOf(e)&&(i+=`.and(${sn({...e,allOf:e.allOf.map(s=>typeof s=="object"&&!s.type&&(s.properties||s.additionalProperties||s.patternProperties)?{...s,type:"object"}:s)},r)})`),i}const ng=e=>{let r="z.string()";r+=dt(e,"format",({value:t})=>{switch(t){case"email":return[".email(",")"];case"ip":return[".ip(",")"];case"ipv4":return['.ip({ version: "v4"',", message: "," })"];case"ipv6":return['.ip({ version: "v6"',", message: "," })"];case"uri":return[".url(",")"];case"uuid":return[".uuid(",")"];case"date-time":return[".datetime({ offset: true",", message: "," })"];case"time":return[".time(",")"];case"date":return[".date(",")"];case"binary":return[".base64(",")"];case"duration":return[".duration(",")"]}}),r+=dt(e,"pattern",({json:t})=>[`.regex(new RegExp(${t})`,", ",")"]),r+=dt(e,"minLength",({json:t})=>[`.min(${t}`,", ",")"]),r+=dt(e,"maxLength",({json:t})=>[`.max(${t}`,", ",")"]),r+=dt(e,"contentEncoding",({value:t})=>{if(t==="base64")return[".base64(",")"]});const a=dt(e,"contentMediaType",({value:t})=>{if(t==="application/json")return['.transform((str, ctx) => { try { return JSON.parse(str); } catch (err) { ctx.addIssue({ code: "custom", message: "Invalid JSON" }); }}',", ",")"]});return a!=""&&(r+=a,r+=dt(e,"contentSchema",({value:t})=>{if(t&&t instanceof Object)return[`.pipe(${ut(t)}`,", ",")"]})),r},sg=(e,...r)=>Object.keys(e).reduce((a,t)=>(r.includes(t)||(a[t]=e[t]),a),{}),ig=(e,r)=>`${ut(sg(e,"nullable"),r,!0)}.nullable()`,ut=(e,r={seen:new Map,path:[]},a)=>{if(typeof e!="object")return e?"z.any()":"z.never()";if(r.parserOverride){const i=r.parserOverride(e,r);if(typeof i=="string")return i}let t=r.seen.get(e);if(t){if(t.r!==void 0)return t.r;if(r.depth===void 0||t.n>=r.depth)return"z.any()";t.n+=1}else t={r:void 0,n:0},r.seen.set(e,t);let n=dg(e,r);return a||(r.withoutDescribes||(n=og(e,n)),r.withoutDefaults||(n=lg(e,n)),n=cg(e,n)),t.r=n,n},og=(e,r)=>(e.description&&(r+=`.describe(${JSON.stringify(e.description)})`),r),lg=(e,r)=>(e.default!==void 0&&(r+=`.default(${JSON.stringify(e.default)})`),r),cg=(e,r)=>(e.readOnly&&(r+=".readonly()"),r),dg=(e,r)=>ot.a.nullable(e)?ig(e,r):ot.an.object(e)?ag(e,r):ot.an.array(e)?Jv(e,r):ot.an.anyOf(e)?Fl(e,r):ot.an.allOf(e)?sn(e,r):ot.a.oneOf(e)?Dl(e,r):ot.a.not(e)?Wv(e,r):ot.an.enum(e)?Yv(e):ot.a.const(e)?Xv(e):ot.a.multipleType(e)?Bv(e,r):ot.a.primitive(e,"string")?ng(e):ot.a.primitive(e,"number")||ot.a.primitive(e,"integer")?tg(e):ot.a.primitive(e,"boolean")?qv():ot.a.primitive(e,"null")?Kv():ot.a.conditional(e)?eg(e,r):Zv(),ot={an:{object:e=>e.type==="object",array:e=>e.type==="array",anyOf:e=>e.anyOf!==void 0,allOf:e=>e.allOf!==void 0,enum:e=>e.enum!==void 0},a:{nullable:e=>e.nullable===!0,multipleType:e=>Array.isArray(e.type),not:e=>e.not!==void 0,const:e=>e.const!==void 0,primitive:(e,r)=>e.type===r,conditional:e=>!!("if"in e&&e.if&&"then"in e&&"else"in e&&e.then&&e.else),oneOf:e=>e.oneOf!==void 0}},ug=(e,{module:r,name:a,type:t,noImport:n,...i}={})=>{if(t&&(!a||r!=="esm"))throw new Error("Option `type` requires `name` to be set and `module` to be `esm`");let s=ut(e,{module:r,name:a,path:[],seen:new Map,...i});const o=i.withJsdocs&&typeof e!="boolean"&&e.description?Ml(e.description):"";if(r==="cjs"?(s=`${o}module.exports = ${a?`{ ${JSON.stringify(a)}: ${s} }`:s}
`,n||(s=`${o}const { z } = require("zod")

${s}`)):r==="esm"?(s=`${o}export ${a?`const ${a} =`:"default"} ${s}
`,n||(s=`import { z } from "zod"

${s}`)):a&&(s=`${o}const ${a} = ${s}`),t&&a){let l=typeof t=="string"?t:`${a[0].toUpperCase()}${a.substring(1)}`;s+=`export type ${l} = z.infer<typeof ${a}>
`}return s},on="2025-06-18",hg=[on,"2025-03-26","2024-11-05","2024-10-07"],ln="2.0",zl=y.union([y.string(),y.number().int()]),Ul=y.string(),pg=y.object({progressToken:y.optional(zl)}).passthrough(),Tt=y.object({_meta:y.optional(pg)}).passthrough(),St=y.object({method:y.string(),params:y.optional(Tt)}),Ea=y.object({_meta:y.optional(y.object({}).passthrough())}).passthrough(),Kt=y.object({method:y.string(),params:y.optional(Ea)}),At=y.object({_meta:y.optional(y.object({}).passthrough())}).passthrough(),cn=y.union([y.string(),y.number().int()]),Hl=y.object({jsonrpc:y.literal(ln),id:cn}).merge(St).strict(),Vl=e=>Hl.safeParse(e).success,ql=y.object({jsonrpc:y.literal(ln)}).merge(Kt).strict(),mg=e=>ql.safeParse(e).success,Zl=y.object({jsonrpc:y.literal(ln),id:cn,result:At}).strict(),_s=e=>Zl.safeParse(e).success;var Qt;(function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"})(Qt||(Qt={}));const Bl=y.object({jsonrpc:y.literal(ln),id:cn,error:y.object({code:y.number().int(),message:y.string(),data:y.optional(y.unknown())})}).strict(),fg=e=>Bl.safeParse(e).success,Sa=y.union([Hl,ql,Zl,Bl]),Vr=At.strict(),bs=Kt.extend({method:y.literal("notifications/cancelled"),params:Ea.extend({requestId:cn,reason:y.string().optional()})}),ka=y.object({name:y.string(),title:y.optional(y.string())}).passthrough(),Wl=ka.extend({version:y.string()}),vg=y.object({experimental:y.optional(y.object({}).passthrough()),sampling:y.optional(y.object({}).passthrough()),elicitation:y.optional(y.object({}).passthrough()),roots:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough())}).passthrough(),gg=St.extend({method:y.literal("initialize"),params:Tt.extend({protocolVersion:y.string(),capabilities:vg,clientInfo:Wl})}),yg=y.object({experimental:y.optional(y.object({}).passthrough()),logging:y.optional(y.object({}).passthrough()),completions:y.optional(y.object({}).passthrough()),prompts:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough()),resources:y.optional(y.object({subscribe:y.optional(y.boolean()),listChanged:y.optional(y.boolean())}).passthrough()),tools:y.optional(y.object({listChanged:y.optional(y.boolean())}).passthrough())}).passthrough(),Kl=At.extend({protocolVersion:y.string(),capabilities:yg,serverInfo:Wl,instructions:y.optional(y.string())}),Ql=Kt.extend({method:y.literal("notifications/initialized")}),_g=e=>Ql.safeParse(e).success,ws=St.extend({method:y.literal("ping")}),bg=y.object({progress:y.number(),total:y.optional(y.number()),message:y.optional(y.string())}).passthrough(),xs=Kt.extend({method:y.literal("notifications/progress"),params:Ea.merge(bg).extend({progressToken:zl})}),dn=St.extend({params:Tt.extend({cursor:y.optional(Ul)}).optional()}),un=At.extend({nextCursor:y.optional(Ul)}),Gl=y.object({uri:y.string(),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Jl=Gl.extend({text:y.string()}),Xl=Gl.extend({blob:y.string().base64()}),Yl=ka.extend({uri:y.string(),description:y.optional(y.string()),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}),wg=ka.extend({uriTemplate:y.string(),description:y.optional(y.string()),mimeType:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}),xg=dn.extend({method:y.literal("resources/list")}),ec=un.extend({resources:y.array(Yl)}),jg=dn.extend({method:y.literal("resources/templates/list")}),tc=un.extend({resourceTemplates:y.array(wg)}),Eg=St.extend({method:y.literal("resources/read"),params:Tt.extend({uri:y.string()})}),rc=At.extend({contents:y.array(y.union([Jl,Xl]))}),Sg=Kt.extend({method:y.literal("notifications/resources/list_changed")}),kg=St.extend({method:y.literal("resources/subscribe"),params:Tt.extend({uri:y.string()})}),Cg=St.extend({method:y.literal("resources/unsubscribe"),params:Tt.extend({uri:y.string()})}),Pg=Kt.extend({method:y.literal("notifications/resources/updated"),params:Ea.extend({uri:y.string()})}),Ng=y.object({name:y.string(),description:y.optional(y.string()),required:y.optional(y.boolean())}).passthrough(),$g=ka.extend({description:y.optional(y.string()),arguments:y.optional(y.array(Ng)),_meta:y.optional(y.object({}).passthrough())}),Og=dn.extend({method:y.literal("prompts/list")}),ac=un.extend({prompts:y.array($g)}),Rg=St.extend({method:y.literal("prompts/get"),params:Tt.extend({name:y.string(),arguments:y.optional(y.record(y.string()))})}),js=y.object({type:y.literal("text"),text:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Es=y.object({type:y.literal("image"),data:y.string().base64(),mimeType:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Ss=y.object({type:y.literal("audio"),data:y.string().base64(),mimeType:y.string(),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Ig=y.object({type:y.literal("resource"),resource:y.union([Jl,Xl]),_meta:y.optional(y.object({}).passthrough())}).passthrough(),Tg=Yl.extend({type:y.literal("resource_link")}),nc=y.union([js,Es,Ss,Tg,Ig]),Ag=y.object({role:y.enum(["user","assistant"]),content:nc}).passthrough(),sc=At.extend({description:y.optional(y.string()),messages:y.array(Ag)}),Lg=Kt.extend({method:y.literal("notifications/prompts/list_changed")}),Fg=y.object({title:y.optional(y.string()),readOnlyHint:y.optional(y.boolean()),destructiveHint:y.optional(y.boolean()),idempotentHint:y.optional(y.boolean()),openWorldHint:y.optional(y.boolean())}).passthrough(),Dg=ka.extend({description:y.optional(y.string()),inputSchema:y.object({type:y.literal("object"),properties:y.optional(y.object({}).passthrough()),required:y.optional(y.array(y.string()))}).passthrough(),outputSchema:y.optional(y.object({type:y.literal("object"),properties:y.optional(y.object({}).passthrough()),required:y.optional(y.array(y.string()))}).passthrough()),annotations:y.optional(Fg),_meta:y.optional(y.object({}).passthrough())}),Mg=dn.extend({method:y.literal("tools/list")}),ic=un.extend({tools:y.array(Dg)}),hn=At.extend({content:y.array(nc).default([]),structuredContent:y.object({}).passthrough().optional(),isError:y.optional(y.boolean())});hn.or(At.extend({toolResult:y.unknown()}));const zg=St.extend({method:y.literal("tools/call"),params:Tt.extend({name:y.string(),arguments:y.optional(y.record(y.unknown()))})}),Ug=Kt.extend({method:y.literal("notifications/tools/list_changed")}),oc=y.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),Hg=St.extend({method:y.literal("logging/setLevel"),params:Tt.extend({level:oc})}),Vg=Kt.extend({method:y.literal("notifications/message"),params:Ea.extend({level:oc,logger:y.optional(y.string()),data:y.unknown()})}),qg=y.object({name:y.string().optional()}).passthrough(),Zg=y.object({hints:y.optional(y.array(qg)),costPriority:y.optional(y.number().min(0).max(1)),speedPriority:y.optional(y.number().min(0).max(1)),intelligencePriority:y.optional(y.number().min(0).max(1))}).passthrough(),Bg=y.object({role:y.enum(["user","assistant"]),content:y.union([js,Es,Ss])}).passthrough(),Wg=St.extend({method:y.literal("sampling/createMessage"),params:Tt.extend({messages:y.array(Bg),systemPrompt:y.optional(y.string()),includeContext:y.optional(y.enum(["none","thisServer","allServers"])),temperature:y.optional(y.number()),maxTokens:y.number().int(),stopSequences:y.optional(y.array(y.string())),metadata:y.optional(y.object({}).passthrough()),modelPreferences:y.optional(Zg)})}),Kg=At.extend({model:y.string(),stopReason:y.optional(y.enum(["endTurn","stopSequence","maxTokens"]).or(y.string())),role:y.enum(["user","assistant"]),content:y.discriminatedUnion("type",[js,Es,Ss])}),Qg=y.object({type:y.literal("boolean"),title:y.optional(y.string()),description:y.optional(y.string()),default:y.optional(y.boolean())}).passthrough(),Gg=y.object({type:y.literal("string"),title:y.optional(y.string()),description:y.optional(y.string()),minLength:y.optional(y.number()),maxLength:y.optional(y.number()),format:y.optional(y.enum(["email","uri","date","date-time"]))}).passthrough(),Jg=y.object({type:y.enum(["number","integer"]),title:y.optional(y.string()),description:y.optional(y.string()),minimum:y.optional(y.number()),maximum:y.optional(y.number())}).passthrough(),Xg=y.object({type:y.literal("string"),title:y.optional(y.string()),description:y.optional(y.string()),enum:y.array(y.string()),enumNames:y.optional(y.array(y.string()))}).passthrough(),Yg=y.union([Qg,Gg,Jg,Xg]),ey=St.extend({method:y.literal("elicitation/create"),params:Tt.extend({message:y.string(),requestedSchema:y.object({type:y.literal("object"),properties:y.record(y.string(),Yg),required:y.optional(y.array(y.string()))}).passthrough()})}),ty=At.extend({action:y.enum(["accept","decline","cancel"]),content:y.optional(y.record(y.string(),y.unknown()))}),ry=y.object({type:y.literal("ref/resource"),uri:y.string()}).passthrough(),ay=y.object({type:y.literal("ref/prompt"),name:y.string()}).passthrough(),ny=St.extend({method:y.literal("completion/complete"),params:Tt.extend({ref:y.union([ay,ry]),argument:y.object({name:y.string(),value:y.string()}).passthrough(),context:y.optional(y.object({arguments:y.optional(y.record(y.string(),y.string()))}))})}),lc=At.extend({completion:y.object({values:y.array(y.string()).max(100),total:y.optional(y.number().int()),hasMore:y.optional(y.boolean())}).passthrough()}),sy=y.object({uri:y.string().startsWith("file://"),name:y.optional(y.string()),_meta:y.optional(y.object({}).passthrough())}).passthrough(),iy=St.extend({method:y.literal("roots/list")}),oy=At.extend({roots:y.array(sy)}),ly=Kt.extend({method:y.literal("notifications/roots/list_changed")});y.union([ws,gg,ny,Hg,Rg,Og,xg,jg,Eg,kg,Cg,zg,Mg]),y.union([bs,xs,Ql,ly]),y.union([Vr,Kg,ty,oy]),y.union([ws,Wg,ey,iy]),y.union([bs,xs,Vg,Pg,Sg,Ug,Lg]),y.union([Vr,Kl,lc,sc,ac,ec,tc,rc,hn,ic]);class gr extends Error{constructor(r,a,t){super(`MCP error ${r}: ${a}`),this.code=r,this.data=t,this.name="McpError"}}const cy=6e4;class dy{constructor(r){this._options=r,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this.setNotificationHandler(bs,a=>{const t=this._requestHandlerAbortControllers.get(a.params.requestId);t==null||t.abort(a.params.reason)}),this.setNotificationHandler(xs,a=>{this._onprogress(a)}),this.setRequestHandler(ws,a=>({}))}_setupTimeout(r,a,t,n,i=!1){this._timeoutInfo.set(r,{timeoutId:setTimeout(n,a),startTime:Date.now(),timeout:a,maxTotalTimeout:t,resetTimeoutOnProgress:i,onTimeout:n})}_resetTimeout(r){const a=this._timeoutInfo.get(r);if(!a)return!1;const t=Date.now()-a.startTime;if(a.maxTotalTimeout&&t>=a.maxTotalTimeout)throw this._timeoutInfo.delete(r),new gr(Qt.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:a.maxTotalTimeout,totalElapsed:t});return clearTimeout(a.timeoutId),a.timeoutId=setTimeout(a.onTimeout,a.timeout),!0}_cleanupTimeout(r){const a=this._timeoutInfo.get(r);a&&(clearTimeout(a.timeoutId),this._timeoutInfo.delete(r))}async connect(r){var a,t,n;this._transport=r;const i=(a=this.transport)===null||a===void 0?void 0:a.onclose;this._transport.onclose=()=>{i==null||i(),this._onclose()};const s=(t=this.transport)===null||t===void 0?void 0:t.onerror;this._transport.onerror=l=>{s==null||s(l),this._onerror(l)};const o=(n=this._transport)===null||n===void 0?void 0:n.onmessage;this._transport.onmessage=(l,u)=>{o==null||o(l,u),_s(l)||fg(l)?this._onresponse(l):Vl(l)?this._onrequest(l,u):mg(l)?this._onnotification(l):this._onerror(new Error(`Unknown message type: ${JSON.stringify(l)}`))},await this._transport.start()}_onclose(){var r;const a=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._pendingDebouncedNotifications.clear(),this._transport=void 0,(r=this.onclose)===null||r===void 0||r.call(this);const t=new gr(Qt.ConnectionClosed,"Connection closed");for(const n of a.values())n(t)}_onerror(r){var a;(a=this.onerror)===null||a===void 0||a.call(this,r)}_onnotification(r){var a;const t=(a=this._notificationHandlers.get(r.method))!==null&&a!==void 0?a:this.fallbackNotificationHandler;t!==void 0&&Promise.resolve().then(()=>t(r)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(r,a){var t,n,i,s;const o=(t=this._requestHandlers.get(r.method))!==null&&t!==void 0?t:this.fallbackRequestHandler;if(o===void 0){(n=this._transport)===null||n===void 0||n.send({jsonrpc:"2.0",id:r.id,error:{code:Qt.MethodNotFound,message:"Method not found"}}).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}const l=new AbortController;this._requestHandlerAbortControllers.set(r.id,l);const u={signal:l.signal,sessionId:(i=this._transport)===null||i===void 0?void 0:i.sessionId,_meta:(s=r.params)===null||s===void 0?void 0:s._meta,sendNotification:d=>this.notification(d,{relatedRequestId:r.id}),sendRequest:(d,p,h)=>this.request(d,p,{...h,relatedRequestId:r.id}),authInfo:a==null?void 0:a.authInfo,requestId:r.id,requestInfo:a==null?void 0:a.requestInfo};Promise.resolve().then(()=>o(r,u)).then(d=>{var p;if(!l.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({result:d,jsonrpc:"2.0",id:r.id})},d=>{var p,h;if(!l.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({jsonrpc:"2.0",id:r.id,error:{code:Number.isSafeInteger(d.code)?d.code:Qt.InternalError,message:(h=d.message)!==null&&h!==void 0?h:"Internal error"}})}).catch(d=>this._onerror(new Error(`Failed to send response: ${d}`))).finally(()=>{this._requestHandlerAbortControllers.delete(r.id)})}_onprogress(r){const{progressToken:a,...t}=r.params,n=Number(a),i=this._progressHandlers.get(n);if(!i){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(r)}`));return}const s=this._responseHandlers.get(n),o=this._timeoutInfo.get(n);if(o&&s&&o.resetTimeoutOnProgress)try{this._resetTimeout(n)}catch(l){s(l);return}i(t)}_onresponse(r){const a=Number(r.id),t=this._responseHandlers.get(a);if(t===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(r)}`));return}if(this._responseHandlers.delete(a),this._progressHandlers.delete(a),this._cleanupTimeout(a),_s(r))t(r);else{const n=new gr(r.error.code,r.error.message,r.error.data);t(n)}}get transport(){return this._transport}async close(){var r;await((r=this._transport)===null||r===void 0?void 0:r.close())}request(r,a,t){const{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}=t??{};return new Promise((o,l)=>{var u,d,p,h,v,f;if(!this._transport){l(new Error("Not connected"));return}((u=this._options)===null||u===void 0?void 0:u.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(r.method),(d=t==null?void 0:t.signal)===null||d===void 0||d.throwIfAborted();const m=this._requestMessageId++,g={...r,jsonrpc:"2.0",id:m};t!=null&&t.onprogress&&(this._progressHandlers.set(m,t.onprogress),g.params={...r.params,_meta:{...((p=r.params)===null||p===void 0?void 0:p._meta)||{},progressToken:m}});const w=x=>{var E;this._responseHandlers.delete(m),this._progressHandlers.delete(m),this._cleanupTimeout(m),(E=this._transport)===null||E===void 0||E.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:m,reason:String(x)}},{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}).catch($=>this._onerror(new Error(`Failed to send cancellation: ${$}`))),l(x)};this._responseHandlers.set(m,x=>{var E;if(!(!((E=t==null?void 0:t.signal)===null||E===void 0)&&E.aborted)){if(x instanceof Error)return l(x);try{const $=a.parse(x.result);o($)}catch($){l($)}}}),(h=t==null?void 0:t.signal)===null||h===void 0||h.addEventListener("abort",()=>{var x;w((x=t==null?void 0:t.signal)===null||x===void 0?void 0:x.reason)});const S=(v=t==null?void 0:t.timeout)!==null&&v!==void 0?v:cy,O=()=>w(new gr(Qt.RequestTimeout,"Request timed out",{timeout:S}));this._setupTimeout(m,S,t==null?void 0:t.maxTotalTimeout,O,(f=t==null?void 0:t.resetTimeoutOnProgress)!==null&&f!==void 0?f:!1),this._transport.send(g,{relatedRequestId:n,resumptionToken:i,onresumptiontoken:s}).catch(x=>{this._cleanupTimeout(m),l(x)})})}async notification(r,a){var t,n;if(!this._transport)throw new Error("Not connected");if(this.assertNotificationCapability(r.method),((n=(t=this._options)===null||t===void 0?void 0:t.debouncedNotificationMethods)!==null&&n!==void 0?n:[]).includes(r.method)&&!r.params&&!(a!=null&&a.relatedRequestId)){if(this._pendingDebouncedNotifications.has(r.method))return;this._pendingDebouncedNotifications.add(r.method),Promise.resolve().then(()=>{var s;if(this._pendingDebouncedNotifications.delete(r.method),!this._transport)return;const o={...r,jsonrpc:"2.0"};(s=this._transport)===null||s===void 0||s.send(o,a).catch(l=>this._onerror(l))});return}const i={...r,jsonrpc:"2.0"};await this._transport.send(i,a)}setRequestHandler(r,a){const t=r.shape.method.value;this.assertRequestHandlerCapability(t),this._requestHandlers.set(t,(n,i)=>Promise.resolve(a(r.parse(n),i)))}removeRequestHandler(r){this._requestHandlers.delete(r)}assertCanSetRequestHandler(r){if(this._requestHandlers.has(r))throw new Error(`A request handler for ${r} already exists, which would be overridden`)}setNotificationHandler(r,a){this._notificationHandlers.set(r.shape.method.value,t=>Promise.resolve(a(r.parse(t))))}removeNotificationHandler(r){this._notificationHandlers.delete(r)}}function uy(e,r){return Object.entries(r).reduce((a,[t,n])=>(n&&typeof n=="object"?a[t]=a[t]?{...a[t],...n}:n:a[t]=n,a),{...e})}var pn={exports:{}},hy=pn.exports,cc;function py(){return cc||(cc=1,function(e,r){(function(a,t){t(r)})(hy,function(a){function t(){for(var P=arguments.length,I=Array(P),L=0;L<P;L++)I[L]=arguments[L];if(I.length>1){I[0]=I[0].slice(0,-1);for(var B=I.length-1,K=1;K<B;++K)I[K]=I[K].slice(1,-1);return I[B]=I[B].slice(1),I.join("")}else return I[0]}function n(P){return"(?:"+P+")"}function i(P){return P===void 0?"undefined":P===null?"null":Object.prototype.toString.call(P).split(" ").pop().split("]").shift().toLowerCase()}function s(P){return P.toUpperCase()}function o(P){return P!=null?P instanceof Array?P:typeof P.length!="number"||P.split||P.setInterval||P.call?[P]:Array.prototype.slice.call(P):[]}function l(P,I){var L=P;if(I)for(var B in I)L[B]=I[B];return L}function u(P){var I="[A-Za-z]",L="[0-9]",B=t(L,"[A-Fa-f]"),K=n(n("%[EFef]"+B+"%"+B+B+"%"+B+B)+"|"+n("%[89A-Fa-f]"+B+"%"+B+B)+"|"+n("%"+B+B)),xe="[\\:\\/\\?\\#\\[\\]\\@]",be="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Ze=t(xe,be),nt=P?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",Ke=P?"[\\uE000-\\uF8FF]":"[]",De=t(I,L,"[\\-\\.\\_\\~]",nt);n(I+t(I,L,"[\\+\\-\\.]")+"*"),n(n(K+"|"+t(De,be,"[\\:]"))+"*");var Ge=n(n("25[0-5]")+"|"+n("2[0-4]"+L)+"|"+n("1"+L+L)+"|"+n("0?[1-9]"+L)+"|0?0?"+L),tt=n(Ge+"\\."+Ge+"\\."+Ge+"\\."+Ge),Oe=n(B+"{1,4}"),st=n(n(Oe+"\\:"+Oe)+"|"+tt),Qe=n(n(Oe+"\\:")+"{6}"+st),Ft=n("\\:\\:"+n(Oe+"\\:")+"{5}"+st),la=n(n(Oe)+"?\\:\\:"+n(Oe+"\\:")+"{4}"+st),qt=n(n(n(Oe+"\\:")+"{0,1}"+Oe)+"?\\:\\:"+n(Oe+"\\:")+"{3}"+st),ir=n(n(n(Oe+"\\:")+"{0,2}"+Oe)+"?\\:\\:"+n(Oe+"\\:")+"{2}"+st),Lr=n(n(n(Oe+"\\:")+"{0,3}"+Oe)+"?\\:\\:"+Oe+"\\:"+st),Fr=n(n(n(Oe+"\\:")+"{0,4}"+Oe)+"?\\:\\:"+st),Dt=n(n(n(Oe+"\\:")+"{0,5}"+Oe)+"?\\:\\:"+Oe),or=n(n(n(Oe+"\\:")+"{0,6}"+Oe)+"?\\:\\:"),Dr=n([Qe,Ft,la,qt,ir,Lr,Fr,Dt,or].join("|")),er=n(n(De+"|"+K)+"+");n("[vV]"+B+"+\\."+t(De,be,"[\\:]")+"+"),n(n(K+"|"+t(De,be))+"*");var Rn=n(K+"|"+t(De,be,"[\\:\\@]"));return n(n(K+"|"+t(De,be,"[\\@]"))+"+"),n(n(Rn+"|"+t("[\\/\\?]",Ke))+"*"),{NOT_SCHEME:new RegExp(t("[^]",I,L,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",De,be),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",De,be),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",De,be),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",De,be),"g"),NOT_QUERY:new RegExp(t("[^\\%]",De,be,"[\\:\\@\\/\\?]",Ke),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",De,be,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",De,be),"g"),UNRESERVED:new RegExp(De,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",De,Ze),"g"),PCT_ENCODED:new RegExp(K,"g"),IPV4ADDRESS:new RegExp("^("+tt+")$"),IPV6ADDRESS:new RegExp("^\\[?("+Dr+")"+n(n("\\%25|\\%(?!"+B+"{2})")+"("+er+")")+"?\\]?$")}}var d=u(!1),p=u(!0),h=function(){function P(I,L){var B=[],K=!0,xe=!1,be=void 0;try{for(var Ze=I[Symbol.iterator](),nt;!(K=(nt=Ze.next()).done)&&(B.push(nt.value),!(L&&B.length===L));K=!0);}catch(Ke){xe=!0,be=Ke}finally{try{!K&&Ze.return&&Ze.return()}finally{if(xe)throw be}}return B}return function(I,L){if(Array.isArray(I))return I;if(Symbol.iterator in Object(I))return P(I,L);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(P){if(Array.isArray(P)){for(var I=0,L=Array(P.length);I<P.length;I++)L[I]=P[I];return L}else return Array.from(P)},f=2147483647,m=36,g=1,w=26,S=38,O=700,x=72,E=128,$="-",N=/^xn--/,T=/[^\0-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},R=m-g,z=Math.floor,U=String.fromCharCode;function M(P){throw new RangeError(A[P])}function q(P,I){for(var L=[],B=P.length;B--;)L[B]=I(P[B]);return L}function J(P,I){var L=P.split("@"),B="";L.length>1&&(B=L[0]+"@",P=L[1]),P=P.replace(D,".");var K=P.split("."),xe=q(K,I).join(".");return B+xe}function Y(P){for(var I=[],L=0,B=P.length;L<B;){var K=P.charCodeAt(L++);if(K>=55296&&K<=56319&&L<B){var xe=P.charCodeAt(L++);(xe&64512)==56320?I.push(((K&1023)<<10)+(xe&1023)+65536):(I.push(K),L--)}else I.push(K)}return I}var se=function(P){return String.fromCodePoint.apply(String,v(P))},oe=function(P){return P-48<10?P-22:P-65<26?P-65:P-97<26?P-97:m},Se=function(P,I){return P+22+75*(P<26)-((I!=0)<<5)},Ce=function(P,I,L){var B=0;for(P=L?z(P/O):P>>1,P+=z(P/I);P>R*w>>1;B+=m)P=z(P/R);return z(B+(R+1)*P/(P+S))},Z=function(P){var I=[],L=P.length,B=0,K=E,xe=x,be=P.lastIndexOf($);be<0&&(be=0);for(var Ze=0;Ze<be;++Ze)P.charCodeAt(Ze)>=128&&M("not-basic"),I.push(P.charCodeAt(Ze));for(var nt=be>0?be+1:0;nt<L;){for(var Ke=B,De=1,Ge=m;;Ge+=m){nt>=L&&M("invalid-input");var tt=oe(P.charCodeAt(nt++));(tt>=m||tt>z((f-B)/De))&&M("overflow"),B+=tt*De;var Oe=Ge<=xe?g:Ge>=xe+w?w:Ge-xe;if(tt<Oe)break;var st=m-Oe;De>z(f/st)&&M("overflow"),De*=st}var Qe=I.length+1;xe=Ce(B-Ke,Qe,Ke==0),z(B/Qe)>f-K&&M("overflow"),K+=z(B/Qe),B%=Qe,I.splice(B++,0,K)}return String.fromCodePoint.apply(String,I)},re=function(P){var I=[];P=Y(P);var L=P.length,B=E,K=0,xe=x,be=!0,Ze=!1,nt=void 0;try{for(var Ke=P[Symbol.iterator](),De;!(be=(De=Ke.next()).done);be=!0){var Ge=De.value;Ge<128&&I.push(U(Ge))}}catch(Ma){Ze=!0,nt=Ma}finally{try{!be&&Ke.return&&Ke.return()}finally{if(Ze)throw nt}}var tt=I.length,Oe=tt;for(tt&&I.push($);Oe<L;){var st=f,Qe=!0,Ft=!1,la=void 0;try{for(var qt=P[Symbol.iterator](),ir;!(Qe=(ir=qt.next()).done);Qe=!0){var Lr=ir.value;Lr>=B&&Lr<st&&(st=Lr)}}catch(Ma){Ft=!0,la=Ma}finally{try{!Qe&&qt.return&&qt.return()}finally{if(Ft)throw la}}var Fr=Oe+1;st-B>z((f-K)/Fr)&&M("overflow"),K+=(st-B)*Fr,B=st;var Dt=!0,or=!1,Dr=void 0;try{for(var er=P[Symbol.iterator](),Rn;!(Dt=(Rn=er.next()).done);Dt=!0){var Ch=Rn.value;if(Ch<B&&++K>f&&M("overflow"),Ch==B){for(var In=K,Tn=m;;Tn+=m){var An=Tn<=xe?g:Tn>=xe+w?w:Tn-xe;if(In<An)break;var Ph=In-An,Nh=m-An;I.push(U(Se(An+Ph%Nh,0))),In=z(Ph/Nh)}I.push(U(Se(In,0))),xe=Ce(K,Fr,Oe==tt),K=0,++Oe}}}catch(Ma){or=!0,Dr=Ma}finally{try{!Dt&&er.return&&er.return()}finally{if(or)throw Dr}}++K,++B}return I.join("")},ue=function(P){return J(P,function(I){return N.test(I)?Z(I.slice(4).toLowerCase()):I})},ee=function(P){return J(P,function(I){return T.test(I)?"xn--"+re(I):I})},_={version:"2.1.0",ucs2:{decode:Y,encode:se},decode:Z,encode:re,toASCII:ee,toUnicode:ue},C={};function F(P){var I=P.charCodeAt(0),L=void 0;return I<16?L="%0"+I.toString(16).toUpperCase():I<128?L="%"+I.toString(16).toUpperCase():I<2048?L="%"+(I>>6|192).toString(16).toUpperCase()+"%"+(I&63|128).toString(16).toUpperCase():L="%"+(I>>12|224).toString(16).toUpperCase()+"%"+(I>>6&63|128).toString(16).toUpperCase()+"%"+(I&63|128).toString(16).toUpperCase(),L}function W(P){for(var I="",L=0,B=P.length;L<B;){var K=parseInt(P.substr(L+1,2),16);if(K<128)I+=String.fromCharCode(K),L+=3;else if(K>=194&&K<224){if(B-L>=6){var xe=parseInt(P.substr(L+4,2),16);I+=String.fromCharCode((K&31)<<6|xe&63)}else I+=P.substr(L,6);L+=6}else if(K>=224){if(B-L>=9){var be=parseInt(P.substr(L+4,2),16),Ze=parseInt(P.substr(L+7,2),16);I+=String.fromCharCode((K&15)<<12|(be&63)<<6|Ze&63)}else I+=P.substr(L,9);L+=9}else I+=P.substr(L,3),L+=3}return I}function H(P,I){function L(B){var K=W(B);return K.match(I.UNRESERVED)?K:B}return P.scheme&&(P.scheme=String(P.scheme).replace(I.PCT_ENCODED,L).toLowerCase().replace(I.NOT_SCHEME,"")),P.userinfo!==void 0&&(P.userinfo=String(P.userinfo).replace(I.PCT_ENCODED,L).replace(I.NOT_USERINFO,F).replace(I.PCT_ENCODED,s)),P.host!==void 0&&(P.host=String(P.host).replace(I.PCT_ENCODED,L).toLowerCase().replace(I.NOT_HOST,F).replace(I.PCT_ENCODED,s)),P.path!==void 0&&(P.path=String(P.path).replace(I.PCT_ENCODED,L).replace(P.scheme?I.NOT_PATH:I.NOT_PATH_NOSCHEME,F).replace(I.PCT_ENCODED,s)),P.query!==void 0&&(P.query=String(P.query).replace(I.PCT_ENCODED,L).replace(I.NOT_QUERY,F).replace(I.PCT_ENCODED,s)),P.fragment!==void 0&&(P.fragment=String(P.fragment).replace(I.PCT_ENCODED,L).replace(I.NOT_FRAGMENT,F).replace(I.PCT_ENCODED,s)),P}function j(P){return P.replace(/^0*(.*)/,"$1")||"0"}function k(P,I){var L=P.match(I.IPV4ADDRESS)||[],B=h(L,2),K=B[1];return K?K.split(".").map(j).join("."):P}function V(P,I){var L=P.match(I.IPV6ADDRESS)||[],B=h(L,3),K=B[1],xe=B[2];if(K){for(var be=K.toLowerCase().split("::").reverse(),Ze=h(be,2),nt=Ze[0],Ke=Ze[1],De=Ke?Ke.split(":").map(j):[],Ge=nt.split(":").map(j),tt=I.IPV4ADDRESS.test(Ge[Ge.length-1]),Oe=tt?7:8,st=Ge.length-Oe,Qe=Array(Oe),Ft=0;Ft<Oe;++Ft)Qe[Ft]=De[Ft]||Ge[st+Ft]||"";tt&&(Qe[Oe-1]=k(Qe[Oe-1],I));var la=Qe.reduce(function(Dt,or,Dr){if(!or||or==="0"){var er=Dt[Dt.length-1];er&&er.index+er.length===Dr?er.length++:Dt.push({index:Dr,length:1})}return Dt},[]),qt=la.sort(function(Dt,or){return or.length-Dt.length})[0],ir=void 0;if(qt&&qt.length>1){var Lr=Qe.slice(0,qt.index),Fr=Qe.slice(qt.index+qt.length);ir=Lr.join(":")+"::"+Fr.join(":")}else ir=Qe.join(":");return xe&&(ir+="%"+xe),ir}else return P}var G=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,we="".match(/(){0}/)[1]===void 0;function ce(P){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L={},B=I.iri!==!1?p:d;I.reference==="suffix"&&(P=(I.scheme?I.scheme+":":"")+"//"+P);var K=P.match(G);if(K){we?(L.scheme=K[1],L.userinfo=K[3],L.host=K[4],L.port=parseInt(K[5],10),L.path=K[6]||"",L.query=K[7],L.fragment=K[8],isNaN(L.port)&&(L.port=K[5])):(L.scheme=K[1]||void 0,L.userinfo=P.indexOf("@")!==-1?K[3]:void 0,L.host=P.indexOf("//")!==-1?K[4]:void 0,L.port=parseInt(K[5],10),L.path=K[6]||"",L.query=P.indexOf("?")!==-1?K[7]:void 0,L.fragment=P.indexOf("#")!==-1?K[8]:void 0,isNaN(L.port)&&(L.port=P.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?K[4]:void 0)),L.host&&(L.host=V(k(L.host,B),B)),L.scheme===void 0&&L.userinfo===void 0&&L.host===void 0&&L.port===void 0&&!L.path&&L.query===void 0?L.reference="same-document":L.scheme===void 0?L.reference="relative":L.fragment===void 0?L.reference="absolute":L.reference="uri",I.reference&&I.reference!=="suffix"&&I.reference!==L.reference&&(L.error=L.error||"URI is not a "+I.reference+" reference.");var xe=C[(I.scheme||L.scheme||"").toLowerCase()];if(!I.unicodeSupport&&(!xe||!xe.unicodeSupport)){if(L.host&&(I.domainHost||xe&&xe.domainHost))try{L.host=_.toASCII(L.host.replace(B.PCT_ENCODED,W).toLowerCase())}catch(be){L.error=L.error||"Host's domain name can not be converted to ASCII via punycode: "+be}H(L,d)}else H(L,B);xe&&xe.parse&&xe.parse(L,I)}else L.error=L.error||"URI can not be parsed.";return L}function me(P,I){var L=I.iri!==!1?p:d,B=[];return P.userinfo!==void 0&&(B.push(P.userinfo),B.push("@")),P.host!==void 0&&B.push(V(k(String(P.host),L),L).replace(L.IPV6ADDRESS,function(K,xe,be){return"["+xe+(be?"%25"+be:"")+"]"})),(typeof P.port=="number"||typeof P.port=="string")&&(B.push(":"),B.push(String(P.port))),B.length?B.join(""):void 0}var Ae=/^\.\.?\//,ct=/^\/\.(\/|$)/,ae=/^\/\.\.(\/|$)/,qe=/^\/?(?:.|\n)*?(?=\/|$)/;function de(P){for(var I=[];P.length;)if(P.match(Ae))P=P.replace(Ae,"");else if(P.match(ct))P=P.replace(ct,"/");else if(P.match(ae))P=P.replace(ae,"/"),I.pop();else if(P==="."||P==="..")P="";else{var L=P.match(qe);if(L){var B=L[0];P=P.slice(B.length),I.push(B)}else throw new Error("Unexpected dot segment condition")}return I.join("")}function te(P){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=I.iri?p:d,B=[],K=C[(I.scheme||P.scheme||"").toLowerCase()];if(K&&K.serialize&&K.serialize(P,I),P.host&&!L.IPV6ADDRESS.test(P.host)&&(I.domainHost||K&&K.domainHost))try{P.host=I.iri?_.toUnicode(P.host):_.toASCII(P.host.replace(L.PCT_ENCODED,W).toLowerCase())}catch(Ze){P.error=P.error||"Host's domain name can not be converted to "+(I.iri?"Unicode":"ASCII")+" via punycode: "+Ze}H(P,L),I.reference!=="suffix"&&P.scheme&&(B.push(P.scheme),B.push(":"));var xe=me(P,I);if(xe!==void 0&&(I.reference!=="suffix"&&B.push("//"),B.push(xe),P.path&&P.path.charAt(0)!=="/"&&B.push("/")),P.path!==void 0){var be=P.path;!I.absolutePath&&(!K||!K.absolutePath)&&(be=de(be)),xe===void 0&&(be=be.replace(/^\/\//,"/%2F")),B.push(be)}return P.query!==void 0&&(B.push("?"),B.push(P.query)),P.fragment!==void 0&&(B.push("#"),B.push(P.fragment)),B.join("")}function Ee(P,I){var L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments[3],K={};return B||(P=ce(te(P,L),L),I=ce(te(I,L),L)),L=L||{},!L.tolerant&&I.scheme?(K.scheme=I.scheme,K.userinfo=I.userinfo,K.host=I.host,K.port=I.port,K.path=de(I.path||""),K.query=I.query):(I.userinfo!==void 0||I.host!==void 0||I.port!==void 0?(K.userinfo=I.userinfo,K.host=I.host,K.port=I.port,K.path=de(I.path||""),K.query=I.query):(I.path?(I.path.charAt(0)==="/"?K.path=de(I.path):((P.userinfo!==void 0||P.host!==void 0||P.port!==void 0)&&!P.path?K.path="/"+I.path:P.path?K.path=P.path.slice(0,P.path.lastIndexOf("/")+1)+I.path:K.path=I.path,K.path=de(K.path)),K.query=I.query):(K.path=P.path,I.query!==void 0?K.query=I.query:K.query=P.query),K.userinfo=P.userinfo,K.host=P.host,K.port=P.port),K.scheme=P.scheme),K.fragment=I.fragment,K}function ie(P,I,L){var B=l({scheme:"null"},L);return te(Ee(ce(P,B),ce(I,B),B,!0),B)}function ne(P,I){return typeof P=="string"?P=te(ce(P,I),I):i(P)==="object"&&(P=ce(te(P,I),I)),P}function ye(P,I,L){return typeof P=="string"?P=te(ce(P,L),L):i(P)==="object"&&(P=te(P,L)),typeof I=="string"?I=te(ce(I,L),L):i(I)==="object"&&(I=te(I,L)),P===I}function ge(P,I){return P&&P.toString().replace(!I||!I.iri?d.ESCAPE:p.ESCAPE,F)}function Xe(P,I){return P&&P.toString().replace(!I||!I.iri?d.PCT_ENCODED:p.PCT_ENCODED,W)}var Ar={scheme:"http",domainHost:!0,parse:function(P,I){return P.host||(P.error=P.error||"HTTP URIs must have a host."),P},serialize:function(P,I){var L=String(P.scheme).toLowerCase()==="https";return(P.port===(L?443:80)||P.port==="")&&(P.port=void 0),P.path||(P.path="/"),P}},Fa={scheme:"https",domainHost:Ar.domainHost,parse:Ar.parse,serialize:Ar.serialize};function bh(P){return typeof P.secure=="boolean"?P.secure:String(P.scheme).toLowerCase()==="wss"}var Da={scheme:"ws",domainHost:!0,parse:function(P,I){var L=P;return L.secure=bh(L),L.resourceName=(L.path||"/")+(L.query?"?"+L.query:""),L.path=void 0,L.query=void 0,L},serialize:function(P,I){if((P.port===(bh(P)?443:80)||P.port==="")&&(P.port=void 0),typeof P.secure=="boolean"&&(P.scheme=P.secure?"wss":"ws",P.secure=void 0),P.resourceName){var L=P.resourceName.split("?"),B=h(L,2),K=B[0],xe=B[1];P.path=K&&K!=="/"?K:void 0,P.query=xe,P.resourceName=void 0}return P.fragment=void 0,P}},wh={scheme:"wss",domainHost:Da.domainHost,parse:Da.parse,serialize:Da.serialize},_w={},xh="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Yt="[0-9A-Fa-f]",bw=n(n("%[EFef]"+Yt+"%"+Yt+Yt+"%"+Yt+Yt)+"|"+n("%[89A-Fa-f]"+Yt+"%"+Yt+Yt)+"|"+n("%"+Yt+Yt)),ww="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",xw="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",jw=t(xw,'[\\"\\\\]'),Ew="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Sw=new RegExp(xh,"g"),oa=new RegExp(bw,"g"),kw=new RegExp(t("[^]",ww,"[\\.]",'[\\"]',jw),"g"),jh=new RegExp(t("[^]",xh,Ew),"g"),Cw=jh;function io(P){var I=W(P);return I.match(Sw)?I:P}var Eh={scheme:"mailto",parse:function(P,I){var L=P,B=L.to=L.path?L.path.split(","):[];if(L.path=void 0,L.query){for(var K=!1,xe={},be=L.query.split("&"),Ze=0,nt=be.length;Ze<nt;++Ze){var Ke=be[Ze].split("=");switch(Ke[0]){case"to":for(var De=Ke[1].split(","),Ge=0,tt=De.length;Ge<tt;++Ge)B.push(De[Ge]);break;case"subject":L.subject=Xe(Ke[1],I);break;case"body":L.body=Xe(Ke[1],I);break;default:K=!0,xe[Xe(Ke[0],I)]=Xe(Ke[1],I);break}}K&&(L.headers=xe)}L.query=void 0;for(var Oe=0,st=B.length;Oe<st;++Oe){var Qe=B[Oe].split("@");if(Qe[0]=Xe(Qe[0]),I.unicodeSupport)Qe[1]=Xe(Qe[1],I).toLowerCase();else try{Qe[1]=_.toASCII(Xe(Qe[1],I).toLowerCase())}catch(Ft){L.error=L.error||"Email address's domain name can not be converted to ASCII via punycode: "+Ft}B[Oe]=Qe.join("@")}return L},serialize:function(P,I){var L=P,B=o(P.to);if(B){for(var K=0,xe=B.length;K<xe;++K){var be=String(B[K]),Ze=be.lastIndexOf("@"),nt=be.slice(0,Ze).replace(oa,io).replace(oa,s).replace(kw,F),Ke=be.slice(Ze+1);try{Ke=I.iri?_.toUnicode(Ke):_.toASCII(Xe(Ke,I).toLowerCase())}catch(Oe){L.error=L.error||"Email address's domain name can not be converted to "+(I.iri?"Unicode":"ASCII")+" via punycode: "+Oe}B[K]=nt+"@"+Ke}L.path=B.join(",")}var De=P.headers=P.headers||{};P.subject&&(De.subject=P.subject),P.body&&(De.body=P.body);var Ge=[];for(var tt in De)De[tt]!==_w[tt]&&Ge.push(tt.replace(oa,io).replace(oa,s).replace(jh,F)+"="+De[tt].replace(oa,io).replace(oa,s).replace(Cw,F));return Ge.length&&(L.query=Ge.join("&")),L}},Pw=/^([^\:]+)\:(.*)/,Sh={scheme:"urn",parse:function(P,I){var L=P.path&&P.path.match(Pw),B=P;if(L){var K=I.scheme||B.scheme||"urn",xe=L[1].toLowerCase(),be=L[2],Ze=K+":"+(I.nid||xe),nt=C[Ze];B.nid=xe,B.nss=be,B.path=void 0,nt&&(B=nt.parse(B,I))}else B.error=B.error||"URN can not be parsed.";return B},serialize:function(P,I){var L=I.scheme||P.scheme||"urn",B=P.nid,K=L+":"+(I.nid||B),xe=C[K];xe&&(P=xe.serialize(P,I));var be=P,Ze=P.nss;return be.path=(B||I.nid)+":"+Ze,be}},Nw=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,kh={scheme:"urn:uuid",parse:function(P,I){var L=P;return L.uuid=L.nss,L.nss=void 0,!I.tolerant&&(!L.uuid||!L.uuid.match(Nw))&&(L.error=L.error||"UUID is not valid."),L},serialize:function(P,I){var L=P;return L.nss=(P.uuid||"").toLowerCase(),L}};C[Ar.scheme]=Ar,C[Fa.scheme]=Fa,C[Da.scheme]=Da,C[wh.scheme]=wh,C[Eh.scheme]=Eh,C[Sh.scheme]=Sh,C[kh.scheme]=kh,a.SCHEMES=C,a.pctEncChar=F,a.pctDecChars=W,a.parse=ce,a.removeDotSegments=de,a.serialize=te,a.resolveComponents=Ee,a.resolve=ie,a.normalize=ne,a.equal=ye,a.escapeComponent=ge,a.unescapeComponent=Xe,Object.defineProperty(a,"__esModule",{value:!0})})}(pn,pn.exports)),pn.exports}var dc,uc;function my(){return uc||(uc=1,dc=function(e){for(var r=0,a=e.length,t=0,n;t<a;)r++,n=e.charCodeAt(t++),n>=55296&&n<=56319&&t<a&&(n=e.charCodeAt(t),(n&64512)==56320&&t++);return r}),dc}var ks,hc;function qr(){if(hc)return ks;hc=1,ks={copy:e,checkDataType:r,checkDataTypes:a,coerceToTypes:n,toHash:i,getProperty:l,escapeQuotes:u,equal:ko(),ucs2length:my(),varOccurences:d,varReplace:p,schemaHasRules:h,schemaHasRulesExcept:v,schemaUnknownRules:f,toQuotedString:m,getPathExpr:g,getPath:w,getData:x,unescapeFragment:$,unescapeJsonPointer:D,escapeFragment:N,escapeJsonPointer:T};function e(A,R){R=R||{};for(var z in A)R[z]=A[z];return R}function r(A,R,z,U){var M=U?" !== ":" === ",q=U?" || ":" && ",J=U?"!":"",Y=U?"":"!";switch(A){case"null":return R+M+"null";case"array":return J+"Array.isArray("+R+")";case"object":return"("+J+R+q+"typeof "+R+M+'"object"'+q+Y+"Array.isArray("+R+"))";case"integer":return"(typeof "+R+M+'"number"'+q+Y+"("+R+" % 1)"+q+R+M+R+(z?q+J+"isFinite("+R+")":"")+")";case"number":return"(typeof "+R+M+'"'+A+'"'+(z?q+J+"isFinite("+R+")":"")+")";default:return"typeof "+R+M+'"'+A+'"'}}function a(A,R,z){switch(A.length){case 1:return r(A[0],R,z,!0);default:var U="",M=i(A);M.array&&M.object&&(U=M.null?"(":"(!"+R+" || ",U+="typeof "+R+' !== "object")',delete M.null,delete M.array,delete M.object),M.number&&delete M.integer;for(var q in M)U+=(U?" && ":"")+r(q,R,z,!0);return U}}var t=i(["string","number","integer","boolean","null"]);function n(A,R){if(Array.isArray(R)){for(var z=[],U=0;U<R.length;U++){var M=R[U];(t[M]||A==="array"&&M==="array")&&(z[z.length]=M)}if(z.length)return z}else{if(t[R])return[R];if(A==="array"&&R==="array")return["array"]}}function i(A){for(var R={},z=0;z<A.length;z++)R[A[z]]=!0;return R}var s=/^[a-z$_][a-z$_0-9]*$/i,o=/'|\\/g;function l(A){return typeof A=="number"?"["+A+"]":s.test(A)?"."+A:"['"+u(A)+"']"}function u(A){return A.replace(o,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function d(A,R){R+="[^0-9]";var z=A.match(new RegExp(R,"g"));return z?z.length:0}function p(A,R,z){return R+="([^0-9])",z=z.replace(/\$/g,"$$$$"),A.replace(new RegExp(R,"g"),z+"$1")}function h(A,R){if(typeof A=="boolean")return!A;for(var z in A)if(R[z])return!0}function v(A,R,z){if(typeof A=="boolean")return!A&&z!="not";for(var U in A)if(U!=z&&R[U])return!0}function f(A,R){if(typeof A!="boolean"){for(var z in A)if(!R[z])return z}}function m(A){return"'"+u(A)+"'"}function g(A,R,z,U){var M=z?"'/' + "+R+(U?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):U?"'[' + "+R+" + ']'":"'[\\'' + "+R+" + '\\']'";return E(A,M)}function w(A,R,z){var U=m(z?"/"+T(R):l(R));return E(A,U)}var S=/^\/(?:[^~]|~0|~1)*$/,O=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function x(A,R,z){var U,M,q,J;if(A==="")return"rootData";if(A[0]=="/"){if(!S.test(A))throw new Error("Invalid JSON-pointer: "+A);M=A,q="rootData"}else{if(J=A.match(O),!J)throw new Error("Invalid JSON-pointer: "+A);if(U=+J[1],M=J[2],M=="#"){if(U>=R)throw new Error("Cannot access property/index "+U+" levels up, current level is "+R);return z[R-U]}if(U>R)throw new Error("Cannot access data "+U+" levels up, current level is "+R);if(q="data"+(R-U||""),!M)return q}for(var Y=q,se=M.split("/"),oe=0;oe<se.length;oe++){var Se=se[oe];Se&&(q+=l(D(Se)),Y+=" && "+q)}return Y}function E(A,R){return A=='""'?R:(A+" + "+R).replace(/([^\\])' \+ '/g,"$1")}function $(A){return D(decodeURIComponent(A))}function N(A){return encodeURIComponent(T(A))}function T(A){return A.replace(/~/g,"~0").replace(/\//g,"~1")}function D(A){return A.replace(/~1/g,"/").replace(/~0/g,"~")}return ks}var Cs,pc;function mc(){if(pc)return Cs;pc=1;var e=qr();Cs=r;function r(a){e.copy(a,this)}return Cs}var Ps={exports:{}},fc;function fy(){if(fc)return Ps.exports;fc=1;var e=Ps.exports=function(t,n,i){typeof n=="function"&&(i=n,n={}),i=n.cb||i;var s=typeof i=="function"?i:i.pre||function(){},o=i.post||function(){};r(n,s,o,t,"",t)};e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function r(t,n,i,s,o,l,u,d,p,h){if(s&&typeof s=="object"&&!Array.isArray(s)){n(s,o,l,u,d,p,h);for(var v in s){var f=s[v];if(Array.isArray(f)){if(v in e.arrayKeywords)for(var m=0;m<f.length;m++)r(t,n,i,f[m],o+"/"+v+"/"+m,l,o,v,s,m)}else if(v in e.propsKeywords){if(f&&typeof f=="object")for(var g in f)r(t,n,i,f[g],o+"/"+v+"/"+a(g),l,o,v,s,g)}else(v in e.keywords||t.allKeys&&!(v in e.skipKeywords))&&r(t,n,i,f,o+"/"+v,l,o,v,s)}i(s,o,l,u,d,p,h)}}function a(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}return Ps.exports}var Ns,vc;function $s(){if(vc)return Ns;vc=1;var e=py(),r=ko(),a=qr(),t=mc(),n=fy();Ns=i,i.normalizeId=w,i.fullPath=f,i.url=S,i.ids=O,i.inlineRef=p,i.schema=s;function i(x,E,$){var N=this._refs[$];if(typeof N=="string")if(this._refs[N])N=this._refs[N];else return i.call(this,x,E,N);if(N=N||this._schemas[$],N instanceof t)return p(N.schema,this._opts.inlineRefs)?N.schema:N.validate||this._compile(N);var T=s.call(this,E,$),D,A,R;return T&&(D=T.schema,E=T.root,R=T.baseId),D instanceof t?A=D.validate||x.call(this,D.schema,E,void 0,R):D!==void 0&&(A=p(D,this._opts.inlineRefs)?D:x.call(this,D,E,void 0,R)),A}function s(x,E){var $=e.parse(E),N=m($),T=f(this._getId(x.schema));if(Object.keys(x.schema).length===0||N!==T){var D=w(N),A=this._refs[D];if(typeof A=="string")return o.call(this,x,A,$);if(A instanceof t)A.validate||this._compile(A),x=A;else if(A=this._schemas[D],A instanceof t){if(A.validate||this._compile(A),D==w(E))return{schema:A,root:x,baseId:T};x=A}else return;if(!x.schema)return;T=f(this._getId(x.schema))}return u.call(this,$,T,x.schema,x)}function o(x,E,$){var N=s.call(this,x,E);if(N){var T=N.schema,D=N.baseId;x=N.root;var A=this._getId(T);return A&&(D=S(D,A)),u.call(this,$,D,T,x)}}var l=a.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function u(x,E,$,N){if(x.fragment=x.fragment||"",x.fragment.slice(0,1)=="/"){for(var T=x.fragment.split("/"),D=1;D<T.length;D++){var A=T[D];if(A){if(A=a.unescapeFragment(A),$=$[A],$===void 0)break;var R;if(!l[A]&&(R=this._getId($),R&&(E=S(E,R)),$.$ref)){var z=S(E,$.$ref),U=s.call(this,N,z);U&&($=U.schema,N=U.root,E=U.baseId)}}}if($!==void 0&&$!==N.schema)return{schema:$,root:N,baseId:E}}}var d=a.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(x,E){if(E===!1)return!1;if(E===void 0||E===!0)return h(x);if(E)return v(x)<=E}function h(x){var E;if(Array.isArray(x)){for(var $=0;$<x.length;$++)if(E=x[$],typeof E=="object"&&!h(E))return!1}else for(var N in x)if(N=="$ref"||(E=x[N],typeof E=="object"&&!h(E)))return!1;return!0}function v(x){var E=0,$;if(Array.isArray(x)){for(var N=0;N<x.length;N++)if($=x[N],typeof $=="object"&&(E+=v($)),E==1/0)return 1/0}else for(var T in x){if(T=="$ref")return 1/0;if(d[T])E++;else if($=x[T],typeof $=="object"&&(E+=v($)+1),E==1/0)return 1/0}return E}function f(x,E){E!==!1&&(x=w(x));var $=e.parse(x);return m($)}function m(x){return e.serialize(x).split("#")[0]+"#"}var g=/#\/?$/;function w(x){return x?x.replace(g,""):""}function S(x,E){return E=w(E),e.resolve(x,E)}function O(x){var E=w(this._getId(x)),$={"":E},N={"":f(E,!1)},T={},D=this;return n(x,{allKeys:!0},function(A,R,z,U,M,q,J){if(R!==""){var Y=D._getId(A),se=$[U],oe=N[U]+"/"+M;if(J!==void 0&&(oe+="/"+(typeof J=="number"?J:a.escapeFragment(J))),typeof Y=="string"){Y=se=w(se?e.resolve(se,Y):Y);var Se=D._refs[Y];if(typeof Se=="string"&&(Se=D._refs[Se]),Se&&Se.schema){if(!r(A,Se.schema))throw new Error('id "'+Y+'" resolves to more than one schema')}else if(Y!=w(oe))if(Y[0]=="#"){if(T[Y]&&!r(A,T[Y]))throw new Error('id "'+Y+'" resolves to more than one schema');T[Y]=A}else D._refs[Y]=oe}$[R]=se,N[R]=oe}}),T}return Ns}var Os,gc;function Rs(){if(gc)return Os;gc=1;var e=$s();Os={Validation:t(r),MissingRef:t(a)};function r(n){this.message="validation failed",this.errors=n,this.ajv=this.validation=!0}a.message=function(n,i){return"can't resolve reference "+i+" from id "+n};function a(n,i,s){this.message=s||a.message(n,i),this.missingRef=e.url(n,i),this.missingSchema=e.normalizeId(e.fullPath(this.missingRef))}function t(n){return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}return Os}var yc,_c;function bc(){return _c||(_c=1,yc=function(e,r){r||(r={}),typeof r=="function"&&(r={cmp:r});var a=typeof r.cycles=="boolean"?r.cycles:!1,t=r.cmp&&function(i){return function(s){return function(o,l){var u={key:o,value:s[o]},d={key:l,value:s[l]};return i(u,d)}}}(r.cmp),n=[];return function i(s){if(s&&s.toJSON&&typeof s.toJSON=="function"&&(s=s.toJSON()),s!==void 0){if(typeof s=="number")return isFinite(s)?""+s:"null";if(typeof s!="object")return JSON.stringify(s);var o,l;if(Array.isArray(s)){for(l="[",o=0;o<s.length;o++)o&&(l+=","),l+=i(s[o])||"null";return l+"]"}if(s===null)return"null";if(n.indexOf(s)!==-1){if(a)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=n.push(s)-1,d=Object.keys(s).sort(t&&t(s));for(l="",o=0;o<d.length;o++){var p=d[o],h=i(s[p]);h&&(l&&(l+=","),l+=JSON.stringify(p)+":"+h)}return n.splice(u,1),"{"+l+"}"}}(e)}),yc}var wc,xc;function jc(){return xc||(xc=1,wc=function(e,r,a){var t="",n=e.schema.$async===!0,i=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),s=e.self._getId(e.schema);if(e.opts.strictKeywords){var o=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(o){var l="unknown keyword: "+o;if(e.opts.strictKeywords==="log")e.logger.warn(l);else throw new Error(l)}}if(e.isTop&&(t+=" var validate = ",n&&(e.async=!0,t+="async "),t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",s&&(e.opts.sourceCode||e.opts.processCode)&&(t+=" "+("/*# sourceURL="+s+" */")+" ")),typeof e.schema=="boolean"||!(i||e.schema.$ref)){var r="false schema",u=e.level,d=e.dataLevel,p=e.schema[r],h=e.schemaPath+e.util.getProperty(r),v=e.errSchemaPath+"/"+r,x=!e.opts.allErrors,N,f="data"+(d||""),O="valid"+u;if(e.schema===!1){e.isTop?x=!0:t+=" var "+O+" = false; ";var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(N||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'boolean schema is false' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?n?t+=" return data; ":t+=" validate.errors = null; return true; ":t+=" var "+O+" = true; ";return e.isTop&&(t+=" }; return validate; "),t}if(e.isTop){var w=e.isTop,u=e.level=0,d=e.dataLevel=0,f="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var S="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(S);else throw new Error(S)}t+=" var vErrors = null; ",t+=" var errors = 0;     ",t+=" if (rootData === undefined) rootData = data; "}else{var u=e.level,d=e.dataLevel,f="data"+(d||"");if(s&&(e.baseId=e.resolve.url(e.baseId,s)),n&&!e.async)throw new Error("async schema in sync schema");t+=" var errs_"+u+" = errors;"}var O="valid"+u,x=!e.opts.allErrors,E="",$="",N,T=e.schema.type,D=Array.isArray(T);if(T&&e.opts.nullable&&e.schema.nullable===!0&&(D?T.indexOf("null")==-1&&(T=T.concat("null")):T!="null"&&(T=[T,"null"],D=!0)),D&&T.length==1&&(T=T[0],D=!1),e.schema.$ref&&i){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(i=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(t+=" "+e.RULES.all.$comment.code(e,"$comment")),T){if(e.opts.coerceTypes)var A=e.util.coerceToTypes(e.opts.coerceTypes,T);var R=e.RULES.types[T];if(A||D||R===!0||R&&!Ae(R)){var h=e.schemaPath+".type",v=e.errSchemaPath+"/type",h=e.schemaPath+".type",v=e.errSchemaPath+"/type",z=D?"checkDataTypes":"checkDataType";if(t+=" if ("+e.util[z](T,f,e.opts.strictNumbers,!0)+") { ",A){var U="dataType"+u,M="coerced"+u;t+=" var "+U+" = typeof "+f+"; var "+M+" = undefined; ",e.opts.coerceTypes=="array"&&(t+=" if ("+U+" == 'object' && Array.isArray("+f+") && "+f+".length == 1) { "+f+" = "+f+"[0]; "+U+" = typeof "+f+"; if ("+e.util.checkDataType(e.schema.type,f,e.opts.strictNumbers)+") "+M+" = "+f+"; } "),t+=" if ("+M+" !== undefined) ; ";var q=A;if(q)for(var J,Y=-1,se=q.length-1;Y<se;)J=q[Y+=1],J=="string"?t+=" else if ("+U+" == 'number' || "+U+" == 'boolean') "+M+" = '' + "+f+"; else if ("+f+" === null) "+M+" = ''; ":J=="number"||J=="integer"?(t+=" else if ("+U+" == 'boolean' || "+f+" === null || ("+U+" == 'string' && "+f+" && "+f+" == +"+f+" ",J=="integer"&&(t+=" && !("+f+" % 1)"),t+=")) "+M+" = +"+f+"; "):J=="boolean"?t+=" else if ("+f+" === 'false' || "+f+" === 0 || "+f+" === null) "+M+" = false; else if ("+f+" === 'true' || "+f+" === 1) "+M+" = true; ":J=="null"?t+=" else if ("+f+" === '' || "+f+" === 0 || "+f+" === false) "+M+" = null; ":e.opts.coerceTypes=="array"&&J=="array"&&(t+=" else if ("+U+" == 'string' || "+U+" == 'number' || "+U+" == 'boolean' || "+f+" == null) "+M+" = ["+f+"]; ");t+=" else {   ";var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",D?t+=""+T.join(","):t+=""+T,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",D?t+=""+T.join(","):t+=""+T,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } if ("+M+" !== undefined) {  ";var oe=d?"data"+(d-1||""):"parentData",Se=d?e.dataPathArr[d]:"parentDataProperty";t+=" "+f+" = "+M+"; ",d||(t+="if ("+oe+" !== undefined)"),t+=" "+oe+"["+Se+"] = "+M+"; } "}else{var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",D?t+=""+T.join(","):t+=""+T,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",D?t+=""+T.join(","):t+=""+T,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(e.schema.$ref&&!i)t+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",x&&(t+=" } if (errors === ",w?t+="0":t+="errs_"+u,t+=") { ",$+="}");else{var Ce=e.RULES;if(Ce){for(var R,Z=-1,re=Ce.length-1;Z<re;)if(R=Ce[Z+=1],Ae(R)){if(R.type&&(t+=" if ("+e.util.checkDataType(R.type,f,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(R.type=="object"&&e.schema.properties){var p=e.schema.properties,ue=Object.keys(p),ee=ue;if(ee)for(var _,C=-1,F=ee.length-1;C<F;){_=ee[C+=1];var W=p[_];if(W.default!==void 0){var H=f+e.util.getProperty(_);if(e.compositeRule){if(e.opts.strictDefaults){var S="default is ignored for: "+H;if(e.opts.strictDefaults==="log")e.logger.warn(S);else throw new Error(S)}}else t+=" if ("+H+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+H+" === null || "+H+" === '' "),t+=" ) "+H+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(W.default)+" ":t+=" "+JSON.stringify(W.default)+" ",t+="; "}}}else if(R.type=="array"&&Array.isArray(e.schema.items)){var j=e.schema.items;if(j){for(var W,Y=-1,k=j.length-1;Y<k;)if(W=j[Y+=1],W.default!==void 0){var H=f+"["+Y+"]";if(e.compositeRule){if(e.opts.strictDefaults){var S="default is ignored for: "+H;if(e.opts.strictDefaults==="log")e.logger.warn(S);else throw new Error(S)}}else t+=" if ("+H+" === undefined ",e.opts.useDefaults=="empty"&&(t+=" || "+H+" === null || "+H+" === '' "),t+=" ) "+H+" = ",e.opts.useDefaults=="shared"?t+=" "+e.useDefault(W.default)+" ":t+=" "+JSON.stringify(W.default)+" ",t+="; "}}}}var V=R.rules;if(V){for(var G,we=-1,ce=V.length-1;we<ce;)if(G=V[we+=1],ct(G)){var me=G.code(e,G.keyword,R.type);me&&(t+=" "+me+" ",x&&(E+="}"))}}if(x&&(t+=" "+E+" ",E=""),R.type&&(t+=" } ",T&&T===R.type&&!A)){t+=" else { ";var h=e.schemaPath+".type",v=e.errSchemaPath+"/type",m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",D?t+=""+T.join(","):t+=""+T,t+="' } ",e.opts.messages!==!1&&(t+=" , message: 'should be ",D?t+=""+T.join(","):t+=""+T,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&x?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } "}x&&(t+=" if (errors === ",w?t+="0":t+="errs_"+u,t+=") { ",$+="}")}}}x&&(t+=" "+$+" "),w?(n?(t+=" if (errors === 0) return data;           ",t+=" else throw new ValidationError(vErrors); "):(t+=" validate.errors = vErrors; ",t+=" return errors === 0;       "),t+=" }; return validate;"):t+=" var "+O+" = errors === errs_"+u+";";function Ae(qe){for(var de=qe.rules,te=0;te<de.length;te++)if(ct(de[te]))return!0}function ct(qe){return e.schema[qe.keyword]!==void 0||qe.implements&&ae(qe)}function ae(qe){for(var de=qe.implements,te=0;te<de.length;te++)if(e.schema[de[te]]!==void 0)return!0}return t}),wc}var Is,Ec;function vy(){if(Ec)return Is;Ec=1;var e=$s(),r=qr(),a=Rs(),t=bc(),n=jc(),i=r.ucs2length,s=ko(),o=a.Validation;Is=l;function l(w,S,O,x){var E=this,$=this._opts,N=[void 0],T={},D=[],A={},R=[],z={},U=[];S=S||{schema:w,refVal:N,refs:T};var M=u.call(this,w,S,x),q=this._compilations[M.index];if(M.compiling)return q.callValidate=Se;var J=this._formats,Y=this.RULES;try{var se=Ce(w,S,O,x);q.validate=se;var oe=q.callValidate;return oe&&(oe.schema=se.schema,oe.errors=null,oe.refs=se.refs,oe.refVal=se.refVal,oe.root=se.root,oe.$async=se.$async,$.sourceCode&&(oe.source=se.source)),se}finally{d.call(this,w,S,x)}function Se(){var H=q.validate,j=H.apply(this,arguments);return Se.errors=H.errors,j}function Ce(H,j,k,V){var G=!j||j&&j.schema==H;if(j.schema!=S.schema)return l.call(E,H,j,k,V);var we=H.$async===!0,ce=n({isTop:!0,schema:H,isRoot:G,baseId:V,root:j,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:a.MissingRef,RULES:Y,validate:n,util:r,resolve:e,resolveRef:Z,usePattern:C,useDefault:F,useCustomRule:W,opts:$,formats:J,logger:E.logger,self:E});ce=g(N,f)+g(D,h)+g(R,v)+g(U,m)+ce,$.processCode&&(ce=$.processCode(ce,H));var me;try{var Ae=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",ce);me=Ae(E,Y,J,S,N,R,U,s,i,o),N[0]=me}catch(ct){throw E.logger.error("Error compiling schema, function code:",ce),ct}return me.schema=H,me.errors=null,me.refs=T,me.refVal=N,me.root=G?me:j,we&&(me.$async=!0),$.sourceCode===!0&&(me.source={code:ce,patterns:D,defaults:R}),me}function Z(H,j,k){j=e.url(H,j);var V=T[j],G,we;if(V!==void 0)return G=N[V],we="refVal["+V+"]",_(G,we);if(!k&&S.refs){var ce=S.refs[j];if(ce!==void 0)return G=S.refVal[ce],we=re(j,G),_(G,we)}we=re(j);var me=e.call(E,Ce,S,j);if(me===void 0){var Ae=O&&O[j];Ae&&(me=e.inlineRef(Ae,$.inlineRefs)?Ae:l.call(E,Ae,S,O,H))}if(me===void 0)ue(j);else return ee(j,me),_(me,we)}function re(H,j){var k=N.length;return N[k]=j,T[H]=k,"refVal"+k}function ue(H){delete T[H]}function ee(H,j){var k=T[H];N[k]=j}function _(H,j){return typeof H=="object"||typeof H=="boolean"?{code:j,schema:H,inline:!0}:{code:j,$async:H&&!!H.$async}}function C(H){var j=A[H];return j===void 0&&(j=A[H]=D.length,D[j]=H),"pattern"+j}function F(H){switch(typeof H){case"boolean":case"number":return""+H;case"string":return r.toQuotedString(H);case"object":if(H===null)return"null";var j=t(H),k=z[j];return k===void 0&&(k=z[j]=R.length,R[k]=H),"default"+k}}function W(H,j,k,V){if(E._opts.validateSchema!==!1){var G=H.definition.dependencies;if(G&&!G.every(function(te){return Object.prototype.hasOwnProperty.call(k,te)}))throw new Error("parent schema must have all required keywords: "+G.join(","));var we=H.definition.validateSchema;if(we){var ce=we(j);if(!ce){var me="keyword schema is invalid: "+E.errorsText(we.errors);if(E._opts.validateSchema=="log")E.logger.error(me);else throw new Error(me)}}}var Ae=H.definition.compile,ct=H.definition.inline,ae=H.definition.macro,qe;if(Ae)qe=Ae.call(E,j,k,V);else if(ae)qe=ae.call(E,j,k,V),$.validateSchema!==!1&&E.validateSchema(qe,!0);else if(ct)qe=ct.call(E,V,H.keyword,j,k);else if(qe=H.definition.validate,!qe)return;if(qe===void 0)throw new Error('custom keyword "'+H.keyword+'"failed to compile');var de=U.length;return U[de]=qe,{code:"customRule"+de,validate:qe}}}function u(w,S,O){var x=p.call(this,w,S,O);return x>=0?{index:x,compiling:!0}:(x=this._compilations.length,this._compilations[x]={schema:w,root:S,baseId:O},{index:x,compiling:!1})}function d(w,S,O){var x=p.call(this,w,S,O);x>=0&&this._compilations.splice(x,1)}function p(w,S,O){for(var x=0;x<this._compilations.length;x++){var E=this._compilations[x];if(E.schema==w&&E.root==S&&E.baseId==O)return x}return-1}function h(w,S){return"var pattern"+w+" = new RegExp("+r.toQuotedString(S[w])+");"}function v(w){return"var default"+w+" = defaults["+w+"];"}function f(w,S){return S[w]===void 0?"":"var refVal"+w+" = refVal["+w+"];"}function m(w){return"var customRule"+w+" = customRules["+w+"];"}function g(w,S){if(!w.length)return"";for(var O="",x=0;x<w.length;x++)O+=S(x,w);return O}return Is}var Ts={exports:{}},Sc;function gy(){if(Sc)return Ts.exports;Sc=1;var e=Ts.exports=function(){this._cache={}};return e.prototype.put=function(r,a){this._cache[r]=a},e.prototype.get=function(r){return this._cache[r]},e.prototype.del=function(r){delete this._cache[r]},e.prototype.clear=function(){this._cache={}},Ts.exports}var As,kc;function yy(){if(kc)return As;kc=1;var e=qr(),r=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,a=[0,31,28,31,30,31,30,31,31,30,31,30,31],t=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,n=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,i=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,s=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,l=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,u=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,d=/^(?:\/(?:[^~/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,h=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;As=v;function v(N){return N=N=="full"?"full":"fast",e.copy(v[N])}v.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":o,url:l,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:n,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:$,uuid:u,"json-pointer":d,"json-pointer-uri-fragment":p,"relative-json-pointer":h},v.full={date:m,time:g,"date-time":S,uri:x,"uri-reference":s,"uri-template":o,url:l,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:n,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:$,uuid:u,"json-pointer":d,"json-pointer-uri-fragment":p,"relative-json-pointer":h};function f(N){return N%4===0&&(N%100!==0||N%400===0)}function m(N){var T=N.match(r);if(!T)return!1;var D=+T[1],A=+T[2],R=+T[3];return A>=1&&A<=12&&R>=1&&R<=(A==2&&f(D)?29:a[A])}function g(N,T){var D=N.match(t);if(!D)return!1;var A=D[1],R=D[2],z=D[3],U=D[5];return(A<=23&&R<=59&&z<=59||A==23&&R==59&&z==60)&&(!T||U)}var w=/t|\s/i;function S(N){var T=N.split(w);return T.length==2&&m(T[0])&&g(T[1],!0)}var O=/\/|:/;function x(N){return O.test(N)&&i.test(N)}var E=/[^\\]\\Z/;function $(N){if(E.test(N))return!1;try{return new RegExp(N),!0}catch{return!1}}return As}var Cc,Pc;function _y(){return Pc||(Pc=1,Cc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.errSchemaPath+"/"+r,l=!e.opts.allErrors,u="data"+(i||""),d="valid"+n,p,h;if(s=="#"||s=="#/")e.isRoot?(p=e.async,h="validate"):(p=e.root.schema.$async===!0,h="root.refVal[0]");else{var v=e.resolveRef(e.baseId,s,e.isRoot);if(v===void 0){var f=e.MissingRefError.message(e.baseId,s);if(e.opts.missingRefs=="fail"){e.logger.error(f);var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(o)+" , params: { ref: '"+e.util.escapeQuotes(s)+"' } ",e.opts.messages!==!1&&(t+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(s)+"' "),e.opts.verbose&&(t+=" , schema: "+e.util.toQuotedString(s)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+u+" "),t+=" } "):t+=" {} ";var g=t;t=m.pop(),!e.compositeRule&&l?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(t+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(f),l&&(t+=" if (true) { ");else throw new e.MissingRefError(e.baseId,s,f)}else if(v.inline){var w=e.util.copy(e);w.level++;var S="valid"+w.level;w.schema=v.schema,w.schemaPath="",w.errSchemaPath=s;var O=e.validate(w).replace(/validate\.schema/g,v.code);t+=" "+O+" ",l&&(t+=" if ("+S+") { ")}else p=v.$async===!0||e.async&&v.$async!==!1,h=v.code}if(h){var m=m||[];m.push(t),t="",e.opts.passContext?t+=" "+h+".call(this, ":t+=" "+h+"( ",t+=" "+u+", (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var x=i?"data"+(i-1||""):"parentData",E=i?e.dataPathArr[i]:"parentDataProperty";t+=" , "+x+" , "+E+", rootData)  ";var $=t;if(t=m.pop(),p){if(!e.async)throw new Error("async schema referenced by sync schema");l&&(t+=" var "+d+"; "),t+=" try { await "+$+"; ",l&&(t+=" "+d+" = true; "),t+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",l&&(t+=" "+d+" = false; "),t+=" } ",l&&(t+=" if ("+d+") { ")}else t+=" if (!"+$+") { if (vErrors === null) vErrors = "+h+".errors; else vErrors = vErrors.concat("+h+".errors); errors = vErrors.length; } ",l&&(t+=" else { ")}return t}),Cc}var Nc,$c;function by(){return $c||($c=1,Nc=function(e,r,a){var t=" ",n=e.schema[r],i=e.schemaPath+e.util.getProperty(r),s=e.errSchemaPath+"/"+r,o=!e.opts.allErrors,l=e.util.copy(e),u="";l.level++;var d="valid"+l.level,p=l.baseId,h=!0,v=n;if(v)for(var f,m=-1,g=v.length-1;m<g;)f=v[m+=1],(e.opts.strictKeywords?typeof f=="object"&&Object.keys(f).length>0||f===!1:e.util.schemaHasRules(f,e.RULES.all))&&(h=!1,l.schema=f,l.schemaPath=i+"["+m+"]",l.errSchemaPath=s+"/"+m,t+="  "+e.validate(l)+" ",l.baseId=p,o&&(t+=" if ("+d+") { ",u+="}"));return o&&(h?t+=" if (true) { ":t+=" "+u.slice(0,-1)+" "),t}),Nc}var Oc,Rc;function wy(){return Rc||(Rc=1,Oc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g=s.every(function(N){return e.opts.strictKeywords?typeof N=="object"&&Object.keys(N).length>0||N===!1:e.util.schemaHasRules(N,e.RULES.all)});if(g){var w=v.baseId;t+=" var "+h+" = errors; var "+p+" = false;  ";var S=e.compositeRule;e.compositeRule=v.compositeRule=!0;var O=s;if(O)for(var x,E=-1,$=O.length-1;E<$;)x=O[E+=1],v.schema=x,v.schemaPath=o+"["+E+"]",v.errSchemaPath=l+"/"+E,t+="  "+e.validate(v)+" ",v.baseId=w,t+=" "+p+" = "+p+" || "+m+"; if (!"+p+") { ",f+="}";e.compositeRule=v.compositeRule=S,t+=" "+f+" if (!"+p+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else u&&(t+=" if (true) { ");return t}),Oc}var Ic,Tc;function xy(){return Tc||(Tc=1,Ic=function(e,r,a){var t=" ",n=e.schema[r],i=e.errSchemaPath+"/"+r;e.opts.allErrors;var s=e.util.toQuotedString(n);return e.opts.$comment===!0?t+=" console.log("+s+");":typeof e.opts.$comment=="function"&&(t+=" self._opts.$comment("+s+", "+e.util.toQuotedString(i)+", validate.root.schema);"),t}),Ic}var Ac,Lc;function jy(){return Lc||(Lc=1,Ac=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; "),h||(t+=" var schema"+n+" = validate.schema"+o+";"),t+="var "+p+" = equal("+d+", schema"+n+"); if (!"+p+") {   ";var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValue: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to constant' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var f=t;return t=v.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+f+"]); ":t+=" validate.errors = ["+f+"]; return false; ":t+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",u&&(t+=" else { "),t}),Ac}var Fc,Dc;function Ey(){return Dc||(Dc=1,Fc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g="i"+n,w=v.dataLevel=e.dataLevel+1,S="data"+w,O=e.baseId,x=e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all);if(t+="var "+h+" = errors;var "+p+";",x){var E=e.compositeRule;e.compositeRule=v.compositeRule=!0,v.schema=s,v.schemaPath=o,v.errSchemaPath=l,t+=" var "+m+" = false; for (var "+g+" = 0; "+g+" < "+d+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var $=d+"["+g+"]";v.dataPathArr[w]=g;var N=e.validate(v);v.baseId=O,e.util.varOccurences(N,S)<2?t+=" "+e.util.varReplace(N,S,$)+" ":t+=" var "+S+" = "+$+"; "+N+" ",t+=" if ("+m+") break; }  ",e.compositeRule=v.compositeRule=E,t+=" "+f+" if (!"+m+") {"}else t+=" if ("+d+".length == 0) {";var T=T||[];T.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should contain a valid item' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var D=t;return t=T.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+D+"]); ":t+=" validate.errors = ["+D+"]; return false; ":t+=" var err = "+D+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { ",x&&(t+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } "),e.opts.allErrors&&(t+=" } "),t}),Fc}var Mc,zc;function Sy(){return zc||(zc=1,Mc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level,m={},g={},w=e.opts.ownProperties;for(E in s)if(E!="__proto__"){var S=s[E],O=Array.isArray(S)?g:m;O[E]=S}t+="var "+p+" = errors;";var x=e.errorPath;t+="var missing"+n+";";for(var E in g)if(O=g[E],O.length){if(t+=" if ( "+d+e.util.getProperty(E)+" !== undefined ",w&&(t+=" && Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(E)+"') "),u){t+=" && ( ";var $=O;if($)for(var N,T=-1,D=$.length-1;T<D;){N=$[T+=1],T&&(t+=" || ");var A=e.util.getProperty(N),R=d+A;t+=" ( ( "+R+" === undefined ",w&&(t+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(N)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?N:A)+") ) "}t+=")) {  ";var z="missing"+n,U="' + "+z+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,z,!0):x+" + "+z);var M=M||[];M.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(E)+"', missingProperty: '"+U+"', depsCount: "+O.length+", deps: '"+e.util.escapeQuotes(O.length==1?O[0]:O.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",O.length==1?t+="property "+e.util.escapeQuotes(O[0]):t+="properties "+e.util.escapeQuotes(O.join(", ")),t+=" when property "+e.util.escapeQuotes(E)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var q=t;t=M.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+q+"]); ":t+=" validate.errors = ["+q+"]; return false; ":t+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{t+=" ) { ";var J=O;if(J)for(var N,Y=-1,se=J.length-1;Y<se;){N=J[Y+=1];var A=e.util.getProperty(N),U=e.util.escapeQuotes(N),R=d+A;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,N,e.opts.jsonPointers)),t+=" if ( "+R+" === undefined ",w&&(t+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(N)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(E)+"', missingProperty: '"+U+"', depsCount: "+O.length+", deps: '"+e.util.escapeQuotes(O.length==1?O[0]:O.join(", "))+"' } ",e.opts.messages!==!1&&(t+=" , message: 'should have ",O.length==1?t+="property "+e.util.escapeQuotes(O[0]):t+="properties "+e.util.escapeQuotes(O.join(", ")),t+=" when property "+e.util.escapeQuotes(E)+" is present' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}t+=" }   ",u&&(v+="}",t+=" else { ")}e.errorPath=x;var oe=h.baseId;for(var E in m){var S=m[E];(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all))&&(t+=" "+f+" = true; if ( "+d+e.util.getProperty(E)+" !== undefined ",w&&(t+=" && Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(E)+"') "),t+=") { ",h.schema=S,h.schemaPath=o+e.util.getProperty(E),h.errSchemaPath=l+"/"+e.util.escapeFragment(E),t+="  "+e.validate(h)+" ",h.baseId=oe,t+=" }  ",u&&(t+=" if ("+f+") { ",v+="}"))}return u&&(t+="   "+v+" if ("+p+" == errors) {"),t}),Mc}var Uc,Hc;function ky(){return Hc||(Hc=1,Uc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ");var v="i"+n,f="schema"+n;h||(t+=" var "+f+" = validate.schema"+o+";"),t+="var "+p+";",h&&(t+=" if (schema"+n+" === undefined) "+p+" = true; else if (!Array.isArray(schema"+n+")) "+p+" = false; else {"),t+=""+p+" = false;for (var "+v+"=0; "+v+"<"+f+".length; "+v+"++) if (equal("+d+", "+f+"["+v+"])) { "+p+" = true; break; }",h&&(t+="  }  "),t+=" if (!"+p+") {   ";var m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+n+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" }",u&&(t+=" else { "),t}),Uc}var Vc,qc;function Cy(){return qc||(qc=1,Vc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||"");if(e.opts.format===!1)return u&&(t+=" if (true) { "),t;var p=e.opts.$data&&s&&s.$data,h;p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=e.opts.unknownFormats,f=Array.isArray(v);if(p){var m="format"+n,g="isObject"+n,w="formatType"+n;t+=" var "+m+" = formats["+h+"]; var "+g+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+w+" = "+g+" && "+m+".type || 'string'; if ("+g+") { ",e.async&&(t+=" var async"+n+" = "+m+".async; "),t+=" "+m+" = "+m+".validate; } if (  ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),t+=" (",v!="ignore"&&(t+=" ("+h+" && !"+m+" ",f&&(t+=" && self._opts.unknownFormats.indexOf("+h+") == -1 "),t+=") || "),t+=" ("+m+" && "+w+" == '"+a+"' && !(typeof "+m+" == 'function' ? ",e.async?t+=" (async"+n+" ? await "+m+"("+d+") : "+m+"("+d+")) ":t+=" "+m+"("+d+") ",t+=" : "+m+".test("+d+"))))) {"}else{var m=e.formats[s];if(!m){if(v=="ignore")return e.logger.warn('unknown format "'+s+'" ignored in schema at path "'+e.errSchemaPath+'"'),u&&(t+=" if (true) { "),t;if(f&&v.indexOf(s)>=0)return u&&(t+=" if (true) { "),t;throw new Error('unknown format "'+s+'" is used in schema at path "'+e.errSchemaPath+'"')}var g=typeof m=="object"&&!(m instanceof RegExp)&&m.validate,w=g&&m.type||"string";if(g){var S=m.async===!0;m=m.validate}if(w!=a)return u&&(t+=" if (true) { "),t;if(S){if(!e.async)throw new Error("async format in sync schema");var O="formats"+e.util.getProperty(s)+".validate";t+=" if (!(await "+O+"("+d+"))) { "}else{t+=" if (! ";var O="formats"+e.util.getProperty(s);g&&(O+=".validate"),typeof m=="function"?t+=" "+O+"("+d+") ":t+=" "+O+".test("+d+") ",t+=") { "}}var x=x||[];x.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",p?t+=""+h:t+=""+e.util.toQuotedString(s),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match format "`,p?t+="' + "+h+" + '":t+=""+e.util.escapeQuotes(s),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+e.util.toQuotedString(s),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var E=t;return t=x.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+E+"]); ":t+=" validate.errors = ["+E+"]; return false; ":t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",u&&(t+=" else { "),t}),Vc}var Zc,Bc;function Py(){return Bc||(Bc=1,Zc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e);v.level++;var f="valid"+v.level,m=e.schema.then,g=e.schema.else,w=m!==void 0&&(e.opts.strictKeywords?typeof m=="object"&&Object.keys(m).length>0||m===!1:e.util.schemaHasRules(m,e.RULES.all)),S=g!==void 0&&(e.opts.strictKeywords?typeof g=="object"&&Object.keys(g).length>0||g===!1:e.util.schemaHasRules(g,e.RULES.all)),O=v.baseId;if(w||S){var x;v.createErrors=!1,v.schema=s,v.schemaPath=o,v.errSchemaPath=l,t+=" var "+h+" = errors; var "+p+" = true;  ";var E=e.compositeRule;e.compositeRule=v.compositeRule=!0,t+="  "+e.validate(v)+" ",v.baseId=O,v.createErrors=!0,t+="  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }  ",e.compositeRule=v.compositeRule=E,w?(t+=" if ("+f+") {  ",v.schema=e.schema.then,v.schemaPath=e.schemaPath+".then",v.errSchemaPath=e.errSchemaPath+"/then",t+="  "+e.validate(v)+" ",v.baseId=O,t+=" "+p+" = "+f+"; ",w&&S?(x="ifClause"+n,t+=" var "+x+" = 'then'; "):x="'then'",t+=" } ",S&&(t+=" else { ")):t+=" if (!"+f+") { ",S&&(v.schema=e.schema.else,v.schemaPath=e.schemaPath+".else",v.errSchemaPath=e.errSchemaPath+"/else",t+="  "+e.validate(v)+" ",v.baseId=O,t+=" "+p+" = "+f+"; ",w&&S?(x="ifClause"+n,t+=" var "+x+" = 'else'; "):x="'else'",t+=" } "),t+=" if (!"+p+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+x+" } ",e.opts.messages!==!1&&(t+=` , message: 'should match "' + `+x+` + '" schema' `),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+=" }   ",u&&(t+=" else { ")}else u&&(t+=" if (true) { ");return t}),Zc}var Wc,Kc;function Ny(){return Kc||(Kc=1,Wc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g="i"+n,w=v.dataLevel=e.dataLevel+1,S="data"+w,O=e.baseId;if(t+="var "+h+" = errors;var "+p+";",Array.isArray(s)){var x=e.schema.additionalItems;if(x===!1){t+=" "+p+" = "+d+".length <= "+s.length+"; ";var E=l;l=e.errSchemaPath+"/additionalItems",t+="  if (!"+p+") {   ";var $=$||[];$.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+s.length+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have more than "+s.length+" items' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var N=t;t=$.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+N+"]); ":t+=" validate.errors = ["+N+"]; return false; ":t+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",l=E,u&&(f+="}",t+=" else { ")}var T=s;if(T){for(var D,A=-1,R=T.length-1;A<R;)if(D=T[A+=1],e.opts.strictKeywords?typeof D=="object"&&Object.keys(D).length>0||D===!1:e.util.schemaHasRules(D,e.RULES.all)){t+=" "+m+" = true; if ("+d+".length > "+A+") { ";var z=d+"["+A+"]";v.schema=D,v.schemaPath=o+"["+A+"]",v.errSchemaPath=l+"/"+A,v.errorPath=e.util.getPathExpr(e.errorPath,A,e.opts.jsonPointers,!0),v.dataPathArr[w]=A;var U=e.validate(v);v.baseId=O,e.util.varOccurences(U,S)<2?t+=" "+e.util.varReplace(U,S,z)+" ":t+=" var "+S+" = "+z+"; "+U+" ",t+=" }  ",u&&(t+=" if ("+m+") { ",f+="}")}}if(typeof x=="object"&&(e.opts.strictKeywords?typeof x=="object"&&Object.keys(x).length>0||x===!1:e.util.schemaHasRules(x,e.RULES.all))){v.schema=x,v.schemaPath=e.schemaPath+".additionalItems",v.errSchemaPath=e.errSchemaPath+"/additionalItems",t+=" "+m+" = true; if ("+d+".length > "+s.length+") {  for (var "+g+" = "+s.length+"; "+g+" < "+d+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var z=d+"["+g+"]";v.dataPathArr[w]=g;var U=e.validate(v);v.baseId=O,e.util.varOccurences(U,S)<2?t+=" "+e.util.varReplace(U,S,z)+" ":t+=" var "+S+" = "+z+"; "+U+" ",u&&(t+=" if (!"+m+") break; "),t+=" } }  ",u&&(t+=" if ("+m+") { ",f+="}")}}else if(e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){v.schema=s,v.schemaPath=o,v.errSchemaPath=l,t+="  for (var "+g+" = 0; "+g+" < "+d+".length; "+g+"++) { ",v.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var z=d+"["+g+"]";v.dataPathArr[w]=g;var U=e.validate(v);v.baseId=O,e.util.varOccurences(U,S)<2?t+=" "+e.util.varReplace(U,S,z)+" ":t+=" var "+S+" = "+z+"; "+U+" ",u&&(t+=" if (!"+m+") break; "),t+=" }"}return u&&(t+=" "+f+" if ("+h+" == errors) {"),t}),Wc}var Qc,Gc;function Jc(){return Gc||(Gc=1,Qc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,O,d="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=r=="maximum",f=v?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],g=e.opts.$data&&m&&m.$data,w=v?"<":">",S=v?">":"<",O=void 0;if(!(p||typeof s=="number"||s===void 0))throw new Error(r+" must be number");if(!(g||m===void 0||typeof m=="number"||typeof m=="boolean"))throw new Error(f+" must be number or boolean");if(g){var x=e.util.getData(m.$data,i,e.dataPathArr),E="exclusive"+n,$="exclType"+n,N="exclIsNumber"+n,T="op"+n,D="' + "+T+" + '";t+=" var schemaExcl"+n+" = "+x+"; ",x="schemaExcl"+n,t+=" var "+E+"; var "+$+" = typeof "+x+"; if ("+$+" != 'boolean' && "+$+" != 'undefined' && "+$+" != 'number') { ";var O=f,A=A||[];A.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(O||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var R=t;t=A.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" "+$+" == 'number' ? ( ("+E+" = "+h+" === undefined || "+x+" "+w+"= "+h+") ? "+d+" "+S+"= "+x+" : "+d+" "+S+" "+h+" ) : ( ("+E+" = "+x+" === true) ? "+d+" "+S+"= "+h+" : "+d+" "+S+" "+h+" ) || "+d+" !== "+d+") { var op"+n+" = "+E+" ? '"+w+"' : '"+w+"='; ",s===void 0&&(O=f,l=e.errSchemaPath+"/"+f,h=x,p=g)}else{var N=typeof m=="number",D=w;if(N&&p){var T="'"+D+"'";t+=" if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" ( "+h+" === undefined || "+m+" "+w+"= "+h+" ? "+d+" "+S+"= "+m+" : "+d+" "+S+" "+h+" ) || "+d+" !== "+d+") { "}else{N&&s===void 0?(E=!0,O=f,l=e.errSchemaPath+"/"+f,h=m,S+="="):(N&&(h=Math[v?"min":"max"](m,s)),m===(N?h:!0)?(E=!0,O=f,l=e.errSchemaPath+"/"+f,S+="="):(E=!1,D+="="));var T="'"+D+"'";t+=" if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" "+d+" "+S+" "+h+" || "+d+" !== "+d+") { "}}O=O||r;var A=A||[];A.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(O||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { comparison: "+T+", limit: "+h+", exclusive: "+E+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be "+D+" ",p?t+="' + "+h:t+=""+h+"'"),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var R=t;return t=A.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",u&&(t+=" else { "),t}),Qc}var Xc,Yc;function ed(){return Yc||(Yc=1,Xc=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,f,d="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");var v=r=="maxItems"?">":"<";t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" "+d+".length "+v+" "+h+") { ";var f=r,m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxItems"?t+="more":t+="fewer",t+=" than ",p?t+="' + "+h+" + '":t+=""+s,t+=" items' "),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",u&&(t+=" else { "),t}),Xc}var td,rd;function ad(){return rd||(rd=1,td=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,f,d="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");var v=r=="maxLength"?">":"<";t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),e.opts.unicode===!1?t+=" "+d+".length ":t+=" ucs2length("+d+") ",t+=" "+v+" "+h+") { ";var f=r,m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be ",r=="maxLength"?t+="longer":t+="shorter",t+=" than ",p?t+="' + "+h+" + '":t+=""+s,t+=" characters' "),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",u&&(t+=" else { "),t}),td}var nd,sd;function id(){return sd||(sd=1,nd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,f,d="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");var v=r=="maxProperties"?">":"<";t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'number') || "),t+=" Object.keys("+d+").length "+v+" "+h+") { ";var f=r,m=m||[];m.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have ",r=="maxProperties"?t+="more":t+="fewer",t+=" than ",p?t+="' + "+h+" + '":t+=""+s,t+=" properties' "),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var g=t;return t=m.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+g+"]); ":t+=" validate.errors = ["+g+"]; return false; ":t+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",u&&(t+=" else { "),t}),nd}var od,ld;function $y(){return ld||(ld=1,od=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;if(p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s,!(p||typeof s=="number"))throw new Error(r+" must be number");t+="var division"+n+";if (",p&&(t+=" "+h+" !== undefined && ( typeof "+h+" != 'number' || "),t+=" (division"+n+" = "+d+" / "+h+", ",e.opts.multipleOfPrecision?t+=" Math.abs(Math.round(division"+n+") - division"+n+") > 1e-"+e.opts.multipleOfPrecision+" ":t+=" division"+n+" !== parseInt(division"+n+") ",t+=" ) ",p&&(t+="  )  "),t+=" ) {   ";var v=v||[];v.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { multipleOf: "+h+" } ",e.opts.messages!==!1&&(t+=" , message: 'should be multiple of ",p?t+="' + "+h:t+=""+h+"'"),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var f=t;return t=v.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+f+"]); ":t+=" validate.errors = ["+f+"]; return false; ":t+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",u&&(t+=" else { "),t}),od}var cd,dd;function Oy(){return dd||(dd=1,cd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="errs__"+n,h=e.util.copy(e);h.level++;var v="valid"+h.level;if(e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){h.schema=s,h.schemaPath=o,h.errSchemaPath=l,t+=" var "+p+" = errors;  ";var f=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.createErrors=!1;var m;h.opts.allErrors&&(m=h.opts.allErrors,h.opts.allErrors=!1),t+=" "+e.validate(h)+" ",h.createErrors=!0,m&&(h.opts.allErrors=m),e.compositeRule=h.compositeRule=f,t+=" if ("+v+") {   ";var g=g||[];g.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var w=t;t=g.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+w+"]); ":t+=" validate.errors = ["+w+"]; return false; ":t+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else {  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; } ",e.opts.allErrors&&(t+=" } ")}else t+="  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",e.opts.messages!==!1&&(t+=" , message: 'should NOT be valid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(t+=" if (false) { ");return t}),cd}var ud,hd;function Ry(){return hd||(hd=1,ud=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h="errs__"+n,v=e.util.copy(e),f="";v.level++;var m="valid"+v.level,g=v.baseId,w="prevValid"+n,S="passingSchemas"+n;t+="var "+h+" = errors , "+w+" = false , "+p+" = false , "+S+" = null; ";var O=e.compositeRule;e.compositeRule=v.compositeRule=!0;var x=s;if(x)for(var E,$=-1,N=x.length-1;$<N;)E=x[$+=1],(e.opts.strictKeywords?typeof E=="object"&&Object.keys(E).length>0||E===!1:e.util.schemaHasRules(E,e.RULES.all))?(v.schema=E,v.schemaPath=o+"["+$+"]",v.errSchemaPath=l+"/"+$,t+="  "+e.validate(v)+" ",v.baseId=g):t+=" var "+m+" = true; ",$&&(t+=" if ("+m+" && "+w+") { "+p+" = false; "+S+" = ["+S+", "+$+"]; } else { ",f+="}"),t+=" if ("+m+") { "+p+" = "+w+" = true; "+S+" = "+$+"; }";return e.compositeRule=v.compositeRule=O,t+=""+f+"if (!"+p+") {   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { passingSchemas: "+S+" } ",e.opts.messages!==!1&&(t+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),t+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",e.opts.allErrors&&(t+=" } "),t}),ud}var pd,md;function Iy(){return md||(md=1,pd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p=e.opts.$data&&s&&s.$data,h;p?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",h="schema"+n):h=s;var v=p?"(new RegExp("+h+"))":e.usePattern(s);t+="if ( ",p&&(t+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),t+=" !"+v+".test("+d+") ) {   ";var f=f||[];f.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { pattern:  ",p?t+=""+h:t+=""+e.util.toQuotedString(s),t+="  } ",e.opts.messages!==!1&&(t+=` , message: 'should match pattern "`,p?t+="' + "+h+" + '":t+=""+e.util.escapeQuotes(s),t+=`"' `),e.opts.verbose&&(t+=" , schema:  ",p?t+="validate.schema"+o:t+=""+e.util.toQuotedString(s),t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var m=t;return t=f.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+m+"]); ":t+=" validate.errors = ["+m+"]; return false; ":t+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+="} ",u&&(t+=" else { "),t}),pd}var fd,vd;function Ty(){return vd||(vd=1,fd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level,m="key"+n,g="idx"+n,w=h.dataLevel=e.dataLevel+1,S="data"+w,O="dataProperties"+n,x=Object.keys(s||{}).filter(Y),E=e.schema.patternProperties||{},$=Object.keys(E).filter(Y),N=e.schema.additionalProperties,T=x.length||$.length,D=N===!1,A=typeof N=="object"&&Object.keys(N).length,R=e.opts.removeAdditional,z=D||A||R,U=e.opts.ownProperties,M=e.baseId,q=e.schema.required;if(q&&!(e.opts.$data&&q.$data)&&q.length<e.opts.loopRequired)var J=e.util.toHash(q);function Y(ne){return ne!=="__proto__"}if(t+="var "+p+" = errors;var "+f+" = true;",U&&(t+=" var "+O+" = undefined;"),z){if(U?t+=" "+O+" = "+O+" || Object.keys("+d+"); for (var "+g+"=0; "+g+"<"+O+".length; "+g+"++) { var "+m+" = "+O+"["+g+"]; ":t+=" for (var "+m+" in "+d+") { ",T){if(t+=" var isAdditional"+n+" = !(false ",x.length)if(x.length>8)t+=" || validate.schema"+o+".hasOwnProperty("+m+") ";else{var se=x;if(se)for(var oe,Se=-1,Ce=se.length-1;Se<Ce;)oe=se[Se+=1],t+=" || "+m+" == "+e.util.toQuotedString(oe)+" "}if($.length){var Z=$;if(Z)for(var re,ue=-1,ee=Z.length-1;ue<ee;)re=Z[ue+=1],t+=" || "+e.usePattern(re)+".test("+m+") "}t+=" ); if (isAdditional"+n+") { "}if(R=="all")t+=" delete "+d+"["+m+"]; ";else{var _=e.errorPath,C="' + "+m+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers)),D)if(R)t+=" delete "+d+"["+m+"]; ";else{t+=" "+f+" = false; ";var F=l;l=e.errSchemaPath+"/additionalProperties";var W=W||[];W.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+C+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is an invalid additional property":t+="should NOT have additional properties",t+="' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var H=t;t=W.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+H+"]); ":t+=" validate.errors = ["+H+"]; return false; ":t+=" var err = "+H+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=F,u&&(t+=" break; ")}else if(A)if(R=="failing"){t+=" var "+p+" = errors;  ";var j=e.compositeRule;e.compositeRule=h.compositeRule=!0,h.schema=N,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var k=d+"["+m+"]";h.dataPathArr[w]=m;var V=e.validate(h);h.baseId=M,e.util.varOccurences(V,S)<2?t+=" "+e.util.varReplace(V,S,k)+" ":t+=" var "+S+" = "+k+"; "+V+" ",t+=" if (!"+f+") { errors = "+p+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+d+"["+m+"]; }  ",e.compositeRule=h.compositeRule=j}else{h.schema=N,h.schemaPath=e.schemaPath+".additionalProperties",h.errSchemaPath=e.errSchemaPath+"/additionalProperties",h.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var k=d+"["+m+"]";h.dataPathArr[w]=m;var V=e.validate(h);h.baseId=M,e.util.varOccurences(V,S)<2?t+=" "+e.util.varReplace(V,S,k)+" ":t+=" var "+S+" = "+k+"; "+V+" ",u&&(t+=" if (!"+f+") break; ")}e.errorPath=_}T&&(t+=" } "),t+=" }  ",u&&(t+=" if ("+f+") { ",v+="}")}var G=e.opts.useDefaults&&!e.compositeRule;if(x.length){var we=x;if(we)for(var oe,ce=-1,me=we.length-1;ce<me;){oe=we[ce+=1];var Ae=s[oe];if(e.opts.strictKeywords?typeof Ae=="object"&&Object.keys(Ae).length>0||Ae===!1:e.util.schemaHasRules(Ae,e.RULES.all)){var ct=e.util.getProperty(oe),k=d+ct,ae=G&&Ae.default!==void 0;h.schema=Ae,h.schemaPath=o+ct,h.errSchemaPath=l+"/"+e.util.escapeFragment(oe),h.errorPath=e.util.getPath(e.errorPath,oe,e.opts.jsonPointers),h.dataPathArr[w]=e.util.toQuotedString(oe);var V=e.validate(h);if(h.baseId=M,e.util.varOccurences(V,S)<2){V=e.util.varReplace(V,S,k);var qe=k}else{var qe=S;t+=" var "+S+" = "+k+"; "}if(ae)t+=" "+V+" ";else{if(J&&J[oe]){t+=" if ( "+qe+" === undefined ",U&&(t+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(oe)+"') "),t+=") { "+f+" = false; ";var _=e.errorPath,F=l,de=e.util.escapeQuotes(oe);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(_,oe,e.opts.jsonPointers)),l=e.errSchemaPath+"/required";var W=W||[];W.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+de+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+de+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var H=t;t=W.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+H+"]); ":t+=" validate.errors = ["+H+"]; return false; ":t+=" var err = "+H+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=F,e.errorPath=_,t+=" } else { "}else u?(t+=" if ( "+qe+" === undefined ",U&&(t+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(oe)+"') "),t+=") { "+f+" = true; } else { "):(t+=" if ("+qe+" !== undefined ",U&&(t+=" &&   Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(oe)+"') "),t+=" ) { ");t+=" "+V+" } "}}u&&(t+=" if ("+f+") { ",v+="}")}}if($.length){var te=$;if(te)for(var re,Ee=-1,ie=te.length-1;Ee<ie;){re=te[Ee+=1];var Ae=E[re];if(e.opts.strictKeywords?typeof Ae=="object"&&Object.keys(Ae).length>0||Ae===!1:e.util.schemaHasRules(Ae,e.RULES.all)){h.schema=Ae,h.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(re),h.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(re),U?t+=" "+O+" = "+O+" || Object.keys("+d+"); for (var "+g+"=0; "+g+"<"+O+".length; "+g+"++) { var "+m+" = "+O+"["+g+"]; ":t+=" for (var "+m+" in "+d+") { ",t+=" if ("+e.usePattern(re)+".test("+m+")) { ",h.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var k=d+"["+m+"]";h.dataPathArr[w]=m;var V=e.validate(h);h.baseId=M,e.util.varOccurences(V,S)<2?t+=" "+e.util.varReplace(V,S,k)+" ":t+=" var "+S+" = "+k+"; "+V+" ",u&&(t+=" if (!"+f+") break; "),t+=" } ",u&&(t+=" else "+f+" = true; "),t+=" }  ",u&&(t+=" if ("+f+") { ",v+="}")}}}return u&&(t+=" "+v+" if ("+p+" == errors) {"),t}),fd}var gd,yd;function Ay(){return yd||(yd=1,gd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="errs__"+n,h=e.util.copy(e),v="";h.level++;var f="valid"+h.level;if(t+="var "+p+" = errors;",e.opts.strictKeywords?typeof s=="object"&&Object.keys(s).length>0||s===!1:e.util.schemaHasRules(s,e.RULES.all)){h.schema=s,h.schemaPath=o,h.errSchemaPath=l;var m="key"+n,g="idx"+n,w="i"+n,S="' + "+m+" + '",O=h.dataLevel=e.dataLevel+1,x="data"+O,E="dataProperties"+n,$=e.opts.ownProperties,N=e.baseId;$&&(t+=" var "+E+" = undefined; "),$?t+=" "+E+" = "+E+" || Object.keys("+d+"); for (var "+g+"=0; "+g+"<"+E+".length; "+g+"++) { var "+m+" = "+E+"["+g+"]; ":t+=" for (var "+m+" in "+d+") { ",t+=" var startErrs"+n+" = errors; ";var T=m,D=e.compositeRule;e.compositeRule=h.compositeRule=!0;var A=e.validate(h);h.baseId=N,e.util.varOccurences(A,x)<2?t+=" "+e.util.varReplace(A,x,T)+" ":t+=" var "+x+" = "+T+"; "+A+" ",e.compositeRule=h.compositeRule=D,t+=" if (!"+f+") { for (var "+w+"=startErrs"+n+"; "+w+"<errors; "+w+"++) { vErrors["+w+"].propertyName = "+m+"; }   var err =   ",e.createErrors!==!1?(t+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+S+"' } ",e.opts.messages!==!1&&(t+=" , message: 'property name \\'"+S+"\\' is invalid' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; "),u&&(t+=" break; "),t+=" } }"}return u&&(t+=" "+v+" if ("+p+" == errors) {"),t}),gd}var _d,bd;function Ly(){return bd||(bd=1,_d=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data;h&&(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ");var v="schema"+n;if(!h)if(s.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var O=[],f=s;if(f)for(var m,g=-1,w=f.length-1;g<w;){m=f[g+=1];var S=e.schema.properties[m];S&&(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all))||(O[O.length]=m)}}else var O=s;if(h||O.length){var x=e.errorPath,E=h||O.length>=e.opts.loopRequired,$=e.opts.ownProperties;if(u)if(t+=" var missing"+n+"; ",E){h||(t+=" var "+v+" = validate.schema"+o+"; ");var N="i"+n,T="schema"+n+"["+N+"]",D="' + "+T+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,T,e.opts.jsonPointers)),t+=" var "+p+" = true; ",h&&(t+=" if (schema"+n+" === undefined) "+p+" = true; else if (!Array.isArray(schema"+n+")) "+p+" = false; else {"),t+=" for (var "+N+" = 0; "+N+" < "+v+".length; "+N+"++) { "+p+" = "+d+"["+v+"["+N+"]] !== undefined ",$&&(t+=" &&   Object.prototype.hasOwnProperty.call("+d+", "+v+"["+N+"]) "),t+="; if (!"+p+") break; } ",h&&(t+="  }  "),t+="  if (!"+p+") {   ";var A=A||[];A.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var R=t;t=A.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else{t+=" if ( ";var z=O;if(z)for(var U,N=-1,M=z.length-1;N<M;){U=z[N+=1],N&&(t+=" || ");var q=e.util.getProperty(U),J=d+q;t+=" ( ( "+J+" === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(U)+"') "),t+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?U:q)+") ) "}t+=") {  ";var T="missing"+n,D="' + "+T+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,T,!0):x+" + "+T);var A=A||[];A.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var R=t;t=A.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+R+"]); ":t+=" validate.errors = ["+R+"]; return false; ":t+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else { "}else if(E){h||(t+=" var "+v+" = validate.schema"+o+"; ");var N="i"+n,T="schema"+n+"["+N+"]",D="' + "+T+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,T,e.opts.jsonPointers)),h&&(t+=" if ("+v+" && !Array.isArray("+v+")) {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+v+" !== undefined) { "),t+=" for (var "+N+" = 0; "+N+" < "+v+".length; "+N+"++) { if ("+d+"["+v+"["+N+"]] === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+d+", "+v+"["+N+"]) "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",h&&(t+="  }  ")}else{var Y=O;if(Y)for(var U,se=-1,oe=Y.length-1;se<oe;){U=Y[se+=1];var q=e.util.getProperty(U),D=e.util.escapeQuotes(U),J=d+q;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,U,e.opts.jsonPointers)),t+=" if ( "+J+" === undefined ",$&&(t+=" || ! Object.prototype.hasOwnProperty.call("+d+", '"+e.util.escapeQuotes(U)+"') "),t+=") {  var err =   ",e.createErrors!==!1?(t+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+D+"' } ",e.opts.messages!==!1&&(t+=" , message: '",e.opts._errorDataPathProperty?t+="is a required property":t+="should have required property \\'"+D+"\\'",t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=x}else u&&(t+=" if (true) {");return t}),_d}var wd,xd;function Fy(){return xd||(xd=1,wd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d="data"+(i||""),p="valid"+n,h=e.opts.$data&&s&&s.$data,v;if(h?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",v="schema"+n):v=s,(s||h)&&e.opts.uniqueItems!==!1){h&&(t+=" var "+p+"; if ("+v+" === false || "+v+" === undefined) "+p+" = true; else if (typeof "+v+" != 'boolean') "+p+" = false; else { "),t+=" var i = "+d+".length , "+p+" = true , j; if (i > 1) { ";var f=e.schema.items&&e.schema.items.type,m=Array.isArray(f);if(!f||f=="object"||f=="array"||m&&(f.indexOf("object")>=0||f.indexOf("array")>=0))t+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+d+"[i], "+d+"[j])) { "+p+" = false; break outer; } } } ";else{t+=" var itemIndices = {}, item; for (;i--;) { var item = "+d+"[i]; ";var g="checkDataType"+(m?"s":"");t+=" if ("+e.util[g](f,"item",e.opts.strictNumbers,!0)+") continue; ",m&&(t+=` if (typeof item == 'string') item = '"' + item; `),t+=" if (typeof itemIndices[item] == 'number') { "+p+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}t+=" } ",h&&(t+="  }  "),t+=" if (!"+p+") {   ";var w=w||[];w.push(t),t="",e.createErrors!==!1?(t+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(t+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(t+=" , schema:  ",h?t+="validate.schema"+o:t+=""+s,t+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),t+=" } "):t+=" {} ";var S=t;t=w.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+S+"]); ":t+=" validate.errors = ["+S+"]; return false; ":t+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } ",u&&(t+=" else { ")}else u&&(t+=" if (true) { ");return t}),wd}var jd,Ed;function Dy(){return Ed||(Ed=1,jd={$ref:_y(),allOf:by(),anyOf:wy(),$comment:xy(),const:jy(),contains:Ey(),dependencies:Sy(),enum:ky(),format:Cy(),if:Py(),items:Ny(),maximum:Jc(),minimum:Jc(),maxItems:ed(),minItems:ed(),maxLength:ad(),minLength:ad(),maxProperties:id(),minProperties:id(),multipleOf:$y(),not:Oy(),oneOf:Ry(),pattern:Iy(),properties:Ty(),propertyNames:Ay(),required:Ly(),uniqueItems:Fy(),validate:jc()}),jd}var Ls,Sd;function My(){if(Sd)return Ls;Sd=1;var e=Dy(),r=qr().toHash;return Ls=function(){var a=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"],n=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],i=["number","integer","string","array","object","boolean","null"];return a.all=r(t),a.types=r(i),a.forEach(function(s){s.rules=s.rules.map(function(o){var l;if(typeof o=="object"){var u=Object.keys(o)[0];l=o[u],o=u,l.forEach(function(p){t.push(p),a.all[p]=!0})}t.push(o);var d=a.all[o]={keyword:o,code:e[o],implements:l};return d}),a.all.$comment={keyword:"$comment",code:e.$comment},s.type&&(a.types[s.type]=s)}),a.keywords=r(t.concat(n)),a.custom={},a},Ls}var Fs,kd;function zy(){if(kd)return Fs;kd=1;var e=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];return Fs=function(r,a){for(var t=0;t<a.length;t++){r=JSON.parse(JSON.stringify(r));var n=a[t].split("/"),i=r,s;for(s=1;s<n.length;s++)i=i[n[s]];for(s=0;s<e.length;s++){var o=e[s],l=i[o];l&&(i[o]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return r},Fs}var Ds,Cd;function Uy(){if(Cd)return Ds;Cd=1;var e=Rs().MissingRef;Ds=r;function r(a,t,n){var i=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof t=="function"&&(n=t,t=void 0);var s=o(a).then(function(){var u=i._addSchema(a,void 0,t);return u.validate||l(u)});return n&&s.then(function(u){n(null,u)},n),s;function o(u){var d=u.$schema;return d&&!i.getSchema(d)?r.call(i,{$ref:d},!0):Promise.resolve()}function l(u){try{return i._compile(u)}catch(p){if(p instanceof e)return d(p);throw p}function d(p){var h=p.missingSchema;if(m(h))throw new Error("Schema "+h+" is loaded but "+p.missingRef+" cannot be resolved");var v=i._loadingSchemas[h];return v||(v=i._loadingSchemas[h]=i._opts.loadSchema(h),v.then(f,f)),v.then(function(g){if(!m(h))return o(g).then(function(){m(h)||i.addSchema(g,h,void 0,t)})}).then(function(){return l(u)});function f(){delete i._loadingSchemas[h]}function m(g){return i._refs[g]||i._schemas[g]}}}}return Ds}var Pd,Nd;function Hy(){return Nd||(Nd=1,Pd=function(e,r,a){var t=" ",n=e.level,i=e.dataLevel,s=e.schema[r],o=e.schemaPath+e.util.getProperty(r),l=e.errSchemaPath+"/"+r,u=!e.opts.allErrors,d,p="data"+(i||""),h="valid"+n,v="errs__"+n,f=e.opts.$data&&s&&s.$data,m;f?(t+=" var schema"+n+" = "+e.util.getData(s.$data,i,e.dataPathArr)+"; ",m="schema"+n):m=s;var g=this,w="definition"+n,S=g.definition,O="",x,E,$,N,T;if(f&&S.$data){T="keywordValidate"+n;var D=S.validateSchema;t+=" var "+w+" = RULES.custom['"+r+"'].definition; var "+T+" = "+w+".validate;"}else{if(N=e.useCustomRule(g,s,e.schema,e),!N)return;m="validate.schema"+o,T=N.code,x=S.compile,E=S.inline,$=S.macro}var A=T+".errors",R="i"+n,z="ruleErr"+n,U=S.async;if(U&&!e.async)throw new Error("async keyword in sync schema");if(E||$||(t+=""+A+" = null;"),t+="var "+v+" = errors;var "+h+";",f&&S.$data&&(O+="}",t+=" if ("+m+" === undefined) { "+h+" = true; } else { ",D&&(O+="}",t+=" "+h+" = "+w+".validateSchema("+m+"); if ("+h+") { ")),E)S.statements?t+=" "+N.validate+" ":t+=" "+h+" = "+N.validate+"; ";else if($){var M=e.util.copy(e),O="";M.level++;var q="valid"+M.level;M.schema=N.validate,M.schemaPath="";var J=e.compositeRule;e.compositeRule=M.compositeRule=!0;var Y=e.validate(M).replace(/validate\.schema/g,T);e.compositeRule=M.compositeRule=J,t+=" "+Y}else{var se=se||[];se.push(t),t="",t+="  "+T+".call( ",e.opts.passContext?t+="this":t+="self",x||S.schema===!1?t+=" , "+p+" ":t+=" , "+m+" , "+p+" , validate.schema"+e.schemaPath+" ",t+=" , (dataPath || '')",e.errorPath!='""'&&(t+=" + "+e.errorPath);var oe=i?"data"+(i-1||""):"parentData",Se=i?e.dataPathArr[i]:"parentDataProperty";t+=" , "+oe+" , "+Se+" , rootData )  ";var Ce=t;t=se.pop(),S.errors===!1?(t+=" "+h+" = ",U&&(t+="await "),t+=""+Ce+"; "):U?(A="customErrors"+n,t+=" var "+A+" = null; try { "+h+" = await "+Ce+"; } catch (e) { "+h+" = false; if (e instanceof ValidationError) "+A+" = e.errors; else throw e; } "):t+=" "+A+" = null; "+h+" = "+Ce+"; "}if(S.modifying&&(t+=" if ("+oe+") "+p+" = "+oe+"["+Se+"];"),t+=""+O,S.valid)u&&(t+=" if (true) { ");else{t+=" if ( ",S.valid===void 0?(t+=" !",$?t+=""+q:t+=""+h):t+=" "+!S.valid+" ",t+=") { ",d=g.keyword;var se=se||[];se.push(t),t="";var se=se||[];se.push(t),t="",e.createErrors!==!1?(t+=" { keyword: '"+(d||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { keyword: '"+g.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+g.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),t+=" } "):t+=" {} ";var Z=t;t=se.pop(),!e.compositeRule&&u?e.async?t+=" throw new ValidationError(["+Z+"]); ":t+=" validate.errors = ["+Z+"]; return false; ":t+=" var err = "+Z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var re=t;t=se.pop(),E?S.errors?S.errors!="full"&&(t+="  for (var "+R+"="+v+"; "+R+"<errors; "+R+"++) { var "+z+" = vErrors["+R+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+z+".schemaPath === undefined) { "+z+'.schemaPath = "'+l+'"; } ',e.opts.verbose&&(t+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),t+=" } "):S.errors===!1?t+=" "+re+" ":(t+=" if ("+v+" == errors) { "+re+" } else {  for (var "+R+"="+v+"; "+R+"<errors; "+R+"++) { var "+z+" = vErrors["+R+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+z+".schemaPath === undefined) { "+z+'.schemaPath = "'+l+'"; } ',e.opts.verbose&&(t+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),t+=" } } "):$?(t+="   var err =   ",e.createErrors!==!1?(t+=" { keyword: '"+(d||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { keyword: '"+g.keyword+"' } ",e.opts.messages!==!1&&(t+=` , message: 'should pass "`+g.keyword+`" keyword validation' `),e.opts.verbose&&(t+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),t+=" } "):t+=" {} ",t+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?t+=" throw new ValidationError(vErrors); ":t+=" validate.errors = vErrors; return false; ")):S.errors===!1?t+=" "+re+" ":(t+=" if (Array.isArray("+A+")) { if (vErrors === null) vErrors = "+A+"; else vErrors = vErrors.concat("+A+"); errors = vErrors.length;  for (var "+R+"="+v+"; "+R+"<errors; "+R+"++) { var "+z+" = vErrors["+R+"]; if ("+z+".dataPath === undefined) "+z+".dataPath = (dataPath || '') + "+e.errorPath+";  "+z+'.schemaPath = "'+l+'";  ',e.opts.verbose&&(t+=" "+z+".schema = "+m+"; "+z+".data = "+p+"; "),t+=" } } else { "+re+" } "),t+=" } ",u&&(t+=" else { ")}return t}),Pd}const Vy="http://json-schema.org/draft-07/schema#",qy="http://json-schema.org/draft-07/schema#",Zy="Core schema meta-schema",By={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},Wy=["object","boolean"],Ky={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},$d={$schema:Vy,$id:qy,title:Zy,definitions:By,type:Wy,properties:Ky,default:!0};var Ms,Od;function Qy(){if(Od)return Ms;Od=1;var e=$d;return Ms={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:e.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:e.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}},Ms}var zs,Rd;function Gy(){if(Rd)return zs;Rd=1;var e=/^[a-z_$][a-z0-9_$-]*$/i,r=Hy(),a=Qy();zs={add:t,get:n,remove:i,validate:s};function t(o,l){var u=this.RULES;if(u.keywords[o])throw new Error("Keyword "+o+" is already defined");if(!e.test(o))throw new Error("Keyword "+o+" is not a valid identifier");if(l){this.validateKeyword(l,!0);var d=l.type;if(Array.isArray(d))for(var p=0;p<d.length;p++)v(o,d[p],l);else v(o,d,l);var h=l.metaSchema;h&&(l.$data&&this._opts.$data&&(h={anyOf:[h,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),l.validateSchema=this.compile(h,!0))}u.keywords[o]=u.all[o]=!0;function v(f,m,g){for(var w,S=0;S<u.length;S++){var O=u[S];if(O.type==m){w=O;break}}w||(w={type:m,rules:[]},u.push(w));var x={keyword:f,definition:g,custom:!0,code:r,implements:g.implements};w.rules.push(x),u.custom[f]=x}return this}function n(o){var l=this.RULES.custom[o];return l?l.definition:this.RULES.keywords[o]||!1}function i(o){var l=this.RULES;delete l.keywords[o],delete l.all[o],delete l.custom[o];for(var u=0;u<l.length;u++)for(var d=l[u].rules,p=0;p<d.length;p++)if(d[p].keyword==o){d.splice(p,1);break}return this}function s(o,l){s.errors=null;var u=this._validateKeyword=this._validateKeyword||this.compile(a,!0);if(u(o))return!0;if(s.errors=u.errors,l)throw new Error("custom keyword definition is invalid: "+this.errorsText(u.errors));return!1}return zs}const Jy="http://json-schema.org/draft-07/schema#",Xy="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",Yy="Meta-schema for $data reference (JSON Schema extension proposal)",e_="object",t_=["$data"],r_={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},a_=!1,n_={$schema:Jy,$id:Xy,description:Yy,type:e_,required:t_,properties:r_,additionalProperties:a_};var Us,Id;function s_(){if(Id)return Us;Id=1;var e=vy(),r=$s(),a=gy(),t=mc(),n=bc(),i=yy(),s=My(),o=zy(),l=qr();Us=f,f.prototype.validate=m,f.prototype.compile=g,f.prototype.addSchema=w,f.prototype.addMetaSchema=S,f.prototype.validateSchema=O,f.prototype.getSchema=E,f.prototype.removeSchema=T,f.prototype.addFormat=Y,f.prototype.errorsText=J,f.prototype._addSchema=A,f.prototype._compile=R,f.prototype.compileAsync=Uy();var u=Gy();f.prototype.addKeyword=u.add,f.prototype.getKeyword=u.get,f.prototype.removeKeyword=u.remove,f.prototype.validateKeyword=u.validate;var d=Rs();f.ValidationError=d.Validation,f.MissingRefError=d.MissingRef,f.$dataMetaSchema=o;var p="http://json-schema.org/draft-07/schema",h=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],v=["/properties"];function f(_){if(!(this instanceof f))return new f(_);_=this._opts=l.copy(_)||{},ue(this),this._schemas={},this._refs={},this._fragments={},this._formats=i(_.format),this._cache=_.cache||new a,this._loadingSchemas={},this._compilations=[],this.RULES=s(),this._getId=z(_),_.loopRequired=_.loopRequired||1/0,_.errorDataPath=="property"&&(_._errorDataPathProperty=!0),_.serialize===void 0&&(_.serialize=n),this._metaOpts=re(this),_.formats&&Se(this),_.keywords&&Ce(this),se(this),typeof _.meta=="object"&&this.addMetaSchema(_.meta),_.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),oe(this)}function m(_,C){var F;if(typeof _=="string"){if(F=this.getSchema(_),!F)throw new Error('no schema with key or ref "'+_+'"')}else{var W=this._addSchema(_);F=W.validate||this._compile(W)}var H=F(C);return F.$async!==!0&&(this.errors=F.errors),H}function g(_,C){var F=this._addSchema(_,void 0,C);return F.validate||this._compile(F)}function w(_,C,F,W){if(Array.isArray(_)){for(var H=0;H<_.length;H++)this.addSchema(_[H],void 0,F,W);return this}var j=this._getId(_);if(j!==void 0&&typeof j!="string")throw new Error("schema id must be string");return C=r.normalizeId(C||j),Z(this,C),this._schemas[C]=this._addSchema(_,F,W,!0),this}function S(_,C,F){return this.addSchema(_,C,F,!0),this}function O(_,C){var F=_.$schema;if(F!==void 0&&typeof F!="string")throw new Error("$schema must be a string");if(F=F||this._opts.defaultMeta||x(this),!F)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var W=this.validate(F,_);if(!W&&C){var H="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(H);else throw new Error(H)}return W}function x(_){var C=_._opts.meta;return _._opts.defaultMeta=typeof C=="object"?_._getId(C)||C:_.getSchema(p)?p:void 0,_._opts.defaultMeta}function E(_){var C=N(this,_);switch(typeof C){case"object":return C.validate||this._compile(C);case"string":return this.getSchema(C);case"undefined":return $(this,_)}}function $(_,C){var F=r.schema.call(_,{schema:{}},C);if(F){var W=F.schema,H=F.root,j=F.baseId,k=e.call(_,W,H,void 0,j);return _._fragments[C]=new t({ref:C,fragment:!0,schema:W,root:H,baseId:j,validate:k}),k}}function N(_,C){return C=r.normalizeId(C),_._schemas[C]||_._refs[C]||_._fragments[C]}function T(_){if(_ instanceof RegExp)return D(this,this._schemas,_),D(this,this._refs,_),this;switch(typeof _){case"undefined":return D(this,this._schemas),D(this,this._refs),this._cache.clear(),this;case"string":var C=N(this,_);return C&&this._cache.del(C.cacheKey),delete this._schemas[_],delete this._refs[_],this;case"object":var F=this._opts.serialize,W=F?F(_):_;this._cache.del(W);var H=this._getId(_);H&&(H=r.normalizeId(H),delete this._schemas[H],delete this._refs[H])}return this}function D(_,C,F){for(var W in C){var H=C[W];!H.meta&&(!F||F.test(W))&&(_._cache.del(H.cacheKey),delete C[W])}}function A(_,C,F,W){if(typeof _!="object"&&typeof _!="boolean")throw new Error("schema should be object or boolean");var H=this._opts.serialize,j=H?H(_):_,k=this._cache.get(j);if(k)return k;W=W||this._opts.addUsedSchema!==!1;var V=r.normalizeId(this._getId(_));V&&W&&Z(this,V);var G=this._opts.validateSchema!==!1&&!C,we;G&&!(we=V&&V==r.normalizeId(_.$schema))&&this.validateSchema(_,!0);var ce=r.ids.call(this,_),me=new t({id:V,schema:_,localRefs:ce,cacheKey:j,meta:F});return V[0]!="#"&&W&&(this._refs[V]=me),this._cache.put(j,me),G&&we&&this.validateSchema(_,!0),me}function R(_,C){if(_.compiling)return _.validate=H,H.schema=_.schema,H.errors=null,H.root=C||H,_.schema.$async===!0&&(H.$async=!0),H;_.compiling=!0;var F;_.meta&&(F=this._opts,this._opts=this._metaOpts);var W;try{W=e.call(this,_.schema,C,_.localRefs)}catch(j){throw delete _.validate,j}finally{_.compiling=!1,_.meta&&(this._opts=F)}return _.validate=W,_.refs=W.refs,_.refVal=W.refVal,_.root=W.root,W;function H(){var j=_.validate,k=j.apply(this,arguments);return H.errors=j.errors,k}}function z(_){switch(_.schemaId){case"auto":return q;case"id":return U;default:return M}}function U(_){return _.$id&&this.logger.warn("schema $id ignored",_.$id),_.id}function M(_){return _.id&&this.logger.warn("schema id ignored",_.id),_.$id}function q(_){if(_.$id&&_.id&&_.$id!=_.id)throw new Error("schema $id is different from id");return _.$id||_.id}function J(_,C){if(_=_||this.errors,!_)return"No errors";C=C||{};for(var F=C.separator===void 0?", ":C.separator,W=C.dataVar===void 0?"data":C.dataVar,H="",j=0;j<_.length;j++){var k=_[j];k&&(H+=W+k.dataPath+" "+k.message+F)}return H.slice(0,-F.length)}function Y(_,C){return typeof C=="string"&&(C=new RegExp(C)),this._formats[_]=C,this}function se(_){var C;if(_._opts.$data&&(C=n_,_.addMetaSchema(C,C.$id,!0)),_._opts.meta!==!1){var F=$d;_._opts.$data&&(F=o(F,v)),_.addMetaSchema(F,p,!0),_._refs["http://json-schema.org/schema"]=p}}function oe(_){var C=_._opts.schemas;if(C)if(Array.isArray(C))_.addSchema(C);else for(var F in C)_.addSchema(C[F],F)}function Se(_){for(var C in _._opts.formats){var F=_._opts.formats[C];_.addFormat(C,F)}}function Ce(_){for(var C in _._opts.keywords){var F=_._opts.keywords[C];_.addKeyword(C,F)}}function Z(_,C){if(_._schemas[C]||_._refs[C])throw new Error('schema with key or id "'+C+'" already exists')}function re(_){for(var C=l.copy(_._opts),F=0;F<h.length;F++)delete C[h[F]];return C}function ue(_){var C=_._opts.logger;if(C===!1)_.logger={log:ee,warn:ee,error:ee};else{if(C===void 0&&(C=console),!(typeof C=="object"&&C.log&&C.warn&&C.error))throw new Error("logger must implement log, warn and error methods");_.logger=C}}function ee(){}return Us}var i_=s_();const o_=lo(i_);class Hs extends dy{constructor(r,a){var t;super(a),this._clientInfo=r,this._cachedToolOutputValidators=new Map,this._capabilities=(t=a==null?void 0:a.capabilities)!==null&&t!==void 0?t:{},this._ajv=new o_}registerCapabilities(r){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=uy(this._capabilities,r)}assertCapability(r,a){var t;if(!(!((t=this._serverCapabilities)===null||t===void 0)&&t[r]))throw new Error(`Server does not support ${r} (required for ${a})`)}async connect(r,a){if(await super.connect(r),r.sessionId===void 0)try{const t=await this.request({method:"initialize",params:{protocolVersion:on,capabilities:this._capabilities,clientInfo:this._clientInfo}},Kl,a);if(t===void 0)throw new Error(`Server sent invalid initialize result: ${t}`);if(!hg.includes(t.protocolVersion))throw new Error(`Server's protocol version is not supported: ${t.protocolVersion}`);this._serverCapabilities=t.capabilities,this._serverVersion=t.serverInfo,r.setProtocolVersion&&r.setProtocolVersion(t.protocolVersion),this._instructions=t.instructions,await this.notification({method:"notifications/initialized"})}catch(t){throw this.close(),t}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(r){var a,t,n,i,s;switch(r){case"logging/setLevel":if(!(!((a=this._serverCapabilities)===null||a===void 0)&&a.logging))throw new Error(`Server does not support logging (required for ${r})`);break;case"prompts/get":case"prompts/list":if(!(!((t=this._serverCapabilities)===null||t===void 0)&&t.prompts))throw new Error(`Server does not support prompts (required for ${r})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(!((n=this._serverCapabilities)===null||n===void 0)&&n.resources))throw new Error(`Server does not support resources (required for ${r})`);if(r==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${r})`);break;case"tools/call":case"tools/list":if(!(!((i=this._serverCapabilities)===null||i===void 0)&&i.tools))throw new Error(`Server does not support tools (required for ${r})`);break;case"completion/complete":if(!(!((s=this._serverCapabilities)===null||s===void 0)&&s.completions))throw new Error(`Server does not support completions (required for ${r})`);break}}assertNotificationCapability(r){var a;switch(r){case"notifications/roots/list_changed":if(!(!((a=this._capabilities.roots)===null||a===void 0)&&a.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${r})`);break}}assertRequestHandlerCapability(r){switch(r){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${r})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${r})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${r})`);break}}async ping(r){return this.request({method:"ping"},Vr,r)}async complete(r,a){return this.request({method:"completion/complete",params:r},lc,a)}async setLoggingLevel(r,a){return this.request({method:"logging/setLevel",params:{level:r}},Vr,a)}async getPrompt(r,a){return this.request({method:"prompts/get",params:r},sc,a)}async listPrompts(r,a){return this.request({method:"prompts/list",params:r},ac,a)}async listResources(r,a){return this.request({method:"resources/list",params:r},ec,a)}async listResourceTemplates(r,a){return this.request({method:"resources/templates/list",params:r},tc,a)}async readResource(r,a){return this.request({method:"resources/read",params:r},rc,a)}async subscribeResource(r,a){return this.request({method:"resources/subscribe",params:r},Vr,a)}async unsubscribeResource(r,a){return this.request({method:"resources/unsubscribe",params:r},Vr,a)}async callTool(r,a=hn,t){const n=await this.request({method:"tools/call",params:r},a,t),i=this.getToolOutputValidator(r.name);if(i){if(!n.structuredContent&&!n.isError)throw new gr(Qt.InvalidRequest,`Tool ${r.name} has an output schema but did not return structured content`);if(n.structuredContent)try{if(!i(n.structuredContent))throw new gr(Qt.InvalidParams,`Structured content does not match the tool's output schema: ${this._ajv.errorsText(i.errors)}`)}catch(s){throw s instanceof gr?s:new gr(Qt.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return n}cacheToolOutputSchemas(r){this._cachedToolOutputValidators.clear();for(const a of r)if(a.outputSchema)try{const t=this._ajv.compile(a.outputSchema);this._cachedToolOutputValidators.set(a.name,t)}catch{}}getToolOutputValidator(r){return this._cachedToolOutputValidators.get(r)}async listTools(r,a){const t=await this.request({method:"tools/list",params:r},ic,a);return this.cacheToolOutputSchemas(t.tools),t}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}var $r={exports:{}},Vs,Td;function l_(){if(Td)return Vs;Td=1;var e={};Vs=n,n.sync=i;var r=fr;function a(s,o){var l=o.pathExt!==void 0?o.pathExt:e.PATHEXT;if(!l||(l=l.split(";"),l.indexOf("")!==-1))return!0;for(var u=0;u<l.length;u++){var d=l[u].toLowerCase();if(d&&s.substr(-d.length).toLowerCase()===d)return!0}return!1}function t(s,o,l){return!s.isSymbolicLink()&&!s.isFile()?!1:a(o,l)}function n(s,o,l){r.stat(s,function(u,d){l(u,u?!1:t(d,s,o))})}function i(s,o){return t(r.statSync(s),s,o)}return Vs}var qs,Ad;function c_(){if(Ad)return qs;Ad=1,qs=r,r.sync=a;var e=fr;function r(i,s,o){e.stat(i,function(l,u){o(l,l?!1:t(u,s))})}function a(i,s){return t(e.statSync(i),s)}function t(i,s){return i.isFile()&&n(i,s)}function n(i,s){var o=i.mode,l=i.uid,u=i.gid,d=s.uid!==void 0?s.uid:Ne.getuid&&Ne.getuid(),p=s.gid!==void 0?s.gid:Ne.getgid&&Ne.getgid(),h=parseInt("100",8),v=parseInt("010",8),f=parseInt("001",8),m=h|v,g=o&f||o&v&&u===p||o&h&&l===d||o&m&&d===0;return g}return qs}var Zs,Ld;function d_(){if(Ld)return Zs;Ld=1;var e;Ne.platform==="win32"||Mr.TESTING_WINDOWS?e=l_():e=c_(),Zs=r,r.sync=a;function r(t,n,i){if(typeof n=="function"&&(i=n,n={}),!i){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,o){r(t,n||{},function(l,u){l?o(l):s(u)})})}e(t,n||{},function(s,o){s&&(s.code==="EACCES"||n&&n.ignoreErrors)&&(s=null,o=!1),i(s,o)})}function a(t,n){try{return e.sync(t,n||{})}catch(i){if(n&&n.ignoreErrors||i.code==="EACCES")return!1;throw i}}return Zs}var Bs,Fd;function u_(){if(Fd)return Bs;Fd=1;var e={};const r=Ne.platform==="win32"||e.OSTYPE==="cygwin"||e.OSTYPE==="msys",a=fr,t=r?";":":",n=d_(),i=u=>Object.assign(new Error(`not found: ${u}`),{code:"ENOENT"}),s=(u,d)=>{const p=d.colon||t,h=u.match(/\//)||r&&u.match(/\\/)?[""]:[...r?[Ne.cwd()]:[],...(d.path||e.PATH||"").split(p)],v=r?d.pathExt||e.PATHEXT||".EXE;.CMD;.BAT;.COM":"",f=r?v.split(p):[""];return r&&u.indexOf(".")!==-1&&f[0]!==""&&f.unshift(""),{pathEnv:h,pathExt:f,pathExtExe:v}},o=(u,d,p)=>{typeof d=="function"&&(p=d,d={}),d||(d={});const{pathEnv:h,pathExt:v,pathExtExe:f}=s(u,d),m=[],g=S=>new Promise((O,x)=>{if(S===h.length)return d.all&&m.length?O(m):x(i(u));const E=h[S],$=/^".*"$/.test(E)?E.slice(1,-1):E,N=a.join($,u),T=!$&&/^\.[\\\/]/.test(u)?u.slice(0,2)+N:N;O(w(T,S,0))}),w=(S,O,x)=>new Promise((E,$)=>{if(x===v.length)return E(g(O+1));const N=v[x];n(S+N,{pathExt:f},(T,D)=>{if(!T&&D)if(d.all)m.push(S+N);else return E(S+N);return E(w(S,O,x+1))})});return p?g(0).then(S=>p(null,S),p):g(0)},l=(u,d)=>{d=d||{};const{pathEnv:p,pathExt:h,pathExtExe:v}=s(u,d),f=[];for(let m=0;m<p.length;m++){const g=p[m],w=/^".*"$/.test(g)?g.slice(1,-1):g,S=a.join(w,u),O=!w&&/^\.[\\\/]/.test(u)?u.slice(0,2)+S:S;for(let x=0;x<h.length;x++){const E=O+h[x];try{if(n.sync(E,{pathExt:v}))if(d.all)f.push(E);else return E}catch{}}}if(d.all&&f.length)return f;if(d.nothrow)return null;throw i(u)};return Bs=o,o.sync=l,Bs}var mn={exports:{}},Dd;function h_(){if(Dd)return mn.exports;Dd=1;var e={};const r=(a={})=>{const t=a.env||e;return(a.platform||Ne.platform)!=="win32"?"PATH":Object.keys(t).reverse().find(n=>n.toUpperCase()==="PATH")||"Path"};return mn.exports=r,mn.exports.default=r,mn.exports}var Ws,Md;function p_(){if(Md)return Ws;Md=1;var e={};const r=fr,a=u_(),t=h_();function n(s,o){const l=s.options.env||e,u=Ne.cwd(),d=s.options.cwd!=null,p=d&&Ne.chdir!==void 0&&!Ne.chdir.disabled;if(p)try{Ne.chdir(s.options.cwd)}catch{}let h;try{h=a.sync(s.command,{path:l[t({env:l})],pathExt:o?r.delimiter:void 0})}catch{}finally{p&&Ne.chdir(u)}return h&&(h=r.resolve(d?s.options.cwd:"",h)),h}function i(s){return n(s)||n(s,!0)}return Ws=i,Ws}var fn={},zd;function m_(){if(zd)return fn;zd=1;const e=/([()\][%!^"`<>&|;, *?])/g;function r(t){return t=t.replace(e,"^$1"),t}function a(t,n){return t=`${t}`,t=t.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),t=t.replace(/(?=(\\+?)?)\1$/,"$1$1"),t=`"${t}"`,t=t.replace(e,"^$1"),n&&(t=t.replace(e,"^$1")),t}return fn.command=r,fn.argument=a,fn}var Ud,Hd;function f_(){return Hd||(Hd=1,Ud=/^#!(.*)/),Ud}var Ks,Vd;function v_(){if(Vd)return Ks;Vd=1;const e=f_();return Ks=(r="")=>{const a=r.match(e);if(!a)return null;const[t,n]=a[0].replace(/#! ?/,"").split(" "),i=t.split("/").pop();return i==="env"?n:n?`${i} ${n}`:i},Ks}var Qs,qd;function g_(){if(qd)return Qs;qd=1;const e=fr,r=v_();function a(t){const n=Dh.alloc(150);let i;try{i=e.openSync(t,"r"),e.readSync(i,n,0,150,0),e.closeSync(i)}catch{}return r(n.toString())}return Qs=a,Qs}var Gs,Zd;function y_(){if(Zd)return Gs;Zd=1;var e={};const r=fr,a=p_(),t=m_(),n=g_(),i=Ne.platform==="win32",s=/\.(?:com|exe)$/i,o=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function l(p){p.file=a(p);const h=p.file&&n(p.file);return h?(p.args.unshift(p.file),p.command=h,a(p)):p.file}function u(p){if(!i)return p;const h=l(p),v=!s.test(h);if(p.options.forceShell||v){const f=o.test(h);p.command=r.normalize(p.command),p.command=t.command(p.command),p.args=p.args.map(g=>t.argument(g,f));const m=[p.command].concat(p.args).join(" ");p.args=["/d","/s","/c",`"${m}"`],p.command=e.comspec||"cmd.exe",p.options.windowsVerbatimArguments=!0}return p}function d(p,h,v){h&&!Array.isArray(h)&&(v=h,h=null),h=h?h.slice(0):[],v=Object.assign({},v);const f={command:p,args:h,options:v,file:void 0,original:{command:p,args:h}};return v.shell?f:u(f)}return Gs=d,Gs}var Js,Bd;function __(){if(Bd)return Js;Bd=1;const e=Ne.platform==="win32";function r(i,s){return Object.assign(new Error(`${s} ${i.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${s} ${i.command}`,path:i.command,spawnargs:i.args})}function a(i,s){if(!e)return;const o=i.emit;i.emit=function(l,u){if(l==="exit"){const d=t(u,s);if(d)return o.call(i,"error",d)}return o.apply(i,arguments)}}function t(i,s){return e&&i===1&&!s.file?r(s.original,"spawn"):null}function n(i,s){return e&&i===1&&!s.file?r(s.original,"spawnSync"):null}return Js={hookChildProcess:a,verifyENOENT:t,verifyENOENTSync:n,notFoundError:r},Js}var Wd;function b_(){if(Wd)return $r.exports;Wd=1;const e=fr,r=y_(),a=__();function t(i,s,o){const l=r(i,s,o),u=e.spawn(l.command,l.args,l.options);return a.hookChildProcess(u,l),u}function n(i,s,o){const l=r(i,s,o),u=e.spawnSync(l.command,l.args,l.options);return u.error=u.error||a.verifyENOENTSync(u.status,l),u}return $r.exports=t,$r.exports.spawn=t,$r.exports.sync=n,$r.exports._parse=r,$r.exports._enoent=a,$r.exports}var w_=b_();const x_=lo(w_);var Kd,Qd;function Gd(){return Qd||(Qd=1,Kd=co().EventEmitter),Kd}var Xs,Jd;function j_(){if(Jd)return Xs;Jd=1;function e(f,m){var g=Object.keys(f);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(f);m&&(w=w.filter(function(S){return Object.getOwnPropertyDescriptor(f,S).enumerable})),g.push.apply(g,w)}return g}function r(f){for(var m=1;m<arguments.length;m++){var g=arguments[m]!=null?arguments[m]:{};m%2?e(Object(g),!0).forEach(function(w){a(f,w,g[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(g)):e(Object(g)).forEach(function(w){Object.defineProperty(f,w,Object.getOwnPropertyDescriptor(g,w))})}return f}function a(f,m,g){return m=s(m),m in f?Object.defineProperty(f,m,{value:g,enumerable:!0,configurable:!0,writable:!0}):f[m]=g,f}function t(f,m){if(!(f instanceof m))throw new TypeError("Cannot call a class as a function")}function n(f,m){for(var g=0;g<m.length;g++){var w=m[g];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,s(w.key),w)}}function i(f,m,g){return m&&n(f.prototype,m),Object.defineProperty(f,"prototype",{writable:!1}),f}function s(f){var m=o(f,"string");return typeof m=="symbol"?m:String(m)}function o(f,m){if(typeof f!="object"||f===null)return f;var g=f[Symbol.toPrimitive];if(g!==void 0){var w=g.call(f,m);if(typeof w!="object")return w;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}var l=uo(),u=l.Buffer,d=fr,p=d.inspect,h=p&&p.custom||"inspect";function v(f,m,g){u.prototype.copy.call(f,m,g)}return Xs=function(){function f(){t(this,f),this.head=null,this.tail=null,this.length=0}return i(f,[{key:"push",value:function(m){var g={data:m,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}},{key:"unshift",value:function(m){var g={data:m,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var g=this.head,w=""+g.data;g=g.next;)w+=m+g.data;return w}},{key:"concat",value:function(m){if(this.length===0)return u.alloc(0);for(var g=u.allocUnsafe(m>>>0),w=this.head,S=0;w;)v(w.data,g,S),S+=w.data.length,w=w.next;return g}},{key:"consume",value:function(m,g){var w;return m<this.head.data.length?(w=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):m===this.head.data.length?w=this.shift():w=g?this._getString(m):this._getBuffer(m),w}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var g=this.head,w=1,S=g.data;for(m-=S.length;g=g.next;){var O=g.data,x=m>O.length?O.length:m;if(x===O.length?S+=O:S+=O.slice(0,m),m-=x,m===0){x===O.length?(++w,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=O.slice(x));break}++w}return this.length-=w,S}},{key:"_getBuffer",value:function(m){var g=u.allocUnsafe(m),w=this.head,S=1;for(w.data.copy(g),m-=w.data.length;w=w.next;){var O=w.data,x=m>O.length?O.length:m;if(O.copy(g,g.length-m,0,x),m-=x,m===0){x===O.length?(++S,w.next?this.head=w.next:this.head=this.tail=null):(this.head=w,w.data=O.slice(x));break}++S}return this.length-=S,g}},{key:h,value:function(m,g){return p(this,r(r({},g),{},{depth:0,customInspect:!1}))}}]),f}(),Xs}var Ys,Xd;function Yd(){if(Xd)return Ys;Xd=1;function e(s,o){var l=this,u=this._readableState&&this._readableState.destroyed,d=this._writableState&&this._writableState.destroyed;return u||d?(o?o(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Ne.nextTick(n,this,s)):Ne.nextTick(n,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(p){!o&&p?l._writableState?l._writableState.errorEmitted?Ne.nextTick(a,l):(l._writableState.errorEmitted=!0,Ne.nextTick(r,l,p)):Ne.nextTick(r,l,p):o?(Ne.nextTick(a,l),o(p)):Ne.nextTick(a,l)}),this)}function r(s,o){n(s,o),a(s)}function a(s){s._writableState&&!s._writableState.emitClose||s._readableState&&!s._readableState.emitClose||s.emit("close")}function t(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function n(s,o){s.emit("error",o)}function i(s,o){var l=s._readableState,u=s._writableState;l&&l.autoDestroy||u&&u.autoDestroy?s.destroy(o):s.emit("error",o)}return Ys={destroy:e,undestroy:t,errorOrDestroy:i},Ys}var ei={},eu;function Zr(){if(eu)return ei;eu=1;function e(o,l){o.prototype=Object.create(l.prototype),o.prototype.constructor=o,o.__proto__=l}var r={};function a(o,l,u){u||(u=Error);function d(h,v,f){return typeof l=="string"?l:l(h,v,f)}var p=function(h){e(v,h);function v(f,m,g){return h.call(this,d(f,m,g))||this}return v}(u);p.prototype.name=u.name,p.prototype.code=o,r[o]=p}function t(o,l){if(Array.isArray(o)){var u=o.length;return o=o.map(function(d){return String(d)}),u>2?"one of ".concat(l," ").concat(o.slice(0,u-1).join(", "),", or ")+o[u-1]:u===2?"one of ".concat(l," ").concat(o[0]," or ").concat(o[1]):"of ".concat(l," ").concat(o[0])}else return"of ".concat(l," ").concat(String(o))}function n(o,l,u){return o.substr(0,l.length)===l}function i(o,l,u){return(u===void 0||u>o.length)&&(u=o.length),o.substring(u-l.length,u)===l}function s(o,l,u){return typeof u!="number"&&(u=0),u+l.length>o.length?!1:o.indexOf(l,u)!==-1}return a("ERR_INVALID_OPT_VALUE",function(o,l){return'The value "'+l+'" is invalid for option "'+o+'"'},TypeError),a("ERR_INVALID_ARG_TYPE",function(o,l,u){var d;typeof l=="string"&&n(l,"not ")?(d="must not be",l=l.replace(/^not /,"")):d="must be";var p;if(i(o," argument"))p="The ".concat(o," ").concat(d," ").concat(t(l,"type"));else{var h=s(o,".")?"property":"argument";p='The "'.concat(o,'" ').concat(h," ").concat(d," ").concat(t(l,"type"))}return p+=". Received type ".concat(typeof u),p},TypeError),a("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),a("ERR_METHOD_NOT_IMPLEMENTED",function(o){return"The "+o+" method is not implemented"}),a("ERR_STREAM_PREMATURE_CLOSE","Premature close"),a("ERR_STREAM_DESTROYED",function(o){return"Cannot call "+o+" after a stream was destroyed"}),a("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),a("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),a("ERR_STREAM_WRITE_AFTER_END","write after end"),a("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),a("ERR_UNKNOWN_ENCODING",function(o){return"Unknown encoding: "+o},TypeError),a("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),ei.codes=r,ei}var ti,tu;function ru(){if(tu)return ti;tu=1;var e=Zr().codes.ERR_INVALID_OPT_VALUE;function r(t,n,i){return t.highWaterMark!=null?t.highWaterMark:n?t[i]:null}function a(t,n,i,s){var o=r(n,s,i);if(o!=null){if(!(isFinite(o)&&Math.floor(o)===o)||o<0){var l=s?i:"highWaterMark";throw new e(l,o)}return Math.floor(o)}return t.objectMode?16:16*1024}return ti={getHighWaterMark:a},ti}var ri,au;function E_(){if(au)return ri;au=1,ri=e;function e(a,t){if(r("noDeprecation"))return a;var n=!1;function i(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return a.apply(this,arguments)}return i}function r(a){try{if(!Mr.localStorage)return!1}catch{return!1}var t=Mr.localStorage[a];return t==null?!1:String(t).toLowerCase()==="true"}return ri}var ai,nu;function su(){if(nu)return ai;nu=1,ai=T;function e(_){var C=this;this.next=null,this.entry=null,this.finish=function(){ee(C,_)}}var r;T.WritableState=$;var a={deprecate:E_()},t=Gd(),n=uo().Buffer,i=(typeof Mr<"u"?Mr:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(_){return n.from(_)}function o(_){return n.isBuffer(_)||_ instanceof i}var l=Yd(),u=ru(),d=u.getHighWaterMark,p=Zr().codes,h=p.ERR_INVALID_ARG_TYPE,v=p.ERR_METHOD_NOT_IMPLEMENTED,f=p.ERR_MULTIPLE_CALLBACK,m=p.ERR_STREAM_CANNOT_PIPE,g=p.ERR_STREAM_DESTROYED,w=p.ERR_STREAM_NULL_VALUES,S=p.ERR_STREAM_WRITE_AFTER_END,O=p.ERR_UNKNOWN_ENCODING,x=l.errorOrDestroy;va()(T,t);function E(){}function $(_,C,F){r=r||Br(),_=_||{},typeof F!="boolean"&&(F=C instanceof r),this.objectMode=!!_.objectMode,F&&(this.objectMode=this.objectMode||!!_.writableObjectMode),this.highWaterMark=d(this,_,"writableHighWaterMark",F),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var W=_.decodeStrings===!1;this.decodeStrings=!W,this.defaultEncoding=_.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(H){J(C,H)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=_.emitClose!==!1,this.autoDestroy=!!_.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}$.prototype.getBuffer=function(){for(var _=this.bufferedRequest,C=[];_;)C.push(_),_=_.next;return C},function(){try{Object.defineProperty($.prototype,"buffer",{get:a.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var N;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(N=Function.prototype[Symbol.hasInstance],Object.defineProperty(T,Symbol.hasInstance,{value:function(_){return N.call(this,_)?!0:this!==T?!1:_&&_._writableState instanceof $}})):N=function(_){return _ instanceof this};function T(_){r=r||Br();var C=this instanceof r;if(!C&&!N.call(T,this))return new T(_);this._writableState=new $(_,this,C),this.writable=!0,_&&(typeof _.write=="function"&&(this._write=_.write),typeof _.writev=="function"&&(this._writev=_.writev),typeof _.destroy=="function"&&(this._destroy=_.destroy),typeof _.final=="function"&&(this._final=_.final)),t.call(this)}T.prototype.pipe=function(){x(this,new m)};function D(_,C){var F=new S;x(_,F),Ne.nextTick(C,F)}function A(_,C,F,W){var H;return F===null?H=new w:typeof F!="string"&&!C.objectMode&&(H=new h("chunk",["string","Buffer"],F)),H?(x(_,H),Ne.nextTick(W,H),!1):!0}T.prototype.write=function(_,C,F){var W=this._writableState,H=!1,j=!W.objectMode&&o(_);return j&&!n.isBuffer(_)&&(_=s(_)),typeof C=="function"&&(F=C,C=null),j?C="buffer":C||(C=W.defaultEncoding),typeof F!="function"&&(F=E),W.ending?D(this,F):(j||A(this,W,_,F))&&(W.pendingcb++,H=z(this,W,j,_,C,F)),H},T.prototype.cork=function(){this._writableState.corked++},T.prototype.uncork=function(){var _=this._writableState;_.corked&&(_.corked--,!_.writing&&!_.corked&&!_.bufferProcessing&&_.bufferedRequest&&oe(this,_))},T.prototype.setDefaultEncoding=function(_){if(typeof _=="string"&&(_=_.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((_+"").toLowerCase())>-1))throw new O(_);return this._writableState.defaultEncoding=_,this},Object.defineProperty(T.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function R(_,C,F){return!_.objectMode&&_.decodeStrings!==!1&&typeof C=="string"&&(C=n.from(C,F)),C}Object.defineProperty(T.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function z(_,C,F,W,H,j){if(!F){var k=R(C,W,H);W!==k&&(F=!0,H="buffer",W=k)}var V=C.objectMode?1:W.length;C.length+=V;var G=C.length<C.highWaterMark;if(G||(C.needDrain=!0),C.writing||C.corked){var we=C.lastBufferedRequest;C.lastBufferedRequest={chunk:W,encoding:H,isBuf:F,callback:j,next:null},we?we.next=C.lastBufferedRequest:C.bufferedRequest=C.lastBufferedRequest,C.bufferedRequestCount+=1}else U(_,C,!1,V,W,H,j);return G}function U(_,C,F,W,H,j,k){C.writelen=W,C.writecb=k,C.writing=!0,C.sync=!0,C.destroyed?C.onwrite(new g("write")):F?_._writev(H,C.onwrite):_._write(H,j,C.onwrite),C.sync=!1}function M(_,C,F,W,H){--C.pendingcb,F?(Ne.nextTick(H,W),Ne.nextTick(re,_,C),_._writableState.errorEmitted=!0,x(_,W)):(H(W),_._writableState.errorEmitted=!0,x(_,W),re(_,C))}function q(_){_.writing=!1,_.writecb=null,_.length-=_.writelen,_.writelen=0}function J(_,C){var F=_._writableState,W=F.sync,H=F.writecb;if(typeof H!="function")throw new f;if(q(F),C)M(_,F,W,C,H);else{var j=Se(F)||_.destroyed;!j&&!F.corked&&!F.bufferProcessing&&F.bufferedRequest&&oe(_,F),W?Ne.nextTick(Y,_,F,j,H):Y(_,F,j,H)}}function Y(_,C,F,W){F||se(_,C),C.pendingcb--,W(),re(_,C)}function se(_,C){C.length===0&&C.needDrain&&(C.needDrain=!1,_.emit("drain"))}function oe(_,C){C.bufferProcessing=!0;var F=C.bufferedRequest;if(_._writev&&F&&F.next){var W=C.bufferedRequestCount,H=new Array(W),j=C.corkedRequestsFree;j.entry=F;for(var k=0,V=!0;F;)H[k]=F,F.isBuf||(V=!1),F=F.next,k+=1;H.allBuffers=V,U(_,C,!0,C.length,H,"",j.finish),C.pendingcb++,C.lastBufferedRequest=null,j.next?(C.corkedRequestsFree=j.next,j.next=null):C.corkedRequestsFree=new e(C),C.bufferedRequestCount=0}else{for(;F;){var G=F.chunk,we=F.encoding,ce=F.callback,me=C.objectMode?1:G.length;if(U(_,C,!1,me,G,we,ce),F=F.next,C.bufferedRequestCount--,C.writing)break}F===null&&(C.lastBufferedRequest=null)}C.bufferedRequest=F,C.bufferProcessing=!1}T.prototype._write=function(_,C,F){F(new v("_write()"))},T.prototype._writev=null,T.prototype.end=function(_,C,F){var W=this._writableState;return typeof _=="function"?(F=_,_=null,C=null):typeof C=="function"&&(F=C,C=null),_!=null&&this.write(_,C),W.corked&&(W.corked=1,this.uncork()),W.ending||ue(this,W,F),this},Object.defineProperty(T.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Se(_){return _.ending&&_.length===0&&_.bufferedRequest===null&&!_.finished&&!_.writing}function Ce(_,C){_._final(function(F){C.pendingcb--,F&&x(_,F),C.prefinished=!0,_.emit("prefinish"),re(_,C)})}function Z(_,C){!C.prefinished&&!C.finalCalled&&(typeof _._final=="function"&&!C.destroyed?(C.pendingcb++,C.finalCalled=!0,Ne.nextTick(Ce,_,C)):(C.prefinished=!0,_.emit("prefinish")))}function re(_,C){var F=Se(C);if(F&&(Z(_,C),C.pendingcb===0&&(C.finished=!0,_.emit("finish"),C.autoDestroy))){var W=_._readableState;(!W||W.autoDestroy&&W.endEmitted)&&_.destroy()}return F}function ue(_,C,F){C.ending=!0,re(_,C),F&&(C.finished?Ne.nextTick(F):_.once("finish",F)),C.ended=!0,_.writable=!1}function ee(_,C,F){var W=_.entry;for(_.entry=null;W;){var H=W.callback;C.pendingcb--,H(F),W=W.next}C.corkedRequestsFree.next=_}return Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(_){this._writableState&&(this._writableState.destroyed=_)}}),T.prototype.destroy=l.destroy,T.prototype._undestroy=l.undestroy,T.prototype._destroy=function(_,C){C(_)},ai}var ni,iu;function Br(){if(iu)return ni;iu=1;var e=Object.keys||function(u){var d=[];for(var p in u)d.push(p);return d};ni=s;var r=hu(),a=su();va()(s,r);for(var t=e(a.prototype),n=0;n<t.length;n++){var i=t[n];s.prototype[i]||(s.prototype[i]=a.prototype[i])}function s(u){if(!(this instanceof s))return new s(u);r.call(this,u),a.call(this,u),this.allowHalfOpen=!0,u&&(u.readable===!1&&(this.readable=!1),u.writable===!1&&(this.writable=!1),u.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",o)))}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o(){this._writableState.ended||Ne.nextTick(l,this)}function l(u){u.end()}return Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(u){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=u,this._writableState.destroyed=u)}}),ni}var si,ou;function ii(){if(ou)return si;ou=1;var e=Zr().codes.ERR_STREAM_PREMATURE_CLOSE;function r(i){var s=!1;return function(){if(!s){s=!0;for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];i.apply(this,l)}}}function a(){}function t(i){return i.setHeader&&typeof i.abort=="function"}function n(i,s,o){if(typeof s=="function")return n(i,null,s);s||(s={}),o=r(o||a);var l=s.readable||s.readable!==!1&&i.readable,u=s.writable||s.writable!==!1&&i.writable,d=function(){i.writable||h()},p=i._writableState&&i._writableState.finished,h=function(){u=!1,p=!0,l||o.call(i)},v=i._readableState&&i._readableState.endEmitted,f=function(){l=!1,v=!0,u||o.call(i)},m=function(S){o.call(i,S)},g=function(){var S;if(l&&!v)return(!i._readableState||!i._readableState.ended)&&(S=new e),o.call(i,S);if(u&&!p)return(!i._writableState||!i._writableState.ended)&&(S=new e),o.call(i,S)},w=function(){i.req.on("finish",h)};return t(i)?(i.on("complete",h),i.on("abort",g),i.req?w():i.on("request",w)):u&&!i._writableState&&(i.on("end",d),i.on("close",d)),i.on("end",f),i.on("finish",h),s.error!==!1&&i.on("error",m),i.on("close",g),function(){i.removeListener("complete",h),i.removeListener("abort",g),i.removeListener("request",w),i.req&&i.req.removeListener("finish",h),i.removeListener("end",d),i.removeListener("close",d),i.removeListener("finish",h),i.removeListener("end",f),i.removeListener("error",m),i.removeListener("close",g)}}return si=n,si}var oi,lu;function S_(){if(lu)return oi;lu=1;var e;function r(O,x,E){return x=a(x),x in O?Object.defineProperty(O,x,{value:E,enumerable:!0,configurable:!0,writable:!0}):O[x]=E,O}function a(O){var x=t(O,"string");return typeof x=="symbol"?x:String(x)}function t(O,x){if(typeof O!="object"||O===null)return O;var E=O[Symbol.toPrimitive];if(E!==void 0){var $=E.call(O,x);if(typeof $!="object")return $;throw new TypeError("@@toPrimitive must return a primitive value.")}return(x==="string"?String:Number)(O)}var n=ii(),i=Symbol("lastResolve"),s=Symbol("lastReject"),o=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(O,x){return{value:O,done:x}}function v(O){var x=O[i];if(x!==null){var E=O[p].read();E!==null&&(O[u]=null,O[i]=null,O[s]=null,x(h(E,!1)))}}function f(O){Ne.nextTick(v,O)}function m(O,x){return function(E,$){O.then(function(){if(x[l]){E(h(void 0,!0));return}x[d](E,$)},$)}}var g=Object.getPrototypeOf(function(){}),w=Object.setPrototypeOf((e={get stream(){return this[p]},next:function(){var O=this,x=this[o];if(x!==null)return Promise.reject(x);if(this[l])return Promise.resolve(h(void 0,!0));if(this[p].destroyed)return new Promise(function(T,D){Ne.nextTick(function(){O[o]?D(O[o]):T(h(void 0,!0))})});var E=this[u],$;if(E)$=new Promise(m(E,this));else{var N=this[p].read();if(N!==null)return Promise.resolve(h(N,!1));$=new Promise(this[d])}return this[u]=$,$}},r(e,Symbol.asyncIterator,function(){return this}),r(e,"return",function(){var O=this;return new Promise(function(x,E){O[p].destroy(null,function($){if($){E($);return}x(h(void 0,!0))})})}),e),g),S=function(O){var x,E=Object.create(w,(x={},r(x,p,{value:O,writable:!0}),r(x,i,{value:null,writable:!0}),r(x,s,{value:null,writable:!0}),r(x,o,{value:null,writable:!0}),r(x,l,{value:O._readableState.endEmitted,writable:!0}),r(x,d,{value:function($,N){var T=E[p].read();T?(E[u]=null,E[i]=null,E[s]=null,$(h(T,!1))):(E[i]=$,E[s]=N)},writable:!0}),x));return E[u]=null,n(O,function($){if($&&$.code!=="ERR_STREAM_PREMATURE_CLOSE"){var N=E[s];N!==null&&(E[u]=null,E[i]=null,E[s]=null,N($)),E[o]=$;return}var T=E[i];T!==null&&(E[u]=null,E[i]=null,E[s]=null,T(h(void 0,!0))),E[l]=!0}),O.on("readable",f.bind(null,E)),E};return oi=S,oi}var cu,du;function k_(){return du||(du=1,cu=function(){throw new Error("Readable.from is not available in the browser")}),cu}var li,uu;function hu(){if(uu)return li;uu=1,li=D;var e;D.ReadableState=T,co().EventEmitter;var r=function(j,k){return j.listeners(k).length},a=Gd(),t=uo().Buffer,n=(typeof Mr<"u"?Mr:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function i(j){return t.from(j)}function s(j){return t.isBuffer(j)||j instanceof n}var o=fr,l;o&&o.debuglog?l=o.debuglog("stream"):l=function(){};var u=j_(),d=Yd(),p=ru(),h=p.getHighWaterMark,v=Zr().codes,f=v.ERR_INVALID_ARG_TYPE,m=v.ERR_STREAM_PUSH_AFTER_EOF,g=v.ERR_METHOD_NOT_IMPLEMENTED,w=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,S,O,x;va()(D,a);var E=d.errorOrDestroy,$=["error","close","destroy","pause","resume"];function N(j,k,V){if(typeof j.prependListener=="function")return j.prependListener(k,V);!j._events||!j._events[k]?j.on(k,V):Array.isArray(j._events[k])?j._events[k].unshift(V):j._events[k]=[V,j._events[k]]}function T(j,k,V){e=e||Br(),j=j||{},typeof V!="boolean"&&(V=k instanceof e),this.objectMode=!!j.objectMode,V&&(this.objectMode=this.objectMode||!!j.readableObjectMode),this.highWaterMark=h(this,j,"readableHighWaterMark",V),this.buffer=new u,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=j.emitClose!==!1,this.autoDestroy=!!j.autoDestroy,this.destroyed=!1,this.defaultEncoding=j.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,j.encoding&&(S||(S=Mh().StringDecoder),this.decoder=new S(j.encoding),this.encoding=j.encoding)}function D(j){if(e=e||Br(),!(this instanceof D))return new D(j);var k=this instanceof e;this._readableState=new T(j,this,k),this.readable=!0,j&&(typeof j.read=="function"&&(this._read=j.read),typeof j.destroy=="function"&&(this._destroy=j.destroy)),a.call(this)}Object.defineProperty(D.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(j){this._readableState&&(this._readableState.destroyed=j)}}),D.prototype.destroy=d.destroy,D.prototype._undestroy=d.undestroy,D.prototype._destroy=function(j,k){k(j)},D.prototype.push=function(j,k){var V=this._readableState,G;return V.objectMode?G=!0:typeof j=="string"&&(k=k||V.defaultEncoding,k!==V.encoding&&(j=t.from(j,k),k=""),G=!0),A(this,j,k,!1,G)},D.prototype.unshift=function(j){return A(this,j,null,!0,!1)};function A(j,k,V,G,we){l("readableAddChunk",k);var ce=j._readableState;if(k===null)ce.reading=!1,J(j,ce);else{var me;if(we||(me=z(ce,k)),me)E(j,me);else if(ce.objectMode||k&&k.length>0)if(typeof k!="string"&&!ce.objectMode&&Object.getPrototypeOf(k)!==t.prototype&&(k=i(k)),G)ce.endEmitted?E(j,new w):R(j,ce,k,!0);else if(ce.ended)E(j,new m);else{if(ce.destroyed)return!1;ce.reading=!1,ce.decoder&&!V?(k=ce.decoder.write(k),ce.objectMode||k.length!==0?R(j,ce,k,!1):oe(j,ce)):R(j,ce,k,!1)}else G||(ce.reading=!1,oe(j,ce))}return!ce.ended&&(ce.length<ce.highWaterMark||ce.length===0)}function R(j,k,V,G){k.flowing&&k.length===0&&!k.sync?(k.awaitDrain=0,j.emit("data",V)):(k.length+=k.objectMode?1:V.length,G?k.buffer.unshift(V):k.buffer.push(V),k.needReadable&&Y(j)),oe(j,k)}function z(j,k){var V;return!s(k)&&typeof k!="string"&&k!==void 0&&!j.objectMode&&(V=new f("chunk",["string","Buffer","Uint8Array"],k)),V}D.prototype.isPaused=function(){return this._readableState.flowing===!1},D.prototype.setEncoding=function(j){S||(S=Mh().StringDecoder);var k=new S(j);this._readableState.decoder=k,this._readableState.encoding=this._readableState.decoder.encoding;for(var V=this._readableState.buffer.head,G="";V!==null;)G+=k.write(V.data),V=V.next;return this._readableState.buffer.clear(),G!==""&&this._readableState.buffer.push(G),this._readableState.length=G.length,this};var U=1073741824;function M(j){return j>=U?j=U:(j--,j|=j>>>1,j|=j>>>2,j|=j>>>4,j|=j>>>8,j|=j>>>16,j++),j}function q(j,k){return j<=0||k.length===0&&k.ended?0:k.objectMode?1:j!==j?k.flowing&&k.length?k.buffer.head.data.length:k.length:(j>k.highWaterMark&&(k.highWaterMark=M(j)),j<=k.length?j:k.ended?k.length:(k.needReadable=!0,0))}D.prototype.read=function(j){l("read",j),j=parseInt(j,10);var k=this._readableState,V=j;if(j!==0&&(k.emittedReadable=!1),j===0&&k.needReadable&&((k.highWaterMark!==0?k.length>=k.highWaterMark:k.length>0)||k.ended))return l("read: emitReadable",k.length,k.ended),k.length===0&&k.ended?F(this):Y(this),null;if(j=q(j,k),j===0&&k.ended)return k.length===0&&F(this),null;var G=k.needReadable;l("need readable",G),(k.length===0||k.length-j<k.highWaterMark)&&(G=!0,l("length less than watermark",G)),k.ended||k.reading?(G=!1,l("reading or ended",G)):G&&(l("do read"),k.reading=!0,k.sync=!0,k.length===0&&(k.needReadable=!0),this._read(k.highWaterMark),k.sync=!1,k.reading||(j=q(V,k)));var we;return j>0?we=C(j,k):we=null,we===null?(k.needReadable=k.length<=k.highWaterMark,j=0):(k.length-=j,k.awaitDrain=0),k.length===0&&(k.ended||(k.needReadable=!0),V!==j&&k.ended&&F(this)),we!==null&&this.emit("data",we),we};function J(j,k){if(l("onEofChunk"),!k.ended){if(k.decoder){var V=k.decoder.end();V&&V.length&&(k.buffer.push(V),k.length+=k.objectMode?1:V.length)}k.ended=!0,k.sync?Y(j):(k.needReadable=!1,k.emittedReadable||(k.emittedReadable=!0,se(j)))}}function Y(j){var k=j._readableState;l("emitReadable",k.needReadable,k.emittedReadable),k.needReadable=!1,k.emittedReadable||(l("emitReadable",k.flowing),k.emittedReadable=!0,Ne.nextTick(se,j))}function se(j){var k=j._readableState;l("emitReadable_",k.destroyed,k.length,k.ended),!k.destroyed&&(k.length||k.ended)&&(j.emit("readable"),k.emittedReadable=!1),k.needReadable=!k.flowing&&!k.ended&&k.length<=k.highWaterMark,_(j)}function oe(j,k){k.readingMore||(k.readingMore=!0,Ne.nextTick(Se,j,k))}function Se(j,k){for(;!k.reading&&!k.ended&&(k.length<k.highWaterMark||k.flowing&&k.length===0);){var V=k.length;if(l("maybeReadMore read 0"),j.read(0),V===k.length)break}k.readingMore=!1}D.prototype._read=function(j){E(this,new g("_read()"))},D.prototype.pipe=function(j,k){var V=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=j;break;case 1:G.pipes=[G.pipes,j];break;default:G.pipes.push(j);break}G.pipesCount+=1,l("pipe count=%d opts=%j",G.pipesCount,k);var we=(!k||k.end!==!1)&&j!==Ne.stdout&&j!==Ne.stderr,ce=we?Ae:ne;G.endEmitted?Ne.nextTick(ce):V.once("end",ce),j.on("unpipe",me);function me(ye,ge){l("onunpipe"),ye===V&&ge&&ge.hasUnpiped===!1&&(ge.hasUnpiped=!0,qe())}function Ae(){l("onend"),j.end()}var ct=Ce(V);j.on("drain",ct);var ae=!1;function qe(){l("cleanup"),j.removeListener("close",Ee),j.removeListener("finish",ie),j.removeListener("drain",ct),j.removeListener("error",te),j.removeListener("unpipe",me),V.removeListener("end",Ae),V.removeListener("end",ne),V.removeListener("data",de),ae=!0,G.awaitDrain&&(!j._writableState||j._writableState.needDrain)&&ct()}V.on("data",de);function de(ye){l("ondata");var ge=j.write(ye);l("dest.write",ge),ge===!1&&((G.pipesCount===1&&G.pipes===j||G.pipesCount>1&&H(G.pipes,j)!==-1)&&!ae&&(l("false write response, pause",G.awaitDrain),G.awaitDrain++),V.pause())}function te(ye){l("onerror",ye),ne(),j.removeListener("error",te),r(j,"error")===0&&E(j,ye)}N(j,"error",te);function Ee(){j.removeListener("finish",ie),ne()}j.once("close",Ee);function ie(){l("onfinish"),j.removeListener("close",Ee),ne()}j.once("finish",ie);function ne(){l("unpipe"),V.unpipe(j)}return j.emit("pipe",V),G.flowing||(l("pipe resume"),V.resume()),j};function Ce(j){return function(){var k=j._readableState;l("pipeOnDrain",k.awaitDrain),k.awaitDrain&&k.awaitDrain--,k.awaitDrain===0&&r(j,"data")&&(k.flowing=!0,_(j))}}D.prototype.unpipe=function(j){var k=this._readableState,V={hasUnpiped:!1};if(k.pipesCount===0)return this;if(k.pipesCount===1)return j&&j!==k.pipes?this:(j||(j=k.pipes),k.pipes=null,k.pipesCount=0,k.flowing=!1,j&&j.emit("unpipe",this,V),this);if(!j){var G=k.pipes,we=k.pipesCount;k.pipes=null,k.pipesCount=0,k.flowing=!1;for(var ce=0;ce<we;ce++)G[ce].emit("unpipe",this,{hasUnpiped:!1});return this}var me=H(k.pipes,j);return me===-1?this:(k.pipes.splice(me,1),k.pipesCount-=1,k.pipesCount===1&&(k.pipes=k.pipes[0]),j.emit("unpipe",this,V),this)},D.prototype.on=function(j,k){var V=a.prototype.on.call(this,j,k),G=this._readableState;return j==="data"?(G.readableListening=this.listenerCount("readable")>0,G.flowing!==!1&&this.resume()):j==="readable"&&!G.endEmitted&&!G.readableListening&&(G.readableListening=G.needReadable=!0,G.flowing=!1,G.emittedReadable=!1,l("on readable",G.length,G.reading),G.length?Y(this):G.reading||Ne.nextTick(re,this)),V},D.prototype.addListener=D.prototype.on,D.prototype.removeListener=function(j,k){var V=a.prototype.removeListener.call(this,j,k);return j==="readable"&&Ne.nextTick(Z,this),V},D.prototype.removeAllListeners=function(j){var k=a.prototype.removeAllListeners.apply(this,arguments);return(j==="readable"||j===void 0)&&Ne.nextTick(Z,this),k};function Z(j){var k=j._readableState;k.readableListening=j.listenerCount("readable")>0,k.resumeScheduled&&!k.paused?k.flowing=!0:j.listenerCount("data")>0&&j.resume()}function re(j){l("readable nexttick read 0"),j.read(0)}D.prototype.resume=function(){var j=this._readableState;return j.flowing||(l("resume"),j.flowing=!j.readableListening,ue(this,j)),j.paused=!1,this};function ue(j,k){k.resumeScheduled||(k.resumeScheduled=!0,Ne.nextTick(ee,j,k))}function ee(j,k){l("resume",k.reading),k.reading||j.read(0),k.resumeScheduled=!1,j.emit("resume"),_(j),k.flowing&&!k.reading&&j.read(0)}D.prototype.pause=function(){return l("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(l("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function _(j){var k=j._readableState;for(l("flow",k.flowing);k.flowing&&j.read()!==null;);}D.prototype.wrap=function(j){var k=this,V=this._readableState,G=!1;j.on("end",function(){if(l("wrapped end"),V.decoder&&!V.ended){var me=V.decoder.end();me&&me.length&&k.push(me)}k.push(null)}),j.on("data",function(me){if(l("wrapped data"),V.decoder&&(me=V.decoder.write(me)),!(V.objectMode&&me==null)&&!(!V.objectMode&&(!me||!me.length))){var Ae=k.push(me);Ae||(G=!0,j.pause())}});for(var we in j)this[we]===void 0&&typeof j[we]=="function"&&(this[we]=function(me){return function(){return j[me].apply(j,arguments)}}(we));for(var ce=0;ce<$.length;ce++)j.on($[ce],this.emit.bind(this,$[ce]));return this._read=function(me){l("wrapped _read",me),G&&(G=!1,j.resume())},this},typeof Symbol=="function"&&(D.prototype[Symbol.asyncIterator]=function(){return O===void 0&&(O=S_()),O(this)}),Object.defineProperty(D.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(D.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(D.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(j){this._readableState&&(this._readableState.flowing=j)}}),D._fromList=C,Object.defineProperty(D.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function C(j,k){if(k.length===0)return null;var V;return k.objectMode?V=k.buffer.shift():!j||j>=k.length?(k.decoder?V=k.buffer.join(""):k.buffer.length===1?V=k.buffer.first():V=k.buffer.concat(k.length),k.buffer.clear()):V=k.buffer.consume(j,k.decoder),V}function F(j){var k=j._readableState;l("endReadable",k.endEmitted),k.endEmitted||(k.ended=!0,Ne.nextTick(W,k,j))}function W(j,k){if(l("endReadableNT",j.endEmitted,j.length),!j.endEmitted&&j.length===0&&(j.endEmitted=!0,k.readable=!1,k.emit("end"),j.autoDestroy)){var V=k._writableState;(!V||V.autoDestroy&&V.finished)&&k.destroy()}}typeof Symbol=="function"&&(D.from=function(j,k){return x===void 0&&(x=k_()),x(D,j,k)});function H(j,k){for(var V=0,G=j.length;V<G;V++)if(j[V]===k)return V;return-1}return li}var ci,pu;function mu(){if(pu)return ci;pu=1,ci=o;var e=Zr().codes,r=e.ERR_METHOD_NOT_IMPLEMENTED,a=e.ERR_MULTIPLE_CALLBACK,t=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,n=e.ERR_TRANSFORM_WITH_LENGTH_0,i=Br();va()(o,i);function s(d,p){var h=this._transformState;h.transforming=!1;var v=h.writecb;if(v===null)return this.emit("error",new a);h.writechunk=null,h.writecb=null,p!=null&&this.push(p),v(d);var f=this._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&this._read(f.highWaterMark)}function o(d){if(!(this instanceof o))return new o(d);i.call(this,d),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,d&&(typeof d.transform=="function"&&(this._transform=d.transform),typeof d.flush=="function"&&(this._flush=d.flush)),this.on("prefinish",l)}function l(){var d=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(p,h){u(d,p,h)}):u(this,null,null)}o.prototype.push=function(d,p){return this._transformState.needTransform=!1,i.prototype.push.call(this,d,p)},o.prototype._transform=function(d,p,h){h(new r("_transform()"))},o.prototype._write=function(d,p,h){var v=this._transformState;if(v.writecb=h,v.writechunk=d,v.writeencoding=p,!v.transforming){var f=this._readableState;(v.needTransform||f.needReadable||f.length<f.highWaterMark)&&this._read(f.highWaterMark)}},o.prototype._read=function(d){var p=this._transformState;p.writechunk!==null&&!p.transforming?(p.transforming=!0,this._transform(p.writechunk,p.writeencoding,p.afterTransform)):p.needTransform=!0},o.prototype._destroy=function(d,p){i.prototype._destroy.call(this,d,function(h){p(h)})};function u(d,p,h){if(p)return d.emit("error",p);if(h!=null&&d.push(h),d._writableState.length)throw new n;if(d._transformState.transforming)throw new t;return d.push(null)}return ci}var di,fu;function C_(){if(fu)return di;fu=1,di=r;var e=mu();va()(r,e);function r(a){if(!(this instanceof r))return new r(a);e.call(this,a)}return r.prototype._transform=function(a,t,n){n(null,a)},di}var ui,vu;function P_(){if(vu)return ui;vu=1;var e;function r(h){var v=!1;return function(){v||(v=!0,h.apply(void 0,arguments))}}var a=Zr().codes,t=a.ERR_MISSING_ARGS,n=a.ERR_STREAM_DESTROYED;function i(h){if(h)throw h}function s(h){return h.setHeader&&typeof h.abort=="function"}function o(h,v,f,m){m=r(m);var g=!1;h.on("close",function(){g=!0}),e===void 0&&(e=ii()),e(h,{readable:v,writable:f},function(S){if(S)return m(S);g=!0,m()});var w=!1;return function(S){if(!g&&!w){if(w=!0,s(h))return h.abort();if(typeof h.destroy=="function")return h.destroy();m(S||new n("pipe"))}}}function l(h){h()}function u(h,v){return h.pipe(v)}function d(h){return!h.length||typeof h[h.length-1]!="function"?i:h.pop()}function p(){for(var h=arguments.length,v=new Array(h),f=0;f<h;f++)v[f]=arguments[f];var m=d(v);if(Array.isArray(v[0])&&(v=v[0]),v.length<2)throw new t("streams");var g,w=v.map(function(S,O){var x=O<v.length-1,E=O>0;return o(S,x,E,function($){g||(g=$),$&&w.forEach(l),!x&&(w.forEach(l),m(g))})});return v.reduce(u)}return ui=p,ui}var hi,gu;function N_(){if(gu)return hi;gu=1,hi=a;var e=co().EventEmitter,r=va();r(a,e),a.Readable=hu(),a.Writable=su(),a.Duplex=Br(),a.Transform=mu(),a.PassThrough=C_(),a.finished=ii(),a.pipeline=P_(),a.Stream=a;function a(){e.call(this)}return a.prototype.pipe=function(t,n){var i=this;function s(v){t.writable&&t.write(v)===!1&&i.pause&&i.pause()}i.on("data",s);function o(){i.readable&&i.resume&&i.resume()}t.on("drain",o),!t._isStdio&&(!n||n.end!==!1)&&(i.on("end",u),i.on("close",d));var l=!1;function u(){l||(l=!0,t.end())}function d(){l||(l=!0,typeof t.destroy=="function"&&t.destroy())}function p(v){if(h(),e.listenerCount(this,"error")===0)throw v}i.on("error",p),t.on("error",p);function h(){i.removeListener("data",s),t.removeListener("drain",o),i.removeListener("end",u),i.removeListener("close",d),i.removeListener("error",p),t.removeListener("error",p),i.removeListener("end",h),i.removeListener("close",h),t.removeListener("close",h)}return i.on("end",h),i.on("close",h),t.on("close",h),t.emit("pipe",i),t},hi}var $_=N_();class O_{append(r){this._buffer=this._buffer?Dh.concat([this._buffer,r]):r}readMessage(){if(!this._buffer)return null;const r=this._buffer.indexOf(`
`);if(r===-1)return null;const a=this._buffer.toString("utf8",0,r).replace(/\r$/,"");return this._buffer=this._buffer.subarray(r+1),R_(a)}clear(){this._buffer=void 0}}function R_(e){return Sa.parse(JSON.parse(e))}function I_(e){return JSON.stringify(e)+`
`}const T_=Qn.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE","PROGRAMFILES"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function A_(){const e={};for(const r of T_){const a=Qn.env[r];a!==void 0&&(a.startsWith("()")||(e[r]=a))}return e}class L_{constructor(r){this._abortController=new AbortController,this._readBuffer=new O_,this._stderrStream=null,this._serverParams=r,(r.stderr==="pipe"||r.stderr==="overlapped")&&(this._stderrStream=new $_.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((r,a)=>{var t,n,i,s,o;this._process=x_(this._serverParams.command,(t=this._serverParams.args)!==null&&t!==void 0?t:[],{env:{...A_(),...this._serverParams.env},stdio:["pipe","pipe",(n=this._serverParams.stderr)!==null&&n!==void 0?n:"inherit"],shell:!1,signal:this._abortController.signal,windowsHide:Qn.platform==="win32"&&F_(),cwd:this._serverParams.cwd}),this._process.on("error",l=>{var u,d;if(l.name==="AbortError"){(u=this.onclose)===null||u===void 0||u.call(this);return}a(l),(d=this.onerror)===null||d===void 0||d.call(this,l)}),this._process.on("spawn",()=>{r()}),this._process.on("close",l=>{var u;this._process=void 0,(u=this.onclose)===null||u===void 0||u.call(this)}),(i=this._process.stdin)===null||i===void 0||i.on("error",l=>{var u;(u=this.onerror)===null||u===void 0||u.call(this,l)}),(s=this._process.stdout)===null||s===void 0||s.on("data",l=>{this._readBuffer.append(l),this.processReadBuffer()}),(o=this._process.stdout)===null||o===void 0||o.on("error",l=>{var u;(u=this.onerror)===null||u===void 0||u.call(this,l)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){var r,a;return this._stderrStream?this._stderrStream:(a=(r=this._process)===null||r===void 0?void 0:r.stderr)!==null&&a!==void 0?a:null}get pid(){var r,a;return(a=(r=this._process)===null||r===void 0?void 0:r.pid)!==null&&a!==void 0?a:null}processReadBuffer(){for(var r,a;;)try{const t=this._readBuffer.readMessage();if(t===null)break;(r=this.onmessage)===null||r===void 0||r.call(this,t)}catch(t){(a=this.onerror)===null||a===void 0||a.call(this,t)}}async close(){this._abortController.abort(),this._process=void 0,this._readBuffer.clear()}send(r){return new Promise(a=>{var t;if(!(!((t=this._process)===null||t===void 0)&&t.stdin))throw new Error("Not connected");const n=I_(r);this._process.stdin.write(n)?a():this._process.stdin.once("drain",a)})}}function F_(){return"type"in Qn}let yu=class extends Error{constructor(e,r){super(e),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}};function pi(e){}function D_(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:r=pi,onError:a=pi,onRetry:t=pi,onComment:n}=e;let i="",s=!0,o,l="",u="";function d(m){const g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[w,S]=M_(`${i}${g}`);for(const O of w)p(O);i=S,s=!1}function p(m){if(m===""){v();return}if(m.startsWith(":")){n&&n(m.slice(m.startsWith(": ")?2:1));return}const g=m.indexOf(":");if(g!==-1){const w=m.slice(0,g),S=m[g+1]===" "?2:1,O=m.slice(g+S);h(w,O,m);return}h(m,"",m)}function h(m,g,w){switch(m){case"event":u=g;break;case"data":l=`${l}${g}
`;break;case"id":o=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?t(parseInt(g,10)):a(new yu(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:w}));break;default:a(new yu(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:w}));break}}function v(){l.length>0&&r({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u=""}function f(m={}){i&&m.consume&&p(i),s=!0,o=void 0,l="",u="",i=""}return{feed:d,reset:f}}function M_(e){const r=[];let a="",t=0;for(;t<e.length;){const n=e.indexOf("\r",t),i=e.indexOf(`
`,t);let s=-1;if(n!==-1&&i!==-1?s=Math.min(n,i):n!==-1?s=n:i!==-1&&(s=i),s===-1){a=e.slice(t);break}else{const o=e.slice(t,s);r.push(o),t=s+1,e[t-1]==="\r"&&e[t]===`
`&&t++}}return[r,a]}class _u extends Event{constructor(r,a){var t,n;super(r),this.code=(t=a==null?void 0:a.code)!=null?t:void 0,this.message=(n=a==null?void 0:a.message)!=null?n:void 0}[Symbol.for("nodejs.util.inspect.custom")](r,a,t){return t(bu(this),a)}[Symbol.for("Deno.customInspect")](r,a){return r(bu(this),a)}}function z_(e){const r=globalThis.DOMException;return typeof r=="function"?new r(e,"SyntaxError"):new SyntaxError(e)}function mi(e){return e instanceof Error?"errors"in e&&Array.isArray(e.errors)?e.errors.map(mi).join(", "):"cause"in e&&e.cause instanceof Error?`${e}: ${mi(e.cause)}`:e.message:`${e}`}function bu(e){return{type:e.type,message:e.message,code:e.code,defaultPrevented:e.defaultPrevented,cancelable:e.cancelable,timeStamp:e.timeStamp}}var wu=e=>{throw TypeError(e)},fi=(e,r,a)=>r.has(e)||wu("Cannot "+a),Le=(e,r,a)=>(fi(e,r,"read from private field"),a?a.call(e):r.get(e)),lt=(e,r,a)=>r.has(e)?wu("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,a),Je=(e,r,a,t)=>(fi(e,r,"write to private field"),r.set(e,a),a),ar=(e,r,a)=>(fi(e,r,"access private method"),a),kt,Or,Wr,vn,gn,Ca,Kr,Pa,yr,Qr,Gr,Jr,Na,Ut,vi,gi,yi,xu,_i,bi,$a,wi,xi;class yn extends EventTarget{constructor(r,a){var t,n;super(),lt(this,Ut),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,lt(this,kt),lt(this,Or),lt(this,Wr),lt(this,vn),lt(this,gn),lt(this,Ca),lt(this,Kr),lt(this,Pa,null),lt(this,yr),lt(this,Qr),lt(this,Gr,null),lt(this,Jr,null),lt(this,Na,null),lt(this,gi,async i=>{var s;Le(this,Qr).reset();const{body:o,redirected:l,status:u,headers:d}=i;if(u===204){ar(this,Ut,$a).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(l?Je(this,Wr,new URL(i.url)):Je(this,Wr,void 0),u!==200){ar(this,Ut,$a).call(this,`Non-200 status code (${u})`,u);return}if(!(d.get("content-type")||"").startsWith("text/event-stream")){ar(this,Ut,$a).call(this,'Invalid content type, expected "text/event-stream"',u);return}if(Le(this,kt)===this.CLOSED)return;Je(this,kt,this.OPEN);const p=new Event("open");if((s=Le(this,Na))==null||s.call(this,p),this.dispatchEvent(p),typeof o!="object"||!o||!("getReader"in o)){ar(this,Ut,$a).call(this,"Invalid response body, expected a web ReadableStream",u),this.close();return}const h=new TextDecoder,v=o.getReader();let f=!0;do{const{done:m,value:g}=await v.read();g&&Le(this,Qr).feed(h.decode(g,{stream:!m})),m&&(f=!1,Le(this,Qr).reset(),ar(this,Ut,wi).call(this))}while(f)}),lt(this,yi,i=>{Je(this,yr,void 0),!(i.name==="AbortError"||i.type==="aborted")&&ar(this,Ut,wi).call(this,mi(i))}),lt(this,_i,i=>{typeof i.id=="string"&&Je(this,Pa,i.id);const s=new MessageEvent(i.event||"message",{data:i.data,origin:Le(this,Wr)?Le(this,Wr).origin:Le(this,Or).origin,lastEventId:i.id||""});Le(this,Jr)&&(!i.event||i.event==="message")&&Le(this,Jr).call(this,s),this.dispatchEvent(s)}),lt(this,bi,i=>{Je(this,Ca,i)}),lt(this,xi,()=>{Je(this,Kr,void 0),Le(this,kt)===this.CONNECTING&&ar(this,Ut,vi).call(this)});try{if(r instanceof URL)Je(this,Or,r);else if(typeof r=="string")Je(this,Or,new URL(r,U_()));else throw new Error("Invalid URL")}catch{throw z_("An invalid or illegal string was specified")}Je(this,Qr,D_({onEvent:Le(this,_i),onRetry:Le(this,bi)})),Je(this,kt,this.CONNECTING),Je(this,Ca,3e3),Je(this,gn,(t=a==null?void 0:a.fetch)!=null?t:globalThis.fetch),Je(this,vn,(n=a==null?void 0:a.withCredentials)!=null?n:!1),ar(this,Ut,vi).call(this)}get readyState(){return Le(this,kt)}get url(){return Le(this,Or).href}get withCredentials(){return Le(this,vn)}get onerror(){return Le(this,Gr)}set onerror(r){Je(this,Gr,r)}get onmessage(){return Le(this,Jr)}set onmessage(r){Je(this,Jr,r)}get onopen(){return Le(this,Na)}set onopen(r){Je(this,Na,r)}addEventListener(r,a,t){const n=a;super.addEventListener(r,n,t)}removeEventListener(r,a,t){const n=a;super.removeEventListener(r,n,t)}close(){Le(this,Kr)&&clearTimeout(Le(this,Kr)),Le(this,kt)!==this.CLOSED&&(Le(this,yr)&&Le(this,yr).abort(),Je(this,kt,this.CLOSED),Je(this,yr,void 0))}}kt=new WeakMap,Or=new WeakMap,Wr=new WeakMap,vn=new WeakMap,gn=new WeakMap,Ca=new WeakMap,Kr=new WeakMap,Pa=new WeakMap,yr=new WeakMap,Qr=new WeakMap,Gr=new WeakMap,Jr=new WeakMap,Na=new WeakMap,Ut=new WeakSet,vi=function(){Je(this,kt,this.CONNECTING),Je(this,yr,new AbortController),Le(this,gn)(Le(this,Or),ar(this,Ut,xu).call(this)).then(Le(this,gi)).catch(Le(this,yi))},gi=new WeakMap,yi=new WeakMap,xu=function(){var e;const r={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...Le(this,Pa)?{"Last-Event-ID":Le(this,Pa)}:void 0},cache:"no-store",signal:(e=Le(this,yr))==null?void 0:e.signal};return"window"in globalThis&&(r.credentials=this.withCredentials?"include":"same-origin"),r},_i=new WeakMap,bi=new WeakMap,$a=function(e,r){var a;Le(this,kt)!==this.CLOSED&&Je(this,kt,this.CLOSED);const t=new _u("error",{code:r,message:e});(a=Le(this,Gr))==null||a.call(this,t),this.dispatchEvent(t)},wi=function(e,r){var a;if(Le(this,kt)===this.CLOSED)return;Je(this,kt,this.CONNECTING);const t=new _u("error",{code:r,message:e});(a=Le(this,Gr))==null||a.call(this,t),this.dispatchEvent(t),Je(this,Kr,setTimeout(Le(this,xi),Le(this,Ca)))},xi=new WeakMap,yn.CONNECTING=0,yn.OPEN=1,yn.CLOSED=2;function U_(){const e="document"in globalThis?globalThis.document:void 0;return e&&typeof e=="object"&&"baseURI"in e&&typeof e.baseURI=="string"?e.baseURI:void 0}let ji;ji=globalThis.crypto;async function H_(e){return(await ji).getRandomValues(new Uint8Array(e))}async function V_(e){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let a="";const t=await H_(e);for(let n=0;n<e;n++){const i=t[n]%r.length;a+=r[i]}return a}async function q_(e){return await V_(e)}async function Z_(e){const r=await(await ji).subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(r))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function B_(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const r=await q_(e),a=await Z_(r);return{code_verifier:r,code_challenge:a}}const W_=y.object({resource:y.string().url(),authorization_servers:y.array(y.string().url()).optional(),jwks_uri:y.string().url().optional(),scopes_supported:y.array(y.string()).optional(),bearer_methods_supported:y.array(y.string()).optional(),resource_signing_alg_values_supported:y.array(y.string()).optional(),resource_name:y.string().optional(),resource_documentation:y.string().optional(),resource_policy_uri:y.string().url().optional(),resource_tos_uri:y.string().url().optional(),tls_client_certificate_bound_access_tokens:y.boolean().optional(),authorization_details_types_supported:y.array(y.string()).optional(),dpop_signing_alg_values_supported:y.array(y.string()).optional(),dpop_bound_access_tokens_required:y.boolean().optional()}).passthrough(),K_=y.object({issuer:y.string(),authorization_endpoint:y.string(),token_endpoint:y.string(),registration_endpoint:y.string().optional(),scopes_supported:y.array(y.string()).optional(),response_types_supported:y.array(y.string()),response_modes_supported:y.array(y.string()).optional(),grant_types_supported:y.array(y.string()).optional(),token_endpoint_auth_methods_supported:y.array(y.string()).optional(),token_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),service_documentation:y.string().optional(),revocation_endpoint:y.string().optional(),revocation_endpoint_auth_methods_supported:y.array(y.string()).optional(),revocation_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),introspection_endpoint:y.string().optional(),introspection_endpoint_auth_methods_supported:y.array(y.string()).optional(),introspection_endpoint_auth_signing_alg_values_supported:y.array(y.string()).optional(),code_challenge_methods_supported:y.array(y.string()).optional()}).passthrough(),ju=y.object({access_token:y.string(),id_token:y.string().optional(),token_type:y.string(),expires_in:y.number().optional(),scope:y.string().optional(),refresh_token:y.string().optional()}).strip(),Q_=y.object({error:y.string(),error_description:y.string().optional(),error_uri:y.string().optional()}),G_=y.object({redirect_uris:y.array(y.string()).refine(e=>e.every(r=>URL.canParse(r)),{message:"redirect_uris must contain valid URLs"}),token_endpoint_auth_method:y.string().optional(),grant_types:y.array(y.string()).optional(),response_types:y.array(y.string()).optional(),client_name:y.string().optional(),client_uri:y.string().optional(),logo_uri:y.string().optional(),scope:y.string().optional(),contacts:y.array(y.string()).optional(),tos_uri:y.string().optional(),policy_uri:y.string().optional(),jwks_uri:y.string().optional(),jwks:y.any().optional(),software_id:y.string().optional(),software_version:y.string().optional(),software_statement:y.string().optional()}).strip(),J_=y.object({client_id:y.string(),client_secret:y.string().optional(),client_id_issued_at:y.number().optional(),client_secret_expires_at:y.number().optional()}).strip(),X_=G_.merge(J_);y.object({error:y.string(),error_description:y.string().optional()}).strip(),y.object({token:y.string(),token_type_hint:y.string().optional()}).strip();function Y_(e){const r=typeof e=="string"?new URL(e):new URL(e.href);return r.hash="",r}function e0({requestedResource:e,configuredResource:r}){const a=typeof e=="string"?new URL(e):new URL(e.href),t=typeof r=="string"?new URL(r):new URL(r.href);if(a.origin!==t.origin||a.pathname.length<t.pathname.length)return!1;const n=a.pathname.endsWith("/")?a.pathname:a.pathname+"/",i=t.pathname.endsWith("/")?t.pathname:t.pathname+"/";return n.startsWith(i)}class pt extends Error{constructor(r,a){super(r),this.errorUri=a,this.name=this.constructor.name}toResponseObject(){const r={error:this.errorCode,error_description:this.message};return this.errorUri&&(r.error_uri=this.errorUri),r}get errorCode(){return this.constructor.errorCode}}class Ei extends pt{}Ei.errorCode="invalid_request";class _n extends pt{}_n.errorCode="invalid_client";class bn extends pt{}bn.errorCode="invalid_grant";class wn extends pt{}wn.errorCode="unauthorized_client";class Si extends pt{}Si.errorCode="unsupported_grant_type";class ki extends pt{}ki.errorCode="invalid_scope";class Ci extends pt{}Ci.errorCode="access_denied";class Xr extends pt{}Xr.errorCode="server_error";class Pi extends pt{}Pi.errorCode="temporarily_unavailable";class Ni extends pt{}Ni.errorCode="unsupported_response_type";class $i extends pt{}$i.errorCode="unsupported_token_type";class Oi extends pt{}Oi.errorCode="invalid_token";class Ri extends pt{}Ri.errorCode="method_not_allowed";class Ii extends pt{}Ii.errorCode="too_many_requests";class Ti extends pt{}Ti.errorCode="invalid_client_metadata";class Ai extends pt{}Ai.errorCode="insufficient_scope";const t0={[Ei.errorCode]:Ei,[_n.errorCode]:_n,[bn.errorCode]:bn,[wn.errorCode]:wn,[Si.errorCode]:Si,[ki.errorCode]:ki,[Ci.errorCode]:Ci,[Xr.errorCode]:Xr,[Pi.errorCode]:Pi,[Ni.errorCode]:Ni,[$i.errorCode]:$i,[Oi.errorCode]:Oi,[Ri.errorCode]:Ri,[Ii.errorCode]:Ii,[Ti.errorCode]:Ti,[Ai.errorCode]:Ai};class Gt extends Error{constructor(r){super(r??"Unauthorized")}}function Eu(e,r){const a=e.client_secret!==void 0;return r.length===0?a?"client_secret_post":"none":a&&r.includes("client_secret_basic")?"client_secret_basic":a&&r.includes("client_secret_post")?"client_secret_post":r.includes("none")?"none":a?"client_secret_post":"none"}function Su(e,r,a,t){const{client_id:n,client_secret:i}=r;switch(e){case"client_secret_basic":r0(n,i,a);return;case"client_secret_post":a0(n,i,t);return;case"none":n0(n,t);return;default:throw new Error(`Unsupported client authentication method: ${e}`)}}function r0(e,r,a){if(!r)throw new Error("client_secret_basic authentication requires a client_secret");const t=btoa(`${e}:${r}`);a.set("Authorization",`Basic ${t}`)}function a0(e,r,a){a.set("client_id",e),r&&a.set("client_secret",r)}function n0(e,r){r.set("client_id",e)}async function Li(e){const r=e instanceof Response?e.status:void 0,a=e instanceof Response?await e.text():e;try{const t=Q_.parse(JSON.parse(a)),{error:n,error_description:i,error_uri:s}=t,o=t0[n]||Xr;return new o(i||"",s)}catch(t){const n=`${r?`HTTP ${r}: `:""}Invalid OAuth error response: ${t}. Raw body: ${a}`;return new Xr(n)}}async function Yr(e,r){var a,t;try{return await Fi(e,r)}catch(n){if(n instanceof _n||n instanceof wn)return await((a=e.invalidateCredentials)===null||a===void 0?void 0:a.call(e,"all")),await Fi(e,r);if(n instanceof bn)return await((t=e.invalidateCredentials)===null||t===void 0?void 0:t.call(e,"tokens")),await Fi(e,r);throw n}}async function Fi(e,{serverUrl:r,authorizationCode:a,scope:t,resourceMetadataUrl:n,fetchFn:i}){let s,o=r;try{s=await i0(r,{resourceMetadataUrl:n},i),s.authorization_servers&&s.authorization_servers.length>0&&(o=s.authorization_servers[0])}catch{}const l=await s0(r,e,s),u=await c0(r,{authorizationServerUrl:o},i);let d=await Promise.resolve(e.clientInformation());if(!d){if(a!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");if(!e.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const m=await p0(o,{metadata:u,clientMetadata:e.clientMetadata});await e.saveClientInformation(m),d=m}if(a!==void 0){const m=await e.codeVerifier(),g=await u0(o,{metadata:u,clientInformation:d,authorizationCode:a,codeVerifier:m,redirectUri:e.redirectUrl,resource:l,addClientAuthentication:e.addClientAuthentication,fetchFn:i});return await e.saveTokens(g),"AUTHORIZED"}const p=await e.tokens();if(p!=null&&p.refresh_token)try{const m=await h0(o,{metadata:u,clientInformation:d,refreshToken:p.refresh_token,resource:l,addClientAuthentication:e.addClientAuthentication});return await e.saveTokens(m),"AUTHORIZED"}catch(m){if(!(!(m instanceof pt)||m instanceof Xr))throw m}const h=e.state?await e.state():void 0,{authorizationUrl:v,codeVerifier:f}=await d0(o,{metadata:u,clientInformation:d,state:h,redirectUrl:e.redirectUrl,scope:t||e.clientMetadata.scope,resource:l});return await e.saveCodeVerifier(f),await e.redirectToAuthorization(v),"REDIRECT"}async function s0(e,r,a){const t=Y_(e);if(r.validateResourceURL)return await r.validateResourceURL(t,a==null?void 0:a.resource);if(a){if(!e0({requestedResource:t,configuredResource:a.resource}))throw new Error(`Protected resource ${a.resource} does not match expected ${t} (or origin)`);return new URL(a.resource)}}function Di(e){const r=e.headers.get("WWW-Authenticate");if(!r)return;const[a,t]=r.split(" ");if(a.toLowerCase()!=="bearer"||!t)return;const n=/resource_metadata="([^"]*)"/.exec(r);if(n)try{return new URL(n[1])}catch{return}}async function i0(e,r,a=fetch){const t=await Pu(e,"oauth-protected-resource",a,{protocolVersion:r==null?void 0:r.protocolVersion,metadataUrl:r==null?void 0:r.resourceMetadataUrl});if(!t||t.status===404)throw new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!t.ok)throw new Error(`HTTP ${t.status} trying to load well-known OAuth protected resource metadata.`);return W_.parse(await t.json())}async function ku(e,r,a=fetch){try{return await a(e,{headers:r})}catch(t){if(t instanceof TypeError)return r?ku(e,void 0,a):void 0;throw t}}function o0(e,r){let a=`/.well-known/${e}${r}`;return r.endsWith("/")&&(a=a.slice(0,-1)),a}async function Cu(e,r,a=fetch){return await ku(e,{"MCP-Protocol-Version":r},a)}function l0(e,r){return!e||e.status===404&&r!=="/"}async function Pu(e,r,a,t){var n,i;const s=new URL(e),o=(n=t==null?void 0:t.protocolVersion)!==null&&n!==void 0?n:on;let l;if(t!=null&&t.metadataUrl)l=new URL(t.metadataUrl);else{const d=o0(r,s.pathname);l=new URL(d,(i=t==null?void 0:t.metadataServerUrl)!==null&&i!==void 0?i:s),l.search=s.search}let u=await Cu(l,o,a);if(!(t!=null&&t.metadataUrl)&&l0(u,s.pathname)){const d=new URL(`/.well-known/${r}`,s);u=await Cu(d,o,a)}return u}async function c0(e,{authorizationServerUrl:r,protocolVersion:a}={},t=fetch){typeof e=="string"&&(e=new URL(e)),r||(r=e),typeof r=="string"&&(r=new URL(r)),a??(a=on);const n=await Pu(r,"oauth-authorization-server",t,{protocolVersion:a,metadataServerUrl:r});if(!(!n||n.status===404)){if(!n.ok)throw new Error(`HTTP ${n.status} trying to load well-known OAuth metadata`);return K_.parse(await n.json())}}async function d0(e,{metadata:r,clientInformation:a,redirectUrl:t,scope:n,state:i,resource:s}){const o="code",l="S256";let u;if(r){if(u=new URL(r.authorization_endpoint),!r.response_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support response type ${o}`);if(!r.code_challenge_methods_supported||!r.code_challenge_methods_supported.includes(l))throw new Error(`Incompatible auth server: does not support code challenge method ${l}`)}else u=new URL("/authorize",e);const d=await B_(),p=d.code_verifier,h=d.code_challenge;return u.searchParams.set("response_type",o),u.searchParams.set("client_id",a.client_id),u.searchParams.set("code_challenge",h),u.searchParams.set("code_challenge_method",l),u.searchParams.set("redirect_uri",String(t)),i&&u.searchParams.set("state",i),n&&u.searchParams.set("scope",n),n!=null&&n.includes("offline_access")&&u.searchParams.append("prompt","consent"),s&&u.searchParams.set("resource",s.href),{authorizationUrl:u,codeVerifier:p}}async function u0(e,{metadata:r,clientInformation:a,authorizationCode:t,codeVerifier:n,redirectUri:i,resource:s,addClientAuthentication:o,fetchFn:l}){var u;const d="authorization_code",p=r!=null&&r.token_endpoint?new URL(r.token_endpoint):new URL("/token",e);if(r!=null&&r.grant_types_supported&&!r.grant_types_supported.includes(d))throw new Error(`Incompatible auth server: does not support grant type ${d}`);const h=new Headers({"Content-Type":"application/x-www-form-urlencoded"}),v=new URLSearchParams({grant_type:d,code:t,code_verifier:n,redirect_uri:String(i)});if(o)o(h,v,e,r);else{const m=(u=r==null?void 0:r.token_endpoint_auth_methods_supported)!==null&&u!==void 0?u:[],g=Eu(a,m);Su(g,a,h,v)}s&&v.set("resource",s.href);const f=await(l??fetch)(p,{method:"POST",headers:h,body:v});if(!f.ok)throw await Li(f);return ju.parse(await f.json())}async function h0(e,{metadata:r,clientInformation:a,refreshToken:t,resource:n,addClientAuthentication:i,fetchFn:s}){var o;const l="refresh_token";let u;if(r){if(u=new URL(r.token_endpoint),r.grant_types_supported&&!r.grant_types_supported.includes(l))throw new Error(`Incompatible auth server: does not support grant type ${l}`)}else u=new URL("/token",e);const d=new Headers({"Content-Type":"application/x-www-form-urlencoded"}),p=new URLSearchParams({grant_type:l,refresh_token:t});if(i)i(d,p,e,r);else{const v=(o=r==null?void 0:r.token_endpoint_auth_methods_supported)!==null&&o!==void 0?o:[],f=Eu(a,v);Su(f,a,d,p)}n&&p.set("resource",n.href);const h=await(s??fetch)(u,{method:"POST",headers:d,body:p});if(!h.ok)throw await Li(h);return ju.parse({refresh_token:t,...await h.json()})}async function p0(e,{metadata:r,clientMetadata:a,fetchFn:t}){let n;if(r){if(!r.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");n=new URL(r.registration_endpoint)}else n=new URL("/register",e);const i=await(t??fetch)(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)throw await Li(i);return X_.parse(await i.json())}class m0 extends Error{constructor(r,a,t){super(`SSE error: ${a}`),this.code=r,this.event=t}}class f0{constructor(r,a){this._url=r,this._resourceMetadataUrl=void 0,this._eventSourceInit=a==null?void 0:a.eventSourceInit,this._requestInit=a==null?void 0:a.requestInit,this._authProvider=a==null?void 0:a.authProvider,this._fetch=a==null?void 0:a.fetch}async _authThenStart(){var r;if(!this._authProvider)throw new Gt("No auth provider");let a;try{a=await Yr(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})}catch(t){throw(r=this.onerror)===null||r===void 0||r.call(this,t),t}if(a!=="AUTHORIZED")throw new Gt;return await this._startOrAuth()}async _commonHeaders(){var r;const a={};if(this._authProvider){const t=await this._authProvider.tokens();t&&(a.Authorization=`Bearer ${t.access_token}`)}return this._protocolVersion&&(a["mcp-protocol-version"]=this._protocolVersion),new Headers({...a,...(r=this._requestInit)===null||r===void 0?void 0:r.headers})}_startOrAuth(){var r,a,t;const n=(t=(a=(r=this===null||this===void 0?void 0:this._eventSourceInit)===null||r===void 0?void 0:r.fetch)!==null&&a!==void 0?a:this._fetch)!==null&&t!==void 0?t:fetch;return new Promise((i,s)=>{this._eventSource=new yn(this._url.href,{...this._eventSourceInit,fetch:async(o,l)=>{const u=await this._commonHeaders();u.set("Accept","text/event-stream");const d=await n(o,{...l,headers:u});return d.status===401&&d.headers.has("www-authenticate")&&(this._resourceMetadataUrl=Di(d)),d}}),this._abortController=new AbortController,this._eventSource.onerror=o=>{var l;if(o.code===401&&this._authProvider){this._authThenStart().then(i,s);return}const u=new m0(o.code,o.message,o);s(u),(l=this.onerror)===null||l===void 0||l.call(this,u)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",o=>{var l;const u=o;try{if(this._endpoint=new URL(u.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(d){s(d),(l=this.onerror)===null||l===void 0||l.call(this,d),this.close();return}i()}),this._eventSource.onmessage=o=>{var l,u;const d=o;let p;try{p=Sa.parse(JSON.parse(d.data))}catch(h){(l=this.onerror)===null||l===void 0||l.call(this,h);return}(u=this.onmessage)===null||u===void 0||u.call(this,p)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(r){if(!this._authProvider)throw new Gt("No auth provider");if(await Yr(this._authProvider,{serverUrl:this._url,authorizationCode:r,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Gt("Failed to authorize")}async close(){var r,a,t;(r=this._abortController)===null||r===void 0||r.abort(),(a=this._eventSource)===null||a===void 0||a.close(),(t=this.onclose)===null||t===void 0||t.call(this)}async send(r){var a,t,n;if(!this._endpoint)throw new Error("Not connected");try{const i=await this._commonHeaders();i.set("content-type","application/json");const s={...this._requestInit,method:"POST",headers:i,body:JSON.stringify(r),signal:(a=this._abortController)===null||a===void 0?void 0:a.signal},o=await((t=this._fetch)!==null&&t!==void 0?t:fetch)(this._endpoint,s);if(!o.ok){if(o.status===401&&this._authProvider){if(this._resourceMetadataUrl=Di(o),await Yr(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Gt;return this.send(r)}const l=await o.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${l}`)}}catch(i){throw(n=this.onerror)===null||n===void 0||n.call(this,i),i}}setProtocolVersion(r){this._protocolVersion=r}}var v0=Object.defineProperty,g0=(e,r,a)=>r in e?v0(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,xn=(e,r,a)=>g0(e,typeof r!="symbol"?r+"":r,a);class Nu extends Error{constructor(r,a){super(r),xn(this,"type"),xn(this,"field"),xn(this,"value"),xn(this,"line"),this.name="ParseError",this.type=a.type,this.field=a.field,this.value=a.value,this.line=a.line}}function Mi(e){}function y0(e){const{onEvent:r=Mi,onError:a=Mi,onRetry:t=Mi,onComment:n}=e;let i="",s=!0,o,l="",u="";function d(m){const g=s?m.replace(/^\xEF\xBB\xBF/,""):m,[w,S]=_0(`${i}${g}`);for(const O of w)p(O);i=S,s=!1}function p(m){if(m===""){v();return}if(m.startsWith(":")){n&&n(m.slice(m.startsWith(": ")?2:1));return}const g=m.indexOf(":");if(g!==-1){const w=m.slice(0,g),S=m[g+1]===" "?2:1,O=m.slice(g+S);h(w,O,m);return}h(m,"",m)}function h(m,g,w){switch(m){case"event":u=g;break;case"data":l=`${l}${g}
`;break;case"id":o=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?t(parseInt(g,10)):a(new Nu(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:w}));break;default:a(new Nu(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:g,line:w}));break}}function v(){l.length>0&&r({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u=""}function f(m={}){i&&m.consume&&p(i),o=void 0,l="",u="",i=""}return{feed:d,reset:f}}function _0(e){const r=[];let a="";const t=e.length;for(let n=0;n<t;n++){const i=e[n];i==="\r"&&e[n+1]===`
`?(r.push(a),a="",n++):i==="\r"||i===`
`?(r.push(a),a=""):a+=i}return[r,a]}class b0 extends TransformStream{constructor({onError:r,onRetry:a,onComment:t}={}){let n;super({start(i){n=y0({onEvent:s=>{i.enqueue(s)},onError(s){r==="terminate"?i.error(s):typeof r=="function"&&r(s)},onRetry:a,onComment:t})},transform(i){n.feed(i)}})}}const w0={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class zi extends Error{constructor(r,a){super(`Streamable HTTP error: ${a}`),this.code=r}}class $u{constructor(r,a){var t;this._url=r,this._resourceMetadataUrl=void 0,this._requestInit=a==null?void 0:a.requestInit,this._authProvider=a==null?void 0:a.authProvider,this._fetch=a==null?void 0:a.fetch,this._sessionId=a==null?void 0:a.sessionId,this._reconnectionOptions=(t=a==null?void 0:a.reconnectionOptions)!==null&&t!==void 0?t:w0}async _authThenStart(){var r;if(!this._authProvider)throw new Gt("No auth provider");let a;try{a=await Yr(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})}catch(t){throw(r=this.onerror)===null||r===void 0||r.call(this,t),t}if(a!=="AUTHORIZED")throw new Gt;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){var r;const a={};if(this._authProvider){const n=await this._authProvider.tokens();n&&(a.Authorization=`Bearer ${n.access_token}`)}this._sessionId&&(a["mcp-session-id"]=this._sessionId),this._protocolVersion&&(a["mcp-protocol-version"]=this._protocolVersion);const t=this._normalizeHeaders((r=this._requestInit)===null||r===void 0?void 0:r.headers);return new Headers({...a,...t})}async _startOrAuthSse(r){var a,t,n;const{resumptionToken:i}=r;try{const s=await this._commonHeaders();s.set("Accept","text/event-stream"),i&&s.set("last-event-id",i);const o=await((a=this._fetch)!==null&&a!==void 0?a:fetch)(this._url,{method:"GET",headers:s,signal:(t=this._abortController)===null||t===void 0?void 0:t.signal});if(!o.ok){if(o.status===401&&this._authProvider)return await this._authThenStart();if(o.status===405)return;throw new zi(o.status,`Failed to open SSE stream: ${o.statusText}`)}this._handleSseStream(o.body,r,!0)}catch(s){throw(n=this.onerror)===null||n===void 0||n.call(this,s),s}}_getNextReconnectionDelay(r){const a=this._reconnectionOptions.initialReconnectionDelay,t=this._reconnectionOptions.reconnectionDelayGrowFactor,n=this._reconnectionOptions.maxReconnectionDelay;return Math.min(a*Math.pow(t,r),n)}_normalizeHeaders(r){return r?r instanceof Headers?Object.fromEntries(r.entries()):Array.isArray(r)?Object.fromEntries(r):{...r}:{}}_scheduleReconnection(r,a=0){var t;const n=this._reconnectionOptions.maxRetries;if(n>0&&a>=n){(t=this.onerror)===null||t===void 0||t.call(this,new Error(`Maximum reconnection attempts (${n}) exceeded.`));return}const i=this._getNextReconnectionDelay(a);setTimeout(()=>{this._startOrAuthSse(r).catch(s=>{var o;(o=this.onerror)===null||o===void 0||o.call(this,new Error(`Failed to reconnect SSE stream: ${s instanceof Error?s.message:String(s)}`)),this._scheduleReconnection(r,a+1)})},i)}_handleSseStream(r,a,t){if(!r)return;const{onresumptiontoken:n,replayMessageId:i}=a;let s;(async()=>{var o,l,u,d;try{const p=r.pipeThrough(new TextDecoderStream).pipeThrough(new b0).getReader();for(;;){const{value:h,done:v}=await p.read();if(v)break;if(h.id&&(s=h.id,n==null||n(h.id)),!h.event||h.event==="message")try{const f=Sa.parse(JSON.parse(h.data));i!==void 0&&_s(f)&&(f.id=i),(o=this.onmessage)===null||o===void 0||o.call(this,f)}catch(f){(l=this.onerror)===null||l===void 0||l.call(this,f)}}}catch(p){if((u=this.onerror)===null||u===void 0||u.call(this,new Error(`SSE stream disconnected: ${p}`)),t&&this._abortController&&!this._abortController.signal.aborted)try{this._scheduleReconnection({resumptionToken:s,onresumptiontoken:n,replayMessageId:i},0)}catch(h){(d=this.onerror)===null||d===void 0||d.call(this,new Error(`Failed to reconnect: ${h instanceof Error?h.message:String(h)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(r){if(!this._authProvider)throw new Gt("No auth provider");if(await Yr(this._authProvider,{serverUrl:this._url,authorizationCode:r,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Gt("Failed to authorize")}async close(){var r,a;(r=this._abortController)===null||r===void 0||r.abort(),(a=this.onclose)===null||a===void 0||a.call(this)}async send(r,a){var t,n,i,s;try{const{resumptionToken:o,onresumptiontoken:l}=a||{};if(o){this._startOrAuthSse({resumptionToken:o,replayMessageId:Vl(r)?r.id:void 0}).catch(m=>{var g;return(g=this.onerror)===null||g===void 0?void 0:g.call(this,m)});return}const u=await this._commonHeaders();u.set("content-type","application/json"),u.set("accept","application/json, text/event-stream");const d={...this._requestInit,method:"POST",headers:u,body:JSON.stringify(r),signal:(t=this._abortController)===null||t===void 0?void 0:t.signal},p=await((n=this._fetch)!==null&&n!==void 0?n:fetch)(this._url,d),h=p.headers.get("mcp-session-id");if(h&&(this._sessionId=h),!p.ok){if(p.status===401&&this._authProvider){if(this._resourceMetadataUrl=Di(p),await Yr(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,fetchFn:this._fetch})!=="AUTHORIZED")throw new Gt;return this.send(r)}const m=await p.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${p.status}): ${m}`)}if(p.status===202){_g(r)&&this._startOrAuthSse({resumptionToken:void 0}).catch(m=>{var g;return(g=this.onerror)===null||g===void 0?void 0:g.call(this,m)});return}const v=(Array.isArray(r)?r:[r]).filter(m=>"method"in m&&"id"in m&&m.id!==void 0).length>0,f=p.headers.get("content-type");if(v)if(f!=null&&f.includes("text/event-stream"))this._handleSseStream(p.body,{onresumptiontoken:l},!1);else if(f!=null&&f.includes("application/json")){const m=await p.json(),g=Array.isArray(m)?m.map(w=>Sa.parse(w)):[Sa.parse(m)];for(const w of g)(i=this.onmessage)===null||i===void 0||i.call(this,w)}else throw new zi(-1,`Unexpected content type: ${f}`)}catch(o){throw(s=this.onerror)===null||s===void 0||s.call(this,o),o}}get sessionId(){return this._sessionId}async terminateSession(){var r,a,t;if(this._sessionId)try{const n=await this._commonHeaders(),i={...this._requestInit,method:"DELETE",headers:n,signal:(r=this._abortController)===null||r===void 0?void 0:r.signal},s=await((a=this._fetch)!==null&&a!==void 0?a:fetch)(this._url,i);if(!s.ok&&s.status!==405)throw new zi(s.status,`Failed to terminate session: ${s.statusText}`);this._sessionId=void 0}catch(n){throw(t=this.onerror)===null||t===void 0||t.call(this,n),n}}setProtocolVersion(r){this._protocolVersion=r}get protocolVersion(){return this._protocolVersion}}var Ui={exports:{}},Hi,Ou;function x0(){if(Ou)return Hi;Ou=1;var e=1e3,r=e*60,a=r*60,t=a*24,n=t*7,i=t*365.25;Hi=function(d,p){p=p||{};var h=typeof d;if(h==="string"&&d.length>0)return s(d);if(h==="number"&&isFinite(d))return p.long?l(d):o(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function s(d){if(d=String(d),!(d.length>100)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(p){var h=parseFloat(p[1]),v=(p[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return h*i;case"weeks":case"week":case"w":return h*n;case"days":case"day":case"d":return h*t;case"hours":case"hour":case"hrs":case"hr":case"h":return h*a;case"minutes":case"minute":case"mins":case"min":case"m":return h*r;case"seconds":case"second":case"secs":case"sec":case"s":return h*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function o(d){var p=Math.abs(d);return p>=t?Math.round(d/t)+"d":p>=a?Math.round(d/a)+"h":p>=r?Math.round(d/r)+"m":p>=e?Math.round(d/e)+"s":d+"ms"}function l(d){var p=Math.abs(d);return p>=t?u(d,p,t,"day"):p>=a?u(d,p,a,"hour"):p>=r?u(d,p,r,"minute"):p>=e?u(d,p,e,"second"):d+" ms"}function u(d,p,h,v){var f=p>=h*1.5;return Math.round(d/h)+" "+v+(f?"s":"")}return Hi}var Vi,Ru;function j0(){if(Ru)return Vi;Ru=1;function e(r){t.debug=t,t.default=t,t.coerce=u,t.disable=o,t.enable=i,t.enabled=l,t.humanize=x0(),t.destroy=d,Object.keys(r).forEach(p=>{t[p]=r[p]}),t.names=[],t.skips=[],t.formatters={};function a(p){let h=0;for(let v=0;v<p.length;v++)h=(h<<5)-h+p.charCodeAt(v),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=a;function t(p){let h,v=null,f,m;function g(...w){if(!g.enabled)return;const S=g,O=Number(new Date),x=O-(h||O);S.diff=x,S.prev=h,S.curr=O,h=O,w[0]=t.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let E=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,($,N)=>{if($==="%%")return"%";E++;const T=t.formatters[N];if(typeof T=="function"){const D=w[E];$=T.call(S,D),w.splice(E,1),E--}return $}),t.formatArgs.call(S,w),(S.log||t.log).apply(S,w)}return g.namespace=p,g.useColors=t.useColors(),g.color=t.selectColor(p),g.extend=n,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>v!==null?v:(f!==t.namespaces&&(f=t.namespaces,m=t.enabled(p)),m),set:w=>{v=w}}),typeof t.init=="function"&&t.init(g),g}function n(p,h){const v=t(this.namespace+(typeof h>"u"?":":h)+p);return v.log=this.log,v}function i(p){t.save(p),t.namespaces=p,t.names=[],t.skips=[];const h=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const v of h)v[0]==="-"?t.skips.push(v.slice(1)):t.names.push(v)}function s(p,h){let v=0,f=0,m=-1,g=0;for(;v<p.length;)if(f<h.length&&(h[f]===p[v]||h[f]==="*"))h[f]==="*"?(m=f,g=v,f++):(v++,f++);else if(m!==-1)f=m+1,g++,v=g;else return!1;for(;f<h.length&&h[f]==="*";)f++;return f===h.length}function o(){const p=[...t.names,...t.skips.map(h=>"-"+h)].join(",");return t.enable(""),p}function l(p){for(const h of t.skips)if(s(p,h))return!1;for(const h of t.names)if(s(p,h))return!0;return!1}function u(p){return p instanceof Error?p.stack||p.message:p}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return Vi=e,Vi}var Iu;function E0(){return Iu||(Iu=1,function(e,r){var a={};r.formatArgs=n,r.save=i,r.load=s,r.useColors=t,r.storage=o(),r.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let p=0,h=0;u[0].replace(/%[a-zA-Z%]/g,v=>{v!=="%%"&&(p++,v==="%c"&&(h=p))}),u.splice(h,0,d)}r.log=console.debug||console.log||(()=>{});function i(u){try{u?r.storage.setItem("debug",u):r.storage.removeItem("debug")}catch{}}function s(){let u;try{u=r.storage.getItem("debug")||r.storage.getItem("DEBUG")}catch{}return!u&&typeof Ne<"u"&&"env"in Ne&&(u=a.DEBUG),u}function o(){try{return localStorage}catch{}}e.exports=j0()(r);const{formatters:l}=e.exports;l.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}(Ui,Ui.exports)),Ui.exports}var S0=E0();const Tu=lo(S0);var ze;(function(e){e.assertEqual=n=>{};function r(n){}e.assertIs=r;function a(n){throw new Error}e.assertNever=a,e.arrayToEnum=n=>{const i={};for(const s of n)i[s]=s;return i},e.getValidEnumValues=n=>{const i=e.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),s={};for(const o of i)s[o]=n[o];return e.objectValues(s)},e.objectValues=n=>e.objectKeys(n).map(function(i){return n[i]}),e.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&i.push(s);return i},e.find=(n,i)=>{for(const s of n)if(i(s))return s},e.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function t(n,i=" | "){return n.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}e.joinValues=t,e.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(ze||(ze={}));var Au;(function(e){e.mergeShapes=(r,a)=>({...r,...a})})(Au||(Au={}));const pe=ze.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_r=e=>{switch(typeof e){case"undefined":return pe.undefined;case"string":return pe.string;case"number":return Number.isNaN(e)?pe.nan:pe.number;case"boolean":return pe.boolean;case"function":return pe.function;case"bigint":return pe.bigint;case"symbol":return pe.symbol;case"object":return Array.isArray(e)?pe.array:e===null?pe.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?pe.promise:typeof Map<"u"&&e instanceof Map?pe.map:typeof Set<"u"&&e instanceof Set?pe.set:typeof Date<"u"&&e instanceof Date?pe.date:pe.object;default:return pe.unknown}},X=ze.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class nr extends Error{get errors(){return this.issues}constructor(r){super(),this.issues=[],this.addIssue=t=>{this.issues=[...this.issues,t]},this.addIssues=(t=[])=>{this.issues=[...this.issues,...t]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=r}format(r){const a=r||function(i){return i.message},t={_errors:[]},n=i=>{for(const s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(n);else if(s.code==="invalid_return_type")n(s.returnTypeError);else if(s.code==="invalid_arguments")n(s.argumentsError);else if(s.path.length===0)t._errors.push(a(s));else{let o=t,l=0;for(;l<s.path.length;){const u=s.path[l];l===s.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(a(s))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return n(this),t}static assert(r){if(!(r instanceof nr))throw new Error(`Not a ZodError: ${r}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ze.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=a=>a.message){const a={},t=[];for(const n of this.issues)if(n.path.length>0){const i=n.path[0];a[i]=a[i]||[],a[i].push(r(n))}else t.push(r(n));return{formErrors:t,fieldErrors:a}}get formErrors(){return this.flatten()}}nr.create=e=>new nr(e);const qi=(e,r)=>{let a;switch(e.code){case X.invalid_type:e.received===pe.undefined?a="Required":a=`Expected ${e.expected}, received ${e.received}`;break;case X.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(e.expected,ze.jsonStringifyReplacer)}`;break;case X.unrecognized_keys:a=`Unrecognized key(s) in object: ${ze.joinValues(e.keys,", ")}`;break;case X.invalid_union:a="Invalid input";break;case X.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${ze.joinValues(e.options)}`;break;case X.invalid_enum_value:a=`Invalid enum value. Expected ${ze.joinValues(e.options)}, received '${e.received}'`;break;case X.invalid_arguments:a="Invalid function arguments";break;case X.invalid_return_type:a="Invalid function return type";break;case X.invalid_date:a="Invalid date";break;case X.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(a=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?a=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?a=`Invalid input: must end with "${e.validation.endsWith}"`:ze.assertNever(e.validation):e.validation!=="regex"?a=`Invalid ${e.validation}`:a="Invalid";break;case X.too_small:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?a=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:a="Invalid input";break;case X.too_big:e.type==="array"?a=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?a=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?a=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?a=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?a=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:a="Invalid input";break;case X.custom:a="Invalid input";break;case X.invalid_intersection_types:a="Intersection results could not be merged";break;case X.not_multiple_of:a=`Number must be a multiple of ${e.multipleOf}`;break;case X.not_finite:a="Number must be finite";break;default:a=r.defaultError,ze.assertNever(e)}return{message:a}};let k0=qi;function C0(){return k0}const P0=e=>{const{data:r,path:a,errorMaps:t,issueData:n}=e,i=[...a,...n.path||[]],s={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const l=t.filter(u=>!!u).slice().reverse();for(const u of l)o=u(s,{data:r,defaultError:o}).message;return{...n,path:i,message:o}};function le(e,r){const a=C0(),t=P0({issueData:r,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,a,a===qi?void 0:qi].filter(n=>!!n)});e.common.issues.push(t)}class bt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,a){const t=[];for(const n of a){if(n.status==="aborted")return Pe;n.status==="dirty"&&r.dirty(),t.push(n.value)}return{status:r.value,value:t}}static async mergeObjectAsync(r,a){const t=[];for(const n of a){const i=await n.key,s=await n.value;t.push({key:i,value:s})}return bt.mergeObjectSync(r,t)}static mergeObjectSync(r,a){const t={};for(const n of a){const{key:i,value:s}=n;if(i.status==="aborted"||s.status==="aborted")return Pe;i.status==="dirty"&&r.dirty(),s.status==="dirty"&&r.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||n.alwaysSet)&&(t[i.value]=s.value)}return{status:r.value,value:t}}}const Pe=Object.freeze({status:"aborted"}),Zi=e=>({status:"dirty",value:e}),Lt=e=>({status:"valid",value:e}),Lu=e=>e.status==="aborted",Fu=e=>e.status==="dirty",ea=e=>e.status==="valid",jn=e=>typeof Promise<"u"&&e instanceof Promise;var fe;(function(e){e.errToObj=r=>typeof r=="string"?{message:r}:r||{},e.toString=r=>typeof r=="string"?r:r==null?void 0:r.message})(fe||(fe={}));class Jt{constructor(r,a,t,n){this._cachedPath=[],this.parent=r,this.data=a,this._path=t,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Du=(e,r)=>{if(ea(r))return{success:!0,data:r.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const a=new nr(e.common.issues);return this._error=a,this._error}}};function Ie(e){if(!e)return{};const{errorMap:r,invalid_type_error:a,required_error:t,description:n}=e;if(r&&(a||t))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:n}:{errorMap:(i,s)=>{const{message:o}=e;return i.code==="invalid_enum_value"?{message:o??s.defaultError}:typeof s.data>"u"?{message:o??t??s.defaultError}:i.code!=="invalid_type"?{message:s.defaultError}:{message:o??a??s.defaultError}},description:n}}class Fe{get description(){return this._def.description}_getType(r){return _r(r.data)}_getOrReturnCtx(r,a){return a||{common:r.parent.common,data:r.data,parsedType:_r(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new bt,ctx:{common:r.parent.common,data:r.data,parsedType:_r(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){const a=this._parse(r);if(jn(a))throw new Error("Synchronous parse encountered promise.");return a}_parseAsync(r){const a=this._parse(r);return Promise.resolve(a)}parse(r,a){const t=this.safeParse(r,a);if(t.success)return t.data;throw t.error}safeParse(r,a){const t={common:{issues:[],async:(a==null?void 0:a.async)??!1,contextualErrorMap:a==null?void 0:a.errorMap},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:_r(r)},n=this._parseSync({data:r,path:t.path,parent:t});return Du(t,n)}"~validate"(r){var t,n;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:_r(r)};if(!this["~standard"].async)try{const i=this._parseSync({data:r,path:[],parent:a});return ea(i)?{value:i.value}:{issues:a.common.issues}}catch(i){(n=(t=i==null?void 0:i.message)==null?void 0:t.toLowerCase())!=null&&n.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:r,path:[],parent:a}).then(i=>ea(i)?{value:i.value}:{issues:a.common.issues})}async parseAsync(r,a){const t=await this.safeParseAsync(r,a);if(t.success)return t.data;throw t.error}async safeParseAsync(r,a){const t={common:{issues:[],contextualErrorMap:a==null?void 0:a.errorMap,async:!0},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:_r(r)},n=this._parse({data:r,path:t.path,parent:t}),i=await(jn(n)?n:Promise.resolve(n));return Du(t,i)}refine(r,a){const t=n=>typeof a=="string"||typeof a>"u"?{message:a}:typeof a=="function"?a(n):a;return this._refinement((n,i)=>{const s=r(n),o=()=>i.addIssue({code:X.custom,...t(n)});return typeof Promise<"u"&&s instanceof Promise?s.then(l=>l?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(r,a){return this._refinement((t,n)=>r(t)?!0:(n.addIssue(typeof a=="function"?a(t,n):a),!1))}_refinement(r){return new na({schema:this,typeName:ke.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return wr.create(this,this._def)}nullable(){return sa.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Xt.create(this)}promise(){return Pn.create(this,this._def)}or(r){return Sn.create([this,r],this._def)}and(r){return kn.create(this,r,this._def)}transform(r){return new na({...Ie(this._def),schema:this,typeName:ke.ZodEffects,effect:{type:"transform",transform:r}})}default(r){const a=typeof r=="function"?r:()=>r;return new Gi({...Ie(this._def),innerType:this,defaultValue:a,typeName:ke.ZodDefault})}brand(){return new J0({typeName:ke.ZodBranded,type:this,...Ie(this._def)})}catch(r){const a=typeof r=="function"?r:()=>r;return new Ji({...Ie(this._def),innerType:this,catchValue:a,typeName:ke.ZodCatch})}describe(r){const a=this.constructor;return new a({...this._def,description:r})}pipe(r){return Xi.create(this,r)}readonly(){return Yi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const N0=/^c[^\s-]{8,}$/i,$0=/^[0-9a-z]+$/,O0=/^[0-9A-HJKMNP-TV-Z]{26}$/i,R0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,I0=/^[a-z0-9_-]{21}$/i,T0=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,A0=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,L0=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,F0="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Bi;const D0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,M0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,z0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,U0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,H0=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,V0=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Mu="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",q0=new RegExp(`^${Mu}$`);function zu(e){let r="[0-5]\\d";e.precision?r=`${r}\\.\\d{${e.precision}}`:e.precision==null&&(r=`${r}(\\.\\d+)?`);const a=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${r})${a}`}function Z0(e){return new RegExp(`^${zu(e)}$`)}function B0(e){let r=`${Mu}T${zu(e)}`;const a=[];return a.push(e.local?"Z?":"Z"),e.offset&&a.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${a.join("|")})`,new RegExp(`^${r}$`)}function W0(e,r){return!!((r==="v4"||!r)&&D0.test(e)||(r==="v6"||!r)&&z0.test(e))}function K0(e,r){if(!T0.test(e))return!1;try{const[a]=e.split(".");if(!a)return!1;const t=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),n=JSON.parse(atob(t));return!(typeof n!="object"||n===null||"typ"in n&&(n==null?void 0:n.typ)!=="JWT"||!n.alg||r&&n.alg!==r)}catch{return!1}}function Q0(e,r){return!!((r==="v4"||!r)&&M0.test(e)||(r==="v6"||!r)&&U0.test(e))}class sr extends Fe{_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==pe.string){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_type,expected:pe.string,received:n.parsedType}),Pe}const a=new bt;let t;for(const n of this._def.checks)if(n.kind==="min")r.data.length<n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")r.data.length>n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){const i=r.data.length>n.value,s=r.data.length<n.value;(i||s)&&(t=this._getOrReturnCtx(r,t),i?le(t,{code:X.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):s&&le(t,{code:X.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")L0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"email",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")Bi||(Bi=new RegExp(F0,"u")),Bi.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"emoji",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")R0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"uuid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")I0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"nanoid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")N0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"cuid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")$0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"cuid2",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")O0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"ulid",code:X.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(r.data)}catch{t=this._getOrReturnCtx(r,t),le(t,{validation:"url",code:X.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"regex",code:X.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?r.data=r.data.trim():n.kind==="includes"?r.data.includes(n.value,n.position)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?r.data=r.data.toLowerCase():n.kind==="toUpperCase"?r.data=r.data.toUpperCase():n.kind==="startsWith"?r.data.startsWith(n.value)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?r.data.endsWith(n.value)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?B0(n).test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?q0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?Z0(n).test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{code:X.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?A0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"duration",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?W0(r.data,n.version)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"ip",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="jwt"?K0(r.data,n.alg)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"jwt",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="cidr"?Q0(r.data,n.version)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"cidr",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?H0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"base64",code:X.invalid_string,message:n.message}),a.dirty()):n.kind==="base64url"?V0.test(r.data)||(t=this._getOrReturnCtx(r,t),le(t,{validation:"base64url",code:X.invalid_string,message:n.message}),a.dirty()):ze.assertNever(n);return{status:a.value,value:r.data}}_regex(r,a,t){return this.refinement(n=>r.test(n),{validation:a,code:X.invalid_string,...fe.errToObj(t)})}_addCheck(r){return new sr({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...fe.errToObj(r)})}url(r){return this._addCheck({kind:"url",...fe.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...fe.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...fe.errToObj(r)})}nanoid(r){return this._addCheck({kind:"nanoid",...fe.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...fe.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...fe.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...fe.errToObj(r)})}base64(r){return this._addCheck({kind:"base64",...fe.errToObj(r)})}base64url(r){return this._addCheck({kind:"base64url",...fe.errToObj(r)})}jwt(r){return this._addCheck({kind:"jwt",...fe.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...fe.errToObj(r)})}cidr(r){return this._addCheck({kind:"cidr",...fe.errToObj(r)})}datetime(r){return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof(r==null?void 0:r.precision)>"u"?null:r==null?void 0:r.precision,offset:(r==null?void 0:r.offset)??!1,local:(r==null?void 0:r.local)??!1,...fe.errToObj(r==null?void 0:r.message)})}date(r){return this._addCheck({kind:"date",message:r})}time(r){return typeof r=="string"?this._addCheck({kind:"time",precision:null,message:r}):this._addCheck({kind:"time",precision:typeof(r==null?void 0:r.precision)>"u"?null:r==null?void 0:r.precision,...fe.errToObj(r==null?void 0:r.message)})}duration(r){return this._addCheck({kind:"duration",...fe.errToObj(r)})}regex(r,a){return this._addCheck({kind:"regex",regex:r,...fe.errToObj(a)})}includes(r,a){return this._addCheck({kind:"includes",value:r,position:a==null?void 0:a.position,...fe.errToObj(a==null?void 0:a.message)})}startsWith(r,a){return this._addCheck({kind:"startsWith",value:r,...fe.errToObj(a)})}endsWith(r,a){return this._addCheck({kind:"endsWith",value:r,...fe.errToObj(a)})}min(r,a){return this._addCheck({kind:"min",value:r,...fe.errToObj(a)})}max(r,a){return this._addCheck({kind:"max",value:r,...fe.errToObj(a)})}length(r,a){return this._addCheck({kind:"length",value:r,...fe.errToObj(a)})}nonempty(r){return this.min(1,fe.errToObj(r))}trim(){return new sr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new sr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new sr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isDate(){return!!this._def.checks.find(r=>r.kind==="date")}get isTime(){return!!this._def.checks.find(r=>r.kind==="time")}get isDuration(){return!!this._def.checks.find(r=>r.kind==="duration")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(r=>r.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get isCIDR(){return!!this._def.checks.find(r=>r.kind==="cidr")}get isBase64(){return!!this._def.checks.find(r=>r.kind==="base64")}get isBase64url(){return!!this._def.checks.find(r=>r.kind==="base64url")}get minLength(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxLength(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}}sr.create=e=>new sr({checks:[],typeName:ke.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Ie(e)});function G0(e,r){const a=(e.toString().split(".")[1]||"").length,t=(r.toString().split(".")[1]||"").length,n=a>t?a:t,i=Number.parseInt(e.toFixed(n).replace(".","")),s=Number.parseInt(r.toFixed(n).replace(".",""));return i%s/10**n}class ta extends Fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==pe.number){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_type,expected:pe.number,received:n.parsedType}),Pe}let a;const t=new bt;for(const n of this._def.checks)n.kind==="int"?ze.isInteger(r.data)||(a=this._getOrReturnCtx(r,a),le(a,{code:X.invalid_type,expected:"integer",received:"float",message:n.message}),t.dirty()):n.kind==="min"?(n.inclusive?r.data<n.value:r.data<=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?r.data>n.value:r.data>=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),t.dirty()):n.kind==="multipleOf"?G0(r.data,n.value)!==0&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):n.kind==="finite"?Number.isFinite(r.data)||(a=this._getOrReturnCtx(r,a),le(a,{code:X.not_finite,message:n.message}),t.dirty()):ze.assertNever(n);return{status:t.value,value:r.data}}gte(r,a){return this.setLimit("min",r,!0,fe.toString(a))}gt(r,a){return this.setLimit("min",r,!1,fe.toString(a))}lte(r,a){return this.setLimit("max",r,!0,fe.toString(a))}lt(r,a){return this.setLimit("max",r,!1,fe.toString(a))}setLimit(r,a,t,n){return new ta({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:t,message:fe.toString(n)}]})}_addCheck(r){return new ta({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:fe.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:fe.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:fe.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:fe.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:fe.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:fe.toString(a)})}finite(r){return this._addCheck({kind:"finite",message:fe.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:fe.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:fe.toString(r)})}get minValue(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&ze.isInteger(r.value))}get isFinite(){let r=null,a=null;for(const t of this._def.checks){if(t.kind==="finite"||t.kind==="int"||t.kind==="multipleOf")return!0;t.kind==="min"?(a===null||t.value>a)&&(a=t.value):t.kind==="max"&&(r===null||t.value<r)&&(r=t.value)}return Number.isFinite(a)&&Number.isFinite(r)}}ta.create=e=>new ta({checks:[],typeName:ke.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Ie(e)});class Oa extends Fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce)try{r.data=BigInt(r.data)}catch{return this._getInvalidInput(r)}if(this._getType(r)!==pe.bigint)return this._getInvalidInput(r);let a;const t=new bt;for(const n of this._def.checks)n.kind==="min"?(n.inclusive?r.data<n.value:r.data<=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="max"?(n.inclusive?r.data>n.value:r.data>=n.value)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),t.dirty()):n.kind==="multipleOf"?r.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(r,a),le(a,{code:X.not_multiple_of,multipleOf:n.value,message:n.message}),t.dirty()):ze.assertNever(n);return{status:t.value,value:r.data}}_getInvalidInput(r){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.bigint,received:a.parsedType}),Pe}gte(r,a){return this.setLimit("min",r,!0,fe.toString(a))}gt(r,a){return this.setLimit("min",r,!1,fe.toString(a))}lte(r,a){return this.setLimit("max",r,!0,fe.toString(a))}lt(r,a){return this.setLimit("max",r,!1,fe.toString(a))}setLimit(r,a,t,n){return new Oa({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:t,message:fe.toString(n)}]})}_addCheck(r){return new Oa({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:fe.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:fe.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:fe.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:fe.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:fe.toString(a)})}get minValue(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}}Oa.create=e=>new Oa({checks:[],typeName:ke.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Ie(e)});class Wi extends Fe{_parse(r){if(this._def.coerce&&(r.data=!!r.data),this._getType(r)!==pe.boolean){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.boolean,received:a.parsedType}),Pe}return Lt(r.data)}}Wi.create=e=>new Wi({typeName:ke.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Ie(e)});class En extends Fe{_parse(r){if(this._def.coerce&&(r.data=new Date(r.data)),this._getType(r)!==pe.date){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_type,expected:pe.date,received:n.parsedType}),Pe}if(Number.isNaN(r.data.getTime())){const n=this._getOrReturnCtx(r);return le(n,{code:X.invalid_date}),Pe}const a=new bt;let t;for(const n of this._def.checks)n.kind==="min"?r.data.getTime()<n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?r.data.getTime()>n.value&&(t=this._getOrReturnCtx(r,t),le(t,{code:X.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):ze.assertNever(n);return{status:a.value,value:new Date(r.data.getTime())}}_addCheck(r){return new En({...this._def,checks:[...this._def.checks,r]})}min(r,a){return this._addCheck({kind:"min",value:r.getTime(),message:fe.toString(a)})}max(r,a){return this._addCheck({kind:"max",value:r.getTime(),message:fe.toString(a)})}get minDate(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r!=null?new Date(r):null}get maxDate(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r!=null?new Date(r):null}}En.create=e=>new En({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:ke.ZodDate,...Ie(e)});class Uu extends Fe{_parse(r){if(this._getType(r)!==pe.symbol){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.symbol,received:a.parsedType}),Pe}return Lt(r.data)}}Uu.create=e=>new Uu({typeName:ke.ZodSymbol,...Ie(e)});class Hu extends Fe{_parse(r){if(this._getType(r)!==pe.undefined){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.undefined,received:a.parsedType}),Pe}return Lt(r.data)}}Hu.create=e=>new Hu({typeName:ke.ZodUndefined,...Ie(e)});class Vu extends Fe{_parse(r){if(this._getType(r)!==pe.null){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.null,received:a.parsedType}),Pe}return Lt(r.data)}}Vu.create=e=>new Vu({typeName:ke.ZodNull,...Ie(e)});class Ra extends Fe{constructor(){super(...arguments),this._any=!0}_parse(r){return Lt(r.data)}}Ra.create=e=>new Ra({typeName:ke.ZodAny,...Ie(e)});class qu extends Fe{constructor(){super(...arguments),this._unknown=!0}_parse(r){return Lt(r.data)}}qu.create=e=>new qu({typeName:ke.ZodUnknown,...Ie(e)});class br extends Fe{_parse(r){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.never,received:a.parsedType}),Pe}}br.create=e=>new br({typeName:ke.ZodNever,...Ie(e)});class Zu extends Fe{_parse(r){if(this._getType(r)!==pe.undefined){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.void,received:a.parsedType}),Pe}return Lt(r.data)}}Zu.create=e=>new Zu({typeName:ke.ZodVoid,...Ie(e)});class Xt extends Fe{_parse(r){const{ctx:a,status:t}=this._processInputParams(r),n=this._def;if(a.parsedType!==pe.array)return le(a,{code:X.invalid_type,expected:pe.array,received:a.parsedType}),Pe;if(n.exactLength!==null){const s=a.data.length>n.exactLength.value,o=a.data.length<n.exactLength.value;(s||o)&&(le(a,{code:s?X.too_big:X.too_small,minimum:o?n.exactLength.value:void 0,maximum:s?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),t.dirty())}if(n.minLength!==null&&a.data.length<n.minLength.value&&(le(a,{code:X.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),t.dirty()),n.maxLength!==null&&a.data.length>n.maxLength.value&&(le(a,{code:X.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),t.dirty()),a.common.async)return Promise.all([...a.data].map((s,o)=>n.type._parseAsync(new Jt(a,s,a.path,o)))).then(s=>bt.mergeArray(t,s));const i=[...a.data].map((s,o)=>n.type._parseSync(new Jt(a,s,a.path,o)));return bt.mergeArray(t,i)}get element(){return this._def.type}min(r,a){return new Xt({...this._def,minLength:{value:r,message:fe.toString(a)}})}max(r,a){return new Xt({...this._def,maxLength:{value:r,message:fe.toString(a)}})}length(r,a){return new Xt({...this._def,exactLength:{value:r,message:fe.toString(a)}})}nonempty(r){return this.min(1,r)}}Xt.create=(e,r)=>new Xt({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ke.ZodArray,...Ie(r)});function ra(e){if(e instanceof at){const r={};for(const a in e.shape){const t=e.shape[a];r[a]=wr.create(ra(t))}return new at({...e._def,shape:()=>r})}else return e instanceof Xt?new Xt({...e._def,type:ra(e.element)}):e instanceof wr?wr.create(ra(e.unwrap())):e instanceof sa?sa.create(ra(e.unwrap())):e instanceof Rr?Rr.create(e.items.map(r=>ra(r))):e}class at extends Fe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const r=this._def.shape(),a=ze.objectKeys(r);return this._cached={shape:r,keys:a},this._cached}_parse(r){if(this._getType(r)!==pe.object){const l=this._getOrReturnCtx(r);return le(l,{code:X.invalid_type,expected:pe.object,received:l.parsedType}),Pe}const{status:a,ctx:t}=this._processInputParams(r),{shape:n,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof br&&this._def.unknownKeys==="strip"))for(const l in t.data)i.includes(l)||s.push(l);const o=[];for(const l of i){const u=n[l],d=t.data[l];o.push({key:{status:"valid",value:l},value:u._parse(new Jt(t,d,t.path,l)),alwaysSet:l in t.data})}if(this._def.catchall instanceof br){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of s)o.push({key:{status:"valid",value:u},value:{status:"valid",value:t.data[u]}});else if(l==="strict")s.length>0&&(le(t,{code:X.unrecognized_keys,keys:s}),a.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of s){const d=t.data[u];o.push({key:{status:"valid",value:u},value:l._parse(new Jt(t,d,t.path,u)),alwaysSet:u in t.data})}}return t.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of o){const d=await u.key,p=await u.value;l.push({key:d,value:p,alwaysSet:u.alwaysSet})}return l}).then(l=>bt.mergeObjectSync(a,l)):bt.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(r){return fe.errToObj,new at({...this._def,unknownKeys:"strict",...r!==void 0?{errorMap:(a,t)=>{var i,s;const n=((s=(i=this._def).errorMap)==null?void 0:s.call(i,a,t).message)??t.defaultError;return a.code==="unrecognized_keys"?{message:fe.errToObj(r).message??n}:{message:n}}}:{}})}strip(){return new at({...this._def,unknownKeys:"strip"})}passthrough(){return new at({...this._def,unknownKeys:"passthrough"})}extend(r){return new at({...this._def,shape:()=>({...this._def.shape(),...r})})}merge(r){return new at({unknownKeys:r._def.unknownKeys,catchall:r._def.catchall,shape:()=>({...this._def.shape(),...r._def.shape()}),typeName:ke.ZodObject})}setKey(r,a){return this.augment({[r]:a})}catchall(r){return new at({...this._def,catchall:r})}pick(r){const a={};for(const t of ze.objectKeys(r))r[t]&&this.shape[t]&&(a[t]=this.shape[t]);return new at({...this._def,shape:()=>a})}omit(r){const a={};for(const t of ze.objectKeys(this.shape))r[t]||(a[t]=this.shape[t]);return new at({...this._def,shape:()=>a})}deepPartial(){return ra(this)}partial(r){const a={};for(const t of ze.objectKeys(this.shape)){const n=this.shape[t];r&&!r[t]?a[t]=n:a[t]=n.optional()}return new at({...this._def,shape:()=>a})}required(r){const a={};for(const t of ze.objectKeys(this.shape))if(r&&!r[t])a[t]=this.shape[t];else{let n=this.shape[t];for(;n instanceof wr;)n=n._def.innerType;a[t]=n}return new at({...this._def,shape:()=>a})}keyof(){return Ku(ze.objectKeys(this.shape))}}at.create=(e,r)=>new at({shape:()=>e,unknownKeys:"strip",catchall:br.create(),typeName:ke.ZodObject,...Ie(r)}),at.strictCreate=(e,r)=>new at({shape:()=>e,unknownKeys:"strict",catchall:br.create(),typeName:ke.ZodObject,...Ie(r)}),at.lazycreate=(e,r)=>new at({shape:e,unknownKeys:"strip",catchall:br.create(),typeName:ke.ZodObject,...Ie(r)});class Sn extends Fe{_parse(r){const{ctx:a}=this._processInputParams(r),t=this._def.options;function n(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return a.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(o=>new nr(o.ctx.common.issues));return le(a,{code:X.invalid_union,unionErrors:s}),Pe}if(a.common.async)return Promise.all(t.map(async i=>{const s={...a,common:{...a.common,issues:[]},parent:null};return{result:await i._parseAsync({data:a.data,path:a.path,parent:s}),ctx:s}})).then(n);{let i;const s=[];for(const l of t){const u={...a,common:{...a.common,issues:[]},parent:null},d=l._parseSync({data:a.data,path:a.path,parent:u});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(i)return a.common.issues.push(...i.ctx.common.issues),i.result;const o=s.map(l=>new nr(l));return le(a,{code:X.invalid_union,unionErrors:o}),Pe}}get options(){return this._def.options}}Sn.create=(e,r)=>new Sn({options:e,typeName:ke.ZodUnion,...Ie(r)});function Ki(e,r){const a=_r(e),t=_r(r);if(e===r)return{valid:!0,data:e};if(a===pe.object&&t===pe.object){const n=ze.objectKeys(r),i=ze.objectKeys(e).filter(o=>n.indexOf(o)!==-1),s={...e,...r};for(const o of i){const l=Ki(e[o],r[o]);if(!l.valid)return{valid:!1};s[o]=l.data}return{valid:!0,data:s}}else if(a===pe.array&&t===pe.array){if(e.length!==r.length)return{valid:!1};const n=[];for(let i=0;i<e.length;i++){const s=e[i],o=r[i],l=Ki(s,o);if(!l.valid)return{valid:!1};n.push(l.data)}return{valid:!0,data:n}}else return a===pe.date&&t===pe.date&&+e==+r?{valid:!0,data:e}:{valid:!1}}class kn extends Fe{_parse(r){const{status:a,ctx:t}=this._processInputParams(r),n=(i,s)=>{if(Lu(i)||Lu(s))return Pe;const o=Ki(i.value,s.value);return o.valid?((Fu(i)||Fu(s))&&a.dirty(),{status:a.value,value:o.data}):(le(t,{code:X.invalid_intersection_types}),Pe)};return t.common.async?Promise.all([this._def.left._parseAsync({data:t.data,path:t.path,parent:t}),this._def.right._parseAsync({data:t.data,path:t.path,parent:t})]).then(([i,s])=>n(i,s)):n(this._def.left._parseSync({data:t.data,path:t.path,parent:t}),this._def.right._parseSync({data:t.data,path:t.path,parent:t}))}}kn.create=(e,r,a)=>new kn({left:e,right:r,typeName:ke.ZodIntersection,...Ie(a)});class Rr extends Fe{_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==pe.array)return le(t,{code:X.invalid_type,expected:pe.array,received:t.parsedType}),Pe;if(t.data.length<this._def.items.length)return le(t,{code:X.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Pe;!this._def.rest&&t.data.length>this._def.items.length&&(le(t,{code:X.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());const n=[...t.data].map((i,s)=>{const o=this._def.items[s]||this._def.rest;return o?o._parse(new Jt(t,i,t.path,s)):null}).filter(i=>!!i);return t.common.async?Promise.all(n).then(i=>bt.mergeArray(a,i)):bt.mergeArray(a,n)}get items(){return this._def.items}rest(r){return new Rr({...this._def,rest:r})}}Rr.create=(e,r)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Rr({items:e,typeName:ke.ZodTuple,rest:null,...Ie(r)})};class Cn extends Fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==pe.object)return le(t,{code:X.invalid_type,expected:pe.object,received:t.parsedType}),Pe;const n=[],i=this._def.keyType,s=this._def.valueType;for(const o in t.data)n.push({key:i._parse(new Jt(t,o,t.path,o)),value:s._parse(new Jt(t,t.data[o],t.path,o)),alwaysSet:o in t.data});return t.common.async?bt.mergeObjectAsync(a,n):bt.mergeObjectSync(a,n)}get element(){return this._def.valueType}static create(r,a,t){return a instanceof Fe?new Cn({keyType:r,valueType:a,typeName:ke.ZodRecord,...Ie(t)}):new Cn({keyType:sr.create(),valueType:r,typeName:ke.ZodRecord,...Ie(a)})}}class Bu extends Fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==pe.map)return le(t,{code:X.invalid_type,expected:pe.map,received:t.parsedType}),Pe;const n=this._def.keyType,i=this._def.valueType,s=[...t.data.entries()].map(([o,l],u)=>({key:n._parse(new Jt(t,o,t.path,[u,"key"])),value:i._parse(new Jt(t,l,t.path,[u,"value"]))}));if(t.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of s){const u=await l.key,d=await l.value;if(u.status==="aborted"||d.status==="aborted")return Pe;(u.status==="dirty"||d.status==="dirty")&&a.dirty(),o.set(u.value,d.value)}return{status:a.value,value:o}})}else{const o=new Map;for(const l of s){const u=l.key,d=l.value;if(u.status==="aborted"||d.status==="aborted")return Pe;(u.status==="dirty"||d.status==="dirty")&&a.dirty(),o.set(u.value,d.value)}return{status:a.value,value:o}}}}Bu.create=(e,r,a)=>new Bu({valueType:r,keyType:e,typeName:ke.ZodMap,...Ie(a)});class Ia extends Fe{_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.parsedType!==pe.set)return le(t,{code:X.invalid_type,expected:pe.set,received:t.parsedType}),Pe;const n=this._def;n.minSize!==null&&t.data.size<n.minSize.value&&(le(t,{code:X.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),a.dirty()),n.maxSize!==null&&t.data.size>n.maxSize.value&&(le(t,{code:X.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),a.dirty());const i=this._def.valueType;function s(l){const u=new Set;for(const d of l){if(d.status==="aborted")return Pe;d.status==="dirty"&&a.dirty(),u.add(d.value)}return{status:a.value,value:u}}const o=[...t.data.values()].map((l,u)=>i._parse(new Jt(t,l,t.path,u)));return t.common.async?Promise.all(o).then(l=>s(l)):s(o)}min(r,a){return new Ia({...this._def,minSize:{value:r,message:fe.toString(a)}})}max(r,a){return new Ia({...this._def,maxSize:{value:r,message:fe.toString(a)}})}size(r,a){return this.min(r,a).max(r,a)}nonempty(r){return this.min(1,r)}}Ia.create=(e,r)=>new Ia({valueType:e,minSize:null,maxSize:null,typeName:ke.ZodSet,...Ie(r)});class Wu extends Fe{get schema(){return this._def.getter()}_parse(r){const{ctx:a}=this._processInputParams(r);return this._def.getter()._parse({data:a.data,path:a.path,parent:a})}}Wu.create=(e,r)=>new Wu({getter:e,typeName:ke.ZodLazy,...Ie(r)});class Qi extends Fe{_parse(r){if(r.data!==this._def.value){const a=this._getOrReturnCtx(r);return le(a,{received:a.data,code:X.invalid_literal,expected:this._def.value}),Pe}return{status:"valid",value:r.data}}get value(){return this._def.value}}Qi.create=(e,r)=>new Qi({value:e,typeName:ke.ZodLiteral,...Ie(r)});function Ku(e,r){return new aa({values:e,typeName:ke.ZodEnum,...Ie(r)})}class aa extends Fe{_parse(r){if(typeof r.data!="string"){const a=this._getOrReturnCtx(r),t=this._def.values;return le(a,{expected:ze.joinValues(t),received:a.parsedType,code:X.invalid_type}),Pe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(r.data)){const a=this._getOrReturnCtx(r),t=this._def.values;return le(a,{received:a.data,code:X.invalid_enum_value,options:t}),Pe}return Lt(r.data)}get options(){return this._def.values}get enum(){const r={};for(const a of this._def.values)r[a]=a;return r}get Values(){const r={};for(const a of this._def.values)r[a]=a;return r}get Enum(){const r={};for(const a of this._def.values)r[a]=a;return r}extract(r,a=this._def){return aa.create(r,{...this._def,...a})}exclude(r,a=this._def){return aa.create(this.options.filter(t=>!r.includes(t)),{...this._def,...a})}}aa.create=Ku;class Qu extends Fe{_parse(r){const a=ze.getValidEnumValues(this._def.values),t=this._getOrReturnCtx(r);if(t.parsedType!==pe.string&&t.parsedType!==pe.number){const n=ze.objectValues(a);return le(t,{expected:ze.joinValues(n),received:t.parsedType,code:X.invalid_type}),Pe}if(this._cache||(this._cache=new Set(ze.getValidEnumValues(this._def.values))),!this._cache.has(r.data)){const n=ze.objectValues(a);return le(t,{received:t.data,code:X.invalid_enum_value,options:n}),Pe}return Lt(r.data)}get enum(){return this._def.values}}Qu.create=(e,r)=>new Qu({values:e,typeName:ke.ZodNativeEnum,...Ie(r)});class Pn extends Fe{unwrap(){return this._def.type}_parse(r){const{ctx:a}=this._processInputParams(r);if(a.parsedType!==pe.promise&&a.common.async===!1)return le(a,{code:X.invalid_type,expected:pe.promise,received:a.parsedType}),Pe;const t=a.parsedType===pe.promise?a.data:Promise.resolve(a.data);return Lt(t.then(n=>this._def.type.parseAsync(n,{path:a.path,errorMap:a.common.contextualErrorMap})))}}Pn.create=(e,r)=>new Pn({type:e,typeName:ke.ZodPromise,...Ie(r)});class na extends Fe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ke.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){const{status:a,ctx:t}=this._processInputParams(r),n=this._def.effect||null,i={addIssue:s=>{le(t,s),s.fatal?a.abort():a.dirty()},get path(){return t.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const s=n.transform(t.data,i);if(t.common.async)return Promise.resolve(s).then(async o=>{if(a.value==="aborted")return Pe;const l=await this._def.schema._parseAsync({data:o,path:t.path,parent:t});return l.status==="aborted"?Pe:l.status==="dirty"||a.value==="dirty"?Zi(l.value):l});{if(a.value==="aborted")return Pe;const o=this._def.schema._parseSync({data:s,path:t.path,parent:t});return o.status==="aborted"?Pe:o.status==="dirty"||a.value==="dirty"?Zi(o.value):o}}if(n.type==="refinement"){const s=o=>{const l=n.refinement(o,i);if(t.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(t.common.async===!1){const o=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});return o.status==="aborted"?Pe:(o.status==="dirty"&&a.dirty(),s(o.value),{status:a.value,value:o.value})}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(o=>o.status==="aborted"?Pe:(o.status==="dirty"&&a.dirty(),s(o.value).then(()=>({status:a.value,value:o.value}))))}if(n.type==="transform")if(t.common.async===!1){const s=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});if(!ea(s))return Pe;const o=n.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:a.value,value:o}}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(s=>ea(s)?Promise.resolve(n.transform(s.value,i)).then(o=>({status:a.value,value:o})):Pe);ze.assertNever(n)}}na.create=(e,r,a)=>new na({schema:e,typeName:ke.ZodEffects,effect:r,...Ie(a)}),na.createWithPreprocess=(e,r,a)=>new na({schema:r,effect:{type:"preprocess",transform:e},typeName:ke.ZodEffects,...Ie(a)});class wr extends Fe{_parse(r){return this._getType(r)===pe.undefined?Lt(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}wr.create=(e,r)=>new wr({innerType:e,typeName:ke.ZodOptional,...Ie(r)});class sa extends Fe{_parse(r){return this._getType(r)===pe.null?Lt(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}sa.create=(e,r)=>new sa({innerType:e,typeName:ke.ZodNullable,...Ie(r)});class Gi extends Fe{_parse(r){const{ctx:a}=this._processInputParams(r);let t=a.data;return a.parsedType===pe.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:a.path,parent:a})}removeDefault(){return this._def.innerType}}Gi.create=(e,r)=>new Gi({innerType:e,typeName:ke.ZodDefault,defaultValue:typeof r.default=="function"?r.default:()=>r.default,...Ie(r)});class Ji extends Fe{_parse(r){const{ctx:a}=this._processInputParams(r),t={...a,common:{...a.common,issues:[]}},n=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return jn(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new nr(t.common.issues)},input:t.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new nr(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}}Ji.create=(e,r)=>new Ji({innerType:e,typeName:ke.ZodCatch,catchValue:typeof r.catch=="function"?r.catch:()=>r.catch,...Ie(r)});class Gu extends Fe{_parse(r){if(this._getType(r)!==pe.nan){const a=this._getOrReturnCtx(r);return le(a,{code:X.invalid_type,expected:pe.nan,received:a.parsedType}),Pe}return{status:"valid",value:r.data}}}Gu.create=e=>new Gu({typeName:ke.ZodNaN,...Ie(e)});class J0 extends Fe{_parse(r){const{ctx:a}=this._processInputParams(r),t=a.data;return this._def.type._parse({data:t,path:a.path,parent:a})}unwrap(){return this._def.type}}class Xi extends Fe{_parse(r){const{status:a,ctx:t}=this._processInputParams(r);if(t.common.async)return(async()=>{const n=await this._def.in._parseAsync({data:t.data,path:t.path,parent:t});return n.status==="aborted"?Pe:n.status==="dirty"?(a.dirty(),Zi(n.value)):this._def.out._parseAsync({data:n.value,path:t.path,parent:t})})();{const n=this._def.in._parseSync({data:t.data,path:t.path,parent:t});return n.status==="aborted"?Pe:n.status==="dirty"?(a.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:t.path,parent:t})}}static create(r,a){return new Xi({in:r,out:a,typeName:ke.ZodPipeline})}}class Yi extends Fe{_parse(r){const a=this._def.innerType._parse(r),t=n=>(ea(n)&&(n.value=Object.freeze(n.value)),n);return jn(a)?a.then(n=>t(n)):t(a)}unwrap(){return this._def.innerType}}Yi.create=(e,r)=>new Yi({innerType:e,typeName:ke.ZodReadonly,...Ie(r)});function Ju(e,r){const a=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e;return typeof a=="string"?{message:a}:a}function X0(e,r={},a){return e?Ra.create().superRefine((t,n)=>{const i=e(t);if(i instanceof Promise)return i.then(s=>{if(!s){const o=Ju(r,t),l=o.fatal??a??!0;n.addIssue({code:"custom",...o,fatal:l})}});if(!i){const s=Ju(r,t),o=s.fatal??a??!0;n.addIssue({code:"custom",...s,fatal:o})}}):Ra.create()}var ke;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(ke||(ke={}));const xr=sr.create,Ta=ta.create,ia=Wi.create;Ra.create,br.create;const Y0=Xt.create,Ir=at.create,jr=Sn.create;kn.create,Rr.create;const Nn=Cn.create,wt=Qi.create;aa.create,Pn.create,wr.create,sa.create;function eb(e){return typeof e=="object"&&e!==null&&"_def"in e&&e._def.typeName==="ZodObject"}function tb(e){return typeof e=="object"&&e!==null&&"_def"in e&&e._def.typeName==="ZodLiteral"}const rb=hn.shape.content._def.innerType.element,$n=rb.options.map(e=>{if(eb(e)&&"type"in e.shape&&tb(e.shape.type))return e.shape.type.value;throw new Error("Internal error: Invalid option found in CallToolResultContentSchema's union. Expected ZodObject with ZodLiteral 'type'.")}),ab=$n.map(e=>wt(e));jr(ab);const nb=jr([wt("content").describe("Put tool output into the ToolMessage.content array"),wt("artifact").describe("Put tool output into the ToolMessage.artifact array")]),sb=Ir(Object.fromEntries($n.map(e=>[e,jr([wt("content").describe(`Put all ${e} tool output into the ToolMessage.content array`),wt("artifact").describe(`Put all ${e} tool output into the ToolMessage.artifact array`)]).describe(`Where to place ${e} tool output in the LangChain ToolMessage`).optional()]))),ib=jr([nb,sb]).describe("Defines where to place each tool output type in the LangChain ToolMessage.\n\nItems in the `content` field will be used as input context for the LLM, while the artifact field is\nused for capturing tool output that won't be shown to the model, to be used in some later workflow\nstep.\n\nFor example, imagine that you have a SQL query tool that can return huge result sets. Rather than\nsending these large outputs directly to the model, perhaps you want the model to be able to inspect\nthe output in a code execution environment. In this case, you would set the output handling for the\n`resource` type to `artifact` (it's default value), and then upon initialization of your code\nexecution environment, you would look through your message history for `ToolMessage`s with the\n`artifact` field set to `resource`, and use the `content` field during initialization of the\nenvironment."),ob=X0(e=>{if(!e||typeof e!="object")return!1;const r=["redirectUrl","clientMetadata","clientInformation","tokens","saveTokens"];if(!("redirectUrl"in e)||!("clientMetadata"in e))return!1;for(const a of r)if(!(a in e))return!1;return!0},{message:"Must be a valid OAuthClientProvider implementation with required properties: redirectUrl, clientMetadata, clientInformation, tokens, saveTokens"}),eo=Ir({outputHandling:ib.optional(),defaultToolTimeout:Ta().min(1).optional()}),lb=Ir({enabled:ia().describe("Whether to automatically restart the process if it exits").optional(),maxAttempts:Ta().describe("The maximum number of restart attempts").optional(),delayMs:Ta().describe("The delay in milliseconds between restart attempts").optional()}).describe("Configuration for stdio transport restart"),cb=Ir({transport:wt("stdio").optional(),type:wt("stdio").optional(),command:xr().describe("The executable to run the server"),args:Y0(xr()).describe("Command line arguments to pass to the executable"),env:Nn(xr()).describe("The environment to use when spawning the process").optional(),encoding:xr().describe("The encoding to use when reading from the process").optional(),stderr:jr([wt("overlapped"),wt("pipe"),wt("ignore"),wt("inherit")]).describe("How to handle stderr of the child process. This matches the semantics of Node's `child_process.spawn`").optional().default("inherit"),cwd:xr().describe("The working directory to use when spawning the process").optional(),restart:lb.optional()}).and(eo).describe("Configuration for stdio transport connection"),db=Ir({enabled:ia().describe("Whether to automatically reconnect if the connection is lost").optional(),maxAttempts:Ta().describe("The maximum number of reconnection attempts").optional(),delayMs:Ta().describe("The delay in milliseconds between reconnection attempts").optional()}).describe("Configuration for streamable HTTP transport reconnection"),ub=Ir({transport:jr([wt("http"),wt("sse")]).optional(),type:jr([wt("http"),wt("sse")]).optional(),url:xr().url(),headers:Nn(xr()).optional(),authProvider:ob.optional(),reconnect:db.optional(),automaticSSEFallback:ia().optional().default(!0)}).and(eo).describe("Configuration for streamable HTTP transport connection"),Xu=jr([cb,ub]).describe("Configuration for a single MCP server"),hb=Ir({mcpServers:Nn(Xu).describe("A map of server names to their configuration"),throwOnLoadError:ia().describe("Whether to throw an error if a tool fails to load").optional().default(!0),prefixToolNameWithServerName:ia().describe("Whether to prefix tool names with the server name").optional().default(!1),additionalToolNamePrefix:xr().describe("An additional prefix to add to the tool name").optional().default(""),useStandardContentBlocks:ia().describe("If true, the tool will use LangChain's standard multimodal content blocks for tools that output\nimage or audio content. When true, embedded resources will be converted to `StandardFileBlock`\nobjects. When `false`, all artifacts are left in their MCP format, but embedded resources will\nbe converted to `StandardFileBlock` objects if `outputHandling` causes embedded resources to be\ntreated as content, as otherwise ChatModel providers will not be able to interpret them.").optional().default(!1)}).and(eo).describe("Configuration for the MCP client");function to(e,r=!1){if(e==null)return{};if(typeof e=="string")return Object.fromEntries($n.map(t=>[t,e]));const a={};for(const t of $n)(e[t]||r)&&(a[t]=e[t]??(t==="resource"?"artifact":"content"));return a}function pb(e,r){const a=to(e),t=to(r);return{...a,...t}}let ro;function Aa(){return ro||(ro=Tu("@langchain/mcp-adapters:tools")),ro}class La extends Error{constructor(r){super(r),this.name="ToolException"}}function mb(e){return typeof e=="object"&&e!==null&&"name"in e&&e.name==="ToolException"}function fb(e){return typeof e=="object"&&e!==null&&e.uri!=null&&e.blob==null&&e.text==null}async function*Yu(e,r){if(fb(e)){const a=await r.readResource({uri:e.uri});for(const t of a.contents)yield*Yu(t,r);return}e.blob!=null&&(yield{type:"file",source_type:"base64",data:e.blob,mime_type:e.mimeType,...e.uri!=null?{metadata:{uri:e.uri}}:{}}),e.text!=null&&(yield{type:"file",source_type:"text",mime_type:e.mimeType,text:e.text,...e.uri!=null?{metadata:{uri:e.uri}}:{}})}async function eh(e,r,a,t,n){const i=[];switch(e.type){case"text":return[{type:"text",...r?{source_type:"text"}:{},text:e.text}];case"image":return r?[{type:"image",source_type:"base64",data:e.data,mime_type:e.mimeType}]:[{type:"image_url",image_url:{url:`data:${e.mimeType};base64,${e.data}`}}];case"audio":return[{type:"audio",source_type:"base64",data:e.data,mime_type:e.mimeType}];case"resource":for await(const s of Yu(e.resource,a))i.push(s);return i;default:throw new La(`MCP tool '${t}' on server '${n}' returned a content block with unexpected type "${e.type}." Expected one of "text", "image", or "audio".`)}}async function vb(e,r,a,t,n){return r?eh(e,r,a,t,n):!e.blob&&!e.text&&e.uri?(await a.readResource({uri:e.resource.uri})).contents.map(i=>({type:"resource",resource:{...i}})):[e]}function th(e,r){return r==="content"||r==="artifact"?r:to(r)[e]??(e==="resource"?"artifact":"content")}async function gb({serverName:e,toolName:r,result:a,client:t,useStandardContentBlocks:n,outputHandling:i}){if(!a)throw new La(`MCP tool '${r}' on server '${e}' returned an invalid result - tool call response was undefined`);if(!Array.isArray(a.content))throw new La(`MCP tool '${r}' on server '${e}' returned an invalid result - expected an array of content, but was ${typeof a.content}`);if(a.isError)throw new La(`MCP tool '${r}' on server '${e}' returned an error: ${a.content.map(l=>l.text).join(`
`)}`);const s=(await Promise.all(a.content.filter(l=>th(l.type,i)==="content").map(l=>eh(l,n,t,r,e)))).flat(),o=(await Promise.all(a.content.filter(l=>th(l.type,i)==="artifact").map(l=>vb(l,n,t,r,e)))).flat();return s.length===1&&s[0].type==="text"?[s[0].text,o]:[s,o]}async function yb({serverName:e,toolName:r,client:a,args:t,config:n,useStandardContentBlocks:i,outputHandling:s}){try{Aa()(`INFO: Calling tool ${r}(${JSON.stringify(t)})`);const o={...n!=null&&n.timeout?{timeout:n.timeout}:{},...n!=null&&n.signal?{signal:n.signal}:{}},l=[{name:r,arguments:t}];Object.keys(o).length>0&&(l.push(void 0),l.push(o));const u=await a.callTool(...l);return gb({serverName:e,toolName:r,result:u,client:a,useStandardContentBlocks:i,outputHandling:s})}catch(o){throw Aa()(`Error calling tool ${r}: ${String(o)}`),mb(o)?o:new La(`Error calling tool ${r}: ${String(o)}`)}}const _b={throwOnLoadError:!0,prefixToolNameWithServerName:!1,additionalToolNamePrefix:"",useStandardContentBlocks:!1};async function bb(e,r,a){const{throwOnLoadError:t,prefixToolNameWithServerName:n,additionalToolNamePrefix:i,useStandardContentBlocks:s,outputHandling:o,defaultToolTimeout:l}={..._b,...a??{}},u=[];let d;do d=await r.listTools({...d!=null&&d.nextCursor?{cursor:d.nextCursor}:{}}),u.push(...d.tools||[]);while(d.nextCursor);Aa()(`INFO: Found ${u.length} MCP tools`);const p=i?`${i}__`:"",h=n?`${e}__`:"",v=`${p}${h}`;return(await Promise.all(u.filter(f=>!!f.name).map(async f=>{try{f.inputSchema.properties||(f.inputSchema.properties={});const m=new tm({name:`${v}${f.name}`,description:f.description||"",schema:f.inputSchema,responseFormat:"content_and_artifact",metadata:{annotations:f.annotations},defaultConfig:l?{timeout:l}:void 0,func:async(g,w,S)=>yb({serverName:e,toolName:f.name,client:r,args:g,config:S,useStandardContentBlocks:s,outputHandling:o})});return Aa()(`INFO: Successfully loaded tool: ${m.name}`),m}catch(m){if(Aa()(`ERROR: Failed to load tool "${f.name}":`,m),t)throw m;return null}}))).filter(Boolean)}var wb={};let ao;function et(){return ao||(ao=Tu("@langchain/mcp-adapters:client")),ao}class Ct extends Error{constructor(r,a){super(r),Object.defineProperty(this,"serverName",{enumerable:!0,configurable:!0,writable:!0,value:a}),this.name="MCPClientError"}}function rh(e){return typeof e!="object"||e===null||Array.isArray(e)?!1:"transport"in e&&e.transport==="stdio"||"type"in e&&e.type==="stdio"||"command"in e&&typeof e.command=="string"}function ah(e){if(typeof e!="object"||e===null||Array.isArray(e))return!1;if("transport"in e&&typeof e.transport=="string"&&["http","sse"].includes(e.transport)||"type"in e&&typeof e.type=="string"&&["http","sse"].includes(e.type))return!0;if("url"in e&&typeof e.url=="string")try{return new URL(e.url),!0}catch{return!1}return!1}class xb{get config(){return JSON.parse(JSON.stringify(this._config))}constructor(r){Object.defineProperty(this,"_clients",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_serverNameToTools",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_connections",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_loadToolsOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_cleanupFunctions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_transportInstances",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let a;const t=hb;if("mcpServers"in r)a=t.parse(r);else{const n=Nn(Xu).parse(r);a=t.parse({mcpServers:n})}if(Object.keys(a.mcpServers).length===0)throw new Ct("No MCP servers provided");for(const[n,i]of Object.entries(a.mcpServers)){const s=pb(a.outputHandling,i.outputHandling),o=a.defaultToolTimeout??i.defaultToolTimeout;this._loadToolsOptions[n]={throwOnLoadError:a.throwOnLoadError,prefixToolNameWithServerName:a.prefixToolNameWithServerName,additionalToolNamePrefix:a.additionalToolNamePrefix,useStandardContentBlocks:a.useStandardContentBlocks,...Object.keys(s).length>0?{outputHandling:s}:{},...o?{defaultToolTimeout:o}:{}}}this._config=a,this._connections=a.mcpServers}async initializeConnections(){if(!this._connections||Object.keys(this._connections).length===0)throw new Ct("No connections to initialize");const r=Array.from(Object.entries(this._connections).filter(([a])=>this._clients[a]===void 0));for(const[a,t]of r)if(et()(`INFO: Initializing connection to server "${a}"...`),rh(t))await this._initializeStdioConnection(a,t);else if(ah(t))t.type==="sse"||t.transport==="sse"?await this._initializeSSEConnection(a,t):await this._initializeStreamableHTTPConnection(a,t);else throw new Ct(`Unsupported transport type for server "${a}"`,a);return this._serverNameToTools}async getTools(...r){return await this.initializeConnections(),r.length===0?this._getAllToolsAsFlatArray():this._getToolsFromServers(r)}async getClient(r){return await this.initializeConnections(),this._clients[r]}async close(){et()("INFO: Closing all MCP connections...");for(const r of this._cleanupFunctions)try{await r()}catch(a){et()(`ERROR: Error during cleanup: ${a}`)}this._cleanupFunctions=[],this._clients={},this._serverNameToTools={},this._transportInstances={},et()("INFO: All MCP connections closed")}async _initializeStdioConnection(r,a){const{command:t,args:n,env:i,restart:s,stderr:o}=a;et()(`DEBUG: Creating stdio transport for server "${r}" with command: ${t} ${n.join(" ")}`);const l=new L_({command:t,args:n,stderr:o,...i?{env:{PATH:wb.PATH,...i}}:{}});this._transportInstances[r]=l;const u=new Hs({name:"langchain-mcp-adapter",version:"0.1.0"});try{await u.connect(l),s!=null&&s.enabled&&this._setupStdioRestart(r,l,a,s)}catch(p){throw new Ct(`Failed to connect to stdio server "${r}": ${p}`,r)}this._clients[r]=u;const d=async()=>{et()(`DEBUG: Closing stdio transport for server "${r}"`),await l.close()};this._cleanupFunctions.push(d),await this._loadToolsForServer(r,u)}_setupStdioRestart(r,a,t,n){const i=a.onclose;a.onclose=async()=>{i&&await i(),this._clients[r]&&(et()(`INFO: Process for server "${r}" exited, attempting to restart...`),await this._attemptReconnect(r,t,n.maxAttempts,n.delayMs))}}_getHttpErrorCode(r){const a=r;let{code:t}=a;if(t==null){const n=a.message.match(/\(HTTP (\d\d\d)\)/);n&&n.length>1&&(t=parseInt(n[1],10))}return t}_createAuthenticationErrorMessage(r,a,t,n){return`Authentication failed for ${t} server "${r}" at ${a}. Please check your credentials, authorization headers, or OAuth configuration. Original error: ${n}`}_toSSEConnectionURL(r){const a=new URL(r),t=a.pathname.split("/"),n=t.at(-1);return n&&n==="mcp"&&(t[t.length-1]="sse"),a.pathname=t.join("/"),a.toString()}async _initializeStreamableHTTPConnection(r,a){const{url:t,headers:n,reconnect:i,type:s,transport:o,authProvider:l}=a,u=a.automaticSSEFallback??!0,d=s||o;if(et()(`DEBUG: Creating Streamable HTTP transport for server "${r}" with URL: ${t}`),d==="http"||d==null){const p=await this._createStreamableHTTPTransport(r,t,n,i,l);this._transportInstances[r]=p;const h=new Hs({name:"langchain-mcp-adapter",version:"0.1.0"});try{await h.connect(p),this._clients[r]=h;const v=async()=>{et()(`DEBUG: Closing streamable HTTP transport for server "${r}"`),await p.close()};this._cleanupFunctions.push(v),await this._loadToolsForServer(r,h)}catch(v){const f=this._getHttpErrorCode(v);if(u&&f!=null&&f>=400&&f<500)try{await this._initializeSSEConnection(r,a)}catch(m){const g=this._toSSEConnectionURL(t);if(g!==t)try{await this._initializeSSEConnection(r,{...a,url:g})}catch(w){throw f===401?new Ct(this._createAuthenticationErrorMessage(r,t,"HTTP",`${v}. Also tried SSE fallback at ${t} and ${g}, but both failed with authentication errors.`),r):new Ct(`Failed to connect to streamable HTTP server "${r}, url: ${t}": ${v}. Additionally, tried falling back to SSE at ${t} and ${g}, but this also failed: ${w}`,r)}else throw f===401?new Ct(this._createAuthenticationErrorMessage(r,t,"HTTP",`${v}. Also tried SSE fallback at ${t}, but it failed with authentication error: ${m}`),r):new Ct(`Failed to connect to streamable HTTP server after trying to fall back to SSE: "${r}, url: ${t}": ${v} (SSE fallback failed with error ${m})`,r)}else throw f===401?new Ct(this._createAuthenticationErrorMessage(r,t,"HTTP",`${v}`),r):new Ct(`Failed to connect to streamable HTTP server "${r}, url: ${t}": ${v}`,r)}}}async _initializeSSEConnection(r,a){const{url:t,headers:n,reconnect:i,authProvider:s}=a;try{const o=await this._createSSETransport(r,t,n,s);this._transportInstances[r]=o;const l=new Hs({name:"langchain-mcp-adapter",version:"0.1.0"});try{await l.connect(o),i!=null&&i.enabled&&this._setupSSEReconnect(r,o,a,i)}catch(d){throw d&&d.name==="MCPClientError"?d:d&&this._getHttpErrorCode(d)===401?new Ct(this._createAuthenticationErrorMessage(r,t,"SSE",`${d}`),r):new Ct(`Failed to create SSE transport for server "${r}, url: ${t}": ${d}`,r)}this._clients[r]=l;const u=async()=>{et()(`DEBUG: Closing SSE transport for server "${r}"`),await o.close()};this._cleanupFunctions.push(u),await this._loadToolsForServer(r,l)}catch(o){throw new Ct(`Failed to create SSE transport for server "${r}, url: ${t}": ${o}`,r)}}async _createSSETransport(r,a,t,n){const i={};return n&&(i.authProvider=n,et()(`DEBUG: Using OAuth authentication for SSE transport to server "${r}"`)),t&&(i.eventSourceInit={fetch:async(s,o)=>{const l=new Headers(o==null?void 0:o.headers);if(n){const u=await n.tokens();u&&l.set("Authorization",`Bearer ${u.access_token}`)}return Object.entries(t).forEach(([u,d])=>{l.set(u,d)}),l.set("Accept","text/event-stream"),fetch(s,{...o,headers:l})}},i.requestInit={headers:t},et()(`DEBUG: Using custom headers for SSE transport to server "${r}"`)),new f0(new URL(a),i)}async _createStreamableHTTPTransport(r,a,t,n,i){var o;const s={...i?{authProvider:i}:{},...t?{requestInit:{headers:t}}:{}};if(n!=null){const l={initialReconnectionDelay:(n==null?void 0:n.delayMs)??1e3,maxReconnectionDelay:(n==null?void 0:n.delayMs)??3e4,maxRetries:(n==null?void 0:n.maxAttempts)??2,reconnectionDelayGrowFactor:1.5};n.enabled===!1&&(l.maxRetries=0),s.reconnectionOptions=l}return(o=s.requestInit)!=null&&o.headers&&et()(`DEBUG: Using custom headers for SSE transport to server "${r}"`),s.authProvider&&et()(`DEBUG: Using OAuth authentication for Streamable HTTP transport to server "${r}"`),s.reconnectionOptions&&(s.reconnectionOptions.maxRetries===0?et()(`DEBUG: Disabling reconnection for Streamable HTTP transport to server "${r}"`):et()(`DEBUG: Using custom reconnection options for Streamable HTTP transport to server "${r}"`)),Object.keys(s).length>0?new $u(new URL(a),s):new $u(new URL(a))}_setupSSEReconnect(r,a,t,n){const i=a.onclose;a.onclose=async()=>{i&&await i(),this._clients[r]&&(et()(`INFO: HTTP connection for server "${r}" closed, attempting to reconnect...`),await this._attemptReconnect(r,t,n.maxAttempts,n.delayMs))}}async _loadToolsForServer(r,a){try{et()(`DEBUG: Loading tools for server "${r}"...`);const t=await bb(r,a,this._loadToolsOptions[r]);this._serverNameToTools[r]=t,et()(`INFO: Successfully loaded ${t.length} tools from server "${r}"`)}catch(t){throw new Ct(`Failed to load tools from server "${r}": ${t}`)}}async _attemptReconnect(r,a,t=3,n=1e3){let i=!1,s=0;for(this._cleanupServerResources(r);!i&&(t===void 0||s<t);){s+=1,et()(`INFO: Reconnection attempt ${s}${t?`/${t}`:""} for server "${r}"`);try{n&&await new Promise(o=>{setTimeout(o,n)}),rh(a)?await this._initializeStdioConnection(r,a):ah(a)&&(a.type==="sse"||a.transport==="sse"?await this._initializeSSEConnection(r,a):await this._initializeStreamableHTTPConnection(r,a)),this._clients[r]&&(i=!0,et()(`INFO: Successfully reconnected to server "${r}"`))}catch(o){et()(`ERROR: Failed to reconnect to server "${r}" (attempt ${s}): ${o}`)}}i||et()(`ERROR: Failed to reconnect to server "${r}" after ${s} attempts`)}_cleanupServerResources(r){delete this._clients[r],delete this._serverNameToTools[r],delete this._transportInstances[r]}_getAllToolsAsFlatArray(){const r=[];for(const a of Object.values(this._serverNameToTools))r.push(...a);return r}_getToolsFromServers(r){const a=[];for(const t of r){const n=this._serverNameToTools[t];n&&a.push(...n)}return a}}const no="sse",jb=e=>{let r=e;switch(no){case"sse":r=e.endsWith("/")?`${e}sse`:`${e}/sse`;break;case"stdio":r=e.endsWith("/")?`${e}`:`${e}`;break}return r.replace(/\/\//g,"/")},Eb=async(e,r)=>{try{const a=await new xb({throwOnLoadError:(r==null?void 0:r.throwOnLoadError)??!0,prefixToolNameWithServerName:(r==null?void 0:r.prefixToolNameWithServerName)??!0,additionalToolNamePrefix:(r==null?void 0:r.additionalToolNamePrefix)??"mcp",mcpServers:{...e.reduce((t,n)=>(t[n.key]={transport:no,url:jb(n.url),type:no,headers:{},useNodeEventSource:!1,reconnect:{enabled:!1,maxAttempts:5,delayMs:2e3}},t),{})}}).getTools();for(const t in a){const n=a[t],i=new Function("z",`return (${ug(n.schema)});`)(y);n.schema=i}return a}catch(a){throw a}},Sb=Symbol("Let zodToJsonSchema decide on which parser to use"),kb={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Cb=e=>({...kb,...e}),Pb=e=>{const r=Cb(e),a=r.name!==void 0?[...r.basePath,r.definitionPath,r.name]:r.basePath;return{...r,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([t,n])=>[n._def,{def:n._def,path:[...r.basePath,r.definitionPath,t],jsonSchema:void 0}]))}};function nh(e,r,a,t){t!=null&&t.errorMessages&&a&&(e.errorMessage={...e.errorMessage,[r]:a})}function Be(e,r,a,t,n){e[r]=a,nh(e,r,t,n)}function Nb(){return{}}function $b(e,r){var t,n,i;const a={type:"array"};return(t=e.type)!=null&&t._def&&((i=(n=e.type)==null?void 0:n._def)==null?void 0:i.typeName)!==Re.ZodAny&&(a.items=Ue(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&Be(a,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&Be(a,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(Be(a,"minItems",e.exactLength.value,e.exactLength.message,r),Be(a,"maxItems",e.exactLength.value,e.exactLength.message,r)),a}function Ob(e,r){const a={type:"integer",format:"int64"};if(!e.checks)return a;for(const t of e.checks)switch(t.kind){case"min":r.target==="jsonSchema7"?t.inclusive?Be(a,"minimum",t.value,t.message,r):Be(a,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(a.exclusiveMinimum=!0),Be(a,"minimum",t.value,t.message,r));break;case"max":r.target==="jsonSchema7"?t.inclusive?Be(a,"maximum",t.value,t.message,r):Be(a,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(a.exclusiveMaximum=!0),Be(a,"maximum",t.value,t.message,r));break;case"multipleOf":Be(a,"multipleOf",t.value,t.message,r);break}return a}function Rb(){return{type:"boolean"}}function sh(e,r){return Ue(e.type._def,r)}const Ib=(e,r)=>Ue(e.innerType._def,r);function ih(e,r,a){const t=a??r.dateStrategy;if(Array.isArray(t))return{anyOf:t.map((n,i)=>ih(e,r,n))};switch(t){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Tb(e,r)}}const Tb=(e,r)=>{const a={type:"integer",format:"unix-time"};if(r.target==="openApi3")return a;for(const t of e.checks)switch(t.kind){case"min":Be(a,"minimum",t.value,t.message,r);break;case"max":Be(a,"maximum",t.value,t.message,r);break}return a};function Ab(e,r){return{...Ue(e.innerType._def,r),default:e.defaultValue()}}function Lb(e,r){return r.effectStrategy==="input"?Ue(e.schema._def,r):{}}function Fb(e){return{type:"string",enum:e.values}}const Db=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Mb(e,r){const a=[Ue(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),Ue(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(i=>!!i);let t=r.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const n=[];return a.forEach(i=>{if(Db(i))n.push(...i.allOf),i.unevaluatedProperties===void 0&&(t=void 0);else{let s=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;s=l}else t=void 0;n.push(s)}}),n.length?{allOf:n,...t}:void 0}function zb(e,r){const a=typeof e.value;return a!=="bigint"&&a!=="number"&&a!=="boolean"&&a!=="string"?{type:Array.isArray(e.value)?"array":"object"}:r.target==="openApi3"?{type:a==="bigint"?"integer":a,enum:[e.value]}:{type:a==="bigint"?"integer":a,const:e.value}}let so;const Tr={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(so===void 0&&(so=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),so),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function oh(e,r){const a={type:"string"};function t(n){return r.patternStrategy==="escape"?Ub(n):n}if(e.checks)for(const n of e.checks)switch(n.kind){case"min":Be(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,n.value):n.value,n.message,r);break;case"max":Be(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,n.value):n.value,n.message,r);break;case"email":switch(r.emailStrategy){case"format:email":Ht(a,"email",n.message,r);break;case"format:idn-email":Ht(a,"idn-email",n.message,r);break;case"pattern:zod":Vt(a,Tr.email,n.message,r);break}break;case"url":Ht(a,"uri",n.message,r);break;case"uuid":Ht(a,"uuid",n.message,r);break;case"regex":Vt(a,n.regex,n.message,r);break;case"cuid":Vt(a,Tr.cuid,n.message,r);break;case"cuid2":Vt(a,Tr.cuid2,n.message,r);break;case"startsWith":Vt(a,RegExp(`^${t(n.value)}`),n.message,r);break;case"endsWith":Vt(a,RegExp(`${t(n.value)}$`),n.message,r);break;case"datetime":Ht(a,"date-time",n.message,r);break;case"date":Ht(a,"date",n.message,r);break;case"time":Ht(a,"time",n.message,r);break;case"duration":Ht(a,"duration",n.message,r);break;case"length":Be(a,"minLength",typeof a.minLength=="number"?Math.max(a.minLength,n.value):n.value,n.message,r),Be(a,"maxLength",typeof a.maxLength=="number"?Math.min(a.maxLength,n.value):n.value,n.message,r);break;case"includes":{Vt(a,RegExp(t(n.value)),n.message,r);break}case"ip":{n.version!=="v6"&&Ht(a,"ipv4",n.message,r),n.version!=="v4"&&Ht(a,"ipv6",n.message,r);break}case"emoji":Vt(a,Tr.emoji,n.message,r);break;case"ulid":{Vt(a,Tr.ulid,n.message,r);break}case"base64":{switch(r.base64Strategy){case"format:binary":{Ht(a,"binary",n.message,r);break}case"contentEncoding:base64":{Be(a,"contentEncoding","base64",n.message,r);break}case"pattern:zod":{Vt(a,Tr.base64,n.message,r);break}}break}case"nanoid":Vt(a,Tr.nanoid,n.message,r)}return a}const Ub=e=>Array.from(e).map(r=>/[a-zA-Z0-9]/.test(r)?r:`\\${r}`).join(""),Ht=(e,r,a,t)=>{var n;e.format||(n=e.anyOf)!=null&&n.some(i=>i.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&t.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:r,...a&&t.errorMessages&&{errorMessage:{format:a}}})):Be(e,"format",r,a,t)},Vt=(e,r,a,t)=>{var n;e.pattern||(n=e.allOf)!=null&&n.some(i=>i.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&t.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:lh(r,t),...a&&t.errorMessages&&{errorMessage:{pattern:a}}})):Be(e,"pattern",lh(r,t),a,t)},lh=(e,r)=>{var u;const a=typeof e=="function"?e():e;if(!r.applyRegexFlags||!a.flags)return a.source;const t={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},n=t.i?a.source.toLowerCase():a.source;let i="",s=!1,o=!1,l=!1;for(let d=0;d<n.length;d++){if(s){i+=n[d],s=!1;continue}if(t.i){if(o){if(n[d].match(/[a-z]/)){l?(i+=n[d],i+=`${n[d-2]}-${n[d]}`.toUpperCase(),l=!1):n[d+1]==="-"&&((u=n[d+2])!=null&&u.match(/[a-z]/))?(i+=n[d],l=!0):i+=`${n[d]}${n[d].toUpperCase()}`;continue}}else if(n[d].match(/[a-z]/)){i+=`[${n[d]}${n[d].toUpperCase()}]`;continue}}if(t.m){if(n[d]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[d]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&n[d]==="."){i+=o?`${n[d]}\r
`:`[${n[d]}\r
]`;continue}i+=n[d],n[d]==="\\"?s=!0:o&&n[d]==="]"?o=!1:!o&&n[d]==="["&&(o=!0)}try{const d=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${r.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return i};function ch(e,r){var t,n,i,s,o,l;if(r.target==="openApi3"&&((t=e.keyType)==null?void 0:t._def.typeName)===Re.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((u,d)=>({...u,[d]:Ue(e.valueType._def,{...r,currentPath:[...r.currentPath,"properties",d]})??{}}),{}),additionalProperties:!1};const a={type:"object",additionalProperties:Ue(e.valueType._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??{}};if(r.target==="openApi3")return a;if(((n=e.keyType)==null?void 0:n._def.typeName)===Re.ZodString&&((i=e.keyType._def.checks)!=null&&i.length)){const{type:u,...d}=oh(e.keyType._def,r);return{...a,propertyNames:d}}else{if(((s=e.keyType)==null?void 0:s._def.typeName)===Re.ZodEnum)return{...a,propertyNames:{enum:e.keyType._def.values}};if(((o=e.keyType)==null?void 0:o._def.typeName)===Re.ZodBranded&&e.keyType._def.type._def.typeName===Re.ZodString&&((l=e.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...d}=sh(e.keyType._def,r);return{...a,propertyNames:d}}}return a}function Hb(e,r){if(r.mapStrategy==="record")return ch(e,r);const a=Ue(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||{},t=Ue(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[a,t],minItems:2,maxItems:2}}}function Vb(e){const r=e.values,a=Object.keys(e.values).filter(n=>typeof r[r[n]]!="number").map(n=>r[n]),t=Array.from(new Set(a.map(n=>typeof n)));return{type:t.length===1?t[0]==="string"?"string":"number":["string","number"],enum:a}}function qb(){return{not:{}}}function Zb(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const On={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Bb(e,r){if(r.target==="openApi3")return dh(e,r);const a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every(t=>t._def.typeName in On&&(!t._def.checks||!t._def.checks.length))){const t=a.reduce((n,i)=>{const s=On[i._def.typeName];return s&&!n.includes(s)?[...n,s]:n},[]);return{type:t.length>1?t:t[0]}}else if(a.every(t=>t._def.typeName==="ZodLiteral"&&!t.description)){const t=a.reduce((n,i)=>{const s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...n,s];case"bigint":return[...n,"integer"];case"object":if(i._def.value===null)return[...n,"null"];case"symbol":case"undefined":case"function":default:return n}},[]);if(t.length===a.length){const n=t.filter((i,s,o)=>o.indexOf(i)===s);return{type:n.length>1?n:n[0],enum:a.reduce((i,s)=>i.includes(s._def.value)?i:[...i,s._def.value],[])}}}else if(a.every(t=>t._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((t,n)=>[...t,...n._def.values.filter(i=>!t.includes(i))],[])};return dh(e,r)}const dh=(e,r)=>{const a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((t,n)=>Ue(t._def,{...r,currentPath:[...r.currentPath,"anyOf",`${n}`]})).filter(t=>!!t&&(!r.strictUnions||typeof t=="object"&&Object.keys(t).length>0));return a.length?{anyOf:a}:void 0};function Wb(e,r){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return r.target==="openApi3"?{type:On[e.innerType._def.typeName],nullable:!0}:{type:[On[e.innerType._def.typeName],"null"]};if(r.target==="openApi3"){const t=Ue(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}const a=Ue(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function Kb(e,r){const a={type:"number"};if(!e.checks)return a;for(const t of e.checks)switch(t.kind){case"int":a.type="integer",nh(a,"type",t.message,r);break;case"min":r.target==="jsonSchema7"?t.inclusive?Be(a,"minimum",t.value,t.message,r):Be(a,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(a.exclusiveMinimum=!0),Be(a,"minimum",t.value,t.message,r));break;case"max":r.target==="jsonSchema7"?t.inclusive?Be(a,"maximum",t.value,t.message,r):Be(a,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(a.exclusiveMaximum=!0),Be(a,"maximum",t.value,t.message,r));break;case"multipleOf":Be(a,"multipleOf",t.value,t.message,r);break}return a}function Qb(e,r){return r.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":Ue(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":Ue(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0}function Gb(e,r){const a={type:"object",...Object.entries(e.shape()).reduce((t,[n,i])=>{if(i===void 0||i._def===void 0)return t;const s=Ue(i._def,{...r,currentPath:[...r.currentPath,"properties",n],propertyPath:[...r.currentPath,"properties",n]});return s===void 0?t:{properties:{...t.properties,[n]:s},required:i.isOptional()?t.required:[...t.required,n]}},{properties:{},required:[]}),additionalProperties:Qb(e,r)};return a.required.length||delete a.required,a}const Jb=(e,r)=>{var t;if(r.currentPath.toString()===((t=r.propertyPath)==null?void 0:t.toString()))return Ue(e.innerType._def,r);const a=Ue(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return a?{anyOf:[{not:{}},a]}:{}},Xb=(e,r)=>{if(r.pipeStrategy==="input")return Ue(e.in._def,r);if(r.pipeStrategy==="output")return Ue(e.out._def,r);const a=Ue(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),t=Ue(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,t].filter(n=>n!==void 0)}};function Yb(e,r){return Ue(e.type._def,r)}function ew(e,r){const a={type:"array",uniqueItems:!0,items:Ue(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})};return e.minSize&&Be(a,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&Be(a,"maxItems",e.maxSize.value,e.maxSize.message,r),a}function tw(e,r){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((a,t)=>Ue(a._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((a,t)=>t===void 0?a:[...a,t],[]),additionalItems:Ue(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((a,t)=>Ue(a._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((a,t)=>t===void 0?a:[...a,t],[])}}function rw(){return{not:{}}}function aw(){return{}}const nw=(e,r)=>Ue(e.innerType._def,r);function Ue(e,r,a=!1){var s;const t=r.seen.get(e);if(r.override){const o=(s=r.override)==null?void 0:s.call(r,e,r,t,a);if(o!==Sb)return o}if(t&&!a){const o=sw(t,r);if(o!==void 0)return o}const n={def:e,path:r.currentPath,jsonSchema:void 0};r.seen.set(e,n);const i=ow(e,e.typeName,r);return i&&lw(e,r,i),n.jsonSchema=i,i}const sw=(e,r)=>{switch(r.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:iw(r.currentPath,e.path)};case"none":case"seen":return e.path.length<r.currentPath.length&&e.path.every((a,t)=>r.currentPath[t]===a)?(console.warn(`Recursive reference detected at ${r.currentPath.join("/")}! Defaulting to any`),{}):r.$refStrategy==="seen"?{}:void 0}},iw=(e,r)=>{let a=0;for(;a<e.length&&a<r.length&&e[a]===r[a];a++);return[(e.length-a).toString(),...r.slice(a)].join("/")},ow=(e,r,a)=>{switch(r){case Re.ZodString:return oh(e,a);case Re.ZodNumber:return Kb(e,a);case Re.ZodObject:return Gb(e,a);case Re.ZodBigInt:return Ob(e,a);case Re.ZodBoolean:return Rb();case Re.ZodDate:return ih(e,a);case Re.ZodUndefined:return rw();case Re.ZodNull:return Zb(a);case Re.ZodArray:return $b(e,a);case Re.ZodUnion:case Re.ZodDiscriminatedUnion:return Bb(e,a);case Re.ZodIntersection:return Mb(e,a);case Re.ZodTuple:return tw(e,a);case Re.ZodRecord:return ch(e,a);case Re.ZodLiteral:return zb(e,a);case Re.ZodEnum:return Fb(e);case Re.ZodNativeEnum:return Vb(e);case Re.ZodNullable:return Wb(e,a);case Re.ZodOptional:return Jb(e,a);case Re.ZodMap:return Hb(e,a);case Re.ZodSet:return ew(e,a);case Re.ZodLazy:return Ue(e.getter()._def,a);case Re.ZodPromise:return Yb(e,a);case Re.ZodNaN:case Re.ZodNever:return qb();case Re.ZodEffects:return Lb(e,a);case Re.ZodAny:return Nb();case Re.ZodUnknown:return aw();case Re.ZodDefault:return Ab(e,a);case Re.ZodBranded:return sh(e,a);case Re.ZodReadonly:return nw(e,a);case Re.ZodCatch:return Ib(e,a);case Re.ZodPipeline:return Xb(e,a);case Re.ZodFunction:case Re.ZodVoid:case Re.ZodSymbol:return;default:return(t=>{})()}},lw=(e,r,a)=>(e.description&&(a.description=e.description,r.markdownDescription&&(a.markdownDescription=e.description)),a),cw=(e,r)=>{const a=Pb(r),t=typeof r=="object"&&r.definitions?Object.entries(r.definitions).reduce((o,[l,u])=>({...o,[l]:Ue(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,l]},!0)??{}}),{}):void 0,n=typeof r=="string"?r:r==null?void 0:r.name,i=Ue(e._def,a,!1)??{},s=n===void 0?t?{...i,[a.definitionPath]:t}:i:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,n].join("/"),[a.definitionPath]:{...t,[n]:i}};return a.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":a.target==="jsonSchema2019-09"&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),s},dw=b.memo(e=>{var p,h,v,f;const{t:r}=Te("flows"),{id:a,data:t,isConnectable:n}=e,[i,s]=b.useState(!1),o=b.useRef(!1),l=mt(a),u=ve(m=>m.updateNodes);Vv(a),b.useEffect(()=>{const m=t==null?void 0:t.entity;!m||!l||o.current||t.loaded||(o.current=!0,Eb([m],{globalThrowOnLoadError:!0}).then(g=>{o.current=!1,u([{id:l.id,type:"replace",item:{...l,data:{...(l==null?void 0:l.data)||{},loaded:!0,tools:g.map(w=>({name:`${w.name}`,description:w.description||"",schema:cw(w.schema)}))}}}])}).catch(g=>{o.current=!1,u([{id:l.id,type:"replace",item:{...l,data:{...t,loaded:!0,error:g.message}}}])}))},[t.loaded,t==null?void 0:t.entity,l,r,u,t]);const d=b.useMemo(()=>!(t!=null&&t.tools)||!t.loaded?{tools:[],total:0}:i?{tools:t.tools,total:t.tools.length}:{tools:t.tools.slice(0,5),total:t.tools.length},[t==null?void 0:t.tools,t.loaded,i]);return c.jsxs("div",{children:[c.jsxs("div",{children:[c.jsx(yt,{id:a}),c.jsxs(It,{className:"flex justify-center max-w-md",variant:"default",children:[c.jsx(_e,{size:24,name:"tool-case"}),c.jsxs("div",{className:"ml-2 max-w-full break-words break-all",children:[c.jsx(pr,{children:`${((p=t.entity)==null?void 0:p.key)||""}`}),c.jsxs(ua,{children:[c.jsx(je,{children:`${((h=t.entity)==null?void 0:h.url)||""}`}),c.jsx(dp,{className:"my-2"}),t.error?c.jsx(je,{className:"text-red-500",children:t.error}):void 0,(v=d==null?void 0:d.tools)!=null&&v.length?c.jsxs("div",{children:[c.jsx("ul",{className:"list-disc pl-5",children:d.tools.map((m,g)=>c.jsx("li",{children:c.jsxs(je,{children:[m.name,": ",m.description]})},g))}),d.total>((f=d==null?void 0:d.tools)==null?void 0:f.length)?c.jsxs(We,{onClick:()=>s(!0),className:"align-self-center mt-2",variant:"ghost",children:[c.jsx(_e,{name:"chevron-down",className:"mt-1"}),r("mcp_node.view_all",{count:d.total})]}):d.total>5?c.jsxs(We,{onClick:()=>s(!1),className:"align-self-center mt-2",variant:"ghost",children:[c.jsx(_e,{name:"chevron-up",className:"mt-1"}),r("mcp_node.view_less")]}):null]}):t!=null&&t.loaded&&!(t!=null&&t.error)?c.jsx(je,{children:r("mcp_node.no_tools")}):t!=null&&t.error?void 0:c.jsx(je,{children:r("mcp_node.loading_tools")})]})]})]})]}),c.jsx(Ve,{type:"source",position:He.Bottom,id:"a",isConnectable:n})]})}),uw={[Q.LLM]:Uf,[Q.Toolbox]:Tf,[Q.Thread]:Bf,[Q.Message]:Jf,[Q.Prompt]:Yf,[Q.SessionInfo]:ev,[Q.Schema]:rv,[Q.CSVData]:av,[Q.ToolDefinition]:sv,[Q.DefaultEmbeddingModel]:cv,[Q.VectorDatabase]:gv,[Q.JSONLData]:_v,[Q.ApplicationBar]:jv,[Q.Shape]:Sv,[Q.CircleShape]:Cv,[Q.TriangleShape]:Nv,[Q.EditorApp]:Iv,[Q.PlaceHolder]:Av,[Q.VSLiteApp]:Hv,[Q.MCP]:dw},uh=Fh("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),hw=b.forwardRef(({className:e,variant:r,size:a,...t},n)=>c.jsx(vp,{ref:n,className:Me(uh({variant:r,size:a,className:e})),...t}));hw.displayName=vp.displayName;const hh=b.createContext({size:"default",variant:"default"}),ph=b.forwardRef(({className:e,variant:r,size:a,children:t,...n},i)=>c.jsx(gp,{ref:i,className:Me("flex items-center justify-center gap-1",e),...n,children:c.jsx(hh.Provider,{value:{variant:r,size:a},children:t})}));ph.displayName=gp.displayName;const mh=b.forwardRef(({className:e,children:r,variant:a,size:t,...n},i)=>{const s=b.useContext(hh);return c.jsx(yp,{ref:i,className:Me(uh({variant:s.variant||a,size:s.size||t}),e),...n,children:r})});mh.displayName=yp.displayName;function pw(){const e=mx(r=>`x: ${r.transform[0].toFixed(2)}, y: ${r.transform[1].toFixed(2)}, zoom: ${r.transform[2].toFixed(2)}`);return c.jsx("div",{children:e})}function mw({change:e}){var t,n,i,s;const r="id"in e?e.id:"-",{type:a}=e;return c.jsxs("div",{className:"mb-3",children:[c.jsxs("div",{children:["node id: ",r]}),c.jsxs("div",{children:[a==="add"?JSON.stringify(e.item,null,2):null,a==="dimensions"?`dimensions: ${(t=e.dimensions)==null?void 0:t.width} \xD7 ${(n=e.dimensions)==null?void 0:n.height}`:null,a==="position"?`position: ${(i=e.position)==null?void 0:i.x.toFixed(1)}, ${(s=e.position)==null?void 0:s.y.toFixed(1)}`:null,a==="remove"?"remove":null,a==="select"?e.selected?"select":"unselect":null]})]})}function fw({limit:e=20}){const[r,a]=b.useState([]),t=hx(),n=b.useCallback(s=>{a(o=>[...s,...o].slice(0,e))},[e]);b.useEffect(()=>(t.setState({onNodesChange:n}),()=>t.setState({onNodesChange:void 0})),[n,t]);const i=()=>c.jsx("div",{children:"No Changes Triggered"});return c.jsx(c.Fragment,{children:r.length===0?c.jsx(i,{}):r.map((s,o)=>c.jsx(mw,{change:s},o))})}function vw(){const{getInternalNode:e}=Zt(),r=Qh();return c.jsx(px,{children:c.jsx("div",{className:"text-secondary-foreground",children:r.map(a=>{var i,s;const t=e(a.id);if(!t)return null;const n=t==null?void 0:t.internals.positionAbsolute;return c.jsx(gw,{id:a.id,selected:!!a.selected,type:a.type||"default",position:a.position,absPosition:n,width:((i=a.measured)==null?void 0:i.width)??0,height:((s=a.measured)==null?void 0:s.height)??0,data:a.data},a.id)})})})}function gw({id:e,type:r,selected:a,position:t,absPosition:n,width:i,height:s,data:o}){if(!i||!s)return null;const l=`translate(${n.x}px, ${n.y+s}px)`,u=`${t.x.toFixed(1)}, ${t.y.toFixed(1)}`,d=`${i} \xD7 ${s}`,p=a?"Selected":"Not Selected";return c.jsxs("div",{style:{position:"absolute",transform:l,width:i*2},className:"text-xs",children:[c.jsxs("div",{children:["id: ",e]}),c.jsxs("div",{children:["type: ",r]}),c.jsxs("div",{children:["selected: ",p]}),c.jsxs("div",{children:["position: ",u]}),c.jsxs("div",{children:["dimensions: ",d]}),c.jsxs("div",{children:["data: ",JSON.stringify(o,null,2)]})]})}function yw({tools:e}){return c.jsx(vo,{position:"top-left",className:"bg-card p-1 border rounded shadow-sm",children:c.jsx(ph,{type:"multiple",children:e.map(({active:r,setActive:a,label:t,value:n})=>c.jsx(mh,{value:n,onClick:()=>a(i=>!i),"aria-pressed":r,className:"bg-card text-card-foreground transition-colors duration-300 hover:bg-secondary hover:text-secondary-foreground",children:t},n))})})}function fh(){const[e,r]=b.useState(!1),[a,t]=b.useState(!1),[n,i]=b.useState(!1),s=[{active:e,setActive:r,label:"Node Inspector",value:"node-inspector"},{active:a,setActive:t,label:"Change Logger",value:"change-logger"},{active:n,setActive:i,label:"Viewport Logger",value:"viewport-logger"}];return c.jsxs(c.Fragment,{children:[c.jsx(yw,{tools:s}),a&&c.jsx(vo,{className:"text-xs p-5 bg-white rounded shadow-md overflow-y-auto max-h-[50%] mt-20",position:"bottom-right",children:c.jsx(fw,{})}),e&&c.jsx(vw,{}),n&&c.jsx(vo,{position:"bottom-left",className:"text-secondary-foreground",children:c.jsx(pw,{})})]})}fh.displayName="DevTools";let vh,gh,yh,_h;vh=()=>{const e=b.useRef({}),r=b.useRef({}),a=b.useRef([]),t=ve(R=>R.flowEdges),n=rt(R=>R.currentSession),i=ve(R=>R.setNodes),s=ve(R=>R.updateNodes),o=ve(R=>R.updateEdges),l=ve(R=>R.addConnectionToEdges),u=ve(R=>R.reset),d=ve(R=>R.findFlowEdges),p=ve(R=>R.deleteFlowNode),h=ve(R=>R.deleteFlowEdge),v=ve(R=>R.updateFlowNode),f=ve(R=>R.getNodes),m=ve(R=>R.findFlowNodesWithSource),g=b.useRef(t),w=b.useRef(),[S,O]=b.useState({loading:!1});g.current=t;const x=b.useCallback(async(R,z)=>{try{w.current=R,u(),await(z==null?void 0:z())}catch{w.current=void 0}},[u]),E=b.useCallback(async R=>{try{if(!(n!=null&&n.id))return;O(M=>({...M,loading:!0}));const z=await m({...R,where:{...R.where,session_id:n.id}}),U=await d({where:[{source:jo(z.map(M=>M.id))},{target:jo(z.map(M=>M.id))}]});return{flowNodes:z,flowEdges:U}}finally{O(z=>({...z,loading:!1}))}},[m,d,n==null?void 0:n.id]),$=b.useCallback(async R=>{var z,U;for(const M of a.current){const q=await M(R);if(typeof q=="boolean"&&!q)return}for(const M of R)if("id"in M&&Object.values(Hn).includes(M.id)&&M.type!=="remove")s([M]);else if(M.type==="position"&&M.position&&!isNaN(M.position.x)&&!isNaN(M.position.y)){s([M]);const q=M.position.x,J=M.position.y;clearTimeout(e.current[M.id]),e.current[M.id]=setTimeout(async()=>{e.current[M.id]=void 0,await v({id:M.id,x:q,y:J},{silent:!0})},200)}else if(M.type==="remove"){const q=(z=f([M.id]))==null?void 0:z[0];if(!(q!=null&&q.type)||fx.includes(q.type))return;await p({id:M.id})}else if(M.type==="dimensions"&&M.dimensions&&!isNaN(M.dimensions.width)&&!isNaN(M.dimensions.height)){const q=(U=f([M.id]))==null?void 0:U[0];if(!(q!=null&&q.width)&&!(q!=null&&q.height))return;s([M]),clearTimeout(r.current[M.id]);const J=M.dimensions.width,Y=M.dimensions.height;r.current[M.id]=setTimeout(async()=>{await v({id:M.id,width:J,height:Y},{silent:!0})},200)}else M.type==="select"&&s([M])},[s,v,f,p]),N=b.useCallback(R=>{Promise.all(R.map(async z=>{if(z.type==="remove")return h({id:z.id})})),o(R)},[h,o]),T=b.useCallback(R=>{l(R)},[l]),D=b.useCallback(R=>{i(z=>{var J,Y;let U;if(typeof R=="function"?U=R(z):U=R,!U)return z;const M=z==null?void 0:z.find(se=>se.id===U.id),q={id:U.id,item:M?vx(M,U):{...U,position:{x:((J=U.position)==null?void 0:J.x)||0,y:((Y=U.position)==null?void 0:Y.y)||0}},type:M?"replace":"add"};return gx([q],z)})},[i]),A=b.useCallback(R=>(a.current.push(R),()=>{a.current=a.current.filter(z=>z!==R)}),[]);return{initFlow:x,loadingState:S,prepareFlowInfo:E,updateNodeChanges:$,updateEdgeChanges:N,updateOrCreateNode:D,currentSessionIdRef:w,updateEdgeConnection:T,addOnNodeChangeHandler:A}},gh=e=>{const r=rt(p=>{var h;return(h=p.currentSession)==null?void 0:h.id}),{loadingState:a,prepareFlowInfo:t,initFlow:n,currentSessionIdRef:i}=e,s=ve(p=>p.ready),o=ve(p=>p.nodes),l=b.useRef(o),u=ve(p=>p.removeSyncNodeQueue),d=ve(p=>p.removeSyncEdgeQueue);l.current=o,b.useEffect(()=>{a.loading||!s||!r||i.current===r||n(r,async()=>{await t({where:{session_id:r}})})},[n,t,a.loading,i,s,r]),b.useEffect(()=>{const p=ve.subscribe(v=>v.syncNodeQueue,async(v,f)=>{const m=f.map(w=>w.timestamp),g=v.filter(w=>!m.includes(w.timestamp));g.length&&u(g.map(w=>w.timestamp))}),h=ve.subscribe(v=>v.syncEdgeQueue,async(v,f)=>{const m=f.map(w=>w.timestamp),g=v.filter(w=>!m.includes(w.timestamp));g.length&&d(g.map(w=>w.timestamp))});return()=>{p(),h()}},[t,d,u])},yh=()=>{const[e,r]=b.useState(!0),a=vh(),t=Ha(d=>d.selectedModel),n=b.useRef(t),i=Ha(d=>d.setInitProgressCallback),{updateOrCreateNode:s,updateNodeChanges:o,updateEdgeChanges:l,updateEdgeConnection:u}=a;return gh(a),n.current=t,b.useEffect(()=>{const d=i==null?void 0:i(p=>{if(!n.current)return;const h=`${n.current}`;s(v=>{const f=v==null?void 0:v.find(m=>{var g;return(g=m.data)!=null&&g.entity&&typeof m.data.entity=="object"&&"name"in m.data.entity?m.data.entity.name===h:!1});if(f)return f.data.label=p.text,f.data.status=jt.Loading,p.progress===100&&(f.data.label="",f.data.status=jt.Loaded),f})});return()=>{d==null||d()}},[i,s]),b.useMemo(()=>({updateNodeChanges:o,updateEdgeChanges:l,initializing:e,setInitializing:r,updateEdgeConnection:u}),[o,l,e,r,u])},_h=()=>{const e=Th(u=>u.theme),r=ve(u=>u.nodes),a=ve(u=>u.edges),{updateNodeChanges:t,updateEdgeChanges:n,updateEdgeConnection:i}=yh(),s=b.useCallback(u=>{t(u)},[t]),o=b.useCallback(u=>{n(u)},[n]),l=b.useCallback(u=>{i(u)},[i]);return c.jsxs(yx,{nodes:r,edges:a,nodeTypes:uw,onNodesChange:s,onEdgesChange:o,onConnect:l,panOnScroll:!0,panOnScrollMode:_x.Free,colorMode:e,fitView:!0,children:[c.jsx(bx,{variant:wx.Dots,gap:24,size:1}),c.jsx(xx,{}),c.jsx(jx,{}),Bw?c.jsx(fh,{}):void 0]})},_p=b.memo(_h)});export{A1 as __tla,_p as default};
