{"version":3,"mappings":"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","names":["useMotionValue","motionValue","useContext","MotionConfigContext","useState","initial","useEffect","value","useCombineMotionValues","values","combineValues","updateValue","scheduleUpdate","frame","subscriptions","v","unsubscribe","cancelFrame","source","config","activeSpringAnimation","useRef","initialValue","useConstant","unit","noop","startAnimation","stopAnimation","animateValue","asNumber","latestValue","latestSetter","useInsertionEffect","latest","set","parseValue","useIsomorphicLayoutEffect","isMotionValue","isCustomValueType","transform","useImmediate","inputValue","args","argOffset","outputRange","options","interpolator","interpolate","inputRange","getMixer","useComputed","collectMotionValues","compute","useTransform","input","transformer","inputRangeOrTransformer","useListTransform","numValues","i","MessageStatusEnum","MessageRoleEnum","ThreadStatusEnum","PromptTypeEnum","p","escapePointer","ignoredKeyword","dereference","lookup","baseURI","initialBaseURI","schema","id","url","schemaURI","basePointer","key","encodePointer","subSchema","length","subKey","keyBase","DATE","TIME","URIREF","URITEMPLATE","URL_","UUID","JSON_POINTER","JSON_POINTER_URI_FRAGMENT","RELATIVE_JSON_POINTER","EMAIL","name","host","rest","part","IPV4","IPV6","DURATION","bind","r","format","date","time","date_time","uri","HOSTNAME","isLeapYear","year","matches","str","month","day","DAYS","full","minute","timeZone","second","DATE_TIME_SEPARATOR","dateTime","NOT_URI_FRAGMENT","URI_PATTERN","Z_ANCHOR","regex","ucs2length","s","result","index","charCode","validate","instance","draft","shortCircuit","recursiveAnchor","instanceLocation","schemaLocation","evaluated","instanceType","rawInstanceType","$ref","$recursiveRef","$recursiveAnchor","$enum","$anyOf","$oneOf","$else","$format","$properties","$patternProperties","$additionalProperties","$minProperties","$maxProperties","$propertyNames","$dependentSchemas","$prefixItems","$items","$additionalItems","$contains","$maxItems","$uniqueItems","$minimum","$exclusiveMinimum","$exclusiveMaximum","$multipleOf","$minLength","__absolute_ref__","errors","message","keywordLocation","refSchema","$type","valid","$const","deepCompareStrict","$not","subEvaluateds","errorsLength","anyValid","subEvaluated","$allOf","allValid","$if","$then","thenResult","elseResult","$required","keys","subInstancePointer","$dependentRequired","required","dependantKey","$dependencies","propsOrSchema","stop","thisEvaluated","pattern","$unevaluatedProperties","$minItems","length2","$minContains","contained","j","$maxContains","$unevaluatedItems","a","ao","k","b","$maximum","remainder","$maxLength","$pattern","StructuredTool","fields","_isToolCall","enrichedConfig","toolInput","arg","configArg","tags","inputForValidation","parsed","isInteropZodSchema","interopParseAsync","e","ToolInputParsingException","parseCallbackConfigArg","runManager","CallbackManager","artifact","content","toolCallId","_configHasToolCallId","formattedOutput","_formatToolOutput","DynamicStructuredTool","parentConfig","params","isDirectToolOutput","item","ToolMessage","_stringify","Collection","useCollection","createCollection","MENUBAR_NAME","createMenubarContext","createMenubarScope","createContextScope","createCollectionScope","createRovingFocusGroupScope","useMenuScope","createMenuScope","useRovingFocusGroupScope","MenubarContextProvider","useMenubarContext","Menubar","React.forwardRef","props","forwardedRef","__scopeMenubar","onValueChange","defaultValue","dir","menubarProps","direction","useDirection","rovingFocusGroupScope","setValue","useControllableState","valueProp","React.useState","jsx","React.useCallback","value2","setCurrentTabStopId","loop","RovingFocusGroup.Root","Primitive","MenubarMenuProvider","MenubarMenu","useId","autoValue","triggerRef","React.useRef","wasKeyboardTriggerOpenRef","open","context","React.useEffect","MenuPrimitive.Root","menuScope","open2","menuProps","MENU_NAME","TRIGGER_NAME","menuContext","useMenubarMenuContext","ref","composedRefs","useComposedRefs","isFocused","setIsFocused","disabled","RovingFocusGroup.Item","MenuPrimitive.Anchor","triggerProps","composeEventHandlers","event","MenubarTrigger","PORTAL_NAME","portalProps","MenuPrimitive.Portal","MenubarPortal","CONTENT_NAME","align","getItems","hasInteractedOutsideRef","MenuPrimitive.Content","target","targetIsSubTrigger","isKeyDownInsideSubMenu","isPrevKey","candidateValues","currentIndex","wrapArray","nextValue","GROUP_NAME","MenubarGroup","MenubarLabel","MenubarItem","MenubarCheckboxItem","radioGroupProps","MenubarRadioGroup","MenubarRadioItem","MenubarItemIndicator","itemIndicatorProps","MenubarSeparator","MenubarArrow","subTriggerProps","MenubarSubTrigger","SUB_TRIGGER_NAME","SUB_CONTENT_NAME","MenubarSubContent","subContentProps","array","startIndex","Root3","Menu","Portal2","MenubarContent","Label2","Item3","CheckboxItem2","RadioItem2","ItemIndicator2","Separator2","SubTrigger2","SubContent2","MenubarPrimitive.Menu","className","MenubarPrimitive.Root","cn","MenubarPrimitive.Trigger","inset","children","jsxs","LazyIcon","MenubarPrimitive.SubTrigger","MenubarPrimitive.SubContent","alignOffset","sideOffset","MenubarPrimitive.Portal","MenubarPrimitive.Content","MenubarPrimitive.ItemIndicator","MenubarPrimitive.CheckboxItem","MenubarPrimitive.RadioItem","MenubarPrimitive.Separator","create","subscribeWithSelector","devtools","get","defaultFlowState","getFlowStateActions","useCreateLLM","sessionId","useSessionState","loading","setLoading","pushSyncNodeQueue","useFlowState","state","createOrUpdateFlowNode","useCallback","record","existed","getRepository","LLMProviderEnum","LLMStatusEnum","llm","FlowNodeTypeEnum","U","Y","H","u","$","m","B","K","X","G","_","C","h","P","A","f","O","T","L","c","S","E","N","R","M","J","D","W","be","le","Z","I","he","o","t","ce","ue","n.createContext","n.useContext","ee","de","fe","me","n.forwardRef","d","pe","l","y","ge","te","F","x","n.useRef","Te","z","re","g","n.useMemo","ne","V","Q","oe","Ie","ie","ae","se","n.createElement","q","ye","ve","n.useEffect","Ee","Ce","xe","Pe","w.Overlay","we","De","Me","n.useLayoutEffect","Re","n.useState","ke","n.isValidElement","n.cloneElement","Le","Command","CommandPrimitive","CommandInput","CommandList","CommandEmpty","CommandGroup","CommandItem","Checkbox","CheckboxPrimitive.Root","CheckboxPrimitive.Indicator","OPEN_AI_MODELS","GROQ_MODELS","GROQ_VISION_MODELS","GOOGLE_GENERATIVE_AI_MODELS","GOOGLE_GENERATIVE_AI_API_KEY_LINK","OPEN_AI_API_KEY_LINK","GROQ_API_KEY_LINK","CreateSessionPassphraseDialog","onConfirm","onCancel","currentModal","useModal","setName","handleChangeOTP","newValue","handleHide","DialogContent","DialogDescription","InputOTP","InputOTPGroup","InputOTPSlot","Button","useUpdateSessionPassphrase","currentSession","setCurrentSession","updateSessionPassphrase","passkey","passphrase","generatePassphrase","encrypted","encryptSymmetric","session","useConfirmOrCreatePassphrase","createSessionPassphraseDialogRef","useModalRef","confirmPassphrase","useConfirmPassphrase","keyInfo","secureSession","setDialog","modelId","setOpen","search","setSearch","provider","setProvider","hasCache","setHasCache","llmsInfo","useLocalLLMState","createLLM","syncCachedLLMURLs","isRequiredSessionPasskey","useMemo","model","pre","next","preInCache","nextInCache","preInRecommended","RECOMMENDATION_LOCAL_LLMS","preInFunctionCalling","nextInFunctionCalling","cachedLLMURLs","modelList","setEncryptedInfo","selectedModel","setModelId","handleOnchange","currentValue","handleSearchChange","hanldeSubmit","node","confirmOrCreatePassphrase","encryptData","encryptedInfo","modelTypeToLLMType","error","logError","toast","useLayoutEffect","username","repo","repoInfo","setLLMsInfo","llmInfoRef","data","__vitePreload","functionCallingModelIds","modelType","LLMModelTypeEnum","modelItems","LLMIcon","LLMInfo","modelSelection","Fragment","Label","PopoverTrigger","PopoverContent","RECOMMENDATION_WALLAMA_LLMS","Input","Popover","Alert","CardHeader","CardTitle","handleOnSelectProvider","SelectValue","SUPPORTED_PROVIDERS","encryptedFields","CardFooter","LoadingButton","creatingLLM","useCreatePrompt","initialX","initialY","prompt","PROMPT_TYPES","PROMPT_ROLES","memo","defaultPromptType","hidePromptRole","setInput","defaultPromptContent","promptType","setPromptType","defaultPromptRole","promptPrefix","useTranslation","setPromptPrefix","handleOnSelectType","handleOnSelectRole","setPromptRole","handleSubmit","onSubmit","promptRole","hidePromptType","Select","SelectTrigger","SelectContent","SelectItem","Textarea","handleOnchangePrefix","CreatePromptCard","thread","useToast","useInternalNode","PromptForm","toSchemaItem","parent","generateUUID","schemaItems","createSchema","NewOrUpdateField","setData","setEmpty","empty","handleChangeName","previous","handleChangeDescription","handleChangeType","handleChangeRequired","handleChangeEnum","items","func","previousData","currentRow","shouldShowChildData","handleSetChildData","Accordion","row","AccordionItem","AccordionTrigger","AccordionContent","Card","CreateSchemaCard","useCreateSchema","FieldList","createCSVData","encodedData","encodeCSVData","headers","csvData","ExampleTable","Table","TableHeader","TableHead","TableBody","TableRow","CreateFewShotExampleCard","prevData","output","setOutput","CardContent","createTool","tool","toolNode","createOrUpdateFlowEdge","CreateToolCard","description","setDescription","useCreateVectorDatabase","createVectorDatabase","textSplitter","vectorDatabase","VectorDatabaseTypeEnum","VectorDatabaseProviderEnum","vectorDatabaseNode","VectorDatabaseStorageEnum","databaseSource","databaseSourceNode","SUPPORTED_TEXT_SPLITTERS","CreateVectorDatabaseCard","storageType","setTextSplitter","setStorageType","handleOnSelectTextSplitter","prev","handleOnChangeChunkSize","SUPPORTED_VECTOR_DATABASE_PROVIDERS","handleOnChangeChunkOverlap","text","setText","handleCreateCSVData","handleAdd","DataTable","SupportedAddNodeEnum","getContainer","existingContainer","container","instanceCounter","applyParticleEffect","mouseX","sizes","speedHorz","spinVal","spinSpeed","particle","particleType","circleSVG","svgNS","circle","size","top","particles","refreshParticles","animationFrame","lastParticleTimestamp","particleGenerationDelay","currentTime","autoAddParticle","generateParticle","tap","isTouchInteraction","tapEnd","move","updateMousePosition","mouseY","tapHandler","element","disableAutoAddParticle","interval","CoolMode","React","MCPForm","setUrl","mcp","createMcp","useCreateMcp","Separator","Collapsible","CollapsibleTrigger","CollapsibleContent","MarkdownViewer","ToolbarNode","theme","useAppState","menu","Logo","SUPPORTED_MODES","mode","child","setMode","CreateTextDataCard","CreateMCPCard","useCreateStandaloneSession","useNavigate","cloneNode","newSession","newFlowNodeIDMap","entity","entityName","cloneEntity","newEntityIDMap","currentFlowNode","cloneFlowNode","createStandaloneSession","standaloneSession","SessionTypeEnum","SessionStatusEnum","mainNodeInfo","connectedNodes","connections","connection","sourceId","targetId","navigate","getRouteURL","useDeleteNodeFlow","updateNode","updateEdges","deleteNodeFlow","edges","edge","CreateStandaloneApplicationDialog","cloneStandaloneSession","Dialog","DialogTitle","DialogFooter","NodeHeader","enableToStandalone","getLinkedConnections","getNode","useReactFlow","deleting","createStandaloneApplicationDialog","currentNode","handleDelete","Handle","Position","useCreateThread","flowNode","flowEdge","useActions","loadingModel","useLoadModel","createThread","creatingThread","updateNodes","queryThreadsFromModel","setQueringThreads","threads","setLoadingModel","loadModel","initProgress","llmNodeChanges","getNodes","handleCreateThread","changeLLMOptions","queringThreads","useBaseConnectionToHandler","handlerFunction","handling","setHandling","newTargetConnection","setNewTargetConnection","deleteElements","useHandleConnections","newConnections","filterUserConnections","connectionHandler","edgeId","handlingConnections","removeEdgeIds","response","useConnectionToHandler","handleConnectionTo","LLMNode","isConnectable","llmInfo","setLLMInfo","isLoading","n","ModelManager","models","prebuiltAppConfig","hasModelInCache","onChangeOptions","actions","queryThreads","llmIcon","AlertTitle","AlertDescription","LLMSetting","BorderBeam","NewMessageCard","AIInput","list","handledIds","functions","runningNodes","nodeConnections","nodes","threadConversationTraveling","threadNode","threadConnections","threadConnectionInfos","threadPromptNodes","threadPromptNodeResult","threadToolsNodes","threadToolNodeResult","toolConnectedNodes","threadPlaceholderNodes","threadPlaceholderNodeResult","placeholderConnectedNodes","schemaNode","buildHistories","histories","decodeCSVData","rows","HumanMessage","SystemMessage","AIMessage","prepareThreadHistory","messageNodes","systems","threadPromptNode","toLocalLLMToolCallingInput","tools","all","toolEntity","toolSchemaEnity","useFlowEmbeddingNode","getFlowEmbeddingNode","getFlowEmbeddingEntity","useCreateMessage","currenSession","useLLM","insertMessages","threadId","humanMessage","initialLLMId","humanMessageNode","aiMessage","aiMessageNode","handlePlaceholders","messagesInfo","threadConnection","placeholders","FlowNodePlaceholderTypeEnum","vectorNode","vector","placeholderRecord","minimalScore","dataSource","getStorageDataSource","documents","similaritySearchWithScoreFunction","template","PromptTemplate","injectedMessages","score","doc","getHandleConnections","invokeMessage","threadConversionNodes","onMessageUpdate","llmEntity","MessageHistory","prompts","schemaEntities","schemas","stream","messages","createMessage","info","omitBy","isUndefined","createMessageFunction","linkedConnections","ThreadNode","showThread","setShowThread","targetConnections","Badge","handleNewThread","DefaultHandle","HumanMessageComponent","onNewThread","isError","Suspense","messageMetadata","useCreateIdieMessage","newMessage","newMessageNode","edgeToPrompt","edgeToNewMessage","MessageNode","handleCopy","handleSpeech","speaking","textToSpeech","setSpeaking","newMessageCard","isEnd","handleCreateMessage","AIMessageComponent","targetEntity","sourceEntity","createIdieMessage","PromptNode","viewDetailDialog","ViewDataDetailDialog","match","isOverLimit","handleOpenDetail","promptArguments","argument","bytes","cachedModdels","setCachedModels","latestUpdate","setUsedBytes","setCountInfo","fetchSessionInfo","estimate","maxUpdatedAt","acc","setLatestUpdate","llms","jsonlDatas","csvDatas","vectorDatabases","handleReload","CardDescription","usedBytes","SchemaNode","loadingRef","Tabs","TabsList","TabsTrigger","TabsContent","convertToTypeScriptInterface","CSVDataNode","lines","decodeSplitter","csv","DataViewer","ToolNode","EmbeddingSetting","show","setShow","setOptions","handleOpenChange","setEncrypted","decrypted","decryptSymmetric","hanleSubmit","useNodes","inputEncrypted","currentSessionId","SYSTEM_NODE_IDS","flowNodePlaceholder","changes","DEFAULT_EMBEDDING_MODEL","modelName","DEFAULT_PROMPT","CreateVectorDatabasePromptDialog","createPrompt","DialogHeader","useCreateVectorDatabaseRetriever","createVectorDatabaseRetriever","systempPrompt","systemPromptNode","metadata","retriever","retrieverNode","CreateVectorDatabaseRetrieverDialog","setK","setMinimalScore","handleOnChangeK","handleOnChangeMinimalScore","useEmbedding","Document","indexFunction","similaritySearchWithScore","embbedingEntity","indexData","dataSourceNode","dataSourceType","chunk","handledCount","partDocuments","chunkedDocuments","updatedDataNode","VectorDatabaseNode","createPromptDialog","CreatePromptDialog","CreateRetrieverDialog","createRetrieverDialog","handleIndexPDF","file","reader","handleCreateData","blob","pdfjs","setProgress","vectorDatabaseData","decodeLine","renderContent","VectorSearch","handleSimilaritySearch","handleCreateRetriever","IndexNewText","IndexNewFile","progress","handleCreatePrompt","LIMIT_LENGTH_BY_COLUMNS","jsonl","DEFAULT_MAGNIFICATION","DEFAULT_DISTANCE","dockVariants","Dock","distance","renderChildren","DockIcon","magnification","distanceCalc","val","bounds","width","useSpring","motion","DEFAULT_NODE_SIZE","nodeData","nodeType","DATA","VisualStudioCodeSvg","ApplicationBarNode","handleAddNode","createNode","TooltipProvider","Icon","Tooltip","TooltipContent","handleClassName","NodeResizer","selected","TriangleNode","height","refDebounce","llmConnection","updateEditorContent","lazy","EditorAppNode","handleChangeContent","DefaultNodeResizer","PlateAppEditor","placeholder","sourceBase","module","sourcebase","setSourcebase","onUpdateSourceBase","getSourceBase","updateCodeContainerData","parseFileSystemTreeToJSONL","onResponseMessageCreate","formatedMessages","VSLiteApp","VSLiteAppNode","parseJSONLToFileSystemTree","tree","setFileSystemTree","sendMessage","handleUpdateCodeContainerFile","updateFileSystemTree","handleUpdateCodeContainerData","refs","parseSchema","parseMultipleType","type","parseNot","parseNull","_schema","arr","originalIndex","ensureOriginalIndex","newArr","parseAllOf","left","half","right","got","opener","prefix","withMessage","json","parseConst","parseEnum","parseIfThenElse","parseNumber","parseOneOf","expandJsdocs","jsdocs","addJsdocs","parseObject","objectSchema","properties","propSchema","hasDefault","additionalProperties","patternProperties","parsedPatternProperties","its","parseAnyOf","parseString","contentMediaType","omit","obj","parseNullable","blockMeta","custom","seen","selectParser","addDescribes","addDefaults","addAnnotations","parseArray","parseBoolean","parseDefault","jsonSchemaToZod","noImport","typeName","LATEST_PROTOCOL_VERSION","SUPPORTED_PROTOCOL_VERSIONS","JSONRPC_VERSION","ProgressTokenSchema","CursorSchema","RequestMetaSchema","BaseRequestParamsSchema","RequestSchema","BaseNotificationParamsSchema","NotificationSchema","ResultSchema","RequestIdSchema","JSONRPCRequestSchema","isJSONRPCRequest","JSONRPCNotificationSchema","isJSONRPCNotification","JSONRPCResponseSchema","isJSONRPCResponse","ErrorCode","JSONRPCErrorSchema","isJSONRPCError","JSONRPCMessageSchema","EmptyResultSchema","CancelledNotificationSchema","BaseMetadataSchema","ImplementationSchema","ClientCapabilitiesSchema","InitializeRequestSchema","ServerCapabilitiesSchema","InitializeResultSchema","InitializedNotificationSchema","isInitializedNotification","PingRequestSchema","ProgressSchema","ProgressNotificationSchema","PaginatedRequestSchema","PaginatedResultSchema","ResourceContentsSchema","TextResourceContentsSchema","BlobResourceContentsSchema","ResourceSchema","ResourceTemplateSchema","ListResourcesRequestSchema","ListResourcesResultSchema","ListResourceTemplatesRequestSchema","ListResourceTemplatesResultSchema","ReadResourceRequestSchema","ReadResourceResultSchema","ResourceListChangedNotificationSchema","SubscribeRequestSchema","UnsubscribeRequestSchema","ResourceUpdatedNotificationSchema","PromptArgumentSchema","PromptSchema","ListPromptsRequestSchema","ListPromptsResultSchema","GetPromptRequestSchema","TextContentSchema","ImageContentSchema","AudioContentSchema","EmbeddedResourceSchema","ResourceLinkSchema","ContentBlockSchema","PromptMessageSchema","GetPromptResultSchema","PromptListChangedNotificationSchema","ToolAnnotationsSchema","ToolSchema","ListToolsRequestSchema","ListToolsResultSchema","CallToolResultSchema","CallToolRequestSchema","ToolListChangedNotificationSchema","LoggingLevelSchema","SetLevelRequestSchema","LoggingMessageNotificationSchema","ModelHintSchema","ModelPreferencesSchema","SamplingMessageSchema","CreateMessageRequestSchema","CreateMessageResultSchema","BooleanSchemaSchema","StringSchemaSchema","NumberSchemaSchema","EnumSchemaSchema","PrimitiveSchemaDefinitionSchema","ElicitRequestSchema","ElicitResultSchema","ResourceTemplateReferenceSchema","PromptReferenceSchema","CompleteRequestSchema","CompleteResultSchema","RootSchema","ListRootsRequestSchema","ListRootsResultSchema","RootsListChangedNotificationSchema","McpError","code","DEFAULT_REQUEST_TIMEOUT_MSEC","Protocol","_options","notification","controller","onTimeout","resetTimeoutOnProgress","timeout","totalElapsed","messageId","transport","_a","_b","_c","_onclose","_onerror","_onmessage","handler","request","_d","abortController","extra","responseHandler","timeoutInfo","relatedRequestId","resumptionToken","reject","jsonrpcRequest","cancel","reason","resultSchema","_e","timeoutHandler","_f","jsonrpcNotification","requestSchema","method","notificationSchema","base","additional","global","factory","_len","_key","sets","xl","subexp","toArray","assign","buildExps","isIRI","DIGIT$$","HEXDIG$$","merge","PCT_ENCODED$","GEN_DELIMS$$","SUB_DELIMS$$","RESERVED$$","UCSCHAR$$","IPRIVATE$$","UNRESERVED$$","ALPHA$$","DEC_OCTET_RELAXED$","IPV4ADDRESS$","H16$","LS32$","IPV6ADDRESS1$","IPV6ADDRESS2$","IPV6ADDRESS3$","IPV6ADDRESS4$","IPV6ADDRESS5$","IPV6ADDRESS6$","IPV6ADDRESS7$","IPV6ADDRESS8$","IPV6ADDRESS9$","IPV6ADDRESS$","ZONEID$","PCHAR$","IRI_PROTOCOL","slicedToArray","sliceIterator","_arr","_n","_i","_s","err","toConsumableArray","arr2","tMin","skew","damp","initialBias","regexNonASCII","baseMinusTMin","floor","stringFromCharCode","error$1","fn","parts","string","regexSeparators","labels","encoded","map","counter","ucs2encode","codePoint","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","tMax","decode","inputLength","initialN","bias","delimiter","basic","oldi","w","basicToDigit","maxInt","baseMinusT","out","encode","_didIteratorError","_iterator","_step","_iteratorNormalCompletion","_currentValue2","_iteratorError","handledCPCount","basicLength","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","handledCPCountPlusOne","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_currentValue","qMinusT","toUnicode","mapDomain","punycode","ucs2decode","toASCII","pctEncChar","chr","newStr","il","c2","c3","protocol","decodeUnreserved","decStr","components","toUpperCase","_normalizeIPv4","_matches","address","_stripLeadingZeros","_normalizeIPv6","_matches2","_address$toLowerCase$2","_address$toLowerCase$","last","first","lastFields","isLastFieldIPv4Address","fieldCount","lastFieldsStart","firstFields","allZeroFields","field","lastLongest","longestZeroFields","newHost","newFirst","newLast","zone","URI_PARSE","NO_MATCH_IS_UNDEFINED","parse","uriString","URI_PROTOCOL","SCHEMES","schemeHandler","_normalizeComponentEncoding","_recomposeAuthority","uriTokens","$1","$2","RDS1","RDS3","RDS5","removeDotSegments","RDS2","im","pctDecChars","authority","resolveComponents","relative","skipNormalization","serialize","resolve","relativeURI","schemelessOptions","normalize","typeOf","equal","uriA","uriB","escapeComponent","secure","handler$1","isSecure","wsComponents","_wsComponents$resourc","path","_wsComponents$resourc2","query","handler$3","handler$2","ATEXT$$","QTEXT$$","VCHAR$$","SOME_DELIMS$$","UNRESERVED","PCT_ENCODED","NOT_LOCAL_PART","NOT_HFNAME","NOT_HFVALUE","handler$4","mailtoComponents","to","unknownHeaders","hfields","hfield","toAddrs","_x","_xl","unescapeComponent","_x2","addr","toAddr","atIdx","localPart","domain","URN_PARSE","handler$5","urnComponents","scheme","nid","nss","urnScheme","uriComponents","handler$6","uuidComponents","exports","pos","len","util","checkDataType","checkDataTypes","toHash","varOccurences","varReplace","schemaUnknownRules","getPath","unescapeJsonPointer","dataType","strictNumbers","negate","EQUAL","OK","NOT","AND","dataTypes","types","COERCE_TO_TYPES","optionCoerceTypes","hash","IDENTIFIER","getProperty","escapeQuotes","SINGLE_QUOTE","dataVar","expr","schemaHasRules","rules","schemaHasRulesExcept","exceptKeyword","toQuotedString","getPathExpr","currentPath","jsonPointers","isNumber","joinPaths","prop","escapeJsonPointer","getData","$data","lvl","paths","up","jsonPointer","segments","segment","unescapeFragment","require$$0","schema_obj","SchemaObject","traverse","cb","opts","_traverse","post","rootSchema","parentJsonPtr","parentKeyword","parentSchema","jsonPtr","keyIndex","sch","escapeJsonPtr","URI","require$$2","require$$3","require$$4","resolve_1","normalizeId","getFullPath","resolveIds","inlineRef","resolveSchema","root","refVal","compile","baseId","res","_getFullPath","refPath","resolveRecursive","getJsonPointer","parsedRef","PREVENT_SCOPE_CHANGE","resolveUrl","limit","checkNoRef","countKeys","count","SIMPLE_INLINED","TRAILING_SLASH_HASH","baseIds","schemaId","fullPaths","localRefs","self","fullPath","error_classes","Subclass","fastJsonStableStringify","cycles","aobj","bobj","stringify","seenIndex","cmp","it","$id","$keywordsMsg","$async","$keyword","$lvl","$dataLvl","$breakOnError","$valid","$$outStack","$errorKeyword","__err","$typeSchema","$typeIsArray","$refKeywords","$rulesGroup","$coerceToTypes","$shouldUseGroup","$schemaPath","$errSchemaPath","$method","$dataType","$coerced","arr1","$i","l1","$parentData","$parentDataProperty","$top","$closingBraces2","i2","l2","arr3","$schemaKeys","$propertyKey","i3","l3","$sch","$schema","$passData","$defaultMsg","arr4","l4","arr5","$rule","i5","l5","$shouldUseRule","$code","$closingBraces1","$ruleImplementsSomeKeyword","impl","require$$1","errorClasses","stableStringify","validateGenerator","require$$5","patterns","patternsHash","defaults","defaultsHash","customRules","callValidate","localCompile","compilation","cv","endCompiling","_root","isRoot","sourceCode","RULES","resolveRef","usePattern","formats","vars","refValCode","patternCode","defaultCode","makeValidate","ValidationError","refIndex","refCode","resolvedRef","_refVal","rootRefId","addLocalRef","localSchema","replaceLocalRef","refId","removeLocalRef","regexStr","useDefault","valueStr","useCustomRule","rule","deps","keyword","validateSchema","macro","inline","compIndex","customRuleCode","cacheModule","Cache","URL","hour","$ruleType","$refCode","$refVal","$message","$it","$nextValid","__callValidate","allOf","$currentBaseId","$allSchemasEmpty","$closingBraces","anyOf","$errs","$noEmptySchema","$wasComposite","comment","_const","$isData","contains","$idx","$nextData","$nonEmptySchema","$dataNxt","dependencies","$schemaDeps","$property","$propertyDeps","$deps","$ownProperties","$useData","$prop","$propertyPath","$missingProperty","$currentErrorPath","_enum","$vSchema","$schemaValue","$allowUnknown","$formatType","$isObject","$unknownFormats","$formatRef","_if","$elseSch","$thenPresent","$thenSch","$elsePresent","$ifClause","$currErrSchemaPath","_limit","$exclusiveKeyword","$isMax","$schemaExcl","$isDataExcl","$op","$notOp","$exclIsNumber","$opExpr","$opStr","$schemaValueExcl","$exclType","$exclusive","_limitItems","_limitLength","_limitProperties","multipleOf","not","$allErrorsOption","oneOf","$passingSchemas","$prevValid","$regexp","$key","$dataProperties","$pPropertyKeys","$someProperties","$aProperties","$removeAdditional","$requiredHash","notProto","$checkAdditional","i1","$pProperty","$noAdditional","$additionalProperty","$additionalIsSchema","$useDefaults","$hasDefault","i4","propertyNames","$invalidName","$propertySch","$loopRequired","$itemType","dotjs","require$$6","require$$7","require$$8","require$$9","require$$12","require$$13","require$$14","require$$15","require$$18","require$$19","require$$20","require$$21","require$$23","ALL","TYPES","group","implKeywords","ruleModules","metaSchema","keywords","KEYWORDS","MissingRefError","async","compileAsync","meta","callback","schemaObj","_compileAsync","loadMissingSchema","added","schemaPromise","$definition","$rDef","$validateCode","$validateSchema","$ruleValidate","$compile","$macro","$ruleErrs","$asyncKeyword","$inline","def_callRuleValidate","def_customError","$ruleErr","addKeyword","getKeyword","removeKeyword","validateKeyword","definition","_addRule","ruleGroup","rg","definitionSchema","compileSchema","Ajv","removeSchema","addFormat","errorsText","_compile","customKeyword","require$$11","$dataMetaSchema","setLogger","chooseGetId","getMetaSchemaOptions","addInitialFormats","addDefaultMetaSchema","schemaKeyRef","_meta","_skipValidation","addMetaSchema","defaultMeta","META_SCHEMA_ID","getSchema","_getSchemaObj","_getSchemaFragment","keyRef","_removeAllSchemas","skipValidation","shouldAddSchema","cacheKey","cached","willValidate","currentOpts","_validate","_get$IdOrId","_getId","separator","$dataSchema","addInitialSchemas","optsSchemas","addInitialKeywords","metaOpts","logger","Client","_clientInfo","capabilities","mergeCapabilities","capability","validator","toolName","windows","isexe","sync","fs","pathext","define_process_env_default","stat","checkPathExt","er","checkStat","checkMode","mod","uid","process","ug","ret","gid","myGid","myUid","core","isexe_1","is","COLON","isWindows","cmd","getPathInfo","opt","pathEnv","colon","pathExt","which","pathExtExe","found","step","getNotFoundError","pathPart","ppRaw","pCmd","subStep","ii","ext","cur","which_1","whichSync","pathKey","environment","pathKeyModule","getPathKey","withoutPathExt","env","hasCustomCwd","shouldSwitchCwd","resolved","resolveCommand","resolveCommandAttempt","resolveCommand_1","metaCharsRegExp","escapeArgument","doubleEscapeMetaChars","_escape","shebangRegex","shebangCommand","binary","readShebang","command","buffer","Buffer","fd","isExecutableRegExp","isCmdShimRegExp","shebang","parseNonShell","isWin","commandFile","detectShebang","needsShell","needsDoubleEscapeMetaChars","escape","shellCommand","notFoundError","original","hookChildProcess","cp","verifyENOENT","originalEmit","status","verifyENOENTSync","enoent","spawn","spawned","spawnSync","crossSpawnModule","streamBrowser","ownKeys","enumerableOnly","symbols","object","_defineProperty","Constructor","_defineProperties","descriptor","_toPropertyKey","_createClass","protoProps","_toPrimitive","prim","_require","_require2","inspect","copyBuffer","offset","buffer_list","_classCallCheck","BufferList","entry","hasStrings","nb","buf","_objectSpread","destroy","readableDestroyed","writableDestroyed","_this","emitErrorAndCloseNT","emitCloseNT","emitErrorNT","rState","wState","undestroy","errorOrDestroy","superClass","subClass","codes","createErrorType","Base","arg1","arg2","arg3","NodeError","_Base","_inheritsLoose","expected","thing","endsWith","this_len","start","actual","determiner","startsWith","msg","includes","errorsBrowser","isDuplex","duplexKey","getHighWaterMark","hwm","highWaterMarkFrom","browser","deprecate","warned","deprecated","_stream_writable","Writable","CorkedRequest","Duplex","WritableState","internalUtil","Stream","OurUint8Array","_uint8ArrayToBuffer","destroyImpl","nop","noDecode","onwrite","current","realHasInstance","ERR_STREAM_CANNOT_PIPE","writeAfterEnd","ERR_STREAM_WRITE_AFTER_END","ERR_STREAM_NULL_VALUES","ERR_INVALID_ARG_TYPE","isBuf","encoding","writeOrBuffer","newChunk","decodeChunk","writev","finishMaybe","onwriteStateUpdate","ERR_MULTIPLE_CALLBACK","onwriteError","finished","needFinish","clearBuffer","afterWrite","onwriteDrain","holder","allBuffers","doWrite","endWritable","callFinal","prefinish","need","onCorkedFinish","corkReq","_stream_duplex","Readable","objectKeys","onend","onEndNT","once","called","eos","writableEnded","onfinish","writable","readableEnded","readable","onerror","onclose","ERR_STREAM_PREMATURE_CLOSE","onrequest","isRequest","onlegacyfinish","kLastResolve","kLastReject","kLastPromise","createIterResult","done","readAndResolve","iter","kStream","onReadable","wrapForNext","lastPromise","_Object$setPrototypeO","kError","promise","kHandlePromise","AsyncIteratorPrototype","createReadableStreamAsyncIterator","_Object$create","iterator","ReadableStreamAsyncIteratorPrototype","fromBrowser","EElistenerCount","emitter","_isUint8Array","debugUtil","debug","_require$codes","StringDecoder","prependListener","ReadableState","skipChunkCheck","readableAddChunk","onEofChunk","addToFront","addChunk","maybeReadMore","emitReadable","chunkInvalid","require$$10","enc","decoder","MAX_HWM","computeNewHighWaterMark","endReadable","doRead","howMuchToRead","nOrig","fromList","emitReadable_","maybeReadMore_","ERR_METHOD_NOT_IMPLEMENTED","src","dest","pipeOpts","doEnd","endFn","unpipe","onunpipe","unpipeInfo","cleanup","ondrain","pipeOnDrain","ondata","indexOf","cleanedUp","dests","ev","updateReadableListening","resume","resume_","paused","kProxyEvents","endReadableNT","iterable","from","xs","_stream_transform","Transform","ts","rs","err2","_stream_passthrough","PassThrough","ERR_MISSING_ARGS","ERR_STREAM_DESTROYED","destroyer","reading","writing","closed","destroyed","call","pipe","streams","pipeline","popCallback","destroys","pipeline_1","EE","inherits","didOnEnd","ReadBuffer","line","deserializeMessage","serializeMessage","DEFAULT_INHERITED_ENV_VARS","getDefaultEnvironment","StdioClientTransport","server","isElectron","_code","_arg","createParser","callbacks","onEvent","onError","onRetry","onComment","incompleteLine","isFirstChunk","eventType","feed","complete","incomplete","splitLines","parseLine","dispatchEvent","fieldSeparatorIndex","processField","ParseError","reset","searchIndex","crIndex","lfIndex","lineEnd","ErrorEvent","errorEventInitDict","inspectableError","DomException","flattenError","__typeError","__accessCheck","member","__privateGet","getter","__privateSet","setter","_readyState","_redirectUrl","_reconnectInterval","_lastEventId","_controller","_parser","_onError","_onMessage","_onOpen","_EventSource_instances","connect_fn","_onFetchResponse","_onFetchError","getRequestOptions_fn","_onEvent","_onRetryChange","failConnection_fn","scheduleReconnect_fn","_reconnect","EventSource","eventSourceInitDict","__privateAdd","_a2","body","redirected","__privateMethod","openEvent","_url","messageEvent","_reconnectTimer","syntaxError","_fetch","_withCredentials","listener","listen","init","errorEvent","getBaseURL","crypto","random","randomIndex","randomUints","mask","generateVerifier","generateChallenge","pkceChallenge","challenge","verifier","OAuthProtectedResourceMetadataSchema","OAuthClientMetadataSchema","uris","OAuthClientInformationSchema","resourceURL","checkResourceAllowed","requestedResource","configuredResource","configured","requested","requestedPath","OAuthError","errorUri","InvalidRequestError","InvalidClientError","InvalidGrantError","UnauthorizedClientError","UnsupportedGrantTypeError","InvalidScopeError","AccessDeniedError","ServerError","TemporarilyUnavailableError","UnsupportedResponseTypeError","UnsupportedTokenTypeError","InvalidTokenError","MethodNotAllowedError","TooManyRequestsError","InvalidClientMetadataError","InsufficientScopeError","OAUTH_ERRORS","UnauthorizedError","selectClientAuthMethod","supportedMethods","clientInformation","hasClientSecret","applyClientAuthentication","applyBasicAuth","applyPublicAuth","client_id","clientSecret","applyPostAuth","clientId","parseErrorResponse","statusCode","OAuthErrorResponseSchema","errorClass","errorMessage","auth","authInternal","serverUrl","authorizationCode","resourceMetadata","discoverOAuthProtectedResourceMetadata","fetchFn","resource","selectResourceURL","authorizationServerUrl","registerClient","exchangeAuthorization","codeVerifier","tokens","newTokens","refreshAuthorization","scope","defaultResource","extractResourceMetadataUrl","authenticateHeader","fetchWithCorsRetry","wellKnownPrefix","pathname","wellKnownPath","tryMetadataDiscovery","shouldAttemptFallback","wellKnownType","protocolVersion","buildWellKnownPath","issuer","rootUrl","discoverOAuthMetadata","startAuthorization","redirectUrl","responseType","authorizationUrl","codeChallenge","redirectUri","grantType","addClientAuthentication","authMethod","tokenUrl","refreshToken","registrationUrl","OAuthClientInformationFullSchema","SseError","SSEClientTransport","fetchImpl","version","__defProp","__defNormalProp","__publicField","totalLength","char","EventSourceParserStream","parser","DEFAULT_STREAMABLE_HTTP_RECONNECTION_OPTIONS","StreamableHTTPError","StreamableHTTPClientTransport","growFactor","maxRetries","delay","attemptCount","isReconnectable","onresumptiontoken","lastEventId","replayMessageId","contentType","hasRequests","responseMessages","ms","fmtLong","msAbs","plural","isPlural","setup","createDebug","coerce","disable","enable","selectColor","namespace","namespacesCache","enabledCache","curr","prevTime","formatter","extend","enableOverride","newDebug","namespaces","split","ns","templateIndex","starIndex","matchIndex","enabled","skip","matchesTemplate","common","formatArgs","save","load","useColors","lastC","localstorage","formatters","assertNever","validKeys","filtered","checker","joinValues","objectUtil","ZodParsedType","ZodIssueCode","ZodError","sub","subs","actualProto","mapper","_mapper","issue","processError","el","fieldErrors","firstEl","issues","_ctx","defaultErrorMap","overrideErrorMap","makeIssue","issueData","fullIssue","maps","errorMaps","addIssueToContext","overrideMap","getErrorMap","ctx","arrayValue","results","INVALID","pairs","pair","syncPairs","ParseStatus","finalObject","DIRTY","isAborted","isDirty","errorUtil","ParseInputLazyPath","handleResult","isValid","errorMap","required_error","iss","getParsedType","isAsync","maybeAsyncResult","check","setError","refinementData","ZodEffects","refinement","ZodOptional","ZodNullable","ZodArray","option","ZodUnion","incoming","ZodIntersection","processCreateParams","defaultValueFunc","def","ZodDefault","ZodBranded","ZodFirstPartyTypeKind","catchValueFunc","This","ZodPipeline","ZodReadonly","cuidRegex","ulidRegex","uuidRegex","nanoidRegex","durationRegex","emailRegex","_emojiRegex","emojiRegex","ipv4Regex","ipv4CidrRegex","ipv6Regex","ipv6CidrRegex","base64Regex","base64urlRegex","dateRegexSource","dateRegex","timeRegexSource","secondsRegexSource","secondsQuantifier","timeRegex","datetimeRegex","isValidIP","ip","isValidJWT","jwt","alg","jwtRegex","base64","header","decoded","isValidCidr","ZodString","ZodType","tooSmall","tooBig","cuid2Regex","minLength","maxLength","ch","min","max","valDecCount","stepDecCount","decCount","stepInt","ZodNumber","floatSafeRemainder","inclusive","kind","ZodBigInt","ZodBoolean","ZodDate","minDate","maxDate","ZodSymbol","ZodUndefined","ZodNull","ZodAny","ZodUnknown","ZodNever","ZodVoid","deepPartialify","newShape","fieldSchema","ZodTuple","ZodObject","extraKeys","shapeKeys","keyValidator","shape","unknownKeys","catchall","defaultError","augmentation","merging","newField","createZodEnum","handleResults","unionErrors","childCtx","dirty","mergeValues","aType","bType","bKeys","sharedKeys","newObj","sharedValue","itemA","itemB","newArray","handleParsed","parsedRight","merged","parsedLeft","itemIndex","ZodRecord","keyType","valueType","third","ZodMap","finalMap","ZodSet","elements","parsedSet","finalizeSet","minSize","maxSize","ZodLazy","ZodLiteral","ZodEnum","expectedValues","enumValues","newDef","ZodNativeEnum","nativeEnumValues","ZodPromise","checkCtx","effect","processed","executeRefinement","inner","preprocess","ZodCatch","newCtx","ZodNaN","inResult","freeze","cleanParams","fatal","_params","_fatal","numberType","unionType","recordType","literalType","isZodObject","callToolResultContentTypes","callToolResultContentSchema","callToolResultContentTypeZodLiterals","z.literal","z.union","outputTypesUnion","z\n        .literal","detailedOutputHandlingSchema","z.object","z\n        .union","z\n            .literal","outputHandlingSchema","z\n    .union","oAuthClientProviderSchema","requiredMethods","baseConfigSchema","z.number","z\n    .object","z\n        .number","stdioConnectionSchema","z.string","z\n        .record","z\n        .string","streamableHttpReconnectSchema","z\n        .boolean","streamableHttpConnectionSchema","clientConfigSchema","outputHandling","override","_resolveDetailedOutputHandling","debugLog","ToolException","isResourceReference","_embeddedResourceToStandardFileBlocks","client","_toolOutputToContentBlocks","useStandardContentBlocks","serverName","block","blocks","_embeddedResourceToArtifact","_getOutputTypeForContentType","_convertCallToolResult","convertedContent","artifacts","_callTool","getDebugLog","requestOptions","callToolArgs","isToolException","defaultLoadMcpToolsOptions","loadMcpTools","mcpTools","toolsResponse","serverPrefix","prefixToolNameWithServerName","toolNamePrefix","initialPrefix","_runManager","throwOnLoadError","MCPClientError","MultiServerMCPClient","parsedServerConfig","configSchema","parsedMcpServers","z.record","serverConfig","_resolveAndApplyOverrideHandlingOverrides","defaultToolTimeout","connectionsToInit","isResolvedStdioConnection","servers","restart","stderr","originalOnClose","streamableError","urlObj","lastPart","pathnameParts","reconnect","transportField","authProvider","automaticSSEFallback","transportType","typeField","sseUrl","requestHeaders","reconnectionOptions","connected","maxAttempts","attempts","delayMs","isResolvedStreamableHTTPConnection","allTools","PROTOCOL","mpcs","defaultOptions","setResponseValueAndErrors","parseAnyDef","parseArrayDef","parseDef","parseBigintDef","parseCatchDef","overrideDateStrategy","strategy","integerDateParser","parseDefaultDef","_def","parseEffectsDef","isJsonSchema7AllOfType","unevaluatedProperties","nestedSchema","mergedAllOf","parseLiteralDef","parsedType","zodPatterns","parseStringDef","processPattern","escapeNonAlphaNumeric","addPattern","processRegExp","regexOrFunction","flags","isEscaped","inCharRange","inCharGroup","regexTest","parseRecordDef","parseBrandedDef","parseMapDef","parseNativeEnumDef","actualValues","parsedTypes","parseNeverDef","primitiveMappings","parseUnionDef","uniqueTypes","parseNullableDef","parseNumberDef","decideAdditionalProperties","parseObjectDef","propName","propDef","parsedDef","innerSchema","parseSetDef","parseTupleDef","parseUndefinedDef","parseUnknownDef","parseReadonlyDef","forceResolution","seenItem","ignoreOverride","seenSchema","get$ref","newItem","jsonSchema","addMeta","getRelativePath","pathA","pathB","parseBooleanDef","parseDateDef","parseNullDef","parseIntersectionDef","definitions","combined","main","McpNode","viewAll","getMCPClientTools","zodToJsonSchema","toolList","setViewAll","SessionInfoNode","EmbeddingNode","JSONLDataNode","ShapeNode","CircleNode","PlaceholderNode","toggleVariants","Toggle","TogglePrimitive.Root","variant","React.createContext","ToggleGroup","ToggleGroupPrimitive.Root","ToggleGroupContext","ToggleGroupItem","React.useContext","ToggleGroupPrimitive.Item","viewport","useStore","ChangeInfo","change","ChangeLogger","setChanges","store","useStoreApi","handleNodeChanges","newChanges","prevChanges","NoChanges","NodeInspector","ViewportPortal","internalNode","getInternalNode","NodeInfo","absPosition","position","formattedPosition","selectionStatus","absoluteTransform","formattedDimensions","DevToolsToggle","Panel","active","setActive","DevTools","changeLoggerActive","setChangeLoggerActive","nodeInspectorActive","viewportLoggerActive","setViewportLoggerActive","ViewportLogger","useFlowManager","updatePositionRef","onNodesChangesRef","flowEdges","setNodes","addConnectionToEdges","deleteFlowNode","findFlowNodesWithSource","flowEdgesRef","currentSessionIdRef","loadingState","initFlow","resetFlows","prepareFlowInfo","setLoadingState","flowNodes","findFlowEdges","In","updateNodeChanges","updateFlowNode","DISABLED_DELETE_NODE_TYPES","updateDimensionsRef","updateEdgeChanges","deleteFlowEdge","updateOrCreateNode","updatingNode","deepmerge","addOnNodeChangeHandler","updateEdgeConnection","useAutomaticallyRenderFlows","flowManager","flowStateReady","flowNodesRef","removeSyncNodeQueue","removeSyncEdgeQueue","unsubNodeHandler","syncNodeQueue","previousSyncNodeQueue","handlingQueueItems","unsubEdgeHandler","previousSyncEdgeQueue","initializing","setInitializing","selectedModelRef","setInitProgressCallback","nodeRefs","callbackRemoval","HomeInner","useHomePage","onConnect","nodeTypes","onNodesChange","onEdgesChange","Background","BackgroundVariant","Controls","isDev","Home"],"ignoreList":[0,1,2,3,4,5,9,10,11,12,13,14,15,19,20,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278],"sources":["../../node_modules/framer-motion/dist/es/value/use-motion-value.mjs","../../node_modules/framer-motion/dist/es/value/use-combine-values.mjs","../../node_modules/framer-motion/dist/es/value/use-spring.mjs","../../node_modules/framer-motion/dist/es/utils/transform.mjs","../../node_modules/framer-motion/dist/es/value/use-computed.mjs","../../node_modules/framer-motion/dist/es/value/use-transform.mjs","../../src/services/database/types/message.ts","../../src/services/database/types/thread.ts","../../src/services/database/types/prompt.ts","../../node_modules/@cfworker/json-schema/dist/esm/pointer.js","../../node_modules/@cfworker/json-schema/dist/esm/dereference.js","../../node_modules/@cfworker/json-schema/dist/esm/format.js","../../node_modules/@cfworker/json-schema/dist/esm/ucs2-length.js","../../node_modules/@cfworker/json-schema/dist/esm/validate.js","../../node_modules/@langchain/core/dist/tools/index.js","../../node_modules/@radix-ui/react-menubar/dist/index.mjs","../../src/lib/shadcn/ui/menubar.tsx","../../src/states/flow/index.ts","../../src/hooks/flows/mutations/use-create-llm.ts","../../node_modules/cmdk/dist/chunk-NZJY6EH4.mjs","../../node_modules/cmdk/dist/index.mjs","../../src/lib/shadcn/ui/command.tsx","../../src/lib/shadcn/ui/checkbox.tsx","../../src/constants/llm.ts","../../src/components/molecules/CreateLLMCard/constants.ts","../../src/components/dialogs/CreateSessionPassphraseDialog/index.tsx","../../src/hooks/mutations/use-update-session-passphrase.ts","../../src/hooks/mutations/use-confirm-or-create-passphrase.ts","../../src/components/molecules/CreateLLMCard/index.tsx","../../src/hooks/flows/mutations/use-create-prompt.ts","../../src/components/molecules/CreatePromptCard/constants.ts","../../src/components/molecules/CreatePromptCard/PromptForm.tsx","../../src/components/molecules/CreatePromptCard/index.tsx","../../src/hooks/flows/mutations/use-create-schema.ts","../../src/components/molecules/CreateSchemaCard/Field/NewOrUpdateField.tsx","../../src/components/molecules/CreateSchemaCard/Field/FieldList.tsx","../../src/components/molecules/CreateSchemaCard/index.tsx","../../src/hooks/flows/mutations/use-create-csv-data.ts","../../src/components/molecules/CreateFewShotExampleCard/ExampleTable/index.tsx","../../src/components/molecules/CreateFewShotExampleCard/index.tsx","../../src/hooks/flows/mutations/use-create-tool.ts","../../src/components/molecules/CreateToolCard/index.tsx","../../src/hooks/flows/mutations/use-create-vector-database.ts","../../src/components/molecules/CreateVectorDatabaseCard/constants.ts","../../src/components/molecules/CreateVectorDatabaseCard/index.tsx","../../src/components/molecules/CreateTextDataCard/DataTable/index.tsx","../../src/components/molecules/CreateTextDataCard/index.tsx","../../src/components/flows/Nodes/ToolboxNode/constants.ts","../../src/lib/shadcn/ui/cool-mode.tsx","../../src/components/molecules/CreateMCPCard/MCPForm.tsx","../../src/hooks/flows/mutations/use-create-mcp.ts","../../src/components/molecules/CreateMCPCard/index.tsx","../../src/components/flows/Nodes/ToolboxNode/ToolBarNode.tsx","../../src/hooks/mutations/use-create-standalone-session.ts","../../src/hooks/flows/mutations/use-delete-node-flow.ts","../../src/components/dialogs/CreateStandaloneApplicationDialog/index.tsx","../../src/components/flows/NodeHeader/NodeHeader.tsx","../../src/components/flows/DefaultHandle/DefaultHandle.tsx","../../src/hooks/flows/mutations/use-create-thread.ts","../../src/components/flows/Nodes/LLMNode/hooks/use-actions.ts","../../src/hooks/flows/handlers/use-base-connection-to-handler.ts","../../src/components/flows/Nodes/LLMNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/LLMNode/LLMNode.tsx","../../src/components/molecules/NewMessageCard/index.tsx","../../src/utils/thread-conversation-traveling.ts","../../src/utils/build-message-history.ts","../../src/utils/flow-to-local-llm.ts","../../src/hooks/flows/use-flow-embedding-node.ts","../../src/hooks/flows/mutations/use-create-message.ts","../../src/components/flows/Nodes/ThreadNode/hooks/use-actions.ts","../../src/components/flows/Nodes/ThreadNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/ThreadNode/ThreadNode.tsx","../../src/components/flows/Nodes/MessageNode/components/HumanMessage.tsx","../../src/components/flows/Nodes/MessageNode/components/AIMessage.tsx","../../src/components/flows/Nodes/MessageNode/hooks/use-actions.ts","../../src/hooks/flows/mutations/use-create-idie-message.ts","../../src/components/flows/Nodes/MessageNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/MessageNode/MessageNode.tsx","../../src/components/flows/Nodes/PromptNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/PromptNode/PromptNode.tsx","../../src/utils/bytes-format.ts","../../src/components/flows/Nodes/SessionInfoNode/SessionInfoNode.tsx","../../src/components/flows/Nodes/SchemaNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/SchemaNode/SchemaNode.tsx","../../src/components/flows/Nodes/CSVDataNode/CSVDataNode.tsx","../../src/components/flows/Nodes/ToolNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/ToolNode/ToolNode.tsx","../../src/components/atoms/EmbeddingSetting.tsx","../../src/components/flows/Nodes/EmbeddingNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/EmbeddingNode/hooks/use-actions.ts","../../src/components/flows/Nodes/EmbeddingNode/EmbeddingNode.tsx","../../src/components/dialogs/CreateVectorDatabasePromptDialog/index.tsx","../../src/hooks/flows/mutations/use-create-vector-database-retriever.ts","../../src/components/dialogs/CreateVectorDatabaseRetrieverDialog/index.tsx","../../src/components/flows/Nodes/VectorDatabaseNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/VectorDatabaseNode/hooks/use-actions.ts","../../src/components/flows/Nodes/VectorDatabaseNode/VectorDatabaseNode.tsx","../../src/components/flows/Nodes/JSONLDataNode/JSONLDataNode.tsx","../../src/lib/shadcn/ui/dock.tsx","../../src/components/flows/Nodes/ApplicationBarNode/constants.ts","../../src/components/flows/Nodes/ApplicationBarNode/hooks/use-actions.ts","../../src/components/flows/Nodes/ApplicationBarNode/ApplicationBarNode.tsx","../../src/components/flows/DefaultNodeResizer/DefaultNodeResizer.tsx","../../src/components/flows/Nodes/ShapeNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/ShapeNode/ShapeNode.tsx","../../src/components/flows/Nodes/CircleNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/CircleNode/CircleNode.tsx","../../src/components/flows/Nodes/TriangleNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/TriangleNode/TriangleNode.tsx","../../src/components/flows/Nodes/EditorAppNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/EditorAppNode/hooks/use-actions.ts","../../src/components/flows/Nodes/EditorAppNode/EditorAppNode.tsx","../../src/components/flows/Nodes/PlaceholderNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/PlaceholderNode/PlaceholderNode.tsx","../../src/services/web-container/source-bases/index.ts","../../src/components/molecules/CreateSourcebaseCard/index.tsx","../../src/components/flows/Nodes/VSLiteAppNode/hooks/use-actions.ts","../../src/components/flows/Nodes/VSLiteAppNode/hooks/use-connection-to-handler.ts","../../src/components/flows/Nodes/VSLiteAppNode/VSLiteAppNode.tsx","../../src/components/flows/Nodes/MCPNode/hooks/use-connection-to-handler.ts","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseAnyOf.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseBoolean.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseDefault.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseMultipleType.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseNot.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseNull.js","../../node_modules/json-schema-to-zod/dist/esm/utils/half.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseAllOf.js","../../node_modules/json-schema-to-zod/dist/esm/utils/withMessage.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseArray.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseConst.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseEnum.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseIfThenElse.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseNumber.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseOneOf.js","../../node_modules/json-schema-to-zod/dist/esm/utils/jsdocs.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseObject.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseString.js","../../node_modules/json-schema-to-zod/dist/esm/utils/omit.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseNullable.js","../../node_modules/json-schema-to-zod/dist/esm/parsers/parseSchema.js","../../node_modules/json-schema-to-zod/dist/esm/jsonSchemaToZod.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/types.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/shared/protocol.js","../../node_modules/uri-js/dist/es5/uri.all.js","../../node_modules/ajv/lib/compile/ucs2length.js","../../node_modules/ajv/lib/compile/util.js","../../node_modules/ajv/lib/compile/schema_obj.js","../../node_modules/json-schema-traverse/index.js","../../node_modules/ajv/lib/compile/resolve.js","../../node_modules/ajv/lib/compile/error_classes.js","../../node_modules/fast-json-stable-stringify/index.js","../../node_modules/ajv/lib/dotjs/validate.js","../../node_modules/ajv/lib/compile/index.js","../../node_modules/ajv/lib/cache.js","../../node_modules/ajv/lib/compile/formats.js","../../node_modules/ajv/lib/dotjs/ref.js","../../node_modules/ajv/lib/dotjs/allOf.js","../../node_modules/ajv/lib/dotjs/anyOf.js","../../node_modules/ajv/lib/dotjs/comment.js","../../node_modules/ajv/lib/dotjs/const.js","../../node_modules/ajv/lib/dotjs/contains.js","../../node_modules/ajv/lib/dotjs/dependencies.js","../../node_modules/ajv/lib/dotjs/enum.js","../../node_modules/ajv/lib/dotjs/format.js","../../node_modules/ajv/lib/dotjs/if.js","../../node_modules/ajv/lib/dotjs/items.js","../../node_modules/ajv/lib/dotjs/_limit.js","../../node_modules/ajv/lib/dotjs/_limitItems.js","../../node_modules/ajv/lib/dotjs/_limitLength.js","../../node_modules/ajv/lib/dotjs/_limitProperties.js","../../node_modules/ajv/lib/dotjs/multipleOf.js","../../node_modules/ajv/lib/dotjs/not.js","../../node_modules/ajv/lib/dotjs/oneOf.js","../../node_modules/ajv/lib/dotjs/pattern.js","../../node_modules/ajv/lib/dotjs/properties.js","../../node_modules/ajv/lib/dotjs/propertyNames.js","../../node_modules/ajv/lib/dotjs/required.js","../../node_modules/ajv/lib/dotjs/uniqueItems.js","../../node_modules/ajv/lib/dotjs/index.js","../../node_modules/ajv/lib/compile/rules.js","../../node_modules/ajv/lib/data.js","../../node_modules/ajv/lib/compile/async.js","../../node_modules/ajv/lib/dotjs/custom.js","../../node_modules/ajv/lib/definition_schema.js","../../node_modules/ajv/lib/keyword.js","../../node_modules/ajv/lib/ajv.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/client/index.js","../../node_modules/isexe/windows.js","../../node_modules/isexe/mode.js","../../node_modules/isexe/index.js","../../node_modules/which/which.js","../../node_modules/path-key/index.js","../../node_modules/@modelcontextprotocol/sdk/node_modules/cross-spawn/lib/util/resolveCommand.js","../../node_modules/@modelcontextprotocol/sdk/node_modules/cross-spawn/lib/util/escape.js","../../node_modules/shebang-regex/index.js","../../node_modules/shebang-command/index.js","../../node_modules/@modelcontextprotocol/sdk/node_modules/cross-spawn/lib/util/readShebang.js","../../node_modules/@modelcontextprotocol/sdk/node_modules/cross-spawn/lib/parse.js","../../node_modules/@modelcontextprotocol/sdk/node_modules/cross-spawn/lib/enoent.js","../../node_modules/@modelcontextprotocol/sdk/node_modules/cross-spawn/index.js","../../node_modules/readable-stream/lib/internal/streams/stream-browser.js","../../node_modules/readable-stream/lib/internal/streams/buffer_list.js","../../node_modules/readable-stream/lib/internal/streams/destroy.js","../../node_modules/readable-stream/errors-browser.js","../../node_modules/readable-stream/lib/internal/streams/state.js","../../node_modules/util-deprecate/browser.js","../../node_modules/readable-stream/lib/_stream_writable.js","../../node_modules/readable-stream/lib/_stream_duplex.js","../../node_modules/readable-stream/lib/internal/streams/end-of-stream.js","../../node_modules/readable-stream/lib/internal/streams/async_iterator.js","../../node_modules/readable-stream/lib/internal/streams/from-browser.js","../../node_modules/readable-stream/lib/_stream_readable.js","../../node_modules/readable-stream/lib/_stream_transform.js","../../node_modules/readable-stream/lib/_stream_passthrough.js","../../node_modules/readable-stream/lib/internal/streams/pipeline.js","../../node_modules/stream-browserify/index.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/shared/stdio.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/client/stdio.js","../../node_modules/eventsource/node_modules/eventsource-parser/dist/index.js","../../node_modules/eventsource/dist/index.js","../../node_modules/pkce-challenge/dist/index.browser.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/shared/auth.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/shared/auth-utils.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/server/auth/errors.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/client/auth.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/client/sse.js","../../node_modules/eventsource-parser/dist/index.js","../../node_modules/eventsource-parser/dist/stream.js","../../node_modules/@modelcontextprotocol/sdk/dist/esm/client/streamableHttp.js","../../node_modules/ms/index.js","../../node_modules/@langchain/mcp-adapters/node_modules/debug/src/common.js","../../node_modules/@langchain/mcp-adapters/node_modules/debug/src/browser.js","../../node_modules/@langchain/mcp-adapters/node_modules/zod/v3/helpers/util.js","../../node_modules/@langchain/mcp-adapters/node_modules/zod/v3/ZodError.js","../../node_modules/@langchain/mcp-adapters/node_modules/zod/v3/locales/en.js","../../node_modules/@langchain/mcp-adapters/node_modules/zod/v3/errors.js","../../node_modules/@langchain/mcp-adapters/node_modules/zod/v3/helpers/parseUtil.js","../../node_modules/@langchain/mcp-adapters/node_modules/zod/v3/helpers/errorUtil.js","../../node_modules/@langchain/mcp-adapters/node_modules/zod/v3/types.js","../../node_modules/@langchain/mcp-adapters/dist/types.js","../../node_modules/@langchain/mcp-adapters/dist/tools.js","../../node_modules/@langchain/mcp-adapters/dist/client.js","../../src/services/mcp/index.ts","../../node_modules/zod-to-json-schema/dist/esm/Options.js","../../node_modules/zod-to-json-schema/dist/esm/Refs.js","../../node_modules/zod-to-json-schema/dist/esm/errorMessages.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/any.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/array.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/bigint.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/boolean.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/branded.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/catch.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/date.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/default.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/effects.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/enum.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/intersection.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/literal.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/string.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/record.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/map.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/nativeEnum.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/never.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/null.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/union.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/nullable.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/number.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/object.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/optional.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/pipeline.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/promise.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/set.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/tuple.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/undefined.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/unknown.js","../../node_modules/zod-to-json-schema/dist/esm/parsers/readonly.js","../../node_modules/zod-to-json-schema/dist/esm/parseDef.js","../../node_modules/zod-to-json-schema/dist/esm/zodToJsonSchema.js","../../src/components/flows/Nodes/MCPNode/MCPNode.tsx","../../src/components/flows/Nodes/index.tsx","../../src/lib/shadcn/ui/toggle.tsx","../../src/lib/shadcn/ui/toggle-group.tsx","../../src/lib/shadcn/devtools.tsx","../../src/hooks/flows/handlers/use-flow-manager.ts","../../src/hooks/flows/handlers/use-automatically-render-flow.ts","../../src/components/pages/Home/hooks/use-home-page.ts","../../src/components/pages/Home/Home.tsx"],"sourcesContent":["import { motionValue } from 'motion-dom';\nimport { useContext, useState, useEffect } from 'react';\nimport { MotionConfigContext } from '../context/MotionConfigContext.mjs';\nimport { useConstant } from '../utils/use-constant.mjs';\n\n/**\n * Creates a `MotionValue` to track the state and velocity of a value.\n *\n * Usually, these are created automatically. For advanced use-cases, like use with `useTransform`, you can create `MotionValue`s externally and pass them into the animated component via the `style` prop.\n *\n * ```jsx\n * export const MyComponent = () => {\n *   const scale = useMotionValue(1)\n *\n *   return <motion.div style={{ scale }} />\n * }\n * ```\n *\n * @param initial - The initial state.\n *\n * @public\n */\nfunction useMotionValue(initial) {\n    const value = useConstant(() => motionValue(initial));\n    /**\n     * If this motion value is being used in static mode, like on\n     * the Framer canvas, force components to rerender when the motion\n     * value is updated.\n     */\n    const { isStatic } = useContext(MotionConfigContext);\n    if (isStatic) {\n        const [, setLatest] = useState(initial);\n        useEffect(() => value.on(\"change\", setLatest), []);\n    }\n    return value;\n}\n\nexport { useMotionValue };\n","import { cancelFrame, frame } from 'motion-dom';\nimport { useIsomorphicLayoutEffect } from '../utils/use-isomorphic-effect.mjs';\nimport { useMotionValue } from './use-motion-value.mjs';\n\nfunction useCombineMotionValues(values, combineValues) {\n    /**\n     * Initialise the returned motion value. This remains the same between renders.\n     */\n    const value = useMotionValue(combineValues());\n    /**\n     * Create a function that will update the template motion value with the latest values.\n     * This is pre-bound so whenever a motion value updates it can schedule its\n     * execution in Framesync. If it's already been scheduled it won't be fired twice\n     * in a single frame.\n     */\n    const updateValue = () => value.set(combineValues());\n    /**\n     * Synchronously update the motion value with the latest values during the render.\n     * This ensures that within a React render, the styles applied to the DOM are up-to-date.\n     */\n    updateValue();\n    /**\n     * Subscribe to all motion values found within the template. Whenever any of them change,\n     * schedule an update.\n     */\n    useIsomorphicLayoutEffect(() => {\n        const scheduleUpdate = () => frame.preRender(updateValue, false, true);\n        const subscriptions = values.map((v) => v.on(\"change\", scheduleUpdate));\n        return () => {\n            subscriptions.forEach((unsubscribe) => unsubscribe());\n            cancelFrame(updateValue);\n        };\n    });\n    return value;\n}\n\nexport { useCombineMotionValues };\n","import { frame } from 'motion-dom';\nimport { noop } from 'motion-utils';\nimport { useContext, useRef, useInsertionEffect } from 'react';\nimport { animateValue } from '../animation/animators/MainThreadAnimation.mjs';\nimport { MotionConfigContext } from '../context/MotionConfigContext.mjs';\nimport { useConstant } from '../utils/use-constant.mjs';\nimport { useIsomorphicLayoutEffect } from '../utils/use-isomorphic-effect.mjs';\nimport { useMotionValue } from './use-motion-value.mjs';\nimport { isMotionValue } from './utils/is-motion-value.mjs';\n\nfunction useSpring(source, config = {}) {\n    const { isStatic } = useContext(MotionConfigContext);\n    const activeSpringAnimation = useRef(null);\n    const initialValue = useConstant(() => isMotionValue(source) ? source.get() : source);\n    const unit = useConstant(() => typeof initialValue === \"string\"\n        ? initialValue.replace(/[\\d.-]/g, \"\")\n        : undefined);\n    const value = useMotionValue(initialValue);\n    const latestValue = useRef(initialValue);\n    const latestSetter = useRef(noop);\n    const startAnimation = () => {\n        stopAnimation();\n        activeSpringAnimation.current = animateValue({\n            keyframes: [asNumber(value.get()), asNumber(latestValue.current)],\n            velocity: value.getVelocity(),\n            type: \"spring\",\n            restDelta: 0.001,\n            restSpeed: 0.01,\n            ...config,\n            onUpdate: latestSetter.current,\n        });\n    };\n    const stopAnimation = () => {\n        if (activeSpringAnimation.current) {\n            activeSpringAnimation.current.stop();\n        }\n    };\n    useInsertionEffect(() => {\n        return value.attach((v, set) => {\n            if (isStatic)\n                return set(v);\n            latestValue.current = v;\n            latestSetter.current = (latest) => set(parseValue(latest, unit));\n            frame.postRender(startAnimation);\n            return value.get();\n        }, stopAnimation);\n    }, [JSON.stringify(config)]);\n    useIsomorphicLayoutEffect(() => {\n        if (isMotionValue(source)) {\n            return source.on(\"change\", (v) => value.set(parseValue(v, unit)));\n        }\n    }, [value, unit]);\n    return value;\n}\nfunction parseValue(v, unit) {\n    return unit ? v + unit : v;\n}\nfunction asNumber(v) {\n    return typeof v === \"number\" ? v : parseFloat(v);\n}\n\nexport { useSpring };\n","import { interpolate } from './interpolate.mjs';\n\nconst isCustomValueType = (v) => {\n    return v && typeof v === \"object\" && v.mix;\n};\nconst getMixer = (v) => (isCustomValueType(v) ? v.mix : undefined);\nfunction transform(...args) {\n    const useImmediate = !Array.isArray(args[0]);\n    const argOffset = useImmediate ? 0 : -1;\n    const inputValue = args[0 + argOffset];\n    const inputRange = args[1 + argOffset];\n    const outputRange = args[2 + argOffset];\n    const options = args[3 + argOffset];\n    const interpolator = interpolate(inputRange, outputRange, {\n        mixer: getMixer(outputRange[0]),\n        ...options,\n    });\n    return useImmediate ? interpolator(inputValue) : interpolator;\n}\n\nexport { transform };\n","import { collectMotionValues } from 'motion-dom';\nimport { useCombineMotionValues } from './use-combine-values.mjs';\n\nfunction useComputed(compute) {\n    /**\n     * Open session of collectMotionValues. Any MotionValue that calls get()\n     * will be saved into this array.\n     */\n    collectMotionValues.current = [];\n    compute();\n    const value = useCombineMotionValues(collectMotionValues.current, compute);\n    /**\n     * Synchronously close session of collectMotionValues.\n     */\n    collectMotionValues.current = undefined;\n    return value;\n}\n\nexport { useComputed };\n","import { transform } from '../utils/transform.mjs';\nimport { useConstant } from '../utils/use-constant.mjs';\nimport { useCombineMotionValues } from './use-combine-values.mjs';\nimport { useComputed } from './use-computed.mjs';\n\nfunction useTransform(input, inputRangeOrTransformer, outputRange, options) {\n    if (typeof input === \"function\") {\n        return useComputed(input);\n    }\n    const transformer = typeof inputRangeOrTransformer === \"function\"\n        ? inputRangeOrTransformer\n        : transform(inputRangeOrTransformer, outputRange, options);\n    return Array.isArray(input)\n        ? useListTransform(input, transformer)\n        : useListTransform([input], ([latest]) => transformer(latest));\n}\nfunction useListTransform(values, transformer) {\n    const latest = useConstant(() => []);\n    return useCombineMotionValues(values, () => {\n        latest.length = 0;\n        const numValues = values.length;\n        for (let i = 0; i < numValues; i++) {\n            latest[i] = values[i].get();\n        }\n        return transformer(latest);\n    });\n}\n\nexport { useTransform };\n","export enum MessageStatusEnum {\n  Started = 'started',\n  Inprogress = 'inprogress',\n  Success = 'success',\n  Failed = 'failed',\n}\n\nexport enum MessageRoleEnum {\n  Human = 'human',\n  User = 'user',\n  AI = 'ai',\n  System = 'system',\n  Assistant = 'assistant',\n  Tool = 'tool',\n  FewShotExample = 'few_shot_example',\n}\n","export enum ThreadStatusEnum {\n  Started = 'started',\n  Inprogress = 'inprogress',\n  Done = 'done',\n}\n","export enum PromptStatusEnum {\n  Started = 'started',\n  Fromated = 'fromated',\n}\n\nexport enum PromptTypeEnum {\n  Chat = 'chat',\n  FewShotExample = 'few_shot_example',\n}\n","export function encodePointer(p) {\n    return encodeURI(escapePointer(p));\n}\nexport function escapePointer(p) {\n    return p.replace(/~/g, '~0').replace(/\\//g, '~1');\n}\n","import { encodePointer } from './pointer.js';\nexport const schemaKeyword = {\n    additionalItems: true,\n    unevaluatedItems: true,\n    items: true,\n    contains: true,\n    additionalProperties: true,\n    unevaluatedProperties: true,\n    propertyNames: true,\n    not: true,\n    if: true,\n    then: true,\n    else: true\n};\nexport const schemaArrayKeyword = {\n    prefixItems: true,\n    items: true,\n    allOf: true,\n    anyOf: true,\n    oneOf: true\n};\nexport const schemaMapKeyword = {\n    $defs: true,\n    definitions: true,\n    properties: true,\n    patternProperties: true,\n    dependentSchemas: true\n};\nexport const ignoredKeyword = {\n    id: true,\n    $id: true,\n    $ref: true,\n    $schema: true,\n    $anchor: true,\n    $vocabulary: true,\n    $comment: true,\n    default: true,\n    enum: true,\n    const: true,\n    required: true,\n    type: true,\n    maximum: true,\n    minimum: true,\n    exclusiveMaximum: true,\n    exclusiveMinimum: true,\n    multipleOf: true,\n    maxLength: true,\n    minLength: true,\n    pattern: true,\n    format: true,\n    maxItems: true,\n    minItems: true,\n    uniqueItems: true,\n    maxProperties: true,\n    minProperties: true\n};\nexport let initialBaseURI = typeof self !== 'undefined' &&\n    self.location &&\n    self.location.origin !== 'null'\n    ?\n        new URL(self.location.origin + self.location.pathname + location.search)\n    : new URL('https://github.com/cfworker');\nexport function dereference(schema, lookup = Object.create(null), baseURI = initialBaseURI, basePointer = '') {\n    if (schema && typeof schema === 'object' && !Array.isArray(schema)) {\n        const id = schema.$id || schema.id;\n        if (id) {\n            const url = new URL(id, baseURI.href);\n            if (url.hash.length > 1) {\n                lookup[url.href] = schema;\n            }\n            else {\n                url.hash = '';\n                if (basePointer === '') {\n                    baseURI = url;\n                }\n                else {\n                    dereference(schema, lookup, baseURI);\n                }\n            }\n        }\n    }\n    else if (schema !== true && schema !== false) {\n        return lookup;\n    }\n    const schemaURI = baseURI.href + (basePointer ? '#' + basePointer : '');\n    if (lookup[schemaURI] !== undefined) {\n        throw new Error(`Duplicate schema URI \"${schemaURI}\".`);\n    }\n    lookup[schemaURI] = schema;\n    if (schema === true || schema === false) {\n        return lookup;\n    }\n    if (schema.__absolute_uri__ === undefined) {\n        Object.defineProperty(schema, '__absolute_uri__', {\n            enumerable: false,\n            value: schemaURI\n        });\n    }\n    if (schema.$ref && schema.__absolute_ref__ === undefined) {\n        const url = new URL(schema.$ref, baseURI.href);\n        url.hash = url.hash;\n        Object.defineProperty(schema, '__absolute_ref__', {\n            enumerable: false,\n            value: url.href\n        });\n    }\n    if (schema.$recursiveRef && schema.__absolute_recursive_ref__ === undefined) {\n        const url = new URL(schema.$recursiveRef, baseURI.href);\n        url.hash = url.hash;\n        Object.defineProperty(schema, '__absolute_recursive_ref__', {\n            enumerable: false,\n            value: url.href\n        });\n    }\n    if (schema.$anchor) {\n        const url = new URL('#' + schema.$anchor, baseURI.href);\n        lookup[url.href] = schema;\n    }\n    for (let key in schema) {\n        if (ignoredKeyword[key]) {\n            continue;\n        }\n        const keyBase = `${basePointer}/${encodePointer(key)}`;\n        const subSchema = schema[key];\n        if (Array.isArray(subSchema)) {\n            if (schemaArrayKeyword[key]) {\n                const length = subSchema.length;\n                for (let i = 0; i < length; i++) {\n                    dereference(subSchema[i], lookup, baseURI, `${keyBase}/${i}`);\n                }\n            }\n        }\n        else if (schemaMapKeyword[key]) {\n            for (let subKey in subSchema) {\n                dereference(subSchema[subKey], lookup, baseURI, `${keyBase}/${encodePointer(subKey)}`);\n            }\n        }\n        else {\n            dereference(subSchema, lookup, baseURI, keyBase);\n        }\n    }\n    return lookup;\n}\n","const DATE = /^(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)$/;\nconst DAYS = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\nconst TIME = /^(\\d\\d):(\\d\\d):(\\d\\d)(\\.\\d+)?(z|[+-]\\d\\d(?::?\\d\\d)?)?$/i;\nconst HOSTNAME = /^(?=.{1,253}\\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\\.?$/i;\nconst URIREF = /^(?:[a-z][a-z0-9+\\-.]*:)?(?:\\/?\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\\.[a-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)|(?:[a-z0-9\\-._~!$&'\"()*+,;=]|%[0-9a-f]{2})*)(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*|\\/(?:(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\\?(?:[a-z0-9\\-._~!$&'\"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\\-._~!$&'\"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;\nconst URITEMPLATE = /^(?:(?:[^\\x00-\\x20\"'<>%\\\\^`{|}]|%[0-9a-f]{2})|\\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\\*)?)*\\})*$/i;\nconst URL_ = /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u{00a1}-\\u{ffff}0-9]+-?)*[a-z\\u{00a1}-\\u{ffff}0-9]+)(?:\\.(?:[a-z\\u{00a1}-\\u{ffff}0-9]+-?)*[a-z\\u{00a1}-\\u{ffff}0-9]+)*(?:\\.(?:[a-z\\u{00a1}-\\u{ffff}]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/iu;\nconst UUID = /^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i;\nconst JSON_POINTER = /^(?:\\/(?:[^~/]|~0|~1)*)*$/;\nconst JSON_POINTER_URI_FRAGMENT = /^#(?:\\/(?:[a-z0-9_\\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i;\nconst RELATIVE_JSON_POINTER = /^(?:0|[1-9][0-9]*)(?:#|(?:\\/(?:[^~/]|~0|~1)*)*)$/;\nconst EMAIL = (input) => {\n    if (input[0] === '\"')\n        return false;\n    const [name, host, ...rest] = input.split('@');\n    if (!name ||\n        !host ||\n        rest.length !== 0 ||\n        name.length > 64 ||\n        host.length > 253)\n        return false;\n    if (name[0] === '.' || name.endsWith('.') || name.includes('..'))\n        return false;\n    if (!/^[a-z0-9.-]+$/i.test(host) ||\n        !/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(name))\n        return false;\n    return host\n        .split('.')\n        .every(part => /^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(part));\n};\nconst IPV4 = /^(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$/;\nconst IPV6 = /^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))$/i;\nconst DURATION = (input) => input.length > 1 &&\n    input.length < 80 &&\n    (/^P\\d+([.,]\\d+)?W$/.test(input) ||\n        (/^P[\\dYMDTHS]*(\\d[.,]\\d+)?[YMDHS]$/.test(input) &&\n            /^P([.,\\d]+Y)?([.,\\d]+M)?([.,\\d]+D)?(T([.,\\d]+H)?([.,\\d]+M)?([.,\\d]+S)?)?$/.test(input)));\nfunction bind(r) {\n    return r.test.bind(r);\n}\nexport const format = {\n    date,\n    time: time.bind(undefined, false),\n    'date-time': date_time,\n    duration: DURATION,\n    uri,\n    'uri-reference': bind(URIREF),\n    'uri-template': bind(URITEMPLATE),\n    url: bind(URL_),\n    email: EMAIL,\n    hostname: bind(HOSTNAME),\n    ipv4: bind(IPV4),\n    ipv6: bind(IPV6),\n    regex: regex,\n    uuid: bind(UUID),\n    'json-pointer': bind(JSON_POINTER),\n    'json-pointer-uri-fragment': bind(JSON_POINTER_URI_FRAGMENT),\n    'relative-json-pointer': bind(RELATIVE_JSON_POINTER)\n};\nfunction isLeapYear(year) {\n    return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);\n}\nfunction date(str) {\n    const matches = str.match(DATE);\n    if (!matches)\n        return false;\n    const year = +matches[1];\n    const month = +matches[2];\n    const day = +matches[3];\n    return (month >= 1 &&\n        month <= 12 &&\n        day >= 1 &&\n        day <= (month == 2 && isLeapYear(year) ? 29 : DAYS[month]));\n}\nfunction time(full, str) {\n    const matches = str.match(TIME);\n    if (!matches)\n        return false;\n    const hour = +matches[1];\n    const minute = +matches[2];\n    const second = +matches[3];\n    const timeZone = !!matches[5];\n    return (((hour <= 23 && minute <= 59 && second <= 59) ||\n        (hour == 23 && minute == 59 && second == 60)) &&\n        (!full || timeZone));\n}\nconst DATE_TIME_SEPARATOR = /t|\\s/i;\nfunction date_time(str) {\n    const dateTime = str.split(DATE_TIME_SEPARATOR);\n    return dateTime.length == 2 && date(dateTime[0]) && time(true, dateTime[1]);\n}\nconst NOT_URI_FRAGMENT = /\\/|:/;\nconst URI_PATTERN = /^(?:[a-z][a-z0-9+\\-.]*:)(?:\\/?\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\\.[a-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)|(?:[a-z0-9\\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\\?(?:[a-z0-9\\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;\nfunction uri(str) {\n    return NOT_URI_FRAGMENT.test(str) && URI_PATTERN.test(str);\n}\nconst Z_ANCHOR = /[^\\\\]\\\\Z/;\nfunction regex(str) {\n    if (Z_ANCHOR.test(str))\n        return false;\n    try {\n        new RegExp(str, 'u');\n        return true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n","export function ucs2length(s) {\n    let result = 0;\n    let length = s.length;\n    let index = 0;\n    let charCode;\n    while (index < length) {\n        result++;\n        charCode = s.charCodeAt(index++);\n        if (charCode >= 0xd800 && charCode <= 0xdbff && index < length) {\n            charCode = s.charCodeAt(index);\n            if ((charCode & 0xfc00) == 0xdc00) {\n                index++;\n            }\n        }\n    }\n    return result;\n}\n","import { deepCompareStrict } from './deep-compare-strict.js';\nimport { dereference } from './dereference.js';\nimport { format } from './format.js';\nimport { encodePointer } from './pointer.js';\nimport { ucs2length } from './ucs2-length.js';\nexport function validate(instance, schema, draft = '2019-09', lookup = dereference(schema), shortCircuit = true, recursiveAnchor = null, instanceLocation = '#', schemaLocation = '#', evaluated = Object.create(null)) {\n    if (schema === true) {\n        return { valid: true, errors: [] };\n    }\n    if (schema === false) {\n        return {\n            valid: false,\n            errors: [\n                {\n                    instanceLocation,\n                    keyword: 'false',\n                    keywordLocation: instanceLocation,\n                    error: 'False boolean schema.'\n                }\n            ]\n        };\n    }\n    const rawInstanceType = typeof instance;\n    let instanceType;\n    switch (rawInstanceType) {\n        case 'boolean':\n        case 'number':\n        case 'string':\n            instanceType = rawInstanceType;\n            break;\n        case 'object':\n            if (instance === null) {\n                instanceType = 'null';\n            }\n            else if (Array.isArray(instance)) {\n                instanceType = 'array';\n            }\n            else {\n                instanceType = 'object';\n            }\n            break;\n        default:\n            throw new Error(`Instances of \"${rawInstanceType}\" type are not supported.`);\n    }\n    const { $ref, $recursiveRef, $recursiveAnchor, type: $type, const: $const, enum: $enum, required: $required, not: $not, anyOf: $anyOf, allOf: $allOf, oneOf: $oneOf, if: $if, then: $then, else: $else, format: $format, properties: $properties, patternProperties: $patternProperties, additionalProperties: $additionalProperties, unevaluatedProperties: $unevaluatedProperties, minProperties: $minProperties, maxProperties: $maxProperties, propertyNames: $propertyNames, dependentRequired: $dependentRequired, dependentSchemas: $dependentSchemas, dependencies: $dependencies, prefixItems: $prefixItems, items: $items, additionalItems: $additionalItems, unevaluatedItems: $unevaluatedItems, contains: $contains, minContains: $minContains, maxContains: $maxContains, minItems: $minItems, maxItems: $maxItems, uniqueItems: $uniqueItems, minimum: $minimum, maximum: $maximum, exclusiveMinimum: $exclusiveMinimum, exclusiveMaximum: $exclusiveMaximum, multipleOf: $multipleOf, minLength: $minLength, maxLength: $maxLength, pattern: $pattern, __absolute_ref__, __absolute_recursive_ref__ } = schema;\n    const errors = [];\n    if ($recursiveAnchor === true && recursiveAnchor === null) {\n        recursiveAnchor = schema;\n    }\n    if ($recursiveRef === '#') {\n        const refSchema = recursiveAnchor === null\n            ? lookup[__absolute_recursive_ref__]\n            : recursiveAnchor;\n        const keywordLocation = `${schemaLocation}/$recursiveRef`;\n        const result = validate(instance, recursiveAnchor === null ? schema : recursiveAnchor, draft, lookup, shortCircuit, refSchema, instanceLocation, keywordLocation, evaluated);\n        if (!result.valid) {\n            errors.push({\n                instanceLocation,\n                keyword: '$recursiveRef',\n                keywordLocation,\n                error: 'A subschema had errors.'\n            }, ...result.errors);\n        }\n    }\n    if ($ref !== undefined) {\n        const uri = __absolute_ref__ || $ref;\n        const refSchema = lookup[uri];\n        if (refSchema === undefined) {\n            let message = `Unresolved $ref \"${$ref}\".`;\n            if (__absolute_ref__ && __absolute_ref__ !== $ref) {\n                message += `  Absolute URI \"${__absolute_ref__}\".`;\n            }\n            message += `\\nKnown schemas:\\n- ${Object.keys(lookup).join('\\n- ')}`;\n            throw new Error(message);\n        }\n        const keywordLocation = `${schemaLocation}/$ref`;\n        const result = validate(instance, refSchema, draft, lookup, shortCircuit, recursiveAnchor, instanceLocation, keywordLocation, evaluated);\n        if (!result.valid) {\n            errors.push({\n                instanceLocation,\n                keyword: '$ref',\n                keywordLocation,\n                error: 'A subschema had errors.'\n            }, ...result.errors);\n        }\n        if (draft === '4' || draft === '7') {\n            return { valid: errors.length === 0, errors };\n        }\n    }\n    if (Array.isArray($type)) {\n        let length = $type.length;\n        let valid = false;\n        for (let i = 0; i < length; i++) {\n            if (instanceType === $type[i] ||\n                ($type[i] === 'integer' &&\n                    instanceType === 'number' &&\n                    instance % 1 === 0 &&\n                    instance === instance)) {\n                valid = true;\n                break;\n            }\n        }\n        if (!valid) {\n            errors.push({\n                instanceLocation,\n                keyword: 'type',\n                keywordLocation: `${schemaLocation}/type`,\n                error: `Instance type \"${instanceType}\" is invalid. Expected \"${$type.join('\", \"')}\".`\n            });\n        }\n    }\n    else if ($type === 'integer') {\n        if (instanceType !== 'number' || instance % 1 || instance !== instance) {\n            errors.push({\n                instanceLocation,\n                keyword: 'type',\n                keywordLocation: `${schemaLocation}/type`,\n                error: `Instance type \"${instanceType}\" is invalid. Expected \"${$type}\".`\n            });\n        }\n    }\n    else if ($type !== undefined && instanceType !== $type) {\n        errors.push({\n            instanceLocation,\n            keyword: 'type',\n            keywordLocation: `${schemaLocation}/type`,\n            error: `Instance type \"${instanceType}\" is invalid. Expected \"${$type}\".`\n        });\n    }\n    if ($const !== undefined) {\n        if (instanceType === 'object' || instanceType === 'array') {\n            if (!deepCompareStrict(instance, $const)) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'const',\n                    keywordLocation: `${schemaLocation}/const`,\n                    error: `Instance does not match ${JSON.stringify($const)}.`\n                });\n            }\n        }\n        else if (instance !== $const) {\n            errors.push({\n                instanceLocation,\n                keyword: 'const',\n                keywordLocation: `${schemaLocation}/const`,\n                error: `Instance does not match ${JSON.stringify($const)}.`\n            });\n        }\n    }\n    if ($enum !== undefined) {\n        if (instanceType === 'object' || instanceType === 'array') {\n            if (!$enum.some(value => deepCompareStrict(instance, value))) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'enum',\n                    keywordLocation: `${schemaLocation}/enum`,\n                    error: `Instance does not match any of ${JSON.stringify($enum)}.`\n                });\n            }\n        }\n        else if (!$enum.some(value => instance === value)) {\n            errors.push({\n                instanceLocation,\n                keyword: 'enum',\n                keywordLocation: `${schemaLocation}/enum`,\n                error: `Instance does not match any of ${JSON.stringify($enum)}.`\n            });\n        }\n    }\n    if ($not !== undefined) {\n        const keywordLocation = `${schemaLocation}/not`;\n        const result = validate(instance, $not, draft, lookup, shortCircuit, recursiveAnchor, instanceLocation, keywordLocation);\n        if (result.valid) {\n            errors.push({\n                instanceLocation,\n                keyword: 'not',\n                keywordLocation,\n                error: 'Instance matched \"not\" schema.'\n            });\n        }\n    }\n    let subEvaluateds = [];\n    if ($anyOf !== undefined) {\n        const keywordLocation = `${schemaLocation}/anyOf`;\n        const errorsLength = errors.length;\n        let anyValid = false;\n        for (let i = 0; i < $anyOf.length; i++) {\n            const subSchema = $anyOf[i];\n            const subEvaluated = Object.create(evaluated);\n            const result = validate(instance, subSchema, draft, lookup, shortCircuit, $recursiveAnchor === true ? recursiveAnchor : null, instanceLocation, `${keywordLocation}/${i}`, subEvaluated);\n            errors.push(...result.errors);\n            anyValid = anyValid || result.valid;\n            if (result.valid) {\n                subEvaluateds.push(subEvaluated);\n            }\n        }\n        if (anyValid) {\n            errors.length = errorsLength;\n        }\n        else {\n            errors.splice(errorsLength, 0, {\n                instanceLocation,\n                keyword: 'anyOf',\n                keywordLocation,\n                error: 'Instance does not match any subschemas.'\n            });\n        }\n    }\n    if ($allOf !== undefined) {\n        const keywordLocation = `${schemaLocation}/allOf`;\n        const errorsLength = errors.length;\n        let allValid = true;\n        for (let i = 0; i < $allOf.length; i++) {\n            const subSchema = $allOf[i];\n            const subEvaluated = Object.create(evaluated);\n            const result = validate(instance, subSchema, draft, lookup, shortCircuit, $recursiveAnchor === true ? recursiveAnchor : null, instanceLocation, `${keywordLocation}/${i}`, subEvaluated);\n            errors.push(...result.errors);\n            allValid = allValid && result.valid;\n            if (result.valid) {\n                subEvaluateds.push(subEvaluated);\n            }\n        }\n        if (allValid) {\n            errors.length = errorsLength;\n        }\n        else {\n            errors.splice(errorsLength, 0, {\n                instanceLocation,\n                keyword: 'allOf',\n                keywordLocation,\n                error: `Instance does not match every subschema.`\n            });\n        }\n    }\n    if ($oneOf !== undefined) {\n        const keywordLocation = `${schemaLocation}/oneOf`;\n        const errorsLength = errors.length;\n        const matches = $oneOf.filter((subSchema, i) => {\n            const subEvaluated = Object.create(evaluated);\n            const result = validate(instance, subSchema, draft, lookup, shortCircuit, $recursiveAnchor === true ? recursiveAnchor : null, instanceLocation, `${keywordLocation}/${i}`, subEvaluated);\n            errors.push(...result.errors);\n            if (result.valid) {\n                subEvaluateds.push(subEvaluated);\n            }\n            return result.valid;\n        }).length;\n        if (matches === 1) {\n            errors.length = errorsLength;\n        }\n        else {\n            errors.splice(errorsLength, 0, {\n                instanceLocation,\n                keyword: 'oneOf',\n                keywordLocation,\n                error: `Instance does not match exactly one subschema (${matches} matches).`\n            });\n        }\n    }\n    if (instanceType === 'object' || instanceType === 'array') {\n        Object.assign(evaluated, ...subEvaluateds);\n    }\n    if ($if !== undefined) {\n        const keywordLocation = `${schemaLocation}/if`;\n        const conditionResult = validate(instance, $if, draft, lookup, shortCircuit, recursiveAnchor, instanceLocation, keywordLocation, evaluated).valid;\n        if (conditionResult) {\n            if ($then !== undefined) {\n                const thenResult = validate(instance, $then, draft, lookup, shortCircuit, recursiveAnchor, instanceLocation, `${schemaLocation}/then`, evaluated);\n                if (!thenResult.valid) {\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'if',\n                        keywordLocation,\n                        error: `Instance does not match \"then\" schema.`\n                    }, ...thenResult.errors);\n                }\n            }\n        }\n        else if ($else !== undefined) {\n            const elseResult = validate(instance, $else, draft, lookup, shortCircuit, recursiveAnchor, instanceLocation, `${schemaLocation}/else`, evaluated);\n            if (!elseResult.valid) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'if',\n                    keywordLocation,\n                    error: `Instance does not match \"else\" schema.`\n                }, ...elseResult.errors);\n            }\n        }\n    }\n    if (instanceType === 'object') {\n        if ($required !== undefined) {\n            for (const key of $required) {\n                if (!(key in instance)) {\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'required',\n                        keywordLocation: `${schemaLocation}/required`,\n                        error: `Instance does not have required property \"${key}\".`\n                    });\n                }\n            }\n        }\n        const keys = Object.keys(instance);\n        if ($minProperties !== undefined && keys.length < $minProperties) {\n            errors.push({\n                instanceLocation,\n                keyword: 'minProperties',\n                keywordLocation: `${schemaLocation}/minProperties`,\n                error: `Instance does not have at least ${$minProperties} properties.`\n            });\n        }\n        if ($maxProperties !== undefined && keys.length > $maxProperties) {\n            errors.push({\n                instanceLocation,\n                keyword: 'maxProperties',\n                keywordLocation: `${schemaLocation}/maxProperties`,\n                error: `Instance does not have at least ${$maxProperties} properties.`\n            });\n        }\n        if ($propertyNames !== undefined) {\n            const keywordLocation = `${schemaLocation}/propertyNames`;\n            for (const key in instance) {\n                const subInstancePointer = `${instanceLocation}/${encodePointer(key)}`;\n                const result = validate(key, $propertyNames, draft, lookup, shortCircuit, recursiveAnchor, subInstancePointer, keywordLocation);\n                if (!result.valid) {\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'propertyNames',\n                        keywordLocation,\n                        error: `Property name \"${key}\" does not match schema.`\n                    }, ...result.errors);\n                }\n            }\n        }\n        if ($dependentRequired !== undefined) {\n            const keywordLocation = `${schemaLocation}/dependantRequired`;\n            for (const key in $dependentRequired) {\n                if (key in instance) {\n                    const required = $dependentRequired[key];\n                    for (const dependantKey of required) {\n                        if (!(dependantKey in instance)) {\n                            errors.push({\n                                instanceLocation,\n                                keyword: 'dependentRequired',\n                                keywordLocation,\n                                error: `Instance has \"${key}\" but does not have \"${dependantKey}\".`\n                            });\n                        }\n                    }\n                }\n            }\n        }\n        if ($dependentSchemas !== undefined) {\n            for (const key in $dependentSchemas) {\n                const keywordLocation = `${schemaLocation}/dependentSchemas`;\n                if (key in instance) {\n                    const result = validate(instance, $dependentSchemas[key], draft, lookup, shortCircuit, recursiveAnchor, instanceLocation, `${keywordLocation}/${encodePointer(key)}`, evaluated);\n                    if (!result.valid) {\n                        errors.push({\n                            instanceLocation,\n                            keyword: 'dependentSchemas',\n                            keywordLocation,\n                            error: `Instance has \"${key}\" but does not match dependant schema.`\n                        }, ...result.errors);\n                    }\n                }\n            }\n        }\n        if ($dependencies !== undefined) {\n            const keywordLocation = `${schemaLocation}/dependencies`;\n            for (const key in $dependencies) {\n                if (key in instance) {\n                    const propsOrSchema = $dependencies[key];\n                    if (Array.isArray(propsOrSchema)) {\n                        for (const dependantKey of propsOrSchema) {\n                            if (!(dependantKey in instance)) {\n                                errors.push({\n                                    instanceLocation,\n                                    keyword: 'dependencies',\n                                    keywordLocation,\n                                    error: `Instance has \"${key}\" but does not have \"${dependantKey}\".`\n                                });\n                            }\n                        }\n                    }\n                    else {\n                        const result = validate(instance, propsOrSchema, draft, lookup, shortCircuit, recursiveAnchor, instanceLocation, `${keywordLocation}/${encodePointer(key)}`);\n                        if (!result.valid) {\n                            errors.push({\n                                instanceLocation,\n                                keyword: 'dependencies',\n                                keywordLocation,\n                                error: `Instance has \"${key}\" but does not match dependant schema.`\n                            }, ...result.errors);\n                        }\n                    }\n                }\n            }\n        }\n        const thisEvaluated = Object.create(null);\n        let stop = false;\n        if ($properties !== undefined) {\n            const keywordLocation = `${schemaLocation}/properties`;\n            for (const key in $properties) {\n                if (!(key in instance)) {\n                    continue;\n                }\n                const subInstancePointer = `${instanceLocation}/${encodePointer(key)}`;\n                const result = validate(instance[key], $properties[key], draft, lookup, shortCircuit, recursiveAnchor, subInstancePointer, `${keywordLocation}/${encodePointer(key)}`);\n                if (result.valid) {\n                    evaluated[key] = thisEvaluated[key] = true;\n                }\n                else {\n                    stop = shortCircuit;\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'properties',\n                        keywordLocation,\n                        error: `Property \"${key}\" does not match schema.`\n                    }, ...result.errors);\n                    if (stop)\n                        break;\n                }\n            }\n        }\n        if (!stop && $patternProperties !== undefined) {\n            const keywordLocation = `${schemaLocation}/patternProperties`;\n            for (const pattern in $patternProperties) {\n                const regex = new RegExp(pattern, 'u');\n                const subSchema = $patternProperties[pattern];\n                for (const key in instance) {\n                    if (!regex.test(key)) {\n                        continue;\n                    }\n                    const subInstancePointer = `${instanceLocation}/${encodePointer(key)}`;\n                    const result = validate(instance[key], subSchema, draft, lookup, shortCircuit, recursiveAnchor, subInstancePointer, `${keywordLocation}/${encodePointer(pattern)}`);\n                    if (result.valid) {\n                        evaluated[key] = thisEvaluated[key] = true;\n                    }\n                    else {\n                        stop = shortCircuit;\n                        errors.push({\n                            instanceLocation,\n                            keyword: 'patternProperties',\n                            keywordLocation,\n                            error: `Property \"${key}\" matches pattern \"${pattern}\" but does not match associated schema.`\n                        }, ...result.errors);\n                    }\n                }\n            }\n        }\n        if (!stop && $additionalProperties !== undefined) {\n            const keywordLocation = `${schemaLocation}/additionalProperties`;\n            for (const key in instance) {\n                if (thisEvaluated[key]) {\n                    continue;\n                }\n                const subInstancePointer = `${instanceLocation}/${encodePointer(key)}`;\n                const result = validate(instance[key], $additionalProperties, draft, lookup, shortCircuit, recursiveAnchor, subInstancePointer, keywordLocation);\n                if (result.valid) {\n                    evaluated[key] = true;\n                }\n                else {\n                    stop = shortCircuit;\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'additionalProperties',\n                        keywordLocation,\n                        error: `Property \"${key}\" does not match additional properties schema.`\n                    }, ...result.errors);\n                }\n            }\n        }\n        else if (!stop && $unevaluatedProperties !== undefined) {\n            const keywordLocation = `${schemaLocation}/unevaluatedProperties`;\n            for (const key in instance) {\n                if (!evaluated[key]) {\n                    const subInstancePointer = `${instanceLocation}/${encodePointer(key)}`;\n                    const result = validate(instance[key], $unevaluatedProperties, draft, lookup, shortCircuit, recursiveAnchor, subInstancePointer, keywordLocation);\n                    if (result.valid) {\n                        evaluated[key] = true;\n                    }\n                    else {\n                        errors.push({\n                            instanceLocation,\n                            keyword: 'unevaluatedProperties',\n                            keywordLocation,\n                            error: `Property \"${key}\" does not match unevaluated properties schema.`\n                        }, ...result.errors);\n                    }\n                }\n            }\n        }\n    }\n    else if (instanceType === 'array') {\n        if ($maxItems !== undefined && instance.length > $maxItems) {\n            errors.push({\n                instanceLocation,\n                keyword: 'maxItems',\n                keywordLocation: `${schemaLocation}/maxItems`,\n                error: `Array has too many items (${instance.length} > ${$maxItems}).`\n            });\n        }\n        if ($minItems !== undefined && instance.length < $minItems) {\n            errors.push({\n                instanceLocation,\n                keyword: 'minItems',\n                keywordLocation: `${schemaLocation}/minItems`,\n                error: `Array has too few items (${instance.length} < ${$minItems}).`\n            });\n        }\n        const length = instance.length;\n        let i = 0;\n        let stop = false;\n        if ($prefixItems !== undefined) {\n            const keywordLocation = `${schemaLocation}/prefixItems`;\n            const length2 = Math.min($prefixItems.length, length);\n            for (; i < length2; i++) {\n                const result = validate(instance[i], $prefixItems[i], draft, lookup, shortCircuit, recursiveAnchor, `${instanceLocation}/${i}`, `${keywordLocation}/${i}`);\n                evaluated[i] = true;\n                if (!result.valid) {\n                    stop = shortCircuit;\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'prefixItems',\n                        keywordLocation,\n                        error: `Items did not match schema.`\n                    }, ...result.errors);\n                    if (stop)\n                        break;\n                }\n            }\n        }\n        if ($items !== undefined) {\n            const keywordLocation = `${schemaLocation}/items`;\n            if (Array.isArray($items)) {\n                const length2 = Math.min($items.length, length);\n                for (; i < length2; i++) {\n                    const result = validate(instance[i], $items[i], draft, lookup, shortCircuit, recursiveAnchor, `${instanceLocation}/${i}`, `${keywordLocation}/${i}`);\n                    evaluated[i] = true;\n                    if (!result.valid) {\n                        stop = shortCircuit;\n                        errors.push({\n                            instanceLocation,\n                            keyword: 'items',\n                            keywordLocation,\n                            error: `Items did not match schema.`\n                        }, ...result.errors);\n                        if (stop)\n                            break;\n                    }\n                }\n            }\n            else {\n                for (; i < length; i++) {\n                    const result = validate(instance[i], $items, draft, lookup, shortCircuit, recursiveAnchor, `${instanceLocation}/${i}`, keywordLocation);\n                    evaluated[i] = true;\n                    if (!result.valid) {\n                        stop = shortCircuit;\n                        errors.push({\n                            instanceLocation,\n                            keyword: 'items',\n                            keywordLocation,\n                            error: `Items did not match schema.`\n                        }, ...result.errors);\n                        if (stop)\n                            break;\n                    }\n                }\n            }\n            if (!stop && $additionalItems !== undefined) {\n                const keywordLocation = `${schemaLocation}/additionalItems`;\n                for (; i < length; i++) {\n                    const result = validate(instance[i], $additionalItems, draft, lookup, shortCircuit, recursiveAnchor, `${instanceLocation}/${i}`, keywordLocation);\n                    evaluated[i] = true;\n                    if (!result.valid) {\n                        stop = shortCircuit;\n                        errors.push({\n                            instanceLocation,\n                            keyword: 'additionalItems',\n                            keywordLocation,\n                            error: `Items did not match additional items schema.`\n                        }, ...result.errors);\n                    }\n                }\n            }\n        }\n        if ($contains !== undefined) {\n            if (length === 0 && $minContains === undefined) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'contains',\n                    keywordLocation: `${schemaLocation}/contains`,\n                    error: `Array is empty. It must contain at least one item matching the schema.`\n                });\n            }\n            else if ($minContains !== undefined && length < $minContains) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'minContains',\n                    keywordLocation: `${schemaLocation}/minContains`,\n                    error: `Array has less items (${length}) than minContains (${$minContains}).`\n                });\n            }\n            else {\n                const keywordLocation = `${schemaLocation}/contains`;\n                const errorsLength = errors.length;\n                let contained = 0;\n                for (let j = 0; j < length; j++) {\n                    const result = validate(instance[j], $contains, draft, lookup, shortCircuit, recursiveAnchor, `${instanceLocation}/${j}`, keywordLocation);\n                    if (result.valid) {\n                        evaluated[j] = true;\n                        contained++;\n                    }\n                    else {\n                        errors.push(...result.errors);\n                    }\n                }\n                if (contained >= ($minContains || 0)) {\n                    errors.length = errorsLength;\n                }\n                if ($minContains === undefined &&\n                    $maxContains === undefined &&\n                    contained === 0) {\n                    errors.splice(errorsLength, 0, {\n                        instanceLocation,\n                        keyword: 'contains',\n                        keywordLocation,\n                        error: `Array does not contain item matching schema.`\n                    });\n                }\n                else if ($minContains !== undefined && contained < $minContains) {\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'minContains',\n                        keywordLocation: `${schemaLocation}/minContains`,\n                        error: `Array must contain at least ${$minContains} items matching schema. Only ${contained} items were found.`\n                    });\n                }\n                else if ($maxContains !== undefined && contained > $maxContains) {\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'maxContains',\n                        keywordLocation: `${schemaLocation}/maxContains`,\n                        error: `Array may contain at most ${$maxContains} items matching schema. ${contained} items were found.`\n                    });\n                }\n            }\n        }\n        if (!stop && $unevaluatedItems !== undefined) {\n            const keywordLocation = `${schemaLocation}/unevaluatedItems`;\n            for (i; i < length; i++) {\n                if (evaluated[i]) {\n                    continue;\n                }\n                const result = validate(instance[i], $unevaluatedItems, draft, lookup, shortCircuit, recursiveAnchor, `${instanceLocation}/${i}`, keywordLocation);\n                evaluated[i] = true;\n                if (!result.valid) {\n                    errors.push({\n                        instanceLocation,\n                        keyword: 'unevaluatedItems',\n                        keywordLocation,\n                        error: `Items did not match unevaluated items schema.`\n                    }, ...result.errors);\n                }\n            }\n        }\n        if ($uniqueItems) {\n            for (let j = 0; j < length; j++) {\n                const a = instance[j];\n                const ao = typeof a === 'object' && a !== null;\n                for (let k = 0; k < length; k++) {\n                    if (j === k) {\n                        continue;\n                    }\n                    const b = instance[k];\n                    const bo = typeof b === 'object' && b !== null;\n                    if (a === b || (ao && bo && deepCompareStrict(a, b))) {\n                        errors.push({\n                            instanceLocation,\n                            keyword: 'uniqueItems',\n                            keywordLocation: `${schemaLocation}/uniqueItems`,\n                            error: `Duplicate items at indexes ${j} and ${k}.`\n                        });\n                        j = Number.MAX_SAFE_INTEGER;\n                        k = Number.MAX_SAFE_INTEGER;\n                    }\n                }\n            }\n        }\n    }\n    else if (instanceType === 'number') {\n        if (draft === '4') {\n            if ($minimum !== undefined &&\n                (($exclusiveMinimum === true && instance <= $minimum) ||\n                    instance < $minimum)) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'minimum',\n                    keywordLocation: `${schemaLocation}/minimum`,\n                    error: `${instance} is less than ${$exclusiveMinimum ? 'or equal to ' : ''} ${$minimum}.`\n                });\n            }\n            if ($maximum !== undefined &&\n                (($exclusiveMaximum === true && instance >= $maximum) ||\n                    instance > $maximum)) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'maximum',\n                    keywordLocation: `${schemaLocation}/maximum`,\n                    error: `${instance} is greater than ${$exclusiveMaximum ? 'or equal to ' : ''} ${$maximum}.`\n                });\n            }\n        }\n        else {\n            if ($minimum !== undefined && instance < $minimum) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'minimum',\n                    keywordLocation: `${schemaLocation}/minimum`,\n                    error: `${instance} is less than ${$minimum}.`\n                });\n            }\n            if ($maximum !== undefined && instance > $maximum) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'maximum',\n                    keywordLocation: `${schemaLocation}/maximum`,\n                    error: `${instance} is greater than ${$maximum}.`\n                });\n            }\n            if ($exclusiveMinimum !== undefined && instance <= $exclusiveMinimum) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'exclusiveMinimum',\n                    keywordLocation: `${schemaLocation}/exclusiveMinimum`,\n                    error: `${instance} is less than ${$exclusiveMinimum}.`\n                });\n            }\n            if ($exclusiveMaximum !== undefined && instance >= $exclusiveMaximum) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'exclusiveMaximum',\n                    keywordLocation: `${schemaLocation}/exclusiveMaximum`,\n                    error: `${instance} is greater than or equal to ${$exclusiveMaximum}.`\n                });\n            }\n        }\n        if ($multipleOf !== undefined) {\n            const remainder = instance % $multipleOf;\n            if (Math.abs(0 - remainder) >= 1.1920929e-7 &&\n                Math.abs($multipleOf - remainder) >= 1.1920929e-7) {\n                errors.push({\n                    instanceLocation,\n                    keyword: 'multipleOf',\n                    keywordLocation: `${schemaLocation}/multipleOf`,\n                    error: `${instance} is not a multiple of ${$multipleOf}.`\n                });\n            }\n        }\n    }\n    else if (instanceType === 'string') {\n        const length = $minLength === undefined && $maxLength === undefined\n            ? 0\n            : ucs2length(instance);\n        if ($minLength !== undefined && length < $minLength) {\n            errors.push({\n                instanceLocation,\n                keyword: 'minLength',\n                keywordLocation: `${schemaLocation}/minLength`,\n                error: `String is too short (${length} < ${$minLength}).`\n            });\n        }\n        if ($maxLength !== undefined && length > $maxLength) {\n            errors.push({\n                instanceLocation,\n                keyword: 'maxLength',\n                keywordLocation: `${schemaLocation}/maxLength`,\n                error: `String is too long (${length} > ${$maxLength}).`\n            });\n        }\n        if ($pattern !== undefined && !new RegExp($pattern, 'u').test(instance)) {\n            errors.push({\n                instanceLocation,\n                keyword: 'pattern',\n                keywordLocation: `${schemaLocation}/pattern`,\n                error: `String does not match pattern.`\n            });\n        }\n        if ($format !== undefined &&\n            format[$format] &&\n            !format[$format](instance)) {\n            errors.push({\n                instanceLocation,\n                keyword: 'format',\n                keywordLocation: `${schemaLocation}/format`,\n                error: `String does not match format \"${$format}\".`\n            });\n        }\n    }\n    return { valid: errors.length === 0, errors };\n}\n","import { z } from \"zod/v3\";\nimport { validate, } from \"@cfworker/json-schema\";\nimport { CallbackManager, parseCallbackConfigArg, } from \"../callbacks/manager.js\";\nimport { BaseLangChain } from \"../language_models/base.js\";\nimport { ensureConfig, patchConfig, pickRunnableConfigKeys, } from \"../runnables/config.js\";\nimport { isDirectToolOutput, ToolMessage } from \"../messages/tool.js\";\nimport { AsyncLocalStorageProviderSingleton } from \"../singletons/index.js\";\nimport { _configHasToolCallId, _isToolCall, ToolInputParsingException, } from \"./utils.js\";\nimport { interopParseAsync, isSimpleStringZodSchema, isInteropZodSchema, } from \"../utils/types/zod.js\";\nimport { validatesOnlyStrings } from \"../utils/json_schema.js\";\nexport { isLangChainTool, isRunnableToolLike, isStructuredTool, isStructuredToolParams, } from \"./types.js\";\nexport { ToolInputParsingException };\n/**\n * Base class for Tools that accept input of any shape defined by a Zod schema.\n */\nexport class StructuredTool extends BaseLangChain {\n    get lc_namespace() {\n        return [\"langchain\", \"tools\"];\n    }\n    constructor(fields) {\n        super(fields ?? {});\n        /**\n         * Whether to return the tool's output directly.\n         *\n         * Setting this to true means that after the tool is called,\n         * an agent should stop looping.\n         */\n        Object.defineProperty(this, \"returnDirect\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"verboseParsingErrors\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        /**\n         * The tool response format.\n         *\n         * If \"content\" then the output of the tool is interpreted as the contents of a\n         * ToolMessage. If \"content_and_artifact\" then the output is expected to be a\n         * two-tuple corresponding to the (content, artifact) of a ToolMessage.\n         *\n         * @default \"content\"\n         */\n        Object.defineProperty(this, \"responseFormat\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"content\"\n        });\n        this.verboseParsingErrors =\n            fields?.verboseParsingErrors ?? this.verboseParsingErrors;\n        this.responseFormat = fields?.responseFormat ?? this.responseFormat;\n    }\n    /**\n     * Invokes the tool with the provided input and configuration.\n     * @param input The input for the tool.\n     * @param config Optional configuration for the tool.\n     * @returns A Promise that resolves with the tool's output.\n     */\n    async invoke(input, config) {\n        let toolInput;\n        let enrichedConfig = ensureConfig(config);\n        if (_isToolCall(input)) {\n            toolInput = input.args;\n            enrichedConfig = {\n                ...enrichedConfig,\n                toolCall: input,\n            };\n        }\n        else {\n            toolInput = input;\n        }\n        return this.call(toolInput, enrichedConfig);\n    }\n    /**\n     * @deprecated Use .invoke() instead. Will be removed in 0.3.0.\n     *\n     * Calls the tool with the provided argument, configuration, and tags. It\n     * parses the input according to the schema, handles any errors, and\n     * manages callbacks.\n     * @param arg The input argument for the tool.\n     * @param configArg Optional configuration or callbacks for the tool.\n     * @param tags Optional tags for the tool.\n     * @returns A Promise that resolves with a string.\n     */\n    async call(arg, configArg, \n    /** @deprecated */\n    tags) {\n        // Determine the actual input that needs parsing/validation.\n        // If arg is a ToolCall, use its args; otherwise, use arg directly.\n        const inputForValidation = _isToolCall(arg) ? arg.args : arg;\n        let parsed; // This will hold the successfully parsed input of the expected output type.\n        if (isInteropZodSchema(this.schema)) {\n            try {\n                // Validate the inputForValidation - TS needs help here as it can't exclude ToolCall based on the check\n                parsed = await interopParseAsync(this.schema, inputForValidation);\n            }\n            catch (e) {\n                let message = `Received tool input did not match expected schema`;\n                if (this.verboseParsingErrors) {\n                    message = `${message}\\nDetails: ${e.message}`;\n                }\n                // Pass the original raw input arg to the exception\n                throw new ToolInputParsingException(message, JSON.stringify(arg));\n            }\n        }\n        else {\n            const result = validate(inputForValidation, this.schema);\n            if (!result.valid) {\n                let message = `Received tool input did not match expected schema`;\n                if (this.verboseParsingErrors) {\n                    message = `${message}\\nDetails: ${result.errors\n                        .map((e) => `${e.keywordLocation}: ${e.error}`)\n                        .join(\"\\n\")}`;\n                }\n                // Pass the original raw input arg to the exception\n                throw new ToolInputParsingException(message, JSON.stringify(arg));\n            }\n            // Assign the validated input to parsed\n            // We cast here because validate() doesn't narrow the type sufficiently for TS, but we know it's valid.\n            parsed = inputForValidation;\n        }\n        const config = parseCallbackConfigArg(configArg);\n        const callbackManager_ = CallbackManager.configure(config.callbacks, this.callbacks, config.tags || tags, this.tags, config.metadata, this.metadata, { verbose: this.verbose });\n        const runManager = await callbackManager_?.handleToolStart(this.toJSON(), \n        // Log the original raw input arg\n        typeof arg === \"string\" ? arg : JSON.stringify(arg), config.runId, undefined, undefined, undefined, config.runName);\n        delete config.runId;\n        let result;\n        try {\n            // Pass the correctly typed parsed input to _call\n            result = await this._call(parsed, runManager, config);\n        }\n        catch (e) {\n            await runManager?.handleToolError(e);\n            throw e;\n        }\n        let content;\n        let artifact;\n        if (this.responseFormat === \"content_and_artifact\") {\n            if (Array.isArray(result) && result.length === 2) {\n                [content, artifact] = result;\n            }\n            else {\n                throw new Error(`Tool response format is \"content_and_artifact\" but the output was not a two-tuple.\\nResult: ${JSON.stringify(result)}`);\n            }\n        }\n        else {\n            content = result;\n        }\n        let toolCallId;\n        // Extract toolCallId ONLY if the original arg was a ToolCall\n        if (_isToolCall(arg)) {\n            toolCallId = arg.id;\n        }\n        // Or if it was provided in the config's toolCall property\n        if (!toolCallId && _configHasToolCallId(config)) {\n            toolCallId = config.toolCall.id;\n        }\n        const formattedOutput = _formatToolOutput({\n            content,\n            artifact,\n            toolCallId,\n            name: this.name,\n        });\n        await runManager?.handleToolEnd(formattedOutput);\n        return formattedOutput;\n    }\n}\n/**\n * Base class for Tools that accept input as a string.\n */\nexport class Tool extends StructuredTool {\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"schema\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: z\n                .object({ input: z.string().optional() })\n                .transform((obj) => obj.input)\n        });\n    }\n    /**\n     * @deprecated Use .invoke() instead. Will be removed in 0.3.0.\n     *\n     * Calls the tool with the provided argument and callbacks. It handles\n     * string inputs specifically.\n     * @param arg The input argument for the tool, which can be a string, undefined, or an input of the tool's schema.\n     * @param callbacks Optional callbacks for the tool.\n     * @returns A Promise that resolves with a string.\n     */\n    // Match the base class signature including the generics and conditional return type\n    call(arg, callbacks) {\n        // Prepare the input for the base class call method.\n        // If arg is string or undefined, wrap it; otherwise, pass ToolCall or { input: ... } directly.\n        const structuredArg = typeof arg === \"string\" || arg == null ? { input: arg } : arg;\n        // Ensure TConfig is passed to super.call\n        return super.call(structuredArg, callbacks);\n    }\n}\n/**\n * A tool that can be created dynamically from a function, name, and description.\n */\nexport class DynamicTool extends Tool {\n    static lc_name() {\n        return \"DynamicTool\";\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"description\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"func\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.name = fields.name;\n        this.description = fields.description;\n        this.func = fields.func;\n        this.returnDirect = fields.returnDirect ?? this.returnDirect;\n    }\n    /**\n     * @deprecated Use .invoke() instead. Will be removed in 0.3.0.\n     */\n    async call(arg, configArg) {\n        const config = parseCallbackConfigArg(configArg);\n        if (config.runName === undefined) {\n            config.runName = this.name;\n        }\n        // Call the Tool class's call method, passing generics through\n        // Cast config to TConfig to satisfy the super.call signature\n        return super.call(arg, config);\n    }\n    /** @ignore */\n    async _call(input, // DynamicTool's _call specifically expects a string after schema transformation\n    runManager, parentConfig) {\n        return this.func(input, runManager, parentConfig);\n    }\n}\n/**\n * A tool that can be created dynamically from a function, name, and\n * description, designed to work with structured data. It extends the\n * StructuredTool class and overrides the _call method to execute the\n * provided function when the tool is called.\n *\n * Schema can be passed as Zod or JSON schema. The tool will not validate\n * input if JSON schema is passed.\n */\nexport class DynamicStructuredTool extends StructuredTool {\n    static lc_name() {\n        return \"DynamicStructuredTool\";\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"description\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"func\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"schema\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.name = fields.name;\n        this.description = fields.description;\n        this.func = fields.func;\n        this.returnDirect = fields.returnDirect ?? this.returnDirect;\n        this.schema = fields.schema;\n    }\n    /**\n     * @deprecated Use .invoke() instead. Will be removed in 0.3.0.\n     */\n    // Match the base class signature\n    async call(arg, configArg, \n    /** @deprecated */\n    tags) {\n        const config = parseCallbackConfigArg(configArg);\n        if (config.runName === undefined) {\n            config.runName = this.name;\n        }\n        // Call the base class method, passing generics through\n        // Cast config to TConfig to satisfy the super.call signature\n        return super.call(arg, config, tags);\n    }\n    _call(arg, runManager, parentConfig) {\n        return this.func(arg, runManager, parentConfig);\n    }\n}\n/**\n * Abstract base class for toolkits in LangChain. Toolkits are collections\n * of tools that agents can use. Subclasses must implement the `tools`\n * property to provide the specific tools for the toolkit.\n */\nexport class BaseToolkit {\n    getTools() {\n        return this.tools;\n    }\n}\nexport function tool(func, fields) {\n    const isSimpleStringSchema = isSimpleStringZodSchema(fields.schema);\n    const isStringJSONSchema = validatesOnlyStrings(fields.schema);\n    // If the schema is not provided, or it's a simple string schema, create a DynamicTool\n    if (!fields.schema || isSimpleStringSchema || isStringJSONSchema) {\n        return new DynamicTool({\n            ...fields,\n            description: fields.description ??\n                fields.schema?.description ??\n                `${fields.name} tool`,\n            func: async (input, runManager, config) => {\n                return new Promise((resolve, reject) => {\n                    const childConfig = patchConfig(config, {\n                        callbacks: runManager?.getChild(),\n                    });\n                    void AsyncLocalStorageProviderSingleton.runWithConfig(pickRunnableConfigKeys(childConfig), async () => {\n                        try {\n                            // TS doesn't restrict the type here based on the guard above\n                            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                            resolve(func(input, childConfig));\n                        }\n                        catch (e) {\n                            reject(e);\n                        }\n                    });\n                });\n            },\n        });\n    }\n    const schema = fields.schema;\n    const description = fields.description ??\n        fields.schema.description ??\n        `${fields.name} tool`;\n    return new DynamicStructuredTool({\n        ...fields,\n        description,\n        schema,\n        func: async (input, runManager, config) => {\n            return new Promise((resolve, reject) => {\n                const childConfig = patchConfig(config, {\n                    callbacks: runManager?.getChild(),\n                });\n                void AsyncLocalStorageProviderSingleton.runWithConfig(pickRunnableConfigKeys(childConfig), async () => {\n                    try {\n                        resolve(func(input, childConfig));\n                    }\n                    catch (e) {\n                        reject(e);\n                    }\n                });\n            });\n        },\n    });\n}\nfunction _formatToolOutput(params) {\n    const { content, artifact, toolCallId } = params;\n    if (toolCallId && !isDirectToolOutput(content)) {\n        if (typeof content === \"string\" ||\n            (Array.isArray(content) &&\n                content.every((item) => typeof item === \"object\"))) {\n            return new ToolMessage({\n                content,\n                artifact,\n                tool_call_id: toolCallId,\n                name: params.name,\n            });\n        }\n        else {\n            return new ToolMessage({\n                content: _stringify(content),\n                artifact,\n                tool_call_id: toolCallId,\n                name: params.name,\n            });\n        }\n    }\n    else {\n        return content;\n    }\n}\nfunction _stringify(content) {\n    try {\n        return JSON.stringify(content, null, 2) ?? \"\";\n    }\n    catch (_noOp) {\n        return `${content}`;\n    }\n}\n","\"use client\";\n\n// packages/react/menubar/src/Menubar.tsx\nimport * as React from \"react\";\nimport { createCollection } from \"@radix-ui/react-collection\";\nimport { useDirection } from \"@radix-ui/react-direction\";\nimport { composeEventHandlers } from \"@radix-ui/primitive\";\nimport { useComposedRefs } from \"@radix-ui/react-compose-refs\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useId } from \"@radix-ui/react-id\";\nimport * as MenuPrimitive from \"@radix-ui/react-menu\";\nimport { createMenuScope } from \"@radix-ui/react-menu\";\nimport * as RovingFocusGroup from \"@radix-ui/react-roving-focus\";\nimport { createRovingFocusGroupScope } from \"@radix-ui/react-roving-focus\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport { useControllableState } from \"@radix-ui/react-use-controllable-state\";\nimport { jsx } from \"react/jsx-runtime\";\nvar MENUBAR_NAME = \"Menubar\";\nvar [Collection, useCollection, createCollectionScope] = createCollection(MENUBAR_NAME);\nvar [createMenubarContext, createMenubarScope] = createContextScope(MENUBAR_NAME, [\n  createCollectionScope,\n  createRovingFocusGroupScope\n]);\nvar useMenuScope = createMenuScope();\nvar useRovingFocusGroupScope = createRovingFocusGroupScope();\nvar [MenubarContextProvider, useMenubarContext] = createMenubarContext(MENUBAR_NAME);\nvar Menubar = React.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeMenubar,\n      value: valueProp,\n      onValueChange,\n      defaultValue,\n      loop = true,\n      dir,\n      ...menubarProps\n    } = props;\n    const direction = useDirection(dir);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenubar);\n    const [value = \"\", setValue] = useControllableState({\n      prop: valueProp,\n      onChange: onValueChange,\n      defaultProp: defaultValue\n    });\n    const [currentTabStopId, setCurrentTabStopId] = React.useState(null);\n    return /* @__PURE__ */ jsx(\n      MenubarContextProvider,\n      {\n        scope: __scopeMenubar,\n        value,\n        onMenuOpen: React.useCallback(\n          (value2) => {\n            setValue(value2);\n            setCurrentTabStopId(value2);\n          },\n          [setValue]\n        ),\n        onMenuClose: React.useCallback(() => setValue(\"\"), [setValue]),\n        onMenuToggle: React.useCallback(\n          (value2) => {\n            setValue((prevValue) => Boolean(prevValue) ? \"\" : value2);\n            setCurrentTabStopId(value2);\n          },\n          [setValue]\n        ),\n        dir: direction,\n        loop,\n        children: /* @__PURE__ */ jsx(Collection.Provider, { scope: __scopeMenubar, children: /* @__PURE__ */ jsx(Collection.Slot, { scope: __scopeMenubar, children: /* @__PURE__ */ jsx(\n          RovingFocusGroup.Root,\n          {\n            asChild: true,\n            ...rovingFocusGroupScope,\n            orientation: \"horizontal\",\n            loop,\n            dir: direction,\n            currentTabStopId,\n            onCurrentTabStopIdChange: setCurrentTabStopId,\n            children: /* @__PURE__ */ jsx(Primitive.div, { role: \"menubar\", ...menubarProps, ref: forwardedRef })\n          }\n        ) }) })\n      }\n    );\n  }\n);\nMenubar.displayName = MENUBAR_NAME;\nvar MENU_NAME = \"MenubarMenu\";\nvar [MenubarMenuProvider, useMenubarMenuContext] = createMenubarContext(MENU_NAME);\nvar MenubarMenu = (props) => {\n  const { __scopeMenubar, value: valueProp, ...menuProps } = props;\n  const autoValue = useId();\n  const value = valueProp || autoValue || \"LEGACY_REACT_AUTO_VALUE\";\n  const context = useMenubarContext(MENU_NAME, __scopeMenubar);\n  const menuScope = useMenuScope(__scopeMenubar);\n  const triggerRef = React.useRef(null);\n  const wasKeyboardTriggerOpenRef = React.useRef(false);\n  const open = context.value === value;\n  React.useEffect(() => {\n    if (!open) wasKeyboardTriggerOpenRef.current = false;\n  }, [open]);\n  return /* @__PURE__ */ jsx(\n    MenubarMenuProvider,\n    {\n      scope: __scopeMenubar,\n      value,\n      triggerId: useId(),\n      triggerRef,\n      contentId: useId(),\n      wasKeyboardTriggerOpenRef,\n      children: /* @__PURE__ */ jsx(\n        MenuPrimitive.Root,\n        {\n          ...menuScope,\n          open,\n          onOpenChange: (open2) => {\n            if (!open2) context.onMenuClose();\n          },\n          modal: false,\n          dir: context.dir,\n          ...menuProps\n        }\n      )\n    }\n  );\n};\nMenubarMenu.displayName = MENU_NAME;\nvar TRIGGER_NAME = \"MenubarTrigger\";\nvar MenubarTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, disabled = false, ...triggerProps } = props;\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenubar);\n    const menuScope = useMenuScope(__scopeMenubar);\n    const context = useMenubarContext(TRIGGER_NAME, __scopeMenubar);\n    const menuContext = useMenubarMenuContext(TRIGGER_NAME, __scopeMenubar);\n    const ref = React.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref, menuContext.triggerRef);\n    const [isFocused, setIsFocused] = React.useState(false);\n    const open = context.value === menuContext.value;\n    return /* @__PURE__ */ jsx(Collection.ItemSlot, { scope: __scopeMenubar, value: menuContext.value, disabled, children: /* @__PURE__ */ jsx(\n      RovingFocusGroup.Item,\n      {\n        asChild: true,\n        ...rovingFocusGroupScope,\n        focusable: !disabled,\n        tabStopId: menuContext.value,\n        children: /* @__PURE__ */ jsx(MenuPrimitive.Anchor, { asChild: true, ...menuScope, children: /* @__PURE__ */ jsx(\n          Primitive.button,\n          {\n            type: \"button\",\n            role: \"menuitem\",\n            id: menuContext.triggerId,\n            \"aria-haspopup\": \"menu\",\n            \"aria-expanded\": open,\n            \"aria-controls\": open ? menuContext.contentId : void 0,\n            \"data-highlighted\": isFocused ? \"\" : void 0,\n            \"data-state\": open ? \"open\" : \"closed\",\n            \"data-disabled\": disabled ? \"\" : void 0,\n            disabled,\n            ...triggerProps,\n            ref: composedRefs,\n            onPointerDown: composeEventHandlers(props.onPointerDown, (event) => {\n              if (!disabled && event.button === 0 && event.ctrlKey === false) {\n                context.onMenuOpen(menuContext.value);\n                if (!open) event.preventDefault();\n              }\n            }),\n            onPointerEnter: composeEventHandlers(props.onPointerEnter, () => {\n              const menubarOpen = Boolean(context.value);\n              if (menubarOpen && !open) {\n                context.onMenuOpen(menuContext.value);\n                ref.current?.focus();\n              }\n            }),\n            onKeyDown: composeEventHandlers(props.onKeyDown, (event) => {\n              if (disabled) return;\n              if ([\"Enter\", \" \"].includes(event.key)) context.onMenuToggle(menuContext.value);\n              if (event.key === \"ArrowDown\") context.onMenuOpen(menuContext.value);\n              if ([\"Enter\", \" \", \"ArrowDown\"].includes(event.key)) {\n                menuContext.wasKeyboardTriggerOpenRef.current = true;\n                event.preventDefault();\n              }\n            }),\n            onFocus: composeEventHandlers(props.onFocus, () => setIsFocused(true)),\n            onBlur: composeEventHandlers(props.onBlur, () => setIsFocused(false))\n          }\n        ) })\n      }\n    ) });\n  }\n);\nMenubarTrigger.displayName = TRIGGER_NAME;\nvar PORTAL_NAME = \"MenubarPortal\";\nvar MenubarPortal = (props) => {\n  const { __scopeMenubar, ...portalProps } = props;\n  const menuScope = useMenuScope(__scopeMenubar);\n  return /* @__PURE__ */ jsx(MenuPrimitive.Portal, { ...menuScope, ...portalProps });\n};\nMenubarPortal.displayName = PORTAL_NAME;\nvar CONTENT_NAME = \"MenubarContent\";\nvar MenubarContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, align = \"start\", ...contentProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    const context = useMenubarContext(CONTENT_NAME, __scopeMenubar);\n    const menuContext = useMenubarMenuContext(CONTENT_NAME, __scopeMenubar);\n    const getItems = useCollection(__scopeMenubar);\n    const hasInteractedOutsideRef = React.useRef(false);\n    return /* @__PURE__ */ jsx(\n      MenuPrimitive.Content,\n      {\n        id: menuContext.contentId,\n        \"aria-labelledby\": menuContext.triggerId,\n        \"data-radix-menubar-content\": \"\",\n        ...menuScope,\n        ...contentProps,\n        ref: forwardedRef,\n        align,\n        onCloseAutoFocus: composeEventHandlers(props.onCloseAutoFocus, (event) => {\n          const menubarOpen = Boolean(context.value);\n          if (!menubarOpen && !hasInteractedOutsideRef.current) {\n            menuContext.triggerRef.current?.focus();\n          }\n          hasInteractedOutsideRef.current = false;\n          event.preventDefault();\n        }),\n        onFocusOutside: composeEventHandlers(props.onFocusOutside, (event) => {\n          const target = event.target;\n          const isMenubarTrigger = getItems().some((item) => item.ref.current?.contains(target));\n          if (isMenubarTrigger) event.preventDefault();\n        }),\n        onInteractOutside: composeEventHandlers(props.onInteractOutside, () => {\n          hasInteractedOutsideRef.current = true;\n        }),\n        onEntryFocus: (event) => {\n          if (!menuContext.wasKeyboardTriggerOpenRef.current) event.preventDefault();\n        },\n        onKeyDown: composeEventHandlers(\n          props.onKeyDown,\n          (event) => {\n            if ([\"ArrowRight\", \"ArrowLeft\"].includes(event.key)) {\n              const target = event.target;\n              const targetIsSubTrigger = target.hasAttribute(\"data-radix-menubar-subtrigger\");\n              const isKeyDownInsideSubMenu = target.closest(\"[data-radix-menubar-content]\") !== event.currentTarget;\n              const prevMenuKey = context.dir === \"rtl\" ? \"ArrowRight\" : \"ArrowLeft\";\n              const isPrevKey = prevMenuKey === event.key;\n              const isNextKey = !isPrevKey;\n              if (isNextKey && targetIsSubTrigger) return;\n              if (isKeyDownInsideSubMenu && isPrevKey) return;\n              const items = getItems().filter((item) => !item.disabled);\n              let candidateValues = items.map((item) => item.value);\n              if (isPrevKey) candidateValues.reverse();\n              const currentIndex = candidateValues.indexOf(menuContext.value);\n              candidateValues = context.loop ? wrapArray(candidateValues, currentIndex + 1) : candidateValues.slice(currentIndex + 1);\n              const [nextValue] = candidateValues;\n              if (nextValue) context.onMenuOpen(nextValue);\n            }\n          },\n          { checkForDefaultPrevented: false }\n        ),\n        style: {\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            \"--radix-menubar-content-transform-origin\": \"var(--radix-popper-transform-origin)\",\n            \"--radix-menubar-content-available-width\": \"var(--radix-popper-available-width)\",\n            \"--radix-menubar-content-available-height\": \"var(--radix-popper-available-height)\",\n            \"--radix-menubar-trigger-width\": \"var(--radix-popper-anchor-width)\",\n            \"--radix-menubar-trigger-height\": \"var(--radix-popper-anchor-height)\"\n          }\n        }\n      }\n    );\n  }\n);\nMenubarContent.displayName = CONTENT_NAME;\nvar GROUP_NAME = \"MenubarGroup\";\nvar MenubarGroup = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...groupProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Group, { ...menuScope, ...groupProps, ref: forwardedRef });\n  }\n);\nMenubarGroup.displayName = GROUP_NAME;\nvar LABEL_NAME = \"MenubarLabel\";\nvar MenubarLabel = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...labelProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Label, { ...menuScope, ...labelProps, ref: forwardedRef });\n  }\n);\nMenubarLabel.displayName = LABEL_NAME;\nvar ITEM_NAME = \"MenubarItem\";\nvar MenubarItem = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...itemProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Item, { ...menuScope, ...itemProps, ref: forwardedRef });\n  }\n);\nMenubarItem.displayName = ITEM_NAME;\nvar CHECKBOX_ITEM_NAME = \"MenubarCheckboxItem\";\nvar MenubarCheckboxItem = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...checkboxItemProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.CheckboxItem, { ...menuScope, ...checkboxItemProps, ref: forwardedRef });\n  }\n);\nMenubarCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\nvar RADIO_GROUP_NAME = \"MenubarRadioGroup\";\nvar MenubarRadioGroup = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...radioGroupProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.RadioGroup, { ...menuScope, ...radioGroupProps, ref: forwardedRef });\n  }\n);\nMenubarRadioGroup.displayName = RADIO_GROUP_NAME;\nvar RADIO_ITEM_NAME = \"MenubarRadioItem\";\nvar MenubarRadioItem = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...radioItemProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.RadioItem, { ...menuScope, ...radioItemProps, ref: forwardedRef });\n  }\n);\nMenubarRadioItem.displayName = RADIO_ITEM_NAME;\nvar INDICATOR_NAME = \"MenubarItemIndicator\";\nvar MenubarItemIndicator = React.forwardRef((props, forwardedRef) => {\n  const { __scopeMenubar, ...itemIndicatorProps } = props;\n  const menuScope = useMenuScope(__scopeMenubar);\n  return /* @__PURE__ */ jsx(MenuPrimitive.ItemIndicator, { ...menuScope, ...itemIndicatorProps, ref: forwardedRef });\n});\nMenubarItemIndicator.displayName = INDICATOR_NAME;\nvar SEPARATOR_NAME = \"MenubarSeparator\";\nvar MenubarSeparator = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...separatorProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Separator, { ...menuScope, ...separatorProps, ref: forwardedRef });\n  }\n);\nMenubarSeparator.displayName = SEPARATOR_NAME;\nvar ARROW_NAME = \"MenubarArrow\";\nvar MenubarArrow = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...arrowProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(MenuPrimitive.Arrow, { ...menuScope, ...arrowProps, ref: forwardedRef });\n  }\n);\nMenubarArrow.displayName = ARROW_NAME;\nvar SUB_NAME = \"MenubarSub\";\nvar MenubarSub = (props) => {\n  const { __scopeMenubar, children, open: openProp, onOpenChange, defaultOpen } = props;\n  const menuScope = useMenuScope(__scopeMenubar);\n  const [open = false, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange\n  });\n  return /* @__PURE__ */ jsx(MenuPrimitive.Sub, { ...menuScope, open, onOpenChange: setOpen, children });\n};\nMenubarSub.displayName = SUB_NAME;\nvar SUB_TRIGGER_NAME = \"MenubarSubTrigger\";\nvar MenubarSubTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...subTriggerProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(\n      MenuPrimitive.SubTrigger,\n      {\n        \"data-radix-menubar-subtrigger\": \"\",\n        ...menuScope,\n        ...subTriggerProps,\n        ref: forwardedRef\n      }\n    );\n  }\n);\nMenubarSubTrigger.displayName = SUB_TRIGGER_NAME;\nvar SUB_CONTENT_NAME = \"MenubarSubContent\";\nvar MenubarSubContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeMenubar, ...subContentProps } = props;\n    const menuScope = useMenuScope(__scopeMenubar);\n    return /* @__PURE__ */ jsx(\n      MenuPrimitive.SubContent,\n      {\n        ...menuScope,\n        \"data-radix-menubar-content\": \"\",\n        ...subContentProps,\n        ref: forwardedRef,\n        style: {\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            \"--radix-menubar-content-transform-origin\": \"var(--radix-popper-transform-origin)\",\n            \"--radix-menubar-content-available-width\": \"var(--radix-popper-available-width)\",\n            \"--radix-menubar-content-available-height\": \"var(--radix-popper-available-height)\",\n            \"--radix-menubar-trigger-width\": \"var(--radix-popper-anchor-width)\",\n            \"--radix-menubar-trigger-height\": \"var(--radix-popper-anchor-height)\"\n          }\n        }\n      }\n    );\n  }\n);\nMenubarSubContent.displayName = SUB_CONTENT_NAME;\nfunction wrapArray(array, startIndex) {\n  return array.map((_, index) => array[(startIndex + index) % array.length]);\n}\nvar Root3 = Menubar;\nvar Menu = MenubarMenu;\nvar Trigger = MenubarTrigger;\nvar Portal2 = MenubarPortal;\nvar Content2 = MenubarContent;\nvar Group2 = MenubarGroup;\nvar Label2 = MenubarLabel;\nvar Item3 = MenubarItem;\nvar CheckboxItem2 = MenubarCheckboxItem;\nvar RadioGroup2 = MenubarRadioGroup;\nvar RadioItem2 = MenubarRadioItem;\nvar ItemIndicator2 = MenubarItemIndicator;\nvar Separator2 = MenubarSeparator;\nvar Arrow2 = MenubarArrow;\nvar Sub2 = MenubarSub;\nvar SubTrigger2 = MenubarSubTrigger;\nvar SubContent2 = MenubarSubContent;\nexport {\n  Arrow2 as Arrow,\n  CheckboxItem2 as CheckboxItem,\n  Content2 as Content,\n  Group2 as Group,\n  Item3 as Item,\n  ItemIndicator2 as ItemIndicator,\n  Label2 as Label,\n  Menu,\n  Menubar,\n  MenubarArrow,\n  MenubarCheckboxItem,\n  MenubarContent,\n  MenubarGroup,\n  MenubarItem,\n  MenubarItemIndicator,\n  MenubarLabel,\n  MenubarMenu,\n  MenubarPortal,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarSeparator,\n  MenubarSub,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarTrigger,\n  Portal2 as Portal,\n  RadioGroup2 as RadioGroup,\n  RadioItem2 as RadioItem,\n  Root3 as Root,\n  Separator2 as Separator,\n  Sub2 as Sub,\n  SubContent2 as SubContent,\n  SubTrigger2 as SubTrigger,\n  Trigger,\n  createMenubarScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from 'react'\nimport * as MenubarPrimitive from '@radix-ui/react-menubar'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { cn } from 'src/lib/utils'\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      'flex h-10 items-center space-x-1 rounded-md border bg-background p-1',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      'flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      'flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',\n      inset && 'pl-8',\n      className,\n    )}\n    {...props}\n  >\n    {children}\n    <LazyIcon name=\"chevron-right\" className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      'z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(({ className, align = 'start', alignOffset = -4, sideOffset = 8, ...props }, ref) => (\n  <MenubarPrimitive.Portal>\n    <MenubarPrimitive.Content\n      ref={ref}\n      align={align}\n      alignOffset={alignOffset}\n      sideOffset={sideOffset}\n      className={cn(\n        'z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',\n        className,\n      )}\n      {...props}\n    />\n  </MenubarPrimitive.Portal>\n))\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      inset && 'pl-8',\n      className,\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      className,\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <LazyIcon name=\"check\" className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      className,\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <LazyIcon name=\"circle\" className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn('px-2 py-1.5 text-sm font-semibold', inset && 'pl-8', className)}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn('-mx-1 my-1 h-px bg-muted', className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn('ml-auto text-xs tracking-widest text-muted-foreground', className)}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = 'MenubarShortcut'\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","import { create } from 'zustand'\nimport { devtools, subscribeWithSelector } from 'zustand/middleware'\nimport { FlowStateActions, getFlowStateActions } from './actions'\nimport { FlowState, defaultFlowState } from './state'\n\nexport const useFlowState = create<FlowState & FlowStateActions>()(\n  subscribeWithSelector(\n    devtools((set, get) => ({\n      ...defaultFlowState,\n      ...getFlowStateActions(set, get),\n    })),\n  ),\n)\n","import { useCallback, useState } from 'react'\nimport { Node } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  LLM,\n  LLMModelTypeEnum,\n  LLMProviderEnum,\n  LLMStatusEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateLLM = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n\n  const pushSyncNodeQueue = useFlowState((state) => state.pushSyncNodeQueue)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createLLM = useCallback(\n    async (source: Node, record: Partial<LLM>) => {\n      try {\n        if (!sessionId) {\n          throw new Error('Session not found')\n        }\n        if (!record.provider || !record.name) {\n          throw new Error('Provider and name are required')\n        }\n        setLoading(true)\n        const existed = await getRepository('LLM').findOne({\n          where: {\n            name: record.name,\n            session_id: sessionId,\n          },\n        })\n        if (existed) {\n          pushSyncNodeQueue('LLM', {\n            where: {\n              source_type: 'LLM',\n              source_id: existed.id,\n            },\n          })\n          return existed\n        }\n        return getRepository('LLM')\n          .save({\n            name: `${record.name}`,\n            // NOTE: No need to load cloud LLM\n            status: [LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(\n              record.provider as LLMProviderEnum,\n            )\n              ? LLMStatusEnum.Started\n              : LLMStatusEnum.Loaded,\n            session_id: sessionId,\n            provider: record.provider,\n            metadata: JSON.stringify(record.metadata || {}),\n            model_type: record.model_type || LLMModelTypeEnum.LLM,\n            parameters: record.parameters || undefined,\n            encrypted: record.encrypted || undefined,\n            ...record,\n          })\n          .then(async (llm) => {\n            await createOrUpdateFlowNode({\n              source_id: llm.id,\n              source_type: 'LLM',\n              node_type: FlowNodeTypeEnum.LLM,\n              x: source.position?.x,\n              y: source.position?.y + (source.measured?.height || 0) + 30,\n            })\n            return llm\n          })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [createOrUpdateFlowNode, pushSyncNodeQueue, sessionId],\n  )\n\n  return {\n    loading,\n    createLLM,\n  }\n}\n","var U=1,Y=.9,H=.8,J=.17,p=.1,u=.999,$=.9999;var k=.99,m=/[\\\\\\/_+.#\"@\\[\\(\\{&]/,B=/[\\\\\\/_+.#\"@\\[\\(\\{&]/g,K=/[\\s-]/,X=/[\\s-]/g;function G(_,C,h,P,A,f,O){if(f===C.length)return A===_.length?U:k;var T=`${A},${f}`;if(O[T]!==void 0)return O[T];for(var L=P.charAt(f),c=h.indexOf(L,A),S=0,E,N,R,M;c>=0;)E=G(_,C,h,P,c+1,f+1,O),E>S&&(c===A?E*=U:m.test(_.charAt(c-1))?(E*=H,R=_.slice(A,c-1).match(B),R&&A>0&&(E*=Math.pow(u,R.length))):K.test(_.charAt(c-1))?(E*=Y,M=_.slice(A,c-1).match(X),M&&A>0&&(E*=Math.pow(u,M.length))):(E*=J,A>0&&(E*=Math.pow(u,c-A))),_.charAt(c)!==C.charAt(f)&&(E*=$)),(E<p&&h.charAt(c-1)===P.charAt(f+1)||P.charAt(f+1)===P.charAt(f)&&h.charAt(c-1)!==P.charAt(f))&&(N=G(_,C,h,P,c+1,f+2,O),N*p>E&&(E=N*p)),E>S&&(S=E),c=h.indexOf(L,c+1);return O[T]=S,S}function D(_){return _.toLowerCase().replace(X,\" \")}function W(_,C,h){return _=h&&h.length>0?`${_+\" \"+h.join(\" \")}`:_,G(_,C,D(_),D(C),0,0,{})}export{W as a};\n","\"use client\";import{a as ce}from\"./chunk-NZJY6EH4.mjs\";import*as w from\"@radix-ui/react-dialog\";import*as n from\"react\";import{Primitive as D}from\"@radix-ui/react-primitive\";import{useId as L}from\"@radix-ui/react-id\";import{useSyncExternalStore as Re}from\"use-sync-external-store/shim/index.js\";var N='[cmdk-group=\"\"]',Q='[cmdk-group-items=\"\"]',be='[cmdk-group-heading=\"\"]',Z='[cmdk-item=\"\"]',le=`${Z}:not([aria-disabled=\"true\"])`,Y=\"cmdk-item-select\",I=\"data-value\",he=(r,o,t)=>ce(r,o,t),ue=n.createContext(void 0),K=()=>n.useContext(ue),de=n.createContext(void 0),ee=()=>n.useContext(de),fe=n.createContext(void 0);var me=n.forwardRef((r,o)=>{let t=k(()=>{var e,s;return{search:\"\",value:(s=(e=r.value)!=null?e:r.defaultValue)!=null?s:\"\",filtered:{count:0,items:new Map,groups:new Set}}}),u=k(()=>new Set),c=k(()=>new Map),d=k(()=>new Map),f=k(()=>new Set),p=pe(r),{label:v,children:b,value:l,onValueChange:y,filter:E,shouldFilter:C,loop:H,disablePointerSelection:ge=!1,vimBindings:$=!0,...O}=r,te=L(),B=L(),F=L(),x=n.useRef(null),R=Te();M(()=>{if(l!==void 0){let e=l.trim();t.current.value=e,h.emit()}},[l]),M(()=>{R(6,re)},[]);let h=n.useMemo(()=>({subscribe:e=>(f.current.add(e),()=>f.current.delete(e)),snapshot:()=>t.current,setState:(e,s,i)=>{var a,m,g;if(!Object.is(t.current[e],s)){if(t.current[e]=s,e===\"search\")W(),U(),R(1,z);else if(e===\"value\"&&(i||R(5,re),((a=p.current)==null?void 0:a.value)!==void 0)){let S=s!=null?s:\"\";(g=(m=p.current).onValueChange)==null||g.call(m,S);return}h.emit()}},emit:()=>{f.current.forEach(e=>e())}}),[]),q=n.useMemo(()=>({value:(e,s,i)=>{var a;s!==((a=d.current.get(e))==null?void 0:a.value)&&(d.current.set(e,{value:s,keywords:i}),t.current.filtered.items.set(e,ne(s,i)),R(2,()=>{U(),h.emit()}))},item:(e,s)=>(u.current.add(e),s&&(c.current.has(s)?c.current.get(s).add(e):c.current.set(s,new Set([e]))),R(3,()=>{W(),U(),t.current.value||z(),h.emit()}),()=>{d.current.delete(e),u.current.delete(e),t.current.filtered.items.delete(e);let i=A();R(4,()=>{W(),(i==null?void 0:i.getAttribute(\"id\"))===e&&z(),h.emit()})}),group:e=>(c.current.has(e)||c.current.set(e,new Set),()=>{d.current.delete(e),c.current.delete(e)}),filter:()=>p.current.shouldFilter,label:v||r[\"aria-label\"],getDisablePointerSelection:()=>p.current.disablePointerSelection,listId:te,inputId:F,labelId:B,listInnerRef:x}),[]);function ne(e,s){var a,m;let i=(m=(a=p.current)==null?void 0:a.filter)!=null?m:he;return e?i(e,t.current.search,s):0}function U(){if(!t.current.search||p.current.shouldFilter===!1)return;let e=t.current.filtered.items,s=[];t.current.filtered.groups.forEach(a=>{let m=c.current.get(a),g=0;m.forEach(S=>{let P=e.get(S);g=Math.max(P,g)}),s.push([a,g])});let i=x.current;_().sort((a,m)=>{var P,V;let g=a.getAttribute(\"id\"),S=m.getAttribute(\"id\");return((P=e.get(S))!=null?P:0)-((V=e.get(g))!=null?V:0)}).forEach(a=>{let m=a.closest(Q);m?m.appendChild(a.parentElement===m?a:a.closest(`${Q} > *`)):i.appendChild(a.parentElement===i?a:a.closest(`${Q} > *`))}),s.sort((a,m)=>m[1]-a[1]).forEach(a=>{var g;let m=(g=x.current)==null?void 0:g.querySelector(`${N}[${I}=\"${encodeURIComponent(a[0])}\"]`);m==null||m.parentElement.appendChild(m)})}function z(){let e=_().find(i=>i.getAttribute(\"aria-disabled\")!==\"true\"),s=e==null?void 0:e.getAttribute(I);h.setState(\"value\",s||void 0)}function W(){var s,i,a,m;if(!t.current.search||p.current.shouldFilter===!1){t.current.filtered.count=u.current.size;return}t.current.filtered.groups=new Set;let e=0;for(let g of u.current){let S=(i=(s=d.current.get(g))==null?void 0:s.value)!=null?i:\"\",P=(m=(a=d.current.get(g))==null?void 0:a.keywords)!=null?m:[],V=ne(S,P);t.current.filtered.items.set(g,V),V>0&&e++}for(let[g,S]of c.current)for(let P of S)if(t.current.filtered.items.get(P)>0){t.current.filtered.groups.add(g);break}t.current.filtered.count=e}function re(){var s,i,a;let e=A();e&&(((s=e.parentElement)==null?void 0:s.firstChild)===e&&((a=(i=e.closest(N))==null?void 0:i.querySelector(be))==null||a.scrollIntoView({block:\"nearest\"})),e.scrollIntoView({block:\"nearest\"}))}function A(){var e;return(e=x.current)==null?void 0:e.querySelector(`${Z}[aria-selected=\"true\"]`)}function _(){var e;return Array.from(((e=x.current)==null?void 0:e.querySelectorAll(le))||[])}function J(e){let i=_()[e];i&&h.setState(\"value\",i.getAttribute(I))}function X(e){var g;let s=A(),i=_(),a=i.findIndex(S=>S===s),m=i[a+e];(g=p.current)!=null&&g.loop&&(m=a+e<0?i[i.length-1]:a+e===i.length?i[0]:i[a+e]),m&&h.setState(\"value\",m.getAttribute(I))}function oe(e){let s=A(),i=s==null?void 0:s.closest(N),a;for(;i&&!a;)i=e>0?Ie(i,N):Me(i,N),a=i==null?void 0:i.querySelector(le);a?h.setState(\"value\",a.getAttribute(I)):X(e)}let ie=()=>J(_().length-1),ae=e=>{e.preventDefault(),e.metaKey?ie():e.altKey?oe(1):X(1)},se=e=>{e.preventDefault(),e.metaKey?J(0):e.altKey?oe(-1):X(-1)};return n.createElement(D.div,{ref:o,tabIndex:-1,...O,\"cmdk-root\":\"\",onKeyDown:e=>{var s;if((s=O.onKeyDown)==null||s.call(O,e),!e.defaultPrevented)switch(e.key){case\"n\":case\"j\":{$&&e.ctrlKey&&ae(e);break}case\"ArrowDown\":{ae(e);break}case\"p\":case\"k\":{$&&e.ctrlKey&&se(e);break}case\"ArrowUp\":{se(e);break}case\"Home\":{e.preventDefault(),J(0);break}case\"End\":{e.preventDefault(),ie();break}case\"Enter\":if(!e.nativeEvent.isComposing&&e.keyCode!==229){e.preventDefault();let i=A();if(i){let a=new Event(Y);i.dispatchEvent(a)}}}}},n.createElement(\"label\",{\"cmdk-label\":\"\",htmlFor:q.inputId,id:q.labelId,style:Le},v),j(r,e=>n.createElement(de.Provider,{value:h},n.createElement(ue.Provider,{value:q},e))))}),ye=n.forwardRef((r,o)=>{var F,x;let t=L(),u=n.useRef(null),c=n.useContext(fe),d=K(),f=pe(r),p=(x=(F=f.current)==null?void 0:F.forceMount)!=null?x:c==null?void 0:c.forceMount;M(()=>{if(!p)return d.item(t,c==null?void 0:c.id)},[p]);let v=ve(t,u,[r.value,r.children,u],r.keywords),b=ee(),l=T(R=>R.value&&R.value===v.current),y=T(R=>p||d.filter()===!1?!0:R.search?R.filtered.items.get(t)>0:!0);n.useEffect(()=>{let R=u.current;if(!(!R||r.disabled))return R.addEventListener(Y,E),()=>R.removeEventListener(Y,E)},[y,r.onSelect,r.disabled]);function E(){var R,h;C(),(h=(R=f.current).onSelect)==null||h.call(R,v.current)}function C(){b.setState(\"value\",v.current,!0)}if(!y)return null;let{disabled:H,value:ge,onSelect:$,forceMount:O,keywords:te,...B}=r;return n.createElement(D.div,{ref:G([u,o]),...B,id:t,\"cmdk-item\":\"\",role:\"option\",\"aria-disabled\":!!H,\"aria-selected\":!!l,\"data-disabled\":!!H,\"data-selected\":!!l,onPointerMove:H||d.getDisablePointerSelection()?void 0:C,onClick:H?void 0:E},r.children)}),Se=n.forwardRef((r,o)=>{let{heading:t,children:u,forceMount:c,...d}=r,f=L(),p=n.useRef(null),v=n.useRef(null),b=L(),l=K(),y=T(C=>c||l.filter()===!1?!0:C.search?C.filtered.groups.has(f):!0);M(()=>l.group(f),[]),ve(f,p,[r.value,r.heading,v]);let E=n.useMemo(()=>({id:f,forceMount:c}),[c]);return n.createElement(D.div,{ref:G([p,o]),...d,\"cmdk-group\":\"\",role:\"presentation\",hidden:y?void 0:!0},t&&n.createElement(\"div\",{ref:v,\"cmdk-group-heading\":\"\",\"aria-hidden\":!0,id:b},t),j(r,C=>n.createElement(\"div\",{\"cmdk-group-items\":\"\",role:\"group\",\"aria-labelledby\":t?b:void 0},n.createElement(fe.Provider,{value:E},C))))}),Ee=n.forwardRef((r,o)=>{let{alwaysRender:t,...u}=r,c=n.useRef(null),d=T(f=>!f.search);return!t&&!d?null:n.createElement(D.div,{ref:G([c,o]),...u,\"cmdk-separator\":\"\",role:\"separator\"})}),Ce=n.forwardRef((r,o)=>{let{onValueChange:t,...u}=r,c=r.value!=null,d=ee(),f=T(l=>l.search),p=T(l=>l.value),v=K(),b=n.useMemo(()=>{var y;let l=(y=v.listInnerRef.current)==null?void 0:y.querySelector(`${Z}[${I}=\"${encodeURIComponent(p)}\"]`);return l==null?void 0:l.getAttribute(\"id\")},[]);return n.useEffect(()=>{r.value!=null&&d.setState(\"search\",r.value)},[r.value]),n.createElement(D.input,{ref:o,...u,\"cmdk-input\":\"\",autoComplete:\"off\",autoCorrect:\"off\",spellCheck:!1,\"aria-autocomplete\":\"list\",role:\"combobox\",\"aria-expanded\":!0,\"aria-controls\":v.listId,\"aria-labelledby\":v.labelId,\"aria-activedescendant\":b,id:v.inputId,type:\"text\",value:c?r.value:f,onChange:l=>{c||d.setState(\"search\",l.target.value),t==null||t(l.target.value)}})}),xe=n.forwardRef((r,o)=>{let{children:t,label:u=\"Suggestions\",...c}=r,d=n.useRef(null),f=n.useRef(null),p=K();return n.useEffect(()=>{if(f.current&&d.current){let v=f.current,b=d.current,l,y=new ResizeObserver(()=>{l=requestAnimationFrame(()=>{let E=v.offsetHeight;b.style.setProperty(\"--cmdk-list-height\",E.toFixed(1)+\"px\")})});return y.observe(v),()=>{cancelAnimationFrame(l),y.unobserve(v)}}},[]),n.createElement(D.div,{ref:G([d,o]),...c,\"cmdk-list\":\"\",role:\"listbox\",\"aria-label\":u,id:p.listId},j(r,v=>n.createElement(\"div\",{ref:G([f,p.listInnerRef]),\"cmdk-list-sizer\":\"\"},v)))}),Pe=n.forwardRef((r,o)=>{let{open:t,onOpenChange:u,overlayClassName:c,contentClassName:d,container:f,...p}=r;return n.createElement(w.Root,{open:t,onOpenChange:u},n.createElement(w.Portal,{container:f},n.createElement(w.Overlay,{\"cmdk-overlay\":\"\",className:c}),n.createElement(w.Content,{\"aria-label\":r.label,\"cmdk-dialog\":\"\",className:d},n.createElement(me,{ref:o,...p}))))}),we=n.forwardRef((r,o)=>T(u=>u.filtered.count===0)?n.createElement(D.div,{ref:o,...r,\"cmdk-empty\":\"\",role:\"presentation\"}):null),De=n.forwardRef((r,o)=>{let{progress:t,children:u,label:c=\"Loading...\",...d}=r;return n.createElement(D.div,{ref:o,...d,\"cmdk-loading\":\"\",role:\"progressbar\",\"aria-valuenow\":t,\"aria-valuemin\":0,\"aria-valuemax\":100,\"aria-label\":c},j(r,f=>n.createElement(\"div\",{\"aria-hidden\":!0},f)))}),Ve=Object.assign(me,{List:xe,Item:ye,Input:Ce,Group:Se,Separator:Ee,Dialog:Pe,Empty:we,Loading:De});function Ie(r,o){let t=r.nextElementSibling;for(;t;){if(t.matches(o))return t;t=t.nextElementSibling}}function Me(r,o){let t=r.previousElementSibling;for(;t;){if(t.matches(o))return t;t=t.previousElementSibling}}function pe(r){let o=n.useRef(r);return M(()=>{o.current=r}),o}var M=typeof window==\"undefined\"?n.useEffect:n.useLayoutEffect;function k(r){let o=n.useRef();return o.current===void 0&&(o.current=r()),o}function G(r){return o=>{r.forEach(t=>{typeof t==\"function\"?t(o):t!=null&&(t.current=o)})}}function T(r){let o=ee(),t=()=>r(o.snapshot());return Re(o.subscribe,t,t)}function ve(r,o,t,u=[]){let c=n.useRef(),d=K();return M(()=>{var v;let f=(()=>{var b;for(let l of t){if(typeof l==\"string\")return l.trim();if(typeof l==\"object\"&&\"current\"in l)return l.current?(b=l.current.textContent)==null?void 0:b.trim():c.current}})(),p=u.map(b=>b.trim());d.value(r,f,p),(v=o.current)==null||v.setAttribute(I,f),c.current=f}),c}var Te=()=>{let[r,o]=n.useState(),t=k(()=>new Map);return M(()=>{t.current.forEach(u=>u()),t.current=new Map},[r]),(u,c)=>{t.current.set(u,c),o({})}};function ke(r){let o=r.type;return typeof o==\"function\"?o(r.props):\"render\"in o?o.render(r.props):r}function j({asChild:r,children:o},t){return r&&n.isValidElement(o)?n.cloneElement(ke(o),{ref:o.ref},t(o.props.children)):t(o)}var Le={position:\"absolute\",width:\"1px\",height:\"1px\",padding:\"0\",margin:\"-1px\",overflow:\"hidden\",clip:\"rect(0, 0, 0, 0)\",whiteSpace:\"nowrap\",borderWidth:\"0\"};export{Ve as Command,Pe as CommandDialog,we as CommandEmpty,Se as CommandGroup,Ce as CommandInput,ye as CommandItem,xe as CommandList,De as CommandLoading,me as CommandRoot,Ee as CommandSeparator,he as defaultFilter,T as useCommandState};\n","import * as React from 'react'\nimport { type DialogProps } from '@radix-ui/react-dialog'\nimport { Command as CommandPrimitive } from 'cmdk'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { cn } from 'src/lib/utils'\nimport { Dialog, DialogContent } from 'src/lib/shadcn/ui/dialog'\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      'flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground',\n      className,\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ntype CommandDialogProps = DialogProps\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <LazyIcon name=\"search\" className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        'flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn('max-h-[300px] overflow-y-auto overflow-x-hidden', className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      'overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground',\n      className,\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn('-mx-1 h-px bg-border', className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0',\n      className,\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn('ml-auto text-xs tracking-widest text-muted-foreground', className)}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = 'CommandShortcut'\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","import * as React from 'react'\nimport * as CheckboxPrimitive from '@radix-ui/react-checkbox'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { cn } from 'src/lib/utils'\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      'peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground',\n      className,\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator className={cn('flex items-center justify-center text-current')}>\n      <LazyIcon name=\"check\" className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","export const OPEN_AI_MODELS = ['gpt-4o', 'gpt-4o-mini', 'gpt-4-turbo', 'gpt-4', 'gpt-3.5-turbo']\nexport const GROQ_MODELS = [\n  'deepseek-r1-distill-llama-70b',\n  'llama-3.2-90b-vision-preview',\n  'llama-3.3-70b-versatile',\n  'llama-3.3-70b-specdec',\n  'llama3-70b-8192',\n  'gemma2-9b-it',\n  'llama3-8b-8192',\n  'mixtral-8x7b-32768',\n]\nexport const GROQ_VISION_MODELS = ['llama-3.2-90b-vision-preview']\nexport const GOOGLE_GENERATIVE_AI_MODELS = [\n  'gemini-2.0-flash-exp',\n  'gemini-1.5-flash',\n  'gemini-1.5-pro',\n  'gemini-1.5-flash-8b',\n]\nexport const GOOGLE_GENERATIVE_AI_API_KEY_LINK = 'https://aistudio.google.com/app/apikey'\nexport const OPEN_AI_API_KEY_LINK = 'https://platform.openai.com/api-keys'\nexport const GROQ_API_KEY_LINK = 'https://console.groq.com/keys'\n","import { LLMProviderEnum } from 'src/services/database/types'\n\nexport const SUPPORTED_PROVIDERS = [\n  LLMProviderEnum.WebLLM,\n  LLMProviderEnum.Wllama,\n  LLMProviderEnum.OpenAI,\n  LLMProviderEnum.GoogleGenerativeAI,\n  LLMProviderEnum.Groq,\n]\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from 'src/lib/shadcn/ui/dialog'\nimport {\n  InputOTP,\n  InputOTPGroup,\n  InputOTPSeparator,\n  InputOTPSlot,\n} from 'src/lib/shadcn/ui/input-otp'\n\ntype CreateSessionPassphraseDialogProps = {\n  className: string\n  onConfirm: (newValue: string) => Promise<unknown>\n  onCancel: () => void\n}\n\nconst CreateSessionPassphraseDialog = create<CreateSessionPassphraseDialogProps>(\n  ({ onConfirm, onCancel }) => {\n    const currentModal = useModal()\n    const { t } = useTranslation('dialogs')\n    const [name, setName] = useState('')\n\n    const handleChangeOTP = (newValue: string) => {\n      setName(newValue)\n    }\n\n    const handleSubmit = async () => {\n      try {\n        if (name?.length !== 6) {\n          return\n        }\n        await onConfirm?.(name)\n        setName('')\n        currentModal.resolve(true)\n        currentModal.hide()\n      } catch (e) {\n        currentModal.reject(e)\n      }\n    }\n\n    const handleHide = () => {\n      onCancel?.()\n      setName('')\n      currentModal.resolve(false)\n      currentModal.hide()\n    }\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={handleHide}>\n        <DialogContent className=\"w-[330px]\">\n          <DialogHeader>\n            <DialogTitle>{t('create_session_passkey.title')}</DialogTitle>\n            <DialogDescription>{t('create_session_passkey.description')}</DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <InputOTP onChange={handleChangeOTP} maxLength={6}>\n              <InputOTPGroup>\n                <InputOTPSlot index={0} hidden />\n                <InputOTPSlot index={1} hidden />\n                <InputOTPSlot index={2} hidden />\n              </InputOTPGroup>\n              <InputOTPSeparator />\n              <InputOTPGroup>\n                <InputOTPSlot index={3} hidden />\n                <InputOTPSlot index={4} hidden />\n                <InputOTPSlot index={5} hidden />\n              </InputOTPGroup>\n            </InputOTP>\n          </div>\n          <DialogFooter>\n            <Button disabled={name?.length !== 6} onClick={handleSubmit} type=\"submit\">\n              {t('create_session_passkey.confirm')}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default CreateSessionPassphraseDialog\n","import { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { encryptSymmetric, generatePassphrase } from 'src/utils/aes'\n\nexport const useUpdateSessionPassphrase = () => {\n  const [loading, setLoading] = useState(false)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const setCurrentSession = useSessionState((state) => state.setCurrentSession)\n\n  const updateSessionPassphrase = useCallback(\n    async (passkey: string) => {\n      if (!currentSession || !passkey) {\n        return\n      }\n      try {\n        setLoading(true)\n\n        const passphrase = await generatePassphrase()\n        const encrypted = await encryptSymmetric(passphrase, passkey)\n        await getRepository('Session').update(currentSession.id, {\n          passphrase: encrypted,\n        })\n        const session = await getRepository('Session').findOne({ where: { id: currentSession.id } })\n        if (session) {\n          setCurrentSession(session)\n        }\n        return {\n          passphrase,\n          encrypted,\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [currentSession, setCurrentSession],\n  )\n\n  return {\n    loading,\n    updateSessionPassphrase,\n  }\n}\n","import { useCallback } from 'react'\nimport { useSessionState } from 'src/states/session'\nimport secureSession from 'src/utils/secure-session'\nimport { useModalRef } from 'src/hooks/use-modal-ref'\nimport CreateSessionPassphraseDialog from 'src/components/dialogs/CreateSessionPassphraseDialog'\nimport { useUpdateSessionPassphrase } from 'src/hooks/mutations/use-update-session-passphrase'\nimport { useConfirmPassphrase } from './use-confirm-passphrase'\n\nexport const useConfirmOrCreatePassphrase = () => {\n  const currentSession = useSessionState((state) => state.currentSession)\n  const { modalRef: createSessionPassphraseDialogRef } = useModalRef(CreateSessionPassphraseDialog)\n  const { updateSessionPassphrase } = useUpdateSessionPassphrase()\n  const { confirmPassphrase } = useConfirmPassphrase()\n\n  const confirmOrCreatePassphrase = useCallback(async () => {\n    if (!currentSession?.passphrase) {\n      let passkey = ''\n      await createSessionPassphraseDialogRef.current.show({\n        onConfirm: async (input: string) => {\n          passkey = input\n        },\n      })\n      if (!passkey) {\n        throw new Error('Passphrase is required')\n      }\n      const keyInfo = await updateSessionPassphrase(passkey)\n      if (!keyInfo) {\n        throw new Error('Failed to update session passphrase')\n      }\n      await secureSession.set('passphrase', keyInfo.passphrase)\n    } else {\n      await confirmPassphrase()\n    }\n    return secureSession.get('passphrase')\n  }, [\n    confirmPassphrase,\n    createSessionPassphraseDialogRef,\n    currentSession?.passphrase,\n    updateSessionPassphrase,\n  ])\n\n  return {\n    confirmOrCreatePassphrase,\n  }\n}\n","import { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useCreateLLM } from 'src/hooks/flows/mutations/use-create-llm'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useTranslation } from 'react-i18next'\nimport { Popover, PopoverContent } from 'src/lib/shadcn/ui/popover'\nimport { PopoverTrigger } from '@radix-ui/react-popover'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from 'src/lib/shadcn/ui/command'\nimport { LLMModelTypeEnum, LLMProviderEnum } from 'src/services/database/types'\nimport { useLocalLLMState } from 'src/services/local-llm'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { RECOMMENDATION_LOCAL_LLMS, RECOMMENDATION_WALLAMA_LLMS } from 'src/constants/local-llm'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { Alert } from 'src/lib/shadcn/ui/alert'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { logError } from 'src/utils/logger'\nimport { useSessionState } from 'src/states/session'\nimport { encryptData } from 'src/utils/passphrase'\nimport { Checkbox } from 'src/lib/shadcn/ui/checkbox'\nimport {\n  GROQ_API_KEY_LINK,\n  GROQ_MODELS,\n  GROQ_VISION_MODELS,\n  OPEN_AI_API_KEY_LINK,\n  OPEN_AI_MODELS,\n  GOOGLE_GENERATIVE_AI_API_KEY_LINK,\n  GOOGLE_GENERATIVE_AI_MODELS,\n} from 'src/constants/llm'\n\nimport { SUPPORTED_PROVIDERS } from './constants'\nimport { useConfirmOrCreatePassphrase } from 'src/hooks/mutations/use-confirm-or-create-passphrase'\n\nfunction CreateLLMCard(props: NodeProps & { setDialog?: (value: boolean) => void }) {\n  const { id, setDialog } = props\n  const { t } = useTranslation('components')\n  const { toast } = useToast()\n  const node = useInternalNode(id)\n  const [loading, setLoading] = useState(false)\n  const [modelId, setModelId] = useState('')\n  const [open, setOpen] = useState(false)\n  const [search, setSearch] = useState('')\n  const [encryptedInfo, setEncryptedInfo] = useState<Record<string, string>>()\n  const [provider, setProvider] = useState<`${LLMProviderEnum}`>(LLMProviderEnum.WebLLM)\n  const [hasCache, setHasCache] = useState(false)\n  const [llmsInfo, setLLMsInfo] = useState<{\n    input?: string\n    modelList: ModelRecord[]\n    functionCallingModelIds: string[]\n  }>()\n  const llmInfoRef = useRef<{\n    input?: string\n    modelList: ModelRecord[]\n    functionCallingModelIds: string[]\n  }>()\n  const currentSession = useSessionState((state) => state.currentSession)\n  const syncCachedLLMURLs = useLocalLLMState((state) => state.syncCachedLLMURLs)\n  const cachedLLMURLs = useLocalLLMState((state) => state.cachedLLMURLs)\n  const { loading: creatingLLM, createLLM } = useCreateLLM()\n\n  llmInfoRef.current = llmsInfo\n\n  const { confirmOrCreatePassphrase } = useConfirmOrCreatePassphrase()\n\n  useEffect(() => {\n    syncCachedLLMURLs()\n  }, [syncCachedLLMURLs])\n\n  const isRequiredSessionPasskey = useMemo(() => {\n    if (!modelId) return false\n    return ![LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(provider as LLMProviderEnum)\n  }, [modelId, provider])\n\n  const modelList = useMemo(() => {\n    if (!llmsInfo?.functionCallingModelIds || !llmsInfo?.modelList) return []\n\n    const data = !search\n      ? llmsInfo?.modelList\n      : llmsInfo?.modelList.filter((model) =>\n          model.model_id.toLowerCase().includes(search.toLowerCase()),\n        )\n\n    return (data || []).sort((pre, next) => {\n      // Check if models are in cachedLLMURLs\n      const preInCache = cachedLLMURLs.some((item) => item.includes(pre.model_id))\n      const nextInCache = cachedLLMURLs.some((item) => item.includes(next.model_id))\n\n      // Prioritize models in cachedLLMURLs\n      if (preInCache && !nextInCache) {\n        return -1\n      }\n      if (!preInCache && nextInCache) {\n        return 1\n      }\n\n      const preInRecommended = RECOMMENDATION_LOCAL_LLMS.includes(pre.model_id)\n      const nextInRecommended = RECOMMENDATION_LOCAL_LLMS.includes(next.model_id)\n\n      // Prioritize models in RECOMMENDATION_LOCAL_LLMS\n      if (preInRecommended && !nextInRecommended) {\n        return -1\n      }\n      if (!preInRecommended && nextInRecommended) {\n        return 1\n      }\n\n      // Check if models are in functionCallingModelIds\n      const preInFunctionCalling = llmsInfo?.functionCallingModelIds.includes(pre.model_id)\n      const nextInFunctionCalling = llmsInfo?.functionCallingModelIds.includes(next.model_id)\n\n      // Prioritize models in functionCallingModelIds\n      if (preInFunctionCalling && !nextInFunctionCalling) {\n        return -1\n      }\n      if (!preInFunctionCalling && nextInFunctionCalling) {\n        return 1\n      }\n\n      // Compare buffer_size_required_bytes\n      if (\n        pre.vram_required_MB &&\n        next.vram_required_MB &&\n        pre.vram_required_MB !== next.vram_required_MB\n      ) {\n        return pre.vram_required_MB - next.vram_required_MB\n      }\n\n      return pre.model_id.localeCompare(next.model_id)\n    })\n  }, [llmsInfo?.modelList, llmsInfo?.functionCallingModelIds, search, cachedLLMURLs])\n\n  const selectedModel = useMemo<ModelRecord | undefined>(() => {\n    if (!modelId) return\n\n    switch (provider) {\n      case LLMProviderEnum.Wllama:\n        return llmsInfo?.modelList.find((model) => model.model_id === modelId)\n      case LLMProviderEnum.WebLLM:\n        return llmsInfo?.modelList && modelList.find((model) => model.model_id === modelId)\n      case LLMProviderEnum.Groq:\n        setEncryptedInfo({})\n        return {\n          model: modelId,\n          model_id: modelId,\n          model_type: GROQ_VISION_MODELS.includes(modelId) ? 2 : 0,\n          overrides: {},\n        } as ModelRecord\n      case LLMProviderEnum.OpenAI:\n        setEncryptedInfo({})\n        return {\n          model: modelId,\n          model_id: modelId,\n          model_type: 2,\n          overrides: {},\n        } as ModelRecord\n      case LLMProviderEnum.GoogleGenerativeAI:\n        setEncryptedInfo({})\n        return {\n          model: modelId,\n          model_id: modelId,\n          model_type: 2,\n          overrides: {},\n        } as ModelRecord\n    }\n  }, [modelId, llmsInfo?.modelList, modelList, provider])\n\n  useEffect(() => {\n    if (!selectedModel?.model_id || !cachedLLMURLs) return\n\n    setHasCache(cachedLLMURLs.some((item) => item.includes(selectedModel.model_id)))\n  }, [cachedLLMURLs, selectedModel?.model_id])\n  useEffect(() => {\n    if (!currentSession?.id) return\n\n    setProvider(LLMProviderEnum.WebLLM)\n    setModelId('')\n    setSearch('')\n    setEncryptedInfo({})\n  }, [currentSession?.id])\n\n  const handleOnchange = useCallback((currentValue: string) => {\n    setModelId(currentValue)\n    setOpen(false)\n  }, [])\n  const handleSearchChange = useCallback((value: string) => {\n    setSearch(value)\n  }, [])\n  const handleOnSelectProvider = useCallback((value: `${LLMProviderEnum}`) => {\n    setProvider(value)\n    setModelId('')\n    setSearch('')\n    setEncryptedInfo({})\n  }, [])\n  const hanldeSubmit = async () => {\n    if (!node || !currentSession) return\n    try {\n      setLoading(true)\n      let encrypted: Record<string, unknown> | undefined\n\n      if (isRequiredSessionPasskey) {\n        const passphrase = await confirmOrCreatePassphrase()\n        if (!passphrase) {\n          throw new Error('Passphrase is not found')\n        }\n        encrypted = await encryptData(encryptedInfo || {}, passphrase)\n      }\n      await createLLM(node, {\n        name: modelId,\n        model_type: modelTypeToLLMType(selectedModel?.model_type),\n        function_calling: selectedModel?.model_id\n          ? llmsInfo?.functionCallingModelIds?.includes(selectedModel?.model_id)\n          : false,\n        encrypted,\n        provider,\n      })\n      setDialog?.(false)\n    } catch (error) {\n      logError('Create LLM', error)\n      toast({\n        variant: 'destructive',\n        description: t('add_llm_card.errors.failed_to_create'),\n      })\n    } finally {\n      setLoading(false)\n      setProvider(LLMProviderEnum.WebLLM)\n      setEncryptedInfo({})\n      setModelId('')\n      setSearch('')\n    }\n  }\n\n  useLayoutEffect(() => {\n    const getModelInfo = async () => {\n      try {\n        if (provider === LLMProviderEnum.Wllama) {\n          const [username, repo] = modelId?.split('/') || []\n          const repoInfo = `${username}/${repo}`\n          if (!modelId || !username || !repo) {\n            setLLMsInfo({\n              modelList: [],\n              functionCallingModelIds: [],\n            })\n            return\n          } else if (llmInfoRef.current?.input === repoInfo) {\n            return\n          }\n          const res = await fetch(`https://huggingface.co/api/models/${repoInfo}`)\n          const data: { siblings?: { rfilename: string }[] } = await res.json()\n\n          if (data.siblings) {\n            setLLMsInfo({\n              input: repoInfo,\n              modelList: data.siblings\n                .map((s) => s.rfilename)\n                .filter((f) => f.endsWith('.gguf'))\n                .map((item) => {\n                  return {\n                    model_id: `${repoInfo}/${item}`,\n                    model: `${repoInfo}/${item}`,\n                    model_lib: `${repoInfo}/${item}`,\n                    model_type: 0,\n                    overrides: {},\n                  }\n                }),\n              functionCallingModelIds: [],\n            })\n          } else {\n            setLLMsInfo({\n              modelList: [],\n              functionCallingModelIds: [],\n            })\n          }\n        } else if (provider === LLMProviderEnum.WebLLM) {\n          import('@mlc-ai/web-llm').then(async ({ functionCallingModelIds, prebuiltAppConfig }) => {\n            const modelList = prebuiltAppConfig.model_list\n            setLLMsInfo({ modelList, functionCallingModelIds })\n          })\n        }\n      } catch {\n        // TODO: handle error\n      }\n    }\n    getModelInfo()\n  }, [provider, modelId])\n\n  const modelTypeToLLMType = useCallback((modelType?: unknown) => {\n    if (modelType === 1) {\n      return LLMModelTypeEnum.embedding\n    }\n    if (modelType === 2) {\n      return LLMModelTypeEnum.VLM\n    }\n    return LLMModelTypeEnum.LLM\n  }, [])\n\n  const modelItems = useMemo(() => {\n    switch (provider) {\n      case LLMProviderEnum.Wllama:\n      case LLMProviderEnum.WebLLM:\n        return modelList.map((model) => (\n          <CommandItem key={model.model_id} value={model.model_id} onSelect={handleOnchange}>\n            {modelId === model.model_id ? (\n              <LazyIcon name=\"check\" className={'mr-2 h-4 w-4'} />\n            ) : (\n              <div className=\"mr-2 h-4 w-4\" />\n            )}\n            <span className=\"max-w-md\">\n              <div className=\"flex gap-2 mb-2\">\n                <LLMIcon name={model.model_id} />\n                {model.model_id}\n              </div>\n              <div className=\"flex max-w-full flex-wrap gap-1\">\n                <LLMInfo\n                  model={model}\n                  isFunctionCalling={\n                    llmsInfo?.functionCallingModelIds?.includes(model.model_id) || false\n                  }\n                  name={model.model_id}\n                  isCached={cachedLLMURLs.some((item) => item.includes(model.model_id)) || false}\n                  cloud={provider !== LLMProviderEnum.WebLLM}\n                />\n              </div>\n            </span>\n          </CommandItem>\n        ))\n      case LLMProviderEnum.OpenAI:\n        return OPEN_AI_MODELS.map((model) => {\n          return (\n            <CommandItem key={model} value={model} onSelect={handleOnchange}>\n              {modelId === model ? (\n                <LazyIcon name=\"check\" className={'h-4 w-4'} />\n              ) : (\n                <div className=\"w-4\" />\n              )}\n              <span className=\"max-w-md\">\n                <div className=\"flex gap-3\">\n                  <LLMIcon name={model} />\n                  {model}\n                </div>\n              </span>\n            </CommandItem>\n          )\n        })\n      case LLMProviderEnum.GoogleGenerativeAI:\n        return GOOGLE_GENERATIVE_AI_MODELS.map((model) => {\n          return (\n            <CommandItem key={model} value={model} onSelect={handleOnchange}>\n              {modelId === model ? (\n                <LazyIcon name=\"check\" className={'h-4 w-4'} />\n              ) : (\n                <div className=\"w-4\" />\n              )}\n              <span className=\"max-w-md\">\n                <div className=\"flex gap-3\">\n                  <LLMIcon name={model} />\n                  {model}\n                </div>\n              </span>\n            </CommandItem>\n          )\n        })\n      case LLMProviderEnum.Groq:\n        return GROQ_MODELS.map((model) => {\n          return (\n            <CommandItem key={model} value={model} onSelect={handleOnchange}>\n              {modelId === model ? (\n                <LazyIcon name=\"check\" className={'h-4 w-4'} />\n              ) : (\n                <div className=\"w-4\" />\n              )}\n              <span className=\"max-w-md\">\n                <div className=\"flex gap-3\">\n                  <LLMIcon name={model} />\n                  {model}\n                </div>\n              </span>\n            </CommandItem>\n          )\n        })\n    }\n    return\n  }, [\n    cachedLLMURLs,\n    handleOnchange,\n    modelId,\n    llmsInfo?.functionCallingModelIds,\n    modelList,\n    provider,\n  ])\n\n  const modelSelection = useMemo(() => {\n    if (provider === LLMProviderEnum.Wllama) {\n      const [username, repo] = modelId?.split('/') || []\n      return (\n        <>\n          <Alert variant=\"default\" className=\"mb-4\">\n            {t('add_llm_card.wllama_description')}\n          </Alert>\n          <Label>{t('add_llm_card.hugging_face_recommendation')}</Label>\n          <Popover>\n            <PopoverTrigger asChild>\n              <Button\n                variant=\"outline\"\n                role=\"combobox\"\n                className=\"w-full justify-between max-w-full overflow-hidden\"\n              >\n                {username && repo\n                  ? `${username}/${repo}`\n                  : t('add_llm_card.select_model_placeholder')}\n                <LazyIcon name=\"chevrons-up-down\" className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-full p-0\">\n              <Command>\n                <CommandInput placeholder={t('add_llm_card.search_placeholder')} />\n                <CommandList>\n                  <CommandEmpty>{t('add_llm_card.no_model')}</CommandEmpty>\n                  <CommandGroup>\n                    {RECOMMENDATION_WALLAMA_LLMS.map((model) => (\n                      <CommandItem key={model} value={model} onSelect={handleOnchange}>\n                        {modelId === model ? (\n                          <LazyIcon name=\"check\" className={'h-4 w-4'} />\n                        ) : (\n                          <div className=\"w-4\" />\n                        )}\n                        <span className=\"max-w-md\">\n                          <div className=\"flex gap-3\">\n                            <LLMIcon name={model} />\n                            {model}\n                          </div>\n                        </span>\n                      </CommandItem>\n                    ))}\n                  </CommandGroup>\n                </CommandList>\n              </Command>\n            </PopoverContent>\n          </Popover>\n          <Label>{t('add_llm_card.hugging_face_repo')}</Label>\n          {username && repo ? (\n            <div className=\"relative\">\n              <Input\n                value={`${username}/${repo}`}\n                disabled\n                placeholder={t('add_llm_card.hugging_face_repo_placeholder')}\n              />\n              <LazyIcon\n                onClick={() => setModelId('')}\n                name=\"x\"\n                className=\"h-4 w-4 absolute right-3 top-3 cursor-pointer\"\n              />\n            </div>\n          ) : (\n            <Input\n              value={username ? `${username}/${repo}` : ''}\n              onChange={(e) => setModelId(e.target.value)}\n              placeholder={t('add_llm_card.hugging_face_repo_placeholder')}\n            />\n          )}\n          <Label>{t('add_llm_card.model_name')}</Label>\n          <Popover open={open} onOpenChange={setOpen}>\n            <PopoverTrigger asChild>\n              <Button\n                variant=\"outline\"\n                role=\"combobox\"\n                aria-expanded={open}\n                disabled={!username || !repo}\n                className=\"w-full justify-between max-w-full overflow-hidden\"\n              >\n                {modelId && selectedModel\n                  ? selectedModel?.model_id\n                  : t('add_llm_card.select_model_placeholder')}\n                <LazyIcon name=\"chevrons-up-down\" className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-full p-0\">\n              <Command>\n                <CommandInput\n                  onValueChange={handleSearchChange}\n                  placeholder={t('add_llm_card.search_placeholder')}\n                />\n                <CommandList>\n                  <CommandEmpty>{t('add_llm_card.no_model')}</CommandEmpty>\n                  <CommandGroup>{modelItems}</CommandGroup>\n                </CommandList>\n              </Command>\n            </PopoverContent>\n          </Popover>\n        </>\n      )\n    }\n    return (\n      <>\n        <Label>{t('add_llm_card.model_name')}</Label>\n        <Popover open={open} onOpenChange={setOpen}>\n          <PopoverTrigger asChild>\n            <Button\n              variant=\"outline\"\n              role=\"combobox\"\n              aria-expanded={open}\n              className=\"w-full justify-between\"\n            >\n              {modelId ? selectedModel?.model_id : t('add_llm_card.select_model_placeholder')}\n              <LazyIcon name=\"chevrons-up-down\" className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-full p-0\">\n            <Command>\n              <CommandInput\n                onValueChange={handleSearchChange}\n                placeholder={t('add_llm_card.search_placeholder')}\n              />\n              <CommandList>\n                <CommandEmpty>{t('add_llm_card.no_model')}</CommandEmpty>\n                <CommandGroup>{modelItems}</CommandGroup>\n              </CommandList>\n            </Command>\n          </PopoverContent>\n        </Popover>\n      </>\n    )\n  }, [provider, t, open, modelId, selectedModel, handleSearchChange, modelItems, handleOnchange])\n\n  const encryptedFields = useMemo(() => {\n    if (!isRequiredSessionPasskey) return undefined\n\n    switch (provider) {\n      case LLMProviderEnum.Groq:\n      case LLMProviderEnum.OpenAI:\n        return (\n          <>\n            <Alert variant=\"destructive\" className=\"mt-4\">\n              {t('add_llm_card.alert.session_passkey')}\n            </Alert>\n            <div className=\"mt-4\">\n              <Label>{t('add_llm_card.encrypted_fields.api_key')}</Label>\n              <Button variant=\"link\" className=\"px-1\">\n                <a\n                  href={\n                    provider === LLMProviderEnum.OpenAI ? OPEN_AI_API_KEY_LINK : GROQ_API_KEY_LINK\n                  }\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                >\n                  ({provider === LLMProviderEnum.OpenAI ? OPEN_AI_API_KEY_LINK : GROQ_API_KEY_LINK})\n                </a>\n              </Button>\n              <Input\n                type=\"password\"\n                value={encryptedInfo?.key || ''}\n                onChange={(e) =>\n                  setEncryptedInfo((pre) => ({\n                    ...pre,\n                    key: e.target.value,\n                  }))\n                }\n              />\n            </div>\n          </>\n        )\n      case LLMProviderEnum.GoogleGenerativeAI:\n        return (\n          <>\n            <Alert variant=\"destructive\" className=\"mt-4\">\n              {t('add_llm_card.alert.session_passkey')}\n            </Alert>\n            <div className=\"mt-4\">\n              <Label>{t('add_llm_card.encrypted_fields.api_key')}</Label>\n              <Button variant=\"link\" className=\"px-1\">\n                <a href={GOOGLE_GENERATIVE_AI_API_KEY_LINK} target=\"_blank\" rel=\"noreferrer\">\n                  ({GOOGLE_GENERATIVE_AI_API_KEY_LINK})\n                </a>\n              </Button>\n              <Input\n                type=\"password\"\n                value={encryptedInfo?.key || ''}\n                onChange={(e) =>\n                  setEncryptedInfo((pre) => ({\n                    ...pre,\n                    key: e.target.value,\n                  }))\n                }\n              />\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <Label>{t('add_llm_card.encrypted_fields.enabled_google_search_retreival')}</Label>\n              <Checkbox\n                checked={!!encryptedInfo?.enabled_google_search_retreival}\n                className=\"ml-2\"\n                onCheckedChange={(e) => {\n                  setEncryptedInfo((pre) => ({\n                    ...pre,\n                    enabled_google_search_retreival: !e ? '' : `true`,\n                  }))\n                }}\n              />\n            </div>\n          </>\n        )\n    }\n  }, [isRequiredSessionPasskey, provider, t, encryptedInfo])\n\n  return (\n    <Card className=\"max-w-lg\">\n      <CardHeader>\n        <CardTitle>{t('add_llm_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid w-full gap-1.5\">\n          <Label>{t('add_llm_card.provider')}</Label>\n          <Select value={provider} onValueChange={handleOnSelectProvider}>\n            <SelectTrigger className=\"w-full mb-4\">\n              <SelectValue placeholder={t('add_llm_card.provider_select_placeholder')} />\n            </SelectTrigger>\n            <SelectContent>\n              {Object.values(SUPPORTED_PROVIDERS).map((item) => {\n                return (\n                  <SelectItem key={item} value={item}>\n                    {t(`add_llm_card.providers.${item.toLowerCase()}`)}\n                  </SelectItem>\n                )\n              })}\n            </SelectContent>\n          </Select>\n          {modelSelection}\n        </div>\n        {selectedModel ? (\n          <div className=\"mt-4\">\n            <div className=\"mt-4 text-sm text-muted-foreground center flex max-w-full flex-wrap gap-1\">\n              <LLMIcon name={selectedModel.model_id} className=\"mr-2\" />\n              <LLMInfo\n                model={selectedModel}\n                isFunctionCalling={\n                  llmsInfo?.functionCallingModelIds?.includes(selectedModel.model_id) || false\n                }\n                name={selectedModel.model_id}\n                isCached={\n                  cachedLLMURLs.some((item) => item.includes(selectedModel.model_id)) || false\n                }\n                cloud={\n                  ![LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(\n                    provider as LLMProviderEnum,\n                  )\n                }\n              />\n            </div>\n            <div className=\"mt-2 text-sm text-muted-foreground\">\n              <span className=\"font-bold mr-2\">{t('add_llm_card.model_url')}</span>\n              {selectedModel.model}\n            </div>\n            {selectedModel.model_lib ? (\n              <div className=\"mt-2 text-sm text-muted-foreground center flex\">\n                <span className=\"font-bold mr-2\">{t('add_llm_card.model_lib_url')}</span>\n                {selectedModel.model_lib}\n              </div>\n            ) : undefined}\n            {selectedModel.overrides && Object.keys(selectedModel.overrides)?.length ? (\n              <div className=\"mt-2 text-sm text-muted-foreground center flex\">\n                <span className=\"font-bold mr-2\">{t('add_llm_card.metadata')}</span>\n                {JSON.stringify(selectedModel.overrides)}\n              </div>\n            ) : undefined}\n          </div>\n        ) : null}\n        {encryptedFields}\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={creatingLLM || loading}\n          disabled={!modelId?.length}\n          onClick={hanldeSubmit}\n          className=\"w-full\"\n        >\n          {hasCache ? t('add_llm_card.button_add') : t('add_llm_card.button_download_and_add')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n}\n\nexport default CreateLLMCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  PromptTypeEnum,\n  Thread,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreatePrompt = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const createPrompt = useCallback(\n    async (\n      source: Node,\n      options: {\n        content: string\n        prefix?: string\n        type?: `${PromptTypeEnum}`\n        role?: `${MessageRoleEnum}`\n        thread?: Thread\n      },\n    ) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const prompt = await getRepository('Prompt').save({\n          content: options.content,\n          prefix: options.prefix,\n          role: options.role || MessageRoleEnum.System,\n          status: MessageStatusEnum.Started,\n          session_id: sessionId,\n          type: options.type || PromptTypeEnum.Chat,\n        })\n        if (!prompt) {\n          throw new Error('Failed to save prompt')\n        }\n        const promptNode = await createOrUpdateFlowNode({\n          source_id: prompt.id,\n          source_type: 'Prompt',\n          node_type: FlowNodeTypeEnum.Prompt,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!promptNode) {\n          throw new Error('Failed to save prompt node')\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode],\n  )\n\n  return {\n    loading,\n    createPrompt,\n  }\n}\n","import { MessageRoleEnum, PromptTypeEnum } from 'src/services/database/types'\n\nexport const PROMPT_TYPES = {\n  [PromptTypeEnum.Chat]: {\n    label: 'add_prompt_card.prompt_types.chat',\n    value: PromptTypeEnum.Chat,\n  },\n  [PromptTypeEnum.FewShotExample]: {\n    label: 'add_prompt_card.prompt_types.few_shot_example',\n    value: PromptTypeEnum.FewShotExample,\n  },\n}\nexport const PROMPT_ROLES = {\n  [MessageRoleEnum.System]: {\n    label: 'add_prompt_card.prompt_roles.system',\n    value: MessageRoleEnum.System,\n  },\n  [MessageRoleEnum.Human]: {\n    label: 'add_prompt_card.prompt_roles.human',\n    value: MessageRoleEnum.Human,\n  },\n  [MessageRoleEnum.AI]: { label: 'add_prompt_card.prompt_roles.ai', value: MessageRoleEnum.AI },\n}\n","import { memo, useCallback, useState } from 'react'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { MessageRoleEnum, Prompt, PromptTypeEnum } from 'src/services/database/types'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { PROMPT_ROLES, PROMPT_TYPES } from './constants'\n\nconst PromptForm = memo(\n  ({\n    defaultPromptContent,\n    defaultPromptRole,\n    defaultPromptType,\n    hidePromptRole,\n    hidePromptType,\n    loading,\n    onSubmit,\n  }: {\n    onSubmit: (prompt: Partial<Prompt>) => Promise<unknown>\n    loading?: boolean\n    defaultPromptType?: `${PromptTypeEnum}`\n    defaultPromptRole?: `${MessageRoleEnum}`\n    defaultPromptContent?: string\n    hidePromptType?: boolean\n    hidePromptRole?: boolean\n  }) => {\n    const [input, setInput] = useState(defaultPromptContent || '')\n    const [promptType, setPromptType] = useState<`${PromptTypeEnum}`>(\n      defaultPromptType || PromptTypeEnum.Chat,\n    )\n    const [promptRole, setPromptRole] = useState<`${MessageRoleEnum}` | undefined>(\n      defaultPromptRole,\n    )\n    const [promptPrefix, setPromptPrefix] = useState('')\n\n    const { t } = useTranslation('components')\n\n    const handleOnchange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      setInput(e.target.value)\n    }, [])\n\n    const handleOnchangePrefix = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      setPromptPrefix(e.target.value)\n    }, [])\n\n    const handleOnSelectType = useCallback((value: `${PromptTypeEnum}`) => {\n      if (value === PromptTypeEnum.FewShotExample) {\n        setInput('Question: {input}\\nAnswer: {output}')\n      }\n      setPromptType(value)\n    }, [])\n\n    const handleOnSelectRole = useCallback((value: `${MessageRoleEnum}`) => {\n      setPromptRole(value)\n    }, [])\n\n    const handleSubmit = async () => {\n      const result = await onSubmit({\n        content: input,\n        role: promptRole,\n        prefix: promptPrefix,\n        type: promptType,\n      })\n      if (!result) {\n        return\n      }\n      setInput('')\n      setPromptRole(undefined)\n      setPromptType('chat')\n      setPromptPrefix('')\n    }\n\n    return (\n      <div>\n        <div className=\"grid w-full gap-1.5\">\n          {!hidePromptType ? (\n            <>\n              <Label>{t('add_prompt_card.prompt_type')}</Label>\n              <Select value={promptType} onValueChange={handleOnSelectType}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue placeholder={t('add_prompt_card.type_select_placeholder')} />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(PROMPT_TYPES).map((item) => {\n                    return (\n                      <SelectItem key={item.value} value={item.value}>\n                        {t(item.label)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          {!hidePromptRole ? (\n            <>\n              <Label>{t('add_prompt_card.prompt_role')}</Label>\n              <Select value={promptRole} onValueChange={handleOnSelectRole}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue placeholder={t('add_prompt_card.role_select_placeholder')} />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(PROMPT_ROLES).map((item) => {\n                    return (\n                      <SelectItem key={item.value} value={item.value}>\n                        {t(item.label)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          {promptType === PromptTypeEnum.FewShotExample && (\n            <>\n              <Label>{t('add_prompt_card.prompt_prefix')}</Label>\n              <Textarea\n                value={promptPrefix}\n                onChange={handleOnchangePrefix}\n                disabled={false}\n                className=\"h-20\"\n                placeholder={t('add_prompt_card.placeholder')}\n                id=\"message\"\n              />\n              <Label>{t('add_prompt_card.prompt_content')}</Label>\n              <div className=\"w-full border-0 text-gray-700 flex text-sm justify-end items-center\">\n                <LazyIcon name=\"info\" className=\"mr-2\" size={14} />\n                {t('add_prompt_card.few_shot_example_note')}\n              </div>\n            </>\n          )}\n          <Textarea\n            value={input}\n            onChange={handleOnchange}\n            disabled={false}\n            placeholder={t('add_prompt_card.placeholder')}\n            id=\"message\"\n          />\n        </div>\n        <div>\n          <LoadingButton\n            loading={loading}\n            disabled={!input?.length}\n            onClick={handleSubmit}\n            className=\"w-full mt-4\"\n          >\n            {t('add_prompt_card.button')}\n          </LoadingButton>\n        </div>\n      </div>\n    )\n  },\n)\n\nexport default PromptForm\n","import { memo } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Prompt, Thread } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { useCreatePrompt } from 'src/hooks/flows/mutations/use-create-prompt'\n\nimport PromptForm from './PromptForm'\n\nconst CreatePromptCard = memo(\n  (\n    props: Omit<NodeProps, 'data'> & {\n      data?: { ready?: boolean }\n      thread?: Thread\n      setDialog?: (value: boolean) => void\n    },\n  ) => {\n    const { id, thread, setDialog } = props\n\n    const { t } = useTranslation('components')\n    const { toast } = useToast()\n    const node = useInternalNode(id)\n    const { createPrompt, loading } = useCreatePrompt()\n\n    const handleSubmit = async (data: Partial<Prompt>) => {\n      if (node) {\n        try {\n          if (!data?.content) {\n            throw new Error('Prompt data is missing')\n          }\n          await createPrompt(node, {\n            ...data,\n            content: data.content,\n            thread,\n          })\n          setDialog?.(false)\n        } catch (error) {\n          toast({\n            variant: 'destructive',\n            title: `${error}`,\n          })\n        }\n      }\n    }\n\n    return (\n      <Card className=\"mw-full\">\n        <CardHeader>\n          <CardTitle>{t('add_prompt_card.title')}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <PromptForm\n            onSubmit={handleSubmit}\n            loading={loading}\n            defaultPromptRole=\"system\"\n            defaultPromptType=\"chat\"\n          />\n        </CardContent>\n      </Card>\n    )\n  },\n)\n\nexport default CreatePromptCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { SchemaItemType } from 'src/components/molecules/CreateSchemaCard/Field/type'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum, SchemaItem } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\nimport { EntityType } from 'src/utils/orm-type'\nimport { generateUUID } from 'src/utils/uuid'\n\nexport const useCreateSchema = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const toSchemaItem = useCallback(\n    (\n      schemaId: string,\n      input: SchemaItemType[],\n      result: EntityType<SchemaItem>[],\n      parent?: string,\n    ) => {\n      if (!sessionId) {\n        return\n      }\n      for (const item of input) {\n        if (item.data?.length) {\n          toSchemaItem(schemaId, item.data, result, item.id)\n        } else {\n          result.push({\n            name: item.name,\n            type: item.type,\n            enum: item.enum ? JSON.stringify(item.enum) : '',\n            required: item.required,\n            description: item.description,\n            id: item.id || generateUUID(),\n            parent_id: parent,\n            schema_id: schemaId,\n            session_id: sessionId,\n          })\n        }\n      }\n      return result\n    },\n    [sessionId],\n  )\n\n  const createSchema = useCallback(\n    async (source: Node, input: SchemaItemType[]) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const schema = await getRepository('Schema').save({\n          name: 'Untitled Schema',\n          session_id: sessionId,\n        })\n        if (!schema) {\n          throw new Error('Failed to save schema')\n        }\n\n        const schemaItems = toSchemaItem(schema.id, input, [], undefined)\n        if (!schemaItems?.length) {\n          throw new Error('Failed to convert schema items')\n        }\n        await getRepository('SchemaItem').save(schemaItems)\n        const promptNode = await createOrUpdateFlowNode({\n          source_id: schema.id,\n          source_type: 'Schema',\n          node_type: FlowNodeTypeEnum.Schema,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!promptNode) {\n          throw new Error('Failed to save schema node')\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, toSchemaItem, createOrUpdateFlowNode],\n  )\n\n  return {\n    loading,\n    createSchema,\n  }\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { useTranslation } from 'react-i18next'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Checkbox } from 'src/lib/shadcn/ui/checkbox'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport FieldList from './FieldList'\nimport { SchemaItemType } from './type'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport { generateUUID } from 'src/utils/uuid'\n\nconst NewOrUpdateField = memo(\n  ({\n    setData,\n    data,\n    id,\n  }: {\n    id?: string\n    setData: (func: (data: SchemaItemType[]) => SchemaItemType[]) => void\n    data: SchemaItemType[]\n  }) => {\n    const { t } = useTranslation('components')\n    const [empty, setEmpty] = useState<SchemaItemType>({\n      name: '',\n      description: '',\n      type: 'string',\n      required: false,\n      data: [],\n    })\n\n    const currentRow = useMemo(() => {\n      return id ? data.find((item) => item.id === id) || empty : empty\n    }, [data, empty, id])\n\n    const handleChangeName = useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (e.target.value && !/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e.target.value)) {\n          return\n        }\n        if (!id) {\n          setEmpty((item) => ({ ...item, name: e.target.value || '' }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      name: e.target.value || '',\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeDescription = useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, description: e.target.value || '' }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      description: e.target.value || '',\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeType = useCallback(\n      (e: string) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, type: (e || 'string') as SchemaItemType['type'] }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      type: (e || '') as SchemaItemType['type'],\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeRequired = useCallback(\n      (e: string | boolean) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, required: !!e || false }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      required: !!e || false,\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleChangeEnum = useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (!id) {\n          setEmpty((item) => ({ ...item, enum: e.target.value || '' }))\n        } else {\n          setData((previous) => {\n            return [\n              ...previous.map((item) =>\n                item.id === id\n                  ? {\n                      ...item,\n                      enum: e.target.value || '',\n                    }\n                  : item,\n              ),\n            ]\n          })\n        }\n      },\n      [id, setData],\n    )\n\n    const handleAddNew = useCallback(() => {\n      if (data.find((item) => item.name === empty.name)) {\n        return toast({\n          variant: 'destructive',\n          content: 'Name already exists',\n        })\n      }\n      empty.id = generateUUID()\n      setData((items) => {\n        return [...items, { ...empty }]\n      })\n      setEmpty({\n        name: '',\n        description: '',\n        type: 'string',\n        required: false,\n        id: generateUUID(),\n        parent: id || undefined,\n        data: [],\n      })\n    }, [data, empty, setData, id])\n\n    const handleSetChildData = useCallback(\n      (func: (previous: SchemaItemType[]) => SchemaItemType[]) => {\n        setData((previousData) => {\n          return [\n            ...previousData.map((item) =>\n              item.id === id\n                ? {\n                    ...item,\n                    data: func(item.data || []),\n                  }\n                : item,\n            ),\n          ]\n        })\n      },\n      [id, setData],\n    )\n\n    const shouldShowChildData = ['object', 'array'].includes(currentRow.type)\n\n    return (\n      <div className=\"w-full p-1\">\n        <div>\n          <Label>{t('add_schema_card.field.name')}</Label>\n          <Input\n            id=\"name\"\n            onChange={handleChangeName}\n            placeholder={t('add_schema_card.field.name_placeholder')}\n            value={currentRow?.name || ''}\n          />\n        </div>\n        <div>\n          <Label>{t('add_schema_card.field.description')}</Label>\n          <Input\n            id=\"description\"\n            placeholder={t('add_schema_card.field.description_placeholder')}\n            onChange={handleChangeDescription}\n            value={currentRow?.description || ''}\n          />\n        </div>\n        <div>\n          <Label>{t('add_schema_card.field.type')}</Label>\n          <Select onValueChange={handleChangeType} value={currentRow?.type || ''}>\n            <SelectTrigger>\n              <SelectValue placeholder={t('add_schema_card.field.type_placeholder')} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"string\">{t('add_schema_card.types.string')}</SelectItem>\n              <SelectItem value=\"boolean\">{t('add_schema_card.types.boolean')}</SelectItem>\n              <SelectItem value=\"number\">{t('add_schema_card.types.number')}</SelectItem>\n              <SelectItem value=\"object\">{t('add_schema_card.types.object')}</SelectItem>\n              <SelectItem value=\"array\">{t('add_schema_card.types.array')}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"flex items-center h-10\">\n          <Label>{t('add_schema_card.field.required')}</Label>\n          <Checkbox\n            className=\"ml-2\"\n            aria-label=\"Select row\"\n            onCheckedChange={handleChangeRequired}\n            checked={currentRow?.required}\n          />\n        </div>\n        {shouldShowChildData ? (\n          <div className=\"mt-2 flex flex-col gap-2\">\n            <Label>{t('add_schema_card.children')}</Label>\n            <FieldList data={currentRow?.data || []} setData={handleSetChildData} />\n          </div>\n        ) : null}\n        {currentRow?.type === 'enum' ? (\n          <div className=\"mt-2 flex flex-col gap-2\">\n            <Label>{t('add_schema_card.field.enum')}</Label>\n            <Input id=\"enum\" onChange={handleChangeEnum} placeholder=\"Enum\" />\n          </div>\n        ) : null}\n        {!id ? (\n          <div className=\"w-full flex justify-end mt-2\">\n            <Button\n              variant=\"secondary\"\n              disabled={!currentRow.name || !currentRow.description || !currentRow.type}\n              onClick={handleAddNew}\n              className=\"w-full\"\n            >\n              {t('add_schema_card.field.add_field')}\n            </Button>\n          </div>\n        ) : null}\n      </div>\n    )\n  },\n)\n\nexport default NewOrUpdateField\n","// import { z } from 'zod'\nimport { memo } from 'react'\nimport { SchemaItemType } from './type'\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from 'src/lib/shadcn/ui/accordion'\nimport { Card } from 'src/lib/shadcn/ui/card'\nimport NewOrUpdateField from './NewOrUpdateField'\n\nconst FieldList = memo(\n  ({\n    data,\n    setData,\n  }: {\n    data: SchemaItemType[]\n    setData: (func: (data: SchemaItemType[]) => SchemaItemType[]) => void\n  }) => {\n    return (\n      <Accordion type=\"single\" collapsible>\n        {data.map((row) => {\n          return (\n            <AccordionItem key={row.id || 'new'} value={`${row.id}`}>\n              <AccordionTrigger>{row.name}</AccordionTrigger>\n              <AccordionContent>\n                <NewOrUpdateField setData={setData} data={data} id={row.id} />\n              </AccordionContent>\n            </AccordionItem>\n          )\n        })}\n        <Card className=\"p-2 mt-4\">\n          <NewOrUpdateField setData={setData} data={data} />\n        </Card>\n      </Accordion>\n    )\n  },\n)\n\nexport default FieldList\n","import { memo, useState } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\nimport { useCreateSchema } from 'src/hooks/flows/mutations/use-create-schema'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { SchemaItemType } from './Field/type'\nimport FieldList from './Field/FieldList'\n\nconst CreateSchemaCard = memo((props: NodeProps) => {\n  const { t } = useTranslation('components')\n  const { id } = props\n  const node = useInternalNode(id)\n\n  const [data, setData] = useState<SchemaItemType[]>([])\n\n  const { createSchema, loading } = useCreateSchema()\n\n  const handleSubmit = async () => {\n    if (node && data?.length) {\n      try {\n        await createSchema(node, data)\n        setData([])\n      } catch (error) {\n        toast({\n          variant: 'destructive',\n          title: `${error}`,\n        })\n      }\n    }\n  }\n  return (\n    <Card className=\"max-w-lg\">\n      <CardHeader>\n        <CardTitle>{t('add_schema_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent className=\"min-w-96\">\n        <FieldList setData={setData} data={data} />\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={loading}\n          disabled={!data?.length}\n          onClick={handleSubmit}\n          className=\"w-full\"\n        >\n          {t('add_schema_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateSchemaCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\nimport { encodeCSVData } from 'src/utils/string-data'\n\nexport const useCreateCSVData = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const createCSVData = useCallback(\n    async (source: Node, headers: string[], data: string[][]) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const encodedData = encodeCSVData(headers, data)\n        const csvData = await getRepository('CSVData').save({\n          headers: encodedData.headers,\n          csv: encodedData.data,\n          session_id: sessionId,\n        })\n        if (!csvData) {\n          throw new Error('Failed to save')\n        }\n        const dataNode = await createOrUpdateFlowNode({\n          source_id: csvData.id,\n          source_type: 'CSVData',\n          node_type: FlowNodeTypeEnum.CSVData,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!dataNode) {\n          throw new Error('Failed to save node')\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode],\n  )\n\n  return {\n    loading,\n    createCSVData,\n  }\n}\n","import { useTranslation } from 'react-i18next'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from 'src/lib/shadcn/ui/table'\n\nexport function ExampleTable({ data }: { data: { input: string; output: string }[] }) {\n  const { t } = useTranslation('components')\n  return (\n    <Table className=\"w-full\">\n      <TableHeader>\n        <TableRow>\n          <TableHead>{t('add_few_shot_example_card.input')}</TableHead>\n          <TableHead>{t('add_few_shot_example_card.output')}</TableHead>\n        </TableRow>\n      </TableHeader>\n      <TableBody>\n        {data?.map((item, index) => (\n          <TableRow key={`${item.input}_${item.output}_${index}`}>\n            <TableCell className=\"p-4\">{item.input}</TableCell>\n            <TableCell className=\"p-4\">{item.output}</TableCell>\n          </TableRow>\n        ))}\n      </TableBody>\n    </Table>\n  )\n}\n","import { memo, useState } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { useCreateCSVData } from 'src/hooks/flows/mutations/use-create-csv-data'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { ExampleTable } from './ExampleTable'\n\nconst CreateFewShotExampleCard = memo((props: NodeProps) => {\n  const { id } = props\n  const { t } = useTranslation('components')\n  const [data, setData] = useState<{ input: string; output: string }[]>([])\n  const [input, setInput] = useState('')\n  const [output, setOutput] = useState('')\n  const node = useInternalNode(id)\n  const { createCSVData, loading } = useCreateCSVData()\n\n  const handleAdd = () => {\n    setData((prevData) => [...prevData, { input, output }])\n    setInput('')\n    setOutput('')\n  }\n  const handleCreateCSVData = async () => {\n    if (node) {\n      await createCSVData(\n        node,\n        ['input', 'output'],\n        data.map((item) => [item.input, item.output]),\n      )\n    }\n  }\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('add_few_shot_example_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col space-y-1.5\">\n          <Label htmlFor=\"name\">{t('add_few_shot_example_card.input')}</Label>\n          <Input\n            value={input}\n            onChange={(e) => setInput(e.target.value || '')}\n            id=\"name\"\n            placeholder={t('add_few_shot_example_card.input_placeholder')}\n          />\n        </div>\n        <div className=\"flex flex-col space-y-1.5 mt-3\">\n          <Label htmlFor=\"name\">{t('add_few_shot_example_card.output')}</Label>\n          <Textarea\n            value={output}\n            onChange={(e) => setOutput(e.target.value || '')}\n            placeholder={t('add_few_shot_example_card.output_placeholder')}\n          />\n        </div>\n        <div className=\"w-full flex mt-4 justify-end\">\n          <Button disabled={!input || !output} onClick={handleAdd} className=\"w-40\">\n            {t('add_few_shot_example_card.add')}\n          </Button>\n        </div>\n        <ExampleTable data={data || []} />\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={loading}\n          disabled={!data?.length}\n          onClick={handleCreateCSVData}\n          className=\"w-full\"\n        >\n          {t('add_few_shot_example_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateFewShotExampleCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum, ToolDefinition } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateTool = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createTool = useCallback(\n    async (\n      source: Node,\n      data: Partial<ToolDefinition>,\n      options?: {\n        schemaNode?: Node\n      },\n    ) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        if (!data.name || !data.description) {\n          throw new Error('Name is required')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const tool = await getRepository('ToolDefinition').save({\n          ...data,\n          name: `${data.name}`,\n          description: `${data.description}`,\n          session_id: sessionId,\n        })\n        if (!tool) {\n          throw new Error('Failed create tool.')\n        }\n        const toolNode = await createOrUpdateFlowNode({\n          source_id: tool.id,\n          source_type: 'ToolDefinition',\n          node_type: FlowNodeTypeEnum.ToolDefinition,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!toolNode) {\n          throw new Error('Failed to save node')\n        }\n        if (options?.schemaNode) {\n          await createOrUpdateFlowEdge({\n            source: options.schemaNode.id,\n            target: toolNode.id,\n          })\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    loading,\n    createTool,\n  }\n}\n","import { memo, useState } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { useCreateTool } from 'src/hooks/flows/mutations/use-create-tool'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { logWarn } from 'src/utils/logger'\nimport FieldList from '../CreateSchemaCard/Field/FieldList'\nimport { SchemaItemType } from '../CreateSchemaCard/Field/type'\n\nconst CreateToolCard = memo((props: NodeProps) => {\n  const { t } = useTranslation('components')\n  const { toast } = useToast()\n  const { id } = props\n  const node = useInternalNode(id)\n  const [name, setName] = useState('')\n  const [description, setDescription] = useState('')\n  const [data, setData] = useState<SchemaItemType[]>([])\n\n  const { createTool, loading } = useCreateTool()\n\n  const handleChangeName = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setName(e.target.value)\n  }\n\n  const handleChangeDescription = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setDescription(e.target.value)\n  }\n\n  const handleSubmit = async () => {\n    if (node && name && description) {\n      try {\n        await createTool(node, { name, description })\n        setName('')\n        setDescription('')\n      } catch (error) {\n        logWarn('Create Tool', error)\n        toast({\n          variant: 'destructive',\n          title: t('add_tool_card.errors.create_tool_failed'),\n        })\n      }\n    }\n  }\n\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('add_tool_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col space-y-1.5\">\n          <Label htmlFor=\"name\">{t('add_tool_card.tool_name')}</Label>\n          <Input\n            onChange={handleChangeName}\n            id=\"name\"\n            placeholder={t('add_tool_card.name_placeholder')}\n          />\n        </div>\n        <div className=\"flex flex-col space-y-1.5 mt-3\">\n          <Label htmlFor=\"name\">{t('add_tool_card.tool_description')}</Label>\n          <Textarea\n            onChange={handleChangeDescription}\n            placeholder={t('add_tool_card.description_placeholder')}\n          />\n        </div>\n        <div>\n          <FieldList data={data} setData={setData} />\n        </div>\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton loading={loading} onClick={handleSubmit} className=\"w-full\">\n          {t('add_tool_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateToolCard\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  VectorDatabase,\n  VectorDatabaseProviderEnum,\n  VectorDatabaseStorageEnum,\n  VectorDatabaseTypeEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\nimport { encodeSplitter } from 'src/utils/string-data'\n\nexport const useCreateVectorDatabase = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createVectorDatabase = useCallback(\n    async (\n      source: Node,\n      data: Partial<VectorDatabase>,\n      textSplitter?: {\n        type: string\n        chunkSize: number\n        chunkOverlap: number\n      },\n    ) => {\n      try {\n        if (!data?.name || !source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const vectorDatabase = await getRepository('VectorDatabase').save({\n          ...data,\n          name: `${data.name}`,\n          type: data.type || VectorDatabaseTypeEnum.Local,\n          storage: data.storage || VectorDatabaseStorageEnum.DatabaseNode,\n          raw: '',\n          provider: data.provider || VectorDatabaseProviderEnum.Memory,\n          session_id: sessionId,\n          metadata: textSplitter ? JSON.stringify({ textSplitter }) : undefined,\n        })\n\n        if (!vectorDatabase) {\n          throw new Error('Failed to save vectorDatabase')\n        }\n\n        const vectorDatabaseNode = await createOrUpdateFlowNode({\n          source_id: vectorDatabase.id,\n          source_type: 'VectorDatabase',\n          node_type: FlowNodeTypeEnum.VectorDatabase,\n          x: initialX,\n          y: initialY + 30,\n        })\n        if (!vectorDatabaseNode) {\n          throw new Error('Failed to save vectorDatabase node')\n        }\n\n        if (data.storage === VectorDatabaseStorageEnum.DataNode) {\n          // Default JSONLData source\n          const databaseSource = await getRepository('JSONLData').save({\n            headers: encodeSplitter(['content', 'embedding', 'metadata']),\n            jsonl: '',\n            session_id: sessionId,\n          })\n          if (!databaseSource) {\n            throw new Error('Failed to save databaseSource')\n          }\n          const databaseSourceNode = await createOrUpdateFlowNode({\n            source_id: databaseSource.id,\n            source_type: 'JSONLData',\n            node_type: FlowNodeTypeEnum.JSONLData,\n            x: initialX + 80,\n            y: initialY + 30,\n          })\n          if (!databaseSourceNode) {\n            throw new Error('Failed to save databaseSource node')\n          }\n\n          await createOrUpdateFlowEdge({\n            source: databaseSourceNode.id,\n            target: vectorDatabaseNode.id,\n          })\n        }\n\n        return {\n          vectorDatabase,\n          vectorDatabaseNode,\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    loading,\n    createVectorDatabase,\n  }\n}\n","import { VectorDatabaseProviderEnum, VectorDatabaseStorageEnum } from 'src/services/database/types'\n\nexport const SUPPORTED_VECTOR_DATABASE_PROVIDERS = [VectorDatabaseProviderEnum.Memory]\n\nexport const SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE = [VectorDatabaseStorageEnum.DatabaseNode]\n\nexport const SUPPORTED_TEXT_SPLITTERS = [\n  'TokenTextSplitter',\n  'CharacterTextSplitter',\n  'RecursiveCharacterTextSplitter',\n]\n","import { memo, useCallback, useState } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { VectorDatabaseProviderEnum, VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { useCreateVectorDatabase } from 'src/hooks/flows/mutations/use-create-vector-database'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport {\n  SUPPORTED_TEXT_SPLITTERS,\n  SUPPORTED_VECTOR_DATABASE_PROVIDERS,\n  SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE,\n} from './constants'\n\nconst CreateVectorDatabaseCard = memo((props: NodeProps) => {\n  const { t } = useTranslation('components')\n  const { id } = props\n  const node = useInternalNode(id)\n  const { toast } = useToast()\n  const [name, setName] = useState('')\n  const [provider, setProvider] = useState<`${VectorDatabaseProviderEnum}`>(\n    SUPPORTED_VECTOR_DATABASE_PROVIDERS[0],\n  )\n  const [storageType, setStorageType] = useState<`${VectorDatabaseStorageEnum}`>(\n    SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE[0],\n  )\n  const [textSplitter, setTextSplitter] = useState<{\n    type?: string\n    chunkSize?: number\n    chunkOverlap?: number\n  }>({})\n  const { loading, createVectorDatabase } = useCreateVectorDatabase()\n\n  const handleOnSelectProvider = useCallback((value: `${VectorDatabaseProviderEnum}`) => {\n    setProvider(value)\n  }, [])\n\n  const handleOnSelectStorageType = useCallback((value: `${VectorDatabaseStorageEnum}`) => {\n    setStorageType(value)\n  }, [])\n\n  const handleOnSelectTextSplitter = useCallback((value: string) => {\n    setTextSplitter((prev) => ({ ...prev, type: value, chunkSize: 500, chunkOverlap: 40 }))\n  }, [])\n\n  const handleOnChangeName = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setName(e.target.value || '')\n  }, [])\n\n  const handleOnChangeChunkSize = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setTextSplitter((prev) => ({ ...prev, chunkSize: Number(e.target.value) }))\n  }, [])\n\n  const handleOnChangeChunkOverlap = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setTextSplitter((prev) => ({ ...prev, chunkOverlap: Number(e.target.value) }))\n  }, [])\n\n  const handleSubmit = async () => {\n    try {\n      if (!node) {\n        return\n      }\n      await createVectorDatabase(\n        node,\n        {\n          name,\n          provider,\n          storage: storageType,\n        },\n        textSplitter?.type\n          ? {\n              type: textSplitter.type,\n              chunkSize: textSplitter.chunkSize || 500,\n              chunkOverlap: textSplitter.chunkOverlap || 0,\n            }\n          : undefined,\n      )\n      setName('')\n      setTextSplitter({})\n    } catch {\n      toast({\n        variant: 'destructive',\n        description: t('create_vector_database_card.errors.create_failed'),\n      })\n    }\n  }\n\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('create_vector_database_card.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid w-full gap-1.5\">\n          <Label>{t('create_vector_database_card.name')}</Label>\n          <Input className=\"mb-4\" value={name} onChange={handleOnChangeName} />\n          {SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE?.length > 1 ? (\n            <>\n              <Label>{t('create_vector_database_card.storage_type')}</Label>\n              <Select value={storageType} onValueChange={handleOnSelectStorageType}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue\n                    placeholder={t('create_vector_database_card.provider_select_placeholder')}\n                  />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(SUPPORTED_VECTOR_DATABASE_SOURCE_TYPE).map((item) => {\n                    return (\n                      <SelectItem key={item} value={item}>\n                        {t(`create_vector_database_card.storage_types.${item.toLowerCase()}`)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          {SUPPORTED_VECTOR_DATABASE_PROVIDERS?.length > 1 ? (\n            <>\n              <Label>{t('create_vector_database_card.provider')}</Label>\n              <Select value={provider} onValueChange={handleOnSelectProvider}>\n                <SelectTrigger className=\"w-full mb-4\">\n                  <SelectValue\n                    placeholder={t('create_vector_database_card.provider_select_placeholder')}\n                  />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.values(SUPPORTED_VECTOR_DATABASE_PROVIDERS).map((item) => {\n                    return (\n                      <SelectItem key={item} value={item}>\n                        {t(`create_vector_database_card.providers.${item.toLowerCase()}`)}\n                      </SelectItem>\n                    )\n                  })}\n                </SelectContent>\n              </Select>\n            </>\n          ) : undefined}\n          <Label>{t('create_vector_database_card.text_splitter')}</Label>\n          <Select value={textSplitter.type} onValueChange={handleOnSelectTextSplitter}>\n            <SelectTrigger className=\"w-full mb-4\">\n              <SelectValue\n                placeholder={t('create_vector_database_card.text_splitter_select_placeholder')}\n              />\n            </SelectTrigger>\n            <SelectContent>\n              {Object.values(SUPPORTED_TEXT_SPLITTERS).map((item) => {\n                return (\n                  <SelectItem key={item} value={item}>\n                    {t(`create_vector_database_card.text_splitters.${item.toLowerCase()}`)}\n                  </SelectItem>\n                )\n              })}\n            </SelectContent>\n          </Select>\n          {textSplitter.type ? (\n            <Card>\n              <CardHeader>\n                <CardTitle>\n                  {t('create_vector_database_card.text_splitter_configuration')}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Label>{t('create_vector_database_card.text_splitter_chunksize')}</Label>\n                <Input\n                  value={textSplitter.chunkSize}\n                  onChange={handleOnChangeChunkSize}\n                  placeholder={t('create_vector_database_card.text_splitter_chunksize_placeholder')}\n                />\n                <Label>{t('create_vector_database_card.text_splitter_chunkoverlap')}</Label>\n                <Input\n                  value={textSplitter.chunkOverlap}\n                  onChange={handleOnChangeChunkOverlap}\n                  placeholder={t(\n                    'create_vector_database_card.text_splitter_chunkoverlap_placeholder',\n                  )}\n                />\n              </CardContent>\n            </Card>\n          ) : undefined}\n        </div>\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          disabled={!textSplitter.type || !name}\n          loading={loading}\n          onClick={handleSubmit}\n          className=\"w-full\"\n        >\n          {t('create_vector_database_card.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateVectorDatabaseCard\n","import { useTranslation } from 'react-i18next'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from 'src/lib/shadcn/ui/table'\n\nexport function DataTable({ data }: { data: { text: string }[] }) {\n  const { t } = useTranslation('components')\n  return (\n    <Table className=\"w-full\">\n      <TableHeader>\n        <TableRow>\n          <TableHead>{t('add_text_data.text')}</TableHead>\n        </TableRow>\n      </TableHeader>\n      <TableBody>\n        {data?.map((item, index) => (\n          <TableRow key={`${item.text}_${index}`}>\n            <TableCell className=\"p-4\">{item.text}</TableCell>\n          </TableRow>\n        ))}\n      </TableBody>\n    </Table>\n  )\n}\n","import { memo, useState } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Textarea } from 'src/lib/shadcn/ui/textarea'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { useCreateCSVData } from 'src/hooks/flows/mutations/use-create-csv-data'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { DataTable } from './DataTable'\n\nconst CreateTextDataCard = memo((props: NodeProps) => {\n  const { id } = props\n  const { t } = useTranslation('components')\n  const [data, setData] = useState<{ text: string }[]>([])\n  const [text, setText] = useState('')\n  const node = useInternalNode(id)\n  const { createCSVData, loading } = useCreateCSVData()\n\n  const handleAdd = () => {\n    setData((prevData) => [...prevData, { text }])\n    setText('')\n  }\n  const handleCreateCSVData = async () => {\n    if (node) {\n      await createCSVData(\n        node,\n        ['text'],\n        data.map((item) => [item.text]),\n      )\n    }\n  }\n  return (\n    <Card className=\"mw-full\">\n      <CardHeader>\n        <CardTitle>{t('add_text_data.title')}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col space-y-1.5 mt-3\">\n          <Label htmlFor=\"name\">{t('add_text_data.text')}</Label>\n          <Textarea\n            value={text}\n            onChange={(e) => setText(e.target.value || '')}\n            placeholder={t('add_text_data.text_placeholder')}\n          />\n        </div>\n        <div className=\"w-full flex mt-4 justify-end\">\n          <Button disabled={!text} onClick={handleAdd} className=\"w-40\">\n            {t('add_text_data.add')}\n          </Button>\n        </div>\n        <DataTable data={data || []} />\n      </CardContent>\n      <CardFooter className=\"flex justify-between\">\n        <LoadingButton\n          loading={loading}\n          disabled={!data?.length}\n          onClick={handleCreateCSVData}\n          className=\"w-full\"\n        >\n          {t('add_text_data.create')}\n        </LoadingButton>\n      </CardFooter>\n    </Card>\n  )\n})\n\nexport default CreateTextDataCard\n","export enum SupportedAddNodeEnum {\n  ADD_LLM = 'ADD_LLM',\n  ADD_PROMPT = 'ADD_PROMPT',\n  ADD_TOOL_DEFINITION = 'ADD_TOOL_DEFINITION',\n  ADD_SCHEMA = 'ADD_SCHEMA',\n  ADD_FEW_SHOT_EXAMPLE = 'ADD_FEW_SHOT_EXAMPLE',\n  ADD_VECTOR_DATABASE = 'ADD_VECTOR_DATABASE',\n  ADD_TEXT_DATA = 'ADD_TEXT_DATA',\n  ADD_MCP = 'ADD_MCP',\n}\nexport const SUPPORTED_MODES = [\n  SupportedAddNodeEnum.ADD_LLM,\n  SupportedAddNodeEnum.ADD_PROMPT,\n  SupportedAddNodeEnum.ADD_SCHEMA,\n  SupportedAddNodeEnum.ADD_VECTOR_DATABASE,\n  SupportedAddNodeEnum.ADD_MCP,\n  {\n    key: 'more',\n    label: 'more',\n    icon: 'ellipsis' as const,\n    children: [SupportedAddNodeEnum.ADD_TOOL_DEFINITION, SupportedAddNodeEnum.ADD_FEW_SHOT_EXAMPLE],\n  },\n]\n","import React, { ReactNode, useEffect, useRef } from 'react'\n\nexport interface BaseParticle {\n  element: HTMLElement | SVGSVGElement\n  left: number\n  size: number\n  top: number\n}\n\nexport interface BaseParticleOptions {\n  particle?: string\n  size?: number\n}\n\nexport interface CoolParticle extends BaseParticle {\n  direction: number\n  speedHorz: number\n  speedUp: number\n  spinSpeed: number\n  spinVal: number\n}\n\nexport interface CoolParticleOptions extends BaseParticleOptions {\n  particleCount?: number\n  speedHorz?: number\n  speedUp?: number\n}\n\nconst getContainer = () => {\n  const id = '_coolMode_effect'\n  const existingContainer = document.getElementById(id)\n\n  if (existingContainer) {\n    return existingContainer\n  }\n\n  const container = document.createElement('div')\n  container.setAttribute('id', id)\n  container.setAttribute(\n    'style',\n    'overflow:hidden; position:fixed; height:100%; top:0; left:0; right:0; bottom:0; pointer-events:none; z-index:2147483647',\n  )\n\n  document.body.appendChild(container)\n\n  return container\n}\n\nlet instanceCounter = 0\n\nconst applyParticleEffect = (element: HTMLElement, options?: CoolParticleOptions): (() => void) => {\n  instanceCounter++\n\n  const defaultParticle = 'circle'\n  const particleType = options?.particle || defaultParticle\n  const sizes = [15, 20, 25, 35, 45]\n  const limit = 45\n\n  let particles: CoolParticle[] = []\n  let autoAddParticle = false\n  let mouseX = 0\n  let mouseY = 0\n\n  const container = getContainer()\n\n  function generateParticle() {\n    const size = options?.size || sizes[Math.floor(Math.random() * sizes.length)]\n    const speedHorz = options?.speedHorz || Math.random() * 10\n    const speedUp = options?.speedUp || Math.random() * 25\n    const spinVal = Math.random() * 360\n    const spinSpeed = Math.random() * 35 * (Math.random() <= 0.5 ? -1 : 1)\n    const top = mouseY - size / 2\n    const left = mouseX - size / 2\n    const direction = Math.random() <= 0.5 ? -1 : 1\n\n    const particle = document.createElement('div')\n\n    if (particleType === 'circle') {\n      const svgNS = 'http://www.w3.org/2000/svg'\n      const circleSVG = document.createElementNS(svgNS, 'svg')\n      const circle = document.createElementNS(svgNS, 'circle')\n      circle.setAttributeNS(null, 'cx', (size / 2).toString())\n      circle.setAttributeNS(null, 'cy', (size / 2).toString())\n      circle.setAttributeNS(null, 'r', (size / 2).toString())\n      circle.setAttributeNS(null, 'fill', `hsl(${Math.random() * 360}, 70%, 50%)`)\n\n      circleSVG.appendChild(circle)\n      circleSVG.setAttribute('width', size.toString())\n      circleSVG.setAttribute('height', size.toString())\n\n      particle.appendChild(circleSVG)\n    } else {\n      particle.innerHTML = `<img src=\"${particleType}\" width=\"${size}\" height=\"${size}\" style=\"border-radius: 50%\">`\n    }\n\n    particle.style.position = 'absolute'\n    particle.style.transform = `translate3d(${left}px, ${top}px, 0px) rotate(${spinVal}deg)`\n\n    container.appendChild(particle)\n\n    particles.push({\n      direction,\n      element: particle,\n      left,\n      size,\n      speedHorz,\n      speedUp,\n      spinSpeed,\n      spinVal,\n      top,\n    })\n  }\n\n  function refreshParticles() {\n    particles.forEach((p) => {\n      p.left = p.left - p.speedHorz * p.direction\n      p.top = p.top - p.speedUp\n      p.speedUp = Math.min(p.size, p.speedUp - 1)\n      p.spinVal = p.spinVal + p.spinSpeed\n\n      if (p.top >= Math.max(window.innerHeight, document.body.clientHeight) + p.size) {\n        particles = particles.filter((o) => o !== p)\n        p.element.remove()\n      }\n\n      p.element.setAttribute(\n        'style',\n        [\n          'position:absolute',\n          'will-change:transform',\n          `top:${p.top}px`,\n          `left:${p.left}px`,\n          `transform:rotate(${p.spinVal}deg)`,\n        ].join(';'),\n      )\n    })\n  }\n\n  let animationFrame: number | undefined\n\n  let lastParticleTimestamp = 0\n  const particleGenerationDelay = 30\n\n  function loop() {\n    const currentTime = performance.now()\n    if (\n      autoAddParticle &&\n      particles.length < limit &&\n      currentTime - lastParticleTimestamp > particleGenerationDelay\n    ) {\n      generateParticle()\n      lastParticleTimestamp = currentTime\n    }\n\n    refreshParticles()\n    animationFrame = requestAnimationFrame(loop)\n  }\n\n  loop()\n\n  const isTouchInteraction = 'ontouchstart' in window\n\n  const tap = isTouchInteraction ? 'touchstart' : 'mousedown'\n  const tapEnd = isTouchInteraction ? 'touchend' : 'mouseup'\n  const move = isTouchInteraction ? 'touchmove' : 'mousemove'\n\n  const updateMousePosition = (e: MouseEvent | TouchEvent) => {\n    if ('touches' in e) {\n      mouseX = e.touches?.[0].clientX\n      mouseY = e.touches?.[0].clientY\n    } else {\n      mouseX = e.clientX\n      mouseY = e.clientY\n    }\n  }\n\n  const tapHandler = (e: MouseEvent | TouchEvent) => {\n    updateMousePosition(e)\n    autoAddParticle = true\n  }\n\n  const disableAutoAddParticle = () => {\n    autoAddParticle = false\n  }\n\n  element.addEventListener(move, updateMousePosition, { passive: true })\n  element.addEventListener(tap, tapHandler, { passive: true })\n  element.addEventListener(tapEnd, disableAutoAddParticle, { passive: true })\n  element.addEventListener('mouseleave', disableAutoAddParticle, {\n    passive: true,\n  })\n\n  return () => {\n    element.removeEventListener(move, updateMousePosition)\n    element.removeEventListener(tap, tapHandler)\n    element.removeEventListener(tapEnd, disableAutoAddParticle)\n    element.removeEventListener('mouseleave', disableAutoAddParticle)\n\n    const interval = setInterval(() => {\n      if (animationFrame && particles.length === 0) {\n        cancelAnimationFrame(animationFrame)\n        clearInterval(interval)\n\n        if (--instanceCounter === 0) {\n          container.remove()\n        }\n      }\n    }, 500)\n  }\n}\n\ninterface CoolModeProps {\n  children: ReactNode\n  options?: CoolParticleOptions\n}\n\nexport const CoolMode: React.FC<CoolModeProps> = ({ children, options }) => {\n  const ref = useRef<HTMLElement>(null)\n\n  useEffect(() => {\n    if (ref.current) {\n      return applyParticleEffect(ref.current, options)\n    }\n  }, [options])\n\n  return React.cloneElement(children as React.ReactElement, { ref })\n}\n","import { memo, useState } from 'react'\nimport { Mcp } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { Input } from 'src/lib/shadcn/ui/input'\n\nconst MCPForm = memo(\n  ({\n    loading,\n    onSubmit,\n  }: {\n    onSubmit: (prompt: Partial<Mcp>) => Promise<unknown>\n    loading?: boolean\n  }) => {\n    const [name, setName] = useState('')\n    const [url, setUrl] = useState('')\n\n    const { t } = useTranslation('components')\n\n    const handleSubmit = async () => {\n      const result = await onSubmit({\n        key: name,\n        url,\n      } as Partial<Mcp>)\n      if (!result) {\n        return\n      }\n      setName('')\n      setUrl('')\n    }\n\n    return (\n      <div>\n        <div className=\"grid w-full gap-1.5\">\n          <Label className=\"mb-2\">{t('add_mcp_card.key')}</Label>\n          <Input\n            disabled={loading}\n            value={name || ''}\n            onChange={(e) => setName(e.target.value || '')}\n            className=\"!text-foreground\"\n          />\n          <Label className=\"mb-2\">{t('add_mcp_card.url')}</Label>\n          <Input\n            disabled={loading}\n            value={url || ''}\n            onChange={(e) => setUrl(e.target.value || '')}\n            className=\"!text-foreground\"\n          />\n        </div>\n        <div>\n          <LoadingButton\n            loading={loading}\n            disabled={!name?.length || !url?.length}\n            onClick={handleSubmit}\n            className=\"w-full mt-4\"\n          >\n            {t('add_mcp_card.button')}\n          </LoadingButton>\n        </div>\n      </div>\n    )\n  },\n)\n\nexport default MCPForm\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateMcp = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const createMcp = useCallback(\n    async (\n      source: Node,\n      options: {\n        key?: string\n        url?: string\n      },\n    ) => {\n      try {\n        if (!source || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        if (!options.key || !options.url) {\n          throw new Error('MCP data is missing')\n        }\n        setLoading(true)\n        // This is node thead replaced with message node\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const mcp = await getRepository('Mcp').save({\n          key: options.key,\n          url: options.url,\n          session_id: sessionId,\n        })\n        if (!mcp) {\n          throw new Error('Failed to save MCP')\n        }\n        const mcpNode = await createOrUpdateFlowNode({\n          source_id: mcp.id,\n          source_type: 'Mcp',\n          node_type: FlowNodeTypeEnum.MCP,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!mcpNode) {\n          throw new Error('Failed to save MCP node')\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode],\n  )\n\n  return {\n    loading,\n    createMcp,\n  }\n}\n","import { memo } from 'react'\nimport { NodeProps, useInternalNode } from '@xyflow/react'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Mcp, Thread } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\n\nimport MCPForm from './MCPForm'\nimport { useCreateMcp } from 'src/hooks/flows/mutations/use-create-mcp'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from 'src/lib/shadcn/ui/collapsible'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { MarkdownViewer } from '../MarkdownViewer'\nimport { Separator } from 'src/lib/plate-ui/ui/separator'\n\nconst CreateMCPCard = memo(\n  (\n    props: Omit<NodeProps, 'data'> & {\n      data?: { ready?: boolean }\n      thread?: Thread\n      setDialog?: (value: boolean) => void\n    },\n  ) => {\n    const { id, setDialog } = props\n\n    const { t } = useTranslation('components')\n    const { toast } = useToast()\n    const node = useInternalNode(id)\n    const { createMcp, loading } = useCreateMcp()\n\n    const handleSubmit = async (data: Partial<Mcp>) => {\n      if (node) {\n        try {\n          if (!data?.url || !data?.key) {\n            throw new Error('MCP data is missing')\n          }\n          await createMcp(node, data)\n          setDialog?.(false)\n        } catch (error) {\n          toast({\n            variant: 'destructive',\n            title: `${error}`,\n          })\n        }\n      }\n    }\n\n    return (\n      <Card className=\"mw-full\">\n        <CardHeader>\n          <CardTitle>{t('add_mcp_card.title')}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"max-w-lg nodrag nowheel\">\n          <MCPForm onSubmit={handleSubmit} loading={loading} />\n          <Separator className=\"mt-4 mb-2\" />\n          <Label className=\"text-lg\">{t('add_mcp_card.faq')}</Label>\n          <Separator className=\"mb-4 mt-2\" />\n          <Collapsible asChild className=\"group/collapsible\">\n            <div>\n              <CollapsibleTrigger asChild>\n                <div className=\"flex justify-between py-2\">\n                  <div>\n                    <Label>{t('add_mcp_card.note.title')}</Label>\n                  </div>\n                  <div>\n                    <LazyIcon name=\"chevron-down\" className=\"h-4 w-4\" />\n                  </div>\n                </div>\n              </CollapsibleTrigger>\n              <CollapsibleContent>\n                <MarkdownViewer source={t('add_mcp_card.note.detail')} />\n              </CollapsibleContent>\n            </div>\n          </Collapsible>\n          <Collapsible asChild className=\"group/collapsible\">\n            <div>\n              <CollapsibleTrigger asChild>\n                <div className=\"flex justify-between py-2\">\n                  <div>\n                    <Label>{t('add_mcp_card.filesystem.title')}</Label>\n                  </div>\n                  <div>\n                    <LazyIcon name=\"chevron-down\" className=\"h-4 w-4\" />\n                  </div>\n                </div>\n              </CollapsibleTrigger>\n              <CollapsibleContent>\n                <MarkdownViewer source={t('add_mcp_card.filesystem.detail')} />\n              </CollapsibleContent>\n            </div>\n          </Collapsible>\n          <Collapsible asChild className=\"group/collapsible\">\n            <div>\n              <CollapsibleTrigger asChild>\n                <div className=\"flex justify-between py-2\">\n                  <div>\n                    <Label>{t('add_mcp_card.memory.title')}</Label>\n                  </div>\n                  <div>\n                    <LazyIcon name=\"chevron-down\" className=\"h-4 w-4\" />\n                  </div>\n                </div>\n              </CollapsibleTrigger>\n              <CollapsibleContent>\n                <MarkdownViewer source={t('add_mcp_card.memory.detail')} />\n              </CollapsibleContent>\n            </div>\n          </Collapsible>\n          <Collapsible asChild className=\"group/collapsible\">\n            <div>\n              <CollapsibleTrigger asChild>\n                <div className=\"flex justify-between py-2\">\n                  <div>\n                    <Label>{t('add_mcp_card.playwright.title')}</Label>\n                  </div>\n                  <div>\n                    <LazyIcon name=\"chevron-down\" className=\"h-4 w-4\" />\n                  </div>\n                </div>\n              </CollapsibleTrigger>\n              <CollapsibleContent>\n                <MarkdownViewer source={t('add_mcp_card.playwright.detail')} />\n              </CollapsibleContent>\n            </div>\n          </Collapsible>\n          <Collapsible asChild className=\"group/collapsible\">\n            <div>\n              <CollapsibleTrigger asChild>\n                <div className=\"flex justify-between py-2\">\n                  <div>\n                    <Label>{t('add_mcp_card.figma.title')}</Label>\n                  </div>\n                  <div>\n                    <LazyIcon name=\"chevron-down\" className=\"h-4 w-4\" />\n                  </div>\n                </div>\n              </CollapsibleTrigger>\n              <CollapsibleContent>\n                <MarkdownViewer source={t('add_mcp_card.figma.detail')} />\n              </CollapsibleContent>\n            </div>\n          </Collapsible>\n        </CardContent>\n      </Card>\n    )\n  },\n)\n\nexport default CreateMCPCard\n","import { NodeProps } from '@xyflow/react'\nimport { memo, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport {\n  Menubar,\n  MenubarContent,\n  MenubarItem,\n  MenubarMenu,\n  MenubarTrigger,\n} from 'src/lib/shadcn/ui/menubar'\nimport CreateLLMCard from 'src/components/molecules/CreateLLMCard'\nimport CreatePromptCard from 'src/components/molecules/CreatePromptCard'\nimport CreateSchemaCard from 'src/components/molecules/CreateSchemaCard'\nimport CreateFewShotExampleCard from 'src/components/molecules/CreateFewShotExampleCard'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport CreateToolCard from 'src/components/molecules/CreateToolCard'\nimport CreateVectorDatabaseCard from 'src/components/molecules/CreateVectorDatabaseCard'\nimport Logo from 'src/assets/svgs/logo.svg?react'\nimport CreateTextDataCard from 'src/components/molecules/CreateTextDataCard'\nimport { useAppState } from 'src/states/app'\nimport { cn } from 'src/lib/utils'\n\nimport { SUPPORTED_MODES, SupportedAddNodeEnum } from './constants'\nimport { CoolMode } from 'src/lib/shadcn/ui/cool-mode'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport CreateMCPCard from 'src/components/molecules/CreateMCPCard'\n\nexport const ToolbarNode = memo((props: NodeProps) => {\n  const { t } = useTranslation('flows')\n  const theme = useAppState((state) => state.theme)\n  const [mode, setMode] = useState(`${SupportedAddNodeEnum.ADD_LLM}`)\n\n  const menu = useMemo(() => {\n    return (\n      <Menubar>\n        <MenubarMenu>\n          <CoolMode>\n            <Button variant=\"link\" className=\"!p-0 !pl-3\">\n              <Logo\n                width={32}\n                height={32}\n                className={cn(theme === 'dark' ? 'fill-white' : 'fill-black')}\n              />\n            </Button>\n          </CoolMode>\n        </MenubarMenu>\n        {SUPPORTED_MODES.map((mode) => {\n          if (typeof mode === 'object') {\n            return (\n              <MenubarMenu key={mode.key}>\n                <MenubarTrigger>\n                  {mode.icon ? <LazyIcon name={mode.icon} /> : t(`supported_nodes.${mode.label}`)}\n                </MenubarTrigger>\n                <MenubarContent>\n                  {mode.children.map((child) => {\n                    return (\n                      <MenubarItem key={child} onClick={() => setMode(child)}>\n                        {t(`supported_nodes.${child.toLowerCase()}`)}\n                      </MenubarItem>\n                    )\n                  })}\n                </MenubarContent>\n              </MenubarMenu>\n            )\n          }\n          return (\n            <MenubarMenu key={mode}>\n              <MenubarTrigger value={mode} onClick={() => setMode(mode)}>\n                {t(`supported_nodes.${mode.toLowerCase()}`)}\n              </MenubarTrigger>\n            </MenubarMenu>\n          )\n        })}\n      </Menubar>\n    )\n  }, [t, theme])\n\n  const modeToComponent = useMemo(() => {\n    switch (mode) {\n      case SupportedAddNodeEnum.ADD_LLM:\n        return <CreateLLMCard {...props} />\n      case SupportedAddNodeEnum.ADD_PROMPT:\n        return <CreatePromptCard {...props} />\n      case SupportedAddNodeEnum.ADD_SCHEMA:\n        return <CreateSchemaCard {...props} />\n      case SupportedAddNodeEnum.ADD_FEW_SHOT_EXAMPLE:\n        return <CreateFewShotExampleCard {...props} />\n      case SupportedAddNodeEnum.ADD_TOOL_DEFINITION:\n        return <CreateToolCard {...props} />\n      case SupportedAddNodeEnum.ADD_VECTOR_DATABASE:\n        return <CreateVectorDatabaseCard {...props} />\n      case SupportedAddNodeEnum.ADD_TEXT_DATA:\n        return <CreateTextDataCard {...props} />\n      case SupportedAddNodeEnum.ADD_MCP:\n        return <CreateMCPCard {...props} />\n    }\n  }, [props, mode])\n  return (\n    <>\n      {menu}\n      <div className=\"mt-4\">{modeToComponent}</div>\n    </>\n  )\n})\n","import { useCallback, useState } from 'react'\nimport { Connection, Node } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport {\n  AppEntityNames,\n  FlowNodeTypeEnum,\n  flowNodeTypeToEntity,\n  Session,\n  SessionStatusEnum,\n  SessionTypeEnum,\n} from 'src/services/database/types'\nimport { EntityType } from 'src/utils/orm-type'\nimport { DefaultNodeData } from 'src/utils/flow-node'\nimport { useNavigate } from 'react-router-dom'\nimport { getRouteURL } from 'src/utils/routes'\n\nexport const useCreateStandaloneSession = () => {\n  const [loading, setLoading] = useState(false)\n  const navigate = useNavigate()\n  const currentSession = useSessionState((state) => state.currentSession)\n\n  const cloneNode = useCallback(\n    async (\n      newSession: Session,\n      node: Node<DefaultNodeData>,\n      newEntityIDMap: Map<string, string>,\n      newFlowNodeIDMap: Map<string, string>,\n    ) => {\n      const entity = node.data?.entity\n      let entityName = node.type ? flowNodeTypeToEntity[node.type as FlowNodeTypeEnum] : undefined\n      if (\n        entityName &&\n        entity &&\n        node &&\n        typeof entity === 'object' &&\n        'id' in entity &&\n        !newEntityIDMap.has(`${entity.id}`) &&\n        !newFlowNodeIDMap.has(`${node.id}`)\n      ) {\n        entityName = entityName as AppEntityNames\n        const cloneEntity = await getRepository(entityName).save({\n          ...entity,\n          ...(entity && typeof entity === 'object' && 'session_id' in entity\n            ? { session_id: newSession.id }\n            : {}),\n        } as EntityType<unknown>)\n        newEntityIDMap.set(`${entity.id}`, cloneEntity.id)\n        const currentFlowNode = await getRepository('FlowNode').findOne({\n          where: {\n            id: node.data.flowNode.id,\n          },\n        })\n        const cloneFlowNode = await getRepository('FlowNode').save({\n          ...(currentFlowNode || node.data.flowNode),\n          session_id: newSession.id,\n          id: undefined,\n          source_type: entityName,\n          source_id: cloneEntity.id,\n        })\n        newFlowNodeIDMap.set(`${node.id}`, cloneFlowNode.id)\n        return {\n          entityName,\n          entity: cloneEntity,\n          node: cloneFlowNode,\n        }\n      } else if (!newFlowNodeIDMap.has(`${node.id}`)) {\n        const currentFlowNode = await getRepository('FlowNode').findOne({\n          where: {\n            id: node.data.flowNode.id,\n          },\n        })\n        const cloneFlowNode = await getRepository('FlowNode').save({\n          ...(currentFlowNode || node.data.flowNode),\n          node_type: node.type as FlowNodeTypeEnum,\n          session_id: newSession.id,\n          id: undefined,\n        })\n        newFlowNodeIDMap.set(`${node.id}`, cloneFlowNode.id)\n        return {\n          node: cloneFlowNode,\n        }\n      }\n    },\n    [],\n  )\n\n  const createStandaloneSession = useCallback(\n    async (\n      node: Node<DefaultNodeData>,\n      options: {\n        name?: string\n        connections: {\n          node: Node<DefaultNodeData>\n          connections: Connection[]\n          connectedNodes?: Node<DefaultNodeData>[]\n        }[]\n      },\n    ) => {\n      try {\n        if (!currentSession) {\n          throw new Error('No current session')\n        }\n        setLoading(true)\n        const standaloneSession = await getRepository('Session').save({\n          type: SessionTypeEnum.StandaloneApp,\n          name: options.name || (currentSession?.name ? `${currentSession.name}` : 'Standalone'),\n          status: SessionStatusEnum.Started,\n          passphrase: currentSession.passphrase,\n        })\n        if (!standaloneSession) {\n          throw new Error('Failed create standalone session')\n        }\n        const newEntityIDMap = new Map<string, string>()\n        const newFlowNodeIDMap = new Map<string, string>()\n        // Clone node\n        const mainNodeInfo = await cloneNode(\n          standaloneSession,\n          node,\n          newEntityIDMap,\n          newFlowNodeIDMap,\n        )\n        if (!mainNodeInfo) {\n          throw new Error('Failed to clone main node')\n        }\n        await getRepository('Session').update(standaloneSession.id, {\n          main_node_id: mainNodeInfo.node.id,\n          main_source_id: mainNodeInfo?.entity ? mainNodeInfo.entity.id : undefined,\n          main_source_type: mainNodeInfo.entityName ? mainNodeInfo.entityName : undefined,\n        })\n        // Clone connected nodes\n        for (const { node, connectedNodes } of options.connections) {\n          await cloneNode(standaloneSession, node, newEntityIDMap, newFlowNodeIDMap)\n          // Clone Connected Nodes\n          if (connectedNodes) {\n            for (const connectedNode of connectedNodes) {\n              await cloneNode(standaloneSession, connectedNode, newEntityIDMap, newFlowNodeIDMap)\n            }\n          }\n        }\n        // Clone connections\n        for (const { connections } of options.connections) {\n          for (const connection of connections) {\n            const sourceId = newFlowNodeIDMap.get(`${connection.source}`)\n            const targetId = newFlowNodeIDMap.get(`${connection.target}`)\n            if (!sourceId || !targetId) {\n              throw new Error('Failed to get connected flow node id')\n            }\n            await getRepository('FlowEdge').save({\n              source: sourceId,\n              target: targetId,\n              sourceHandle: connection.sourceHandle,\n              targetHandle: connection.targetHandle,\n              session_id: standaloneSession.id,\n            })\n          }\n        }\n\n        navigate(getRouteURL('application', { applicationId: standaloneSession.id }))\n        return true\n      } finally {\n        setLoading(false)\n      }\n    },\n    [cloneNode, currentSession, navigate],\n  )\n\n  return {\n    loading,\n    createStandaloneSession,\n  }\n}\n","import { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport { useFlowState } from 'src/states/flow'\n\nexport const useDeleteNodeFlow = () => {\n  const [loading, setLoading] = useState(false)\n  const updateNode = useFlowState((state) => state.updateNodes)\n  const updateEdges = useFlowState((state) => state.updateEdges)\n\n  const deleteNodeFlow = useCallback(\n    async (id: string) => {\n      try {\n        setLoading(true)\n        await getRepository('FlowNode').delete(id)\n        const edges = await getRepository('FlowEdge').find({\n          where: [{ source: id }, { target: id }],\n        })\n        await Promise.all(edges.map((edge) => getRepository('FlowEdge').delete(edge.id)))\n        await updateNode([{ id, type: 'remove' as const }])\n        await updateEdges(edges.map((edge) => ({ id: edge.id, type: 'remove' as const })))\n        return true\n      } catch {\n        return false\n      } finally {\n        setLoading(false)\n      }\n    },\n    [updateEdges, updateNode],\n  )\n\n  return {\n    loading,\n    deleteNodeFlow,\n  }\n}\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from 'src/lib/shadcn/ui/dialog'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { Label } from 'src/lib/shadcn/ui/label'\n\ntype CreateSessionProps = {\n  className: string\n  cloneStandaloneSession: (name?: string) => Promise<void>\n}\n\nconst CreateStandaloneApplicationDialog = create<CreateSessionProps>(\n  ({ cloneStandaloneSession }) => {\n    const currentModal = useModal()\n    const { t } = useTranslation('dialogs')\n    const [name, setName] = useState('')\n\n    const { toast } = useToast()\n\n    const handleChangeName = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setName(e.target.value)\n    }\n\n    const handleSubmit = async () => {\n      try {\n        currentModal.hide()\n        await cloneStandaloneSession(name)\n        setName('')\n      } catch {\n        toast({\n          variant: 'destructive',\n          description: t('create_standalone_application.errors.create_failed'),\n        })\n      }\n    }\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>{t('create_session.title')}</DialogTitle>\n            <DialogDescription>{t('create_standalone_application.description')}</DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"flex flex-col space-y-1.5\">\n              <Label className=\"mb-2\" htmlFor=\"name\">\n                {t('create_standalone_application.name')}\n              </Label>\n              <Input\n                onChange={handleChangeName}\n                id=\"name\"\n                value={name}\n                placeholder={t('create_standalone_application.name_placeholder')}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button onClick={handleSubmit} disabled={!name} type=\"submit\">\n              {t('create_standalone_application.create')}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default CreateStandaloneApplicationDialog\n","import { memo, useCallback } from 'react'\nimport { Node, Connection, useReactFlow } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\nimport { useCreateStandaloneSession } from 'src/hooks/mutations/use-create-standalone-session'\nimport { useDeleteNodeFlow } from 'src/hooks/flows/mutations/use-delete-node-flow'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { cn } from 'src/lib/utils'\nimport { DefaultNodeData, DefaultNodeProps } from 'src/utils/flow-node'\nimport { EntityType } from 'src/utils/orm-type'\nimport { logError } from 'src/utils/logger'\nimport { useModal } from '@ebay/nice-modal-react'\nimport CreateStandaloneApplicationDialog from 'src/components/dialogs/CreateStandaloneApplicationDialog'\n\nexport const NodeHeader = memo(\n  ({\n    id,\n    className,\n    enableToStandalone,\n    getLinkedConnections,\n  }: {\n    id: string\n    className?: string\n    enableToStandalone?: boolean\n    getLinkedConnections?: (id: string) => {\n      node: Node<DefaultNodeProps<{ entity: EntityType<unknown> }>['data']>\n      connections: Connection[]\n      connectedNodes?: Node<DefaultNodeProps<{ entity: EntityType<unknown> }>['data']>[]\n    }[]\n  }) => {\n    const { t } = useTranslation('common')\n    const { getNode } = useReactFlow<Node<DefaultNodeData>>()\n    const { loading: deleting, deleteNodeFlow } = useDeleteNodeFlow()\n    const { createStandaloneSession } = useCreateStandaloneSession()\n    const { toast } = useToast()\n    const createStandaloneApplicationDialog = useModal(CreateStandaloneApplicationDialog)\n\n    const handleDelete = useCallback(async () => {\n      try {\n        await deleteNodeFlow(id)\n        toast({\n          description: t('deleted'),\n        })\n      } catch {\n        toast({\n          description: t('errors.delete_failed'),\n          variant: 'destructive',\n        })\n      }\n    }, [deleteNodeFlow, id, toast, t])\n\n    const cloneStandaloneSession = useCallback(\n      async (name?: string) => {\n        try {\n          const currentNode = getNode(id)\n          if (!currentNode) {\n            throw new Error('No current node')\n          }\n          const connections = getLinkedConnections?.(id) || []\n          await createStandaloneSession(currentNode, { name, connections })\n          toast({\n            description: t('standalone_session_created'),\n          })\n        } catch (error) {\n          logError('Clone Standalone Session', error)\n          toast({\n            description: t('errors.create_standalone_session_failed'),\n            variant: 'destructive',\n          })\n        }\n      },\n      [getNode, id, getLinkedConnections, createStandaloneSession, toast, t],\n    )\n\n    const handleCreateStandaloneApplication = useCallback(() => {\n      createStandaloneApplicationDialog.show({\n        cloneStandaloneSession,\n      })\n    }, [cloneStandaloneSession, createStandaloneApplicationDialog])\n\n    return (\n      <div className={cn('flex absolute z-[51] right-0 top-0 h-10', className)}>\n        {enableToStandalone ? (\n          <Button\n            className=\"!rounded-none !px-2\"\n            onClick={handleCreateStandaloneApplication}\n            variant=\"ghost\"\n          >\n            <LazyIcon name=\"package-plus\" size={16} />\n          </Button>\n        ) : undefined}\n        <LoadingButton\n          loading={deleting}\n          className=\"!rounded-none !px-2\"\n          onClick={handleDelete}\n          variant=\"ghost\"\n        >\n          <LazyIcon name=\"trash-2\" size={16} />\n        </LoadingButton>\n      </div>\n    )\n  },\n)\n","import { memo } from 'react'\nimport { Handle, HandleProps, Position } from '@xyflow/react'\nimport { cn } from 'src/lib/utils'\n\nexport const DefaultHandle = memo((props: HandleProps) => {\n  const { className, ...rest } = props\n  return (\n    <Handle\n      className={cn(\n        '!w-2 !h-2 !border-none !rounded-full !bg-slate-700',\n        props.position === Position.Top ? '!top-[-2px]' : '',\n        className,\n      )}\n      {...rest}\n    />\n  )\n})\n","import { useState, useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport { FlowNodeTypeEnum, LLM } from 'src/services/database/types'\nimport { ThreadStatusEnum } from 'src/services/database/types/thread'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateThread = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const createThread = useCallback(\n    async (source: Node) => {\n      setLoading(true)\n      try {\n        const llm = source.data?.entity as LLM\n        if (!llm || !sessionId) {\n          throw new Error('LLM or Session not found')\n        }\n\n        const initialX = source.position.x\n        const initialY = source.position.y + (source.measured?.height || 0)\n        const thread = await getRepository('Thread').save({\n          initial_llm_id: llm.id,\n          title: `New thread with ${llm.name}`,\n          status: ThreadStatusEnum.Started,\n          messages: [],\n          session_id: sessionId,\n        })\n        const flowNode = await createOrUpdateFlowNode({\n          source_id: thread.id,\n          source_type: 'Thread',\n          node_type: FlowNodeTypeEnum.Thread,\n          x: initialX,\n          y: initialY + 60,\n        })\n        if (!flowNode) {\n          throw new Error('Failed to create thread node')\n        }\n        // Create connection from source to threadNode\n        const flowEdge = await createOrUpdateFlowEdge({\n          source: source.id,\n          target: flowNode.id,\n        })\n\n        return {\n          thread,\n          flowNode,\n          flowEdge,\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [createOrUpdateFlowEdge, createOrUpdateFlowNode, sessionId],\n  )\n\n  return {\n    loading,\n    createThread,\n  }\n}\n","import { useCallback, useEffect, useState } from 'react'\nimport { Node, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { FlowNodeTypeEnum, LLM, LLMProviderEnum, LLMStatusEnum } from 'src/services/database/types'\nimport { useCreateThread } from 'src/hooks/flows/mutations/use-create-thread'\nimport { useFlowState } from 'src/states/flow'\nimport { getRepository } from 'src/services/database'\nimport { In } from 'src/services/database/typeorm-wrapper'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { logError } from 'src/utils/logger'\nimport { useLoadModel } from 'src/hooks/mutations/use-load-model'\n\nimport { LLMNodeProps } from '../type'\n\nexport const useActions = (id: string, data: LLMNodeProps['data']) => {\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n  const [loadingModel, setLoadingModel] = useState(false)\n  const [queringThreads, setQueringThreads] = useState(false)\n  const node = useInternalNode(id) as Node<LLMNodeProps['data']>\n  const { loadModel } = useLoadModel()\n  const { createThread, loading: creatingThread } = useCreateThread()\n\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const pushSyncNodeQueue = useFlowState((state) => state.pushSyncNodeQueue)\n\n  const { getNodes } = useReactFlow()\n\n  const queryThreadsFromModel = useCallback(async () => {\n    try {\n      setQueringThreads(true)\n      if (data.entity.id) {\n        const threads = await getRepository('Thread').find({\n          where: {\n            initial_llm_id: data.entity.id,\n          },\n        })\n        pushSyncNodeQueue('Thread', {\n          where: {\n            source_type: 'Thread',\n            source_id: In(threads.map((thread) => thread.id)),\n          },\n        })\n      }\n    } finally {\n      setQueringThreads(false)\n    }\n  }, [data?.entity?.id, pushSyncNodeQueue])\n\n  const handleLoadModel = useCallback(async () => {\n    try {\n      setLoadingModel(true)\n      if (data.entity && node) {\n        await loadModel?.(data.entity.provider, `${data.entity.name}`, {\n          provider: data.entity.provider,\n          callback: (initProgress) => {\n            node.data.status =\n              initProgress.progress === 100 ? LLMStatusEnum.Loaded : LLMStatusEnum.Loading\n\n            node.data.label = initProgress.text\n            updateNodes([{ id, type: 'replace' as const, item: node }])\n          },\n        })\n        const llmNodeChanges = getNodes()\n          .filter((node) => {\n            const isLLMNode = node.type === FlowNodeTypeEnum.LLM\n            if (isLLMNode) {\n              const entity = node.data.entity as LLM\n              return entity.provider === LLMProviderEnum.WebLLM\n            }\n            return false\n          })\n          .map((node) => {\n            node.data.status = LLMStatusEnum.Started\n            return { id: node.id, type: 'replace' as const, item: node }\n          })\n        node.data.label = ''\n        node.data.status = LLMStatusEnum.Loaded\n        llmNodeChanges.push({\n          id,\n          type: 'replace' as const,\n          item: node,\n        })\n        updateNodes(llmNodeChanges)\n        await queryThreadsFromModel()\n      }\n    } catch (error) {\n      logError('Load Model', error)\n      toast({\n        variant: 'destructive',\n        description: t('llm_node.errors.loading_model'),\n      })\n    } finally {\n      setLoadingModel(false)\n    }\n  }, [data.entity, getNodes, id, loadModel, node, queryThreadsFromModel, t, toast, updateNodes])\n\n  const handleCreateThread = useCallback(async () => {\n    if (data.entity && node) {\n      await createThread?.(node)\n    }\n  }, [data.entity, node, createThread])\n\n  const changeLLMOptions = useCallback(\n    async (options: Record<string, unknown>) => {\n      if (data.entity && node) {\n        node.data.entity.options = options\n        await getRepository('LLM').update(data.entity.id, { options })\n        updateNodes([{ id, type: 'replace' as const, item: node }])\n      }\n    },\n    [data.entity, id, node, updateNodes],\n  )\n\n  useEffect(() => {\n    if (data.entity && node && data.entity.status !== data.status) {\n      node.data.status = data.entity.status as LLMStatusEnum\n      updateNodes([{ id, type: 'replace' as const, item: node }])\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  return {\n    loadingModel,\n    creatingThread,\n    queringThreads,\n    changeLLMOptions,\n    loadModel: handleLoadModel,\n    createThread: handleCreateThread,\n    queryThreads: queryThreadsFromModel,\n  }\n}\n","import { useCallback, useEffect, useState } from 'react'\nimport { Node, Connection, useHandleConnections, useReactFlow } from '@xyflow/react'\n\nimport { filterUserConnections } from 'src/utils/flow'\n\nexport const useBaseConnectionToHandler = (\n  id: string,\n  handlerFunction: (input: {\n    id: string\n    edgeId: string\n    source: Node\n    target: Node\n    connection: Connection\n  }) => Promise<{ deleteEdgeId: string | string[] } | undefined>,\n) => {\n  const [handling, setHandling] = useState(false)\n  const [newTargetConnection, setNewTargetConnection] = useState<Connection[]>([])\n  const { deleteElements, getNode } = useReactFlow()\n\n  useHandleConnections({\n    type: 'target',\n    nodeId: id,\n    onConnect: (newConnections) => {\n      if (newConnections?.length) {\n        setNewTargetConnection((pre) => [...pre, ...filterUserConnections(newConnections)])\n      }\n    },\n  })\n\n  const connectionHandler = useCallback(\n    async (edgeId: string, source: Node, target: Node, connection: Connection) => {\n      try {\n        const result = await handlerFunction({\n          id,\n          edgeId,\n          source,\n          target,\n          connection,\n        })\n\n        return result\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [handlerFunction, id],\n  )\n\n  useEffect(() => {\n    if (!newTargetConnection?.length || handling) {\n      return\n    }\n    const handle = async () => {\n      try {\n        setHandling(true)\n        const handlingConnections = [...newTargetConnection]\n        setNewTargetConnection([])\n        const removeEdgeIds: string[] = []\n        const target = getNode(id)\n        await Promise.all(\n          handlingConnections.map(async (connection) => {\n            const edgeId = 'edgeId' in connection ? connection.edgeId : undefined\n            const source = getNode(connection.source)\n            if (!source || !target) {\n              return\n            }\n\n            const response = await connectionHandler(`${edgeId}`, source, target, connection)\n\n            if (response?.deleteEdgeId) {\n              removeEdgeIds.push(\n                ...(Array.isArray(response.deleteEdgeId)\n                  ? response.deleteEdgeId\n                  : [response.deleteEdgeId]),\n              )\n            }\n          }),\n        )\n        if (removeEdgeIds?.length) {\n          await deleteElements({\n            edges: removeEdgeIds.map((id) => ({ id })),\n          })\n        }\n      } finally {\n        setHandling(false)\n      }\n    }\n    handle()\n  }, [deleteElements, getNode, id, handling, connectionHandler, newTargetConnection])\n}\n","import { useCallback } from 'react'\n\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const handleConnectionTo = useCallback(async () => {\n    return undefined\n  }, [])\n  useBaseConnectionToHandler(id, handleConnectionTo)\n}\n","import { memo, useCallback, useEffect, useMemo, useState } from 'react'\nimport { Position } from '@xyflow/react'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { LLMProviderEnum, LLMStatusEnum } from 'src/services/database/types/llm'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { BorderBeam } from 'src/lib/shadcn/ui/border-beam'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\nimport LoadingButton from 'src/components/atoms/LoadingButton'\n\nimport { LLMNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { LLMSetting } from 'src/components/atoms/LLMSetting'\n\nexport const LLMNode = memo((props: LLMNodeProps) => {\n  const { id, data, isConnectable } = props\n  const [llmInfo, setLLMInfo] = useState<\n    | { hasCache: boolean; isFunctionCalling: boolean; info?: ModelRecord; cloud?: boolean }\n    | undefined\n  >()\n  const { t } = useTranslation('flows')\n\n  const { createThread, loadModel, queringThreads, queryThreads, loadingModel, changeLLMOptions } =\n    useActions(id, data)\n  useConnectionToHandler(id)\n\n  const isLoading = [LLMStatusEnum.Loading, LLMStatusEnum.Downloading].includes(data.status)\n\n  useEffect(() => {\n    if (llmInfo || !data?.entity?.name) {\n      return\n    }\n    if (\n      ![LLMProviderEnum.WebLLM, LLMProviderEnum.Wllama].includes(\n        data?.entity?.provider as LLMProviderEnum,\n      )\n    ) {\n      setLLMInfo({\n        hasCache: false,\n        cloud: true,\n        isFunctionCalling: true,\n        info: {\n          model_id: data?.entity?.name,\n          model: data?.entity?.name,\n          model_lib: data?.entity?.provider,\n          model_type: 2,\n        },\n      })\n      return\n    } else if (LLMProviderEnum.Wllama === data?.entity?.provider) {\n      import('@wllama/wllama').then(async ({ ModelManager }) => {\n        const modelManager = new ModelManager()\n        const models = await modelManager.getModels()\n        setLLMInfo({\n          hasCache: !!models.find((item) => item.url.includes(data?.entity?.name)),\n          cloud: false,\n          isFunctionCalling: false,\n          info: {\n            model_id: data?.entity?.name,\n            model: data?.entity?.name,\n            model_lib: data?.entity?.provider,\n            model_type: 2,\n          },\n        })\n      })\n      setLLMInfo({\n        hasCache: false,\n        cloud: false,\n        isFunctionCalling: true,\n        info: {\n          model_id: data?.entity?.name,\n          model: data?.entity?.name,\n          model_lib: data?.entity?.provider,\n          model_type: 2,\n        },\n      })\n      return\n    }\n\n    import('@mlc-ai/web-llm').then(\n      async ({ hasModelInCache, functionCallingModelIds, prebuiltAppConfig }) => {\n        const hasCache = await hasModelInCache(data?.entity?.name)\n        setLLMInfo({\n          hasCache,\n          isFunctionCalling: functionCallingModelIds.includes(data?.entity?.name),\n          info: prebuiltAppConfig.model_list.find((item) => item.model_id === data?.entity?.name),\n        })\n      },\n    )\n  }, [data?.entity?.name, data?.entity?.provider, llmInfo])\n\n  const onChangeOptions = useCallback(\n    async (options: Record<string, unknown>) => {\n      await changeLLMOptions(options)\n    },\n    [changeLLMOptions],\n  )\n\n  const llmIcon = useMemo(() => {\n    switch (data.status) {\n      case LLMStatusEnum.Downloading:\n        return <LazyIcon className={'animate-spin w-7 h-7'} name={'arrow-big-down-dash'} />\n      case LLMStatusEnum.Loaded:\n        return <LLMIcon name={data.entity?.name || 'brain'} className=\"w-7 h-7\" />\n      case LLMStatusEnum.Loading:\n        return <LazyIcon className={'animate-spin w-7 h-7'} name={'loader-circle'} />\n      default:\n        return <LLMIcon name={data.entity?.name || 'brain'} className=\"w-7 h-7\" />\n    }\n  }, [data.entity?.name, data.status])\n\n  const actions = useMemo(() => {\n    if (isLoading) {\n      return null\n    }\n    if (loadingModel) {\n      return (\n        <Button disabled={true} className=\"w-full mt-4\">\n          <LazyIcon className={'animate-spin'} size={24} name={'loader-circle'} />\n        </Button>\n      )\n    }\n    if (data.status === LLMStatusEnum.Loaded) {\n      return (\n        <Button onClick={createThread} className=\"mt-4 w-full\">\n          {t('llm_node.create_thread_button')}\n        </Button>\n      )\n    }\n    return (\n      <div className=\"flex gap-2 mt-4\">\n        {llmInfo?.hasCache ? (\n          <LoadingButton loading={queringThreads} onClick={queryThreads}>\n            <LazyIcon size={24} name={'message-square-more'} />\n          </LoadingButton>\n        ) : null}\n        <Button disabled={loadingModel} onClick={loadModel} className=\"w-full\">\n          {t(llmInfo?.hasCache ? 'llm_node.load_model_button' : 'llm_node.download_model_button')}\n        </Button>\n      </div>\n    )\n  }, [\n    isLoading,\n    loadingModel,\n    data.status,\n    llmInfo?.hasCache,\n    queringThreads,\n    queryThreads,\n    loadModel,\n    t,\n    createThread,\n  ])\n  return (\n    <div>\n      <div>\n        <NodeHeader id={id} />\n        <Alert className=\"flex justify-center\">\n          {llmIcon}\n          <div className=\"ml-2 pt-1 max-w-lg\">\n            <AlertTitle className=\"flex gap-2 items-center pr-6\">\n              {`${data?.entity?.name || ''}`}\n            </AlertTitle>\n            <AlertDescription className=\"max-w-full\">{`${data.label || ''}`}</AlertDescription>\n            <div className=\"max-w-full mt-2 flex-wrap flex gap-1\">\n              <LLMInfo\n                model={llmInfo?.info}\n                isFunctionCalling={llmInfo?.isFunctionCalling || false}\n                name={data?.entity?.name}\n                isCached={llmInfo?.hasCache || false}\n                cloud={llmInfo?.cloud || false}\n              />\n            </div>\n            <LLMSetting\n              options={data?.entity?.options}\n              onChangeOptions={onChangeOptions}\n              className=\"mt-2\"\n            />\n            {actions}\n          </div>\n        </Alert>\n        {isLoading ? <BorderBeam className=\"rounded-lg\" /> : undefined}\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\nimport AIInput from 'src/lib/kokonutui/ai-input'\n\nconst NewMessageCard = memo(\n  ({\n    tags,\n    disabled,\n    loading,\n    onSubmit,\n  }: {\n    tags?: React.ReactNode\n    disabled?: boolean\n    loading?: boolean\n    onSubmit: (input: string) => void\n  }) => {\n    const { t } = useTranslation('components')\n\n    const hanldeSubmit = async (input: string) => {\n      try {\n        await onSubmit(input)\n        return true\n      } catch {\n        return false\n      }\n    }\n\n    return (\n      <Card className=\"min-w-80\">\n        <CardHeader>\n          <CardTitle>{t('add_message_card.title')}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid w-full gap-1.5\">\n            <AIInput\n              onSubmit={hanldeSubmit}\n              disabled={disabled || loading}\n              placeholder={t('add_message_card.placeholder')}\n            />\n          </div>\n          {tags ? <div className=\"mt-2 gap-1 flex flex-wrap\">{tags}</div> : null}\n        </CardContent>\n      </Card>\n    )\n  },\n)\n\nexport default NewMessageCard\n","import type { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types/flow-node'\n\nimport type { DefaultNodeData } from './flow-node'\n\nexport const threadConversationTraveling = (\n  list: string[],\n  nodes: Node<DefaultNodeData>[],\n  connections: Connection[],\n  handledIds: string[] = [],\n  functions: {\n    getNode: (id: string) => Node<DefaultNodeData> | undefined\n    getHandleConnections: (props: { type: 'source' | 'target'; nodeId: string }) => Connection[]\n  },\n) => {\n  const runningNodes = list.map((id) => functions.getNode(id))\n  for (const node of runningNodes) {\n    if (!node) {\n      continue\n    }\n\n    const nodeConnections = functions.getHandleConnections({\n      type: 'target',\n      nodeId: node.id,\n    })\n    connections.push(...nodeConnections)\n\n    if (node.type === FlowNodeTypeEnum.Thread) {\n      handledIds.push(node.id)\n      nodes.push(node)\n      continue\n    } else if (node.type !== FlowNodeTypeEnum.Message) {\n      handledIds.push(node.id)\n      continue\n    } else if (handledIds.includes(node.id)) {\n      continue\n    }\n\n    handledIds.push(node.id)\n    nodes.push(node)\n    if (nodeConnections.length) {\n      threadConversationTraveling(\n        nodeConnections.map((c) => c.source),\n        nodes,\n        connections,\n        handledIds,\n        functions,\n      )\n    }\n  }\n\n  return {\n    nodes,\n    connections,\n  }\n}\n\nexport const prepareThreadConnections = (\n  threadNode: Node<DefaultNodeData>,\n  functions: {\n    getNode: (id: string) => Node<DefaultNodeData> | undefined\n    getHandleConnections: (props: { type: 'source' | 'target'; nodeId: string }) => Connection[]\n  },\n) => {\n  const threadConnections = functions.getHandleConnections({\n    nodeId: threadNode.id,\n    type: 'target',\n  })\n  const threadConnectionInfos = threadConnections.map((connection) => {\n    const node = functions.getNode(connection.source)\n    if (!node) {\n      return\n    }\n    const connections = functions.getHandleConnections({\n      nodeId: node.id,\n      type: 'target',\n    })\n    return {\n      connections,\n      node,\n    }\n  }) as { connections: Connection[]; node: Node<DefaultNodeData> }[]\n  // Prompt connection\n  const threadPromptNodes = threadConnectionInfos.filter((item) => {\n    return item.node?.type === FlowNodeTypeEnum.Prompt\n  })\n  const threadPromptNodeResult: {\n    node: Node<DefaultNodeData>\n    connectedNodes?: Node<DefaultNodeData>[]\n    connections: Connection[]\n  }[] = []\n  if (threadPromptNodes?.length) {\n    threadPromptNodes.forEach((item) => {\n      const promptConnectedNodes = item.connections\n        ?.map((connection) => {\n          return functions.getNode(connection.source)\n        })\n        .filter(Boolean) as Node<DefaultNodeData>[]\n      threadPromptNodeResult.push({\n        node: item.node,\n        connections: item.connections,\n        connectedNodes: promptConnectedNodes,\n      })\n    })\n  }\n  // Tool connection\n  const threadToolsNodes = threadConnectionInfos.filter((item) => {\n    return item.node?.type === FlowNodeTypeEnum.ToolDefinition\n  })\n  const threadToolNodeResult: {\n    node: Node<DefaultNodeData>\n    connectedNodes?: Node<DefaultNodeData>[]\n    connections: Connection[]\n  }[] = []\n  if (threadToolsNodes?.length) {\n    threadToolsNodes.forEach((item) => {\n      const toolConnectedNodes = item.connections\n        ?.map((connection) => {\n          return functions.getNode(connection.source)\n        })\n        .filter(Boolean) as Node<DefaultNodeData>[]\n      if (toolConnectedNodes?.find((node) => node.type === FlowNodeTypeEnum.Schema)) {\n        threadToolNodeResult.push({\n          node: item.node,\n          connections: item.connections,\n          connectedNodes: toolConnectedNodes,\n        })\n      }\n    })\n  }\n  // placeholder node connection\n  const threadPlaceholderNodes = threadConnectionInfos.filter((item) => {\n    return item.node?.type === FlowNodeTypeEnum.PlaceHolder\n  })\n  const threadPlaceholderNodeResult: {\n    node: Node<DefaultNodeData>\n    connectedNodes?: Node<DefaultNodeData>[]\n    connections: Connection[]\n  }[] = []\n  if (threadPlaceholderNodes?.length) {\n    threadPlaceholderNodes.forEach((item) => {\n      const placeholderConnectedNodes = item.connections\n        ?.map((connection) => {\n          return functions.getNode(connection.source)\n        })\n        .filter(Boolean) as Node<DefaultNodeData>[]\n      if (placeholderConnectedNodes) {\n        threadPlaceholderNodeResult.push({\n          node: item.node,\n          connections: item.connections,\n          connectedNodes: placeholderConnectedNodes,\n        })\n      }\n    })\n  }\n  // Schema connection\n  const schemaNode = threadConnectionInfos.find((item) => {\n    return item.node?.type === FlowNodeTypeEnum.Schema\n  })\n\n  return {\n    thread: {\n      node: threadNode,\n      connections: threadConnections,\n    },\n    llm: threadConnectionInfos.find((item) => {\n      return item.node?.type === FlowNodeTypeEnum.LLM\n    }),\n    schemas: schemaNode ? [schemaNode] : [],\n    prompts: threadPromptNodeResult,\n    tools: threadToolNodeResult,\n    placeholders: threadPlaceholderNodeResult,\n  }\n}\n","import { Node } from '@xyflow/react'\nimport { AIMessage, BaseMessage, HumanMessage, SystemMessage } from '@langchain/core/messages'\nimport {\n  CSVData,\n  FlowNodeTypeEnum,\n  Message,\n  Prompt,\n  PromptTypeEnum,\n} from 'src/services/database/types'\nimport { decodeCSVData } from './string-data'\n\nexport const buildHistories = (nodes: { node: Node; connectedNodes: Node[] }[]) => {\n  const histories: BaseMessage[] = []\n  nodes.forEach((item) => {\n    const { node, connectedNodes } = item\n    if (!node.data?.entity) {\n      return\n    }\n    if (node.type === FlowNodeTypeEnum.Message) {\n      const message = node.data.entity as Message\n      switch (message.role) {\n        case 'human':\n          histories.push(new HumanMessage(message.content))\n          break\n        case 'ai':\n          histories.push(new AIMessage(message.content))\n          break\n      }\n    } else if (node.type === FlowNodeTypeEnum.Prompt) {\n      // Prompt\n      const prompt = node.data.entity as Prompt\n\n      let content = `${prompt.prefix ? `${prompt.prefix}\\n` : ''}`\n      if (prompt.type === PromptTypeEnum.FewShotExample) {\n        const connectedDataNode = connectedNodes.find((n) => n.type === FlowNodeTypeEnum.CSVData)\n        const csvData = connectedDataNode?.data?.entity as CSVData\n        if (csvData) {\n          const { rows } = decodeCSVData(csvData.headers, csvData.csv)\n          rows.forEach((row: Record<string, unknown>) => {\n            content += `${prompt.content.replace(/{([^{}]*)}/g, (_, key) => `${row[key as keyof typeof row]}`)}\\n`\n          })\n        }\n      } else {\n        content += prompt.content\n      }\n      if (prompt.suffix) {\n        content += `\\n${prompt.suffix}`\n      }\n\n      switch (prompt.role) {\n        case 'human':\n          histories.push(new HumanMessage(content))\n          break\n        case 'system':\n          histories.push(new SystemMessage(content))\n          break\n        default:\n          histories.push(new AIMessage(content))\n          break\n      }\n    }\n  })\n  return histories\n}\n\nexport const prepareThreadHistory = (\n  connectedNodes: Node[],\n  threadPromptNodes: { node: Node; connectedNodes?: Node[] }[],\n) => {\n  const messageNodes =\n    connectedNodes\n      ?.filter((node) => node.type === FlowNodeTypeEnum.Message)\n      .map((node) => ({ node: node, connectedNodes: [] as Node[] }))\n      .reverse() || []\n\n  const systems: { node: Node; connectedNodes: Node[] }[] = []\n  threadPromptNodes.forEach(async (threadPromptNode) => {\n    systems.unshift({\n      node: threadPromptNode.node,\n      connectedNodes: threadPromptNode.connectedNodes || [],\n    })\n  })\n  return {\n    history: buildHistories(messageNodes),\n    systems: buildHistories(systems),\n  }\n}\n","import { Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum, Schema, SchemaItem, ToolDefinition } from 'src/services/database/types'\nimport { DefaultNode } from './flow-node'\n\nexport const toLocalLLMToolCallingInput = (\n  tools?: {\n    node: DefaultNode\n    connectedNodes?: DefaultNode[]\n    connections: Connection[]\n  }[],\n): {\n  name: string\n  description: string\n  schemaItems: SchemaItem[]\n}[] => {\n  if (!tools) {\n    return []\n  }\n  return tools.reduce(\n    (all: { name: string; description: string; schemaItems: SchemaItem[] }[], item) => {\n      const toolEntity = item.node.data?.entity as ToolDefinition\n      const toolSchemaEnity = item?.connectedNodes?.find(\n        (node) => node.type === FlowNodeTypeEnum.Schema,\n      )?.data?.entity as Schema\n      if (toolEntity && toolSchemaEnity?.schema_items?.length) {\n        all.push({\n          name: toolEntity.name,\n          description: toolEntity.description,\n          schemaItems: toolSchemaEnity.schema_items,\n        })\n      }\n      return all\n    },\n    [],\n  )\n}\n","import { useReactFlow } from '@xyflow/react'\nimport { useCallback } from 'react'\nimport { FlowNodePlaceholder, FlowNodeTypeEnum } from 'src/services/database/types'\n\nexport const useFlowEmbeddingNode = () => {\n  const { getNodes } = useReactFlow()\n\n  const getFlowEmbeddingNode = useCallback(() => {\n    const embeddingNode = getNodes().find(\n      (node) => node.type === FlowNodeTypeEnum.DefaultEmbeddingModel,\n    )\n    return embeddingNode\n  }, [getNodes])\n\n  const getFlowEmbeddingEntity = useCallback(() => {\n    const embeddingNode = getFlowEmbeddingNode()\n    const embbedingEntity = embeddingNode?.data?.entity as FlowNodePlaceholder\n\n    return embbedingEntity\n  }, [getFlowEmbeddingNode])\n\n  return {\n    getFlowEmbeddingNode,\n    getFlowEmbeddingEntity,\n  }\n}\n","import { Node, useReactFlow } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { PromptTemplate } from '@langchain/core/prompts'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { getRepository } from 'src/services/database'\nimport {\n  CSVData,\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n  JSONData,\n  JSONLData,\n  LLM,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  Prompt,\n  Schema,\n  Thread,\n  VectorDatabase,\n  VectorDatabaseStorageEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport {\n  prepareThreadConnections,\n  threadConversationTraveling,\n} from 'src/utils/thread-conversation-traveling'\nimport { prepareThreadHistory } from 'src/utils/build-message-history'\nimport { AIMessage, BaseMessage, HumanMessage } from '@langchain/core/messages'\nimport { getStorageDataSource } from 'src/utils/vector-storage'\nimport { DefaultNodeData } from 'src/utils/flow-node'\nimport { toLocalLLMToolCallingInput } from 'src/utils/flow-to-local-llm'\nimport { useSessionState } from 'src/states/session'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\nimport { logError } from 'src/utils/logger'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useFlowEmbeddingNode } from 'src/hooks/flows/use-flow-embedding-node'\n\ntype CreateMessageOption = {\n  onMessageUpdate: (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => void\n}\nexport const useCreateMessage = ({\n  getNode,\n  getHandleConnections,\n}: Pick<\n  ReturnType<typeof useReactFlow<Node<DefaultNodeData>>>,\n  'getNode' | 'getHandleConnections'\n>) => {\n  const { t } = useTranslation('create_new_message')\n  const [loading, setLoading] = useState(false)\n\n  const currenSession = useSessionState((state) => state.currentSession)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const { similaritySearchWithScore: similaritySearchWithScoreFunction } = useEmbedding()\n  const { getFlowEmbeddingEntity } = useFlowEmbeddingNode()\n\n  const { stream } = useLLM()\n\n  const insertMessages = useCallback(\n    async ({\n      content,\n      threadId,\n      sourceId,\n      initialX,\n      initialY,\n      initialLLMId,\n    }: {\n      content: string\n      threadId: string\n      sourceId: string\n      initialX: number\n      initialY: number\n      initialLLMId: string\n    }) => {\n      if (!currenSession) {\n        throw new Error('Session is not found')\n      }\n      const humanMessage = await getRepository('Message').save({\n        thread_id: threadId,\n        content,\n        role: MessageRoleEnum.Human,\n        status: MessageStatusEnum.Started,\n        llm_id: initialLLMId,\n        session_id: currenSession.id,\n      })\n      if (!humanMessage) {\n        throw new Error('Failed to save message')\n      }\n\n      const humanMessageNode = await createOrUpdateFlowNode({\n        source_id: humanMessage.id,\n        source_type: 'Message',\n        node_type: FlowNodeTypeEnum.Message,\n        x: initialX,\n        y: initialY + 80,\n      })\n      if (!humanMessageNode) {\n        throw new Error('Failed to save human message node')\n      }\n      await createOrUpdateFlowEdge({\n        source: sourceId,\n        target: humanMessageNode.id,\n      })\n      const aiMessage = await getRepository('Message').save({\n        thread_id: threadId,\n        content: t('initial_ai_message'),\n        role: MessageRoleEnum.AI,\n        status: MessageStatusEnum.Inprogress,\n        llm_id: initialLLMId,\n        parent_message_id: humanMessage.id,\n        session_id: currenSession.id,\n      })\n      if (!aiMessage) {\n        throw new Error('Failed to save message')\n      }\n      const aiMessageNode = await createOrUpdateFlowNode({\n        source_id: aiMessage.id,\n        source_type: 'Message',\n        node_type: FlowNodeTypeEnum.Message,\n        x: initialX,\n        y: initialY + 250,\n      })\n      if (!aiMessageNode) {\n        throw new Error('Failed to save ai message node')\n      }\n      await createOrUpdateFlowEdge({\n        source: humanMessageNode.id,\n        target: aiMessageNode.id,\n      })\n\n      return {\n        aiMessage,\n        humanMessage,\n        aiMessageNode,\n        humanMessageNode,\n      }\n    },\n    [createOrUpdateFlowEdge, createOrUpdateFlowNode, currenSession, t],\n  )\n\n  const handlePlaceholders = useCallback(\n    async (\n      messagesInfo: Awaited<ReturnType<typeof insertMessages>>,\n      threadConnection: ReturnType<typeof prepareThreadConnections>,\n    ): Promise<BaseMessage[]> => {\n      const { placeholders } = threadConnection\n      if (!placeholders?.length) {\n        return []\n      }\n      const injectedMessages: BaseMessage[] = []\n      await Promise.all(\n        placeholders.map(async (item) => {\n          const placeholderRecord = item.node.data?.entity as FlowNodePlaceholder\n          if (!placeholderRecord) {\n            return\n          }\n          switch (placeholderRecord.placeholder_type) {\n            case FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER: {\n              const vectorNode = item.connectedNodes?.find(\n                (node) => node.type === FlowNodeTypeEnum.VectorDatabase,\n              )\n              const vector = vectorNode?.data?.entity as VectorDatabase\n              const prompt = item.connectedNodes?.find(\n                (node) => node.type === FlowNodeTypeEnum.Prompt,\n              )?.data?.entity as Prompt\n              if (!prompt || !vector || !vectorNode) {\n                return\n              }\n\n              const k = placeholderRecord.metadata?.k ? +placeholderRecord.metadata?.k : 1\n              let minimalScore = placeholderRecord.metadata?.minimalScore\n                ? +placeholderRecord.metadata?.minimalScore\n                : undefined\n              if (minimalScore && minimalScore > 1) {\n                minimalScore = minimalScore / 100\n              }\n\n              const documents: Awaited<ReturnType<typeof similaritySearchWithScoreFunction>> = []\n\n              if (vector.storage === VectorDatabaseStorageEnum.DataNode) {\n                const connections = getHandleConnections({\n                  nodeId: vectorNode.id,\n                  type: 'target',\n                })\n                const dataSourceNode = connections\n                  .map((connection) => getNode(connection.source))\n                  .find(\n                    (node) =>\n                      node?.type &&\n                      [FlowNodeTypeEnum.JSONLData, FlowNodeTypeEnum.CSVData].includes(\n                        node?.type as FlowNodeTypeEnum,\n                      ),\n                  )\n                const dataSource = dataSourceNode?.data?.entity as CSVData | JSONData | JSONLData\n                if (!dataSource) {\n                  return\n                }\n                documents.push(\n                  ...((await similaritySearchWithScoreFunction(\n                    getFlowEmbeddingEntity(),\n                    {\n                      database: {\n                        databaseId: vector.id,\n                        dataSourceId: dataSource.id,\n                        dataSourceType: getStorageDataSource(dataSource),\n                      },\n                    },\n                    messagesInfo.humanMessage.content,\n                    k,\n                  )) || []),\n                )\n              } else {\n                documents.push(\n                  ...((await similaritySearchWithScoreFunction(\n                    getFlowEmbeddingEntity(),\n                    {\n                      database: {\n                        databaseId: vector.id,\n                      },\n                    },\n                    messagesInfo.humanMessage.content,\n                    k,\n                  )) || []),\n                )\n              }\n              if (!documents) {\n                return []\n              }\n              const template = new PromptTemplate({\n                template: prompt.content,\n                inputVariables: ['context'],\n              })\n\n              injectedMessages.push(\n                new AIMessage(\n                  await template.format({\n                    context: !minimalScore\n                      ? documents.map(([doc]) => doc.pageContent).join('\\n')\n                      : documents\n                          .filter(([, score]) => score >= minimalScore)\n                          .map(([doc]) => doc.pageContent)\n                          .join('\\n'),\n                  }),\n                ),\n              )\n            }\n          }\n        }),\n      )\n      return injectedMessages\n    },\n    [getFlowEmbeddingEntity, getHandleConnections, getNode, similaritySearchWithScoreFunction],\n  )\n\n  const invokeMessage = useCallback(\n    async (\n      messagesInfo: Awaited<ReturnType<typeof insertMessages>>,\n      threadConnection: ReturnType<typeof prepareThreadConnections>,\n      threadConversionNodes: Node[],\n      { onMessageUpdate }: CreateMessageOption,\n    ) => {\n      const { prompts, tools, schemas, placeholders, llm } = threadConnection\n\n      const llmEntity = llm?.node.data?.entity as LLM\n\n      if (!llmEntity) {\n        throw new Error('LLM is not found')\n      }\n\n      const injectedMessages: BaseMessage[] = []\n\n      if (placeholders?.length) {\n        injectedMessages.push(...(await handlePlaceholders(messagesInfo, threadConnection)))\n      }\n\n      const { history: MessageHistory, systems } = prepareThreadHistory(\n        threadConversionNodes,\n        prompts,\n      )\n      const messages = [\n        ...systems,\n        ...injectedMessages,\n        ...MessageHistory,\n        new HumanMessage(messagesInfo.humanMessage.content),\n      ]\n\n      const schemaEntities = schemas\n        .map((schemaNode) => schemaNode.node.data?.entity as Schema)\n        .filter(Boolean) as Schema[]\n      const response = await stream(llmEntity.provider, messages, {\n        tools: toLocalLLMToolCallingInput(tools),\n        schemas: schemaEntities,\n        llm: llmEntity,\n        onMessageUpdate: ({ content }) => {\n          onMessageUpdate?.({\n            id: messagesInfo.aiMessageNode.id,\n            nodeData: {\n              loading: true,\n              content: content,\n            },\n          })\n        },\n      })\n\n      messagesInfo.aiMessage.content = response?.content || ''\n      messagesInfo.aiMessage.metadata = JSON.stringify({\n        message: response?.lastChunk,\n      })\n      onMessageUpdate?.({\n        id: messagesInfo.aiMessageNode.id,\n        nodeData: {\n          content: response?.content,\n          loading: false,\n          entity: messagesInfo.aiMessage,\n        },\n      })\n      if (messagesInfo.aiMessage.id) {\n        await getRepository('Message').update(messagesInfo.aiMessage.id, {\n          content: response?.content,\n          metadata: JSON.stringify({\n            message: response?.lastChunk,\n          }),\n        })\n      }\n      return response?.content\n    },\n    [handlePlaceholders, stream],\n  )\n\n  const createMessage = useCallback(\n    async (source: Node, content: string, options: CreateMessageOption) => {\n      const { nodes: threadConversionNodes } = threadConversationTraveling(\n        [source.id],\n        [],\n        [],\n        [],\n        {\n          getNode,\n          getHandleConnections,\n        },\n      )\n\n      const threadNode = threadConversionNodes.find((node) => node.type === FlowNodeTypeEnum.Thread)\n      const thread = threadNode?.data.entity as Thread\n      if (!source || !thread || !threadNode) {\n        throw new Error('Source or thread is not found')\n      }\n      const threadConnections = prepareThreadConnections(threadNode, {\n        getNode,\n        getHandleConnections,\n      })\n      if (!threadConnections?.thread) {\n        throw new Error('Thread node is not found')\n      }\n\n      let messagesInfo: Awaited<ReturnType<typeof insertMessages>> | undefined\n      try {\n        setLoading(true)\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        messagesInfo = await insertMessages({\n          content,\n          initialX,\n          initialY,\n          sourceId: source.id,\n          threadId: thread.id,\n          initialLLMId: thread.initial_llm_id,\n        })\n        await invokeMessage(messagesInfo, threadConnections, threadConversionNodes, options)\n        await getRepository('Message').update(`${messagesInfo.aiMessage.id}`, {\n          status: MessageStatusEnum.Success,\n        })\n        messagesInfo.aiMessage.status = MessageStatusEnum.Success\n        options.onMessageUpdate({\n          id: messagesInfo.aiMessageNode.id,\n          nodeData: {\n            entity: messagesInfo.aiMessage,\n            loading: false,\n          },\n        })\n        return true\n      } catch (error) {\n        logError('Create Message', error)\n        if (messagesInfo?.aiMessage) {\n          await getRepository('Message').update(`${messagesInfo.aiMessage.id}`, {\n            status: MessageStatusEnum.Failed,\n            content: t('errors.ai_message_content_failed'),\n          })\n        }\n        if (messagesInfo?.aiMessageNode.id) {\n          options?.onMessageUpdate({\n            id: messagesInfo.aiMessageNode.id,\n            nodeData: {\n              content: t('errors.ai_message_content_failed'),\n              entity: {\n                ...messagesInfo.aiMessage,\n                status: MessageStatusEnum.Failed,\n                content: t('errors.ai_message_content_failed'),\n              },\n              loading: false,\n            },\n          })\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [getHandleConnections, getNode, insertMessages, invokeMessage, t],\n  )\n\n  return {\n    loading,\n    createMessage,\n  }\n}\n","import { useCallback } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport omitBy from 'lodash/omitBy'\nimport isUndefined from 'lodash/isUndefined'\nimport { Node, Connection, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { useCreateMessage } from 'src/hooks/flows/mutations/use-create-message'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport { useFlowState } from 'src/states/flow'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { prepareThreadConnections } from 'src/utils/thread-conversation-traveling'\nimport { DefaultNodeData } from 'src/utils/flow-node'\n\nimport { ThreadNodeProps } from '../type'\n\nexport const useActions = (id: string, data: ThreadNodeProps['data']) => {\n  const node = useInternalNode(id)\n  const { t } = useTranslation('flows')\n  const { getNode, getHandleConnections } = useReactFlow<Node<DefaultNodeData>>()\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { createMessage: createMessageFunction, loading } = useCreateMessage({\n    getNode,\n    getHandleConnections,\n  })\n\n  const onMessageUpdate = useCallback(\n    (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => {\n      if (!info.id) {\n        return\n      }\n      const item = getNode(info.id)\n      if (!item || !info.nodeData) {\n        return\n      }\n      updateNodes([\n        {\n          id: item.id,\n          type: 'replace',\n          item: {\n            ...item,\n            data: {\n              ...item.data,\n              ...omitBy(info.nodeData, isUndefined),\n            },\n          },\n        },\n      ])\n    },\n    [getNode, updateNodes],\n  )\n  const createMessage = useCallback(\n    async (input: string) => {\n      if (node && data.entity) {\n        try {\n          await createMessageFunction(node, input, {\n            onMessageUpdate,\n          })\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('LLM_NOT_LOADED_YET')) {\n            return toast({\n              variant: 'destructive',\n              title: t('thread_node.errors.llm_not_loaded_yet'),\n            })\n          }\n          toast({\n            variant: 'destructive',\n            title: `${error}`,\n          })\n        }\n      }\n    },\n    [node, data.entity, createMessageFunction, onMessageUpdate, t],\n  )\n\n  const getLinkedConnections = useCallback(\n    (id: string) => {\n      const currentNode = getNode(id)\n      if (!currentNode) {\n        return []\n      }\n      const linkedConnections: {\n        node: Node<DefaultNodeData>\n        connections: Connection[]\n        connectedNodes?: Node<DefaultNodeData>[]\n      }[] = []\n      const threadConnections = prepareThreadConnections(currentNode as Node<DefaultNodeData>, {\n        getNode,\n        getHandleConnections,\n      })\n      if (threadConnections.thread) {\n        linkedConnections.push({\n          node: threadConnections.thread.node as Node<DefaultNodeData>,\n          connectedNodes: [],\n          connections: threadConnections.thread.connections,\n        })\n      }\n      if (threadConnections.prompts) {\n        linkedConnections.push(\n          ...threadConnections.prompts.map((item) => {\n            return {\n              node: item.node,\n              connectedNodes: item.connectedNodes,\n              connections: item.connections,\n            }\n          }),\n        )\n      }\n      if (threadConnections.schemas) {\n        linkedConnections.push(\n          ...threadConnections.schemas.map((item) => {\n            return {\n              node: item.node,\n              connectedNodes: [],\n              connections: item.connections,\n            }\n          }),\n        )\n      }\n      if (threadConnections.placeholders) {\n        threadConnections.placeholders.forEach((item) => {\n          const connectedNodes = item.connections\n            .map((connection) => {\n              return getNode(connection.source)\n            })\n            .filter(Boolean) as Node<DefaultNodeData>[]\n          linkedConnections.push({\n            node: item.node,\n            connectedNodes: connectedNodes || [],\n            connections: item.connections,\n          })\n        })\n      }\n      if (threadConnections.llm) {\n        linkedConnections.push(threadConnections.llm)\n      }\n      return linkedConnections\n    },\n    [getHandleConnections, getNode],\n  )\n\n  return { loading, createMessage, getLinkedConnections }\n}\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport {\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.Prompt && target?.type === FlowNodeTypeEnum.Thread) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.LLM &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.Schema &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.ToolDefinition &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.VectorDatabase &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.PlaceHolder &&\n          target?.type === FlowNodeTypeEnum.Thread\n        ) {\n          const sourceEntity = source.data.entity as FlowNodePlaceholder\n          if (\n            sourceEntity.placeholder_type === FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER\n          ) {\n            await createOrUpdateFlowEdge({\n              source: connection.source,\n              target: connection.target,\n              sourceHandle: connection.sourceHandle,\n              targetHandle: connection.targetHandle,\n            })\n            return\n          }\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { Position, useHandleConnections, useReactFlow } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport NewMessageCard from 'src/components/molecules/NewMessageCard'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Card, CardTitle } from 'src/lib/shadcn/ui/card'\nimport {\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n  Prompt,\n  PromptTypeEnum,\n} from 'src/services/database/types'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { ThreadNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const ThreadNode = memo((props: ThreadNodeProps) => {\n  const { id, data, isConnectable } = props\n  const { t } = useTranslation('flows')\n  const [showThread, setShowThread] = useState(false)\n  const connections = useHandleConnections({\n    type: 'source',\n  })\n  const targetConnections = useHandleConnections({\n    type: 'target',\n  })\n  const { getNode } = useReactFlow()\n  const { loading, createMessage, getLinkedConnections } = useActions(id, data)\n\n  useConnectionToHandler(id)\n\n  const handleCreateMessage = useCallback(\n    async (...args: Parameters<typeof createMessage>) => {\n      setShowThread(false)\n      const result = await createMessage(...args)\n      return result\n    },\n    [createMessage],\n  )\n\n  const containMessage = useMemo(() => {\n    return connections.length > 0\n  }, [connections])\n\n  const handleNewThread = useCallback(() => {\n    setShowThread((pre) => !pre)\n  }, [])\n\n  const inner = useMemo(() => {\n    const tags = targetConnections\n      .map((connection, index) => {\n        const source = getNode(connection.source)\n        if (source?.type === FlowNodeTypeEnum.Schema) {\n          return <Badge key={`${index}`}>{t('thread_node.structured_output')}</Badge>\n        } else if (source?.type === FlowNodeTypeEnum.Prompt) {\n          const entity = source.data.entity as Prompt\n          return (\n            <Badge key={`${index}`}>\n              {t(\n                entity.type === PromptTypeEnum.FewShotExample\n                  ? 'thread_node.prompts.few_shot_example'\n                  : `thread_node.prompts.${entity.role.toLowerCase()}`,\n              )}\n            </Badge>\n          )\n        } else if (source?.type === FlowNodeTypeEnum.PlaceHolder) {\n          const entity = source.data.entity as FlowNodePlaceholder\n          if (entity?.placeholder_type === FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER) {\n            return <Badge key={`${index}`}>{t('thread_node.vector_database_retriever')}</Badge>\n          }\n        }\n        return undefined\n      })\n      .filter(Boolean)\n\n    if (props.data.entity && !props.data.entity?.messages?.length && !containMessage) {\n      return (\n        <NewMessageCard\n          disabled={loading}\n          loading={loading}\n          onSubmit={handleCreateMessage}\n          tags={tags}\n        />\n      )\n    }\n\n    if (!tags?.length) {\n      return <div className=\"w-12 h-10\" />\n    }\n\n    return (\n      <Card className=\"p-4 pt-2\">\n        <CardTitle className=\"mb-2\">{t('thread_node.title')}</CardTitle>\n        <div className=\"flex gap-1.5\">{tags}</div>\n        <div className=\"mt-4 w-full flex justify-end\">\n          <Button onClick={handleNewThread} variant=\"outline\">\n            <LazyIcon name={showThread ? 'copy-minus' : 'copy-plus'} />\n            {showThread ? t('thread_node.hide') : t('thread_node.clone')}\n          </Button>\n        </div>\n      </Card>\n    )\n  }, [\n    containMessage,\n    getNode,\n    handleCreateMessage,\n    handleNewThread,\n    loading,\n    props.data.entity,\n    showThread,\n    t,\n    targetConnections,\n  ])\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} enableToStandalone getLinkedConnections={getLinkedConnections} />\n        {inner}\n        {showThread ? (\n          <>\n            <div className=\"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500\" />\n            <div className=\"absolute mt-[30px] w-full\">\n              <div className=\"ml-[10%] w-80 animate-in slide-in-from-bottom-5\">\n                <NewMessageCard\n                  disabled={loading}\n                  loading={loading}\n                  onSubmit={handleCreateMessage}\n                />\n              </div>\n            </div>\n          </>\n        ) : undefined}\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useTranslation } from 'react-i18next'\n\nimport { MessageNodeProps } from '../type'\n\nexport function HumanMessageComponent({\n  data,\n  onNewThread,\n  loading,\n  showThread,\n}: {\n  data: MessageNodeProps['data']\n  onNewThread?: () => void\n  loading?: boolean\n  showThread: boolean\n}) {\n  const { t } = useTranslation('flows')\n  return (\n    <Alert className=\"flex min-w-52\">\n      <LazyIcon size={24} name=\"user\" />\n      <div className=\"ml-2 max-w-full w-full\">\n        <AlertTitle>{`Human`}</AlertTitle>\n        <AlertDescription>{`${data.content || data.entity?.content || ''}`}</AlertDescription>\n        {onNewThread ? (\n          <div className=\"w-full mt-2 flex items-center justify-end\">\n            <Button onClick={onNewThread} disabled={loading} variant=\"outline\">\n              <LazyIcon name={!showThread ? 'plus' : 'minus'} size={16} />\n              {!showThread ? t(`message_node.new_thread`) : t(`message_node.hide_thread`)}\n            </Button>\n          </div>\n        ) : undefined}\n      </div>\n    </Alert>\n  )\n}\n","import { Suspense, useMemo } from 'react'\nimport { Alert, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { cn } from 'src/lib/utils'\nimport { useTranslation } from 'react-i18next'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { BorderBeam } from 'src/lib/shadcn/ui/border-beam'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { MessageStatusEnum } from 'src/services/database/types'\nimport { MarkdownViewer } from 'src/components/molecules/MarkdownViewer'\n\nimport { MessageNodeProps } from '../type'\n\nexport function AIMessageComponent({\n  data,\n  onNewThread,\n  loading,\n  showThread,\n}: {\n  data: MessageNodeProps['data']\n  onNewThread?: () => void\n  loading?: boolean\n  showThread: boolean\n}) {\n  const { t } = useTranslation('flows')\n  const messageMetadata = useMemo<{ message: Record<string, unknown> }>(() => {\n    try {\n      return JSON.parse(data?.entity?.metadata || '{}')\n    } catch {\n      return {}\n    }\n  }, [data?.entity?.metadata])\n\n  const isError = data.entity.status === MessageStatusEnum.Failed\n\n  const content = useMemo(() => {\n    return <MarkdownViewer source={`${data.content || data.entity?.content || ''}`} />\n  }, [data.content, data.entity?.content])\n\n  return (\n    <Alert\n      className={cn('flex min-w-52', isError ? 'bg-background' : '')}\n      variant={isError ? 'destructive' : 'default'}\n    >\n      <LazyIcon\n        className={cn(data.loading ? 'animate-spin' : undefined)}\n        size={24}\n        name={data.loading ? 'loader-circle' : 'bot'}\n      />\n      <LazyIcon name={!showThread ? 'plus' : 'minus'} size={24} />\n      <div className=\"ml-2 w-full max-w-full\">\n        <AlertTitle>\n          {t(`message_node.message_roles.${data.entity?.role?.toLowerCase()}`)}\n        </AlertTitle>\n        <Suspense\n          fallback={\n            <div className=\"h-full w-ful rounded-lg flex justify-center items-center\">\n              <LazyIcon name=\"loader-circle\" className=\"animate-spin\" />\n            </div>\n          }\n        >\n          {isError ? data.content || data.entity?.content || '' : content}\n        </Suspense>\n        {Array.isArray(messageMetadata?.message?.tool_calls) &&\n        messageMetadata?.message?.tool_calls?.length\n          ? messageMetadata?.message?.tool_calls.map((item, index) => {\n              return (\n                <Badge key={`${item.name}_${index}`}>\n                  {t('message_node.tool_call', {\n                    name: item.name,\n                    args: Object.entries(item.args)\n                      .map(([key, value]) => `\"${key}\": \"${value}\"`)\n                      .join(', '),\n                  })}\n                </Badge>\n              )\n            })\n          : null}\n        {onNewThread ? (\n          <div className=\"w-full mt-2 flex items-center justify-end\">\n            <Button onClick={onNewThread} disabled={loading} variant=\"outline\">\n              <LazyIcon name={!showThread ? 'plus' : 'minus'} size={16} />\n              {!showThread ? t(`message_node.new_thread`) : t(`message_node.hide_thread`)}\n            </Button>\n          </div>\n        ) : undefined}\n      </div>\n      {data.loading ? <BorderBeam size={350} duration={10} /> : undefined}\n    </Alert>\n  )\n}\n","import { useCallback } from 'react'\nimport omitBy from 'lodash/omitBy'\nimport isUndefined from 'lodash/isUndefined'\nimport { useTranslation } from 'react-i18next'\nimport { toast } from 'src/lib/hooks/use-toast'\nimport { Node, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { useCreateMessage } from 'src/hooks/flows/mutations/use-create-message'\nimport { useFlowState } from 'src/states/flow'\n\nimport { MessageNodeProps } from '../type'\n\nexport const useActions = (id: string) => {\n  const { t } = useTranslation('flows')\n  const node = useInternalNode(id)\n\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { getNode, getHandleConnections } = useReactFlow<Node<MessageNodeProps['data']>>()\n  const { createMessage: createMessageFunction, loading } = useCreateMessage({\n    getNode,\n    getHandleConnections,\n  })\n\n  const onMessageUpdate = useCallback(\n    (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => {\n      if (!info.id) {\n        return\n      }\n      const item = getNode(info.id)\n      if (!item || !info.nodeData) {\n        return\n      }\n      updateNodes([\n        {\n          id: item.id,\n          type: 'replace',\n          item: {\n            ...item,\n            data: {\n              ...item.data,\n              ...omitBy(info.nodeData, isUndefined),\n            },\n          },\n        },\n      ])\n    },\n    [getNode, updateNodes],\n  )\n\n  const createMessage = useCallback(\n    async (input: string) => {\n      if (node) {\n        try {\n          await createMessageFunction(node, input, {\n            onMessageUpdate,\n          })\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('LLM_NOT_LOADED_YET')) {\n            return toast({\n              variant: 'destructive',\n              title: t('message_node.errors.llm_not_loaded_yet'),\n            })\n          }\n          toast({\n            variant: 'destructive',\n            title: t('message_node.errors.create_message'),\n          })\n        }\n      }\n    },\n    [node, t, createMessageFunction, onMessageUpdate],\n  )\n\n  return {\n    loading,\n    createMessage,\n  }\n}\n","import { Node } from '@xyflow/react'\nimport { useCallback } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodeTypeEnum,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  Prompt,\n  Thread,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateIdieMessage = () => {\n  const currenSession = useSessionState((state) => state.currentSession)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createIdieMessage = useCallback(\n    async (\n      source: Node,\n      thread: Thread,\n      input: string,\n      options?: {\n        promptNode?: Node\n      },\n    ) => {\n      if (!source || !thread || !currenSession) {\n        return\n      }\n      const prompt = options?.promptNode?.data?.entity as Prompt\n      // This is node thead replaced with message node\n      const initialX = source.position?.x || 0\n      const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n      const newMessage = await getRepository('Message').save({\n        thread_id: thread.id,\n        content: input,\n        role: prompt?.role || MessageRoleEnum.Human,\n        status: MessageStatusEnum.Started,\n        llm_id: thread.initial_llm_id,\n        session_id: currenSession.id,\n      })\n      if (!newMessage) {\n        throw new Error('Failed to save message')\n      }\n      const newMessageNode = await createOrUpdateFlowNode({\n        source_id: newMessage.id,\n        source_type: 'Message',\n        node_type: FlowNodeTypeEnum.Message,\n        x: initialX,\n        y: initialY,\n      })\n      if (!newMessageNode) {\n        throw new Error('Failed to save message node')\n      }\n      const edgeToNewMessage = await createOrUpdateFlowEdge({\n        source: source.id,\n        target: newMessageNode.id,\n      })\n      let edgeToPrompt\n      if (options?.promptNode) {\n        edgeToPrompt = await createOrUpdateFlowEdge({\n          source: options?.promptNode.id,\n          target: newMessageNode.id,\n        })\n      }\n      return {\n        message: newMessage,\n        edgeToPrompt,\n        messageNode: newMessageNode,\n        messageEdge: edgeToNewMessage,\n      }\n    },\n    [createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    createIdieMessage,\n  }\n}\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { FlowNodeTypeEnum, Message, Prompt, ThreadStatusEnum } from 'src/services/database/types'\n\nimport { useCreateIdieMessage } from 'src/hooks/flows/mutations/use-create-idie-message'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const { createIdieMessage } = useCreateIdieMessage()\n\n  const connectionHandler = useCallback(\n    async ({ edgeId, source, target }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.Prompt && target?.type === FlowNodeTypeEnum.Message) {\n          const message = target?.data?.entity as Message\n          const prompt = source?.data?.entity as Prompt\n          if (!prompt || !message || !target) {\n            return {\n              deleteEdgeId: edgeId,\n            }\n          }\n          await createIdieMessage(\n            target,\n            {\n              id: message?.thread_id,\n              title: '',\n              status: ThreadStatusEnum.Started,\n              initial_llm_id: message.llm_id,\n              session_id: prompt.session_id,\n            },\n            prompt.content,\n            {\n              promptNode: source,\n            },\n          )\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createIdieMessage],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Position, useHandleConnections } from '@xyflow/react'\nimport NewMessageCard from 'src/components/molecules/NewMessageCard'\nimport { MessageRoleEnum } from 'src/services/database/types'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport textToSpeech from 'src/utils/text-to-speech'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { HumanMessageComponent } from './components/HumanMessage'\nimport { AIMessageComponent } from './components/AIMessage'\nimport { MessageNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const MessageNode = memo((props: MessageNodeProps) => {\n  const { id, data, isConnectable } = props\n  const [showThread, setShowThread] = useState(false)\n  const [speaking, setSpeaking] = useState(false)\n  const { t } = useTranslation('common')\n  const connections = useHandleConnections({\n    type: 'source',\n  })\n  const { loading, createMessage } = useActions(id)\n  const { toast } = useToast()\n\n  useConnectionToHandler(id)\n\n  const handleCreateMessage = useCallback(\n    async (...args: Parameters<typeof createMessage>) => {\n      const result = await createMessage(...args)\n      setShowThread(false)\n      return result\n    },\n    [createMessage],\n  )\n\n  const isEnd = useMemo(() => {\n    return connections.length === 0\n  }, [connections])\n\n  const handleCopy = useCallback(() => {\n    if (!data.entity?.content) {\n      return\n    }\n    navigator.clipboard.writeText(data.entity.content)\n    toast({\n      description: t('copied'),\n    })\n  }, [toast, data, t])\n\n  const handleSpeech = useCallback(async () => {\n    try {\n      if (speaking) {\n        await textToSpeech.stop()\n        return setSpeaking(false)\n      }\n      setSpeaking(true)\n      await textToSpeech.speak(data.entity?.content || '')\n    } catch {\n      toast({\n        variant: 'destructive',\n        description: t('errors.speech_is_not_supported'),\n      })\n    } finally {\n      setSpeaking(false)\n    }\n  }, [data.entity?.content, speaking, t, toast])\n\n  const handleNewThread = useCallback(() => {\n    setShowThread((pre) => !pre)\n  }, [])\n\n  const newMessageCard = useMemo(() => {\n    if (\n      (!isEnd && !showThread) ||\n      data.loading ||\n      loading ||\n      data?.entity?.status === 'inprogress'\n    ) {\n      return undefined\n    }\n    return (\n      <>\n        <div className=\"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500\" />\n        <div className=\"absolute mt-[30px] w-full\">\n          <div className=\"ml-[10%] w-80 animate-in slide-in-from-bottom-5\">\n            <NewMessageCard disabled={loading} loading={loading} onSubmit={handleCreateMessage} />\n          </div>\n        </div>\n      </>\n    )\n  }, [data?.entity?.status, data.loading, handleCreateMessage, isEnd, loading, showThread])\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"max-w-sm min-w-64\">\n        <div className=\"w-auto\">\n          <NodeHeader id={id} />\n          <div>\n            {data.entity?.role === MessageRoleEnum.Human ? (\n              <HumanMessageComponent\n                data={data}\n                showThread={showThread}\n                onNewThread={!isEnd ? handleNewThread : undefined}\n              />\n            ) : (\n              <AIMessageComponent\n                data={data}\n                showThread={showThread}\n                loading={loading}\n                onNewThread={!isEnd ? handleNewThread : undefined}\n              />\n            )}\n          </div>\n          <Button\n            onClick={handleSpeech}\n            className=\"absolute top-0 right-[68px] !px-2 !rounded-none\"\n            variant=\"ghost\"\n          >\n            <LazyIcon name={speaking ? 'circle-stop' : 'speech'} size={16} />\n          </Button>\n          <Button\n            onClick={handleCopy}\n            className=\"absolute top-0 right-[36px] !px-2 !rounded-none\"\n            variant=\"ghost\"\n          >\n            <LazyIcon name=\"copy\" size={16} />\n          </Button>\n        </div>\n        {newMessageCard}\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport {\n  CSVData,\n  FlowNodeTypeEnum,\n  Message,\n  Prompt,\n  PromptTypeEnum,\n  ThreadStatusEnum,\n} from 'src/services/database/types'\nimport { useCreateIdieMessage } from 'src/hooks/flows/mutations/use-create-idie-message'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\nimport { useFlowState } from 'src/states/flow'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const { createIdieMessage } = useCreateIdieMessage()\n\n  const connectionHandler = useCallback(\n    async ({ edgeId, source, target }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        const targetEntity = target?.data?.entity as Prompt\n        const sourceEntity = source?.data?.entity as CSVData\n        if (source?.type === FlowNodeTypeEnum.Message && target?.type === FlowNodeTypeEnum.Prompt) {\n          const message = source?.data?.entity as Message\n          const prompt = target?.data?.entity as Prompt\n          if (!prompt || !message || !target) {\n            return {\n              deleteEdgeId: edgeId,\n            }\n          }\n          await createIdieMessage(\n            source,\n            {\n              id: message?.thread_id,\n              title: '',\n              status: ThreadStatusEnum.Started,\n              initial_llm_id: message.llm_id,\n              session_id: prompt.session_id,\n            },\n            prompt.content,\n            {\n              promptNode: target,\n            },\n          )\n          return\n        } else if (\n          source?.type === FlowNodeTypeEnum.CSVData &&\n          target?.type === FlowNodeTypeEnum.Prompt &&\n          targetEntity?.type === PromptTypeEnum.FewShotExample &&\n          sourceEntity?.headers.includes('input') &&\n          sourceEntity?.headers.includes('output')\n        ) {\n          await createOrUpdateFlowEdge({\n            source: source.id,\n            target: target.id,\n          })\n          return\n        }\n\n        // Need to delete edge\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createIdieMessage, createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useMemo } from 'react'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport { Position } from '@xyflow/react'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport { useModal } from '@ebay/nice-modal-react'\nimport ViewDataDetailDialog from 'src/components/dialogs/ViewDataDetailDialog'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { PromptNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const PromptNode = memo((props: PromptNodeProps) => {\n  const { id, data, isConnectable } = props\n\n  useConnectionToHandler(id)\n\n  const viewDetailDialog = useModal(ViewDataDetailDialog)\n\n  const content = useMemo(() => {\n    return `${data.entity?.prefix ? `${data.entity?.prefix}\\n` : ''}${data.entity?.content || ''}`\n  }, [data.entity?.prefix, data.entity?.content])\n\n  const promptArguments = useMemo(() => {\n    const regex = /{(.*?)}/g\n    const matches = content.match(regex)\n    return matches?.map((match) => match.replace('{', '').replace('}', '')) || []\n  }, [content])\n\n  const isOverLimit = content.length > 990\n\n  const handleOpenDetail = () => {\n    viewDetailDialog.show({ title: 'Prompt', content })\n  }\n\n  return (\n    <div className=\"min-w-56\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} />\n        <Alert className=\"flex justify-center max-w-72\" variant=\"default\">\n          <LazyIcon size={24} name={'notepad-text'} />\n          <div className=\"ml-2 max-w-full break-words break-all\">\n            <AlertTitle>{`${data.entity?.role || ''}`}</AlertTitle>\n            <AlertDescription onClick={isOverLimit ? handleOpenDetail : undefined}>\n              {isOverLimit ? `${content.slice(0, 990)}...` : content}\n              {isOverLimit ? (\n                <span className=\"float-right\">\n                  <LazyIcon name=\"chevron-right\" />\n                </span>\n              ) : undefined}\n            </AlertDescription>\n            {promptArguments?.length\n              ? promptArguments.map((argument, index) => {\n                  return (\n                    <Badge key={index} className=\"mt-2 mr-1\" variant=\"default\">\n                      {argument}\n                    </Badge>\n                  )\n                })\n              : undefined}\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","export const formatBytes = (bytes?: number) => {\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\n  if (bytes === undefined) return 'Unknown size'\n  if (bytes === 0) return '0 Byte'\n  const i = Math.floor(Math.log(bytes) / Math.log(1024))\n  return `${Math.round(bytes / Math.pow(1024, i))} ${sizes[i]}`\n}\n","import dayjs from 'dayjs'\nimport { memo, useCallback, useEffect, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\n// import { Bar, XAxis, CartesianGrid, BarChart } from 'recharts'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport type { ModelRecord } from '@mlc-ai/web-llm'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from 'src/lib/shadcn/ui/card'\n// import {\n//   ChartConfig,\n//   ChartContainer,\n//   ChartTooltip,\n//   ChartTooltipContent,\n// } from 'src/lib/shadcn/ui/chart'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { formatBytes } from 'src/utils/bytes-format'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useLocalLLMState } from 'src/services/local-llm'\nimport { LLMInfo } from 'src/components/atoms/LLMInfo'\n\nexport const SessionInfoNode = memo(() => {\n  const { t } = useTranslation('flows')\n  const [cachedModdels, setCachedModels] =\n    useState<{ model_id: string; info: ModelRecord; isFunctionCalling: boolean }[]>()\n  const cachedLLMURLs = useLocalLLMState((state) => state.cachedLLMURLs)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const [latestUpdate, setLatestUpdate] = useState<Date>()\n  const [usedBytes, setUsedBytes] = useState('')\n  const [, setCountInfo] = useState<\n    [\n      {\n        name: string\n        nodes: number\n        edges: number\n        llms?: number\n        threads?: number\n        prompts?: number\n        schemas?: number\n        tools?: number\n        vectorDatabases?: number\n        jsonlDatas?: number\n        csvDatas?: number\n      },\n    ]\n  >()\n\n  // const chartConfig = useMemo(() => {\n  //   return {\n  //     nodes: {\n  //       label: t('session_info_node.entities.nodes'),\n  //       color: '#2563eb', // Original color\n  //     },\n  //     edges: {\n  //       label: t('session_info_node.entities.edges'),\n  //       color: '#34d399', // New color\n  //     },\n  //     threads: {\n  //       label: t('session_info_node.entities.threads'),\n  //       color: '#fbbf24', // New color\n  //     },\n  //     llms: {\n  //       label: t('session_info_node.entities.llms'),\n  //       color: '#f87171', // New color\n  //     },\n  //     prompts: {\n  //       label: t('session_info_node.entities.prompts'),\n  //       color: '#a78bfa', // New color\n  //     },\n  //     tools: {\n  //       label: t('session_info_node.entities.tools'),\n  //       color: '#ffcccb', // Lighter and more colorful\n  //     },\n  //     schemas: {\n  //       label: t('session_info_node.entities.schemas'),\n  //       color: '#ffb6c1', // Lighter and more colorful\n  //     },\n  //     vectorDatabases: {\n  //       label: t('session_info_node.entities.vector_databases'),\n  //       color: '#ff69b4', // Lighter and more colorful\n  //     },\n  //     jsonlDatas: {\n  //       label: t('session_info_node.entities.jsonl_data'),\n  //       color: '#ff1493', // Lighter and more colorful\n  //     },\n  //     csvDatas: {\n  //       label: t('session_info_node.entities.csv_data'),\n  //       color: '#db7093', // Lighter and more colorful\n  //     },\n  //   } satisfies ChartConfig\n  // }, [t])\n\n  useEffect(() => {\n    import('@mlc-ai/web-llm').then(({ functionCallingModelIds, prebuiltAppConfig }) => {\n      setCachedModels(\n        cachedLLMURLs?.map((url) => {\n          const item = prebuiltAppConfig.model_list.find((model) => url.includes(model.model))\n          if (!item) {\n            return\n          }\n          return {\n            model_id: item?.model_id || '',\n            info: item,\n            isFunctionCalling: functionCallingModelIds.includes(item?.model_id || ''),\n          }\n        }) as { model_id: string; info: ModelRecord; isFunctionCalling: boolean }[],\n      )\n    })\n  }, [cachedLLMURLs, currentSession?.id])\n\n  const fetchSessionInfo = useCallback(async () => {\n    navigator.storage.estimate().then((estimate) => {\n      if (estimate) {\n        setUsedBytes(\n          t('session_info_node.used_bytes', {\n            used: formatBytes(estimate.usage),\n            total: formatBytes(estimate?.quota),\n          }),\n        )\n      }\n    })\n    if (!currentSession?.id) {\n      return\n    }\n\n    Promise.all([\n      getRepository('FlowNode').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('FlowEdge').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('Thread').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('Prompt').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('LLM').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('Schema').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('ToolDefinition').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('VectorDatabase').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('JSONLData').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n      getRepository('CSVData').findOne({\n        where: { session_id: currentSession?.id },\n        order: { updated_at: 'DESC' },\n      }),\n    ]).then((response) => {\n      const maxUpdatedAt = response.reduce(\n        (acc, item) => {\n          if (item?.updated_at && (!acc || new Date(item.updated_at) > acc)) {\n            return new Date(item.updated_at)\n          }\n          return acc\n        },\n        currentSession.updated_at ? new Date(currentSession.updated_at) : undefined,\n      )\n      setLatestUpdate(maxUpdatedAt)\n    })\n\n    Promise.all([\n      getRepository('FlowNode').count({ where: { session_id: currentSession?.id } }),\n      getRepository('FlowEdge').count({ where: { session_id: currentSession?.id } }),\n      getRepository('Thread').count({ where: { session_id: currentSession?.id } }),\n      getRepository('Prompt').count({ where: { session_id: currentSession?.id } }),\n      getRepository('LLM').count({ where: { session_id: currentSession?.id } }),\n      getRepository('ToolDefinition').count({ where: { session_id: currentSession?.id } }),\n      getRepository('Schema').count({ where: { session_id: currentSession?.id } }),\n      getRepository('VectorDatabase').count({ where: { session_id: currentSession?.id } }),\n      getRepository('JSONLData').count({ where: { session_id: currentSession?.id } }),\n      getRepository('CSVData').count({ where: { session_id: currentSession?.id } }),\n    ]).then(\n      ([\n        nodes,\n        edges,\n        threads,\n        prompts,\n        llms,\n        tools,\n        schemas,\n        vectorDatabases,\n        jsonlDatas,\n        csvDatas,\n      ]) => {\n        setCountInfo([\n          {\n            name: t('session_info_node.count_info.title'),\n            nodes: nodes || 0,\n            edges: edges || 0,\n            threads: threads || 0,\n            prompts: prompts || 0,\n            llms: llms || 0,\n            tools: tools || 0,\n            schemas: schemas || 0,\n            vectorDatabases: vectorDatabases || 0,\n            jsonlDatas: jsonlDatas || 0,\n            csvDatas: csvDatas || 0,\n          },\n        ])\n      },\n    )\n  }, [currentSession?.id, currentSession?.updated_at, t])\n\n  const handleReload = useCallback(() => {\n    fetchSessionInfo()\n  }, [fetchSessionInfo])\n\n  useEffect(() => {\n    fetchSessionInfo()\n  }, [fetchSessionInfo])\n  return (\n    <Card className=\"w-96\">\n      <CardHeader>\n        <CardTitle>{t('session_info_node.title')}</CardTitle>\n        <CardDescription>\n          {latestUpdate || currentSession?.updated_at\n            ? dayjs(latestUpdate || currentSession?.updated_at).fromNow()\n            : ''}\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"grid gap-4\">\n        <div className=\"flex items-center space-x-4 rounded-md border p-4\">\n          <div className=\"flex-1 space-y-1\">\n            <p className=\"text-sm font-medium leading-none\">{t('session_info_node.disk_size')}</p>\n            <p className=\"text-sm text-muted-foreground\">{usedBytes}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center space-x-4 rounded-md border p-4\">\n          <div className=\"flex-1 space-y-1\">\n            <div className=\"text-sm font-medium leading-none\">\n              {t('session_info_node.cached_llms')}\n              <Badge className=\"ml-2\">{cachedModdels?.length || 0}</Badge>\n            </div>\n            {cachedModdels?.map((llm) => (\n              <div key={llm?.model_id} className=\"text-sm text-muted-foreground gap-1\">\n                {llm?.model_id}\n                <div className=\"max-w-full gap-1 flex flex-wrap mt-1\">\n                  <LLMInfo\n                    model={llm?.info}\n                    isFunctionCalling={llm?.isFunctionCalling || false}\n                    isCached={true}\n                    cloud={false}\n                  />\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n        <div>\n          {/* Production build failed */}\n          {/* <ChartContainer config={chartConfig} className=\"min-h-28 w-full\">\n            <BarChart accessibilityLayer data={countInfo}>\n              <CartesianGrid vertical={false} />\n              <XAxis dataKey=\"name\" tickLine={false} tickMargin={10} axisLine={false} />\n              <ChartTooltip content={<ChartTooltipContent />} />\n              {Object.entries(chartConfig).map(([key]) => (\n                <Bar key={key} dataKey={key} fill={'#ffb6c1'} radius={4} />\n              ))}\n            </BarChart>\n          </ChartContainer> */}\n        </div>\n      </CardContent>\n      <CardFooter>\n        <Button className=\"w-full\" onClick={handleReload}>\n          <LazyIcon size={24} name={'refresh-ccw'} />\n          {t('session_info_node.reload')}\n        </Button>\n      </CardFooter>\n    </Card>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const connectionHandler = useCallback(\n    async ({ edgeId }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo, useEffect, useRef } from 'react'\nimport { Position, useInternalNode } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport { getRepository } from 'src/services/database'\nimport { useFlowState } from 'src/states/flow'\nimport { convertToTypeScriptInterface, convertToZodSchemaString } from 'src/utils/schema-format'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from 'src/lib/shadcn/ui/tabs'\nimport { Card } from 'src/lib/shadcn/ui/card'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { SchemaNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const SchemaNode = memo((props: SchemaNodeProps) => {\n  const { t } = useTranslation('flows')\n  const { id, data, isConnectable } = props\n  const loadingRef = useRef(false)\n  const node = useInternalNode(id)\n  const updateNodes = useFlowState((state) => state.updateNodes)\n\n  useConnectionToHandler(id)\n\n  useEffect(() => {\n    const schema = data?.entity\n    if (!schema || !node || loadingRef.current || schema?.schema_items?.length || data.loaded)\n      return\n\n    loadingRef.current = true\n    getRepository('SchemaItem')\n      .find({\n        where: {\n          schema_id: schema.id,\n        },\n      })\n      .then((schemaItems) => {\n        updateNodes([\n          {\n            id: node.id,\n            type: 'replace',\n            item: {\n              ...node,\n              data: {\n                ...(node?.data || {}),\n                loaded: true,\n                entity: {\n                  ...data.entity,\n                  schema_items: schemaItems,\n                },\n              },\n            },\n          },\n        ])\n      })\n      .finally(() => {\n        loadingRef.current = false\n      })\n  }, [data.entity, data.loaded, node, updateNodes])\n\n  return (\n    <div>\n      <div>\n        <NodeHeader id={id} />\n        <Tabs defaultValue=\"account\" className=\"w-[400px]\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"account\">{t('schema_node.typescript')}</TabsTrigger>\n            <TabsTrigger value=\"password\">{t('schema_node.zod')}</TabsTrigger>\n          </TabsList>\n          <TabsContent value=\"account\">\n            <Card className=\"p-4\">\n              <pre className=\"overflow-hidden break-words whitespace-pre-wrap\">\n                {convertToTypeScriptInterface(data?.entity?.schema_items || [])}\n              </pre>\n            </Card>\n          </TabsContent>\n          <TabsContent value=\"password\">\n            <Card className=\"p-4 max-w-full\">\n              <pre className=\"overflow-hidden break-words whitespace-pre-wrap\">\n                {convertToZodSchemaString(data?.entity?.schema_items || [])}\n              </pre>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo, useMemo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Card, CardContent, CardHeader } from 'src/lib/shadcn/ui/card'\nimport { decodeLine, decodeSplitter } from 'src/utils/string-data'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { CSVDataNodeProps } from './type'\n\nexport const CSVDataNode = memo((props: CSVDataNodeProps) => {\n  const { id, data, isConnectable } = props\n\n  const csv = useMemo(() => {\n    if (!data?.entity) {\n      return {\n        headers: [],\n        rows: [],\n      }\n    }\n\n    const lines = decodeLine(data.entity.csv)\n\n    return {\n      headers: decodeSplitter(data.entity.headers),\n      rows: lines.map((row) => decodeSplitter(row)),\n    }\n  }, [data?.entity])\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} />\n        <Card className=\"min-w-32 min-h-16 p-4\">\n          <CardHeader className=\"!p-0\">\n            <div className=\"pt-2 flex !flex-row\">\n              <LazyIcon name=\"file-spreadsheet\" className=\"mr-2\" />\n              <Label className=\"!font-medium leading-none tracking-tight pr-8\">\n                {FlowNodeTypeEnum.CSVData} {csv?.rows?.length ? `(${csv?.rows?.length || 0})` : ''}\n              </Label>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pb-0\">\n            <DataViewer data={csv.rows} headers={csv.headers} />\n          </CardContent>\n        </Card>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          source?.type === FlowNodeTypeEnum.Schema &&\n          target?.type === FlowNodeTypeEnum.ToolDefinition\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { ToolNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const ToolNode = memo(({ id, data, isConnectable }: ToolNodeProps) => {\n  useConnectionToHandler(id)\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <Alert className=\"flex justify-center\">\n          <LazyIcon size={24} name=\"wrench\" />\n          <div className=\"ml-2\">\n            <AlertTitle>{`${data.entity?.name || ''}`}</AlertTitle>\n            <AlertDescription>{`${data.entity?.description || ''}`}</AlertDescription>\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport LazyIcon from './LazyIcon'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Popover, PopoverContent, PopoverTrigger } from 'src/lib/shadcn/ui/popover'\nimport { cn } from 'src/lib/utils'\nimport { Alert } from 'src/lib/shadcn/ui/alert'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { LLMProviderEnum } from 'src/services/database/types'\nimport { GOOGLE_GENERATIVE_AI_API_KEY_LINK, OPEN_AI_API_KEY_LINK } from 'src/constants/llm'\nimport { useConfirmPassphrase } from 'src/hooks/mutations/use-confirm-passphrase'\nimport secureSession from 'src/utils/secure-session'\nimport { decryptSymmetric } from 'src/utils/aes'\n\nexport const EmbeddingSetting = memo(\n  (props: {\n    name?: string\n    className?: string\n    encrypted?: Record<string, unknown>\n    options?: Record<string, unknown>\n    supportedProviders?: string[]\n    onChangeOptions?: (\n      options: Record<string, unknown>,\n      encrypted?: Record<string, unknown>,\n    ) => Promise<void>\n  }) => {\n    const [show, setShow] = useState(false)\n    const [options, setOptions] = useState<Record<string, unknown>>({})\n    const [encrypted, setEncrypted] = useState<Record<string, unknown>>({})\n    const { confirmPassphrase } = useConfirmPassphrase()\n    const { t } = useTranslation('atoms')\n\n    const handleOpenChange = async () => {\n      if (!show) {\n        if (Object.keys(props.encrypted || {})?.length) {\n          await confirmPassphrase()\n          const decrypted: Record<string, unknown> = {}\n          const passphrase = await secureSession.get('passphrase')\n          if (!passphrase) {\n            throw new Error('Passphrase is not found')\n          }\n          await Promise.all(\n            Object.keys(props.encrypted || {}).map(async (key) => {\n              if (props.encrypted?.[key]) {\n                decrypted[key] = await decryptSymmetric(\n                  props.encrypted?.[key] as string,\n                  passphrase!,\n                )\n              }\n            }),\n          )\n          setEncrypted(decrypted || {})\n        }\n        setOptions({ ...props.options })\n      } else {\n        setOptions({})\n        setEncrypted({})\n      }\n      setShow(!show)\n    }\n\n    const hanleSubmit = () => {\n      props.onChangeOptions?.(options || {}, encrypted || {})\n      setShow(false)\n    }\n\n    return (\n      <div className={cn('min-w-20 flex justify-end', props.className)}>\n        <Popover open={show} onOpenChange={setShow}>\n          <PopoverTrigger>\n            <div className=\"flex justify-end gap-2 !cursor-pointer\">\n              <Button\n                onClick={handleOpenChange}\n                variant=\"link\"\n                className=\"flex items-center px-0 !cursor-pointer\"\n              >\n                <LazyIcon name=\"settings\" />\n                <Label>{t('embedding_setting.title')}</Label>\n              </Button>\n            </div>\n          </PopoverTrigger>\n          <PopoverContent className=\"w-full p-0\">\n            {show ? (\n              <Card className=\"!border-none max-w-96 min-w-56\">\n                <CardHeader>\n                  <CardTitle>{t('embedding_setting.title')}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <Label>{t('embedding_setting.provider')}:</Label>\n                  <Select\n                    value={options?.provider ? `${options?.provider}` : 'local_transformers'}\n                    onValueChange={(value) => setOptions({ provider: value })}\n                  >\n                    <SelectTrigger className=\"\">\n                      <SelectValue placeholder={t('embedding_setting.provider_placeholder')} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem key=\"local_transformers\" value=\"local_transformers\">\n                        {t('embedding_setting.providers.local_transformers')}\n                      </SelectItem>\n                      {props.supportedProviders?.map((provider) => (\n                        <SelectItem key={provider} value={provider}>\n                          {t(`embedding_setting.providers.${provider.toLowerCase()}`)}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  {!props.supportedProviders?.length ? (\n                    <Label className=\"text-red-500 !pt-2\">\n                      {t('embedding_setting.alerts.no_provider')}\n                    </Label>\n                  ) : undefined}\n                  <>\n                    {options.provider && options.provider !== 'local_transformers' ? (\n                      <>\n                        <Alert variant=\"destructive\" className=\"mt-4\">\n                          {t('embedding_setting.alerts.session_passkey')}\n                        </Alert>\n                        <div className=\"mt-4\">\n                          <Label>{t('embedding_setting.encrypted_fields.api_key')}</Label>\n                          <Button variant=\"link\" className=\"px-1\">\n                            <a\n                              href={\n                                options.provider === LLMProviderEnum.OpenAI\n                                  ? OPEN_AI_API_KEY_LINK\n                                  : GOOGLE_GENERATIVE_AI_API_KEY_LINK\n                              }\n                              target=\"_blank\"\n                              rel=\"noreferrer\"\n                            >\n                              (\n                              {options.provider === LLMProviderEnum.OpenAI\n                                ? OPEN_AI_API_KEY_LINK\n                                : GOOGLE_GENERATIVE_AI_API_KEY_LINK}\n                              )\n                            </a>\n                          </Button>\n                          <Input\n                            type=\"password\"\n                            value={encrypted?.key ? `${encrypted?.key}` : ''}\n                            onChange={(e) =>\n                              setEncrypted((pre) => ({\n                                ...pre,\n                                key: e.target.value,\n                              }))\n                            }\n                          />\n                        </div>\n                      </>\n                    ) : undefined}\n                  </>\n                </CardContent>\n                <CardFooter className=\"flex justify-end\">\n                  <Button variant=\"secondary\" onClick={hanleSubmit}>\n                    {t('embedding_setting.save')}\n                  </Button>\n                </CardFooter>\n              </Card>\n            ) : undefined}\n          </PopoverContent>\n        </Popover>\n      </div>\n    )\n  },\n)\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const connectionHandler = useCallback(\n    async ({ edgeId }: { edgeId: string; source: Node; target: Node }) => {\n      return {\n        deleteEdgeId: edgeId,\n      }\n    },\n    [],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { useCallback, useEffect } from 'react'\nimport { NodeChange, useInternalNode, useNodes, Node } from '@xyflow/react'\nimport {\n  FlowNodePlaceholder,\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\nimport { SYSTEM_NODE_IDS } from 'src/constants/nodes'\nimport secureSession from 'src/utils/secure-session'\nimport { encryptSymmetric } from 'src/utils/aes'\nimport { useConfirmOrCreatePassphrase } from 'src/hooks/mutations/use-confirm-or-create-passphrase'\n\nexport const useActions = (id: string) => {\n  const currentSessionId = useSessionState((state) => state.currentSession?.id)\n  const node = useInternalNode(id)\n  const nodes = useNodes()\n\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { confirmOrCreatePassphrase } = useConfirmOrCreatePassphrase()\n\n  const changeLLMOptions = useCallback(\n    async (input: Record<string, unknown>, inputEncrypted?: Record<string, unknown>) => {\n      if (node && currentSessionId) {\n        let flowNode =\n          id !== SYSTEM_NODE_IDS.DEFAULT_EMBEDDING_MODEL\n            ? await getRepository('FlowNode').findOne({\n                where: { id },\n              })\n            : undefined\n\n        const encrypted: Record<string, unknown> = {}\n        if (Object.keys(inputEncrypted || {})?.length) {\n          await confirmOrCreatePassphrase()\n          const passphrase = await secureSession.get('passphrase')\n          if (!passphrase) {\n            throw new Error('Passphrase is not found')\n          }\n          await Promise.all(\n            Object.keys(inputEncrypted || {}).map(async (key) => {\n              if (inputEncrypted?.[key]) {\n                encrypted[key] = await encryptSymmetric(inputEncrypted[key] as string, passphrase!)\n              }\n            }),\n          )\n        }\n        let flowNodePlaceholder: FlowNodePlaceholder | undefined\n        const changes: NodeChange<Node>[] = []\n        if (!flowNode) {\n          changes.push({ id, type: 'remove' })\n          flowNodePlaceholder = await getRepository('FlowNodePlaceholder').save({\n            placeholder_type: FlowNodePlaceholderTypeEnum.DEFAULT_EMBEDDING_MODEL,\n            encrypted,\n            data: input,\n            session_id: currentSessionId,\n          })\n          flowNode = await getRepository('FlowNode').save({\n            node_type: FlowNodeTypeEnum.DefaultEmbeddingModel,\n            session_id: currentSessionId,\n            source_type: 'FlowNodePlaceholder',\n            source_id: flowNodePlaceholder.id,\n            x: node.position.x,\n            y: node.position.y,\n          })\n          changes.push({ type: 'add', item: node })\n        } else {\n          await getRepository('FlowNodePlaceholder').update(flowNode.source_id, {\n            encrypted,\n            data: input,\n          })\n          flowNodePlaceholder = await getRepository('FlowNodePlaceholder').findOne({\n            where: { id: flowNode.source_id },\n          })\n          changes.push({ id: flowNode.id, type: 'replace', item: node })\n        }\n        node.data.entity = flowNodePlaceholder\n        node.data.flowNode = flowNode\n        updateNodes(changes)\n      }\n    },\n    [confirmOrCreatePassphrase, currentSessionId, id, node, updateNodes],\n  )\n\n  useEffect(() => {\n    if (id !== SYSTEM_NODE_IDS.DEFAULT_EMBEDDING_MODEL) return\n\n    const embeddingNode = nodes.find(\n      (n) =>\n        n.type === FlowNodeTypeEnum.DefaultEmbeddingModel &&\n        n.id !== SYSTEM_NODE_IDS.DEFAULT_EMBEDDING_MODEL,\n    )\n    if (embeddingNode) {\n      updateNodes([{ id, type: 'remove' as const }])\n    }\n  }, [id, nodes, updateNodes])\n\n  return {\n    changeLLMOptions,\n  }\n}\n","import { memo } from 'react'\nimport { Alert, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport { Position } from '@xyflow/react'\nimport LLMIcon from 'src/components/atoms/LLMIcon'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { EmbeddingSetting } from 'src/components/atoms/EmbeddingSetting'\nimport { LLMProviderEnum } from 'src/services/database/types'\nimport { DEFAULT_EMBEDDING_MODEL } from 'src/constants/embedding'\n\nimport { EmbeddingNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useActions } from './hooks/use-actions'\n\nexport const EmbeddingNode = memo((props: EmbeddingNodeProps) => {\n  const { id, data, isConnectable } = props\n  const { changeLLMOptions } = useActions(id)\n\n  useConnectionToHandler(id)\n\n  let model = 'brain'\n  let modelName = DEFAULT_EMBEDDING_MODEL\n  switch (`${data?.entity?.data?.provider}`) {\n    case LLMProviderEnum.OpenAI:\n      model = 'gpt'\n      modelName = 'text-embedding-3-small'\n      break\n    case LLMProviderEnum.GoogleGenerativeAI:\n      model = 'gemma'\n      modelName = 'text-embedding-004'\n      break\n  }\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <Alert className=\"flex justify-center max-w-auto\" variant=\"default\">\n          <LLMIcon name={model} className=\"w-7 h-7\" />\n          <div className=\"ml-2 pr-4 flex justify-center gap-1 flex-col\">\n            <div className=\"min-h-8 flex items-center\">\n              <AlertTitle>{`${modelName || ''}`}</AlertTitle>\n            </div>\n            <EmbeddingSetting\n              supportedProviders={[LLMProviderEnum.OpenAI, LLMProviderEnum.GoogleGenerativeAI]}\n              onChangeOptions={changeLLMOptions}\n              encrypted={data.entity?.encrypted}\n              options={data.entity?.data}\n            />\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { Node } from '@xyflow/react'\nimport type { Document } from '@langchain/core/documents'\nimport { useTranslation } from 'react-i18next'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from 'src/lib/shadcn/ui/dialog'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useCreatePrompt } from 'src/hooks/flows/mutations/use-create-prompt'\nimport { Prompt } from 'src/services/database/types'\nimport PromptForm from 'src/components/molecules/CreatePromptCard/PromptForm'\nimport { useToast } from 'src/lib/hooks/use-toast'\n\nconst DEFAULT_PROMPT = `Use the following pieces of context to answer the question at the end.\nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\nUse three sentences maximum and keep the answer as concise as possible.\n\n{context}\n`\n\ntype CreateVectorDatabasePromptProps = {\n  className: string\n  source: Node\n  documents: Document[]\n}\n\nconst CreateVectorDatabasePromptDialog = create<CreateVectorDatabasePromptProps>((props) => {\n  const { source, documents } = props\n  const currentModal = useModal()\n  const { toast } = useToast()\n  const { t } = useTranslation('dialogs')\n  const { loading, createPrompt } = useCreatePrompt()\n\n  const handleSubmit = async (data: Partial<Prompt>) => {\n    try {\n      if (!data.content || !data.content.includes(`{context}`)) {\n        toast({\n          title: t('create_vector_database_prompt.errors.fill_context'),\n          variant: 'destructive',\n        })\n        return\n      }\n      // NOTE: No need to use Prompt template because it will automatically added role prefix\n      const content = data.content.replace(\n        '{context}',\n        documents.map((doc) => `<document>${doc.pageContent}</document>`).join('\\n'),\n      )\n      await createPrompt(source, {\n        ...data,\n        content,\n      })\n      currentModal.hide()\n      return true\n    } catch {\n      toast({\n        title: t('create_vector_database_prompt.errors.create_failed'),\n        variant: 'destructive',\n      })\n    }\n  }\n\n  return (\n    <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <div className=\"flex\">\n            <LazyIcon name=\"file\" className=\"mr-2 h-4 w-4\" />\n            <DialogTitle>{t('create_vector_database_prompt.title')}</DialogTitle>\n          </div>\n        </DialogHeader>\n        <div className=\"flex gap-4 py-4 flex-col\">\n          <PromptForm\n            onSubmit={handleSubmit}\n            loading={loading}\n            hidePromptType\n            defaultPromptRole=\"system\"\n            defaultPromptContent={DEFAULT_PROMPT}\n          />\n          <div className=\"w-full border-0 text-gray-700 flex text-sm items-center\">\n            <LazyIcon name=\"info\" className=\"mr-2\" size={14} />\n            {t('create_vector_database_prompt.fill_content_note')}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n})\n\nexport default CreateVectorDatabasePromptDialog\n","import { Node } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { getRepository } from 'src/services/database'\nimport {\n  FlowNodePlaceholderTypeEnum,\n  FlowNodeTypeEnum,\n  MessageRoleEnum,\n  MessageStatusEnum,\n  Prompt,\n  PromptTypeEnum,\n  VectorDatabase,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useCreateVectorDatabaseRetriever = () => {\n  const sessionId = useSessionState((state) => state.currentSession?.id)\n\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const createVectorDatabaseRetriever = useCallback(\n    async ({\n      prompt,\n      source,\n      metadata,\n    }: {\n      source: Node\n      prompt?: Partial<Prompt>\n      metadata?: Record<string, unknown>\n    }) => {\n      try {\n        const vectorDatabase = source?.data?.entity as VectorDatabase\n        if (!vectorDatabase || !sessionId) {\n          throw new Error('Source or Session not found')\n        }\n        setLoading(true)\n        const initialX = source.position?.x || 0\n        const initialY = (source.position?.y || 0) + (source.measured?.height || 0)\n\n        const systempPrompt = await getRepository('Prompt').save({\n          ...prompt,\n          status: prompt?.status || MessageStatusEnum.Started,\n          role: prompt?.role || MessageRoleEnum.System,\n          type: prompt?.type || PromptTypeEnum.Chat,\n          content: prompt?.content || '{context}',\n          session_id: sessionId,\n        })\n        if (!systempPrompt) {\n          throw new Error('Failed to save prompt')\n        }\n        const systemPromptNode = await createOrUpdateFlowNode({\n          source_id: systempPrompt.id,\n          source_type: 'Prompt',\n          node_type: FlowNodeTypeEnum.Prompt,\n          x: initialX,\n          y: initialY + 20,\n        })\n        if (!systemPromptNode) {\n          throw new Error('Failed to save prompt node')\n        }\n        const retriever = await getRepository('FlowNodePlaceholder').save({\n          placeholder: `Retriever for ${vectorDatabase.name}`,\n          placeholder_type: FlowNodePlaceholderTypeEnum.VECTOR_DATABASE_RETREIVER,\n          session_id: sessionId,\n          metadata,\n        })\n        if (!retriever) {\n          throw new Error('Failed to save node placeholder')\n        }\n        const retrieverNode = await createOrUpdateFlowNode({\n          source_id: retriever.id,\n          source_type: 'FlowNodePlaceholder',\n          node_type: FlowNodeTypeEnum.PlaceHolder,\n          x: initialX,\n          y: initialY + 40,\n        })\n        if (!retrieverNode) {\n          throw new Error('Failed to save node placeholder node')\n        }\n        await createOrUpdateFlowEdge({\n          source: systemPromptNode.id,\n          target: retrieverNode.id,\n        })\n        await createOrUpdateFlowEdge({\n          source: source.id,\n          target: retrieverNode.id,\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [sessionId, createOrUpdateFlowNode, createOrUpdateFlowEdge],\n  )\n\n  return {\n    loading,\n    createVectorDatabaseRetriever,\n  }\n}\n","import { create, useModal } from '@ebay/nice-modal-react'\nimport { Node } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from 'src/lib/shadcn/ui/dialog'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Prompt } from 'src/services/database/types'\nimport PromptForm from 'src/components/molecules/CreatePromptCard/PromptForm'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { useCreateVectorDatabaseRetriever } from 'src/hooks/flows/mutations/use-create-vector-database-retriever'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { Input } from 'src/lib/shadcn/ui/input'\nimport { useState } from 'react'\n\nconst DEFAULT_PROMPT = `Use the following pieces of context to answer the question at the end.\nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}\n`\n\ntype CreateVectorDatabaseRetrieverDialogProps = {\n  className: string\n  source: Node\n}\n\nconst CreateVectorDatabaseRetrieverDialog = create<CreateVectorDatabaseRetrieverDialogProps>(\n  (props) => {\n    const { source } = props\n    const currentModal = useModal()\n    const { toast } = useToast()\n    const { t } = useTranslation('dialogs')\n    const [k, setK] = useState<number | undefined>(1)\n    const [minimalScore, setMinimalScore] = useState<number | undefined>(undefined)\n    const { loading, createVectorDatabaseRetriever } = useCreateVectorDatabaseRetriever()\n\n    const handleSubmit = async (data: Partial<Prompt>) => {\n      try {\n        const content = data.content\n        if (!content || !content.includes(`{context}`)) {\n          toast({\n            title: t('create_vector_database_retriever.errors.fill_context'),\n            variant: 'destructive',\n          })\n          return\n        }\n        await createVectorDatabaseRetriever({\n          source,\n          prompt: {\n            content: content,\n          },\n          metadata: {\n            k,\n            minimalScore,\n          },\n        })\n        setK(1)\n        setMinimalScore(undefined)\n        currentModal.hide()\n        return true\n      } catch {\n        toast({\n          title: t('create_vector_database_retriever.errors.create_failed'),\n          variant: 'destructive',\n        })\n      }\n    }\n\n    const handleOnChangeK = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setK(e.target.value ? Number(e.target.value) : undefined)\n    }\n\n    const handleOnChangeMinimalScore = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setMinimalScore(e.target.value ? Number(e.target.value) : undefined)\n    }\n\n    return (\n      <Dialog open={currentModal.visible} onOpenChange={currentModal.hide}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <div className=\"flex\">\n              <LazyIcon name=\"file\" className=\"mr-2 h-4 w-4\" />\n              <DialogTitle>{t('create_vector_database_retriever.title')}</DialogTitle>\n            </div>\n          </DialogHeader>\n          <div className=\"flex gap-4 py-4 flex-col\">\n            <PromptForm\n              onSubmit={handleSubmit}\n              loading={loading}\n              hidePromptType\n              defaultPromptRole=\"system\"\n              defaultPromptContent={DEFAULT_PROMPT}\n            />\n            <Card>\n              <CardHeader>\n                <CardTitle>{t('create_vector_database_retriever.retriever_settings')}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Label>{t('create_vector_database_retriever.retriever_k')}</Label>\n                <Input\n                  value={k || ''}\n                  type=\"number\"\n                  onChange={handleOnChangeK}\n                  placeholder={t('create_vector_database_retriever.retriever_k_placeholder')}\n                />\n                <Label>{t('create_vector_database_retriever.retriever_minimum_score')}</Label>\n                <Input\n                  value={minimalScore || ''}\n                  type=\"number\"\n                  onChange={handleOnChangeMinimalScore}\n                  placeholder={t(\n                    'create_vector_database_retriever.retriever_minimum_score_placeholder',\n                  )}\n                />\n              </CardContent>\n            </Card>\n            <div className=\"w-full border-0 text-gray-700 flex text-sm items-center\">\n              <LazyIcon name=\"info\" className=\"mr-2\" size={14} />\n              {t('create_vector_database_retriever.fill_content_note')}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    )\n  },\n)\n\nexport default CreateVectorDatabaseRetrieverDialog\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\nimport { useFlowState } from 'src/states/flow'\nimport { CSVData, FlowNodeTypeEnum, VectorDatabase } from 'src/services/database/types'\nimport { decodeCSVData } from 'src/utils/string-data'\nimport { Document } from '@langchain/core/documents'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useFlowEmbeddingNode } from 'src/hooks/flows/use-flow-embedding-node'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n  const { getFlowEmbeddingEntity } = useFlowEmbeddingNode()\n  const { index: indexFunction } = useEmbedding()\n\n  const connectionHandler = useCallback(\n    async ({ edgeId, target, source }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        const targetEntity = target?.data?.entity as VectorDatabase\n        if (\n          source?.type === FlowNodeTypeEnum.CSVData &&\n          target?.type === FlowNodeTypeEnum.VectorDatabase\n        ) {\n          const csvData = source?.data?.entity as CSVData\n          if (!csvData || !targetEntity) {\n            return {\n              deleteEdgeId: edgeId,\n            }\n          }\n          const { rows } = decodeCSVData(csvData.headers, csvData.csv)\n          const documents = rows.map(\n            (row) =>\n              new Document({\n                pageContent: `${row.text}`,\n              }),\n          )\n          await indexFunction(\n            getFlowEmbeddingEntity(),\n            {\n              database: {\n                databaseId: targetEntity.id,\n                dataSourceId: csvData.id,\n                dataSourceType: 'CSVData',\n              },\n            },\n            documents,\n          )\n          await createOrUpdateFlowEdge({\n            source: source.id,\n            target: target.id,\n          })\n          return\n        }\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge, getFlowEmbeddingEntity, indexFunction],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { Document } from '@langchain/core/documents'\nimport chunk from 'lodash/chunk'\nimport { useReactFlow } from '@xyflow/react'\nimport { useCallback, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { getRepository } from 'src/services/database'\nimport type { VectorDatabase } from 'src/services/database/types'\nimport {\n  FlowNodeTypeEnum,\n  CSVData,\n  JSONData,\n  JSONLData,\n  VectorDatabaseStorageEnum,\n} from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { getStorageDataSource } from 'src/utils/vector-storage'\nimport { useEmbedding } from 'src/hooks/mutations/use-embedding'\nimport { useFlowEmbeddingNode } from 'src/hooks/flows/use-flow-embedding-node'\n\nexport const useActions = (id: string) => {\n  const [loading, setLoading] = useState(false)\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n\n  const { getNode, getHandleConnections } = useReactFlow()\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const { getFlowEmbeddingEntity } = useFlowEmbeddingNode()\n  const { index: indexFunction, similaritySearchWithScore: similaritySearchWithScoreFunction } =\n    useEmbedding()\n  const similaritySearchWithScore = useCallback(\n    async (input: string, options?: { k?: number }) => {\n      try {\n        const vectorDatabaseNode = getNode(id)\n        if (!vectorDatabaseNode) {\n          return\n        }\n        const entity = vectorDatabaseNode.data?.entity as VectorDatabase\n        if (!entity) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n        const embbedingEntity = getFlowEmbeddingEntity()\n        if (entity.storage === VectorDatabaseStorageEnum.DataNode) {\n          const connections = getHandleConnections({\n            nodeId: id,\n            type: 'target',\n          })\n          const dataSourceNode = connections\n            .map((connection) => getNode(connection.source))\n            .find(\n              (node) =>\n                node?.type &&\n                [FlowNodeTypeEnum.JSONLData, FlowNodeTypeEnum.CSVData].includes(\n                  node?.type as FlowNodeTypeEnum,\n                ),\n            )\n          const dataSource = dataSourceNode?.data?.entity as CSVData | JSONData | JSONLData\n          if (!dataSource) {\n            toast({\n              variant: 'destructive',\n              title: t('vector_database_node.errors.data_node_not_found'),\n            })\n            return\n          }\n          setLoading(true)\n          const result = await similaritySearchWithScoreFunction(\n            embbedingEntity,\n            {\n              database: {\n                databaseId: entity.id,\n                dataSourceId: dataSource.id,\n                dataSourceType: getStorageDataSource(dataSource),\n              },\n            },\n            input,\n            options?.k,\n          )\n          return result\n        } else {\n          setLoading(true)\n          const result = await similaritySearchWithScoreFunction(\n            embbedingEntity,\n            {\n              database: {\n                databaseId: entity.id,\n              },\n            },\n            input,\n            options?.k,\n          )\n          return result\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [\n      getNode,\n      id,\n      getFlowEmbeddingEntity,\n      toast,\n      t,\n      getHandleConnections,\n      similaritySearchWithScoreFunction,\n    ],\n  )\n\n  const indexData = useCallback(\n    async (\n      data: { id?: string; content?: string; documents?: Document[] },\n      options?: {\n        onProgressReport?: (info: { total: number; handled: number; handling: number }) => void\n      },\n    ) => {\n      try {\n        const vectorDatabaseNode = getNode(id)\n        if (!vectorDatabaseNode) {\n          return\n        }\n        setLoading(true)\n        const documents = data.content\n          ? [\n              new Document({\n                pageContent: data.content,\n                id: data.id,\n                metadata: {\n                  id: data.id,\n                },\n              }),\n            ]\n          : data.documents\n\n        if (!documents?.length) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.content_not_found'),\n          })\n          return\n        }\n\n        const entity = vectorDatabaseNode.data?.entity as VectorDatabase\n        if (!entity || !vectorDatabaseNode) {\n          toast({\n            variant: 'destructive',\n            title: t('vector_database_node.errors.vector_database_not_found'),\n          })\n          return\n        }\n\n        const embbedingEntity = getFlowEmbeddingEntity()\n\n        if (entity.storage === VectorDatabaseStorageEnum.DataNode) {\n          const connections = getHandleConnections({\n            nodeId: id,\n            type: 'target',\n          })\n          const dataSourceNode = connections\n            .map((connection) => getNode(connection.source))\n            .find(\n              (node) =>\n                node?.type &&\n                [FlowNodeTypeEnum.JSONLData, FlowNodeTypeEnum.CSVData].includes(\n                  node?.type as FlowNodeTypeEnum,\n                ),\n            )\n\n          const dataSource = dataSourceNode?.data?.entity as CSVData | JSONData | JSONLData\n          if (!dataSource) {\n            toast({\n              variant: 'destructive',\n              title: t('vector_database_node.errors.data_node_not_found'),\n            })\n            return\n          }\n          const dataSourceType = getStorageDataSource(dataSource)\n\n          const chunkedDocuments = chunk(documents, 10)\n          let handledCount = 0\n\n          for (const partDocuments of chunkedDocuments) {\n            options?.onProgressReport?.({\n              handling: partDocuments.length,\n              handled: handledCount,\n              total: documents.length,\n            })\n            await indexFunction(\n              embbedingEntity,\n              {\n                database: {\n                  databaseId: entity.id,\n                  dataSourceId: dataSource.id,\n                  dataSourceType,\n                },\n              },\n              partDocuments,\n            )\n            if (dataSourceType && dataSourceNode) {\n              const updatedDataNode = await getRepository(dataSourceType).findOne({\n                where: { id: dataSource.id },\n              })\n              updateNodes([\n                {\n                  type: 'replace',\n                  id: dataSourceNode.id,\n                  item: {\n                    ...dataSourceNode,\n                    data: {\n                      ...dataSourceNode.data,\n                      entity: updatedDataNode,\n                    },\n                  },\n                },\n              ])\n            }\n            handledCount += partDocuments.length\n          }\n        } else {\n          // DEFAULT OPTION IS INDEXING AND STORED DIRECTLY TO VECTOR DATABASE ENTITY\n          const chunkedDocuments = chunk(documents, 10)\n          let handledCount = 0\n\n          for (const partDocuments of chunkedDocuments) {\n            options?.onProgressReport?.({\n              handling: partDocuments.length,\n              handled: handledCount,\n              total: documents.length,\n            })\n            await indexFunction(\n              embbedingEntity,\n              {\n                database: {\n                  databaseId: entity.id,\n                },\n              },\n              partDocuments,\n            )\n            const updatedDataNode = await getRepository('VectorDatabase').findOne({\n              where: { id: `${entity.id}` },\n            })\n            updateNodes([\n              {\n                type: 'replace',\n                id: vectorDatabaseNode.id,\n                item: {\n                  ...vectorDatabaseNode,\n                  data: {\n                    ...vectorDatabaseNode.data,\n                    entity: updatedDataNode,\n                  },\n                },\n              },\n            ])\n            handledCount += partDocuments.length\n          }\n        }\n      } catch {\n        toast({\n          variant: 'destructive',\n          title: t('vector_database_node.errors.similarity_search_failed'),\n        })\n      } finally {\n        setLoading(false)\n      }\n    },\n    [\n      getNode,\n      id,\n      getFlowEmbeddingEntity,\n      toast,\n      t,\n      getHandleConnections,\n      indexFunction,\n      updateNodes,\n    ],\n  )\n\n  return {\n    loading,\n    indexData,\n    similaritySearchWithScore,\n  }\n}\n","import { memo, useCallback, useMemo, useState } from 'react'\nimport { Alert, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport type { Document } from '@langchain/core/documents'\nimport { Position, useInternalNode } from '@xyflow/react'\nimport { WebPDFLoader } from '@langchain/community/document_loaders/web/pdf'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { useTranslation } from 'react-i18next'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from 'src/lib/shadcn/ui/tabs'\nimport { useModal } from '@ebay/nice-modal-react'\nimport CreatePromptDialog from 'src/components/dialogs/CreateVectorDatabasePromptDialog'\nimport CreateRetrieverDialog from 'src/components/dialogs/CreateVectorDatabaseRetrieverDialog'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { VectorDatabaseStorageEnum } from 'src/services/database/types'\nimport { cn } from 'src/lib/utils'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { decodeLine } from 'src/utils/string-data'\n\nimport { VectorDatabaseNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useActions } from './hooks/use-actions'\nimport { VectorSearch } from './components/VectorSearch'\nimport IndexNewText from './components/IndexNewText'\nimport IndexNewFile from './components/IndexNewFile'\n\nexport const VectorDatabaseNode = memo((props: VectorDatabaseNodeProps) => {\n  const { t } = useTranslation('flows')\n  const [progress, setProgress] = useState(0)\n  const [mode, setMode] = useState('search')\n  const node = useInternalNode(props.id)\n  const { id, data, isConnectable } = props\n  const { loading, similaritySearchWithScore, indexData } = useActions(id)\n\n  const createPromptDialog = useModal(CreatePromptDialog)\n  const createRetrieverDialog = useModal(CreateRetrieverDialog)\n\n  useConnectionToHandler(id)\n\n  const handleCreateData = useCallback(\n    async (...args: Parameters<typeof indexData>) => {\n      if (node) {\n        await indexData(...args)\n      }\n    },\n    [indexData, node],\n  )\n\n  const handleSimilaritySearch = useCallback(\n    async (value: string, k?: number) => {\n      const input = value.trim()\n      const documents = await similaritySearchWithScore(input, { k })\n      if (!documents?.length) {\n        return\n      }\n      return documents\n    },\n    [similaritySearchWithScore],\n  )\n\n  const handleCreatePrompt = useCallback(\n    (content: [Document, number][]) => {\n      createPromptDialog.show({\n        source: node,\n        documents: content.map(([doc]) => doc),\n      })\n    },\n    [createPromptDialog, node],\n  )\n\n  const handleCreateRetriever = useCallback(async () => {\n    createRetrieverDialog.show({\n      source: node,\n    })\n  }, [createRetrieverDialog, node])\n\n  const handleIndexPDF = useCallback(\n    async (file: File) => {\n      if (file.type.includes('text') || file.type.includes('txt')) {\n        const reader = new FileReader()\n        reader.onload = async (e) => {\n          const content = e.target?.result as string\n          await handleCreateData({ content })\n        }\n        reader.readAsText(file)\n      } else if (file.type.endsWith('pdf')) {\n        // File to blob\n        const blob = new Blob([file], { type: 'application/pdf' })\n        const customBuildLoader = new WebPDFLoader(blob, {\n          // you may need to add `.then(m => m.default)` to the end of the import\n          pdfjs: async () => {\n            const pdfjs = await import('pdfjs-dist/legacy/build/pdf.min.mjs')\n            await import('pdfjs-dist/legacy/build/pdf.worker.min.mjs')\n            pdfjs.GlobalWorkerOptions.workerSrc = new URL(\n              'pdfjs-dist/build/pdf.worker.min.js',\n              import.meta.url,\n            ).toString()\n            return pdfjs\n          },\n          parsedItemSeparator: ' ',\n        })\n        const documents = await customBuildLoader.load()\n        await handleCreateData(\n          { documents },\n          {\n            onProgressReport: (info) => {\n              setProgress((info.handled + info.handling) / info.total)\n            },\n          },\n        )\n      }\n    },\n    [handleCreateData],\n  )\n\n  const vectorDatabaseData = useMemo(() => {\n    if (!data?.entity?.raw) {\n      return {\n        headers: [],\n        rows: [],\n      }\n    }\n\n    const headers = ['content', 'embedding', 'metadata']\n    const lines = decodeLine(data?.entity?.raw)\n    return {\n      headers,\n      rows: lines.map((row) => {\n        try {\n          const data = JSON.parse(row)\n          return data\n        } catch {\n          return []\n        }\n      }),\n    }\n  }, [data?.entity?.raw])\n\n  const renderContent = useMemo(() => {\n    switch (mode) {\n      case 'search':\n        return (\n          <TabsContent value=\"search\">\n            <VectorSearch\n              loading={loading}\n              onSimilaritySearch={handleSimilaritySearch}\n              onCreatePrompt={handleCreatePrompt}\n              onCreateRetriever={handleCreateRetriever}\n            />\n          </TabsContent>\n        )\n      case 'new':\n        return (\n          <TabsContent className=\"min-w-80\" value=\"new\">\n            <IndexNewText loading={loading} onCreateData={handleCreateData} />\n          </TabsContent>\n        )\n      case 'file':\n        return (\n          <TabsContent value=\"file\">\n            <IndexNewFile\n              loading={loading}\n              progress={progress}\n              onFileSubmit={handleIndexPDF}\n              fileOptions={{ accept: '.pdf,.txt,.text', maxSize: 15 }}\n            />\n          </TabsContent>\n        )\n      case 'view': {\n        return (\n          <TabsContent value=\"view\">\n            <DataViewer\n              data={vectorDatabaseData.rows}\n              headers={vectorDatabaseData.headers}\n              limitLengthByColumns={{\n                embedding: 32,\n              }}\n            />\n          </TabsContent>\n        )\n      }\n    }\n  }, [\n    handleCreateData,\n    handleCreatePrompt,\n    handleCreateRetriever,\n    handleIndexPDF,\n    handleSimilaritySearch,\n    loading,\n    mode,\n    progress,\n    vectorDatabaseData,\n  ])\n\n  return (\n    <div className=\"min-w-72\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"max-w-full\">\n        <NodeHeader id={id} />\n        <Alert className=\"flex justify-center\" variant=\"default\">\n          <LazyIcon size={24} name={'database-zap'} />\n          <div className=\"ml-2 max-w-full\">\n            <AlertTitle>{`${data.entity?.name || ''}`}</AlertTitle>\n            <Tabs\n              value={mode}\n              onValueChange={setMode}\n              defaultValue=\"search\"\n              className={cn('w-full mt-4')}\n            >\n              <TabsList\n                className={cn(\n                  'grid w-full grid-cols-3',\n                  data.entity?.storage === VectorDatabaseStorageEnum.DatabaseNode\n                    ? 'grid-cols-4'\n                    : 'grid-cols-3',\n                )}\n              >\n                <TabsTrigger value=\"search\">{t('vector_database_node.search')}</TabsTrigger>\n                <TabsTrigger value=\"new\">{t('vector_database_node.text')}</TabsTrigger>\n                <TabsTrigger value=\"file\">{t('vector_database_node.file')}</TabsTrigger>\n                {data.entity?.storage === VectorDatabaseStorageEnum.DatabaseNode ? (\n                  <TabsTrigger value=\"view\">{t('vector_database_node.view')}</TabsTrigger>\n                ) : undefined}\n              </TabsList>\n              {renderContent}\n            </Tabs>\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { memo, useMemo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { Card, CardContent, CardHeader } from 'src/lib/shadcn/ui/card'\nimport { decodeLine, decodeSplitter } from 'src/utils/string-data'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { DataViewer } from 'src/components/molecules/Nodes/DataViewer'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { JSONLDataNodeProps } from './type'\n\nconst LIMIT_LENGTH_BY_COLUMNS = {\n  embedding: 32,\n}\nexport const JSONLDataNode = memo((props: JSONLDataNodeProps) => {\n  const { id, data, isConnectable } = props\n\n  const jsonl = useMemo(() => {\n    if (!data?.entity?.jsonl) {\n      return {\n        headers: [],\n        rows: [],\n      }\n    }\n\n    const headers = decodeSplitter(data.entity.headers || '')\n    const lines = decodeLine(data.entity.jsonl)\n    return {\n      headers,\n      rows: lines.map((row) => {\n        try {\n          const data = JSON.parse(row)\n          return data\n        } catch {\n          return []\n        }\n      }),\n    }\n  }, [data?.entity?.jsonl, data.entity.headers])\n\n  return (\n    <div className=\"min-w-80\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div>\n        <NodeHeader id={id} />\n        <Card className=\"min-w-32 min-h-16 p-4\">\n          <CardHeader className=\"!p-0\">\n            <div className=\"pt-2 flex !flex-row\">\n              <LazyIcon name=\"file-json\" className=\"mr-2\" />\n              <Label className=\"!font-medium leading-none tracking-tight pr-8\">\n                {FlowNodeTypeEnum.JSONLData}{' '}\n                {jsonl?.rows?.length ? `(${jsonl?.rows?.length || 0})` : ''}\n              </Label>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pb-0\">\n            <DataViewer\n              data={jsonl.rows}\n              headers={jsonl.headers}\n              limitLengthByColumns={LIMIT_LENGTH_BY_COLUMNS}\n            />\n          </CardContent>\n        </Card>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","'use client'\n\nimport React, { PropsWithChildren, useRef } from 'react'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport { motion, MotionValue, useMotionValue, useSpring, useTransform } from 'framer-motion'\n\nimport { cn } from 'src/lib/utils'\n\nexport interface DockProps extends VariantProps<typeof dockVariants> {\n  className?: string\n  magnification?: number\n  distance?: number\n  direction?: 'top' | 'middle' | 'bottom'\n  children: React.ReactNode\n}\n\nconst DEFAULT_MAGNIFICATION = 60\nconst DEFAULT_DISTANCE = 140\n\nconst dockVariants = cva(\n  'supports-backdrop-blur:bg-white/10 supports-backdrop-blur:dark:bg-black/10 mx-auto flex h-[58px] w-max gap-2 rounded-lg border p-2 backdrop-blur-md',\n)\n\nconst Dock = React.forwardRef<HTMLDivElement, DockProps>(\n  (\n    {\n      className,\n      children,\n      magnification = DEFAULT_MAGNIFICATION,\n      distance = DEFAULT_DISTANCE,\n      direction = 'bottom',\n      ...props\n    },\n    ref,\n  ) => {\n    const mouseX = useMotionValue(Infinity)\n\n    const renderChildren = () => {\n      return React.Children.map(children, (child) => {\n        if (React.isValidElement(child) && child.type === DockIcon) {\n          return React.cloneElement(child, {\n            ...child.props,\n            mouseX: mouseX,\n            magnification: magnification,\n            distance: distance,\n          })\n        }\n        return child\n      })\n    }\n\n    return (\n      <motion.div\n        ref={ref}\n        onMouseMove={(e) => mouseX.set(e.pageX)}\n        onMouseLeave={() => mouseX.set(Infinity)}\n        {...props}\n        className={cn(dockVariants({ className }), {\n          'items-start': direction === 'top',\n          'items-center': direction === 'middle',\n          'items-end': direction === 'bottom',\n        })}\n      >\n        {renderChildren()}\n      </motion.div>\n    )\n  },\n)\n\nDock.displayName = 'Dock'\n\nexport interface DockIconProps {\n  size?: number\n  magnification?: number\n  distance?: number\n  mouseX?: MotionValue<number>\n  className?: string\n  children?: React.ReactNode\n  props?: PropsWithChildren\n}\n\nconst DockIcon = ({\n  magnification = DEFAULT_MAGNIFICATION,\n  distance = DEFAULT_DISTANCE,\n  mouseX,\n  className,\n  children,\n  ...props\n}: DockIconProps) => {\n  const ref = useRef<HTMLDivElement>(null)\n\n  const distanceCalc = useTransform(mouseX || new MotionValue(0), (val: number) => {\n    const bounds = ref.current?.getBoundingClientRect() ?? { x: 0, width: 0 }\n\n    return val - bounds.x - bounds.width / 2\n  })\n\n  const widthSync = useTransform(distanceCalc, [-distance, 0, distance], [40, magnification, 40])\n\n  const width = useSpring(widthSync, {\n    mass: 0.1,\n    stiffness: 150,\n    damping: 12,\n  })\n\n  return (\n    <motion.div\n      ref={ref}\n      style={{ width }}\n      className={cn(\n        'flex aspect-square cursor-pointer items-center justify-center rounded-full',\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </motion.div>\n  )\n}\n\nDockIcon.displayName = 'DockIcon'\n\nexport { Dock, DockIcon, dockVariants }\n","import { FlowNodeTypeEnum } from 'src/services/database/types'\n\nexport const DEFAULT_NODE_SIZE: Partial<{\n  [key in FlowNodeTypeEnum]: { width: number; height: number }\n}> = {\n  [FlowNodeTypeEnum.Shape]: { width: 100, height: 100 },\n  [FlowNodeTypeEnum.CircleShape]: { width: 100, height: 100 },\n  [FlowNodeTypeEnum.TriangleShape]: { width: 100, height: 100 },\n  [FlowNodeTypeEnum.EditorApp]: { width: 1240, height: 400 },\n}\n","import { useCallback, useState } from 'react'\nimport { useInternalNode } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { getRepository } from 'src/services/database'\nimport { useSessionState } from 'src/states/session'\n\nimport { DEFAULT_NODE_SIZE } from '../constants'\n\nexport const useActions = (id: string) => {\n  const node = useInternalNode(id)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const [loading, setLoading] = useState(false)\n  const createOrUpdateFlowNode = useFlowState((state) => state.createOrUpdateFlowNode)\n\n  const createNode = useCallback(\n    async (nodeType: FlowNodeTypeEnum) => {\n      try {\n        setLoading(true)\n        if (node && currentSession?.id) {\n          const initialX = node.position?.x || 0\n          const initialY = (node.position?.y || 0) + (node.measured?.height || 0)\n\n          const nodeData = await getRepository('FlowNodeData').save({\n            data: {},\n            session_id: currentSession.id,\n          })\n\n          if (!nodeData) {\n            throw new Error('Failed to save node data')\n          }\n\n          const newNode = await createOrUpdateFlowNode({\n            node_type: nodeType,\n            data: {},\n            source_id: nodeData.id,\n            source_type: 'FlowNodeData',\n            x: initialX,\n            y: initialY + 20,\n            ...(DEFAULT_NODE_SIZE[nodeType] || {}),\n          })\n          if (!newNode) {\n            throw new Error('Failed to save node')\n          }\n        }\n      } finally {\n        setLoading(false)\n      }\n    },\n    [createOrUpdateFlowNode, currentSession?.id, node],\n  )\n\n  return {\n    loading,\n    createNode,\n  }\n}\n","import { memo } from 'react'\n\nimport { Separator } from 'src/lib/shadcn/ui/separator'\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from 'src/lib/shadcn/ui/tooltip'\nimport { Dock, DockIcon } from 'src/lib/shadcn/ui/dock'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { useTranslation } from 'react-i18next'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { NodeProps } from '@xyflow/react'\nimport VisualStudioCodeSvg from 'src/assets/svgs/visual-studio-code.svg?react'\nimport plateEditorIcon from 'src/assets/images/plate-editor.png'\nimport { useToast } from 'src/lib/hooks/use-toast'\n\nimport { useActions } from './hooks/use-actions'\n\nconst DATA = {\n  applications: [\n    {\n      key: FlowNodeTypeEnum.EditorApp,\n      image: plateEditorIcon,\n      label: 'application_bar.editor',\n    },\n    {\n      key: FlowNodeTypeEnum.VSLiteApp,\n      icon: VisualStudioCodeSvg,\n      label: 'application_bar.vslite',\n    },\n  ],\n  shapes: [\n    { key: FlowNodeTypeEnum.Shape, icon: 'square' as const, label: 'application_bar.square' },\n    { key: FlowNodeTypeEnum.CircleShape, icon: 'circle' as const, label: 'application_bar.circle' },\n    {\n      key: FlowNodeTypeEnum.TriangleShape,\n      icon: 'triangle' as const,\n      label: 'application_bar.triangle',\n    },\n  ],\n}\n\nexport const ApplicationBarNode = memo((props: NodeProps) => {\n  const { t } = useTranslation('flows')\n  const { toast } = useToast()\n  const { loading, createNode } = useActions(props.id)\n  const handleAddNode = async (nodeType: FlowNodeTypeEnum) => {\n    try {\n      if (loading) {\n        return\n      }\n      await createNode(nodeType)\n    } catch {\n      toast({\n        description: t('application_bar.errors.add_node_failed'),\n        variant: 'destructive',\n      })\n    }\n  }\n  return (\n    <TooltipProvider>\n      <Dock direction=\"middle\">\n        {DATA.applications.map((item) => {\n          const Icon = item.icon\n          return (\n            <DockIcon key={item.label}>\n              <Tooltip>\n                <TooltipTrigger>\n                  {Icon ? (\n                    <Icon width={20} height={20} onClick={() => handleAddNode(item.key)} />\n                  ) : undefined}\n                  {item.image ? (\n                    <img\n                      src={item.image}\n                      alt={t(item.label)}\n                      className=\"w-8 h-8 rounded-md\"\n                      onClick={() => handleAddNode(item.key)}\n                    />\n                  ) : undefined}\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>{t(item.label)}</p>\n                </TooltipContent>\n              </Tooltip>\n            </DockIcon>\n          )\n        })}\n        <Separator orientation=\"vertical\" className=\"h-full\" />\n        {DATA.shapes.map((item) => (\n          <DockIcon key={item.label}>\n            <Tooltip>\n              <TooltipTrigger>\n                <LazyIcon onClick={() => handleAddNode(item.key)} name={item.icon} />\n              </TooltipTrigger>\n              <TooltipContent>\n                <p>{t(item.label)}</p>\n              </TooltipContent>\n            </Tooltip>\n          </DockIcon>\n        ))}\n      </Dock>\n    </TooltipProvider>\n  )\n})\n","import { memo } from 'react'\nimport { NodeResizer, NodeResizerProps } from '@xyflow/react'\nimport { cn } from 'src/lib/utils'\n\nexport const DefaultNodeResizer = memo((props: NodeResizerProps) => {\n  const { lineClassName, handleClassName, ...rest } = props\n  return (\n    <NodeResizer\n      lineClassName={cn('!border-1.5', lineClassName)}\n      handleClassName={cn('!w-2 !h-2 !border-2 !rounded-full', handleClassName)}\n      {...rest}\n    />\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          [FlowNodeTypeEnum.CircleShape, FlowNodeTypeEnum.TriangleShape].includes(\n            source?.type as FlowNodeTypeEnum,\n          ) &&\n          target?.type === FlowNodeTypeEnum.Shape\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position, NodeProps } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const ShapeNode = memo((props: NodeProps) => {\n  const { id, selected, isConnectable } = props\n  useConnectionToHandler(id)\n  return (\n    <>\n      <DefaultNodeResizer isVisible={!!selected} minWidth={40} minHeight={40} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"min-w-10 min-h-10 w-full h-full bg-border border\">\n        <NodeHeader id={id} />\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          [FlowNodeTypeEnum.Shape, FlowNodeTypeEnum.TriangleShape].includes(\n            source?.type as FlowNodeTypeEnum,\n          ) &&\n          target?.type === FlowNodeTypeEnum.CircleShape\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position, NodeProps } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const CircleNode = memo((props: NodeProps) => {\n  const { id, selected, isConnectable } = props\n  useConnectionToHandler(id)\n  return (\n    <>\n      <DefaultNodeResizer isVisible={!!selected} minWidth={40} minHeight={40} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"min-w-10 min-h-10 w-full h-full bg-border rounded-full border\">\n        <NodeHeader id={id} />\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (\n          [FlowNodeTypeEnum.CircleShape, FlowNodeTypeEnum.Shape].includes(\n            source?.type as FlowNodeTypeEnum,\n          ) &&\n          target?.type === FlowNodeTypeEnum.TriangleShape\n        ) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position, NodeProps } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\n\nexport const TriangleNode = memo((props: NodeProps) => {\n  const { id, selected, width, height, isConnectable } = props\n  useConnectionToHandler(id)\n  return (\n    <>\n      <DefaultNodeResizer isVisible={!!selected} minWidth={40} minHeight={40} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div\n        className=\"w-0 h-0 border-l-transparent border-r-transparent border-b-border\"\n        style={{\n          borderLeftWidth: (width || 0) / 2,\n          borderRightWidth: (width || 0) / 2,\n          borderBottomWidth: height || 0,\n        }}\n      />\n      <NodeHeader id={id} className=\"absolute top-0 right-0\" />\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.LLM && target?.type === FlowNodeTypeEnum.EditorApp) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { useCallback, useRef } from 'react'\nimport { HumanMessage, type BaseMessage } from '@langchain/core/messages'\nimport { Connection, useInternalNode, useReactFlow } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport { useToast } from 'src/lib/hooks/use-toast'\nimport { FlowNodeTypeEnum, LLM, LLMStatusEnum } from 'src/services/database/types'\nimport { useTranslation } from 'react-i18next'\nimport { DefaultNode } from 'src/utils/flow-node'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\n\nexport const useActions = (id: string) => {\n  const node = useInternalNode(id)\n  const { t } = useTranslation('flows')\n  const refDebounce = useRef<number | null>(null)\n  const { toast } = useToast()\n  const { getNode, getHandleConnections } = useReactFlow()\n  const { stream } = useLLM()\n\n  const updateEditorContent = useCallback(\n    async (value: unknown[]) => {\n      if (!node) return\n      clearTimeout(refDebounce.current!)\n      refDebounce.current = setTimeout(async () => {\n        await getRepository('FlowNode').update(node.id, {\n          data: value,\n        })\n      }, 150) as unknown as number\n    },\n    [node],\n  )\n\n  const createMessage = useCallback(\n    async (input: string | BaseMessage[], onMessageUpdate: (chunk: string) => void) => {\n      if (node) {\n        const connections = getHandleConnections({\n          nodeId: id,\n          type: 'target',\n        })\n        const llmConnection = connections.find((connection) => {\n          const currentNode = getNode(connection.source)\n          return currentNode?.type === FlowNodeTypeEnum.LLM\n        })\n        const llmNode = llmConnection ? getNode(llmConnection?.source as string) : undefined\n        const llm = llmNode?.data?.entity as LLM\n        if (!llmNode || !llm) {\n          return toast({\n            variant: 'destructive',\n            description: t('editor_node.errors.llm_not_found'),\n          })\n        } else if (llmNode.data.status !== LLMStatusEnum.Loaded) {\n          return toast({\n            variant: 'destructive',\n            description: t('editor_node.errors.llm_not_loaded_yet'),\n          })\n        }\n        try {\n          const streamResponse = await stream(\n            llm.provider,\n            typeof input === 'string' ? [new HumanMessage(input)] : input,\n            {\n              onMessageUpdate: (data) => {\n                onMessageUpdate?.(data.content)\n              },\n              llm,\n            },\n          )\n          return streamResponse?.content\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('LLM_NOT_LOADED_YET')) {\n            return toast({\n              title: t('editor_node.errors.llm_not_loaded_yet'),\n            })\n          }\n          toast({\n            variant: 'destructive',\n            title: t('editor_node.errors.stream_message_failed'),\n          })\n        }\n      }\n    },\n    [node, getHandleConnections, id, getNode, toast, t, stream],\n  )\n\n  const getLinkedConnections = useCallback(\n    (id: string) => {\n      const currentNode = getNode(id)\n      if (!currentNode) {\n        return []\n      }\n      const linkedConnections: {\n        node: DefaultNode\n        connections: Connection[]\n        connectedNodes?: DefaultNode[]\n      }[] = []\n      const connections = getHandleConnections({\n        nodeId: id,\n        type: 'target',\n      })\n      connections.forEach((connection) => {\n        const node = getNode(connection.source)\n        if (!node || node.type !== FlowNodeTypeEnum.LLM) {\n          return\n        }\n        linkedConnections.push({\n          node: node as DefaultNode,\n          connections: [connection],\n        })\n      })\n      return linkedConnections\n    },\n    [getHandleConnections, getNode],\n  )\n\n  return {\n    createMessage,\n    updateEditorContent,\n    getLinkedConnections,\n  }\n}\n","import { lazy, memo, Suspense, useCallback } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { DefaultNodeResizer } from 'src/components/flows/DefaultNodeResizer'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useActions } from './hooks/use-actions'\nimport { EditorAppNodeProps } from './type'\n\nconst PlateAppEditor = lazy(() => import('src/components/organisms/PlateEditor'))\n\nexport const EditorAppNode = memo((props: EditorAppNodeProps) => {\n  const { id, data, selected, isConnectable } = props\n  useConnectionToHandler(id)\n  const { createMessage, updateEditorContent, getLinkedConnections } = useActions(id)\n\n  const handleChangeContent = useCallback(\n    (value: unknown[]) => {\n      updateEditorContent(value)\n    },\n    [updateEditorContent],\n  )\n\n  return (\n    <div className=\"w-full min-w-[1240px] h-full\">\n      <DefaultNodeResizer isVisible={!!selected} minWidth={1240} minHeight={400} />\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"min-w-10 min-h-10 w-full h-full rounded-lg border bg-background\">\n        <NodeHeader\n          className=\"!z-[100]\"\n          id={id}\n          enableToStandalone\n          getLinkedConnections={getLinkedConnections}\n        />\n        <Suspense\n          fallback={\n            <div className=\"h-full w-ful rounded-lg flex justify-center items-center\">\n              <LazyIcon name=\"loader-circle\" className=\"animate-spin\" />\n            </div>\n          }\n        >\n          <div className=\"h-full w-ful rounded-lg\" data-registry=\"plate\">\n            <PlateAppEditor\n              defaultValue={data?.flowNode?.data}\n              onValueChange={handleChangeContent}\n              copilotStream={createMessage}\n            />\n          </div>\n        </Suspense>\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </div>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const connectionHandler = useCallback(\n    async ({ edgeId }: { edgeId: string; source: Node; target: Node; connection: Connection }) => {\n      try {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { memo } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport { Badge } from 'src/lib/shadcn/ui/badge'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\n\nimport { PlaceholderNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { useTranslation } from 'react-i18next'\n\nexport const PlaceholderNode = memo((props: PlaceholderNodeProps) => {\n  const { id, data, isConnectable } = props\n  const { t } = useTranslation('flows')\n\n  useConnectionToHandler(id)\n\n  let placeholder = ''\n  switch (data.entity?.placeholder_type) {\n    case 'VECTOR_DATABASE_RETREIVER':\n      placeholder = t('placeholder_node.vector_database_retriever')\n      break\n  }\n\n  return (\n    <div>\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <Alert className=\"flex justify-center max-w-80\" variant=\"default\">\n        <NodeHeader id={id} />\n        <LazyIcon name={'land-plot'} className=\"w-7 h-7\" />\n        <div className=\"ml-2 pr-4\">\n          <AlertTitle>{`${data.entity?.placeholder || ''}`}</AlertTitle>\n          <AlertDescription>\n            {placeholder ? <Badge>{placeholder}</Badge> : undefined}\n          </AlertDescription>\n        </div>\n      </Alert>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import type { FileSystemTree } from '@webcontainer/api'\n\nexport const SOURCE_BASES = [\n  'empty-source',\n  'vite-vue',\n  'shadcn-react-vite',\n  'todo-app-react-vite',\n  'porfolio-nextjs',\n] as const\n\nexport const getSourceBase = async (sourceBase: string): Promise<FileSystemTree> => {\n  switch (sourceBase) {\n    case 'empty-source':\n      return import('./empty-source').then((module) => module.BASE)\n    case 'vite-vue':\n      return import('./vite-vue').then((module) => module.BASE)\n    case 'shadcn-react-vite':\n      return import('./shadcn-react-vite').then((module) => module.BASE)\n    case 'todo-app-react-vite':\n      return import('./todo-app-react-vite').then((module) => module.BASE)\n    case 'porfolio-nextjs':\n      return import('./porfolio-nextjs').then((module) => module.BASE)\n    default:\n      throw new Error(`Unknown source base: ${sourceBase}`)\n  }\n}\n","import { memo, useState } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from 'src/lib/shadcn/ui/card'\nimport { useTranslation } from 'react-i18next'\n\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from 'src/lib/shadcn/ui/select'\nimport { Button } from 'src/lib/shadcn/ui/button'\nimport { getSourceBase, SOURCE_BASES } from 'src/services/web-container/source-bases'\nimport { cn } from 'src/lib/utils'\n\nconst CreateSourcebaseCard = memo(\n  ({\n    className,\n    onUpdateSourceBase,\n  }: {\n    className?: string\n    onUpdateSourceBase: (data: Awaited<ReturnType<typeof getSourceBase>>) => void\n  }) => {\n    const { t } = useTranslation('components')\n    const [sourcebase, setSourcebase] = useState<string>()\n    return (\n      <Card className={cn('mw-full', className)}>\n        <CardHeader className=\"p-4\">\n          <CardTitle>{t('add_source_base.title')}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-center w-full h-full flex-col\">\n            <Select onValueChange={(value) => setSourcebase(value)}>\n              <SelectTrigger className=\"w-full mb-4\">\n                <SelectValue placeholder={t('add_source_base.source_base_select_placeholder')} />\n              </SelectTrigger>\n              <SelectContent>\n                {SOURCE_BASES.map((key) => {\n                  return (\n                    <SelectItem key={`${key}`} value={`${key}`}>\n                      {t(`add_source_base.sourcebases.${key.toLowerCase()}`)}\n                    </SelectItem>\n                  )\n                })}\n              </SelectContent>\n            </Select>\n            <Button\n              className=\"w-full\"\n              onClick={async () =>\n                sourcebase && onUpdateSourceBase(await getSourceBase(sourcebase))\n              }\n            >\n              {t('add_source_base.update_source')}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    )\n  },\n)\n\nexport default CreateSourcebaseCard\n","import { useCallback } from 'react'\nimport { Connection, useReactFlow } from '@xyflow/react'\nimport { getRepository } from 'src/services/database'\nimport type { FileSystemTree } from '@webcontainer/api'\nimport { parseFileSystemTreeToJSONL } from 'src/services/web-container/utils/file-tree'\nimport { DefaultNode } from 'src/utils/flow-node'\nimport { FlowNodeTypeEnum, LLMProviderEnum } from 'src/services/database/types'\nimport { AIMessage, HumanMessage, SystemMessage } from '@langchain/core/messages'\nimport { Message } from 'ai/react'\nimport { MessageNodeProps } from 'src/components/flows/Nodes/MessageNode/type'\nimport { useLLM } from 'src/hooks/mutations/use-llm'\n\ntype CreateMessageOption = {\n  onMessageUpdate?: (info: { id?: string; nodeData: Partial<MessageNodeProps['data']> }) => void\n  onResponseMessageCreate?: (message?: string) => void\n}\nexport const useActions = () => {\n  const { getNode, getHandleConnections } = useReactFlow()\n  const { stream } = useLLM()\n\n  const updateCodeContainerData = useCallback(async (id: string, data: FileSystemTree) => {\n    await getRepository('FlowNode').update(id, {\n      raw: parseFileSystemTreeToJSONL(data),\n    })\n  }, [])\n\n  const getLinkedConnections = useCallback(\n    (id: string) => {\n      const currentNode = getNode(id)\n      if (!currentNode) {\n        return []\n      }\n      const linkedConnections: {\n        node: DefaultNode\n        connections: Connection[]\n        connectedNodes?: DefaultNode[]\n      }[] = []\n      const connections = getHandleConnections({\n        nodeId: id,\n        type: 'target',\n      })\n      connections.forEach((connection) => {\n        const node = getNode(connection.source)\n        if (!node || node.type !== FlowNodeTypeEnum.LLM) {\n          return\n        }\n        linkedConnections.push({\n          node: node as DefaultNode,\n          connections: [connection],\n        })\n      })\n      return linkedConnections\n    },\n    [getHandleConnections, getNode],\n  )\n\n  const sendMessage = useCallback(\n    async (\n      message: string,\n      messages: Message[],\n      { onMessageUpdate, onResponseMessageCreate }: CreateMessageOption = {},\n    ) => {\n      const formatedMessages = messages.map((message) => {\n        if (message.role === 'system') {\n          return new SystemMessage(message.content)\n        }\n        if (message.role === 'user') {\n          return new HumanMessage(message.content)\n        }\n        return new AIMessage(message.content)\n      })\n\n      onResponseMessageCreate?.()\n\n      const response = await stream(\n        LLMProviderEnum.WebLLM,\n        [...formatedMessages, new HumanMessage(message)],\n        {\n          onMessageUpdate: ({ content }) => {\n            onMessageUpdate?.({\n              nodeData: {\n                loading: true,\n                content: content,\n              },\n            })\n          },\n          llm: undefined,\n        },\n      )\n\n      onMessageUpdate?.({\n        nodeData: {\n          loading: false,\n          content: response?.content,\n        },\n      })\n      return response?.content\n    },\n    [stream],\n  )\n\n  return {\n    sendMessage,\n    getLinkedConnections,\n    updateCodeContainerData,\n  }\n}\n","import { useCallback } from 'react'\nimport { Node, Connection } from '@xyflow/react'\nimport { FlowNodeTypeEnum } from 'src/services/database/types'\nimport { useFlowState } from 'src/states/flow'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const createOrUpdateFlowEdge = useFlowState((state) => state.createOrUpdateFlowEdge)\n\n  const connectionHandler = useCallback(\n    async ({\n      edgeId,\n      source,\n      target,\n      connection,\n    }: {\n      edgeId: string\n      source: Node\n      target: Node\n      connection: Connection\n    }) => {\n      try {\n        if (source?.type === FlowNodeTypeEnum.LLM && target?.type === FlowNodeTypeEnum.VSLiteApp) {\n          await createOrUpdateFlowEdge({\n            source: connection.source,\n            target: connection.target,\n            sourceHandle: connection.sourceHandle,\n            targetHandle: connection.targetHandle,\n          })\n          return\n        }\n\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [createOrUpdateFlowEdge],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { lazy, memo, Suspense, useCallback, useState } from 'react'\nimport { Position } from '@xyflow/react'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport {\n  FileSystemTreeChange,\n  parseJSONLToFileSystemTree,\n  updateFileSystemTree,\n} from 'src/services/web-container/utils/file-tree'\nimport CreateSourcebaseCard from 'src/components/molecules/CreateSourcebaseCard'\nimport type { FileSystemTree } from '@webcontainer/api'\n\nimport { EditorAppNodeProps } from './type'\nimport { useActions } from './hooks/use-actions'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { Message } from 'ai/react'\n\nconst VSLiteApp = lazy(() => import('src/lib/vslite/index'))\n\nexport const VSLiteAppNode = memo((props: EditorAppNodeProps) => {\n  const { id, isConnectable, data } = props\n  const [fileSystemTree, setFileSystemTree] = useState(\n    data?.flowNode?.raw ? parseJSONLToFileSystemTree(data.flowNode.raw) : undefined,\n  )\n  const { updateCodeContainerData, getLinkedConnections, sendMessage } = useActions()\n  useConnectionToHandler(id)\n\n  const handleUpdateCodeContainerData = useCallback(\n    async (tree: FileSystemTree) => {\n      if (!data?.flowNode?.id) return\n\n      await updateCodeContainerData(data?.flowNode?.id, tree)\n      setFileSystemTree(tree)\n    },\n    [data?.flowNode?.id, updateCodeContainerData],\n  )\n\n  const handleSendMessage = useCallback(\n    async (message: string, messages: Message[]) => {\n      if (!data?.flowNode?.id) return\n\n      const result = await sendMessage(message, messages)\n      return result\n    },\n    [data?.flowNode?.id, sendMessage],\n  )\n\n  const handleUpdateCodeContainerFile = useCallback(\n    async (changes: FileSystemTreeChange[]) => {\n      setFileSystemTree((prev) => {\n        const result = updateFileSystemTree(prev || {}, changes)\n        updateCodeContainerData(data?.flowNode?.id, result)\n        return result\n      })\n    },\n    [data?.flowNode?.id, updateCodeContainerData],\n  )\n\n  if (!fileSystemTree) {\n    return (\n      <div className=\"h-full flex justify-center items-center\">\n        <CreateSourcebaseCard className=\"w-64\" onUpdateSourceBase={handleUpdateCodeContainerData} />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"w-[1380px] h-[600px] rounded-lg border overflow-hidden shadow-sm\">\n      <DefaultHandle type=\"target\" position={Position.Top} isConnectable={isConnectable} />\n      <div className=\"w-full h-full rounded-lg border bg-card overflow-hidden\">\n        <NodeHeader\n          id={id}\n          className=\"z-50\"\n          enableToStandalone\n          getLinkedConnections={getLinkedConnections}\n        />\n        <Suspense\n          fallback={\n            <div className=\"h-full w-full flex justify-center items-center\">\n              <LazyIcon name=\"loader-circle\" className=\"animate-spin\" />\n            </div>\n          }\n        >\n          <VSLiteApp\n            fileSystemTree={fileSystemTree}\n            onUpdateFileContent={handleUpdateCodeContainerFile}\n            sendMessage={handleSendMessage}\n          />\n        </Suspense>\n      </div>\n      <DefaultHandle type=\"source\" position={Position.Bottom} isConnectable={isConnectable} />\n    </div>\n  )\n})\n","import { useCallback } from 'react'\nimport { Node } from '@xyflow/react'\nimport { useBaseConnectionToHandler } from 'src/hooks/flows/handlers/use-base-connection-to-handler'\n\nexport const useConnectionToHandler = (id: string) => {\n  const connectionHandler = useCallback(\n    async ({ edgeId }: { edgeId: string; source: Node; target: Node }) => {\n      try {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      } catch {\n        return {\n          deleteEdgeId: edgeId,\n        }\n      }\n    },\n    [],\n  )\n\n  useBaseConnectionToHandler(id, connectionHandler)\n}\n","import { parseSchema } from \"./parseSchema.js\";\nexport const parseAnyOf = (schema, refs) => {\n    return schema.anyOf.length\n        ? schema.anyOf.length === 1\n            ? parseSchema(schema.anyOf[0], {\n                ...refs,\n                path: [...refs.path, \"anyOf\", 0],\n            })\n            : `z.union([${schema.anyOf\n                .map((schema, i) => parseSchema(schema, { ...refs, path: [...refs.path, \"anyOf\", i] }))\n                .join(\", \")}])`\n        : `z.any()`;\n};\n","export const parseBoolean = (_schema) => {\n    return \"z.boolean()\";\n};\n","export const parseDefault = (_schema) => {\n    return \"z.any()\";\n};\n","import { parseSchema } from \"./parseSchema.js\";\nexport const parseMultipleType = (schema, refs) => {\n    return `z.union([${schema.type\n        .map((type) => parseSchema({ ...schema, type }, { ...refs, withoutDefaults: true }))\n        .join(\", \")}])`;\n};\n","import { parseSchema } from \"./parseSchema.js\";\nexport const parseNot = (schema, refs) => {\n    return `z.any().refine((value) => !${parseSchema(schema.not, {\n        ...refs,\n        path: [...refs.path, \"not\"],\n    })}.safeParse(value).success, \"Invalid input: Should NOT be valid against schema\")`;\n};\n","export const parseNull = (_schema) => {\n    return \"z.null()\";\n};\n","export const half = (arr) => {\n    return [arr.slice(0, arr.length / 2), arr.slice(arr.length / 2)];\n};\n","import { parseSchema } from \"./parseSchema.js\";\nimport { half } from \"../utils/half.js\";\nconst originalIndex = Symbol(\"Original index\");\nconst ensureOriginalIndex = (arr) => {\n    let newArr = [];\n    for (let i = 0; i < arr.length; i++) {\n        const item = arr[i];\n        if (typeof item === \"boolean\") {\n            newArr.push(item ? { [originalIndex]: i } : { [originalIndex]: i, not: {} });\n        }\n        else if (originalIndex in item) {\n            return arr;\n        }\n        else {\n            newArr.push({ ...item, [originalIndex]: i });\n        }\n    }\n    return newArr;\n};\nexport function parseAllOf(schema, refs) {\n    if (schema.allOf.length === 0) {\n        return \"z.never()\";\n    }\n    else if (schema.allOf.length === 1) {\n        const item = schema.allOf[0];\n        return parseSchema(item, {\n            ...refs,\n            path: [...refs.path, \"allOf\", item[originalIndex]],\n        });\n    }\n    else {\n        const [left, right] = half(ensureOriginalIndex(schema.allOf));\n        return `z.intersection(${parseAllOf({ allOf: left }, refs)}, ${parseAllOf({\n            allOf: right,\n        }, refs)})`;\n    }\n}\n","export function withMessage(schema, key, get) {\n    const value = schema[key];\n    let r = \"\";\n    if (value !== undefined) {\n        const got = get({ value, json: JSON.stringify(value) });\n        if (got) {\n            const opener = got[0];\n            const prefix = got.length === 3 ? got[1] : \"\";\n            const closer = got.length === 3 ? got[2] : got[1];\n            r += opener;\n            if (schema.errorMessage?.[key] !== undefined) {\n                r += prefix + JSON.stringify(schema.errorMessage[key]);\n            }\n            r;\n            r += closer;\n        }\n    }\n    return r;\n}\n","import { withMessage } from \"../utils/withMessage.js\";\nimport { parseSchema } from \"./parseSchema.js\";\nexport const parseArray = (schema, refs) => {\n    if (Array.isArray(schema.items)) {\n        return `z.tuple([${schema.items.map((v, i) => parseSchema(v, { ...refs, path: [...refs.path, \"items\", i] }))}])`;\n    }\n    let r = !schema.items\n        ? \"z.array(z.any())\"\n        : `z.array(${parseSchema(schema.items, {\n            ...refs,\n            path: [...refs.path, \"items\"],\n        })})`;\n    r += withMessage(schema, \"minItems\", ({ json }) => [\n        `.min(${json}`,\n        \", \",\n        \")\",\n    ]);\n    r += withMessage(schema, \"maxItems\", ({ json }) => [\n        `.max(${json}`,\n        \", \",\n        \")\",\n    ]);\n    return r;\n};\n","export const parseConst = (schema) => {\n    return `z.literal(${JSON.stringify(schema.const)})`;\n};\n","export const parseEnum = (schema) => {\n    if (schema.enum.length === 0) {\n        return \"z.never()\";\n    }\n    else if (schema.enum.length === 1) {\n        // union does not work when there is only one element\n        return `z.literal(${JSON.stringify(schema.enum[0])})`;\n    }\n    else if (schema.enum.every((x) => typeof x === \"string\")) {\n        return `z.enum([${schema.enum.map((x) => JSON.stringify(x))}])`;\n    }\n    else {\n        return `z.union([${schema.enum\n            .map((x) => `z.literal(${JSON.stringify(x)})`)\n            .join(\", \")}])`;\n    }\n};\n","import { parseSchema } from \"./parseSchema.js\";\nexport const parseIfThenElse = (schema, refs) => {\n    const $if = parseSchema(schema.if, { ...refs, path: [...refs.path, \"if\"] });\n    const $then = parseSchema(schema.then, {\n        ...refs,\n        path: [...refs.path, \"then\"],\n    });\n    const $else = parseSchema(schema.else, {\n        ...refs,\n        path: [...refs.path, \"else\"],\n    });\n    return `z.union([${$then}, ${$else}]).superRefine((value,ctx) => {\n  const result = ${$if}.safeParse(value).success\n    ? ${$then}.safeParse(value)\n    : ${$else}.safeParse(value);\n  if (!result.success) {\n    result.error.errors.forEach((error) => ctx.addIssue(error))\n  }\n})`;\n};\n","import { withMessage } from \"../utils/withMessage.js\";\nexport const parseNumber = (schema) => {\n    let r = \"z.number()\";\n    if (schema.type === \"integer\") {\n        r += withMessage(schema, \"type\", () => [\".int(\", \")\"]);\n    }\n    else {\n        r += withMessage(schema, \"format\", ({ value }) => {\n            if (value === \"int64\") {\n                return [\".int(\", \")\"];\n            }\n        });\n    }\n    r += withMessage(schema, \"multipleOf\", ({ value, json }) => {\n        if (value === 1) {\n            if (r.startsWith(\"z.number().int(\")) {\n                return;\n            }\n            return [\".int(\", \")\"];\n        }\n        return [`.multipleOf(${json}`, \", \", \")\"];\n    });\n    if (typeof schema.minimum === \"number\") {\n        if (schema.exclusiveMinimum === true) {\n            r += withMessage(schema, \"minimum\", ({ json }) => [\n                `.gt(${json}`,\n                \", \",\n                \")\",\n            ]);\n        }\n        else {\n            r += withMessage(schema, \"minimum\", ({ json }) => [\n                `.gte(${json}`,\n                \", \",\n                \")\",\n            ]);\n        }\n    }\n    else if (typeof schema.exclusiveMinimum === \"number\") {\n        r += withMessage(schema, \"exclusiveMinimum\", ({ json }) => [\n            `.gt(${json}`,\n            \", \",\n            \")\",\n        ]);\n    }\n    if (typeof schema.maximum === \"number\") {\n        if (schema.exclusiveMaximum === true) {\n            r += withMessage(schema, \"maximum\", ({ json }) => [\n                `.lt(${json}`,\n                \", \",\n                \")\",\n            ]);\n        }\n        else {\n            r += withMessage(schema, \"maximum\", ({ json }) => [\n                `.lte(${json}`,\n                \", \",\n                \")\",\n            ]);\n        }\n    }\n    else if (typeof schema.exclusiveMaximum === \"number\") {\n        r += withMessage(schema, \"exclusiveMaximum\", ({ json }) => [\n            `.lt(${json}`,\n            \", \",\n            \")\",\n        ]);\n    }\n    return r;\n};\n","import { parseSchema } from \"./parseSchema.js\";\nexport const parseOneOf = (schema, refs) => {\n    return schema.oneOf.length\n        ? schema.oneOf.length === 1\n            ? parseSchema(schema.oneOf[0], {\n                ...refs,\n                path: [...refs.path, \"oneOf\", 0],\n            })\n            : `z.any().superRefine((x, ctx) => {\n    const schemas = [${schema.oneOf\n                .map((schema, i) => parseSchema(schema, {\n                ...refs,\n                path: [...refs.path, \"oneOf\", i],\n            }))\n                .join(\", \")}];\n    const errors = schemas.reduce<z.ZodError[]>(\n      (errors, schema) =>\n        ((result) =>\n          result.error ? [...errors, result.error] : errors)(\n          schema.safeParse(x),\n        ),\n      [],\n    );\n    if (schemas.length - errors.length !== 1) {\n      ctx.addIssue({\n        path: ctx.path,\n        code: \"invalid_union\",\n        unionErrors: errors,\n        message: \"Invalid input: Should pass single schema\",\n      });\n    }\n  })`\n        : \"z.any()\";\n};\n","export const expandJsdocs = (jsdocs) => {\n    const lines = jsdocs.split(\"\\n\");\n    const result = lines.length === 1\n        ? lines[0]\n        : `\\n${lines.map(x => `* ${x}`)\n            .join(\"\\n\")}\\n`;\n    return `/**${result}*/\\n`;\n};\nexport const addJsdocs = (schema, parsed) => {\n    const description = schema.description;\n    if (!description) {\n        return parsed;\n    }\n    return `\\n${expandJsdocs(description)}${parsed}`;\n};\n","import { parseAnyOf } from \"./parseAnyOf.js\";\nimport { parseOneOf } from \"./parseOneOf.js\";\nimport { its, parseSchema } from \"./parseSchema.js\";\nimport { parseAllOf } from \"./parseAllOf.js\";\nimport { addJsdocs } from \"../utils/jsdocs.js\";\nexport function parseObject(objectSchema, refs) {\n    let properties = undefined;\n    if (objectSchema.properties) {\n        if (!Object.keys(objectSchema.properties).length) {\n            properties = \"z.object({})\";\n        }\n        else {\n            properties = \"z.object({ \";\n            properties += Object.keys(objectSchema.properties)\n                .map((key) => {\n                const propSchema = objectSchema.properties[key];\n                let result = `${JSON.stringify(key)}: ${parseSchema(propSchema, {\n                    ...refs,\n                    path: [...refs.path, \"properties\", key],\n                })}`;\n                if (refs.withJsdocs && typeof propSchema === \"object\") {\n                    result = addJsdocs(propSchema, result);\n                }\n                const hasDefault = typeof propSchema === \"object\" && propSchema.default !== undefined;\n                const required = Array.isArray(objectSchema.required)\n                    ? objectSchema.required.includes(key)\n                    : typeof propSchema === \"object\" && propSchema.required === true;\n                const optional = !hasDefault && !required;\n                return optional ? `${result}.optional()` : result;\n            })\n                .join(\", \");\n            properties += \" })\";\n        }\n    }\n    const additionalProperties = objectSchema.additionalProperties !== undefined\n        ? parseSchema(objectSchema.additionalProperties, {\n            ...refs,\n            path: [...refs.path, \"additionalProperties\"],\n        })\n        : undefined;\n    let patternProperties = undefined;\n    if (objectSchema.patternProperties) {\n        const parsedPatternProperties = Object.fromEntries(Object.entries(objectSchema.patternProperties).map(([key, value]) => {\n            return [\n                key,\n                parseSchema(value, {\n                    ...refs,\n                    path: [...refs.path, \"patternProperties\", key],\n                }),\n            ];\n        }, {}));\n        patternProperties = \"\";\n        if (properties) {\n            if (additionalProperties) {\n                patternProperties += `.catchall(z.union([${[\n                    ...Object.values(parsedPatternProperties),\n                    additionalProperties,\n                ].join(\", \")}]))`;\n            }\n            else if (Object.keys(parsedPatternProperties).length > 1) {\n                patternProperties += `.catchall(z.union([${Object.values(parsedPatternProperties).join(\", \")}]))`;\n            }\n            else {\n                patternProperties += `.catchall(${Object.values(parsedPatternProperties)})`;\n            }\n        }\n        else {\n            if (additionalProperties) {\n                patternProperties += `z.record(z.union([${[\n                    ...Object.values(parsedPatternProperties),\n                    additionalProperties,\n                ].join(\", \")}]))`;\n            }\n            else if (Object.keys(parsedPatternProperties).length > 1) {\n                patternProperties += `z.record(z.union([${Object.values(parsedPatternProperties).join(\", \")}]))`;\n            }\n            else {\n                patternProperties += `z.record(${Object.values(parsedPatternProperties)})`;\n            }\n        }\n        patternProperties += \".superRefine((value, ctx) => {\\n\";\n        patternProperties += \"for (const key in value) {\\n\";\n        if (additionalProperties) {\n            if (objectSchema.properties) {\n                patternProperties += `let evaluated = [${Object.keys(objectSchema.properties)\n                    .map((key) => JSON.stringify(key))\n                    .join(\", \")}].includes(key)\\n`;\n            }\n            else {\n                patternProperties += `let evaluated = false\\n`;\n            }\n        }\n        for (const key in objectSchema.patternProperties) {\n            patternProperties +=\n                \"if (key.match(new RegExp(\" + JSON.stringify(key) + \"))) {\\n\";\n            if (additionalProperties) {\n                patternProperties += \"evaluated = true\\n\";\n            }\n            patternProperties +=\n                \"const result = \" +\n                    parsedPatternProperties[key] +\n                    \".safeParse(value[key])\\n\";\n            patternProperties += \"if (!result.success) {\\n\";\n            patternProperties += `ctx.addIssue({\n          path: [...ctx.path, key],\n          code: 'custom',\n          message: \\`Invalid input: Key matching regex /\\${key}/ must match schema\\`,\n          params: {\n            issues: result.error.issues\n          }\n        })\\n`;\n            patternProperties += \"}\\n\";\n            patternProperties += \"}\\n\";\n        }\n        if (additionalProperties) {\n            patternProperties += \"if (!evaluated) {\\n\";\n            patternProperties +=\n                \"const result = \" + additionalProperties + \".safeParse(value[key])\\n\";\n            patternProperties += \"if (!result.success) {\\n\";\n            patternProperties += `ctx.addIssue({\n          path: [...ctx.path, key],\n          code: 'custom',\n          message: \\`Invalid input: must match catchall schema\\`,\n          params: {\n            issues: result.error.issues\n          }\n        })\\n`;\n            patternProperties += \"}\\n\";\n            patternProperties += \"}\\n\";\n        }\n        patternProperties += \"}\\n\";\n        patternProperties += \"})\";\n    }\n    let output = properties\n        ? patternProperties\n            ? properties + patternProperties\n            : additionalProperties\n                ? additionalProperties === \"z.never()\"\n                    ? properties + \".strict()\"\n                    : properties + `.catchall(${additionalProperties})`\n                : properties\n        : patternProperties\n            ? patternProperties\n            : additionalProperties\n                ? `z.record(${additionalProperties})`\n                : \"z.record(z.any())\";\n    if (its.an.anyOf(objectSchema)) {\n        output += `.and(${parseAnyOf({\n            ...objectSchema,\n            anyOf: objectSchema.anyOf.map((x) => typeof x === \"object\" &&\n                !x.type &&\n                (x.properties || x.additionalProperties || x.patternProperties)\n                ? { ...x, type: \"object\" }\n                : x),\n        }, refs)})`;\n    }\n    if (its.a.oneOf(objectSchema)) {\n        output += `.and(${parseOneOf({\n            ...objectSchema,\n            oneOf: objectSchema.oneOf.map((x) => typeof x === \"object\" &&\n                !x.type &&\n                (x.properties || x.additionalProperties || x.patternProperties)\n                ? { ...x, type: \"object\" }\n                : x),\n        }, refs)})`;\n    }\n    if (its.an.allOf(objectSchema)) {\n        output += `.and(${parseAllOf({\n            ...objectSchema,\n            allOf: objectSchema.allOf.map((x) => typeof x === \"object\" &&\n                !x.type &&\n                (x.properties || x.additionalProperties || x.patternProperties)\n                ? { ...x, type: \"object\" }\n                : x),\n        }, refs)})`;\n    }\n    return output;\n}\n","import { withMessage } from \"../utils/withMessage.js\";\nimport { parseSchema } from \"./parseSchema.js\";\nexport const parseString = (schema) => {\n    let r = \"z.string()\";\n    r += withMessage(schema, \"format\", ({ value }) => {\n        switch (value) {\n            case \"email\":\n                return [\".email(\", \")\"];\n            case \"ip\":\n                return [\".ip(\", \")\"];\n            case \"ipv4\":\n                return ['.ip({ version: \"v4\"', \", message: \", \" })\"];\n            case \"ipv6\":\n                return ['.ip({ version: \"v6\"', \", message: \", \" })\"];\n            case \"uri\":\n                return [\".url(\", \")\"];\n            case \"uuid\":\n                return [\".uuid(\", \")\"];\n            case \"date-time\":\n                return [\".datetime({ offset: true\", \", message: \", \" })\"];\n            case \"time\":\n                return [\".time(\", \")\"];\n            case \"date\":\n                return [\".date(\", \")\"];\n            case \"binary\":\n                return [\".base64(\", \")\"];\n            case \"duration\":\n                return [\".duration(\", \")\"];\n        }\n    });\n    r += withMessage(schema, \"pattern\", ({ json }) => [\n        `.regex(new RegExp(${json})`,\n        \", \",\n        \")\",\n    ]);\n    r += withMessage(schema, \"minLength\", ({ json }) => [\n        `.min(${json}`,\n        \", \",\n        \")\",\n    ]);\n    r += withMessage(schema, \"maxLength\", ({ json }) => [\n        `.max(${json}`,\n        \", \",\n        \")\",\n    ]);\n    r += withMessage(schema, \"contentEncoding\", ({ value }) => {\n        if (value === \"base64\") {\n            return [\".base64(\", \")\"];\n        }\n    });\n    const contentMediaType = withMessage(schema, \"contentMediaType\", ({ value }) => {\n        if (value === \"application/json\") {\n            return [\n                \".transform((str, ctx) => { try { return JSON.parse(str); } catch (err) { ctx.addIssue({ code: \\\"custom\\\", message: \\\"Invalid JSON\\\" }); }}\",\n                \", \",\n                \")\"\n            ];\n        }\n    });\n    if (contentMediaType != \"\") {\n        r += contentMediaType;\n        r += withMessage(schema, \"contentSchema\", ({ value }) => {\n            if (value && value instanceof Object) {\n                return [\n                    `.pipe(${parseSchema(value)}`,\n                    \", \",\n                    \")\"\n                ];\n            }\n        });\n    }\n    return r;\n};\n","export const omit = (obj, ...keys) => Object.keys(obj).reduce((acc, key) => {\n    if (!keys.includes(key)) {\n        acc[key] = obj[key];\n    }\n    return acc;\n}, {});\n","import { omit } from \"../utils/omit.js\";\nimport { parseSchema } from \"./parseSchema.js\";\n/**\n * For compatibility with open api 3.0 nullable\n */\nexport const parseNullable = (schema, refs) => {\n    return `${parseSchema(omit(schema, \"nullable\"), refs, true)}.nullable()`;\n};\n","import { parseAnyOf } from \"./parseAnyOf.js\";\nimport { parseBoolean } from \"./parseBoolean.js\";\nimport { parseDefault } from \"./parseDefault.js\";\nimport { parseMultipleType } from \"./parseMultipleType.js\";\nimport { parseNot } from \"./parseNot.js\";\nimport { parseNull } from \"./parseNull.js\";\nimport { parseAllOf } from \"./parseAllOf.js\";\nimport { parseArray } from \"./parseArray.js\";\nimport { parseConst } from \"./parseConst.js\";\nimport { parseEnum } from \"./parseEnum.js\";\nimport { parseIfThenElse } from \"./parseIfThenElse.js\";\nimport { parseNumber } from \"./parseNumber.js\";\nimport { parseObject } from \"./parseObject.js\";\nimport { parseString } from \"./parseString.js\";\nimport { parseOneOf } from \"./parseOneOf.js\";\nimport { parseNullable } from \"./parseNullable.js\";\nexport const parseSchema = (schema, refs = { seen: new Map(), path: [] }, blockMeta) => {\n    if (typeof schema !== \"object\")\n        return schema ? \"z.any()\" : \"z.never()\";\n    if (refs.parserOverride) {\n        const custom = refs.parserOverride(schema, refs);\n        if (typeof custom === \"string\") {\n            return custom;\n        }\n    }\n    let seen = refs.seen.get(schema);\n    if (seen) {\n        if (seen.r !== undefined) {\n            return seen.r;\n        }\n        if (refs.depth === undefined || seen.n >= refs.depth) {\n            return \"z.any()\";\n        }\n        seen.n += 1;\n    }\n    else {\n        seen = { r: undefined, n: 0 };\n        refs.seen.set(schema, seen);\n    }\n    let parsed = selectParser(schema, refs);\n    if (!blockMeta) {\n        if (!refs.withoutDescribes) {\n            parsed = addDescribes(schema, parsed);\n        }\n        if (!refs.withoutDefaults) {\n            parsed = addDefaults(schema, parsed);\n        }\n        parsed = addAnnotations(schema, parsed);\n    }\n    seen.r = parsed;\n    return parsed;\n};\nconst addDescribes = (schema, parsed) => {\n    if (schema.description) {\n        parsed += `.describe(${JSON.stringify(schema.description)})`;\n    }\n    return parsed;\n};\nconst addDefaults = (schema, parsed) => {\n    if (schema.default !== undefined) {\n        parsed += `.default(${JSON.stringify(schema.default)})`;\n    }\n    return parsed;\n};\nconst addAnnotations = (schema, parsed) => {\n    if (schema.readOnly) {\n        parsed += \".readonly()\";\n    }\n    return parsed;\n};\nconst selectParser = (schema, refs) => {\n    if (its.a.nullable(schema)) {\n        return parseNullable(schema, refs);\n    }\n    else if (its.an.object(schema)) {\n        return parseObject(schema, refs);\n    }\n    else if (its.an.array(schema)) {\n        return parseArray(schema, refs);\n    }\n    else if (its.an.anyOf(schema)) {\n        return parseAnyOf(schema, refs);\n    }\n    else if (its.an.allOf(schema)) {\n        return parseAllOf(schema, refs);\n    }\n    else if (its.a.oneOf(schema)) {\n        return parseOneOf(schema, refs);\n    }\n    else if (its.a.not(schema)) {\n        return parseNot(schema, refs);\n    }\n    else if (its.an.enum(schema)) {\n        return parseEnum(schema); //<-- needs to come before primitives\n    }\n    else if (its.a.const(schema)) {\n        return parseConst(schema);\n    }\n    else if (its.a.multipleType(schema)) {\n        return parseMultipleType(schema, refs);\n    }\n    else if (its.a.primitive(schema, \"string\")) {\n        return parseString(schema);\n    }\n    else if (its.a.primitive(schema, \"number\") ||\n        its.a.primitive(schema, \"integer\")) {\n        return parseNumber(schema);\n    }\n    else if (its.a.primitive(schema, \"boolean\")) {\n        return parseBoolean(schema);\n    }\n    else if (its.a.primitive(schema, \"null\")) {\n        return parseNull(schema);\n    }\n    else if (its.a.conditional(schema)) {\n        return parseIfThenElse(schema, refs);\n    }\n    else {\n        return parseDefault(schema);\n    }\n};\nexport const its = {\n    an: {\n        object: (x) => x.type === \"object\",\n        array: (x) => x.type === \"array\",\n        anyOf: (x) => x.anyOf !== undefined,\n        allOf: (x) => x.allOf !== undefined,\n        enum: (x) => x.enum !== undefined,\n    },\n    a: {\n        nullable: (x) => x.nullable === true,\n        multipleType: (x) => Array.isArray(x.type),\n        not: (x) => x.not !== undefined,\n        const: (x) => x.const !== undefined,\n        primitive: (x, p) => x.type === p,\n        conditional: (x) => Boolean(\"if\" in x && x.if && \"then\" in x && \"else\" in x && x.then && x.else),\n        oneOf: (x) => x.oneOf !== undefined,\n    },\n};\n","import { parseSchema } from \"./parsers/parseSchema.js\";\nimport { expandJsdocs } from \"./utils/jsdocs.js\";\nexport const jsonSchemaToZod = (schema, { module, name, type, noImport, ...rest } = {}) => {\n    if (type && (!name || module !== \"esm\")) {\n        throw new Error(\"Option `type` requires `name` to be set and `module` to be `esm`\");\n    }\n    let result = parseSchema(schema, {\n        module,\n        name,\n        path: [],\n        seen: new Map(),\n        ...rest,\n    });\n    const jsdocs = rest.withJsdocs && typeof schema !== \"boolean\" && schema.description\n        ? expandJsdocs(schema.description)\n        : \"\";\n    if (module === \"cjs\") {\n        result = `${jsdocs}module.exports = ${name ? `{ ${JSON.stringify(name)}: ${result} }` : result}\n`;\n        if (!noImport) {\n            result = `${jsdocs}const { z } = require(\"zod\")\n\n${result}`;\n        }\n    }\n    else if (module === \"esm\") {\n        result = `${jsdocs}export ${name ? `const ${name} =` : `default`} ${result}\n`;\n        if (!noImport) {\n            result = `import { z } from \"zod\"\n\n${result}`;\n        }\n    }\n    else if (name) {\n        result = `${jsdocs}const ${name} = ${result}`;\n    }\n    if (type && name) {\n        let typeName = typeof type === \"string\"\n            ? type\n            : `${name[0].toUpperCase()}${name.substring(1)}`;\n        result += `export type ${typeName} = z.infer<typeof ${name}>\n`;\n    }\n    return result;\n};\n","import { z } from \"zod\";\nexport const LATEST_PROTOCOL_VERSION = \"2025-06-18\";\nexport const DEFAULT_NEGOTIATED_PROTOCOL_VERSION = \"2025-03-26\";\nexport const SUPPORTED_PROTOCOL_VERSIONS = [\n    LATEST_PROTOCOL_VERSION,\n    \"2025-03-26\",\n    \"2024-11-05\",\n    \"2024-10-07\",\n];\n/* JSON-RPC types */\nexport const JSONRPC_VERSION = \"2.0\";\n/**\n * A progress token, used to associate progress notifications with the original request.\n */\nexport const ProgressTokenSchema = z.union([z.string(), z.number().int()]);\n/**\n * An opaque token used to represent a cursor for pagination.\n */\nexport const CursorSchema = z.string();\nconst RequestMetaSchema = z\n    .object({\n    /**\n     * If specified, the caller is requesting out-of-band progress notifications for this request (as represented by notifications/progress). The value of this parameter is an opaque token that will be attached to any subsequent notifications. The receiver is not obligated to provide these notifications.\n     */\n    progressToken: z.optional(ProgressTokenSchema),\n})\n    .passthrough();\nconst BaseRequestParamsSchema = z\n    .object({\n    _meta: z.optional(RequestMetaSchema),\n})\n    .passthrough();\nexport const RequestSchema = z.object({\n    method: z.string(),\n    params: z.optional(BaseRequestParamsSchema),\n});\nconst BaseNotificationParamsSchema = z\n    .object({\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\nexport const NotificationSchema = z.object({\n    method: z.string(),\n    params: z.optional(BaseNotificationParamsSchema),\n});\nexport const ResultSchema = z\n    .object({\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\n/**\n * A uniquely identifying ID for a request in JSON-RPC.\n */\nexport const RequestIdSchema = z.union([z.string(), z.number().int()]);\n/**\n * A request that expects a response.\n */\nexport const JSONRPCRequestSchema = z\n    .object({\n    jsonrpc: z.literal(JSONRPC_VERSION),\n    id: RequestIdSchema,\n})\n    .merge(RequestSchema)\n    .strict();\nexport const isJSONRPCRequest = (value) => JSONRPCRequestSchema.safeParse(value).success;\n/**\n * A notification which does not expect a response.\n */\nexport const JSONRPCNotificationSchema = z\n    .object({\n    jsonrpc: z.literal(JSONRPC_VERSION),\n})\n    .merge(NotificationSchema)\n    .strict();\nexport const isJSONRPCNotification = (value) => JSONRPCNotificationSchema.safeParse(value).success;\n/**\n * A successful (non-error) response to a request.\n */\nexport const JSONRPCResponseSchema = z\n    .object({\n    jsonrpc: z.literal(JSONRPC_VERSION),\n    id: RequestIdSchema,\n    result: ResultSchema,\n})\n    .strict();\nexport const isJSONRPCResponse = (value) => JSONRPCResponseSchema.safeParse(value).success;\n/**\n * Error codes defined by the JSON-RPC specification.\n */\nexport var ErrorCode;\n(function (ErrorCode) {\n    // SDK error codes\n    ErrorCode[ErrorCode[\"ConnectionClosed\"] = -32000] = \"ConnectionClosed\";\n    ErrorCode[ErrorCode[\"RequestTimeout\"] = -32001] = \"RequestTimeout\";\n    // Standard JSON-RPC error codes\n    ErrorCode[ErrorCode[\"ParseError\"] = -32700] = \"ParseError\";\n    ErrorCode[ErrorCode[\"InvalidRequest\"] = -32600] = \"InvalidRequest\";\n    ErrorCode[ErrorCode[\"MethodNotFound\"] = -32601] = \"MethodNotFound\";\n    ErrorCode[ErrorCode[\"InvalidParams\"] = -32602] = \"InvalidParams\";\n    ErrorCode[ErrorCode[\"InternalError\"] = -32603] = \"InternalError\";\n})(ErrorCode || (ErrorCode = {}));\n/**\n * A response to a request that indicates an error occurred.\n */\nexport const JSONRPCErrorSchema = z\n    .object({\n    jsonrpc: z.literal(JSONRPC_VERSION),\n    id: RequestIdSchema,\n    error: z.object({\n        /**\n         * The error type that occurred.\n         */\n        code: z.number().int(),\n        /**\n         * A short description of the error. The message SHOULD be limited to a concise single sentence.\n         */\n        message: z.string(),\n        /**\n         * Additional information about the error. The value of this member is defined by the sender (e.g. detailed error information, nested errors etc.).\n         */\n        data: z.optional(z.unknown()),\n    }),\n})\n    .strict();\nexport const isJSONRPCError = (value) => JSONRPCErrorSchema.safeParse(value).success;\nexport const JSONRPCMessageSchema = z.union([\n    JSONRPCRequestSchema,\n    JSONRPCNotificationSchema,\n    JSONRPCResponseSchema,\n    JSONRPCErrorSchema,\n]);\n/* Empty result */\n/**\n * A response that indicates success but carries no data.\n */\nexport const EmptyResultSchema = ResultSchema.strict();\n/* Cancellation */\n/**\n * This notification can be sent by either side to indicate that it is cancelling a previously-issued request.\n *\n * The request SHOULD still be in-flight, but due to communication latency, it is always possible that this notification MAY arrive after the request has already finished.\n *\n * This notification indicates that the result will be unused, so any associated processing SHOULD cease.\n *\n * A client MUST NOT attempt to cancel its `initialize` request.\n */\nexport const CancelledNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/cancelled\"),\n    params: BaseNotificationParamsSchema.extend({\n        /**\n         * The ID of the request to cancel.\n         *\n         * This MUST correspond to the ID of a request previously issued in the same direction.\n         */\n        requestId: RequestIdSchema,\n        /**\n         * An optional string describing the reason for the cancellation. This MAY be logged or presented to the user.\n         */\n        reason: z.string().optional(),\n    }),\n});\n/* Base Metadata */\n/**\n * Base metadata interface for common properties across resources, tools, prompts, and implementations.\n */\nexport const BaseMetadataSchema = z\n    .object({\n    /** Intended for programmatic or logical use, but used as a display name in past specs or fallback */\n    name: z.string(),\n    /**\n    * Intended for UI and end-user contexts  optimized to be human-readable and easily understood,\n    * even by those unfamiliar with domain-specific terminology.\n    *\n    * If not provided, the name should be used for display (except for Tool,\n    * where `annotations.title` should be given precedence over using `name`,\n    * if present).\n    */\n    title: z.optional(z.string()),\n})\n    .passthrough();\n/* Initialization */\n/**\n * Describes the name and version of an MCP implementation.\n */\nexport const ImplementationSchema = BaseMetadataSchema.extend({\n    version: z.string(),\n});\n/**\n * Capabilities a client may support. Known capabilities are defined here, in this schema, but this is not a closed set: any client can define its own, additional capabilities.\n */\nexport const ClientCapabilitiesSchema = z\n    .object({\n    /**\n     * Experimental, non-standard capabilities that the client supports.\n     */\n    experimental: z.optional(z.object({}).passthrough()),\n    /**\n     * Present if the client supports sampling from an LLM.\n     */\n    sampling: z.optional(z.object({}).passthrough()),\n    /**\n     * Present if the client supports eliciting user input.\n     */\n    elicitation: z.optional(z.object({}).passthrough()),\n    /**\n     * Present if the client supports listing roots.\n     */\n    roots: z.optional(z\n        .object({\n        /**\n         * Whether the client supports issuing notifications for changes to the roots list.\n         */\n        listChanged: z.optional(z.boolean()),\n    })\n        .passthrough()),\n})\n    .passthrough();\n/**\n * This request is sent from the client to the server when it first connects, asking it to begin initialization.\n */\nexport const InitializeRequestSchema = RequestSchema.extend({\n    method: z.literal(\"initialize\"),\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * The latest version of the Model Context Protocol that the client supports. The client MAY decide to support older versions as well.\n         */\n        protocolVersion: z.string(),\n        capabilities: ClientCapabilitiesSchema,\n        clientInfo: ImplementationSchema,\n    }),\n});\nexport const isInitializeRequest = (value) => InitializeRequestSchema.safeParse(value).success;\n/**\n * Capabilities that a server may support. Known capabilities are defined here, in this schema, but this is not a closed set: any server can define its own, additional capabilities.\n */\nexport const ServerCapabilitiesSchema = z\n    .object({\n    /**\n     * Experimental, non-standard capabilities that the server supports.\n     */\n    experimental: z.optional(z.object({}).passthrough()),\n    /**\n     * Present if the server supports sending log messages to the client.\n     */\n    logging: z.optional(z.object({}).passthrough()),\n    /**\n     * Present if the server supports sending completions to the client.\n     */\n    completions: z.optional(z.object({}).passthrough()),\n    /**\n     * Present if the server offers any prompt templates.\n     */\n    prompts: z.optional(z\n        .object({\n        /**\n         * Whether this server supports issuing notifications for changes to the prompt list.\n         */\n        listChanged: z.optional(z.boolean()),\n    })\n        .passthrough()),\n    /**\n     * Present if the server offers any resources to read.\n     */\n    resources: z.optional(z\n        .object({\n        /**\n         * Whether this server supports clients subscribing to resource updates.\n         */\n        subscribe: z.optional(z.boolean()),\n        /**\n         * Whether this server supports issuing notifications for changes to the resource list.\n         */\n        listChanged: z.optional(z.boolean()),\n    })\n        .passthrough()),\n    /**\n     * Present if the server offers any tools to call.\n     */\n    tools: z.optional(z\n        .object({\n        /**\n         * Whether this server supports issuing notifications for changes to the tool list.\n         */\n        listChanged: z.optional(z.boolean()),\n    })\n        .passthrough()),\n})\n    .passthrough();\n/**\n * After receiving an initialize request from the client, the server sends this response.\n */\nexport const InitializeResultSchema = ResultSchema.extend({\n    /**\n     * The version of the Model Context Protocol that the server wants to use. This may not match the version that the client requested. If the client cannot support this version, it MUST disconnect.\n     */\n    protocolVersion: z.string(),\n    capabilities: ServerCapabilitiesSchema,\n    serverInfo: ImplementationSchema,\n    /**\n     * Instructions describing how to use the server and its features.\n     *\n     * This can be used by clients to improve the LLM's understanding of available tools, resources, etc. It can be thought of like a \"hint\" to the model. For example, this information MAY be added to the system prompt.\n     */\n    instructions: z.optional(z.string()),\n});\n/**\n * This notification is sent from the client to the server after initialization has finished.\n */\nexport const InitializedNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/initialized\"),\n});\nexport const isInitializedNotification = (value) => InitializedNotificationSchema.safeParse(value).success;\n/* Ping */\n/**\n * A ping, issued by either the server or the client, to check that the other party is still alive. The receiver must promptly respond, or else may be disconnected.\n */\nexport const PingRequestSchema = RequestSchema.extend({\n    method: z.literal(\"ping\"),\n});\n/* Progress notifications */\nexport const ProgressSchema = z\n    .object({\n    /**\n     * The progress thus far. This should increase every time progress is made, even if the total is unknown.\n     */\n    progress: z.number(),\n    /**\n     * Total number of items to process (or total progress required), if known.\n     */\n    total: z.optional(z.number()),\n    /**\n     * An optional message describing the current progress.\n     */\n    message: z.optional(z.string()),\n})\n    .passthrough();\n/**\n * An out-of-band notification used to inform the receiver of a progress update for a long-running request.\n */\nexport const ProgressNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/progress\"),\n    params: BaseNotificationParamsSchema.merge(ProgressSchema).extend({\n        /**\n         * The progress token which was given in the initial request, used to associate this notification with the request that is proceeding.\n         */\n        progressToken: ProgressTokenSchema,\n    }),\n});\n/* Pagination */\nexport const PaginatedRequestSchema = RequestSchema.extend({\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * An opaque token representing the current pagination position.\n         * If provided, the server should return results starting after this cursor.\n         */\n        cursor: z.optional(CursorSchema),\n    }).optional(),\n});\nexport const PaginatedResultSchema = ResultSchema.extend({\n    /**\n     * An opaque token representing the pagination position after the last returned result.\n     * If present, there may be more results available.\n     */\n    nextCursor: z.optional(CursorSchema),\n});\n/* Resources */\n/**\n * The contents of a specific resource or sub-resource.\n */\nexport const ResourceContentsSchema = z\n    .object({\n    /**\n     * The URI of this resource.\n     */\n    uri: z.string(),\n    /**\n     * The MIME type of this resource, if known.\n     */\n    mimeType: z.optional(z.string()),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\nexport const TextResourceContentsSchema = ResourceContentsSchema.extend({\n    /**\n     * The text of the item. This must only be set if the item can actually be represented as text (not binary data).\n     */\n    text: z.string(),\n});\nexport const BlobResourceContentsSchema = ResourceContentsSchema.extend({\n    /**\n     * A base64-encoded string representing the binary data of the item.\n     */\n    blob: z.string().base64(),\n});\n/**\n * A known resource that the server is capable of reading.\n */\nexport const ResourceSchema = BaseMetadataSchema.extend({\n    /**\n     * The URI of this resource.\n     */\n    uri: z.string(),\n    /**\n     * A description of what this resource represents.\n     *\n     * This can be used by clients to improve the LLM's understanding of available resources. It can be thought of like a \"hint\" to the model.\n     */\n    description: z.optional(z.string()),\n    /**\n     * The MIME type of this resource, if known.\n     */\n    mimeType: z.optional(z.string()),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n});\n/**\n * A template description for resources available on the server.\n */\nexport const ResourceTemplateSchema = BaseMetadataSchema.extend({\n    /**\n     * A URI template (according to RFC 6570) that can be used to construct resource URIs.\n     */\n    uriTemplate: z.string(),\n    /**\n     * A description of what this template is for.\n     *\n     * This can be used by clients to improve the LLM's understanding of available resources. It can be thought of like a \"hint\" to the model.\n     */\n    description: z.optional(z.string()),\n    /**\n     * The MIME type for all resources that match this template. This should only be included if all resources matching this template have the same type.\n     */\n    mimeType: z.optional(z.string()),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n});\n/**\n * Sent from the client to request a list of resources the server has.\n */\nexport const ListResourcesRequestSchema = PaginatedRequestSchema.extend({\n    method: z.literal(\"resources/list\"),\n});\n/**\n * The server's response to a resources/list request from the client.\n */\nexport const ListResourcesResultSchema = PaginatedResultSchema.extend({\n    resources: z.array(ResourceSchema),\n});\n/**\n * Sent from the client to request a list of resource templates the server has.\n */\nexport const ListResourceTemplatesRequestSchema = PaginatedRequestSchema.extend({\n    method: z.literal(\"resources/templates/list\"),\n});\n/**\n * The server's response to a resources/templates/list request from the client.\n */\nexport const ListResourceTemplatesResultSchema = PaginatedResultSchema.extend({\n    resourceTemplates: z.array(ResourceTemplateSchema),\n});\n/**\n * Sent from the client to the server, to read a specific resource URI.\n */\nexport const ReadResourceRequestSchema = RequestSchema.extend({\n    method: z.literal(\"resources/read\"),\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * The URI of the resource to read. The URI can use any protocol; it is up to the server how to interpret it.\n         */\n        uri: z.string(),\n    }),\n});\n/**\n * The server's response to a resources/read request from the client.\n */\nexport const ReadResourceResultSchema = ResultSchema.extend({\n    contents: z.array(z.union([TextResourceContentsSchema, BlobResourceContentsSchema])),\n});\n/**\n * An optional notification from the server to the client, informing it that the list of resources it can read from has changed. This may be issued by servers without any previous subscription from the client.\n */\nexport const ResourceListChangedNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/resources/list_changed\"),\n});\n/**\n * Sent from the client to request resources/updated notifications from the server whenever a particular resource changes.\n */\nexport const SubscribeRequestSchema = RequestSchema.extend({\n    method: z.literal(\"resources/subscribe\"),\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * The URI of the resource to subscribe to. The URI can use any protocol; it is up to the server how to interpret it.\n         */\n        uri: z.string(),\n    }),\n});\n/**\n * Sent from the client to request cancellation of resources/updated notifications from the server. This should follow a previous resources/subscribe request.\n */\nexport const UnsubscribeRequestSchema = RequestSchema.extend({\n    method: z.literal(\"resources/unsubscribe\"),\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * The URI of the resource to unsubscribe from.\n         */\n        uri: z.string(),\n    }),\n});\n/**\n * A notification from the server to the client, informing it that a resource has changed and may need to be read again. This should only be sent if the client previously sent a resources/subscribe request.\n */\nexport const ResourceUpdatedNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/resources/updated\"),\n    params: BaseNotificationParamsSchema.extend({\n        /**\n         * The URI of the resource that has been updated. This might be a sub-resource of the one that the client actually subscribed to.\n         */\n        uri: z.string(),\n    }),\n});\n/* Prompts */\n/**\n * Describes an argument that a prompt can accept.\n */\nexport const PromptArgumentSchema = z\n    .object({\n    /**\n     * The name of the argument.\n     */\n    name: z.string(),\n    /**\n     * A human-readable description of the argument.\n     */\n    description: z.optional(z.string()),\n    /**\n     * Whether this argument must be provided.\n     */\n    required: z.optional(z.boolean()),\n})\n    .passthrough();\n/**\n * A prompt or prompt template that the server offers.\n */\nexport const PromptSchema = BaseMetadataSchema.extend({\n    /**\n     * An optional description of what this prompt provides\n     */\n    description: z.optional(z.string()),\n    /**\n     * A list of arguments to use for templating the prompt.\n     */\n    arguments: z.optional(z.array(PromptArgumentSchema)),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n});\n/**\n * Sent from the client to request a list of prompts and prompt templates the server has.\n */\nexport const ListPromptsRequestSchema = PaginatedRequestSchema.extend({\n    method: z.literal(\"prompts/list\"),\n});\n/**\n * The server's response to a prompts/list request from the client.\n */\nexport const ListPromptsResultSchema = PaginatedResultSchema.extend({\n    prompts: z.array(PromptSchema),\n});\n/**\n * Used by the client to get a prompt provided by the server.\n */\nexport const GetPromptRequestSchema = RequestSchema.extend({\n    method: z.literal(\"prompts/get\"),\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * The name of the prompt or prompt template.\n         */\n        name: z.string(),\n        /**\n         * Arguments to use for templating the prompt.\n         */\n        arguments: z.optional(z.record(z.string())),\n    }),\n});\n/**\n * Text provided to or from an LLM.\n */\nexport const TextContentSchema = z\n    .object({\n    type: z.literal(\"text\"),\n    /**\n     * The text content of the message.\n     */\n    text: z.string(),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\n/**\n * An image provided to or from an LLM.\n */\nexport const ImageContentSchema = z\n    .object({\n    type: z.literal(\"image\"),\n    /**\n     * The base64-encoded image data.\n     */\n    data: z.string().base64(),\n    /**\n     * The MIME type of the image. Different providers may support different image types.\n     */\n    mimeType: z.string(),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\n/**\n * An Audio provided to or from an LLM.\n */\nexport const AudioContentSchema = z\n    .object({\n    type: z.literal(\"audio\"),\n    /**\n     * The base64-encoded audio data.\n     */\n    data: z.string().base64(),\n    /**\n     * The MIME type of the audio. Different providers may support different audio types.\n     */\n    mimeType: z.string(),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\n/**\n * The contents of a resource, embedded into a prompt or tool call result.\n */\nexport const EmbeddedResourceSchema = z\n    .object({\n    type: z.literal(\"resource\"),\n    resource: z.union([TextResourceContentsSchema, BlobResourceContentsSchema]),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\n/**\n * A resource that the server is capable of reading, included in a prompt or tool call result.\n *\n * Note: resource links returned by tools are not guaranteed to appear in the results of `resources/list` requests.\n */\nexport const ResourceLinkSchema = ResourceSchema.extend({\n    type: z.literal(\"resource_link\"),\n});\n/**\n * A content block that can be used in prompts and tool results.\n */\nexport const ContentBlockSchema = z.union([\n    TextContentSchema,\n    ImageContentSchema,\n    AudioContentSchema,\n    ResourceLinkSchema,\n    EmbeddedResourceSchema,\n]);\n/**\n * Describes a message returned as part of a prompt.\n */\nexport const PromptMessageSchema = z\n    .object({\n    role: z.enum([\"user\", \"assistant\"]),\n    content: ContentBlockSchema,\n})\n    .passthrough();\n/**\n * The server's response to a prompts/get request from the client.\n */\nexport const GetPromptResultSchema = ResultSchema.extend({\n    /**\n     * An optional description for the prompt.\n     */\n    description: z.optional(z.string()),\n    messages: z.array(PromptMessageSchema),\n});\n/**\n * An optional notification from the server to the client, informing it that the list of prompts it offers has changed. This may be issued by servers without any previous subscription from the client.\n */\nexport const PromptListChangedNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/prompts/list_changed\"),\n});\n/* Tools */\n/**\n * Additional properties describing a Tool to clients.\n *\n * NOTE: all properties in ToolAnnotations are **hints**.\n * They are not guaranteed to provide a faithful description of\n * tool behavior (including descriptive properties like `title`).\n *\n * Clients should never make tool use decisions based on ToolAnnotations\n * received from untrusted servers.\n */\nexport const ToolAnnotationsSchema = z\n    .object({\n    /**\n     * A human-readable title for the tool.\n     */\n    title: z.optional(z.string()),\n    /**\n     * If true, the tool does not modify its environment.\n     *\n     * Default: false\n     */\n    readOnlyHint: z.optional(z.boolean()),\n    /**\n     * If true, the tool may perform destructive updates to its environment.\n     * If false, the tool performs only additive updates.\n     *\n     * (This property is meaningful only when `readOnlyHint == false`)\n     *\n     * Default: true\n     */\n    destructiveHint: z.optional(z.boolean()),\n    /**\n     * If true, calling the tool repeatedly with the same arguments\n     * will have no additional effect on the its environment.\n     *\n     * (This property is meaningful only when `readOnlyHint == false`)\n     *\n     * Default: false\n     */\n    idempotentHint: z.optional(z.boolean()),\n    /**\n     * If true, this tool may interact with an \"open world\" of external\n     * entities. If false, the tool's domain of interaction is closed.\n     * For example, the world of a web search tool is open, whereas that\n     * of a memory tool is not.\n     *\n     * Default: true\n     */\n    openWorldHint: z.optional(z.boolean()),\n})\n    .passthrough();\n/**\n * Definition for a tool the client can call.\n */\nexport const ToolSchema = BaseMetadataSchema.extend({\n    /**\n     * A human-readable description of the tool.\n     */\n    description: z.optional(z.string()),\n    /**\n     * A JSON Schema object defining the expected parameters for the tool.\n     */\n    inputSchema: z\n        .object({\n        type: z.literal(\"object\"),\n        properties: z.optional(z.object({}).passthrough()),\n        required: z.optional(z.array(z.string())),\n    })\n        .passthrough(),\n    /**\n     * An optional JSON Schema object defining the structure of the tool's output returned in\n     * the structuredContent field of a CallToolResult.\n     */\n    outputSchema: z.optional(z.object({\n        type: z.literal(\"object\"),\n        properties: z.optional(z.object({}).passthrough()),\n        required: z.optional(z.array(z.string())),\n    })\n        .passthrough()),\n    /**\n     * Optional additional tool information.\n     */\n    annotations: z.optional(ToolAnnotationsSchema),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n});\n/**\n * Sent from the client to request a list of tools the server has.\n */\nexport const ListToolsRequestSchema = PaginatedRequestSchema.extend({\n    method: z.literal(\"tools/list\"),\n});\n/**\n * The server's response to a tools/list request from the client.\n */\nexport const ListToolsResultSchema = PaginatedResultSchema.extend({\n    tools: z.array(ToolSchema),\n});\n/**\n * The server's response to a tool call.\n */\nexport const CallToolResultSchema = ResultSchema.extend({\n    /**\n     * A list of content objects that represent the result of the tool call.\n     *\n     * If the Tool does not define an outputSchema, this field MUST be present in the result.\n     * For backwards compatibility, this field is always present, but it may be empty.\n     */\n    content: z.array(ContentBlockSchema).default([]),\n    /**\n     * An object containing structured tool output.\n     *\n     * If the Tool defines an outputSchema, this field MUST be present in the result, and contain a JSON object that matches the schema.\n     */\n    structuredContent: z.object({}).passthrough().optional(),\n    /**\n     * Whether the tool call ended in an error.\n     *\n     * If not set, this is assumed to be false (the call was successful).\n     *\n     * Any errors that originate from the tool SHOULD be reported inside the result\n     * object, with `isError` set to true, _not_ as an MCP protocol-level error\n     * response. Otherwise, the LLM would not be able to see that an error occurred\n     * and self-correct.\n     *\n     * However, any errors in _finding_ the tool, an error indicating that the\n     * server does not support tool calls, or any other exceptional conditions,\n     * should be reported as an MCP error response.\n     */\n    isError: z.optional(z.boolean()),\n});\n/**\n * CallToolResultSchema extended with backwards compatibility to protocol version 2024-10-07.\n */\nexport const CompatibilityCallToolResultSchema = CallToolResultSchema.or(ResultSchema.extend({\n    toolResult: z.unknown(),\n}));\n/**\n * Used by the client to invoke a tool provided by the server.\n */\nexport const CallToolRequestSchema = RequestSchema.extend({\n    method: z.literal(\"tools/call\"),\n    params: BaseRequestParamsSchema.extend({\n        name: z.string(),\n        arguments: z.optional(z.record(z.unknown())),\n    }),\n});\n/**\n * An optional notification from the server to the client, informing it that the list of tools it offers has changed. This may be issued by servers without any previous subscription from the client.\n */\nexport const ToolListChangedNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/tools/list_changed\"),\n});\n/* Logging */\n/**\n * The severity of a log message.\n */\nexport const LoggingLevelSchema = z.enum([\n    \"debug\",\n    \"info\",\n    \"notice\",\n    \"warning\",\n    \"error\",\n    \"critical\",\n    \"alert\",\n    \"emergency\",\n]);\n/**\n * A request from the client to the server, to enable or adjust logging.\n */\nexport const SetLevelRequestSchema = RequestSchema.extend({\n    method: z.literal(\"logging/setLevel\"),\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * The level of logging that the client wants to receive from the server. The server should send all logs at this level and higher (i.e., more severe) to the client as notifications/logging/message.\n         */\n        level: LoggingLevelSchema,\n    }),\n});\n/**\n * Notification of a log message passed from server to client. If no logging/setLevel request has been sent from the client, the server MAY decide which messages to send automatically.\n */\nexport const LoggingMessageNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/message\"),\n    params: BaseNotificationParamsSchema.extend({\n        /**\n         * The severity of this log message.\n         */\n        level: LoggingLevelSchema,\n        /**\n         * An optional name of the logger issuing this message.\n         */\n        logger: z.optional(z.string()),\n        /**\n         * The data to be logged, such as a string message or an object. Any JSON serializable type is allowed here.\n         */\n        data: z.unknown(),\n    }),\n});\n/* Sampling */\n/**\n * Hints to use for model selection.\n */\nexport const ModelHintSchema = z\n    .object({\n    /**\n     * A hint for a model name.\n     */\n    name: z.string().optional(),\n})\n    .passthrough();\n/**\n * The server's preferences for model selection, requested of the client during sampling.\n */\nexport const ModelPreferencesSchema = z\n    .object({\n    /**\n     * Optional hints to use for model selection.\n     */\n    hints: z.optional(z.array(ModelHintSchema)),\n    /**\n     * How much to prioritize cost when selecting a model.\n     */\n    costPriority: z.optional(z.number().min(0).max(1)),\n    /**\n     * How much to prioritize sampling speed (latency) when selecting a model.\n     */\n    speedPriority: z.optional(z.number().min(0).max(1)),\n    /**\n     * How much to prioritize intelligence and capabilities when selecting a model.\n     */\n    intelligencePriority: z.optional(z.number().min(0).max(1)),\n})\n    .passthrough();\n/**\n * Describes a message issued to or received from an LLM API.\n */\nexport const SamplingMessageSchema = z\n    .object({\n    role: z.enum([\"user\", \"assistant\"]),\n    content: z.union([TextContentSchema, ImageContentSchema, AudioContentSchema]),\n})\n    .passthrough();\n/**\n * A request from the server to sample an LLM via the client. The client has full discretion over which model to select. The client should also inform the user before beginning sampling, to allow them to inspect the request (human in the loop) and decide whether to approve it.\n */\nexport const CreateMessageRequestSchema = RequestSchema.extend({\n    method: z.literal(\"sampling/createMessage\"),\n    params: BaseRequestParamsSchema.extend({\n        messages: z.array(SamplingMessageSchema),\n        /**\n         * An optional system prompt the server wants to use for sampling. The client MAY modify or omit this prompt.\n         */\n        systemPrompt: z.optional(z.string()),\n        /**\n         * A request to include context from one or more MCP servers (including the caller), to be attached to the prompt. The client MAY ignore this request.\n         */\n        includeContext: z.optional(z.enum([\"none\", \"thisServer\", \"allServers\"])),\n        temperature: z.optional(z.number()),\n        /**\n         * The maximum number of tokens to sample, as requested by the server. The client MAY choose to sample fewer tokens than requested.\n         */\n        maxTokens: z.number().int(),\n        stopSequences: z.optional(z.array(z.string())),\n        /**\n         * Optional metadata to pass through to the LLM provider. The format of this metadata is provider-specific.\n         */\n        metadata: z.optional(z.object({}).passthrough()),\n        /**\n         * The server's preferences for which model to select.\n         */\n        modelPreferences: z.optional(ModelPreferencesSchema),\n    }),\n});\n/**\n * The client's response to a sampling/create_message request from the server. The client should inform the user before returning the sampled message, to allow them to inspect the response (human in the loop) and decide whether to allow the server to see it.\n */\nexport const CreateMessageResultSchema = ResultSchema.extend({\n    /**\n     * The name of the model that generated the message.\n     */\n    model: z.string(),\n    /**\n     * The reason why sampling stopped.\n     */\n    stopReason: z.optional(z.enum([\"endTurn\", \"stopSequence\", \"maxTokens\"]).or(z.string())),\n    role: z.enum([\"user\", \"assistant\"]),\n    content: z.discriminatedUnion(\"type\", [\n        TextContentSchema,\n        ImageContentSchema,\n        AudioContentSchema\n    ]),\n});\n/* Elicitation */\n/**\n * Primitive schema definition for boolean fields.\n */\nexport const BooleanSchemaSchema = z\n    .object({\n    type: z.literal(\"boolean\"),\n    title: z.optional(z.string()),\n    description: z.optional(z.string()),\n    default: z.optional(z.boolean()),\n})\n    .passthrough();\n/**\n * Primitive schema definition for string fields.\n */\nexport const StringSchemaSchema = z\n    .object({\n    type: z.literal(\"string\"),\n    title: z.optional(z.string()),\n    description: z.optional(z.string()),\n    minLength: z.optional(z.number()),\n    maxLength: z.optional(z.number()),\n    format: z.optional(z.enum([\"email\", \"uri\", \"date\", \"date-time\"])),\n})\n    .passthrough();\n/**\n * Primitive schema definition for number fields.\n */\nexport const NumberSchemaSchema = z\n    .object({\n    type: z.enum([\"number\", \"integer\"]),\n    title: z.optional(z.string()),\n    description: z.optional(z.string()),\n    minimum: z.optional(z.number()),\n    maximum: z.optional(z.number()),\n})\n    .passthrough();\n/**\n * Primitive schema definition for enum fields.\n */\nexport const EnumSchemaSchema = z\n    .object({\n    type: z.literal(\"string\"),\n    title: z.optional(z.string()),\n    description: z.optional(z.string()),\n    enum: z.array(z.string()),\n    enumNames: z.optional(z.array(z.string())),\n})\n    .passthrough();\n/**\n * Union of all primitive schema definitions.\n */\nexport const PrimitiveSchemaDefinitionSchema = z.union([\n    BooleanSchemaSchema,\n    StringSchemaSchema,\n    NumberSchemaSchema,\n    EnumSchemaSchema,\n]);\n/**\n * A request from the server to elicit user input via the client.\n * The client should present the message and form fields to the user.\n */\nexport const ElicitRequestSchema = RequestSchema.extend({\n    method: z.literal(\"elicitation/create\"),\n    params: BaseRequestParamsSchema.extend({\n        /**\n         * The message to present to the user.\n         */\n        message: z.string(),\n        /**\n         * The schema for the requested user input.\n         */\n        requestedSchema: z\n            .object({\n            type: z.literal(\"object\"),\n            properties: z.record(z.string(), PrimitiveSchemaDefinitionSchema),\n            required: z.optional(z.array(z.string())),\n        })\n            .passthrough(),\n    }),\n});\n/**\n * The client's response to an elicitation/create request from the server.\n */\nexport const ElicitResultSchema = ResultSchema.extend({\n    /**\n     * The user's response action.\n     */\n    action: z.enum([\"accept\", \"decline\", \"cancel\"]),\n    /**\n     * The collected user input content (only present if action is \"accept\").\n     */\n    content: z.optional(z.record(z.string(), z.unknown())),\n});\n/* Autocomplete */\n/**\n * A reference to a resource or resource template definition.\n */\nexport const ResourceTemplateReferenceSchema = z\n    .object({\n    type: z.literal(\"ref/resource\"),\n    /**\n     * The URI or URI template of the resource.\n     */\n    uri: z.string(),\n})\n    .passthrough();\n/**\n * @deprecated Use ResourceTemplateReferenceSchema instead\n */\nexport const ResourceReferenceSchema = ResourceTemplateReferenceSchema;\n/**\n * Identifies a prompt.\n */\nexport const PromptReferenceSchema = z\n    .object({\n    type: z.literal(\"ref/prompt\"),\n    /**\n     * The name of the prompt or prompt template\n     */\n    name: z.string(),\n})\n    .passthrough();\n/**\n * A request from the client to the server, to ask for completion options.\n */\nexport const CompleteRequestSchema = RequestSchema.extend({\n    method: z.literal(\"completion/complete\"),\n    params: BaseRequestParamsSchema.extend({\n        ref: z.union([PromptReferenceSchema, ResourceTemplateReferenceSchema]),\n        /**\n         * The argument's information\n         */\n        argument: z\n            .object({\n            /**\n             * The name of the argument\n             */\n            name: z.string(),\n            /**\n             * The value of the argument to use for completion matching.\n             */\n            value: z.string(),\n        })\n            .passthrough(),\n        context: z.optional(z.object({\n            /**\n             * Previously-resolved variables in a URI template or prompt.\n             */\n            arguments: z.optional(z.record(z.string(), z.string())),\n        })),\n    }),\n});\n/**\n * The server's response to a completion/complete request\n */\nexport const CompleteResultSchema = ResultSchema.extend({\n    completion: z\n        .object({\n        /**\n         * An array of completion values. Must not exceed 100 items.\n         */\n        values: z.array(z.string()).max(100),\n        /**\n         * The total number of completion options available. This can exceed the number of values actually sent in the response.\n         */\n        total: z.optional(z.number().int()),\n        /**\n         * Indicates whether there are additional completion options beyond those provided in the current response, even if the exact total is unknown.\n         */\n        hasMore: z.optional(z.boolean()),\n    })\n        .passthrough(),\n});\n/* Roots */\n/**\n * Represents a root directory or file that the server can operate on.\n */\nexport const RootSchema = z\n    .object({\n    /**\n     * The URI identifying the root. This *must* start with file:// for now.\n     */\n    uri: z.string().startsWith(\"file://\"),\n    /**\n     * An optional name for the root.\n     */\n    name: z.optional(z.string()),\n    /**\n     * See [MCP specification](https://github.com/modelcontextprotocol/modelcontextprotocol/blob/47339c03c143bb4ec01a26e721a1b8fe66634ebe/docs/specification/draft/basic/index.mdx#general-fields)\n     * for notes on _meta usage.\n     */\n    _meta: z.optional(z.object({}).passthrough()),\n})\n    .passthrough();\n/**\n * Sent from the server to request a list of root URIs from the client.\n */\nexport const ListRootsRequestSchema = RequestSchema.extend({\n    method: z.literal(\"roots/list\"),\n});\n/**\n * The client's response to a roots/list request from the server.\n */\nexport const ListRootsResultSchema = ResultSchema.extend({\n    roots: z.array(RootSchema),\n});\n/**\n * A notification from the client to the server, informing it that the list of roots has changed.\n */\nexport const RootsListChangedNotificationSchema = NotificationSchema.extend({\n    method: z.literal(\"notifications/roots/list_changed\"),\n});\n/* Client messages */\nexport const ClientRequestSchema = z.union([\n    PingRequestSchema,\n    InitializeRequestSchema,\n    CompleteRequestSchema,\n    SetLevelRequestSchema,\n    GetPromptRequestSchema,\n    ListPromptsRequestSchema,\n    ListResourcesRequestSchema,\n    ListResourceTemplatesRequestSchema,\n    ReadResourceRequestSchema,\n    SubscribeRequestSchema,\n    UnsubscribeRequestSchema,\n    CallToolRequestSchema,\n    ListToolsRequestSchema,\n]);\nexport const ClientNotificationSchema = z.union([\n    CancelledNotificationSchema,\n    ProgressNotificationSchema,\n    InitializedNotificationSchema,\n    RootsListChangedNotificationSchema,\n]);\nexport const ClientResultSchema = z.union([\n    EmptyResultSchema,\n    CreateMessageResultSchema,\n    ElicitResultSchema,\n    ListRootsResultSchema,\n]);\n/* Server messages */\nexport const ServerRequestSchema = z.union([\n    PingRequestSchema,\n    CreateMessageRequestSchema,\n    ElicitRequestSchema,\n    ListRootsRequestSchema,\n]);\nexport const ServerNotificationSchema = z.union([\n    CancelledNotificationSchema,\n    ProgressNotificationSchema,\n    LoggingMessageNotificationSchema,\n    ResourceUpdatedNotificationSchema,\n    ResourceListChangedNotificationSchema,\n    ToolListChangedNotificationSchema,\n    PromptListChangedNotificationSchema,\n]);\nexport const ServerResultSchema = z.union([\n    EmptyResultSchema,\n    InitializeResultSchema,\n    CompleteResultSchema,\n    GetPromptResultSchema,\n    ListPromptsResultSchema,\n    ListResourcesResultSchema,\n    ListResourceTemplatesResultSchema,\n    ReadResourceResultSchema,\n    CallToolResultSchema,\n    ListToolsResultSchema,\n]);\nexport class McpError extends Error {\n    constructor(code, message, data) {\n        super(`MCP error ${code}: ${message}`);\n        this.code = code;\n        this.data = data;\n        this.name = \"McpError\";\n    }\n}\n//# sourceMappingURL=types.js.map","import { CancelledNotificationSchema, ErrorCode, isJSONRPCError, isJSONRPCRequest, isJSONRPCResponse, isJSONRPCNotification, McpError, PingRequestSchema, ProgressNotificationSchema, } from \"../types.js\";\n/**\n * The default request timeout, in miliseconds.\n */\nexport const DEFAULT_REQUEST_TIMEOUT_MSEC = 60000;\n/**\n * Implements MCP protocol framing on top of a pluggable transport, including\n * features like request/response linking, notifications, and progress.\n */\nexport class Protocol {\n    constructor(_options) {\n        this._options = _options;\n        this._requestMessageId = 0;\n        this._requestHandlers = new Map();\n        this._requestHandlerAbortControllers = new Map();\n        this._notificationHandlers = new Map();\n        this._responseHandlers = new Map();\n        this._progressHandlers = new Map();\n        this._timeoutInfo = new Map();\n        this._pendingDebouncedNotifications = new Set();\n        this.setNotificationHandler(CancelledNotificationSchema, (notification) => {\n            const controller = this._requestHandlerAbortControllers.get(notification.params.requestId);\n            controller === null || controller === void 0 ? void 0 : controller.abort(notification.params.reason);\n        });\n        this.setNotificationHandler(ProgressNotificationSchema, (notification) => {\n            this._onprogress(notification);\n        });\n        this.setRequestHandler(PingRequestSchema, \n        // Automatic pong by default.\n        (_request) => ({}));\n    }\n    _setupTimeout(messageId, timeout, maxTotalTimeout, onTimeout, resetTimeoutOnProgress = false) {\n        this._timeoutInfo.set(messageId, {\n            timeoutId: setTimeout(onTimeout, timeout),\n            startTime: Date.now(),\n            timeout,\n            maxTotalTimeout,\n            resetTimeoutOnProgress,\n            onTimeout\n        });\n    }\n    _resetTimeout(messageId) {\n        const info = this._timeoutInfo.get(messageId);\n        if (!info)\n            return false;\n        const totalElapsed = Date.now() - info.startTime;\n        if (info.maxTotalTimeout && totalElapsed >= info.maxTotalTimeout) {\n            this._timeoutInfo.delete(messageId);\n            throw new McpError(ErrorCode.RequestTimeout, \"Maximum total timeout exceeded\", { maxTotalTimeout: info.maxTotalTimeout, totalElapsed });\n        }\n        clearTimeout(info.timeoutId);\n        info.timeoutId = setTimeout(info.onTimeout, info.timeout);\n        return true;\n    }\n    _cleanupTimeout(messageId) {\n        const info = this._timeoutInfo.get(messageId);\n        if (info) {\n            clearTimeout(info.timeoutId);\n            this._timeoutInfo.delete(messageId);\n        }\n    }\n    /**\n     * Attaches to the given transport, starts it, and starts listening for messages.\n     *\n     * The Protocol object assumes ownership of the Transport, replacing any callbacks that have already been set, and expects that it is the only user of the Transport instance going forward.\n     */\n    async connect(transport) {\n        var _a, _b, _c;\n        this._transport = transport;\n        const _onclose = (_a = this.transport) === null || _a === void 0 ? void 0 : _a.onclose;\n        this._transport.onclose = () => {\n            _onclose === null || _onclose === void 0 ? void 0 : _onclose();\n            this._onclose();\n        };\n        const _onerror = (_b = this.transport) === null || _b === void 0 ? void 0 : _b.onerror;\n        this._transport.onerror = (error) => {\n            _onerror === null || _onerror === void 0 ? void 0 : _onerror(error);\n            this._onerror(error);\n        };\n        const _onmessage = (_c = this._transport) === null || _c === void 0 ? void 0 : _c.onmessage;\n        this._transport.onmessage = (message, extra) => {\n            _onmessage === null || _onmessage === void 0 ? void 0 : _onmessage(message, extra);\n            if (isJSONRPCResponse(message) || isJSONRPCError(message)) {\n                this._onresponse(message);\n            }\n            else if (isJSONRPCRequest(message)) {\n                this._onrequest(message, extra);\n            }\n            else if (isJSONRPCNotification(message)) {\n                this._onnotification(message);\n            }\n            else {\n                this._onerror(new Error(`Unknown message type: ${JSON.stringify(message)}`));\n            }\n        };\n        await this._transport.start();\n    }\n    _onclose() {\n        var _a;\n        const responseHandlers = this._responseHandlers;\n        this._responseHandlers = new Map();\n        this._progressHandlers.clear();\n        this._pendingDebouncedNotifications.clear();\n        this._transport = undefined;\n        (_a = this.onclose) === null || _a === void 0 ? void 0 : _a.call(this);\n        const error = new McpError(ErrorCode.ConnectionClosed, \"Connection closed\");\n        for (const handler of responseHandlers.values()) {\n            handler(error);\n        }\n    }\n    _onerror(error) {\n        var _a;\n        (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n    }\n    _onnotification(notification) {\n        var _a;\n        const handler = (_a = this._notificationHandlers.get(notification.method)) !== null && _a !== void 0 ? _a : this.fallbackNotificationHandler;\n        // Ignore notifications not being subscribed to.\n        if (handler === undefined) {\n            return;\n        }\n        // Starting with Promise.resolve() puts any synchronous errors into the monad as well.\n        Promise.resolve()\n            .then(() => handler(notification))\n            .catch((error) => this._onerror(new Error(`Uncaught error in notification handler: ${error}`)));\n    }\n    _onrequest(request, extra) {\n        var _a, _b, _c, _d;\n        const handler = (_a = this._requestHandlers.get(request.method)) !== null && _a !== void 0 ? _a : this.fallbackRequestHandler;\n        if (handler === undefined) {\n            (_b = this._transport) === null || _b === void 0 ? void 0 : _b.send({\n                jsonrpc: \"2.0\",\n                id: request.id,\n                error: {\n                    code: ErrorCode.MethodNotFound,\n                    message: \"Method not found\",\n                },\n            }).catch((error) => this._onerror(new Error(`Failed to send an error response: ${error}`)));\n            return;\n        }\n        const abortController = new AbortController();\n        this._requestHandlerAbortControllers.set(request.id, abortController);\n        const fullExtra = {\n            signal: abortController.signal,\n            sessionId: (_c = this._transport) === null || _c === void 0 ? void 0 : _c.sessionId,\n            _meta: (_d = request.params) === null || _d === void 0 ? void 0 : _d._meta,\n            sendNotification: (notification) => this.notification(notification, { relatedRequestId: request.id }),\n            sendRequest: (r, resultSchema, options) => this.request(r, resultSchema, { ...options, relatedRequestId: request.id }),\n            authInfo: extra === null || extra === void 0 ? void 0 : extra.authInfo,\n            requestId: request.id,\n            requestInfo: extra === null || extra === void 0 ? void 0 : extra.requestInfo\n        };\n        // Starting with Promise.resolve() puts any synchronous errors into the monad as well.\n        Promise.resolve()\n            .then(() => handler(request, fullExtra))\n            .then((result) => {\n            var _a;\n            if (abortController.signal.aborted) {\n                return;\n            }\n            return (_a = this._transport) === null || _a === void 0 ? void 0 : _a.send({\n                result,\n                jsonrpc: \"2.0\",\n                id: request.id,\n            });\n        }, (error) => {\n            var _a, _b;\n            if (abortController.signal.aborted) {\n                return;\n            }\n            return (_a = this._transport) === null || _a === void 0 ? void 0 : _a.send({\n                jsonrpc: \"2.0\",\n                id: request.id,\n                error: {\n                    code: Number.isSafeInteger(error[\"code\"])\n                        ? error[\"code\"]\n                        : ErrorCode.InternalError,\n                    message: (_b = error.message) !== null && _b !== void 0 ? _b : \"Internal error\",\n                },\n            });\n        })\n            .catch((error) => this._onerror(new Error(`Failed to send response: ${error}`)))\n            .finally(() => {\n            this._requestHandlerAbortControllers.delete(request.id);\n        });\n    }\n    _onprogress(notification) {\n        const { progressToken, ...params } = notification.params;\n        const messageId = Number(progressToken);\n        const handler = this._progressHandlers.get(messageId);\n        if (!handler) {\n            this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(notification)}`));\n            return;\n        }\n        const responseHandler = this._responseHandlers.get(messageId);\n        const timeoutInfo = this._timeoutInfo.get(messageId);\n        if (timeoutInfo && responseHandler && timeoutInfo.resetTimeoutOnProgress) {\n            try {\n                this._resetTimeout(messageId);\n            }\n            catch (error) {\n                responseHandler(error);\n                return;\n            }\n        }\n        handler(params);\n    }\n    _onresponse(response) {\n        const messageId = Number(response.id);\n        const handler = this._responseHandlers.get(messageId);\n        if (handler === undefined) {\n            this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(response)}`));\n            return;\n        }\n        this._responseHandlers.delete(messageId);\n        this._progressHandlers.delete(messageId);\n        this._cleanupTimeout(messageId);\n        if (isJSONRPCResponse(response)) {\n            handler(response);\n        }\n        else {\n            const error = new McpError(response.error.code, response.error.message, response.error.data);\n            handler(error);\n        }\n    }\n    get transport() {\n        return this._transport;\n    }\n    /**\n     * Closes the connection.\n     */\n    async close() {\n        var _a;\n        await ((_a = this._transport) === null || _a === void 0 ? void 0 : _a.close());\n    }\n    /**\n     * Sends a request and wait for a response.\n     *\n     * Do not use this method to emit notifications! Use notification() instead.\n     */\n    request(request, resultSchema, options) {\n        const { relatedRequestId, resumptionToken, onresumptiontoken } = options !== null && options !== void 0 ? options : {};\n        return new Promise((resolve, reject) => {\n            var _a, _b, _c, _d, _e, _f;\n            if (!this._transport) {\n                reject(new Error(\"Not connected\"));\n                return;\n            }\n            if (((_a = this._options) === null || _a === void 0 ? void 0 : _a.enforceStrictCapabilities) === true) {\n                this.assertCapabilityForMethod(request.method);\n            }\n            (_b = options === null || options === void 0 ? void 0 : options.signal) === null || _b === void 0 ? void 0 : _b.throwIfAborted();\n            const messageId = this._requestMessageId++;\n            const jsonrpcRequest = {\n                ...request,\n                jsonrpc: \"2.0\",\n                id: messageId,\n            };\n            if (options === null || options === void 0 ? void 0 : options.onprogress) {\n                this._progressHandlers.set(messageId, options.onprogress);\n                jsonrpcRequest.params = {\n                    ...request.params,\n                    _meta: {\n                        ...(((_c = request.params) === null || _c === void 0 ? void 0 : _c._meta) || {}),\n                        progressToken: messageId\n                    },\n                };\n            }\n            const cancel = (reason) => {\n                var _a;\n                this._responseHandlers.delete(messageId);\n                this._progressHandlers.delete(messageId);\n                this._cleanupTimeout(messageId);\n                (_a = this._transport) === null || _a === void 0 ? void 0 : _a.send({\n                    jsonrpc: \"2.0\",\n                    method: \"notifications/cancelled\",\n                    params: {\n                        requestId: messageId,\n                        reason: String(reason),\n                    },\n                }, { relatedRequestId, resumptionToken, onresumptiontoken }).catch((error) => this._onerror(new Error(`Failed to send cancellation: ${error}`)));\n                reject(reason);\n            };\n            this._responseHandlers.set(messageId, (response) => {\n                var _a;\n                if ((_a = options === null || options === void 0 ? void 0 : options.signal) === null || _a === void 0 ? void 0 : _a.aborted) {\n                    return;\n                }\n                if (response instanceof Error) {\n                    return reject(response);\n                }\n                try {\n                    const result = resultSchema.parse(response.result);\n                    resolve(result);\n                }\n                catch (error) {\n                    reject(error);\n                }\n            });\n            (_d = options === null || options === void 0 ? void 0 : options.signal) === null || _d === void 0 ? void 0 : _d.addEventListener(\"abort\", () => {\n                var _a;\n                cancel((_a = options === null || options === void 0 ? void 0 : options.signal) === null || _a === void 0 ? void 0 : _a.reason);\n            });\n            const timeout = (_e = options === null || options === void 0 ? void 0 : options.timeout) !== null && _e !== void 0 ? _e : DEFAULT_REQUEST_TIMEOUT_MSEC;\n            const timeoutHandler = () => cancel(new McpError(ErrorCode.RequestTimeout, \"Request timed out\", { timeout }));\n            this._setupTimeout(messageId, timeout, options === null || options === void 0 ? void 0 : options.maxTotalTimeout, timeoutHandler, (_f = options === null || options === void 0 ? void 0 : options.resetTimeoutOnProgress) !== null && _f !== void 0 ? _f : false);\n            this._transport.send(jsonrpcRequest, { relatedRequestId, resumptionToken, onresumptiontoken }).catch((error) => {\n                this._cleanupTimeout(messageId);\n                reject(error);\n            });\n        });\n    }\n    /**\n     * Emits a notification, which is a one-way message that does not expect a response.\n     */\n    async notification(notification, options) {\n        var _a, _b;\n        if (!this._transport) {\n            throw new Error(\"Not connected\");\n        }\n        this.assertNotificationCapability(notification.method);\n        const debouncedMethods = (_b = (_a = this._options) === null || _a === void 0 ? void 0 : _a.debouncedNotificationMethods) !== null && _b !== void 0 ? _b : [];\n        // A notification can only be debounced if it's in the list AND it's \"simple\"\n        // (i.e., has no parameters and no related request ID that could be lost).\n        const canDebounce = debouncedMethods.includes(notification.method)\n            && !notification.params\n            && !(options === null || options === void 0 ? void 0 : options.relatedRequestId);\n        if (canDebounce) {\n            // If a notification of this type is already scheduled, do nothing.\n            if (this._pendingDebouncedNotifications.has(notification.method)) {\n                return;\n            }\n            // Mark this notification type as pending.\n            this._pendingDebouncedNotifications.add(notification.method);\n            // Schedule the actual send to happen in the next microtask.\n            // This allows all synchronous calls in the current event loop tick to be coalesced.\n            Promise.resolve().then(() => {\n                var _a;\n                // Un-mark the notification so the next one can be scheduled.\n                this._pendingDebouncedNotifications.delete(notification.method);\n                // SAFETY CHECK: If the connection was closed while this was pending, abort.\n                if (!this._transport) {\n                    return;\n                }\n                const jsonrpcNotification = {\n                    ...notification,\n                    jsonrpc: \"2.0\",\n                };\n                // Send the notification, but don't await it here to avoid blocking.\n                // Handle potential errors with a .catch().\n                (_a = this._transport) === null || _a === void 0 ? void 0 : _a.send(jsonrpcNotification, options).catch(error => this._onerror(error));\n            });\n            // Return immediately.\n            return;\n        }\n        const jsonrpcNotification = {\n            ...notification,\n            jsonrpc: \"2.0\",\n        };\n        await this._transport.send(jsonrpcNotification, options);\n    }\n    /**\n     * Registers a handler to invoke when this protocol object receives a request with the given method.\n     *\n     * Note that this will replace any previous request handler for the same method.\n     */\n    setRequestHandler(requestSchema, handler) {\n        const method = requestSchema.shape.method.value;\n        this.assertRequestHandlerCapability(method);\n        this._requestHandlers.set(method, (request, extra) => {\n            return Promise.resolve(handler(requestSchema.parse(request), extra));\n        });\n    }\n    /**\n     * Removes the request handler for the given method.\n     */\n    removeRequestHandler(method) {\n        this._requestHandlers.delete(method);\n    }\n    /**\n     * Asserts that a request handler has not already been set for the given method, in preparation for a new one being automatically installed.\n     */\n    assertCanSetRequestHandler(method) {\n        if (this._requestHandlers.has(method)) {\n            throw new Error(`A request handler for ${method} already exists, which would be overridden`);\n        }\n    }\n    /**\n     * Registers a handler to invoke when this protocol object receives a notification with the given method.\n     *\n     * Note that this will replace any previous notification handler for the same method.\n     */\n    setNotificationHandler(notificationSchema, handler) {\n        this._notificationHandlers.set(notificationSchema.shape.method.value, (notification) => Promise.resolve(handler(notificationSchema.parse(notification))));\n    }\n    /**\n     * Removes the notification handler for the given method.\n     */\n    removeNotificationHandler(method) {\n        this._notificationHandlers.delete(method);\n    }\n}\nexport function mergeCapabilities(base, additional) {\n    return Object.entries(additional).reduce((acc, [key, value]) => {\n        if (value && typeof value === \"object\") {\n            acc[key] = acc[key] ? { ...acc[key], ...value } : value;\n        }\n        else {\n            acc[key] = value;\n        }\n        return acc;\n    }, { ...base });\n}\n//# sourceMappingURL=protocol.js.map","/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.URI = global.URI || {})));\n}(this, (function (exports) { 'use strict';\n\nfunction merge() {\n    for (var _len = arguments.length, sets = Array(_len), _key = 0; _key < _len; _key++) {\n        sets[_key] = arguments[_key];\n    }\n\n    if (sets.length > 1) {\n        sets[0] = sets[0].slice(0, -1);\n        var xl = sets.length - 1;\n        for (var x = 1; x < xl; ++x) {\n            sets[x] = sets[x].slice(1, -1);\n        }\n        sets[xl] = sets[xl].slice(1);\n        return sets.join('');\n    } else {\n        return sets[0];\n    }\n}\nfunction subexp(str) {\n    return \"(?:\" + str + \")\";\n}\nfunction typeOf(o) {\n    return o === undefined ? \"undefined\" : o === null ? \"null\" : Object.prototype.toString.call(o).split(\" \").pop().split(\"]\").shift().toLowerCase();\n}\nfunction toUpperCase(str) {\n    return str.toUpperCase();\n}\nfunction toArray(obj) {\n    return obj !== undefined && obj !== null ? obj instanceof Array ? obj : typeof obj.length !== \"number\" || obj.split || obj.setInterval || obj.call ? [obj] : Array.prototype.slice.call(obj) : [];\n}\nfunction assign(target, source) {\n    var obj = target;\n    if (source) {\n        for (var key in source) {\n            obj[key] = source[key];\n        }\n    }\n    return obj;\n}\n\nfunction buildExps(isIRI) {\n    var ALPHA$$ = \"[A-Za-z]\",\n        CR$ = \"[\\\\x0D]\",\n        DIGIT$$ = \"[0-9]\",\n        DQUOTE$$ = \"[\\\\x22]\",\n        HEXDIG$$ = merge(DIGIT$$, \"[A-Fa-f]\"),\n        //case-insensitive\n    LF$$ = \"[\\\\x0A]\",\n        SP$$ = \"[\\\\x20]\",\n        PCT_ENCODED$ = subexp(subexp(\"%[EFef]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%[89A-Fa-f]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%\" + HEXDIG$$ + HEXDIG$$)),\n        //expanded\n    GEN_DELIMS$$ = \"[\\\\:\\\\/\\\\?\\\\#\\\\[\\\\]\\\\@]\",\n        SUB_DELIMS$$ = \"[\\\\!\\\\$\\\\&\\\\'\\\\(\\\\)\\\\*\\\\+\\\\,\\\\;\\\\=]\",\n        RESERVED$$ = merge(GEN_DELIMS$$, SUB_DELIMS$$),\n        UCSCHAR$$ = isIRI ? \"[\\\\xA0-\\\\u200D\\\\u2010-\\\\u2029\\\\u202F-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF]\" : \"[]\",\n        //subset, excludes bidi control characters\n    IPRIVATE$$ = isIRI ? \"[\\\\uE000-\\\\uF8FF]\" : \"[]\",\n        //subset\n    UNRESERVED$$ = merge(ALPHA$$, DIGIT$$, \"[\\\\-\\\\.\\\\_\\\\~]\", UCSCHAR$$),\n        SCHEME$ = subexp(ALPHA$$ + merge(ALPHA$$, DIGIT$$, \"[\\\\+\\\\-\\\\.]\") + \"*\"),\n        USERINFO$ = subexp(subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:]\")) + \"*\"),\n        DEC_OCTET$ = subexp(subexp(\"25[0-5]\") + \"|\" + subexp(\"2[0-4]\" + DIGIT$$) + \"|\" + subexp(\"1\" + DIGIT$$ + DIGIT$$) + \"|\" + subexp(\"[1-9]\" + DIGIT$$) + \"|\" + DIGIT$$),\n        DEC_OCTET_RELAXED$ = subexp(subexp(\"25[0-5]\") + \"|\" + subexp(\"2[0-4]\" + DIGIT$$) + \"|\" + subexp(\"1\" + DIGIT$$ + DIGIT$$) + \"|\" + subexp(\"0?[1-9]\" + DIGIT$$) + \"|0?0?\" + DIGIT$$),\n        //relaxed parsing rules\n    IPV4ADDRESS$ = subexp(DEC_OCTET_RELAXED$ + \"\\\\.\" + DEC_OCTET_RELAXED$ + \"\\\\.\" + DEC_OCTET_RELAXED$ + \"\\\\.\" + DEC_OCTET_RELAXED$),\n        H16$ = subexp(HEXDIG$$ + \"{1,4}\"),\n        LS32$ = subexp(subexp(H16$ + \"\\\\:\" + H16$) + \"|\" + IPV4ADDRESS$),\n        IPV6ADDRESS1$ = subexp(subexp(H16$ + \"\\\\:\") + \"{6}\" + LS32$),\n        //                           6( h16 \":\" ) ls32\n    IPV6ADDRESS2$ = subexp(\"\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{5}\" + LS32$),\n        //                      \"::\" 5( h16 \":\" ) ls32\n    IPV6ADDRESS3$ = subexp(subexp(H16$) + \"?\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{4}\" + LS32$),\n        //[               h16 ] \"::\" 4( h16 \":\" ) ls32\n    IPV6ADDRESS4$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,1}\" + H16$) + \"?\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{3}\" + LS32$),\n        //[ *1( h16 \":\" ) h16 ] \"::\" 3( h16 \":\" ) ls32\n    IPV6ADDRESS5$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,2}\" + H16$) + \"?\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{2}\" + LS32$),\n        //[ *2( h16 \":\" ) h16 ] \"::\" 2( h16 \":\" ) ls32\n    IPV6ADDRESS6$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,3}\" + H16$) + \"?\\\\:\\\\:\" + H16$ + \"\\\\:\" + LS32$),\n        //[ *3( h16 \":\" ) h16 ] \"::\"    h16 \":\"   ls32\n    IPV6ADDRESS7$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,4}\" + H16$) + \"?\\\\:\\\\:\" + LS32$),\n        //[ *4( h16 \":\" ) h16 ] \"::\"              ls32\n    IPV6ADDRESS8$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,5}\" + H16$) + \"?\\\\:\\\\:\" + H16$),\n        //[ *5( h16 \":\" ) h16 ] \"::\"              h16\n    IPV6ADDRESS9$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,6}\" + H16$) + \"?\\\\:\\\\:\"),\n        //[ *6( h16 \":\" ) h16 ] \"::\"\n    IPV6ADDRESS$ = subexp([IPV6ADDRESS1$, IPV6ADDRESS2$, IPV6ADDRESS3$, IPV6ADDRESS4$, IPV6ADDRESS5$, IPV6ADDRESS6$, IPV6ADDRESS7$, IPV6ADDRESS8$, IPV6ADDRESS9$].join(\"|\")),\n        ZONEID$ = subexp(subexp(UNRESERVED$$ + \"|\" + PCT_ENCODED$) + \"+\"),\n        //RFC 6874\n    IPV6ADDRZ$ = subexp(IPV6ADDRESS$ + \"\\\\%25\" + ZONEID$),\n        //RFC 6874\n    IPV6ADDRZ_RELAXED$ = subexp(IPV6ADDRESS$ + subexp(\"\\\\%25|\\\\%(?!\" + HEXDIG$$ + \"{2})\") + ZONEID$),\n        //RFC 6874, with relaxed parsing rules\n    IPVFUTURE$ = subexp(\"[vV]\" + HEXDIG$$ + \"+\\\\.\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:]\") + \"+\"),\n        IP_LITERAL$ = subexp(\"\\\\[\" + subexp(IPV6ADDRZ_RELAXED$ + \"|\" + IPV6ADDRESS$ + \"|\" + IPVFUTURE$) + \"\\\\]\"),\n        //RFC 6874\n    REG_NAME$ = subexp(subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$)) + \"*\"),\n        HOST$ = subexp(IP_LITERAL$ + \"|\" + IPV4ADDRESS$ + \"(?!\" + REG_NAME$ + \")\" + \"|\" + REG_NAME$),\n        PORT$ = subexp(DIGIT$$ + \"*\"),\n        AUTHORITY$ = subexp(subexp(USERINFO$ + \"@\") + \"?\" + HOST$ + subexp(\"\\\\:\" + PORT$) + \"?\"),\n        PCHAR$ = subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:\\\\@]\")),\n        SEGMENT$ = subexp(PCHAR$ + \"*\"),\n        SEGMENT_NZ$ = subexp(PCHAR$ + \"+\"),\n        SEGMENT_NZ_NC$ = subexp(subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\@]\")) + \"+\"),\n        PATH_ABEMPTY$ = subexp(subexp(\"\\\\/\" + SEGMENT$) + \"*\"),\n        PATH_ABSOLUTE$ = subexp(\"\\\\/\" + subexp(SEGMENT_NZ$ + PATH_ABEMPTY$) + \"?\"),\n        //simplified\n    PATH_NOSCHEME$ = subexp(SEGMENT_NZ_NC$ + PATH_ABEMPTY$),\n        //simplified\n    PATH_ROOTLESS$ = subexp(SEGMENT_NZ$ + PATH_ABEMPTY$),\n        //simplified\n    PATH_EMPTY$ = \"(?!\" + PCHAR$ + \")\",\n        PATH$ = subexp(PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_NOSCHEME$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$),\n        QUERY$ = subexp(subexp(PCHAR$ + \"|\" + merge(\"[\\\\/\\\\?]\", IPRIVATE$$)) + \"*\"),\n        FRAGMENT$ = subexp(subexp(PCHAR$ + \"|[\\\\/\\\\?]\") + \"*\"),\n        HIER_PART$ = subexp(subexp(\"\\\\/\\\\/\" + AUTHORITY$ + PATH_ABEMPTY$) + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$),\n        URI$ = subexp(SCHEME$ + \"\\\\:\" + HIER_PART$ + subexp(\"\\\\?\" + QUERY$) + \"?\" + subexp(\"\\\\#\" + FRAGMENT$) + \"?\"),\n        RELATIVE_PART$ = subexp(subexp(\"\\\\/\\\\/\" + AUTHORITY$ + PATH_ABEMPTY$) + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_NOSCHEME$ + \"|\" + PATH_EMPTY$),\n        RELATIVE$ = subexp(RELATIVE_PART$ + subexp(\"\\\\?\" + QUERY$) + \"?\" + subexp(\"\\\\#\" + FRAGMENT$) + \"?\"),\n        URI_REFERENCE$ = subexp(URI$ + \"|\" + RELATIVE$),\n        ABSOLUTE_URI$ = subexp(SCHEME$ + \"\\\\:\" + HIER_PART$ + subexp(\"\\\\?\" + QUERY$) + \"?\"),\n        GENERIC_REF$ = \"^(\" + SCHEME$ + \")\\\\:\" + subexp(subexp(\"\\\\/\\\\/(\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?)\") + \"?(\" + PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$ + \")\") + subexp(\"\\\\?(\" + QUERY$ + \")\") + \"?\" + subexp(\"\\\\#(\" + FRAGMENT$ + \")\") + \"?$\",\n        RELATIVE_REF$ = \"^(){0}\" + subexp(subexp(\"\\\\/\\\\/(\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?)\") + \"?(\" + PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_NOSCHEME$ + \"|\" + PATH_EMPTY$ + \")\") + subexp(\"\\\\?(\" + QUERY$ + \")\") + \"?\" + subexp(\"\\\\#(\" + FRAGMENT$ + \")\") + \"?$\",\n        ABSOLUTE_REF$ = \"^(\" + SCHEME$ + \")\\\\:\" + subexp(subexp(\"\\\\/\\\\/(\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?)\") + \"?(\" + PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$ + \")\") + subexp(\"\\\\?(\" + QUERY$ + \")\") + \"?$\",\n        SAMEDOC_REF$ = \"^\" + subexp(\"\\\\#(\" + FRAGMENT$ + \")\") + \"?$\",\n        AUTHORITY_REF$ = \"^\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?$\";\n    return {\n        NOT_SCHEME: new RegExp(merge(\"[^]\", ALPHA$$, DIGIT$$, \"[\\\\+\\\\-\\\\.]\"), \"g\"),\n        NOT_USERINFO: new RegExp(merge(\"[^\\\\%\\\\:]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n        NOT_HOST: new RegExp(merge(\"[^\\\\%\\\\[\\\\]\\\\:]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n        NOT_PATH: new RegExp(merge(\"[^\\\\%\\\\/\\\\:\\\\@]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n        NOT_PATH_NOSCHEME: new RegExp(merge(\"[^\\\\%\\\\/\\\\@]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n        NOT_QUERY: new RegExp(merge(\"[^\\\\%]\", UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:\\\\@\\\\/\\\\?]\", IPRIVATE$$), \"g\"),\n        NOT_FRAGMENT: new RegExp(merge(\"[^\\\\%]\", UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:\\\\@\\\\/\\\\?]\"), \"g\"),\n        ESCAPE: new RegExp(merge(\"[^]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n        UNRESERVED: new RegExp(UNRESERVED$$, \"g\"),\n        OTHER_CHARS: new RegExp(merge(\"[^\\\\%]\", UNRESERVED$$, RESERVED$$), \"g\"),\n        PCT_ENCODED: new RegExp(PCT_ENCODED$, \"g\"),\n        IPV4ADDRESS: new RegExp(\"^(\" + IPV4ADDRESS$ + \")$\"),\n        IPV6ADDRESS: new RegExp(\"^\\\\[?(\" + IPV6ADDRESS$ + \")\" + subexp(subexp(\"\\\\%25|\\\\%(?!\" + HEXDIG$$ + \"{2})\") + \"(\" + ZONEID$ + \")\") + \"?\\\\]?$\") //RFC 6874, with relaxed parsing rules\n    };\n}\nvar URI_PROTOCOL = buildExps(false);\n\nvar IRI_PROTOCOL = buildExps(true);\n\nvar slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar toConsumableArray = function (arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n};\n\n/** Highest positive signed 32-bit float value */\n\nvar maxInt = 2147483647; // aka. 0x7FFFFFFF or 2^31-1\n\n/** Bootstring parameters */\nvar base = 36;\nvar tMin = 1;\nvar tMax = 26;\nvar skew = 38;\nvar damp = 700;\nvar initialBias = 72;\nvar initialN = 128; // 0x80\nvar delimiter = '-'; // '\\x2D'\n\n/** Regular expressions */\nvar regexPunycode = /^xn--/;\nvar regexNonASCII = /[^\\0-\\x7E]/; // non-ASCII chars\nvar regexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g; // RFC 3490 separators\n\n/** Error messages */\nvar errors = {\n\t'overflow': 'Overflow: input needs wider integers to process',\n\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t'invalid-input': 'Invalid input'\n};\n\n/** Convenience shortcuts */\nvar baseMinusTMin = base - tMin;\nvar floor = Math.floor;\nvar stringFromCharCode = String.fromCharCode;\n\n/*--------------------------------------------------------------------------*/\n\n/**\n * A generic error utility function.\n * @private\n * @param {String} type The error type.\n * @returns {Error} Throws a `RangeError` with the applicable error message.\n */\nfunction error$1(type) {\n\tthrow new RangeError(errors[type]);\n}\n\n/**\n * A generic `Array#map` utility function.\n * @private\n * @param {Array} array The array to iterate over.\n * @param {Function} callback The function that gets called for every array\n * item.\n * @returns {Array} A new array of values returned by the callback function.\n */\nfunction map(array, fn) {\n\tvar result = [];\n\tvar length = array.length;\n\twhile (length--) {\n\t\tresult[length] = fn(array[length]);\n\t}\n\treturn result;\n}\n\n/**\n * A simple `Array#map`-like wrapper to work with domain name strings or email\n * addresses.\n * @private\n * @param {String} domain The domain name or email address.\n * @param {Function} callback The function that gets called for every\n * character.\n * @returns {Array} A new string of characters returned by the callback\n * function.\n */\nfunction mapDomain(string, fn) {\n\tvar parts = string.split('@');\n\tvar result = '';\n\tif (parts.length > 1) {\n\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t// the local part (i.e. everything up to `@`) intact.\n\t\tresult = parts[0] + '@';\n\t\tstring = parts[1];\n\t}\n\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\tstring = string.replace(regexSeparators, '\\x2E');\n\tvar labels = string.split('.');\n\tvar encoded = map(labels, fn).join('.');\n\treturn result + encoded;\n}\n\n/**\n * Creates an array containing the numeric code points of each Unicode\n * character in the string. While JavaScript uses UCS-2 internally,\n * this function will convert a pair of surrogate halves (each of which\n * UCS-2 exposes as separate characters) into a single code point,\n * matching UTF-16.\n * @see `punycode.ucs2.encode`\n * @see <https://mathiasbynens.be/notes/javascript-encoding>\n * @memberOf punycode.ucs2\n * @name decode\n * @param {String} string The Unicode input string (UCS-2).\n * @returns {Array} The new array of code points.\n */\nfunction ucs2decode(string) {\n\tvar output = [];\n\tvar counter = 0;\n\tvar length = string.length;\n\twhile (counter < length) {\n\t\tvar value = string.charCodeAt(counter++);\n\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t// It's a high surrogate, and there is a next character.\n\t\t\tvar extra = string.charCodeAt(counter++);\n\t\t\tif ((extra & 0xFC00) == 0xDC00) {\n\t\t\t\t// Low surrogate.\n\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t} else {\n\t\t\t\t// It's an unmatched surrogate; only append this code unit, in case the\n\t\t\t\t// next code unit is the high surrogate of a surrogate pair.\n\t\t\t\toutput.push(value);\n\t\t\t\tcounter--;\n\t\t\t}\n\t\t} else {\n\t\t\toutput.push(value);\n\t\t}\n\t}\n\treturn output;\n}\n\n/**\n * Creates a string based on an array of numeric code points.\n * @see `punycode.ucs2.decode`\n * @memberOf punycode.ucs2\n * @name encode\n * @param {Array} codePoints The array of numeric code points.\n * @returns {String} The new Unicode string (UCS-2).\n */\nvar ucs2encode = function ucs2encode(array) {\n\treturn String.fromCodePoint.apply(String, toConsumableArray(array));\n};\n\n/**\n * Converts a basic code point into a digit/integer.\n * @see `digitToBasic()`\n * @private\n * @param {Number} codePoint The basic numeric code point value.\n * @returns {Number} The numeric value of a basic code point (for use in\n * representing integers) in the range `0` to `base - 1`, or `base` if\n * the code point does not represent a value.\n */\nvar basicToDigit = function basicToDigit(codePoint) {\n\tif (codePoint - 0x30 < 0x0A) {\n\t\treturn codePoint - 0x16;\n\t}\n\tif (codePoint - 0x41 < 0x1A) {\n\t\treturn codePoint - 0x41;\n\t}\n\tif (codePoint - 0x61 < 0x1A) {\n\t\treturn codePoint - 0x61;\n\t}\n\treturn base;\n};\n\n/**\n * Converts a digit/integer into a basic code point.\n * @see `basicToDigit()`\n * @private\n * @param {Number} digit The numeric value of a basic code point.\n * @returns {Number} The basic code point whose value (when used for\n * representing integers) is `digit`, which needs to be in the range\n * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n * used; else, the lowercase form is used. The behavior is undefined\n * if `flag` is non-zero and `digit` has no uppercase form.\n */\nvar digitToBasic = function digitToBasic(digit, flag) {\n\t//  0..25 map to ASCII a..z or A..Z\n\t// 26..35 map to ASCII 0..9\n\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n};\n\n/**\n * Bias adaptation function as per section 3.4 of RFC 3492.\n * https://tools.ietf.org/html/rfc3492#section-3.4\n * @private\n */\nvar adapt = function adapt(delta, numPoints, firstTime) {\n\tvar k = 0;\n\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\tdelta += floor(delta / numPoints);\n\tfor (; /* no initialization */delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\tdelta = floor(delta / baseMinusTMin);\n\t}\n\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n};\n\n/**\n * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n * symbols.\n * @memberOf punycode\n * @param {String} input The Punycode string of ASCII-only symbols.\n * @returns {String} The resulting string of Unicode symbols.\n */\nvar decode = function decode(input) {\n\t// Don't use UCS-2.\n\tvar output = [];\n\tvar inputLength = input.length;\n\tvar i = 0;\n\tvar n = initialN;\n\tvar bias = initialBias;\n\n\t// Handle the basic code points: let `basic` be the number of input code\n\t// points before the last delimiter, or `0` if there is none, then copy\n\t// the first basic code points to the output.\n\n\tvar basic = input.lastIndexOf(delimiter);\n\tif (basic < 0) {\n\t\tbasic = 0;\n\t}\n\n\tfor (var j = 0; j < basic; ++j) {\n\t\t// if it's not a basic code point\n\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\terror$1('not-basic');\n\t\t}\n\t\toutput.push(input.charCodeAt(j));\n\t}\n\n\t// Main decoding loop: start just after the last delimiter if any basic code\n\t// points were copied; start at the beginning otherwise.\n\n\tfor (var index = basic > 0 ? basic + 1 : 0; index < inputLength;) /* no final expression */{\n\n\t\t// `index` is the index of the next character to be consumed.\n\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t// which gets added to `i`. The overflow checking is easier\n\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t// value at the end to obtain `delta`.\n\t\tvar oldi = i;\n\t\tfor (var w = 1, k = base;; /* no condition */k += base) {\n\n\t\t\tif (index >= inputLength) {\n\t\t\t\terror$1('invalid-input');\n\t\t\t}\n\n\t\t\tvar digit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\terror$1('overflow');\n\t\t\t}\n\n\t\t\ti += digit * w;\n\t\t\tvar t = k <= bias ? tMin : k >= bias + tMax ? tMax : k - bias;\n\n\t\t\tif (digit < t) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvar baseMinusT = base - t;\n\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\terror$1('overflow');\n\t\t\t}\n\n\t\t\tw *= baseMinusT;\n\t\t}\n\n\t\tvar out = output.length + 1;\n\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t// incrementing `n` each time, so we'll fix that now:\n\t\tif (floor(i / out) > maxInt - n) {\n\t\t\terror$1('overflow');\n\t\t}\n\n\t\tn += floor(i / out);\n\t\ti %= out;\n\n\t\t// Insert `n` at position `i` of the output.\n\t\toutput.splice(i++, 0, n);\n\t}\n\n\treturn String.fromCodePoint.apply(String, output);\n};\n\n/**\n * Converts a string of Unicode symbols (e.g. a domain name label) to a\n * Punycode string of ASCII-only symbols.\n * @memberOf punycode\n * @param {String} input The string of Unicode symbols.\n * @returns {String} The resulting Punycode string of ASCII-only symbols.\n */\nvar encode = function encode(input) {\n\tvar output = [];\n\n\t// Convert the input in UCS-2 to an array of Unicode code points.\n\tinput = ucs2decode(input);\n\n\t// Cache the length.\n\tvar inputLength = input.length;\n\n\t// Initialize the state.\n\tvar n = initialN;\n\tvar delta = 0;\n\tvar bias = initialBias;\n\n\t// Handle the basic code points.\n\tvar _iteratorNormalCompletion = true;\n\tvar _didIteratorError = false;\n\tvar _iteratorError = undefined;\n\n\ttry {\n\t\tfor (var _iterator = input[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\tvar _currentValue2 = _step.value;\n\n\t\t\tif (_currentValue2 < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(_currentValue2));\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\t_didIteratorError = true;\n\t\t_iteratorError = err;\n\t} finally {\n\t\ttry {\n\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t_iterator.return();\n\t\t\t}\n\t\t} finally {\n\t\t\tif (_didIteratorError) {\n\t\t\t\tthrow _iteratorError;\n\t\t\t}\n\t\t}\n\t}\n\n\tvar basicLength = output.length;\n\tvar handledCPCount = basicLength;\n\n\t// `handledCPCount` is the number of code points that have been handled;\n\t// `basicLength` is the number of basic code points.\n\n\t// Finish the basic string with a delimiter unless it's empty.\n\tif (basicLength) {\n\t\toutput.push(delimiter);\n\t}\n\n\t// Main encoding loop:\n\twhile (handledCPCount < inputLength) {\n\n\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t// larger one:\n\t\tvar m = maxInt;\n\t\tvar _iteratorNormalCompletion2 = true;\n\t\tvar _didIteratorError2 = false;\n\t\tvar _iteratorError2 = undefined;\n\n\t\ttry {\n\t\t\tfor (var _iterator2 = input[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\tvar currentValue = _step2.value;\n\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow.\n\t\t} catch (err) {\n\t\t\t_didIteratorError2 = true;\n\t\t\t_iteratorError2 = err;\n\t\t} finally {\n\t\t\ttry {\n\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t_iterator2.return();\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar handledCPCountPlusOne = handledCPCount + 1;\n\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\terror$1('overflow');\n\t\t}\n\n\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\tn = m;\n\n\t\tvar _iteratorNormalCompletion3 = true;\n\t\tvar _didIteratorError3 = false;\n\t\tvar _iteratorError3 = undefined;\n\n\t\ttry {\n\t\t\tfor (var _iterator3 = input[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n\t\t\t\tvar _currentValue = _step3.value;\n\n\t\t\t\tif (_currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror$1('overflow');\n\t\t\t\t}\n\t\t\t\tif (_currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer.\n\t\t\t\t\tvar q = delta;\n\t\t\t\t\tfor (var k = base;; /* no condition */k += base) {\n\t\t\t\t\t\tvar t = k <= bias ? tMin : k >= bias + tMax ? tMax : k - bias;\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar qMinusT = q - t;\n\t\t\t\t\t\tvar baseMinusT = base - t;\n\t\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0)));\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t_didIteratorError3 = true;\n\t\t\t_iteratorError3 = err;\n\t\t} finally {\n\t\t\ttry {\n\t\t\t\tif (!_iteratorNormalCompletion3 && _iterator3.return) {\n\t\t\t\t\t_iterator3.return();\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tif (_didIteratorError3) {\n\t\t\t\t\tthrow _iteratorError3;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t++delta;\n\t\t++n;\n\t}\n\treturn output.join('');\n};\n\n/**\n * Converts a Punycode string representing a domain name or an email address\n * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n * it doesn't matter if you call it on a string that has already been\n * converted to Unicode.\n * @memberOf punycode\n * @param {String} input The Punycoded domain name or email address to\n * convert to Unicode.\n * @returns {String} The Unicode representation of the given Punycode\n * string.\n */\nvar toUnicode = function toUnicode(input) {\n\treturn mapDomain(input, function (string) {\n\t\treturn regexPunycode.test(string) ? decode(string.slice(4).toLowerCase()) : string;\n\t});\n};\n\n/**\n * Converts a Unicode string representing a domain name or an email address to\n * Punycode. Only the non-ASCII parts of the domain name will be converted,\n * i.e. it doesn't matter if you call it with a domain that's already in\n * ASCII.\n * @memberOf punycode\n * @param {String} input The domain name or email address to convert, as a\n * Unicode string.\n * @returns {String} The Punycode representation of the given domain name or\n * email address.\n */\nvar toASCII = function toASCII(input) {\n\treturn mapDomain(input, function (string) {\n\t\treturn regexNonASCII.test(string) ? 'xn--' + encode(string) : string;\n\t});\n};\n\n/*--------------------------------------------------------------------------*/\n\n/** Define the public API */\nvar punycode = {\n\t/**\n  * A string representing the current Punycode.js version number.\n  * @memberOf punycode\n  * @type String\n  */\n\t'version': '2.1.0',\n\t/**\n  * An object of methods to convert from JavaScript's internal character\n  * representation (UCS-2) to Unicode code points, and back.\n  * @see <https://mathiasbynens.be/notes/javascript-encoding>\n  * @memberOf punycode\n  * @type Object\n  */\n\t'ucs2': {\n\t\t'decode': ucs2decode,\n\t\t'encode': ucs2encode\n\t},\n\t'decode': decode,\n\t'encode': encode,\n\t'toASCII': toASCII,\n\t'toUnicode': toUnicode\n};\n\n/**\n * URI.js\n *\n * @fileoverview An RFC 3986 compliant, scheme extendable URI parsing/validating/resolving library for JavaScript.\n * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\n * @see http://github.com/garycourt/uri-js\n */\n/**\n * Copyright 2011 Gary Court. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification, are\n * permitted provided that the following conditions are met:\n *\n *    1. Redistributions of source code must retain the above copyright notice, this list of\n *       conditions and the following disclaimer.\n *\n *    2. Redistributions in binary form must reproduce the above copyright notice, this list\n *       of conditions and the following disclaimer in the documentation and/or other materials\n *       provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY GARY COURT ``AS IS'' AND ANY EXPRESS OR IMPLIED\n * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL GARY COURT OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF\n * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those of the\n * authors and should not be interpreted as representing official policies, either expressed\n * or implied, of Gary Court.\n */\nvar SCHEMES = {};\nfunction pctEncChar(chr) {\n    var c = chr.charCodeAt(0);\n    var e = void 0;\n    if (c < 16) e = \"%0\" + c.toString(16).toUpperCase();else if (c < 128) e = \"%\" + c.toString(16).toUpperCase();else if (c < 2048) e = \"%\" + (c >> 6 | 192).toString(16).toUpperCase() + \"%\" + (c & 63 | 128).toString(16).toUpperCase();else e = \"%\" + (c >> 12 | 224).toString(16).toUpperCase() + \"%\" + (c >> 6 & 63 | 128).toString(16).toUpperCase() + \"%\" + (c & 63 | 128).toString(16).toUpperCase();\n    return e;\n}\nfunction pctDecChars(str) {\n    var newStr = \"\";\n    var i = 0;\n    var il = str.length;\n    while (i < il) {\n        var c = parseInt(str.substr(i + 1, 2), 16);\n        if (c < 128) {\n            newStr += String.fromCharCode(c);\n            i += 3;\n        } else if (c >= 194 && c < 224) {\n            if (il - i >= 6) {\n                var c2 = parseInt(str.substr(i + 4, 2), 16);\n                newStr += String.fromCharCode((c & 31) << 6 | c2 & 63);\n            } else {\n                newStr += str.substr(i, 6);\n            }\n            i += 6;\n        } else if (c >= 224) {\n            if (il - i >= 9) {\n                var _c = parseInt(str.substr(i + 4, 2), 16);\n                var c3 = parseInt(str.substr(i + 7, 2), 16);\n                newStr += String.fromCharCode((c & 15) << 12 | (_c & 63) << 6 | c3 & 63);\n            } else {\n                newStr += str.substr(i, 9);\n            }\n            i += 9;\n        } else {\n            newStr += str.substr(i, 3);\n            i += 3;\n        }\n    }\n    return newStr;\n}\nfunction _normalizeComponentEncoding(components, protocol) {\n    function decodeUnreserved(str) {\n        var decStr = pctDecChars(str);\n        return !decStr.match(protocol.UNRESERVED) ? str : decStr;\n    }\n    if (components.scheme) components.scheme = String(components.scheme).replace(protocol.PCT_ENCODED, decodeUnreserved).toLowerCase().replace(protocol.NOT_SCHEME, \"\");\n    if (components.userinfo !== undefined) components.userinfo = String(components.userinfo).replace(protocol.PCT_ENCODED, decodeUnreserved).replace(protocol.NOT_USERINFO, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n    if (components.host !== undefined) components.host = String(components.host).replace(protocol.PCT_ENCODED, decodeUnreserved).toLowerCase().replace(protocol.NOT_HOST, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n    if (components.path !== undefined) components.path = String(components.path).replace(protocol.PCT_ENCODED, decodeUnreserved).replace(components.scheme ? protocol.NOT_PATH : protocol.NOT_PATH_NOSCHEME, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n    if (components.query !== undefined) components.query = String(components.query).replace(protocol.PCT_ENCODED, decodeUnreserved).replace(protocol.NOT_QUERY, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n    if (components.fragment !== undefined) components.fragment = String(components.fragment).replace(protocol.PCT_ENCODED, decodeUnreserved).replace(protocol.NOT_FRAGMENT, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n    return components;\n}\n\nfunction _stripLeadingZeros(str) {\n    return str.replace(/^0*(.*)/, \"$1\") || \"0\";\n}\nfunction _normalizeIPv4(host, protocol) {\n    var matches = host.match(protocol.IPV4ADDRESS) || [];\n\n    var _matches = slicedToArray(matches, 2),\n        address = _matches[1];\n\n    if (address) {\n        return address.split(\".\").map(_stripLeadingZeros).join(\".\");\n    } else {\n        return host;\n    }\n}\nfunction _normalizeIPv6(host, protocol) {\n    var matches = host.match(protocol.IPV6ADDRESS) || [];\n\n    var _matches2 = slicedToArray(matches, 3),\n        address = _matches2[1],\n        zone = _matches2[2];\n\n    if (address) {\n        var _address$toLowerCase$ = address.toLowerCase().split('::').reverse(),\n            _address$toLowerCase$2 = slicedToArray(_address$toLowerCase$, 2),\n            last = _address$toLowerCase$2[0],\n            first = _address$toLowerCase$2[1];\n\n        var firstFields = first ? first.split(\":\").map(_stripLeadingZeros) : [];\n        var lastFields = last.split(\":\").map(_stripLeadingZeros);\n        var isLastFieldIPv4Address = protocol.IPV4ADDRESS.test(lastFields[lastFields.length - 1]);\n        var fieldCount = isLastFieldIPv4Address ? 7 : 8;\n        var lastFieldsStart = lastFields.length - fieldCount;\n        var fields = Array(fieldCount);\n        for (var x = 0; x < fieldCount; ++x) {\n            fields[x] = firstFields[x] || lastFields[lastFieldsStart + x] || '';\n        }\n        if (isLastFieldIPv4Address) {\n            fields[fieldCount - 1] = _normalizeIPv4(fields[fieldCount - 1], protocol);\n        }\n        var allZeroFields = fields.reduce(function (acc, field, index) {\n            if (!field || field === \"0\") {\n                var lastLongest = acc[acc.length - 1];\n                if (lastLongest && lastLongest.index + lastLongest.length === index) {\n                    lastLongest.length++;\n                } else {\n                    acc.push({ index: index, length: 1 });\n                }\n            }\n            return acc;\n        }, []);\n        var longestZeroFields = allZeroFields.sort(function (a, b) {\n            return b.length - a.length;\n        })[0];\n        var newHost = void 0;\n        if (longestZeroFields && longestZeroFields.length > 1) {\n            var newFirst = fields.slice(0, longestZeroFields.index);\n            var newLast = fields.slice(longestZeroFields.index + longestZeroFields.length);\n            newHost = newFirst.join(\":\") + \"::\" + newLast.join(\":\");\n        } else {\n            newHost = fields.join(\":\");\n        }\n        if (zone) {\n            newHost += \"%\" + zone;\n        }\n        return newHost;\n    } else {\n        return host;\n    }\n}\nvar URI_PARSE = /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:([^\\/?#@]*)@)?(\\[[^\\/?#\\]]+\\]|[^\\/?#:]*)(?:\\:(\\d*))?))?([^?#]*)(?:\\?([^#]*))?(?:#((?:.|\\n|\\r)*))?/i;\nvar NO_MATCH_IS_UNDEFINED = \"\".match(/(){0}/)[1] === undefined;\nfunction parse(uriString) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var components = {};\n    var protocol = options.iri !== false ? IRI_PROTOCOL : URI_PROTOCOL;\n    if (options.reference === \"suffix\") uriString = (options.scheme ? options.scheme + \":\" : \"\") + \"//\" + uriString;\n    var matches = uriString.match(URI_PARSE);\n    if (matches) {\n        if (NO_MATCH_IS_UNDEFINED) {\n            //store each component\n            components.scheme = matches[1];\n            components.userinfo = matches[3];\n            components.host = matches[4];\n            components.port = parseInt(matches[5], 10);\n            components.path = matches[6] || \"\";\n            components.query = matches[7];\n            components.fragment = matches[8];\n            //fix port number\n            if (isNaN(components.port)) {\n                components.port = matches[5];\n            }\n        } else {\n            //IE FIX for improper RegExp matching\n            //store each component\n            components.scheme = matches[1] || undefined;\n            components.userinfo = uriString.indexOf(\"@\") !== -1 ? matches[3] : undefined;\n            components.host = uriString.indexOf(\"//\") !== -1 ? matches[4] : undefined;\n            components.port = parseInt(matches[5], 10);\n            components.path = matches[6] || \"\";\n            components.query = uriString.indexOf(\"?\") !== -1 ? matches[7] : undefined;\n            components.fragment = uriString.indexOf(\"#\") !== -1 ? matches[8] : undefined;\n            //fix port number\n            if (isNaN(components.port)) {\n                components.port = uriString.match(/\\/\\/(?:.|\\n)*\\:(?:\\/|\\?|\\#|$)/) ? matches[4] : undefined;\n            }\n        }\n        if (components.host) {\n            //normalize IP hosts\n            components.host = _normalizeIPv6(_normalizeIPv4(components.host, protocol), protocol);\n        }\n        //determine reference type\n        if (components.scheme === undefined && components.userinfo === undefined && components.host === undefined && components.port === undefined && !components.path && components.query === undefined) {\n            components.reference = \"same-document\";\n        } else if (components.scheme === undefined) {\n            components.reference = \"relative\";\n        } else if (components.fragment === undefined) {\n            components.reference = \"absolute\";\n        } else {\n            components.reference = \"uri\";\n        }\n        //check for reference errors\n        if (options.reference && options.reference !== \"suffix\" && options.reference !== components.reference) {\n            components.error = components.error || \"URI is not a \" + options.reference + \" reference.\";\n        }\n        //find scheme handler\n        var schemeHandler = SCHEMES[(options.scheme || components.scheme || \"\").toLowerCase()];\n        //check if scheme can't handle IRIs\n        if (!options.unicodeSupport && (!schemeHandler || !schemeHandler.unicodeSupport)) {\n            //if host component is a domain name\n            if (components.host && (options.domainHost || schemeHandler && schemeHandler.domainHost)) {\n                //convert Unicode IDN -> ASCII IDN\n                try {\n                    components.host = punycode.toASCII(components.host.replace(protocol.PCT_ENCODED, pctDecChars).toLowerCase());\n                } catch (e) {\n                    components.error = components.error || \"Host's domain name can not be converted to ASCII via punycode: \" + e;\n                }\n            }\n            //convert IRI -> URI\n            _normalizeComponentEncoding(components, URI_PROTOCOL);\n        } else {\n            //normalize encodings\n            _normalizeComponentEncoding(components, protocol);\n        }\n        //perform scheme specific parsing\n        if (schemeHandler && schemeHandler.parse) {\n            schemeHandler.parse(components, options);\n        }\n    } else {\n        components.error = components.error || \"URI can not be parsed.\";\n    }\n    return components;\n}\n\nfunction _recomposeAuthority(components, options) {\n    var protocol = options.iri !== false ? IRI_PROTOCOL : URI_PROTOCOL;\n    var uriTokens = [];\n    if (components.userinfo !== undefined) {\n        uriTokens.push(components.userinfo);\n        uriTokens.push(\"@\");\n    }\n    if (components.host !== undefined) {\n        //normalize IP hosts, add brackets and escape zone separator for IPv6\n        uriTokens.push(_normalizeIPv6(_normalizeIPv4(String(components.host), protocol), protocol).replace(protocol.IPV6ADDRESS, function (_, $1, $2) {\n            return \"[\" + $1 + ($2 ? \"%25\" + $2 : \"\") + \"]\";\n        }));\n    }\n    if (typeof components.port === \"number\" || typeof components.port === \"string\") {\n        uriTokens.push(\":\");\n        uriTokens.push(String(components.port));\n    }\n    return uriTokens.length ? uriTokens.join(\"\") : undefined;\n}\n\nvar RDS1 = /^\\.\\.?\\//;\nvar RDS2 = /^\\/\\.(\\/|$)/;\nvar RDS3 = /^\\/\\.\\.(\\/|$)/;\nvar RDS5 = /^\\/?(?:.|\\n)*?(?=\\/|$)/;\nfunction removeDotSegments(input) {\n    var output = [];\n    while (input.length) {\n        if (input.match(RDS1)) {\n            input = input.replace(RDS1, \"\");\n        } else if (input.match(RDS2)) {\n            input = input.replace(RDS2, \"/\");\n        } else if (input.match(RDS3)) {\n            input = input.replace(RDS3, \"/\");\n            output.pop();\n        } else if (input === \".\" || input === \"..\") {\n            input = \"\";\n        } else {\n            var im = input.match(RDS5);\n            if (im) {\n                var s = im[0];\n                input = input.slice(s.length);\n                output.push(s);\n            } else {\n                throw new Error(\"Unexpected dot segment condition\");\n            }\n        }\n    }\n    return output.join(\"\");\n}\n\nfunction serialize(components) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var protocol = options.iri ? IRI_PROTOCOL : URI_PROTOCOL;\n    var uriTokens = [];\n    //find scheme handler\n    var schemeHandler = SCHEMES[(options.scheme || components.scheme || \"\").toLowerCase()];\n    //perform scheme specific serialization\n    if (schemeHandler && schemeHandler.serialize) schemeHandler.serialize(components, options);\n    if (components.host) {\n        //if host component is an IPv6 address\n        if (protocol.IPV6ADDRESS.test(components.host)) {}\n        //TODO: normalize IPv6 address as per RFC 5952\n\n        //if host component is a domain name\n        else if (options.domainHost || schemeHandler && schemeHandler.domainHost) {\n                //convert IDN via punycode\n                try {\n                    components.host = !options.iri ? punycode.toASCII(components.host.replace(protocol.PCT_ENCODED, pctDecChars).toLowerCase()) : punycode.toUnicode(components.host);\n                } catch (e) {\n                    components.error = components.error || \"Host's domain name can not be converted to \" + (!options.iri ? \"ASCII\" : \"Unicode\") + \" via punycode: \" + e;\n                }\n            }\n    }\n    //normalize encoding\n    _normalizeComponentEncoding(components, protocol);\n    if (options.reference !== \"suffix\" && components.scheme) {\n        uriTokens.push(components.scheme);\n        uriTokens.push(\":\");\n    }\n    var authority = _recomposeAuthority(components, options);\n    if (authority !== undefined) {\n        if (options.reference !== \"suffix\") {\n            uriTokens.push(\"//\");\n        }\n        uriTokens.push(authority);\n        if (components.path && components.path.charAt(0) !== \"/\") {\n            uriTokens.push(\"/\");\n        }\n    }\n    if (components.path !== undefined) {\n        var s = components.path;\n        if (!options.absolutePath && (!schemeHandler || !schemeHandler.absolutePath)) {\n            s = removeDotSegments(s);\n        }\n        if (authority === undefined) {\n            s = s.replace(/^\\/\\//, \"/%2F\"); //don't allow the path to start with \"//\"\n        }\n        uriTokens.push(s);\n    }\n    if (components.query !== undefined) {\n        uriTokens.push(\"?\");\n        uriTokens.push(components.query);\n    }\n    if (components.fragment !== undefined) {\n        uriTokens.push(\"#\");\n        uriTokens.push(components.fragment);\n    }\n    return uriTokens.join(\"\"); //merge tokens into a string\n}\n\nfunction resolveComponents(base, relative) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var skipNormalization = arguments[3];\n\n    var target = {};\n    if (!skipNormalization) {\n        base = parse(serialize(base, options), options); //normalize base components\n        relative = parse(serialize(relative, options), options); //normalize relative components\n    }\n    options = options || {};\n    if (!options.tolerant && relative.scheme) {\n        target.scheme = relative.scheme;\n        //target.authority = relative.authority;\n        target.userinfo = relative.userinfo;\n        target.host = relative.host;\n        target.port = relative.port;\n        target.path = removeDotSegments(relative.path || \"\");\n        target.query = relative.query;\n    } else {\n        if (relative.userinfo !== undefined || relative.host !== undefined || relative.port !== undefined) {\n            //target.authority = relative.authority;\n            target.userinfo = relative.userinfo;\n            target.host = relative.host;\n            target.port = relative.port;\n            target.path = removeDotSegments(relative.path || \"\");\n            target.query = relative.query;\n        } else {\n            if (!relative.path) {\n                target.path = base.path;\n                if (relative.query !== undefined) {\n                    target.query = relative.query;\n                } else {\n                    target.query = base.query;\n                }\n            } else {\n                if (relative.path.charAt(0) === \"/\") {\n                    target.path = removeDotSegments(relative.path);\n                } else {\n                    if ((base.userinfo !== undefined || base.host !== undefined || base.port !== undefined) && !base.path) {\n                        target.path = \"/\" + relative.path;\n                    } else if (!base.path) {\n                        target.path = relative.path;\n                    } else {\n                        target.path = base.path.slice(0, base.path.lastIndexOf(\"/\") + 1) + relative.path;\n                    }\n                    target.path = removeDotSegments(target.path);\n                }\n                target.query = relative.query;\n            }\n            //target.authority = base.authority;\n            target.userinfo = base.userinfo;\n            target.host = base.host;\n            target.port = base.port;\n        }\n        target.scheme = base.scheme;\n    }\n    target.fragment = relative.fragment;\n    return target;\n}\n\nfunction resolve(baseURI, relativeURI, options) {\n    var schemelessOptions = assign({ scheme: 'null' }, options);\n    return serialize(resolveComponents(parse(baseURI, schemelessOptions), parse(relativeURI, schemelessOptions), schemelessOptions, true), schemelessOptions);\n}\n\nfunction normalize(uri, options) {\n    if (typeof uri === \"string\") {\n        uri = serialize(parse(uri, options), options);\n    } else if (typeOf(uri) === \"object\") {\n        uri = parse(serialize(uri, options), options);\n    }\n    return uri;\n}\n\nfunction equal(uriA, uriB, options) {\n    if (typeof uriA === \"string\") {\n        uriA = serialize(parse(uriA, options), options);\n    } else if (typeOf(uriA) === \"object\") {\n        uriA = serialize(uriA, options);\n    }\n    if (typeof uriB === \"string\") {\n        uriB = serialize(parse(uriB, options), options);\n    } else if (typeOf(uriB) === \"object\") {\n        uriB = serialize(uriB, options);\n    }\n    return uriA === uriB;\n}\n\nfunction escapeComponent(str, options) {\n    return str && str.toString().replace(!options || !options.iri ? URI_PROTOCOL.ESCAPE : IRI_PROTOCOL.ESCAPE, pctEncChar);\n}\n\nfunction unescapeComponent(str, options) {\n    return str && str.toString().replace(!options || !options.iri ? URI_PROTOCOL.PCT_ENCODED : IRI_PROTOCOL.PCT_ENCODED, pctDecChars);\n}\n\nvar handler = {\n    scheme: \"http\",\n    domainHost: true,\n    parse: function parse(components, options) {\n        //report missing host\n        if (!components.host) {\n            components.error = components.error || \"HTTP URIs must have a host.\";\n        }\n        return components;\n    },\n    serialize: function serialize(components, options) {\n        var secure = String(components.scheme).toLowerCase() === \"https\";\n        //normalize the default port\n        if (components.port === (secure ? 443 : 80) || components.port === \"\") {\n            components.port = undefined;\n        }\n        //normalize the empty path\n        if (!components.path) {\n            components.path = \"/\";\n        }\n        //NOTE: We do not parse query strings for HTTP URIs\n        //as WWW Form Url Encoded query strings are part of the HTML4+ spec,\n        //and not the HTTP spec.\n        return components;\n    }\n};\n\nvar handler$1 = {\n    scheme: \"https\",\n    domainHost: handler.domainHost,\n    parse: handler.parse,\n    serialize: handler.serialize\n};\n\nfunction isSecure(wsComponents) {\n    return typeof wsComponents.secure === 'boolean' ? wsComponents.secure : String(wsComponents.scheme).toLowerCase() === \"wss\";\n}\n//RFC 6455\nvar handler$2 = {\n    scheme: \"ws\",\n    domainHost: true,\n    parse: function parse(components, options) {\n        var wsComponents = components;\n        //indicate if the secure flag is set\n        wsComponents.secure = isSecure(wsComponents);\n        //construct resouce name\n        wsComponents.resourceName = (wsComponents.path || '/') + (wsComponents.query ? '?' + wsComponents.query : '');\n        wsComponents.path = undefined;\n        wsComponents.query = undefined;\n        return wsComponents;\n    },\n    serialize: function serialize(wsComponents, options) {\n        //normalize the default port\n        if (wsComponents.port === (isSecure(wsComponents) ? 443 : 80) || wsComponents.port === \"\") {\n            wsComponents.port = undefined;\n        }\n        //ensure scheme matches secure flag\n        if (typeof wsComponents.secure === 'boolean') {\n            wsComponents.scheme = wsComponents.secure ? 'wss' : 'ws';\n            wsComponents.secure = undefined;\n        }\n        //reconstruct path from resource name\n        if (wsComponents.resourceName) {\n            var _wsComponents$resourc = wsComponents.resourceName.split('?'),\n                _wsComponents$resourc2 = slicedToArray(_wsComponents$resourc, 2),\n                path = _wsComponents$resourc2[0],\n                query = _wsComponents$resourc2[1];\n\n            wsComponents.path = path && path !== '/' ? path : undefined;\n            wsComponents.query = query;\n            wsComponents.resourceName = undefined;\n        }\n        //forbid fragment component\n        wsComponents.fragment = undefined;\n        return wsComponents;\n    }\n};\n\nvar handler$3 = {\n    scheme: \"wss\",\n    domainHost: handler$2.domainHost,\n    parse: handler$2.parse,\n    serialize: handler$2.serialize\n};\n\nvar O = {};\nvar isIRI = true;\n//RFC 3986\nvar UNRESERVED$$ = \"[A-Za-z0-9\\\\-\\\\.\\\\_\\\\~\" + (isIRI ? \"\\\\xA0-\\\\u200D\\\\u2010-\\\\u2029\\\\u202F-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF\" : \"\") + \"]\";\nvar HEXDIG$$ = \"[0-9A-Fa-f]\"; //case-insensitive\nvar PCT_ENCODED$ = subexp(subexp(\"%[EFef]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%[89A-Fa-f]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%\" + HEXDIG$$ + HEXDIG$$)); //expanded\n//RFC 5322, except these symbols as per RFC 6068: @ : / ? # [ ] & ; =\n//const ATEXT$$ = \"[A-Za-z0-9\\\\!\\\\#\\\\$\\\\%\\\\&\\\\'\\\\*\\\\+\\\\-\\\\/\\\\=\\\\?\\\\^\\\\_\\\\`\\\\{\\\\|\\\\}\\\\~]\";\n//const WSP$$ = \"[\\\\x20\\\\x09]\";\n//const OBS_QTEXT$$ = \"[\\\\x01-\\\\x08\\\\x0B\\\\x0C\\\\x0E-\\\\x1F\\\\x7F]\";  //(%d1-8 / %d11-12 / %d14-31 / %d127)\n//const QTEXT$$ = merge(\"[\\\\x21\\\\x23-\\\\x5B\\\\x5D-\\\\x7E]\", OBS_QTEXT$$);  //%d33 / %d35-91 / %d93-126 / obs-qtext\n//const VCHAR$$ = \"[\\\\x21-\\\\x7E]\";\n//const WSP$$ = \"[\\\\x20\\\\x09]\";\n//const OBS_QP$ = subexp(\"\\\\\\\\\" + merge(\"[\\\\x00\\\\x0D\\\\x0A]\", OBS_QTEXT$$));  //%d0 / CR / LF / obs-qtext\n//const FWS$ = subexp(subexp(WSP$$ + \"*\" + \"\\\\x0D\\\\x0A\") + \"?\" + WSP$$ + \"+\");\n//const QUOTED_PAIR$ = subexp(subexp(\"\\\\\\\\\" + subexp(VCHAR$$ + \"|\" + WSP$$)) + \"|\" + OBS_QP$);\n//const QUOTED_STRING$ = subexp('\\\\\"' + subexp(FWS$ + \"?\" + QCONTENT$) + \"*\" + FWS$ + \"?\" + '\\\\\"');\nvar ATEXT$$ = \"[A-Za-z0-9\\\\!\\\\$\\\\%\\\\'\\\\*\\\\+\\\\-\\\\^\\\\_\\\\`\\\\{\\\\|\\\\}\\\\~]\";\nvar QTEXT$$ = \"[\\\\!\\\\$\\\\%\\\\'\\\\(\\\\)\\\\*\\\\+\\\\,\\\\-\\\\.0-9\\\\<\\\\>A-Z\\\\x5E-\\\\x7E]\";\nvar VCHAR$$ = merge(QTEXT$$, \"[\\\\\\\"\\\\\\\\]\");\nvar SOME_DELIMS$$ = \"[\\\\!\\\\$\\\\'\\\\(\\\\)\\\\*\\\\+\\\\,\\\\;\\\\:\\\\@]\";\nvar UNRESERVED = new RegExp(UNRESERVED$$, \"g\");\nvar PCT_ENCODED = new RegExp(PCT_ENCODED$, \"g\");\nvar NOT_LOCAL_PART = new RegExp(merge(\"[^]\", ATEXT$$, \"[\\\\.]\", '[\\\\\"]', VCHAR$$), \"g\");\nvar NOT_HFNAME = new RegExp(merge(\"[^]\", UNRESERVED$$, SOME_DELIMS$$), \"g\");\nvar NOT_HFVALUE = NOT_HFNAME;\nfunction decodeUnreserved(str) {\n    var decStr = pctDecChars(str);\n    return !decStr.match(UNRESERVED) ? str : decStr;\n}\nvar handler$4 = {\n    scheme: \"mailto\",\n    parse: function parse$$1(components, options) {\n        var mailtoComponents = components;\n        var to = mailtoComponents.to = mailtoComponents.path ? mailtoComponents.path.split(\",\") : [];\n        mailtoComponents.path = undefined;\n        if (mailtoComponents.query) {\n            var unknownHeaders = false;\n            var headers = {};\n            var hfields = mailtoComponents.query.split(\"&\");\n            for (var x = 0, xl = hfields.length; x < xl; ++x) {\n                var hfield = hfields[x].split(\"=\");\n                switch (hfield[0]) {\n                    case \"to\":\n                        var toAddrs = hfield[1].split(\",\");\n                        for (var _x = 0, _xl = toAddrs.length; _x < _xl; ++_x) {\n                            to.push(toAddrs[_x]);\n                        }\n                        break;\n                    case \"subject\":\n                        mailtoComponents.subject = unescapeComponent(hfield[1], options);\n                        break;\n                    case \"body\":\n                        mailtoComponents.body = unescapeComponent(hfield[1], options);\n                        break;\n                    default:\n                        unknownHeaders = true;\n                        headers[unescapeComponent(hfield[0], options)] = unescapeComponent(hfield[1], options);\n                        break;\n                }\n            }\n            if (unknownHeaders) mailtoComponents.headers = headers;\n        }\n        mailtoComponents.query = undefined;\n        for (var _x2 = 0, _xl2 = to.length; _x2 < _xl2; ++_x2) {\n            var addr = to[_x2].split(\"@\");\n            addr[0] = unescapeComponent(addr[0]);\n            if (!options.unicodeSupport) {\n                //convert Unicode IDN -> ASCII IDN\n                try {\n                    addr[1] = punycode.toASCII(unescapeComponent(addr[1], options).toLowerCase());\n                } catch (e) {\n                    mailtoComponents.error = mailtoComponents.error || \"Email address's domain name can not be converted to ASCII via punycode: \" + e;\n                }\n            } else {\n                addr[1] = unescapeComponent(addr[1], options).toLowerCase();\n            }\n            to[_x2] = addr.join(\"@\");\n        }\n        return mailtoComponents;\n    },\n    serialize: function serialize$$1(mailtoComponents, options) {\n        var components = mailtoComponents;\n        var to = toArray(mailtoComponents.to);\n        if (to) {\n            for (var x = 0, xl = to.length; x < xl; ++x) {\n                var toAddr = String(to[x]);\n                var atIdx = toAddr.lastIndexOf(\"@\");\n                var localPart = toAddr.slice(0, atIdx).replace(PCT_ENCODED, decodeUnreserved).replace(PCT_ENCODED, toUpperCase).replace(NOT_LOCAL_PART, pctEncChar);\n                var domain = toAddr.slice(atIdx + 1);\n                //convert IDN via punycode\n                try {\n                    domain = !options.iri ? punycode.toASCII(unescapeComponent(domain, options).toLowerCase()) : punycode.toUnicode(domain);\n                } catch (e) {\n                    components.error = components.error || \"Email address's domain name can not be converted to \" + (!options.iri ? \"ASCII\" : \"Unicode\") + \" via punycode: \" + e;\n                }\n                to[x] = localPart + \"@\" + domain;\n            }\n            components.path = to.join(\",\");\n        }\n        var headers = mailtoComponents.headers = mailtoComponents.headers || {};\n        if (mailtoComponents.subject) headers[\"subject\"] = mailtoComponents.subject;\n        if (mailtoComponents.body) headers[\"body\"] = mailtoComponents.body;\n        var fields = [];\n        for (var name in headers) {\n            if (headers[name] !== O[name]) {\n                fields.push(name.replace(PCT_ENCODED, decodeUnreserved).replace(PCT_ENCODED, toUpperCase).replace(NOT_HFNAME, pctEncChar) + \"=\" + headers[name].replace(PCT_ENCODED, decodeUnreserved).replace(PCT_ENCODED, toUpperCase).replace(NOT_HFVALUE, pctEncChar));\n            }\n        }\n        if (fields.length) {\n            components.query = fields.join(\"&\");\n        }\n        return components;\n    }\n};\n\nvar URN_PARSE = /^([^\\:]+)\\:(.*)/;\n//RFC 2141\nvar handler$5 = {\n    scheme: \"urn\",\n    parse: function parse$$1(components, options) {\n        var matches = components.path && components.path.match(URN_PARSE);\n        var urnComponents = components;\n        if (matches) {\n            var scheme = options.scheme || urnComponents.scheme || \"urn\";\n            var nid = matches[1].toLowerCase();\n            var nss = matches[2];\n            var urnScheme = scheme + \":\" + (options.nid || nid);\n            var schemeHandler = SCHEMES[urnScheme];\n            urnComponents.nid = nid;\n            urnComponents.nss = nss;\n            urnComponents.path = undefined;\n            if (schemeHandler) {\n                urnComponents = schemeHandler.parse(urnComponents, options);\n            }\n        } else {\n            urnComponents.error = urnComponents.error || \"URN can not be parsed.\";\n        }\n        return urnComponents;\n    },\n    serialize: function serialize$$1(urnComponents, options) {\n        var scheme = options.scheme || urnComponents.scheme || \"urn\";\n        var nid = urnComponents.nid;\n        var urnScheme = scheme + \":\" + (options.nid || nid);\n        var schemeHandler = SCHEMES[urnScheme];\n        if (schemeHandler) {\n            urnComponents = schemeHandler.serialize(urnComponents, options);\n        }\n        var uriComponents = urnComponents;\n        var nss = urnComponents.nss;\n        uriComponents.path = (nid || options.nid) + \":\" + nss;\n        return uriComponents;\n    }\n};\n\nvar UUID = /^[0-9A-Fa-f]{8}(?:\\-[0-9A-Fa-f]{4}){3}\\-[0-9A-Fa-f]{12}$/;\n//RFC 4122\nvar handler$6 = {\n    scheme: \"urn:uuid\",\n    parse: function parse(urnComponents, options) {\n        var uuidComponents = urnComponents;\n        uuidComponents.uuid = uuidComponents.nss;\n        uuidComponents.nss = undefined;\n        if (!options.tolerant && (!uuidComponents.uuid || !uuidComponents.uuid.match(UUID))) {\n            uuidComponents.error = uuidComponents.error || \"UUID is not valid.\";\n        }\n        return uuidComponents;\n    },\n    serialize: function serialize(uuidComponents, options) {\n        var urnComponents = uuidComponents;\n        //normalize UUID\n        urnComponents.nss = (uuidComponents.uuid || \"\").toLowerCase();\n        return urnComponents;\n    }\n};\n\nSCHEMES[handler.scheme] = handler;\nSCHEMES[handler$1.scheme] = handler$1;\nSCHEMES[handler$2.scheme] = handler$2;\nSCHEMES[handler$3.scheme] = handler$3;\nSCHEMES[handler$4.scheme] = handler$4;\nSCHEMES[handler$5.scheme] = handler$5;\nSCHEMES[handler$6.scheme] = handler$6;\n\nexports.SCHEMES = SCHEMES;\nexports.pctEncChar = pctEncChar;\nexports.pctDecChars = pctDecChars;\nexports.parse = parse;\nexports.removeDotSegments = removeDotSegments;\nexports.serialize = serialize;\nexports.resolveComponents = resolveComponents;\nexports.resolve = resolve;\nexports.normalize = normalize;\nexports.equal = equal;\nexports.escapeComponent = escapeComponent;\nexports.unescapeComponent = unescapeComponent;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=uri.all.js.map\n","'use strict';\n\n// https://mathiasbynens.be/notes/javascript-encoding\n// https://github.com/bestiejs/punycode.js - punycode.ucs2.decode\nmodule.exports = function ucs2length(str) {\n  var length = 0\n    , len = str.length\n    , pos = 0\n    , value;\n  while (pos < len) {\n    length++;\n    value = str.charCodeAt(pos++);\n    if (value >= 0xD800 && value <= 0xDBFF && pos < len) {\n      // high surrogate, and there is a next character\n      value = str.charCodeAt(pos);\n      if ((value & 0xFC00) == 0xDC00) pos++; // low surrogate\n    }\n  }\n  return length;\n};\n","'use strict';\n\n\nmodule.exports = {\n  copy: copy,\n  checkDataType: checkDataType,\n  checkDataTypes: checkDataTypes,\n  coerceToTypes: coerceToTypes,\n  toHash: toHash,\n  getProperty: getProperty,\n  escapeQuotes: escapeQuotes,\n  equal: require('fast-deep-equal'),\n  ucs2length: require('./ucs2length'),\n  varOccurences: varOccurences,\n  varReplace: varReplace,\n  schemaHasRules: schemaHasRules,\n  schemaHasRulesExcept: schemaHasRulesExcept,\n  schemaUnknownRules: schemaUnknownRules,\n  toQuotedString: toQuotedString,\n  getPathExpr: getPathExpr,\n  getPath: getPath,\n  getData: getData,\n  unescapeFragment: unescapeFragment,\n  unescapeJsonPointer: unescapeJsonPointer,\n  escapeFragment: escapeFragment,\n  escapeJsonPointer: escapeJsonPointer\n};\n\n\nfunction copy(o, to) {\n  to = to || {};\n  for (var key in o) to[key] = o[key];\n  return to;\n}\n\n\nfunction checkDataType(dataType, data, strictNumbers, negate) {\n  var EQUAL = negate ? ' !== ' : ' === '\n    , AND = negate ? ' || ' : ' && '\n    , OK = negate ? '!' : ''\n    , NOT = negate ? '' : '!';\n  switch (dataType) {\n    case 'null': return data + EQUAL + 'null';\n    case 'array': return OK + 'Array.isArray(' + data + ')';\n    case 'object': return '(' + OK + data + AND +\n                          'typeof ' + data + EQUAL + '\"object\"' + AND +\n                          NOT + 'Array.isArray(' + data + '))';\n    case 'integer': return '(typeof ' + data + EQUAL + '\"number\"' + AND +\n                           NOT + '(' + data + ' % 1)' +\n                           AND + data + EQUAL + data +\n                           (strictNumbers ? (AND + OK + 'isFinite(' + data + ')') : '') + ')';\n    case 'number': return '(typeof ' + data + EQUAL + '\"' + dataType + '\"' +\n                          (strictNumbers ? (AND + OK + 'isFinite(' + data + ')') : '') + ')';\n    default: return 'typeof ' + data + EQUAL + '\"' + dataType + '\"';\n  }\n}\n\n\nfunction checkDataTypes(dataTypes, data, strictNumbers) {\n  switch (dataTypes.length) {\n    case 1: return checkDataType(dataTypes[0], data, strictNumbers, true);\n    default:\n      var code = '';\n      var types = toHash(dataTypes);\n      if (types.array && types.object) {\n        code = types.null ? '(': '(!' + data + ' || ';\n        code += 'typeof ' + data + ' !== \"object\")';\n        delete types.null;\n        delete types.array;\n        delete types.object;\n      }\n      if (types.number) delete types.integer;\n      for (var t in types)\n        code += (code ? ' && ' : '' ) + checkDataType(t, data, strictNumbers, true);\n\n      return code;\n  }\n}\n\n\nvar COERCE_TO_TYPES = toHash([ 'string', 'number', 'integer', 'boolean', 'null' ]);\nfunction coerceToTypes(optionCoerceTypes, dataTypes) {\n  if (Array.isArray(dataTypes)) {\n    var types = [];\n    for (var i=0; i<dataTypes.length; i++) {\n      var t = dataTypes[i];\n      if (COERCE_TO_TYPES[t]) types[types.length] = t;\n      else if (optionCoerceTypes === 'array' && t === 'array') types[types.length] = t;\n    }\n    if (types.length) return types;\n  } else if (COERCE_TO_TYPES[dataTypes]) {\n    return [dataTypes];\n  } else if (optionCoerceTypes === 'array' && dataTypes === 'array') {\n    return ['array'];\n  }\n}\n\n\nfunction toHash(arr) {\n  var hash = {};\n  for (var i=0; i<arr.length; i++) hash[arr[i]] = true;\n  return hash;\n}\n\n\nvar IDENTIFIER = /^[a-z$_][a-z$_0-9]*$/i;\nvar SINGLE_QUOTE = /'|\\\\/g;\nfunction getProperty(key) {\n  return typeof key == 'number'\n          ? '[' + key + ']'\n          : IDENTIFIER.test(key)\n            ? '.' + key\n            : \"['\" + escapeQuotes(key) + \"']\";\n}\n\n\nfunction escapeQuotes(str) {\n  return str.replace(SINGLE_QUOTE, '\\\\$&')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\r/g, '\\\\r')\n            .replace(/\\f/g, '\\\\f')\n            .replace(/\\t/g, '\\\\t');\n}\n\n\nfunction varOccurences(str, dataVar) {\n  dataVar += '[^0-9]';\n  var matches = str.match(new RegExp(dataVar, 'g'));\n  return matches ? matches.length : 0;\n}\n\n\nfunction varReplace(str, dataVar, expr) {\n  dataVar += '([^0-9])';\n  expr = expr.replace(/\\$/g, '$$$$');\n  return str.replace(new RegExp(dataVar, 'g'), expr + '$1');\n}\n\n\nfunction schemaHasRules(schema, rules) {\n  if (typeof schema == 'boolean') return !schema;\n  for (var key in schema) if (rules[key]) return true;\n}\n\n\nfunction schemaHasRulesExcept(schema, rules, exceptKeyword) {\n  if (typeof schema == 'boolean') return !schema && exceptKeyword != 'not';\n  for (var key in schema) if (key != exceptKeyword && rules[key]) return true;\n}\n\n\nfunction schemaUnknownRules(schema, rules) {\n  if (typeof schema == 'boolean') return;\n  for (var key in schema) if (!rules[key]) return key;\n}\n\n\nfunction toQuotedString(str) {\n  return '\\'' + escapeQuotes(str) + '\\'';\n}\n\n\nfunction getPathExpr(currentPath, expr, jsonPointers, isNumber) {\n  var path = jsonPointers // false by default\n              ? '\\'/\\' + ' + expr + (isNumber ? '' : '.replace(/~/g, \\'~0\\').replace(/\\\\//g, \\'~1\\')')\n              : (isNumber ? '\\'[\\' + ' + expr + ' + \\']\\'' : '\\'[\\\\\\'\\' + ' + expr + ' + \\'\\\\\\']\\'');\n  return joinPaths(currentPath, path);\n}\n\n\nfunction getPath(currentPath, prop, jsonPointers) {\n  var path = jsonPointers // false by default\n              ? toQuotedString('/' + escapeJsonPointer(prop))\n              : toQuotedString(getProperty(prop));\n  return joinPaths(currentPath, path);\n}\n\n\nvar JSON_POINTER = /^\\/(?:[^~]|~0|~1)*$/;\nvar RELATIVE_JSON_POINTER = /^([0-9]+)(#|\\/(?:[^~]|~0|~1)*)?$/;\nfunction getData($data, lvl, paths) {\n  var up, jsonPointer, data, matches;\n  if ($data === '') return 'rootData';\n  if ($data[0] == '/') {\n    if (!JSON_POINTER.test($data)) throw new Error('Invalid JSON-pointer: ' + $data);\n    jsonPointer = $data;\n    data = 'rootData';\n  } else {\n    matches = $data.match(RELATIVE_JSON_POINTER);\n    if (!matches) throw new Error('Invalid JSON-pointer: ' + $data);\n    up = +matches[1];\n    jsonPointer = matches[2];\n    if (jsonPointer == '#') {\n      if (up >= lvl) throw new Error('Cannot access property/index ' + up + ' levels up, current level is ' + lvl);\n      return paths[lvl - up];\n    }\n\n    if (up > lvl) throw new Error('Cannot access data ' + up + ' levels up, current level is ' + lvl);\n    data = 'data' + ((lvl - up) || '');\n    if (!jsonPointer) return data;\n  }\n\n  var expr = data;\n  var segments = jsonPointer.split('/');\n  for (var i=0; i<segments.length; i++) {\n    var segment = segments[i];\n    if (segment) {\n      data += getProperty(unescapeJsonPointer(segment));\n      expr += ' && ' + data;\n    }\n  }\n  return expr;\n}\n\n\nfunction joinPaths (a, b) {\n  if (a == '\"\"') return b;\n  return (a + ' + ' + b).replace(/([^\\\\])' \\+ '/g, '$1');\n}\n\n\nfunction unescapeFragment(str) {\n  return unescapeJsonPointer(decodeURIComponent(str));\n}\n\n\nfunction escapeFragment(str) {\n  return encodeURIComponent(escapeJsonPointer(str));\n}\n\n\nfunction escapeJsonPointer(str) {\n  return str.replace(/~/g, '~0').replace(/\\//g, '~1');\n}\n\n\nfunction unescapeJsonPointer(str) {\n  return str.replace(/~1/g, '/').replace(/~0/g, '~');\n}\n","'use strict';\n\nvar util = require('./util');\n\nmodule.exports = SchemaObject;\n\nfunction SchemaObject(obj) {\n  util.copy(obj, this);\n}\n","'use strict';\n\nvar traverse = module.exports = function (schema, opts, cb) {\n  // Legacy support for v0.3.1 and earlier.\n  if (typeof opts == 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  cb = opts.cb || cb;\n  var pre = (typeof cb == 'function') ? cb : cb.pre || function() {};\n  var post = cb.post || function() {};\n\n  _traverse(opts, pre, post, schema, '', schema);\n};\n\n\ntraverse.keywords = {\n  additionalItems: true,\n  items: true,\n  contains: true,\n  additionalProperties: true,\n  propertyNames: true,\n  not: true\n};\n\ntraverse.arrayKeywords = {\n  items: true,\n  allOf: true,\n  anyOf: true,\n  oneOf: true\n};\n\ntraverse.propsKeywords = {\n  definitions: true,\n  properties: true,\n  patternProperties: true,\n  dependencies: true\n};\n\ntraverse.skipKeywords = {\n  default: true,\n  enum: true,\n  const: true,\n  required: true,\n  maximum: true,\n  minimum: true,\n  exclusiveMaximum: true,\n  exclusiveMinimum: true,\n  multipleOf: true,\n  maxLength: true,\n  minLength: true,\n  pattern: true,\n  format: true,\n  maxItems: true,\n  minItems: true,\n  uniqueItems: true,\n  maxProperties: true,\n  minProperties: true\n};\n\n\nfunction _traverse(opts, pre, post, schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex) {\n  if (schema && typeof schema == 'object' && !Array.isArray(schema)) {\n    pre(schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex);\n    for (var key in schema) {\n      var sch = schema[key];\n      if (Array.isArray(sch)) {\n        if (key in traverse.arrayKeywords) {\n          for (var i=0; i<sch.length; i++)\n            _traverse(opts, pre, post, sch[i], jsonPtr + '/' + key + '/' + i, rootSchema, jsonPtr, key, schema, i);\n        }\n      } else if (key in traverse.propsKeywords) {\n        if (sch && typeof sch == 'object') {\n          for (var prop in sch)\n            _traverse(opts, pre, post, sch[prop], jsonPtr + '/' + key + '/' + escapeJsonPtr(prop), rootSchema, jsonPtr, key, schema, prop);\n        }\n      } else if (key in traverse.keywords || (opts.allKeys && !(key in traverse.skipKeywords))) {\n        _traverse(opts, pre, post, sch, jsonPtr + '/' + key, rootSchema, jsonPtr, key, schema);\n      }\n    }\n    post(schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex);\n  }\n}\n\n\nfunction escapeJsonPtr(str) {\n  return str.replace(/~/g, '~0').replace(/\\//g, '~1');\n}\n","'use strict';\n\nvar URI = require('uri-js')\n  , equal = require('fast-deep-equal')\n  , util = require('./util')\n  , SchemaObject = require('./schema_obj')\n  , traverse = require('json-schema-traverse');\n\nmodule.exports = resolve;\n\nresolve.normalizeId = normalizeId;\nresolve.fullPath = getFullPath;\nresolve.url = resolveUrl;\nresolve.ids = resolveIds;\nresolve.inlineRef = inlineRef;\nresolve.schema = resolveSchema;\n\n/**\n * [resolve and compile the references ($ref)]\n * @this   Ajv\n * @param  {Function} compile reference to schema compilation funciton (localCompile)\n * @param  {Object} root object with information about the root schema for the current schema\n * @param  {String} ref reference to resolve\n * @return {Object|Function} schema object (if the schema can be inlined) or validation function\n */\nfunction resolve(compile, root, ref) {\n  /* jshint validthis: true */\n  var refVal = this._refs[ref];\n  if (typeof refVal == 'string') {\n    if (this._refs[refVal]) refVal = this._refs[refVal];\n    else return resolve.call(this, compile, root, refVal);\n  }\n\n  refVal = refVal || this._schemas[ref];\n  if (refVal instanceof SchemaObject) {\n    return inlineRef(refVal.schema, this._opts.inlineRefs)\n            ? refVal.schema\n            : refVal.validate || this._compile(refVal);\n  }\n\n  var res = resolveSchema.call(this, root, ref);\n  var schema, v, baseId;\n  if (res) {\n    schema = res.schema;\n    root = res.root;\n    baseId = res.baseId;\n  }\n\n  if (schema instanceof SchemaObject) {\n    v = schema.validate || compile.call(this, schema.schema, root, undefined, baseId);\n  } else if (schema !== undefined) {\n    v = inlineRef(schema, this._opts.inlineRefs)\n        ? schema\n        : compile.call(this, schema, root, undefined, baseId);\n  }\n\n  return v;\n}\n\n\n/**\n * Resolve schema, its root and baseId\n * @this Ajv\n * @param  {Object} root root object with properties schema, refVal, refs\n * @param  {String} ref  reference to resolve\n * @return {Object} object with properties schema, root, baseId\n */\nfunction resolveSchema(root, ref) {\n  /* jshint validthis: true */\n  var p = URI.parse(ref)\n    , refPath = _getFullPath(p)\n    , baseId = getFullPath(this._getId(root.schema));\n  if (Object.keys(root.schema).length === 0 || refPath !== baseId) {\n    var id = normalizeId(refPath);\n    var refVal = this._refs[id];\n    if (typeof refVal == 'string') {\n      return resolveRecursive.call(this, root, refVal, p);\n    } else if (refVal instanceof SchemaObject) {\n      if (!refVal.validate) this._compile(refVal);\n      root = refVal;\n    } else {\n      refVal = this._schemas[id];\n      if (refVal instanceof SchemaObject) {\n        if (!refVal.validate) this._compile(refVal);\n        if (id == normalizeId(ref))\n          return { schema: refVal, root: root, baseId: baseId };\n        root = refVal;\n      } else {\n        return;\n      }\n    }\n    if (!root.schema) return;\n    baseId = getFullPath(this._getId(root.schema));\n  }\n  return getJsonPointer.call(this, p, baseId, root.schema, root);\n}\n\n\n/* @this Ajv */\nfunction resolveRecursive(root, ref, parsedRef) {\n  /* jshint validthis: true */\n  var res = resolveSchema.call(this, root, ref);\n  if (res) {\n    var schema = res.schema;\n    var baseId = res.baseId;\n    root = res.root;\n    var id = this._getId(schema);\n    if (id) baseId = resolveUrl(baseId, id);\n    return getJsonPointer.call(this, parsedRef, baseId, schema, root);\n  }\n}\n\n\nvar PREVENT_SCOPE_CHANGE = util.toHash(['properties', 'patternProperties', 'enum', 'dependencies', 'definitions']);\n/* @this Ajv */\nfunction getJsonPointer(parsedRef, baseId, schema, root) {\n  /* jshint validthis: true */\n  parsedRef.fragment = parsedRef.fragment || '';\n  if (parsedRef.fragment.slice(0,1) != '/') return;\n  var parts = parsedRef.fragment.split('/');\n\n  for (var i = 1; i < parts.length; i++) {\n    var part = parts[i];\n    if (part) {\n      part = util.unescapeFragment(part);\n      schema = schema[part];\n      if (schema === undefined) break;\n      var id;\n      if (!PREVENT_SCOPE_CHANGE[part]) {\n        id = this._getId(schema);\n        if (id) baseId = resolveUrl(baseId, id);\n        if (schema.$ref) {\n          var $ref = resolveUrl(baseId, schema.$ref);\n          var res = resolveSchema.call(this, root, $ref);\n          if (res) {\n            schema = res.schema;\n            root = res.root;\n            baseId = res.baseId;\n          }\n        }\n      }\n    }\n  }\n  if (schema !== undefined && schema !== root.schema)\n    return { schema: schema, root: root, baseId: baseId };\n}\n\n\nvar SIMPLE_INLINED = util.toHash([\n  'type', 'format', 'pattern',\n  'maxLength', 'minLength',\n  'maxProperties', 'minProperties',\n  'maxItems', 'minItems',\n  'maximum', 'minimum',\n  'uniqueItems', 'multipleOf',\n  'required', 'enum'\n]);\nfunction inlineRef(schema, limit) {\n  if (limit === false) return false;\n  if (limit === undefined || limit === true) return checkNoRef(schema);\n  else if (limit) return countKeys(schema) <= limit;\n}\n\n\nfunction checkNoRef(schema) {\n  var item;\n  if (Array.isArray(schema)) {\n    for (var i=0; i<schema.length; i++) {\n      item = schema[i];\n      if (typeof item == 'object' && !checkNoRef(item)) return false;\n    }\n  } else {\n    for (var key in schema) {\n      if (key == '$ref') return false;\n      item = schema[key];\n      if (typeof item == 'object' && !checkNoRef(item)) return false;\n    }\n  }\n  return true;\n}\n\n\nfunction countKeys(schema) {\n  var count = 0, item;\n  if (Array.isArray(schema)) {\n    for (var i=0; i<schema.length; i++) {\n      item = schema[i];\n      if (typeof item == 'object') count += countKeys(item);\n      if (count == Infinity) return Infinity;\n    }\n  } else {\n    for (var key in schema) {\n      if (key == '$ref') return Infinity;\n      if (SIMPLE_INLINED[key]) {\n        count++;\n      } else {\n        item = schema[key];\n        if (typeof item == 'object') count += countKeys(item) + 1;\n        if (count == Infinity) return Infinity;\n      }\n    }\n  }\n  return count;\n}\n\n\nfunction getFullPath(id, normalize) {\n  if (normalize !== false) id = normalizeId(id);\n  var p = URI.parse(id);\n  return _getFullPath(p);\n}\n\n\nfunction _getFullPath(p) {\n  return URI.serialize(p).split('#')[0] + '#';\n}\n\n\nvar TRAILING_SLASH_HASH = /#\\/?$/;\nfunction normalizeId(id) {\n  return id ? id.replace(TRAILING_SLASH_HASH, '') : '';\n}\n\n\nfunction resolveUrl(baseId, id) {\n  id = normalizeId(id);\n  return URI.resolve(baseId, id);\n}\n\n\n/* @this Ajv */\nfunction resolveIds(schema) {\n  var schemaId = normalizeId(this._getId(schema));\n  var baseIds = {'': schemaId};\n  var fullPaths = {'': getFullPath(schemaId, false)};\n  var localRefs = {};\n  var self = this;\n\n  traverse(schema, {allKeys: true}, function(sch, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex) {\n    if (jsonPtr === '') return;\n    var id = self._getId(sch);\n    var baseId = baseIds[parentJsonPtr];\n    var fullPath = fullPaths[parentJsonPtr] + '/' + parentKeyword;\n    if (keyIndex !== undefined)\n      fullPath += '/' + (typeof keyIndex == 'number' ? keyIndex : util.escapeFragment(keyIndex));\n\n    if (typeof id == 'string') {\n      id = baseId = normalizeId(baseId ? URI.resolve(baseId, id) : id);\n\n      var refVal = self._refs[id];\n      if (typeof refVal == 'string') refVal = self._refs[refVal];\n      if (refVal && refVal.schema) {\n        if (!equal(sch, refVal.schema))\n          throw new Error('id \"' + id + '\" resolves to more than one schema');\n      } else if (id != normalizeId(fullPath)) {\n        if (id[0] == '#') {\n          if (localRefs[id] && !equal(sch, localRefs[id]))\n            throw new Error('id \"' + id + '\" resolves to more than one schema');\n          localRefs[id] = sch;\n        } else {\n          self._refs[id] = fullPath;\n        }\n      }\n    }\n    baseIds[jsonPtr] = baseId;\n    fullPaths[jsonPtr] = fullPath;\n  });\n\n  return localRefs;\n}\n","'use strict';\n\nvar resolve = require('./resolve');\n\nmodule.exports = {\n  Validation: errorSubclass(ValidationError),\n  MissingRef: errorSubclass(MissingRefError)\n};\n\n\nfunction ValidationError(errors) {\n  this.message = 'validation failed';\n  this.errors = errors;\n  this.ajv = this.validation = true;\n}\n\n\nMissingRefError.message = function (baseId, ref) {\n  return 'can\\'t resolve reference ' + ref + ' from id ' + baseId;\n};\n\n\nfunction MissingRefError(baseId, ref, message) {\n  this.message = message || MissingRefError.message(baseId, ref);\n  this.missingRef = resolve.url(baseId, ref);\n  this.missingSchema = resolve.normalizeId(resolve.fullPath(this.missingRef));\n}\n\n\nfunction errorSubclass(Subclass) {\n  Subclass.prototype = Object.create(Error.prototype);\n  Subclass.prototype.constructor = Subclass;\n  return Subclass;\n}\n","'use strict';\n\nmodule.exports = function (data, opts) {\n    if (!opts) opts = {};\n    if (typeof opts === 'function') opts = { cmp: opts };\n    var cycles = (typeof opts.cycles === 'boolean') ? opts.cycles : false;\n\n    var cmp = opts.cmp && (function (f) {\n        return function (node) {\n            return function (a, b) {\n                var aobj = { key: a, value: node[a] };\n                var bobj = { key: b, value: node[b] };\n                return f(aobj, bobj);\n            };\n        };\n    })(opts.cmp);\n\n    var seen = [];\n    return (function stringify (node) {\n        if (node && node.toJSON && typeof node.toJSON === 'function') {\n            node = node.toJSON();\n        }\n\n        if (node === undefined) return;\n        if (typeof node == 'number') return isFinite(node) ? '' + node : 'null';\n        if (typeof node !== 'object') return JSON.stringify(node);\n\n        var i, out;\n        if (Array.isArray(node)) {\n            out = '[';\n            for (i = 0; i < node.length; i++) {\n                if (i) out += ',';\n                out += stringify(node[i]) || 'null';\n            }\n            return out + ']';\n        }\n\n        if (node === null) return 'null';\n\n        if (seen.indexOf(node) !== -1) {\n            if (cycles) return JSON.stringify('__cycle__');\n            throw new TypeError('Converting circular structure to JSON');\n        }\n\n        var seenIndex = seen.push(node) - 1;\n        var keys = Object.keys(node).sort(cmp && cmp(node));\n        out = '';\n        for (i = 0; i < keys.length; i++) {\n            var key = keys[i];\n            var value = stringify(node[key]);\n\n            if (!value) continue;\n            if (out) out += ',';\n            out += JSON.stringify(key) + ':' + value;\n        }\n        seen.splice(seenIndex, 1);\n        return '{' + out + '}';\n    })(data);\n};\n","'use strict';\nmodule.exports = function generate_validate(it, $keyword, $ruleType) {\n  var out = '';\n  var $async = it.schema.$async === true,\n    $refKeywords = it.util.schemaHasRulesExcept(it.schema, it.RULES.all, '$ref'),\n    $id = it.self._getId(it.schema);\n  if (it.opts.strictKeywords) {\n    var $unknownKwd = it.util.schemaUnknownRules(it.schema, it.RULES.keywords);\n    if ($unknownKwd) {\n      var $keywordsMsg = 'unknown keyword: ' + $unknownKwd;\n      if (it.opts.strictKeywords === 'log') it.logger.warn($keywordsMsg);\n      else throw new Error($keywordsMsg);\n    }\n  }\n  if (it.isTop) {\n    out += ' var validate = ';\n    if ($async) {\n      it.async = true;\n      out += 'async ';\n    }\n    out += 'function(data, dataPath, parentData, parentDataProperty, rootData) { \\'use strict\\'; ';\n    if ($id && (it.opts.sourceCode || it.opts.processCode)) {\n      out += ' ' + ('/\\*# sourceURL=' + $id + ' */') + ' ';\n    }\n  }\n  if (typeof it.schema == 'boolean' || !($refKeywords || it.schema.$ref)) {\n    var $keyword = 'false schema';\n    var $lvl = it.level;\n    var $dataLvl = it.dataLevel;\n    var $schema = it.schema[$keyword];\n    var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n    var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n    var $breakOnError = !it.opts.allErrors;\n    var $errorKeyword;\n    var $data = 'data' + ($dataLvl || '');\n    var $valid = 'valid' + $lvl;\n    if (it.schema === false) {\n      if (it.isTop) {\n        $breakOnError = true;\n      } else {\n        out += ' var ' + ($valid) + ' = false; ';\n      }\n      var $$outStack = $$outStack || [];\n      $$outStack.push(out);\n      out = ''; /* istanbul ignore else */\n      if (it.createErrors !== false) {\n        out += ' { keyword: \\'' + ($errorKeyword || 'false schema') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n        if (it.opts.messages !== false) {\n          out += ' , message: \\'boolean schema is false\\' ';\n        }\n        if (it.opts.verbose) {\n          out += ' , schema: false , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n        }\n        out += ' } ';\n      } else {\n        out += ' {} ';\n      }\n      var __err = out;\n      out = $$outStack.pop();\n      if (!it.compositeRule && $breakOnError) {\n        /* istanbul ignore if */\n        if (it.async) {\n          out += ' throw new ValidationError([' + (__err) + ']); ';\n        } else {\n          out += ' validate.errors = [' + (__err) + ']; return false; ';\n        }\n      } else {\n        out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n      }\n    } else {\n      if (it.isTop) {\n        if ($async) {\n          out += ' return data; ';\n        } else {\n          out += ' validate.errors = null; return true; ';\n        }\n      } else {\n        out += ' var ' + ($valid) + ' = true; ';\n      }\n    }\n    if (it.isTop) {\n      out += ' }; return validate; ';\n    }\n    return out;\n  }\n  if (it.isTop) {\n    var $top = it.isTop,\n      $lvl = it.level = 0,\n      $dataLvl = it.dataLevel = 0,\n      $data = 'data';\n    it.rootId = it.resolve.fullPath(it.self._getId(it.root.schema));\n    it.baseId = it.baseId || it.rootId;\n    delete it.isTop;\n    it.dataPathArr = [\"\"];\n    if (it.schema.default !== undefined && it.opts.useDefaults && it.opts.strictDefaults) {\n      var $defaultMsg = 'default is ignored in the schema root';\n      if (it.opts.strictDefaults === 'log') it.logger.warn($defaultMsg);\n      else throw new Error($defaultMsg);\n    }\n    out += ' var vErrors = null; ';\n    out += ' var errors = 0;     ';\n    out += ' if (rootData === undefined) rootData = data; ';\n  } else {\n    var $lvl = it.level,\n      $dataLvl = it.dataLevel,\n      $data = 'data' + ($dataLvl || '');\n    if ($id) it.baseId = it.resolve.url(it.baseId, $id);\n    if ($async && !it.async) throw new Error('async schema in sync schema');\n    out += ' var errs_' + ($lvl) + ' = errors;';\n  }\n  var $valid = 'valid' + $lvl,\n    $breakOnError = !it.opts.allErrors,\n    $closingBraces1 = '',\n    $closingBraces2 = '';\n  var $errorKeyword;\n  var $typeSchema = it.schema.type,\n    $typeIsArray = Array.isArray($typeSchema);\n  if ($typeSchema && it.opts.nullable && it.schema.nullable === true) {\n    if ($typeIsArray) {\n      if ($typeSchema.indexOf('null') == -1) $typeSchema = $typeSchema.concat('null');\n    } else if ($typeSchema != 'null') {\n      $typeSchema = [$typeSchema, 'null'];\n      $typeIsArray = true;\n    }\n  }\n  if ($typeIsArray && $typeSchema.length == 1) {\n    $typeSchema = $typeSchema[0];\n    $typeIsArray = false;\n  }\n  if (it.schema.$ref && $refKeywords) {\n    if (it.opts.extendRefs == 'fail') {\n      throw new Error('$ref: validation keywords used in schema at path \"' + it.errSchemaPath + '\" (see option extendRefs)');\n    } else if (it.opts.extendRefs !== true) {\n      $refKeywords = false;\n      it.logger.warn('$ref: keywords ignored in schema at path \"' + it.errSchemaPath + '\"');\n    }\n  }\n  if (it.schema.$comment && it.opts.$comment) {\n    out += ' ' + (it.RULES.all.$comment.code(it, '$comment'));\n  }\n  if ($typeSchema) {\n    if (it.opts.coerceTypes) {\n      var $coerceToTypes = it.util.coerceToTypes(it.opts.coerceTypes, $typeSchema);\n    }\n    var $rulesGroup = it.RULES.types[$typeSchema];\n    if ($coerceToTypes || $typeIsArray || $rulesGroup === true || ($rulesGroup && !$shouldUseGroup($rulesGroup))) {\n      var $schemaPath = it.schemaPath + '.type',\n        $errSchemaPath = it.errSchemaPath + '/type';\n      var $schemaPath = it.schemaPath + '.type',\n        $errSchemaPath = it.errSchemaPath + '/type',\n        $method = $typeIsArray ? 'checkDataTypes' : 'checkDataType';\n      out += ' if (' + (it.util[$method]($typeSchema, $data, it.opts.strictNumbers, true)) + ') { ';\n      if ($coerceToTypes) {\n        var $dataType = 'dataType' + $lvl,\n          $coerced = 'coerced' + $lvl;\n        out += ' var ' + ($dataType) + ' = typeof ' + ($data) + '; var ' + ($coerced) + ' = undefined; ';\n        if (it.opts.coerceTypes == 'array') {\n          out += ' if (' + ($dataType) + ' == \\'object\\' && Array.isArray(' + ($data) + ') && ' + ($data) + '.length == 1) { ' + ($data) + ' = ' + ($data) + '[0]; ' + ($dataType) + ' = typeof ' + ($data) + '; if (' + (it.util.checkDataType(it.schema.type, $data, it.opts.strictNumbers)) + ') ' + ($coerced) + ' = ' + ($data) + '; } ';\n        }\n        out += ' if (' + ($coerced) + ' !== undefined) ; ';\n        var arr1 = $coerceToTypes;\n        if (arr1) {\n          var $type, $i = -1,\n            l1 = arr1.length - 1;\n          while ($i < l1) {\n            $type = arr1[$i += 1];\n            if ($type == 'string') {\n              out += ' else if (' + ($dataType) + ' == \\'number\\' || ' + ($dataType) + ' == \\'boolean\\') ' + ($coerced) + ' = \\'\\' + ' + ($data) + '; else if (' + ($data) + ' === null) ' + ($coerced) + ' = \\'\\'; ';\n            } else if ($type == 'number' || $type == 'integer') {\n              out += ' else if (' + ($dataType) + ' == \\'boolean\\' || ' + ($data) + ' === null || (' + ($dataType) + ' == \\'string\\' && ' + ($data) + ' && ' + ($data) + ' == +' + ($data) + ' ';\n              if ($type == 'integer') {\n                out += ' && !(' + ($data) + ' % 1)';\n              }\n              out += ')) ' + ($coerced) + ' = +' + ($data) + '; ';\n            } else if ($type == 'boolean') {\n              out += ' else if (' + ($data) + ' === \\'false\\' || ' + ($data) + ' === 0 || ' + ($data) + ' === null) ' + ($coerced) + ' = false; else if (' + ($data) + ' === \\'true\\' || ' + ($data) + ' === 1) ' + ($coerced) + ' = true; ';\n            } else if ($type == 'null') {\n              out += ' else if (' + ($data) + ' === \\'\\' || ' + ($data) + ' === 0 || ' + ($data) + ' === false) ' + ($coerced) + ' = null; ';\n            } else if (it.opts.coerceTypes == 'array' && $type == 'array') {\n              out += ' else if (' + ($dataType) + ' == \\'string\\' || ' + ($dataType) + ' == \\'number\\' || ' + ($dataType) + ' == \\'boolean\\' || ' + ($data) + ' == null) ' + ($coerced) + ' = [' + ($data) + ']; ';\n            }\n          }\n        }\n        out += ' else {   ';\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ($errorKeyword || 'type') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { type: \\'';\n          if ($typeIsArray) {\n            out += '' + ($typeSchema.join(\",\"));\n          } else {\n            out += '' + ($typeSchema);\n          }\n          out += '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'should be ';\n            if ($typeIsArray) {\n              out += '' + ($typeSchema.join(\",\"));\n            } else {\n              out += '' + ($typeSchema);\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        out += ' } if (' + ($coerced) + ' !== undefined) {  ';\n        var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',\n          $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';\n        out += ' ' + ($data) + ' = ' + ($coerced) + '; ';\n        if (!$dataLvl) {\n          out += 'if (' + ($parentData) + ' !== undefined)';\n        }\n        out += ' ' + ($parentData) + '[' + ($parentDataProperty) + '] = ' + ($coerced) + '; } ';\n      } else {\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ($errorKeyword || 'type') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { type: \\'';\n          if ($typeIsArray) {\n            out += '' + ($typeSchema.join(\",\"));\n          } else {\n            out += '' + ($typeSchema);\n          }\n          out += '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'should be ';\n            if ($typeIsArray) {\n              out += '' + ($typeSchema.join(\",\"));\n            } else {\n              out += '' + ($typeSchema);\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n      }\n      out += ' } ';\n    }\n  }\n  if (it.schema.$ref && !$refKeywords) {\n    out += ' ' + (it.RULES.all.$ref.code(it, '$ref')) + ' ';\n    if ($breakOnError) {\n      out += ' } if (errors === ';\n      if ($top) {\n        out += '0';\n      } else {\n        out += 'errs_' + ($lvl);\n      }\n      out += ') { ';\n      $closingBraces2 += '}';\n    }\n  } else {\n    var arr2 = it.RULES;\n    if (arr2) {\n      var $rulesGroup, i2 = -1,\n        l2 = arr2.length - 1;\n      while (i2 < l2) {\n        $rulesGroup = arr2[i2 += 1];\n        if ($shouldUseGroup($rulesGroup)) {\n          if ($rulesGroup.type) {\n            out += ' if (' + (it.util.checkDataType($rulesGroup.type, $data, it.opts.strictNumbers)) + ') { ';\n          }\n          if (it.opts.useDefaults) {\n            if ($rulesGroup.type == 'object' && it.schema.properties) {\n              var $schema = it.schema.properties,\n                $schemaKeys = Object.keys($schema);\n              var arr3 = $schemaKeys;\n              if (arr3) {\n                var $propertyKey, i3 = -1,\n                  l3 = arr3.length - 1;\n                while (i3 < l3) {\n                  $propertyKey = arr3[i3 += 1];\n                  var $sch = $schema[$propertyKey];\n                  if ($sch.default !== undefined) {\n                    var $passData = $data + it.util.getProperty($propertyKey);\n                    if (it.compositeRule) {\n                      if (it.opts.strictDefaults) {\n                        var $defaultMsg = 'default is ignored for: ' + $passData;\n                        if (it.opts.strictDefaults === 'log') it.logger.warn($defaultMsg);\n                        else throw new Error($defaultMsg);\n                      }\n                    } else {\n                      out += ' if (' + ($passData) + ' === undefined ';\n                      if (it.opts.useDefaults == 'empty') {\n                        out += ' || ' + ($passData) + ' === null || ' + ($passData) + ' === \\'\\' ';\n                      }\n                      out += ' ) ' + ($passData) + ' = ';\n                      if (it.opts.useDefaults == 'shared') {\n                        out += ' ' + (it.useDefault($sch.default)) + ' ';\n                      } else {\n                        out += ' ' + (JSON.stringify($sch.default)) + ' ';\n                      }\n                      out += '; ';\n                    }\n                  }\n                }\n              }\n            } else if ($rulesGroup.type == 'array' && Array.isArray(it.schema.items)) {\n              var arr4 = it.schema.items;\n              if (arr4) {\n                var $sch, $i = -1,\n                  l4 = arr4.length - 1;\n                while ($i < l4) {\n                  $sch = arr4[$i += 1];\n                  if ($sch.default !== undefined) {\n                    var $passData = $data + '[' + $i + ']';\n                    if (it.compositeRule) {\n                      if (it.opts.strictDefaults) {\n                        var $defaultMsg = 'default is ignored for: ' + $passData;\n                        if (it.opts.strictDefaults === 'log') it.logger.warn($defaultMsg);\n                        else throw new Error($defaultMsg);\n                      }\n                    } else {\n                      out += ' if (' + ($passData) + ' === undefined ';\n                      if (it.opts.useDefaults == 'empty') {\n                        out += ' || ' + ($passData) + ' === null || ' + ($passData) + ' === \\'\\' ';\n                      }\n                      out += ' ) ' + ($passData) + ' = ';\n                      if (it.opts.useDefaults == 'shared') {\n                        out += ' ' + (it.useDefault($sch.default)) + ' ';\n                      } else {\n                        out += ' ' + (JSON.stringify($sch.default)) + ' ';\n                      }\n                      out += '; ';\n                    }\n                  }\n                }\n              }\n            }\n          }\n          var arr5 = $rulesGroup.rules;\n          if (arr5) {\n            var $rule, i5 = -1,\n              l5 = arr5.length - 1;\n            while (i5 < l5) {\n              $rule = arr5[i5 += 1];\n              if ($shouldUseRule($rule)) {\n                var $code = $rule.code(it, $rule.keyword, $rulesGroup.type);\n                if ($code) {\n                  out += ' ' + ($code) + ' ';\n                  if ($breakOnError) {\n                    $closingBraces1 += '}';\n                  }\n                }\n              }\n            }\n          }\n          if ($breakOnError) {\n            out += ' ' + ($closingBraces1) + ' ';\n            $closingBraces1 = '';\n          }\n          if ($rulesGroup.type) {\n            out += ' } ';\n            if ($typeSchema && $typeSchema === $rulesGroup.type && !$coerceToTypes) {\n              out += ' else { ';\n              var $schemaPath = it.schemaPath + '.type',\n                $errSchemaPath = it.errSchemaPath + '/type';\n              var $$outStack = $$outStack || [];\n              $$outStack.push(out);\n              out = ''; /* istanbul ignore else */\n              if (it.createErrors !== false) {\n                out += ' { keyword: \\'' + ($errorKeyword || 'type') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { type: \\'';\n                if ($typeIsArray) {\n                  out += '' + ($typeSchema.join(\",\"));\n                } else {\n                  out += '' + ($typeSchema);\n                }\n                out += '\\' } ';\n                if (it.opts.messages !== false) {\n                  out += ' , message: \\'should be ';\n                  if ($typeIsArray) {\n                    out += '' + ($typeSchema.join(\",\"));\n                  } else {\n                    out += '' + ($typeSchema);\n                  }\n                  out += '\\' ';\n                }\n                if (it.opts.verbose) {\n                  out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n                }\n                out += ' } ';\n              } else {\n                out += ' {} ';\n              }\n              var __err = out;\n              out = $$outStack.pop();\n              if (!it.compositeRule && $breakOnError) {\n                /* istanbul ignore if */\n                if (it.async) {\n                  out += ' throw new ValidationError([' + (__err) + ']); ';\n                } else {\n                  out += ' validate.errors = [' + (__err) + ']; return false; ';\n                }\n              } else {\n                out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n              }\n              out += ' } ';\n            }\n          }\n          if ($breakOnError) {\n            out += ' if (errors === ';\n            if ($top) {\n              out += '0';\n            } else {\n              out += 'errs_' + ($lvl);\n            }\n            out += ') { ';\n            $closingBraces2 += '}';\n          }\n        }\n      }\n    }\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces2) + ' ';\n  }\n  if ($top) {\n    if ($async) {\n      out += ' if (errors === 0) return data;           ';\n      out += ' else throw new ValidationError(vErrors); ';\n    } else {\n      out += ' validate.errors = vErrors; ';\n      out += ' return errors === 0;       ';\n    }\n    out += ' }; return validate;';\n  } else {\n    out += ' var ' + ($valid) + ' = errors === errs_' + ($lvl) + ';';\n  }\n\n  function $shouldUseGroup($rulesGroup) {\n    var rules = $rulesGroup.rules;\n    for (var i = 0; i < rules.length; i++)\n      if ($shouldUseRule(rules[i])) return true;\n  }\n\n  function $shouldUseRule($rule) {\n    return it.schema[$rule.keyword] !== undefined || ($rule.implements && $ruleImplementsSomeKeyword($rule));\n  }\n\n  function $ruleImplementsSomeKeyword($rule) {\n    var impl = $rule.implements;\n    for (var i = 0; i < impl.length; i++)\n      if (it.schema[impl[i]] !== undefined) return true;\n  }\n  return out;\n}\n","'use strict';\n\nvar resolve = require('./resolve')\n  , util = require('./util')\n  , errorClasses = require('./error_classes')\n  , stableStringify = require('fast-json-stable-stringify');\n\nvar validateGenerator = require('../dotjs/validate');\n\n/**\n * Functions below are used inside compiled validations function\n */\n\nvar ucs2length = util.ucs2length;\nvar equal = require('fast-deep-equal');\n\n// this error is thrown by async schemas to return validation errors via exception\nvar ValidationError = errorClasses.Validation;\n\nmodule.exports = compile;\n\n\n/**\n * Compiles schema to validation function\n * @this   Ajv\n * @param  {Object} schema schema object\n * @param  {Object} root object with information about the root schema for this schema\n * @param  {Object} localRefs the hash of local references inside the schema (created by resolve.id), used for inline resolution\n * @param  {String} baseId base ID for IDs in the schema\n * @return {Function} validation function\n */\nfunction compile(schema, root, localRefs, baseId) {\n  /* jshint validthis: true, evil: true */\n  /* eslint no-shadow: 0 */\n  var self = this\n    , opts = this._opts\n    , refVal = [ undefined ]\n    , refs = {}\n    , patterns = []\n    , patternsHash = {}\n    , defaults = []\n    , defaultsHash = {}\n    , customRules = [];\n\n  root = root || { schema: schema, refVal: refVal, refs: refs };\n\n  var c = checkCompiling.call(this, schema, root, baseId);\n  var compilation = this._compilations[c.index];\n  if (c.compiling) return (compilation.callValidate = callValidate);\n\n  var formats = this._formats;\n  var RULES = this.RULES;\n\n  try {\n    var v = localCompile(schema, root, localRefs, baseId);\n    compilation.validate = v;\n    var cv = compilation.callValidate;\n    if (cv) {\n      cv.schema = v.schema;\n      cv.errors = null;\n      cv.refs = v.refs;\n      cv.refVal = v.refVal;\n      cv.root = v.root;\n      cv.$async = v.$async;\n      if (opts.sourceCode) cv.source = v.source;\n    }\n    return v;\n  } finally {\n    endCompiling.call(this, schema, root, baseId);\n  }\n\n  /* @this   {*} - custom context, see passContext option */\n  function callValidate() {\n    /* jshint validthis: true */\n    var validate = compilation.validate;\n    var result = validate.apply(this, arguments);\n    callValidate.errors = validate.errors;\n    return result;\n  }\n\n  function localCompile(_schema, _root, localRefs, baseId) {\n    var isRoot = !_root || (_root && _root.schema == _schema);\n    if (_root.schema != root.schema)\n      return compile.call(self, _schema, _root, localRefs, baseId);\n\n    var $async = _schema.$async === true;\n\n    var sourceCode = validateGenerator({\n      isTop: true,\n      schema: _schema,\n      isRoot: isRoot,\n      baseId: baseId,\n      root: _root,\n      schemaPath: '',\n      errSchemaPath: '#',\n      errorPath: '\"\"',\n      MissingRefError: errorClasses.MissingRef,\n      RULES: RULES,\n      validate: validateGenerator,\n      util: util,\n      resolve: resolve,\n      resolveRef: resolveRef,\n      usePattern: usePattern,\n      useDefault: useDefault,\n      useCustomRule: useCustomRule,\n      opts: opts,\n      formats: formats,\n      logger: self.logger,\n      self: self\n    });\n\n    sourceCode = vars(refVal, refValCode) + vars(patterns, patternCode)\n                   + vars(defaults, defaultCode) + vars(customRules, customRuleCode)\n                   + sourceCode;\n\n    if (opts.processCode) sourceCode = opts.processCode(sourceCode, _schema);\n    // console.log('\\n\\n\\n *** \\n', JSON.stringify(sourceCode));\n    var validate;\n    try {\n      var makeValidate = new Function(\n        'self',\n        'RULES',\n        'formats',\n        'root',\n        'refVal',\n        'defaults',\n        'customRules',\n        'equal',\n        'ucs2length',\n        'ValidationError',\n        sourceCode\n      );\n\n      validate = makeValidate(\n        self,\n        RULES,\n        formats,\n        root,\n        refVal,\n        defaults,\n        customRules,\n        equal,\n        ucs2length,\n        ValidationError\n      );\n\n      refVal[0] = validate;\n    } catch(e) {\n      self.logger.error('Error compiling schema, function code:', sourceCode);\n      throw e;\n    }\n\n    validate.schema = _schema;\n    validate.errors = null;\n    validate.refs = refs;\n    validate.refVal = refVal;\n    validate.root = isRoot ? validate : _root;\n    if ($async) validate.$async = true;\n    if (opts.sourceCode === true) {\n      validate.source = {\n        code: sourceCode,\n        patterns: patterns,\n        defaults: defaults\n      };\n    }\n\n    return validate;\n  }\n\n  function resolveRef(baseId, ref, isRoot) {\n    ref = resolve.url(baseId, ref);\n    var refIndex = refs[ref];\n    var _refVal, refCode;\n    if (refIndex !== undefined) {\n      _refVal = refVal[refIndex];\n      refCode = 'refVal[' + refIndex + ']';\n      return resolvedRef(_refVal, refCode);\n    }\n    if (!isRoot && root.refs) {\n      var rootRefId = root.refs[ref];\n      if (rootRefId !== undefined) {\n        _refVal = root.refVal[rootRefId];\n        refCode = addLocalRef(ref, _refVal);\n        return resolvedRef(_refVal, refCode);\n      }\n    }\n\n    refCode = addLocalRef(ref);\n    var v = resolve.call(self, localCompile, root, ref);\n    if (v === undefined) {\n      var localSchema = localRefs && localRefs[ref];\n      if (localSchema) {\n        v = resolve.inlineRef(localSchema, opts.inlineRefs)\n            ? localSchema\n            : compile.call(self, localSchema, root, localRefs, baseId);\n      }\n    }\n\n    if (v === undefined) {\n      removeLocalRef(ref);\n    } else {\n      replaceLocalRef(ref, v);\n      return resolvedRef(v, refCode);\n    }\n  }\n\n  function addLocalRef(ref, v) {\n    var refId = refVal.length;\n    refVal[refId] = v;\n    refs[ref] = refId;\n    return 'refVal' + refId;\n  }\n\n  function removeLocalRef(ref) {\n    delete refs[ref];\n  }\n\n  function replaceLocalRef(ref, v) {\n    var refId = refs[ref];\n    refVal[refId] = v;\n  }\n\n  function resolvedRef(refVal, code) {\n    return typeof refVal == 'object' || typeof refVal == 'boolean'\n            ? { code: code, schema: refVal, inline: true }\n            : { code: code, $async: refVal && !!refVal.$async };\n  }\n\n  function usePattern(regexStr) {\n    var index = patternsHash[regexStr];\n    if (index === undefined) {\n      index = patternsHash[regexStr] = patterns.length;\n      patterns[index] = regexStr;\n    }\n    return 'pattern' + index;\n  }\n\n  function useDefault(value) {\n    switch (typeof value) {\n      case 'boolean':\n      case 'number':\n        return '' + value;\n      case 'string':\n        return util.toQuotedString(value);\n      case 'object':\n        if (value === null) return 'null';\n        var valueStr = stableStringify(value);\n        var index = defaultsHash[valueStr];\n        if (index === undefined) {\n          index = defaultsHash[valueStr] = defaults.length;\n          defaults[index] = value;\n        }\n        return 'default' + index;\n    }\n  }\n\n  function useCustomRule(rule, schema, parentSchema, it) {\n    if (self._opts.validateSchema !== false) {\n      var deps = rule.definition.dependencies;\n      if (deps && !deps.every(function(keyword) {\n        return Object.prototype.hasOwnProperty.call(parentSchema, keyword);\n      }))\n        throw new Error('parent schema must have all required keywords: ' + deps.join(','));\n\n      var validateSchema = rule.definition.validateSchema;\n      if (validateSchema) {\n        var valid = validateSchema(schema);\n        if (!valid) {\n          var message = 'keyword schema is invalid: ' + self.errorsText(validateSchema.errors);\n          if (self._opts.validateSchema == 'log') self.logger.error(message);\n          else throw new Error(message);\n        }\n      }\n    }\n\n    var compile = rule.definition.compile\n      , inline = rule.definition.inline\n      , macro = rule.definition.macro;\n\n    var validate;\n    if (compile) {\n      validate = compile.call(self, schema, parentSchema, it);\n    } else if (macro) {\n      validate = macro.call(self, schema, parentSchema, it);\n      if (opts.validateSchema !== false) self.validateSchema(validate, true);\n    } else if (inline) {\n      validate = inline.call(self, it, rule.keyword, schema, parentSchema);\n    } else {\n      validate = rule.definition.validate;\n      if (!validate) return;\n    }\n\n    if (validate === undefined)\n      throw new Error('custom keyword \"' + rule.keyword + '\"failed to compile');\n\n    var index = customRules.length;\n    customRules[index] = validate;\n\n    return {\n      code: 'customRule' + index,\n      validate: validate\n    };\n  }\n}\n\n\n/**\n * Checks if the schema is currently compiled\n * @this   Ajv\n * @param  {Object} schema schema to compile\n * @param  {Object} root root object\n * @param  {String} baseId base schema ID\n * @return {Object} object with properties \"index\" (compilation index) and \"compiling\" (boolean)\n */\nfunction checkCompiling(schema, root, baseId) {\n  /* jshint validthis: true */\n  var index = compIndex.call(this, schema, root, baseId);\n  if (index >= 0) return { index: index, compiling: true };\n  index = this._compilations.length;\n  this._compilations[index] = {\n    schema: schema,\n    root: root,\n    baseId: baseId\n  };\n  return { index: index, compiling: false };\n}\n\n\n/**\n * Removes the schema from the currently compiled list\n * @this   Ajv\n * @param  {Object} schema schema to compile\n * @param  {Object} root root object\n * @param  {String} baseId base schema ID\n */\nfunction endCompiling(schema, root, baseId) {\n  /* jshint validthis: true */\n  var i = compIndex.call(this, schema, root, baseId);\n  if (i >= 0) this._compilations.splice(i, 1);\n}\n\n\n/**\n * Index of schema compilation in the currently compiled list\n * @this   Ajv\n * @param  {Object} schema schema to compile\n * @param  {Object} root root object\n * @param  {String} baseId base schema ID\n * @return {Integer} compilation index\n */\nfunction compIndex(schema, root, baseId) {\n  /* jshint validthis: true */\n  for (var i=0; i<this._compilations.length; i++) {\n    var c = this._compilations[i];\n    if (c.schema == schema && c.root == root && c.baseId == baseId) return i;\n  }\n  return -1;\n}\n\n\nfunction patternCode(i, patterns) {\n  return 'var pattern' + i + ' = new RegExp(' + util.toQuotedString(patterns[i]) + ');';\n}\n\n\nfunction defaultCode(i) {\n  return 'var default' + i + ' = defaults[' + i + '];';\n}\n\n\nfunction refValCode(i, refVal) {\n  return refVal[i] === undefined ? '' : 'var refVal' + i + ' = refVal[' + i + '];';\n}\n\n\nfunction customRuleCode(i) {\n  return 'var customRule' + i + ' = customRules[' + i + '];';\n}\n\n\nfunction vars(arr, statement) {\n  if (!arr.length) return '';\n  var code = '';\n  for (var i=0; i<arr.length; i++)\n    code += statement(i, arr);\n  return code;\n}\n","'use strict';\n\n\nvar Cache = module.exports = function Cache() {\n  this._cache = {};\n};\n\n\nCache.prototype.put = function Cache_put(key, value) {\n  this._cache[key] = value;\n};\n\n\nCache.prototype.get = function Cache_get(key) {\n  return this._cache[key];\n};\n\n\nCache.prototype.del = function Cache_del(key) {\n  delete this._cache[key];\n};\n\n\nCache.prototype.clear = function Cache_clear() {\n  this._cache = {};\n};\n","'use strict';\n\nvar util = require('./util');\n\nvar DATE = /^(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)$/;\nvar DAYS = [0,31,28,31,30,31,30,31,31,30,31,30,31];\nvar TIME = /^(\\d\\d):(\\d\\d):(\\d\\d)(\\.\\d+)?(z|[+-]\\d\\d(?::?\\d\\d)?)?$/i;\nvar HOSTNAME = /^(?=.{1,253}\\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\\.?$/i;\nvar URI = /^(?:[a-z][a-z0-9+\\-.]*:)(?:\\/?\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\\.[a-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)|(?:[a-z0-9\\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\\?(?:[a-z0-9\\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;\nvar URIREF = /^(?:[a-z][a-z0-9+\\-.]*:)?(?:\\/?\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\\.[a-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)|(?:[a-z0-9\\-._~!$&'\"()*+,;=]|%[0-9a-f]{2})*)(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*|\\/(?:(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\\?(?:[a-z0-9\\-._~!$&'\"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\\-._~!$&'\"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;\n// uri-template: https://tools.ietf.org/html/rfc6570\nvar URITEMPLATE = /^(?:(?:[^\\x00-\\x20\"'<>%\\\\^`{|}]|%[0-9a-f]{2})|\\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\\*)?)*\\})*$/i;\n// For the source: https://gist.github.com/dperini/729294\n// For test cases: https://mathiasbynens.be/demo/url-regex\n// @todo Delete current URL in favour of the commented out URL rule when this issue is fixed https://github.com/eslint/eslint/issues/7983.\n// var URL = /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u{00a1}-\\u{ffff}0-9]+-)*[a-z\\u{00a1}-\\u{ffff}0-9]+)(?:\\.(?:[a-z\\u{00a1}-\\u{ffff}0-9]+-)*[a-z\\u{00a1}-\\u{ffff}0-9]+)*(?:\\.(?:[a-z\\u{00a1}-\\u{ffff}]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/iu;\nvar URL = /^(?:(?:http[s\\u017F]?|ftp):\\/\\/)(?:(?:[\\0-\\x08\\x0E-\\x1F!-\\x9F\\xA1-\\u167F\\u1681-\\u1FFF\\u200B-\\u2027\\u202A-\\u202E\\u2030-\\u205E\\u2060-\\u2FFF\\u3001-\\uD7FF\\uE000-\\uFEFE\\uFF00-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+(?::(?:[\\0-\\x08\\x0E-\\x1F!-\\x9F\\xA1-\\u167F\\u1681-\\u1FFF\\u200B-\\u2027\\u202A-\\u202E\\u2030-\\u205E\\u2060-\\u2FFF\\u3001-\\uD7FF\\uE000-\\uFEFE\\uFF00-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])*)?@)?(?:(?!10(?:\\.[0-9]{1,3}){3})(?!127(?:\\.[0-9]{1,3}){3})(?!169\\.254(?:\\.[0-9]{1,3}){2})(?!192\\.168(?:\\.[0-9]{1,3}){2})(?!172\\.(?:1[6-9]|2[0-9]|3[01])(?:\\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+-)*(?:[0-9a-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+)(?:\\.(?:(?:[0-9a-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+-)*(?:[0-9a-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+)*(?:\\.(?:(?:[a-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\\/(?:[\\0-\\x08\\x0E-\\x1F!-\\x9F\\xA1-\\u167F\\u1681-\\u1FFF\\u200B-\\u2027\\u202A-\\u202E\\u2030-\\u205E\\u2060-\\u2FFF\\u3001-\\uD7FF\\uE000-\\uFEFE\\uFF00-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])*)?$/i;\nvar UUID = /^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i;\nvar JSON_POINTER = /^(?:\\/(?:[^~/]|~0|~1)*)*$/;\nvar JSON_POINTER_URI_FRAGMENT = /^#(?:\\/(?:[a-z0-9_\\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i;\nvar RELATIVE_JSON_POINTER = /^(?:0|[1-9][0-9]*)(?:#|(?:\\/(?:[^~/]|~0|~1)*)*)$/;\n\n\nmodule.exports = formats;\n\nfunction formats(mode) {\n  mode = mode == 'full' ? 'full' : 'fast';\n  return util.copy(formats[mode]);\n}\n\n\nformats.fast = {\n  // date: http://tools.ietf.org/html/rfc3339#section-5.6\n  date: /^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$/,\n  // date-time: http://tools.ietf.org/html/rfc3339#section-5.6\n  time: /^(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)(?:\\.\\d+)?(?:z|[+-]\\d\\d(?::?\\d\\d)?)?$/i,\n  'date-time': /^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d[t\\s](?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)(?:\\.\\d+)?(?:z|[+-]\\d\\d(?::?\\d\\d)?)$/i,\n  // uri: https://github.com/mafintosh/is-my-json-valid/blob/master/formats.js\n  uri: /^(?:[a-z][a-z0-9+\\-.]*:)(?:\\/?\\/)?[^\\s]*$/i,\n  'uri-reference': /^(?:(?:[a-z][a-z0-9+\\-.]*:)?\\/?\\/)?(?:[^\\\\\\s#][^\\s#]*)?(?:#[^\\\\\\s]*)?$/i,\n  'uri-template': URITEMPLATE,\n  url: URL,\n  // email (sources from jsen validator):\n  // http://stackoverflow.com/questions/201323/using-a-regular-expression-to-validate-an-email-address#answer-8829363\n  // http://www.w3.org/TR/html5/forms.html#valid-e-mail-address (search for 'willful violation')\n  email: /^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,\n  hostname: HOSTNAME,\n  // optimized https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9780596802837/ch07s16.html\n  ipv4: /^(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$/,\n  // optimized http://stackoverflow.com/questions/53497/regular-expression-that-matches-valid-ipv6-addresses\n  ipv6: /^\\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(?:%.+)?\\s*$/i,\n  regex: regex,\n  // uuid: http://tools.ietf.org/html/rfc4122\n  uuid: UUID,\n  // JSON-pointer: https://tools.ietf.org/html/rfc6901\n  // uri fragment: https://tools.ietf.org/html/rfc3986#appendix-A\n  'json-pointer': JSON_POINTER,\n  'json-pointer-uri-fragment': JSON_POINTER_URI_FRAGMENT,\n  // relative JSON-pointer: http://tools.ietf.org/html/draft-luff-relative-json-pointer-00\n  'relative-json-pointer': RELATIVE_JSON_POINTER\n};\n\n\nformats.full = {\n  date: date,\n  time: time,\n  'date-time': date_time,\n  uri: uri,\n  'uri-reference': URIREF,\n  'uri-template': URITEMPLATE,\n  url: URL,\n  email: /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,\n  hostname: HOSTNAME,\n  ipv4: /^(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$/,\n  ipv6: /^\\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(?:%.+)?\\s*$/i,\n  regex: regex,\n  uuid: UUID,\n  'json-pointer': JSON_POINTER,\n  'json-pointer-uri-fragment': JSON_POINTER_URI_FRAGMENT,\n  'relative-json-pointer': RELATIVE_JSON_POINTER\n};\n\n\nfunction isLeapYear(year) {\n  // https://tools.ietf.org/html/rfc3339#appendix-C\n  return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);\n}\n\n\nfunction date(str) {\n  // full-date from http://tools.ietf.org/html/rfc3339#section-5.6\n  var matches = str.match(DATE);\n  if (!matches) return false;\n\n  var year = +matches[1];\n  var month = +matches[2];\n  var day = +matches[3];\n\n  return month >= 1 && month <= 12 && day >= 1 &&\n          day <= (month == 2 && isLeapYear(year) ? 29 : DAYS[month]);\n}\n\n\nfunction time(str, full) {\n  var matches = str.match(TIME);\n  if (!matches) return false;\n\n  var hour = matches[1];\n  var minute = matches[2];\n  var second = matches[3];\n  var timeZone = matches[5];\n  return ((hour <= 23 && minute <= 59 && second <= 59) ||\n          (hour == 23 && minute == 59 && second == 60)) &&\n         (!full || timeZone);\n}\n\n\nvar DATE_TIME_SEPARATOR = /t|\\s/i;\nfunction date_time(str) {\n  // http://tools.ietf.org/html/rfc3339#section-5.6\n  var dateTime = str.split(DATE_TIME_SEPARATOR);\n  return dateTime.length == 2 && date(dateTime[0]) && time(dateTime[1], true);\n}\n\n\nvar NOT_URI_FRAGMENT = /\\/|:/;\nfunction uri(str) {\n  // http://jmrware.com/articles/2009/uri_regexp/URI_regex.html + optional protocol + required \".\"\n  return NOT_URI_FRAGMENT.test(str) && URI.test(str);\n}\n\n\nvar Z_ANCHOR = /[^\\\\]\\\\Z/;\nfunction regex(str) {\n  if (Z_ANCHOR.test(str)) return false;\n  try {\n    new RegExp(str);\n    return true;\n  } catch(e) {\n    return false;\n  }\n}\n","'use strict';\nmodule.exports = function generate_ref(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $async, $refCode;\n  if ($schema == '#' || $schema == '#/') {\n    if (it.isRoot) {\n      $async = it.async;\n      $refCode = 'validate';\n    } else {\n      $async = it.root.schema.$async === true;\n      $refCode = 'root.refVal[0]';\n    }\n  } else {\n    var $refVal = it.resolveRef(it.baseId, $schema, it.isRoot);\n    if ($refVal === undefined) {\n      var $message = it.MissingRefError.message(it.baseId, $schema);\n      if (it.opts.missingRefs == 'fail') {\n        it.logger.error($message);\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('$ref') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { ref: \\'' + (it.util.escapeQuotes($schema)) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'can\\\\\\'t resolve reference ' + (it.util.escapeQuotes($schema)) + '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: ' + (it.util.toQuotedString($schema)) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        if ($breakOnError) {\n          out += ' if (false) { ';\n        }\n      } else if (it.opts.missingRefs == 'ignore') {\n        it.logger.warn($message);\n        if ($breakOnError) {\n          out += ' if (true) { ';\n        }\n      } else {\n        throw new it.MissingRefError(it.baseId, $schema, $message);\n      }\n    } else if ($refVal.inline) {\n      var $it = it.util.copy(it);\n      $it.level++;\n      var $nextValid = 'valid' + $it.level;\n      $it.schema = $refVal.schema;\n      $it.schemaPath = '';\n      $it.errSchemaPath = $schema;\n      var $code = it.validate($it).replace(/validate\\.schema/g, $refVal.code);\n      out += ' ' + ($code) + ' ';\n      if ($breakOnError) {\n        out += ' if (' + ($nextValid) + ') { ';\n      }\n    } else {\n      $async = $refVal.$async === true || (it.async && $refVal.$async !== false);\n      $refCode = $refVal.code;\n    }\n  }\n  if ($refCode) {\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = '';\n    if (it.opts.passContext) {\n      out += ' ' + ($refCode) + '.call(this, ';\n    } else {\n      out += ' ' + ($refCode) + '( ';\n    }\n    out += ' ' + ($data) + ', (dataPath || \\'\\')';\n    if (it.errorPath != '\"\"') {\n      out += ' + ' + (it.errorPath);\n    }\n    var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',\n      $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';\n    out += ' , ' + ($parentData) + ' , ' + ($parentDataProperty) + ', rootData)  ';\n    var __callValidate = out;\n    out = $$outStack.pop();\n    if ($async) {\n      if (!it.async) throw new Error('async schema referenced by sync schema');\n      if ($breakOnError) {\n        out += ' var ' + ($valid) + '; ';\n      }\n      out += ' try { await ' + (__callValidate) + '; ';\n      if ($breakOnError) {\n        out += ' ' + ($valid) + ' = true; ';\n      }\n      out += ' } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ';\n      if ($breakOnError) {\n        out += ' ' + ($valid) + ' = false; ';\n      }\n      out += ' } ';\n      if ($breakOnError) {\n        out += ' if (' + ($valid) + ') { ';\n      }\n    } else {\n      out += ' if (!' + (__callValidate) + ') { if (vErrors === null) vErrors = ' + ($refCode) + '.errors; else vErrors = vErrors.concat(' + ($refCode) + '.errors); errors = vErrors.length; } ';\n      if ($breakOnError) {\n        out += ' else { ';\n      }\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_allOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $currentBaseId = $it.baseId,\n    $allSchemasEmpty = true;\n  var arr1 = $schema;\n  if (arr1) {\n    var $sch, $i = -1,\n      l1 = arr1.length - 1;\n    while ($i < l1) {\n      $sch = arr1[$i += 1];\n      if ((it.opts.strictKeywords ? (typeof $sch == 'object' && Object.keys($sch).length > 0) || $sch === false : it.util.schemaHasRules($sch, it.RULES.all))) {\n        $allSchemasEmpty = false;\n        $it.schema = $sch;\n        $it.schemaPath = $schemaPath + '[' + $i + ']';\n        $it.errSchemaPath = $errSchemaPath + '/' + $i;\n        out += '  ' + (it.validate($it)) + ' ';\n        $it.baseId = $currentBaseId;\n        if ($breakOnError) {\n          out += ' if (' + ($nextValid) + ') { ';\n          $closingBraces += '}';\n        }\n      }\n    }\n  }\n  if ($breakOnError) {\n    if ($allSchemasEmpty) {\n      out += ' if (true) { ';\n    } else {\n      out += ' ' + ($closingBraces.slice(0, -1)) + ' ';\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_anyOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $noEmptySchema = $schema.every(function($sch) {\n    return (it.opts.strictKeywords ? (typeof $sch == 'object' && Object.keys($sch).length > 0) || $sch === false : it.util.schemaHasRules($sch, it.RULES.all));\n  });\n  if ($noEmptySchema) {\n    var $currentBaseId = $it.baseId;\n    out += ' var ' + ($errs) + ' = errors; var ' + ($valid) + ' = false;  ';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    var arr1 = $schema;\n    if (arr1) {\n      var $sch, $i = -1,\n        l1 = arr1.length - 1;\n      while ($i < l1) {\n        $sch = arr1[$i += 1];\n        $it.schema = $sch;\n        $it.schemaPath = $schemaPath + '[' + $i + ']';\n        $it.errSchemaPath = $errSchemaPath + '/' + $i;\n        out += '  ' + (it.validate($it)) + ' ';\n        $it.baseId = $currentBaseId;\n        out += ' ' + ($valid) + ' = ' + ($valid) + ' || ' + ($nextValid) + '; if (!' + ($valid) + ') { ';\n        $closingBraces += '}';\n      }\n    }\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' ' + ($closingBraces) + ' if (!' + ($valid) + ') {   var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('anyOf') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should match some schema in anyOf\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError(vErrors); ';\n      } else {\n        out += ' validate.errors = vErrors; return false; ';\n      }\n    }\n    out += ' } else {  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; } ';\n    if (it.opts.allErrors) {\n      out += ' } ';\n    }\n  } else {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_comment(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $schema = it.schema[$keyword];\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $comment = it.util.toQuotedString($schema);\n  if (it.opts.$comment === true) {\n    out += ' console.log(' + ($comment) + ');';\n  } else if (typeof it.opts.$comment == 'function') {\n    out += ' self._opts.$comment(' + ($comment) + ', ' + (it.util.toQuotedString($errSchemaPath)) + ', validate.root.schema);';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_const(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (!$isData) {\n    out += ' var schema' + ($lvl) + ' = validate.schema' + ($schemaPath) + ';';\n  }\n  out += 'var ' + ($valid) + ' = equal(' + ($data) + ', schema' + ($lvl) + '); if (!' + ($valid) + ') {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('const') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { allowedValue: schema' + ($lvl) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be equal to constant\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' }';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_contains(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $idx = 'i' + $lvl,\n    $dataNxt = $it.dataLevel = it.dataLevel + 1,\n    $nextData = 'data' + $dataNxt,\n    $currentBaseId = it.baseId,\n    $nonEmptySchema = (it.opts.strictKeywords ? (typeof $schema == 'object' && Object.keys($schema).length > 0) || $schema === false : it.util.schemaHasRules($schema, it.RULES.all));\n  out += 'var ' + ($errs) + ' = errors;var ' + ($valid) + ';';\n  if ($nonEmptySchema) {\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += ' var ' + ($nextValid) + ' = false; for (var ' + ($idx) + ' = 0; ' + ($idx) + ' < ' + ($data) + '.length; ' + ($idx) + '++) { ';\n    $it.errorPath = it.util.getPathExpr(it.errorPath, $idx, it.opts.jsonPointers, true);\n    var $passData = $data + '[' + $idx + ']';\n    $it.dataPathArr[$dataNxt] = $idx;\n    var $code = it.validate($it);\n    $it.baseId = $currentBaseId;\n    if (it.util.varOccurences($code, $nextData) < 2) {\n      out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n    } else {\n      out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n    }\n    out += ' if (' + ($nextValid) + ') break; }  ';\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' ' + ($closingBraces) + ' if (!' + ($nextValid) + ') {';\n  } else {\n    out += ' if (' + ($data) + '.length == 0) {';\n  }\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('contains') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should contain a valid item\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' } else { ';\n  if ($nonEmptySchema) {\n    out += '  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; } ';\n  }\n  if (it.opts.allErrors) {\n    out += ' } ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_dependencies(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $schemaDeps = {},\n    $propertyDeps = {},\n    $ownProperties = it.opts.ownProperties;\n  for ($property in $schema) {\n    if ($property == '__proto__') continue;\n    var $sch = $schema[$property];\n    var $deps = Array.isArray($sch) ? $propertyDeps : $schemaDeps;\n    $deps[$property] = $sch;\n  }\n  out += 'var ' + ($errs) + ' = errors;';\n  var $currentErrorPath = it.errorPath;\n  out += 'var missing' + ($lvl) + ';';\n  for (var $property in $propertyDeps) {\n    $deps = $propertyDeps[$property];\n    if ($deps.length) {\n      out += ' if ( ' + ($data) + (it.util.getProperty($property)) + ' !== undefined ';\n      if ($ownProperties) {\n        out += ' && Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($property)) + '\\') ';\n      }\n      if ($breakOnError) {\n        out += ' && ( ';\n        var arr1 = $deps;\n        if (arr1) {\n          var $propertyKey, $i = -1,\n            l1 = arr1.length - 1;\n          while ($i < l1) {\n            $propertyKey = arr1[$i += 1];\n            if ($i) {\n              out += ' || ';\n            }\n            var $prop = it.util.getProperty($propertyKey),\n              $useData = $data + $prop;\n            out += ' ( ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') && (missing' + ($lvl) + ' = ' + (it.util.toQuotedString(it.opts.jsonPointers ? $propertyKey : $prop)) + ') ) ';\n          }\n        }\n        out += ')) {  ';\n        var $propertyPath = 'missing' + $lvl,\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.opts.jsonPointers ? it.util.getPathExpr($currentErrorPath, $propertyPath, true) : $currentErrorPath + ' + ' + $propertyPath;\n        }\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('dependencies') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { property: \\'' + (it.util.escapeQuotes($property)) + '\\', missingProperty: \\'' + ($missingProperty) + '\\', depsCount: ' + ($deps.length) + ', deps: \\'' + (it.util.escapeQuotes($deps.length == 1 ? $deps[0] : $deps.join(\", \"))) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'should have ';\n            if ($deps.length == 1) {\n              out += 'property ' + (it.util.escapeQuotes($deps[0]));\n            } else {\n              out += 'properties ' + (it.util.escapeQuotes($deps.join(\", \")));\n            }\n            out += ' when property ' + (it.util.escapeQuotes($property)) + ' is present\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n      } else {\n        out += ' ) { ';\n        var arr2 = $deps;\n        if (arr2) {\n          var $propertyKey, i2 = -1,\n            l2 = arr2.length - 1;\n          while (i2 < l2) {\n            $propertyKey = arr2[i2 += 1];\n            var $prop = it.util.getProperty($propertyKey),\n              $missingProperty = it.util.escapeQuotes($propertyKey),\n              $useData = $data + $prop;\n            if (it.opts._errorDataPathProperty) {\n              it.errorPath = it.util.getPath($currentErrorPath, $propertyKey, it.opts.jsonPointers);\n            }\n            out += ' if ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') {  var err =   '; /* istanbul ignore else */\n            if (it.createErrors !== false) {\n              out += ' { keyword: \\'' + ('dependencies') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { property: \\'' + (it.util.escapeQuotes($property)) + '\\', missingProperty: \\'' + ($missingProperty) + '\\', depsCount: ' + ($deps.length) + ', deps: \\'' + (it.util.escapeQuotes($deps.length == 1 ? $deps[0] : $deps.join(\", \"))) + '\\' } ';\n              if (it.opts.messages !== false) {\n                out += ' , message: \\'should have ';\n                if ($deps.length == 1) {\n                  out += 'property ' + (it.util.escapeQuotes($deps[0]));\n                } else {\n                  out += 'properties ' + (it.util.escapeQuotes($deps.join(\", \")));\n                }\n                out += ' when property ' + (it.util.escapeQuotes($property)) + ' is present\\' ';\n              }\n              if (it.opts.verbose) {\n                out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n              }\n              out += ' } ';\n            } else {\n              out += ' {} ';\n            }\n            out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } ';\n          }\n        }\n      }\n      out += ' }   ';\n      if ($breakOnError) {\n        $closingBraces += '}';\n        out += ' else { ';\n      }\n    }\n  }\n  it.errorPath = $currentErrorPath;\n  var $currentBaseId = $it.baseId;\n  for (var $property in $schemaDeps) {\n    var $sch = $schemaDeps[$property];\n    if ((it.opts.strictKeywords ? (typeof $sch == 'object' && Object.keys($sch).length > 0) || $sch === false : it.util.schemaHasRules($sch, it.RULES.all))) {\n      out += ' ' + ($nextValid) + ' = true; if ( ' + ($data) + (it.util.getProperty($property)) + ' !== undefined ';\n      if ($ownProperties) {\n        out += ' && Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($property)) + '\\') ';\n      }\n      out += ') { ';\n      $it.schema = $sch;\n      $it.schemaPath = $schemaPath + it.util.getProperty($property);\n      $it.errSchemaPath = $errSchemaPath + '/' + it.util.escapeFragment($property);\n      out += '  ' + (it.validate($it)) + ' ';\n      $it.baseId = $currentBaseId;\n      out += ' }  ';\n      if ($breakOnError) {\n        out += ' if (' + ($nextValid) + ') { ';\n        $closingBraces += '}';\n      }\n    }\n  }\n  if ($breakOnError) {\n    out += '   ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_enum(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $i = 'i' + $lvl,\n    $vSchema = 'schema' + $lvl;\n  if (!$isData) {\n    out += ' var ' + ($vSchema) + ' = validate.schema' + ($schemaPath) + ';';\n  }\n  out += 'var ' + ($valid) + ';';\n  if ($isData) {\n    out += ' if (schema' + ($lvl) + ' === undefined) ' + ($valid) + ' = true; else if (!Array.isArray(schema' + ($lvl) + ')) ' + ($valid) + ' = false; else {';\n  }\n  out += '' + ($valid) + ' = false;for (var ' + ($i) + '=0; ' + ($i) + '<' + ($vSchema) + '.length; ' + ($i) + '++) if (equal(' + ($data) + ', ' + ($vSchema) + '[' + ($i) + '])) { ' + ($valid) + ' = true; break; }';\n  if ($isData) {\n    out += '  }  ';\n  }\n  out += ' if (!' + ($valid) + ') {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('enum') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { allowedValues: schema' + ($lvl) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be equal to one of the allowed values\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' }';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_format(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  if (it.opts.format === false) {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n    return out;\n  }\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $unknownFormats = it.opts.unknownFormats,\n    $allowUnknown = Array.isArray($unknownFormats);\n  if ($isData) {\n    var $format = 'format' + $lvl,\n      $isObject = 'isObject' + $lvl,\n      $formatType = 'formatType' + $lvl;\n    out += ' var ' + ($format) + ' = formats[' + ($schemaValue) + ']; var ' + ($isObject) + ' = typeof ' + ($format) + ' == \\'object\\' && !(' + ($format) + ' instanceof RegExp) && ' + ($format) + '.validate; var ' + ($formatType) + ' = ' + ($isObject) + ' && ' + ($format) + '.type || \\'string\\'; if (' + ($isObject) + ') { ';\n    if (it.async) {\n      out += ' var async' + ($lvl) + ' = ' + ($format) + '.async; ';\n    }\n    out += ' ' + ($format) + ' = ' + ($format) + '.validate; } if (  ';\n    if ($isData) {\n      out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'string\\') || ';\n    }\n    out += ' (';\n    if ($unknownFormats != 'ignore') {\n      out += ' (' + ($schemaValue) + ' && !' + ($format) + ' ';\n      if ($allowUnknown) {\n        out += ' && self._opts.unknownFormats.indexOf(' + ($schemaValue) + ') == -1 ';\n      }\n      out += ') || ';\n    }\n    out += ' (' + ($format) + ' && ' + ($formatType) + ' == \\'' + ($ruleType) + '\\' && !(typeof ' + ($format) + ' == \\'function\\' ? ';\n    if (it.async) {\n      out += ' (async' + ($lvl) + ' ? await ' + ($format) + '(' + ($data) + ') : ' + ($format) + '(' + ($data) + ')) ';\n    } else {\n      out += ' ' + ($format) + '(' + ($data) + ') ';\n    }\n    out += ' : ' + ($format) + '.test(' + ($data) + '))))) {';\n  } else {\n    var $format = it.formats[$schema];\n    if (!$format) {\n      if ($unknownFormats == 'ignore') {\n        it.logger.warn('unknown format \"' + $schema + '\" ignored in schema at path \"' + it.errSchemaPath + '\"');\n        if ($breakOnError) {\n          out += ' if (true) { ';\n        }\n        return out;\n      } else if ($allowUnknown && $unknownFormats.indexOf($schema) >= 0) {\n        if ($breakOnError) {\n          out += ' if (true) { ';\n        }\n        return out;\n      } else {\n        throw new Error('unknown format \"' + $schema + '\" is used in schema at path \"' + it.errSchemaPath + '\"');\n      }\n    }\n    var $isObject = typeof $format == 'object' && !($format instanceof RegExp) && $format.validate;\n    var $formatType = $isObject && $format.type || 'string';\n    if ($isObject) {\n      var $async = $format.async === true;\n      $format = $format.validate;\n    }\n    if ($formatType != $ruleType) {\n      if ($breakOnError) {\n        out += ' if (true) { ';\n      }\n      return out;\n    }\n    if ($async) {\n      if (!it.async) throw new Error('async format in sync schema');\n      var $formatRef = 'formats' + it.util.getProperty($schema) + '.validate';\n      out += ' if (!(await ' + ($formatRef) + '(' + ($data) + '))) { ';\n    } else {\n      out += ' if (! ';\n      var $formatRef = 'formats' + it.util.getProperty($schema);\n      if ($isObject) $formatRef += '.validate';\n      if (typeof $format == 'function') {\n        out += ' ' + ($formatRef) + '(' + ($data) + ') ';\n      } else {\n        out += ' ' + ($formatRef) + '.test(' + ($data) + ') ';\n      }\n      out += ') { ';\n    }\n  }\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('format') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { format:  ';\n    if ($isData) {\n      out += '' + ($schemaValue);\n    } else {\n      out += '' + (it.util.toQuotedString($schema));\n    }\n    out += '  } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should match format \"';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + (it.util.escapeQuotes($schema));\n      }\n      out += '\"\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + (it.util.toQuotedString($schema));\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' } ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_if(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $thenSch = it.schema['then'],\n    $elseSch = it.schema['else'],\n    $thenPresent = $thenSch !== undefined && (it.opts.strictKeywords ? (typeof $thenSch == 'object' && Object.keys($thenSch).length > 0) || $thenSch === false : it.util.schemaHasRules($thenSch, it.RULES.all)),\n    $elsePresent = $elseSch !== undefined && (it.opts.strictKeywords ? (typeof $elseSch == 'object' && Object.keys($elseSch).length > 0) || $elseSch === false : it.util.schemaHasRules($elseSch, it.RULES.all)),\n    $currentBaseId = $it.baseId;\n  if ($thenPresent || $elsePresent) {\n    var $ifClause;\n    $it.createErrors = false;\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += ' var ' + ($errs) + ' = errors; var ' + ($valid) + ' = true;  ';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    out += '  ' + (it.validate($it)) + ' ';\n    $it.baseId = $currentBaseId;\n    $it.createErrors = true;\n    out += '  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; }  ';\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    if ($thenPresent) {\n      out += ' if (' + ($nextValid) + ') {  ';\n      $it.schema = it.schema['then'];\n      $it.schemaPath = it.schemaPath + '.then';\n      $it.errSchemaPath = it.errSchemaPath + '/then';\n      out += '  ' + (it.validate($it)) + ' ';\n      $it.baseId = $currentBaseId;\n      out += ' ' + ($valid) + ' = ' + ($nextValid) + '; ';\n      if ($thenPresent && $elsePresent) {\n        $ifClause = 'ifClause' + $lvl;\n        out += ' var ' + ($ifClause) + ' = \\'then\\'; ';\n      } else {\n        $ifClause = '\\'then\\'';\n      }\n      out += ' } ';\n      if ($elsePresent) {\n        out += ' else { ';\n      }\n    } else {\n      out += ' if (!' + ($nextValid) + ') { ';\n    }\n    if ($elsePresent) {\n      $it.schema = it.schema['else'];\n      $it.schemaPath = it.schemaPath + '.else';\n      $it.errSchemaPath = it.errSchemaPath + '/else';\n      out += '  ' + (it.validate($it)) + ' ';\n      $it.baseId = $currentBaseId;\n      out += ' ' + ($valid) + ' = ' + ($nextValid) + '; ';\n      if ($thenPresent && $elsePresent) {\n        $ifClause = 'ifClause' + $lvl;\n        out += ' var ' + ($ifClause) + ' = \\'else\\'; ';\n      } else {\n        $ifClause = '\\'else\\'';\n      }\n      out += ' } ';\n    }\n    out += ' if (!' + ($valid) + ') {   var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('if') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { failingKeyword: ' + ($ifClause) + ' } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should match \"\\' + ' + ($ifClause) + ' + \\'\" schema\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError(vErrors); ';\n      } else {\n        out += ' validate.errors = vErrors; return false; ';\n      }\n    }\n    out += ' }   ';\n    if ($breakOnError) {\n      out += ' else { ';\n    }\n  } else {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_items(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $idx = 'i' + $lvl,\n    $dataNxt = $it.dataLevel = it.dataLevel + 1,\n    $nextData = 'data' + $dataNxt,\n    $currentBaseId = it.baseId;\n  out += 'var ' + ($errs) + ' = errors;var ' + ($valid) + ';';\n  if (Array.isArray($schema)) {\n    var $additionalItems = it.schema.additionalItems;\n    if ($additionalItems === false) {\n      out += ' ' + ($valid) + ' = ' + ($data) + '.length <= ' + ($schema.length) + '; ';\n      var $currErrSchemaPath = $errSchemaPath;\n      $errSchemaPath = it.errSchemaPath + '/additionalItems';\n      out += '  if (!' + ($valid) + ') {   ';\n      var $$outStack = $$outStack || [];\n      $$outStack.push(out);\n      out = ''; /* istanbul ignore else */\n      if (it.createErrors !== false) {\n        out += ' { keyword: \\'' + ('additionalItems') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schema.length) + ' } ';\n        if (it.opts.messages !== false) {\n          out += ' , message: \\'should NOT have more than ' + ($schema.length) + ' items\\' ';\n        }\n        if (it.opts.verbose) {\n          out += ' , schema: false , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n        }\n        out += ' } ';\n      } else {\n        out += ' {} ';\n      }\n      var __err = out;\n      out = $$outStack.pop();\n      if (!it.compositeRule && $breakOnError) {\n        /* istanbul ignore if */\n        if (it.async) {\n          out += ' throw new ValidationError([' + (__err) + ']); ';\n        } else {\n          out += ' validate.errors = [' + (__err) + ']; return false; ';\n        }\n      } else {\n        out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n      }\n      out += ' } ';\n      $errSchemaPath = $currErrSchemaPath;\n      if ($breakOnError) {\n        $closingBraces += '}';\n        out += ' else { ';\n      }\n    }\n    var arr1 = $schema;\n    if (arr1) {\n      var $sch, $i = -1,\n        l1 = arr1.length - 1;\n      while ($i < l1) {\n        $sch = arr1[$i += 1];\n        if ((it.opts.strictKeywords ? (typeof $sch == 'object' && Object.keys($sch).length > 0) || $sch === false : it.util.schemaHasRules($sch, it.RULES.all))) {\n          out += ' ' + ($nextValid) + ' = true; if (' + ($data) + '.length > ' + ($i) + ') { ';\n          var $passData = $data + '[' + $i + ']';\n          $it.schema = $sch;\n          $it.schemaPath = $schemaPath + '[' + $i + ']';\n          $it.errSchemaPath = $errSchemaPath + '/' + $i;\n          $it.errorPath = it.util.getPathExpr(it.errorPath, $i, it.opts.jsonPointers, true);\n          $it.dataPathArr[$dataNxt] = $i;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          out += ' }  ';\n          if ($breakOnError) {\n            out += ' if (' + ($nextValid) + ') { ';\n            $closingBraces += '}';\n          }\n        }\n      }\n    }\n    if (typeof $additionalItems == 'object' && (it.opts.strictKeywords ? (typeof $additionalItems == 'object' && Object.keys($additionalItems).length > 0) || $additionalItems === false : it.util.schemaHasRules($additionalItems, it.RULES.all))) {\n      $it.schema = $additionalItems;\n      $it.schemaPath = it.schemaPath + '.additionalItems';\n      $it.errSchemaPath = it.errSchemaPath + '/additionalItems';\n      out += ' ' + ($nextValid) + ' = true; if (' + ($data) + '.length > ' + ($schema.length) + ') {  for (var ' + ($idx) + ' = ' + ($schema.length) + '; ' + ($idx) + ' < ' + ($data) + '.length; ' + ($idx) + '++) { ';\n      $it.errorPath = it.util.getPathExpr(it.errorPath, $idx, it.opts.jsonPointers, true);\n      var $passData = $data + '[' + $idx + ']';\n      $it.dataPathArr[$dataNxt] = $idx;\n      var $code = it.validate($it);\n      $it.baseId = $currentBaseId;\n      if (it.util.varOccurences($code, $nextData) < 2) {\n        out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n      } else {\n        out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n      }\n      if ($breakOnError) {\n        out += ' if (!' + ($nextValid) + ') break; ';\n      }\n      out += ' } }  ';\n      if ($breakOnError) {\n        out += ' if (' + ($nextValid) + ') { ';\n        $closingBraces += '}';\n      }\n    }\n  } else if ((it.opts.strictKeywords ? (typeof $schema == 'object' && Object.keys($schema).length > 0) || $schema === false : it.util.schemaHasRules($schema, it.RULES.all))) {\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += '  for (var ' + ($idx) + ' = ' + (0) + '; ' + ($idx) + ' < ' + ($data) + '.length; ' + ($idx) + '++) { ';\n    $it.errorPath = it.util.getPathExpr(it.errorPath, $idx, it.opts.jsonPointers, true);\n    var $passData = $data + '[' + $idx + ']';\n    $it.dataPathArr[$dataNxt] = $idx;\n    var $code = it.validate($it);\n    $it.baseId = $currentBaseId;\n    if (it.util.varOccurences($code, $nextData) < 2) {\n      out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n    } else {\n      out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n    }\n    if ($breakOnError) {\n      out += ' if (!' + ($nextValid) + ') break; ';\n    }\n    out += ' }';\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limit(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $isMax = $keyword == 'maximum',\n    $exclusiveKeyword = $isMax ? 'exclusiveMaximum' : 'exclusiveMinimum',\n    $schemaExcl = it.schema[$exclusiveKeyword],\n    $isDataExcl = it.opts.$data && $schemaExcl && $schemaExcl.$data,\n    $op = $isMax ? '<' : '>',\n    $notOp = $isMax ? '>' : '<',\n    $errorKeyword = undefined;\n  if (!($isData || typeof $schema == 'number' || $schema === undefined)) {\n    throw new Error($keyword + ' must be number');\n  }\n  if (!($isDataExcl || $schemaExcl === undefined || typeof $schemaExcl == 'number' || typeof $schemaExcl == 'boolean')) {\n    throw new Error($exclusiveKeyword + ' must be number or boolean');\n  }\n  if ($isDataExcl) {\n    var $schemaValueExcl = it.util.getData($schemaExcl.$data, $dataLvl, it.dataPathArr),\n      $exclusive = 'exclusive' + $lvl,\n      $exclType = 'exclType' + $lvl,\n      $exclIsNumber = 'exclIsNumber' + $lvl,\n      $opExpr = 'op' + $lvl,\n      $opStr = '\\' + ' + $opExpr + ' + \\'';\n    out += ' var schemaExcl' + ($lvl) + ' = ' + ($schemaValueExcl) + '; ';\n    $schemaValueExcl = 'schemaExcl' + $lvl;\n    out += ' var ' + ($exclusive) + '; var ' + ($exclType) + ' = typeof ' + ($schemaValueExcl) + '; if (' + ($exclType) + ' != \\'boolean\\' && ' + ($exclType) + ' != \\'undefined\\' && ' + ($exclType) + ' != \\'number\\') { ';\n    var $errorKeyword = $exclusiveKeyword;\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ($errorKeyword || '_exclusiveLimit') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'' + ($exclusiveKeyword) + ' should be boolean\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    out += ' } else if ( ';\n    if ($isData) {\n      out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n    }\n    out += ' ' + ($exclType) + ' == \\'number\\' ? ( (' + ($exclusive) + ' = ' + ($schemaValue) + ' === undefined || ' + ($schemaValueExcl) + ' ' + ($op) + '= ' + ($schemaValue) + ') ? ' + ($data) + ' ' + ($notOp) + '= ' + ($schemaValueExcl) + ' : ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' ) : ( (' + ($exclusive) + ' = ' + ($schemaValueExcl) + ' === true) ? ' + ($data) + ' ' + ($notOp) + '= ' + ($schemaValue) + ' : ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' ) || ' + ($data) + ' !== ' + ($data) + ') { var op' + ($lvl) + ' = ' + ($exclusive) + ' ? \\'' + ($op) + '\\' : \\'' + ($op) + '=\\'; ';\n    if ($schema === undefined) {\n      $errorKeyword = $exclusiveKeyword;\n      $errSchemaPath = it.errSchemaPath + '/' + $exclusiveKeyword;\n      $schemaValue = $schemaValueExcl;\n      $isData = $isDataExcl;\n    }\n  } else {\n    var $exclIsNumber = typeof $schemaExcl == 'number',\n      $opStr = $op;\n    if ($exclIsNumber && $isData) {\n      var $opExpr = '\\'' + $opStr + '\\'';\n      out += ' if ( ';\n      if ($isData) {\n        out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n      }\n      out += ' ( ' + ($schemaValue) + ' === undefined || ' + ($schemaExcl) + ' ' + ($op) + '= ' + ($schemaValue) + ' ? ' + ($data) + ' ' + ($notOp) + '= ' + ($schemaExcl) + ' : ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' ) || ' + ($data) + ' !== ' + ($data) + ') { ';\n    } else {\n      if ($exclIsNumber && $schema === undefined) {\n        $exclusive = true;\n        $errorKeyword = $exclusiveKeyword;\n        $errSchemaPath = it.errSchemaPath + '/' + $exclusiveKeyword;\n        $schemaValue = $schemaExcl;\n        $notOp += '=';\n      } else {\n        if ($exclIsNumber) $schemaValue = Math[$isMax ? 'min' : 'max']($schemaExcl, $schema);\n        if ($schemaExcl === ($exclIsNumber ? $schemaValue : true)) {\n          $exclusive = true;\n          $errorKeyword = $exclusiveKeyword;\n          $errSchemaPath = it.errSchemaPath + '/' + $exclusiveKeyword;\n          $notOp += '=';\n        } else {\n          $exclusive = false;\n          $opStr += '=';\n        }\n      }\n      var $opExpr = '\\'' + $opStr + '\\'';\n      out += ' if ( ';\n      if ($isData) {\n        out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n      }\n      out += ' ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' || ' + ($data) + ' !== ' + ($data) + ') { ';\n    }\n  }\n  $errorKeyword = $errorKeyword || $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limit') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { comparison: ' + ($opExpr) + ', limit: ' + ($schemaValue) + ', exclusive: ' + ($exclusive) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be ' + ($opStr) + ' ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue);\n      } else {\n        out += '' + ($schemaValue) + '\\'';\n      }\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' } ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limitItems(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (!($isData || typeof $schema == 'number')) {\n    throw new Error($keyword + ' must be number');\n  }\n  var $op = $keyword == 'maxItems' ? '>' : '<';\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n  }\n  out += ' ' + ($data) + '.length ' + ($op) + ' ' + ($schemaValue) + ') { ';\n  var $errorKeyword = $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limitItems') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should NOT have ';\n      if ($keyword == 'maxItems') {\n        out += 'more';\n      } else {\n        out += 'fewer';\n      }\n      out += ' than ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + ($schema);\n      }\n      out += ' items\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limitLength(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (!($isData || typeof $schema == 'number')) {\n    throw new Error($keyword + ' must be number');\n  }\n  var $op = $keyword == 'maxLength' ? '>' : '<';\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n  }\n  if (it.opts.unicode === false) {\n    out += ' ' + ($data) + '.length ';\n  } else {\n    out += ' ucs2length(' + ($data) + ') ';\n  }\n  out += ' ' + ($op) + ' ' + ($schemaValue) + ') { ';\n  var $errorKeyword = $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limitLength') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should NOT be ';\n      if ($keyword == 'maxLength') {\n        out += 'longer';\n      } else {\n        out += 'shorter';\n      }\n      out += ' than ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + ($schema);\n      }\n      out += ' characters\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limitProperties(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (!($isData || typeof $schema == 'number')) {\n    throw new Error($keyword + ' must be number');\n  }\n  var $op = $keyword == 'maxProperties' ? '>' : '<';\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n  }\n  out += ' Object.keys(' + ($data) + ').length ' + ($op) + ' ' + ($schemaValue) + ') { ';\n  var $errorKeyword = $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limitProperties') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should NOT have ';\n      if ($keyword == 'maxProperties') {\n        out += 'more';\n      } else {\n        out += 'fewer';\n      }\n      out += ' than ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + ($schema);\n      }\n      out += ' properties\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_multipleOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (!($isData || typeof $schema == 'number')) {\n    throw new Error($keyword + ' must be number');\n  }\n  out += 'var division' + ($lvl) + ';if (';\n  if ($isData) {\n    out += ' ' + ($schemaValue) + ' !== undefined && ( typeof ' + ($schemaValue) + ' != \\'number\\' || ';\n  }\n  out += ' (division' + ($lvl) + ' = ' + ($data) + ' / ' + ($schemaValue) + ', ';\n  if (it.opts.multipleOfPrecision) {\n    out += ' Math.abs(Math.round(division' + ($lvl) + ') - division' + ($lvl) + ') > 1e-' + (it.opts.multipleOfPrecision) + ' ';\n  } else {\n    out += ' division' + ($lvl) + ' !== parseInt(division' + ($lvl) + ') ';\n  }\n  out += ' ) ';\n  if ($isData) {\n    out += '  )  ';\n  }\n  out += ' ) {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('multipleOf') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { multipleOf: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be multiple of ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue);\n      } else {\n        out += '' + ($schemaValue) + '\\'';\n      }\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_not(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  if ((it.opts.strictKeywords ? (typeof $schema == 'object' && Object.keys($schema).length > 0) || $schema === false : it.util.schemaHasRules($schema, it.RULES.all))) {\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += ' var ' + ($errs) + ' = errors;  ';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    $it.createErrors = false;\n    var $allErrorsOption;\n    if ($it.opts.allErrors) {\n      $allErrorsOption = $it.opts.allErrors;\n      $it.opts.allErrors = false;\n    }\n    out += ' ' + (it.validate($it)) + ' ';\n    $it.createErrors = true;\n    if ($allErrorsOption) $it.opts.allErrors = $allErrorsOption;\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' if (' + ($nextValid) + ') {   ';\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('not') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should NOT be valid\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    out += ' } else {  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; } ';\n    if (it.opts.allErrors) {\n      out += ' } ';\n    }\n  } else {\n    out += '  var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('not') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should NOT be valid\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if ($breakOnError) {\n      out += ' if (false) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_oneOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $currentBaseId = $it.baseId,\n    $prevValid = 'prevValid' + $lvl,\n    $passingSchemas = 'passingSchemas' + $lvl;\n  out += 'var ' + ($errs) + ' = errors , ' + ($prevValid) + ' = false , ' + ($valid) + ' = false , ' + ($passingSchemas) + ' = null; ';\n  var $wasComposite = it.compositeRule;\n  it.compositeRule = $it.compositeRule = true;\n  var arr1 = $schema;\n  if (arr1) {\n    var $sch, $i = -1,\n      l1 = arr1.length - 1;\n    while ($i < l1) {\n      $sch = arr1[$i += 1];\n      if ((it.opts.strictKeywords ? (typeof $sch == 'object' && Object.keys($sch).length > 0) || $sch === false : it.util.schemaHasRules($sch, it.RULES.all))) {\n        $it.schema = $sch;\n        $it.schemaPath = $schemaPath + '[' + $i + ']';\n        $it.errSchemaPath = $errSchemaPath + '/' + $i;\n        out += '  ' + (it.validate($it)) + ' ';\n        $it.baseId = $currentBaseId;\n      } else {\n        out += ' var ' + ($nextValid) + ' = true; ';\n      }\n      if ($i) {\n        out += ' if (' + ($nextValid) + ' && ' + ($prevValid) + ') { ' + ($valid) + ' = false; ' + ($passingSchemas) + ' = [' + ($passingSchemas) + ', ' + ($i) + ']; } else { ';\n        $closingBraces += '}';\n      }\n      out += ' if (' + ($nextValid) + ') { ' + ($valid) + ' = ' + ($prevValid) + ' = true; ' + ($passingSchemas) + ' = ' + ($i) + '; }';\n    }\n  }\n  it.compositeRule = $it.compositeRule = $wasComposite;\n  out += '' + ($closingBraces) + 'if (!' + ($valid) + ') {   var err =   '; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('oneOf') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { passingSchemas: ' + ($passingSchemas) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should match exactly one schema in oneOf\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError(vErrors); ';\n    } else {\n      out += ' validate.errors = vErrors; return false; ';\n    }\n  }\n  out += '} else {  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; }';\n  if (it.opts.allErrors) {\n    out += ' } ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_pattern(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $regexp = $isData ? '(new RegExp(' + $schemaValue + '))' : it.usePattern($schema);\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'string\\') || ';\n  }\n  out += ' !' + ($regexp) + '.test(' + ($data) + ') ) {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('pattern') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { pattern:  ';\n    if ($isData) {\n      out += '' + ($schemaValue);\n    } else {\n      out += '' + (it.util.toQuotedString($schema));\n    }\n    out += '  } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should match pattern \"';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + (it.util.escapeQuotes($schema));\n      }\n      out += '\"\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + (it.util.toQuotedString($schema));\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_properties(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $key = 'key' + $lvl,\n    $idx = 'idx' + $lvl,\n    $dataNxt = $it.dataLevel = it.dataLevel + 1,\n    $nextData = 'data' + $dataNxt,\n    $dataProperties = 'dataProperties' + $lvl;\n  var $schemaKeys = Object.keys($schema || {}).filter(notProto),\n    $pProperties = it.schema.patternProperties || {},\n    $pPropertyKeys = Object.keys($pProperties).filter(notProto),\n    $aProperties = it.schema.additionalProperties,\n    $someProperties = $schemaKeys.length || $pPropertyKeys.length,\n    $noAdditional = $aProperties === false,\n    $additionalIsSchema = typeof $aProperties == 'object' && Object.keys($aProperties).length,\n    $removeAdditional = it.opts.removeAdditional,\n    $checkAdditional = $noAdditional || $additionalIsSchema || $removeAdditional,\n    $ownProperties = it.opts.ownProperties,\n    $currentBaseId = it.baseId;\n  var $required = it.schema.required;\n  if ($required && !(it.opts.$data && $required.$data) && $required.length < it.opts.loopRequired) {\n    var $requiredHash = it.util.toHash($required);\n  }\n\n  function notProto(p) {\n    return p !== '__proto__';\n  }\n  out += 'var ' + ($errs) + ' = errors;var ' + ($nextValid) + ' = true;';\n  if ($ownProperties) {\n    out += ' var ' + ($dataProperties) + ' = undefined;';\n  }\n  if ($checkAdditional) {\n    if ($ownProperties) {\n      out += ' ' + ($dataProperties) + ' = ' + ($dataProperties) + ' || Object.keys(' + ($data) + '); for (var ' + ($idx) + '=0; ' + ($idx) + '<' + ($dataProperties) + '.length; ' + ($idx) + '++) { var ' + ($key) + ' = ' + ($dataProperties) + '[' + ($idx) + ']; ';\n    } else {\n      out += ' for (var ' + ($key) + ' in ' + ($data) + ') { ';\n    }\n    if ($someProperties) {\n      out += ' var isAdditional' + ($lvl) + ' = !(false ';\n      if ($schemaKeys.length) {\n        if ($schemaKeys.length > 8) {\n          out += ' || validate.schema' + ($schemaPath) + '.hasOwnProperty(' + ($key) + ') ';\n        } else {\n          var arr1 = $schemaKeys;\n          if (arr1) {\n            var $propertyKey, i1 = -1,\n              l1 = arr1.length - 1;\n            while (i1 < l1) {\n              $propertyKey = arr1[i1 += 1];\n              out += ' || ' + ($key) + ' == ' + (it.util.toQuotedString($propertyKey)) + ' ';\n            }\n          }\n        }\n      }\n      if ($pPropertyKeys.length) {\n        var arr2 = $pPropertyKeys;\n        if (arr2) {\n          var $pProperty, $i = -1,\n            l2 = arr2.length - 1;\n          while ($i < l2) {\n            $pProperty = arr2[$i += 1];\n            out += ' || ' + (it.usePattern($pProperty)) + '.test(' + ($key) + ') ';\n          }\n        }\n      }\n      out += ' ); if (isAdditional' + ($lvl) + ') { ';\n    }\n    if ($removeAdditional == 'all') {\n      out += ' delete ' + ($data) + '[' + ($key) + ']; ';\n    } else {\n      var $currentErrorPath = it.errorPath;\n      var $additionalProperty = '\\' + ' + $key + ' + \\'';\n      if (it.opts._errorDataPathProperty) {\n        it.errorPath = it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n      }\n      if ($noAdditional) {\n        if ($removeAdditional) {\n          out += ' delete ' + ($data) + '[' + ($key) + ']; ';\n        } else {\n          out += ' ' + ($nextValid) + ' = false; ';\n          var $currErrSchemaPath = $errSchemaPath;\n          $errSchemaPath = it.errSchemaPath + '/additionalProperties';\n          var $$outStack = $$outStack || [];\n          $$outStack.push(out);\n          out = ''; /* istanbul ignore else */\n          if (it.createErrors !== false) {\n            out += ' { keyword: \\'' + ('additionalProperties') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { additionalProperty: \\'' + ($additionalProperty) + '\\' } ';\n            if (it.opts.messages !== false) {\n              out += ' , message: \\'';\n              if (it.opts._errorDataPathProperty) {\n                out += 'is an invalid additional property';\n              } else {\n                out += 'should NOT have additional properties';\n              }\n              out += '\\' ';\n            }\n            if (it.opts.verbose) {\n              out += ' , schema: false , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n            }\n            out += ' } ';\n          } else {\n            out += ' {} ';\n          }\n          var __err = out;\n          out = $$outStack.pop();\n          if (!it.compositeRule && $breakOnError) {\n            /* istanbul ignore if */\n            if (it.async) {\n              out += ' throw new ValidationError([' + (__err) + ']); ';\n            } else {\n              out += ' validate.errors = [' + (__err) + ']; return false; ';\n            }\n          } else {\n            out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n          }\n          $errSchemaPath = $currErrSchemaPath;\n          if ($breakOnError) {\n            out += ' break; ';\n          }\n        }\n      } else if ($additionalIsSchema) {\n        if ($removeAdditional == 'failing') {\n          out += ' var ' + ($errs) + ' = errors;  ';\n          var $wasComposite = it.compositeRule;\n          it.compositeRule = $it.compositeRule = true;\n          $it.schema = $aProperties;\n          $it.schemaPath = it.schemaPath + '.additionalProperties';\n          $it.errSchemaPath = it.errSchemaPath + '/additionalProperties';\n          $it.errorPath = it.opts._errorDataPathProperty ? it.errorPath : it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n          var $passData = $data + '[' + $key + ']';\n          $it.dataPathArr[$dataNxt] = $key;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          out += ' if (!' + ($nextValid) + ') { errors = ' + ($errs) + '; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete ' + ($data) + '[' + ($key) + ']; }  ';\n          it.compositeRule = $it.compositeRule = $wasComposite;\n        } else {\n          $it.schema = $aProperties;\n          $it.schemaPath = it.schemaPath + '.additionalProperties';\n          $it.errSchemaPath = it.errSchemaPath + '/additionalProperties';\n          $it.errorPath = it.opts._errorDataPathProperty ? it.errorPath : it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n          var $passData = $data + '[' + $key + ']';\n          $it.dataPathArr[$dataNxt] = $key;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          if ($breakOnError) {\n            out += ' if (!' + ($nextValid) + ') break; ';\n          }\n        }\n      }\n      it.errorPath = $currentErrorPath;\n    }\n    if ($someProperties) {\n      out += ' } ';\n    }\n    out += ' }  ';\n    if ($breakOnError) {\n      out += ' if (' + ($nextValid) + ') { ';\n      $closingBraces += '}';\n    }\n  }\n  var $useDefaults = it.opts.useDefaults && !it.compositeRule;\n  if ($schemaKeys.length) {\n    var arr3 = $schemaKeys;\n    if (arr3) {\n      var $propertyKey, i3 = -1,\n        l3 = arr3.length - 1;\n      while (i3 < l3) {\n        $propertyKey = arr3[i3 += 1];\n        var $sch = $schema[$propertyKey];\n        if ((it.opts.strictKeywords ? (typeof $sch == 'object' && Object.keys($sch).length > 0) || $sch === false : it.util.schemaHasRules($sch, it.RULES.all))) {\n          var $prop = it.util.getProperty($propertyKey),\n            $passData = $data + $prop,\n            $hasDefault = $useDefaults && $sch.default !== undefined;\n          $it.schema = $sch;\n          $it.schemaPath = $schemaPath + $prop;\n          $it.errSchemaPath = $errSchemaPath + '/' + it.util.escapeFragment($propertyKey);\n          $it.errorPath = it.util.getPath(it.errorPath, $propertyKey, it.opts.jsonPointers);\n          $it.dataPathArr[$dataNxt] = it.util.toQuotedString($propertyKey);\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            $code = it.util.varReplace($code, $nextData, $passData);\n            var $useData = $passData;\n          } else {\n            var $useData = $nextData;\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ';\n          }\n          if ($hasDefault) {\n            out += ' ' + ($code) + ' ';\n          } else {\n            if ($requiredHash && $requiredHash[$propertyKey]) {\n              out += ' if ( ' + ($useData) + ' === undefined ';\n              if ($ownProperties) {\n                out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n              }\n              out += ') { ' + ($nextValid) + ' = false; ';\n              var $currentErrorPath = it.errorPath,\n                $currErrSchemaPath = $errSchemaPath,\n                $missingProperty = it.util.escapeQuotes($propertyKey);\n              if (it.opts._errorDataPathProperty) {\n                it.errorPath = it.util.getPath($currentErrorPath, $propertyKey, it.opts.jsonPointers);\n              }\n              $errSchemaPath = it.errSchemaPath + '/required';\n              var $$outStack = $$outStack || [];\n              $$outStack.push(out);\n              out = ''; /* istanbul ignore else */\n              if (it.createErrors !== false) {\n                out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n                if (it.opts.messages !== false) {\n                  out += ' , message: \\'';\n                  if (it.opts._errorDataPathProperty) {\n                    out += 'is a required property';\n                  } else {\n                    out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n                  }\n                  out += '\\' ';\n                }\n                if (it.opts.verbose) {\n                  out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n                }\n                out += ' } ';\n              } else {\n                out += ' {} ';\n              }\n              var __err = out;\n              out = $$outStack.pop();\n              if (!it.compositeRule && $breakOnError) {\n                /* istanbul ignore if */\n                if (it.async) {\n                  out += ' throw new ValidationError([' + (__err) + ']); ';\n                } else {\n                  out += ' validate.errors = [' + (__err) + ']; return false; ';\n                }\n              } else {\n                out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n              }\n              $errSchemaPath = $currErrSchemaPath;\n              it.errorPath = $currentErrorPath;\n              out += ' } else { ';\n            } else {\n              if ($breakOnError) {\n                out += ' if ( ' + ($useData) + ' === undefined ';\n                if ($ownProperties) {\n                  out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n                }\n                out += ') { ' + ($nextValid) + ' = true; } else { ';\n              } else {\n                out += ' if (' + ($useData) + ' !== undefined ';\n                if ($ownProperties) {\n                  out += ' &&   Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n                }\n                out += ' ) { ';\n              }\n            }\n            out += ' ' + ($code) + ' } ';\n          }\n        }\n        if ($breakOnError) {\n          out += ' if (' + ($nextValid) + ') { ';\n          $closingBraces += '}';\n        }\n      }\n    }\n  }\n  if ($pPropertyKeys.length) {\n    var arr4 = $pPropertyKeys;\n    if (arr4) {\n      var $pProperty, i4 = -1,\n        l4 = arr4.length - 1;\n      while (i4 < l4) {\n        $pProperty = arr4[i4 += 1];\n        var $sch = $pProperties[$pProperty];\n        if ((it.opts.strictKeywords ? (typeof $sch == 'object' && Object.keys($sch).length > 0) || $sch === false : it.util.schemaHasRules($sch, it.RULES.all))) {\n          $it.schema = $sch;\n          $it.schemaPath = it.schemaPath + '.patternProperties' + it.util.getProperty($pProperty);\n          $it.errSchemaPath = it.errSchemaPath + '/patternProperties/' + it.util.escapeFragment($pProperty);\n          if ($ownProperties) {\n            out += ' ' + ($dataProperties) + ' = ' + ($dataProperties) + ' || Object.keys(' + ($data) + '); for (var ' + ($idx) + '=0; ' + ($idx) + '<' + ($dataProperties) + '.length; ' + ($idx) + '++) { var ' + ($key) + ' = ' + ($dataProperties) + '[' + ($idx) + ']; ';\n          } else {\n            out += ' for (var ' + ($key) + ' in ' + ($data) + ') { ';\n          }\n          out += ' if (' + (it.usePattern($pProperty)) + '.test(' + ($key) + ')) { ';\n          $it.errorPath = it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n          var $passData = $data + '[' + $key + ']';\n          $it.dataPathArr[$dataNxt] = $key;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          if ($breakOnError) {\n            out += ' if (!' + ($nextValid) + ') break; ';\n          }\n          out += ' } ';\n          if ($breakOnError) {\n            out += ' else ' + ($nextValid) + ' = true; ';\n          }\n          out += ' }  ';\n          if ($breakOnError) {\n            out += ' if (' + ($nextValid) + ') { ';\n            $closingBraces += '}';\n          }\n        }\n      }\n    }\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_propertyNames(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  out += 'var ' + ($errs) + ' = errors;';\n  if ((it.opts.strictKeywords ? (typeof $schema == 'object' && Object.keys($schema).length > 0) || $schema === false : it.util.schemaHasRules($schema, it.RULES.all))) {\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    var $key = 'key' + $lvl,\n      $idx = 'idx' + $lvl,\n      $i = 'i' + $lvl,\n      $invalidName = '\\' + ' + $key + ' + \\'',\n      $dataNxt = $it.dataLevel = it.dataLevel + 1,\n      $nextData = 'data' + $dataNxt,\n      $dataProperties = 'dataProperties' + $lvl,\n      $ownProperties = it.opts.ownProperties,\n      $currentBaseId = it.baseId;\n    if ($ownProperties) {\n      out += ' var ' + ($dataProperties) + ' = undefined; ';\n    }\n    if ($ownProperties) {\n      out += ' ' + ($dataProperties) + ' = ' + ($dataProperties) + ' || Object.keys(' + ($data) + '); for (var ' + ($idx) + '=0; ' + ($idx) + '<' + ($dataProperties) + '.length; ' + ($idx) + '++) { var ' + ($key) + ' = ' + ($dataProperties) + '[' + ($idx) + ']; ';\n    } else {\n      out += ' for (var ' + ($key) + ' in ' + ($data) + ') { ';\n    }\n    out += ' var startErrs' + ($lvl) + ' = errors; ';\n    var $passData = $key;\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    var $code = it.validate($it);\n    $it.baseId = $currentBaseId;\n    if (it.util.varOccurences($code, $nextData) < 2) {\n      out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n    } else {\n      out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n    }\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' if (!' + ($nextValid) + ') { for (var ' + ($i) + '=startErrs' + ($lvl) + '; ' + ($i) + '<errors; ' + ($i) + '++) { vErrors[' + ($i) + '].propertyName = ' + ($key) + '; }   var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('propertyNames') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { propertyName: \\'' + ($invalidName) + '\\' } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'property name \\\\\\'' + ($invalidName) + '\\\\\\' is invalid\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError(vErrors); ';\n      } else {\n        out += ' validate.errors = vErrors; return false; ';\n      }\n    }\n    if ($breakOnError) {\n      out += ' break; ';\n    }\n    out += ' } }';\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_required(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $vSchema = 'schema' + $lvl;\n  if (!$isData) {\n    if ($schema.length < it.opts.loopRequired && it.schema.properties && Object.keys(it.schema.properties).length) {\n      var $required = [];\n      var arr1 = $schema;\n      if (arr1) {\n        var $property, i1 = -1,\n          l1 = arr1.length - 1;\n        while (i1 < l1) {\n          $property = arr1[i1 += 1];\n          var $propertySch = it.schema.properties[$property];\n          if (!($propertySch && (it.opts.strictKeywords ? (typeof $propertySch == 'object' && Object.keys($propertySch).length > 0) || $propertySch === false : it.util.schemaHasRules($propertySch, it.RULES.all)))) {\n            $required[$required.length] = $property;\n          }\n        }\n      }\n    } else {\n      var $required = $schema;\n    }\n  }\n  if ($isData || $required.length) {\n    var $currentErrorPath = it.errorPath,\n      $loopRequired = $isData || $required.length >= it.opts.loopRequired,\n      $ownProperties = it.opts.ownProperties;\n    if ($breakOnError) {\n      out += ' var missing' + ($lvl) + '; ';\n      if ($loopRequired) {\n        if (!$isData) {\n          out += ' var ' + ($vSchema) + ' = validate.schema' + ($schemaPath) + '; ';\n        }\n        var $i = 'i' + $lvl,\n          $propertyPath = 'schema' + $lvl + '[' + $i + ']',\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.util.getPathExpr($currentErrorPath, $propertyPath, it.opts.jsonPointers);\n        }\n        out += ' var ' + ($valid) + ' = true; ';\n        if ($isData) {\n          out += ' if (schema' + ($lvl) + ' === undefined) ' + ($valid) + ' = true; else if (!Array.isArray(schema' + ($lvl) + ')) ' + ($valid) + ' = false; else {';\n        }\n        out += ' for (var ' + ($i) + ' = 0; ' + ($i) + ' < ' + ($vSchema) + '.length; ' + ($i) + '++) { ' + ($valid) + ' = ' + ($data) + '[' + ($vSchema) + '[' + ($i) + ']] !== undefined ';\n        if ($ownProperties) {\n          out += ' &&   Object.prototype.hasOwnProperty.call(' + ($data) + ', ' + ($vSchema) + '[' + ($i) + ']) ';\n        }\n        out += '; if (!' + ($valid) + ') break; } ';\n        if ($isData) {\n          out += '  }  ';\n        }\n        out += '  if (!' + ($valid) + ') {   ';\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'';\n            if (it.opts._errorDataPathProperty) {\n              out += 'is a required property';\n            } else {\n              out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        out += ' } else { ';\n      } else {\n        out += ' if ( ';\n        var arr2 = $required;\n        if (arr2) {\n          var $propertyKey, $i = -1,\n            l2 = arr2.length - 1;\n          while ($i < l2) {\n            $propertyKey = arr2[$i += 1];\n            if ($i) {\n              out += ' || ';\n            }\n            var $prop = it.util.getProperty($propertyKey),\n              $useData = $data + $prop;\n            out += ' ( ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') && (missing' + ($lvl) + ' = ' + (it.util.toQuotedString(it.opts.jsonPointers ? $propertyKey : $prop)) + ') ) ';\n          }\n        }\n        out += ') {  ';\n        var $propertyPath = 'missing' + $lvl,\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.opts.jsonPointers ? it.util.getPathExpr($currentErrorPath, $propertyPath, true) : $currentErrorPath + ' + ' + $propertyPath;\n        }\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'';\n            if (it.opts._errorDataPathProperty) {\n              out += 'is a required property';\n            } else {\n              out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        out += ' } else { ';\n      }\n    } else {\n      if ($loopRequired) {\n        if (!$isData) {\n          out += ' var ' + ($vSchema) + ' = validate.schema' + ($schemaPath) + '; ';\n        }\n        var $i = 'i' + $lvl,\n          $propertyPath = 'schema' + $lvl + '[' + $i + ']',\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.util.getPathExpr($currentErrorPath, $propertyPath, it.opts.jsonPointers);\n        }\n        if ($isData) {\n          out += ' if (' + ($vSchema) + ' && !Array.isArray(' + ($vSchema) + ')) {  var err =   '; /* istanbul ignore else */\n          if (it.createErrors !== false) {\n            out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n            if (it.opts.messages !== false) {\n              out += ' , message: \\'';\n              if (it.opts._errorDataPathProperty) {\n                out += 'is a required property';\n              } else {\n                out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n              }\n              out += '\\' ';\n            }\n            if (it.opts.verbose) {\n              out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n            }\n            out += ' } ';\n          } else {\n            out += ' {} ';\n          }\n          out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if (' + ($vSchema) + ' !== undefined) { ';\n        }\n        out += ' for (var ' + ($i) + ' = 0; ' + ($i) + ' < ' + ($vSchema) + '.length; ' + ($i) + '++) { if (' + ($data) + '[' + ($vSchema) + '[' + ($i) + ']] === undefined ';\n        if ($ownProperties) {\n          out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', ' + ($vSchema) + '[' + ($i) + ']) ';\n        }\n        out += ') {  var err =   '; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'';\n            if (it.opts._errorDataPathProperty) {\n              out += 'is a required property';\n            } else {\n              out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ';\n        if ($isData) {\n          out += '  }  ';\n        }\n      } else {\n        var arr3 = $required;\n        if (arr3) {\n          var $propertyKey, i3 = -1,\n            l3 = arr3.length - 1;\n          while (i3 < l3) {\n            $propertyKey = arr3[i3 += 1];\n            var $prop = it.util.getProperty($propertyKey),\n              $missingProperty = it.util.escapeQuotes($propertyKey),\n              $useData = $data + $prop;\n            if (it.opts._errorDataPathProperty) {\n              it.errorPath = it.util.getPath($currentErrorPath, $propertyKey, it.opts.jsonPointers);\n            }\n            out += ' if ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') {  var err =   '; /* istanbul ignore else */\n            if (it.createErrors !== false) {\n              out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n              if (it.opts.messages !== false) {\n                out += ' , message: \\'';\n                if (it.opts._errorDataPathProperty) {\n                  out += 'is a required property';\n                } else {\n                  out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n                }\n                out += '\\' ';\n              }\n              if (it.opts.verbose) {\n                out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n              }\n              out += ' } ';\n            } else {\n              out += ' {} ';\n            }\n            out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } ';\n          }\n        }\n      }\n    }\n    it.errorPath = $currentErrorPath;\n  } else if ($breakOnError) {\n    out += ' if (true) {';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_uniqueItems(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (($schema || $isData) && it.opts.uniqueItems !== false) {\n    if ($isData) {\n      out += ' var ' + ($valid) + '; if (' + ($schemaValue) + ' === false || ' + ($schemaValue) + ' === undefined) ' + ($valid) + ' = true; else if (typeof ' + ($schemaValue) + ' != \\'boolean\\') ' + ($valid) + ' = false; else { ';\n    }\n    out += ' var i = ' + ($data) + '.length , ' + ($valid) + ' = true , j; if (i > 1) { ';\n    var $itemType = it.schema.items && it.schema.items.type,\n      $typeIsArray = Array.isArray($itemType);\n    if (!$itemType || $itemType == 'object' || $itemType == 'array' || ($typeIsArray && ($itemType.indexOf('object') >= 0 || $itemType.indexOf('array') >= 0))) {\n      out += ' outer: for (;i--;) { for (j = i; j--;) { if (equal(' + ($data) + '[i], ' + ($data) + '[j])) { ' + ($valid) + ' = false; break outer; } } } ';\n    } else {\n      out += ' var itemIndices = {}, item; for (;i--;) { var item = ' + ($data) + '[i]; ';\n      var $method = 'checkDataType' + ($typeIsArray ? 's' : '');\n      out += ' if (' + (it.util[$method]($itemType, 'item', it.opts.strictNumbers, true)) + ') continue; ';\n      if ($typeIsArray) {\n        out += ' if (typeof item == \\'string\\') item = \\'\"\\' + item; ';\n      }\n      out += ' if (typeof itemIndices[item] == \\'number\\') { ' + ($valid) + ' = false; j = itemIndices[item]; break; } itemIndices[item] = i; } ';\n    }\n    out += ' } ';\n    if ($isData) {\n      out += '  }  ';\n    }\n    out += ' if (!' + ($valid) + ') {   ';\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('uniqueItems') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { i: i, j: j } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should NOT have duplicate items (items ## \\' + j + \\' and \\' + i + \\' are identical)\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema:  ';\n        if ($isData) {\n          out += 'validate.schema' + ($schemaPath);\n        } else {\n          out += '' + ($schema);\n        }\n        out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    out += ' } ';\n    if ($breakOnError) {\n      out += ' else { ';\n    }\n  } else {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\n\n//all requires must be explicit because browserify won't work with dynamic requires\nmodule.exports = {\n  '$ref': require('./ref'),\n  allOf: require('./allOf'),\n  anyOf: require('./anyOf'),\n  '$comment': require('./comment'),\n  const: require('./const'),\n  contains: require('./contains'),\n  dependencies: require('./dependencies'),\n  'enum': require('./enum'),\n  format: require('./format'),\n  'if': require('./if'),\n  items: require('./items'),\n  maximum: require('./_limit'),\n  minimum: require('./_limit'),\n  maxItems: require('./_limitItems'),\n  minItems: require('./_limitItems'),\n  maxLength: require('./_limitLength'),\n  minLength: require('./_limitLength'),\n  maxProperties: require('./_limitProperties'),\n  minProperties: require('./_limitProperties'),\n  multipleOf: require('./multipleOf'),\n  not: require('./not'),\n  oneOf: require('./oneOf'),\n  pattern: require('./pattern'),\n  properties: require('./properties'),\n  propertyNames: require('./propertyNames'),\n  required: require('./required'),\n  uniqueItems: require('./uniqueItems'),\n  validate: require('./validate')\n};\n","'use strict';\n\nvar ruleModules = require('../dotjs')\n  , toHash = require('./util').toHash;\n\nmodule.exports = function rules() {\n  var RULES = [\n    { type: 'number',\n      rules: [ { 'maximum': ['exclusiveMaximum'] },\n               { 'minimum': ['exclusiveMinimum'] }, 'multipleOf', 'format'] },\n    { type: 'string',\n      rules: [ 'maxLength', 'minLength', 'pattern', 'format' ] },\n    { type: 'array',\n      rules: [ 'maxItems', 'minItems', 'items', 'contains', 'uniqueItems' ] },\n    { type: 'object',\n      rules: [ 'maxProperties', 'minProperties', 'required', 'dependencies', 'propertyNames',\n               { 'properties': ['additionalProperties', 'patternProperties'] } ] },\n    { rules: [ '$ref', 'const', 'enum', 'not', 'anyOf', 'oneOf', 'allOf', 'if' ] }\n  ];\n\n  var ALL = [ 'type', '$comment' ];\n  var KEYWORDS = [\n    '$schema', '$id', 'id', '$data', '$async', 'title',\n    'description', 'default', 'definitions',\n    'examples', 'readOnly', 'writeOnly',\n    'contentMediaType', 'contentEncoding',\n    'additionalItems', 'then', 'else'\n  ];\n  var TYPES = [ 'number', 'integer', 'string', 'array', 'object', 'boolean', 'null' ];\n  RULES.all = toHash(ALL);\n  RULES.types = toHash(TYPES);\n\n  RULES.forEach(function (group) {\n    group.rules = group.rules.map(function (keyword) {\n      var implKeywords;\n      if (typeof keyword == 'object') {\n        var key = Object.keys(keyword)[0];\n        implKeywords = keyword[key];\n        keyword = key;\n        implKeywords.forEach(function (k) {\n          ALL.push(k);\n          RULES.all[k] = true;\n        });\n      }\n      ALL.push(keyword);\n      var rule = RULES.all[keyword] = {\n        keyword: keyword,\n        code: ruleModules[keyword],\n        implements: implKeywords\n      };\n      return rule;\n    });\n\n    RULES.all.$comment = {\n      keyword: '$comment',\n      code: ruleModules.$comment\n    };\n\n    if (group.type) RULES.types[group.type] = group;\n  });\n\n  RULES.keywords = toHash(ALL.concat(KEYWORDS));\n  RULES.custom = {};\n\n  return RULES;\n};\n","'use strict';\n\nvar KEYWORDS = [\n  'multipleOf',\n  'maximum',\n  'exclusiveMaximum',\n  'minimum',\n  'exclusiveMinimum',\n  'maxLength',\n  'minLength',\n  'pattern',\n  'additionalItems',\n  'maxItems',\n  'minItems',\n  'uniqueItems',\n  'maxProperties',\n  'minProperties',\n  'required',\n  'additionalProperties',\n  'enum',\n  'format',\n  'const'\n];\n\nmodule.exports = function (metaSchema, keywordsJsonPointers) {\n  for (var i=0; i<keywordsJsonPointers.length; i++) {\n    metaSchema = JSON.parse(JSON.stringify(metaSchema));\n    var segments = keywordsJsonPointers[i].split('/');\n    var keywords = metaSchema;\n    var j;\n    for (j=1; j<segments.length; j++)\n      keywords = keywords[segments[j]];\n\n    for (j=0; j<KEYWORDS.length; j++) {\n      var key = KEYWORDS[j];\n      var schema = keywords[key];\n      if (schema) {\n        keywords[key] = {\n          anyOf: [\n            schema,\n            { $ref: 'https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#' }\n          ]\n        };\n      }\n    }\n  }\n\n  return metaSchema;\n};\n","'use strict';\n\nvar MissingRefError = require('./error_classes').MissingRef;\n\nmodule.exports = compileAsync;\n\n\n/**\n * Creates validating function for passed schema with asynchronous loading of missing schemas.\n * `loadSchema` option should be a function that accepts schema uri and returns promise that resolves with the schema.\n * @this  Ajv\n * @param {Object}   schema schema object\n * @param {Boolean}  meta optional true to compile meta-schema; this parameter can be skipped\n * @param {Function} callback an optional node-style callback, it is called with 2 parameters: error (or null) and validating function.\n * @return {Promise} promise that resolves with a validating function.\n */\nfunction compileAsync(schema, meta, callback) {\n  /* eslint no-shadow: 0 */\n  /* global Promise */\n  /* jshint validthis: true */\n  var self = this;\n  if (typeof this._opts.loadSchema != 'function')\n    throw new Error('options.loadSchema should be a function');\n\n  if (typeof meta == 'function') {\n    callback = meta;\n    meta = undefined;\n  }\n\n  var p = loadMetaSchemaOf(schema).then(function () {\n    var schemaObj = self._addSchema(schema, undefined, meta);\n    return schemaObj.validate || _compileAsync(schemaObj);\n  });\n\n  if (callback) {\n    p.then(\n      function(v) { callback(null, v); },\n      callback\n    );\n  }\n\n  return p;\n\n\n  function loadMetaSchemaOf(sch) {\n    var $schema = sch.$schema;\n    return $schema && !self.getSchema($schema)\n            ? compileAsync.call(self, { $ref: $schema }, true)\n            : Promise.resolve();\n  }\n\n\n  function _compileAsync(schemaObj) {\n    try { return self._compile(schemaObj); }\n    catch(e) {\n      if (e instanceof MissingRefError) return loadMissingSchema(e);\n      throw e;\n    }\n\n\n    function loadMissingSchema(e) {\n      var ref = e.missingSchema;\n      if (added(ref)) throw new Error('Schema ' + ref + ' is loaded but ' + e.missingRef + ' cannot be resolved');\n\n      var schemaPromise = self._loadingSchemas[ref];\n      if (!schemaPromise) {\n        schemaPromise = self._loadingSchemas[ref] = self._opts.loadSchema(ref);\n        schemaPromise.then(removePromise, removePromise);\n      }\n\n      return schemaPromise.then(function (sch) {\n        if (!added(ref)) {\n          return loadMetaSchemaOf(sch).then(function () {\n            if (!added(ref)) self.addSchema(sch, ref, undefined, meta);\n          });\n        }\n      }).then(function() {\n        return _compileAsync(schemaObj);\n      });\n\n      function removePromise() {\n        delete self._loadingSchemas[ref];\n      }\n\n      function added(ref) {\n        return self._refs[ref] || self._schemas[ref];\n      }\n    }\n  }\n}\n","'use strict';\nmodule.exports = function generate_custom(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $rule = this,\n    $definition = 'definition' + $lvl,\n    $rDef = $rule.definition,\n    $closingBraces = '';\n  var $compile, $inline, $macro, $ruleValidate, $validateCode;\n  if ($isData && $rDef.$data) {\n    $validateCode = 'keywordValidate' + $lvl;\n    var $validateSchema = $rDef.validateSchema;\n    out += ' var ' + ($definition) + ' = RULES.custom[\\'' + ($keyword) + '\\'].definition; var ' + ($validateCode) + ' = ' + ($definition) + '.validate;';\n  } else {\n    $ruleValidate = it.useCustomRule($rule, $schema, it.schema, it);\n    if (!$ruleValidate) return;\n    $schemaValue = 'validate.schema' + $schemaPath;\n    $validateCode = $ruleValidate.code;\n    $compile = $rDef.compile;\n    $inline = $rDef.inline;\n    $macro = $rDef.macro;\n  }\n  var $ruleErrs = $validateCode + '.errors',\n    $i = 'i' + $lvl,\n    $ruleErr = 'ruleErr' + $lvl,\n    $asyncKeyword = $rDef.async;\n  if ($asyncKeyword && !it.async) throw new Error('async keyword in sync schema');\n  if (!($inline || $macro)) {\n    out += '' + ($ruleErrs) + ' = null;';\n  }\n  out += 'var ' + ($errs) + ' = errors;var ' + ($valid) + ';';\n  if ($isData && $rDef.$data) {\n    $closingBraces += '}';\n    out += ' if (' + ($schemaValue) + ' === undefined) { ' + ($valid) + ' = true; } else { ';\n    if ($validateSchema) {\n      $closingBraces += '}';\n      out += ' ' + ($valid) + ' = ' + ($definition) + '.validateSchema(' + ($schemaValue) + '); if (' + ($valid) + ') { ';\n    }\n  }\n  if ($inline) {\n    if ($rDef.statements) {\n      out += ' ' + ($ruleValidate.validate) + ' ';\n    } else {\n      out += ' ' + ($valid) + ' = ' + ($ruleValidate.validate) + '; ';\n    }\n  } else if ($macro) {\n    var $it = it.util.copy(it);\n    var $closingBraces = '';\n    $it.level++;\n    var $nextValid = 'valid' + $it.level;\n    $it.schema = $ruleValidate.validate;\n    $it.schemaPath = '';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    var $code = it.validate($it).replace(/validate\\.schema/g, $validateCode);\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' ' + ($code);\n  } else {\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = '';\n    out += '  ' + ($validateCode) + '.call( ';\n    if (it.opts.passContext) {\n      out += 'this';\n    } else {\n      out += 'self';\n    }\n    if ($compile || $rDef.schema === false) {\n      out += ' , ' + ($data) + ' ';\n    } else {\n      out += ' , ' + ($schemaValue) + ' , ' + ($data) + ' , validate.schema' + (it.schemaPath) + ' ';\n    }\n    out += ' , (dataPath || \\'\\')';\n    if (it.errorPath != '\"\"') {\n      out += ' + ' + (it.errorPath);\n    }\n    var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',\n      $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';\n    out += ' , ' + ($parentData) + ' , ' + ($parentDataProperty) + ' , rootData )  ';\n    var def_callRuleValidate = out;\n    out = $$outStack.pop();\n    if ($rDef.errors === false) {\n      out += ' ' + ($valid) + ' = ';\n      if ($asyncKeyword) {\n        out += 'await ';\n      }\n      out += '' + (def_callRuleValidate) + '; ';\n    } else {\n      if ($asyncKeyword) {\n        $ruleErrs = 'customErrors' + $lvl;\n        out += ' var ' + ($ruleErrs) + ' = null; try { ' + ($valid) + ' = await ' + (def_callRuleValidate) + '; } catch (e) { ' + ($valid) + ' = false; if (e instanceof ValidationError) ' + ($ruleErrs) + ' = e.errors; else throw e; } ';\n      } else {\n        out += ' ' + ($ruleErrs) + ' = null; ' + ($valid) + ' = ' + (def_callRuleValidate) + '; ';\n      }\n    }\n  }\n  if ($rDef.modifying) {\n    out += ' if (' + ($parentData) + ') ' + ($data) + ' = ' + ($parentData) + '[' + ($parentDataProperty) + '];';\n  }\n  out += '' + ($closingBraces);\n  if ($rDef.valid) {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  } else {\n    out += ' if ( ';\n    if ($rDef.valid === undefined) {\n      out += ' !';\n      if ($macro) {\n        out += '' + ($nextValid);\n      } else {\n        out += '' + ($valid);\n      }\n    } else {\n      out += ' ' + (!$rDef.valid) + ' ';\n    }\n    out += ') { ';\n    $errorKeyword = $rule.keyword;\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = '';\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ($errorKeyword || 'custom') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { keyword: \\'' + ($rule.keyword) + '\\' } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should pass \"' + ($rule.keyword) + '\" keyword validation\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    var def_customError = out;\n    out = $$outStack.pop();\n    if ($inline) {\n      if ($rDef.errors) {\n        if ($rDef.errors != 'full') {\n          out += '  for (var ' + ($i) + '=' + ($errs) + '; ' + ($i) + '<errors; ' + ($i) + '++) { var ' + ($ruleErr) + ' = vErrors[' + ($i) + ']; if (' + ($ruleErr) + '.dataPath === undefined) ' + ($ruleErr) + '.dataPath = (dataPath || \\'\\') + ' + (it.errorPath) + '; if (' + ($ruleErr) + '.schemaPath === undefined) { ' + ($ruleErr) + '.schemaPath = \"' + ($errSchemaPath) + '\"; } ';\n          if (it.opts.verbose) {\n            out += ' ' + ($ruleErr) + '.schema = ' + ($schemaValue) + '; ' + ($ruleErr) + '.data = ' + ($data) + '; ';\n          }\n          out += ' } ';\n        }\n      } else {\n        if ($rDef.errors === false) {\n          out += ' ' + (def_customError) + ' ';\n        } else {\n          out += ' if (' + ($errs) + ' == errors) { ' + (def_customError) + ' } else {  for (var ' + ($i) + '=' + ($errs) + '; ' + ($i) + '<errors; ' + ($i) + '++) { var ' + ($ruleErr) + ' = vErrors[' + ($i) + ']; if (' + ($ruleErr) + '.dataPath === undefined) ' + ($ruleErr) + '.dataPath = (dataPath || \\'\\') + ' + (it.errorPath) + '; if (' + ($ruleErr) + '.schemaPath === undefined) { ' + ($ruleErr) + '.schemaPath = \"' + ($errSchemaPath) + '\"; } ';\n          if (it.opts.verbose) {\n            out += ' ' + ($ruleErr) + '.schema = ' + ($schemaValue) + '; ' + ($ruleErr) + '.data = ' + ($data) + '; ';\n          }\n          out += ' } } ';\n        }\n      }\n    } else if ($macro) {\n      out += '   var err =   '; /* istanbul ignore else */\n      if (it.createErrors !== false) {\n        out += ' { keyword: \\'' + ($errorKeyword || 'custom') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { keyword: \\'' + ($rule.keyword) + '\\' } ';\n        if (it.opts.messages !== false) {\n          out += ' , message: \\'should pass \"' + ($rule.keyword) + '\" keyword validation\\' ';\n        }\n        if (it.opts.verbose) {\n          out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n        }\n        out += ' } ';\n      } else {\n        out += ' {} ';\n      }\n      out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n      if (!it.compositeRule && $breakOnError) {\n        /* istanbul ignore if */\n        if (it.async) {\n          out += ' throw new ValidationError(vErrors); ';\n        } else {\n          out += ' validate.errors = vErrors; return false; ';\n        }\n      }\n    } else {\n      if ($rDef.errors === false) {\n        out += ' ' + (def_customError) + ' ';\n      } else {\n        out += ' if (Array.isArray(' + ($ruleErrs) + ')) { if (vErrors === null) vErrors = ' + ($ruleErrs) + '; else vErrors = vErrors.concat(' + ($ruleErrs) + '); errors = vErrors.length;  for (var ' + ($i) + '=' + ($errs) + '; ' + ($i) + '<errors; ' + ($i) + '++) { var ' + ($ruleErr) + ' = vErrors[' + ($i) + ']; if (' + ($ruleErr) + '.dataPath === undefined) ' + ($ruleErr) + '.dataPath = (dataPath || \\'\\') + ' + (it.errorPath) + ';  ' + ($ruleErr) + '.schemaPath = \"' + ($errSchemaPath) + '\";  ';\n        if (it.opts.verbose) {\n          out += ' ' + ($ruleErr) + '.schema = ' + ($schemaValue) + '; ' + ($ruleErr) + '.data = ' + ($data) + '; ';\n        }\n        out += ' } } else { ' + (def_customError) + ' } ';\n      }\n    }\n    out += ' } ';\n    if ($breakOnError) {\n      out += ' else { ';\n    }\n  }\n  return out;\n}\n","'use strict';\n\nvar metaSchema = require('./refs/json-schema-draft-07.json');\n\nmodule.exports = {\n  $id: 'https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js',\n  definitions: {\n    simpleTypes: metaSchema.definitions.simpleTypes\n  },\n  type: 'object',\n  dependencies: {\n    schema: ['validate'],\n    $data: ['validate'],\n    statements: ['inline'],\n    valid: {not: {required: ['macro']}}\n  },\n  properties: {\n    type: metaSchema.properties.type,\n    schema: {type: 'boolean'},\n    statements: {type: 'boolean'},\n    dependencies: {\n      type: 'array',\n      items: {type: 'string'}\n    },\n    metaSchema: {type: 'object'},\n    modifying: {type: 'boolean'},\n    valid: {type: 'boolean'},\n    $data: {type: 'boolean'},\n    async: {type: 'boolean'},\n    errors: {\n      anyOf: [\n        {type: 'boolean'},\n        {const: 'full'}\n      ]\n    }\n  }\n};\n","'use strict';\n\nvar IDENTIFIER = /^[a-z_$][a-z0-9_$-]*$/i;\nvar customRuleCode = require('./dotjs/custom');\nvar definitionSchema = require('./definition_schema');\n\nmodule.exports = {\n  add: addKeyword,\n  get: getKeyword,\n  remove: removeKeyword,\n  validate: validateKeyword\n};\n\n\n/**\n * Define custom keyword\n * @this  Ajv\n * @param {String} keyword custom keyword, should be unique (including different from all standard, custom and macro keywords).\n * @param {Object} definition keyword definition object with properties `type` (type(s) which the keyword applies to), `validate` or `compile`.\n * @return {Ajv} this for method chaining\n */\nfunction addKeyword(keyword, definition) {\n  /* jshint validthis: true */\n  /* eslint no-shadow: 0 */\n  var RULES = this.RULES;\n  if (RULES.keywords[keyword])\n    throw new Error('Keyword ' + keyword + ' is already defined');\n\n  if (!IDENTIFIER.test(keyword))\n    throw new Error('Keyword ' + keyword + ' is not a valid identifier');\n\n  if (definition) {\n    this.validateKeyword(definition, true);\n\n    var dataType = definition.type;\n    if (Array.isArray(dataType)) {\n      for (var i=0; i<dataType.length; i++)\n        _addRule(keyword, dataType[i], definition);\n    } else {\n      _addRule(keyword, dataType, definition);\n    }\n\n    var metaSchema = definition.metaSchema;\n    if (metaSchema) {\n      if (definition.$data && this._opts.$data) {\n        metaSchema = {\n          anyOf: [\n            metaSchema,\n            { '$ref': 'https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#' }\n          ]\n        };\n      }\n      definition.validateSchema = this.compile(metaSchema, true);\n    }\n  }\n\n  RULES.keywords[keyword] = RULES.all[keyword] = true;\n\n\n  function _addRule(keyword, dataType, definition) {\n    var ruleGroup;\n    for (var i=0; i<RULES.length; i++) {\n      var rg = RULES[i];\n      if (rg.type == dataType) {\n        ruleGroup = rg;\n        break;\n      }\n    }\n\n    if (!ruleGroup) {\n      ruleGroup = { type: dataType, rules: [] };\n      RULES.push(ruleGroup);\n    }\n\n    var rule = {\n      keyword: keyword,\n      definition: definition,\n      custom: true,\n      code: customRuleCode,\n      implements: definition.implements\n    };\n    ruleGroup.rules.push(rule);\n    RULES.custom[keyword] = rule;\n  }\n\n  return this;\n}\n\n\n/**\n * Get keyword\n * @this  Ajv\n * @param {String} keyword pre-defined or custom keyword.\n * @return {Object|Boolean} custom keyword definition, `true` if it is a predefined keyword, `false` otherwise.\n */\nfunction getKeyword(keyword) {\n  /* jshint validthis: true */\n  var rule = this.RULES.custom[keyword];\n  return rule ? rule.definition : this.RULES.keywords[keyword] || false;\n}\n\n\n/**\n * Remove keyword\n * @this  Ajv\n * @param {String} keyword pre-defined or custom keyword.\n * @return {Ajv} this for method chaining\n */\nfunction removeKeyword(keyword) {\n  /* jshint validthis: true */\n  var RULES = this.RULES;\n  delete RULES.keywords[keyword];\n  delete RULES.all[keyword];\n  delete RULES.custom[keyword];\n  for (var i=0; i<RULES.length; i++) {\n    var rules = RULES[i].rules;\n    for (var j=0; j<rules.length; j++) {\n      if (rules[j].keyword == keyword) {\n        rules.splice(j, 1);\n        break;\n      }\n    }\n  }\n  return this;\n}\n\n\n/**\n * Validate keyword definition\n * @this  Ajv\n * @param {Object} definition keyword definition object.\n * @param {Boolean} throwError true to throw exception if definition is invalid\n * @return {boolean} validation result\n */\nfunction validateKeyword(definition, throwError) {\n  validateKeyword.errors = null;\n  var v = this._validateKeyword = this._validateKeyword\n                                  || this.compile(definitionSchema, true);\n\n  if (v(definition)) return true;\n  validateKeyword.errors = v.errors;\n  if (throwError)\n    throw new Error('custom keyword definition is invalid: '  + this.errorsText(v.errors));\n  else\n    return false;\n}\n","'use strict';\n\nvar compileSchema = require('./compile')\n  , resolve = require('./compile/resolve')\n  , Cache = require('./cache')\n  , SchemaObject = require('./compile/schema_obj')\n  , stableStringify = require('fast-json-stable-stringify')\n  , formats = require('./compile/formats')\n  , rules = require('./compile/rules')\n  , $dataMetaSchema = require('./data')\n  , util = require('./compile/util');\n\nmodule.exports = Ajv;\n\nAjv.prototype.validate = validate;\nAjv.prototype.compile = compile;\nAjv.prototype.addSchema = addSchema;\nAjv.prototype.addMetaSchema = addMetaSchema;\nAjv.prototype.validateSchema = validateSchema;\nAjv.prototype.getSchema = getSchema;\nAjv.prototype.removeSchema = removeSchema;\nAjv.prototype.addFormat = addFormat;\nAjv.prototype.errorsText = errorsText;\n\nAjv.prototype._addSchema = _addSchema;\nAjv.prototype._compile = _compile;\n\nAjv.prototype.compileAsync = require('./compile/async');\nvar customKeyword = require('./keyword');\nAjv.prototype.addKeyword = customKeyword.add;\nAjv.prototype.getKeyword = customKeyword.get;\nAjv.prototype.removeKeyword = customKeyword.remove;\nAjv.prototype.validateKeyword = customKeyword.validate;\n\nvar errorClasses = require('./compile/error_classes');\nAjv.ValidationError = errorClasses.Validation;\nAjv.MissingRefError = errorClasses.MissingRef;\nAjv.$dataMetaSchema = $dataMetaSchema;\n\nvar META_SCHEMA_ID = 'http://json-schema.org/draft-07/schema';\n\nvar META_IGNORE_OPTIONS = [ 'removeAdditional', 'useDefaults', 'coerceTypes', 'strictDefaults' ];\nvar META_SUPPORT_DATA = ['/properties'];\n\n/**\n * Creates validator instance.\n * Usage: `Ajv(opts)`\n * @param {Object} opts optional options\n * @return {Object} ajv instance\n */\nfunction Ajv(opts) {\n  if (!(this instanceof Ajv)) return new Ajv(opts);\n  opts = this._opts = util.copy(opts) || {};\n  setLogger(this);\n  this._schemas = {};\n  this._refs = {};\n  this._fragments = {};\n  this._formats = formats(opts.format);\n\n  this._cache = opts.cache || new Cache;\n  this._loadingSchemas = {};\n  this._compilations = [];\n  this.RULES = rules();\n  this._getId = chooseGetId(opts);\n\n  opts.loopRequired = opts.loopRequired || Infinity;\n  if (opts.errorDataPath == 'property') opts._errorDataPathProperty = true;\n  if (opts.serialize === undefined) opts.serialize = stableStringify;\n  this._metaOpts = getMetaSchemaOptions(this);\n\n  if (opts.formats) addInitialFormats(this);\n  if (opts.keywords) addInitialKeywords(this);\n  addDefaultMetaSchema(this);\n  if (typeof opts.meta == 'object') this.addMetaSchema(opts.meta);\n  if (opts.nullable) this.addKeyword('nullable', {metaSchema: {type: 'boolean'}});\n  addInitialSchemas(this);\n}\n\n\n\n/**\n * Validate data using schema\n * Schema will be compiled and cached (using serialized JSON as key. [fast-json-stable-stringify](https://github.com/epoberezkin/fast-json-stable-stringify) is used to serialize.\n * @this   Ajv\n * @param  {String|Object} schemaKeyRef key, ref or schema object\n * @param  {Any} data to be validated\n * @return {Boolean} validation result. Errors from the last validation will be available in `ajv.errors` (and also in compiled schema: `schema.errors`).\n */\nfunction validate(schemaKeyRef, data) {\n  var v;\n  if (typeof schemaKeyRef == 'string') {\n    v = this.getSchema(schemaKeyRef);\n    if (!v) throw new Error('no schema with key or ref \"' + schemaKeyRef + '\"');\n  } else {\n    var schemaObj = this._addSchema(schemaKeyRef);\n    v = schemaObj.validate || this._compile(schemaObj);\n  }\n\n  var valid = v(data);\n  if (v.$async !== true) this.errors = v.errors;\n  return valid;\n}\n\n\n/**\n * Create validating function for passed schema.\n * @this   Ajv\n * @param  {Object} schema schema object\n * @param  {Boolean} _meta true if schema is a meta-schema. Used internally to compile meta schemas of custom keywords.\n * @return {Function} validating function\n */\nfunction compile(schema, _meta) {\n  var schemaObj = this._addSchema(schema, undefined, _meta);\n  return schemaObj.validate || this._compile(schemaObj);\n}\n\n\n/**\n * Adds schema to the instance.\n * @this   Ajv\n * @param {Object|Array} schema schema or array of schemas. If array is passed, `key` and other parameters will be ignored.\n * @param {String} key Optional schema key. Can be passed to `validate` method instead of schema object or id/ref. One schema per instance can have empty `id` and `key`.\n * @param {Boolean} _skipValidation true to skip schema validation. Used internally, option validateSchema should be used instead.\n * @param {Boolean} _meta true if schema is a meta-schema. Used internally, addMetaSchema should be used instead.\n * @return {Ajv} this for method chaining\n */\nfunction addSchema(schema, key, _skipValidation, _meta) {\n  if (Array.isArray(schema)){\n    for (var i=0; i<schema.length; i++) this.addSchema(schema[i], undefined, _skipValidation, _meta);\n    return this;\n  }\n  var id = this._getId(schema);\n  if (id !== undefined && typeof id != 'string')\n    throw new Error('schema id must be string');\n  key = resolve.normalizeId(key || id);\n  checkUnique(this, key);\n  this._schemas[key] = this._addSchema(schema, _skipValidation, _meta, true);\n  return this;\n}\n\n\n/**\n * Add schema that will be used to validate other schemas\n * options in META_IGNORE_OPTIONS are alway set to false\n * @this   Ajv\n * @param {Object} schema schema object\n * @param {String} key optional schema key\n * @param {Boolean} skipValidation true to skip schema validation, can be used to override validateSchema option for meta-schema\n * @return {Ajv} this for method chaining\n */\nfunction addMetaSchema(schema, key, skipValidation) {\n  this.addSchema(schema, key, skipValidation, true);\n  return this;\n}\n\n\n/**\n * Validate schema\n * @this   Ajv\n * @param {Object} schema schema to validate\n * @param {Boolean} throwOrLogError pass true to throw (or log) an error if invalid\n * @return {Boolean} true if schema is valid\n */\nfunction validateSchema(schema, throwOrLogError) {\n  var $schema = schema.$schema;\n  if ($schema !== undefined && typeof $schema != 'string')\n    throw new Error('$schema must be a string');\n  $schema = $schema || this._opts.defaultMeta || defaultMeta(this);\n  if (!$schema) {\n    this.logger.warn('meta-schema not available');\n    this.errors = null;\n    return true;\n  }\n  var valid = this.validate($schema, schema);\n  if (!valid && throwOrLogError) {\n    var message = 'schema is invalid: ' + this.errorsText();\n    if (this._opts.validateSchema == 'log') this.logger.error(message);\n    else throw new Error(message);\n  }\n  return valid;\n}\n\n\nfunction defaultMeta(self) {\n  var meta = self._opts.meta;\n  self._opts.defaultMeta = typeof meta == 'object'\n                            ? self._getId(meta) || meta\n                            : self.getSchema(META_SCHEMA_ID)\n                              ? META_SCHEMA_ID\n                              : undefined;\n  return self._opts.defaultMeta;\n}\n\n\n/**\n * Get compiled schema from the instance by `key` or `ref`.\n * @this   Ajv\n * @param  {String} keyRef `key` that was passed to `addSchema` or full schema reference (`schema.id` or resolved id).\n * @return {Function} schema validating function (with property `schema`).\n */\nfunction getSchema(keyRef) {\n  var schemaObj = _getSchemaObj(this, keyRef);\n  switch (typeof schemaObj) {\n    case 'object': return schemaObj.validate || this._compile(schemaObj);\n    case 'string': return this.getSchema(schemaObj);\n    case 'undefined': return _getSchemaFragment(this, keyRef);\n  }\n}\n\n\nfunction _getSchemaFragment(self, ref) {\n  var res = resolve.schema.call(self, { schema: {} }, ref);\n  if (res) {\n    var schema = res.schema\n      , root = res.root\n      , baseId = res.baseId;\n    var v = compileSchema.call(self, schema, root, undefined, baseId);\n    self._fragments[ref] = new SchemaObject({\n      ref: ref,\n      fragment: true,\n      schema: schema,\n      root: root,\n      baseId: baseId,\n      validate: v\n    });\n    return v;\n  }\n}\n\n\nfunction _getSchemaObj(self, keyRef) {\n  keyRef = resolve.normalizeId(keyRef);\n  return self._schemas[keyRef] || self._refs[keyRef] || self._fragments[keyRef];\n}\n\n\n/**\n * Remove cached schema(s).\n * If no parameter is passed all schemas but meta-schemas are removed.\n * If RegExp is passed all schemas with key/id matching pattern but meta-schemas are removed.\n * Even if schema is referenced by other schemas it still can be removed as other schemas have local references.\n * @this   Ajv\n * @param  {String|Object|RegExp} schemaKeyRef key, ref, pattern to match key/ref or schema object\n * @return {Ajv} this for method chaining\n */\nfunction removeSchema(schemaKeyRef) {\n  if (schemaKeyRef instanceof RegExp) {\n    _removeAllSchemas(this, this._schemas, schemaKeyRef);\n    _removeAllSchemas(this, this._refs, schemaKeyRef);\n    return this;\n  }\n  switch (typeof schemaKeyRef) {\n    case 'undefined':\n      _removeAllSchemas(this, this._schemas);\n      _removeAllSchemas(this, this._refs);\n      this._cache.clear();\n      return this;\n    case 'string':\n      var schemaObj = _getSchemaObj(this, schemaKeyRef);\n      if (schemaObj) this._cache.del(schemaObj.cacheKey);\n      delete this._schemas[schemaKeyRef];\n      delete this._refs[schemaKeyRef];\n      return this;\n    case 'object':\n      var serialize = this._opts.serialize;\n      var cacheKey = serialize ? serialize(schemaKeyRef) : schemaKeyRef;\n      this._cache.del(cacheKey);\n      var id = this._getId(schemaKeyRef);\n      if (id) {\n        id = resolve.normalizeId(id);\n        delete this._schemas[id];\n        delete this._refs[id];\n      }\n  }\n  return this;\n}\n\n\nfunction _removeAllSchemas(self, schemas, regex) {\n  for (var keyRef in schemas) {\n    var schemaObj = schemas[keyRef];\n    if (!schemaObj.meta && (!regex || regex.test(keyRef))) {\n      self._cache.del(schemaObj.cacheKey);\n      delete schemas[keyRef];\n    }\n  }\n}\n\n\n/* @this   Ajv */\nfunction _addSchema(schema, skipValidation, meta, shouldAddSchema) {\n  if (typeof schema != 'object' && typeof schema != 'boolean')\n    throw new Error('schema should be object or boolean');\n  var serialize = this._opts.serialize;\n  var cacheKey = serialize ? serialize(schema) : schema;\n  var cached = this._cache.get(cacheKey);\n  if (cached) return cached;\n\n  shouldAddSchema = shouldAddSchema || this._opts.addUsedSchema !== false;\n\n  var id = resolve.normalizeId(this._getId(schema));\n  if (id && shouldAddSchema) checkUnique(this, id);\n\n  var willValidate = this._opts.validateSchema !== false && !skipValidation;\n  var recursiveMeta;\n  if (willValidate && !(recursiveMeta = id && id == resolve.normalizeId(schema.$schema)))\n    this.validateSchema(schema, true);\n\n  var localRefs = resolve.ids.call(this, schema);\n\n  var schemaObj = new SchemaObject({\n    id: id,\n    schema: schema,\n    localRefs: localRefs,\n    cacheKey: cacheKey,\n    meta: meta\n  });\n\n  if (id[0] != '#' && shouldAddSchema) this._refs[id] = schemaObj;\n  this._cache.put(cacheKey, schemaObj);\n\n  if (willValidate && recursiveMeta) this.validateSchema(schema, true);\n\n  return schemaObj;\n}\n\n\n/* @this   Ajv */\nfunction _compile(schemaObj, root) {\n  if (schemaObj.compiling) {\n    schemaObj.validate = callValidate;\n    callValidate.schema = schemaObj.schema;\n    callValidate.errors = null;\n    callValidate.root = root ? root : callValidate;\n    if (schemaObj.schema.$async === true)\n      callValidate.$async = true;\n    return callValidate;\n  }\n  schemaObj.compiling = true;\n\n  var currentOpts;\n  if (schemaObj.meta) {\n    currentOpts = this._opts;\n    this._opts = this._metaOpts;\n  }\n\n  var v;\n  try { v = compileSchema.call(this, schemaObj.schema, root, schemaObj.localRefs); }\n  catch(e) {\n    delete schemaObj.validate;\n    throw e;\n  }\n  finally {\n    schemaObj.compiling = false;\n    if (schemaObj.meta) this._opts = currentOpts;\n  }\n\n  schemaObj.validate = v;\n  schemaObj.refs = v.refs;\n  schemaObj.refVal = v.refVal;\n  schemaObj.root = v.root;\n  return v;\n\n\n  /* @this   {*} - custom context, see passContext option */\n  function callValidate() {\n    /* jshint validthis: true */\n    var _validate = schemaObj.validate;\n    var result = _validate.apply(this, arguments);\n    callValidate.errors = _validate.errors;\n    return result;\n  }\n}\n\n\nfunction chooseGetId(opts) {\n  switch (opts.schemaId) {\n    case 'auto': return _get$IdOrId;\n    case 'id': return _getId;\n    default: return _get$Id;\n  }\n}\n\n/* @this   Ajv */\nfunction _getId(schema) {\n  if (schema.$id) this.logger.warn('schema $id ignored', schema.$id);\n  return schema.id;\n}\n\n/* @this   Ajv */\nfunction _get$Id(schema) {\n  if (schema.id) this.logger.warn('schema id ignored', schema.id);\n  return schema.$id;\n}\n\n\nfunction _get$IdOrId(schema) {\n  if (schema.$id && schema.id && schema.$id != schema.id)\n    throw new Error('schema $id is different from id');\n  return schema.$id || schema.id;\n}\n\n\n/**\n * Convert array of error message objects to string\n * @this   Ajv\n * @param  {Array<Object>} errors optional array of validation errors, if not passed errors from the instance are used.\n * @param  {Object} options optional options with properties `separator` and `dataVar`.\n * @return {String} human readable string with all errors descriptions\n */\nfunction errorsText(errors, options) {\n  errors = errors || this.errors;\n  if (!errors) return 'No errors';\n  options = options || {};\n  var separator = options.separator === undefined ? ', ' : options.separator;\n  var dataVar = options.dataVar === undefined ? 'data' : options.dataVar;\n\n  var text = '';\n  for (var i=0; i<errors.length; i++) {\n    var e = errors[i];\n    if (e) text += dataVar + e.dataPath + ' ' + e.message + separator;\n  }\n  return text.slice(0, -separator.length);\n}\n\n\n/**\n * Add custom format\n * @this   Ajv\n * @param {String} name format name\n * @param {String|RegExp|Function} format string is converted to RegExp; function should return boolean (true when valid)\n * @return {Ajv} this for method chaining\n */\nfunction addFormat(name, format) {\n  if (typeof format == 'string') format = new RegExp(format);\n  this._formats[name] = format;\n  return this;\n}\n\n\nfunction addDefaultMetaSchema(self) {\n  var $dataSchema;\n  if (self._opts.$data) {\n    $dataSchema = require('./refs/data.json');\n    self.addMetaSchema($dataSchema, $dataSchema.$id, true);\n  }\n  if (self._opts.meta === false) return;\n  var metaSchema = require('./refs/json-schema-draft-07.json');\n  if (self._opts.$data) metaSchema = $dataMetaSchema(metaSchema, META_SUPPORT_DATA);\n  self.addMetaSchema(metaSchema, META_SCHEMA_ID, true);\n  self._refs['http://json-schema.org/schema'] = META_SCHEMA_ID;\n}\n\n\nfunction addInitialSchemas(self) {\n  var optsSchemas = self._opts.schemas;\n  if (!optsSchemas) return;\n  if (Array.isArray(optsSchemas)) self.addSchema(optsSchemas);\n  else for (var key in optsSchemas) self.addSchema(optsSchemas[key], key);\n}\n\n\nfunction addInitialFormats(self) {\n  for (var name in self._opts.formats) {\n    var format = self._opts.formats[name];\n    self.addFormat(name, format);\n  }\n}\n\n\nfunction addInitialKeywords(self) {\n  for (var name in self._opts.keywords) {\n    var keyword = self._opts.keywords[name];\n    self.addKeyword(name, keyword);\n  }\n}\n\n\nfunction checkUnique(self, id) {\n  if (self._schemas[id] || self._refs[id])\n    throw new Error('schema with key or id \"' + id + '\" already exists');\n}\n\n\nfunction getMetaSchemaOptions(self) {\n  var metaOpts = util.copy(self._opts);\n  for (var i=0; i<META_IGNORE_OPTIONS.length; i++)\n    delete metaOpts[META_IGNORE_OPTIONS[i]];\n  return metaOpts;\n}\n\n\nfunction setLogger(self) {\n  var logger = self._opts.logger;\n  if (logger === false) {\n    self.logger = {log: noop, warn: noop, error: noop};\n  } else {\n    if (logger === undefined) logger = console;\n    if (!(typeof logger == 'object' && logger.log && logger.warn && logger.error))\n      throw new Error('logger must implement log, warn and error methods');\n    self.logger = logger;\n  }\n}\n\n\nfunction noop() {}\n","import { mergeCapabilities, Protocol, } from \"../shared/protocol.js\";\nimport { CallToolResultSchema, CompleteResultSchema, EmptyResultSchema, GetPromptResultSchema, InitializeResultSchema, LATEST_PROTOCOL_VERSION, ListPromptsResultSchema, ListResourcesResultSchema, ListResourceTemplatesResultSchema, ListToolsResultSchema, ReadResourceResultSchema, SUPPORTED_PROTOCOL_VERSIONS, ErrorCode, McpError, } from \"../types.js\";\nimport Ajv from \"ajv\";\n/**\n * An MCP client on top of a pluggable transport.\n *\n * The client will automatically begin the initialization flow with the server when connect() is called.\n *\n * To use with custom types, extend the base Request/Notification/Result types and pass them as type parameters:\n *\n * ```typescript\n * // Custom schemas\n * const CustomRequestSchema = RequestSchema.extend({...})\n * const CustomNotificationSchema = NotificationSchema.extend({...})\n * const CustomResultSchema = ResultSchema.extend({...})\n *\n * // Type aliases\n * type CustomRequest = z.infer<typeof CustomRequestSchema>\n * type CustomNotification = z.infer<typeof CustomNotificationSchema>\n * type CustomResult = z.infer<typeof CustomResultSchema>\n *\n * // Create typed client\n * const client = new Client<CustomRequest, CustomNotification, CustomResult>({\n *   name: \"CustomClient\",\n *   version: \"1.0.0\"\n * })\n * ```\n */\nexport class Client extends Protocol {\n    /**\n     * Initializes this client with the given name and version information.\n     */\n    constructor(_clientInfo, options) {\n        var _a;\n        super(options);\n        this._clientInfo = _clientInfo;\n        this._cachedToolOutputValidators = new Map();\n        this._capabilities = (_a = options === null || options === void 0 ? void 0 : options.capabilities) !== null && _a !== void 0 ? _a : {};\n        this._ajv = new Ajv();\n    }\n    /**\n     * Registers new capabilities. This can only be called before connecting to a transport.\n     *\n     * The new capabilities will be merged with any existing capabilities previously given (e.g., at initialization).\n     */\n    registerCapabilities(capabilities) {\n        if (this.transport) {\n            throw new Error(\"Cannot register capabilities after connecting to transport\");\n        }\n        this._capabilities = mergeCapabilities(this._capabilities, capabilities);\n    }\n    assertCapability(capability, method) {\n        var _a;\n        if (!((_a = this._serverCapabilities) === null || _a === void 0 ? void 0 : _a[capability])) {\n            throw new Error(`Server does not support ${capability} (required for ${method})`);\n        }\n    }\n    async connect(transport, options) {\n        await super.connect(transport);\n        // When transport sessionId is already set this means we are trying to reconnect.\n        // In this case we don't need to initialize again.\n        if (transport.sessionId !== undefined) {\n            return;\n        }\n        try {\n            const result = await this.request({\n                method: \"initialize\",\n                params: {\n                    protocolVersion: LATEST_PROTOCOL_VERSION,\n                    capabilities: this._capabilities,\n                    clientInfo: this._clientInfo,\n                },\n            }, InitializeResultSchema, options);\n            if (result === undefined) {\n                throw new Error(`Server sent invalid initialize result: ${result}`);\n            }\n            if (!SUPPORTED_PROTOCOL_VERSIONS.includes(result.protocolVersion)) {\n                throw new Error(`Server's protocol version is not supported: ${result.protocolVersion}`);\n            }\n            this._serverCapabilities = result.capabilities;\n            this._serverVersion = result.serverInfo;\n            // HTTP transports must set the protocol version in each header after initialization.\n            if (transport.setProtocolVersion) {\n                transport.setProtocolVersion(result.protocolVersion);\n            }\n            this._instructions = result.instructions;\n            await this.notification({\n                method: \"notifications/initialized\",\n            });\n        }\n        catch (error) {\n            // Disconnect if initialization fails.\n            void this.close();\n            throw error;\n        }\n    }\n    /**\n     * After initialization has completed, this will be populated with the server's reported capabilities.\n     */\n    getServerCapabilities() {\n        return this._serverCapabilities;\n    }\n    /**\n     * After initialization has completed, this will be populated with information about the server's name and version.\n     */\n    getServerVersion() {\n        return this._serverVersion;\n    }\n    /**\n     * After initialization has completed, this may be populated with information about the server's instructions.\n     */\n    getInstructions() {\n        return this._instructions;\n    }\n    assertCapabilityForMethod(method) {\n        var _a, _b, _c, _d, _e;\n        switch (method) {\n            case \"logging/setLevel\":\n                if (!((_a = this._serverCapabilities) === null || _a === void 0 ? void 0 : _a.logging)) {\n                    throw new Error(`Server does not support logging (required for ${method})`);\n                }\n                break;\n            case \"prompts/get\":\n            case \"prompts/list\":\n                if (!((_b = this._serverCapabilities) === null || _b === void 0 ? void 0 : _b.prompts)) {\n                    throw new Error(`Server does not support prompts (required for ${method})`);\n                }\n                break;\n            case \"resources/list\":\n            case \"resources/templates/list\":\n            case \"resources/read\":\n            case \"resources/subscribe\":\n            case \"resources/unsubscribe\":\n                if (!((_c = this._serverCapabilities) === null || _c === void 0 ? void 0 : _c.resources)) {\n                    throw new Error(`Server does not support resources (required for ${method})`);\n                }\n                if (method === \"resources/subscribe\" &&\n                    !this._serverCapabilities.resources.subscribe) {\n                    throw new Error(`Server does not support resource subscriptions (required for ${method})`);\n                }\n                break;\n            case \"tools/call\":\n            case \"tools/list\":\n                if (!((_d = this._serverCapabilities) === null || _d === void 0 ? void 0 : _d.tools)) {\n                    throw new Error(`Server does not support tools (required for ${method})`);\n                }\n                break;\n            case \"completion/complete\":\n                if (!((_e = this._serverCapabilities) === null || _e === void 0 ? void 0 : _e.completions)) {\n                    throw new Error(`Server does not support completions (required for ${method})`);\n                }\n                break;\n            case \"initialize\":\n                // No specific capability required for initialize\n                break;\n            case \"ping\":\n                // No specific capability required for ping\n                break;\n        }\n    }\n    assertNotificationCapability(method) {\n        var _a;\n        switch (method) {\n            case \"notifications/roots/list_changed\":\n                if (!((_a = this._capabilities.roots) === null || _a === void 0 ? void 0 : _a.listChanged)) {\n                    throw new Error(`Client does not support roots list changed notifications (required for ${method})`);\n                }\n                break;\n            case \"notifications/initialized\":\n                // No specific capability required for initialized\n                break;\n            case \"notifications/cancelled\":\n                // Cancellation notifications are always allowed\n                break;\n            case \"notifications/progress\":\n                // Progress notifications are always allowed\n                break;\n        }\n    }\n    assertRequestHandlerCapability(method) {\n        switch (method) {\n            case \"sampling/createMessage\":\n                if (!this._capabilities.sampling) {\n                    throw new Error(`Client does not support sampling capability (required for ${method})`);\n                }\n                break;\n            case \"elicitation/create\":\n                if (!this._capabilities.elicitation) {\n                    throw new Error(`Client does not support elicitation capability (required for ${method})`);\n                }\n                break;\n            case \"roots/list\":\n                if (!this._capabilities.roots) {\n                    throw new Error(`Client does not support roots capability (required for ${method})`);\n                }\n                break;\n            case \"ping\":\n                // No specific capability required for ping\n                break;\n        }\n    }\n    async ping(options) {\n        return this.request({ method: \"ping\" }, EmptyResultSchema, options);\n    }\n    async complete(params, options) {\n        return this.request({ method: \"completion/complete\", params }, CompleteResultSchema, options);\n    }\n    async setLoggingLevel(level, options) {\n        return this.request({ method: \"logging/setLevel\", params: { level } }, EmptyResultSchema, options);\n    }\n    async getPrompt(params, options) {\n        return this.request({ method: \"prompts/get\", params }, GetPromptResultSchema, options);\n    }\n    async listPrompts(params, options) {\n        return this.request({ method: \"prompts/list\", params }, ListPromptsResultSchema, options);\n    }\n    async listResources(params, options) {\n        return this.request({ method: \"resources/list\", params }, ListResourcesResultSchema, options);\n    }\n    async listResourceTemplates(params, options) {\n        return this.request({ method: \"resources/templates/list\", params }, ListResourceTemplatesResultSchema, options);\n    }\n    async readResource(params, options) {\n        return this.request({ method: \"resources/read\", params }, ReadResourceResultSchema, options);\n    }\n    async subscribeResource(params, options) {\n        return this.request({ method: \"resources/subscribe\", params }, EmptyResultSchema, options);\n    }\n    async unsubscribeResource(params, options) {\n        return this.request({ method: \"resources/unsubscribe\", params }, EmptyResultSchema, options);\n    }\n    async callTool(params, resultSchema = CallToolResultSchema, options) {\n        const result = await this.request({ method: \"tools/call\", params }, resultSchema, options);\n        // Check if the tool has an outputSchema\n        const validator = this.getToolOutputValidator(params.name);\n        if (validator) {\n            // If tool has outputSchema, it MUST return structuredContent (unless it's an error)\n            if (!result.structuredContent && !result.isError) {\n                throw new McpError(ErrorCode.InvalidRequest, `Tool ${params.name} has an output schema but did not return structured content`);\n            }\n            // Only validate structured content if present (not when there's an error)\n            if (result.structuredContent) {\n                try {\n                    // Validate the structured content (which is already an object) against the schema\n                    const isValid = validator(result.structuredContent);\n                    if (!isValid) {\n                        throw new McpError(ErrorCode.InvalidParams, `Structured content does not match the tool's output schema: ${this._ajv.errorsText(validator.errors)}`);\n                    }\n                }\n                catch (error) {\n                    if (error instanceof McpError) {\n                        throw error;\n                    }\n                    throw new McpError(ErrorCode.InvalidParams, `Failed to validate structured content: ${error instanceof Error ? error.message : String(error)}`);\n                }\n            }\n        }\n        return result;\n    }\n    cacheToolOutputSchemas(tools) {\n        this._cachedToolOutputValidators.clear();\n        for (const tool of tools) {\n            // If the tool has an outputSchema, create and cache the Ajv validator\n            if (tool.outputSchema) {\n                try {\n                    const validator = this._ajv.compile(tool.outputSchema);\n                    this._cachedToolOutputValidators.set(tool.name, validator);\n                }\n                catch (_a) {\n                    // Ignore schema compilation errors\n                }\n            }\n        }\n    }\n    getToolOutputValidator(toolName) {\n        return this._cachedToolOutputValidators.get(toolName);\n    }\n    async listTools(params, options) {\n        const result = await this.request({ method: \"tools/list\", params }, ListToolsResultSchema, options);\n        // Cache the tools and their output schemas for future validation\n        this.cacheToolOutputSchemas(result.tools);\n        return result;\n    }\n    async sendRootsListChanged() {\n        return this.notification({ method: \"notifications/roots/list_changed\" });\n    }\n}\n//# sourceMappingURL=index.js.map","module.exports = isexe\nisexe.sync = sync\n\nvar fs = require('fs')\n\nfunction checkPathExt (path, options) {\n  var pathext = options.pathExt !== undefined ?\n    options.pathExt : process.env.PATHEXT\n\n  if (!pathext) {\n    return true\n  }\n\n  pathext = pathext.split(';')\n  if (pathext.indexOf('') !== -1) {\n    return true\n  }\n  for (var i = 0; i < pathext.length; i++) {\n    var p = pathext[i].toLowerCase()\n    if (p && path.substr(-p.length).toLowerCase() === p) {\n      return true\n    }\n  }\n  return false\n}\n\nfunction checkStat (stat, path, options) {\n  if (!stat.isSymbolicLink() && !stat.isFile()) {\n    return false\n  }\n  return checkPathExt(path, options)\n}\n\nfunction isexe (path, options, cb) {\n  fs.stat(path, function (er, stat) {\n    cb(er, er ? false : checkStat(stat, path, options))\n  })\n}\n\nfunction sync (path, options) {\n  return checkStat(fs.statSync(path), path, options)\n}\n","module.exports = isexe\nisexe.sync = sync\n\nvar fs = require('fs')\n\nfunction isexe (path, options, cb) {\n  fs.stat(path, function (er, stat) {\n    cb(er, er ? false : checkStat(stat, options))\n  })\n}\n\nfunction sync (path, options) {\n  return checkStat(fs.statSync(path), options)\n}\n\nfunction checkStat (stat, options) {\n  return stat.isFile() && checkMode(stat, options)\n}\n\nfunction checkMode (stat, options) {\n  var mod = stat.mode\n  var uid = stat.uid\n  var gid = stat.gid\n\n  var myUid = options.uid !== undefined ?\n    options.uid : process.getuid && process.getuid()\n  var myGid = options.gid !== undefined ?\n    options.gid : process.getgid && process.getgid()\n\n  var u = parseInt('100', 8)\n  var g = parseInt('010', 8)\n  var o = parseInt('001', 8)\n  var ug = u | g\n\n  var ret = (mod & o) ||\n    (mod & g) && gid === myGid ||\n    (mod & u) && uid === myUid ||\n    (mod & ug) && myUid === 0\n\n  return ret\n}\n","var fs = require('fs')\nvar core\nif (process.platform === 'win32' || global.TESTING_WINDOWS) {\n  core = require('./windows.js')\n} else {\n  core = require('./mode.js')\n}\n\nmodule.exports = isexe\nisexe.sync = sync\n\nfunction isexe (path, options, cb) {\n  if (typeof options === 'function') {\n    cb = options\n    options = {}\n  }\n\n  if (!cb) {\n    if (typeof Promise !== 'function') {\n      throw new TypeError('callback not provided')\n    }\n\n    return new Promise(function (resolve, reject) {\n      isexe(path, options || {}, function (er, is) {\n        if (er) {\n          reject(er)\n        } else {\n          resolve(is)\n        }\n      })\n    })\n  }\n\n  core(path, options || {}, function (er, is) {\n    // ignore EACCES because that just means we aren't allowed to run it\n    if (er) {\n      if (er.code === 'EACCES' || options && options.ignoreErrors) {\n        er = null\n        is = false\n      }\n    }\n    cb(er, is)\n  })\n}\n\nfunction sync (path, options) {\n  // my kingdom for a filtered catch\n  try {\n    return core.sync(path, options || {})\n  } catch (er) {\n    if (options && options.ignoreErrors || er.code === 'EACCES') {\n      return false\n    } else {\n      throw er\n    }\n  }\n}\n","const isWindows = process.platform === 'win32' ||\n    process.env.OSTYPE === 'cygwin' ||\n    process.env.OSTYPE === 'msys'\n\nconst path = require('path')\nconst COLON = isWindows ? ';' : ':'\nconst isexe = require('isexe')\n\nconst getNotFoundError = (cmd) =>\n  Object.assign(new Error(`not found: ${cmd}`), { code: 'ENOENT' })\n\nconst getPathInfo = (cmd, opt) => {\n  const colon = opt.colon || COLON\n\n  // If it has a slash, then we don't bother searching the pathenv.\n  // just check the file itself, and that's it.\n  const pathEnv = cmd.match(/\\//) || isWindows && cmd.match(/\\\\/) ? ['']\n    : (\n      [\n        // windows always checks the cwd first\n        ...(isWindows ? [process.cwd()] : []),\n        ...(opt.path || process.env.PATH ||\n          /* istanbul ignore next: very unusual */ '').split(colon),\n      ]\n    )\n  const pathExtExe = isWindows\n    ? opt.pathExt || process.env.PATHEXT || '.EXE;.CMD;.BAT;.COM'\n    : ''\n  const pathExt = isWindows ? pathExtExe.split(colon) : ['']\n\n  if (isWindows) {\n    if (cmd.indexOf('.') !== -1 && pathExt[0] !== '')\n      pathExt.unshift('')\n  }\n\n  return {\n    pathEnv,\n    pathExt,\n    pathExtExe,\n  }\n}\n\nconst which = (cmd, opt, cb) => {\n  if (typeof opt === 'function') {\n    cb = opt\n    opt = {}\n  }\n  if (!opt)\n    opt = {}\n\n  const { pathEnv, pathExt, pathExtExe } = getPathInfo(cmd, opt)\n  const found = []\n\n  const step = i => new Promise((resolve, reject) => {\n    if (i === pathEnv.length)\n      return opt.all && found.length ? resolve(found)\n        : reject(getNotFoundError(cmd))\n\n    const ppRaw = pathEnv[i]\n    const pathPart = /^\".*\"$/.test(ppRaw) ? ppRaw.slice(1, -1) : ppRaw\n\n    const pCmd = path.join(pathPart, cmd)\n    const p = !pathPart && /^\\.[\\\\\\/]/.test(cmd) ? cmd.slice(0, 2) + pCmd\n      : pCmd\n\n    resolve(subStep(p, i, 0))\n  })\n\n  const subStep = (p, i, ii) => new Promise((resolve, reject) => {\n    if (ii === pathExt.length)\n      return resolve(step(i + 1))\n    const ext = pathExt[ii]\n    isexe(p + ext, { pathExt: pathExtExe }, (er, is) => {\n      if (!er && is) {\n        if (opt.all)\n          found.push(p + ext)\n        else\n          return resolve(p + ext)\n      }\n      return resolve(subStep(p, i, ii + 1))\n    })\n  })\n\n  return cb ? step(0).then(res => cb(null, res), cb) : step(0)\n}\n\nconst whichSync = (cmd, opt) => {\n  opt = opt || {}\n\n  const { pathEnv, pathExt, pathExtExe } = getPathInfo(cmd, opt)\n  const found = []\n\n  for (let i = 0; i < pathEnv.length; i ++) {\n    const ppRaw = pathEnv[i]\n    const pathPart = /^\".*\"$/.test(ppRaw) ? ppRaw.slice(1, -1) : ppRaw\n\n    const pCmd = path.join(pathPart, cmd)\n    const p = !pathPart && /^\\.[\\\\\\/]/.test(cmd) ? cmd.slice(0, 2) + pCmd\n      : pCmd\n\n    for (let j = 0; j < pathExt.length; j ++) {\n      const cur = p + pathExt[j]\n      try {\n        const is = isexe.sync(cur, { pathExt: pathExtExe })\n        if (is) {\n          if (opt.all)\n            found.push(cur)\n          else\n            return cur\n        }\n      } catch (ex) {}\n    }\n  }\n\n  if (opt.all && found.length)\n    return found\n\n  if (opt.nothrow)\n    return null\n\n  throw getNotFoundError(cmd)\n}\n\nmodule.exports = which\nwhich.sync = whichSync\n","'use strict';\n\nconst pathKey = (options = {}) => {\n\tconst environment = options.env || process.env;\n\tconst platform = options.platform || process.platform;\n\n\tif (platform !== 'win32') {\n\t\treturn 'PATH';\n\t}\n\n\treturn Object.keys(environment).reverse().find(key => key.toUpperCase() === 'PATH') || 'Path';\n};\n\nmodule.exports = pathKey;\n// TODO: Remove this for the next major release\nmodule.exports.default = pathKey;\n","'use strict';\n\nconst path = require('path');\nconst which = require('which');\nconst getPathKey = require('path-key');\n\nfunction resolveCommandAttempt(parsed, withoutPathExt) {\n    const env = parsed.options.env || process.env;\n    const cwd = process.cwd();\n    const hasCustomCwd = parsed.options.cwd != null;\n    // Worker threads do not have process.chdir()\n    const shouldSwitchCwd = hasCustomCwd && process.chdir !== undefined && !process.chdir.disabled;\n\n    // If a custom `cwd` was specified, we need to change the process cwd\n    // because `which` will do stat calls but does not support a custom cwd\n    if (shouldSwitchCwd) {\n        try {\n            process.chdir(parsed.options.cwd);\n        } catch (err) {\n            /* Empty */\n        }\n    }\n\n    let resolved;\n\n    try {\n        resolved = which.sync(parsed.command, {\n            path: env[getPathKey({ env })],\n            pathExt: withoutPathExt ? path.delimiter : undefined,\n        });\n    } catch (e) {\n        /* Empty */\n    } finally {\n        if (shouldSwitchCwd) {\n            process.chdir(cwd);\n        }\n    }\n\n    // If we successfully resolved, ensure that an absolute path is returned\n    // Note that when a custom `cwd` was used, we need to resolve to an absolute path based on it\n    if (resolved) {\n        resolved = path.resolve(hasCustomCwd ? parsed.options.cwd : '', resolved);\n    }\n\n    return resolved;\n}\n\nfunction resolveCommand(parsed) {\n    return resolveCommandAttempt(parsed) || resolveCommandAttempt(parsed, true);\n}\n\nmodule.exports = resolveCommand;\n","'use strict';\n\n// See http://www.robvanderwoude.com/escapechars.php\nconst metaCharsRegExp = /([()\\][%!^\"`<>&|;, *?])/g;\n\nfunction escapeCommand(arg) {\n    // Escape meta chars\n    arg = arg.replace(metaCharsRegExp, '^$1');\n\n    return arg;\n}\n\nfunction escapeArgument(arg, doubleEscapeMetaChars) {\n    // Convert to string\n    arg = `${arg}`;\n\n    // Algorithm below is based on https://qntm.org/cmd\n    // It's slightly altered to disable JS backtracking to avoid hanging on specially crafted input\n    // Please see https://github.com/moxystudio/node-cross-spawn/pull/160 for more information\n\n    // Sequence of backslashes followed by a double quote:\n    // double up all the backslashes and escape the double quote\n    arg = arg.replace(/(?=(\\\\+?)?)\\1\"/g, '$1$1\\\\\"');\n\n    // Sequence of backslashes followed by the end of the string\n    // (which will become a double quote later):\n    // double up all the backslashes\n    arg = arg.replace(/(?=(\\\\+?)?)\\1$/, '$1$1');\n\n    // All other backslashes occur literally\n\n    // Quote the whole thing:\n    arg = `\"${arg}\"`;\n\n    // Escape meta chars\n    arg = arg.replace(metaCharsRegExp, '^$1');\n\n    // Double escape meta chars if necessary\n    if (doubleEscapeMetaChars) {\n        arg = arg.replace(metaCharsRegExp, '^$1');\n    }\n\n    return arg;\n}\n\nmodule.exports.command = escapeCommand;\nmodule.exports.argument = escapeArgument;\n","'use strict';\nmodule.exports = /^#!(.*)/;\n","'use strict';\nconst shebangRegex = require('shebang-regex');\n\nmodule.exports = (string = '') => {\n\tconst match = string.match(shebangRegex);\n\n\tif (!match) {\n\t\treturn null;\n\t}\n\n\tconst [path, argument] = match[0].replace(/#! ?/, '').split(' ');\n\tconst binary = path.split('/').pop();\n\n\tif (binary === 'env') {\n\t\treturn argument;\n\t}\n\n\treturn argument ? `${binary} ${argument}` : binary;\n};\n","'use strict';\n\nconst fs = require('fs');\nconst shebangCommand = require('shebang-command');\n\nfunction readShebang(command) {\n    // Read the first 150 bytes from the file\n    const size = 150;\n    const buffer = Buffer.alloc(size);\n\n    let fd;\n\n    try {\n        fd = fs.openSync(command, 'r');\n        fs.readSync(fd, buffer, 0, size, 0);\n        fs.closeSync(fd);\n    } catch (e) { /* Empty */ }\n\n    // Attempt to extract shebang (null is returned if not a shebang)\n    return shebangCommand(buffer.toString());\n}\n\nmodule.exports = readShebang;\n","'use strict';\n\nconst path = require('path');\nconst resolveCommand = require('./util/resolveCommand');\nconst escape = require('./util/escape');\nconst readShebang = require('./util/readShebang');\n\nconst isWin = process.platform === 'win32';\nconst isExecutableRegExp = /\\.(?:com|exe)$/i;\nconst isCmdShimRegExp = /node_modules[\\\\/].bin[\\\\/][^\\\\/]+\\.cmd$/i;\n\nfunction detectShebang(parsed) {\n    parsed.file = resolveCommand(parsed);\n\n    const shebang = parsed.file && readShebang(parsed.file);\n\n    if (shebang) {\n        parsed.args.unshift(parsed.file);\n        parsed.command = shebang;\n\n        return resolveCommand(parsed);\n    }\n\n    return parsed.file;\n}\n\nfunction parseNonShell(parsed) {\n    if (!isWin) {\n        return parsed;\n    }\n\n    // Detect & add support for shebangs\n    const commandFile = detectShebang(parsed);\n\n    // We don't need a shell if the command filename is an executable\n    const needsShell = !isExecutableRegExp.test(commandFile);\n\n    // If a shell is required, use cmd.exe and take care of escaping everything correctly\n    // Note that `forceShell` is an hidden option used only in tests\n    if (parsed.options.forceShell || needsShell) {\n        // Need to double escape meta chars if the command is a cmd-shim located in `node_modules/.bin/`\n        // The cmd-shim simply calls execute the package bin file with NodeJS, proxying any argument\n        // Because the escape of metachars with ^ gets interpreted when the cmd.exe is first called,\n        // we need to double escape them\n        const needsDoubleEscapeMetaChars = isCmdShimRegExp.test(commandFile);\n\n        // Normalize posix paths into OS compatible paths (e.g.: foo/bar -> foo\\bar)\n        // This is necessary otherwise it will always fail with ENOENT in those cases\n        parsed.command = path.normalize(parsed.command);\n\n        // Escape command & arguments\n        parsed.command = escape.command(parsed.command);\n        parsed.args = parsed.args.map((arg) => escape.argument(arg, needsDoubleEscapeMetaChars));\n\n        const shellCommand = [parsed.command].concat(parsed.args).join(' ');\n\n        parsed.args = ['/d', '/s', '/c', `\"${shellCommand}\"`];\n        parsed.command = process.env.comspec || 'cmd.exe';\n        parsed.options.windowsVerbatimArguments = true; // Tell node's spawn that the arguments are already escaped\n    }\n\n    return parsed;\n}\n\nfunction parse(command, args, options) {\n    // Normalize arguments, similar to nodejs\n    if (args && !Array.isArray(args)) {\n        options = args;\n        args = null;\n    }\n\n    args = args ? args.slice(0) : []; // Clone array to avoid changing the original\n    options = Object.assign({}, options); // Clone object to avoid changing the original\n\n    // Build our parsed object\n    const parsed = {\n        command,\n        args,\n        options,\n        file: undefined,\n        original: {\n            command,\n            args,\n        },\n    };\n\n    // Delegate further parsing to shell or non-shell\n    return options.shell ? parsed : parseNonShell(parsed);\n}\n\nmodule.exports = parse;\n","'use strict';\n\nconst isWin = process.platform === 'win32';\n\nfunction notFoundError(original, syscall) {\n    return Object.assign(new Error(`${syscall} ${original.command} ENOENT`), {\n        code: 'ENOENT',\n        errno: 'ENOENT',\n        syscall: `${syscall} ${original.command}`,\n        path: original.command,\n        spawnargs: original.args,\n    });\n}\n\nfunction hookChildProcess(cp, parsed) {\n    if (!isWin) {\n        return;\n    }\n\n    const originalEmit = cp.emit;\n\n    cp.emit = function (name, arg1) {\n        // If emitting \"exit\" event and exit code is 1, we need to check if\n        // the command exists and emit an \"error\" instead\n        // See https://github.com/IndigoUnited/node-cross-spawn/issues/16\n        if (name === 'exit') {\n            const err = verifyENOENT(arg1, parsed);\n\n            if (err) {\n                return originalEmit.call(cp, 'error', err);\n            }\n        }\n\n        return originalEmit.apply(cp, arguments); // eslint-disable-line prefer-rest-params\n    };\n}\n\nfunction verifyENOENT(status, parsed) {\n    if (isWin && status === 1 && !parsed.file) {\n        return notFoundError(parsed.original, 'spawn');\n    }\n\n    return null;\n}\n\nfunction verifyENOENTSync(status, parsed) {\n    if (isWin && status === 1 && !parsed.file) {\n        return notFoundError(parsed.original, 'spawnSync');\n    }\n\n    return null;\n}\n\nmodule.exports = {\n    hookChildProcess,\n    verifyENOENT,\n    verifyENOENTSync,\n    notFoundError,\n};\n","'use strict';\n\nconst cp = require('child_process');\nconst parse = require('./lib/parse');\nconst enoent = require('./lib/enoent');\n\nfunction spawn(command, args, options) {\n    // Parse the arguments\n    const parsed = parse(command, args, options);\n\n    // Spawn the child process\n    const spawned = cp.spawn(parsed.command, parsed.args, parsed.options);\n\n    // Hook into child process \"exit\" event to emit an error if the command\n    // does not exists, see: https://github.com/IndigoUnited/node-cross-spawn/issues/16\n    enoent.hookChildProcess(spawned, parsed);\n\n    return spawned;\n}\n\nfunction spawnSync(command, args, options) {\n    // Parse the arguments\n    const parsed = parse(command, args, options);\n\n    // Spawn the child process\n    const result = cp.spawnSync(parsed.command, parsed.args, parsed.options);\n\n    // Analyze if the command does not exist, see: https://github.com/IndigoUnited/node-cross-spawn/issues/16\n    result.error = result.error || enoent.verifyENOENTSync(result.status, parsed);\n\n    return result;\n}\n\nmodule.exports = spawn;\nmodule.exports.spawn = spawn;\nmodule.exports.sync = spawnSync;\n\nmodule.exports._parse = parse;\nmodule.exports._enoent = enoent;\n","module.exports = require('events').EventEmitter;\n","'use strict';\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nvar _require = require('buffer'),\n  Buffer = _require.Buffer;\nvar _require2 = require('util'),\n  inspect = _require2.inspect;\nvar custom = inspect && inspect.custom || 'inspect';\nfunction copyBuffer(src, target, offset) {\n  Buffer.prototype.copy.call(src, target, offset);\n}\nmodule.exports = /*#__PURE__*/function () {\n  function BufferList() {\n    _classCallCheck(this, BufferList);\n    this.head = null;\n    this.tail = null;\n    this.length = 0;\n  }\n  _createClass(BufferList, [{\n    key: \"push\",\n    value: function push(v) {\n      var entry = {\n        data: v,\n        next: null\n      };\n      if (this.length > 0) this.tail.next = entry;else this.head = entry;\n      this.tail = entry;\n      ++this.length;\n    }\n  }, {\n    key: \"unshift\",\n    value: function unshift(v) {\n      var entry = {\n        data: v,\n        next: this.head\n      };\n      if (this.length === 0) this.tail = entry;\n      this.head = entry;\n      ++this.length;\n    }\n  }, {\n    key: \"shift\",\n    value: function shift() {\n      if (this.length === 0) return;\n      var ret = this.head.data;\n      if (this.length === 1) this.head = this.tail = null;else this.head = this.head.next;\n      --this.length;\n      return ret;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.head = this.tail = null;\n      this.length = 0;\n    }\n  }, {\n    key: \"join\",\n    value: function join(s) {\n      if (this.length === 0) return '';\n      var p = this.head;\n      var ret = '' + p.data;\n      while (p = p.next) ret += s + p.data;\n      return ret;\n    }\n  }, {\n    key: \"concat\",\n    value: function concat(n) {\n      if (this.length === 0) return Buffer.alloc(0);\n      var ret = Buffer.allocUnsafe(n >>> 0);\n      var p = this.head;\n      var i = 0;\n      while (p) {\n        copyBuffer(p.data, ret, i);\n        i += p.data.length;\n        p = p.next;\n      }\n      return ret;\n    }\n\n    // Consumes a specified amount of bytes or characters from the buffered data.\n  }, {\n    key: \"consume\",\n    value: function consume(n, hasStrings) {\n      var ret;\n      if (n < this.head.data.length) {\n        // `slice` is the same for buffers and strings.\n        ret = this.head.data.slice(0, n);\n        this.head.data = this.head.data.slice(n);\n      } else if (n === this.head.data.length) {\n        // First chunk is a perfect match.\n        ret = this.shift();\n      } else {\n        // Result spans more than one buffer.\n        ret = hasStrings ? this._getString(n) : this._getBuffer(n);\n      }\n      return ret;\n    }\n  }, {\n    key: \"first\",\n    value: function first() {\n      return this.head.data;\n    }\n\n    // Consumes a specified amount of characters from the buffered data.\n  }, {\n    key: \"_getString\",\n    value: function _getString(n) {\n      var p = this.head;\n      var c = 1;\n      var ret = p.data;\n      n -= ret.length;\n      while (p = p.next) {\n        var str = p.data;\n        var nb = n > str.length ? str.length : n;\n        if (nb === str.length) ret += str;else ret += str.slice(0, n);\n        n -= nb;\n        if (n === 0) {\n          if (nb === str.length) {\n            ++c;\n            if (p.next) this.head = p.next;else this.head = this.tail = null;\n          } else {\n            this.head = p;\n            p.data = str.slice(nb);\n          }\n          break;\n        }\n        ++c;\n      }\n      this.length -= c;\n      return ret;\n    }\n\n    // Consumes a specified amount of bytes from the buffered data.\n  }, {\n    key: \"_getBuffer\",\n    value: function _getBuffer(n) {\n      var ret = Buffer.allocUnsafe(n);\n      var p = this.head;\n      var c = 1;\n      p.data.copy(ret);\n      n -= p.data.length;\n      while (p = p.next) {\n        var buf = p.data;\n        var nb = n > buf.length ? buf.length : n;\n        buf.copy(ret, ret.length - n, 0, nb);\n        n -= nb;\n        if (n === 0) {\n          if (nb === buf.length) {\n            ++c;\n            if (p.next) this.head = p.next;else this.head = this.tail = null;\n          } else {\n            this.head = p;\n            p.data = buf.slice(nb);\n          }\n          break;\n        }\n        ++c;\n      }\n      this.length -= c;\n      return ret;\n    }\n\n    // Make sure the linked list only shows the minimal necessary information.\n  }, {\n    key: custom,\n    value: function value(_, options) {\n      return inspect(this, _objectSpread(_objectSpread({}, options), {}, {\n        // Only inspect one level.\n        depth: 0,\n        // It should not recurse.\n        customInspect: false\n      }));\n    }\n  }]);\n  return BufferList;\n}();","'use strict';\n\n// undocumented cb() API, needed for core, not for public API\nfunction destroy(err, cb) {\n  var _this = this;\n  var readableDestroyed = this._readableState && this._readableState.destroyed;\n  var writableDestroyed = this._writableState && this._writableState.destroyed;\n  if (readableDestroyed || writableDestroyed) {\n    if (cb) {\n      cb(err);\n    } else if (err) {\n      if (!this._writableState) {\n        process.nextTick(emitErrorNT, this, err);\n      } else if (!this._writableState.errorEmitted) {\n        this._writableState.errorEmitted = true;\n        process.nextTick(emitErrorNT, this, err);\n      }\n    }\n    return this;\n  }\n\n  // we set destroyed to true before firing error callbacks in order\n  // to make it re-entrance safe in case destroy() is called within callbacks\n\n  if (this._readableState) {\n    this._readableState.destroyed = true;\n  }\n\n  // if this is a duplex stream mark the writable part as destroyed as well\n  if (this._writableState) {\n    this._writableState.destroyed = true;\n  }\n  this._destroy(err || null, function (err) {\n    if (!cb && err) {\n      if (!_this._writableState) {\n        process.nextTick(emitErrorAndCloseNT, _this, err);\n      } else if (!_this._writableState.errorEmitted) {\n        _this._writableState.errorEmitted = true;\n        process.nextTick(emitErrorAndCloseNT, _this, err);\n      } else {\n        process.nextTick(emitCloseNT, _this);\n      }\n    } else if (cb) {\n      process.nextTick(emitCloseNT, _this);\n      cb(err);\n    } else {\n      process.nextTick(emitCloseNT, _this);\n    }\n  });\n  return this;\n}\nfunction emitErrorAndCloseNT(self, err) {\n  emitErrorNT(self, err);\n  emitCloseNT(self);\n}\nfunction emitCloseNT(self) {\n  if (self._writableState && !self._writableState.emitClose) return;\n  if (self._readableState && !self._readableState.emitClose) return;\n  self.emit('close');\n}\nfunction undestroy() {\n  if (this._readableState) {\n    this._readableState.destroyed = false;\n    this._readableState.reading = false;\n    this._readableState.ended = false;\n    this._readableState.endEmitted = false;\n  }\n  if (this._writableState) {\n    this._writableState.destroyed = false;\n    this._writableState.ended = false;\n    this._writableState.ending = false;\n    this._writableState.finalCalled = false;\n    this._writableState.prefinished = false;\n    this._writableState.finished = false;\n    this._writableState.errorEmitted = false;\n  }\n}\nfunction emitErrorNT(self, err) {\n  self.emit('error', err);\n}\nfunction errorOrDestroy(stream, err) {\n  // We have tests that rely on errors being emitted\n  // in the same tick, so changing this is semver major.\n  // For now when you opt-in to autoDestroy we allow\n  // the error to be emitted nextTick. In a future\n  // semver major update we should change the default to this.\n\n  var rState = stream._readableState;\n  var wState = stream._writableState;\n  if (rState && rState.autoDestroy || wState && wState.autoDestroy) stream.destroy(err);else stream.emit('error', err);\n}\nmodule.exports = {\n  destroy: destroy,\n  undestroy: undestroy,\n  errorOrDestroy: errorOrDestroy\n};","'use strict';\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nvar codes = {};\n\nfunction createErrorType(code, message, Base) {\n  if (!Base) {\n    Base = Error;\n  }\n\n  function getMessage(arg1, arg2, arg3) {\n    if (typeof message === 'string') {\n      return message;\n    } else {\n      return message(arg1, arg2, arg3);\n    }\n  }\n\n  var NodeError =\n  /*#__PURE__*/\n  function (_Base) {\n    _inheritsLoose(NodeError, _Base);\n\n    function NodeError(arg1, arg2, arg3) {\n      return _Base.call(this, getMessage(arg1, arg2, arg3)) || this;\n    }\n\n    return NodeError;\n  }(Base);\n\n  NodeError.prototype.name = Base.name;\n  NodeError.prototype.code = code;\n  codes[code] = NodeError;\n} // https://github.com/nodejs/node/blob/v10.8.0/lib/internal/errors.js\n\n\nfunction oneOf(expected, thing) {\n  if (Array.isArray(expected)) {\n    var len = expected.length;\n    expected = expected.map(function (i) {\n      return String(i);\n    });\n\n    if (len > 2) {\n      return \"one of \".concat(thing, \" \").concat(expected.slice(0, len - 1).join(', '), \", or \") + expected[len - 1];\n    } else if (len === 2) {\n      return \"one of \".concat(thing, \" \").concat(expected[0], \" or \").concat(expected[1]);\n    } else {\n      return \"of \".concat(thing, \" \").concat(expected[0]);\n    }\n  } else {\n    return \"of \".concat(thing, \" \").concat(String(expected));\n  }\n} // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith\n\n\nfunction startsWith(str, search, pos) {\n  return str.substr(!pos || pos < 0 ? 0 : +pos, search.length) === search;\n} // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith\n\n\nfunction endsWith(str, search, this_len) {\n  if (this_len === undefined || this_len > str.length) {\n    this_len = str.length;\n  }\n\n  return str.substring(this_len - search.length, this_len) === search;\n} // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes\n\n\nfunction includes(str, search, start) {\n  if (typeof start !== 'number') {\n    start = 0;\n  }\n\n  if (start + search.length > str.length) {\n    return false;\n  } else {\n    return str.indexOf(search, start) !== -1;\n  }\n}\n\ncreateErrorType('ERR_INVALID_OPT_VALUE', function (name, value) {\n  return 'The value \"' + value + '\" is invalid for option \"' + name + '\"';\n}, TypeError);\ncreateErrorType('ERR_INVALID_ARG_TYPE', function (name, expected, actual) {\n  // determiner: 'must be' or 'must not be'\n  var determiner;\n\n  if (typeof expected === 'string' && startsWith(expected, 'not ')) {\n    determiner = 'must not be';\n    expected = expected.replace(/^not /, '');\n  } else {\n    determiner = 'must be';\n  }\n\n  var msg;\n\n  if (endsWith(name, ' argument')) {\n    // For cases like 'first argument'\n    msg = \"The \".concat(name, \" \").concat(determiner, \" \").concat(oneOf(expected, 'type'));\n  } else {\n    var type = includes(name, '.') ? 'property' : 'argument';\n    msg = \"The \\\"\".concat(name, \"\\\" \").concat(type, \" \").concat(determiner, \" \").concat(oneOf(expected, 'type'));\n  }\n\n  msg += \". Received type \".concat(typeof actual);\n  return msg;\n}, TypeError);\ncreateErrorType('ERR_STREAM_PUSH_AFTER_EOF', 'stream.push() after EOF');\ncreateErrorType('ERR_METHOD_NOT_IMPLEMENTED', function (name) {\n  return 'The ' + name + ' method is not implemented';\n});\ncreateErrorType('ERR_STREAM_PREMATURE_CLOSE', 'Premature close');\ncreateErrorType('ERR_STREAM_DESTROYED', function (name) {\n  return 'Cannot call ' + name + ' after a stream was destroyed';\n});\ncreateErrorType('ERR_MULTIPLE_CALLBACK', 'Callback called multiple times');\ncreateErrorType('ERR_STREAM_CANNOT_PIPE', 'Cannot pipe, not readable');\ncreateErrorType('ERR_STREAM_WRITE_AFTER_END', 'write after end');\ncreateErrorType('ERR_STREAM_NULL_VALUES', 'May not write null values to stream', TypeError);\ncreateErrorType('ERR_UNKNOWN_ENCODING', function (arg) {\n  return 'Unknown encoding: ' + arg;\n}, TypeError);\ncreateErrorType('ERR_STREAM_UNSHIFT_AFTER_END_EVENT', 'stream.unshift() after end event');\nmodule.exports.codes = codes;\n","'use strict';\n\nvar ERR_INVALID_OPT_VALUE = require('../../../errors').codes.ERR_INVALID_OPT_VALUE;\nfunction highWaterMarkFrom(options, isDuplex, duplexKey) {\n  return options.highWaterMark != null ? options.highWaterMark : isDuplex ? options[duplexKey] : null;\n}\nfunction getHighWaterMark(state, options, duplexKey, isDuplex) {\n  var hwm = highWaterMarkFrom(options, isDuplex, duplexKey);\n  if (hwm != null) {\n    if (!(isFinite(hwm) && Math.floor(hwm) === hwm) || hwm < 0) {\n      var name = isDuplex ? duplexKey : 'highWaterMark';\n      throw new ERR_INVALID_OPT_VALUE(name, hwm);\n    }\n    return Math.floor(hwm);\n  }\n\n  // Default value\n  return state.objectMode ? 16 : 16 * 1024;\n}\nmodule.exports = {\n  getHighWaterMark: getHighWaterMark\n};","\n/**\n * Module exports.\n */\n\nmodule.exports = deprecate;\n\n/**\n * Mark that a method should not be used.\n * Returns a modified function which warns once by default.\n *\n * If `localStorage.noDeprecation = true` is set, then it is a no-op.\n *\n * If `localStorage.throwDeprecation = true` is set, then deprecated functions\n * will throw an Error when invoked.\n *\n * If `localStorage.traceDeprecation = true` is set, then deprecated functions\n * will invoke `console.trace()` instead of `console.error()`.\n *\n * @param {Function} fn - the function to deprecate\n * @param {String} msg - the string to print to the console when `fn` is invoked\n * @returns {Function} a new \"deprecated\" version of `fn`\n * @api public\n */\n\nfunction deprecate (fn, msg) {\n  if (config('noDeprecation')) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (config('throwDeprecation')) {\n        throw new Error(msg);\n      } else if (config('traceDeprecation')) {\n        console.trace(msg);\n      } else {\n        console.warn(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n}\n\n/**\n * Checks `localStorage` for boolean values for the given `name`.\n *\n * @param {String} name\n * @returns {Boolean}\n * @api private\n */\n\nfunction config (name) {\n  // accessing global.localStorage can trigger a DOMException in sandboxed iframes\n  try {\n    if (!global.localStorage) return false;\n  } catch (_) {\n    return false;\n  }\n  var val = global.localStorage[name];\n  if (null == val) return false;\n  return String(val).toLowerCase() === 'true';\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// A bit simpler than readable streams.\n// Implement an async ._write(chunk, encoding, cb), and it'll handle all\n// the drain event emission and buffering.\n\n'use strict';\n\nmodule.exports = Writable;\n\n/* <replacement> */\nfunction WriteReq(chunk, encoding, cb) {\n  this.chunk = chunk;\n  this.encoding = encoding;\n  this.callback = cb;\n  this.next = null;\n}\n\n// It seems a linked list but it is not\n// there will be only 2 of these for each stream\nfunction CorkedRequest(state) {\n  var _this = this;\n  this.next = null;\n  this.entry = null;\n  this.finish = function () {\n    onCorkedFinish(_this, state);\n  };\n}\n/* </replacement> */\n\n/*<replacement>*/\nvar Duplex;\n/*</replacement>*/\n\nWritable.WritableState = WritableState;\n\n/*<replacement>*/\nvar internalUtil = {\n  deprecate: require('util-deprecate')\n};\n/*</replacement>*/\n\n/*<replacement>*/\nvar Stream = require('./internal/streams/stream');\n/*</replacement>*/\n\nvar Buffer = require('buffer').Buffer;\nvar OurUint8Array = (typeof global !== 'undefined' ? global : typeof window !== 'undefined' ? window : typeof self !== 'undefined' ? self : {}).Uint8Array || function () {};\nfunction _uint8ArrayToBuffer(chunk) {\n  return Buffer.from(chunk);\n}\nfunction _isUint8Array(obj) {\n  return Buffer.isBuffer(obj) || obj instanceof OurUint8Array;\n}\nvar destroyImpl = require('./internal/streams/destroy');\nvar _require = require('./internal/streams/state'),\n  getHighWaterMark = _require.getHighWaterMark;\nvar _require$codes = require('../errors').codes,\n  ERR_INVALID_ARG_TYPE = _require$codes.ERR_INVALID_ARG_TYPE,\n  ERR_METHOD_NOT_IMPLEMENTED = _require$codes.ERR_METHOD_NOT_IMPLEMENTED,\n  ERR_MULTIPLE_CALLBACK = _require$codes.ERR_MULTIPLE_CALLBACK,\n  ERR_STREAM_CANNOT_PIPE = _require$codes.ERR_STREAM_CANNOT_PIPE,\n  ERR_STREAM_DESTROYED = _require$codes.ERR_STREAM_DESTROYED,\n  ERR_STREAM_NULL_VALUES = _require$codes.ERR_STREAM_NULL_VALUES,\n  ERR_STREAM_WRITE_AFTER_END = _require$codes.ERR_STREAM_WRITE_AFTER_END,\n  ERR_UNKNOWN_ENCODING = _require$codes.ERR_UNKNOWN_ENCODING;\nvar errorOrDestroy = destroyImpl.errorOrDestroy;\nrequire('inherits')(Writable, Stream);\nfunction nop() {}\nfunction WritableState(options, stream, isDuplex) {\n  Duplex = Duplex || require('./_stream_duplex');\n  options = options || {};\n\n  // Duplex streams are both readable and writable, but share\n  // the same options object.\n  // However, some cases require setting options to different\n  // values for the readable and the writable sides of the duplex stream,\n  // e.g. options.readableObjectMode vs. options.writableObjectMode, etc.\n  if (typeof isDuplex !== 'boolean') isDuplex = stream instanceof Duplex;\n\n  // object stream flag to indicate whether or not this stream\n  // contains buffers or objects.\n  this.objectMode = !!options.objectMode;\n  if (isDuplex) this.objectMode = this.objectMode || !!options.writableObjectMode;\n\n  // the point at which write() starts returning false\n  // Note: 0 is a valid value, means that we always return false if\n  // the entire buffer is not flushed immediately on write()\n  this.highWaterMark = getHighWaterMark(this, options, 'writableHighWaterMark', isDuplex);\n\n  // if _final has been called\n  this.finalCalled = false;\n\n  // drain event flag.\n  this.needDrain = false;\n  // at the start of calling end()\n  this.ending = false;\n  // when end() has been called, and returned\n  this.ended = false;\n  // when 'finish' is emitted\n  this.finished = false;\n\n  // has it been destroyed\n  this.destroyed = false;\n\n  // should we decode strings into buffers before passing to _write?\n  // this is here so that some node-core streams can optimize string\n  // handling at a lower level.\n  var noDecode = options.decodeStrings === false;\n  this.decodeStrings = !noDecode;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // not an actual buffer we keep track of, but a measurement\n  // of how much we're waiting to get pushed to some underlying\n  // socket or file.\n  this.length = 0;\n\n  // a flag to see when we're in the middle of a write.\n  this.writing = false;\n\n  // when true all writes will be buffered until .uncork() call\n  this.corked = 0;\n\n  // a flag to be able to tell if the onwrite cb is called immediately,\n  // or on a later tick.  We set this to true at first, because any\n  // actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first write call.\n  this.sync = true;\n\n  // a flag to know if we're processing previously buffered items, which\n  // may call the _write() callback in the same tick, so that we don't\n  // end up in an overlapped onwrite situation.\n  this.bufferProcessing = false;\n\n  // the callback that's passed to _write(chunk,cb)\n  this.onwrite = function (er) {\n    onwrite(stream, er);\n  };\n\n  // the callback that the user supplies to write(chunk,encoding,cb)\n  this.writecb = null;\n\n  // the amount that is being written when _write is called.\n  this.writelen = 0;\n  this.bufferedRequest = null;\n  this.lastBufferedRequest = null;\n\n  // number of pending user-supplied write callbacks\n  // this must be 0 before 'finish' can be emitted\n  this.pendingcb = 0;\n\n  // emit prefinish if the only thing we're waiting for is _write cbs\n  // This is relevant for synchronous Transform streams\n  this.prefinished = false;\n\n  // True if the error was already emitted and should not be thrown again\n  this.errorEmitted = false;\n\n  // Should close be emitted on destroy. Defaults to true.\n  this.emitClose = options.emitClose !== false;\n\n  // Should .destroy() be called after 'finish' (and potentially 'end')\n  this.autoDestroy = !!options.autoDestroy;\n\n  // count buffered requests\n  this.bufferedRequestCount = 0;\n\n  // allocate the first CorkedRequest, there is always\n  // one allocated and free to use, and we maintain at most two\n  this.corkedRequestsFree = new CorkedRequest(this);\n}\nWritableState.prototype.getBuffer = function getBuffer() {\n  var current = this.bufferedRequest;\n  var out = [];\n  while (current) {\n    out.push(current);\n    current = current.next;\n  }\n  return out;\n};\n(function () {\n  try {\n    Object.defineProperty(WritableState.prototype, 'buffer', {\n      get: internalUtil.deprecate(function writableStateBufferGetter() {\n        return this.getBuffer();\n      }, '_writableState.buffer is deprecated. Use _writableState.getBuffer ' + 'instead.', 'DEP0003')\n    });\n  } catch (_) {}\n})();\n\n// Test _writableState for inheritance to account for Duplex streams,\n// whose prototype chain only points to Readable.\nvar realHasInstance;\nif (typeof Symbol === 'function' && Symbol.hasInstance && typeof Function.prototype[Symbol.hasInstance] === 'function') {\n  realHasInstance = Function.prototype[Symbol.hasInstance];\n  Object.defineProperty(Writable, Symbol.hasInstance, {\n    value: function value(object) {\n      if (realHasInstance.call(this, object)) return true;\n      if (this !== Writable) return false;\n      return object && object._writableState instanceof WritableState;\n    }\n  });\n} else {\n  realHasInstance = function realHasInstance(object) {\n    return object instanceof this;\n  };\n}\nfunction Writable(options) {\n  Duplex = Duplex || require('./_stream_duplex');\n\n  // Writable ctor is applied to Duplexes, too.\n  // `realHasInstance` is necessary because using plain `instanceof`\n  // would return false, as no `_writableState` property is attached.\n\n  // Trying to use the custom `instanceof` for Writable here will also break the\n  // Node.js LazyTransform implementation, which has a non-trivial getter for\n  // `_writableState` that would lead to infinite recursion.\n\n  // Checking for a Stream.Duplex instance is faster here instead of inside\n  // the WritableState constructor, at least with V8 6.5\n  var isDuplex = this instanceof Duplex;\n  if (!isDuplex && !realHasInstance.call(Writable, this)) return new Writable(options);\n  this._writableState = new WritableState(options, this, isDuplex);\n\n  // legacy.\n  this.writable = true;\n  if (options) {\n    if (typeof options.write === 'function') this._write = options.write;\n    if (typeof options.writev === 'function') this._writev = options.writev;\n    if (typeof options.destroy === 'function') this._destroy = options.destroy;\n    if (typeof options.final === 'function') this._final = options.final;\n  }\n  Stream.call(this);\n}\n\n// Otherwise people can pipe Writable streams, which is just wrong.\nWritable.prototype.pipe = function () {\n  errorOrDestroy(this, new ERR_STREAM_CANNOT_PIPE());\n};\nfunction writeAfterEnd(stream, cb) {\n  var er = new ERR_STREAM_WRITE_AFTER_END();\n  // TODO: defer error events consistently everywhere, not just the cb\n  errorOrDestroy(stream, er);\n  process.nextTick(cb, er);\n}\n\n// Checks that a user-supplied chunk is valid, especially for the particular\n// mode the stream is in. Currently this means that `null` is never accepted\n// and undefined/non-string values are only allowed in object mode.\nfunction validChunk(stream, state, chunk, cb) {\n  var er;\n  if (chunk === null) {\n    er = new ERR_STREAM_NULL_VALUES();\n  } else if (typeof chunk !== 'string' && !state.objectMode) {\n    er = new ERR_INVALID_ARG_TYPE('chunk', ['string', 'Buffer'], chunk);\n  }\n  if (er) {\n    errorOrDestroy(stream, er);\n    process.nextTick(cb, er);\n    return false;\n  }\n  return true;\n}\nWritable.prototype.write = function (chunk, encoding, cb) {\n  var state = this._writableState;\n  var ret = false;\n  var isBuf = !state.objectMode && _isUint8Array(chunk);\n  if (isBuf && !Buffer.isBuffer(chunk)) {\n    chunk = _uint8ArrayToBuffer(chunk);\n  }\n  if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n  if (isBuf) encoding = 'buffer';else if (!encoding) encoding = state.defaultEncoding;\n  if (typeof cb !== 'function') cb = nop;\n  if (state.ending) writeAfterEnd(this, cb);else if (isBuf || validChunk(this, state, chunk, cb)) {\n    state.pendingcb++;\n    ret = writeOrBuffer(this, state, isBuf, chunk, encoding, cb);\n  }\n  return ret;\n};\nWritable.prototype.cork = function () {\n  this._writableState.corked++;\n};\nWritable.prototype.uncork = function () {\n  var state = this._writableState;\n  if (state.corked) {\n    state.corked--;\n    if (!state.writing && !state.corked && !state.bufferProcessing && state.bufferedRequest) clearBuffer(this, state);\n  }\n};\nWritable.prototype.setDefaultEncoding = function setDefaultEncoding(encoding) {\n  // node::ParseEncoding() requires lower case.\n  if (typeof encoding === 'string') encoding = encoding.toLowerCase();\n  if (!(['hex', 'utf8', 'utf-8', 'ascii', 'binary', 'base64', 'ucs2', 'ucs-2', 'utf16le', 'utf-16le', 'raw'].indexOf((encoding + '').toLowerCase()) > -1)) throw new ERR_UNKNOWN_ENCODING(encoding);\n  this._writableState.defaultEncoding = encoding;\n  return this;\n};\nObject.defineProperty(Writable.prototype, 'writableBuffer', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._writableState && this._writableState.getBuffer();\n  }\n});\nfunction decodeChunk(state, chunk, encoding) {\n  if (!state.objectMode && state.decodeStrings !== false && typeof chunk === 'string') {\n    chunk = Buffer.from(chunk, encoding);\n  }\n  return chunk;\n}\nObject.defineProperty(Writable.prototype, 'writableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._writableState.highWaterMark;\n  }\n});\n\n// if we're already writing something, then just put this\n// in the queue, and wait our turn.  Otherwise, call _write\n// If we return false, then we need a drain event, so set that flag.\nfunction writeOrBuffer(stream, state, isBuf, chunk, encoding, cb) {\n  if (!isBuf) {\n    var newChunk = decodeChunk(state, chunk, encoding);\n    if (chunk !== newChunk) {\n      isBuf = true;\n      encoding = 'buffer';\n      chunk = newChunk;\n    }\n  }\n  var len = state.objectMode ? 1 : chunk.length;\n  state.length += len;\n  var ret = state.length < state.highWaterMark;\n  // we must ensure that previous needDrain will not be reset to false.\n  if (!ret) state.needDrain = true;\n  if (state.writing || state.corked) {\n    var last = state.lastBufferedRequest;\n    state.lastBufferedRequest = {\n      chunk: chunk,\n      encoding: encoding,\n      isBuf: isBuf,\n      callback: cb,\n      next: null\n    };\n    if (last) {\n      last.next = state.lastBufferedRequest;\n    } else {\n      state.bufferedRequest = state.lastBufferedRequest;\n    }\n    state.bufferedRequestCount += 1;\n  } else {\n    doWrite(stream, state, false, len, chunk, encoding, cb);\n  }\n  return ret;\n}\nfunction doWrite(stream, state, writev, len, chunk, encoding, cb) {\n  state.writelen = len;\n  state.writecb = cb;\n  state.writing = true;\n  state.sync = true;\n  if (state.destroyed) state.onwrite(new ERR_STREAM_DESTROYED('write'));else if (writev) stream._writev(chunk, state.onwrite);else stream._write(chunk, encoding, state.onwrite);\n  state.sync = false;\n}\nfunction onwriteError(stream, state, sync, er, cb) {\n  --state.pendingcb;\n  if (sync) {\n    // defer the callback if we are being called synchronously\n    // to avoid piling up things on the stack\n    process.nextTick(cb, er);\n    // this can emit finish, and it will always happen\n    // after error\n    process.nextTick(finishMaybe, stream, state);\n    stream._writableState.errorEmitted = true;\n    errorOrDestroy(stream, er);\n  } else {\n    // the caller expect this to happen before if\n    // it is async\n    cb(er);\n    stream._writableState.errorEmitted = true;\n    errorOrDestroy(stream, er);\n    // this can emit finish, but finish must\n    // always follow error\n    finishMaybe(stream, state);\n  }\n}\nfunction onwriteStateUpdate(state) {\n  state.writing = false;\n  state.writecb = null;\n  state.length -= state.writelen;\n  state.writelen = 0;\n}\nfunction onwrite(stream, er) {\n  var state = stream._writableState;\n  var sync = state.sync;\n  var cb = state.writecb;\n  if (typeof cb !== 'function') throw new ERR_MULTIPLE_CALLBACK();\n  onwriteStateUpdate(state);\n  if (er) onwriteError(stream, state, sync, er, cb);else {\n    // Check if we're actually ready to finish, but don't emit yet\n    var finished = needFinish(state) || stream.destroyed;\n    if (!finished && !state.corked && !state.bufferProcessing && state.bufferedRequest) {\n      clearBuffer(stream, state);\n    }\n    if (sync) {\n      process.nextTick(afterWrite, stream, state, finished, cb);\n    } else {\n      afterWrite(stream, state, finished, cb);\n    }\n  }\n}\nfunction afterWrite(stream, state, finished, cb) {\n  if (!finished) onwriteDrain(stream, state);\n  state.pendingcb--;\n  cb();\n  finishMaybe(stream, state);\n}\n\n// Must force callback to be called on nextTick, so that we don't\n// emit 'drain' before the write() consumer gets the 'false' return\n// value, and has a chance to attach a 'drain' listener.\nfunction onwriteDrain(stream, state) {\n  if (state.length === 0 && state.needDrain) {\n    state.needDrain = false;\n    stream.emit('drain');\n  }\n}\n\n// if there's something in the buffer waiting, then process it\nfunction clearBuffer(stream, state) {\n  state.bufferProcessing = true;\n  var entry = state.bufferedRequest;\n  if (stream._writev && entry && entry.next) {\n    // Fast case, write everything using _writev()\n    var l = state.bufferedRequestCount;\n    var buffer = new Array(l);\n    var holder = state.corkedRequestsFree;\n    holder.entry = entry;\n    var count = 0;\n    var allBuffers = true;\n    while (entry) {\n      buffer[count] = entry;\n      if (!entry.isBuf) allBuffers = false;\n      entry = entry.next;\n      count += 1;\n    }\n    buffer.allBuffers = allBuffers;\n    doWrite(stream, state, true, state.length, buffer, '', holder.finish);\n\n    // doWrite is almost always async, defer these to save a bit of time\n    // as the hot path ends with doWrite\n    state.pendingcb++;\n    state.lastBufferedRequest = null;\n    if (holder.next) {\n      state.corkedRequestsFree = holder.next;\n      holder.next = null;\n    } else {\n      state.corkedRequestsFree = new CorkedRequest(state);\n    }\n    state.bufferedRequestCount = 0;\n  } else {\n    // Slow case, write chunks one-by-one\n    while (entry) {\n      var chunk = entry.chunk;\n      var encoding = entry.encoding;\n      var cb = entry.callback;\n      var len = state.objectMode ? 1 : chunk.length;\n      doWrite(stream, state, false, len, chunk, encoding, cb);\n      entry = entry.next;\n      state.bufferedRequestCount--;\n      // if we didn't call the onwrite immediately, then\n      // it means that we need to wait until it does.\n      // also, that means that the chunk and cb are currently\n      // being processed, so move the buffer counter past them.\n      if (state.writing) {\n        break;\n      }\n    }\n    if (entry === null) state.lastBufferedRequest = null;\n  }\n  state.bufferedRequest = entry;\n  state.bufferProcessing = false;\n}\nWritable.prototype._write = function (chunk, encoding, cb) {\n  cb(new ERR_METHOD_NOT_IMPLEMENTED('_write()'));\n};\nWritable.prototype._writev = null;\nWritable.prototype.end = function (chunk, encoding, cb) {\n  var state = this._writableState;\n  if (typeof chunk === 'function') {\n    cb = chunk;\n    chunk = null;\n    encoding = null;\n  } else if (typeof encoding === 'function') {\n    cb = encoding;\n    encoding = null;\n  }\n  if (chunk !== null && chunk !== undefined) this.write(chunk, encoding);\n\n  // .end() fully uncorks\n  if (state.corked) {\n    state.corked = 1;\n    this.uncork();\n  }\n\n  // ignore unnecessary end() calls.\n  if (!state.ending) endWritable(this, state, cb);\n  return this;\n};\nObject.defineProperty(Writable.prototype, 'writableLength', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._writableState.length;\n  }\n});\nfunction needFinish(state) {\n  return state.ending && state.length === 0 && state.bufferedRequest === null && !state.finished && !state.writing;\n}\nfunction callFinal(stream, state) {\n  stream._final(function (err) {\n    state.pendingcb--;\n    if (err) {\n      errorOrDestroy(stream, err);\n    }\n    state.prefinished = true;\n    stream.emit('prefinish');\n    finishMaybe(stream, state);\n  });\n}\nfunction prefinish(stream, state) {\n  if (!state.prefinished && !state.finalCalled) {\n    if (typeof stream._final === 'function' && !state.destroyed) {\n      state.pendingcb++;\n      state.finalCalled = true;\n      process.nextTick(callFinal, stream, state);\n    } else {\n      state.prefinished = true;\n      stream.emit('prefinish');\n    }\n  }\n}\nfunction finishMaybe(stream, state) {\n  var need = needFinish(state);\n  if (need) {\n    prefinish(stream, state);\n    if (state.pendingcb === 0) {\n      state.finished = true;\n      stream.emit('finish');\n      if (state.autoDestroy) {\n        // In case of duplex streams we need a way to detect\n        // if the readable side is ready for autoDestroy as well\n        var rState = stream._readableState;\n        if (!rState || rState.autoDestroy && rState.endEmitted) {\n          stream.destroy();\n        }\n      }\n    }\n  }\n  return need;\n}\nfunction endWritable(stream, state, cb) {\n  state.ending = true;\n  finishMaybe(stream, state);\n  if (cb) {\n    if (state.finished) process.nextTick(cb);else stream.once('finish', cb);\n  }\n  state.ended = true;\n  stream.writable = false;\n}\nfunction onCorkedFinish(corkReq, state, err) {\n  var entry = corkReq.entry;\n  corkReq.entry = null;\n  while (entry) {\n    var cb = entry.callback;\n    state.pendingcb--;\n    cb(err);\n    entry = entry.next;\n  }\n\n  // reuse the free corkReq.\n  state.corkedRequestsFree.next = corkReq;\n}\nObject.defineProperty(Writable.prototype, 'destroyed', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    if (this._writableState === undefined) {\n      return false;\n    }\n    return this._writableState.destroyed;\n  },\n  set: function set(value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (!this._writableState) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._writableState.destroyed = value;\n  }\n});\nWritable.prototype.destroy = destroyImpl.destroy;\nWritable.prototype._undestroy = destroyImpl.undestroy;\nWritable.prototype._destroy = function (err, cb) {\n  cb(err);\n};","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a duplex stream is just a stream that is both readable and writable.\n// Since JS doesn't have multiple prototypal inheritance, this class\n// prototypally inherits from Readable, and then parasitically from\n// Writable.\n\n'use strict';\n\n/*<replacement>*/\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) keys.push(key);\n  return keys;\n};\n/*</replacement>*/\n\nmodule.exports = Duplex;\nvar Readable = require('./_stream_readable');\nvar Writable = require('./_stream_writable');\nrequire('inherits')(Duplex, Readable);\n{\n  // Allow the keys array to be GC'ed.\n  var keys = objectKeys(Writable.prototype);\n  for (var v = 0; v < keys.length; v++) {\n    var method = keys[v];\n    if (!Duplex.prototype[method]) Duplex.prototype[method] = Writable.prototype[method];\n  }\n}\nfunction Duplex(options) {\n  if (!(this instanceof Duplex)) return new Duplex(options);\n  Readable.call(this, options);\n  Writable.call(this, options);\n  this.allowHalfOpen = true;\n  if (options) {\n    if (options.readable === false) this.readable = false;\n    if (options.writable === false) this.writable = false;\n    if (options.allowHalfOpen === false) {\n      this.allowHalfOpen = false;\n      this.once('end', onend);\n    }\n  }\n}\nObject.defineProperty(Duplex.prototype, 'writableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._writableState.highWaterMark;\n  }\n});\nObject.defineProperty(Duplex.prototype, 'writableBuffer', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._writableState && this._writableState.getBuffer();\n  }\n});\nObject.defineProperty(Duplex.prototype, 'writableLength', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._writableState.length;\n  }\n});\n\n// the no-half-open enforcer\nfunction onend() {\n  // If the writable side ended, then we're ok.\n  if (this._writableState.ended) return;\n\n  // no more data can be written.\n  // But allow more writes to happen in this tick.\n  process.nextTick(onEndNT, this);\n}\nfunction onEndNT(self) {\n  self.end();\n}\nObject.defineProperty(Duplex.prototype, 'destroyed', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    if (this._readableState === undefined || this._writableState === undefined) {\n      return false;\n    }\n    return this._readableState.destroyed && this._writableState.destroyed;\n  },\n  set: function set(value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (this._readableState === undefined || this._writableState === undefined) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._readableState.destroyed = value;\n    this._writableState.destroyed = value;\n  }\n});","// Ported from https://github.com/mafintosh/end-of-stream with\n// permission from the author, Mathias Buus (@mafintosh).\n\n'use strict';\n\nvar ERR_STREAM_PREMATURE_CLOSE = require('../../../errors').codes.ERR_STREAM_PREMATURE_CLOSE;\nfunction once(callback) {\n  var called = false;\n  return function () {\n    if (called) return;\n    called = true;\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    callback.apply(this, args);\n  };\n}\nfunction noop() {}\nfunction isRequest(stream) {\n  return stream.setHeader && typeof stream.abort === 'function';\n}\nfunction eos(stream, opts, callback) {\n  if (typeof opts === 'function') return eos(stream, null, opts);\n  if (!opts) opts = {};\n  callback = once(callback || noop);\n  var readable = opts.readable || opts.readable !== false && stream.readable;\n  var writable = opts.writable || opts.writable !== false && stream.writable;\n  var onlegacyfinish = function onlegacyfinish() {\n    if (!stream.writable) onfinish();\n  };\n  var writableEnded = stream._writableState && stream._writableState.finished;\n  var onfinish = function onfinish() {\n    writable = false;\n    writableEnded = true;\n    if (!readable) callback.call(stream);\n  };\n  var readableEnded = stream._readableState && stream._readableState.endEmitted;\n  var onend = function onend() {\n    readable = false;\n    readableEnded = true;\n    if (!writable) callback.call(stream);\n  };\n  var onerror = function onerror(err) {\n    callback.call(stream, err);\n  };\n  var onclose = function onclose() {\n    var err;\n    if (readable && !readableEnded) {\n      if (!stream._readableState || !stream._readableState.ended) err = new ERR_STREAM_PREMATURE_CLOSE();\n      return callback.call(stream, err);\n    }\n    if (writable && !writableEnded) {\n      if (!stream._writableState || !stream._writableState.ended) err = new ERR_STREAM_PREMATURE_CLOSE();\n      return callback.call(stream, err);\n    }\n  };\n  var onrequest = function onrequest() {\n    stream.req.on('finish', onfinish);\n  };\n  if (isRequest(stream)) {\n    stream.on('complete', onfinish);\n    stream.on('abort', onclose);\n    if (stream.req) onrequest();else stream.on('request', onrequest);\n  } else if (writable && !stream._writableState) {\n    // legacy streams\n    stream.on('end', onlegacyfinish);\n    stream.on('close', onlegacyfinish);\n  }\n  stream.on('end', onend);\n  stream.on('finish', onfinish);\n  if (opts.error !== false) stream.on('error', onerror);\n  stream.on('close', onclose);\n  return function () {\n    stream.removeListener('complete', onfinish);\n    stream.removeListener('abort', onclose);\n    stream.removeListener('request', onrequest);\n    if (stream.req) stream.req.removeListener('finish', onfinish);\n    stream.removeListener('end', onlegacyfinish);\n    stream.removeListener('close', onlegacyfinish);\n    stream.removeListener('finish', onfinish);\n    stream.removeListener('end', onend);\n    stream.removeListener('error', onerror);\n    stream.removeListener('close', onclose);\n  };\n}\nmodule.exports = eos;","'use strict';\n\nvar _Object$setPrototypeO;\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nvar finished = require('./end-of-stream');\nvar kLastResolve = Symbol('lastResolve');\nvar kLastReject = Symbol('lastReject');\nvar kError = Symbol('error');\nvar kEnded = Symbol('ended');\nvar kLastPromise = Symbol('lastPromise');\nvar kHandlePromise = Symbol('handlePromise');\nvar kStream = Symbol('stream');\nfunction createIterResult(value, done) {\n  return {\n    value: value,\n    done: done\n  };\n}\nfunction readAndResolve(iter) {\n  var resolve = iter[kLastResolve];\n  if (resolve !== null) {\n    var data = iter[kStream].read();\n    // we defer if data is null\n    // we can be expecting either 'end' or\n    // 'error'\n    if (data !== null) {\n      iter[kLastPromise] = null;\n      iter[kLastResolve] = null;\n      iter[kLastReject] = null;\n      resolve(createIterResult(data, false));\n    }\n  }\n}\nfunction onReadable(iter) {\n  // we wait for the next tick, because it might\n  // emit an error with process.nextTick\n  process.nextTick(readAndResolve, iter);\n}\nfunction wrapForNext(lastPromise, iter) {\n  return function (resolve, reject) {\n    lastPromise.then(function () {\n      if (iter[kEnded]) {\n        resolve(createIterResult(undefined, true));\n        return;\n      }\n      iter[kHandlePromise](resolve, reject);\n    }, reject);\n  };\n}\nvar AsyncIteratorPrototype = Object.getPrototypeOf(function () {});\nvar ReadableStreamAsyncIteratorPrototype = Object.setPrototypeOf((_Object$setPrototypeO = {\n  get stream() {\n    return this[kStream];\n  },\n  next: function next() {\n    var _this = this;\n    // if we have detected an error in the meanwhile\n    // reject straight away\n    var error = this[kError];\n    if (error !== null) {\n      return Promise.reject(error);\n    }\n    if (this[kEnded]) {\n      return Promise.resolve(createIterResult(undefined, true));\n    }\n    if (this[kStream].destroyed) {\n      // We need to defer via nextTick because if .destroy(err) is\n      // called, the error will be emitted via nextTick, and\n      // we cannot guarantee that there is no error lingering around\n      // waiting to be emitted.\n      return new Promise(function (resolve, reject) {\n        process.nextTick(function () {\n          if (_this[kError]) {\n            reject(_this[kError]);\n          } else {\n            resolve(createIterResult(undefined, true));\n          }\n        });\n      });\n    }\n\n    // if we have multiple next() calls\n    // we will wait for the previous Promise to finish\n    // this logic is optimized to support for await loops,\n    // where next() is only called once at a time\n    var lastPromise = this[kLastPromise];\n    var promise;\n    if (lastPromise) {\n      promise = new Promise(wrapForNext(lastPromise, this));\n    } else {\n      // fast path needed to support multiple this.push()\n      // without triggering the next() queue\n      var data = this[kStream].read();\n      if (data !== null) {\n        return Promise.resolve(createIterResult(data, false));\n      }\n      promise = new Promise(this[kHandlePromise]);\n    }\n    this[kLastPromise] = promise;\n    return promise;\n  }\n}, _defineProperty(_Object$setPrototypeO, Symbol.asyncIterator, function () {\n  return this;\n}), _defineProperty(_Object$setPrototypeO, \"return\", function _return() {\n  var _this2 = this;\n  // destroy(err, cb) is a private API\n  // we can guarantee we have that here, because we control the\n  // Readable class this is attached to\n  return new Promise(function (resolve, reject) {\n    _this2[kStream].destroy(null, function (err) {\n      if (err) {\n        reject(err);\n        return;\n      }\n      resolve(createIterResult(undefined, true));\n    });\n  });\n}), _Object$setPrototypeO), AsyncIteratorPrototype);\nvar createReadableStreamAsyncIterator = function createReadableStreamAsyncIterator(stream) {\n  var _Object$create;\n  var iterator = Object.create(ReadableStreamAsyncIteratorPrototype, (_Object$create = {}, _defineProperty(_Object$create, kStream, {\n    value: stream,\n    writable: true\n  }), _defineProperty(_Object$create, kLastResolve, {\n    value: null,\n    writable: true\n  }), _defineProperty(_Object$create, kLastReject, {\n    value: null,\n    writable: true\n  }), _defineProperty(_Object$create, kError, {\n    value: null,\n    writable: true\n  }), _defineProperty(_Object$create, kEnded, {\n    value: stream._readableState.endEmitted,\n    writable: true\n  }), _defineProperty(_Object$create, kHandlePromise, {\n    value: function value(resolve, reject) {\n      var data = iterator[kStream].read();\n      if (data) {\n        iterator[kLastPromise] = null;\n        iterator[kLastResolve] = null;\n        iterator[kLastReject] = null;\n        resolve(createIterResult(data, false));\n      } else {\n        iterator[kLastResolve] = resolve;\n        iterator[kLastReject] = reject;\n      }\n    },\n    writable: true\n  }), _Object$create));\n  iterator[kLastPromise] = null;\n  finished(stream, function (err) {\n    if (err && err.code !== 'ERR_STREAM_PREMATURE_CLOSE') {\n      var reject = iterator[kLastReject];\n      // reject if we are waiting for data in the Promise\n      // returned by next() and store the error\n      if (reject !== null) {\n        iterator[kLastPromise] = null;\n        iterator[kLastResolve] = null;\n        iterator[kLastReject] = null;\n        reject(err);\n      }\n      iterator[kError] = err;\n      return;\n    }\n    var resolve = iterator[kLastResolve];\n    if (resolve !== null) {\n      iterator[kLastPromise] = null;\n      iterator[kLastResolve] = null;\n      iterator[kLastReject] = null;\n      resolve(createIterResult(undefined, true));\n    }\n    iterator[kEnded] = true;\n  });\n  stream.on('readable', onReadable.bind(null, iterator));\n  return iterator;\n};\nmodule.exports = createReadableStreamAsyncIterator;","module.exports = function () {\n  throw new Error('Readable.from is not available in the browser')\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nmodule.exports = Readable;\n\n/*<replacement>*/\nvar Duplex;\n/*</replacement>*/\n\nReadable.ReadableState = ReadableState;\n\n/*<replacement>*/\nvar EE = require('events').EventEmitter;\nvar EElistenerCount = function EElistenerCount(emitter, type) {\n  return emitter.listeners(type).length;\n};\n/*</replacement>*/\n\n/*<replacement>*/\nvar Stream = require('./internal/streams/stream');\n/*</replacement>*/\n\nvar Buffer = require('buffer').Buffer;\nvar OurUint8Array = (typeof global !== 'undefined' ? global : typeof window !== 'undefined' ? window : typeof self !== 'undefined' ? self : {}).Uint8Array || function () {};\nfunction _uint8ArrayToBuffer(chunk) {\n  return Buffer.from(chunk);\n}\nfunction _isUint8Array(obj) {\n  return Buffer.isBuffer(obj) || obj instanceof OurUint8Array;\n}\n\n/*<replacement>*/\nvar debugUtil = require('util');\nvar debug;\nif (debugUtil && debugUtil.debuglog) {\n  debug = debugUtil.debuglog('stream');\n} else {\n  debug = function debug() {};\n}\n/*</replacement>*/\n\nvar BufferList = require('./internal/streams/buffer_list');\nvar destroyImpl = require('./internal/streams/destroy');\nvar _require = require('./internal/streams/state'),\n  getHighWaterMark = _require.getHighWaterMark;\nvar _require$codes = require('../errors').codes,\n  ERR_INVALID_ARG_TYPE = _require$codes.ERR_INVALID_ARG_TYPE,\n  ERR_STREAM_PUSH_AFTER_EOF = _require$codes.ERR_STREAM_PUSH_AFTER_EOF,\n  ERR_METHOD_NOT_IMPLEMENTED = _require$codes.ERR_METHOD_NOT_IMPLEMENTED,\n  ERR_STREAM_UNSHIFT_AFTER_END_EVENT = _require$codes.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;\n\n// Lazy loaded to improve the startup performance.\nvar StringDecoder;\nvar createReadableStreamAsyncIterator;\nvar from;\nrequire('inherits')(Readable, Stream);\nvar errorOrDestroy = destroyImpl.errorOrDestroy;\nvar kProxyEvents = ['error', 'close', 'destroy', 'pause', 'resume'];\nfunction prependListener(emitter, event, fn) {\n  // Sadly this is not cacheable as some libraries bundle their own\n  // event emitter implementation with them.\n  if (typeof emitter.prependListener === 'function') return emitter.prependListener(event, fn);\n\n  // This is a hack to make sure that our error handler is attached before any\n  // userland ones.  NEVER DO THIS. This is here only because this code needs\n  // to continue to work with older versions of Node.js that do not include\n  // the prependListener() method. The goal is to eventually remove this hack.\n  if (!emitter._events || !emitter._events[event]) emitter.on(event, fn);else if (Array.isArray(emitter._events[event])) emitter._events[event].unshift(fn);else emitter._events[event] = [fn, emitter._events[event]];\n}\nfunction ReadableState(options, stream, isDuplex) {\n  Duplex = Duplex || require('./_stream_duplex');\n  options = options || {};\n\n  // Duplex streams are both readable and writable, but share\n  // the same options object.\n  // However, some cases require setting options to different\n  // values for the readable and the writable sides of the duplex stream.\n  // These options can be provided separately as readableXXX and writableXXX.\n  if (typeof isDuplex !== 'boolean') isDuplex = stream instanceof Duplex;\n\n  // object stream flag. Used to make read(n) ignore n and to\n  // make all the buffer merging and length checks go away\n  this.objectMode = !!options.objectMode;\n  if (isDuplex) this.objectMode = this.objectMode || !!options.readableObjectMode;\n\n  // the point at which it stops calling _read() to fill the buffer\n  // Note: 0 is a valid value, means \"don't call _read preemptively ever\"\n  this.highWaterMark = getHighWaterMark(this, options, 'readableHighWaterMark', isDuplex);\n\n  // A linked list is used to store data chunks instead of an array because the\n  // linked list can remove elements from the beginning faster than\n  // array.shift()\n  this.buffer = new BufferList();\n  this.length = 0;\n  this.pipes = null;\n  this.pipesCount = 0;\n  this.flowing = null;\n  this.ended = false;\n  this.endEmitted = false;\n  this.reading = false;\n\n  // a flag to be able to tell if the event 'readable'/'data' is emitted\n  // immediately, or on a later tick.  We set this to true at first, because\n  // any actions that shouldn't happen until \"later\" should generally also\n  // not happen before the first read call.\n  this.sync = true;\n\n  // whenever we return null, then we set a flag to say\n  // that we're awaiting a 'readable' event emission.\n  this.needReadable = false;\n  this.emittedReadable = false;\n  this.readableListening = false;\n  this.resumeScheduled = false;\n  this.paused = true;\n\n  // Should close be emitted on destroy. Defaults to true.\n  this.emitClose = options.emitClose !== false;\n\n  // Should .destroy() be called after 'end' (and potentially 'finish')\n  this.autoDestroy = !!options.autoDestroy;\n\n  // has it been destroyed\n  this.destroyed = false;\n\n  // Crypto is kind of old and crusty.  Historically, its default string\n  // encoding is 'binary' so we have to make this configurable.\n  // Everything else in the universe uses 'utf8', though.\n  this.defaultEncoding = options.defaultEncoding || 'utf8';\n\n  // the number of writers that are awaiting a drain event in .pipe()s\n  this.awaitDrain = 0;\n\n  // if true, a maybeReadMore has been scheduled\n  this.readingMore = false;\n  this.decoder = null;\n  this.encoding = null;\n  if (options.encoding) {\n    if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n    this.decoder = new StringDecoder(options.encoding);\n    this.encoding = options.encoding;\n  }\n}\nfunction Readable(options) {\n  Duplex = Duplex || require('./_stream_duplex');\n  if (!(this instanceof Readable)) return new Readable(options);\n\n  // Checking for a Stream.Duplex instance is faster here instead of inside\n  // the ReadableState constructor, at least with V8 6.5\n  var isDuplex = this instanceof Duplex;\n  this._readableState = new ReadableState(options, this, isDuplex);\n\n  // legacy\n  this.readable = true;\n  if (options) {\n    if (typeof options.read === 'function') this._read = options.read;\n    if (typeof options.destroy === 'function') this._destroy = options.destroy;\n  }\n  Stream.call(this);\n}\nObject.defineProperty(Readable.prototype, 'destroyed', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    if (this._readableState === undefined) {\n      return false;\n    }\n    return this._readableState.destroyed;\n  },\n  set: function set(value) {\n    // we ignore the value if the stream\n    // has not been initialized yet\n    if (!this._readableState) {\n      return;\n    }\n\n    // backward compatibility, the user is explicitly\n    // managing destroyed\n    this._readableState.destroyed = value;\n  }\n});\nReadable.prototype.destroy = destroyImpl.destroy;\nReadable.prototype._undestroy = destroyImpl.undestroy;\nReadable.prototype._destroy = function (err, cb) {\n  cb(err);\n};\n\n// Manually shove something into the read() buffer.\n// This returns true if the highWaterMark has not been hit yet,\n// similar to how Writable.write() returns true if you should\n// write() some more.\nReadable.prototype.push = function (chunk, encoding) {\n  var state = this._readableState;\n  var skipChunkCheck;\n  if (!state.objectMode) {\n    if (typeof chunk === 'string') {\n      encoding = encoding || state.defaultEncoding;\n      if (encoding !== state.encoding) {\n        chunk = Buffer.from(chunk, encoding);\n        encoding = '';\n      }\n      skipChunkCheck = true;\n    }\n  } else {\n    skipChunkCheck = true;\n  }\n  return readableAddChunk(this, chunk, encoding, false, skipChunkCheck);\n};\n\n// Unshift should *always* be something directly out of read()\nReadable.prototype.unshift = function (chunk) {\n  return readableAddChunk(this, chunk, null, true, false);\n};\nfunction readableAddChunk(stream, chunk, encoding, addToFront, skipChunkCheck) {\n  debug('readableAddChunk', chunk);\n  var state = stream._readableState;\n  if (chunk === null) {\n    state.reading = false;\n    onEofChunk(stream, state);\n  } else {\n    var er;\n    if (!skipChunkCheck) er = chunkInvalid(state, chunk);\n    if (er) {\n      errorOrDestroy(stream, er);\n    } else if (state.objectMode || chunk && chunk.length > 0) {\n      if (typeof chunk !== 'string' && !state.objectMode && Object.getPrototypeOf(chunk) !== Buffer.prototype) {\n        chunk = _uint8ArrayToBuffer(chunk);\n      }\n      if (addToFront) {\n        if (state.endEmitted) errorOrDestroy(stream, new ERR_STREAM_UNSHIFT_AFTER_END_EVENT());else addChunk(stream, state, chunk, true);\n      } else if (state.ended) {\n        errorOrDestroy(stream, new ERR_STREAM_PUSH_AFTER_EOF());\n      } else if (state.destroyed) {\n        return false;\n      } else {\n        state.reading = false;\n        if (state.decoder && !encoding) {\n          chunk = state.decoder.write(chunk);\n          if (state.objectMode || chunk.length !== 0) addChunk(stream, state, chunk, false);else maybeReadMore(stream, state);\n        } else {\n          addChunk(stream, state, chunk, false);\n        }\n      }\n    } else if (!addToFront) {\n      state.reading = false;\n      maybeReadMore(stream, state);\n    }\n  }\n\n  // We can push more data if we are below the highWaterMark.\n  // Also, if we have no data yet, we can stand some more bytes.\n  // This is to work around cases where hwm=0, such as the repl.\n  return !state.ended && (state.length < state.highWaterMark || state.length === 0);\n}\nfunction addChunk(stream, state, chunk, addToFront) {\n  if (state.flowing && state.length === 0 && !state.sync) {\n    state.awaitDrain = 0;\n    stream.emit('data', chunk);\n  } else {\n    // update the buffer info.\n    state.length += state.objectMode ? 1 : chunk.length;\n    if (addToFront) state.buffer.unshift(chunk);else state.buffer.push(chunk);\n    if (state.needReadable) emitReadable(stream);\n  }\n  maybeReadMore(stream, state);\n}\nfunction chunkInvalid(state, chunk) {\n  var er;\n  if (!_isUint8Array(chunk) && typeof chunk !== 'string' && chunk !== undefined && !state.objectMode) {\n    er = new ERR_INVALID_ARG_TYPE('chunk', ['string', 'Buffer', 'Uint8Array'], chunk);\n  }\n  return er;\n}\nReadable.prototype.isPaused = function () {\n  return this._readableState.flowing === false;\n};\n\n// backwards compatibility.\nReadable.prototype.setEncoding = function (enc) {\n  if (!StringDecoder) StringDecoder = require('string_decoder/').StringDecoder;\n  var decoder = new StringDecoder(enc);\n  this._readableState.decoder = decoder;\n  // If setEncoding(null), decoder.encoding equals utf8\n  this._readableState.encoding = this._readableState.decoder.encoding;\n\n  // Iterate over current buffer to convert already stored Buffers:\n  var p = this._readableState.buffer.head;\n  var content = '';\n  while (p !== null) {\n    content += decoder.write(p.data);\n    p = p.next;\n  }\n  this._readableState.buffer.clear();\n  if (content !== '') this._readableState.buffer.push(content);\n  this._readableState.length = content.length;\n  return this;\n};\n\n// Don't raise the hwm > 1GB\nvar MAX_HWM = 0x40000000;\nfunction computeNewHighWaterMark(n) {\n  if (n >= MAX_HWM) {\n    // TODO(ronag): Throw ERR_VALUE_OUT_OF_RANGE.\n    n = MAX_HWM;\n  } else {\n    // Get the next highest power of 2 to prevent increasing hwm excessively in\n    // tiny amounts\n    n--;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    n++;\n  }\n  return n;\n}\n\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction howMuchToRead(n, state) {\n  if (n <= 0 || state.length === 0 && state.ended) return 0;\n  if (state.objectMode) return 1;\n  if (n !== n) {\n    // Only flow one buffer at a time\n    if (state.flowing && state.length) return state.buffer.head.data.length;else return state.length;\n  }\n  // If we're asking for more than the current hwm, then raise the hwm.\n  if (n > state.highWaterMark) state.highWaterMark = computeNewHighWaterMark(n);\n  if (n <= state.length) return n;\n  // Don't have enough\n  if (!state.ended) {\n    state.needReadable = true;\n    return 0;\n  }\n  return state.length;\n}\n\n// you can override either this method, or the async _read(n) below.\nReadable.prototype.read = function (n) {\n  debug('read', n);\n  n = parseInt(n, 10);\n  var state = this._readableState;\n  var nOrig = n;\n  if (n !== 0) state.emittedReadable = false;\n\n  // if we're doing read(0) to trigger a readable event, but we\n  // already have a bunch of data in the buffer, then just trigger\n  // the 'readable' event and move on.\n  if (n === 0 && state.needReadable && ((state.highWaterMark !== 0 ? state.length >= state.highWaterMark : state.length > 0) || state.ended)) {\n    debug('read: emitReadable', state.length, state.ended);\n    if (state.length === 0 && state.ended) endReadable(this);else emitReadable(this);\n    return null;\n  }\n  n = howMuchToRead(n, state);\n\n  // if we've ended, and we're now clear, then finish it up.\n  if (n === 0 && state.ended) {\n    if (state.length === 0) endReadable(this);\n    return null;\n  }\n\n  // All the actual chunk generation logic needs to be\n  // *below* the call to _read.  The reason is that in certain\n  // synthetic stream cases, such as passthrough streams, _read\n  // may be a completely synchronous operation which may change\n  // the state of the read buffer, providing enough data when\n  // before there was *not* enough.\n  //\n  // So, the steps are:\n  // 1. Figure out what the state of things will be after we do\n  // a read from the buffer.\n  //\n  // 2. If that resulting state will trigger a _read, then call _read.\n  // Note that this may be asynchronous, or synchronous.  Yes, it is\n  // deeply ugly to write APIs this way, but that still doesn't mean\n  // that the Readable class should behave improperly, as streams are\n  // designed to be sync/async agnostic.\n  // Take note if the _read call is sync or async (ie, if the read call\n  // has returned yet), so that we know whether or not it's safe to emit\n  // 'readable' etc.\n  //\n  // 3. Actually pull the requested chunks out of the buffer and return.\n\n  // if we need a readable event, then we need to do some reading.\n  var doRead = state.needReadable;\n  debug('need readable', doRead);\n\n  // if we currently have less than the highWaterMark, then also read some\n  if (state.length === 0 || state.length - n < state.highWaterMark) {\n    doRead = true;\n    debug('length less than watermark', doRead);\n  }\n\n  // however, if we've ended, then there's no point, and if we're already\n  // reading, then it's unnecessary.\n  if (state.ended || state.reading) {\n    doRead = false;\n    debug('reading or ended', doRead);\n  } else if (doRead) {\n    debug('do read');\n    state.reading = true;\n    state.sync = true;\n    // if the length is currently zero, then we *need* a readable event.\n    if (state.length === 0) state.needReadable = true;\n    // call internal read method\n    this._read(state.highWaterMark);\n    state.sync = false;\n    // If _read pushed data synchronously, then `reading` will be false,\n    // and we need to re-evaluate how much data we can return to the user.\n    if (!state.reading) n = howMuchToRead(nOrig, state);\n  }\n  var ret;\n  if (n > 0) ret = fromList(n, state);else ret = null;\n  if (ret === null) {\n    state.needReadable = state.length <= state.highWaterMark;\n    n = 0;\n  } else {\n    state.length -= n;\n    state.awaitDrain = 0;\n  }\n  if (state.length === 0) {\n    // If we have nothing in the buffer, then we want to know\n    // as soon as we *do* get something into the buffer.\n    if (!state.ended) state.needReadable = true;\n\n    // If we tried to read() past the EOF, then emit end on the next tick.\n    if (nOrig !== n && state.ended) endReadable(this);\n  }\n  if (ret !== null) this.emit('data', ret);\n  return ret;\n};\nfunction onEofChunk(stream, state) {\n  debug('onEofChunk');\n  if (state.ended) return;\n  if (state.decoder) {\n    var chunk = state.decoder.end();\n    if (chunk && chunk.length) {\n      state.buffer.push(chunk);\n      state.length += state.objectMode ? 1 : chunk.length;\n    }\n  }\n  state.ended = true;\n  if (state.sync) {\n    // if we are sync, wait until next tick to emit the data.\n    // Otherwise we risk emitting data in the flow()\n    // the readable code triggers during a read() call\n    emitReadable(stream);\n  } else {\n    // emit 'readable' now to make sure it gets picked up.\n    state.needReadable = false;\n    if (!state.emittedReadable) {\n      state.emittedReadable = true;\n      emitReadable_(stream);\n    }\n  }\n}\n\n// Don't emit readable right away in sync mode, because this can trigger\n// another read() call => stack overflow.  This way, it might trigger\n// a nextTick recursion warning, but that's not so bad.\nfunction emitReadable(stream) {\n  var state = stream._readableState;\n  debug('emitReadable', state.needReadable, state.emittedReadable);\n  state.needReadable = false;\n  if (!state.emittedReadable) {\n    debug('emitReadable', state.flowing);\n    state.emittedReadable = true;\n    process.nextTick(emitReadable_, stream);\n  }\n}\nfunction emitReadable_(stream) {\n  var state = stream._readableState;\n  debug('emitReadable_', state.destroyed, state.length, state.ended);\n  if (!state.destroyed && (state.length || state.ended)) {\n    stream.emit('readable');\n    state.emittedReadable = false;\n  }\n\n  // The stream needs another readable event if\n  // 1. It is not flowing, as the flow mechanism will take\n  //    care of it.\n  // 2. It is not ended.\n  // 3. It is below the highWaterMark, so we can schedule\n  //    another readable later.\n  state.needReadable = !state.flowing && !state.ended && state.length <= state.highWaterMark;\n  flow(stream);\n}\n\n// at this point, the user has presumably seen the 'readable' event,\n// and called read() to consume some data.  that may have triggered\n// in turn another _read(n) call, in which case reading = true if\n// it's in progress.\n// However, if we're not ended, or reading, and the length < hwm,\n// then go ahead and try to read some more preemptively.\nfunction maybeReadMore(stream, state) {\n  if (!state.readingMore) {\n    state.readingMore = true;\n    process.nextTick(maybeReadMore_, stream, state);\n  }\n}\nfunction maybeReadMore_(stream, state) {\n  // Attempt to read more data if we should.\n  //\n  // The conditions for reading more data are (one of):\n  // - Not enough data buffered (state.length < state.highWaterMark). The loop\n  //   is responsible for filling the buffer with enough data if such data\n  //   is available. If highWaterMark is 0 and we are not in the flowing mode\n  //   we should _not_ attempt to buffer any extra data. We'll get more data\n  //   when the stream consumer calls read() instead.\n  // - No data in the buffer, and the stream is in flowing mode. In this mode\n  //   the loop below is responsible for ensuring read() is called. Failing to\n  //   call read here would abort the flow and there's no other mechanism for\n  //   continuing the flow if the stream consumer has just subscribed to the\n  //   'data' event.\n  //\n  // In addition to the above conditions to keep reading data, the following\n  // conditions prevent the data from being read:\n  // - The stream has ended (state.ended).\n  // - There is already a pending 'read' operation (state.reading). This is a\n  //   case where the the stream has called the implementation defined _read()\n  //   method, but they are processing the call asynchronously and have _not_\n  //   called push() with new data. In this case we skip performing more\n  //   read()s. The execution ends in this method again after the _read() ends\n  //   up calling push() with more data.\n  while (!state.reading && !state.ended && (state.length < state.highWaterMark || state.flowing && state.length === 0)) {\n    var len = state.length;\n    debug('maybeReadMore read 0');\n    stream.read(0);\n    if (len === state.length)\n      // didn't get any data, stop spinning.\n      break;\n  }\n  state.readingMore = false;\n}\n\n// abstract method.  to be overridden in specific implementation classes.\n// call cb(er, data) where data is <= n in length.\n// for virtual (non-string, non-buffer) streams, \"length\" is somewhat\n// arbitrary, and perhaps not very meaningful.\nReadable.prototype._read = function (n) {\n  errorOrDestroy(this, new ERR_METHOD_NOT_IMPLEMENTED('_read()'));\n};\nReadable.prototype.pipe = function (dest, pipeOpts) {\n  var src = this;\n  var state = this._readableState;\n  switch (state.pipesCount) {\n    case 0:\n      state.pipes = dest;\n      break;\n    case 1:\n      state.pipes = [state.pipes, dest];\n      break;\n    default:\n      state.pipes.push(dest);\n      break;\n  }\n  state.pipesCount += 1;\n  debug('pipe count=%d opts=%j', state.pipesCount, pipeOpts);\n  var doEnd = (!pipeOpts || pipeOpts.end !== false) && dest !== process.stdout && dest !== process.stderr;\n  var endFn = doEnd ? onend : unpipe;\n  if (state.endEmitted) process.nextTick(endFn);else src.once('end', endFn);\n  dest.on('unpipe', onunpipe);\n  function onunpipe(readable, unpipeInfo) {\n    debug('onunpipe');\n    if (readable === src) {\n      if (unpipeInfo && unpipeInfo.hasUnpiped === false) {\n        unpipeInfo.hasUnpiped = true;\n        cleanup();\n      }\n    }\n  }\n  function onend() {\n    debug('onend');\n    dest.end();\n  }\n\n  // when the dest drains, it reduces the awaitDrain counter\n  // on the source.  This would be more elegant with a .once()\n  // handler in flow(), but adding and removing repeatedly is\n  // too slow.\n  var ondrain = pipeOnDrain(src);\n  dest.on('drain', ondrain);\n  var cleanedUp = false;\n  function cleanup() {\n    debug('cleanup');\n    // cleanup event handlers once the pipe is broken\n    dest.removeListener('close', onclose);\n    dest.removeListener('finish', onfinish);\n    dest.removeListener('drain', ondrain);\n    dest.removeListener('error', onerror);\n    dest.removeListener('unpipe', onunpipe);\n    src.removeListener('end', onend);\n    src.removeListener('end', unpipe);\n    src.removeListener('data', ondata);\n    cleanedUp = true;\n\n    // if the reader is waiting for a drain event from this\n    // specific writer, then it would cause it to never start\n    // flowing again.\n    // So, if this is awaiting a drain, then we just call it now.\n    // If we don't know, then assume that we are waiting for one.\n    if (state.awaitDrain && (!dest._writableState || dest._writableState.needDrain)) ondrain();\n  }\n  src.on('data', ondata);\n  function ondata(chunk) {\n    debug('ondata');\n    var ret = dest.write(chunk);\n    debug('dest.write', ret);\n    if (ret === false) {\n      // If the user unpiped during `dest.write()`, it is possible\n      // to get stuck in a permanently paused state if that write\n      // also returned false.\n      // => Check whether `dest` is still a piping destination.\n      if ((state.pipesCount === 1 && state.pipes === dest || state.pipesCount > 1 && indexOf(state.pipes, dest) !== -1) && !cleanedUp) {\n        debug('false write response, pause', state.awaitDrain);\n        state.awaitDrain++;\n      }\n      src.pause();\n    }\n  }\n\n  // if the dest has an error, then stop piping into it.\n  // however, don't suppress the throwing behavior for this.\n  function onerror(er) {\n    debug('onerror', er);\n    unpipe();\n    dest.removeListener('error', onerror);\n    if (EElistenerCount(dest, 'error') === 0) errorOrDestroy(dest, er);\n  }\n\n  // Make sure our error handler is attached before userland ones.\n  prependListener(dest, 'error', onerror);\n\n  // Both close and finish should trigger unpipe, but only once.\n  function onclose() {\n    dest.removeListener('finish', onfinish);\n    unpipe();\n  }\n  dest.once('close', onclose);\n  function onfinish() {\n    debug('onfinish');\n    dest.removeListener('close', onclose);\n    unpipe();\n  }\n  dest.once('finish', onfinish);\n  function unpipe() {\n    debug('unpipe');\n    src.unpipe(dest);\n  }\n\n  // tell the dest that it's being piped to\n  dest.emit('pipe', src);\n\n  // start the flow if it hasn't been started already.\n  if (!state.flowing) {\n    debug('pipe resume');\n    src.resume();\n  }\n  return dest;\n};\nfunction pipeOnDrain(src) {\n  return function pipeOnDrainFunctionResult() {\n    var state = src._readableState;\n    debug('pipeOnDrain', state.awaitDrain);\n    if (state.awaitDrain) state.awaitDrain--;\n    if (state.awaitDrain === 0 && EElistenerCount(src, 'data')) {\n      state.flowing = true;\n      flow(src);\n    }\n  };\n}\nReadable.prototype.unpipe = function (dest) {\n  var state = this._readableState;\n  var unpipeInfo = {\n    hasUnpiped: false\n  };\n\n  // if we're not piping anywhere, then do nothing.\n  if (state.pipesCount === 0) return this;\n\n  // just one destination.  most common case.\n  if (state.pipesCount === 1) {\n    // passed in one, but it's not the right one.\n    if (dest && dest !== state.pipes) return this;\n    if (!dest) dest = state.pipes;\n\n    // got a match.\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n    if (dest) dest.emit('unpipe', this, unpipeInfo);\n    return this;\n  }\n\n  // slow case. multiple pipe destinations.\n\n  if (!dest) {\n    // remove all.\n    var dests = state.pipes;\n    var len = state.pipesCount;\n    state.pipes = null;\n    state.pipesCount = 0;\n    state.flowing = false;\n    for (var i = 0; i < len; i++) dests[i].emit('unpipe', this, {\n      hasUnpiped: false\n    });\n    return this;\n  }\n\n  // try to find the right one.\n  var index = indexOf(state.pipes, dest);\n  if (index === -1) return this;\n  state.pipes.splice(index, 1);\n  state.pipesCount -= 1;\n  if (state.pipesCount === 1) state.pipes = state.pipes[0];\n  dest.emit('unpipe', this, unpipeInfo);\n  return this;\n};\n\n// set up data events if they are asked for\n// Ensure readable listeners eventually get something\nReadable.prototype.on = function (ev, fn) {\n  var res = Stream.prototype.on.call(this, ev, fn);\n  var state = this._readableState;\n  if (ev === 'data') {\n    // update readableListening so that resume() may be a no-op\n    // a few lines down. This is needed to support once('readable').\n    state.readableListening = this.listenerCount('readable') > 0;\n\n    // Try start flowing on next tick if stream isn't explicitly paused\n    if (state.flowing !== false) this.resume();\n  } else if (ev === 'readable') {\n    if (!state.endEmitted && !state.readableListening) {\n      state.readableListening = state.needReadable = true;\n      state.flowing = false;\n      state.emittedReadable = false;\n      debug('on readable', state.length, state.reading);\n      if (state.length) {\n        emitReadable(this);\n      } else if (!state.reading) {\n        process.nextTick(nReadingNextTick, this);\n      }\n    }\n  }\n  return res;\n};\nReadable.prototype.addListener = Readable.prototype.on;\nReadable.prototype.removeListener = function (ev, fn) {\n  var res = Stream.prototype.removeListener.call(this, ev, fn);\n  if (ev === 'readable') {\n    // We need to check if there is someone still listening to\n    // readable and reset the state. However this needs to happen\n    // after readable has been emitted but before I/O (nextTick) to\n    // support once('readable', fn) cycles. This means that calling\n    // resume within the same tick will have no\n    // effect.\n    process.nextTick(updateReadableListening, this);\n  }\n  return res;\n};\nReadable.prototype.removeAllListeners = function (ev) {\n  var res = Stream.prototype.removeAllListeners.apply(this, arguments);\n  if (ev === 'readable' || ev === undefined) {\n    // We need to check if there is someone still listening to\n    // readable and reset the state. However this needs to happen\n    // after readable has been emitted but before I/O (nextTick) to\n    // support once('readable', fn) cycles. This means that calling\n    // resume within the same tick will have no\n    // effect.\n    process.nextTick(updateReadableListening, this);\n  }\n  return res;\n};\nfunction updateReadableListening(self) {\n  var state = self._readableState;\n  state.readableListening = self.listenerCount('readable') > 0;\n  if (state.resumeScheduled && !state.paused) {\n    // flowing needs to be set to true now, otherwise\n    // the upcoming resume will not flow.\n    state.flowing = true;\n\n    // crude way to check if we should resume\n  } else if (self.listenerCount('data') > 0) {\n    self.resume();\n  }\n}\nfunction nReadingNextTick(self) {\n  debug('readable nexttick read 0');\n  self.read(0);\n}\n\n// pause() and resume() are remnants of the legacy readable stream API\n// If the user uses them, then switch into old mode.\nReadable.prototype.resume = function () {\n  var state = this._readableState;\n  if (!state.flowing) {\n    debug('resume');\n    // we flow only if there is no one listening\n    // for readable, but we still have to call\n    // resume()\n    state.flowing = !state.readableListening;\n    resume(this, state);\n  }\n  state.paused = false;\n  return this;\n};\nfunction resume(stream, state) {\n  if (!state.resumeScheduled) {\n    state.resumeScheduled = true;\n    process.nextTick(resume_, stream, state);\n  }\n}\nfunction resume_(stream, state) {\n  debug('resume', state.reading);\n  if (!state.reading) {\n    stream.read(0);\n  }\n  state.resumeScheduled = false;\n  stream.emit('resume');\n  flow(stream);\n  if (state.flowing && !state.reading) stream.read(0);\n}\nReadable.prototype.pause = function () {\n  debug('call pause flowing=%j', this._readableState.flowing);\n  if (this._readableState.flowing !== false) {\n    debug('pause');\n    this._readableState.flowing = false;\n    this.emit('pause');\n  }\n  this._readableState.paused = true;\n  return this;\n};\nfunction flow(stream) {\n  var state = stream._readableState;\n  debug('flow', state.flowing);\n  while (state.flowing && stream.read() !== null);\n}\n\n// wrap an old-style stream as the async data source.\n// This is *not* part of the readable stream interface.\n// It is an ugly unfortunate mess of history.\nReadable.prototype.wrap = function (stream) {\n  var _this = this;\n  var state = this._readableState;\n  var paused = false;\n  stream.on('end', function () {\n    debug('wrapped end');\n    if (state.decoder && !state.ended) {\n      var chunk = state.decoder.end();\n      if (chunk && chunk.length) _this.push(chunk);\n    }\n    _this.push(null);\n  });\n  stream.on('data', function (chunk) {\n    debug('wrapped data');\n    if (state.decoder) chunk = state.decoder.write(chunk);\n\n    // don't skip over falsy values in objectMode\n    if (state.objectMode && (chunk === null || chunk === undefined)) return;else if (!state.objectMode && (!chunk || !chunk.length)) return;\n    var ret = _this.push(chunk);\n    if (!ret) {\n      paused = true;\n      stream.pause();\n    }\n  });\n\n  // proxy all the other methods.\n  // important when wrapping filters and duplexes.\n  for (var i in stream) {\n    if (this[i] === undefined && typeof stream[i] === 'function') {\n      this[i] = function methodWrap(method) {\n        return function methodWrapReturnFunction() {\n          return stream[method].apply(stream, arguments);\n        };\n      }(i);\n    }\n  }\n\n  // proxy certain important events.\n  for (var n = 0; n < kProxyEvents.length; n++) {\n    stream.on(kProxyEvents[n], this.emit.bind(this, kProxyEvents[n]));\n  }\n\n  // when we try to consume some more bytes, simply unpause the\n  // underlying stream.\n  this._read = function (n) {\n    debug('wrapped _read', n);\n    if (paused) {\n      paused = false;\n      stream.resume();\n    }\n  };\n  return this;\n};\nif (typeof Symbol === 'function') {\n  Readable.prototype[Symbol.asyncIterator] = function () {\n    if (createReadableStreamAsyncIterator === undefined) {\n      createReadableStreamAsyncIterator = require('./internal/streams/async_iterator');\n    }\n    return createReadableStreamAsyncIterator(this);\n  };\n}\nObject.defineProperty(Readable.prototype, 'readableHighWaterMark', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._readableState.highWaterMark;\n  }\n});\nObject.defineProperty(Readable.prototype, 'readableBuffer', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._readableState && this._readableState.buffer;\n  }\n});\nObject.defineProperty(Readable.prototype, 'readableFlowing', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._readableState.flowing;\n  },\n  set: function set(state) {\n    if (this._readableState) {\n      this._readableState.flowing = state;\n    }\n  }\n});\n\n// exposed for testing purposes only.\nReadable._fromList = fromList;\nObject.defineProperty(Readable.prototype, 'readableLength', {\n  // making it explicit this property is not enumerable\n  // because otherwise some prototype manipulation in\n  // userland will fail\n  enumerable: false,\n  get: function get() {\n    return this._readableState.length;\n  }\n});\n\n// Pluck off n bytes from an array of buffers.\n// Length is the combined lengths of all the buffers in the list.\n// This function is designed to be inlinable, so please take care when making\n// changes to the function body.\nfunction fromList(n, state) {\n  // nothing buffered\n  if (state.length === 0) return null;\n  var ret;\n  if (state.objectMode) ret = state.buffer.shift();else if (!n || n >= state.length) {\n    // read it all, truncate the list\n    if (state.decoder) ret = state.buffer.join('');else if (state.buffer.length === 1) ret = state.buffer.first();else ret = state.buffer.concat(state.length);\n    state.buffer.clear();\n  } else {\n    // read part of list\n    ret = state.buffer.consume(n, state.decoder);\n  }\n  return ret;\n}\nfunction endReadable(stream) {\n  var state = stream._readableState;\n  debug('endReadable', state.endEmitted);\n  if (!state.endEmitted) {\n    state.ended = true;\n    process.nextTick(endReadableNT, state, stream);\n  }\n}\nfunction endReadableNT(state, stream) {\n  debug('endReadableNT', state.endEmitted, state.length);\n\n  // Check that we didn't get one last unshift.\n  if (!state.endEmitted && state.length === 0) {\n    state.endEmitted = true;\n    stream.readable = false;\n    stream.emit('end');\n    if (state.autoDestroy) {\n      // In case of duplex streams we need a way to detect\n      // if the writable side is ready for autoDestroy as well\n      var wState = stream._writableState;\n      if (!wState || wState.autoDestroy && wState.finished) {\n        stream.destroy();\n      }\n    }\n  }\n}\nif (typeof Symbol === 'function') {\n  Readable.from = function (iterable, opts) {\n    if (from === undefined) {\n      from = require('./internal/streams/from');\n    }\n    return from(Readable, iterable, opts);\n  };\n}\nfunction indexOf(xs, x) {\n  for (var i = 0, l = xs.length; i < l; i++) {\n    if (xs[i] === x) return i;\n  }\n  return -1;\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a transform stream is a readable/writable stream where you do\n// something with the data.  Sometimes it's called a \"filter\",\n// but that's not a great name for it, since that implies a thing where\n// some bits pass through, and others are simply ignored.  (That would\n// be a valid example of a transform, of course.)\n//\n// While the output is causally related to the input, it's not a\n// necessarily symmetric or synchronous transformation.  For example,\n// a zlib stream might take multiple plain-text writes(), and then\n// emit a single compressed chunk some time in the future.\n//\n// Here's how this works:\n//\n// The Transform stream has all the aspects of the readable and writable\n// stream classes.  When you write(chunk), that calls _write(chunk,cb)\n// internally, and returns false if there's a lot of pending writes\n// buffered up.  When you call read(), that calls _read(n) until\n// there's enough pending readable data buffered up.\n//\n// In a transform stream, the written data is placed in a buffer.  When\n// _read(n) is called, it transforms the queued up data, calling the\n// buffered _write cb's as it consumes chunks.  If consuming a single\n// written chunk would result in multiple output chunks, then the first\n// outputted bit calls the readcb, and subsequent chunks just go into\n// the read buffer, and will cause it to emit 'readable' if necessary.\n//\n// This way, back-pressure is actually determined by the reading side,\n// since _read has to be called to start processing a new chunk.  However,\n// a pathological inflate type of transform can cause excessive buffering\n// here.  For example, imagine a stream where every byte of input is\n// interpreted as an integer from 0-255, and then results in that many\n// bytes of output.  Writing the 4 bytes {ff,ff,ff,ff} would result in\n// 1kb of data being output.  In this case, you could write a very small\n// amount of input, and end up with a very large amount of output.  In\n// such a pathological inflating mechanism, there'd be no way to tell\n// the system to stop doing the transform.  A single 4MB write could\n// cause the system to run out of memory.\n//\n// However, even in such a pathological case, only a single written chunk\n// would be consumed, and then the rest would wait (un-transformed) until\n// the results of the previous transformed chunk were consumed.\n\n'use strict';\n\nmodule.exports = Transform;\nvar _require$codes = require('../errors').codes,\n  ERR_METHOD_NOT_IMPLEMENTED = _require$codes.ERR_METHOD_NOT_IMPLEMENTED,\n  ERR_MULTIPLE_CALLBACK = _require$codes.ERR_MULTIPLE_CALLBACK,\n  ERR_TRANSFORM_ALREADY_TRANSFORMING = _require$codes.ERR_TRANSFORM_ALREADY_TRANSFORMING,\n  ERR_TRANSFORM_WITH_LENGTH_0 = _require$codes.ERR_TRANSFORM_WITH_LENGTH_0;\nvar Duplex = require('./_stream_duplex');\nrequire('inherits')(Transform, Duplex);\nfunction afterTransform(er, data) {\n  var ts = this._transformState;\n  ts.transforming = false;\n  var cb = ts.writecb;\n  if (cb === null) {\n    return this.emit('error', new ERR_MULTIPLE_CALLBACK());\n  }\n  ts.writechunk = null;\n  ts.writecb = null;\n  if (data != null)\n    // single equals check for both `null` and `undefined`\n    this.push(data);\n  cb(er);\n  var rs = this._readableState;\n  rs.reading = false;\n  if (rs.needReadable || rs.length < rs.highWaterMark) {\n    this._read(rs.highWaterMark);\n  }\n}\nfunction Transform(options) {\n  if (!(this instanceof Transform)) return new Transform(options);\n  Duplex.call(this, options);\n  this._transformState = {\n    afterTransform: afterTransform.bind(this),\n    needTransform: false,\n    transforming: false,\n    writecb: null,\n    writechunk: null,\n    writeencoding: null\n  };\n\n  // start out asking for a readable event once data is transformed.\n  this._readableState.needReadable = true;\n\n  // we have implemented the _read method, and done the other things\n  // that Readable wants before the first _read call, so unset the\n  // sync guard flag.\n  this._readableState.sync = false;\n  if (options) {\n    if (typeof options.transform === 'function') this._transform = options.transform;\n    if (typeof options.flush === 'function') this._flush = options.flush;\n  }\n\n  // When the writable side finishes, then flush out anything remaining.\n  this.on('prefinish', prefinish);\n}\nfunction prefinish() {\n  var _this = this;\n  if (typeof this._flush === 'function' && !this._readableState.destroyed) {\n    this._flush(function (er, data) {\n      done(_this, er, data);\n    });\n  } else {\n    done(this, null, null);\n  }\n}\nTransform.prototype.push = function (chunk, encoding) {\n  this._transformState.needTransform = false;\n  return Duplex.prototype.push.call(this, chunk, encoding);\n};\n\n// This is the part where you do stuff!\n// override this function in implementation classes.\n// 'chunk' is an input chunk.\n//\n// Call `push(newChunk)` to pass along transformed output\n// to the readable side.  You may call 'push' zero or more times.\n//\n// Call `cb(err)` when you are done with this chunk.  If you pass\n// an error, then that'll put the hurt on the whole operation.  If you\n// never call cb(), then you'll never get another chunk.\nTransform.prototype._transform = function (chunk, encoding, cb) {\n  cb(new ERR_METHOD_NOT_IMPLEMENTED('_transform()'));\n};\nTransform.prototype._write = function (chunk, encoding, cb) {\n  var ts = this._transformState;\n  ts.writecb = cb;\n  ts.writechunk = chunk;\n  ts.writeencoding = encoding;\n  if (!ts.transforming) {\n    var rs = this._readableState;\n    if (ts.needTransform || rs.needReadable || rs.length < rs.highWaterMark) this._read(rs.highWaterMark);\n  }\n};\n\n// Doesn't matter what the args are here.\n// _transform does all the work.\n// That we got here means that the readable side wants more data.\nTransform.prototype._read = function (n) {\n  var ts = this._transformState;\n  if (ts.writechunk !== null && !ts.transforming) {\n    ts.transforming = true;\n    this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);\n  } else {\n    // mark that we need a transform, so that any data that comes in\n    // will get processed, now that we've asked for it.\n    ts.needTransform = true;\n  }\n};\nTransform.prototype._destroy = function (err, cb) {\n  Duplex.prototype._destroy.call(this, err, function (err2) {\n    cb(err2);\n  });\n};\nfunction done(stream, er, data) {\n  if (er) return stream.emit('error', er);\n  if (data != null)\n    // single equals check for both `null` and `undefined`\n    stream.push(data);\n\n  // TODO(BridgeAR): Write a test for these two error cases\n  // if there's nothing in the write buffer, then that means\n  // that nothing more will ever be provided\n  if (stream._writableState.length) throw new ERR_TRANSFORM_WITH_LENGTH_0();\n  if (stream._transformState.transforming) throw new ERR_TRANSFORM_ALREADY_TRANSFORMING();\n  return stream.push(null);\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// a passthrough stream.\n// basically just the most minimal sort of Transform stream.\n// Every written chunk gets output as-is.\n\n'use strict';\n\nmodule.exports = PassThrough;\nvar Transform = require('./_stream_transform');\nrequire('inherits')(PassThrough, Transform);\nfunction PassThrough(options) {\n  if (!(this instanceof PassThrough)) return new PassThrough(options);\n  Transform.call(this, options);\n}\nPassThrough.prototype._transform = function (chunk, encoding, cb) {\n  cb(null, chunk);\n};","// Ported from https://github.com/mafintosh/pump with\n// permission from the author, Mathias Buus (@mafintosh).\n\n'use strict';\n\nvar eos;\nfunction once(callback) {\n  var called = false;\n  return function () {\n    if (called) return;\n    called = true;\n    callback.apply(void 0, arguments);\n  };\n}\nvar _require$codes = require('../../../errors').codes,\n  ERR_MISSING_ARGS = _require$codes.ERR_MISSING_ARGS,\n  ERR_STREAM_DESTROYED = _require$codes.ERR_STREAM_DESTROYED;\nfunction noop(err) {\n  // Rethrow the error if it exists to avoid swallowing it\n  if (err) throw err;\n}\nfunction isRequest(stream) {\n  return stream.setHeader && typeof stream.abort === 'function';\n}\nfunction destroyer(stream, reading, writing, callback) {\n  callback = once(callback);\n  var closed = false;\n  stream.on('close', function () {\n    closed = true;\n  });\n  if (eos === undefined) eos = require('./end-of-stream');\n  eos(stream, {\n    readable: reading,\n    writable: writing\n  }, function (err) {\n    if (err) return callback(err);\n    closed = true;\n    callback();\n  });\n  var destroyed = false;\n  return function (err) {\n    if (closed) return;\n    if (destroyed) return;\n    destroyed = true;\n\n    // request.destroy just do .end - .abort is what we want\n    if (isRequest(stream)) return stream.abort();\n    if (typeof stream.destroy === 'function') return stream.destroy();\n    callback(err || new ERR_STREAM_DESTROYED('pipe'));\n  };\n}\nfunction call(fn) {\n  fn();\n}\nfunction pipe(from, to) {\n  return from.pipe(to);\n}\nfunction popCallback(streams) {\n  if (!streams.length) return noop;\n  if (typeof streams[streams.length - 1] !== 'function') return noop;\n  return streams.pop();\n}\nfunction pipeline() {\n  for (var _len = arguments.length, streams = new Array(_len), _key = 0; _key < _len; _key++) {\n    streams[_key] = arguments[_key];\n  }\n  var callback = popCallback(streams);\n  if (Array.isArray(streams[0])) streams = streams[0];\n  if (streams.length < 2) {\n    throw new ERR_MISSING_ARGS('streams');\n  }\n  var error;\n  var destroys = streams.map(function (stream, i) {\n    var reading = i < streams.length - 1;\n    var writing = i > 0;\n    return destroyer(stream, reading, writing, function (err) {\n      if (!error) error = err;\n      if (err) destroys.forEach(call);\n      if (reading) return;\n      destroys.forEach(call);\n      callback(error);\n    });\n  });\n  return streams.reduce(pipe);\n}\nmodule.exports = pipeline;","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nmodule.exports = Stream;\n\nvar EE = require('events').EventEmitter;\nvar inherits = require('inherits');\n\ninherits(Stream, EE);\nStream.Readable = require('readable-stream/lib/_stream_readable.js');\nStream.Writable = require('readable-stream/lib/_stream_writable.js');\nStream.Duplex = require('readable-stream/lib/_stream_duplex.js');\nStream.Transform = require('readable-stream/lib/_stream_transform.js');\nStream.PassThrough = require('readable-stream/lib/_stream_passthrough.js');\nStream.finished = require('readable-stream/lib/internal/streams/end-of-stream.js')\nStream.pipeline = require('readable-stream/lib/internal/streams/pipeline.js')\n\n// Backwards-compat with node 0.4.x\nStream.Stream = Stream;\n\n\n\n// old-style streams.  Note that the pipe method (the only relevant\n// part of this class) is overridden in the Readable class.\n\nfunction Stream() {\n  EE.call(this);\n}\n\nStream.prototype.pipe = function(dest, options) {\n  var source = this;\n\n  function ondata(chunk) {\n    if (dest.writable) {\n      if (false === dest.write(chunk) && source.pause) {\n        source.pause();\n      }\n    }\n  }\n\n  source.on('data', ondata);\n\n  function ondrain() {\n    if (source.readable && source.resume) {\n      source.resume();\n    }\n  }\n\n  dest.on('drain', ondrain);\n\n  // If the 'end' option is not supplied, dest.end() will be called when\n  // source gets the 'end' or 'close' events.  Only dest.end() once.\n  if (!dest._isStdio && (!options || options.end !== false)) {\n    source.on('end', onend);\n    source.on('close', onclose);\n  }\n\n  var didOnEnd = false;\n  function onend() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    dest.end();\n  }\n\n\n  function onclose() {\n    if (didOnEnd) return;\n    didOnEnd = true;\n\n    if (typeof dest.destroy === 'function') dest.destroy();\n  }\n\n  // don't leave dangling pipes when there are errors.\n  function onerror(er) {\n    cleanup();\n    if (EE.listenerCount(this, 'error') === 0) {\n      throw er; // Unhandled stream error in pipe.\n    }\n  }\n\n  source.on('error', onerror);\n  dest.on('error', onerror);\n\n  // remove all the event listeners that were added.\n  function cleanup() {\n    source.removeListener('data', ondata);\n    dest.removeListener('drain', ondrain);\n\n    source.removeListener('end', onend);\n    source.removeListener('close', onclose);\n\n    source.removeListener('error', onerror);\n    dest.removeListener('error', onerror);\n\n    source.removeListener('end', cleanup);\n    source.removeListener('close', cleanup);\n\n    dest.removeListener('close', cleanup);\n  }\n\n  source.on('end', cleanup);\n  source.on('close', cleanup);\n\n  dest.on('close', cleanup);\n\n  dest.emit('pipe', source);\n\n  // Allow for unix-like usage: A.pipe(B).pipe(C)\n  return dest;\n};\n","import { JSONRPCMessageSchema } from \"../types.js\";\n/**\n * Buffers a continuous stdio stream into discrete JSON-RPC messages.\n */\nexport class ReadBuffer {\n    append(chunk) {\n        this._buffer = this._buffer ? Buffer.concat([this._buffer, chunk]) : chunk;\n    }\n    readMessage() {\n        if (!this._buffer) {\n            return null;\n        }\n        const index = this._buffer.indexOf(\"\\n\");\n        if (index === -1) {\n            return null;\n        }\n        const line = this._buffer.toString(\"utf8\", 0, index).replace(/\\r$/, '');\n        this._buffer = this._buffer.subarray(index + 1);\n        return deserializeMessage(line);\n    }\n    clear() {\n        this._buffer = undefined;\n    }\n}\nexport function deserializeMessage(line) {\n    return JSONRPCMessageSchema.parse(JSON.parse(line));\n}\nexport function serializeMessage(message) {\n    return JSON.stringify(message) + \"\\n\";\n}\n//# sourceMappingURL=stdio.js.map","import spawn from \"cross-spawn\";\nimport process from \"node:process\";\nimport { PassThrough } from \"node:stream\";\nimport { ReadBuffer, serializeMessage } from \"../shared/stdio.js\";\n/**\n * Environment variables to inherit by default, if an environment is not explicitly given.\n */\nexport const DEFAULT_INHERITED_ENV_VARS = process.platform === \"win32\"\n    ? [\n        \"APPDATA\",\n        \"HOMEDRIVE\",\n        \"HOMEPATH\",\n        \"LOCALAPPDATA\",\n        \"PATH\",\n        \"PROCESSOR_ARCHITECTURE\",\n        \"SYSTEMDRIVE\",\n        \"SYSTEMROOT\",\n        \"TEMP\",\n        \"USERNAME\",\n        \"USERPROFILE\",\n        \"PROGRAMFILES\",\n    ]\n    : /* list inspired by the default env inheritance of sudo */\n        [\"HOME\", \"LOGNAME\", \"PATH\", \"SHELL\", \"TERM\", \"USER\"];\n/**\n * Returns a default environment object including only environment variables deemed safe to inherit.\n */\nexport function getDefaultEnvironment() {\n    const env = {};\n    for (const key of DEFAULT_INHERITED_ENV_VARS) {\n        const value = process.env[key];\n        if (value === undefined) {\n            continue;\n        }\n        if (value.startsWith(\"()\")) {\n            // Skip functions, which are a security risk.\n            continue;\n        }\n        env[key] = value;\n    }\n    return env;\n}\n/**\n * Client transport for stdio: this will connect to a server by spawning a process and communicating with it over stdin/stdout.\n *\n * This transport is only available in Node.js environments.\n */\nexport class StdioClientTransport {\n    constructor(server) {\n        this._abortController = new AbortController();\n        this._readBuffer = new ReadBuffer();\n        this._stderrStream = null;\n        this._serverParams = server;\n        if (server.stderr === \"pipe\" || server.stderr === \"overlapped\") {\n            this._stderrStream = new PassThrough();\n        }\n    }\n    /**\n     * Starts the server process and prepares to communicate with it.\n     */\n    async start() {\n        if (this._process) {\n            throw new Error(\"StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.\");\n        }\n        return new Promise((resolve, reject) => {\n            var _a, _b, _c, _d, _e;\n            this._process = spawn(this._serverParams.command, (_a = this._serverParams.args) !== null && _a !== void 0 ? _a : [], {\n                // merge default env with server env because mcp server needs some env vars\n                env: {\n                    ...getDefaultEnvironment(),\n                    ...this._serverParams.env,\n                },\n                stdio: [\"pipe\", \"pipe\", (_b = this._serverParams.stderr) !== null && _b !== void 0 ? _b : \"inherit\"],\n                shell: false,\n                signal: this._abortController.signal,\n                windowsHide: process.platform === \"win32\" && isElectron(),\n                cwd: this._serverParams.cwd,\n            });\n            this._process.on(\"error\", (error) => {\n                var _a, _b;\n                if (error.name === \"AbortError\") {\n                    // Expected when close() is called.\n                    (_a = this.onclose) === null || _a === void 0 ? void 0 : _a.call(this);\n                    return;\n                }\n                reject(error);\n                (_b = this.onerror) === null || _b === void 0 ? void 0 : _b.call(this, error);\n            });\n            this._process.on(\"spawn\", () => {\n                resolve();\n            });\n            this._process.on(\"close\", (_code) => {\n                var _a;\n                this._process = undefined;\n                (_a = this.onclose) === null || _a === void 0 ? void 0 : _a.call(this);\n            });\n            (_c = this._process.stdin) === null || _c === void 0 ? void 0 : _c.on(\"error\", (error) => {\n                var _a;\n                (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n            });\n            (_d = this._process.stdout) === null || _d === void 0 ? void 0 : _d.on(\"data\", (chunk) => {\n                this._readBuffer.append(chunk);\n                this.processReadBuffer();\n            });\n            (_e = this._process.stdout) === null || _e === void 0 ? void 0 : _e.on(\"error\", (error) => {\n                var _a;\n                (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n            });\n            if (this._stderrStream && this._process.stderr) {\n                this._process.stderr.pipe(this._stderrStream);\n            }\n        });\n    }\n    /**\n     * The stderr stream of the child process, if `StdioServerParameters.stderr` was set to \"pipe\" or \"overlapped\".\n     *\n     * If stderr piping was requested, a PassThrough stream is returned _immediately_, allowing callers to\n     * attach listeners before the start method is invoked. This prevents loss of any early\n     * error output emitted by the child process.\n     */\n    get stderr() {\n        var _a, _b;\n        if (this._stderrStream) {\n            return this._stderrStream;\n        }\n        return (_b = (_a = this._process) === null || _a === void 0 ? void 0 : _a.stderr) !== null && _b !== void 0 ? _b : null;\n    }\n    /**\n     * The child process pid spawned by this transport.\n     *\n     * This is only available after the transport has been started.\n     */\n    get pid() {\n        var _a, _b;\n        return (_b = (_a = this._process) === null || _a === void 0 ? void 0 : _a.pid) !== null && _b !== void 0 ? _b : null;\n    }\n    processReadBuffer() {\n        var _a, _b;\n        while (true) {\n            try {\n                const message = this._readBuffer.readMessage();\n                if (message === null) {\n                    break;\n                }\n                (_a = this.onmessage) === null || _a === void 0 ? void 0 : _a.call(this, message);\n            }\n            catch (error) {\n                (_b = this.onerror) === null || _b === void 0 ? void 0 : _b.call(this, error);\n            }\n        }\n    }\n    async close() {\n        this._abortController.abort();\n        this._process = undefined;\n        this._readBuffer.clear();\n    }\n    send(message) {\n        return new Promise((resolve) => {\n            var _a;\n            if (!((_a = this._process) === null || _a === void 0 ? void 0 : _a.stdin)) {\n                throw new Error(\"Not connected\");\n            }\n            const json = serializeMessage(message);\n            if (this._process.stdin.write(json)) {\n                resolve();\n            }\n            else {\n                this._process.stdin.once(\"drain\", resolve);\n            }\n        });\n    }\n}\nfunction isElectron() {\n    return \"type\" in process;\n}\n//# sourceMappingURL=stdio.js.map","class ParseError extends Error {\n  constructor(message, options) {\n    super(message), this.name = \"ParseError\", this.type = options.type, this.field = options.field, this.value = options.value, this.line = options.line;\n  }\n}\nfunction noop(_arg) {\n}\nfunction createParser(callbacks) {\n  if (typeof callbacks == \"function\")\n    throw new TypeError(\n      \"`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?\"\n    );\n  const { onEvent = noop, onError = noop, onRetry = noop, onComment } = callbacks;\n  let incompleteLine = \"\", isFirstChunk = !0, id, data = \"\", eventType = \"\";\n  function feed(newChunk) {\n    const chunk = isFirstChunk ? newChunk.replace(/^\\xEF\\xBB\\xBF/, \"\") : newChunk, [complete, incomplete] = splitLines(`${incompleteLine}${chunk}`);\n    for (const line of complete)\n      parseLine(line);\n    incompleteLine = incomplete, isFirstChunk = !1;\n  }\n  function parseLine(line) {\n    if (line === \"\") {\n      dispatchEvent();\n      return;\n    }\n    if (line.startsWith(\":\")) {\n      onComment && onComment(line.slice(line.startsWith(\": \") ? 2 : 1));\n      return;\n    }\n    const fieldSeparatorIndex = line.indexOf(\":\");\n    if (fieldSeparatorIndex !== -1) {\n      const field = line.slice(0, fieldSeparatorIndex), offset = line[fieldSeparatorIndex + 1] === \" \" ? 2 : 1, value = line.slice(fieldSeparatorIndex + offset);\n      processField(field, value, line);\n      return;\n    }\n    processField(line, \"\", line);\n  }\n  function processField(field, value, line) {\n    switch (field) {\n      case \"event\":\n        eventType = value;\n        break;\n      case \"data\":\n        data = `${data}${value}\n`;\n        break;\n      case \"id\":\n        id = value.includes(\"\\0\") ? void 0 : value;\n        break;\n      case \"retry\":\n        /^\\d+$/.test(value) ? onRetry(parseInt(value, 10)) : onError(\n          new ParseError(`Invalid \\`retry\\` value: \"${value}\"`, {\n            type: \"invalid-retry\",\n            value,\n            line\n          })\n        );\n        break;\n      default:\n        onError(\n          new ParseError(\n            `Unknown field \"${field.length > 20 ? `${field.slice(0, 20)}\\u2026` : field}\"`,\n            { type: \"unknown-field\", field, value, line }\n          )\n        );\n        break;\n    }\n  }\n  function dispatchEvent() {\n    data.length > 0 && onEvent({\n      id,\n      event: eventType || void 0,\n      // If the data buffer's last character is a U+000A LINE FEED (LF) character,\n      // then remove the last character from the data buffer.\n      data: data.endsWith(`\n`) ? data.slice(0, -1) : data\n    }), id = void 0, data = \"\", eventType = \"\";\n  }\n  function reset(options = {}) {\n    incompleteLine && options.consume && parseLine(incompleteLine), isFirstChunk = !0, id = void 0, data = \"\", eventType = \"\", incompleteLine = \"\";\n  }\n  return { feed, reset };\n}\nfunction splitLines(chunk) {\n  const lines = [];\n  let incompleteLine = \"\", searchIndex = 0;\n  for (; searchIndex < chunk.length; ) {\n    const crIndex = chunk.indexOf(\"\\r\", searchIndex), lfIndex = chunk.indexOf(`\n`, searchIndex);\n    let lineEnd = -1;\n    if (crIndex !== -1 && lfIndex !== -1 ? lineEnd = Math.min(crIndex, lfIndex) : crIndex !== -1 ? lineEnd = crIndex : lfIndex !== -1 && (lineEnd = lfIndex), lineEnd === -1) {\n      incompleteLine = chunk.slice(searchIndex);\n      break;\n    } else {\n      const line = chunk.slice(searchIndex, lineEnd);\n      lines.push(line), searchIndex = lineEnd + 1, chunk[searchIndex - 1] === \"\\r\" && chunk[searchIndex] === `\n` && searchIndex++;\n    }\n  }\n  return [lines, incompleteLine];\n}\nexport {\n  ParseError,\n  createParser\n};\n//# sourceMappingURL=index.js.map\n","import { createParser } from \"eventsource-parser\";\nclass ErrorEvent extends Event {\n  /**\n   * Constructs a new `ErrorEvent` instance. This is typically not called directly,\n   * but rather emitted by the `EventSource` object when an error occurs.\n   *\n   * @param type - The type of the event (should be \"error\")\n   * @param errorEventInitDict - Optional properties to include in the error event\n   */\n  constructor(type, errorEventInitDict) {\n    var _a, _b;\n    super(type), this.code = (_a = errorEventInitDict == null ? void 0 : errorEventInitDict.code) != null ? _a : void 0, this.message = (_b = errorEventInitDict == null ? void 0 : errorEventInitDict.message) != null ? _b : void 0;\n  }\n  /**\n   * Node.js \"hides\" the `message` and `code` properties of the `ErrorEvent` instance,\n   * when it is `console.log`'ed. This makes it harder to debug errors. To ease debugging,\n   * we explicitly include the properties in the `inspect` method.\n   *\n   * This is automatically called by Node.js when you `console.log` an instance of this class.\n   *\n   * @param _depth - The current depth\n   * @param options - The options passed to `util.inspect`\n   * @param inspect - The inspect function to use (prevents having to import it from `util`)\n   * @returns A string representation of the error\n   */\n  [Symbol.for(\"nodejs.util.inspect.custom\")](_depth, options, inspect) {\n    return inspect(inspectableError(this), options);\n  }\n  /**\n   * Deno \"hides\" the `message` and `code` properties of the `ErrorEvent` instance,\n   * when it is `console.log`'ed. This makes it harder to debug errors. To ease debugging,\n   * we explicitly include the properties in the `inspect` method.\n   *\n   * This is automatically called by Deno when you `console.log` an instance of this class.\n   *\n   * @param inspect - The inspect function to use (prevents having to import it from `util`)\n   * @param options - The options passed to `Deno.inspect`\n   * @returns A string representation of the error\n   */\n  [Symbol.for(\"Deno.customInspect\")](inspect, options) {\n    return inspect(inspectableError(this), options);\n  }\n}\nfunction syntaxError(message) {\n  const DomException = globalThis.DOMException;\n  return typeof DomException == \"function\" ? new DomException(message, \"SyntaxError\") : new SyntaxError(message);\n}\nfunction flattenError(err) {\n  return err instanceof Error ? \"errors\" in err && Array.isArray(err.errors) ? err.errors.map(flattenError).join(\", \") : \"cause\" in err && err.cause instanceof Error ? `${err}: ${flattenError(err.cause)}` : err.message : `${err}`;\n}\nfunction inspectableError(err) {\n  return {\n    type: err.type,\n    message: err.message,\n    code: err.code,\n    defaultPrevented: err.defaultPrevented,\n    cancelable: err.cancelable,\n    timeStamp: err.timeStamp\n  };\n}\nvar __typeError = (msg) => {\n  throw TypeError(msg);\n}, __accessCheck = (obj, member, msg) => member.has(obj) || __typeError(\"Cannot \" + msg), __privateGet = (obj, member, getter) => (__accessCheck(obj, member, \"read from private field\"), getter ? getter.call(obj) : member.get(obj)), __privateAdd = (obj, member, value) => member.has(obj) ? __typeError(\"Cannot add the same private member more than once\") : member instanceof WeakSet ? member.add(obj) : member.set(obj, value), __privateSet = (obj, member, value, setter) => (__accessCheck(obj, member, \"write to private field\"), member.set(obj, value), value), __privateMethod = (obj, member, method) => (__accessCheck(obj, member, \"access private method\"), method), _readyState, _url, _redirectUrl, _withCredentials, _fetch, _reconnectInterval, _reconnectTimer, _lastEventId, _controller, _parser, _onError, _onMessage, _onOpen, _EventSource_instances, connect_fn, _onFetchResponse, _onFetchError, getRequestOptions_fn, _onEvent, _onRetryChange, failConnection_fn, scheduleReconnect_fn, _reconnect;\nclass EventSource extends EventTarget {\n  constructor(url, eventSourceInitDict) {\n    var _a, _b;\n    super(), __privateAdd(this, _EventSource_instances), this.CONNECTING = 0, this.OPEN = 1, this.CLOSED = 2, __privateAdd(this, _readyState), __privateAdd(this, _url), __privateAdd(this, _redirectUrl), __privateAdd(this, _withCredentials), __privateAdd(this, _fetch), __privateAdd(this, _reconnectInterval), __privateAdd(this, _reconnectTimer), __privateAdd(this, _lastEventId, null), __privateAdd(this, _controller), __privateAdd(this, _parser), __privateAdd(this, _onError, null), __privateAdd(this, _onMessage, null), __privateAdd(this, _onOpen, null), __privateAdd(this, _onFetchResponse, async (response) => {\n      var _a2;\n      __privateGet(this, _parser).reset();\n      const { body, redirected, status, headers } = response;\n      if (status === 204) {\n        __privateMethod(this, _EventSource_instances, failConnection_fn).call(this, \"Server sent HTTP 204, not reconnecting\", 204), this.close();\n        return;\n      }\n      if (redirected ? __privateSet(this, _redirectUrl, new URL(response.url)) : __privateSet(this, _redirectUrl, void 0), status !== 200) {\n        __privateMethod(this, _EventSource_instances, failConnection_fn).call(this, `Non-200 status code (${status})`, status);\n        return;\n      }\n      if (!(headers.get(\"content-type\") || \"\").startsWith(\"text/event-stream\")) {\n        __privateMethod(this, _EventSource_instances, failConnection_fn).call(this, 'Invalid content type, expected \"text/event-stream\"', status);\n        return;\n      }\n      if (__privateGet(this, _readyState) === this.CLOSED)\n        return;\n      __privateSet(this, _readyState, this.OPEN);\n      const openEvent = new Event(\"open\");\n      if ((_a2 = __privateGet(this, _onOpen)) == null || _a2.call(this, openEvent), this.dispatchEvent(openEvent), typeof body != \"object\" || !body || !(\"getReader\" in body)) {\n        __privateMethod(this, _EventSource_instances, failConnection_fn).call(this, \"Invalid response body, expected a web ReadableStream\", status), this.close();\n        return;\n      }\n      const decoder = new TextDecoder(), reader = body.getReader();\n      let open = !0;\n      do {\n        const { done, value } = await reader.read();\n        value && __privateGet(this, _parser).feed(decoder.decode(value, { stream: !done })), done && (open = !1, __privateGet(this, _parser).reset(), __privateMethod(this, _EventSource_instances, scheduleReconnect_fn).call(this));\n      } while (open);\n    }), __privateAdd(this, _onFetchError, (err) => {\n      __privateSet(this, _controller, void 0), !(err.name === \"AbortError\" || err.type === \"aborted\") && __privateMethod(this, _EventSource_instances, scheduleReconnect_fn).call(this, flattenError(err));\n    }), __privateAdd(this, _onEvent, (event) => {\n      typeof event.id == \"string\" && __privateSet(this, _lastEventId, event.id);\n      const messageEvent = new MessageEvent(event.event || \"message\", {\n        data: event.data,\n        origin: __privateGet(this, _redirectUrl) ? __privateGet(this, _redirectUrl).origin : __privateGet(this, _url).origin,\n        lastEventId: event.id || \"\"\n      });\n      __privateGet(this, _onMessage) && (!event.event || event.event === \"message\") && __privateGet(this, _onMessage).call(this, messageEvent), this.dispatchEvent(messageEvent);\n    }), __privateAdd(this, _onRetryChange, (value) => {\n      __privateSet(this, _reconnectInterval, value);\n    }), __privateAdd(this, _reconnect, () => {\n      __privateSet(this, _reconnectTimer, void 0), __privateGet(this, _readyState) === this.CONNECTING && __privateMethod(this, _EventSource_instances, connect_fn).call(this);\n    });\n    try {\n      if (url instanceof URL)\n        __privateSet(this, _url, url);\n      else if (typeof url == \"string\")\n        __privateSet(this, _url, new URL(url, getBaseURL()));\n      else\n        throw new Error(\"Invalid URL\");\n    } catch {\n      throw syntaxError(\"An invalid or illegal string was specified\");\n    }\n    __privateSet(this, _parser, createParser({\n      onEvent: __privateGet(this, _onEvent),\n      onRetry: __privateGet(this, _onRetryChange)\n    })), __privateSet(this, _readyState, this.CONNECTING), __privateSet(this, _reconnectInterval, 3e3), __privateSet(this, _fetch, (_a = eventSourceInitDict == null ? void 0 : eventSourceInitDict.fetch) != null ? _a : globalThis.fetch), __privateSet(this, _withCredentials, (_b = eventSourceInitDict == null ? void 0 : eventSourceInitDict.withCredentials) != null ? _b : !1), __privateMethod(this, _EventSource_instances, connect_fn).call(this);\n  }\n  /**\n   * Returns the state of this EventSource object's connection. It can have the values described below.\n   *\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/EventSource/readyState)\n   *\n   * Note: typed as `number` instead of `0 | 1 | 2` for compatibility with the `EventSource` interface,\n   * defined in the TypeScript `dom` library.\n   *\n   * @public\n   */\n  get readyState() {\n    return __privateGet(this, _readyState);\n  }\n  /**\n   * Returns the URL providing the event stream.\n   *\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/EventSource/url)\n   *\n   * @public\n   */\n  get url() {\n    return __privateGet(this, _url).href;\n  }\n  /**\n   * Returns true if the credentials mode for connection requests to the URL providing the event stream is set to \"include\", and false otherwise.\n   *\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/EventSource/withCredentials)\n   */\n  get withCredentials() {\n    return __privateGet(this, _withCredentials);\n  }\n  /** [MDN Reference](https://developer.mozilla.org/docs/Web/API/EventSource/error_event) */\n  get onerror() {\n    return __privateGet(this, _onError);\n  }\n  set onerror(value) {\n    __privateSet(this, _onError, value);\n  }\n  /** [MDN Reference](https://developer.mozilla.org/docs/Web/API/EventSource/message_event) */\n  get onmessage() {\n    return __privateGet(this, _onMessage);\n  }\n  set onmessage(value) {\n    __privateSet(this, _onMessage, value);\n  }\n  /** [MDN Reference](https://developer.mozilla.org/docs/Web/API/EventSource/open_event) */\n  get onopen() {\n    return __privateGet(this, _onOpen);\n  }\n  set onopen(value) {\n    __privateSet(this, _onOpen, value);\n  }\n  addEventListener(type, listener, options) {\n    const listen = listener;\n    super.addEventListener(type, listen, options);\n  }\n  removeEventListener(type, listener, options) {\n    const listen = listener;\n    super.removeEventListener(type, listen, options);\n  }\n  /**\n   * Aborts any instances of the fetch algorithm started for this EventSource object, and sets the readyState attribute to CLOSED.\n   *\n   * [MDN Reference](https://developer.mozilla.org/docs/Web/API/EventSource/close)\n   *\n   * @public\n   */\n  close() {\n    __privateGet(this, _reconnectTimer) && clearTimeout(__privateGet(this, _reconnectTimer)), __privateGet(this, _readyState) !== this.CLOSED && (__privateGet(this, _controller) && __privateGet(this, _controller).abort(), __privateSet(this, _readyState, this.CLOSED), __privateSet(this, _controller, void 0));\n  }\n}\n_readyState = /* @__PURE__ */ new WeakMap(), _url = /* @__PURE__ */ new WeakMap(), _redirectUrl = /* @__PURE__ */ new WeakMap(), _withCredentials = /* @__PURE__ */ new WeakMap(), _fetch = /* @__PURE__ */ new WeakMap(), _reconnectInterval = /* @__PURE__ */ new WeakMap(), _reconnectTimer = /* @__PURE__ */ new WeakMap(), _lastEventId = /* @__PURE__ */ new WeakMap(), _controller = /* @__PURE__ */ new WeakMap(), _parser = /* @__PURE__ */ new WeakMap(), _onError = /* @__PURE__ */ new WeakMap(), _onMessage = /* @__PURE__ */ new WeakMap(), _onOpen = /* @__PURE__ */ new WeakMap(), _EventSource_instances = /* @__PURE__ */ new WeakSet(), /**\n* Connect to the given URL and start receiving events\n*\n* @internal\n*/\nconnect_fn = function() {\n  __privateSet(this, _readyState, this.CONNECTING), __privateSet(this, _controller, new AbortController()), __privateGet(this, _fetch)(__privateGet(this, _url), __privateMethod(this, _EventSource_instances, getRequestOptions_fn).call(this)).then(__privateGet(this, _onFetchResponse)).catch(__privateGet(this, _onFetchError));\n}, _onFetchResponse = /* @__PURE__ */ new WeakMap(), _onFetchError = /* @__PURE__ */ new WeakMap(), /**\n* Get request options for the `fetch()` request\n*\n* @returns The request options\n* @internal\n*/\ngetRequestOptions_fn = function() {\n  var _a;\n  const init = {\n    // [spec] Let `corsAttributeState` be `Anonymous`\n    // [spec] will have their mode set to \"cors\"\n    mode: \"cors\",\n    redirect: \"follow\",\n    headers: { Accept: \"text/event-stream\", ...__privateGet(this, _lastEventId) ? { \"Last-Event-ID\": __privateGet(this, _lastEventId) } : void 0 },\n    cache: \"no-store\",\n    signal: (_a = __privateGet(this, _controller)) == null ? void 0 : _a.signal\n  };\n  return \"window\" in globalThis && (init.credentials = this.withCredentials ? \"include\" : \"same-origin\"), init;\n}, _onEvent = /* @__PURE__ */ new WeakMap(), _onRetryChange = /* @__PURE__ */ new WeakMap(), /**\n* Handles the process referred to in the EventSource specification as \"failing a connection\".\n*\n* @param error - The error causing the connection to fail\n* @param code - The HTTP status code, if available\n* @internal\n*/\nfailConnection_fn = function(message, code) {\n  var _a;\n  __privateGet(this, _readyState) !== this.CLOSED && __privateSet(this, _readyState, this.CLOSED);\n  const errorEvent = new ErrorEvent(\"error\", { code, message });\n  (_a = __privateGet(this, _onError)) == null || _a.call(this, errorEvent), this.dispatchEvent(errorEvent);\n}, /**\n* Schedules a reconnection attempt against the EventSource endpoint.\n*\n* @param message - The error causing the connection to fail\n* @param code - The HTTP status code, if available\n* @internal\n*/\nscheduleReconnect_fn = function(message, code) {\n  var _a;\n  if (__privateGet(this, _readyState) === this.CLOSED)\n    return;\n  __privateSet(this, _readyState, this.CONNECTING);\n  const errorEvent = new ErrorEvent(\"error\", { code, message });\n  (_a = __privateGet(this, _onError)) == null || _a.call(this, errorEvent), this.dispatchEvent(errorEvent), __privateSet(this, _reconnectTimer, setTimeout(__privateGet(this, _reconnect), __privateGet(this, _reconnectInterval)));\n}, _reconnect = /* @__PURE__ */ new WeakMap(), /**\n* ReadyState representing an EventSource currently trying to connect\n*\n* @public\n*/\nEventSource.CONNECTING = 0, /**\n* ReadyState representing an EventSource connection that is open (eg connected)\n*\n* @public\n*/\nEventSource.OPEN = 1, /**\n* ReadyState representing an EventSource connection that is closed (eg disconnected)\n*\n* @public\n*/\nEventSource.CLOSED = 2;\nfunction getBaseURL() {\n  const doc = \"document\" in globalThis ? globalThis.document : void 0;\n  return doc && typeof doc == \"object\" && \"baseURI\" in doc && typeof doc.baseURI == \"string\" ? doc.baseURI : void 0;\n}\nexport {\n  ErrorEvent,\n  EventSource\n};\n//# sourceMappingURL=index.js.map\n","let crypto;\ncrypto = globalThis.crypto; // web browsers\n/**\n * Creates an array of length `size` of random bytes\n * @param size\n * @returns Array of random ints (0 to 255)\n */\nasync function getRandomValues(size) {\n    return (await crypto).getRandomValues(new Uint8Array(size));\n}\n/** Generate cryptographically strong random string\n * @param size The desired length of the string\n * @returns The random string\n */\nasync function random(size) {\n    const mask = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~\";\n    let result = \"\";\n    const randomUints = await getRandomValues(size);\n    for (let i = 0; i < size; i++) {\n        // cap the value of the randomIndex to mask.length - 1\n        const randomIndex = randomUints[i] % mask.length;\n        result += mask[randomIndex];\n    }\n    return result;\n}\n/** Generate a PKCE challenge verifier\n * @param length Length of the verifier\n * @returns A random verifier `length` characters long\n */\nasync function generateVerifier(length) {\n    return await random(length);\n}\n/** Generate a PKCE code challenge from a code verifier\n * @param code_verifier\n * @returns The base64 url encoded code challenge\n */\nexport async function generateChallenge(code_verifier) {\n    const buffer = await (await crypto).subtle.digest(\"SHA-256\", new TextEncoder().encode(code_verifier));\n    // Generate base64url string\n    // btoa is deprecated in Node.js but is used here for web browser compatibility\n    // (which has no good replacement yet, see also https://github.com/whatwg/html/issues/6811)\n    return btoa(String.fromCharCode(...new Uint8Array(buffer)))\n        .replace(/\\//g, '_')\n        .replace(/\\+/g, '-')\n        .replace(/=/g, '');\n}\n/** Generate a PKCE challenge pair\n * @param length Length of the verifer (between 43-128). Defaults to 43.\n * @returns PKCE challenge pair\n */\nexport default async function pkceChallenge(length) {\n    if (!length)\n        length = 43;\n    if (length < 43 || length > 128) {\n        throw `Expected a length between 43 and 128. Received ${length}.`;\n    }\n    const verifier = await generateVerifier(length);\n    const challenge = await generateChallenge(verifier);\n    return {\n        code_verifier: verifier,\n        code_challenge: challenge,\n    };\n}\n/** Verify that a code_verifier produces the expected code challenge\n * @param code_verifier\n * @param expectedChallenge The code challenge to verify\n * @returns True if challenges are equal. False otherwise.\n */\nexport async function verifyChallenge(code_verifier, expectedChallenge) {\n    const actualChallenge = await generateChallenge(code_verifier);\n    return actualChallenge === expectedChallenge;\n}\n","import { z } from \"zod\";\n/**\n * RFC 9728 OAuth Protected Resource Metadata\n */\nexport const OAuthProtectedResourceMetadataSchema = z\n    .object({\n    resource: z.string().url(),\n    authorization_servers: z.array(z.string().url()).optional(),\n    jwks_uri: z.string().url().optional(),\n    scopes_supported: z.array(z.string()).optional(),\n    bearer_methods_supported: z.array(z.string()).optional(),\n    resource_signing_alg_values_supported: z.array(z.string()).optional(),\n    resource_name: z.string().optional(),\n    resource_documentation: z.string().optional(),\n    resource_policy_uri: z.string().url().optional(),\n    resource_tos_uri: z.string().url().optional(),\n    tls_client_certificate_bound_access_tokens: z.boolean().optional(),\n    authorization_details_types_supported: z.array(z.string()).optional(),\n    dpop_signing_alg_values_supported: z.array(z.string()).optional(),\n    dpop_bound_access_tokens_required: z.boolean().optional(),\n})\n    .passthrough();\n/**\n * RFC 8414 OAuth 2.0 Authorization Server Metadata\n */\nexport const OAuthMetadataSchema = z\n    .object({\n    issuer: z.string(),\n    authorization_endpoint: z.string(),\n    token_endpoint: z.string(),\n    registration_endpoint: z.string().optional(),\n    scopes_supported: z.array(z.string()).optional(),\n    response_types_supported: z.array(z.string()),\n    response_modes_supported: z.array(z.string()).optional(),\n    grant_types_supported: z.array(z.string()).optional(),\n    token_endpoint_auth_methods_supported: z.array(z.string()).optional(),\n    token_endpoint_auth_signing_alg_values_supported: z\n        .array(z.string())\n        .optional(),\n    service_documentation: z.string().optional(),\n    revocation_endpoint: z.string().optional(),\n    revocation_endpoint_auth_methods_supported: z.array(z.string()).optional(),\n    revocation_endpoint_auth_signing_alg_values_supported: z\n        .array(z.string())\n        .optional(),\n    introspection_endpoint: z.string().optional(),\n    introspection_endpoint_auth_methods_supported: z\n        .array(z.string())\n        .optional(),\n    introspection_endpoint_auth_signing_alg_values_supported: z\n        .array(z.string())\n        .optional(),\n    code_challenge_methods_supported: z.array(z.string()).optional(),\n})\n    .passthrough();\n/**\n * OAuth 2.1 token response\n */\nexport const OAuthTokensSchema = z\n    .object({\n    access_token: z.string(),\n    id_token: z.string().optional(), // Optional for OAuth 2.1, but necessary in OpenID Connect\n    token_type: z.string(),\n    expires_in: z.number().optional(),\n    scope: z.string().optional(),\n    refresh_token: z.string().optional(),\n})\n    .strip();\n/**\n * OAuth 2.1 error response\n */\nexport const OAuthErrorResponseSchema = z\n    .object({\n    error: z.string(),\n    error_description: z.string().optional(),\n    error_uri: z.string().optional(),\n});\n/**\n * RFC 7591 OAuth 2.0 Dynamic Client Registration metadata\n */\nexport const OAuthClientMetadataSchema = z.object({\n    redirect_uris: z.array(z.string()).refine((uris) => uris.every((uri) => URL.canParse(uri)), { message: \"redirect_uris must contain valid URLs\" }),\n    token_endpoint_auth_method: z.string().optional(),\n    grant_types: z.array(z.string()).optional(),\n    response_types: z.array(z.string()).optional(),\n    client_name: z.string().optional(),\n    client_uri: z.string().optional(),\n    logo_uri: z.string().optional(),\n    scope: z.string().optional(),\n    contacts: z.array(z.string()).optional(),\n    tos_uri: z.string().optional(),\n    policy_uri: z.string().optional(),\n    jwks_uri: z.string().optional(),\n    jwks: z.any().optional(),\n    software_id: z.string().optional(),\n    software_version: z.string().optional(),\n    software_statement: z.string().optional(),\n}).strip();\n/**\n * RFC 7591 OAuth 2.0 Dynamic Client Registration client information\n */\nexport const OAuthClientInformationSchema = z.object({\n    client_id: z.string(),\n    client_secret: z.string().optional(),\n    client_id_issued_at: z.number().optional(),\n    client_secret_expires_at: z.number().optional(),\n}).strip();\n/**\n * RFC 7591 OAuth 2.0 Dynamic Client Registration full response (client information plus metadata)\n */\nexport const OAuthClientInformationFullSchema = OAuthClientMetadataSchema.merge(OAuthClientInformationSchema);\n/**\n * RFC 7591 OAuth 2.0 Dynamic Client Registration error response\n */\nexport const OAuthClientRegistrationErrorSchema = z.object({\n    error: z.string(),\n    error_description: z.string().optional(),\n}).strip();\n/**\n * RFC 7009 OAuth 2.0 Token Revocation request\n */\nexport const OAuthTokenRevocationRequestSchema = z.object({\n    token: z.string(),\n    token_type_hint: z.string().optional(),\n}).strip();\n//# sourceMappingURL=auth.js.map","/**\n * Utilities for handling OAuth resource URIs.\n */\n/**\n * Converts a server URL to a resource URL by removing the fragment.\n * RFC 8707 section 2 states that resource URIs \"MUST NOT include a fragment component\".\n * Keeps everything else unchanged (scheme, domain, port, path, query).\n */\nexport function resourceUrlFromServerUrl(url) {\n    const resourceURL = typeof url === \"string\" ? new URL(url) : new URL(url.href);\n    resourceURL.hash = ''; // Remove fragment\n    return resourceURL;\n}\n/**\n * Checks if a requested resource URL matches a configured resource URL.\n * A requested resource matches if it has the same scheme, domain, port,\n * and its path starts with the configured resource's path.\n *\n * @param requestedResource The resource URL being requested\n * @param configuredResource The resource URL that has been configured\n * @returns true if the requested resource matches the configured resource, false otherwise\n */\nexport function checkResourceAllowed({ requestedResource, configuredResource }) {\n    const requested = typeof requestedResource === \"string\" ? new URL(requestedResource) : new URL(requestedResource.href);\n    const configured = typeof configuredResource === \"string\" ? new URL(configuredResource) : new URL(configuredResource.href);\n    // Compare the origin (scheme, domain, and port)\n    if (requested.origin !== configured.origin) {\n        return false;\n    }\n    // Handle cases like requested=/foo and configured=/foo/\n    if (requested.pathname.length < configured.pathname.length) {\n        return false;\n    }\n    // Check if the requested path starts with the configured path\n    // Ensure both paths end with / for proper comparison\n    // This ensures that if we have paths like \"/api\" and \"/api/users\",\n    // we properly detect that \"/api/users\" is a subpath of \"/api\"\n    // By adding a trailing slash if missing, we avoid false positives\n    // where paths like \"/api123\" would incorrectly match \"/api\"\n    const requestedPath = requested.pathname.endsWith('/') ? requested.pathname : requested.pathname + '/';\n    const configuredPath = configured.pathname.endsWith('/') ? configured.pathname : configured.pathname + '/';\n    return requestedPath.startsWith(configuredPath);\n}\n//# sourceMappingURL=auth-utils.js.map","/**\n * Base class for all OAuth errors\n */\nexport class OAuthError extends Error {\n    constructor(message, errorUri) {\n        super(message);\n        this.errorUri = errorUri;\n        this.name = this.constructor.name;\n    }\n    /**\n     * Converts the error to a standard OAuth error response object\n     */\n    toResponseObject() {\n        const response = {\n            error: this.errorCode,\n            error_description: this.message\n        };\n        if (this.errorUri) {\n            response.error_uri = this.errorUri;\n        }\n        return response;\n    }\n    get errorCode() {\n        return this.constructor.errorCode;\n    }\n}\n/**\n * Invalid request error - The request is missing a required parameter,\n * includes an invalid parameter value, includes a parameter more than once,\n * or is otherwise malformed.\n */\nexport class InvalidRequestError extends OAuthError {\n}\nInvalidRequestError.errorCode = \"invalid_request\";\n/**\n * Invalid client error - Client authentication failed (e.g., unknown client, no client\n * authentication included, or unsupported authentication method).\n */\nexport class InvalidClientError extends OAuthError {\n}\nInvalidClientError.errorCode = \"invalid_client\";\n/**\n * Invalid grant error - The provided authorization grant or refresh token is\n * invalid, expired, revoked, does not match the redirection URI used in the\n * authorization request, or was issued to another client.\n */\nexport class InvalidGrantError extends OAuthError {\n}\nInvalidGrantError.errorCode = \"invalid_grant\";\n/**\n * Unauthorized client error - The authenticated client is not authorized to use\n * this authorization grant type.\n */\nexport class UnauthorizedClientError extends OAuthError {\n}\nUnauthorizedClientError.errorCode = \"unauthorized_client\";\n/**\n * Unsupported grant type error - The authorization grant type is not supported\n * by the authorization server.\n */\nexport class UnsupportedGrantTypeError extends OAuthError {\n}\nUnsupportedGrantTypeError.errorCode = \"unsupported_grant_type\";\n/**\n * Invalid scope error - The requested scope is invalid, unknown, malformed, or\n * exceeds the scope granted by the resource owner.\n */\nexport class InvalidScopeError extends OAuthError {\n}\nInvalidScopeError.errorCode = \"invalid_scope\";\n/**\n * Access denied error - The resource owner or authorization server denied the request.\n */\nexport class AccessDeniedError extends OAuthError {\n}\nAccessDeniedError.errorCode = \"access_denied\";\n/**\n * Server error - The authorization server encountered an unexpected condition\n * that prevented it from fulfilling the request.\n */\nexport class ServerError extends OAuthError {\n}\nServerError.errorCode = \"server_error\";\n/**\n * Temporarily unavailable error - The authorization server is currently unable to\n * handle the request due to a temporary overloading or maintenance of the server.\n */\nexport class TemporarilyUnavailableError extends OAuthError {\n}\nTemporarilyUnavailableError.errorCode = \"temporarily_unavailable\";\n/**\n * Unsupported response type error - The authorization server does not support\n * obtaining an authorization code using this method.\n */\nexport class UnsupportedResponseTypeError extends OAuthError {\n}\nUnsupportedResponseTypeError.errorCode = \"unsupported_response_type\";\n/**\n * Unsupported token type error - The authorization server does not support\n * the requested token type.\n */\nexport class UnsupportedTokenTypeError extends OAuthError {\n}\nUnsupportedTokenTypeError.errorCode = \"unsupported_token_type\";\n/**\n * Invalid token error - The access token provided is expired, revoked, malformed,\n * or invalid for other reasons.\n */\nexport class InvalidTokenError extends OAuthError {\n}\nInvalidTokenError.errorCode = \"invalid_token\";\n/**\n * Method not allowed error - The HTTP method used is not allowed for this endpoint.\n * (Custom, non-standard error)\n */\nexport class MethodNotAllowedError extends OAuthError {\n}\nMethodNotAllowedError.errorCode = \"method_not_allowed\";\n/**\n * Too many requests error - Rate limit exceeded.\n * (Custom, non-standard error based on RFC 6585)\n */\nexport class TooManyRequestsError extends OAuthError {\n}\nTooManyRequestsError.errorCode = \"too_many_requests\";\n/**\n * Invalid client metadata error - The client metadata is invalid.\n * (Custom error for dynamic client registration - RFC 7591)\n */\nexport class InvalidClientMetadataError extends OAuthError {\n}\nInvalidClientMetadataError.errorCode = \"invalid_client_metadata\";\n/**\n * Insufficient scope error - The request requires higher privileges than provided by the access token.\n */\nexport class InsufficientScopeError extends OAuthError {\n}\nInsufficientScopeError.errorCode = \"insufficient_scope\";\n/**\n * A utility class for defining one-off error codes\n */\nexport class CustomOAuthError extends OAuthError {\n    constructor(customErrorCode, message, errorUri) {\n        super(message, errorUri);\n        this.customErrorCode = customErrorCode;\n    }\n    get errorCode() {\n        return this.customErrorCode;\n    }\n}\n/**\n * A full list of all OAuthErrors, enabling parsing from error responses\n */\nexport const OAUTH_ERRORS = {\n    [InvalidRequestError.errorCode]: InvalidRequestError,\n    [InvalidClientError.errorCode]: InvalidClientError,\n    [InvalidGrantError.errorCode]: InvalidGrantError,\n    [UnauthorizedClientError.errorCode]: UnauthorizedClientError,\n    [UnsupportedGrantTypeError.errorCode]: UnsupportedGrantTypeError,\n    [InvalidScopeError.errorCode]: InvalidScopeError,\n    [AccessDeniedError.errorCode]: AccessDeniedError,\n    [ServerError.errorCode]: ServerError,\n    [TemporarilyUnavailableError.errorCode]: TemporarilyUnavailableError,\n    [UnsupportedResponseTypeError.errorCode]: UnsupportedResponseTypeError,\n    [UnsupportedTokenTypeError.errorCode]: UnsupportedTokenTypeError,\n    [InvalidTokenError.errorCode]: InvalidTokenError,\n    [MethodNotAllowedError.errorCode]: MethodNotAllowedError,\n    [TooManyRequestsError.errorCode]: TooManyRequestsError,\n    [InvalidClientMetadataError.errorCode]: InvalidClientMetadataError,\n    [InsufficientScopeError.errorCode]: InsufficientScopeError,\n};\n//# sourceMappingURL=errors.js.map","import pkceChallenge from \"pkce-challenge\";\nimport { LATEST_PROTOCOL_VERSION } from \"../types.js\";\nimport { OAuthErrorResponseSchema } from \"../shared/auth.js\";\nimport { OAuthClientInformationFullSchema, OAuthMetadataSchema, OAuthProtectedResourceMetadataSchema, OAuthTokensSchema } from \"../shared/auth.js\";\nimport { checkResourceAllowed, resourceUrlFromServerUrl } from \"../shared/auth-utils.js\";\nimport { InvalidClientError, InvalidGrantError, OAUTH_ERRORS, OAuthError, ServerError, UnauthorizedClientError } from \"../server/auth/errors.js\";\nexport class UnauthorizedError extends Error {\n    constructor(message) {\n        super(message !== null && message !== void 0 ? message : \"Unauthorized\");\n    }\n}\n/**\n * Determines the best client authentication method to use based on server support and client configuration.\n *\n * Priority order (highest to lowest):\n * 1. client_secret_basic (if client secret is available)\n * 2. client_secret_post (if client secret is available)\n * 3. none (for public clients)\n *\n * @param clientInformation - OAuth client information containing credentials\n * @param supportedMethods - Authentication methods supported by the authorization server\n * @returns The selected authentication method\n */\nfunction selectClientAuthMethod(clientInformation, supportedMethods) {\n    const hasClientSecret = clientInformation.client_secret !== undefined;\n    // If server doesn't specify supported methods, use RFC 6749 defaults\n    if (supportedMethods.length === 0) {\n        return hasClientSecret ? \"client_secret_post\" : \"none\";\n    }\n    // Try methods in priority order (most secure first)\n    if (hasClientSecret && supportedMethods.includes(\"client_secret_basic\")) {\n        return \"client_secret_basic\";\n    }\n    if (hasClientSecret && supportedMethods.includes(\"client_secret_post\")) {\n        return \"client_secret_post\";\n    }\n    if (supportedMethods.includes(\"none\")) {\n        return \"none\";\n    }\n    // Fallback: use what we have\n    return hasClientSecret ? \"client_secret_post\" : \"none\";\n}\n/**\n * Applies client authentication to the request based on the specified method.\n *\n * Implements OAuth 2.1 client authentication methods:\n * - client_secret_basic: HTTP Basic authentication (RFC 6749 Section 2.3.1)\n * - client_secret_post: Credentials in request body (RFC 6749 Section 2.3.1)\n * - none: Public client authentication (RFC 6749 Section 2.1)\n *\n * @param method - The authentication method to use\n * @param clientInformation - OAuth client information containing credentials\n * @param headers - HTTP headers object to modify\n * @param params - URL search parameters to modify\n * @throws {Error} When required credentials are missing\n */\nfunction applyClientAuthentication(method, clientInformation, headers, params) {\n    const { client_id, client_secret } = clientInformation;\n    switch (method) {\n        case \"client_secret_basic\":\n            applyBasicAuth(client_id, client_secret, headers);\n            return;\n        case \"client_secret_post\":\n            applyPostAuth(client_id, client_secret, params);\n            return;\n        case \"none\":\n            applyPublicAuth(client_id, params);\n            return;\n        default:\n            throw new Error(`Unsupported client authentication method: ${method}`);\n    }\n}\n/**\n * Applies HTTP Basic authentication (RFC 6749 Section 2.3.1)\n */\nfunction applyBasicAuth(clientId, clientSecret, headers) {\n    if (!clientSecret) {\n        throw new Error(\"client_secret_basic authentication requires a client_secret\");\n    }\n    const credentials = btoa(`${clientId}:${clientSecret}`);\n    headers.set(\"Authorization\", `Basic ${credentials}`);\n}\n/**\n * Applies POST body authentication (RFC 6749 Section 2.3.1)\n */\nfunction applyPostAuth(clientId, clientSecret, params) {\n    params.set(\"client_id\", clientId);\n    if (clientSecret) {\n        params.set(\"client_secret\", clientSecret);\n    }\n}\n/**\n * Applies public client authentication (RFC 6749 Section 2.1)\n */\nfunction applyPublicAuth(clientId, params) {\n    params.set(\"client_id\", clientId);\n}\n/**\n * Parses an OAuth error response from a string or Response object.\n *\n * If the input is a standard OAuth2.0 error response, it will be parsed according to the spec\n * and an instance of the appropriate OAuthError subclass will be returned.\n * If parsing fails, it falls back to a generic ServerError that includes\n * the response status (if available) and original content.\n *\n * @param input - A Response object or string containing the error response\n * @returns A Promise that resolves to an OAuthError instance\n */\nexport async function parseErrorResponse(input) {\n    const statusCode = input instanceof Response ? input.status : undefined;\n    const body = input instanceof Response ? await input.text() : input;\n    try {\n        const result = OAuthErrorResponseSchema.parse(JSON.parse(body));\n        const { error, error_description, error_uri } = result;\n        const errorClass = OAUTH_ERRORS[error] || ServerError;\n        return new errorClass(error_description || '', error_uri);\n    }\n    catch (error) {\n        // Not a valid OAuth error response, but try to inform the user of the raw data anyway\n        const errorMessage = `${statusCode ? `HTTP ${statusCode}: ` : ''}Invalid OAuth error response: ${error}. Raw body: ${body}`;\n        return new ServerError(errorMessage);\n    }\n}\n/**\n * Orchestrates the full auth flow with a server.\n *\n * This can be used as a single entry point for all authorization functionality,\n * instead of linking together the other lower-level functions in this module.\n */\nexport async function auth(provider, options) {\n    var _a, _b;\n    try {\n        return await authInternal(provider, options);\n    }\n    catch (error) {\n        // Handle recoverable error types by invalidating credentials and retrying\n        if (error instanceof InvalidClientError || error instanceof UnauthorizedClientError) {\n            await ((_a = provider.invalidateCredentials) === null || _a === void 0 ? void 0 : _a.call(provider, 'all'));\n            return await authInternal(provider, options);\n        }\n        else if (error instanceof InvalidGrantError) {\n            await ((_b = provider.invalidateCredentials) === null || _b === void 0 ? void 0 : _b.call(provider, 'tokens'));\n            return await authInternal(provider, options);\n        }\n        // Throw otherwise\n        throw error;\n    }\n}\nasync function authInternal(provider, { serverUrl, authorizationCode, scope, resourceMetadataUrl, fetchFn, }) {\n    let resourceMetadata;\n    let authorizationServerUrl = serverUrl;\n    try {\n        resourceMetadata = await discoverOAuthProtectedResourceMetadata(serverUrl, { resourceMetadataUrl }, fetchFn);\n        if (resourceMetadata.authorization_servers && resourceMetadata.authorization_servers.length > 0) {\n            authorizationServerUrl = resourceMetadata.authorization_servers[0];\n        }\n    }\n    catch (_a) {\n        // Ignore errors and fall back to /.well-known/oauth-authorization-server\n    }\n    const resource = await selectResourceURL(serverUrl, provider, resourceMetadata);\n    const metadata = await discoverOAuthMetadata(serverUrl, {\n        authorizationServerUrl\n    }, fetchFn);\n    // Handle client registration if needed\n    let clientInformation = await Promise.resolve(provider.clientInformation());\n    if (!clientInformation) {\n        if (authorizationCode !== undefined) {\n            throw new Error(\"Existing OAuth client information is required when exchanging an authorization code\");\n        }\n        if (!provider.saveClientInformation) {\n            throw new Error(\"OAuth client information must be saveable for dynamic registration\");\n        }\n        const fullInformation = await registerClient(authorizationServerUrl, {\n            metadata,\n            clientMetadata: provider.clientMetadata,\n        });\n        await provider.saveClientInformation(fullInformation);\n        clientInformation = fullInformation;\n    }\n    // Exchange authorization code for tokens\n    if (authorizationCode !== undefined) {\n        const codeVerifier = await provider.codeVerifier();\n        const tokens = await exchangeAuthorization(authorizationServerUrl, {\n            metadata,\n            clientInformation,\n            authorizationCode,\n            codeVerifier,\n            redirectUri: provider.redirectUrl,\n            resource,\n            addClientAuthentication: provider.addClientAuthentication,\n            fetchFn: fetchFn,\n        });\n        await provider.saveTokens(tokens);\n        return \"AUTHORIZED\";\n    }\n    const tokens = await provider.tokens();\n    // Handle token refresh or new authorization\n    if (tokens === null || tokens === void 0 ? void 0 : tokens.refresh_token) {\n        try {\n            // Attempt to refresh the token\n            const newTokens = await refreshAuthorization(authorizationServerUrl, {\n                metadata,\n                clientInformation,\n                refreshToken: tokens.refresh_token,\n                resource,\n                addClientAuthentication: provider.addClientAuthentication,\n            });\n            await provider.saveTokens(newTokens);\n            return \"AUTHORIZED\";\n        }\n        catch (error) {\n            // If this is a ServerError, or an unknown type, log it out and try to continue. Otherwise, escalate so we can fix things and retry.\n            if (!(error instanceof OAuthError) || error instanceof ServerError) {\n                // Could not refresh OAuth tokens\n            }\n            else {\n                // Refresh failed for another reason, re-throw\n                throw error;\n            }\n        }\n    }\n    const state = provider.state ? await provider.state() : undefined;\n    // Start new authorization flow\n    const { authorizationUrl, codeVerifier } = await startAuthorization(authorizationServerUrl, {\n        metadata,\n        clientInformation,\n        state,\n        redirectUrl: provider.redirectUrl,\n        scope: scope || provider.clientMetadata.scope,\n        resource,\n    });\n    await provider.saveCodeVerifier(codeVerifier);\n    await provider.redirectToAuthorization(authorizationUrl);\n    return \"REDIRECT\";\n}\nexport async function selectResourceURL(serverUrl, provider, resourceMetadata) {\n    const defaultResource = resourceUrlFromServerUrl(serverUrl);\n    // If provider has custom validation, delegate to it\n    if (provider.validateResourceURL) {\n        return await provider.validateResourceURL(defaultResource, resourceMetadata === null || resourceMetadata === void 0 ? void 0 : resourceMetadata.resource);\n    }\n    // Only include resource parameter when Protected Resource Metadata is present\n    if (!resourceMetadata) {\n        return undefined;\n    }\n    // Validate that the metadata's resource is compatible with our request\n    if (!checkResourceAllowed({ requestedResource: defaultResource, configuredResource: resourceMetadata.resource })) {\n        throw new Error(`Protected resource ${resourceMetadata.resource} does not match expected ${defaultResource} (or origin)`);\n    }\n    // Prefer the resource from metadata since it's what the server is telling us to request\n    return new URL(resourceMetadata.resource);\n}\n/**\n * Extract resource_metadata from response header.\n */\nexport function extractResourceMetadataUrl(res) {\n    const authenticateHeader = res.headers.get(\"WWW-Authenticate\");\n    if (!authenticateHeader) {\n        return undefined;\n    }\n    const [type, scheme] = authenticateHeader.split(' ');\n    if (type.toLowerCase() !== 'bearer' || !scheme) {\n        return undefined;\n    }\n    const regex = /resource_metadata=\"([^\"]*)\"/;\n    const match = regex.exec(authenticateHeader);\n    if (!match) {\n        return undefined;\n    }\n    try {\n        return new URL(match[1]);\n    }\n    catch (_a) {\n        return undefined;\n    }\n}\n/**\n * Looks up RFC 9728 OAuth 2.0 Protected Resource Metadata.\n *\n * If the server returns a 404 for the well-known endpoint, this function will\n * return `undefined`. Any other errors will be thrown as exceptions.\n */\nexport async function discoverOAuthProtectedResourceMetadata(serverUrl, opts, fetchFn = fetch) {\n    const response = await discoverMetadataWithFallback(serverUrl, 'oauth-protected-resource', fetchFn, {\n        protocolVersion: opts === null || opts === void 0 ? void 0 : opts.protocolVersion,\n        metadataUrl: opts === null || opts === void 0 ? void 0 : opts.resourceMetadataUrl,\n    });\n    if (!response || response.status === 404) {\n        throw new Error(`Resource server does not implement OAuth 2.0 Protected Resource Metadata.`);\n    }\n    if (!response.ok) {\n        throw new Error(`HTTP ${response.status} trying to load well-known OAuth protected resource metadata.`);\n    }\n    return OAuthProtectedResourceMetadataSchema.parse(await response.json());\n}\n/**\n * Helper function to handle fetch with CORS retry logic\n */\nasync function fetchWithCorsRetry(url, headers, fetchFn = fetch) {\n    try {\n        return await fetchFn(url, { headers });\n    }\n    catch (error) {\n        if (error instanceof TypeError) {\n            if (headers) {\n                // CORS errors come back as TypeError, retry without headers\n                return fetchWithCorsRetry(url, undefined, fetchFn);\n            }\n            else {\n                // We're getting CORS errors on retry too, return undefined\n                return undefined;\n            }\n        }\n        throw error;\n    }\n}\n/**\n * Constructs the well-known path for OAuth metadata discovery\n */\nfunction buildWellKnownPath(wellKnownPrefix, pathname) {\n    let wellKnownPath = `/.well-known/${wellKnownPrefix}${pathname}`;\n    if (pathname.endsWith('/')) {\n        // Strip trailing slash from pathname to avoid double slashes\n        wellKnownPath = wellKnownPath.slice(0, -1);\n    }\n    return wellKnownPath;\n}\n/**\n * Tries to discover OAuth metadata at a specific URL\n */\nasync function tryMetadataDiscovery(url, protocolVersion, fetchFn = fetch) {\n    const headers = {\n        \"MCP-Protocol-Version\": protocolVersion\n    };\n    return await fetchWithCorsRetry(url, headers, fetchFn);\n}\n/**\n * Determines if fallback to root discovery should be attempted\n */\nfunction shouldAttemptFallback(response, pathname) {\n    return !response || response.status === 404 && pathname !== '/';\n}\n/**\n * Generic function for discovering OAuth metadata with fallback support\n */\nasync function discoverMetadataWithFallback(serverUrl, wellKnownType, fetchFn, opts) {\n    var _a, _b;\n    const issuer = new URL(serverUrl);\n    const protocolVersion = (_a = opts === null || opts === void 0 ? void 0 : opts.protocolVersion) !== null && _a !== void 0 ? _a : LATEST_PROTOCOL_VERSION;\n    let url;\n    if (opts === null || opts === void 0 ? void 0 : opts.metadataUrl) {\n        url = new URL(opts.metadataUrl);\n    }\n    else {\n        // Try path-aware discovery first\n        const wellKnownPath = buildWellKnownPath(wellKnownType, issuer.pathname);\n        url = new URL(wellKnownPath, (_b = opts === null || opts === void 0 ? void 0 : opts.metadataServerUrl) !== null && _b !== void 0 ? _b : issuer);\n        url.search = issuer.search;\n    }\n    let response = await tryMetadataDiscovery(url, protocolVersion, fetchFn);\n    // If path-aware discovery fails with 404 and we're not already at root, try fallback to root discovery\n    if (!(opts === null || opts === void 0 ? void 0 : opts.metadataUrl) && shouldAttemptFallback(response, issuer.pathname)) {\n        const rootUrl = new URL(`/.well-known/${wellKnownType}`, issuer);\n        response = await tryMetadataDiscovery(rootUrl, protocolVersion, fetchFn);\n    }\n    return response;\n}\n/**\n * Looks up RFC 8414 OAuth 2.0 Authorization Server Metadata.\n *\n * If the server returns a 404 for the well-known endpoint, this function will\n * return `undefined`. Any other errors will be thrown as exceptions.\n */\nexport async function discoverOAuthMetadata(issuer, { authorizationServerUrl, protocolVersion, } = {}, fetchFn = fetch) {\n    if (typeof issuer === 'string') {\n        issuer = new URL(issuer);\n    }\n    if (!authorizationServerUrl) {\n        authorizationServerUrl = issuer;\n    }\n    if (typeof authorizationServerUrl === 'string') {\n        authorizationServerUrl = new URL(authorizationServerUrl);\n    }\n    protocolVersion !== null && protocolVersion !== void 0 ? protocolVersion : (protocolVersion = LATEST_PROTOCOL_VERSION);\n    const response = await discoverMetadataWithFallback(authorizationServerUrl, 'oauth-authorization-server', fetchFn, {\n        protocolVersion,\n        metadataServerUrl: authorizationServerUrl,\n    });\n    if (!response || response.status === 404) {\n        return undefined;\n    }\n    if (!response.ok) {\n        throw new Error(`HTTP ${response.status} trying to load well-known OAuth metadata`);\n    }\n    return OAuthMetadataSchema.parse(await response.json());\n}\n/**\n * Begins the authorization flow with the given server, by generating a PKCE challenge and constructing the authorization URL.\n */\nexport async function startAuthorization(authorizationServerUrl, { metadata, clientInformation, redirectUrl, scope, state, resource, }) {\n    const responseType = \"code\";\n    const codeChallengeMethod = \"S256\";\n    let authorizationUrl;\n    if (metadata) {\n        authorizationUrl = new URL(metadata.authorization_endpoint);\n        if (!metadata.response_types_supported.includes(responseType)) {\n            throw new Error(`Incompatible auth server: does not support response type ${responseType}`);\n        }\n        if (!metadata.code_challenge_methods_supported ||\n            !metadata.code_challenge_methods_supported.includes(codeChallengeMethod)) {\n            throw new Error(`Incompatible auth server: does not support code challenge method ${codeChallengeMethod}`);\n        }\n    }\n    else {\n        authorizationUrl = new URL(\"/authorize\", authorizationServerUrl);\n    }\n    // Generate PKCE challenge\n    const challenge = await pkceChallenge();\n    const codeVerifier = challenge.code_verifier;\n    const codeChallenge = challenge.code_challenge;\n    authorizationUrl.searchParams.set(\"response_type\", responseType);\n    authorizationUrl.searchParams.set(\"client_id\", clientInformation.client_id);\n    authorizationUrl.searchParams.set(\"code_challenge\", codeChallenge);\n    authorizationUrl.searchParams.set(\"code_challenge_method\", codeChallengeMethod);\n    authorizationUrl.searchParams.set(\"redirect_uri\", String(redirectUrl));\n    if (state) {\n        authorizationUrl.searchParams.set(\"state\", state);\n    }\n    if (scope) {\n        authorizationUrl.searchParams.set(\"scope\", scope);\n    }\n    if (scope === null || scope === void 0 ? void 0 : scope.includes(\"offline_access\")) {\n        // if the request includes the OIDC-only \"offline_access\" scope,\n        // we need to set the prompt to \"consent\" to ensure the user is prompted to grant offline access\n        // https://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess\n        authorizationUrl.searchParams.append(\"prompt\", \"consent\");\n    }\n    if (resource) {\n        authorizationUrl.searchParams.set(\"resource\", resource.href);\n    }\n    return { authorizationUrl, codeVerifier };\n}\n/**\n * Exchanges an authorization code for an access token with the given server.\n *\n * Supports multiple client authentication methods as specified in OAuth 2.1:\n * - Automatically selects the best authentication method based on server support\n * - Falls back to appropriate defaults when server metadata is unavailable\n *\n * @param authorizationServerUrl - The authorization server's base URL\n * @param options - Configuration object containing client info, auth code, etc.\n * @returns Promise resolving to OAuth tokens\n * @throws {Error} When token exchange fails or authentication is invalid\n */\nexport async function exchangeAuthorization(authorizationServerUrl, { metadata, clientInformation, authorizationCode, codeVerifier, redirectUri, resource, addClientAuthentication, fetchFn, }) {\n    var _a;\n    const grantType = \"authorization_code\";\n    const tokenUrl = (metadata === null || metadata === void 0 ? void 0 : metadata.token_endpoint)\n        ? new URL(metadata.token_endpoint)\n        : new URL(\"/token\", authorizationServerUrl);\n    if ((metadata === null || metadata === void 0 ? void 0 : metadata.grant_types_supported) &&\n        !metadata.grant_types_supported.includes(grantType)) {\n        throw new Error(`Incompatible auth server: does not support grant type ${grantType}`);\n    }\n    // Exchange code for tokens\n    const headers = new Headers({\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n    });\n    const params = new URLSearchParams({\n        grant_type: grantType,\n        code: authorizationCode,\n        code_verifier: codeVerifier,\n        redirect_uri: String(redirectUri),\n    });\n    if (addClientAuthentication) {\n        addClientAuthentication(headers, params, authorizationServerUrl, metadata);\n    }\n    else {\n        // Determine and apply client authentication method\n        const supportedMethods = (_a = metadata === null || metadata === void 0 ? void 0 : metadata.token_endpoint_auth_methods_supported) !== null && _a !== void 0 ? _a : [];\n        const authMethod = selectClientAuthMethod(clientInformation, supportedMethods);\n        applyClientAuthentication(authMethod, clientInformation, headers, params);\n    }\n    if (resource) {\n        params.set(\"resource\", resource.href);\n    }\n    const response = await (fetchFn !== null && fetchFn !== void 0 ? fetchFn : fetch)(tokenUrl, {\n        method: \"POST\",\n        headers,\n        body: params,\n    });\n    if (!response.ok) {\n        throw await parseErrorResponse(response);\n    }\n    return OAuthTokensSchema.parse(await response.json());\n}\n/**\n * Exchange a refresh token for an updated access token.\n *\n * Supports multiple client authentication methods as specified in OAuth 2.1:\n * - Automatically selects the best authentication method based on server support\n * - Preserves the original refresh token if a new one is not returned\n *\n * @param authorizationServerUrl - The authorization server's base URL\n * @param options - Configuration object containing client info, refresh token, etc.\n * @returns Promise resolving to OAuth tokens (preserves original refresh_token if not replaced)\n * @throws {Error} When token refresh fails or authentication is invalid\n */\nexport async function refreshAuthorization(authorizationServerUrl, { metadata, clientInformation, refreshToken, resource, addClientAuthentication, fetchFn, }) {\n    var _a;\n    const grantType = \"refresh_token\";\n    let tokenUrl;\n    if (metadata) {\n        tokenUrl = new URL(metadata.token_endpoint);\n        if (metadata.grant_types_supported &&\n            !metadata.grant_types_supported.includes(grantType)) {\n            throw new Error(`Incompatible auth server: does not support grant type ${grantType}`);\n        }\n    }\n    else {\n        tokenUrl = new URL(\"/token\", authorizationServerUrl);\n    }\n    // Exchange refresh token\n    const headers = new Headers({\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n    });\n    const params = new URLSearchParams({\n        grant_type: grantType,\n        refresh_token: refreshToken,\n    });\n    if (addClientAuthentication) {\n        addClientAuthentication(headers, params, authorizationServerUrl, metadata);\n    }\n    else {\n        // Determine and apply client authentication method\n        const supportedMethods = (_a = metadata === null || metadata === void 0 ? void 0 : metadata.token_endpoint_auth_methods_supported) !== null && _a !== void 0 ? _a : [];\n        const authMethod = selectClientAuthMethod(clientInformation, supportedMethods);\n        applyClientAuthentication(authMethod, clientInformation, headers, params);\n    }\n    if (resource) {\n        params.set(\"resource\", resource.href);\n    }\n    const response = await (fetchFn !== null && fetchFn !== void 0 ? fetchFn : fetch)(tokenUrl, {\n        method: \"POST\",\n        headers,\n        body: params,\n    });\n    if (!response.ok) {\n        throw await parseErrorResponse(response);\n    }\n    return OAuthTokensSchema.parse({ refresh_token: refreshToken, ...(await response.json()) });\n}\n/**\n * Performs OAuth 2.0 Dynamic Client Registration according to RFC 7591.\n */\nexport async function registerClient(authorizationServerUrl, { metadata, clientMetadata, fetchFn, }) {\n    let registrationUrl;\n    if (metadata) {\n        if (!metadata.registration_endpoint) {\n            throw new Error(\"Incompatible auth server: does not support dynamic client registration\");\n        }\n        registrationUrl = new URL(metadata.registration_endpoint);\n    }\n    else {\n        registrationUrl = new URL(\"/register\", authorizationServerUrl);\n    }\n    const response = await (fetchFn !== null && fetchFn !== void 0 ? fetchFn : fetch)(registrationUrl, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(clientMetadata),\n    });\n    if (!response.ok) {\n        throw await parseErrorResponse(response);\n    }\n    return OAuthClientInformationFullSchema.parse(await response.json());\n}\n//# sourceMappingURL=auth.js.map","import { EventSource } from \"eventsource\";\nimport { JSONRPCMessageSchema } from \"../types.js\";\nimport { auth, extractResourceMetadataUrl, UnauthorizedError } from \"./auth.js\";\nexport class SseError extends Error {\n    constructor(code, message, event) {\n        super(`SSE error: ${message}`);\n        this.code = code;\n        this.event = event;\n    }\n}\n/**\n * Client transport for SSE: this will connect to a server using Server-Sent Events for receiving\n * messages and make separate POST requests for sending messages.\n */\nexport class SSEClientTransport {\n    constructor(url, opts) {\n        this._url = url;\n        this._resourceMetadataUrl = undefined;\n        this._eventSourceInit = opts === null || opts === void 0 ? void 0 : opts.eventSourceInit;\n        this._requestInit = opts === null || opts === void 0 ? void 0 : opts.requestInit;\n        this._authProvider = opts === null || opts === void 0 ? void 0 : opts.authProvider;\n        this._fetch = opts === null || opts === void 0 ? void 0 : opts.fetch;\n    }\n    async _authThenStart() {\n        var _a;\n        if (!this._authProvider) {\n            throw new UnauthorizedError(\"No auth provider\");\n        }\n        let result;\n        try {\n            result = await auth(this._authProvider, { serverUrl: this._url, resourceMetadataUrl: this._resourceMetadataUrl, fetchFn: this._fetch });\n        }\n        catch (error) {\n            (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n            throw error;\n        }\n        if (result !== \"AUTHORIZED\") {\n            throw new UnauthorizedError();\n        }\n        return await this._startOrAuth();\n    }\n    async _commonHeaders() {\n        var _a;\n        const headers = {};\n        if (this._authProvider) {\n            const tokens = await this._authProvider.tokens();\n            if (tokens) {\n                headers[\"Authorization\"] = `Bearer ${tokens.access_token}`;\n            }\n        }\n        if (this._protocolVersion) {\n            headers[\"mcp-protocol-version\"] = this._protocolVersion;\n        }\n        return new Headers({ ...headers, ...(_a = this._requestInit) === null || _a === void 0 ? void 0 : _a.headers });\n    }\n    _startOrAuth() {\n        var _a, _b, _c;\n        const fetchImpl = ((_c = (_b = (_a = this === null || this === void 0 ? void 0 : this._eventSourceInit) === null || _a === void 0 ? void 0 : _a.fetch) !== null && _b !== void 0 ? _b : this._fetch) !== null && _c !== void 0 ? _c : fetch);\n        return new Promise((resolve, reject) => {\n            this._eventSource = new EventSource(this._url.href, {\n                ...this._eventSourceInit,\n                fetch: async (url, init) => {\n                    const headers = await this._commonHeaders();\n                    headers.set(\"Accept\", \"text/event-stream\");\n                    const response = await fetchImpl(url, {\n                        ...init,\n                        headers,\n                    });\n                    if (response.status === 401 && response.headers.has('www-authenticate')) {\n                        this._resourceMetadataUrl = extractResourceMetadataUrl(response);\n                    }\n                    return response;\n                },\n            });\n            this._abortController = new AbortController();\n            this._eventSource.onerror = (event) => {\n                var _a;\n                if (event.code === 401 && this._authProvider) {\n                    this._authThenStart().then(resolve, reject);\n                    return;\n                }\n                const error = new SseError(event.code, event.message, event);\n                reject(error);\n                (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n            };\n            this._eventSource.onopen = () => {\n                // The connection is open, but we need to wait for the endpoint to be received.\n            };\n            this._eventSource.addEventListener(\"endpoint\", (event) => {\n                var _a;\n                const messageEvent = event;\n                try {\n                    this._endpoint = new URL(messageEvent.data, this._url);\n                    if (this._endpoint.origin !== this._url.origin) {\n                        throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`);\n                    }\n                }\n                catch (error) {\n                    reject(error);\n                    (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n                    void this.close();\n                    return;\n                }\n                resolve();\n            });\n            this._eventSource.onmessage = (event) => {\n                var _a, _b;\n                const messageEvent = event;\n                let message;\n                try {\n                    message = JSONRPCMessageSchema.parse(JSON.parse(messageEvent.data));\n                }\n                catch (error) {\n                    (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n                    return;\n                }\n                (_b = this.onmessage) === null || _b === void 0 ? void 0 : _b.call(this, message);\n            };\n        });\n    }\n    async start() {\n        if (this._eventSource) {\n            throw new Error(\"SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.\");\n        }\n        return await this._startOrAuth();\n    }\n    /**\n     * Call this method after the user has finished authorizing via their user agent and is redirected back to the MCP client application. This will exchange the authorization code for an access token, enabling the next connection attempt to successfully auth.\n     */\n    async finishAuth(authorizationCode) {\n        if (!this._authProvider) {\n            throw new UnauthorizedError(\"No auth provider\");\n        }\n        const result = await auth(this._authProvider, { serverUrl: this._url, authorizationCode, resourceMetadataUrl: this._resourceMetadataUrl, fetchFn: this._fetch });\n        if (result !== \"AUTHORIZED\") {\n            throw new UnauthorizedError(\"Failed to authorize\");\n        }\n    }\n    async close() {\n        var _a, _b, _c;\n        (_a = this._abortController) === null || _a === void 0 ? void 0 : _a.abort();\n        (_b = this._eventSource) === null || _b === void 0 ? void 0 : _b.close();\n        (_c = this.onclose) === null || _c === void 0 ? void 0 : _c.call(this);\n    }\n    async send(message) {\n        var _a, _b, _c;\n        if (!this._endpoint) {\n            throw new Error(\"Not connected\");\n        }\n        try {\n            const headers = await this._commonHeaders();\n            headers.set(\"content-type\", \"application/json\");\n            const init = {\n                ...this._requestInit,\n                method: \"POST\",\n                headers,\n                body: JSON.stringify(message),\n                signal: (_a = this._abortController) === null || _a === void 0 ? void 0 : _a.signal,\n            };\n            const response = await ((_b = this._fetch) !== null && _b !== void 0 ? _b : fetch)(this._endpoint, init);\n            if (!response.ok) {\n                if (response.status === 401 && this._authProvider) {\n                    this._resourceMetadataUrl = extractResourceMetadataUrl(response);\n                    const result = await auth(this._authProvider, { serverUrl: this._url, resourceMetadataUrl: this._resourceMetadataUrl, fetchFn: this._fetch });\n                    if (result !== \"AUTHORIZED\") {\n                        throw new UnauthorizedError();\n                    }\n                    // Purposely _not_ awaited, so we don't call onerror twice\n                    return this.send(message);\n                }\n                const text = await response.text().catch(() => null);\n                throw new Error(`Error POSTing to endpoint (HTTP ${response.status}): ${text}`);\n            }\n        }\n        catch (error) {\n            (_c = this.onerror) === null || _c === void 0 ? void 0 : _c.call(this, error);\n            throw error;\n        }\n    }\n    setProtocolVersion(version) {\n        this._protocolVersion = version;\n    }\n}\n//# sourceMappingURL=sse.js.map","var __defProp = Object.defineProperty, __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: !0, configurable: !0, writable: !0, value }) : obj[key] = value, __publicField = (obj, key, value) => __defNormalProp(obj, typeof key != \"symbol\" ? key + \"\" : key, value);\nclass ParseError extends Error {\n  constructor(message, options) {\n    super(message), __publicField(this, \"type\"), __publicField(this, \"field\"), __publicField(this, \"value\"), __publicField(this, \"line\"), this.name = \"ParseError\", this.type = options.type, this.field = options.field, this.value = options.value, this.line = options.line;\n  }\n}\nfunction noop(_arg) {\n}\nfunction createParser(callbacks) {\n  const { onEvent = noop, onError = noop, onRetry = noop, onComment } = callbacks;\n  let incompleteLine = \"\", isFirstChunk = !0, id, data = \"\", eventType = \"\";\n  function feed(newChunk) {\n    const chunk = isFirstChunk ? newChunk.replace(/^\\xEF\\xBB\\xBF/, \"\") : newChunk, [complete, incomplete] = splitLines(`${incompleteLine}${chunk}`);\n    for (const line of complete)\n      parseLine(line);\n    incompleteLine = incomplete, isFirstChunk = !1;\n  }\n  function parseLine(line) {\n    if (line === \"\") {\n      dispatchEvent();\n      return;\n    }\n    if (line.startsWith(\":\")) {\n      onComment && onComment(line.slice(line.startsWith(\": \") ? 2 : 1));\n      return;\n    }\n    const fieldSeparatorIndex = line.indexOf(\":\");\n    if (fieldSeparatorIndex !== -1) {\n      const field = line.slice(0, fieldSeparatorIndex), offset = line[fieldSeparatorIndex + 1] === \" \" ? 2 : 1, value = line.slice(fieldSeparatorIndex + offset);\n      processField(field, value, line);\n      return;\n    }\n    processField(line, \"\", line);\n  }\n  function processField(field, value, line) {\n    switch (field) {\n      case \"event\":\n        eventType = value;\n        break;\n      case \"data\":\n        data = `${data}${value}\n`;\n        break;\n      case \"id\":\n        id = value.includes(\"\\0\") ? void 0 : value;\n        break;\n      case \"retry\":\n        /^\\d+$/.test(value) ? onRetry(parseInt(value, 10)) : onError(\n          new ParseError(`Invalid \\`retry\\` value: \"${value}\"`, {\n            type: \"invalid-retry\",\n            value,\n            line\n          })\n        );\n        break;\n      default:\n        onError(\n          new ParseError(\n            `Unknown field \"${field.length > 20 ? `${field.slice(0, 20)}\\u2026` : field}\"`,\n            { type: \"unknown-field\", field, value, line }\n          )\n        );\n        break;\n    }\n  }\n  function dispatchEvent() {\n    data.length > 0 && onEvent({\n      id,\n      event: eventType || void 0,\n      // If the data buffer's last character is a U+000A LINE FEED (LF) character,\n      // then remove the last character from the data buffer.\n      data: data.endsWith(`\n`) ? data.slice(0, -1) : data\n    }), id = void 0, data = \"\", eventType = \"\";\n  }\n  function reset(options = {}) {\n    incompleteLine && options.consume && parseLine(incompleteLine), id = void 0, data = \"\", eventType = \"\", incompleteLine = \"\";\n  }\n  return { feed, reset };\n}\nfunction splitLines(chunk) {\n  const lines = [];\n  let incompleteLine = \"\";\n  const totalLength = chunk.length;\n  for (let i = 0; i < totalLength; i++) {\n    const char = chunk[i];\n    char === \"\\r\" && chunk[i + 1] === `\n` ? (lines.push(incompleteLine), incompleteLine = \"\", i++) : char === \"\\r\" || char === `\n` ? (lines.push(incompleteLine), incompleteLine = \"\") : incompleteLine += char;\n  }\n  return [lines, incompleteLine];\n}\nexport {\n  ParseError,\n  createParser\n};\n//# sourceMappingURL=index.js.map\n","import { createParser } from \"./index.js\";\nimport { ParseError } from \"./index.js\";\nclass EventSourceParserStream extends TransformStream {\n  constructor({ onError, onRetry, onComment } = {}) {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser({\n          onEvent: (event) => {\n            controller.enqueue(event);\n          },\n          onError(error) {\n            onError === \"terminate\" ? controller.error(error) : typeof onError == \"function\" && onError(error);\n          },\n          onRetry,\n          onComment\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport {\n  EventSourceParserStream,\n  ParseError\n};\n//# sourceMappingURL=stream.js.map\n","import { isInitializedNotification, isJSONRPCRequest, isJSONRPCResponse, JSONRPCMessageSchema } from \"../types.js\";\nimport { auth, extractResourceMetadataUrl, UnauthorizedError } from \"./auth.js\";\nimport { EventSourceParserStream } from \"eventsource-parser/stream\";\n// Default reconnection options for StreamableHTTP connections\nconst DEFAULT_STREAMABLE_HTTP_RECONNECTION_OPTIONS = {\n    initialReconnectionDelay: 1000,\n    maxReconnectionDelay: 30000,\n    reconnectionDelayGrowFactor: 1.5,\n    maxRetries: 2,\n};\nexport class StreamableHTTPError extends Error {\n    constructor(code, message) {\n        super(`Streamable HTTP error: ${message}`);\n        this.code = code;\n    }\n}\n/**\n * Client transport for Streamable HTTP: this implements the MCP Streamable HTTP transport specification.\n * It will connect to a server using HTTP POST for sending messages and HTTP GET with Server-Sent Events\n * for receiving messages.\n */\nexport class StreamableHTTPClientTransport {\n    constructor(url, opts) {\n        var _a;\n        this._url = url;\n        this._resourceMetadataUrl = undefined;\n        this._requestInit = opts === null || opts === void 0 ? void 0 : opts.requestInit;\n        this._authProvider = opts === null || opts === void 0 ? void 0 : opts.authProvider;\n        this._fetch = opts === null || opts === void 0 ? void 0 : opts.fetch;\n        this._sessionId = opts === null || opts === void 0 ? void 0 : opts.sessionId;\n        this._reconnectionOptions = (_a = opts === null || opts === void 0 ? void 0 : opts.reconnectionOptions) !== null && _a !== void 0 ? _a : DEFAULT_STREAMABLE_HTTP_RECONNECTION_OPTIONS;\n    }\n    async _authThenStart() {\n        var _a;\n        if (!this._authProvider) {\n            throw new UnauthorizedError(\"No auth provider\");\n        }\n        let result;\n        try {\n            result = await auth(this._authProvider, { serverUrl: this._url, resourceMetadataUrl: this._resourceMetadataUrl, fetchFn: this._fetch });\n        }\n        catch (error) {\n            (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, error);\n            throw error;\n        }\n        if (result !== \"AUTHORIZED\") {\n            throw new UnauthorizedError();\n        }\n        return await this._startOrAuthSse({ resumptionToken: undefined });\n    }\n    async _commonHeaders() {\n        var _a;\n        const headers = {};\n        if (this._authProvider) {\n            const tokens = await this._authProvider.tokens();\n            if (tokens) {\n                headers[\"Authorization\"] = `Bearer ${tokens.access_token}`;\n            }\n        }\n        if (this._sessionId) {\n            headers[\"mcp-session-id\"] = this._sessionId;\n        }\n        if (this._protocolVersion) {\n            headers[\"mcp-protocol-version\"] = this._protocolVersion;\n        }\n        const extraHeaders = this._normalizeHeaders((_a = this._requestInit) === null || _a === void 0 ? void 0 : _a.headers);\n        return new Headers({\n            ...headers,\n            ...extraHeaders,\n        });\n    }\n    async _startOrAuthSse(options) {\n        var _a, _b, _c;\n        const { resumptionToken } = options;\n        try {\n            // Try to open an initial SSE stream with GET to listen for server messages\n            // This is optional according to the spec - server may not support it\n            const headers = await this._commonHeaders();\n            headers.set(\"Accept\", \"text/event-stream\");\n            // Include Last-Event-ID header for resumable streams if provided\n            if (resumptionToken) {\n                headers.set(\"last-event-id\", resumptionToken);\n            }\n            const response = await ((_a = this._fetch) !== null && _a !== void 0 ? _a : fetch)(this._url, {\n                method: \"GET\",\n                headers,\n                signal: (_b = this._abortController) === null || _b === void 0 ? void 0 : _b.signal,\n            });\n            if (!response.ok) {\n                if (response.status === 401 && this._authProvider) {\n                    // Need to authenticate\n                    return await this._authThenStart();\n                }\n                // 405 indicates that the server does not offer an SSE stream at GET endpoint\n                // This is an expected case that should not trigger an error\n                if (response.status === 405) {\n                    return;\n                }\n                throw new StreamableHTTPError(response.status, `Failed to open SSE stream: ${response.statusText}`);\n            }\n            this._handleSseStream(response.body, options, true);\n        }\n        catch (error) {\n            (_c = this.onerror) === null || _c === void 0 ? void 0 : _c.call(this, error);\n            throw error;\n        }\n    }\n    /**\n     * Calculates the next reconnection delay using  backoff algorithm\n     *\n     * @param attempt Current reconnection attempt count for the specific stream\n     * @returns Time to wait in milliseconds before next reconnection attempt\n     */\n    _getNextReconnectionDelay(attempt) {\n        // Access default values directly, ensuring they're never undefined\n        const initialDelay = this._reconnectionOptions.initialReconnectionDelay;\n        const growFactor = this._reconnectionOptions.reconnectionDelayGrowFactor;\n        const maxDelay = this._reconnectionOptions.maxReconnectionDelay;\n        // Cap at maximum delay\n        return Math.min(initialDelay * Math.pow(growFactor, attempt), maxDelay);\n    }\n    _normalizeHeaders(headers) {\n        if (!headers)\n            return {};\n        if (headers instanceof Headers) {\n            return Object.fromEntries(headers.entries());\n        }\n        if (Array.isArray(headers)) {\n            return Object.fromEntries(headers);\n        }\n        return { ...headers };\n    }\n    /**\n     * Schedule a reconnection attempt with exponential backoff\n     *\n     * @param lastEventId The ID of the last received event for resumability\n     * @param attemptCount Current reconnection attempt count for this specific stream\n     */\n    _scheduleReconnection(options, attemptCount = 0) {\n        var _a;\n        // Use provided options or default options\n        const maxRetries = this._reconnectionOptions.maxRetries;\n        // Check if we've exceeded maximum retry attempts\n        if (maxRetries > 0 && attemptCount >= maxRetries) {\n            (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, new Error(`Maximum reconnection attempts (${maxRetries}) exceeded.`));\n            return;\n        }\n        // Calculate next delay based on current attempt count\n        const delay = this._getNextReconnectionDelay(attemptCount);\n        // Schedule the reconnection\n        setTimeout(() => {\n            // Use the last event ID to resume where we left off\n            this._startOrAuthSse(options).catch(error => {\n                var _a;\n                (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, new Error(`Failed to reconnect SSE stream: ${error instanceof Error ? error.message : String(error)}`));\n                // Schedule another attempt if this one failed, incrementing the attempt counter\n                this._scheduleReconnection(options, attemptCount + 1);\n            });\n        }, delay);\n    }\n    _handleSseStream(stream, options, isReconnectable) {\n        if (!stream) {\n            return;\n        }\n        const { onresumptiontoken, replayMessageId } = options;\n        let lastEventId;\n        const processStream = async () => {\n            var _a, _b, _c, _d;\n            // this is the closest we can get to trying to catch network errors\n            // if something happens reader will throw\n            try {\n                // Create a pipeline: binary stream -> text decoder -> SSE parser\n                const reader = stream\n                    .pipeThrough(new TextDecoderStream())\n                    .pipeThrough(new EventSourceParserStream())\n                    .getReader();\n                while (true) {\n                    const { value: event, done } = await reader.read();\n                    if (done) {\n                        break;\n                    }\n                    // Update last event ID if provided\n                    if (event.id) {\n                        lastEventId = event.id;\n                        onresumptiontoken === null || onresumptiontoken === void 0 ? void 0 : onresumptiontoken(event.id);\n                    }\n                    if (!event.event || event.event === \"message\") {\n                        try {\n                            const message = JSONRPCMessageSchema.parse(JSON.parse(event.data));\n                            if (replayMessageId !== undefined && isJSONRPCResponse(message)) {\n                                message.id = replayMessageId;\n                            }\n                            (_a = this.onmessage) === null || _a === void 0 ? void 0 : _a.call(this, message);\n                        }\n                        catch (error) {\n                            (_b = this.onerror) === null || _b === void 0 ? void 0 : _b.call(this, error);\n                        }\n                    }\n                }\n            }\n            catch (error) {\n                // Handle stream errors - likely a network disconnect\n                (_c = this.onerror) === null || _c === void 0 ? void 0 : _c.call(this, new Error(`SSE stream disconnected: ${error}`));\n                // Attempt to reconnect if the stream disconnects unexpectedly and we aren't closing\n                if (isReconnectable &&\n                    this._abortController &&\n                    !this._abortController.signal.aborted) {\n                    // Use the exponential backoff reconnection strategy\n                    try {\n                        this._scheduleReconnection({\n                            resumptionToken: lastEventId,\n                            onresumptiontoken,\n                            replayMessageId\n                        }, 0);\n                    }\n                    catch (error) {\n                        (_d = this.onerror) === null || _d === void 0 ? void 0 : _d.call(this, new Error(`Failed to reconnect: ${error instanceof Error ? error.message : String(error)}`));\n                    }\n                }\n            }\n        };\n        processStream();\n    }\n    async start() {\n        if (this._abortController) {\n            throw new Error(\"StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.\");\n        }\n        this._abortController = new AbortController();\n    }\n    /**\n     * Call this method after the user has finished authorizing via their user agent and is redirected back to the MCP client application. This will exchange the authorization code for an access token, enabling the next connection attempt to successfully auth.\n     */\n    async finishAuth(authorizationCode) {\n        if (!this._authProvider) {\n            throw new UnauthorizedError(\"No auth provider\");\n        }\n        const result = await auth(this._authProvider, { serverUrl: this._url, authorizationCode, resourceMetadataUrl: this._resourceMetadataUrl, fetchFn: this._fetch });\n        if (result !== \"AUTHORIZED\") {\n            throw new UnauthorizedError(\"Failed to authorize\");\n        }\n    }\n    async close() {\n        var _a, _b;\n        // Abort any pending requests\n        (_a = this._abortController) === null || _a === void 0 ? void 0 : _a.abort();\n        (_b = this.onclose) === null || _b === void 0 ? void 0 : _b.call(this);\n    }\n    async send(message, options) {\n        var _a, _b, _c, _d;\n        try {\n            const { resumptionToken, onresumptiontoken } = options || {};\n            if (resumptionToken) {\n                // If we have at last event ID, we need to reconnect the SSE stream\n                this._startOrAuthSse({ resumptionToken, replayMessageId: isJSONRPCRequest(message) ? message.id : undefined }).catch(err => { var _a; return (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, err); });\n                return;\n            }\n            const headers = await this._commonHeaders();\n            headers.set(\"content-type\", \"application/json\");\n            headers.set(\"accept\", \"application/json, text/event-stream\");\n            const init = {\n                ...this._requestInit,\n                method: \"POST\",\n                headers,\n                body: JSON.stringify(message),\n                signal: (_a = this._abortController) === null || _a === void 0 ? void 0 : _a.signal,\n            };\n            const response = await ((_b = this._fetch) !== null && _b !== void 0 ? _b : fetch)(this._url, init);\n            // Handle session ID received during initialization\n            const sessionId = response.headers.get(\"mcp-session-id\");\n            if (sessionId) {\n                this._sessionId = sessionId;\n            }\n            if (!response.ok) {\n                if (response.status === 401 && this._authProvider) {\n                    this._resourceMetadataUrl = extractResourceMetadataUrl(response);\n                    const result = await auth(this._authProvider, { serverUrl: this._url, resourceMetadataUrl: this._resourceMetadataUrl, fetchFn: this._fetch });\n                    if (result !== \"AUTHORIZED\") {\n                        throw new UnauthorizedError();\n                    }\n                    // Purposely _not_ awaited, so we don't call onerror twice\n                    return this.send(message);\n                }\n                const text = await response.text().catch(() => null);\n                throw new Error(`Error POSTing to endpoint (HTTP ${response.status}): ${text}`);\n            }\n            // If the response is 202 Accepted, there's no body to process\n            if (response.status === 202) {\n                // if the accepted notification is initialized, we start the SSE stream\n                // if it's supported by the server\n                if (isInitializedNotification(message)) {\n                    // Start without a lastEventId since this is a fresh connection\n                    this._startOrAuthSse({ resumptionToken: undefined }).catch(err => { var _a; return (_a = this.onerror) === null || _a === void 0 ? void 0 : _a.call(this, err); });\n                }\n                return;\n            }\n            // Get original message(s) for detecting request IDs\n            const messages = Array.isArray(message) ? message : [message];\n            const hasRequests = messages.filter(msg => \"method\" in msg && \"id\" in msg && msg.id !== undefined).length > 0;\n            // Check the response type\n            const contentType = response.headers.get(\"content-type\");\n            if (hasRequests) {\n                if (contentType === null || contentType === void 0 ? void 0 : contentType.includes(\"text/event-stream\")) {\n                    // Handle SSE stream responses for requests\n                    // We use the same handler as standalone streams, which now supports\n                    // reconnection with the last event ID\n                    this._handleSseStream(response.body, { onresumptiontoken }, false);\n                }\n                else if (contentType === null || contentType === void 0 ? void 0 : contentType.includes(\"application/json\")) {\n                    // For non-streaming servers, we might get direct JSON responses\n                    const data = await response.json();\n                    const responseMessages = Array.isArray(data)\n                        ? data.map(msg => JSONRPCMessageSchema.parse(msg))\n                        : [JSONRPCMessageSchema.parse(data)];\n                    for (const msg of responseMessages) {\n                        (_c = this.onmessage) === null || _c === void 0 ? void 0 : _c.call(this, msg);\n                    }\n                }\n                else {\n                    throw new StreamableHTTPError(-1, `Unexpected content type: ${contentType}`);\n                }\n            }\n        }\n        catch (error) {\n            (_d = this.onerror) === null || _d === void 0 ? void 0 : _d.call(this, error);\n            throw error;\n        }\n    }\n    get sessionId() {\n        return this._sessionId;\n    }\n    /**\n     * Terminates the current session by sending a DELETE request to the server.\n     *\n     * Clients that no longer need a particular session\n     * (e.g., because the user is leaving the client application) SHOULD send an\n     * HTTP DELETE to the MCP endpoint with the Mcp-Session-Id header to explicitly\n     * terminate the session.\n     *\n     * The server MAY respond with HTTP 405 Method Not Allowed, indicating that\n     * the server does not allow clients to terminate sessions.\n     */\n    async terminateSession() {\n        var _a, _b, _c;\n        if (!this._sessionId) {\n            return; // No session to terminate\n        }\n        try {\n            const headers = await this._commonHeaders();\n            const init = {\n                ...this._requestInit,\n                method: \"DELETE\",\n                headers,\n                signal: (_a = this._abortController) === null || _a === void 0 ? void 0 : _a.signal,\n            };\n            const response = await ((_b = this._fetch) !== null && _b !== void 0 ? _b : fetch)(this._url, init);\n            // We specifically handle 405 as a valid response according to the spec,\n            // meaning the server does not support explicit session termination\n            if (!response.ok && response.status !== 405) {\n                throw new StreamableHTTPError(response.status, `Failed to terminate session: ${response.statusText}`);\n            }\n            this._sessionId = undefined;\n        }\n        catch (error) {\n            (_c = this.onerror) === null || _c === void 0 ? void 0 : _c.call(this, error);\n            throw error;\n        }\n    }\n    setProtocolVersion(version) {\n        this._protocolVersion = version;\n    }\n    get protocolVersion() {\n        return this._protocolVersion;\n    }\n}\n//# sourceMappingURL=streamableHttp.js.map","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function (val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '')\n\t\t\t.trim()\n\t\t\t.replace(/\\s+/g, ',')\n\t\t\t.split(',')\n\t\t\t.filter(Boolean);\n\n\t\tfor (const ns of split) {\n\t\t\tif (ns[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(ns.slice(1));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(ns);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the given string matches a namespace template, honoring\n\t * asterisks as wildcards.\n\t *\n\t * @param {String} search\n\t * @param {String} template\n\t * @return {Boolean}\n\t */\n\tfunction matchesTemplate(search, template) {\n\t\tlet searchIndex = 0;\n\t\tlet templateIndex = 0;\n\t\tlet starIndex = -1;\n\t\tlet matchIndex = 0;\n\n\t\twhile (searchIndex < search.length) {\n\t\t\tif (templateIndex < template.length && (template[templateIndex] === search[searchIndex] || template[templateIndex] === '*')) {\n\t\t\t\t// Match character or proceed with wildcard\n\t\t\t\tif (template[templateIndex] === '*') {\n\t\t\t\t\tstarIndex = templateIndex;\n\t\t\t\t\tmatchIndex = searchIndex;\n\t\t\t\t\ttemplateIndex++; // Skip the '*'\n\t\t\t\t} else {\n\t\t\t\t\tsearchIndex++;\n\t\t\t\t\ttemplateIndex++;\n\t\t\t\t}\n\t\t\t} else if (starIndex !== -1) { // eslint-disable-line no-negated-condition\n\t\t\t\t// Backtrack to the last '*' and try to match more characters\n\t\t\t\ttemplateIndex = starIndex + 1;\n\t\t\t\tmatchIndex++;\n\t\t\t\tsearchIndex = matchIndex;\n\t\t\t} else {\n\t\t\t\treturn false; // No match\n\t\t\t}\n\t\t}\n\n\t\t// Handle trailing '*' in template\n\t\twhile (templateIndex < template.length && template[templateIndex] === '*') {\n\t\t\ttemplateIndex++;\n\t\t}\n\n\t\treturn templateIndex === template.length;\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names,\n\t\t\t...createDebug.skips.map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tfor (const skip of createDebug.skips) {\n\t\t\tif (matchesTemplate(name, skip)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (const ns of createDebug.names) {\n\t\t\tif (matchesTemplate(name, ns)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\tlet m;\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\t// eslint-disable-next-line no-return-assign\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && (m = navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)) && parseInt(m[1], 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug') || exports.storage.getItem('DEBUG') ;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","export var util;\n(function (util) {\n    util.assertEqual = (_) => { };\n    function assertIs(_arg) { }\n    util.assertIs = assertIs;\n    function assertNever(_x) {\n        throw new Error();\n    }\n    util.assertNever = assertNever;\n    util.arrayToEnum = (items) => {\n        const obj = {};\n        for (const item of items) {\n            obj[item] = item;\n        }\n        return obj;\n    };\n    util.getValidEnumValues = (obj) => {\n        const validKeys = util.objectKeys(obj).filter((k) => typeof obj[obj[k]] !== \"number\");\n        const filtered = {};\n        for (const k of validKeys) {\n            filtered[k] = obj[k];\n        }\n        return util.objectValues(filtered);\n    };\n    util.objectValues = (obj) => {\n        return util.objectKeys(obj).map(function (e) {\n            return obj[e];\n        });\n    };\n    util.objectKeys = typeof Object.keys === \"function\" // eslint-disable-line ban/ban\n        ? (obj) => Object.keys(obj) // eslint-disable-line ban/ban\n        : (object) => {\n            const keys = [];\n            for (const key in object) {\n                if (Object.prototype.hasOwnProperty.call(object, key)) {\n                    keys.push(key);\n                }\n            }\n            return keys;\n        };\n    util.find = (arr, checker) => {\n        for (const item of arr) {\n            if (checker(item))\n                return item;\n        }\n        return undefined;\n    };\n    util.isInteger = typeof Number.isInteger === \"function\"\n        ? (val) => Number.isInteger(val) // eslint-disable-line ban/ban\n        : (val) => typeof val === \"number\" && Number.isFinite(val) && Math.floor(val) === val;\n    function joinValues(array, separator = \" | \") {\n        return array.map((val) => (typeof val === \"string\" ? `'${val}'` : val)).join(separator);\n    }\n    util.joinValues = joinValues;\n    util.jsonStringifyReplacer = (_, value) => {\n        if (typeof value === \"bigint\") {\n            return value.toString();\n        }\n        return value;\n    };\n})(util || (util = {}));\nexport var objectUtil;\n(function (objectUtil) {\n    objectUtil.mergeShapes = (first, second) => {\n        return {\n            ...first,\n            ...second, // second overwrites first\n        };\n    };\n})(objectUtil || (objectUtil = {}));\nexport const ZodParsedType = util.arrayToEnum([\n    \"string\",\n    \"nan\",\n    \"number\",\n    \"integer\",\n    \"float\",\n    \"boolean\",\n    \"date\",\n    \"bigint\",\n    \"symbol\",\n    \"function\",\n    \"undefined\",\n    \"null\",\n    \"array\",\n    \"object\",\n    \"unknown\",\n    \"promise\",\n    \"void\",\n    \"never\",\n    \"map\",\n    \"set\",\n]);\nexport const getParsedType = (data) => {\n    const t = typeof data;\n    switch (t) {\n        case \"undefined\":\n            return ZodParsedType.undefined;\n        case \"string\":\n            return ZodParsedType.string;\n        case \"number\":\n            return Number.isNaN(data) ? ZodParsedType.nan : ZodParsedType.number;\n        case \"boolean\":\n            return ZodParsedType.boolean;\n        case \"function\":\n            return ZodParsedType.function;\n        case \"bigint\":\n            return ZodParsedType.bigint;\n        case \"symbol\":\n            return ZodParsedType.symbol;\n        case \"object\":\n            if (Array.isArray(data)) {\n                return ZodParsedType.array;\n            }\n            if (data === null) {\n                return ZodParsedType.null;\n            }\n            if (data.then && typeof data.then === \"function\" && data.catch && typeof data.catch === \"function\") {\n                return ZodParsedType.promise;\n            }\n            if (typeof Map !== \"undefined\" && data instanceof Map) {\n                return ZodParsedType.map;\n            }\n            if (typeof Set !== \"undefined\" && data instanceof Set) {\n                return ZodParsedType.set;\n            }\n            if (typeof Date !== \"undefined\" && data instanceof Date) {\n                return ZodParsedType.date;\n            }\n            return ZodParsedType.object;\n        default:\n            return ZodParsedType.unknown;\n    }\n};\n","import { util } from \"./helpers/util.js\";\nexport const ZodIssueCode = util.arrayToEnum([\n    \"invalid_type\",\n    \"invalid_literal\",\n    \"custom\",\n    \"invalid_union\",\n    \"invalid_union_discriminator\",\n    \"invalid_enum_value\",\n    \"unrecognized_keys\",\n    \"invalid_arguments\",\n    \"invalid_return_type\",\n    \"invalid_date\",\n    \"invalid_string\",\n    \"too_small\",\n    \"too_big\",\n    \"invalid_intersection_types\",\n    \"not_multiple_of\",\n    \"not_finite\",\n]);\nexport const quotelessJson = (obj) => {\n    const json = JSON.stringify(obj, null, 2);\n    return json.replace(/\"([^\"]+)\":/g, \"$1:\");\n};\nexport class ZodError extends Error {\n    get errors() {\n        return this.issues;\n    }\n    constructor(issues) {\n        super();\n        this.issues = [];\n        this.addIssue = (sub) => {\n            this.issues = [...this.issues, sub];\n        };\n        this.addIssues = (subs = []) => {\n            this.issues = [...this.issues, ...subs];\n        };\n        const actualProto = new.target.prototype;\n        if (Object.setPrototypeOf) {\n            // eslint-disable-next-line ban/ban\n            Object.setPrototypeOf(this, actualProto);\n        }\n        else {\n            this.__proto__ = actualProto;\n        }\n        this.name = \"ZodError\";\n        this.issues = issues;\n    }\n    format(_mapper) {\n        const mapper = _mapper ||\n            function (issue) {\n                return issue.message;\n            };\n        const fieldErrors = { _errors: [] };\n        const processError = (error) => {\n            for (const issue of error.issues) {\n                if (issue.code === \"invalid_union\") {\n                    issue.unionErrors.map(processError);\n                }\n                else if (issue.code === \"invalid_return_type\") {\n                    processError(issue.returnTypeError);\n                }\n                else if (issue.code === \"invalid_arguments\") {\n                    processError(issue.argumentsError);\n                }\n                else if (issue.path.length === 0) {\n                    fieldErrors._errors.push(mapper(issue));\n                }\n                else {\n                    let curr = fieldErrors;\n                    let i = 0;\n                    while (i < issue.path.length) {\n                        const el = issue.path[i];\n                        const terminal = i === issue.path.length - 1;\n                        if (!terminal) {\n                            curr[el] = curr[el] || { _errors: [] };\n                            // if (typeof el === \"string\") {\n                            //   curr[el] = curr[el] || { _errors: [] };\n                            // } else if (typeof el === \"number\") {\n                            //   const errorArray: any = [];\n                            //   errorArray._errors = [];\n                            //   curr[el] = curr[el] || errorArray;\n                            // }\n                        }\n                        else {\n                            curr[el] = curr[el] || { _errors: [] };\n                            curr[el]._errors.push(mapper(issue));\n                        }\n                        curr = curr[el];\n                        i++;\n                    }\n                }\n            }\n        };\n        processError(this);\n        return fieldErrors;\n    }\n    static assert(value) {\n        if (!(value instanceof ZodError)) {\n            throw new Error(`Not a ZodError: ${value}`);\n        }\n    }\n    toString() {\n        return this.message;\n    }\n    get message() {\n        return JSON.stringify(this.issues, util.jsonStringifyReplacer, 2);\n    }\n    get isEmpty() {\n        return this.issues.length === 0;\n    }\n    flatten(mapper = (issue) => issue.message) {\n        const fieldErrors = {};\n        const formErrors = [];\n        for (const sub of this.issues) {\n            if (sub.path.length > 0) {\n                const firstEl = sub.path[0];\n                fieldErrors[firstEl] = fieldErrors[firstEl] || [];\n                fieldErrors[firstEl].push(mapper(sub));\n            }\n            else {\n                formErrors.push(mapper(sub));\n            }\n        }\n        return { formErrors, fieldErrors };\n    }\n    get formErrors() {\n        return this.flatten();\n    }\n}\nZodError.create = (issues) => {\n    const error = new ZodError(issues);\n    return error;\n};\n","import { ZodIssueCode } from \"../ZodError.js\";\nimport { util, ZodParsedType } from \"../helpers/util.js\";\nconst errorMap = (issue, _ctx) => {\n    let message;\n    switch (issue.code) {\n        case ZodIssueCode.invalid_type:\n            if (issue.received === ZodParsedType.undefined) {\n                message = \"Required\";\n            }\n            else {\n                message = `Expected ${issue.expected}, received ${issue.received}`;\n            }\n            break;\n        case ZodIssueCode.invalid_literal:\n            message = `Invalid literal value, expected ${JSON.stringify(issue.expected, util.jsonStringifyReplacer)}`;\n            break;\n        case ZodIssueCode.unrecognized_keys:\n            message = `Unrecognized key(s) in object: ${util.joinValues(issue.keys, \", \")}`;\n            break;\n        case ZodIssueCode.invalid_union:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_union_discriminator:\n            message = `Invalid discriminator value. Expected ${util.joinValues(issue.options)}`;\n            break;\n        case ZodIssueCode.invalid_enum_value:\n            message = `Invalid enum value. Expected ${util.joinValues(issue.options)}, received '${issue.received}'`;\n            break;\n        case ZodIssueCode.invalid_arguments:\n            message = `Invalid function arguments`;\n            break;\n        case ZodIssueCode.invalid_return_type:\n            message = `Invalid function return type`;\n            break;\n        case ZodIssueCode.invalid_date:\n            message = `Invalid date`;\n            break;\n        case ZodIssueCode.invalid_string:\n            if (typeof issue.validation === \"object\") {\n                if (\"includes\" in issue.validation) {\n                    message = `Invalid input: must include \"${issue.validation.includes}\"`;\n                    if (typeof issue.validation.position === \"number\") {\n                        message = `${message} at one or more positions greater than or equal to ${issue.validation.position}`;\n                    }\n                }\n                else if (\"startsWith\" in issue.validation) {\n                    message = `Invalid input: must start with \"${issue.validation.startsWith}\"`;\n                }\n                else if (\"endsWith\" in issue.validation) {\n                    message = `Invalid input: must end with \"${issue.validation.endsWith}\"`;\n                }\n                else {\n                    util.assertNever(issue.validation);\n                }\n            }\n            else if (issue.validation !== \"regex\") {\n                message = `Invalid ${issue.validation}`;\n            }\n            else {\n                message = \"Invalid\";\n            }\n            break;\n        case ZodIssueCode.too_small:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `more than`} ${issue.minimum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `over`} ${issue.minimum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"bigint\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${new Date(Number(issue.minimum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.too_big:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `less than`} ${issue.maximum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `under`} ${issue.maximum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"bigint\")\n                message = `BigInt must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly` : issue.inclusive ? `smaller than or equal to` : `smaller than`} ${new Date(Number(issue.maximum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.custom:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_intersection_types:\n            message = `Intersection results could not be merged`;\n            break;\n        case ZodIssueCode.not_multiple_of:\n            message = `Number must be a multiple of ${issue.multipleOf}`;\n            break;\n        case ZodIssueCode.not_finite:\n            message = \"Number must be finite\";\n            break;\n        default:\n            message = _ctx.defaultError;\n            util.assertNever(issue);\n    }\n    return { message };\n};\nexport default errorMap;\n","import defaultErrorMap from \"./locales/en.js\";\nlet overrideErrorMap = defaultErrorMap;\nexport { defaultErrorMap };\nexport function setErrorMap(map) {\n    overrideErrorMap = map;\n}\nexport function getErrorMap() {\n    return overrideErrorMap;\n}\n","import { getErrorMap } from \"../errors.js\";\nimport defaultErrorMap from \"../locales/en.js\";\nexport const makeIssue = (params) => {\n    const { data, path, errorMaps, issueData } = params;\n    const fullPath = [...path, ...(issueData.path || [])];\n    const fullIssue = {\n        ...issueData,\n        path: fullPath,\n    };\n    if (issueData.message !== undefined) {\n        return {\n            ...issueData,\n            path: fullPath,\n            message: issueData.message,\n        };\n    }\n    let errorMessage = \"\";\n    const maps = errorMaps\n        .filter((m) => !!m)\n        .slice()\n        .reverse();\n    for (const map of maps) {\n        errorMessage = map(fullIssue, { data, defaultError: errorMessage }).message;\n    }\n    return {\n        ...issueData,\n        path: fullPath,\n        message: errorMessage,\n    };\n};\nexport const EMPTY_PATH = [];\nexport function addIssueToContext(ctx, issueData) {\n    const overrideMap = getErrorMap();\n    const issue = makeIssue({\n        issueData: issueData,\n        data: ctx.data,\n        path: ctx.path,\n        errorMaps: [\n            ctx.common.contextualErrorMap, // contextual error map is first priority\n            ctx.schemaErrorMap, // then schema-bound map if available\n            overrideMap, // then global override map\n            overrideMap === defaultErrorMap ? undefined : defaultErrorMap, // then global default map\n        ].filter((x) => !!x),\n    });\n    ctx.common.issues.push(issue);\n}\nexport class ParseStatus {\n    constructor() {\n        this.value = \"valid\";\n    }\n    dirty() {\n        if (this.value === \"valid\")\n            this.value = \"dirty\";\n    }\n    abort() {\n        if (this.value !== \"aborted\")\n            this.value = \"aborted\";\n    }\n    static mergeArray(status, results) {\n        const arrayValue = [];\n        for (const s of results) {\n            if (s.status === \"aborted\")\n                return INVALID;\n            if (s.status === \"dirty\")\n                status.dirty();\n            arrayValue.push(s.value);\n        }\n        return { status: status.value, value: arrayValue };\n    }\n    static async mergeObjectAsync(status, pairs) {\n        const syncPairs = [];\n        for (const pair of pairs) {\n            const key = await pair.key;\n            const value = await pair.value;\n            syncPairs.push({\n                key,\n                value,\n            });\n        }\n        return ParseStatus.mergeObjectSync(status, syncPairs);\n    }\n    static mergeObjectSync(status, pairs) {\n        const finalObject = {};\n        for (const pair of pairs) {\n            const { key, value } = pair;\n            if (key.status === \"aborted\")\n                return INVALID;\n            if (value.status === \"aborted\")\n                return INVALID;\n            if (key.status === \"dirty\")\n                status.dirty();\n            if (value.status === \"dirty\")\n                status.dirty();\n            if (key.value !== \"__proto__\" && (typeof value.value !== \"undefined\" || pair.alwaysSet)) {\n                finalObject[key.value] = value.value;\n            }\n        }\n        return { status: status.value, value: finalObject };\n    }\n}\nexport const INVALID = Object.freeze({\n    status: \"aborted\",\n});\nexport const DIRTY = (value) => ({ status: \"dirty\", value });\nexport const OK = (value) => ({ status: \"valid\", value });\nexport const isAborted = (x) => x.status === \"aborted\";\nexport const isDirty = (x) => x.status === \"dirty\";\nexport const isValid = (x) => x.status === \"valid\";\nexport const isAsync = (x) => typeof Promise !== \"undefined\" && x instanceof Promise;\n","export var errorUtil;\n(function (errorUtil) {\n    errorUtil.errToObj = (message) => typeof message === \"string\" ? { message } : message || {};\n    // biome-ignore lint:\n    errorUtil.toString = (message) => typeof message === \"string\" ? message : message?.message;\n})(errorUtil || (errorUtil = {}));\n","import { ZodError, ZodIssueCode, } from \"./ZodError.js\";\nimport { defaultErrorMap, getErrorMap } from \"./errors.js\";\nimport { errorUtil } from \"./helpers/errorUtil.js\";\nimport { DIRTY, INVALID, OK, ParseStatus, addIssueToContext, isAborted, isAsync, isDirty, isValid, makeIssue, } from \"./helpers/parseUtil.js\";\nimport { util, ZodParsedType, getParsedType } from \"./helpers/util.js\";\nclass ParseInputLazyPath {\n    constructor(parent, value, path, key) {\n        this._cachedPath = [];\n        this.parent = parent;\n        this.data = value;\n        this._path = path;\n        this._key = key;\n    }\n    get path() {\n        if (!this._cachedPath.length) {\n            if (Array.isArray(this._key)) {\n                this._cachedPath.push(...this._path, ...this._key);\n            }\n            else {\n                this._cachedPath.push(...this._path, this._key);\n            }\n        }\n        return this._cachedPath;\n    }\n}\nconst handleResult = (ctx, result) => {\n    if (isValid(result)) {\n        return { success: true, data: result.value };\n    }\n    else {\n        if (!ctx.common.issues.length) {\n            throw new Error(\"Validation failed but no issues detected.\");\n        }\n        return {\n            success: false,\n            get error() {\n                if (this._error)\n                    return this._error;\n                const error = new ZodError(ctx.common.issues);\n                this._error = error;\n                return this._error;\n            },\n        };\n    }\n};\nfunction processCreateParams(params) {\n    if (!params)\n        return {};\n    const { errorMap, invalid_type_error, required_error, description } = params;\n    if (errorMap && (invalid_type_error || required_error)) {\n        throw new Error(`Can't use \"invalid_type_error\" or \"required_error\" in conjunction with custom error map.`);\n    }\n    if (errorMap)\n        return { errorMap: errorMap, description };\n    const customMap = (iss, ctx) => {\n        const { message } = params;\n        if (iss.code === \"invalid_enum_value\") {\n            return { message: message ?? ctx.defaultError };\n        }\n        if (typeof ctx.data === \"undefined\") {\n            return { message: message ?? required_error ?? ctx.defaultError };\n        }\n        if (iss.code !== \"invalid_type\")\n            return { message: ctx.defaultError };\n        return { message: message ?? invalid_type_error ?? ctx.defaultError };\n    };\n    return { errorMap: customMap, description };\n}\nexport class ZodType {\n    get description() {\n        return this._def.description;\n    }\n    _getType(input) {\n        return getParsedType(input.data);\n    }\n    _getOrReturnCtx(input, ctx) {\n        return (ctx || {\n            common: input.parent.common,\n            data: input.data,\n            parsedType: getParsedType(input.data),\n            schemaErrorMap: this._def.errorMap,\n            path: input.path,\n            parent: input.parent,\n        });\n    }\n    _processInputParams(input) {\n        return {\n            status: new ParseStatus(),\n            ctx: {\n                common: input.parent.common,\n                data: input.data,\n                parsedType: getParsedType(input.data),\n                schemaErrorMap: this._def.errorMap,\n                path: input.path,\n                parent: input.parent,\n            },\n        };\n    }\n    _parseSync(input) {\n        const result = this._parse(input);\n        if (isAsync(result)) {\n            throw new Error(\"Synchronous parse encountered promise.\");\n        }\n        return result;\n    }\n    _parseAsync(input) {\n        const result = this._parse(input);\n        return Promise.resolve(result);\n    }\n    parse(data, params) {\n        const result = this.safeParse(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    safeParse(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: params?.async ?? false,\n                contextualErrorMap: params?.errorMap,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const result = this._parseSync({ data, path: ctx.path, parent: ctx });\n        return handleResult(ctx, result);\n    }\n    \"~validate\"(data) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: !!this[\"~standard\"].async,\n            },\n            path: [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        if (!this[\"~standard\"].async) {\n            try {\n                const result = this._parseSync({ data, path: [], parent: ctx });\n                return isValid(result)\n                    ? {\n                        value: result.value,\n                    }\n                    : {\n                        issues: ctx.common.issues,\n                    };\n            }\n            catch (err) {\n                if (err?.message?.toLowerCase()?.includes(\"encountered\")) {\n                    this[\"~standard\"].async = true;\n                }\n                ctx.common = {\n                    issues: [],\n                    async: true,\n                };\n            }\n        }\n        return this._parseAsync({ data, path: [], parent: ctx }).then((result) => isValid(result)\n            ? {\n                value: result.value,\n            }\n            : {\n                issues: ctx.common.issues,\n            });\n    }\n    async parseAsync(data, params) {\n        const result = await this.safeParseAsync(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    async safeParseAsync(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                contextualErrorMap: params?.errorMap,\n                async: true,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const maybeAsyncResult = this._parse({ data, path: ctx.path, parent: ctx });\n        const result = await (isAsync(maybeAsyncResult) ? maybeAsyncResult : Promise.resolve(maybeAsyncResult));\n        return handleResult(ctx, result);\n    }\n    refine(check, message) {\n        const getIssueProperties = (val) => {\n            if (typeof message === \"string\" || typeof message === \"undefined\") {\n                return { message };\n            }\n            else if (typeof message === \"function\") {\n                return message(val);\n            }\n            else {\n                return message;\n            }\n        };\n        return this._refinement((val, ctx) => {\n            const result = check(val);\n            const setError = () => ctx.addIssue({\n                code: ZodIssueCode.custom,\n                ...getIssueProperties(val),\n            });\n            if (typeof Promise !== \"undefined\" && result instanceof Promise) {\n                return result.then((data) => {\n                    if (!data) {\n                        setError();\n                        return false;\n                    }\n                    else {\n                        return true;\n                    }\n                });\n            }\n            if (!result) {\n                setError();\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    refinement(check, refinementData) {\n        return this._refinement((val, ctx) => {\n            if (!check(val)) {\n                ctx.addIssue(typeof refinementData === \"function\" ? refinementData(val, ctx) : refinementData);\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    _refinement(refinement) {\n        return new ZodEffects({\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"refinement\", refinement },\n        });\n    }\n    superRefine(refinement) {\n        return this._refinement(refinement);\n    }\n    constructor(def) {\n        /** Alias of safeParseAsync */\n        this.spa = this.safeParseAsync;\n        this._def = def;\n        this.parse = this.parse.bind(this);\n        this.safeParse = this.safeParse.bind(this);\n        this.parseAsync = this.parseAsync.bind(this);\n        this.safeParseAsync = this.safeParseAsync.bind(this);\n        this.spa = this.spa.bind(this);\n        this.refine = this.refine.bind(this);\n        this.refinement = this.refinement.bind(this);\n        this.superRefine = this.superRefine.bind(this);\n        this.optional = this.optional.bind(this);\n        this.nullable = this.nullable.bind(this);\n        this.nullish = this.nullish.bind(this);\n        this.array = this.array.bind(this);\n        this.promise = this.promise.bind(this);\n        this.or = this.or.bind(this);\n        this.and = this.and.bind(this);\n        this.transform = this.transform.bind(this);\n        this.brand = this.brand.bind(this);\n        this.default = this.default.bind(this);\n        this.catch = this.catch.bind(this);\n        this.describe = this.describe.bind(this);\n        this.pipe = this.pipe.bind(this);\n        this.readonly = this.readonly.bind(this);\n        this.isNullable = this.isNullable.bind(this);\n        this.isOptional = this.isOptional.bind(this);\n        this[\"~standard\"] = {\n            version: 1,\n            vendor: \"zod\",\n            validate: (data) => this[\"~validate\"](data),\n        };\n    }\n    optional() {\n        return ZodOptional.create(this, this._def);\n    }\n    nullable() {\n        return ZodNullable.create(this, this._def);\n    }\n    nullish() {\n        return this.nullable().optional();\n    }\n    array() {\n        return ZodArray.create(this);\n    }\n    promise() {\n        return ZodPromise.create(this, this._def);\n    }\n    or(option) {\n        return ZodUnion.create([this, option], this._def);\n    }\n    and(incoming) {\n        return ZodIntersection.create(this, incoming, this._def);\n    }\n    transform(transform) {\n        return new ZodEffects({\n            ...processCreateParams(this._def),\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"transform\", transform },\n        });\n    }\n    default(def) {\n        const defaultValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodDefault({\n            ...processCreateParams(this._def),\n            innerType: this,\n            defaultValue: defaultValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodDefault,\n        });\n    }\n    brand() {\n        return new ZodBranded({\n            typeName: ZodFirstPartyTypeKind.ZodBranded,\n            type: this,\n            ...processCreateParams(this._def),\n        });\n    }\n    catch(def) {\n        const catchValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodCatch({\n            ...processCreateParams(this._def),\n            innerType: this,\n            catchValue: catchValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodCatch,\n        });\n    }\n    describe(description) {\n        const This = this.constructor;\n        return new This({\n            ...this._def,\n            description,\n        });\n    }\n    pipe(target) {\n        return ZodPipeline.create(this, target);\n    }\n    readonly() {\n        return ZodReadonly.create(this);\n    }\n    isOptional() {\n        return this.safeParse(undefined).success;\n    }\n    isNullable() {\n        return this.safeParse(null).success;\n    }\n}\nconst cuidRegex = /^c[^\\s-]{8,}$/i;\nconst cuid2Regex = /^[0-9a-z]+$/;\nconst ulidRegex = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n// const uuidRegex =\n//   /^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i;\nconst uuidRegex = /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/i;\nconst nanoidRegex = /^[a-z0-9_-]{21}$/i;\nconst jwtRegex = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/;\nconst durationRegex = /^[-+]?P(?!$)(?:(?:[-+]?\\d+Y)|(?:[-+]?\\d+[.,]\\d+Y$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:(?:[-+]?\\d+W)|(?:[-+]?\\d+[.,]\\d+W$))?(?:(?:[-+]?\\d+D)|(?:[-+]?\\d+[.,]\\d+D$))?(?:T(?=[\\d+-])(?:(?:[-+]?\\d+H)|(?:[-+]?\\d+[.,]\\d+H$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:[-+]?\\d+(?:[.,]\\d+)?S)?)??$/;\n// from https://stackoverflow.com/a/46181/1550155\n// old version: too slow, didn't support unicode\n// const emailRegex = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i;\n//old email regex\n// const emailRegex = /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@((?!-)([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{1,})[^-<>()[\\].,;:\\s@\"]$/i;\n// eslint-disable-next-line\n// const emailRegex =\n//   /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$/;\n// const emailRegex =\n//   /^[a-zA-Z0-9\\.\\!\\#\\$\\%\\&\\'\\*\\+\\/\\=\\?\\^\\_\\`\\{\\|\\}\\~\\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n// const emailRegex =\n//   /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i;\nconst emailRegex = /^(?!\\.)(?!.*\\.\\.)([A-Z0-9_'+\\-\\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\\-]*\\.)+[A-Z]{2,}$/i;\n// const emailRegex =\n//   /^[a-z0-9.!#$%&*+/=?^_`{|}~-]+@[a-z0-9-]+(?:\\.[a-z0-9\\-]+)*$/i;\n// from https://thekevinscott.com/emojis-in-javascript/#writing-a-regular-expression\nconst _emojiRegex = `^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$`;\nlet emojiRegex;\n// faster, simpler, safer\nconst ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/;\nconst ipv4CidrRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/;\n// const ipv6Regex =\n// /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;\nconst ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;\nconst ipv6CidrRegex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/;\n// https://stackoverflow.com/questions/7860392/determine-if-string-is-in-base64-using-javascript\nconst base64Regex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n// https://base64.guru/standards/base64url\nconst base64urlRegex = /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/;\n// simple\n// const dateRegexSource = `\\\\d{4}-\\\\d{2}-\\\\d{2}`;\n// no leap year validation\n// const dateRegexSource = `\\\\d{4}-((0[13578]|10|12)-31|(0[13-9]|1[0-2])-30|(0[1-9]|1[0-2])-(0[1-9]|1\\\\d|2\\\\d))`;\n// with leap year validation\nconst dateRegexSource = `((\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\\\d|30)|(02)-(0[1-9]|1\\\\d|2[0-8])))`;\nconst dateRegex = new RegExp(`^${dateRegexSource}$`);\nfunction timeRegexSource(args) {\n    let secondsRegexSource = `[0-5]\\\\d`;\n    if (args.precision) {\n        secondsRegexSource = `${secondsRegexSource}\\\\.\\\\d{${args.precision}}`;\n    }\n    else if (args.precision == null) {\n        secondsRegexSource = `${secondsRegexSource}(\\\\.\\\\d+)?`;\n    }\n    const secondsQuantifier = args.precision ? \"+\" : \"?\"; // require seconds if precision is nonzero\n    return `([01]\\\\d|2[0-3]):[0-5]\\\\d(:${secondsRegexSource})${secondsQuantifier}`;\n}\nfunction timeRegex(args) {\n    return new RegExp(`^${timeRegexSource(args)}$`);\n}\n// Adapted from https://stackoverflow.com/a/3143231\nexport function datetimeRegex(args) {\n    let regex = `${dateRegexSource}T${timeRegexSource(args)}`;\n    const opts = [];\n    opts.push(args.local ? `Z?` : `Z`);\n    if (args.offset)\n        opts.push(`([+-]\\\\d{2}:?\\\\d{2})`);\n    regex = `${regex}(${opts.join(\"|\")})`;\n    return new RegExp(`^${regex}$`);\n}\nfunction isValidIP(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4Regex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6Regex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nfunction isValidJWT(jwt, alg) {\n    if (!jwtRegex.test(jwt))\n        return false;\n    try {\n        const [header] = jwt.split(\".\");\n        if (!header)\n            return false;\n        // Convert base64url to base64\n        const base64 = header\n            .replace(/-/g, \"+\")\n            .replace(/_/g, \"/\")\n            .padEnd(header.length + ((4 - (header.length % 4)) % 4), \"=\");\n        const decoded = JSON.parse(atob(base64));\n        if (typeof decoded !== \"object\" || decoded === null)\n            return false;\n        if (\"typ\" in decoded && decoded?.typ !== \"JWT\")\n            return false;\n        if (!decoded.alg)\n            return false;\n        if (alg && decoded.alg !== alg)\n            return false;\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nfunction isValidCidr(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4CidrRegex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6CidrRegex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nexport class ZodString extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = String(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.string) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.string,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.length < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.length > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"length\") {\n                const tooBig = input.data.length > check.value;\n                const tooSmall = input.data.length < check.value;\n                if (tooBig || tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    if (tooBig) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_big,\n                            maximum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    else if (tooSmall) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_small,\n                            minimum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"email\") {\n                if (!emailRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"email\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"emoji\") {\n                if (!emojiRegex) {\n                    emojiRegex = new RegExp(_emojiRegex, \"u\");\n                }\n                if (!emojiRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"emoji\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"uuid\") {\n                if (!uuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"uuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"nanoid\") {\n                if (!nanoidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"nanoid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid\") {\n                if (!cuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid2\") {\n                if (!cuid2Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid2\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ulid\") {\n                if (!ulidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ulid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"url\") {\n                try {\n                    new URL(input.data);\n                }\n                catch {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"regex\") {\n                check.regex.lastIndex = 0;\n                const testResult = check.regex.test(input.data);\n                if (!testResult) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"regex\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"trim\") {\n                input.data = input.data.trim();\n            }\n            else if (check.kind === \"includes\") {\n                if (!input.data.includes(check.value, check.position)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { includes: check.value, position: check.position },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"toLowerCase\") {\n                input.data = input.data.toLowerCase();\n            }\n            else if (check.kind === \"toUpperCase\") {\n                input.data = input.data.toUpperCase();\n            }\n            else if (check.kind === \"startsWith\") {\n                if (!input.data.startsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { startsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"endsWith\") {\n                if (!input.data.endsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { endsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"datetime\") {\n                const regex = datetimeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"datetime\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"date\") {\n                const regex = dateRegex;\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"date\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"time\") {\n                const regex = timeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"time\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"duration\") {\n                if (!durationRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"duration\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ip\") {\n                if (!isValidIP(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ip\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"jwt\") {\n                if (!isValidJWT(input.data, check.alg)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"jwt\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cidr\") {\n                if (!isValidCidr(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cidr\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64\") {\n                if (!base64Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64url\") {\n                if (!base64urlRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _regex(regex, validation, message) {\n        return this.refinement((data) => regex.test(data), {\n            validation,\n            code: ZodIssueCode.invalid_string,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    _addCheck(check) {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    email(message) {\n        return this._addCheck({ kind: \"email\", ...errorUtil.errToObj(message) });\n    }\n    url(message) {\n        return this._addCheck({ kind: \"url\", ...errorUtil.errToObj(message) });\n    }\n    emoji(message) {\n        return this._addCheck({ kind: \"emoji\", ...errorUtil.errToObj(message) });\n    }\n    uuid(message) {\n        return this._addCheck({ kind: \"uuid\", ...errorUtil.errToObj(message) });\n    }\n    nanoid(message) {\n        return this._addCheck({ kind: \"nanoid\", ...errorUtil.errToObj(message) });\n    }\n    cuid(message) {\n        return this._addCheck({ kind: \"cuid\", ...errorUtil.errToObj(message) });\n    }\n    cuid2(message) {\n        return this._addCheck({ kind: \"cuid2\", ...errorUtil.errToObj(message) });\n    }\n    ulid(message) {\n        return this._addCheck({ kind: \"ulid\", ...errorUtil.errToObj(message) });\n    }\n    base64(message) {\n        return this._addCheck({ kind: \"base64\", ...errorUtil.errToObj(message) });\n    }\n    base64url(message) {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return this._addCheck({\n            kind: \"base64url\",\n            ...errorUtil.errToObj(message),\n        });\n    }\n    jwt(options) {\n        return this._addCheck({ kind: \"jwt\", ...errorUtil.errToObj(options) });\n    }\n    ip(options) {\n        return this._addCheck({ kind: \"ip\", ...errorUtil.errToObj(options) });\n    }\n    cidr(options) {\n        return this._addCheck({ kind: \"cidr\", ...errorUtil.errToObj(options) });\n    }\n    datetime(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"datetime\",\n                precision: null,\n                offset: false,\n                local: false,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"datetime\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            offset: options?.offset ?? false,\n            local: options?.local ?? false,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    date(message) {\n        return this._addCheck({ kind: \"date\", message });\n    }\n    time(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"time\",\n                precision: null,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"time\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    duration(message) {\n        return this._addCheck({ kind: \"duration\", ...errorUtil.errToObj(message) });\n    }\n    regex(regex, message) {\n        return this._addCheck({\n            kind: \"regex\",\n            regex: regex,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    includes(value, options) {\n        return this._addCheck({\n            kind: \"includes\",\n            value: value,\n            position: options?.position,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    startsWith(value, message) {\n        return this._addCheck({\n            kind: \"startsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    endsWith(value, message) {\n        return this._addCheck({\n            kind: \"endsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    min(minLength, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    max(maxLength, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    length(len, message) {\n        return this._addCheck({\n            kind: \"length\",\n            value: len,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    /**\n     * Equivalent to `.min(1)`\n     */\n    nonempty(message) {\n        return this.min(1, errorUtil.errToObj(message));\n    }\n    trim() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"trim\" }],\n        });\n    }\n    toLowerCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toLowerCase\" }],\n        });\n    }\n    toUpperCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toUpperCase\" }],\n        });\n    }\n    get isDatetime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"datetime\");\n    }\n    get isDate() {\n        return !!this._def.checks.find((ch) => ch.kind === \"date\");\n    }\n    get isTime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"time\");\n    }\n    get isDuration() {\n        return !!this._def.checks.find((ch) => ch.kind === \"duration\");\n    }\n    get isEmail() {\n        return !!this._def.checks.find((ch) => ch.kind === \"email\");\n    }\n    get isURL() {\n        return !!this._def.checks.find((ch) => ch.kind === \"url\");\n    }\n    get isEmoji() {\n        return !!this._def.checks.find((ch) => ch.kind === \"emoji\");\n    }\n    get isUUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"uuid\");\n    }\n    get isNANOID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"nanoid\");\n    }\n    get isCUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid\");\n    }\n    get isCUID2() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid2\");\n    }\n    get isULID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ulid\");\n    }\n    get isIP() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ip\");\n    }\n    get isCIDR() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cidr\");\n    }\n    get isBase64() {\n        return !!this._def.checks.find((ch) => ch.kind === \"base64\");\n    }\n    get isBase64url() {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return !!this._def.checks.find((ch) => ch.kind === \"base64url\");\n    }\n    get minLength() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxLength() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodString.create = (params) => {\n    return new ZodString({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodString,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\n// https://stackoverflow.com/questions/3966484/why-does-modulus-operator-return-fractional-number-in-javascript/31711034#31711034\nfunction floatSafeRemainder(val, step) {\n    const valDecCount = (val.toString().split(\".\")[1] || \"\").length;\n    const stepDecCount = (step.toString().split(\".\")[1] || \"\").length;\n    const decCount = valDecCount > stepDecCount ? valDecCount : stepDecCount;\n    const valInt = Number.parseInt(val.toFixed(decCount).replace(\".\", \"\"));\n    const stepInt = Number.parseInt(step.toFixed(decCount).replace(\".\", \"\"));\n    return (valInt % stepInt) / 10 ** decCount;\n}\nexport class ZodNumber extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n        this.step = this.multipleOf;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Number(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.number) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.number,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"int\") {\n                if (!util.isInteger(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_type,\n                        expected: \"integer\",\n                        received: \"float\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (floatSafeRemainder(input.data, check.value) !== 0) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"finite\") {\n                if (!Number.isFinite(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_finite,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    int(message) {\n        return this._addCheck({\n            kind: \"int\",\n            message: errorUtil.toString(message),\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value: value,\n            message: errorUtil.toString(message),\n        });\n    }\n    finite(message) {\n        return this._addCheck({\n            kind: \"finite\",\n            message: errorUtil.toString(message),\n        });\n    }\n    safe(message) {\n        return this._addCheck({\n            kind: \"min\",\n            inclusive: true,\n            value: Number.MIN_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        })._addCheck({\n            kind: \"max\",\n            inclusive: true,\n            value: Number.MAX_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n    get isInt() {\n        return !!this._def.checks.find((ch) => ch.kind === \"int\" || (ch.kind === \"multipleOf\" && util.isInteger(ch.value)));\n    }\n    get isFinite() {\n        let max = null;\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"finite\" || ch.kind === \"int\" || ch.kind === \"multipleOf\") {\n                return true;\n            }\n            else if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n            else if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return Number.isFinite(min) && Number.isFinite(max);\n    }\n}\nZodNumber.create = (params) => {\n    return new ZodNumber({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodNumber,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBigInt extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            try {\n                input.data = BigInt(input.data);\n            }\n            catch {\n                return this._getInvalidInput(input);\n            }\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.bigint) {\n            return this._getInvalidInput(input);\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        type: \"bigint\",\n                        minimum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        type: \"bigint\",\n                        maximum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (input.data % check.value !== BigInt(0)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _getInvalidInput(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.bigint,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodBigInt.create = (params) => {\n    return new ZodBigInt({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodBigInt,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBoolean extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Boolean(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.boolean) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.boolean,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodBoolean.create = (params) => {\n    return new ZodBoolean({\n        typeName: ZodFirstPartyTypeKind.ZodBoolean,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDate extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = new Date(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.date) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.date,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (Number.isNaN(input.data.getTime())) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_date,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.getTime() < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        minimum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.getTime() > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        maximum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return {\n            status: status.value,\n            value: new Date(input.data.getTime()),\n        };\n    }\n    _addCheck(check) {\n        return new ZodDate({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    min(minDate, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    max(maxDate, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    get minDate() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min != null ? new Date(min) : null;\n    }\n    get maxDate() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max != null ? new Date(max) : null;\n    }\n}\nZodDate.create = (params) => {\n    return new ZodDate({\n        checks: [],\n        coerce: params?.coerce || false,\n        typeName: ZodFirstPartyTypeKind.ZodDate,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSymbol extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.symbol) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.symbol,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodSymbol.create = (params) => {\n    return new ZodSymbol({\n        typeName: ZodFirstPartyTypeKind.ZodSymbol,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUndefined extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.undefined,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodUndefined.create = (params) => {\n    return new ZodUndefined({\n        typeName: ZodFirstPartyTypeKind.ZodUndefined,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNull extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.null) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.null,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodNull.create = (params) => {\n    return new ZodNull({\n        typeName: ZodFirstPartyTypeKind.ZodNull,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodAny extends ZodType {\n    constructor() {\n        super(...arguments);\n        // to prevent instances of other classes from extending ZodAny. this causes issues with catchall in ZodObject.\n        this._any = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodAny.create = (params) => {\n    return new ZodAny({\n        typeName: ZodFirstPartyTypeKind.ZodAny,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnknown extends ZodType {\n    constructor() {\n        super(...arguments);\n        // required\n        this._unknown = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodUnknown.create = (params) => {\n    return new ZodUnknown({\n        typeName: ZodFirstPartyTypeKind.ZodUnknown,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNever extends ZodType {\n    _parse(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.never,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n}\nZodNever.create = (params) => {\n    return new ZodNever({\n        typeName: ZodFirstPartyTypeKind.ZodNever,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodVoid extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.void,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodVoid.create = (params) => {\n    return new ZodVoid({\n        typeName: ZodFirstPartyTypeKind.ZodVoid,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodArray extends ZodType {\n    _parse(input) {\n        const { ctx, status } = this._processInputParams(input);\n        const def = this._def;\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (def.exactLength !== null) {\n            const tooBig = ctx.data.length > def.exactLength.value;\n            const tooSmall = ctx.data.length < def.exactLength.value;\n            if (tooBig || tooSmall) {\n                addIssueToContext(ctx, {\n                    code: tooBig ? ZodIssueCode.too_big : ZodIssueCode.too_small,\n                    minimum: (tooSmall ? def.exactLength.value : undefined),\n                    maximum: (tooBig ? def.exactLength.value : undefined),\n                    type: \"array\",\n                    inclusive: true,\n                    exact: true,\n                    message: def.exactLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.minLength !== null) {\n            if (ctx.data.length < def.minLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxLength !== null) {\n            if (ctx.data.length > def.maxLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.all([...ctx.data].map((item, i) => {\n                return def.type._parseAsync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n            })).then((result) => {\n                return ParseStatus.mergeArray(status, result);\n            });\n        }\n        const result = [...ctx.data].map((item, i) => {\n            return def.type._parseSync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n        });\n        return ParseStatus.mergeArray(status, result);\n    }\n    get element() {\n        return this._def.type;\n    }\n    min(minLength, message) {\n        return new ZodArray({\n            ...this._def,\n            minLength: { value: minLength, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxLength, message) {\n        return new ZodArray({\n            ...this._def,\n            maxLength: { value: maxLength, message: errorUtil.toString(message) },\n        });\n    }\n    length(len, message) {\n        return new ZodArray({\n            ...this._def,\n            exactLength: { value: len, message: errorUtil.toString(message) },\n        });\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodArray.create = (schema, params) => {\n    return new ZodArray({\n        type: schema,\n        minLength: null,\n        maxLength: null,\n        exactLength: null,\n        typeName: ZodFirstPartyTypeKind.ZodArray,\n        ...processCreateParams(params),\n    });\n};\nfunction deepPartialify(schema) {\n    if (schema instanceof ZodObject) {\n        const newShape = {};\n        for (const key in schema.shape) {\n            const fieldSchema = schema.shape[key];\n            newShape[key] = ZodOptional.create(deepPartialify(fieldSchema));\n        }\n        return new ZodObject({\n            ...schema._def,\n            shape: () => newShape,\n        });\n    }\n    else if (schema instanceof ZodArray) {\n        return new ZodArray({\n            ...schema._def,\n            type: deepPartialify(schema.element),\n        });\n    }\n    else if (schema instanceof ZodOptional) {\n        return ZodOptional.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodNullable) {\n        return ZodNullable.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodTuple) {\n        return ZodTuple.create(schema.items.map((item) => deepPartialify(item)));\n    }\n    else {\n        return schema;\n    }\n}\nexport class ZodObject extends ZodType {\n    constructor() {\n        super(...arguments);\n        this._cached = null;\n        /**\n         * @deprecated In most cases, this is no longer needed - unknown properties are now silently stripped.\n         * If you want to pass through unknown properties, use `.passthrough()` instead.\n         */\n        this.nonstrict = this.passthrough;\n        // extend<\n        //   Augmentation extends ZodRawShape,\n        //   NewOutput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_output\"]\n        //       : k extends keyof Output\n        //       ? Output[k]\n        //       : never;\n        //   }>,\n        //   NewInput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_input\"]\n        //       : k extends keyof Input\n        //       ? Input[k]\n        //       : never;\n        //   }>\n        // >(\n        //   augmentation: Augmentation\n        // ): ZodObject<\n        //   extendShape<T, Augmentation>,\n        //   UnknownKeys,\n        //   Catchall,\n        //   NewOutput,\n        //   NewInput\n        // > {\n        //   return new ZodObject({\n        //     ...this._def,\n        //     shape: () => ({\n        //       ...this._def.shape(),\n        //       ...augmentation,\n        //     }),\n        //   }) as any;\n        // }\n        /**\n         * @deprecated Use `.extend` instead\n         *  */\n        this.augment = this.extend;\n    }\n    _getCached() {\n        if (this._cached !== null)\n            return this._cached;\n        const shape = this._def.shape();\n        const keys = util.objectKeys(shape);\n        this._cached = { shape, keys };\n        return this._cached;\n    }\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.object) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const { status, ctx } = this._processInputParams(input);\n        const { shape, keys: shapeKeys } = this._getCached();\n        const extraKeys = [];\n        if (!(this._def.catchall instanceof ZodNever && this._def.unknownKeys === \"strip\")) {\n            for (const key in ctx.data) {\n                if (!shapeKeys.includes(key)) {\n                    extraKeys.push(key);\n                }\n            }\n        }\n        const pairs = [];\n        for (const key of shapeKeys) {\n            const keyValidator = shape[key];\n            const value = ctx.data[key];\n            pairs.push({\n                key: { status: \"valid\", value: key },\n                value: keyValidator._parse(new ParseInputLazyPath(ctx, value, ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (this._def.catchall instanceof ZodNever) {\n            const unknownKeys = this._def.unknownKeys;\n            if (unknownKeys === \"passthrough\") {\n                for (const key of extraKeys) {\n                    pairs.push({\n                        key: { status: \"valid\", value: key },\n                        value: { status: \"valid\", value: ctx.data[key] },\n                    });\n                }\n            }\n            else if (unknownKeys === \"strict\") {\n                if (extraKeys.length > 0) {\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.unrecognized_keys,\n                        keys: extraKeys,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (unknownKeys === \"strip\") {\n            }\n            else {\n                throw new Error(`Internal ZodObject error: invalid unknownKeys value.`);\n            }\n        }\n        else {\n            // run catchall validation\n            const catchall = this._def.catchall;\n            for (const key of extraKeys) {\n                const value = ctx.data[key];\n                pairs.push({\n                    key: { status: \"valid\", value: key },\n                    value: catchall._parse(new ParseInputLazyPath(ctx, value, ctx.path, key) //, ctx.child(key), value, getParsedType(value)\n                    ),\n                    alwaysSet: key in ctx.data,\n                });\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.resolve()\n                .then(async () => {\n                const syncPairs = [];\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    syncPairs.push({\n                        key,\n                        value,\n                        alwaysSet: pair.alwaysSet,\n                    });\n                }\n                return syncPairs;\n            })\n                .then((syncPairs) => {\n                return ParseStatus.mergeObjectSync(status, syncPairs);\n            });\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get shape() {\n        return this._def.shape();\n    }\n    strict(message) {\n        errorUtil.errToObj;\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strict\",\n            ...(message !== undefined\n                ? {\n                    errorMap: (issue, ctx) => {\n                        const defaultError = this._def.errorMap?.(issue, ctx).message ?? ctx.defaultError;\n                        if (issue.code === \"unrecognized_keys\")\n                            return {\n                                message: errorUtil.errToObj(message).message ?? defaultError,\n                            };\n                        return {\n                            message: defaultError,\n                        };\n                    },\n                }\n                : {}),\n        });\n    }\n    strip() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strip\",\n        });\n    }\n    passthrough() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"passthrough\",\n        });\n    }\n    // const AugmentFactory =\n    //   <Def extends ZodObjectDef>(def: Def) =>\n    //   <Augmentation extends ZodRawShape>(\n    //     augmentation: Augmentation\n    //   ): ZodObject<\n    //     extendShape<ReturnType<Def[\"shape\"]>, Augmentation>,\n    //     Def[\"unknownKeys\"],\n    //     Def[\"catchall\"]\n    //   > => {\n    //     return new ZodObject({\n    //       ...def,\n    //       shape: () => ({\n    //         ...def.shape(),\n    //         ...augmentation,\n    //       }),\n    //     }) as any;\n    //   };\n    extend(augmentation) {\n        return new ZodObject({\n            ...this._def,\n            shape: () => ({\n                ...this._def.shape(),\n                ...augmentation,\n            }),\n        });\n    }\n    /**\n     * Prior to zod@1.0.12 there was a bug in the\n     * inferred type of merged objects. Please\n     * upgrade if you are experiencing issues.\n     */\n    merge(merging) {\n        const merged = new ZodObject({\n            unknownKeys: merging._def.unknownKeys,\n            catchall: merging._def.catchall,\n            shape: () => ({\n                ...this._def.shape(),\n                ...merging._def.shape(),\n            }),\n            typeName: ZodFirstPartyTypeKind.ZodObject,\n        });\n        return merged;\n    }\n    // merge<\n    //   Incoming extends AnyZodObject,\n    //   Augmentation extends Incoming[\"shape\"],\n    //   NewOutput extends {\n    //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_output\"]\n    //       : k extends keyof Output\n    //       ? Output[k]\n    //       : never;\n    //   },\n    //   NewInput extends {\n    //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_input\"]\n    //       : k extends keyof Input\n    //       ? Input[k]\n    //       : never;\n    //   }\n    // >(\n    //   merging: Incoming\n    // ): ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"],\n    //   NewOutput,\n    //   NewInput\n    // > {\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    setKey(key, schema) {\n        return this.augment({ [key]: schema });\n    }\n    // merge<Incoming extends AnyZodObject>(\n    //   merging: Incoming\n    // ): //ZodObject<T & Incoming[\"_shape\"], UnknownKeys, Catchall> = (merging) => {\n    // ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"]\n    // > {\n    //   // const mergedShape = objectUtil.mergeShapes(\n    //   //   this._def.shape(),\n    //   //   merging._def.shape()\n    //   // );\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    catchall(index) {\n        return new ZodObject({\n            ...this._def,\n            catchall: index,\n        });\n    }\n    pick(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(mask)) {\n            if (mask[key] && this.shape[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    omit(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (!mask[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    /**\n     * @deprecated\n     */\n    deepPartial() {\n        return deepPartialify(this);\n    }\n    partial(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            const fieldSchema = this.shape[key];\n            if (mask && !mask[key]) {\n                newShape[key] = fieldSchema;\n            }\n            else {\n                newShape[key] = fieldSchema.optional();\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    required(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (mask && !mask[key]) {\n                newShape[key] = this.shape[key];\n            }\n            else {\n                const fieldSchema = this.shape[key];\n                let newField = fieldSchema;\n                while (newField instanceof ZodOptional) {\n                    newField = newField._def.innerType;\n                }\n                newShape[key] = newField;\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    keyof() {\n        return createZodEnum(util.objectKeys(this.shape));\n    }\n}\nZodObject.create = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.strictCreate = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strict\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.lazycreate = (shape, params) => {\n    return new ZodObject({\n        shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const options = this._def.options;\n        function handleResults(results) {\n            // return first issue-free validation if it exists\n            for (const result of results) {\n                if (result.result.status === \"valid\") {\n                    return result.result;\n                }\n            }\n            for (const result of results) {\n                if (result.result.status === \"dirty\") {\n                    // add issues from dirty option\n                    ctx.common.issues.push(...result.ctx.common.issues);\n                    return result.result;\n                }\n            }\n            // return invalid\n            const unionErrors = results.map((result) => new ZodError(result.ctx.common.issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return Promise.all(options.map(async (option) => {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                return {\n                    result: await option._parseAsync({\n                        data: ctx.data,\n                        path: ctx.path,\n                        parent: childCtx,\n                    }),\n                    ctx: childCtx,\n                };\n            })).then(handleResults);\n        }\n        else {\n            let dirty = undefined;\n            const issues = [];\n            for (const option of options) {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                const result = option._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: childCtx,\n                });\n                if (result.status === \"valid\") {\n                    return result;\n                }\n                else if (result.status === \"dirty\" && !dirty) {\n                    dirty = { result, ctx: childCtx };\n                }\n                if (childCtx.common.issues.length) {\n                    issues.push(childCtx.common.issues);\n                }\n            }\n            if (dirty) {\n                ctx.common.issues.push(...dirty.ctx.common.issues);\n                return dirty.result;\n            }\n            const unionErrors = issues.map((issues) => new ZodError(issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n    }\n    get options() {\n        return this._def.options;\n    }\n}\nZodUnion.create = (types, params) => {\n    return new ZodUnion({\n        options: types,\n        typeName: ZodFirstPartyTypeKind.ZodUnion,\n        ...processCreateParams(params),\n    });\n};\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\n//////////                                 //////////\n//////////      ZodDiscriminatedUnion      //////////\n//////////                                 //////////\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\nconst getDiscriminator = (type) => {\n    if (type instanceof ZodLazy) {\n        return getDiscriminator(type.schema);\n    }\n    else if (type instanceof ZodEffects) {\n        return getDiscriminator(type.innerType());\n    }\n    else if (type instanceof ZodLiteral) {\n        return [type.value];\n    }\n    else if (type instanceof ZodEnum) {\n        return type.options;\n    }\n    else if (type instanceof ZodNativeEnum) {\n        // eslint-disable-next-line ban/ban\n        return util.objectValues(type.enum);\n    }\n    else if (type instanceof ZodDefault) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else if (type instanceof ZodUndefined) {\n        return [undefined];\n    }\n    else if (type instanceof ZodNull) {\n        return [null];\n    }\n    else if (type instanceof ZodOptional) {\n        return [undefined, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodNullable) {\n        return [null, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodBranded) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodReadonly) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodCatch) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else {\n        return [];\n    }\n};\nexport class ZodDiscriminatedUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const discriminator = this.discriminator;\n        const discriminatorValue = ctx.data[discriminator];\n        const option = this.optionsMap.get(discriminatorValue);\n        if (!option) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union_discriminator,\n                options: Array.from(this.optionsMap.keys()),\n                path: [discriminator],\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return option._parseAsync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n        else {\n            return option._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n    }\n    get discriminator() {\n        return this._def.discriminator;\n    }\n    get options() {\n        return this._def.options;\n    }\n    get optionsMap() {\n        return this._def.optionsMap;\n    }\n    /**\n     * The constructor of the discriminated union schema. Its behaviour is very similar to that of the normal z.union() constructor.\n     * However, it only allows a union of objects, all of which need to share a discriminator property. This property must\n     * have a different value for each object in the union.\n     * @param discriminator the name of the discriminator property\n     * @param types an array of object schemas\n     * @param params\n     */\n    static create(discriminator, options, params) {\n        // Get all the valid discriminator values\n        const optionsMap = new Map();\n        // try {\n        for (const type of options) {\n            const discriminatorValues = getDiscriminator(type.shape[discriminator]);\n            if (!discriminatorValues.length) {\n                throw new Error(`A discriminator value for key \\`${discriminator}\\` could not be extracted from all schema options`);\n            }\n            for (const value of discriminatorValues) {\n                if (optionsMap.has(value)) {\n                    throw new Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);\n                }\n                optionsMap.set(value, type);\n            }\n        }\n        return new ZodDiscriminatedUnion({\n            typeName: ZodFirstPartyTypeKind.ZodDiscriminatedUnion,\n            discriminator,\n            options,\n            optionsMap,\n            ...processCreateParams(params),\n        });\n    }\n}\nfunction mergeValues(a, b) {\n    const aType = getParsedType(a);\n    const bType = getParsedType(b);\n    if (a === b) {\n        return { valid: true, data: a };\n    }\n    else if (aType === ZodParsedType.object && bType === ZodParsedType.object) {\n        const bKeys = util.objectKeys(b);\n        const sharedKeys = util.objectKeys(a).filter((key) => bKeys.indexOf(key) !== -1);\n        const newObj = { ...a, ...b };\n        for (const key of sharedKeys) {\n            const sharedValue = mergeValues(a[key], b[key]);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newObj[key] = sharedValue.data;\n        }\n        return { valid: true, data: newObj };\n    }\n    else if (aType === ZodParsedType.array && bType === ZodParsedType.array) {\n        if (a.length !== b.length) {\n            return { valid: false };\n        }\n        const newArray = [];\n        for (let index = 0; index < a.length; index++) {\n            const itemA = a[index];\n            const itemB = b[index];\n            const sharedValue = mergeValues(itemA, itemB);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newArray.push(sharedValue.data);\n        }\n        return { valid: true, data: newArray };\n    }\n    else if (aType === ZodParsedType.date && bType === ZodParsedType.date && +a === +b) {\n        return { valid: true, data: a };\n    }\n    else {\n        return { valid: false };\n    }\n}\nexport class ZodIntersection extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const handleParsed = (parsedLeft, parsedRight) => {\n            if (isAborted(parsedLeft) || isAborted(parsedRight)) {\n                return INVALID;\n            }\n            const merged = mergeValues(parsedLeft.value, parsedRight.value);\n            if (!merged.valid) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.invalid_intersection_types,\n                });\n                return INVALID;\n            }\n            if (isDirty(parsedLeft) || isDirty(parsedRight)) {\n                status.dirty();\n            }\n            return { status: status.value, value: merged.data };\n        };\n        if (ctx.common.async) {\n            return Promise.all([\n                this._def.left._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n                this._def.right._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n            ]).then(([left, right]) => handleParsed(left, right));\n        }\n        else {\n            return handleParsed(this._def.left._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }), this._def.right._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }));\n        }\n    }\n}\nZodIntersection.create = (left, right, params) => {\n    return new ZodIntersection({\n        left: left,\n        right: right,\n        typeName: ZodFirstPartyTypeKind.ZodIntersection,\n        ...processCreateParams(params),\n    });\n};\n// type ZodTupleItems = [ZodTypeAny, ...ZodTypeAny[]];\nexport class ZodTuple extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (ctx.data.length < this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_small,\n                minimum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            return INVALID;\n        }\n        const rest = this._def.rest;\n        if (!rest && ctx.data.length > this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_big,\n                maximum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            status.dirty();\n        }\n        const items = [...ctx.data]\n            .map((item, itemIndex) => {\n            const schema = this._def.items[itemIndex] || this._def.rest;\n            if (!schema)\n                return null;\n            return schema._parse(new ParseInputLazyPath(ctx, item, ctx.path, itemIndex));\n        })\n            .filter((x) => !!x); // filter nulls\n        if (ctx.common.async) {\n            return Promise.all(items).then((results) => {\n                return ParseStatus.mergeArray(status, results);\n            });\n        }\n        else {\n            return ParseStatus.mergeArray(status, items);\n        }\n    }\n    get items() {\n        return this._def.items;\n    }\n    rest(rest) {\n        return new ZodTuple({\n            ...this._def,\n            rest,\n        });\n    }\n}\nZodTuple.create = (schemas, params) => {\n    if (!Array.isArray(schemas)) {\n        throw new Error(\"You must pass an array of schemas to z.tuple([ ... ])\");\n    }\n    return new ZodTuple({\n        items: schemas,\n        typeName: ZodFirstPartyTypeKind.ZodTuple,\n        rest: null,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodRecord extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const pairs = [];\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        for (const key in ctx.data) {\n            pairs.push({\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, key)),\n                value: valueType._parse(new ParseInputLazyPath(ctx, ctx.data[key], ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (ctx.common.async) {\n            return ParseStatus.mergeObjectAsync(status, pairs);\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get element() {\n        return this._def.valueType;\n    }\n    static create(first, second, third) {\n        if (second instanceof ZodType) {\n            return new ZodRecord({\n                keyType: first,\n                valueType: second,\n                typeName: ZodFirstPartyTypeKind.ZodRecord,\n                ...processCreateParams(third),\n            });\n        }\n        return new ZodRecord({\n            keyType: ZodString.create(),\n            valueType: first,\n            typeName: ZodFirstPartyTypeKind.ZodRecord,\n            ...processCreateParams(second),\n        });\n    }\n}\nexport class ZodMap extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.map) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.map,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        const pairs = [...ctx.data.entries()].map(([key, value], index) => {\n            return {\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, [index, \"key\"])),\n                value: valueType._parse(new ParseInputLazyPath(ctx, value, ctx.path, [index, \"value\"])),\n            };\n        });\n        if (ctx.common.async) {\n            const finalMap = new Map();\n            return Promise.resolve().then(async () => {\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    if (key.status === \"aborted\" || value.status === \"aborted\") {\n                        return INVALID;\n                    }\n                    if (key.status === \"dirty\" || value.status === \"dirty\") {\n                        status.dirty();\n                    }\n                    finalMap.set(key.value, value.value);\n                }\n                return { status: status.value, value: finalMap };\n            });\n        }\n        else {\n            const finalMap = new Map();\n            for (const pair of pairs) {\n                const key = pair.key;\n                const value = pair.value;\n                if (key.status === \"aborted\" || value.status === \"aborted\") {\n                    return INVALID;\n                }\n                if (key.status === \"dirty\" || value.status === \"dirty\") {\n                    status.dirty();\n                }\n                finalMap.set(key.value, value.value);\n            }\n            return { status: status.value, value: finalMap };\n        }\n    }\n}\nZodMap.create = (keyType, valueType, params) => {\n    return new ZodMap({\n        valueType,\n        keyType,\n        typeName: ZodFirstPartyTypeKind.ZodMap,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSet extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.set) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.set,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const def = this._def;\n        if (def.minSize !== null) {\n            if (ctx.data.size < def.minSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minSize.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxSize !== null) {\n            if (ctx.data.size > def.maxSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxSize.message,\n                });\n                status.dirty();\n            }\n        }\n        const valueType = this._def.valueType;\n        function finalizeSet(elements) {\n            const parsedSet = new Set();\n            for (const element of elements) {\n                if (element.status === \"aborted\")\n                    return INVALID;\n                if (element.status === \"dirty\")\n                    status.dirty();\n                parsedSet.add(element.value);\n            }\n            return { status: status.value, value: parsedSet };\n        }\n        const elements = [...ctx.data.values()].map((item, i) => valueType._parse(new ParseInputLazyPath(ctx, item, ctx.path, i)));\n        if (ctx.common.async) {\n            return Promise.all(elements).then((elements) => finalizeSet(elements));\n        }\n        else {\n            return finalizeSet(elements);\n        }\n    }\n    min(minSize, message) {\n        return new ZodSet({\n            ...this._def,\n            minSize: { value: minSize, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxSize, message) {\n        return new ZodSet({\n            ...this._def,\n            maxSize: { value: maxSize, message: errorUtil.toString(message) },\n        });\n    }\n    size(size, message) {\n        return this.min(size, message).max(size, message);\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodSet.create = (valueType, params) => {\n    return new ZodSet({\n        valueType,\n        minSize: null,\n        maxSize: null,\n        typeName: ZodFirstPartyTypeKind.ZodSet,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodFunction extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.validate = this.implement;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.function) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.function,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        function makeArgsIssue(args, error) {\n            return makeIssue({\n                data: args,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_arguments,\n                    argumentsError: error,\n                },\n            });\n        }\n        function makeReturnsIssue(returns, error) {\n            return makeIssue({\n                data: returns,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_return_type,\n                    returnTypeError: error,\n                },\n            });\n        }\n        const params = { errorMap: ctx.common.contextualErrorMap };\n        const fn = ctx.data;\n        if (this._def.returns instanceof ZodPromise) {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(async function (...args) {\n                const error = new ZodError([]);\n                const parsedArgs = await me._def.args.parseAsync(args, params).catch((e) => {\n                    error.addIssue(makeArgsIssue(args, e));\n                    throw error;\n                });\n                const result = await Reflect.apply(fn, this, parsedArgs);\n                const parsedReturns = await me._def.returns._def.type\n                    .parseAsync(result, params)\n                    .catch((e) => {\n                    error.addIssue(makeReturnsIssue(result, e));\n                    throw error;\n                });\n                return parsedReturns;\n            });\n        }\n        else {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(function (...args) {\n                const parsedArgs = me._def.args.safeParse(args, params);\n                if (!parsedArgs.success) {\n                    throw new ZodError([makeArgsIssue(args, parsedArgs.error)]);\n                }\n                const result = Reflect.apply(fn, this, parsedArgs.data);\n                const parsedReturns = me._def.returns.safeParse(result, params);\n                if (!parsedReturns.success) {\n                    throw new ZodError([makeReturnsIssue(result, parsedReturns.error)]);\n                }\n                return parsedReturns.data;\n            });\n        }\n    }\n    parameters() {\n        return this._def.args;\n    }\n    returnType() {\n        return this._def.returns;\n    }\n    args(...items) {\n        return new ZodFunction({\n            ...this._def,\n            args: ZodTuple.create(items).rest(ZodUnknown.create()),\n        });\n    }\n    returns(returnType) {\n        return new ZodFunction({\n            ...this._def,\n            returns: returnType,\n        });\n    }\n    implement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    strictImplement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    static create(args, returns, params) {\n        return new ZodFunction({\n            args: (args ? args : ZodTuple.create([]).rest(ZodUnknown.create())),\n            returns: returns || ZodUnknown.create(),\n            typeName: ZodFirstPartyTypeKind.ZodFunction,\n            ...processCreateParams(params),\n        });\n    }\n}\nexport class ZodLazy extends ZodType {\n    get schema() {\n        return this._def.getter();\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const lazySchema = this._def.getter();\n        return lazySchema._parse({ data: ctx.data, path: ctx.path, parent: ctx });\n    }\n}\nZodLazy.create = (getter, params) => {\n    return new ZodLazy({\n        getter: getter,\n        typeName: ZodFirstPartyTypeKind.ZodLazy,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodLiteral extends ZodType {\n    _parse(input) {\n        if (input.data !== this._def.value) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_literal,\n                expected: this._def.value,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n    get value() {\n        return this._def.value;\n    }\n}\nZodLiteral.create = (value, params) => {\n    return new ZodLiteral({\n        value: value,\n        typeName: ZodFirstPartyTypeKind.ZodLiteral,\n        ...processCreateParams(params),\n    });\n};\nfunction createZodEnum(values, params) {\n    return new ZodEnum({\n        values,\n        typeName: ZodFirstPartyTypeKind.ZodEnum,\n        ...processCreateParams(params),\n    });\n}\nexport class ZodEnum extends ZodType {\n    _parse(input) {\n        if (typeof input.data !== \"string\") {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(this._def.values);\n        }\n        if (!this._cache.has(input.data)) {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get options() {\n        return this._def.values;\n    }\n    get enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Values() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    extract(values, newDef = this._def) {\n        return ZodEnum.create(values, {\n            ...this._def,\n            ...newDef,\n        });\n    }\n    exclude(values, newDef = this._def) {\n        return ZodEnum.create(this.options.filter((opt) => !values.includes(opt)), {\n            ...this._def,\n            ...newDef,\n        });\n    }\n}\nZodEnum.create = createZodEnum;\nexport class ZodNativeEnum extends ZodType {\n    _parse(input) {\n        const nativeEnumValues = util.getValidEnumValues(this._def.values);\n        const ctx = this._getOrReturnCtx(input);\n        if (ctx.parsedType !== ZodParsedType.string && ctx.parsedType !== ZodParsedType.number) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(util.getValidEnumValues(this._def.values));\n        }\n        if (!this._cache.has(input.data)) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get enum() {\n        return this._def.values;\n    }\n}\nZodNativeEnum.create = (values, params) => {\n    return new ZodNativeEnum({\n        values: values,\n        typeName: ZodFirstPartyTypeKind.ZodNativeEnum,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodPromise extends ZodType {\n    unwrap() {\n        return this._def.type;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.promise && ctx.common.async === false) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.promise,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const promisified = ctx.parsedType === ZodParsedType.promise ? ctx.data : Promise.resolve(ctx.data);\n        return OK(promisified.then((data) => {\n            return this._def.type.parseAsync(data, {\n                path: ctx.path,\n                errorMap: ctx.common.contextualErrorMap,\n            });\n        }));\n    }\n}\nZodPromise.create = (schema, params) => {\n    return new ZodPromise({\n        type: schema,\n        typeName: ZodFirstPartyTypeKind.ZodPromise,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodEffects extends ZodType {\n    innerType() {\n        return this._def.schema;\n    }\n    sourceType() {\n        return this._def.schema._def.typeName === ZodFirstPartyTypeKind.ZodEffects\n            ? this._def.schema.sourceType()\n            : this._def.schema;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const effect = this._def.effect || null;\n        const checkCtx = {\n            addIssue: (arg) => {\n                addIssueToContext(ctx, arg);\n                if (arg.fatal) {\n                    status.abort();\n                }\n                else {\n                    status.dirty();\n                }\n            },\n            get path() {\n                return ctx.path;\n            },\n        };\n        checkCtx.addIssue = checkCtx.addIssue.bind(checkCtx);\n        if (effect.type === \"preprocess\") {\n            const processed = effect.transform(ctx.data, checkCtx);\n            if (ctx.common.async) {\n                return Promise.resolve(processed).then(async (processed) => {\n                    if (status.value === \"aborted\")\n                        return INVALID;\n                    const result = await this._def.schema._parseAsync({\n                        data: processed,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                    if (result.status === \"aborted\")\n                        return INVALID;\n                    if (result.status === \"dirty\")\n                        return DIRTY(result.value);\n                    if (status.value === \"dirty\")\n                        return DIRTY(result.value);\n                    return result;\n                });\n            }\n            else {\n                if (status.value === \"aborted\")\n                    return INVALID;\n                const result = this._def.schema._parseSync({\n                    data: processed,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (result.status === \"aborted\")\n                    return INVALID;\n                if (result.status === \"dirty\")\n                    return DIRTY(result.value);\n                if (status.value === \"dirty\")\n                    return DIRTY(result.value);\n                return result;\n            }\n        }\n        if (effect.type === \"refinement\") {\n            const executeRefinement = (acc) => {\n                const result = effect.refinement(acc, checkCtx);\n                if (ctx.common.async) {\n                    return Promise.resolve(result);\n                }\n                if (result instanceof Promise) {\n                    throw new Error(\"Async refinement encountered during synchronous parse operation. Use .parseAsync instead.\");\n                }\n                return acc;\n            };\n            if (ctx.common.async === false) {\n                const inner = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inner.status === \"aborted\")\n                    return INVALID;\n                if (inner.status === \"dirty\")\n                    status.dirty();\n                // return value is ignored\n                executeRefinement(inner.value);\n                return { status: status.value, value: inner.value };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((inner) => {\n                    if (inner.status === \"aborted\")\n                        return INVALID;\n                    if (inner.status === \"dirty\")\n                        status.dirty();\n                    return executeRefinement(inner.value).then(() => {\n                        return { status: status.value, value: inner.value };\n                    });\n                });\n            }\n        }\n        if (effect.type === \"transform\") {\n            if (ctx.common.async === false) {\n                const base = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (!isValid(base))\n                    return INVALID;\n                const result = effect.transform(base.value, checkCtx);\n                if (result instanceof Promise) {\n                    throw new Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);\n                }\n                return { status: status.value, value: result };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((base) => {\n                    if (!isValid(base))\n                        return INVALID;\n                    return Promise.resolve(effect.transform(base.value, checkCtx)).then((result) => ({\n                        status: status.value,\n                        value: result,\n                    }));\n                });\n            }\n        }\n        util.assertNever(effect);\n    }\n}\nZodEffects.create = (schema, effect, params) => {\n    return new ZodEffects({\n        schema,\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        effect,\n        ...processCreateParams(params),\n    });\n};\nZodEffects.createWithPreprocess = (preprocess, schema, params) => {\n    return new ZodEffects({\n        schema,\n        effect: { type: \"preprocess\", transform: preprocess },\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        ...processCreateParams(params),\n    });\n};\nexport { ZodEffects as ZodTransformer };\nexport class ZodOptional extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.undefined) {\n            return OK(undefined);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodOptional.create = (type, params) => {\n    return new ZodOptional({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodOptional,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNullable extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.null) {\n            return OK(null);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodNullable.create = (type, params) => {\n    return new ZodNullable({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodNullable,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDefault extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        let data = ctx.data;\n        if (ctx.parsedType === ZodParsedType.undefined) {\n            data = this._def.defaultValue();\n        }\n        return this._def.innerType._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    removeDefault() {\n        return this._def.innerType;\n    }\n}\nZodDefault.create = (type, params) => {\n    return new ZodDefault({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodDefault,\n        defaultValue: typeof params.default === \"function\" ? params.default : () => params.default,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodCatch extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        // newCtx is used to not collect issues from inner types in ctx\n        const newCtx = {\n            ...ctx,\n            common: {\n                ...ctx.common,\n                issues: [],\n            },\n        };\n        const result = this._def.innerType._parse({\n            data: newCtx.data,\n            path: newCtx.path,\n            parent: {\n                ...newCtx,\n            },\n        });\n        if (isAsync(result)) {\n            return result.then((result) => {\n                return {\n                    status: \"valid\",\n                    value: result.status === \"valid\"\n                        ? result.value\n                        : this._def.catchValue({\n                            get error() {\n                                return new ZodError(newCtx.common.issues);\n                            },\n                            input: newCtx.data,\n                        }),\n                };\n            });\n        }\n        else {\n            return {\n                status: \"valid\",\n                value: result.status === \"valid\"\n                    ? result.value\n                    : this._def.catchValue({\n                        get error() {\n                            return new ZodError(newCtx.common.issues);\n                        },\n                        input: newCtx.data,\n                    }),\n            };\n        }\n    }\n    removeCatch() {\n        return this._def.innerType;\n    }\n}\nZodCatch.create = (type, params) => {\n    return new ZodCatch({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodCatch,\n        catchValue: typeof params.catch === \"function\" ? params.catch : () => params.catch,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNaN extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.nan) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.nan,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n}\nZodNaN.create = (params) => {\n    return new ZodNaN({\n        typeName: ZodFirstPartyTypeKind.ZodNaN,\n        ...processCreateParams(params),\n    });\n};\nexport const BRAND = Symbol(\"zod_brand\");\nexport class ZodBranded extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const data = ctx.data;\n        return this._def.type._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    unwrap() {\n        return this._def.type;\n    }\n}\nexport class ZodPipeline extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.common.async) {\n            const handleAsync = async () => {\n                const inResult = await this._def.in._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inResult.status === \"aborted\")\n                    return INVALID;\n                if (inResult.status === \"dirty\") {\n                    status.dirty();\n                    return DIRTY(inResult.value);\n                }\n                else {\n                    return this._def.out._parseAsync({\n                        data: inResult.value,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                }\n            };\n            return handleAsync();\n        }\n        else {\n            const inResult = this._def.in._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n            if (inResult.status === \"aborted\")\n                return INVALID;\n            if (inResult.status === \"dirty\") {\n                status.dirty();\n                return {\n                    status: \"dirty\",\n                    value: inResult.value,\n                };\n            }\n            else {\n                return this._def.out._parseSync({\n                    data: inResult.value,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n            }\n        }\n    }\n    static create(a, b) {\n        return new ZodPipeline({\n            in: a,\n            out: b,\n            typeName: ZodFirstPartyTypeKind.ZodPipeline,\n        });\n    }\n}\nexport class ZodReadonly extends ZodType {\n    _parse(input) {\n        const result = this._def.innerType._parse(input);\n        const freeze = (data) => {\n            if (isValid(data)) {\n                data.value = Object.freeze(data.value);\n            }\n            return data;\n        };\n        return isAsync(result) ? result.then((data) => freeze(data)) : freeze(result);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodReadonly.create = (type, params) => {\n    return new ZodReadonly({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodReadonly,\n        ...processCreateParams(params),\n    });\n};\n////////////////////////////////////////\n////////////////////////////////////////\n//////////                    //////////\n//////////      z.custom      //////////\n//////////                    //////////\n////////////////////////////////////////\n////////////////////////////////////////\nfunction cleanParams(params, data) {\n    const p = typeof params === \"function\" ? params(data) : typeof params === \"string\" ? { message: params } : params;\n    const p2 = typeof p === \"string\" ? { message: p } : p;\n    return p2;\n}\nexport function custom(check, _params = {}, \n/**\n * @deprecated\n *\n * Pass `fatal` into the params object instead:\n *\n * ```ts\n * z.string().custom((val) => val.length > 5, { fatal: false })\n * ```\n *\n */\nfatal) {\n    if (check)\n        return ZodAny.create().superRefine((data, ctx) => {\n            const r = check(data);\n            if (r instanceof Promise) {\n                return r.then((r) => {\n                    if (!r) {\n                        const params = cleanParams(_params, data);\n                        const _fatal = params.fatal ?? fatal ?? true;\n                        ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n                    }\n                });\n            }\n            if (!r) {\n                const params = cleanParams(_params, data);\n                const _fatal = params.fatal ?? fatal ?? true;\n                ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n            }\n            return;\n        });\n    return ZodAny.create();\n}\nexport { ZodType as Schema, ZodType as ZodSchema };\nexport const late = {\n    object: ZodObject.lazycreate,\n};\nexport var ZodFirstPartyTypeKind;\n(function (ZodFirstPartyTypeKind) {\n    ZodFirstPartyTypeKind[\"ZodString\"] = \"ZodString\";\n    ZodFirstPartyTypeKind[\"ZodNumber\"] = \"ZodNumber\";\n    ZodFirstPartyTypeKind[\"ZodNaN\"] = \"ZodNaN\";\n    ZodFirstPartyTypeKind[\"ZodBigInt\"] = \"ZodBigInt\";\n    ZodFirstPartyTypeKind[\"ZodBoolean\"] = \"ZodBoolean\";\n    ZodFirstPartyTypeKind[\"ZodDate\"] = \"ZodDate\";\n    ZodFirstPartyTypeKind[\"ZodSymbol\"] = \"ZodSymbol\";\n    ZodFirstPartyTypeKind[\"ZodUndefined\"] = \"ZodUndefined\";\n    ZodFirstPartyTypeKind[\"ZodNull\"] = \"ZodNull\";\n    ZodFirstPartyTypeKind[\"ZodAny\"] = \"ZodAny\";\n    ZodFirstPartyTypeKind[\"ZodUnknown\"] = \"ZodUnknown\";\n    ZodFirstPartyTypeKind[\"ZodNever\"] = \"ZodNever\";\n    ZodFirstPartyTypeKind[\"ZodVoid\"] = \"ZodVoid\";\n    ZodFirstPartyTypeKind[\"ZodArray\"] = \"ZodArray\";\n    ZodFirstPartyTypeKind[\"ZodObject\"] = \"ZodObject\";\n    ZodFirstPartyTypeKind[\"ZodUnion\"] = \"ZodUnion\";\n    ZodFirstPartyTypeKind[\"ZodDiscriminatedUnion\"] = \"ZodDiscriminatedUnion\";\n    ZodFirstPartyTypeKind[\"ZodIntersection\"] = \"ZodIntersection\";\n    ZodFirstPartyTypeKind[\"ZodTuple\"] = \"ZodTuple\";\n    ZodFirstPartyTypeKind[\"ZodRecord\"] = \"ZodRecord\";\n    ZodFirstPartyTypeKind[\"ZodMap\"] = \"ZodMap\";\n    ZodFirstPartyTypeKind[\"ZodSet\"] = \"ZodSet\";\n    ZodFirstPartyTypeKind[\"ZodFunction\"] = \"ZodFunction\";\n    ZodFirstPartyTypeKind[\"ZodLazy\"] = \"ZodLazy\";\n    ZodFirstPartyTypeKind[\"ZodLiteral\"] = \"ZodLiteral\";\n    ZodFirstPartyTypeKind[\"ZodEnum\"] = \"ZodEnum\";\n    ZodFirstPartyTypeKind[\"ZodEffects\"] = \"ZodEffects\";\n    ZodFirstPartyTypeKind[\"ZodNativeEnum\"] = \"ZodNativeEnum\";\n    ZodFirstPartyTypeKind[\"ZodOptional\"] = \"ZodOptional\";\n    ZodFirstPartyTypeKind[\"ZodNullable\"] = \"ZodNullable\";\n    ZodFirstPartyTypeKind[\"ZodDefault\"] = \"ZodDefault\";\n    ZodFirstPartyTypeKind[\"ZodCatch\"] = \"ZodCatch\";\n    ZodFirstPartyTypeKind[\"ZodPromise\"] = \"ZodPromise\";\n    ZodFirstPartyTypeKind[\"ZodBranded\"] = \"ZodBranded\";\n    ZodFirstPartyTypeKind[\"ZodPipeline\"] = \"ZodPipeline\";\n    ZodFirstPartyTypeKind[\"ZodReadonly\"] = \"ZodReadonly\";\n})(ZodFirstPartyTypeKind || (ZodFirstPartyTypeKind = {}));\n// requires TS 4.4+\nclass Class {\n    constructor(..._) { }\n}\nconst instanceOfType = (\n// const instanceOfType = <T extends new (...args: any[]) => any>(\ncls, params = {\n    message: `Input not instance of ${cls.name}`,\n}) => custom((data) => data instanceof cls, params);\nconst stringType = ZodString.create;\nconst numberType = ZodNumber.create;\nconst nanType = ZodNaN.create;\nconst bigIntType = ZodBigInt.create;\nconst booleanType = ZodBoolean.create;\nconst dateType = ZodDate.create;\nconst symbolType = ZodSymbol.create;\nconst undefinedType = ZodUndefined.create;\nconst nullType = ZodNull.create;\nconst anyType = ZodAny.create;\nconst unknownType = ZodUnknown.create;\nconst neverType = ZodNever.create;\nconst voidType = ZodVoid.create;\nconst arrayType = ZodArray.create;\nconst objectType = ZodObject.create;\nconst strictObjectType = ZodObject.strictCreate;\nconst unionType = ZodUnion.create;\nconst discriminatedUnionType = ZodDiscriminatedUnion.create;\nconst intersectionType = ZodIntersection.create;\nconst tupleType = ZodTuple.create;\nconst recordType = ZodRecord.create;\nconst mapType = ZodMap.create;\nconst setType = ZodSet.create;\nconst functionType = ZodFunction.create;\nconst lazyType = ZodLazy.create;\nconst literalType = ZodLiteral.create;\nconst enumType = ZodEnum.create;\nconst nativeEnumType = ZodNativeEnum.create;\nconst promiseType = ZodPromise.create;\nconst effectsType = ZodEffects.create;\nconst optionalType = ZodOptional.create;\nconst nullableType = ZodNullable.create;\nconst preprocessType = ZodEffects.createWithPreprocess;\nconst pipelineType = ZodPipeline.create;\nconst ostring = () => stringType().optional();\nconst onumber = () => numberType().optional();\nconst oboolean = () => booleanType().optional();\nexport const coerce = {\n    string: ((arg) => ZodString.create({ ...arg, coerce: true })),\n    number: ((arg) => ZodNumber.create({ ...arg, coerce: true })),\n    boolean: ((arg) => ZodBoolean.create({\n        ...arg,\n        coerce: true,\n    })),\n    bigint: ((arg) => ZodBigInt.create({ ...arg, coerce: true })),\n    date: ((arg) => ZodDate.create({ ...arg, coerce: true })),\n};\nexport { anyType as any, arrayType as array, bigIntType as bigint, booleanType as boolean, dateType as date, discriminatedUnionType as discriminatedUnion, effectsType as effect, enumType as enum, functionType as function, instanceOfType as instanceof, intersectionType as intersection, lazyType as lazy, literalType as literal, mapType as map, nanType as nan, nativeEnumType as nativeEnum, neverType as never, nullType as null, nullableType as nullable, numberType as number, objectType as object, oboolean, onumber, optionalType as optional, ostring, pipelineType as pipeline, preprocessType as preprocess, promiseType as promise, recordType as record, setType as set, strictObjectType as strictObject, stringType as string, symbolType as symbol, effectsType as transformer, tupleType as tuple, undefinedType as undefined, unionType as union, unknownType as unknown, voidType as void, };\nexport const NEVER = INVALID;\n","/* __LC_ALLOW_ENTRYPOINT_SIDE_EFFECTS__ */\nimport { z, } from \"zod\";\nimport { CallToolResultSchema } from \"@modelcontextprotocol/sdk/types.js\";\nfunction isZodObject(schema) {\n    return (typeof schema === \"object\" &&\n        schema !== null &&\n        \"_def\" in schema &&\n        schema._def.typeName === \"ZodObject\");\n}\nfunction isZodLiteral(schema) {\n    return (typeof schema === \"object\" &&\n        schema !== null &&\n        \"_def\" in schema &&\n        schema._def.typeName === \"ZodLiteral\");\n}\n/**\n * Zod schema for an individual content item within a CallToolResult.\n */\nconst callToolResultContentSchema = CallToolResultSchema.shape.content._def.innerType.element;\nconst callToolResultContentTypes = callToolResultContentSchema.options.map((option) => {\n    if (isZodObject(option) &&\n        \"type\" in option.shape &&\n        isZodLiteral(option.shape.type)) {\n        return option.shape.type.value;\n    }\n    throw new Error(\"Internal error: Invalid option found in CallToolResultContentSchema's union. Expected ZodObject with ZodLiteral 'type'.\");\n});\nconst callToolResultContentTypeZodLiterals = callToolResultContentTypes.map((t) => z.literal(t));\n/**\n * Zod schema for the 'type' field of a CallToolResultContent item.\n * This will be a union of literals like \"text\", \"image\", \"audio\", and \"resource\".\n */\nexport const callToolResultContentTypeSchema = z.union(callToolResultContentTypeZodLiterals);\nconst outputTypesUnion = z.union([\n    z\n        .literal(\"content\")\n        .describe(\"Put tool output into the ToolMessage.content array\"),\n    z\n        .literal(\"artifact\")\n        .describe(\"Put tool output into the ToolMessage.artifact array\"),\n]);\nconst detailedOutputHandlingSchema = z.object(Object.fromEntries(callToolResultContentTypes.map((contentType) => [\n    contentType,\n    z\n        .union([\n        z\n            .literal(\"content\")\n            .describe(`Put all ${contentType} tool output into the ToolMessage.content array`),\n        z\n            .literal(\"artifact\")\n            .describe(`Put all ${contentType} tool output into the ToolMessage.artifact array`),\n    ])\n        .describe(`Where to place ${contentType} tool output in the LangChain ToolMessage`)\n        .optional(),\n])));\nexport const outputHandlingSchema = z\n    .union([outputTypesUnion, detailedOutputHandlingSchema])\n    .describe(\"Defines where to place each tool output type in the LangChain ToolMessage.\\n\\n\" +\n    \"Items in the `content` field will be used as input context for the LLM, while the artifact field is\\n\" +\n    \"used for capturing tool output that won't be shown to the model, to be used in some later workflow\\n\" +\n    \"step.\\n\\n\" +\n    \"For example, imagine that you have a SQL query tool that can return huge result sets. Rather than\\n\" +\n    \"sending these large outputs directly to the model, perhaps you want the model to be able to inspect\\n\" +\n    \"the output in a code execution environment. In this case, you would set the output handling for the\\n\" +\n    \"`resource` type to `artifact` (it's default value), and then upon initialization of your code\\n\" +\n    \"execution environment, you would look through your message history for `ToolMessage`s with the\\n\" +\n    \"`artifact` field set to `resource`, and use the `content` field during initialization of the\\n\" +\n    \"environment.\");\n/**\n * Zod schema for validating OAuthClientProvider interface\n * Since OAuthClientProvider has methods, we create a custom validator\n */\nexport const oAuthClientProviderSchema = z.custom((val) => {\n    if (!val || typeof val !== \"object\")\n        return false;\n    // Check required properties and methods exist\n    const requiredMethods = [\n        \"redirectUrl\",\n        \"clientMetadata\",\n        \"clientInformation\",\n        \"tokens\",\n        \"saveTokens\",\n    ];\n    // redirectUrl can be a string, URL, or getter returning string/URL\n    if (!(\"redirectUrl\" in val))\n        return false;\n    // clientMetadata can be an object or getter returning an object\n    if (!(\"clientMetadata\" in val))\n        return false;\n    // Check that required methods exist (they can be functions or getters)\n    for (const method of requiredMethods) {\n        if (!(method in val))\n            return false;\n    }\n    return true;\n}, {\n    message: \"Must be a valid OAuthClientProvider implementation with required properties: redirectUrl, clientMetadata, clientInformation, tokens, saveTokens\",\n});\nexport const baseConfigSchema = z.object({\n    /**\n     * Defines where to place each tool output type in the LangChain ToolMessage.\n     *\n     * Can be set to `content` or `artifact` to send all tool output into the ToolMessage.content or\n     * ToolMessage.artifact array, respectively, or you can assign an object that maps each content type\n     * to `content` or `artifact`.\n     *\n     * @default {\n     *   \"text\": \"content\",\n     *   \"image\": \"content\",\n     *   \"audio\": \"content\",\n     *   \"resource\": \"artifact\"\n     * }\n     *\n     * Items in the `content` field will be used as input context for the LLM, while the artifact field is\n     * used for capturing tool output that won't be shown to the model, to be used in some later workflow\n     * step.\n     *\n     * For example, imagine that you have a SQL query tool that can return huge result sets. Rather than\n     * sending these large outputs directly to the model, perhaps you want the model to be able to inspect\n     * the output in a code execution environment. In this case, you would set the output handling for the\n     * `resource` type to `artifact` (its default value), and then upon initialization of your code\n     * execution environment, you would look through your message history for `ToolMessage`s with the\n     * `artifact` field set to `resource`, and use the `content` field during initialization of the\n     * environment.\n     */\n    outputHandling: outputHandlingSchema.optional(),\n    /**\n     * Default timeout in milliseconds for tool execution. Must be greater than 0.\n     * If not specified, tools will use their own configured timeout values.\n     */\n    defaultToolTimeout: z.number().min(1).optional(),\n});\n/**\n * Stdio transport restart configuration\n */\nexport const stdioRestartSchema = z\n    .object({\n    /**\n     * Whether to automatically restart the process if it exits\n     */\n    enabled: z\n        .boolean()\n        .describe(\"Whether to automatically restart the process if it exits\")\n        .optional(),\n    /**\n     * Maximum number of restart attempts\n     */\n    maxAttempts: z\n        .number()\n        .describe(\"The maximum number of restart attempts\")\n        .optional(),\n    /**\n     * Delay in milliseconds between restart attempts\n     */\n    delayMs: z\n        .number()\n        .describe(\"The delay in milliseconds between restart attempts\")\n        .optional(),\n})\n    .describe(\"Configuration for stdio transport restart\");\n/**\n * Stdio transport connection\n */\nexport const stdioConnectionSchema = z\n    .object({\n    /**\n     * Optional transport type, inferred from the structure of the config if not provided. Included\n     * for compatibility with common MCP client config file formats.\n     */\n    transport: z.literal(\"stdio\").optional(),\n    /**\n     * Optional transport type, inferred from the structure of the config if not provided. Included\n     * for compatibility with common MCP client config file formats.\n     */\n    type: z.literal(\"stdio\").optional(),\n    /**\n     * The executable to run the server (e.g. `node`, `npx`, etc)\n     */\n    command: z.string().describe(\"The executable to run the server\"),\n    /**\n     * Array of command line arguments to pass to the executable\n     */\n    args: z\n        .array(z.string())\n        .describe(\"Command line arguments to pass to the executable\"),\n    /**\n     * Environment variables to set when spawning the process.\n     */\n    env: z\n        .record(z.string())\n        .describe(\"The environment to use when spawning the process\")\n        .optional(),\n    /**\n     * The encoding to use when reading from the process\n     */\n    encoding: z\n        .string()\n        .describe(\"The encoding to use when reading from the process\")\n        .optional(),\n    /**\n     * How to handle stderr of the child process. This matches the semantics of Node's `child_process.spawn`\n     *\n     * The default is \"inherit\", meaning messages to stderr will be printed to the parent process's stderr.\n     *\n     * @default \"inherit\"\n     */\n    stderr: z\n        .union([\n        z.literal(\"overlapped\"),\n        z.literal(\"pipe\"),\n        z.literal(\"ignore\"),\n        z.literal(\"inherit\"),\n    ])\n        .describe(\"How to handle stderr of the child process. This matches the semantics of Node's `child_process.spawn`\")\n        .optional()\n        .default(\"inherit\"),\n    /**\n     * The working directory to use when spawning the process.\n     */\n    cwd: z\n        .string()\n        .describe(\"The working directory to use when spawning the process\")\n        .optional(),\n    /**\n     * Additional restart settings\n     */\n    restart: stdioRestartSchema.optional(),\n})\n    .and(baseConfigSchema)\n    .describe(\"Configuration for stdio transport connection\");\n/**\n * Streamable HTTP transport reconnection configuration\n */\nexport const streamableHttpReconnectSchema = z\n    .object({\n    /**\n     * Whether to automatically reconnect if the connection is lost\n     */\n    enabled: z\n        .boolean()\n        .describe(\"Whether to automatically reconnect if the connection is lost\")\n        .optional(),\n    /**\n     * Maximum number of reconnection attempts\n     */\n    maxAttempts: z\n        .number()\n        .describe(\"The maximum number of reconnection attempts\")\n        .optional(),\n    /**\n     * Delay in milliseconds between reconnection attempts\n     */\n    delayMs: z\n        .number()\n        .describe(\"The delay in milliseconds between reconnection attempts\")\n        .optional(),\n})\n    .describe(\"Configuration for streamable HTTP transport reconnection\");\n/**\n * Streamable HTTP transport connection\n */\nexport const streamableHttpConnectionSchema = z\n    .object({\n    /**\n     * Optional transport type, inferred from the structure of the config. If \"sse\", will not attempt\n     * to connect using streamable HTTP.\n     */\n    transport: z.union([z.literal(\"http\"), z.literal(\"sse\")]).optional(),\n    /**\n     * Optional transport type, inferred from the structure of the config. If \"sse\", will not attempt\n     * to connect using streamable HTTP.\n     */\n    type: z.union([z.literal(\"http\"), z.literal(\"sse\")]).optional(),\n    /**\n     * The URL to connect to\n     */\n    url: z.string().url(),\n    /**\n     * Additional headers to send with the request, useful for authentication\n     */\n    headers: z.record(z.string()).optional(),\n    /**\n     * OAuth client provider for automatic authentication handling.\n     * When provided, the transport will automatically handle token refresh,\n     * 401 error retries, and OAuth 2.0 flows according to RFC 6750.\n     * This is the recommended approach for authentication instead of manual headers.\n     */\n    authProvider: oAuthClientProviderSchema.optional(),\n    /**\n     * Additional reconnection settings.\n     */\n    reconnect: streamableHttpReconnectSchema.optional(),\n    /**\n     * Whether to automatically fallback to SSE if Streamable HTTP is not available or not supported\n     *\n     * @default true\n     */\n    automaticSSEFallback: z.boolean().optional().default(true),\n})\n    .and(baseConfigSchema)\n    .describe(\"Configuration for streamable HTTP transport connection\");\n/**\n * Create combined schema for all transport connection types\n */\nexport const connectionSchema = z\n    .union([stdioConnectionSchema, streamableHttpConnectionSchema])\n    .describe(\"Configuration for a single MCP server\");\n/**\n * {@link MultiServerMCPClient} configuration\n */\nexport const clientConfigSchema = z\n    .object({\n    /**\n     * A map of server names to their configuration\n     */\n    mcpServers: z\n        .record(connectionSchema)\n        .describe(\"A map of server names to their configuration\"),\n    /**\n     * Whether to throw an error if a tool fails to load\n     *\n     * @default true\n     */\n    throwOnLoadError: z\n        .boolean()\n        .describe(\"Whether to throw an error if a tool fails to load\")\n        .optional()\n        .default(true),\n    /**\n     * Whether to prefix tool names with the server name. Prefixes are separated by double\n     * underscores (example: `calculator_server_1__add`).\n     *\n     * @default true\n     */\n    prefixToolNameWithServerName: z\n        .boolean()\n        .describe(\"Whether to prefix tool names with the server name\")\n        .optional()\n        .default(false),\n    /**\n     * An additional prefix to add to the tool name Prefixes are separated by double underscores\n     * (example: `mcp__add`).\n     *\n     * @default \"mcp\"\n     */\n    additionalToolNamePrefix: z\n        .string()\n        .describe(\"An additional prefix to add to the tool name\")\n        .optional()\n        .default(\"\"),\n    /**\n     * If true, the tool will use LangChain's standard multimodal content blocks for tools that output\n     * image or audio content, and embedded resources will be converted to `StandardFileBlock` objects.\n     * When `false`, all artifacts are left in their MCP format, but embedded resources will be\n     * converted to `StandardFileBlock` objects if {@link ClientConfig#outputHandling} causes embedded resources to\n     * be treated as content, as otherwise ChatModel providers will not be able to interpret them.\n     *\n     * @default false\n     */\n    useStandardContentBlocks: z\n        .boolean()\n        .describe(\"If true, the tool will use LangChain's standard multimodal content blocks for tools that output\\n\" +\n        \"image or audio content. When true, embedded resources will be converted to `StandardFileBlock`\\n\" +\n        \"objects. When `false`, all artifacts are left in their MCP format, but embedded resources will\\n\" +\n        \"be converted to `StandardFileBlock` objects if `outputHandling` causes embedded resources to be\\n\" +\n        \"treated as content, as otherwise ChatModel providers will not be able to interpret them.\")\n        .optional()\n        .default(false),\n})\n    .and(baseConfigSchema)\n    .describe(\"Configuration for the MCP client\");\n/**\n * Helper function that expands a string literal OutputHandling to an object with all content types.\n * Used when applying server-level overrides to the top-level config.\n *\n * @internal\n */\nexport function _resolveDetailedOutputHandling(outputHandling, applyDefaults = false) {\n    if (outputHandling == null) {\n        return {};\n    }\n    if (typeof outputHandling === \"string\") {\n        return Object.fromEntries(callToolResultContentTypes.map((contentType) => [\n            contentType,\n            outputHandling,\n        ]));\n    }\n    const resolved = {};\n    for (const contentType of callToolResultContentTypes) {\n        if (outputHandling[contentType] || applyDefaults) {\n            resolved[contentType] =\n                outputHandling[contentType] ??\n                    (contentType === \"resource\" ? \"artifact\" : \"content\");\n        }\n    }\n    return resolved;\n}\n/**\n * Given a base {@link OutputHandling}, apply any overrides from the override {@link OutputHandling}.\n *\n * @internal\n */\nexport function _resolveAndApplyOverrideHandlingOverrides(base, override) {\n    const expandedBase = _resolveDetailedOutputHandling(base);\n    const expandedOverride = _resolveDetailedOutputHandling(override);\n    return {\n        ...expandedBase,\n        ...expandedOverride,\n    };\n}\n","import { DynamicStructuredTool } from \"@langchain/core/tools\";\nimport debug from \"debug\";\nimport { _resolveDetailedOutputHandling, } from \"./types.js\";\n// Replace direct initialization with lazy initialization\nlet debugLog;\nfunction getDebugLog() {\n    if (!debugLog) {\n        debugLog = debug(\"@langchain/mcp-adapters:tools\");\n    }\n    return debugLog;\n}\n/**\n * Custom error class for tool exceptions\n */\nexport class ToolException extends Error {\n    constructor(message) {\n        super(message);\n        this.name = \"ToolException\";\n    }\n}\nexport function isToolException(error) {\n    return (typeof error === \"object\" &&\n        error !== null &&\n        \"name\" in error &&\n        error.name === \"ToolException\");\n}\nfunction isResourceReference(resource) {\n    return (typeof resource === \"object\" &&\n        resource !== null &&\n        resource.uri != null &&\n        resource.blob == null &&\n        resource.text == null);\n}\nasync function* _embeddedResourceToStandardFileBlocks(resource, client) {\n    if (isResourceReference(resource)) {\n        const response = await client.readResource({\n            uri: resource.uri,\n        });\n        for (const content of response.contents) {\n            yield* _embeddedResourceToStandardFileBlocks(content, client);\n        }\n        return;\n    }\n    if (resource.blob != null) {\n        yield {\n            type: \"file\",\n            source_type: \"base64\",\n            data: resource.blob,\n            mime_type: resource.mimeType,\n            ...(resource.uri != null ? { metadata: { uri: resource.uri } } : {}),\n        };\n    }\n    if (resource.text != null) {\n        yield {\n            type: \"file\",\n            source_type: \"text\",\n            mime_type: resource.mimeType,\n            text: resource.text,\n            ...(resource.uri != null ? { metadata: { uri: resource.uri } } : {}),\n        };\n    }\n}\nasync function _toolOutputToContentBlocks(content, useStandardContentBlocks, client, toolName, serverName) {\n    const blocks = [];\n    switch (content.type) {\n        case \"text\":\n            return [\n                {\n                    type: \"text\",\n                    ...(useStandardContentBlocks\n                        ? {\n                            source_type: \"text\",\n                        }\n                        : {}),\n                    text: content.text,\n                },\n            ];\n        case \"image\":\n            if (useStandardContentBlocks) {\n                return [\n                    {\n                        type: \"image\",\n                        source_type: \"base64\",\n                        data: content.data,\n                        mime_type: content.mimeType,\n                    },\n                ];\n            }\n            return [\n                {\n                    type: \"image_url\",\n                    image_url: {\n                        url: `data:${content.mimeType};base64,${content.data}`,\n                    },\n                },\n            ];\n        case \"audio\":\n            // We don't check `useStandardContentBlocks` here because we only support audio via\n            // standard content blocks\n            return [\n                {\n                    type: \"audio\",\n                    source_type: \"base64\",\n                    data: content.data,\n                    mime_type: content.mimeType,\n                },\n            ];\n        case \"resource\":\n            for await (const block of _embeddedResourceToStandardFileBlocks(content.resource, client)) {\n                blocks.push(block);\n            }\n            return blocks;\n        default:\n            throw new ToolException(`MCP tool '${toolName}' on server '${serverName}' returned a content block with unexpected type \"${content.type}.\" Expected one of \"text\", \"image\", or \"audio\".`);\n    }\n}\nasync function _embeddedResourceToArtifact(resource, useStandardContentBlocks, client, toolName, serverName) {\n    if (useStandardContentBlocks) {\n        return _toolOutputToContentBlocks(resource, useStandardContentBlocks, client, toolName, serverName);\n    }\n    if (!resource.blob && !resource.text && resource.uri) {\n        const response = await client.readResource({\n            uri: resource.resource.uri,\n        });\n        return response.contents.map((content) => ({\n            type: \"resource\",\n            resource: {\n                ...content,\n            },\n        }));\n    }\n    return [resource];\n}\nfunction _getOutputTypeForContentType(contentType, outputHandling) {\n    if (outputHandling === \"content\" || outputHandling === \"artifact\") {\n        return outputHandling;\n    }\n    const resolved = _resolveDetailedOutputHandling(outputHandling);\n    return (resolved[contentType] ??\n        (contentType === \"resource\" ? \"artifact\" : \"content\"));\n}\n/**\n * Process the result from calling an MCP tool.\n * Extracts text content and non-text content for better agent compatibility.\n *\n * @internal\n *\n * @param args - The arguments to pass to the tool\n * @returns A tuple of [textContent, nonTextContent]\n */\nasync function _convertCallToolResult({ serverName, toolName, result, client, useStandardContentBlocks, outputHandling, }) {\n    if (!result) {\n        throw new ToolException(`MCP tool '${toolName}' on server '${serverName}' returned an invalid result - tool call response was undefined`);\n    }\n    if (!Array.isArray(result.content)) {\n        throw new ToolException(`MCP tool '${toolName}' on server '${serverName}' returned an invalid result - expected an array of content, but was ${typeof result.content}`);\n    }\n    if (result.isError) {\n        throw new ToolException(`MCP tool '${toolName}' on server '${serverName}' returned an error: ${result.content\n            .map((content) => content.text)\n            .join(\"\\n\")}`);\n    }\n    const convertedContent = (await Promise.all(result.content\n        .filter((content) => _getOutputTypeForContentType(content.type, outputHandling) ===\n        \"content\")\n        .map((content) => _toolOutputToContentBlocks(content, useStandardContentBlocks, client, toolName, serverName)))).flat();\n    // Create the text content output\n    const artifacts = (await Promise.all(result.content.filter((content) => _getOutputTypeForContentType(content.type, outputHandling) ===\n        \"artifact\").map((content) => {\n        return _embeddedResourceToArtifact(content, useStandardContentBlocks, client, toolName, serverName);\n    }))).flat();\n    if (convertedContent.length === 1 && convertedContent[0].type === \"text\") {\n        return [convertedContent[0].text, artifacts];\n    }\n    return [convertedContent, artifacts];\n}\n/**\n * Call an MCP tool.\n *\n * Use this with `.bind` to capture the fist three arguments, then pass to the constructor of DynamicStructuredTool.\n *\n * @internal\n * @param args - The arguments to pass to the tool\n * @returns A tuple of [textContent, nonTextContent]\n */\nasync function _callTool({ serverName, toolName, client, args, config, useStandardContentBlocks, outputHandling, }) {\n    try {\n        getDebugLog()(`INFO: Calling tool ${toolName}(${JSON.stringify(args)})`);\n        // Extract timeout from RunnableConfig and pass to MCP SDK\n        const requestOptions = {\n            ...(config?.timeout ? { timeout: config.timeout } : {}),\n            ...(config?.signal ? { signal: config.signal } : {}),\n        };\n        const callToolArgs = [\n            {\n                name: toolName,\n                arguments: args,\n            },\n        ];\n        if (Object.keys(requestOptions).length > 0) {\n            callToolArgs.push(undefined); // optional output schema arg\n            callToolArgs.push(requestOptions);\n        }\n        const result = await client.callTool(...callToolArgs);\n        return _convertCallToolResult({\n            serverName,\n            toolName,\n            result: result,\n            client,\n            useStandardContentBlocks,\n            outputHandling,\n        });\n    }\n    catch (error) {\n        getDebugLog()(`Error calling tool ${toolName}: ${String(error)}`);\n        if (isToolException(error)) {\n            throw error;\n        }\n        throw new ToolException(`Error calling tool ${toolName}: ${String(error)}`);\n    }\n}\nconst defaultLoadMcpToolsOptions = {\n    throwOnLoadError: true,\n    prefixToolNameWithServerName: false,\n    additionalToolNamePrefix: \"\",\n    useStandardContentBlocks: false,\n};\n/**\n * Load all tools from an MCP client.\n *\n * @param serverName - The name of the server to load tools from\n * @param client - The MCP client\n * @returns A list of LangChain tools\n */\nexport async function loadMcpTools(serverName, client, options) {\n    const { throwOnLoadError, prefixToolNameWithServerName, additionalToolNamePrefix, useStandardContentBlocks, outputHandling, defaultToolTimeout, } = {\n        ...defaultLoadMcpToolsOptions,\n        ...(options ?? {}),\n    };\n    const mcpTools = [];\n    // Get tools in a single operation\n    let toolsResponse;\n    do {\n        toolsResponse = await client.listTools({\n            ...(toolsResponse?.nextCursor\n                ? { cursor: toolsResponse.nextCursor }\n                : {}),\n        });\n        mcpTools.push(...(toolsResponse.tools || []));\n    } while (toolsResponse.nextCursor);\n    getDebugLog()(`INFO: Found ${mcpTools.length} MCP tools`);\n    const initialPrefix = additionalToolNamePrefix\n        ? `${additionalToolNamePrefix}__`\n        : \"\";\n    const serverPrefix = prefixToolNameWithServerName ? `${serverName}__` : \"\";\n    const toolNamePrefix = `${initialPrefix}${serverPrefix}`;\n    // Filter out tools without names and convert in a single map operation\n    return (await Promise.all(mcpTools\n        .filter((tool) => !!tool.name)\n        .map(async (tool) => {\n        try {\n            if (!tool.inputSchema.properties) {\n                // Workaround for MCP SDK not consistently providing properties\n                // eslint-disable-next-line no-param-reassign\n                tool.inputSchema.properties = {};\n            }\n            const dst = new DynamicStructuredTool({\n                name: `${toolNamePrefix}${tool.name}`,\n                description: tool.description || \"\",\n                schema: tool.inputSchema,\n                responseFormat: \"content_and_artifact\",\n                metadata: { annotations: tool.annotations },\n                defaultConfig: defaultToolTimeout\n                    ? { timeout: defaultToolTimeout }\n                    : undefined,\n                func: async (args, _runManager, config) => {\n                    return _callTool({\n                        serverName,\n                        toolName: tool.name,\n                        client,\n                        args,\n                        config,\n                        useStandardContentBlocks,\n                        outputHandling,\n                    });\n                },\n            });\n            getDebugLog()(`INFO: Successfully loaded tool: ${dst.name}`);\n            return dst;\n        }\n        catch (error) {\n            getDebugLog()(`ERROR: Failed to load tool \"${tool.name}\":`, error);\n            if (throwOnLoadError) {\n                throw error;\n            }\n            return null;\n        }\n    }))).filter(Boolean);\n}\n","import { Client } from \"@modelcontextprotocol/sdk/client/index.js\";\nimport { StdioClientTransport } from \"@modelcontextprotocol/sdk/client/stdio.js\";\nimport { SSEClientTransport, } from \"@modelcontextprotocol/sdk/client/sse.js\";\nimport { StreamableHTTPClientTransport, } from \"@modelcontextprotocol/sdk/client/streamableHttp.js\";\nimport debug from \"debug\";\nimport { z } from \"zod\";\nimport { loadMcpTools } from \"./tools.js\";\nimport { clientConfigSchema, connectionSchema, _resolveAndApplyOverrideHandlingOverrides, } from \"./types.js\";\n// Read package name from package.json\nlet debugLog;\nfunction getDebugLog() {\n    if (!debugLog) {\n        debugLog = debug(\"@langchain/mcp-adapters:client\");\n    }\n    return debugLog;\n}\n/**\n * Error class for MCP client operations\n */\nexport class MCPClientError extends Error {\n    constructor(message, serverName) {\n        super(message);\n        Object.defineProperty(this, \"serverName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: serverName\n        });\n        this.name = \"MCPClientError\";\n    }\n}\nfunction isResolvedStdioConnection(connection) {\n    if (typeof connection !== \"object\" ||\n        connection === null ||\n        Array.isArray(connection)) {\n        return false;\n    }\n    if (\"transport\" in connection && connection.transport === \"stdio\") {\n        return true;\n    }\n    if (\"type\" in connection && connection.type === \"stdio\") {\n        return true;\n    }\n    if (\"command\" in connection && typeof connection.command === \"string\") {\n        return true;\n    }\n    return false;\n}\nfunction isResolvedStreamableHTTPConnection(connection) {\n    if (typeof connection !== \"object\" ||\n        connection === null ||\n        Array.isArray(connection)) {\n        return false;\n    }\n    if ((\"transport\" in connection &&\n        typeof connection.transport === \"string\" &&\n        [\"http\", \"sse\"].includes(connection.transport)) ||\n        (\"type\" in connection &&\n            typeof connection.type === \"string\" &&\n            [\"http\", \"sse\"].includes(connection.type))) {\n        return true;\n    }\n    if (\"url\" in connection && typeof connection.url === \"string\") {\n        try {\n            // eslint-disable-next-line no-new\n            new URL(connection.url);\n            return true;\n        }\n        catch (error) {\n            return false;\n        }\n    }\n    return false;\n}\n/**\n * Client for connecting to multiple MCP servers and loading LangChain-compatible tools.\n */\nexport class MultiServerMCPClient {\n    /**\n     * Returns clone of server config for inspection purposes.\n     *\n     * Client does not support config modifications.\n     */\n    get config() {\n        // clone config so it can't be mutated\n        return JSON.parse(JSON.stringify(this._config));\n    }\n    /**\n     * Create a new MultiServerMCPClient.\n     *\n     * @param config - Configuration object\n     */\n    constructor(config) {\n        Object.defineProperty(this, \"_clients\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"_serverNameToTools\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"_connections\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"_loadToolsOptions\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"_cleanupFunctions\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        Object.defineProperty(this, \"_transportInstances\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"_config\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        let parsedServerConfig;\n        const configSchema = clientConfigSchema;\n        if (\"mcpServers\" in config) {\n            parsedServerConfig = configSchema.parse(config);\n        }\n        else {\n            // two step parse so parse errors are referencing the correct object paths\n            const parsedMcpServers = z.record(connectionSchema).parse(config);\n            parsedServerConfig = configSchema.parse({ mcpServers: parsedMcpServers });\n        }\n        if (Object.keys(parsedServerConfig.mcpServers).length === 0) {\n            throw new MCPClientError(\"No MCP servers provided\");\n        }\n        for (const [serverName, serverConfig] of Object.entries(parsedServerConfig.mcpServers)) {\n            const outputHandling = _resolveAndApplyOverrideHandlingOverrides(parsedServerConfig.outputHandling, serverConfig.outputHandling);\n            const defaultToolTimeout = parsedServerConfig.defaultToolTimeout ??\n                serverConfig.defaultToolTimeout;\n            this._loadToolsOptions[serverName] = {\n                throwOnLoadError: parsedServerConfig.throwOnLoadError,\n                prefixToolNameWithServerName: parsedServerConfig.prefixToolNameWithServerName,\n                additionalToolNamePrefix: parsedServerConfig.additionalToolNamePrefix,\n                useStandardContentBlocks: parsedServerConfig.useStandardContentBlocks,\n                ...(Object.keys(outputHandling).length > 0 ? { outputHandling } : {}),\n                ...(defaultToolTimeout ? { defaultToolTimeout } : {}),\n            };\n        }\n        this._config = parsedServerConfig;\n        this._connections = parsedServerConfig.mcpServers;\n    }\n    /**\n     * Proactively initialize connections to all servers. This will be called automatically when\n     * methods requiring an active connection (like {@link getTools} or {@link getClient}) are called,\n     * but you can call it directly to ensure all connections are established before using the tools.\n     *\n     * @returns A map of server names to arrays of tools\n     * @throws {MCPClientError} If initialization fails\n     */\n    async initializeConnections() {\n        if (!this._connections || Object.keys(this._connections).length === 0) {\n            throw new MCPClientError(\"No connections to initialize\");\n        }\n        const connectionsToInit = Array.from(Object.entries(this._connections).filter(([serverName]) => this._clients[serverName] === undefined));\n        for (const [serverName, connection] of connectionsToInit) {\n            getDebugLog()(`INFO: Initializing connection to server \"${serverName}\"...`);\n            if (isResolvedStdioConnection(connection)) {\n                await this._initializeStdioConnection(serverName, connection);\n            }\n            else if (isResolvedStreamableHTTPConnection(connection)) {\n                if (connection.type === \"sse\" || connection.transport === \"sse\") {\n                    await this._initializeSSEConnection(serverName, connection);\n                }\n                else {\n                    await this._initializeStreamableHTTPConnection(serverName, connection);\n                }\n            }\n            else {\n                // This should never happen due to the validation in the constructor\n                throw new MCPClientError(`Unsupported transport type for server \"${serverName}\"`, serverName);\n            }\n        }\n        return this._serverNameToTools;\n    }\n    /**\n     * Get tools from specified servers as a flattened array.\n     *\n     * @param servers - Optional array of server names to filter tools by.\n     *                 If not provided, returns tools from all servers.\n     * @returns A flattened array of tools from the specified servers (or all servers)\n     */\n    async getTools(...servers) {\n        await this.initializeConnections();\n        if (servers.length === 0) {\n            return this._getAllToolsAsFlatArray();\n        }\n        return this._getToolsFromServers(servers);\n    }\n    /**\n     * Get a the MCP client for a specific server. Useful for fetching prompts or resources from that server.\n     *\n     * @param serverName - The name of the server\n     * @returns The client for the server, or undefined if the server is not connected\n     */\n    async getClient(serverName) {\n        await this.initializeConnections();\n        return this._clients[serverName];\n    }\n    /**\n     * Close all connections.\n     */\n    async close() {\n        getDebugLog()(`INFO: Closing all MCP connections...`);\n        for (const cleanup of this._cleanupFunctions) {\n            try {\n                await cleanup();\n            }\n            catch (error) {\n                getDebugLog()(`ERROR: Error during cleanup: ${error}`);\n            }\n        }\n        this._cleanupFunctions = [];\n        this._clients = {};\n        this._serverNameToTools = {};\n        this._transportInstances = {};\n        getDebugLog()(`INFO: All MCP connections closed`);\n    }\n    /**\n     * Initialize a stdio connection\n     */\n    async _initializeStdioConnection(serverName, connection) {\n        const { command, args, env, restart, stderr } = connection;\n        getDebugLog()(`DEBUG: Creating stdio transport for server \"${serverName}\" with command: ${command} ${args.join(\" \")}`);\n        const transport = new StdioClientTransport({\n            command,\n            args,\n            stderr,\n            ...(env ? { env: { PATH: process.env.PATH, ...env } } : {}),\n        });\n        this._transportInstances[serverName] = transport;\n        const client = new Client({\n            name: \"langchain-mcp-adapter\",\n            version: \"0.1.0\",\n        });\n        try {\n            await client.connect(transport);\n            // Set up auto-restart if configured\n            if (restart?.enabled) {\n                this._setupStdioRestart(serverName, transport, connection, restart);\n            }\n        }\n        catch (error) {\n            throw new MCPClientError(`Failed to connect to stdio server \"${serverName}\": ${error}`, serverName);\n        }\n        this._clients[serverName] = client;\n        const cleanup = async () => {\n            getDebugLog()(`DEBUG: Closing stdio transport for server \"${serverName}\"`);\n            await transport.close();\n        };\n        this._cleanupFunctions.push(cleanup);\n        // Load tools for this server\n        await this._loadToolsForServer(serverName, client);\n    }\n    /**\n     * Set up stdio restart handling\n     */\n    _setupStdioRestart(serverName, transport, connection, restart) {\n        const originalOnClose = transport.onclose;\n        // eslint-disable-next-line no-param-reassign, @typescript-eslint/no-misused-promises\n        transport.onclose = async () => {\n            if (originalOnClose) {\n                await originalOnClose();\n            }\n            // Only attempt restart if we haven't cleaned up\n            if (this._clients[serverName]) {\n                getDebugLog()(`INFO: Process for server \"${serverName}\" exited, attempting to restart...`);\n                await this._attemptReconnect(serverName, connection, restart.maxAttempts, restart.delayMs);\n            }\n        };\n    }\n    _getHttpErrorCode(error) {\n        const streamableError = error;\n        let { code } = streamableError;\n        // try parsing from error message if code is not set\n        if (code == null) {\n            const m = streamableError.message.match(/\\(HTTP (\\d\\d\\d)\\)/);\n            if (m && m.length > 1) {\n                code = parseInt(m[1], 10);\n            }\n        }\n        return code;\n    }\n    _createAuthenticationErrorMessage(serverName, url, transport, originalError) {\n        return (`Authentication failed for ${transport} server \"${serverName}\" at ${url}. ` +\n            `Please check your credentials, authorization headers, or OAuth configuration. ` +\n            `Original error: ${originalError}`);\n    }\n    _toSSEConnectionURL(url) {\n        const urlObj = new URL(url);\n        const pathnameParts = urlObj.pathname.split(\"/\");\n        const lastPart = pathnameParts.at(-1);\n        if (lastPart && lastPart === \"mcp\") {\n            pathnameParts[pathnameParts.length - 1] = \"sse\";\n        }\n        urlObj.pathname = pathnameParts.join(\"/\");\n        return urlObj.toString();\n    }\n    /**\n     * Initialize a streamable HTTP connection\n     */\n    async _initializeStreamableHTTPConnection(serverName, connection) {\n        const { url, headers, reconnect, type: typeField, transport: transportField, authProvider, } = connection;\n        const automaticSSEFallback = connection.automaticSSEFallback ?? true;\n        const transportType = typeField || transportField;\n        getDebugLog()(`DEBUG: Creating Streamable HTTP transport for server \"${serverName}\" with URL: ${url}`);\n        if (transportType === \"http\" || transportType == null) {\n            const transport = await this._createStreamableHTTPTransport(serverName, url, headers, reconnect, authProvider);\n            this._transportInstances[serverName] = transport;\n            const client = new Client({\n                name: \"langchain-mcp-adapter\",\n                version: \"0.1.0\",\n            });\n            try {\n                await client.connect(transport);\n                this._clients[serverName] = client;\n                const cleanup = async () => {\n                    getDebugLog()(`DEBUG: Closing streamable HTTP transport for server \"${serverName}\"`);\n                    await transport.close();\n                };\n                this._cleanupFunctions.push(cleanup);\n                // Load tools for this server\n                await this._loadToolsForServer(serverName, client);\n            }\n            catch (error) {\n                const code = this._getHttpErrorCode(error);\n                if (automaticSSEFallback && code != null && code >= 400 && code < 500) {\n                    // Streamable HTTP error is a 4xx, so fall back to SSE\n                    try {\n                        await this._initializeSSEConnection(serverName, connection);\n                    }\n                    catch (firstSSEError) {\n                        // try one more time, but modify the URL to end with `/sse`\n                        const sseUrl = this._toSSEConnectionURL(url);\n                        if (sseUrl !== url) {\n                            try {\n                                await this._initializeSSEConnection(serverName, {\n                                    ...connection,\n                                    url: sseUrl,\n                                });\n                            }\n                            catch (secondSSEError) {\n                                // Provide specific error message for authentication failures\n                                if (code === 401) {\n                                    throw new MCPClientError(this._createAuthenticationErrorMessage(serverName, url, \"HTTP\", `${error}. Also tried SSE fallback at ${url} and ${sseUrl}, but both failed with authentication errors.`), serverName);\n                                }\n                                throw new MCPClientError(`Failed to connect to streamable HTTP server \"${serverName}, url: ${url}\": ${error}. Additionally, tried falling back to SSE at ${url} and ${sseUrl}, but this also failed: ${secondSSEError}`, serverName);\n                            }\n                        }\n                        else {\n                            // Provide specific error message for authentication failures\n                            if (code === 401) {\n                                throw new MCPClientError(this._createAuthenticationErrorMessage(serverName, url, \"HTTP\", `${error}. Also tried SSE fallback at ${url}, but it failed with authentication error: ${firstSSEError}`), serverName);\n                            }\n                            throw new MCPClientError(`Failed to connect to streamable HTTP server after trying to fall back to SSE: \"${serverName}, url: ${url}\": ${error} (SSE fallback failed with error ${firstSSEError})`, serverName);\n                        }\n                    }\n                }\n                else {\n                    // Provide specific error message for authentication failures\n                    if (code === 401) {\n                        throw new MCPClientError(this._createAuthenticationErrorMessage(serverName, url, \"HTTP\", `${error}`), serverName);\n                    }\n                    throw new MCPClientError(`Failed to connect to streamable HTTP server \"${serverName}, url: ${url}\": ${error}`, serverName);\n                }\n            }\n        }\n    }\n    /**\n     * Initialize an SSE connection\n     *\n     * Don't call this directly unless SSE transport is explicitly requested. Otherwise,\n     * use _initializeStreamableHTTPConnection and it'll fall back to SSE if needed for\n     * backwards compatibility.\n     */\n    async _initializeSSEConnection(serverName, connection // used for both SSE and streamable HTTP\n    ) {\n        const { url, headers, reconnect, authProvider } = connection;\n        try {\n            const transport = await this._createSSETransport(serverName, url, headers, authProvider);\n            this._transportInstances[serverName] = transport;\n            const client = new Client({\n                name: \"langchain-mcp-adapter\",\n                version: \"0.1.0\",\n            });\n            try {\n                await client.connect(transport);\n                // Set up auto-reconnect if configured\n                if (reconnect?.enabled) {\n                    this._setupSSEReconnect(serverName, transport, connection, reconnect);\n                }\n            }\n            catch (error) {\n                // Check if this is already a wrapped error that should be re-thrown\n                if (error && error.name === \"MCPClientError\") {\n                    throw error;\n                }\n                // Check if this is an authentication error that needs better messaging\n                const isAuthError = error && this._getHttpErrorCode(error) === 401;\n                if (isAuthError) {\n                    throw new MCPClientError(this._createAuthenticationErrorMessage(serverName, url, \"SSE\", `${error}`), serverName);\n                }\n                throw new MCPClientError(`Failed to create SSE transport for server \"${serverName}, url: ${url}\": ${error}`, serverName);\n            }\n            this._clients[serverName] = client;\n            const cleanup = async () => {\n                getDebugLog()(`DEBUG: Closing SSE transport for server \"${serverName}\"`);\n                await transport.close();\n            };\n            this._cleanupFunctions.push(cleanup);\n            // Load tools for this server\n            await this._loadToolsForServer(serverName, client);\n        }\n        catch (error) {\n            throw new MCPClientError(`Failed to create SSE transport for server \"${serverName}, url: ${url}\": ${error}`, serverName);\n        }\n    }\n    /**\n     * Create an SSE transport with appropriate EventSource implementation\n     *\n     * @param serverName - The name of the server\n     * @param url - The URL of the server\n     * @param headers - The headers to send with the request\n     * @param authProvider - The OAuth client provider to use for authentication\n     * @returns The SSE transport\n     */\n    async _createSSETransport(serverName, url, headers, authProvider) {\n        const options = {};\n        if (authProvider) {\n            options.authProvider = authProvider;\n            getDebugLog()(`DEBUG: Using OAuth authentication for SSE transport to server \"${serverName}\"`);\n        }\n        if (headers) {\n            // For SSE, we need to pass headers via eventSourceInit.fetch for the initial connection\n            // and also via requestInit.headers for subsequent POST requests\n            options.eventSourceInit = {\n                fetch: async (url, init) => {\n                    const requestHeaders = new Headers(init?.headers);\n                    // Add OAuth token if authProvider is available\n                    // This is necessary because setting eventSourceInit.fetch prevents automatic Authorization header\n                    if (authProvider) {\n                        const tokens = await authProvider.tokens();\n                        if (tokens) {\n                            requestHeaders.set(\"Authorization\", `Bearer ${tokens.access_token}`);\n                        }\n                    }\n                    // Add our custom headers\n                    Object.entries(headers).forEach(([key, value]) => {\n                        requestHeaders.set(key, value);\n                    });\n                    // Always include Accept header for SSE\n                    requestHeaders.set(\"Accept\", \"text/event-stream\");\n                    return fetch(url, {\n                        ...init,\n                        headers: requestHeaders,\n                    });\n                },\n            };\n            // Also include headers for POST requests\n            options.requestInit = { headers };\n            getDebugLog()(`DEBUG: Using custom headers for SSE transport to server \"${serverName}\"`);\n        }\n        return new SSEClientTransport(new URL(url), options);\n    }\n    async _createStreamableHTTPTransport(serverName, url, headers, reconnect, authProvider) {\n        const options = {\n            ...(authProvider ? { authProvider } : {}),\n            ...(headers ? { requestInit: { headers } } : {}),\n        };\n        if (reconnect != null) {\n            const reconnectionOptions = {\n                initialReconnectionDelay: reconnect?.delayMs ?? 1000, // MCP default\n                maxReconnectionDelay: reconnect?.delayMs ?? 30000, // MCP default\n                maxRetries: reconnect?.maxAttempts ?? 2, // MCP default\n                reconnectionDelayGrowFactor: 1.5, // MCP default\n            };\n            if (reconnect.enabled === false) {\n                reconnectionOptions.maxRetries = 0;\n            }\n            options.reconnectionOptions = reconnectionOptions;\n        }\n        if (options.requestInit?.headers) {\n            getDebugLog()(`DEBUG: Using custom headers for SSE transport to server \"${serverName}\"`);\n        }\n        if (options.authProvider) {\n            getDebugLog()(`DEBUG: Using OAuth authentication for Streamable HTTP transport to server \"${serverName}\"`);\n        }\n        if (options.reconnectionOptions) {\n            if (options.reconnectionOptions.maxRetries === 0) {\n                getDebugLog()(`DEBUG: Disabling reconnection for Streamable HTTP transport to server \"${serverName}\"`);\n            }\n            else {\n                getDebugLog()(`DEBUG: Using custom reconnection options for Streamable HTTP transport to server \"${serverName}\"`);\n            }\n        }\n        // Only pass options if there are any, otherwise use default constructor\n        return Object.keys(options).length > 0\n            ? new StreamableHTTPClientTransport(new URL(url), options)\n            : new StreamableHTTPClientTransport(new URL(url));\n    }\n    /**\n     * Set up reconnect handling for SSE (Streamable HTTP reconnects are more complex and are handled internally by the SDK)\n     */\n    _setupSSEReconnect(serverName, transport, connection, reconnect) {\n        const originalOnClose = transport.onclose;\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises, no-param-reassign\n        transport.onclose = async () => {\n            if (originalOnClose) {\n                await originalOnClose();\n            }\n            // Only attempt reconnect if we haven't cleaned up\n            if (this._clients[serverName]) {\n                getDebugLog()(`INFO: HTTP connection for server \"${serverName}\" closed, attempting to reconnect...`);\n                await this._attemptReconnect(serverName, connection, reconnect.maxAttempts, reconnect.delayMs);\n            }\n        };\n    }\n    /**\n     * Load tools for a specific server\n     */\n    async _loadToolsForServer(serverName, client) {\n        try {\n            getDebugLog()(`DEBUG: Loading tools for server \"${serverName}\"...`);\n            const tools = await loadMcpTools(serverName, client, this._loadToolsOptions[serverName]);\n            this._serverNameToTools[serverName] = tools;\n            getDebugLog()(`INFO: Successfully loaded ${tools.length} tools from server \"${serverName}\"`);\n        }\n        catch (error) {\n            throw new MCPClientError(`Failed to load tools from server \"${serverName}\": ${error}`);\n        }\n    }\n    /**\n     * Attempt to reconnect to a server after a connection failure.\n     *\n     * @param serverName - The name of the server to reconnect to\n     * @param connection - The connection configuration\n     * @param maxAttempts - Maximum number of reconnection attempts\n     * @param delayMs - Delay in milliseconds between reconnection attempts\n     * @private\n     */\n    async _attemptReconnect(serverName, connection, maxAttempts = 3, delayMs = 1000) {\n        let connected = false;\n        let attempts = 0;\n        // Clean up previous connection resources\n        this._cleanupServerResources(serverName);\n        while (!connected &&\n            (maxAttempts === undefined || attempts < maxAttempts)) {\n            attempts += 1;\n            getDebugLog()(`INFO: Reconnection attempt ${attempts}${maxAttempts ? `/${maxAttempts}` : \"\"} for server \"${serverName}\"`);\n            try {\n                // Wait before attempting to reconnect\n                if (delayMs) {\n                    await new Promise((resolve) => {\n                        setTimeout(resolve, delayMs);\n                    });\n                }\n                // Initialize just this connection based on its type\n                if (isResolvedStdioConnection(connection)) {\n                    await this._initializeStdioConnection(serverName, connection);\n                }\n                else if (isResolvedStreamableHTTPConnection(connection)) {\n                    if (connection.type === \"sse\" || connection.transport === \"sse\") {\n                        await this._initializeSSEConnection(serverName, connection);\n                    }\n                    else {\n                        await this._initializeStreamableHTTPConnection(serverName, connection);\n                    }\n                }\n                // Check if connected\n                if (this._clients[serverName]) {\n                    connected = true;\n                    getDebugLog()(`INFO: Successfully reconnected to server \"${serverName}\"`);\n                }\n            }\n            catch (error) {\n                getDebugLog()(`ERROR: Failed to reconnect to server \"${serverName}\" (attempt ${attempts}): ${error}`);\n            }\n        }\n        if (!connected) {\n            getDebugLog()(`ERROR: Failed to reconnect to server \"${serverName}\" after ${attempts} attempts`);\n        }\n    }\n    /**\n     * Clean up resources for a specific server\n     */\n    _cleanupServerResources(serverName) {\n        delete this._clients[serverName];\n        delete this._serverNameToTools[serverName];\n        delete this._transportInstances[serverName];\n    }\n    /**\n     * Get all tools from all servers as a flat array.\n     *\n     * @returns A flattened array of all tools\n     */\n    _getAllToolsAsFlatArray() {\n        const allTools = [];\n        for (const tools of Object.values(this._serverNameToTools)) {\n            allTools.push(...tools);\n        }\n        return allTools;\n    }\n    /**\n     * Get tools from specific servers as a flat array.\n     *\n     * @param serverNames - Names of servers to get tools from\n     * @returns A flattened array of tools from the specified servers\n     */\n    _getToolsFromServers(serverNames) {\n        const allTools = [];\n        for (const serverName of serverNames) {\n            const tools = this._serverNameToTools[serverName];\n            if (tools) {\n                allTools.push(...tools);\n            }\n        }\n        return allTools;\n    }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { z } from 'zod'\nimport { JsonSchema, jsonSchemaToZod } from 'json-schema-to-zod'\nimport { DynamicStructuredTool } from '@langchain/core/tools'\nimport { MultiServerMCPClient } from '@langchain/mcp-adapters'\nimport type { Mcp } from 'src/services/database/types'\n\nconst PROTOCOL = 'sse' as 'sse' | 'stdio'\nconst urlToProtocol = (url: string) => {\n  let response = url\n  switch (PROTOCOL) {\n    case 'sse':\n      response = url.endsWith('/') ? `${url}sse` : `${url}/sse`\n      break\n    case 'stdio':\n      response = url.endsWith('/') ? `${url}` : `${url}`\n      break\n  }\n  return response.replace(/\\/\\//g, '/')\n}\nexport const getMCPClientTools = async (\n  mpcs: Mcp[],\n  options?: {\n    globalThrowOnLoadError?: boolean\n    throwOnLoadError?: boolean\n    prefixToolNameWithServerName?: boolean\n    additionalToolNamePrefix?: string\n  },\n): Promise<DynamicStructuredTool[]> => {\n  try {\n    const client = new MultiServerMCPClient({\n      // Global tool configuration options\n      // Whether to throw on errors if a tool fails to load (optional, default: true)\n      throwOnLoadError: options?.throwOnLoadError ?? true,\n      // Whether to prefix tool names with the server name (optional, default: true)\n      prefixToolNameWithServerName: options?.prefixToolNameWithServerName ?? true,\n      // Optional additional prefix for tool names (optional, default: \"mcp\")\n      additionalToolNamePrefix: options?.additionalToolNamePrefix ?? 'mcp',\n      // Server configuration\n      mcpServers: {\n        // SSE transport example with reconnection configuration\n        ...mpcs.reduce((acc: Record<string, any>, mcp) => {\n          acc[mcp.key] = {\n            transport: PROTOCOL,\n            url: urlToProtocol(mcp.url),\n            type: PROTOCOL,\n            headers: {},\n            useNodeEventSource: false,\n            reconnect: {\n              enabled: false,\n              maxAttempts: 5,\n              delayMs: 2000,\n            },\n          }\n          return acc\n        }, {}),\n      },\n    })\n\n    const tools = await client.getTools()\n    for (const index in tools) {\n      const tool = tools[index]\n      const zodObject = new Function(\n        'z',\n        `return (${jsonSchemaToZod(tool.schema as JsonSchema)});`,\n      )(z)\n      tool.schema = zodObject\n    }\n\n    return tools as DynamicStructuredTool[]\n  } catch (error) {\n    if (options?.globalThrowOnLoadError) {\n      throw error\n    }\n    // Log the error and return an empty array if globalThrowOnLoadError is false\n    console.error('Error creating MCP client tools:', error)\n    return []\n  }\n}\n","export const ignoreOverride = Symbol(\"Let zodToJsonSchema decide on which parser to use\");\nexport const defaultOptions = {\n    name: undefined,\n    $refStrategy: \"root\",\n    basePath: [\"#\"],\n    effectStrategy: \"input\",\n    pipeStrategy: \"all\",\n    dateStrategy: \"format:date-time\",\n    mapStrategy: \"entries\",\n    removeAdditionalStrategy: \"passthrough\",\n    definitionPath: \"definitions\",\n    target: \"jsonSchema7\",\n    strictUnions: false,\n    definitions: {},\n    errorMessages: false,\n    markdownDescription: false,\n    patternStrategy: \"escape\",\n    applyRegexFlags: false,\n    emailStrategy: \"format:email\",\n    base64Strategy: \"contentEncoding:base64\",\n    nameStrategy: \"ref\"\n};\nexport const getDefaultOptions = (options) => (typeof options === \"string\"\n    ? {\n        ...defaultOptions,\n        name: options,\n    }\n    : {\n        ...defaultOptions,\n        ...options,\n    });\n","import { getDefaultOptions } from \"./Options.js\";\nexport const getRefs = (options) => {\n    const _options = getDefaultOptions(options);\n    const currentPath = _options.name !== undefined\n        ? [..._options.basePath, _options.definitionPath, _options.name]\n        : _options.basePath;\n    return {\n        ..._options,\n        currentPath: currentPath,\n        propertyPath: undefined,\n        seen: new Map(Object.entries(_options.definitions).map(([name, def]) => [\n            def._def,\n            {\n                def: def._def,\n                path: [..._options.basePath, _options.definitionPath, name],\n                // Resolution of references will be forced even though seen, so it's ok that the schema is undefined here for now.\n                jsonSchema: undefined,\n            },\n        ])),\n    };\n};\n","export function addErrorMessage(res, key, errorMessage, refs) {\n    if (!refs?.errorMessages)\n        return;\n    if (errorMessage) {\n        res.errorMessage = {\n            ...res.errorMessage,\n            [key]: errorMessage,\n        };\n    }\n}\nexport function setResponseValueAndErrors(res, key, value, errorMessage, refs) {\n    res[key] = value;\n    addErrorMessage(res, key, errorMessage, refs);\n}\n","export function parseAnyDef() {\n    return {};\n}\n","import { ZodFirstPartyTypeKind } from \"zod\";\nimport { setResponseValueAndErrors } from \"../errorMessages.js\";\nimport { parseDef } from \"../parseDef.js\";\nexport function parseArrayDef(def, refs) {\n    const res = {\n        type: \"array\",\n    };\n    if (def.type?._def && def.type?._def?.typeName !== ZodFirstPartyTypeKind.ZodAny) {\n        res.items = parseDef(def.type._def, {\n            ...refs,\n            currentPath: [...refs.currentPath, \"items\"],\n        });\n    }\n    if (def.minLength) {\n        setResponseValueAndErrors(res, \"minItems\", def.minLength.value, def.minLength.message, refs);\n    }\n    if (def.maxLength) {\n        setResponseValueAndErrors(res, \"maxItems\", def.maxLength.value, def.maxLength.message, refs);\n    }\n    if (def.exactLength) {\n        setResponseValueAndErrors(res, \"minItems\", def.exactLength.value, def.exactLength.message, refs);\n        setResponseValueAndErrors(res, \"maxItems\", def.exactLength.value, def.exactLength.message, refs);\n    }\n    return res;\n}\n","import { setResponseValueAndErrors } from \"../errorMessages.js\";\nexport function parseBigintDef(def, refs) {\n    const res = {\n        type: \"integer\",\n        format: \"int64\",\n    };\n    if (!def.checks)\n        return res;\n    for (const check of def.checks) {\n        switch (check.kind) {\n            case \"min\":\n                if (refs.target === \"jsonSchema7\") {\n                    if (check.inclusive) {\n                        setResponseValueAndErrors(res, \"minimum\", check.value, check.message, refs);\n                    }\n                    else {\n                        setResponseValueAndErrors(res, \"exclusiveMinimum\", check.value, check.message, refs);\n                    }\n                }\n                else {\n                    if (!check.inclusive) {\n                        res.exclusiveMinimum = true;\n                    }\n                    setResponseValueAndErrors(res, \"minimum\", check.value, check.message, refs);\n                }\n                break;\n            case \"max\":\n                if (refs.target === \"jsonSchema7\") {\n                    if (check.inclusive) {\n                        setResponseValueAndErrors(res, \"maximum\", check.value, check.message, refs);\n                    }\n                    else {\n                        setResponseValueAndErrors(res, \"exclusiveMaximum\", check.value, check.message, refs);\n                    }\n                }\n                else {\n                    if (!check.inclusive) {\n                        res.exclusiveMaximum = true;\n                    }\n                    setResponseValueAndErrors(res, \"maximum\", check.value, check.message, refs);\n                }\n                break;\n            case \"multipleOf\":\n                setResponseValueAndErrors(res, \"multipleOf\", check.value, check.message, refs);\n                break;\n        }\n    }\n    return res;\n}\n","export function parseBooleanDef() {\n    return {\n        type: \"boolean\",\n    };\n}\n","import { parseDef } from \"../parseDef.js\";\nexport function parseBrandedDef(_def, refs) {\n    return parseDef(_def.type._def, refs);\n}\n","import { parseDef } from \"../parseDef.js\";\nexport const parseCatchDef = (def, refs) => {\n    return parseDef(def.innerType._def, refs);\n};\n","import { setResponseValueAndErrors } from \"../errorMessages.js\";\nexport function parseDateDef(def, refs, overrideDateStrategy) {\n    const strategy = overrideDateStrategy ?? refs.dateStrategy;\n    if (Array.isArray(strategy)) {\n        return {\n            anyOf: strategy.map((item, i) => parseDateDef(def, refs, item)),\n        };\n    }\n    switch (strategy) {\n        case \"string\":\n        case \"format:date-time\":\n            return {\n                type: \"string\",\n                format: \"date-time\",\n            };\n        case \"format:date\":\n            return {\n                type: \"string\",\n                format: \"date\",\n            };\n        case \"integer\":\n            return integerDateParser(def, refs);\n    }\n}\nconst integerDateParser = (def, refs) => {\n    const res = {\n        type: \"integer\",\n        format: \"unix-time\",\n    };\n    if (refs.target === \"openApi3\") {\n        return res;\n    }\n    for (const check of def.checks) {\n        switch (check.kind) {\n            case \"min\":\n                setResponseValueAndErrors(res, \"minimum\", check.value, // This is in milliseconds\n                check.message, refs);\n                break;\n            case \"max\":\n                setResponseValueAndErrors(res, \"maximum\", check.value, // This is in milliseconds\n                check.message, refs);\n                break;\n        }\n    }\n    return res;\n};\n","import { parseDef } from \"../parseDef.js\";\nexport function parseDefaultDef(_def, refs) {\n    return {\n        ...parseDef(_def.innerType._def, refs),\n        default: _def.defaultValue(),\n    };\n}\n","import { parseDef } from \"../parseDef.js\";\nexport function parseEffectsDef(_def, refs) {\n    return refs.effectStrategy === \"input\"\n        ? parseDef(_def.schema._def, refs)\n        : {};\n}\n","export function parseEnumDef(def) {\n    return {\n        type: \"string\",\n        enum: def.values,\n    };\n}\n","import { parseDef } from \"../parseDef.js\";\nconst isJsonSchema7AllOfType = (type) => {\n    if (\"type\" in type && type.type === \"string\")\n        return false;\n    return \"allOf\" in type;\n};\nexport function parseIntersectionDef(def, refs) {\n    const allOf = [\n        parseDef(def.left._def, {\n            ...refs,\n            currentPath: [...refs.currentPath, \"allOf\", \"0\"],\n        }),\n        parseDef(def.right._def, {\n            ...refs,\n            currentPath: [...refs.currentPath, \"allOf\", \"1\"],\n        }),\n    ].filter((x) => !!x);\n    let unevaluatedProperties = refs.target === \"jsonSchema2019-09\"\n        ? { unevaluatedProperties: false }\n        : undefined;\n    const mergedAllOf = [];\n    // If either of the schemas is an allOf, merge them into a single allOf\n    allOf.forEach((schema) => {\n        if (isJsonSchema7AllOfType(schema)) {\n            mergedAllOf.push(...schema.allOf);\n            if (schema.unevaluatedProperties === undefined) {\n                // If one of the schemas has no unevaluatedProperties set,\n                // the merged schema should also have no unevaluatedProperties set\n                unevaluatedProperties = undefined;\n            }\n        }\n        else {\n            let nestedSchema = schema;\n            if (\"additionalProperties\" in schema &&\n                schema.additionalProperties === false) {\n                const { additionalProperties, ...rest } = schema;\n                nestedSchema = rest;\n            }\n            else {\n                // As soon as one of the schemas has additionalProperties set not to false, we allow unevaluatedProperties\n                unevaluatedProperties = undefined;\n            }\n            mergedAllOf.push(nestedSchema);\n        }\n    });\n    return mergedAllOf.length\n        ? {\n            allOf: mergedAllOf,\n            ...unevaluatedProperties,\n        }\n        : undefined;\n}\n","export function parseLiteralDef(def, refs) {\n    const parsedType = typeof def.value;\n    if (parsedType !== \"bigint\" &&\n        parsedType !== \"number\" &&\n        parsedType !== \"boolean\" &&\n        parsedType !== \"string\") {\n        return {\n            type: Array.isArray(def.value) ? \"array\" : \"object\",\n        };\n    }\n    if (refs.target === \"openApi3\") {\n        return {\n            type: parsedType === \"bigint\" ? \"integer\" : parsedType,\n            enum: [def.value],\n        };\n    }\n    return {\n        type: parsedType === \"bigint\" ? \"integer\" : parsedType,\n        const: def.value,\n    };\n}\n","import { setResponseValueAndErrors } from \"../errorMessages.js\";\nlet emojiRegex;\n/**\n * Generated from the regular expressions found here as of 2024-05-22:\n * https://github.com/colinhacks/zod/blob/master/src/types.ts.\n *\n * Expressions with /i flag have been changed accordingly.\n */\nexport const zodPatterns = {\n    /**\n     * `c` was changed to `[cC]` to replicate /i flag\n     */\n    cuid: /^[cC][^\\s-]{8,}$/,\n    cuid2: /^[0-9a-z]+$/,\n    ulid: /^[0-9A-HJKMNP-TV-Z]{26}$/,\n    /**\n     * `a-z` was added to replicate /i flag\n     */\n    email: /^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_'+\\-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$/,\n    /**\n     * Constructed a valid Unicode RegExp\n     *\n     * Lazily instantiate since this type of regex isn't supported\n     * in all envs (e.g. React Native).\n     *\n     * See:\n     * https://github.com/colinhacks/zod/issues/2433\n     * Fix in Zod:\n     * https://github.com/colinhacks/zod/commit/9340fd51e48576a75adc919bff65dbc4a5d4c99b\n     */\n    emoji: () => {\n        if (emojiRegex === undefined) {\n            emojiRegex = RegExp(\"^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$\", \"u\");\n        }\n        return emojiRegex;\n    },\n    /**\n     * Unused\n     */\n    uuid: /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/,\n    /**\n     * Unused\n     */\n    ipv4: /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,\n    /**\n     * Unused\n     */\n    ipv6: /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,\n    base64: /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,\n    nanoid: /^[a-zA-Z0-9_-]{21}$/,\n};\nexport function parseStringDef(def, refs) {\n    const res = {\n        type: \"string\",\n    };\n    function processPattern(value) {\n        return refs.patternStrategy === \"escape\"\n            ? escapeNonAlphaNumeric(value)\n            : value;\n    }\n    if (def.checks) {\n        for (const check of def.checks) {\n            switch (check.kind) {\n                case \"min\":\n                    setResponseValueAndErrors(res, \"minLength\", typeof res.minLength === \"number\"\n                        ? Math.max(res.minLength, check.value)\n                        : check.value, check.message, refs);\n                    break;\n                case \"max\":\n                    setResponseValueAndErrors(res, \"maxLength\", typeof res.maxLength === \"number\"\n                        ? Math.min(res.maxLength, check.value)\n                        : check.value, check.message, refs);\n                    break;\n                case \"email\":\n                    switch (refs.emailStrategy) {\n                        case \"format:email\":\n                            addFormat(res, \"email\", check.message, refs);\n                            break;\n                        case \"format:idn-email\":\n                            addFormat(res, \"idn-email\", check.message, refs);\n                            break;\n                        case \"pattern:zod\":\n                            addPattern(res, zodPatterns.email, check.message, refs);\n                            break;\n                    }\n                    break;\n                case \"url\":\n                    addFormat(res, \"uri\", check.message, refs);\n                    break;\n                case \"uuid\":\n                    addFormat(res, \"uuid\", check.message, refs);\n                    break;\n                case \"regex\":\n                    addPattern(res, check.regex, check.message, refs);\n                    break;\n                case \"cuid\":\n                    addPattern(res, zodPatterns.cuid, check.message, refs);\n                    break;\n                case \"cuid2\":\n                    addPattern(res, zodPatterns.cuid2, check.message, refs);\n                    break;\n                case \"startsWith\":\n                    addPattern(res, RegExp(`^${processPattern(check.value)}`), check.message, refs);\n                    break;\n                case \"endsWith\":\n                    addPattern(res, RegExp(`${processPattern(check.value)}$`), check.message, refs);\n                    break;\n                case \"datetime\":\n                    addFormat(res, \"date-time\", check.message, refs);\n                    break;\n                case \"date\":\n                    addFormat(res, \"date\", check.message, refs);\n                    break;\n                case \"time\":\n                    addFormat(res, \"time\", check.message, refs);\n                    break;\n                case \"duration\":\n                    addFormat(res, \"duration\", check.message, refs);\n                    break;\n                case \"length\":\n                    setResponseValueAndErrors(res, \"minLength\", typeof res.minLength === \"number\"\n                        ? Math.max(res.minLength, check.value)\n                        : check.value, check.message, refs);\n                    setResponseValueAndErrors(res, \"maxLength\", typeof res.maxLength === \"number\"\n                        ? Math.min(res.maxLength, check.value)\n                        : check.value, check.message, refs);\n                    break;\n                case \"includes\": {\n                    addPattern(res, RegExp(processPattern(check.value)), check.message, refs);\n                    break;\n                }\n                case \"ip\": {\n                    if (check.version !== \"v6\") {\n                        addFormat(res, \"ipv4\", check.message, refs);\n                    }\n                    if (check.version !== \"v4\") {\n                        addFormat(res, \"ipv6\", check.message, refs);\n                    }\n                    break;\n                }\n                case \"emoji\":\n                    addPattern(res, zodPatterns.emoji, check.message, refs);\n                    break;\n                case \"ulid\": {\n                    addPattern(res, zodPatterns.ulid, check.message, refs);\n                    break;\n                }\n                case \"base64\": {\n                    switch (refs.base64Strategy) {\n                        case \"format:binary\": {\n                            addFormat(res, \"binary\", check.message, refs);\n                            break;\n                        }\n                        case \"contentEncoding:base64\": {\n                            setResponseValueAndErrors(res, \"contentEncoding\", \"base64\", check.message, refs);\n                            break;\n                        }\n                        case \"pattern:zod\": {\n                            addPattern(res, zodPatterns.base64, check.message, refs);\n                            break;\n                        }\n                    }\n                    break;\n                }\n                case \"nanoid\": {\n                    addPattern(res, zodPatterns.nanoid, check.message, refs);\n                }\n                case \"toLowerCase\":\n                case \"toUpperCase\":\n                case \"trim\":\n                    break;\n                default:\n                    /* c8 ignore next */\n                    ((_) => { })(check);\n            }\n        }\n    }\n    return res;\n}\nconst escapeNonAlphaNumeric = (value) => Array.from(value)\n    .map((c) => (/[a-zA-Z0-9]/.test(c) ? c : `\\\\${c}`))\n    .join(\"\");\nconst addFormat = (schema, value, message, refs) => {\n    if (schema.format || schema.anyOf?.some((x) => x.format)) {\n        if (!schema.anyOf) {\n            schema.anyOf = [];\n        }\n        if (schema.format) {\n            schema.anyOf.push({\n                format: schema.format,\n                ...(schema.errorMessage &&\n                    refs.errorMessages && {\n                    errorMessage: { format: schema.errorMessage.format },\n                }),\n            });\n            delete schema.format;\n            if (schema.errorMessage) {\n                delete schema.errorMessage.format;\n                if (Object.keys(schema.errorMessage).length === 0) {\n                    delete schema.errorMessage;\n                }\n            }\n        }\n        schema.anyOf.push({\n            format: value,\n            ...(message &&\n                refs.errorMessages && { errorMessage: { format: message } }),\n        });\n    }\n    else {\n        setResponseValueAndErrors(schema, \"format\", value, message, refs);\n    }\n};\nconst addPattern = (schema, regex, message, refs) => {\n    if (schema.pattern || schema.allOf?.some((x) => x.pattern)) {\n        if (!schema.allOf) {\n            schema.allOf = [];\n        }\n        if (schema.pattern) {\n            schema.allOf.push({\n                pattern: schema.pattern,\n                ...(schema.errorMessage &&\n                    refs.errorMessages && {\n                    errorMessage: { pattern: schema.errorMessage.pattern },\n                }),\n            });\n            delete schema.pattern;\n            if (schema.errorMessage) {\n                delete schema.errorMessage.pattern;\n                if (Object.keys(schema.errorMessage).length === 0) {\n                    delete schema.errorMessage;\n                }\n            }\n        }\n        schema.allOf.push({\n            pattern: processRegExp(regex, refs),\n            ...(message &&\n                refs.errorMessages && { errorMessage: { pattern: message } }),\n        });\n    }\n    else {\n        setResponseValueAndErrors(schema, \"pattern\", processRegExp(regex, refs), message, refs);\n    }\n};\n// Mutate z.string.regex() in a best attempt to accommodate for regex flags when applyRegexFlags is true\nconst processRegExp = (regexOrFunction, refs) => {\n    const regex = typeof regexOrFunction === \"function\" ? regexOrFunction() : regexOrFunction;\n    if (!refs.applyRegexFlags || !regex.flags)\n        return regex.source;\n    // Currently handled flags\n    const flags = {\n        i: regex.flags.includes(\"i\"),\n        m: regex.flags.includes(\"m\"),\n        s: regex.flags.includes(\"s\"), // `.` matches newlines\n    };\n    // The general principle here is to step through each character, one at a time, applying mutations as flags require. We keep track when the current character is escaped, and when it's inside a group /like [this]/ or (also) a range like /[a-z]/. The following is fairly brittle imperative code; edit at your peril!\n    const source = flags.i ? regex.source.toLowerCase() : regex.source;\n    let pattern = \"\";\n    let isEscaped = false;\n    let inCharGroup = false;\n    let inCharRange = false;\n    for (let i = 0; i < source.length; i++) {\n        if (isEscaped) {\n            pattern += source[i];\n            isEscaped = false;\n            continue;\n        }\n        if (flags.i) {\n            if (inCharGroup) {\n                if (source[i].match(/[a-z]/)) {\n                    if (inCharRange) {\n                        pattern += source[i];\n                        pattern += `${source[i - 2]}-${source[i]}`.toUpperCase();\n                        inCharRange = false;\n                    }\n                    else if (source[i + 1] === \"-\" && source[i + 2]?.match(/[a-z]/)) {\n                        pattern += source[i];\n                        inCharRange = true;\n                    }\n                    else {\n                        pattern += `${source[i]}${source[i].toUpperCase()}`;\n                    }\n                    continue;\n                }\n            }\n            else if (source[i].match(/[a-z]/)) {\n                pattern += `[${source[i]}${source[i].toUpperCase()}]`;\n                continue;\n            }\n        }\n        if (flags.m) {\n            if (source[i] === \"^\") {\n                pattern += `(^|(?<=[\\r\\n]))`;\n                continue;\n            }\n            else if (source[i] === \"$\") {\n                pattern += `($|(?=[\\r\\n]))`;\n                continue;\n            }\n        }\n        if (flags.s && source[i] === \".\") {\n            pattern += inCharGroup ? `${source[i]}\\r\\n` : `[${source[i]}\\r\\n]`;\n            continue;\n        }\n        pattern += source[i];\n        if (source[i] === \"\\\\\") {\n            isEscaped = true;\n        }\n        else if (inCharGroup && source[i] === \"]\") {\n            inCharGroup = false;\n        }\n        else if (!inCharGroup && source[i] === \"[\") {\n            inCharGroup = true;\n        }\n    }\n    try {\n        const regexTest = new RegExp(pattern);\n    }\n    catch {\n        console.warn(`Could not convert regex pattern at ${refs.currentPath.join(\"/\")} to a flag-independent form! Falling back to the flag-ignorant source`);\n        return regex.source;\n    }\n    return pattern;\n};\n","import { ZodFirstPartyTypeKind, } from \"zod\";\nimport { parseDef } from \"../parseDef.js\";\nimport { parseStringDef } from \"./string.js\";\nimport { parseBrandedDef } from \"./branded.js\";\nexport function parseRecordDef(def, refs) {\n    if (refs.target === \"openApi3\" &&\n        def.keyType?._def.typeName === ZodFirstPartyTypeKind.ZodEnum) {\n        return {\n            type: \"object\",\n            required: def.keyType._def.values,\n            properties: def.keyType._def.values.reduce((acc, key) => ({\n                ...acc,\n                [key]: parseDef(def.valueType._def, {\n                    ...refs,\n                    currentPath: [...refs.currentPath, \"properties\", key],\n                }) ?? {},\n            }), {}),\n            additionalProperties: false,\n        };\n    }\n    const schema = {\n        type: \"object\",\n        additionalProperties: parseDef(def.valueType._def, {\n            ...refs,\n            currentPath: [...refs.currentPath, \"additionalProperties\"],\n        }) ?? {},\n    };\n    if (refs.target === \"openApi3\") {\n        return schema;\n    }\n    if (def.keyType?._def.typeName === ZodFirstPartyTypeKind.ZodString &&\n        def.keyType._def.checks?.length) {\n        const { type, ...keyType } = parseStringDef(def.keyType._def, refs);\n        return {\n            ...schema,\n            propertyNames: keyType,\n        };\n    }\n    else if (def.keyType?._def.typeName === ZodFirstPartyTypeKind.ZodEnum) {\n        return {\n            ...schema,\n            propertyNames: {\n                enum: def.keyType._def.values,\n            },\n        };\n    }\n    else if (def.keyType?._def.typeName === ZodFirstPartyTypeKind.ZodBranded &&\n        def.keyType._def.type._def.typeName === ZodFirstPartyTypeKind.ZodString &&\n        def.keyType._def.type._def.checks?.length) {\n        const { type, ...keyType } = parseBrandedDef(def.keyType._def, refs);\n        return {\n            ...schema,\n            propertyNames: keyType,\n        };\n    }\n    return schema;\n}\n","import { parseDef } from \"../parseDef.js\";\nimport { parseRecordDef } from \"./record.js\";\nexport function parseMapDef(def, refs) {\n    if (refs.mapStrategy === \"record\") {\n        return parseRecordDef(def, refs);\n    }\n    const keys = parseDef(def.keyType._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"items\", \"items\", \"0\"],\n    }) || {};\n    const values = parseDef(def.valueType._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"items\", \"items\", \"1\"],\n    }) || {};\n    return {\n        type: \"array\",\n        maxItems: 125,\n        items: {\n            type: \"array\",\n            items: [keys, values],\n            minItems: 2,\n            maxItems: 2,\n        },\n    };\n}\n","export function parseNativeEnumDef(def) {\n    const object = def.values;\n    const actualKeys = Object.keys(def.values).filter((key) => {\n        return typeof object[object[key]] !== \"number\";\n    });\n    const actualValues = actualKeys.map((key) => object[key]);\n    const parsedTypes = Array.from(new Set(actualValues.map((values) => typeof values)));\n    return {\n        type: parsedTypes.length === 1\n            ? parsedTypes[0] === \"string\"\n                ? \"string\"\n                : \"number\"\n            : [\"string\", \"number\"],\n        enum: actualValues,\n    };\n}\n","export function parseNeverDef() {\n    return {\n        not: {},\n    };\n}\n","export function parseNullDef(refs) {\n    return refs.target === \"openApi3\"\n        ? {\n            enum: [\"null\"],\n            nullable: true,\n        }\n        : {\n            type: \"null\",\n        };\n}\n","import { parseDef } from \"../parseDef.js\";\nexport const primitiveMappings = {\n    ZodString: \"string\",\n    ZodNumber: \"number\",\n    ZodBigInt: \"integer\",\n    ZodBoolean: \"boolean\",\n    ZodNull: \"null\",\n};\nexport function parseUnionDef(def, refs) {\n    if (refs.target === \"openApi3\")\n        return asAnyOf(def, refs);\n    const options = def.options instanceof Map ? Array.from(def.options.values()) : def.options;\n    // This blocks tries to look ahead a bit to produce nicer looking schemas with type array instead of anyOf.\n    if (options.every((x) => x._def.typeName in primitiveMappings &&\n        (!x._def.checks || !x._def.checks.length))) {\n        // all types in union are primitive and lack checks, so might as well squash into {type: [...]}\n        const types = options.reduce((types, x) => {\n            const type = primitiveMappings[x._def.typeName]; //Can be safely casted due to row 43\n            return type && !types.includes(type) ? [...types, type] : types;\n        }, []);\n        return {\n            type: types.length > 1 ? types : types[0],\n        };\n    }\n    else if (options.every((x) => x._def.typeName === \"ZodLiteral\" && !x.description)) {\n        // all options literals\n        const types = options.reduce((acc, x) => {\n            const type = typeof x._def.value;\n            switch (type) {\n                case \"string\":\n                case \"number\":\n                case \"boolean\":\n                    return [...acc, type];\n                case \"bigint\":\n                    return [...acc, \"integer\"];\n                case \"object\":\n                    if (x._def.value === null)\n                        return [...acc, \"null\"];\n                case \"symbol\":\n                case \"undefined\":\n                case \"function\":\n                default:\n                    return acc;\n            }\n        }, []);\n        if (types.length === options.length) {\n            // all the literals are primitive, as far as null can be considered primitive\n            const uniqueTypes = types.filter((x, i, a) => a.indexOf(x) === i);\n            return {\n                type: uniqueTypes.length > 1 ? uniqueTypes : uniqueTypes[0],\n                enum: options.reduce((acc, x) => {\n                    return acc.includes(x._def.value) ? acc : [...acc, x._def.value];\n                }, []),\n            };\n        }\n    }\n    else if (options.every((x) => x._def.typeName === \"ZodEnum\")) {\n        return {\n            type: \"string\",\n            enum: options.reduce((acc, x) => [\n                ...acc,\n                ...x._def.values.filter((x) => !acc.includes(x)),\n            ], []),\n        };\n    }\n    return asAnyOf(def, refs);\n}\nconst asAnyOf = (def, refs) => {\n    const anyOf = (def.options instanceof Map\n        ? Array.from(def.options.values())\n        : def.options)\n        .map((x, i) => parseDef(x._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"anyOf\", `${i}`],\n    }))\n        .filter((x) => !!x &&\n        (!refs.strictUnions ||\n            (typeof x === \"object\" && Object.keys(x).length > 0)));\n    return anyOf.length ? { anyOf } : undefined;\n};\n","import { parseDef } from \"../parseDef.js\";\nimport { primitiveMappings } from \"./union.js\";\nexport function parseNullableDef(def, refs) {\n    if ([\"ZodString\", \"ZodNumber\", \"ZodBigInt\", \"ZodBoolean\", \"ZodNull\"].includes(def.innerType._def.typeName) &&\n        (!def.innerType._def.checks || !def.innerType._def.checks.length)) {\n        if (refs.target === \"openApi3\") {\n            return {\n                type: primitiveMappings[def.innerType._def.typeName],\n                nullable: true,\n            };\n        }\n        return {\n            type: [\n                primitiveMappings[def.innerType._def.typeName],\n                \"null\",\n            ],\n        };\n    }\n    if (refs.target === \"openApi3\") {\n        const base = parseDef(def.innerType._def, {\n            ...refs,\n            currentPath: [...refs.currentPath],\n        });\n        if (base && '$ref' in base)\n            return { allOf: [base], nullable: true };\n        return base && { ...base, nullable: true };\n    }\n    const base = parseDef(def.innerType._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"anyOf\", \"0\"],\n    });\n    return base && { anyOf: [base, { type: \"null\" }] };\n}\n","import { addErrorMessage, setResponseValueAndErrors, } from \"../errorMessages.js\";\nexport function parseNumberDef(def, refs) {\n    const res = {\n        type: \"number\",\n    };\n    if (!def.checks)\n        return res;\n    for (const check of def.checks) {\n        switch (check.kind) {\n            case \"int\":\n                res.type = \"integer\";\n                addErrorMessage(res, \"type\", check.message, refs);\n                break;\n            case \"min\":\n                if (refs.target === \"jsonSchema7\") {\n                    if (check.inclusive) {\n                        setResponseValueAndErrors(res, \"minimum\", check.value, check.message, refs);\n                    }\n                    else {\n                        setResponseValueAndErrors(res, \"exclusiveMinimum\", check.value, check.message, refs);\n                    }\n                }\n                else {\n                    if (!check.inclusive) {\n                        res.exclusiveMinimum = true;\n                    }\n                    setResponseValueAndErrors(res, \"minimum\", check.value, check.message, refs);\n                }\n                break;\n            case \"max\":\n                if (refs.target === \"jsonSchema7\") {\n                    if (check.inclusive) {\n                        setResponseValueAndErrors(res, \"maximum\", check.value, check.message, refs);\n                    }\n                    else {\n                        setResponseValueAndErrors(res, \"exclusiveMaximum\", check.value, check.message, refs);\n                    }\n                }\n                else {\n                    if (!check.inclusive) {\n                        res.exclusiveMaximum = true;\n                    }\n                    setResponseValueAndErrors(res, \"maximum\", check.value, check.message, refs);\n                }\n                break;\n            case \"multipleOf\":\n                setResponseValueAndErrors(res, \"multipleOf\", check.value, check.message, refs);\n                break;\n        }\n    }\n    return res;\n}\n","import { parseDef } from \"../parseDef.js\";\nfunction decideAdditionalProperties(def, refs) {\n    if (refs.removeAdditionalStrategy === \"strict\") {\n        return def.catchall._def.typeName === \"ZodNever\"\n            ? def.unknownKeys !== \"strict\"\n            : parseDef(def.catchall._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"additionalProperties\"],\n            }) ?? true;\n    }\n    else {\n        return def.catchall._def.typeName === \"ZodNever\"\n            ? def.unknownKeys === \"passthrough\"\n            : parseDef(def.catchall._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"additionalProperties\"],\n            }) ?? true;\n    }\n}\nexport function parseObjectDef(def, refs) {\n    const result = {\n        type: \"object\",\n        ...Object.entries(def.shape()).reduce((acc, [propName, propDef]) => {\n            if (propDef === undefined || propDef._def === undefined)\n                return acc;\n            const parsedDef = parseDef(propDef._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"properties\", propName],\n                propertyPath: [...refs.currentPath, \"properties\", propName],\n            });\n            if (parsedDef === undefined)\n                return acc;\n            return {\n                properties: { ...acc.properties, [propName]: parsedDef },\n                required: propDef.isOptional()\n                    ? acc.required\n                    : [...acc.required, propName],\n            };\n        }, { properties: {}, required: [] }),\n        additionalProperties: decideAdditionalProperties(def, refs),\n    };\n    if (!result.required.length)\n        delete result.required;\n    return result;\n}\n","import { parseDef } from \"../parseDef.js\";\nexport const parseOptionalDef = (def, refs) => {\n    if (refs.currentPath.toString() === refs.propertyPath?.toString()) {\n        return parseDef(def.innerType._def, refs);\n    }\n    const innerSchema = parseDef(def.innerType._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"anyOf\", \"1\"],\n    });\n    return innerSchema\n        ? {\n            anyOf: [\n                {\n                    not: {},\n                },\n                innerSchema,\n            ],\n        }\n        : {};\n};\n","import { parseDef } from \"../parseDef.js\";\nexport const parsePipelineDef = (def, refs) => {\n    if (refs.pipeStrategy === \"input\") {\n        return parseDef(def.in._def, refs);\n    }\n    else if (refs.pipeStrategy === \"output\") {\n        return parseDef(def.out._def, refs);\n    }\n    const a = parseDef(def.in._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"allOf\", \"0\"],\n    });\n    const b = parseDef(def.out._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"allOf\", a ? \"1\" : \"0\"],\n    });\n    return {\n        allOf: [a, b].filter((x) => x !== undefined),\n    };\n};\n","import { parseDef } from \"../parseDef.js\";\nexport function parsePromiseDef(def, refs) {\n    return parseDef(def.type._def, refs);\n}\n","import { setResponseValueAndErrors } from \"../errorMessages.js\";\nimport { parseDef } from \"../parseDef.js\";\nexport function parseSetDef(def, refs) {\n    const items = parseDef(def.valueType._def, {\n        ...refs,\n        currentPath: [...refs.currentPath, \"items\"],\n    });\n    const schema = {\n        type: \"array\",\n        uniqueItems: true,\n        items,\n    };\n    if (def.minSize) {\n        setResponseValueAndErrors(schema, \"minItems\", def.minSize.value, def.minSize.message, refs);\n    }\n    if (def.maxSize) {\n        setResponseValueAndErrors(schema, \"maxItems\", def.maxSize.value, def.maxSize.message, refs);\n    }\n    return schema;\n}\n","import { parseDef } from \"../parseDef.js\";\nexport function parseTupleDef(def, refs) {\n    if (def.rest) {\n        return {\n            type: \"array\",\n            minItems: def.items.length,\n            items: def.items\n                .map((x, i) => parseDef(x._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"items\", `${i}`],\n            }))\n                .reduce((acc, x) => (x === undefined ? acc : [...acc, x]), []),\n            additionalItems: parseDef(def.rest._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"additionalItems\"],\n            }),\n        };\n    }\n    else {\n        return {\n            type: \"array\",\n            minItems: def.items.length,\n            maxItems: def.items.length,\n            items: def.items\n                .map((x, i) => parseDef(x._def, {\n                ...refs,\n                currentPath: [...refs.currentPath, \"items\", `${i}`],\n            }))\n                .reduce((acc, x) => (x === undefined ? acc : [...acc, x]), []),\n        };\n    }\n}\n","export function parseUndefinedDef() {\n    return {\n        not: {},\n    };\n}\n","export function parseUnknownDef() {\n    return {};\n}\n","import { parseDef } from \"../parseDef.js\";\nexport const parseReadonlyDef = (def, refs) => {\n    return parseDef(def.innerType._def, refs);\n};\n","import { ZodFirstPartyTypeKind } from \"zod\";\nimport { parseAnyDef } from \"./parsers/any.js\";\nimport { parseArrayDef } from \"./parsers/array.js\";\nimport { parseBigintDef } from \"./parsers/bigint.js\";\nimport { parseBooleanDef } from \"./parsers/boolean.js\";\nimport { parseBrandedDef } from \"./parsers/branded.js\";\nimport { parseCatchDef } from \"./parsers/catch.js\";\nimport { parseDateDef } from \"./parsers/date.js\";\nimport { parseDefaultDef } from \"./parsers/default.js\";\nimport { parseEffectsDef } from \"./parsers/effects.js\";\nimport { parseEnumDef } from \"./parsers/enum.js\";\nimport { parseIntersectionDef, } from \"./parsers/intersection.js\";\nimport { parseLiteralDef } from \"./parsers/literal.js\";\nimport { parseMapDef } from \"./parsers/map.js\";\nimport { parseNativeEnumDef, } from \"./parsers/nativeEnum.js\";\nimport { parseNeverDef } from \"./parsers/never.js\";\nimport { parseNullDef } from \"./parsers/null.js\";\nimport { parseNullableDef, } from \"./parsers/nullable.js\";\nimport { parseNumberDef } from \"./parsers/number.js\";\nimport { parseObjectDef } from \"./parsers/object.js\";\nimport { parseOptionalDef } from \"./parsers/optional.js\";\nimport { parsePipelineDef } from \"./parsers/pipeline.js\";\nimport { parsePromiseDef } from \"./parsers/promise.js\";\nimport { parseRecordDef } from \"./parsers/record.js\";\nimport { parseSetDef } from \"./parsers/set.js\";\nimport { parseStringDef } from \"./parsers/string.js\";\nimport { parseTupleDef } from \"./parsers/tuple.js\";\nimport { parseUndefinedDef, } from \"./parsers/undefined.js\";\nimport { parseUnionDef } from \"./parsers/union.js\";\nimport { parseUnknownDef } from \"./parsers/unknown.js\";\nimport { parseReadonlyDef } from \"./parsers/readonly.js\";\nimport { ignoreOverride } from \"./Options.js\";\nexport function parseDef(def, refs, forceResolution = false) {\n    const seenItem = refs.seen.get(def);\n    if (refs.override) {\n        const overrideResult = refs.override?.(def, refs, seenItem, forceResolution);\n        if (overrideResult !== ignoreOverride) {\n            return overrideResult;\n        }\n    }\n    if (seenItem && !forceResolution) {\n        const seenSchema = get$ref(seenItem, refs);\n        if (seenSchema !== undefined) {\n            return seenSchema;\n        }\n    }\n    const newItem = { def, path: refs.currentPath, jsonSchema: undefined };\n    refs.seen.set(def, newItem);\n    const jsonSchema = selectParser(def, def.typeName, refs);\n    if (jsonSchema) {\n        addMeta(def, refs, jsonSchema);\n    }\n    newItem.jsonSchema = jsonSchema;\n    return jsonSchema;\n}\nconst get$ref = (item, refs) => {\n    switch (refs.$refStrategy) {\n        case \"root\":\n            return { $ref: item.path.join(\"/\") };\n        case \"relative\":\n            return { $ref: getRelativePath(refs.currentPath, item.path) };\n        case \"none\":\n        case \"seen\": {\n            if (item.path.length < refs.currentPath.length &&\n                item.path.every((value, index) => refs.currentPath[index] === value)) {\n                console.warn(`Recursive reference detected at ${refs.currentPath.join(\"/\")}! Defaulting to any`);\n                return {};\n            }\n            return refs.$refStrategy === \"seen\" ? {} : undefined;\n        }\n    }\n};\nconst getRelativePath = (pathA, pathB) => {\n    let i = 0;\n    for (; i < pathA.length && i < pathB.length; i++) {\n        if (pathA[i] !== pathB[i])\n            break;\n    }\n    return [(pathA.length - i).toString(), ...pathB.slice(i)].join(\"/\");\n};\nconst selectParser = (def, typeName, refs) => {\n    switch (typeName) {\n        case ZodFirstPartyTypeKind.ZodString:\n            return parseStringDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodNumber:\n            return parseNumberDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodObject:\n            return parseObjectDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodBigInt:\n            return parseBigintDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodBoolean:\n            return parseBooleanDef();\n        case ZodFirstPartyTypeKind.ZodDate:\n            return parseDateDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodUndefined:\n            return parseUndefinedDef();\n        case ZodFirstPartyTypeKind.ZodNull:\n            return parseNullDef(refs);\n        case ZodFirstPartyTypeKind.ZodArray:\n            return parseArrayDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodUnion:\n        case ZodFirstPartyTypeKind.ZodDiscriminatedUnion:\n            return parseUnionDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodIntersection:\n            return parseIntersectionDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodTuple:\n            return parseTupleDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodRecord:\n            return parseRecordDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodLiteral:\n            return parseLiteralDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodEnum:\n            return parseEnumDef(def);\n        case ZodFirstPartyTypeKind.ZodNativeEnum:\n            return parseNativeEnumDef(def);\n        case ZodFirstPartyTypeKind.ZodNullable:\n            return parseNullableDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodOptional:\n            return parseOptionalDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodMap:\n            return parseMapDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodSet:\n            return parseSetDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodLazy:\n            return parseDef(def.getter()._def, refs);\n        case ZodFirstPartyTypeKind.ZodPromise:\n            return parsePromiseDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodNaN:\n        case ZodFirstPartyTypeKind.ZodNever:\n            return parseNeverDef();\n        case ZodFirstPartyTypeKind.ZodEffects:\n            return parseEffectsDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodAny:\n            return parseAnyDef();\n        case ZodFirstPartyTypeKind.ZodUnknown:\n            return parseUnknownDef();\n        case ZodFirstPartyTypeKind.ZodDefault:\n            return parseDefaultDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodBranded:\n            return parseBrandedDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodReadonly:\n            return parseReadonlyDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodCatch:\n            return parseCatchDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodPipeline:\n            return parsePipelineDef(def, refs);\n        case ZodFirstPartyTypeKind.ZodFunction:\n        case ZodFirstPartyTypeKind.ZodVoid:\n        case ZodFirstPartyTypeKind.ZodSymbol:\n            return undefined;\n        default:\n            /* c8 ignore next */\n            return ((_) => undefined)(typeName);\n    }\n};\nconst addMeta = (def, refs, jsonSchema) => {\n    if (def.description) {\n        jsonSchema.description = def.description;\n        if (refs.markdownDescription) {\n            jsonSchema.markdownDescription = def.description;\n        }\n    }\n    return jsonSchema;\n};\n","import { parseDef } from \"./parseDef.js\";\nimport { getRefs } from \"./Refs.js\";\nconst zodToJsonSchema = (schema, options) => {\n    const refs = getRefs(options);\n    const definitions = typeof options === \"object\" && options.definitions\n        ? Object.entries(options.definitions).reduce((acc, [name, schema]) => ({\n            ...acc,\n            [name]: parseDef(schema._def, {\n                ...refs,\n                currentPath: [...refs.basePath, refs.definitionPath, name],\n            }, true) ?? {},\n        }), {})\n        : undefined;\n    const name = typeof options === \"string\"\n        ? options\n        : options?.nameStrategy === \"title\"\n            ? undefined\n            : options?.name;\n    const main = parseDef(schema._def, name === undefined\n        ? refs\n        : {\n            ...refs,\n            currentPath: [...refs.basePath, refs.definitionPath, name],\n        }, false) ?? {};\n    const title = typeof options === \"object\" &&\n        options.name !== undefined &&\n        options.nameStrategy === \"title\"\n        ? options.name\n        : undefined;\n    if (title !== undefined) {\n        main.title = title;\n    }\n    const combined = name === undefined\n        ? definitions\n            ? {\n                ...main,\n                [refs.definitionPath]: definitions,\n            }\n            : main\n        : {\n            $ref: [\n                ...(refs.$refStrategy === \"relative\" ? [] : refs.basePath),\n                refs.definitionPath,\n                name,\n            ].join(\"/\"),\n            [refs.definitionPath]: {\n                ...definitions,\n                [name]: main,\n            },\n        };\n    if (refs.target === \"jsonSchema7\") {\n        combined.$schema = \"http://json-schema.org/draft-07/schema#\";\n    }\n    else if (refs.target === \"jsonSchema2019-09\") {\n        combined.$schema = \"https://json-schema.org/draft/2019-09/schema#\";\n    }\n    return combined;\n};\nexport { zodToJsonSchema };\n","import { memo, useEffect, useMemo, useRef, useState } from 'react'\nimport { Position, useInternalNode } from '@xyflow/react'\nimport { useTranslation } from 'react-i18next'\nimport { useFlowState } from 'src/states/flow'\nimport { NodeHeader } from 'src/components/flows/NodeHeader'\nimport { DefaultHandle } from 'src/components/flows/DefaultHandle'\n\nimport { McpNodeProps } from './type'\nimport { useConnectionToHandler } from './hooks/use-connection-to-handler'\nimport { Alert, AlertDescription, AlertTitle } from 'src/lib/shadcn/ui/alert'\nimport LazyIcon from 'src/components/atoms/LazyIcon'\nimport { Label } from 'src/lib/shadcn/ui/label'\nimport { getMCPClientTools } from 'src/services/mcp'\nimport zodToJsonSchema from 'zod-to-json-schema'\nimport { ZodObject, ZodRawShape } from 'zod'\nimport { Separator } from 'src/lib/shadcn/ui/separator'\nimport { Button } from 'src/lib/shadcn/ui/button'\n\nexport const McpNode = memo((props: McpNodeProps) => {\n  const { t } = useTranslation('flows')\n  const { id, data, isConnectable } = props\n  const [viewAll, setViewAll] = useState(false)\n  const loadingRef = useRef(false)\n  const node = useInternalNode(id)\n  const updateNodes = useFlowState((state) => state.updateNodes)\n\n  useConnectionToHandler(id)\n\n  useEffect(() => {\n    const mcp = data?.entity\n    if (!mcp || !node || loadingRef.current || data.loaded) return\n\n    loadingRef.current = true\n    getMCPClientTools([mcp], {\n      globalThrowOnLoadError: true,\n    })\n      .then((tools) => {\n        loadingRef.current = false\n\n        updateNodes([\n          {\n            id: node.id,\n            type: 'replace',\n            item: {\n              ...node,\n              data: {\n                ...(node?.data || {}),\n                loaded: true,\n                tools: tools.map((tool) => ({\n                  name: `${tool.name}`,\n                  description: tool.description || '',\n                  schema: zodToJsonSchema(tool.schema as ZodObject<ZodRawShape>),\n                })),\n              },\n            },\n          },\n        ])\n      })\n      .catch((error) => {\n        loadingRef.current = false\n        updateNodes([\n          {\n            id: node.id,\n            type: 'replace',\n            item: { ...node, data: { ...data, loaded: true, error: error.message } },\n          },\n        ])\n      })\n  }, [data.loaded, data?.entity, node, t, updateNodes, data])\n\n  const toolList = useMemo(() => {\n    if (!data?.tools || !data.loaded) {\n      return {\n        tools: [],\n        total: 0,\n      }\n    }\n\n    if (viewAll) {\n      return {\n        tools: data.tools,\n        total: data.tools.length,\n      }\n    }\n    return {\n      tools: data.tools.slice(0, 5),\n      total: data.tools.length,\n    }\n  }, [data?.tools, data.loaded, viewAll])\n\n  return (\n    <div>\n      <div>\n        <NodeHeader id={id} />\n        <Alert className=\"flex justify-center max-w-md\" variant=\"default\">\n          <LazyIcon size={24} name={'tool-case'} />\n          <div className=\"ml-2 max-w-full break-words break-all\">\n            <AlertTitle>{`${data.entity?.key || ''}`}</AlertTitle>\n            <AlertDescription>\n              <Label>{`${data.entity?.url || ''}`}</Label>\n              <Separator className=\"my-2\" />\n              {data.error ? <Label className=\"text-red-500\">{data.error}</Label> : undefined}\n              {toolList?.tools?.length ? (\n                <div>\n                  <ul className=\"list-disc pl-5\">\n                    {toolList.tools.map((tool, index) => (\n                      <li key={index}>\n                        <Label>\n                          {tool.name}: {tool.description}\n                        </Label>\n                      </li>\n                    ))}\n                  </ul>\n                  {toolList.total > toolList?.tools?.length ? (\n                    <Button\n                      onClick={() => setViewAll(true)}\n                      className=\"align-self-center mt-2\"\n                      variant=\"ghost\"\n                    >\n                      <LazyIcon name=\"chevron-down\" className=\"mt-1\" />\n                      {t('mcp_node.view_all', { count: toolList.total })}\n                    </Button>\n                  ) : toolList.total > 5 ? (\n                    <Button\n                      onClick={() => setViewAll(false)}\n                      className=\"align-self-center mt-2\"\n                      variant=\"ghost\"\n                    >\n                      <LazyIcon name=\"chevron-up\" className=\"mt-1\" />\n                      {t('mcp_node.view_less')}\n                    </Button>\n                  ) : null}\n                </div>\n              ) : data?.loaded && !data?.error ? (\n                <Label>{t('mcp_node.no_tools')}</Label>\n              ) : data?.error ? undefined : (\n                <Label>{t('mcp_node.loading_tools')}</Label>\n              )}\n            </AlertDescription>\n          </div>\n        </Alert>\n      </div>\n      <DefaultHandle\n        type=\"source\"\n        position={Position.Bottom}\n        id=\"a\"\n        isConnectable={isConnectable}\n      />\n    </div>\n  )\n})\n","import { FlowNodeTypeEnum } from 'src/services/database/types'\n\nimport { ToolbarNode } from './ToolboxNode'\nimport { LLMNode } from './LLMNode/LLMNode'\nimport { ThreadNode } from './ThreadNode'\nimport { MessageNode } from './MessageNode'\nimport { PromptNode } from './PromptNode'\nimport { SessionInfoNode } from './SessionInfoNode'\nimport { SchemaNode } from './SchemaNode'\nimport { CSVDataNode } from './CSVDataNode'\nimport { ToolNode } from './ToolNode'\nimport { EmbeddingNode } from './EmbeddingNode'\nimport { VectorDatabaseNode } from './VectorDatabaseNode'\nimport { JSONLDataNode } from './JSONLDataNode'\nimport { ApplicationBarNode } from './ApplicationBarNode'\nimport { ShapeNode } from './ShapeNode'\nimport { CircleNode } from './CircleNode'\nimport { TriangleNode } from './TriangleNode'\nimport { EditorAppNode } from './EditorAppNode'\nimport { PlaceholderNode } from './PlaceholderNode'\nimport { VSLiteAppNode } from './VSLiteAppNode'\nimport { McpNode } from './MCPNode'\n\nexport const nodeTypes = {\n  [FlowNodeTypeEnum.LLM]: LLMNode,\n  [FlowNodeTypeEnum.Toolbox]: ToolbarNode,\n  [FlowNodeTypeEnum.Thread]: ThreadNode,\n  [FlowNodeTypeEnum.Message]: MessageNode,\n  [FlowNodeTypeEnum.Prompt]: PromptNode,\n  [FlowNodeTypeEnum.SessionInfo]: SessionInfoNode,\n  [FlowNodeTypeEnum.Schema]: SchemaNode,\n  [FlowNodeTypeEnum.CSVData]: CSVDataNode,\n  [FlowNodeTypeEnum.ToolDefinition]: ToolNode,\n  [FlowNodeTypeEnum.DefaultEmbeddingModel]: EmbeddingNode,\n  [FlowNodeTypeEnum.VectorDatabase]: VectorDatabaseNode,\n  [FlowNodeTypeEnum.JSONLData]: JSONLDataNode,\n  [FlowNodeTypeEnum.ApplicationBar]: ApplicationBarNode,\n  [FlowNodeTypeEnum.Shape]: ShapeNode,\n  [FlowNodeTypeEnum.CircleShape]: CircleNode,\n  [FlowNodeTypeEnum.TriangleShape]: TriangleNode,\n  [FlowNodeTypeEnum.EditorApp]: EditorAppNode,\n  [FlowNodeTypeEnum.PlaceHolder]: PlaceholderNode,\n  [FlowNodeTypeEnum.VSLiteApp]: VSLiteAppNode,\n  [FlowNodeTypeEnum.MCP]: McpNode,\n}\n","'use client'\n\nimport * as React from 'react'\nimport * as TogglePrimitive from '@radix-ui/react-toggle'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from 'src/lib/utils'\n\nconst toggleVariants = cva(\n  'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2',\n  {\n    variants: {\n      variant: {\n        default: 'bg-transparent',\n        outline: 'border border-input bg-transparent hover:bg-accent hover:text-accent-foreground',\n      },\n      size: {\n        default: 'h-10 px-3 min-w-10',\n        sm: 'h-9 px-2.5 min-w-9',\n        lg: 'h-11 px-5 min-w-11',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","import * as React from 'react'\nimport * as ToggleGroupPrimitive from '@radix-ui/react-toggle-group'\nimport { type VariantProps } from 'class-variance-authority'\n\nimport { cn } from 'src/lib/utils'\nimport { toggleVariants } from 'src/lib/shadcn/ui/toggle'\n\nconst ToggleGroupContext = React.createContext<VariantProps<typeof toggleVariants>>({\n  size: 'default',\n  variant: 'default',\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn('flex items-center justify-center gap-1', className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>{children}</ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","import { useEffect, useState, type Dispatch, type SetStateAction, useCallback } from 'react'\n\nimport {\n  useNodes,\n  Panel,\n  useStore,\n  useStoreApi,\n  type OnNodesChange,\n  type NodeChange,\n  type XYPosition,\n  ViewportPortal,\n  useReactFlow,\n} from '@xyflow/react'\n\nimport { ToggleGroup, ToggleGroupItem } from 'src/lib/shadcn/ui/toggle-group'\n\nexport function ViewportLogger() {\n  const viewport = useStore(\n    (s) =>\n      `x: ${s.transform[0].toFixed(2)}, y: ${s.transform[1].toFixed(2)}, zoom: ${s.transform[2].toFixed(2)}`,\n  )\n\n  return <div>{viewport}</div>\n}\n\ntype ChangeLoggerProps = {\n  color?: string\n  limit?: number\n}\n\ntype ChangeInfoProps = {\n  change: NodeChange\n}\n\nfunction ChangeInfo({ change }: ChangeInfoProps) {\n  const id = 'id' in change ? change.id : '-'\n  const { type } = change\n\n  return (\n    <div className=\"mb-3\">\n      <div>node id: {id}</div>\n      <div>\n        {type === 'add' ? JSON.stringify(change.item, null, 2) : null}\n        {type === 'dimensions'\n          ? `dimensions: ${change.dimensions?.width}  ${change.dimensions?.height}`\n          : null}\n        {type === 'position'\n          ? `position: ${change.position?.x.toFixed(1)}, ${change.position?.y.toFixed(1)}`\n          : null}\n        {type === 'remove' ? 'remove' : null}\n        {type === 'select' ? (change.selected ? 'select' : 'unselect') : null}\n      </div>\n    </div>\n  )\n}\n\nexport function ChangeLogger({ limit = 20 }: ChangeLoggerProps) {\n  const [changes, setChanges] = useState<NodeChange[]>([])\n  const store = useStoreApi()\n\n  // Memoize the callback for handling node changes\n  const handleNodeChanges: OnNodesChange = useCallback(\n    (newChanges: NodeChange[]) => {\n      setChanges((prevChanges) => [...newChanges, ...prevChanges].slice(0, limit))\n    },\n    [limit],\n  )\n\n  useEffect(() => {\n    store.setState({ onNodesChange: handleNodeChanges })\n\n    return () => store.setState({ onNodesChange: undefined })\n  }, [handleNodeChanges, store])\n\n  const NoChanges = () => <div>No Changes Triggered</div>\n\n  return (\n    <>\n      {changes.length === 0 ? (\n        <NoChanges />\n      ) : (\n        changes.map((change, index) => <ChangeInfo key={index} change={change} />)\n      )}\n    </>\n  )\n}\n\nexport function NodeInspector() {\n  const { getInternalNode } = useReactFlow()\n  const nodes = useNodes()\n\n  return (\n    <ViewportPortal>\n      <div className=\"text-secondary-foreground\">\n        {nodes.map((node) => {\n          const internalNode = getInternalNode(node.id)\n          if (!internalNode) {\n            return null\n          }\n\n          const absPosition = internalNode?.internals.positionAbsolute\n\n          return (\n            <NodeInfo\n              key={node.id}\n              id={node.id}\n              selected={!!node.selected}\n              type={node.type || 'default'}\n              position={node.position}\n              absPosition={absPosition}\n              width={node.measured?.width ?? 0}\n              height={node.measured?.height ?? 0}\n              data={node.data}\n            />\n          )\n        })}\n      </div>\n    </ViewportPortal>\n  )\n}\n\ntype NodeInfoProps = {\n  id: string\n  type: string\n  selected: boolean\n  position: XYPosition\n  absPosition: XYPosition\n  width?: number\n  height?: number\n\n  data: unknown\n}\n\nfunction NodeInfo({\n  id,\n  type,\n  selected,\n  position,\n  absPosition,\n  width,\n  height,\n  data,\n}: NodeInfoProps) {\n  if (!width || !height) return null\n\n  const absoluteTransform = `translate(${absPosition.x}px, ${absPosition.y + height}px)`\n  const formattedPosition = `${position.x.toFixed(1)}, ${position.y.toFixed(1)}`\n  const formattedDimensions = `${width}  ${height}`\n  const selectionStatus = selected ? 'Selected' : 'Not Selected'\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        transform: absoluteTransform,\n        width: width * 2,\n      }}\n      className=\"text-xs\"\n    >\n      <div>id: {id}</div>\n      <div>type: {type}</div>\n      <div>selected: {selectionStatus}</div>\n      <div>position: {formattedPosition}</div>\n      <div>dimensions: {formattedDimensions}</div>\n      <div>data: {JSON.stringify(data, null, 2)}</div>\n    </div>\n  )\n}\n\ntype Tool = {\n  active: boolean\n  setActive: Dispatch<SetStateAction<boolean>>\n  label: string\n  value: string\n}\n\ntype DevToolsToggleProps = {\n  tools: Tool[]\n}\n\nfunction DevToolsToggle({ tools }: DevToolsToggleProps) {\n  return (\n    <Panel position=\"top-left\" className=\"bg-card p-1 border rounded shadow-sm\">\n      <ToggleGroup type=\"multiple\">\n        {tools.map(({ active, setActive, label, value }) => (\n          <ToggleGroupItem\n            key={value}\n            value={value}\n            onClick={() => setActive((prev) => !prev)}\n            aria-pressed={active}\n            className=\"bg-card text-card-foreground transition-colors duration-300 hover:bg-secondary hover:text-secondary-foreground\"\n          >\n            {label}\n          </ToggleGroupItem>\n        ))}\n      </ToggleGroup>\n    </Panel>\n  )\n}\n\nexport function DevTools() {\n  const [nodeInspectorActive, setNodeInspectorActive] = useState(false)\n  const [changeLoggerActive, setChangeLoggerActive] = useState(false)\n  const [viewportLoggerActive, setViewportLoggerActive] = useState(false)\n\n  const tools = [\n    {\n      active: nodeInspectorActive,\n      setActive: setNodeInspectorActive,\n      label: 'Node Inspector',\n      value: 'node-inspector',\n    },\n    {\n      active: changeLoggerActive,\n      setActive: setChangeLoggerActive,\n      label: 'Change Logger',\n      value: 'change-logger',\n    },\n    {\n      active: viewportLoggerActive,\n      setActive: setViewportLoggerActive,\n      label: 'Viewport Logger',\n      value: 'viewport-logger',\n    },\n  ]\n\n  return (\n    <>\n      <DevToolsToggle tools={tools} />\n\n      {changeLoggerActive && (\n        <Panel\n          className=\"text-xs p-5 bg-white rounded shadow-md overflow-y-auto max-h-[50%] mt-20\"\n          position=\"bottom-right\"\n        >\n          <ChangeLogger />\n        </Panel>\n      )}\n\n      {nodeInspectorActive && <NodeInspector />}\n\n      {viewportLoggerActive && (\n        <Panel position=\"bottom-left\" className=\"text-secondary-foreground\">\n          <ViewportLogger />\n        </Panel>\n      )}\n    </>\n  )\n}\n\nDevTools.displayName = 'DevTools'\n","import { useCallback, useRef, useState } from 'react'\nimport deepmerge from 'deepmerge'\nimport { applyNodeChanges, Connection, Edge, EdgeChange, Node, NodeChange } from '@xyflow/react'\nimport { FlowNode, FlowNodeTypeEnum } from 'src/services/database/types'\nimport { In, type FindManyOptions } from 'src/services/database/typeorm-wrapper'\nimport { useFlowState } from 'src/states/flow'\nimport { DISABLED_DELETE_NODE_TYPES, SYSTEM_NODE_IDS } from 'src/constants/nodes'\nimport { useSessionState } from 'src/states/session'\n\nexport const useFlowManager = () => {\n  const updatePositionRef = useRef<Record<string, number | undefined>>({})\n  const updateDimensionsRef = useRef<Record<string, number>>({})\n  const onNodesChangesRef = useRef<\n    ((changes: NodeChange<Node>[]) => Promise<boolean | void | undefined>)[]\n  >([])\n\n  const flowEdges = useFlowState((state) => state.flowEdges)\n  const currentSession = useSessionState((state) => state.currentSession)\n  const setNodes = useFlowState((state) => state.setNodes)\n  const updateNodes = useFlowState((state) => state.updateNodes)\n  const updateEdges = useFlowState((state) => state.updateEdges)\n  const addConnectionToEdges = useFlowState((state) => state.addConnectionToEdges)\n\n  const resetFlows = useFlowState((state) => state.reset)\n  const findFlowEdges = useFlowState((state) => state.findFlowEdges)\n  const deleteFlowNode = useFlowState((state) => state.deleteFlowNode)\n  const deleteFlowEdge = useFlowState((state) => state.deleteFlowEdge)\n  const updateFlowNode = useFlowState((state) => state.updateFlowNode)\n  const getNodes = useFlowState((state) => state.getNodes)\n  const findFlowNodesWithSource = useFlowState((state) => state.findFlowNodesWithSource)\n\n  const flowEdgesRef = useRef(flowEdges)\n  const currentSessionIdRef = useRef<string | null>()\n  const [loadingState, setLoadingState] = useState({ loading: false })\n\n  flowEdgesRef.current = flowEdges\n\n  const initFlow = useCallback(\n    async (currentSessionId: string, func?: () => Promise<void>) => {\n      try {\n        currentSessionIdRef.current = currentSessionId\n        resetFlows()\n        await func?.()\n      } catch {\n        currentSessionIdRef.current = undefined\n      }\n    },\n    [resetFlows],\n  )\n\n  const prepareFlowInfo = useCallback(\n    async (query: FindManyOptions<FlowNode>) => {\n      try {\n        if (!currentSession?.id) {\n          return\n        }\n        setLoadingState((loading) => ({ ...loading, loading: true }))\n        const flowNodes = await findFlowNodesWithSource({\n          ...query,\n          where: {\n            ...query.where,\n            session_id: currentSession.id,\n          },\n        })\n        const flowEdges = await findFlowEdges({\n          where: [\n            { source: In(flowNodes.map((node) => node.id)) },\n            { target: In(flowNodes.map((node) => node.id)) },\n          ],\n        })\n        return {\n          flowNodes,\n          flowEdges,\n        }\n      } finally {\n        setLoadingState((loading) => ({ ...loading, loading: false }))\n      }\n    },\n    [findFlowNodesWithSource, findFlowEdges, currentSession?.id],\n  )\n\n  const updateNodeChanges = useCallback(\n    async (changes: NodeChange<Node>[]) => {\n      for (const handler of onNodesChangesRef.current) {\n        const result = await handler(changes)\n        if (typeof result === 'boolean' && !result) {\n          return\n        }\n      }\n      for (const change of changes) {\n        if (\n          'id' in change &&\n          Object.values(SYSTEM_NODE_IDS).includes(change.id) &&\n          change.type !== 'remove'\n        ) {\n          updateNodes([change])\n        } else if (\n          change.type === 'position' &&\n          change.position &&\n          !isNaN(change.position.x) &&\n          !isNaN(change.position.y)\n        ) {\n          updateNodes([change])\n\n          const x = change.position.x\n          const y = change.position.y\n          clearTimeout(updatePositionRef.current[change.id])\n          updatePositionRef.current[change.id] = setTimeout(async () => {\n            updatePositionRef.current[change.id] = undefined\n            await updateFlowNode(\n              {\n                id: change.id,\n                x,\n                y,\n              },\n              { silent: true },\n            )\n          }, 200) as unknown as number\n        } else if (change.type === 'remove') {\n          // DISABLED: delete node\n          const node = getNodes([change.id])?.[0]\n          if (!node?.type || DISABLED_DELETE_NODE_TYPES.includes(node.type as FlowNodeTypeEnum)) {\n            return\n          }\n          await deleteFlowNode({ id: change.id })\n        } else if (\n          change.type === 'dimensions' &&\n          change.dimensions &&\n          !isNaN(change.dimensions.width) &&\n          !isNaN(change.dimensions.height)\n        ) {\n          const node = getNodes([change.id])?.[0]\n          if (!node?.width && !node?.height) {\n            return\n          }\n          updateNodes([change])\n\n          clearTimeout(updateDimensionsRef.current[change.id])\n          const width = change.dimensions.width\n          const height = change.dimensions.height\n          updateDimensionsRef.current[change.id] = setTimeout(async () => {\n            await updateFlowNode(\n              {\n                id: change.id,\n                width,\n                height,\n              },\n              { silent: true },\n            )\n          }, 200) as unknown as number\n        } else if (change.type === 'select') {\n          updateNodes([change])\n        }\n      }\n    },\n    [updateNodes, updateFlowNode, getNodes, deleteFlowNode],\n  )\n\n  const updateEdgeChanges = useCallback(\n    (changes: EdgeChange<Edge>[]) => {\n      Promise.all(\n        changes.map(async (change) => {\n          if (change.type === 'remove') {\n            return deleteFlowEdge({ id: change.id })\n          }\n        }),\n      )\n      updateEdges(changes)\n    },\n    [deleteFlowEdge, updateEdges],\n  )\n\n  const updateEdgeConnection = useCallback(\n    (connection: Connection) => {\n      addConnectionToEdges(connection)\n    },\n    [addConnectionToEdges],\n  )\n\n  const updateOrCreateNode = useCallback(\n    (input: Node | ((node: Node[]) => Node | undefined)) => {\n      setNodes((nodes) => {\n        let updatingNode\n        if (typeof input === 'function') {\n          updatingNode = input(nodes)\n        } else {\n          updatingNode = input\n        }\n        if (!updatingNode) {\n          return nodes\n        }\n        const node = nodes?.find((n) => n.id === updatingNode.id)\n        const change: NodeChange<Node> = {\n          id: updatingNode.id,\n          item: node\n            ? deepmerge(node, updatingNode)\n            : {\n                ...updatingNode,\n                position: {\n                  x: updatingNode.position?.x || 0,\n                  y: updatingNode.position?.y || 0,\n                },\n              },\n          type: node ? 'replace' : 'add',\n        }\n        return applyNodeChanges([change], nodes)\n      })\n    },\n    [setNodes],\n  )\n\n  const addOnNodeChangeHandler = useCallback(\n    (func: (changes: NodeChange<Node>[]) => Promise<boolean | void | undefined>) => {\n      onNodesChangesRef.current.push(func)\n      return () => {\n        onNodesChangesRef.current = onNodesChangesRef.current.filter((handler) => handler !== func)\n      }\n    },\n    [],\n  )\n\n  return {\n    initFlow,\n    loadingState,\n    prepareFlowInfo,\n    updateNodeChanges,\n    updateEdgeChanges,\n    updateOrCreateNode,\n    currentSessionIdRef,\n    updateEdgeConnection,\n    addOnNodeChangeHandler,\n  }\n}\n","import { useEffect, useRef } from 'react'\nimport { useFlowManager } from 'src/hooks/flows/handlers/use-flow-manager'\nimport { useFlowState } from 'src/states/flow'\nimport { useSessionState } from 'src/states/session'\n\nexport const useAutomaticallyRenderFlows = (flowManager: ReturnType<typeof useFlowManager>) => {\n  const currentSessionId = useSessionState((state) => state.currentSession?.id)\n  const { loadingState, prepareFlowInfo, initFlow, currentSessionIdRef } = flowManager\n\n  const flowStateReady = useFlowState((state) => state.ready)\n  const nodes = useFlowState((state) => state.nodes)\n\n  const flowNodesRef = useRef(nodes)\n  const removeSyncNodeQueue = useFlowState((state) => state.removeSyncNodeQueue)\n  const removeSyncEdgeQueue = useFlowState((state) => state.removeSyncEdgeQueue)\n  flowNodesRef.current = nodes\n\n  useEffect(() => {\n    if (\n      loadingState.loading ||\n      !flowStateReady ||\n      !currentSessionId ||\n      currentSessionIdRef.current === currentSessionId\n    ) {\n      return\n    }\n    initFlow(currentSessionId, async () => {\n      await prepareFlowInfo({\n        where: {\n          session_id: currentSessionId,\n        },\n      })\n    })\n  }, [\n    initFlow,\n    prepareFlowInfo,\n    loadingState.loading,\n    currentSessionIdRef,\n    flowStateReady,\n    currentSessionId,\n  ])\n\n  useEffect(() => {\n    const unsubNodeHandler = useFlowState.subscribe(\n      (state) => state.syncNodeQueue,\n      async (syncNodeQueue, previousSyncNodeQueue) => {\n        const lastTimestamps = previousSyncNodeQueue.map((node) => node.timestamp)\n        const handlingQueueItems = syncNodeQueue.filter(\n          (item) => !lastTimestamps.includes(item.timestamp),\n        )\n        if (handlingQueueItems.length) {\n          removeSyncNodeQueue(handlingQueueItems.map((item) => item.timestamp))\n        }\n      },\n    )\n    const unsubEdgeHandler = useFlowState.subscribe(\n      (state) => state.syncEdgeQueue,\n      async (syncEdgeQueue, previousSyncEdgeQueue) => {\n        const lastTimestamps = previousSyncEdgeQueue.map((node) => node.timestamp)\n        const handlingQueueItems = syncEdgeQueue.filter(\n          (item) => !lastTimestamps.includes(item.timestamp),\n        )\n        if (handlingQueueItems.length) {\n          removeSyncEdgeQueue(handlingQueueItems.map((item) => item.timestamp))\n        }\n      },\n    )\n\n    return () => {\n      unsubNodeHandler()\n      unsubEdgeHandler()\n    }\n  }, [prepareFlowInfo, removeSyncEdgeQueue, removeSyncNodeQueue])\n}\n","import { useEffect, useMemo, useRef, useState } from 'react'\nimport { LLMStatusEnum } from 'src/services/database/types/llm'\nimport { useFlowManager } from 'src/hooks/flows/handlers/use-flow-manager'\n\nimport { useAutomaticallyRenderFlows } from 'src/hooks/flows/handlers/use-automatically-render-flow'\nimport { useLocalLLMState } from 'src/services/local-llm'\n\nexport const useHomePage = () => {\n  const [initializing, setInitializing] = useState(true)\n  const flowManager = useFlowManager()\n  const selectedModel = useLocalLLMState((state) => state.selectedModel)\n  const selectedModelRef = useRef(selectedModel)\n  const setInitProgressCallback = useLocalLLMState((state) => state.setInitProgressCallback)\n  const { updateOrCreateNode, updateNodeChanges, updateEdgeChanges, updateEdgeConnection } =\n    flowManager\n  useAutomaticallyRenderFlows(flowManager)\n\n  selectedModelRef.current = selectedModel\n\n  useEffect(() => {\n    const callbackRemoval = setInitProgressCallback?.((input) => {\n      if (!selectedModelRef.current) {\n        return\n      }\n      const modelName = `${selectedModelRef.current}`\n      updateOrCreateNode((nodeRefs) => {\n        const flowNode = nodeRefs?.find((node) => {\n          if (\n            node.data?.entity &&\n            typeof node.data.entity === 'object' &&\n            'name' in node.data.entity\n          ) {\n            return node.data.entity.name === modelName\n          }\n          return false\n        })\n        if (!flowNode) return\n\n        flowNode.data.label = input.text\n        flowNode.data.status = LLMStatusEnum.Loading\n        if (input.progress === 100) {\n          flowNode.data.label = ``\n          flowNode.data.status = LLMStatusEnum.Loaded\n        }\n\n        return flowNode\n      })\n    })\n\n    return () => {\n      callbackRemoval?.()\n    }\n  }, [setInitProgressCallback, updateOrCreateNode])\n\n  const contextValue = useMemo(\n    () => ({\n      updateNodeChanges,\n      updateEdgeChanges,\n      initializing,\n      setInitializing,\n      updateEdgeConnection,\n    }),\n    [updateNodeChanges, updateEdgeChanges, initializing, setInitializing, updateEdgeConnection],\n  )\n\n  return contextValue\n}\n","import { memo, useCallback } from 'react'\nimport {\n  ReactFlow,\n  MiniMap,\n  Controls,\n  Background,\n  BackgroundVariant,\n  Node,\n  NodeChange,\n  Edge,\n  EdgeChange,\n  Connection,\n  PanOnScrollMode,\n} from '@xyflow/react'\nimport { nodeTypes } from 'src/components/flows/Nodes'\nimport { useFlowState } from 'src/states/flow'\nimport { useAppState } from 'src/states/app'\nimport { DevTools } from 'src/lib/shadcn/devtools'\nimport { isDev } from 'src/constants/dev'\nimport { useHomePage } from './hooks/use-home-page'\n\nconst HomeInner = () => {\n  const theme = useAppState((state) => state.theme)\n  const nodes = useFlowState((state) => state.nodes)\n  const edges = useFlowState((state) => state.edges)\n  const { updateNodeChanges, updateEdgeChanges, updateEdgeConnection } = useHomePage()\n\n  const onNodesChange = useCallback(\n    (changes: NodeChange<Node>[]) => {\n      updateNodeChanges(changes)\n    },\n    [updateNodeChanges],\n  )\n\n  const onEdgesChange = useCallback(\n    (changes: EdgeChange<Edge>[]) => {\n      updateEdgeChanges(changes)\n    },\n    [updateEdgeChanges],\n  )\n\n  const onConnect = useCallback(\n    (connection: Connection) => {\n      updateEdgeConnection(connection)\n    },\n    [updateEdgeConnection],\n  )\n\n  return (\n    <ReactFlow\n      nodes={nodes}\n      edges={edges}\n      nodeTypes={nodeTypes}\n      onNodesChange={onNodesChange}\n      onEdgesChange={onEdgesChange}\n      onConnect={onConnect}\n      panOnScroll\n      panOnScrollMode={PanOnScrollMode.Free}\n      colorMode={theme}\n      fitView\n    >\n      <Background variant={BackgroundVariant.Dots} gap={24} size={1} />\n      <Controls />\n      <MiniMap />\n      {isDev ? <DevTools /> : undefined}\n    </ReactFlow>\n  )\n}\n\nexport default memo(HomeInner)\n"],"file":"assets/Home-qx7shXPf.js"}