const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BTHjChhh.js","assets/index-DWQzdqsc.js","assets/index-Vcso_2OS.css","assets/routes-Bmso1xvj.js","assets/index-DxpaLr3Y.js","assets/index-DnF6nb4_.js","assets/chevron-right-RV_U_CF1.js","assets/createLucideIcon-ByB7ruez.js","assets/check-DITHWRNn.js","assets/circle-DnbEUkhh.js","assets/popover-Qa2ZleT0.js","assets/index-BtRrMOaN.js","assets/index-HSnfLTSA.css"])))=>i.map(i=>d[i]);
import{r as i,e as E,f as F,_ as T,j as m,c as D,L as k,D as O,__tla as z}from"./index-DWQzdqsc.js";import{a as A,u as I,b as P,L as h,l as R,I as U,p as H,S as V,c as Y,__tla as q}from"./LLMIcon-DTzLaIG1.js";import{u as M,S as B,A as G,H as N,g as x,F as J,e as K,f as Q,h as W,i as X,__tla as Z}from"./routes-Bmso1xvj.js";import{p as $,u as ee,a as ae,__tla as te}from"./file-tree-DH9c22tu.js";import"./dot-CWbyRG3b.js";import"./createLucideIcon-ByB7ruez.js";let S,se=Promise.all([(()=>{try{return z}catch{}})(),(()=>{try{return q}catch{}})(),(()=>{try{return Z}catch{}})(),(()=>{try{return te}catch{}})()]).then(async()=>{let j,b,L;j=()=>{const[a,e]=i.useState(!1),[t,o]=i.useState(),s=M(c=>c.currentSession),{t:u}=E("flows"),{toast:l}=F(),{loadModel:n}=A(),{confirmPassphrase:p}=I(),{modalRef:y}=P(V),v=i.useCallback(async(c,f,d)=>{if(s!=null&&s.main_node_id){if(!(t!=null&&t.llm)){l({variant:"destructive",description:u("editor_node.errors.llm_not_found")});return}(t==null?void 0:t.status)!==h.Loaded&&(await n(t.llm.provider,t.llm.name,{provider:t.llm.provider,callback:r=>{o(_=>_&&{..._,progress:r.text})}}),o(r=>r&&{...r,status:h.Loaded,progress:""}));try{const r=f.map(w=>w.role==="system"?new B(w.content):w.role==="assistant"?new G(w.content):new N(w.content));await p();const _=await R.stream(t.llm.provider,[...r,new N(c)],{onMessageUpdate:({content:w})=>{d==null||d(w)},llm:t.llm});return d==null||d((_==null?void 0:_.content)||""),_==null?void 0:_.content}catch(r){if(r instanceof Error&&r.message.includes("LLM_NOT_LOADED_YET")){l({title:u("editor_node.errors.llm_not_loaded_yet")});return}l({variant:"destructive",title:u("editor_node.errors.stream_message_failed")})}}},[s==null?void 0:s.main_node_id,t==null?void 0:t.llm,t==null?void 0:t.status,l,u,n]),g=i.useCallback(async()=>{try{if(e(!0),!(s!=null&&s.main_node_id))return;const c=await x("FlowEdge").find({where:{target:s.main_node_id}}),f=(await x("FlowNode").find({where:{id:U(c.map(r=>r.source))}})).find(r=>r.source_type===J.LLM);if(!f)return;const d=await x("LLM").findOne({where:{id:f.source_id}});if(!d)return;s.passphrase&&await H(s.passphrase,y.current),await n(d.provider,d.name,{provider:d.provider,callback:r=>{o(_=>_&&{..._,llm:d,progress:r.text})}}),o({llm:d,status:h.Loaded})}finally{e(!1)}},[s==null?void 0:s.main_node_id,s==null?void 0:s.passphrase,n,y]),C=i.useCallback(async()=>{try{if(e(!0),!(t!=null&&t.llm))return;await n(t.llm.provider,t.llm.name,{provider:t.llm.provider,callback:c=>{o(f=>f&&{...f,progress:c.text})}}),o(c=>c&&{...c,status:h.Loaded,progress:""})}finally{e(!1)}},[n,t==null?void 0:t.llm]);return i.useEffect(()=>{s!=null&&s.main_node_id&&g()},[s==null?void 0:s.main_node_id,g]),{loading:a,mainLLMInfo:t,createMessage:v,loadCurrentModel:C}},b=()=>{const a=M(l=>l.currentSession),[e,t]=i.useState(),o=i.useCallback(async(l,n)=>{await x("FlowNode").update(l,{raw:$(n)})},[]),s=i.useCallback(async l=>{a!=null&&a.main_node_id&&t(n=>{if(!(a!=null&&a.main_node_id))return n;const p=ee(n||{},l);return o(a==null?void 0:a.main_node_id,p),p})},[a==null?void 0:a.main_node_id,o]),u=i.useCallback(async()=>{if(!(a!=null&&a.main_node_id))return;const l=await x("FlowNode").findOne({where:{id:a==null?void 0:a.main_node_id}});l&&t(l.raw?ae(l.raw):{})},[a==null?void 0:a.main_node_id]);return i.useEffect(()=>{a!=null&&a.main_node_id&&u()},[a==null?void 0:a.main_node_id,u]),{fileSystemTree:e,updateCodeContainerFile:s,updateCodeContainerData:o}},L=i.lazy(()=>T(()=>import("./index-BTHjChhh.js").then(async a=>(await a.__tla,a)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),S=i.memo(()=>{var n,p,y,v;const{loading:a,mainLLMInfo:e,loadCurrentModel:t,createMessage:o}=j(),{fileSystemTree:s,updateCodeContainerFile:u}=b(),l=i.useCallback((g,C,c)=>o(g,C,c),[o]);return m.jsxs("div",{className:"h-full w-full relative","data-registry":"plate",children:[m.jsx(K,{children:m.jsx(Q,{children:m.jsxs("div",{className:D("flex absolute !z-[51] right-1 top-0 max-w-28 h-9 items-center justify-center flex-row"),children:[(e==null?void 0:e.status)===h.Loaded&&((n=e==null?void 0:e.llm)!=null&&n.name)?m.jsx(Y,{name:(p=e==null?void 0:e.llm)==null?void 0:p.name,className:"w-5 h-5 mr-1"}):void 0,m.jsxs(W,{className:"overflow-hidden !text-ellipsis w-full max-w-full max-h-full whitespace-nowrap text-sm",children:[e!=null&&e.progress?e.progress:(e==null?void 0:e.status)===h.Loaded?((y=e==null?void 0:e.llm)==null?void 0:y.name)||"":a?m.jsx(k,{size:16,name:"loader-circle",className:"animate-spin ml-2"}):void 0,e!=null&&e.llm&&(e==null?void 0:e.status)!==h.Loaded?m.jsx(k,{size:16,name:"loader-circle",onClick:t,className:"animate-spin ml-2"}):void 0]}),m.jsx(X,{children:m.jsx("p",{children:(e==null?void 0:e.progress)||((v=e==null?void 0:e.llm)==null?void 0:v.name)||""})})]})})}),m.jsx(i.Suspense,{fallback:m.jsx(O,{simple:!0}),children:s!==void 0?m.jsx(L,{autoLoad:!0,hideAppName:!0,llm:e==null?void 0:e.llm,fileSystemTree:s,onUpdateFileContent:u,sendMessage:l}):void 0})]})})});export{se as __tla,S as default};
