var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(ae){return ae&&ae.__esModule&&Object.prototype.hasOwnProperty.call(ae,"default")?ae.default:ae}function getAugmentedNamespace(ae){if(ae.__esModule)return ae;var e=ae.default;if(typeof e=="function"){var I=function oe(){return this instanceof oe?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};I.prototype=e.prototype}else I={};return Object.defineProperty(I,"__esModule",{value:!0}),Object.keys(ae).forEach(function(oe){var ue=Object.getOwnPropertyDescriptor(ae,oe);Object.defineProperty(I,oe,ue.get?ue:{enumerable:!0,get:function(){return ae[oe]}})}),I}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Reflect$1;(function(ae){(function(e){var I=typeof globalThis=="object"?globalThis:typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:rr(),oe=ue(ae);typeof I.Reflect<"u"&&(oe=ue(I.Reflect,oe)),e(oe,I),typeof I.Reflect>"u"&&(I.Reflect=ae);function ue(ir,lr){return function(dr,pr){Object.defineProperty(ir,dr,{configurable:!0,writable:!0,value:pr}),lr&&lr(dr,pr)}}function bt(){try{return Function("return this;")()}catch{}}function tr(){try{return(0,eval)("(function() { return this; })()")}catch{}}function rr(){return bt()||tr()}})(function(e,I){var oe=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",bt=ue&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",tr=ue&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",rr=typeof Object.create=="function",ir={__proto__:[]}instanceof Array,lr=!rr&&!ir,dr={create:rr?function(){return br(Object.create(null))}:ir?function(){return br({__proto__:null})}:function(){return br({})},has:lr?function(mr,fr){return oe.call(mr,fr)}:function(mr,fr){return fr in mr},get:lr?function(mr,fr){return oe.call(mr,fr)?mr[fr]:void 0}:function(mr,fr){return mr[fr]}},pr=Object.getPrototypeOf(Function),hr=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:js(),_r=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ps(),yr=typeof WeakMap=="function"?WeakMap:Vs(),wr=ue?Symbol.for("@reflect-metadata:registry"):void 0,Tr=Bs(),Ar=qs(Tr);function Sr(mr,fr,gr,xr){if(as(gr)){if(!xs(mr))throw new TypeError;if(!Rs(fr))throw new TypeError;return zr(mr,fr)}else{if(!xs(mr))throw new TypeError;if(!ps(fr))throw new TypeError;if(!ps(xr)&&!as(xr)&&!gs(xr))throw new TypeError;return gs(xr)&&(xr=void 0),gr=Es(gr),Ir(mr,fr,gr,xr)}}e("decorate",Sr);function Mr(mr,fr){function gr(xr,Rr){if(!ps(xr))throw new TypeError;if(!as(Rr)&&!Qs(Rr))throw new TypeError;Qr(mr,fr,xr,Rr)}return gr}e("metadata",Mr);function vr(mr,fr,gr,xr){if(!ps(gr))throw new TypeError;return as(xr)||(xr=Es(xr)),Qr(mr,fr,gr,xr)}e("defineMetadata",vr);function Lr(mr,fr,gr){if(!ps(fr))throw new TypeError;return as(gr)||(gr=Es(gr)),Or(mr,fr,gr)}e("hasMetadata",Lr);function es(mr,fr,gr){if(!ps(fr))throw new TypeError;return as(gr)||(gr=Es(gr)),Dr(mr,fr,gr)}e("hasOwnMetadata",es);function ss(mr,fr,gr){if(!ps(fr))throw new TypeError;return as(gr)||(gr=Es(gr)),Ur(mr,fr,gr)}e("getMetadata",ss);function os(mr,fr,gr){if(!ps(fr))throw new TypeError;return as(gr)||(gr=Es(gr)),kr(mr,fr,gr)}e("getOwnMetadata",os);function $r(mr,fr){if(!ps(mr))throw new TypeError;return as(fr)||(fr=Es(fr)),is(mr,fr)}e("getMetadataKeys",$r);function ns(mr,fr){if(!ps(mr))throw new TypeError;return as(fr)||(fr=Es(fr)),cs(mr,fr)}e("getOwnMetadataKeys",ns);function Nr(mr,fr,gr){if(!ps(fr))throw new TypeError;if(as(gr)||(gr=Es(gr)),!ps(fr))throw new TypeError;as(gr)||(gr=Es(gr));var xr=Os(fr,gr,!1);return as(xr)?!1:xr.OrdinaryDeleteMetadata(mr,fr,gr)}e("deleteMetadata",Nr);function zr(mr,fr){for(var gr=mr.length-1;gr>=0;--gr){var xr=mr[gr],Rr=xr(fr);if(!as(Rr)&&!gs(Rr)){if(!Rs(Rr))throw new TypeError;fr=Rr}}return fr}function Ir(mr,fr,gr,xr){for(var Rr=mr.length-1;Rr>=0;--Rr){var Fr=mr[Rr],ds=Fr(fr,gr,xr);if(!as(ds)&&!gs(ds)){if(!ps(ds))throw new TypeError;xr=ds}}return xr}function Or(mr,fr,gr){var xr=Dr(mr,fr,gr);if(xr)return!0;var Rr=Ls(fr);return gs(Rr)?!1:Or(mr,Rr,gr)}function Dr(mr,fr,gr){var xr=Os(fr,gr,!1);return as(xr)?!1:Ts(xr.OrdinaryHasOwnMetadata(mr,fr,gr))}function Ur(mr,fr,gr){var xr=Dr(mr,fr,gr);if(xr)return kr(mr,fr,gr);var Rr=Ls(fr);if(!gs(Rr))return Ur(mr,Rr,gr)}function kr(mr,fr,gr){var xr=Os(fr,gr,!1);if(!as(xr))return xr.OrdinaryGetOwnMetadata(mr,fr,gr)}function Qr(mr,fr,gr,xr){var Rr=Os(gr,xr,!0);Rr.OrdinaryDefineOwnMetadata(mr,fr,gr,xr)}function is(mr,fr){var gr=cs(mr,fr),xr=Ls(mr);if(xr===null)return gr;var Rr=is(xr,fr);if(Rr.length<=0)return gr;if(gr.length<=0)return Rr;for(var Fr=new _r,ds=[],ls=0,Jr=gr;ls<Jr.length;ls++){var rs=Jr[ls],ts=Fr.has(rs);ts||(Fr.add(rs),ds.push(rs))}for(var us=0,ys=Rr;us<ys.length;us++){var rs=ys[us],ts=Fr.has(rs);ts||(Fr.add(rs),ds.push(rs))}return ds}function cs(mr,fr){var gr=Os(mr,fr,!1);return gr?gr.OrdinaryOwnMetadataKeys(mr,fr):[]}function _s(mr){if(mr===null)return 1;switch(typeof mr){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return mr===null?1:6;default:return 6}}function as(mr){return mr===void 0}function gs(mr){return mr===null}function hs(mr){return typeof mr=="symbol"}function ps(mr){return typeof mr=="object"?mr!==null:typeof mr=="function"}function Ms(mr,fr){switch(_s(mr)){case 0:return mr;case 1:return mr;case 2:return mr;case 3:return mr;case 4:return mr;case 5:return mr}var gr="string",xr=Is(mr,bt);if(xr!==void 0){var Rr=xr.call(mr,gr);if(ps(Rr))throw new TypeError;return Rr}return bs(mr)}function bs(mr,fr){var gr,xr;{var Rr=mr.toString;if(As(Rr)){var xr=Rr.call(mr);if(!ps(xr))return xr}var gr=mr.valueOf;if(As(gr)){var xr=gr.call(mr);if(!ps(xr))return xr}}throw new TypeError}function Ts(mr){return!!mr}function Cs(mr){return""+mr}function Es(mr){var fr=Ms(mr);return hs(fr)?fr:Cs(fr)}function xs(mr){return Array.isArray?Array.isArray(mr):mr instanceof Object?mr instanceof Array:Object.prototype.toString.call(mr)==="[object Array]"}function As(mr){return typeof mr=="function"}function Rs(mr){return typeof mr=="function"}function Qs(mr){switch(_s(mr)){case 3:return!0;case 4:return!0;default:return!1}}function $s(mr,fr){return mr===fr||mr!==mr&&fr!==fr}function Is(mr,fr){var gr=mr[fr];if(gr!=null){if(!As(gr))throw new TypeError;return gr}}function Ds(mr){var fr=Is(mr,tr);if(!As(fr))throw new TypeError;var gr=fr.call(mr);if(!ps(gr))throw new TypeError;return gr}function Us(mr){return mr.value}function ks(mr){var fr=mr.next();return fr.done?!1:fr}function Fs(mr){var fr=mr.return;fr&&fr.call(mr)}function Ls(mr){var fr=Object.getPrototypeOf(mr);if(typeof mr!="function"||mr===pr||fr!==pr)return fr;var gr=mr.prototype,xr=gr&&Object.getPrototypeOf(gr);if(xr==null||xr===Object.prototype)return fr;var Rr=xr.constructor;return typeof Rr!="function"||Rr===mr?fr:Rr}function zs(){var mr;!as(wr)&&typeof I.Reflect<"u"&&!(wr in I.Reflect)&&typeof I.Reflect.defineMetadata=="function"&&(mr=Ns(I.Reflect));var fr,gr,xr,Rr=new yr,Fr={registerProvider:ds,getProvider:Jr,setProvider:ts};return Fr;function ds(us){if(!Object.isExtensible(Fr))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case mr===us:break;case as(fr):fr=us;break;case fr===us:break;case as(gr):gr=us;break;case gr===us:break;default:xr===void 0&&(xr=new _r),xr.add(us);break}}function ls(us,ys){if(!as(fr)){if(fr.isProviderFor(us,ys))return fr;if(!as(gr)){if(gr.isProviderFor(us,ys))return fr;if(!as(xr))for(var ws=Ds(xr);;){var Ss=ks(ws);if(!Ss)return;var vs=Us(Ss);if(vs.isProviderFor(us,ys))return Fs(ws),vs}}}if(!as(mr)&&mr.isProviderFor(us,ys))return mr}function Jr(us,ys){var ws=Rr.get(us),Ss;return as(ws)||(Ss=ws.get(ys)),as(Ss)&&(Ss=ls(us,ys),as(Ss)||(as(ws)&&(ws=new hr,Rr.set(us,ws)),ws.set(ys,Ss))),Ss}function rs(us){if(as(us))throw new TypeError;return fr===us||gr===us||!as(xr)&&xr.has(us)}function ts(us,ys,ws){if(!rs(ws))throw new Error("Metadata provider not registered.");var Ss=Jr(us,ys);if(Ss!==ws){if(!as(Ss))return!1;var vs=Rr.get(us);as(vs)&&(vs=new hr,Rr.set(us,vs)),vs.set(ys,ws)}return!0}}function Bs(){var mr;return!as(wr)&&ps(I.Reflect)&&Object.isExtensible(I.Reflect)&&(mr=I.Reflect[wr]),as(mr)&&(mr=zs()),!as(wr)&&ps(I.Reflect)&&Object.isExtensible(I.Reflect)&&Object.defineProperty(I.Reflect,wr,{enumerable:!1,configurable:!1,writable:!1,value:mr}),mr}function qs(mr){var fr=new yr,gr={isProviderFor:function(rs,ts){var us=fr.get(rs);return as(us)?!1:us.has(ts)},OrdinaryDefineOwnMetadata:ds,OrdinaryHasOwnMetadata:Rr,OrdinaryGetOwnMetadata:Fr,OrdinaryOwnMetadataKeys:ls,OrdinaryDeleteMetadata:Jr};return Tr.registerProvider(gr),gr;function xr(rs,ts,us){var ys=fr.get(rs),ws=!1;if(as(ys)){if(!us)return;ys=new hr,fr.set(rs,ys),ws=!0}var Ss=ys.get(ts);if(as(Ss)){if(!us)return;if(Ss=new hr,ys.set(ts,Ss),!mr.setProvider(rs,ts,gr))throw ys.delete(ts),ws&&fr.delete(rs),new Error("Wrong provider for target.")}return Ss}function Rr(rs,ts,us){var ys=xr(ts,us,!1);return as(ys)?!1:Ts(ys.has(rs))}function Fr(rs,ts,us){var ys=xr(ts,us,!1);if(!as(ys))return ys.get(rs)}function ds(rs,ts,us,ys){var ws=xr(us,ys,!0);ws.set(rs,ts)}function ls(rs,ts){var us=[],ys=xr(rs,ts,!1);if(as(ys))return us;for(var ws=ys.keys(),Ss=Ds(ws),vs=0;;){var Hs=ks(Ss);if(!Hs)return us.length=vs,us;var Ws=Us(Hs);try{us[vs]=Ws}catch(Ks){try{Fs(Ss)}finally{throw Ks}}vs++}}function Jr(rs,ts,us){var ys=xr(ts,us,!1);if(as(ys)||!ys.delete(rs))return!1;if(ys.size===0){var ws=fr.get(ts);as(ws)||(ws.delete(us),ws.size===0&&fr.delete(ws))}return!0}}function Ns(mr){var fr=mr.defineMetadata,gr=mr.hasOwnMetadata,xr=mr.getOwnMetadata,Rr=mr.getOwnMetadataKeys,Fr=mr.deleteMetadata,ds=new yr,ls={isProviderFor:function(Jr,rs){var ts=ds.get(Jr);return!as(ts)&&ts.has(rs)?!0:Rr(Jr,rs).length?(as(ts)&&(ts=new _r,ds.set(Jr,ts)),ts.add(rs),!0):!1},OrdinaryDefineOwnMetadata:fr,OrdinaryHasOwnMetadata:gr,OrdinaryGetOwnMetadata:xr,OrdinaryOwnMetadataKeys:Rr,OrdinaryDeleteMetadata:Fr};return ls}function Os(mr,fr,gr){var xr=Tr.getProvider(mr,fr);if(!as(xr))return xr;if(gr){if(Tr.setProvider(mr,fr,Ar))return Ar;throw new Error("Illegal state.")}}function js(){var mr={},fr=[],gr=function(){function ls(Jr,rs,ts){this._index=0,this._keys=Jr,this._values=rs,this._selector=ts}return ls.prototype["@@iterator"]=function(){return this},ls.prototype[tr]=function(){return this},ls.prototype.next=function(){var Jr=this._index;if(Jr>=0&&Jr<this._keys.length){var rs=this._selector(this._keys[Jr],this._values[Jr]);return Jr+1>=this._keys.length?(this._index=-1,this._keys=fr,this._values=fr):this._index++,{value:rs,done:!1}}return{value:void 0,done:!0}},ls.prototype.throw=function(Jr){throw this._index>=0&&(this._index=-1,this._keys=fr,this._values=fr),Jr},ls.prototype.return=function(Jr){return this._index>=0&&(this._index=-1,this._keys=fr,this._values=fr),{value:Jr,done:!0}},ls}(),xr=function(){function ls(){this._keys=[],this._values=[],this._cacheKey=mr,this._cacheIndex=-2}return Object.defineProperty(ls.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ls.prototype.has=function(Jr){return this._find(Jr,!1)>=0},ls.prototype.get=function(Jr){var rs=this._find(Jr,!1);return rs>=0?this._values[rs]:void 0},ls.prototype.set=function(Jr,rs){var ts=this._find(Jr,!0);return this._values[ts]=rs,this},ls.prototype.delete=function(Jr){var rs=this._find(Jr,!1);if(rs>=0){for(var ts=this._keys.length,us=rs+1;us<ts;us++)this._keys[us-1]=this._keys[us],this._values[us-1]=this._values[us];return this._keys.length--,this._values.length--,$s(Jr,this._cacheKey)&&(this._cacheKey=mr,this._cacheIndex=-2),!0}return!1},ls.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=mr,this._cacheIndex=-2},ls.prototype.keys=function(){return new gr(this._keys,this._values,Rr)},ls.prototype.values=function(){return new gr(this._keys,this._values,Fr)},ls.prototype.entries=function(){return new gr(this._keys,this._values,ds)},ls.prototype["@@iterator"]=function(){return this.entries()},ls.prototype[tr]=function(){return this.entries()},ls.prototype._find=function(Jr,rs){if(!$s(this._cacheKey,Jr)){this._cacheIndex=-1;for(var ts=0;ts<this._keys.length;ts++)if($s(this._keys[ts],Jr)){this._cacheIndex=ts;break}}return this._cacheIndex<0&&rs&&(this._cacheIndex=this._keys.length,this._keys.push(Jr),this._values.push(void 0)),this._cacheIndex},ls}();return xr;function Rr(ls,Jr){return ls}function Fr(ls,Jr){return Jr}function ds(ls,Jr){return[ls,Jr]}}function Ps(){var mr=function(){function fr(){this._map=new hr}return Object.defineProperty(fr.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),fr.prototype.has=function(gr){return this._map.has(gr)},fr.prototype.add=function(gr){return this._map.set(gr,gr),this},fr.prototype.delete=function(gr){return this._map.delete(gr)},fr.prototype.clear=function(){this._map.clear()},fr.prototype.keys=function(){return this._map.keys()},fr.prototype.values=function(){return this._map.keys()},fr.prototype.entries=function(){return this._map.entries()},fr.prototype["@@iterator"]=function(){return this.keys()},fr.prototype[tr]=function(){return this.keys()},fr}();return mr}function Vs(){var mr=16,fr=dr.create(),gr=xr();return function(){function Jr(){this._key=xr()}return Jr.prototype.has=function(rs){var ts=Rr(rs,!1);return ts!==void 0?dr.has(ts,this._key):!1},Jr.prototype.get=function(rs){var ts=Rr(rs,!1);return ts!==void 0?dr.get(ts,this._key):void 0},Jr.prototype.set=function(rs,ts){var us=Rr(rs,!0);return us[this._key]=ts,this},Jr.prototype.delete=function(rs){var ts=Rr(rs,!1);return ts!==void 0?delete ts[this._key]:!1},Jr.prototype.clear=function(){this._key=xr()},Jr}();function xr(){var Jr;do Jr="@@WeakMap@@"+ls();while(dr.has(fr,Jr));return fr[Jr]=!0,Jr}function Rr(Jr,rs){if(!oe.call(Jr,gr)){if(!rs)return;Object.defineProperty(Jr,gr,{value:dr.create()})}return Jr[gr]}function Fr(Jr,rs){for(var ts=0;ts<rs;++ts)Jr[ts]=Math.random()*255|0;return Jr}function ds(Jr){if(typeof Uint8Array=="function"){var rs=new Uint8Array(Jr);return typeof crypto<"u"?crypto.getRandomValues(rs):typeof msCrypto<"u"?msCrypto.getRandomValues(rs):Fr(rs,Jr),rs}return Fr(new Array(Jr),Jr)}function ls(){var Jr=ds(mr);Jr[6]=Jr[6]&79|64,Jr[8]=Jr[8]&191|128;for(var rs="",ts=0;ts<mr;++ts){var us=Jr[ts];(ts===4||ts===6||ts===8)&&(rs+="-"),us<16&&(rs+="0"),rs+=us.toString(16).toLowerCase()}return rs}}function br(mr){return mr.__=void 0,delete mr.__,mr}})})(Reflect$1||(Reflect$1={}));class MetadataUtils{static getInheritanceTree(e){const I=[e],oe=ue=>{const bt=Object.getPrototypeOf(ue);bt&&bt.name&&(I.push(bt),oe(bt))};return oe(e),I}static isInherited(e,I){return e.prototype instanceof I}static filterByTarget(e,I){return I?e.filter(oe=>oe.target&&I.indexOf(oe.target)!==-1):e}}class MetadataArgsStorage{constructor(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}filterTables(e){return this.filterByTarget(this.tables,e)}filterColumns(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)}findGenerated(e,I){return this.generations.find(oe=>(Array.isArray(e)?e.indexOf(oe.target)!==-1:oe.target===e)&&oe.propertyName===I)}findTree(e){return this.trees.find(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterRelations(e){return this.filterByTargetAndWithoutDuplicateRelationProperties(this.relations,e)}filterRelationIds(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)}filterRelationCounts(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)}filterIndices(e){return this.indices.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterUniques(e){return this.uniques.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterChecks(e){return this.checks.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterExclusions(e){return this.exclusions.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterListeners(e){return this.filterByTarget(this.entityListeners,e)}filterEmbeddeds(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)}findJoinTable(e,I){return this.joinTables.find(oe=>oe.target===e&&oe.propertyName===I)}filterJoinColumns(e,I){return this.joinColumns.filter(oe=>oe.target===e&&oe.propertyName===I)}filterSubscribers(e){return this.filterByTarget(this.entitySubscribers,e)}filterNamingStrategies(e){return this.filterByTarget(this.namingStrategies,e)}filterTransactionEntityManagers(e,I){return this.transactionEntityManagers.filter(oe=>(Array.isArray(e)?e.indexOf(oe.target)!==-1:oe.target===e)&&oe.methodName===I)}filterTransactionRepository(e,I){return this.transactionRepositories.filter(oe=>(Array.isArray(e)?e.indexOf(oe.target)!==-1:oe.target===e)&&oe.methodName===I)}filterSingleTableChildren(e){return this.tables.filter(I=>typeof I.target=="function"&&typeof e=="function"&&MetadataUtils.isInherited(I.target,e)&&I.type==="entity-child")}findInheritanceType(e){return this.inheritances.find(I=>I.target===e)}findDiscriminatorValue(e){return this.discriminatorValues.find(I=>I.target===e)}filterByTarget(e,I){return e.filter(oe=>Array.isArray(I)?I.indexOf(oe.target)!==-1:oe.target===I)}filterByTargetAndWithoutDuplicateProperties(e,I){const oe=[];return e.forEach(ue=>{(Array.isArray(I)?I.indexOf(ue.target)!==-1:ue.target===I)&&(oe.find(tr=>tr.propertyName===ue.propertyName)||oe.push(ue))}),oe}filterByTargetAndWithoutDuplicateRelationProperties(e,I){const oe=[];return e.forEach(ue=>{if(Array.isArray(I)?I.indexOf(ue.target)!==-1:ue.target===I){const tr=oe.findIndex(rr=>rr.propertyName===ue.propertyName);if(Array.isArray(I)&&tr!==-1&&I.indexOf(ue.target)<I.indexOf(oe[tr].target)){const rr=Object.create(oe[tr]);rr.type=ue.type,oe[tr]=rr}else tr===-1&&oe.push(ue)}}),oe}filterByTargetAndWithoutDuplicateEmbeddedProperties(e,I){const oe=[];return e.forEach(ue=>{(Array.isArray(I)?I.indexOf(ue.target)!==-1:ue.target===I)&&(oe.find(rr=>rr.prefix===ue.prefix&&rr.propertyName===ue.propertyName)||oe.push(ue))}),oe}}const global$1=globalThis||void 0||self;var buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$1=0,len=code.length;i$1<len;++i$1)lookup[i$1]=code[i$1],revLookup[code.charCodeAt(i$1)]=i$1;revLookup[45]=62;revLookup[95]=63;function getLens(ae){var e=ae.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=ae.indexOf("=");I===-1&&(I=e);var oe=I===e?0:4-I%4;return[I,oe]}function byteLength(ae){var e=getLens(ae),I=e[0],oe=e[1];return(I+oe)*3/4-oe}function _byteLength(ae,e,I){return(e+I)*3/4-I}function toByteArray(ae){var e,I=getLens(ae),oe=I[0],ue=I[1],bt=new Arr(_byteLength(ae,oe,ue)),tr=0,rr=ue>0?oe-4:oe,ir;for(ir=0;ir<rr;ir+=4)e=revLookup[ae.charCodeAt(ir)]<<18|revLookup[ae.charCodeAt(ir+1)]<<12|revLookup[ae.charCodeAt(ir+2)]<<6|revLookup[ae.charCodeAt(ir+3)],bt[tr++]=e>>16&255,bt[tr++]=e>>8&255,bt[tr++]=e&255;return ue===2&&(e=revLookup[ae.charCodeAt(ir)]<<2|revLookup[ae.charCodeAt(ir+1)]>>4,bt[tr++]=e&255),ue===1&&(e=revLookup[ae.charCodeAt(ir)]<<10|revLookup[ae.charCodeAt(ir+1)]<<4|revLookup[ae.charCodeAt(ir+2)]>>2,bt[tr++]=e>>8&255,bt[tr++]=e&255),bt}function tripletToBase64(ae){return lookup[ae>>18&63]+lookup[ae>>12&63]+lookup[ae>>6&63]+lookup[ae&63]}function encodeChunk(ae,e,I){for(var oe,ue=[],bt=e;bt<I;bt+=3)oe=(ae[bt]<<16&16711680)+(ae[bt+1]<<8&65280)+(ae[bt+2]&255),ue.push(tripletToBase64(oe));return ue.join("")}function fromByteArray(ae){for(var e,I=ae.length,oe=I%3,ue=[],bt=16383,tr=0,rr=I-oe;tr<rr;tr+=bt)ue.push(encodeChunk(ae,tr,tr+bt>rr?rr:tr+bt));return oe===1?(e=ae[I-1],ue.push(lookup[e>>2]+lookup[e<<4&63]+"==")):oe===2&&(e=(ae[I-2]<<8)+ae[I-1],ue.push(lookup[e>>10]+lookup[e>>4&63]+lookup[e<<2&63]+"=")),ue.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(ae,e,I,oe,ue){var bt,tr,rr=ue*8-oe-1,ir=(1<<rr)-1,lr=ir>>1,dr=-7,pr=I?ue-1:0,hr=I?-1:1,_r=ae[e+pr];for(pr+=hr,bt=_r&(1<<-dr)-1,_r>>=-dr,dr+=rr;dr>0;bt=bt*256+ae[e+pr],pr+=hr,dr-=8);for(tr=bt&(1<<-dr)-1,bt>>=-dr,dr+=oe;dr>0;tr=tr*256+ae[e+pr],pr+=hr,dr-=8);if(bt===0)bt=1-lr;else{if(bt===ir)return tr?NaN:(_r?-1:1)*(1/0);tr=tr+Math.pow(2,oe),bt=bt-lr}return(_r?-1:1)*tr*Math.pow(2,bt-oe)};ieee754.write=function(ae,e,I,oe,ue,bt){var tr,rr,ir,lr=bt*8-ue-1,dr=(1<<lr)-1,pr=dr>>1,hr=ue===23?Math.pow(2,-24)-Math.pow(2,-77):0,_r=oe?0:bt-1,yr=oe?1:-1,wr=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(rr=isNaN(e)?1:0,tr=dr):(tr=Math.floor(Math.log(e)/Math.LN2),e*(ir=Math.pow(2,-tr))<1&&(tr--,ir*=2),tr+pr>=1?e+=hr/ir:e+=hr*Math.pow(2,1-pr),e*ir>=2&&(tr++,ir/=2),tr+pr>=dr?(rr=0,tr=dr):tr+pr>=1?(rr=(e*ir-1)*Math.pow(2,ue),tr=tr+pr):(rr=e*Math.pow(2,pr-1)*Math.pow(2,ue),tr=0));ue>=8;ae[I+_r]=rr&255,_r+=yr,rr/=256,ue-=8);for(tr=tr<<ue|rr,lr+=ue;lr>0;ae[I+_r]=tr&255,_r+=yr,tr/=256,lr-=8);ae[I+_r-yr]|=wr*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(ae){const e=base64Js,I=ieee754,oe=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;ae.Buffer=dr,ae.SlowBuffer=Lr,ae.INSPECT_MAX_BYTES=50;const ue=2147483647;ae.kMaxLength=ue;const{Uint8Array:bt,ArrayBuffer:tr,SharedArrayBuffer:rr}=globalThis;dr.TYPED_ARRAY_SUPPORT=ir(),!dr.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function ir(){try{const br=new bt(1),mr={foo:function(){return 42}};return Object.setPrototypeOf(mr,bt.prototype),Object.setPrototypeOf(br,mr),br.foo()===42}catch{return!1}}Object.defineProperty(dr.prototype,"parent",{enumerable:!0,get:function(){if(dr.isBuffer(this))return this.buffer}}),Object.defineProperty(dr.prototype,"offset",{enumerable:!0,get:function(){if(dr.isBuffer(this))return this.byteOffset}});function lr(br){if(br>ue)throw new RangeError('The value "'+br+'" is invalid for option "size"');const mr=new bt(br);return Object.setPrototypeOf(mr,dr.prototype),mr}function dr(br,mr,fr){if(typeof br=="number"){if(typeof mr=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return yr(br)}return pr(br,mr,fr)}dr.poolSize=8192;function pr(br,mr,fr){if(typeof br=="string")return wr(br,mr);if(tr.isView(br))return Ar(br);if(br==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof br);if(Ns(br,tr)||br&&Ns(br.buffer,tr)||typeof rr<"u"&&(Ns(br,rr)||br&&Ns(br.buffer,rr)))return Sr(br,mr,fr);if(typeof br=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const gr=br.valueOf&&br.valueOf();if(gr!=null&&gr!==br)return dr.from(gr,mr,fr);const xr=Mr(br);if(xr)return xr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof br[Symbol.toPrimitive]=="function")return dr.from(br[Symbol.toPrimitive]("string"),mr,fr);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof br)}dr.from=function(br,mr,fr){return pr(br,mr,fr)},Object.setPrototypeOf(dr.prototype,bt.prototype),Object.setPrototypeOf(dr,bt);function hr(br){if(typeof br!="number")throw new TypeError('"size" argument must be of type number');if(br<0)throw new RangeError('The value "'+br+'" is invalid for option "size"')}function _r(br,mr,fr){return hr(br),br<=0?lr(br):mr!==void 0?typeof fr=="string"?lr(br).fill(mr,fr):lr(br).fill(mr):lr(br)}dr.alloc=function(br,mr,fr){return _r(br,mr,fr)};function yr(br){return hr(br),lr(br<0?0:vr(br)|0)}dr.allocUnsafe=function(br){return yr(br)},dr.allocUnsafeSlow=function(br){return yr(br)};function wr(br,mr){if((typeof mr!="string"||mr==="")&&(mr="utf8"),!dr.isEncoding(mr))throw new TypeError("Unknown encoding: "+mr);const fr=es(br,mr)|0;let gr=lr(fr);const xr=gr.write(br,mr);return xr!==fr&&(gr=gr.slice(0,xr)),gr}function Tr(br){const mr=br.length<0?0:vr(br.length)|0,fr=lr(mr);for(let gr=0;gr<mr;gr+=1)fr[gr]=br[gr]&255;return fr}function Ar(br){if(Ns(br,bt)){const mr=new bt(br);return Sr(mr.buffer,mr.byteOffset,mr.byteLength)}return Tr(br)}function Sr(br,mr,fr){if(mr<0||br.byteLength<mr)throw new RangeError('"offset" is outside of buffer bounds');if(br.byteLength<mr+(fr||0))throw new RangeError('"length" is outside of buffer bounds');let gr;return mr===void 0&&fr===void 0?gr=new bt(br):fr===void 0?gr=new bt(br,mr):gr=new bt(br,mr,fr),Object.setPrototypeOf(gr,dr.prototype),gr}function Mr(br){if(dr.isBuffer(br)){const mr=vr(br.length)|0,fr=lr(mr);return fr.length===0||br.copy(fr,0,0,mr),fr}if(br.length!==void 0)return typeof br.length!="number"||Os(br.length)?lr(0):Tr(br);if(br.type==="Buffer"&&Array.isArray(br.data))return Tr(br.data)}function vr(br){if(br>=ue)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ue.toString(16)+" bytes");return br|0}function Lr(br){return+br!=br&&(br=0),dr.alloc(+br)}dr.isBuffer=function(mr){return mr!=null&&mr._isBuffer===!0&&mr!==dr.prototype},dr.compare=function(mr,fr){if(Ns(mr,bt)&&(mr=dr.from(mr,mr.offset,mr.byteLength)),Ns(fr,bt)&&(fr=dr.from(fr,fr.offset,fr.byteLength)),!dr.isBuffer(mr)||!dr.isBuffer(fr))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(mr===fr)return 0;let gr=mr.length,xr=fr.length;for(let Rr=0,Fr=Math.min(gr,xr);Rr<Fr;++Rr)if(mr[Rr]!==fr[Rr]){gr=mr[Rr],xr=fr[Rr];break}return gr<xr?-1:xr<gr?1:0},dr.isEncoding=function(mr){switch(String(mr).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},dr.concat=function(mr,fr){if(!Array.isArray(mr))throw new TypeError('"list" argument must be an Array of Buffers');if(mr.length===0)return dr.alloc(0);let gr;if(fr===void 0)for(fr=0,gr=0;gr<mr.length;++gr)fr+=mr[gr].length;const xr=dr.allocUnsafe(fr);let Rr=0;for(gr=0;gr<mr.length;++gr){let Fr=mr[gr];if(Ns(Fr,bt))Rr+Fr.length>xr.length?(dr.isBuffer(Fr)||(Fr=dr.from(Fr)),Fr.copy(xr,Rr)):bt.prototype.set.call(xr,Fr,Rr);else if(dr.isBuffer(Fr))Fr.copy(xr,Rr);else throw new TypeError('"list" argument must be an Array of Buffers');Rr+=Fr.length}return xr};function es(br,mr){if(dr.isBuffer(br))return br.length;if(tr.isView(br)||Ns(br,tr))return br.byteLength;if(typeof br!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof br);const fr=br.length,gr=arguments.length>2&&arguments[2]===!0;if(!gr&&fr===0)return 0;let xr=!1;for(;;)switch(mr){case"ascii":case"latin1":case"binary":return fr;case"utf8":case"utf-8":return Fs(br).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fr*2;case"hex":return fr>>>1;case"base64":return Bs(br).length;default:if(xr)return gr?-1:Fs(br).length;mr=(""+mr).toLowerCase(),xr=!0}}dr.byteLength=es;function ss(br,mr,fr){let gr=!1;if((mr===void 0||mr<0)&&(mr=0),mr>this.length||((fr===void 0||fr>this.length)&&(fr=this.length),fr<=0)||(fr>>>=0,mr>>>=0,fr<=mr))return"";for(br||(br="utf8");;)switch(br){case"hex":return as(this,mr,fr);case"utf8":case"utf-8":return kr(this,mr,fr);case"ascii":return cs(this,mr,fr);case"latin1":case"binary":return _s(this,mr,fr);case"base64":return Ur(this,mr,fr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gs(this,mr,fr);default:if(gr)throw new TypeError("Unknown encoding: "+br);br=(br+"").toLowerCase(),gr=!0}}dr.prototype._isBuffer=!0;function os(br,mr,fr){const gr=br[mr];br[mr]=br[fr],br[fr]=gr}dr.prototype.swap16=function(){const mr=this.length;if(mr%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let fr=0;fr<mr;fr+=2)os(this,fr,fr+1);return this},dr.prototype.swap32=function(){const mr=this.length;if(mr%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let fr=0;fr<mr;fr+=4)os(this,fr,fr+3),os(this,fr+1,fr+2);return this},dr.prototype.swap64=function(){const mr=this.length;if(mr%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let fr=0;fr<mr;fr+=8)os(this,fr,fr+7),os(this,fr+1,fr+6),os(this,fr+2,fr+5),os(this,fr+3,fr+4);return this},dr.prototype.toString=function(){const mr=this.length;return mr===0?"":arguments.length===0?kr(this,0,mr):ss.apply(this,arguments)},dr.prototype.toLocaleString=dr.prototype.toString,dr.prototype.equals=function(mr){if(!dr.isBuffer(mr))throw new TypeError("Argument must be a Buffer");return this===mr?!0:dr.compare(this,mr)===0},dr.prototype.inspect=function(){let mr="";const fr=ae.INSPECT_MAX_BYTES;return mr=this.toString("hex",0,fr).replace(/(.{2})/g,"$1 ").trim(),this.length>fr&&(mr+=" ... "),"<Buffer "+mr+">"},oe&&(dr.prototype[oe]=dr.prototype.inspect),dr.prototype.compare=function(mr,fr,gr,xr,Rr){if(Ns(mr,bt)&&(mr=dr.from(mr,mr.offset,mr.byteLength)),!dr.isBuffer(mr))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof mr);if(fr===void 0&&(fr=0),gr===void 0&&(gr=mr?mr.length:0),xr===void 0&&(xr=0),Rr===void 0&&(Rr=this.length),fr<0||gr>mr.length||xr<0||Rr>this.length)throw new RangeError("out of range index");if(xr>=Rr&&fr>=gr)return 0;if(xr>=Rr)return-1;if(fr>=gr)return 1;if(fr>>>=0,gr>>>=0,xr>>>=0,Rr>>>=0,this===mr)return 0;let Fr=Rr-xr,ds=gr-fr;const ls=Math.min(Fr,ds),Jr=this.slice(xr,Rr),rs=mr.slice(fr,gr);for(let ts=0;ts<ls;++ts)if(Jr[ts]!==rs[ts]){Fr=Jr[ts],ds=rs[ts];break}return Fr<ds?-1:ds<Fr?1:0};function $r(br,mr,fr,gr,xr){if(br.length===0)return-1;if(typeof fr=="string"?(gr=fr,fr=0):fr>2147483647?fr=2147483647:fr<-2147483648&&(fr=-2147483648),fr=+fr,Os(fr)&&(fr=xr?0:br.length-1),fr<0&&(fr=br.length+fr),fr>=br.length){if(xr)return-1;fr=br.length-1}else if(fr<0)if(xr)fr=0;else return-1;if(typeof mr=="string"&&(mr=dr.from(mr,gr)),dr.isBuffer(mr))return mr.length===0?-1:ns(br,mr,fr,gr,xr);if(typeof mr=="number")return mr=mr&255,typeof bt.prototype.indexOf=="function"?xr?bt.prototype.indexOf.call(br,mr,fr):bt.prototype.lastIndexOf.call(br,mr,fr):ns(br,[mr],fr,gr,xr);throw new TypeError("val must be string, number or Buffer")}function ns(br,mr,fr,gr,xr){let Rr=1,Fr=br.length,ds=mr.length;if(gr!==void 0&&(gr=String(gr).toLowerCase(),gr==="ucs2"||gr==="ucs-2"||gr==="utf16le"||gr==="utf-16le")){if(br.length<2||mr.length<2)return-1;Rr=2,Fr/=2,ds/=2,fr/=2}function ls(rs,ts){return Rr===1?rs[ts]:rs.readUInt16BE(ts*Rr)}let Jr;if(xr){let rs=-1;for(Jr=fr;Jr<Fr;Jr++)if(ls(br,Jr)===ls(mr,rs===-1?0:Jr-rs)){if(rs===-1&&(rs=Jr),Jr-rs+1===ds)return rs*Rr}else rs!==-1&&(Jr-=Jr-rs),rs=-1}else for(fr+ds>Fr&&(fr=Fr-ds),Jr=fr;Jr>=0;Jr--){let rs=!0;for(let ts=0;ts<ds;ts++)if(ls(br,Jr+ts)!==ls(mr,ts)){rs=!1;break}if(rs)return Jr}return-1}dr.prototype.includes=function(mr,fr,gr){return this.indexOf(mr,fr,gr)!==-1},dr.prototype.indexOf=function(mr,fr,gr){return $r(this,mr,fr,gr,!0)},dr.prototype.lastIndexOf=function(mr,fr,gr){return $r(this,mr,fr,gr,!1)};function Nr(br,mr,fr,gr){fr=Number(fr)||0;const xr=br.length-fr;gr?(gr=Number(gr),gr>xr&&(gr=xr)):gr=xr;const Rr=mr.length;gr>Rr/2&&(gr=Rr/2);let Fr;for(Fr=0;Fr<gr;++Fr){const ds=parseInt(mr.substr(Fr*2,2),16);if(Os(ds))return Fr;br[fr+Fr]=ds}return Fr}function zr(br,mr,fr,gr){return qs(Fs(mr,br.length-fr),br,fr,gr)}function Ir(br,mr,fr,gr){return qs(Ls(mr),br,fr,gr)}function Or(br,mr,fr,gr){return qs(Bs(mr),br,fr,gr)}function Dr(br,mr,fr,gr){return qs(zs(mr,br.length-fr),br,fr,gr)}dr.prototype.write=function(mr,fr,gr,xr){if(fr===void 0)xr="utf8",gr=this.length,fr=0;else if(gr===void 0&&typeof fr=="string")xr=fr,gr=this.length,fr=0;else if(isFinite(fr))fr=fr>>>0,isFinite(gr)?(gr=gr>>>0,xr===void 0&&(xr="utf8")):(xr=gr,gr=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Rr=this.length-fr;if((gr===void 0||gr>Rr)&&(gr=Rr),mr.length>0&&(gr<0||fr<0)||fr>this.length)throw new RangeError("Attempt to write outside buffer bounds");xr||(xr="utf8");let Fr=!1;for(;;)switch(xr){case"hex":return Nr(this,mr,fr,gr);case"utf8":case"utf-8":return zr(this,mr,fr,gr);case"ascii":case"latin1":case"binary":return Ir(this,mr,fr,gr);case"base64":return Or(this,mr,fr,gr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Dr(this,mr,fr,gr);default:if(Fr)throw new TypeError("Unknown encoding: "+xr);xr=(""+xr).toLowerCase(),Fr=!0}},dr.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ur(br,mr,fr){return mr===0&&fr===br.length?e.fromByteArray(br):e.fromByteArray(br.slice(mr,fr))}function kr(br,mr,fr){fr=Math.min(br.length,fr);const gr=[];let xr=mr;for(;xr<fr;){const Rr=br[xr];let Fr=null,ds=Rr>239?4:Rr>223?3:Rr>191?2:1;if(xr+ds<=fr){let ls,Jr,rs,ts;switch(ds){case 1:Rr<128&&(Fr=Rr);break;case 2:ls=br[xr+1],(ls&192)===128&&(ts=(Rr&31)<<6|ls&63,ts>127&&(Fr=ts));break;case 3:ls=br[xr+1],Jr=br[xr+2],(ls&192)===128&&(Jr&192)===128&&(ts=(Rr&15)<<12|(ls&63)<<6|Jr&63,ts>2047&&(ts<55296||ts>57343)&&(Fr=ts));break;case 4:ls=br[xr+1],Jr=br[xr+2],rs=br[xr+3],(ls&192)===128&&(Jr&192)===128&&(rs&192)===128&&(ts=(Rr&15)<<18|(ls&63)<<12|(Jr&63)<<6|rs&63,ts>65535&&ts<1114112&&(Fr=ts))}}Fr===null?(Fr=65533,ds=1):Fr>65535&&(Fr-=65536,gr.push(Fr>>>10&1023|55296),Fr=56320|Fr&1023),gr.push(Fr),xr+=ds}return is(gr)}const Qr=4096;function is(br){const mr=br.length;if(mr<=Qr)return String.fromCharCode.apply(String,br);let fr="",gr=0;for(;gr<mr;)fr+=String.fromCharCode.apply(String,br.slice(gr,gr+=Qr));return fr}function cs(br,mr,fr){let gr="";fr=Math.min(br.length,fr);for(let xr=mr;xr<fr;++xr)gr+=String.fromCharCode(br[xr]&127);return gr}function _s(br,mr,fr){let gr="";fr=Math.min(br.length,fr);for(let xr=mr;xr<fr;++xr)gr+=String.fromCharCode(br[xr]);return gr}function as(br,mr,fr){const gr=br.length;(!mr||mr<0)&&(mr=0),(!fr||fr<0||fr>gr)&&(fr=gr);let xr="";for(let Rr=mr;Rr<fr;++Rr)xr+=js[br[Rr]];return xr}function gs(br,mr,fr){const gr=br.slice(mr,fr);let xr="";for(let Rr=0;Rr<gr.length-1;Rr+=2)xr+=String.fromCharCode(gr[Rr]+gr[Rr+1]*256);return xr}dr.prototype.slice=function(mr,fr){const gr=this.length;mr=~~mr,fr=fr===void 0?gr:~~fr,mr<0?(mr+=gr,mr<0&&(mr=0)):mr>gr&&(mr=gr),fr<0?(fr+=gr,fr<0&&(fr=0)):fr>gr&&(fr=gr),fr<mr&&(fr=mr);const xr=this.subarray(mr,fr);return Object.setPrototypeOf(xr,dr.prototype),xr};function hs(br,mr,fr){if(br%1!==0||br<0)throw new RangeError("offset is not uint");if(br+mr>fr)throw new RangeError("Trying to access beyond buffer length")}dr.prototype.readUintLE=dr.prototype.readUIntLE=function(mr,fr,gr){mr=mr>>>0,fr=fr>>>0,gr||hs(mr,fr,this.length);let xr=this[mr],Rr=1,Fr=0;for(;++Fr<fr&&(Rr*=256);)xr+=this[mr+Fr]*Rr;return xr},dr.prototype.readUintBE=dr.prototype.readUIntBE=function(mr,fr,gr){mr=mr>>>0,fr=fr>>>0,gr||hs(mr,fr,this.length);let xr=this[mr+--fr],Rr=1;for(;fr>0&&(Rr*=256);)xr+=this[mr+--fr]*Rr;return xr},dr.prototype.readUint8=dr.prototype.readUInt8=function(mr,fr){return mr=mr>>>0,fr||hs(mr,1,this.length),this[mr]},dr.prototype.readUint16LE=dr.prototype.readUInt16LE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,2,this.length),this[mr]|this[mr+1]<<8},dr.prototype.readUint16BE=dr.prototype.readUInt16BE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,2,this.length),this[mr]<<8|this[mr+1]},dr.prototype.readUint32LE=dr.prototype.readUInt32LE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,4,this.length),(this[mr]|this[mr+1]<<8|this[mr+2]<<16)+this[mr+3]*16777216},dr.prototype.readUint32BE=dr.prototype.readUInt32BE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,4,this.length),this[mr]*16777216+(this[mr+1]<<16|this[mr+2]<<8|this[mr+3])},dr.prototype.readBigUInt64LE=Ps(function(mr){mr=mr>>>0,Is(mr,"offset");const fr=this[mr],gr=this[mr+7];(fr===void 0||gr===void 0)&&Ds(mr,this.length-8);const xr=fr+this[++mr]*2**8+this[++mr]*2**16+this[++mr]*2**24,Rr=this[++mr]+this[++mr]*2**8+this[++mr]*2**16+gr*2**24;return BigInt(xr)+(BigInt(Rr)<<BigInt(32))}),dr.prototype.readBigUInt64BE=Ps(function(mr){mr=mr>>>0,Is(mr,"offset");const fr=this[mr],gr=this[mr+7];(fr===void 0||gr===void 0)&&Ds(mr,this.length-8);const xr=fr*2**24+this[++mr]*2**16+this[++mr]*2**8+this[++mr],Rr=this[++mr]*2**24+this[++mr]*2**16+this[++mr]*2**8+gr;return(BigInt(xr)<<BigInt(32))+BigInt(Rr)}),dr.prototype.readIntLE=function(mr,fr,gr){mr=mr>>>0,fr=fr>>>0,gr||hs(mr,fr,this.length);let xr=this[mr],Rr=1,Fr=0;for(;++Fr<fr&&(Rr*=256);)xr+=this[mr+Fr]*Rr;return Rr*=128,xr>=Rr&&(xr-=Math.pow(2,8*fr)),xr},dr.prototype.readIntBE=function(mr,fr,gr){mr=mr>>>0,fr=fr>>>0,gr||hs(mr,fr,this.length);let xr=fr,Rr=1,Fr=this[mr+--xr];for(;xr>0&&(Rr*=256);)Fr+=this[mr+--xr]*Rr;return Rr*=128,Fr>=Rr&&(Fr-=Math.pow(2,8*fr)),Fr},dr.prototype.readInt8=function(mr,fr){return mr=mr>>>0,fr||hs(mr,1,this.length),this[mr]&128?(255-this[mr]+1)*-1:this[mr]},dr.prototype.readInt16LE=function(mr,fr){mr=mr>>>0,fr||hs(mr,2,this.length);const gr=this[mr]|this[mr+1]<<8;return gr&32768?gr|4294901760:gr},dr.prototype.readInt16BE=function(mr,fr){mr=mr>>>0,fr||hs(mr,2,this.length);const gr=this[mr+1]|this[mr]<<8;return gr&32768?gr|4294901760:gr},dr.prototype.readInt32LE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,4,this.length),this[mr]|this[mr+1]<<8|this[mr+2]<<16|this[mr+3]<<24},dr.prototype.readInt32BE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,4,this.length),this[mr]<<24|this[mr+1]<<16|this[mr+2]<<8|this[mr+3]},dr.prototype.readBigInt64LE=Ps(function(mr){mr=mr>>>0,Is(mr,"offset");const fr=this[mr],gr=this[mr+7];(fr===void 0||gr===void 0)&&Ds(mr,this.length-8);const xr=this[mr+4]+this[mr+5]*2**8+this[mr+6]*2**16+(gr<<24);return(BigInt(xr)<<BigInt(32))+BigInt(fr+this[++mr]*2**8+this[++mr]*2**16+this[++mr]*2**24)}),dr.prototype.readBigInt64BE=Ps(function(mr){mr=mr>>>0,Is(mr,"offset");const fr=this[mr],gr=this[mr+7];(fr===void 0||gr===void 0)&&Ds(mr,this.length-8);const xr=(fr<<24)+this[++mr]*2**16+this[++mr]*2**8+this[++mr];return(BigInt(xr)<<BigInt(32))+BigInt(this[++mr]*2**24+this[++mr]*2**16+this[++mr]*2**8+gr)}),dr.prototype.readFloatLE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,4,this.length),I.read(this,mr,!0,23,4)},dr.prototype.readFloatBE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,4,this.length),I.read(this,mr,!1,23,4)},dr.prototype.readDoubleLE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,8,this.length),I.read(this,mr,!0,52,8)},dr.prototype.readDoubleBE=function(mr,fr){return mr=mr>>>0,fr||hs(mr,8,this.length),I.read(this,mr,!1,52,8)};function ps(br,mr,fr,gr,xr,Rr){if(!dr.isBuffer(br))throw new TypeError('"buffer" argument must be a Buffer instance');if(mr>xr||mr<Rr)throw new RangeError('"value" argument is out of bounds');if(fr+gr>br.length)throw new RangeError("Index out of range")}dr.prototype.writeUintLE=dr.prototype.writeUIntLE=function(mr,fr,gr,xr){if(mr=+mr,fr=fr>>>0,gr=gr>>>0,!xr){const ds=Math.pow(2,8*gr)-1;ps(this,mr,fr,gr,ds,0)}let Rr=1,Fr=0;for(this[fr]=mr&255;++Fr<gr&&(Rr*=256);)this[fr+Fr]=mr/Rr&255;return fr+gr},dr.prototype.writeUintBE=dr.prototype.writeUIntBE=function(mr,fr,gr,xr){if(mr=+mr,fr=fr>>>0,gr=gr>>>0,!xr){const ds=Math.pow(2,8*gr)-1;ps(this,mr,fr,gr,ds,0)}let Rr=gr-1,Fr=1;for(this[fr+Rr]=mr&255;--Rr>=0&&(Fr*=256);)this[fr+Rr]=mr/Fr&255;return fr+gr},dr.prototype.writeUint8=dr.prototype.writeUInt8=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,1,255,0),this[fr]=mr&255,fr+1},dr.prototype.writeUint16LE=dr.prototype.writeUInt16LE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,2,65535,0),this[fr]=mr&255,this[fr+1]=mr>>>8,fr+2},dr.prototype.writeUint16BE=dr.prototype.writeUInt16BE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,2,65535,0),this[fr]=mr>>>8,this[fr+1]=mr&255,fr+2},dr.prototype.writeUint32LE=dr.prototype.writeUInt32LE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,4,4294967295,0),this[fr+3]=mr>>>24,this[fr+2]=mr>>>16,this[fr+1]=mr>>>8,this[fr]=mr&255,fr+4},dr.prototype.writeUint32BE=dr.prototype.writeUInt32BE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,4,4294967295,0),this[fr]=mr>>>24,this[fr+1]=mr>>>16,this[fr+2]=mr>>>8,this[fr+3]=mr&255,fr+4};function Ms(br,mr,fr,gr,xr){$s(mr,gr,xr,br,fr,7);let Rr=Number(mr&BigInt(4294967295));br[fr++]=Rr,Rr=Rr>>8,br[fr++]=Rr,Rr=Rr>>8,br[fr++]=Rr,Rr=Rr>>8,br[fr++]=Rr;let Fr=Number(mr>>BigInt(32)&BigInt(4294967295));return br[fr++]=Fr,Fr=Fr>>8,br[fr++]=Fr,Fr=Fr>>8,br[fr++]=Fr,Fr=Fr>>8,br[fr++]=Fr,fr}function bs(br,mr,fr,gr,xr){$s(mr,gr,xr,br,fr,7);let Rr=Number(mr&BigInt(4294967295));br[fr+7]=Rr,Rr=Rr>>8,br[fr+6]=Rr,Rr=Rr>>8,br[fr+5]=Rr,Rr=Rr>>8,br[fr+4]=Rr;let Fr=Number(mr>>BigInt(32)&BigInt(4294967295));return br[fr+3]=Fr,Fr=Fr>>8,br[fr+2]=Fr,Fr=Fr>>8,br[fr+1]=Fr,Fr=Fr>>8,br[fr]=Fr,fr+8}dr.prototype.writeBigUInt64LE=Ps(function(mr,fr=0){return Ms(this,mr,fr,BigInt(0),BigInt("0xffffffffffffffff"))}),dr.prototype.writeBigUInt64BE=Ps(function(mr,fr=0){return bs(this,mr,fr,BigInt(0),BigInt("0xffffffffffffffff"))}),dr.prototype.writeIntLE=function(mr,fr,gr,xr){if(mr=+mr,fr=fr>>>0,!xr){const ls=Math.pow(2,8*gr-1);ps(this,mr,fr,gr,ls-1,-ls)}let Rr=0,Fr=1,ds=0;for(this[fr]=mr&255;++Rr<gr&&(Fr*=256);)mr<0&&ds===0&&this[fr+Rr-1]!==0&&(ds=1),this[fr+Rr]=(mr/Fr>>0)-ds&255;return fr+gr},dr.prototype.writeIntBE=function(mr,fr,gr,xr){if(mr=+mr,fr=fr>>>0,!xr){const ls=Math.pow(2,8*gr-1);ps(this,mr,fr,gr,ls-1,-ls)}let Rr=gr-1,Fr=1,ds=0;for(this[fr+Rr]=mr&255;--Rr>=0&&(Fr*=256);)mr<0&&ds===0&&this[fr+Rr+1]!==0&&(ds=1),this[fr+Rr]=(mr/Fr>>0)-ds&255;return fr+gr},dr.prototype.writeInt8=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,1,127,-128),mr<0&&(mr=255+mr+1),this[fr]=mr&255,fr+1},dr.prototype.writeInt16LE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,2,32767,-32768),this[fr]=mr&255,this[fr+1]=mr>>>8,fr+2},dr.prototype.writeInt16BE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,2,32767,-32768),this[fr]=mr>>>8,this[fr+1]=mr&255,fr+2},dr.prototype.writeInt32LE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,4,2147483647,-2147483648),this[fr]=mr&255,this[fr+1]=mr>>>8,this[fr+2]=mr>>>16,this[fr+3]=mr>>>24,fr+4},dr.prototype.writeInt32BE=function(mr,fr,gr){return mr=+mr,fr=fr>>>0,gr||ps(this,mr,fr,4,2147483647,-2147483648),mr<0&&(mr=4294967295+mr+1),this[fr]=mr>>>24,this[fr+1]=mr>>>16,this[fr+2]=mr>>>8,this[fr+3]=mr&255,fr+4},dr.prototype.writeBigInt64LE=Ps(function(mr,fr=0){return Ms(this,mr,fr,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),dr.prototype.writeBigInt64BE=Ps(function(mr,fr=0){return bs(this,mr,fr,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ts(br,mr,fr,gr,xr,Rr){if(fr+gr>br.length)throw new RangeError("Index out of range");if(fr<0)throw new RangeError("Index out of range")}function Cs(br,mr,fr,gr,xr){return mr=+mr,fr=fr>>>0,xr||Ts(br,mr,fr,4),I.write(br,mr,fr,gr,23,4),fr+4}dr.prototype.writeFloatLE=function(mr,fr,gr){return Cs(this,mr,fr,!0,gr)},dr.prototype.writeFloatBE=function(mr,fr,gr){return Cs(this,mr,fr,!1,gr)};function Es(br,mr,fr,gr,xr){return mr=+mr,fr=fr>>>0,xr||Ts(br,mr,fr,8),I.write(br,mr,fr,gr,52,8),fr+8}dr.prototype.writeDoubleLE=function(mr,fr,gr){return Es(this,mr,fr,!0,gr)},dr.prototype.writeDoubleBE=function(mr,fr,gr){return Es(this,mr,fr,!1,gr)},dr.prototype.copy=function(mr,fr,gr,xr){if(!dr.isBuffer(mr))throw new TypeError("argument should be a Buffer");if(gr||(gr=0),!xr&&xr!==0&&(xr=this.length),fr>=mr.length&&(fr=mr.length),fr||(fr=0),xr>0&&xr<gr&&(xr=gr),xr===gr||mr.length===0||this.length===0)return 0;if(fr<0)throw new RangeError("targetStart out of bounds");if(gr<0||gr>=this.length)throw new RangeError("Index out of range");if(xr<0)throw new RangeError("sourceEnd out of bounds");xr>this.length&&(xr=this.length),mr.length-fr<xr-gr&&(xr=mr.length-fr+gr);const Rr=xr-gr;return this===mr&&typeof bt.prototype.copyWithin=="function"?this.copyWithin(fr,gr,xr):bt.prototype.set.call(mr,this.subarray(gr,xr),fr),Rr},dr.prototype.fill=function(mr,fr,gr,xr){if(typeof mr=="string"){if(typeof fr=="string"?(xr=fr,fr=0,gr=this.length):typeof gr=="string"&&(xr=gr,gr=this.length),xr!==void 0&&typeof xr!="string")throw new TypeError("encoding must be a string");if(typeof xr=="string"&&!dr.isEncoding(xr))throw new TypeError("Unknown encoding: "+xr);if(mr.length===1){const Fr=mr.charCodeAt(0);(xr==="utf8"&&Fr<128||xr==="latin1")&&(mr=Fr)}}else typeof mr=="number"?mr=mr&255:typeof mr=="boolean"&&(mr=Number(mr));if(fr<0||this.length<fr||this.length<gr)throw new RangeError("Out of range index");if(gr<=fr)return this;fr=fr>>>0,gr=gr===void 0?this.length:gr>>>0,mr||(mr=0);let Rr;if(typeof mr=="number")for(Rr=fr;Rr<gr;++Rr)this[Rr]=mr;else{const Fr=dr.isBuffer(mr)?mr:dr.from(mr,xr),ds=Fr.length;if(ds===0)throw new TypeError('The value "'+mr+'" is invalid for argument "value"');for(Rr=0;Rr<gr-fr;++Rr)this[Rr+fr]=Fr[Rr%ds]}return this};const xs={};function As(br,mr,fr){xs[br]=class extends fr{constructor(){super(),Object.defineProperty(this,"message",{value:mr.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${br}]`,this.stack,delete this.name}get code(){return br}set code(xr){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:xr,writable:!0})}toString(){return`${this.name} [${br}]: ${this.message}`}}}As("ERR_BUFFER_OUT_OF_BOUNDS",function(br){return br?`${br} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),As("ERR_INVALID_ARG_TYPE",function(br,mr){return`The "${br}" argument must be of type number. Received type ${typeof mr}`},TypeError),As("ERR_OUT_OF_RANGE",function(br,mr,fr){let gr=`The value of "${br}" is out of range.`,xr=fr;return Number.isInteger(fr)&&Math.abs(fr)>2**32?xr=Rs(String(fr)):typeof fr=="bigint"&&(xr=String(fr),(fr>BigInt(2)**BigInt(32)||fr<-(BigInt(2)**BigInt(32)))&&(xr=Rs(xr)),xr+="n"),gr+=` It must be ${mr}. Received ${xr}`,gr},RangeError);function Rs(br){let mr="",fr=br.length;const gr=br[0]==="-"?1:0;for(;fr>=gr+4;fr-=3)mr=`_${br.slice(fr-3,fr)}${mr}`;return`${br.slice(0,fr)}${mr}`}function Qs(br,mr,fr){Is(mr,"offset"),(br[mr]===void 0||br[mr+fr]===void 0)&&Ds(mr,br.length-(fr+1))}function $s(br,mr,fr,gr,xr,Rr){if(br>fr||br<mr){const Fr=typeof mr=="bigint"?"n":"";let ds;throw mr===0||mr===BigInt(0)?ds=`>= 0${Fr} and < 2${Fr} ** ${(Rr+1)*8}${Fr}`:ds=`>= -(2${Fr} ** ${(Rr+1)*8-1}${Fr}) and < 2 ** ${(Rr+1)*8-1}${Fr}`,new xs.ERR_OUT_OF_RANGE("value",ds,br)}Qs(gr,xr,Rr)}function Is(br,mr){if(typeof br!="number")throw new xs.ERR_INVALID_ARG_TYPE(mr,"number",br)}function Ds(br,mr,fr){throw Math.floor(br)!==br?(Is(br,fr),new xs.ERR_OUT_OF_RANGE("offset","an integer",br)):mr<0?new xs.ERR_BUFFER_OUT_OF_BOUNDS:new xs.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${mr}`,br)}const Us=/[^+/0-9A-Za-z-_]/g;function ks(br){if(br=br.split("=")[0],br=br.trim().replace(Us,""),br.length<2)return"";for(;br.length%4!==0;)br=br+"=";return br}function Fs(br,mr){mr=mr||1/0;let fr;const gr=br.length;let xr=null;const Rr=[];for(let Fr=0;Fr<gr;++Fr){if(fr=br.charCodeAt(Fr),fr>55295&&fr<57344){if(!xr){if(fr>56319){(mr-=3)>-1&&Rr.push(239,191,189);continue}else if(Fr+1===gr){(mr-=3)>-1&&Rr.push(239,191,189);continue}xr=fr;continue}if(fr<56320){(mr-=3)>-1&&Rr.push(239,191,189),xr=fr;continue}fr=(xr-55296<<10|fr-56320)+65536}else xr&&(mr-=3)>-1&&Rr.push(239,191,189);if(xr=null,fr<128){if((mr-=1)<0)break;Rr.push(fr)}else if(fr<2048){if((mr-=2)<0)break;Rr.push(fr>>6|192,fr&63|128)}else if(fr<65536){if((mr-=3)<0)break;Rr.push(fr>>12|224,fr>>6&63|128,fr&63|128)}else if(fr<1114112){if((mr-=4)<0)break;Rr.push(fr>>18|240,fr>>12&63|128,fr>>6&63|128,fr&63|128)}else throw new Error("Invalid code point")}return Rr}function Ls(br){const mr=[];for(let fr=0;fr<br.length;++fr)mr.push(br.charCodeAt(fr)&255);return mr}function zs(br,mr){let fr,gr,xr;const Rr=[];for(let Fr=0;Fr<br.length&&!((mr-=2)<0);++Fr)fr=br.charCodeAt(Fr),gr=fr>>8,xr=fr%256,Rr.push(xr),Rr.push(gr);return Rr}function Bs(br){return e.toByteArray(ks(br))}function qs(br,mr,fr,gr){let xr;for(xr=0;xr<gr&&!(xr+fr>=mr.length||xr>=br.length);++xr)mr[xr+fr]=br[xr];return xr}function Ns(br,mr){return br instanceof mr||br!=null&&br.constructor!=null&&br.constructor.name!=null&&br.constructor.name===mr.name}function Os(br){return br!==br}const js=function(){const br="0123456789abcdef",mr=new Array(256);for(let fr=0;fr<16;++fr){const gr=fr*16;for(let xr=0;xr<16;++xr)mr[gr+xr]=br[fr]+br[xr]}return mr}();function Ps(br){return typeof BigInt>"u"?Vs:br}function Vs(){throw new Error("BigInt not supported")}})(buffer);const Buffer$7=buffer.Buffer,Blob$1=buffer.Blob,BlobOptions=buffer.BlobOptions,Buffer$1$1=buffer.Buffer,File$1=buffer.File,FileOptions=buffer.FileOptions,INSPECT_MAX_BYTES=buffer.INSPECT_MAX_BYTES,SlowBuffer=buffer.SlowBuffer,TranscodeEncoding=buffer.TranscodeEncoding,atob=buffer.atob,btoa=buffer.btoa,constants=buffer.constants,isAscii=buffer.isAscii,isUtf8=buffer.isUtf8,kMaxLength=buffer.kMaxLength,kStringMaxLength=buffer.kStringMaxLength,resolveObjectURL=buffer.resolveObjectURL,transcode=buffer.transcode;var dist=Object.freeze({__proto__:null,Blob:Blob$1,BlobOptions,Buffer:Buffer$1$1,File:File$1,FileOptions,INSPECT_MAX_BYTES,SlowBuffer,TranscodeEncoding,atob,btoa,constants,default:Buffer$7,isAscii,isUtf8,kMaxLength,kStringMaxLength,resolveObjectURL,transcode});class PlatformTools{static getGlobalVariable(){return typeof window<"u"?window:global$1}static load(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: require("${e}").`);return""}static pathNormalize(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.normalize("${e}").`);return""}static pathExtname(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.extname("${e}").`);return""}static pathResolve(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.resolve("${e}").`);return""}static fileExist(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.existsSync("${e}").`);return!1}static dotenv(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "${e}" }).`)}static getEnvVariable(e){}static readFileSync(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("${e}").`);return null}static appendFileSync(e,I){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("${e}").`)}static writeFile(e,I){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.writeFile("${e}").`);return Promise.reject(null)}static highlightSql(e){return e}static highlightJson(e){return e}static logInfo(e,I){console.info(e+" ",I)}static logError(e,I){console.error(e+" ",I)}static logWarn(e,I){console.warn(e+" ",I)}static log(e){console.log(e)}static warn(e){return e}}PlatformTools.type="browser";typeof window<"u"&&(window.Buffer=Buffer$1$1);typeof global$1<"u"&&typeof require<"u"&&(global$1.Buffer=require("buffer/").Buffer);class ObjectUtils{static isObject(e){return e!==null&&typeof e=="object"}static isObjectWithName(e){return e!==null&&typeof e=="object"&&e.name!==void 0}static assign(e,...I){for(const oe of I)for(const ue of Object.getOwnPropertyNames(oe))e[ue]=oe[ue]}static mixedListToArray(e){return e!==null&&typeof e=="object"?Object.keys(e).map(I=>e[I]):e}}class TypeORMError extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}class SubjectWithoutIdentifierError extends TypeORMError{constructor(e){super(`Internal error. Subject ${e.metadata.targetName} must have an identifier to perform operation.`)}}class CannotConnectAlreadyConnectedError extends TypeORMError{constructor(e){super(`Cannot create a "${e}" connection because connection to the database already established.`)}}class LockNotSupportedOnGivenDriverError extends TypeORMError{constructor(){super("Locking not supported on given driver.")}}class ConnectionIsNotSetError extends TypeORMError{constructor(e){super(`Connection with ${e} database is not established. Check connection configuration.`)}}class CannotCreateEntityIdMapError extends TypeORMError{constructor(e,I){super();const oe=e.primaryColumns.reduce((ue,bt,tr)=>(bt.setEntityValue(ue,tr+1),ue),{});this.message=`Cannot use given entity id "${I}" because "${e.targetName}" contains multiple primary columns, you must provide object in following form: ${JSON.stringify(oe)} as an id.`}}class CannotDetermineEntityError extends TypeORMError{constructor(e){super(`Cannot ${e}, given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.`)}}class UpdateValuesMissingError extends TypeORMError{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}class TreeRepositoryNotSupportedError extends TypeORMError{constructor(e){super(`Tree repositories are not supported in ${e.options.type} driver.`)}}class CustomRepositoryNotFoundError extends TypeORMError{constructor(e){super(`Custom repository ${typeof e=="function"?e.name:e.constructor.name} was not found. Did you forgot to put @EntityRepository decorator on it?`)}}class TransactionNotStartedError extends TypeORMError{constructor(){super("Transaction is not started yet, start transaction before committing or rolling it back.")}}class TransactionAlreadyStartedError extends TypeORMError{constructor(){super("Transaction already started for the given connection, commit current transaction before starting a new one.")}}class InstanceChecker{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return typeof e=="function"&&typeof e.hasId=="function"&&typeof e.save=="function"&&typeof e.useDataSource=="function"}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,I){return typeof e=="object"&&e!==null&&e["@instanceof"]===Symbol.for(I)}}class EntityNotFoundError extends TypeORMError{constructor(e,I){super(),this.entityClass=e,this.criteria=I,this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(I)}`}stringifyTarget(e){return InstanceChecker.isEntitySchema(e)?e.options.name:typeof e=="function"||ObjectUtils.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch{}return""+e}}class EntityMetadataNotFoundError extends TypeORMError{constructor(e){super(),this.message=`No metadata for "${this.stringifyTarget(e)}" was found.`}stringifyTarget(e){return InstanceChecker.isEntitySchema(e)?e.options.name:typeof e=="function"||ObjectUtils.isObject(e)&&"name"in e?e.name:e}}class MustBeEntityError extends TypeORMError{constructor(e,I){super(`Cannot ${e}, given value must be an entity, instead "${I}" is given.`)}}class OptimisticLockVersionMismatchError extends TypeORMError{constructor(e,I,oe){super(`The optimistic lock on entity ${e} failed, version ${I} was expected, but is actually ${oe}.`)}}class LimitOnUpdateNotSupportedError extends TypeORMError{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}class CustomRepositoryCannotInheritRepositoryError extends TypeORMError{constructor(e){super(`Custom entity repository ${typeof e=="function"?e.name:e.constructor.name}  cannot inherit Repository class without entity being set in the @EntityRepository decorator.`)}}class QueryRunnerProviderAlreadyReleasedError extends TypeORMError{constructor(){super("Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.")}}class CannotAttachTreeChildrenEntityError extends TypeORMError{constructor(e){super(`Cannot attach entity "${e}" to its parent. Please make sure parent is saved in the database before saving children nodes.`)}}class CustomRepositoryDoesNotHaveEntityError extends TypeORMError{constructor(e){super(`Custom repository ${typeof e=="function"?e.name:e.constructor.name} does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? `)}}class MissingDeleteDateColumnError extends TypeORMError{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}class CircularRelationsError extends TypeORMError{constructor(e){super(`Circular relations detected: ${e}. To resolve this issue you need to set nullable: true somewhere in this dependency structure.`)}}class ReturningStatementNotSupportedError extends TypeORMError{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}class MissingPrimaryColumnError extends TypeORMError{constructor(e){super(`Entity "${e.name}" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.`)}}class EntityPropertyNotFoundError extends TypeORMError{constructor(e,I){super(e),Object.setPrototypeOf(this,EntityPropertyNotFoundError.prototype),this.message=`Property "${e}" was not found in "${I.targetName}". Make sure your query is correct.`}}class MissingDriverError extends TypeORMError{constructor(e,I=[]){super(`Wrong driver: "${e}" given. Supported drivers are: ${I.map(oe=>`"${oe}"`).join(", ")}.`)}}class DriverPackageNotInstalledError extends TypeORMError{constructor(e,I){super(`${e} package has not been found installed. Try to install it: npm install ${I} --save`)}}class NoVersionOrUpdateDateColumnError extends TypeORMError{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}class InsertValuesMissingError extends TypeORMError{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}class OptimisticLockCanNotBeUsedError extends TypeORMError{constructor(){super("The optimistic lock can be used only with getOne() method.")}}class DriverOptionNotSetError extends TypeORMError{constructor(e){super(`Driver option (${e}) is not set. Please set it to perform connection to the database.`)}}class FindRelationsNotFoundError extends TypeORMError{constructor(e){super(),e.length===1?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map(I=>`"${I}"`).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}class PessimisticLockTransactionRequiredError extends TypeORMError{constructor(){super("An open transaction is required for pessimistic lock.")}}class DataTypeNotSupportedError extends TypeORMError{constructor(e,I,oe){super();const ue=typeof I=="string"?I:I.name;this.message=`Data type "${ue}" in "${e.entityMetadata.targetName}.${e.propertyName}" is not supported by "${oe}" database.`}}class InitializedRelationError extends TypeORMError{constructor(e){super(`Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "${e.entityMetadata.targetName}#${e.propertyPath}". This is ORM requirement to make relations to work properly. Refer docs for more information.`)}}class QueryFailedError extends TypeORMError{constructor(e,I,oe){if(super(oe.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,"")),this.query=e,this.parameters=I,this.driverError=oe,oe){const{name:ue,...bt}=oe;ObjectUtils.assign(this,{...bt})}}}class NoNeedToReleaseEntityManagerError extends TypeORMError{constructor(){super("Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.")}}class SubjectRemovedAndUpdatedError extends TypeORMError{constructor(e){super(`Removed entity "${e.metadata.name}" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).`)}}class ColumnTypeUndefinedError extends TypeORMError{constructor(e,I){super(`Column type for ${e.constructor.name}#${I} is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.`)}}class QueryRunnerAlreadyReleasedError extends TypeORMError{constructor(){super("Query runner already released. Cannot run queries anymore.")}}class OffsetWithoutLimitNotSupportedError extends TypeORMError{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}class CannotExecuteNotConnectedError extends TypeORMError{constructor(e){super(`Cannot execute operation on "${e}" connection because connection is not yet established.`)}}class NoConnectionOptionError extends TypeORMError{constructor(e){super(`Option "${e}" is not set in your connection options, please define "${e}" option in your connection options or ormconfig.json`)}}class ForbiddenTransactionModeOverrideError extends TypeORMError{constructor(e){const I=e.map(oe=>`"${oe.name}"`);super(`Migrations ${I.join(", ")} override the transaction mode, but the global transaction mode is "all"`)}}class Alias{constructor(e){ObjectUtils.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new TypeORMError(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}class QueryBuilderUtils{static isAliasProperty(e){if(typeof e!="string"||e.indexOf(".")===-1)return!1;const[I,oe]=e.split(".");return!(!I||!oe||e.indexOf("(")!==-1||e.indexOf(")")!==-1)}}var sha_js={exports:{}},inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(e,I){I&&(e.super_=I,e.prototype=Object.create(I.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,I){if(I){e.super_=I;var oe=function(){};oe.prototype=I.prototype,e.prototype=new oe,e.prototype.constructor=e}};var inherits_browserExports=inherits_browser.exports,safeBuffer={exports:{}},require$$0=getAugmentedNamespace(dist);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(ae,e){var I=require$$0,oe=I.Buffer;function ue(tr,rr){for(var ir in tr)rr[ir]=tr[ir]}oe.from&&oe.alloc&&oe.allocUnsafe&&oe.allocUnsafeSlow?ae.exports=I:(ue(I,e),e.Buffer=bt);function bt(tr,rr,ir){return oe(tr,rr,ir)}bt.prototype=Object.create(oe.prototype),ue(oe,bt),bt.from=function(tr,rr,ir){if(typeof tr=="number")throw new TypeError("Argument must not be a number");return oe(tr,rr,ir)},bt.alloc=function(tr,rr,ir){if(typeof tr!="number")throw new TypeError("Argument must be a number");var lr=oe(tr);return rr!==void 0?typeof ir=="string"?lr.fill(rr,ir):lr.fill(rr):lr.fill(0),lr},bt.allocUnsafe=function(tr){if(typeof tr!="number")throw new TypeError("Argument must be a number");return oe(tr)},bt.allocUnsafeSlow=function(tr){if(typeof tr!="number")throw new TypeError("Argument must be a number");return I.SlowBuffer(tr)}})(safeBuffer,safeBuffer.exports);var safeBufferExports=safeBuffer.exports,Buffer$6=safeBufferExports.Buffer;function Hash$6(ae,e){this._block=Buffer$6.alloc(ae),this._finalSize=e,this._blockSize=ae,this._len=0}Hash$6.prototype.update=function(ae,e){typeof ae=="string"&&(e=e||"utf8",ae=Buffer$6.from(ae,e));for(var I=this._block,oe=this._blockSize,ue=ae.length,bt=this._len,tr=0;tr<ue;){for(var rr=bt%oe,ir=Math.min(ue-tr,oe-rr),lr=0;lr<ir;lr++)I[rr+lr]=ae[tr+lr];bt+=ir,tr+=ir,bt%oe===0&&this._update(I)}return this._len+=ue,this};Hash$6.prototype.digest=function(ae){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var I=this._len*8;if(I<=4294967295)this._block.writeUInt32BE(I,this._blockSize-4);else{var oe=(I&4294967295)>>>0,ue=(I-oe)/4294967296;this._block.writeUInt32BE(ue,this._blockSize-8),this._block.writeUInt32BE(oe,this._blockSize-4)}this._update(this._block);var bt=this._hash();return ae?bt.toString(ae):bt};Hash$6.prototype._update=function(){throw new Error("_update must be implemented by subclass")};var hash$1=Hash$6,inherits$5=inherits_browserExports,Hash$5=hash$1,Buffer$5=safeBufferExports.Buffer,K$5=[1518500249,1859775393,-1894007588,-899497514],W$7=new Array(80);function Sha(){this.init(),this._w=W$7,Hash$5.call(this,64,56)}inherits$5(Sha,Hash$5);Sha.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl5$1(ae){return ae<<5|ae>>>27}function rotl30$1(ae){return ae<<30|ae>>>2}function ft$2(ae,e,I,oe){return ae===0?e&I|~e&oe:ae===2?e&I|e&oe|I&oe:e^I^oe}Sha.prototype._update=function(ae){for(var e=this._w,I=this._a|0,oe=this._b|0,ue=this._c|0,bt=this._d|0,tr=this._e|0,rr=0;rr<16;++rr)e[rr]=ae.readInt32BE(rr*4);for(;rr<80;++rr)e[rr]=e[rr-3]^e[rr-8]^e[rr-14]^e[rr-16];for(var ir=0;ir<80;++ir){var lr=~~(ir/20),dr=rotl5$1(I)+ft$2(lr,oe,ue,bt)+tr+e[ir]+K$5[lr]|0;tr=bt,bt=ue,ue=rotl30$1(oe),oe=I,I=dr}this._a=I+this._a|0,this._b=oe+this._b|0,this._c=ue+this._c|0,this._d=bt+this._d|0,this._e=tr+this._e|0};Sha.prototype._hash=function(){var ae=Buffer$5.allocUnsafe(20);return ae.writeInt32BE(this._a|0,0),ae.writeInt32BE(this._b|0,4),ae.writeInt32BE(this._c|0,8),ae.writeInt32BE(this._d|0,12),ae.writeInt32BE(this._e|0,16),ae};var sha=Sha,inherits$4=inherits_browserExports,Hash$4=hash$1,Buffer$4=safeBufferExports.Buffer,K$4=[1518500249,1859775393,-1894007588,-899497514],W$6=new Array(80);function Sha1(){this.init(),this._w=W$6,Hash$4.call(this,64,56)}inherits$4(Sha1,Hash$4);Sha1.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl1(ae){return ae<<1|ae>>>31}function rotl5(ae){return ae<<5|ae>>>27}function rotl30(ae){return ae<<30|ae>>>2}function ft$1(ae,e,I,oe){return ae===0?e&I|~e&oe:ae===2?e&I|e&oe|I&oe:e^I^oe}Sha1.prototype._update=function(ae){for(var e=this._w,I=this._a|0,oe=this._b|0,ue=this._c|0,bt=this._d|0,tr=this._e|0,rr=0;rr<16;++rr)e[rr]=ae.readInt32BE(rr*4);for(;rr<80;++rr)e[rr]=rotl1(e[rr-3]^e[rr-8]^e[rr-14]^e[rr-16]);for(var ir=0;ir<80;++ir){var lr=~~(ir/20),dr=rotl5(I)+ft$1(lr,oe,ue,bt)+tr+e[ir]+K$4[lr]|0;tr=bt,bt=ue,ue=rotl30(oe),oe=I,I=dr}this._a=I+this._a|0,this._b=oe+this._b|0,this._c=ue+this._c|0,this._d=bt+this._d|0,this._e=tr+this._e|0};Sha1.prototype._hash=function(){var ae=Buffer$4.allocUnsafe(20);return ae.writeInt32BE(this._a|0,0),ae.writeInt32BE(this._b|0,4),ae.writeInt32BE(this._c|0,8),ae.writeInt32BE(this._d|0,12),ae.writeInt32BE(this._e|0,16),ae};var sha1=Sha1,inherits$3=inherits_browserExports,Hash$3=hash$1,Buffer$3=safeBufferExports.Buffer,K$3=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],W$5=new Array(64);function Sha256$1(){this.init(),this._w=W$5,Hash$3.call(this,64,56)}inherits$3(Sha256$1,Hash$3);Sha256$1.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function ch(ae,e,I){return I^ae&(e^I)}function maj$1(ae,e,I){return ae&e|I&(ae|e)}function sigma0$1(ae){return(ae>>>2|ae<<30)^(ae>>>13|ae<<19)^(ae>>>22|ae<<10)}function sigma1$1(ae){return(ae>>>6|ae<<26)^(ae>>>11|ae<<21)^(ae>>>25|ae<<7)}function gamma0(ae){return(ae>>>7|ae<<25)^(ae>>>18|ae<<14)^ae>>>3}function gamma1(ae){return(ae>>>17|ae<<15)^(ae>>>19|ae<<13)^ae>>>10}Sha256$1.prototype._update=function(ae){for(var e=this._w,I=this._a|0,oe=this._b|0,ue=this._c|0,bt=this._d|0,tr=this._e|0,rr=this._f|0,ir=this._g|0,lr=this._h|0,dr=0;dr<16;++dr)e[dr]=ae.readInt32BE(dr*4);for(;dr<64;++dr)e[dr]=gamma1(e[dr-2])+e[dr-7]+gamma0(e[dr-15])+e[dr-16]|0;for(var pr=0;pr<64;++pr){var hr=lr+sigma1$1(tr)+ch(tr,rr,ir)+K$3[pr]+e[pr]|0,_r=sigma0$1(I)+maj$1(I,oe,ue)|0;lr=ir,ir=rr,rr=tr,tr=bt+hr|0,bt=ue,ue=oe,oe=I,I=hr+_r|0}this._a=I+this._a|0,this._b=oe+this._b|0,this._c=ue+this._c|0,this._d=bt+this._d|0,this._e=tr+this._e|0,this._f=rr+this._f|0,this._g=ir+this._g|0,this._h=lr+this._h|0};Sha256$1.prototype._hash=function(){var ae=Buffer$3.allocUnsafe(32);return ae.writeInt32BE(this._a,0),ae.writeInt32BE(this._b,4),ae.writeInt32BE(this._c,8),ae.writeInt32BE(this._d,12),ae.writeInt32BE(this._e,16),ae.writeInt32BE(this._f,20),ae.writeInt32BE(this._g,24),ae.writeInt32BE(this._h,28),ae};var sha256=Sha256$1,inherits$2=inherits_browserExports,Sha256=sha256,Hash$2=hash$1,Buffer$2=safeBufferExports.Buffer,W$4=new Array(64);function Sha224(){this.init(),this._w=W$4,Hash$2.call(this,64,56)}inherits$2(Sha224,Sha256);Sha224.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this};Sha224.prototype._hash=function(){var ae=Buffer$2.allocUnsafe(28);return ae.writeInt32BE(this._a,0),ae.writeInt32BE(this._b,4),ae.writeInt32BE(this._c,8),ae.writeInt32BE(this._d,12),ae.writeInt32BE(this._e,16),ae.writeInt32BE(this._f,20),ae.writeInt32BE(this._g,24),ae};var sha224=Sha224,inherits$1=inherits_browserExports,Hash$1=hash$1,Buffer$1=safeBufferExports.Buffer,K$2=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],W$3=new Array(160);function Sha512(){this.init(),this._w=W$3,Hash$1.call(this,128,112)}inherits$1(Sha512,Hash$1);Sha512.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function Ch(ae,e,I){return I^ae&(e^I)}function maj(ae,e,I){return ae&e|I&(ae|e)}function sigma0(ae,e){return(ae>>>28|e<<4)^(e>>>2|ae<<30)^(e>>>7|ae<<25)}function sigma1(ae,e){return(ae>>>14|e<<18)^(ae>>>18|e<<14)^(e>>>9|ae<<23)}function Gamma0(ae,e){return(ae>>>1|e<<31)^(ae>>>8|e<<24)^ae>>>7}function Gamma0l(ae,e){return(ae>>>1|e<<31)^(ae>>>8|e<<24)^(ae>>>7|e<<25)}function Gamma1(ae,e){return(ae>>>19|e<<13)^(e>>>29|ae<<3)^ae>>>6}function Gamma1l(ae,e){return(ae>>>19|e<<13)^(e>>>29|ae<<3)^(ae>>>6|e<<26)}function getCarry(ae,e){return ae>>>0<e>>>0?1:0}Sha512.prototype._update=function(ae){for(var e=this._w,I=this._ah|0,oe=this._bh|0,ue=this._ch|0,bt=this._dh|0,tr=this._eh|0,rr=this._fh|0,ir=this._gh|0,lr=this._hh|0,dr=this._al|0,pr=this._bl|0,hr=this._cl|0,_r=this._dl|0,yr=this._el|0,wr=this._fl|0,Tr=this._gl|0,Ar=this._hl|0,Sr=0;Sr<32;Sr+=2)e[Sr]=ae.readInt32BE(Sr*4),e[Sr+1]=ae.readInt32BE(Sr*4+4);for(;Sr<160;Sr+=2){var Mr=e[Sr-30],vr=e[Sr-15*2+1],Lr=Gamma0(Mr,vr),es=Gamma0l(vr,Mr);Mr=e[Sr-2*2],vr=e[Sr-2*2+1];var ss=Gamma1(Mr,vr),os=Gamma1l(vr,Mr),$r=e[Sr-7*2],ns=e[Sr-7*2+1],Nr=e[Sr-16*2],zr=e[Sr-16*2+1],Ir=es+ns|0,Or=Lr+$r+getCarry(Ir,es)|0;Ir=Ir+os|0,Or=Or+ss+getCarry(Ir,os)|0,Ir=Ir+zr|0,Or=Or+Nr+getCarry(Ir,zr)|0,e[Sr]=Or,e[Sr+1]=Ir}for(var Dr=0;Dr<160;Dr+=2){Or=e[Dr],Ir=e[Dr+1];var Ur=maj(I,oe,ue),kr=maj(dr,pr,hr),Qr=sigma0(I,dr),is=sigma0(dr,I),cs=sigma1(tr,yr),_s=sigma1(yr,tr),as=K$2[Dr],gs=K$2[Dr+1],hs=Ch(tr,rr,ir),ps=Ch(yr,wr,Tr),Ms=Ar+_s|0,bs=lr+cs+getCarry(Ms,Ar)|0;Ms=Ms+ps|0,bs=bs+hs+getCarry(Ms,ps)|0,Ms=Ms+gs|0,bs=bs+as+getCarry(Ms,gs)|0,Ms=Ms+Ir|0,bs=bs+Or+getCarry(Ms,Ir)|0;var Ts=is+kr|0,Cs=Qr+Ur+getCarry(Ts,is)|0;lr=ir,Ar=Tr,ir=rr,Tr=wr,rr=tr,wr=yr,yr=_r+Ms|0,tr=bt+bs+getCarry(yr,_r)|0,bt=ue,_r=hr,ue=oe,hr=pr,oe=I,pr=dr,dr=Ms+Ts|0,I=bs+Cs+getCarry(dr,Ms)|0}this._al=this._al+dr|0,this._bl=this._bl+pr|0,this._cl=this._cl+hr|0,this._dl=this._dl+_r|0,this._el=this._el+yr|0,this._fl=this._fl+wr|0,this._gl=this._gl+Tr|0,this._hl=this._hl+Ar|0,this._ah=this._ah+I+getCarry(this._al,dr)|0,this._bh=this._bh+oe+getCarry(this._bl,pr)|0,this._ch=this._ch+ue+getCarry(this._cl,hr)|0,this._dh=this._dh+bt+getCarry(this._dl,_r)|0,this._eh=this._eh+tr+getCarry(this._el,yr)|0,this._fh=this._fh+rr+getCarry(this._fl,wr)|0,this._gh=this._gh+ir+getCarry(this._gl,Tr)|0,this._hh=this._hh+lr+getCarry(this._hl,Ar)|0};Sha512.prototype._hash=function(){var ae=Buffer$1.allocUnsafe(64);function e(I,oe,ue){ae.writeInt32BE(I,ue),ae.writeInt32BE(oe,ue+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),ae};var sha512=Sha512,inherits=inherits_browserExports,SHA512=sha512,Hash=hash$1,Buffer=safeBufferExports.Buffer,W$2=new Array(160);function Sha384(){this.init(),this._w=W$2,Hash.call(this,128,112)}inherits(Sha384,SHA512);Sha384.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this};Sha384.prototype._hash=function(){var ae=Buffer.allocUnsafe(48);function e(I,oe,ue){ae.writeInt32BE(I,ue),ae.writeInt32BE(oe,ue+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),ae};var sha384=Sha384,exports=sha_js.exports=function(e){e=e.toLowerCase();var I=exports[e];if(!I)throw new Error(e+" is not supported (we accept pull requests)");return new I};exports.sha=sha;exports.sha1=sha1;exports.sha224=sha224;exports.sha256=sha256;exports.sha384=sha384;exports.sha512=sha512;var sha_jsExports=sha_js.exports,shajs=getDefaultExportFromCjs$1(sha_jsExports);function camelCase(ae,e=!1){return e&&(ae=" "+ae),ae.replace(/^([A-Z])|[\s-_](\w)/g,function(I,oe,ue){return ue?ue.toUpperCase():oe.toLowerCase()})}function snakeCase(ae){return ae.replace(/([A-Z])([A-Z])([a-z])/g,"$1_$2$3").replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase()}function titleCase(ae){return ae.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())}function shorten(ae,e={}){const{segmentLength:I=4,separator:oe="__",termLength:ue=2}=e;return ae.split(oe).reduce((rr,ir)=>{const lr=ir.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),dr=lr.length>1?ue:I,pr=lr.map(hr=>hr.substr(0,dr)).join("");return rr.push(pr),rr},[]).join(oe)}function hash(ae,e={}){const I=shajs("sha1");I.update(ae,"utf8");const oe=I.digest("hex");return e.length?oe.slice(0,e.length):oe}class VersionUtils{static isGreaterOrEqual(e,I){const oe=parseVersion(e),ue=parseVersion(I);return oe[0]>ue[0]||oe[0]===ue[0]&&oe[1]>ue[1]||oe[0]===ue[0]&&oe[1]===ue[1]&&oe[2]>=ue[2]}}function parseVersion(ae=""){const e=[0,0,0];return ae.split(".").forEach((I,oe)=>e[oe]=parseInt(I,10)),e}class DriverUtils{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,I){return e.version!=null&&VersionUtils.isGreaterOrEqual(e.version,I)}static isPostgresFamily(e){return["postgres","aurora-postgres","cockroachdb"].includes(e.options.type)}static buildDriverOptions(e,I){if(e.url){const oe=this.parseConnectionUrl(e.url);I&&I.useSid&&oe.database&&(oe.sid=oe.database);for(const ue of Object.keys(oe))typeof oe[ue]>"u"&&delete oe[ue];return Object.assign({},e,oe)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,I){if(e.url){const oe=this.parseMongoDBConnectionUrl(e.url);I&&I.useSid&&oe.database&&(oe.sid=oe.database);for(const ue of Object.keys(oe))typeof oe[ue]>"u"&&delete oe[ue];return Object.assign({},e,oe)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},I,...oe){const ue=I&&I.joiner?I.joiner:"_";let bt=oe.length===1?oe[0]:oe.join(ue);if(e&&e>0&&bt.length>e){if(I&&I.shorten===!0){const tr=shorten(bt);if(tr.length<e)return tr}return hash(bt,{length:e})}return bt}static buildColumnAlias({maxAliasLength:e},I,...oe){return typeof I=="string"?(oe.unshift(I),I={shorten:!1,joiner:"_"}):I=Object.assign({shorten:!1,joiner:"_"},I),this.buildAlias({maxAliasLength:e},I,...oe)}static parseConnectionUrl(e){const I=e.split(":")[0],oe=e.indexOf("//"),ue=e.substr(oe+2),bt=ue.indexOf("/"),tr=bt!==-1?ue.substr(0,bt):ue;let rr=bt!==-1?ue.substr(bt+1):void 0;rr&&rr.indexOf("?")!==-1&&(rr=rr.substr(0,rr.indexOf("?")));const ir=tr.lastIndexOf("@"),lr=tr.substr(0,ir),dr=tr.substr(ir+1);let pr=lr,hr="";const _r=lr.indexOf(":");_r!==-1&&(pr=lr.substr(0,_r),hr=lr.substr(_r+1));const[yr,wr]=dr.split(":");return{type:I,host:yr,username:decodeURIComponent(pr),password:decodeURIComponent(hr),port:wr?parseInt(wr):void 0,database:rr||void 0}}static parseMongoDBConnectionUrl(e){const I=e.split(":")[0],oe=e.indexOf("//"),ue=e.substr(oe+2),bt=ue.indexOf("/"),tr=bt!==-1?ue.substr(0,bt):ue;let rr=bt!==-1?ue.substr(bt+1):void 0,ir="",lr,dr,pr,hr,_r={};if(rr&&rr.indexOf("?")!==-1){ir=rr.substr(rr.indexOf("?")+1,rr.length);const Lr=ir.split("&");let es,ss;Lr.forEach(os=>{es=os.split("=")[0],ss=os.split("=")[1],_r[es]=ss}),hr=_r.replicaSet,rr=rr.substr(0,rr.indexOf("?"))}const yr=tr.lastIndexOf("@"),wr=tr.substr(0,yr),Tr=tr.substr(yr+1);let Ar=wr,Sr="";const Mr=wr.indexOf(":");Mr!==-1&&(Ar=wr.substr(0,Mr),Sr=wr.substr(Mr+1)),hr?pr=Tr:[lr,dr]=Tr.split(":");let vr={type:I,host:lr,hostReplicaSet:pr,username:decodeURIComponent(Ar),password:decodeURIComponent(Sr),port:dr?parseInt(dr):void 0,database:rr||void 0};for(const[Lr,es]of Object.entries(_r))vr[Lr]=es;return vr}}class JoinAttribute{constructor(e,I,oe){this.connection=e,this.queryExpressionMap=I,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,oe&&ObjectUtils.assign(this,oe)}get isMany(){return this.isMappingMany!==void 0?this.isMappingMany:this.relation?this.relation.isManyToMany||this.relation.isOneToMany:!1}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const I of this.queryExpressionMap.selects)if(I.selection===this.alias.name||this.metadata&&this.metadata.columns.find(oe=>I.selection===this.alias.name+"."+oe.propertyPath))return!0;return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return;const I=this.queryExpressionMap.findAliasByName(this.parentAlias);let oe=I.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(oe||I.metadata.parentEntityMetadata&&(oe=I.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),oe))return oe;throw new TypeORMError(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){if(this.relation)return this.relation.inverseEntityMetadata;if(this.connection.hasMetadata(this.entityOrProperty))return this.connection.getMetadata(this.entityOrProperty);if(this.mapAsEntity&&this.connection.hasMetadata(this.mapAsEntity))return this.connection.getMetadata(this.mapAsEntity)}get junctionAlias(){if(!this.relation)throw new TypeORMError("Cannot get junction table for join without relation.");if(typeof this.entityOrProperty!="string")throw new TypeORMError("Junction property is not defined.");const e=this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."));return this.relation.isOwning?DriverUtils.buildAlias(this.connection.driver,void 0,e,this.alias.name):DriverUtils.buildAlias(this.connection.driver,void 0,this.alias.name,e)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}class RelationIdAttribute{constructor(e,I){this.queryExpressionMap=e,this.disableMixedMap=!1,ObjectUtils.assign(this,I||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");const I=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!I)throw new TypeORMError(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return I}get junctionAlias(){const[e,I]=this.relationName.split(".");return e+"_"+I+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}class RelationCountAttribute{constructor(e,I){this.expressionMap=e,ObjectUtils.assign(this,I||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,I]=this.relationName.split(".");return e+"_"+I+"_rc"}get relation(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value is a string representation of alias property");const[e,I]=this.relationName.split("."),ue=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(I);if(!ue)throw new TypeORMError(`Relation with property path ${I} in entity was not found.`);return ue}get metadata(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}class QueryExpressionMap{constructor(e){this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy),this.timeTravel=e.options?.timeTravelQueries||!1}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&this.options.indexOf("disable-global-order")===-1){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce((I,oe)=>(I[this.mainAlias.name+"."+oe]=e[oe],I),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let I=e.name;!I&&e.tablePath&&(I=e.tablePath),!I&&typeof e.target=="function"&&(I=e.target.name),!I&&typeof e.target=="string"&&(I=e.target);const oe=new Alias;return oe.type=e.type,I&&(oe.name=I),e.metadata&&(oe.metadata=e.metadata),e.target&&!oe.hasMetadata&&(oe.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(oe.tablePath=e.tablePath),e.subQuery&&(oe.subQuery=e.subQuery),this.aliases.push(oe),oe}findAliasByName(e){const I=this.aliases.find(oe=>oe.name===e);if(!I)throw new TypeORMError(`"${e}" alias was not found. Maybe you forgot to join it?`);return I}findColumnByAliasExpression(e){const[I,oe]=e.split(".");return this.findAliasByName(I).metadata.findColumnWithPropertyName(oe)}get relationMetadata(){if(!this.mainAlias)throw new TypeORMError("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new TypeORMError(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new QueryExpressionMap(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map(I=>I),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(I=>e.aliases.push(new Alias(I))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map(I=>new JoinAttribute(this.connection,this,I)),e.relationIdAttributes=this.relationIdAttributes.map(I=>new RelationIdAttribute(this,I)),e.relationCountAttributes=this.relationCountAttributes.map(I=>new RelationCountAttribute(this,I)),e.wheres=this.wheres.map(I=>({...I})),e.havings=this.havings.map(I=>({...I})),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map(I=>I),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.timeTravel=this.timeTravel,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map(I=>({alias:I.alias,queryBuilder:typeof I.queryBuilder=="string"?I.queryBuilder:I.queryBuilder.clone(),options:I.options})),e}}class Brackets{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}class ApplyValueTransformers{static transformFrom(e,I){return Array.isArray(e)?e.slice().reverse().reduce((ue,bt)=>bt.from(ue),I):e.from(I)}static transformTo(e,I){return Array.isArray(e)?e.reduce((oe,ue)=>ue.to(oe),I):e.to(I)}}class FindOperator{constructor(e,I,oe=!0,ue=!1,bt,tr){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=I,this._useParameter=oe,this._multipleParameters=ue,this._getSql=bt,this._objectLiteralParameters=tr}get useParameter(){return InstanceChecker.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return InstanceChecker.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return InstanceChecker.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return InstanceChecker.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(InstanceChecker.isFindOperator(this._value))return this._value}get getSql(){return InstanceChecker.isFindOperator(this._value)?this._value.getSql:this._getSql}transformValue(e){this._value instanceof FindOperator?this._value.transformValue(e):this._value=Array.isArray(this._value)&&this._multipleParameters?this._value.map(I=>e&&ApplyValueTransformers.transformTo(e,I)):ApplyValueTransformers.transformTo(e,this._value)}}function In$1(ae){return new FindOperator("in",ae,!0,!0)}const ESCAPE_REGEXP=/[.*+\-?^${}()|[\]\\]/g,escapeRegExp=ae=>ae.replace(ESCAPE_REGEXP,"\\$&");class QueryBuilder{constructor(e,I){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,InstanceChecker.isDataSource(e)?(this.connection=e,this.queryRunner=I,this.expressionMap=new QueryExpressionMap(this.connection)):(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone())}static registerQueryBuilderClass(e,I){QueryBuilder.queryBuilderRegistry[e]=I}get alias(){if(!this.expressionMap.mainAlias)throw new TypeORMError("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,I){return this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map(oe=>({selection:oe})):e&&(this.expressionMap.selects=[{selection:e,aliasName:I}]),InstanceChecker.isSelectQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.SelectQueryBuilder(this)}insert(){return this.expressionMap.queryType="insert",InstanceChecker.isInsertQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.InsertQueryBuilder(this)}update(e,I){const oe=I||e;if(e=InstanceChecker.isEntitySchema(e)?e.options.name:e,typeof e=="function"||typeof e=="string"){const ue=this.createFromAlias(e);this.expressionMap.setMainAlias(ue)}return this.expressionMap.queryType="update",this.expressionMap.valuesSet=oe,InstanceChecker.isUpdateQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.UpdateQueryBuilder(this)}delete(){return this.expressionMap.queryType="delete",InstanceChecker.isDeleteQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.DeleteQueryBuilder(this)}softDelete(){return this.expressionMap.queryType="soft-delete",InstanceChecker.isSoftDeleteQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}restore(){return this.expressionMap.queryType="restore",InstanceChecker.isSoftDeleteQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}relation(e,I){const oe=arguments.length===2?e:void 0,ue=arguments.length===2?I:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=ue,oe){const bt=this.createFromAlias(oe);this.expressionMap.setMainAlias(bt)}return InstanceChecker.isRelationQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.RelationQueryBuilder(this)}hasRelation(e,I){const oe=this.connection.getMetadata(e);return(Array.isArray(I)?I:[I]).every(bt=>!!oe.findRelationWithPropertyPath(bt))}hasParameter(e){return this.parentQueryBuilder?.hasParameter(e)||e in this.expressionMap.parameters}setParameter(e,I){if(typeof I=="function")throw new TypeORMError(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new TypeORMError("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,I),this.expressionMap.parameters[e]=I,this}setParameters(e){for(const[I,oe]of Object.entries(e))this.setParameter(I,oe);return this}createParameter(e){let I;do I=`orm_param_${this.parameterIndex++}`;while(this.hasParameter(I));return this.setParameter(I,e),`:${I}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(I=>{this.expressionMap.nativeParameters[I]=e[I]}),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const I=this.expressionMap.mainAlias.metadata;if(I.discriminatorColumn&&I.parentEntityMetadata){const oe=I.childEntityMetadatas.filter(ue=>ue.discriminatorColumn).map(ue=>ue.discriminatorValue);oe.push(I.discriminatorValue),e.discriminatorColumnValues=oe}}return e}printSql(){const[e,I]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,I),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),I=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,I,this.expressionMap.nativeParameters)}async execute(){const[e,I]=this.getQueryAndParameters(),oe=this.obtainQueryRunner();try{return await oe.query(e,I)}finally{oe!==this.queryRunner&&await oe.release()}}createQueryBuilder(e){return new this.constructor(this.connection,e??this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,I,oe){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:I,options:oe||{}}),this}getTableName(e){return e.split(".").map(I=>I===""?I:this.escape(I)).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new TypeORMError('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,I){if(this.connection.hasMetadata(e)){const oe=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:I,metadata:this.connection.getMetadata(e),tablePath:oe.tablePath})}else{if(typeof e=="string"){const bt=e.substr(0,1)==="("&&e.substr(-1)===")";return this.expressionMap.createAlias({type:"from",name:I,tablePath:bt?void 0:e,subQuery:bt?e:void 0})}const oe=e(this.subQuery());this.setParameters(oe.getParameters());const ue=oe.getQuery();return this.expressionMap.createAlias({type:"from",name:I,subQuery:ue})}}replacePropertyNames(e){return e}replacePropertyNamesForTheWholeQuery(e){const I={};for(const bt of this.expressionMap.aliases){if(!bt.hasMetadata)continue;const tr=this.expressionMap.aliasNamePrefixingEnabled&&bt.name?`${bt.name}.`:"";I[tr]||(I[tr]={});for(const rr of bt.metadata.relations)rr.joinColumns.length>0&&(I[tr][rr.propertyPath]=rr.joinColumns[0].databaseName);for(const rr of bt.metadata.relations){const ir=[...rr.joinColumns,...rr.inverseJoinColumns];for(const lr of ir){const dr=`${rr.propertyPath}.${lr.referencedColumn.propertyPath}`;I[tr][dr]=lr.databaseName}}for(const rr of bt.metadata.columns)I[tr][rr.databaseName]=rr.databaseName;for(const rr of bt.metadata.columns)I[tr][rr.propertyName]=rr.databaseName;for(const rr of bt.metadata.columns)I[tr][rr.propertyPath]=rr.databaseName}const oe=Object.keys(I),ue=oe.map(bt=>escapeRegExp(bt)).join("|");return oe.length>0&&(e=e.replace(new RegExp(`([ =(]|^.{0})${ue?"("+ue+")":""}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),(...bt)=>{let tr,rr,ir;if(ue){if(tr=bt[0],rr=bt[1],ir=bt[3],I[bt[2]][ir])return`${rr}${this.escape(bt[2].substring(0,bt[2].length-1))}.${this.escape(I[bt[2]][ir])}`}else if(tr=bt[0],rr=bt[1],ir=bt[2],I[""][ir])return`${rr}${this.escape(I[""][ir])}`;return tr})),e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace(/\*\//g,"")} */ `:""}createTimeTravelQuery(){return this.expressionMap.queryType==="select"&&this.expressionMap.timeTravel?` AS OF SYSTEM TIME ${this.expressionMap.timeTravel}`:""}createWhereExpression(){const e=[],I=this.createWhereClausesExpression(this.expressionMap.wheres);if(I.length>0&&I!=="1=1"&&e.push(this.replacePropertyNames(I)),this.expressionMap.mainAlias.hasMetadata){const ue=this.expressionMap.mainAlias.metadata;if(this.expressionMap.queryType==="select"&&!this.expressionMap.withDeleted&&ue.deleteDateColumn){const bt=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+ue.deleteDateColumn.propertyName:ue.deleteDateColumn.propertyName,tr=`${this.replacePropertyNames(bt)} IS NULL`;e.push(tr)}if(ue.discriminatorColumn&&ue.parentEntityMetadata){const bt=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+ue.discriminatorColumn.databaseName:ue.discriminatorColumn.databaseName,tr=`${this.replacePropertyNames(bt)} IN (:...discriminatorColumnValues)`;e.push(tr)}}if(this.expressionMap.extraAppendedAndWhereCondition){const ue=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(ue)}let oe="";return oe+=this.createTimeTravelQuery(),e.length?e.length===1?oe+=` WHERE ${e[0]}`:oe+=` WHERE ( ${e.join(" ) AND ( ")} )`:oe+="",oe}createReturningExpression(e){const I=this.getReturningColumns(),oe=this.connection.driver;if(typeof this.expressionMap.returning!="string"&&this.expressionMap.extraReturningColumns.length>0&&oe.isReturningSqlSupported(e)&&I.push(...this.expressionMap.extraReturningColumns.filter(ue=>I.indexOf(ue)===-1)),I.length){let ue=I.map(bt=>{const tr=this.escape(bt.databaseName);return oe.options.type==="mssql"?this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update"||this.expressionMap.queryType==="soft-delete"||this.expressionMap.queryType==="restore"?"INSERTED."+tr:this.escape(this.getMainTableName())+"."+tr:tr}).join(", ");return oe.options.type==="oracle"&&(ue+=" INTO "+I.map(bt=>this.createParameter({type:oe.columnTypeToNativeParameter(bt.type),dir:oe.oracle.BIND_OUT})).join(", ")),oe.options.type==="mssql"&&(this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update")&&(ue+=" INTO @OutputTable"),ue}else if(typeof this.expressionMap.returning=="string")return this.expressionMap.returning;return""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(I=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(I))}),e}createWhereClausesExpression(e){return e.map((I,oe)=>{const ue=this.createWhereConditionExpression(I.condition);switch(I.type){case"and":return(oe>0?"AND ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${ue}${this.connection.options.isolateWhereStatements?")":""}`;case"or":return(oe>0?"OR ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${ue}${this.connection.options.isolateWhereStatements?")":""}`}return ue}).join(" ").trim()}createWhereConditionExpression(e,I=!1){if(typeof e=="string")return e;if(Array.isArray(e))return e.length===0?"1=1":e.length===1&&!I?this.createWhereClausesExpression(e):"("+this.createWhereClausesExpression(e)+")";const{driver:oe}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"jsonContains":return`${e.parameters[0]} ::jsonb @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return oe.options.type==="postgres"||oe.options.type==="cockroachdb"?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return oe.options.type==="cockroachdb"?`${e.parameters[0]}::STRING = ANY(${e.parameters[1]}::STRING[])`:`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`;case"and":return"("+e.parameters.join(" AND ")+")";case"or":return"("+e.parameters.join(" OR ")+")"}throw new TypeError(`Unsupported FindOperator ${FindOperator.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map(oe=>{const ue=typeof oe.queryBuilder=="string"?oe.queryBuilder:oe.queryBuilder.getQuery();if(typeof oe.queryBuilder!="string"){if(oe.queryBuilder.hasCommonTableExpressions())throw new TypeORMError(`Nested CTEs aren't supported (CTE: ${oe.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!InstanceChecker.isSelectQueryBuilder(oe.queryBuilder))throw new TypeORMError(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${oe.alias})`);this.setParameters(oe.queryBuilder.getParameters())}let bt=this.escape(oe.alias);if(oe.options.columnNames){const ir=oe.options.columnNames.map(lr=>this.escape(lr));if(InstanceChecker.isSelectQueryBuilder(oe.queryBuilder)&&oe.queryBuilder.expressionMap.selects.length&&oe.options.columnNames.length!==oe.queryBuilder.expressionMap.selects.length)throw new TypeORMError(`cte.options.columnNames length (${oe.options.columnNames.length}) doesn't match subquery select list length ${oe.queryBuilder.expressionMap.selects.length} (CTE: ${oe.alias})`);bt+=`(${ir.join(", ")})`}const tr=oe.options.recursive&&e?"RECURSIVE":"";let rr="";return this.connection.driver.cteCapabilities.materializedHint&&oe.options.materialized!==void 0&&(rr=oe.options.materialized?"MATERIALIZED":"NOT MATERIALIZED"),[tr,bt,"AS",rr,`(${ue})`].filter(Boolean).join(" ")}).join(", ")+" "}getWhereInIdsCondition(e){const I=this.expressionMap.mainAlias.metadata,oe=(Array.isArray(e)?e:[e]).map(ue=>I.ensureEntityIdMap(ue));if(!I.hasMultiplePrimaryKeys){const ue=I.primaryColumns[0];if(!ue.transformer&&!ue.relationMetadata&&!ue.embeddedMetadata)return{[ue.propertyName]:In$1(oe.map(bt=>ue.getEntityValue(bt,!1)))}}return new Brackets(ue=>{for(const bt of oe)ue.orWhere(new Brackets(tr=>tr.where(bt)))})}getExistsCondition(e){const I=e.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select("1").setOption("disable-global-order");return[`EXISTS (${I.getQuery()})`,I.getParameters()]}findColumnsForPropertyPath(e){let I=this.expressionMap.mainAlias;const oe=[],ue=e.split(".");for(;ue.length>1;){const rr=ue[0];if(!I?.hasMetadata)break;if(I.metadata.hasEmbeddedWithPropertyPath(rr)){ue.unshift(`${ue.shift()}.${ue.shift()}`);continue}if(I.metadata.hasRelationWithPropertyPath(rr)){const ir=this.expressionMap.joinAttributes.find(lr=>lr.relationPropertyPath===rr);if(!ir?.alias){const lr=oe.length>0?`${oe.join(".")}.${rr}`:rr;throw new Error(`Cannot find alias for relation at ${lr}`)}I=ir.alias,oe.push(...rr.split(".")),ue.shift();continue}break}if(!I)throw new Error(`Cannot find alias for property ${e}`);const bt=ue.join("."),tr=I.metadata.findColumnsWithPropertyPath(bt);if(!tr.length)throw new EntityPropertyNotFoundError(e,I.metadata);return[I,oe,tr]}createPropertyPath(e,I,oe=""){const ue=[];for(const bt of Object.keys(I)){const tr=oe?`${oe}.${bt}`:bt;if(I[bt]===null||typeof I[bt]!="object"||InstanceChecker.isFindOperator(I[bt])){ue.push(tr);continue}if(e.hasEmbeddedWithPropertyPath(tr)){const rr=this.createPropertyPath(e,I[bt],tr);ue.push(...rr);continue}if(e.hasRelationWithPropertyPath(tr)){const rr=e.findRelationWithPropertyPath(tr);if(rr.relationType==="one-to-one"||rr.relationType==="many-to-one"){const pr=rr.joinColumns.map(_r=>_r.referencedColumn).filter(_r=>!!_r);if(pr.length>0&&pr.every(_r=>_r.getEntityValue(I[bt],!1))){ue.push(tr);continue}}if(rr.relationType==="one-to-many"||rr.relationType==="many-to-many")throw new Error(`Cannot query across ${rr.relationType} for property ${tr}`);const ir=rr.inverseEntityMetadata.primaryColumns;if(ir.length>0&&ir.every(pr=>pr.getEntityValue(I[bt],!1))){const pr=ir.map(hr=>`${tr}.${hr.propertyPath}`);ue.push(...pr);continue}const dr=this.createPropertyPath(rr.inverseEntityMetadata,I[bt]).map(pr=>`${tr}.${pr}`);ue.push(...dr);continue}ue.push(tr)}return ue}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const I=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const oe of I){const[ue,bt,tr]=this.findColumnsForPropertyPath(oe);for(const rr of tr){let ir=e;for(const pr of bt){if(!ir||!(pr in ir)){ir={};break}ir=ir[pr]}const lr=this.expressionMap.aliasNamePrefixingEnabled?`${ue.name}.${rr.propertyPath}`:rr.propertyPath,dr=rr.getEntityValue(ir,!0);yield[lr,dr]}}}else for(const I of Object.keys(e)){const oe=e[I];yield[this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${I}`:I,oe]}}getWherePredicateCondition(e,I){if(InstanceChecker.isFindOperator(I)){let oe=[];if(I.useParameter)if(I.objectLiteralParameters)this.setParameters(I.objectLiteralParameters);else if(I.multipleParameters)for(const ue of I.value)oe.push(this.createParameter(ue));else oe.push(this.createParameter(I.value));if(I.type==="raw")return I.getSql?I.getSql(e):{operator:"equal",parameters:[e,I.value]};if(I.type==="not")return I.child?{operator:I.type,condition:this.getWherePredicateCondition(e,I.child)}:{operator:"notEqual",parameters:[e,...oe]};if(I.type==="and"){const ue=I.value;return{operator:I.type,parameters:ue.map(bt=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,bt)))}}else if(I.type==="or"){const ue=I.value;return{operator:I.type,parameters:ue.map(bt=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,bt)))}}else return{operator:I.type,parameters:[e,...oe]}}else return{operator:"equal",parameters:[e,this.createParameter(I)]}}getWhereCondition(e){if(typeof e=="string")return e;if(InstanceChecker.isBrackets(e)){const ue=this.createQueryBuilder();return ue.parentQueryBuilder=this,ue.expressionMap.mainAlias=this.expressionMap.mainAlias,ue.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,ue.expressionMap.parameters=this.expressionMap.parameters,ue.expressionMap.nativeParameters=this.expressionMap.nativeParameters,ue.expressionMap.wheres=[],e.whereFactory(ue),{operator:InstanceChecker.isNotBrackets(e)?"not":"brackets",condition:ue.expressionMap.wheres}}if(typeof e=="function")return e(this);const I=Array.isArray(e)?e:[e],oe=[];for(const ue of I){const bt=[];for(const[tr,rr]of this.getPredicates(ue))bt.push({type:"and",condition:this.getWherePredicateCondition(tr,rr)});oe.push({type:"or",condition:bt})}return oe.length===1?oe[0].condition:oe}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}QueryBuilder.queryBuilderRegistry={};class DeleteResult{static from(e){const I=new this;return I.raw=e.records,I.affected=e.affected,I}}class DeleteQueryBuilder extends QueryBuilder{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const[e,I]=this.getQueryAndParameters(),oe=this.obtainQueryRunner();let ue=!1;try{this.expressionMap.useTransaction===!0&&oe.isTransactionActive===!1&&(await oe.startTransaction(),ue=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await oe.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const bt=await oe.query(e,I,!0),tr=DeleteResult.from(bt);return this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await oe.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),ue&&await oe.commitTransaction(),tr}catch(bt){if(ue)try{await oe.rollbackTransaction()}catch{}throw bt}finally{oe!==this.queryRunner&&await oe.release()}}from(e,I){e=InstanceChecker.isEntitySchema(e)?e.options.name:e;const oe=this.createFromAlias(e,I);return this.expressionMap.setMainAlias(oe),this}where(e,I){this.expressionMap.wheres=[];const oe=this.getWhereCondition(e);return oe&&(this.expressionMap.wheres=[{type:"simple",condition:oe}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),I=this.createWhereExpression(),oe=this.createReturningExpression("delete");return oe===""?`DELETE FROM ${e}${I}`:this.connection.driver.options.type==="mssql"?`DELETE FROM ${e} OUTPUT ${oe}${I}`:`DELETE FROM ${e}${I} RETURNING ${oe}`}}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let ae=0;ae<256;++ae)byteToHex.push((ae+256).toString(16).slice(1));function unsafeStringify(ae,e=0){return byteToHex[ae[e+0]]+byteToHex[ae[e+1]]+byteToHex[ae[e+2]]+byteToHex[ae[e+3]]+"-"+byteToHex[ae[e+4]]+byteToHex[ae[e+5]]+"-"+byteToHex[ae[e+6]]+byteToHex[ae[e+7]]+"-"+byteToHex[ae[e+8]]+byteToHex[ae[e+9]]+"-"+byteToHex[ae[e+10]]+byteToHex[ae[e+11]]+byteToHex[ae[e+12]]+byteToHex[ae[e+13]]+byteToHex[ae[e+14]]+byteToHex[ae[e+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native={randomUUID};function v4(ae,e,I){if(native.randomUUID&&!e&&!ae)return native.randomUUID();ae=ae||{};const oe=ae.random||(ae.rng||rng)();return oe[6]=oe[6]&15|64,oe[8]=oe[8]&63|128,unsafeStringify(oe)}class BroadcasterResult{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}class InsertResult{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const I=new this;return I.raw=e.raw,I}}class ReturningResultsEntityUpdator{constructor(e,I){this.queryRunner=e,this.expressionMap=I}async update(e,I){const oe=this.expressionMap.mainAlias.metadata;await Promise.all(I.map(async(ue,bt)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((ir,lr,dr)=>(ir[this.expressionMap.extraReturningColumns[dr].databaseName]=lr[0],ir),{}));const tr=Array.isArray(e.raw)?e.raw[bt]:e.raw,rr=this.queryRunner.connection.driver.createGeneratedMap(oe,tr);rr&&(this.queryRunner.manager.merge(oe.target,ue,rr),e.generatedMaps.push(rr))}else{const tr=this.expressionMap.extraReturningColumns;if(tr.length>0){const rr=this.expressionMap.mainAlias.metadata.getEntityIdMap(ue);if(!rr)throw new TypeORMError("Cannot update entity because entity id is not set in the entity.");const ir=await this.queryRunner.manager.createQueryBuilder().select(oe.primaryColumns.map(lr=>oe.targetName+"."+lr.propertyPath)).addSelect(tr.map(lr=>oe.targetName+"."+lr.propertyPath)).from(oe.target,oe.targetName).where(rr).withDeleted().setOption("create-pojo").getOne();ir&&(this.queryRunner.manager.merge(oe.target,ue,ir),e.generatedMaps.push(ir))}}}))}async insert(e,I){const oe=this.expressionMap.mainAlias.metadata;let ue=oe.getInsertionReturningColumns();const bt=this.queryRunner.connection.driver.isReturningSqlSupported("insert");ue=ue.filter(rr=>rr.isGenerated?bt===!0:!0);const tr=I.map((rr,ir)=>{this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((pr,hr,_r)=>(pr[this.expressionMap.extraReturningColumns[_r].databaseName]=hr[0],pr),{}));const lr=Array.isArray(e.raw)?e.raw[ir]:e.raw,dr=this.queryRunner.connection.driver.createGeneratedMap(oe,lr,ir,I.length)||{};return ir in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(oe.target,dr,this.expressionMap.locallyGenerated[ir]),this.queryRunner.manager.merge(oe.target,rr,dr),dr});if(ue.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const rr=I.map(lr=>{const dr=oe.getEntityIdMap(lr);if(!dr)throw new TypeORMError("Cannot update entity because entity id is not set in the entity.");return dr}),ir=await this.queryRunner.manager.createQueryBuilder().select(oe.primaryColumns.map(lr=>oe.targetName+"."+lr.propertyPath)).addSelect(ue.map(lr=>oe.targetName+"."+lr.propertyPath)).from(oe.target,oe.targetName).where(rr).setOption("create-pojo").getMany();I.forEach((lr,dr)=>{this.queryRunner.manager.merge(oe.target,tr[dr],ir[dr]),this.queryRunner.manager.merge(oe.target,lr,ir[dr])})}I.forEach((rr,ir)=>{const lr=oe.getEntityIdMap(rr);e.identifiers.push(lr),e.generatedMaps.push(tr[ir])})}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion)}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion||e.isDeleteDate)}}class InsertQueryBuilder extends QueryBuilder{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.getValueSets();if(e.length===0)return new InsertResult;const I=this.obtainQueryRunner();let oe=!1;try{if(this.expressionMap.useTransaction===!0&&I.isTransactionActive===!1&&(await I.startTransaction(),oe=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const yr=new BroadcasterResult;e.forEach(wr=>{I.broadcaster.broadcastBeforeInsertEvent(yr,this.expressionMap.mainAlias.metadata,wr)}),await yr.wait()}let ue=null,bt=null;const tr=new ReturningResultsEntityUpdator(I,this.expressionMap),rr=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const yr of this.expressionMap.returning)rr.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(yr));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver.options.type==="oracle"||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),rr.push(...this.expressionMap.extraReturningColumns.filter(yr=>!rr.includes(yr)))),rr.length>0&&this.connection.driver.options.type==="mssql"&&(ue=this.connection.driver.buildTableVariableDeclaration("@OutputTable",rr),bt="SELECT * FROM @OutputTable");const[ir,lr]=this.getQueryAndParameters(),pr=[ue,ir,bt].filter(yr=>yr!=null).join(`;

`),hr=await I.query(pr,lr,!0),_r=InsertResult.from(hr);if(this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&await tr.insert(_r,e),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const yr=new BroadcasterResult;e.forEach(wr=>{I.broadcaster.broadcastAfterInsertEvent(yr,this.expressionMap.mainAlias.metadata,wr)}),await yr.wait()}return oe&&await I.commitTransaction(),_r}catch(ue){if(oe)try{await I.rollbackTransaction()}catch{}throw ue}finally{I!==this.queryRunner&&await I.release()}}into(e,I){e=InstanceChecker.isEntitySchema(e)?e.options.name:e;const oe=this.createFromAlias(e);return this.expressionMap.setMainAlias(oe),this.expressionMap.insertColumns=I||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,I,oe){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:I,skipUpdateIfNoValuesChanged:oe?.skipUpdateIfNoValuesChanged,indexPredicate:oe?.indexPredicate,upsertType:oe?.upsertType},this):(this.expressionMap.onUpdate={conflict:e?.conflict_target,columns:e?.columns,overwrite:e?.overwrite,skipUpdateIfNoValuesChanged:oe?.skipUpdateIfNoValuesChanged,upsertType:oe?.upsertType},this)}createInsertExpression(){const e=this.getTableName(this.getMainTableName()),I=this.createValuesExpression(),oe=this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),ue=this.createColumnNamesExpression();let bt="INSERT ";if(this.expressionMap.onUpdate?.upsertType==="primary-key"&&(bt="UPSERT "),(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(bt+=`${this.expressionMap.onIgnore?" IGNORE ":""}`),bt+=`INTO ${e}`,this.alias!==this.getMainTableName()&&DriverUtils.isPostgresFamily(this.connection.driver)&&(bt+=` AS "${this.alias}"`),ue?bt+=`(${ue})`:!I&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(bt+="()"),oe&&this.connection.driver.options.type==="mssql"&&(bt+=` OUTPUT ${oe}`),I?(this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="sap")&&this.getValueSets().length>1?bt+=` ${I}`:bt+=` VALUES ${I}`:DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"?bt+=" VALUES ()":bt+=" DEFAULT VALUES",this.expressionMap.onUpdate?.upsertType!=="primary-key"){if(this.connection.driver.supportedUpsertTypes.includes("on-conflict-do-update")){if(this.expressionMap.onIgnore)bt+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)bt+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:tr,columns:rr,conflict:ir,skipUpdateIfNoValuesChanged:lr,indexPredicate:dr}=this.expressionMap.onUpdate;let pr="ON CONFLICT";if(Array.isArray(ir)){if(pr+=` ( ${ir.map(_r=>this.escape(_r)).join(", ")} )`,dr&&!DriverUtils.isPostgresFamily(this.connection.driver))throw new TypeORMError("indexPredicate option is not supported by the current database driver");dr&&DriverUtils.isPostgresFamily(this.connection.driver)&&(pr+=` WHERE ( ${dr} )`)}else ir&&(pr+=` ON CONSTRAINT ${this.escape(ir)}`);const hr=[];Array.isArray(tr)?hr.push(...tr.map(_r=>`${this.escape(_r)} = EXCLUDED.${this.escape(_r)}`)):rr&&hr.push(...rr.map(_r=>`${this.escape(_r)} = :${_r}`)),hr.length>0&&(bt+=` ${pr} DO UPDATE SET `,hr.push(...this.expressionMap.mainAlias.metadata.columns.filter(_r=>_r.isUpdateDate&&!tr?.includes(_r.databaseName)&&!(this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1||DriverUtils.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")).map(_r=>`${this.escape(_r.databaseName)} = DEFAULT`)),bt+=hr.join(", "),bt+=" "),Array.isArray(tr)&&lr&&DriverUtils.isPostgresFamily(this.connection.driver)&&(bt+=" WHERE (",bt+=tr.map(_r=>`${e}.${this.escape(_r)} IS DISTINCT FROM EXCLUDED.${this.escape(_r)}`).join(" OR "),bt+=") ")}}else if(this.connection.driver.supportedUpsertTypes.includes("on-duplicate-key-update")){if(this.expressionMap.onUpdate){const{overwrite:tr,columns:rr}=this.expressionMap.onUpdate;Array.isArray(tr)?(bt+=" ON DUPLICATE KEY UPDATE ",bt+=tr.map(ir=>`${this.escape(ir)} = VALUES(${this.escape(ir)})`).join(", "),bt+=" "):Array.isArray(rr)&&(bt+=" ON DUPLICATE KEY UPDATE ",bt+=rr.map(ir=>`${this.escape(ir)} = :${ir}`).join(", "),bt+=" ")}}else if(this.expressionMap.onUpdate)throw new TypeORMError("onUpdate is not supported by the current database driver")}return oe&&(DriverUtils.isPostgresFamily(this.connection.driver)||this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="cockroachdb"||DriverUtils.isMySQLFamily(this.connection.driver))&&(bt+=` RETURNING ${oe}`),this.connection.driver.options.type==="mssql"&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(tr=>this.expressionMap.insertColumns.length>0?this.expressionMap.insertColumns.indexOf(tr.propertyPath)!==-1:tr.isInsert).some(tr=>this.isOverridingAutoIncrementBehavior(tr))&&(bt=`SET IDENTITY_INSERT ${e} ON; ${bt}; SET IDENTITY_INSERT ${e} OFF`),bt}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(e=>this.expressionMap.insertColumns.length?this.expressionMap.insertColumns.indexOf(e.propertyPath)!==-1:!(!e.isInsert||e.isGenerated&&e.generationStrategy==="increment"&&this.connection.driver.options.type!=="spanner"&&this.connection.driver.options.type!=="oracle"&&!DriverUtils.isSQLiteFamily(this.connection.driver)&&!DriverUtils.isMySQLFamily(this.connection.driver)&&this.connection.driver.options.type!=="aurora-mysql"&&!(this.connection.driver.options.type==="mssql"&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map(I=>this.escape(I.databaseName)).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const I=this.getValueSets();if(I.length===1)return Object.keys(I[0]).map(oe=>this.escape(oe)).join(", ")}return this.expressionMap.insertColumns.map(I=>this.escape(I)).join(", ")}createValuesExpression(){const e=this.getValueSets(),I=this.getInsertedColumns();if(I.length>0){let oe="";return e.forEach((ue,bt)=>{I.forEach((tr,rr)=>{rr===0&&(this.connection.driver.options.type==="oracle"&&e.length>1||this.connection.driver.options.type==="sap"&&e.length>1?oe+=" SELECT ":oe+="(");let ir=tr.getEntityValue(ue);if(typeof ir!="function"&&(ir=this.connection.driver.preparePersistentValue(ir,tr)),tr.isVersion&&ir===void 0)oe+="1";else if(tr.isDiscriminator)oe+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(tr.isGenerated&&tr.generationStrategy==="uuid"&&!this.connection.driver.isUUIDGenerationSupported()&&ir===void 0)ir=v4(),oe+=this.createParameter(ir),bt in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[bt]={}),tr.setEntityValue(this.expressionMap.locallyGenerated[bt],ir);else if(ir===void 0)this.connection.driver.options.type==="oracle"&&e.length>1||DriverUtils.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?tr.default!==void 0&&tr.default!==null?oe+=this.connection.driver.normalizeDefault(tr):oe+="NULL":oe+="DEFAULT";else if(ir===null&&this.connection.driver.options.type==="spanner")oe+="NULL";else if(typeof ir=="function")oe+=ir();else{this.connection.driver.options.type==="mssql"&&(ir=this.connection.driver.parametrizeValue(tr,ir));const lr=this.createParameter(ir);if((DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(tr.type)!==-1){const pr=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";tr.srid!=null?oe+=`${pr}(${lr}, ${tr.srid})`:oe+=`${pr}(${lr})`}else DriverUtils.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(tr.type)!==-1?tr.srid!=null?oe+=`ST_SetSRID(ST_GeomFromGeoJSON(${lr}), ${tr.srid})::${tr.type}`:oe+=`ST_GeomFromGeoJSON(${lr})::${tr.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(tr.type)!==-1?oe+=tr.type+"::STGeomFromText("+lr+", "+(tr.srid||"0")+")":oe+=lr}rr===I.length-1?bt===e.length-1?this.connection.driver.options.type==="oracle"&&e.length>1?oe+=" FROM DUAL ":this.connection.driver.options.type==="sap"&&e.length>1?oe+=" FROM dummy ":oe+=")":this.connection.driver.options.type==="oracle"&&e.length>1?oe+=" FROM DUAL UNION ALL ":this.connection.driver.options.type==="sap"&&e.length>1?oe+=" FROM dummy UNION ALL ":oe+="), ":oe+=", "})}),oe==="()"?"":oe}else{let oe="";return e.forEach((ue,bt)=>{Object.keys(ue).forEach((rr,ir)=>{ir===0&&(oe+="(");const lr=ue[rr];typeof lr=="function"?oe+=lr():lr===void 0?this.connection.driver.options.type==="oracle"&&e.length>1||DriverUtils.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?oe+="NULL":oe+="DEFAULT":lr===null&&this.connection.driver.options.type==="spanner"||(oe+=this.createParameter(lr)),ir===Object.keys(ue).length-1?bt===e.length-1?oe+=")":oe+="), ":oe+=", "})}),oe==="()"?"":oe}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(ObjectUtils.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new InsertValuesMissingError}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&e.generationStrategy==="increment"&&this.getValueSets().some(I=>e.getEntityValue(I)!==void 0&&e.getEntityValue(I)!==null)}}class RelationUpdater{constructor(e,I){this.queryBuilder=e,this.expressionMap=I}async update(e){const I=this.expressionMap.relationMetadata;if(I.isManyToOne||I.isOneToOneOwner){const oe=I.joinColumns.reduce((ue,bt)=>{const tr=ObjectUtils.isObject(e)?bt.referencedColumn.getEntityValue(e):e;return bt.setEntityValue(ue,tr),ue},{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(I.entityMetadata.target).set(oe).whereInIds(this.expressionMap.of).execute()}else if((I.isOneToOneNotOwner||I.isOneToMany)&&e===null){const oe={};I.inverseRelation.joinColumns.forEach(ir=>{oe[ir.propertyName]=null});const ue=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],bt={},tr=[];ue.forEach((ir,lr)=>{I.inverseRelation.joinColumns.map((dr,pr)=>{const hr="joinColumn_"+lr+"_"+pr;bt[hr]=ObjectUtils.isObject(ir)?dr.referencedColumn.getEntityValue(ir):ir,tr.push(`${dr.propertyPath} = :${hr}`)})});const rr=tr.map(ir=>"("+ir+")").join(" OR ");if(!rr)return;await this.queryBuilder.createQueryBuilder().update(I.inverseEntityMetadata.target).set(oe).where(rr).setParameters(bt).execute()}else if(I.isOneToOneNotOwner||I.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new TypeORMError("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const oe=this.expressionMap.of,ue=I.inverseRelation.joinColumns.reduce((bt,tr)=>{const rr=ObjectUtils.isObject(oe)?tr.referencedColumn.getEntityValue(oe):oe;return tr.setEntityValue(bt,rr),bt},{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(I.inverseEntityMetadata.target).set(ue).whereInIds(e).execute()}else{const oe=I.junctionEntityMetadata,ue=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],bt=Array.isArray(e)?e:[e],tr=I.isManyToManyOwner?ue:bt,rr=I.isManyToManyOwner?bt:ue,ir=[];if(tr.forEach(lr=>{rr.forEach(dr=>{const pr={};oe.ownerColumns.forEach(hr=>{pr[hr.databaseName]=ObjectUtils.isObject(lr)?hr.referencedColumn.getEntityValue(lr):lr}),oe.inverseColumns.forEach(hr=>{pr[hr.databaseName]=ObjectUtils.isObject(dr)?hr.referencedColumn.getEntityValue(dr):dr}),ir.push(pr)})}),!ir.length)return;this.queryBuilder.connection.driver.options.type==="oracle"||this.queryBuilder.connection.driver.options.type==="sap"?await Promise.all(ir.map(lr=>this.queryBuilder.createQueryBuilder().insert().into(oe.tableName).values(lr).execute())):await this.queryBuilder.createQueryBuilder().insert().into(oe.tableName).values(ir).execute()}}}class RelationRemover{constructor(e,I){this.queryBuilder=e,this.expressionMap=I}async remove(e){const I=this.expressionMap.relationMetadata;if(I.isOneToMany){const oe=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],ue=Array.isArray(e)?e:[e],bt={};I.inverseRelation.joinColumns.forEach(lr=>{bt[lr.propertyName]=null});const tr={},rr=[];oe.forEach((lr,dr)=>{rr.push(...ue.map((pr,hr)=>[...I.inverseRelation.joinColumns.map((_r,yr)=>{const wr="joinColumn_"+dr+"_"+hr+"_"+yr;return tr[wr]=ObjectUtils.isObject(lr)?_r.referencedColumn.getEntityValue(lr):lr,`${_r.propertyPath} = :${wr}`}),...I.inverseRelation.entityMetadata.primaryColumns.map((_r,yr)=>{const wr="primaryColumn_"+hr+"_"+hr+"_"+yr;return tr[wr]=ObjectUtils.isObject(pr)?_r.getEntityValue(pr):pr,`${_r.propertyPath} = :${wr}`})].join(" AND ")))});const ir=rr.map(lr=>"("+lr+")").join(" OR ");if(!ir)return;await this.queryBuilder.createQueryBuilder().update(I.inverseEntityMetadata.target).set(bt).where(ir).setParameters(tr).execute()}else{const oe=I.junctionEntityMetadata,ue=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],bt=Array.isArray(e)?e:[e],tr=I.isManyToManyOwner?ue:bt,rr=I.isManyToManyOwner?bt:ue,ir={},lr=[];tr.forEach((pr,hr)=>{lr.push(...rr.map((_r,yr)=>[...oe.ownerColumns.map((wr,Tr)=>{const Ar="firstValue_"+hr+"_"+yr+"_"+Tr;return ir[Ar]=ObjectUtils.isObject(pr)?wr.referencedColumn.getEntityValue(pr):pr,`${wr.databaseName} = :${Ar}`}),...oe.inverseColumns.map((wr,Tr)=>{const Ar="secondValue_"+hr+"_"+yr+"_"+Tr;return ir[Ar]=ObjectUtils.isObject(_r)?wr.referencedColumn.getEntityValue(_r):_r,`${wr.databaseName} = :${Ar}`})].join(" AND ")))});const dr=lr.map(pr=>"("+pr+")").join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(oe.tableName).where(dr).setParameters(ir).execute()}}}class RelationQueryBuilder extends QueryBuilder{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const I=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(I.isManyToMany||I.isOneToMany)throw new TypeORMError(`Set operation is only supported for many-to-one and one-to-one relations. However given "${I.propertyPath}" has ${I.relationType} relation. Use .add() method instead.`);if(I.joinColumns&&I.joinColumns.length>1&&(!ObjectUtils.isObject(e)||Object.keys(e).length<I.joinColumns.length))throw new TypeORMError('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new RelationUpdater(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&e.length===0)return;const I=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(I.isManyToOne||I.isOneToOne)throw new TypeORMError(`Add operation is only supported for many-to-many and one-to-many relations. However given "${I.propertyPath}" has ${I.relationType} relation. Use .set() method instead.`);if(I.joinColumns&&I.joinColumns.length>1&&(!ObjectUtils.isObject(e)||Object.keys(e).length<I.joinColumns.length))throw new TypeORMError('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new RelationUpdater(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&e.length===0)return;const I=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(I.isManyToOne||I.isOneToOne)throw new TypeORMError(`Add operation is only supported for many-to-many and one-to-many relations. However given "${I.propertyPath}" has ${I.relationType} relation. Use .set(null) method instead.`);return new RelationRemover(this,this.expressionMap).remove(e)}async addAndRemove(e,I){await this.remove(I),await this.add(e)}async loadOne(){return this.loadMany().then(e=>e[0])}async loadMany(){let e=this.expressionMap.of;if(!ObjectUtils.isObject(e)){const I=this.expressionMap.mainAlias.metadata;if(I.hasMultiplePrimaryKeys)throw new TypeORMError("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=I.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}class OrmUtils{static chunk(e,I){return Array.from(Array(Math.ceil(e.length/I)),(oe,ue)=>e.slice(ue*I,ue*I+I))}static splitClassesAndStrings(e){return[e.filter(I=>typeof I!="string"),e.filter(I=>typeof I=="string")]}static groupBy(e,I){return e.reduce((oe,ue)=>{const bt=I(ue);let tr=oe.find(rr=>rr.id===bt);return tr||(tr={id:bt,items:[]},oe.push(tr)),tr.items.push(ue),oe},[])}static uniq(e,I){return e.reduce((oe,ue)=>{let bt=!1;if(typeof I=="function"){const tr=I(ue);bt=!!oe.find(rr=>I(rr)===tr)}else typeof I=="string"?bt=!!oe.find(tr=>tr[I]===ue[I]):bt=oe.indexOf(ue)!==-1;return bt||oe.push(ue),oe},[])}static isPlainObject(e){return e==null?!1:!e.constructor||e.constructor===Object}static mergeArrayKey(e,I,oe,ue){if(ue.has(oe)){e[I]=ue.get(oe);return}if(!(oe instanceof Promise)){if(!this.isPlainObject(oe)&&!Array.isArray(oe)){e[I]=oe;return}e[I]||(e[I]=Array.isArray(oe)?[]:{}),ue.set(oe,e[I]),this.merge(e[I],oe,ue),ue.delete(oe)}}static mergeObjectKey(e,I,oe,ue){if(ue.has(oe)){Object.assign(e,{[I]:ue.get(oe)});return}if(!(oe instanceof Promise)){if(!this.isPlainObject(oe)&&!Array.isArray(oe)){Object.assign(e,{[I]:oe});return}e[I]||Object.assign(e,{[I]:Array.isArray(oe)?[]:{}}),ue.set(oe,e[I]),this.merge(e[I],oe,ue),ue.delete(oe)}}static merge(e,I,oe=new Map){if(this.isPlainObject(e)&&this.isPlainObject(I))for(const ue of Object.keys(I))ue!=="__proto__"&&this.mergeObjectKey(e,ue,I[ue],oe);if(Array.isArray(e)&&Array.isArray(I))for(let ue=0;ue<I.length;ue++)this.mergeArrayKey(e,ue,I[ue],oe)}static mergeDeep(e,...I){if(!I.length)return e;for(const oe of I)OrmUtils.merge(e,oe);return e}static deepCompare(...e){let I,oe,ue,bt;if(arguments.length<1)return!0;for(I=1,oe=arguments.length;I<oe;I++)if(ue=[],bt=[],!this.compare2Objects(ue,bt,arguments[0],arguments[I]))return!1;return!0}static deepValue(e,I){const oe=I.split(".");for(let ue=0,bt=oe.length;ue<bt;ue++)e=e[oe[ue]];return e}static replaceEmptyObjectsWithBooleans(e){for(let I in e)e[I]&&typeof e[I]=="object"&&(Object.keys(e[I]).length===0?e[I]=!0:this.replaceEmptyObjectsWithBooleans(e[I]))}static propertyPathsToTruthyObject(e){let I={};for(let oe of e){const ue=oe.split(".");if(!ue.length)continue;(!I[ue[0]]||I[ue[0]]===!0)&&(I[ue[0]]={});let bt=I[ue[0]];for(let[tr,rr]of ue.entries())tr!==0&&(bt[rr]?bt=bt[rr]:tr===ue.length-1?(bt[rr]={},bt=null):(bt[rr]={},bt=bt[rr]))}return this.replaceEmptyObjectsWithBooleans(I),I}static compareIds(e,I){return e==null||I===void 0||I===null?!1:(typeof e.id=="string"&&typeof I.id=="string"||typeof e.id=="number"&&typeof I.id=="number")&&Object.keys(e).length===1&&Object.keys(I).length===1?e.id===I.id:OrmUtils.deepCompare(e,I)}static toBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e==="true"||e==="1":typeof e=="number"?e>0:!1}static zipObject(e,I){return e.reduce((oe,ue,bt)=>(oe[ue]=I[bt],oe),{})}static isArraysEqual(e,I){return e.length!==I.length?!1:e.every(oe=>I.indexOf(oe)!==-1)}static areMutuallyExclusive(...e){return!e.some(oe=>{const ue=e.filter(bt=>bt!==oe);return oe.some(bt=>ue.some(tr=>tr.includes(bt)))})}static parseSqlCheckExpression(e,I){const oe=e.match(new RegExp(`"${I}" varchar CHECK\\s*\\(\\s*"${I}"\\s+IN\\s*`));if(oe&&oe.index){const bt=e.substring(oe.index+oe[0].length);let tr="",rr="";const ir=[];for(let lr=0;lr<bt.length;lr++){const dr=bt[lr];switch(dr){case",":tr==""?(ir.push(rr),rr=""):rr+=dr;break;case"'":tr==dr?bt[lr+1]===dr?(rr+=dr,lr+=1):tr="":tr=dr;break;case")":if(tr=="")return ir.push(rr),ir;rr+=dr;break;default:tr!=""&&(rr+=dr)}}}}static compare2Objects(e,I,oe,ue){let bt;if(Number.isNaN(oe)&&Number.isNaN(ue)||oe===ue)return!0;if(oe===null||ue===null||oe===void 0||ue===void 0)return!1;if((typeof oe.equals=="function"||typeof oe.equals=="function")&&oe.equals(ue))return!0;if(typeof oe=="function"&&typeof ue=="function"||oe instanceof Date&&ue instanceof Date||oe instanceof RegExp&&ue instanceof RegExp||typeof oe=="string"&&typeof ue=="string"||typeof oe=="number"&&typeof ue=="number")return oe.toString()===ue.toString();if(!(typeof oe=="object"&&typeof ue=="object")||Object.prototype.isPrototypeOf.call(oe,ue)||Object.prototype.isPrototypeOf.call(ue,oe)||oe.constructor!==ue.constructor||oe.prototype!==ue.prototype||e.indexOf(oe)>-1||I.indexOf(ue)>-1)return!1;for(bt in ue){if(ue.hasOwnProperty(bt)!==oe.hasOwnProperty(bt))return!1;if(typeof ue[bt]!=typeof oe[bt])return!1}for(bt in oe){if(ue.hasOwnProperty(bt)!==oe.hasOwnProperty(bt))return!1;if(typeof ue[bt]!=typeof oe[bt])return!1;switch(typeof oe[bt]){case"object":case"function":if(e.push(oe),I.push(ue),!this.compare2Objects(e,I,oe[bt],ue[bt]))return!1;e.pop(),I.pop();break;default:if(oe[bt]!==ue[bt])return!1;break}}return!0}}class RawSqlResultsToEntityTransformer{constructor(e,I,oe,ue,bt){this.expressionMap=e,this.driver=I,this.rawRelationIdResults=oe,this.rawRelationCountResults=ue,this.queryRunner=bt}transform(e,I){const oe=this.group(e,I),ue=[];return oe.forEach(bt=>{const tr=this.transformRawResultsGroup(bt,I);tr!==void 0&&!Object.values(tr).every(rr=>rr===null)&&ue.push(tr)}),ue}group(e,I){const oe=new Map,ue=[];return I.metadata.tableType==="view"?ue.push(...I.metadata.columns.map(bt=>DriverUtils.buildAlias(this.driver,void 0,I.name,bt.databaseName))):ue.push(...I.metadata.primaryColumns.map(bt=>DriverUtils.buildAlias(this.driver,void 0,I.name,bt.databaseName))),e.forEach(bt=>{const tr=ue.map(ir=>{const lr=bt[ir];return Buffer$7.isBuffer(lr)?lr.toString("hex"):ObjectUtils.isObject(lr)?JSON.stringify(lr):lr}).join("_"),rr=oe.get(tr);rr?rr.push(bt):oe.set(tr,[bt])}),oe}transformRawResultsGroup(e,I){let oe=I.metadata;if(oe.discriminatorColumn){const dr=e.map(hr=>hr[DriverUtils.buildAlias(this.driver,void 0,I.name,I.metadata.discriminatorColumn.databaseName)]),pr=oe.childEntityMetadatas.find(hr=>typeof dr.find(_r=>_r===hr.discriminatorValue)<"u");pr&&(oe=pr)}let ue=oe.create(this.queryRunner,{fromDeserializer:!0,pojo:this.expressionMap.options.indexOf("create-pojo")!==-1});const bt=this.transformColumns(e,I,ue,oe),tr=this.transformJoins(e,ue,I,oe),rr=this.transformRelationIds(e,I,ue,oe),ir=this.transformRelationCounts(e,I,ue);if(bt||oe.primaryColumns.filter(dr=>dr.isVirtual===!1).length===0&&(tr||rr||ir))return ue}transformColumns(e,I,oe,ue){let bt=!1;return ue.columns.forEach(tr=>{if(ue.childEntityMetadatas.length>0&&ue.childEntityMetadatas.findIndex(ir=>ir.target===tr.target)!==-1)return;const rr=e[0][DriverUtils.buildAlias(this.driver,void 0,I.name,tr.databaseName)];rr===void 0||tr.isVirtual||this.expressionMap.selects.find(ir=>ir.selection===I.name||ir.selection===I.name+"."+tr.propertyPath)&&(tr.setEntityValue(oe,this.driver.prepareHydratedValue(rr,tr)),rr!==null&&(bt=!0))}),bt}transformJoins(e,I,oe,ue){let bt=!1;return this.expressionMap.joinAttributes.forEach(tr=>{if(!tr.metadata||!tr.isSelected||tr.relation&&!ue.relations.find(ir=>ir===tr.relation))return;if(tr.mapToProperty){if(tr.mapToPropertyParentAlias!==oe.name)return}else if(!tr.relation||tr.parentAlias!==oe.name||tr.relationPropertyPath!==tr.relation.propertyPath)return;let rr=this.transform(e,tr.alias);rr=tr.isMany?rr:rr[0],rr=!tr.isMany&&rr===void 0?null:rr,rr!==void 0&&(tr.mapToPropertyPropertyName?I[tr.mapToPropertyPropertyName]=rr:tr.relation.setEntityValue(I,rr),bt=!0)}),bt}transformRelationIds(e,I,oe,ue){let bt=!1;return this.rawRelationIdResults.forEach((tr,rr)=>{if(tr.relationIdAttribute.parentAlias!==I.name)return;const ir=tr.relationIdAttribute.relation,lr=this.createValueMapFromJoinColumns(ir,tr.relationIdAttribute.parentAlias,e);if(lr==null)return;this.prepareDataForTransformRelationIds();const dr=this.hashEntityIds(ir,lr),pr=this.relationIdMaps[rr][dr]||[],hr=tr.relationIdAttribute.mapToPropertyPropertyPath.split("."),_r=(yr,wr,Tr)=>{const Ar=yr.shift();if(Ar&&yr.length===0)return wr[Ar]=Tr,wr;if(Ar&&yr.length>0)_r(yr,wr[Ar],Tr);else return wr};ir.isOneToOne||ir.isManyToOne?pr[0]!==void 0&&(_r(hr,oe,pr[0]),bt=!0):(_r(hr,oe,pr),bt=bt||pr.length>0)}),bt}transformRelationCounts(e,I,oe){let ue=!1;return this.rawRelationCountResults.filter(bt=>bt.relationCountAttribute.parentAlias===I.name).forEach(bt=>{const tr=bt.relationCountAttribute.relation;let rr;tr.isOneToMany?rr=tr.inverseRelation.joinColumns[0].referencedColumn.databaseName:rr=tr.isOwning?tr.joinColumns[0].referencedColumn.databaseName:tr.inverseRelation.joinColumns[0].referencedColumn.databaseName;const ir=e[0][DriverUtils.buildAlias(this.driver,void 0,I.name,rr)];ir!=null&&(oe[bt.relationCountAttribute.mapToPropertyPropertyName]=0,bt.results.filter(lr=>lr.parentId===ir).forEach(lr=>{oe[bt.relationCountAttribute.mapToPropertyPropertyName]=parseInt(lr.cnt),ue=!0}))}),ue}createValueMapFromJoinColumns(e,I,oe){let ue;return e.isManyToOne||e.isOneToOneOwner?ue=e.entityMetadata.primaryColumns.map(bt=>bt):e.isOneToMany||e.isOneToOneNotOwner?ue=e.inverseRelation.joinColumns.map(bt=>bt):e.isOwning?ue=e.joinColumns.map(bt=>bt):ue=e.inverseRelation.inverseJoinColumns.map(bt=>bt),ue.reduce((bt,tr)=>(oe.forEach(rr=>{e.isManyToOne||e.isOneToOneOwner?bt[tr.databaseName]=this.driver.prepareHydratedValue(rr[DriverUtils.buildAlias(this.driver,void 0,I,tr.databaseName)],tr):bt[tr.databaseName]=this.driver.prepareHydratedValue(rr[DriverUtils.buildAlias(this.driver,void 0,I,tr.referencedColumn.databaseName)],tr.referencedColumn)}),bt),{})}extractEntityPrimaryIds(e,I){let oe;return e.isManyToOne||e.isOneToOneOwner?oe=e.entityMetadata.primaryColumns.map(ue=>ue):e.isOneToMany||e.isOneToOneNotOwner?oe=e.inverseRelation.joinColumns.map(ue=>ue):e.isOwning?oe=e.joinColumns.map(ue=>ue):oe=e.inverseRelation.inverseJoinColumns.map(ue=>ue),oe.reduce((ue,bt)=>(ue[bt.databaseName]=I[bt.databaseName],ue),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map(e=>{const I=e.relationIdAttribute.relation;let oe;return I.isManyToOne||I.isOneToOneOwner?oe=I.joinColumns:I.isOneToMany||I.isOneToOneNotOwner?oe=I.inverseEntityMetadata.primaryColumns:I.isOwning?oe=I.inverseJoinColumns:oe=I.inverseRelation.joinColumns,e.results.reduce((ue,bt)=>{let tr=oe.reduce((rr,ir)=>{let lr=bt[ir.databaseName];return I.isOneToMany||I.isOneToOneNotOwner?(ir.isVirtual&&ir.referencedColumn&&ir.referencedColumn.propertyName!==ir.propertyName&&(lr=ir.referencedColumn.createValueMap(lr)),OrmUtils.mergeDeep(rr,ir.createValueMap(lr))):(!ir.isPrimary&&ir.referencedColumn.referencedColumn&&(lr=ir.referencedColumn.referencedColumn.createValueMap(lr)),OrmUtils.mergeDeep(rr,ir.referencedColumn.createValueMap(lr)))},{});if(oe.length===1&&!e.relationIdAttribute.disableMixedMap&&(I.isOneToMany||I.isOneToOneNotOwner?tr=oe[0].getEntityValue(tr):tr=oe[0].referencedColumn.getEntityValue(tr)),tr!==void 0){const rr=this.hashEntityIds(I,bt);ue[rr]?ue[rr].push(tr):ue[rr]=[tr]}return ue},{})}))}hashEntityIds(e,I){const oe=this.extractEntityPrimaryIds(e,I);return JSON.stringify(oe)}}let RelationIdLoader$1=class{constructor(e,I,oe){this.connection=e,this.queryRunner=I,this.relationIdAttributes=oe}async load(e){const I=this.relationIdAttributes.map(async oe=>{if(oe.relation.isManyToOne||oe.relation.isOneToOneOwner){if(oe.queryBuilderFactory)throw new TypeORMError("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const ue={},bt=e.map(tr=>{const rr={},ir=[];oe.relation.joinColumns.forEach(dr=>{rr[dr.databaseName]=this.connection.driver.prepareHydratedValue(tr[DriverUtils.buildAlias(this.connection.driver,void 0,oe.parentAlias,dr.databaseName)],dr.referencedColumn);const pr=`${dr.databaseName}:${rr[dr.databaseName]}`;ir.indexOf(pr)===-1&&ir.push(pr)}),oe.relation.entityMetadata.primaryColumns.forEach(dr=>{rr[dr.databaseName]=this.connection.driver.prepareHydratedValue(tr[DriverUtils.buildAlias(this.connection.driver,void 0,oe.parentAlias,dr.databaseName)],dr);const pr=`${dr.databaseName}:${rr[dr.databaseName]}`;ir.indexOf(pr)===-1&&ir.push(pr)}),ir.sort();const lr=ir.join("::");return ue[lr]?null:(ue[lr]=!0,rr)}).filter(tr=>tr);return{relationIdAttribute:oe,results:bt}}else if(oe.relation.isOneToMany||oe.relation.isOneToOneNotOwner){const ue=oe.relation,bt=ue.isOwning?ue.joinColumns:ue.inverseRelation.joinColumns,tr=ue.inverseEntityMetadata.target,rr=ue.inverseEntityMetadata.tableName,ir=oe.alias||rr,lr={},dr={},pr=e.map((wr,Tr)=>{const Ar=[],Sr={},Mr=bt.map(Lr=>{const es=Lr.databaseName+Tr,ss=wr[DriverUtils.buildAlias(this.connection.driver,void 0,oe.parentAlias,Lr.referencedColumn.databaseName)],os=`${ir}:${Lr.propertyPath}:${ss}`;return Ar.indexOf(os)!==-1?"":(Ar.push(os),Sr[es]=ss,ir+"."+Lr.propertyPath+" = :"+es)}).filter(Lr=>Lr).join(" AND ");Ar.sort();const vr=Ar.join("::");return lr[vr]?"":(lr[vr]=!0,Object.assign(dr,Sr),Mr)}).filter(wr=>wr).map(wr=>"("+wr+")").join(" OR ");if(!pr)return{relationIdAttribute:oe,results:[]};const hr=this.connection.createQueryBuilder(this.queryRunner);OrmUtils.uniq([...bt,...ue.inverseRelation.entityMetadata.primaryColumns],wr=>wr.propertyPath).forEach(wr=>{hr.addSelect(ir+"."+wr.propertyPath,wr.databaseName)}),hr.from(tr,ir).where("("+pr+")").setParameters(dr),oe.queryBuilderFactory&&oe.queryBuilderFactory(hr);const yr=await hr.getRawMany();return yr.forEach(wr=>{bt.forEach(Tr=>{wr[Tr.databaseName]=this.connection.driver.prepareHydratedValue(wr[Tr.databaseName],Tr.referencedColumn)}),ue.inverseRelation.entityMetadata.primaryColumns.forEach(Tr=>{wr[Tr.databaseName]=this.connection.driver.prepareHydratedValue(wr[Tr.databaseName],Tr)})}),{relationIdAttribute:oe,results:yr}}else{const ue=oe.relation,bt=ue.isOwning?ue.joinColumns:ue.inverseRelation.inverseJoinColumns,tr=ue.isOwning?ue.inverseJoinColumns:ue.inverseRelation.joinColumns,rr=oe.junctionAlias,ir=oe.joinInverseSideMetadata.tableName,lr=oe.alias||ir,dr=ue.isOwning?ue.junctionEntityMetadata.tableName:ue.inverseRelation.junctionEntityMetadata.tableName,pr=e.map(Mr=>bt.reduce((vr,Lr)=>(vr[Lr.propertyPath]=Mr[DriverUtils.buildAlias(this.connection.driver,void 0,oe.parentAlias,Lr.referencedColumn.databaseName)],vr),{}));if(pr.length===0)return{relationIdAttribute:oe,results:[]};const hr={},_r={},yr=pr.map((Mr,vr)=>{const Lr=[],es={},ss=Object.keys(Mr).map($r=>{const ns=$r+vr,Nr=Mr[$r],zr=`${rr}:${$r}:${Nr}`;return Lr.indexOf(zr)!==-1?"":(Lr.push(zr),es[ns]=Nr,rr+"."+$r+" = :"+ns)}).filter($r=>$r).join(" AND ");Lr.sort();const os=Lr.join("::");return _r[os]?"":(_r[os]=!0,Object.assign(hr,es),ss)}).filter(Mr=>Mr),wr=tr.map(Mr=>rr+"."+Mr.propertyPath+" = "+lr+"."+Mr.referencedColumn.propertyPath).join(" AND "),Tr=yr.map(Mr=>"("+Mr+" AND "+wr+")").join(" OR "),Ar=this.connection.createQueryBuilder(this.queryRunner);tr.forEach(Mr=>{Ar.addSelect(rr+"."+Mr.propertyPath,Mr.databaseName).addOrderBy(rr+"."+Mr.propertyPath)}),bt.forEach(Mr=>{Ar.addSelect(rr+"."+Mr.propertyPath,Mr.databaseName).addOrderBy(rr+"."+Mr.propertyPath)}),Ar.from(ir,lr).innerJoin(dr,rr,Tr).setParameters(hr),oe.queryBuilderFactory&&oe.queryBuilderFactory(Ar);const Sr=await Ar.getRawMany();return Sr.forEach(Mr=>{[...bt,...tr].forEach(vr=>{Mr[vr.databaseName]=this.connection.driver.prepareHydratedValue(Mr[vr.databaseName],vr.referencedColumn)})}),{relationIdAttribute:oe,results:Sr}}});return Promise.all(I)}};class RelationIdLoader{constructor(e,I){this.connection=e,this.queryRunner=I}load(e,I,oe){const ue=Array.isArray(I)?I:[I],bt=Array.isArray(oe)?oe:oe?[oe]:void 0;return e.isManyToMany?this.loadForManyToMany(e,ue,bt):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,ue,bt):this.loadForOneToManyAndOneToOneNotOwner(e,ue,bt)}async loadManyToManyRelationIdsAndGroup(e,I,oe,ue){const bt=e.isManyToMany||e.isOneToMany,tr=Array.isArray(I)?I:[I];if(!oe&&(oe=await this.connection.relationLoader.load(e,I,this.queryRunner,ue),!oe.length))return tr.map(pr=>({entity:pr,related:bt?[]:void 0}));const rr=await this.load(e,I,oe),ir=Array.isArray(oe)?oe:[oe];let lr=[],dr=[];return e.isManyToManyOwner?(lr=e.junctionEntityMetadata.inverseColumns.map(pr=>pr.referencedColumn),dr=e.junctionEntityMetadata.ownerColumns.map(pr=>pr.referencedColumn)):e.isManyToManyNotOwner?(lr=e.junctionEntityMetadata.ownerColumns.map(pr=>pr.referencedColumn),dr=e.junctionEntityMetadata.inverseColumns.map(pr=>pr.referencedColumn)):e.isManyToOne||e.isOneToOneOwner?(lr=e.joinColumns.map(pr=>pr.referencedColumn),dr=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(lr=e.inverseRelation.entityMetadata.primaryColumns,dr=e.inverseRelation.joinColumns.map(pr=>pr.referencedColumn)),tr.map(pr=>{const hr={entity:pr,related:bt?[]:void 0},_r=rr.filter(yr=>dr.every(wr=>wr.compareEntityValue(pr,yr[wr.entityMetadata.name+"_"+wr.propertyAliasName])));return _r.length&&ir.forEach(yr=>{_r.forEach(wr=>{lr.every(Ar=>Ar.compareEntityValue(yr,wr[DriverUtils.buildAlias(this.connection.driver,void 0,Ar.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+Ar.propertyPath.replace(".","_"))]))&&(bt?hr.related.push(yr):hr.related=yr)})}),hr})}loadForManyToMany(e,I,oe){const ue=e.junctionEntityMetadata,bt=ue.name,tr=e.isOwning?ue.ownerColumns:ue.inverseColumns,rr=e.isOwning?ue.inverseColumns:ue.ownerColumns,ir=this.connection.createQueryBuilder(this.queryRunner);tr.forEach(hr=>{const _r=DriverUtils.buildAlias(this.connection.driver,void 0,hr.referencedColumn.entityMetadata.name+"_"+hr.referencedColumn.propertyPath.replace(".","_"));ir.addSelect(bt+"."+hr.propertyPath,_r)}),rr.forEach(hr=>{const _r=DriverUtils.buildAlias(this.connection.driver,void 0,hr.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+hr.referencedColumn.propertyPath.replace(".","_"));ir.addSelect(bt+"."+hr.propertyPath,_r)});let lr="";if(tr.length===1){const hr=I.map(yr=>tr[0].referencedColumn.getEntityValue(yr));hr.every(yr=>typeof yr=="number")?lr=`${bt}.${tr[0].propertyPath} IN (${hr.join(", ")})`:(ir.setParameter("values1",hr),lr=bt+"."+tr[0].propertyPath+" IN (:...values1)")}else lr="("+I.map((hr,_r)=>tr.map(yr=>{const wr="entity1_"+_r+"_"+yr.propertyName;return ir.setParameter(wr,yr.referencedColumn.getEntityValue(hr)),bt+"."+yr.propertyPath+" = :"+wr}).join(" AND ")).map(hr=>"("+hr+")").join(" OR ")+")";let dr="";if(oe)if(rr.length===1){const hr=oe.map(yr=>rr[0].referencedColumn.getEntityValue(yr));hr.every(yr=>typeof yr=="number")?dr=`${bt}.${rr[0].propertyPath} IN (${hr.join(", ")})`:(ir.setParameter("values2",hr),dr=bt+"."+rr[0].propertyPath+" IN (:...values2)")}else dr="("+oe.map((hr,_r)=>rr.map(yr=>{const wr="entity2_"+_r+"_"+yr.propertyName;return ir.setParameter(wr,yr.referencedColumn.getEntityValue(hr)),bt+"."+yr.propertyPath+" = :"+wr}).join(" AND ")).map(hr=>"("+hr+")").join(" OR ")+")";const pr=[lr,dr].filter(hr=>hr.length>0).join(" AND ");return ir.from(ue.target,bt).where(pr).getRawMany()}loadForManyToOneAndOneToOneOwner(e,I,oe){const ue=e.entityMetadata.targetName,bt=e.joinColumns.every(ir=>!!e.entityMetadata.nonVirtualColumns.find(lr=>lr===ir));if(oe&&bt){let ir=[];if(I.forEach(lr=>{let dr={};e.entityMetadata.primaryColumns.forEach(pr=>{const hr=pr.entityMetadata.name+"_"+pr.propertyPath.replace(".","_");dr[hr]=pr.getEntityValue(lr)}),oe.forEach(pr=>{e.joinColumns.forEach(hr=>{const _r=hr.getEntityValue(lr),yr=hr.referencedColumn.getEntityValue(pr);if(!(_r===void 0||yr===void 0)&&_r===yr){const wr=hr.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+hr.referencedColumn.propertyPath.replace(".","_");dr[wr]=yr}})}),Object.keys(dr).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&ir.push(dr)}),ir.length===I.length)return Promise.resolve(ir)}const tr=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(ir=>{const lr=DriverUtils.buildAlias(this.connection.driver,void 0,ir.entityMetadata.name+"_"+ir.propertyPath.replace(".","_"));tr.addSelect(ue+"."+ir.propertyPath,lr)}),e.joinColumns.forEach(ir=>{const lr=DriverUtils.buildAlias(this.connection.driver,void 0,ir.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+ir.referencedColumn.propertyPath.replace(".","_"));tr.addSelect(ue+"."+ir.propertyPath,lr)});let rr="";if(e.entityMetadata.primaryColumns.length===1){const ir=I.map(dr=>e.entityMetadata.primaryColumns[0].getEntityValue(dr));ir.every(dr=>typeof dr=="number")?rr=`${ue}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${ir.join(", ")})`:(tr.setParameter("values",ir),rr=ue+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else rr=I.map((ir,lr)=>e.entityMetadata.primaryColumns.map((dr,pr)=>{const hr="entity"+lr+"_"+pr;return tr.setParameter(hr,dr.getEntityValue(ir)),ue+"."+dr.propertyPath+" = :"+hr}).join(" AND ")).map(ir=>"("+ir+")").join(" OR ");return tr.from(e.entityMetadata.target,ue).where(rr).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,I,oe){if(e=e.inverseRelation,e.entityMetadata.primaryColumns.length===e.joinColumns.length&&e.entityMetadata.primaryColumns.every(ir=>e.joinColumns.indexOf(ir)!==-1))return Promise.resolve(I.map(ir=>{const lr={};return e.joinColumns.forEach(function(dr){const pr=dr.referencedColumn.getEntityValue(ir),hr=dr.referencedColumn.entityMetadata.name+"_"+dr.referencedColumn.propertyPath.replace(".","_"),_r=dr.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+dr.propertyPath.replace(".","_");lr[hr]=pr,lr[_r]=pr}),lr}));const ue=e.entityMetadata.targetName,bt=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(rr=>{const ir=DriverUtils.buildAlias(this.connection.driver,void 0,rr.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+rr.propertyPath.replace(".","_"));bt.addSelect(ue+"."+rr.propertyPath,ir)}),e.joinColumns.forEach(rr=>{const ir=DriverUtils.buildAlias(this.connection.driver,void 0,rr.referencedColumn.entityMetadata.name+"_"+rr.referencedColumn.propertyPath.replace(".","_"));bt.addSelect(ue+"."+rr.propertyPath,ir)});let tr="";if(e.joinColumns.length===1){const rr=I.map(lr=>e.joinColumns[0].referencedColumn.getEntityValue(lr));rr.every(lr=>typeof lr=="number")?tr=`${ue}.${e.joinColumns[0].propertyPath} IN (${rr.join(", ")})`:(bt.setParameter("values",rr),tr=ue+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else tr=I.map((rr,ir)=>e.joinColumns.map((lr,dr)=>{const pr="entity"+ir+"_"+dr;return bt.setParameter(pr,lr.referencedColumn.getEntityValue(rr)),ue+"."+lr.propertyPath+" = :"+pr}).join(" AND ")).map(rr=>"("+rr+")").join(" OR ");return bt.from(e.entityMetadata.target,ue).where(tr).getRawMany()}}class RelationIdMetadataToAttributeTransformer{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(e=>{const I=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(I)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationIds.forEach(I=>{const oe=this.metadataToAttribute(e.alias.name,I);this.expressionMap.relationIdAttributes.push(oe)})})}metadataToAttribute(e,I){return new RelationIdAttribute(this.expressionMap,{relationName:e+"."+I.relation.propertyName,mapToProperty:e+"."+I.propertyName,alias:I.alias,queryBuilderFactory:I.queryBuilderFactory})}}class RelationCountLoader{constructor(e,I,oe){this.connection=e,this.queryRunner=I,this.relationCountAttributes=oe}async load(e){const I=(ue,bt,tr)=>tr.indexOf(ue)===bt,oe=this.relationCountAttributes.map(async ue=>{if(ue.relation.isOneToMany){const bt=ue.relation,tr=bt.inverseRelation,rr=tr.joinColumns[0].referencedColumn.propertyName,ir=bt.inverseEntityMetadata.target,lr=bt.inverseEntityMetadata.tableName,dr=ue.alias||lr,pr=tr.propertyName;let hr=e.map(yr=>yr[ue.parentAlias+"_"+rr]).filter(yr=>!!yr);if(hr=hr.filter(I),hr.length===0)return{relationCountAttribute:ue,results:[]};const _r=this.connection.createQueryBuilder(this.queryRunner);return _r.select(dr+"."+pr,"parentId").addSelect("COUNT(*)","cnt").from(ir,dr).where(dr+"."+pr+" IN (:...ids)").addGroupBy(dr+"."+pr).setParameter("ids",hr),ue.queryBuilderFactory&&ue.queryBuilderFactory(_r),{relationCountAttribute:ue,results:await _r.getRawMany()}}else{let bt,tr,rr,ir;ue.relation.isOwning?(bt=ue.relation.joinColumns[0].referencedColumn.databaseName,tr=ue.relation.inverseJoinColumns[0].referencedColumn.databaseName,rr=ue.relation.junctionEntityMetadata.columns[0],ir=ue.relation.junctionEntityMetadata.columns[1]):(bt=ue.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,tr=ue.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,rr=ue.relation.junctionEntityMetadata.columns[1],ir=ue.relation.junctionEntityMetadata.columns[0]);let lr=e.map(Tr=>Tr[ue.parentAlias+"_"+bt]).filter(Tr=>!!Tr);if(lr=lr.filter(I),lr.length===0)return{relationCountAttribute:ue,results:[]};const dr=ue.junctionAlias,pr=ue.joinInverseSideMetadata.tableName,hr=ue.alias||pr,_r=ue.relation.junctionEntityMetadata.tableName,yr=dr+"."+rr.propertyName+" IN ("+lr.map(Tr=>isNaN(Tr)?"'"+Tr+"'":Tr)+") AND "+dr+"."+ir.propertyName+" = "+hr+"."+tr,wr=this.connection.createQueryBuilder(this.queryRunner);return wr.select(dr+"."+rr.propertyName,"parentId").addSelect("COUNT("+wr.escape(hr)+"."+wr.escape(tr)+")","cnt").from(pr,hr).innerJoin(_r,dr,yr).addGroupBy(dr+"."+rr.propertyName),ue.queryBuilderFactory&&ue.queryBuilderFactory(wr),{relationCountAttribute:ue,results:await wr.getRawMany()}}});return Promise.all(oe)}}class RelationCountMetadataToAttributeTransformer{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(e=>{const I=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(I)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationCounts.forEach(I=>{const oe=this.metadataToAttribute(e.alias.name,I);this.expressionMap.relationCountAttributes.push(oe)})})}metadataToAttribute(e,I){return new RelationCountAttribute(this.expressionMap,{relationName:e+"."+I.relation.propertyName,mapToProperty:e+"."+I.propertyName,alias:I.alias,queryBuilderFactory:I.queryBuilderFactory})}}class FindOptionsUtils{static isFindOneOptions(e){const I=e;return I&&(Array.isArray(I.select)||Array.isArray(I.relations)||typeof I.select=="object"||typeof I.relations=="object"||typeof I.where=="object"||typeof I.join=="object"||typeof I.order=="object"||typeof I.cache=="object"||typeof I.cache=="boolean"||typeof I.cache=="number"||typeof I.comment=="string"||typeof I.lock=="object"||typeof I.loadRelationIds=="object"||typeof I.loadRelationIds=="boolean"||typeof I.loadEagerRelations=="boolean"||typeof I.withDeleted=="boolean"||typeof I.relationLoadStrategy=="string"||typeof I.transaction=="boolean")}static isFindManyOptions(e){const I=e;return I&&(this.isFindOneOptions(I)||typeof I.skip=="number"||typeof I.take=="number"||typeof I.skip=="string"||typeof I.take=="string")}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,I){if(I?.relations){const oe=[...I.relations];if(FindOptionsUtils.applyRelationsRecursively(e,oe,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),oe.length>0)throw new FindRelationsNotFoundError(oe)}return e}static applyRelationsRecursively(e,I,oe,ue,bt){let tr=[];if(bt){const rr=new RegExp("^"+bt.replace(".","\\.")+"\\.");tr=I.filter(ir=>ir.match(rr)).map(ir=>ue.findRelationWithPropertyPath(ir.replace(rr,""))).filter(ir=>ir)}else tr=I.map(rr=>ue.findRelationWithPropertyPath(rr)).filter(rr=>rr);tr.forEach(rr=>{let ir=DriverUtils.buildAlias(e.connection.driver,{joiner:"__"},oe,rr.propertyPath);const lr=oe+"."+rr.propertyPath;e.expressionMap.relationLoadStrategy==="query"?e.concatRelationMetadata(rr):e.leftJoinAndSelect(lr,ir),I.splice(I.indexOf(bt?bt+"."+rr.propertyPath:rr.propertyPath),1);let dr,pr;if(e.expressionMap.relationLoadStrategy==="query")dr=rr.inverseEntityMetadata,pr=ir;else{const hr=e.expressionMap.joinAttributes.find(_r=>_r.entityOrProperty===lr);dr=hr.metadata,pr=hr.alias.name}if(!pr||!dr)throw new EntityPropertyNotFoundError(rr.propertyPath,ue);if(this.applyRelationsRecursively(e,I,pr,dr,bt?bt+"."+rr.propertyPath:rr.propertyPath),e.expressionMap.relationLoadStrategy==="join"){const hr=ue.relations.find(_r=>_r.propertyName===rr.propertyPath);hr&&this.joinEagerRelations(e,ir,hr.inverseEntityMetadata)}})}static joinEagerRelations(e,I,oe){oe.eagerRelations.forEach(ue=>{let bt=DriverUtils.buildAlias(e.connection.driver,{joiner:"__"},I,ue.propertyName),tr=!0;for(const lr of e.expressionMap.joinAttributes)if(!(lr.condition!==void 0||lr.mapToProperty!==void 0||lr.isMappingMany!==void 0||lr.direction!=="LEFT"||lr.entityOrProperty!==`${I}.${ue.propertyPath}`)){tr=!1,bt=lr.alias.name;break}const rr=!!e.expressionMap.joinAttributes.find(lr=>lr.alias.name===bt);tr&&!rr&&e.leftJoin(I+"."+ue.propertyPath,bt);let ir=!0;for(const lr of e.expressionMap.selects)if(!(lr.aliasName!==void 0||lr.virtual!==void 0||lr.selection!==bt)){ir=!1;break}ir&&e.addSelect(bt),this.joinEagerRelations(e,bt,ue.inverseEntityMetadata)})}}class SelectQueryBuilder extends QueryBuilder{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),this.replacePropertyNamesForTheWholeQuery(e)}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,I){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map(oe=>({selection:oe}));else if(typeof e=="function"){const oe=e(this.subQuery());this.setParameters(oe.getParameters()),this.expressionMap.selects.push({selection:oe.getQuery(),aliasName:I})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:I}]);return this}addSelect(e,I){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(oe=>({selection:oe})));else if(typeof e=="function"){const oe=e(this.subQuery());this.setParameters(oe.getParameters()),this.expressionMap.selects.push({selection:oe.getQuery(),aliasName:I})}else e&&this.expressionMap.selects.push({selection:e,aliasName:I});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}fromDummy(){return this.from(this.connection.driver.dummyTableName??"(SELECT 1 AS dummy_column)","dummy_table")}from(e,I){const oe=this.createFromAlias(e,I);return this.expressionMap.setMainAlias(oe),this}addFrom(e,I){const oe=this.createFromAlias(e,I);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(oe),this}innerJoin(e,I,oe,ue){return this.join("INNER",e,I,oe,ue),this}leftJoin(e,I,oe,ue){return this.join("LEFT",e,I,oe,ue),this}innerJoinAndSelect(e,I,oe,ue){return this.addSelect(I),this.innerJoin(e,I,oe,ue),this}leftJoinAndSelect(e,I,oe,ue){return this.addSelect(I),this.leftJoin(e,I,oe,ue),this}innerJoinAndMapMany(e,I,oe,ue,bt){return this.addSelect(oe),this.join("INNER",I,oe,ue,bt,e,!0),this}innerJoinAndMapOne(e,I,oe,ue,bt,tr){return this.addSelect(oe),this.join("INNER",I,oe,ue,bt,e,!1,tr),this}leftJoinAndMapMany(e,I,oe,ue,bt){return this.addSelect(oe),this.join("LEFT",I,oe,ue,bt,e,!0),this}leftJoinAndMapOne(e,I,oe,ue,bt,tr){return this.addSelect(oe),this.join("LEFT",I,oe,ue,bt,e,!1,tr),this}loadRelationIdAndMap(e,I,oe,ue){const bt=new RelationIdAttribute(this.expressionMap);return bt.mapToProperty=e,bt.relationName=I,typeof oe=="string"&&(bt.alias=oe),typeof oe=="object"&&oe.disableMixedMap&&(bt.disableMixedMap=!0),bt.queryBuilderFactory=ue,this.expressionMap.relationIdAttributes.push(bt),bt.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:bt.junctionAlias,metadata:bt.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,I,oe,ue){const bt=new RelationCountAttribute(this.expressionMap);return bt.mapToProperty=e,bt.relationName=I,bt.alias=oe,bt.queryBuilderFactory=ue,this.expressionMap.relationCountAttributes.push(bt),this.expressionMap.createAlias({type:"other",name:bt.junctionAlias}),bt.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:bt.junctionAlias,metadata:bt.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach(I=>{e!==void 0&&e.relations!==void 0&&e.relations.indexOf(I.propertyPath)===-1||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+I.propertyPath,this.expressionMap.mainAlias.name+"."+I.propertyPath,e)}),this}where(e,I){this.expressionMap.wheres=[];const oe=this.getWhereCondition(e);return oe&&(this.expressionMap.wheres=[{type:"simple",condition:oe}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereExists(e){return this.where(...this.getExistsCondition(e))}andWhereExists(e){return this.andWhere(...this.getExistsCondition(e))}orWhereExists(e){return this.orWhere(...this.getExistsCondition(e))}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,I){return this.expressionMap.havings.push({type:"simple",condition:e}),I&&this.setParameters(I),this}andHaving(e,I){return this.expressionMap.havings.push({type:"and",condition:e}),I&&this.setParameters(I),this}orHaving(e,I){return this.expressionMap.havings.push({type:"or",condition:e}),I&&this.setParameters(I),this}groupBy(e){return e?this.expressionMap.groupBys=[e]:this.expressionMap.groupBys=[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}timeTravelQuery(e){return this.connection.driver.options.type==="cockroachdb"&&(e===void 0?this.expressionMap.timeTravel="follower_read_timestamp()":this.expressionMap.timeTravel=e),this}orderBy(e,I="ASC",oe){if(I!==void 0&&I!=="ASC"&&I!=="DESC")throw new TypeORMError('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(oe!==void 0&&oe!=="NULLS FIRST"&&oe!=="NULLS LAST")throw new TypeORMError('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?typeof e=="object"?this.expressionMap.orderBys=e:oe?this.expressionMap.orderBys={[e]:{order:I,nulls:oe}}:this.expressionMap.orderBys={[e]:I}:this.expressionMap.orderBys={},this}addOrderBy(e,I="ASC",oe){if(I!==void 0&&I!=="ASC"&&I!=="DESC")throw new TypeORMError('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(oe!==void 0&&oe!=="NULLS FIRST"&&oe!=="NULLS LAST")throw new TypeORMError('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return oe?this.expressionMap.orderBys[e]={order:I,nulls:oe}:this.expressionMap.orderBys[e]=I,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),this.expressionMap.limit!==void 0&&isNaN(this.expressionMap.limit))throw new TypeORMError('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),this.expressionMap.offset!==void 0&&isNaN(this.expressionMap.offset))throw new TypeORMError('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),this.expressionMap.take!==void 0&&isNaN(this.expressionMap.take))throw new TypeORMError('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),this.expressionMap.skip!==void 0&&isNaN(this.expressionMap.skip))throw new TypeORMError('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,I,oe){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=I,this.expressionMap.lockTables=oe,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0);const oe=await this.loadRawResults(e);return I&&await e.commitTransaction(),oe}catch(oe){if(I)try{await e.rollbackTransaction()}catch{}throw oe}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!0;const oe=await this.executeEntitiesAndRawResults(e);return I&&await e.commitTransaction(),oe}catch(oe){if(I)try{await e.rollbackTransaction()}catch{}throw oe}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const I=(await this.getRawAndEntities()).entities[0];if(I&&this.expressionMap.lockMode==="optimistic"&&this.expressionMap.lockVersion){const oe=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const ue=oe.updateDateColumn.getEntityValue(I);if(ue.getTime()!==this.expressionMap.lockVersion.getTime())throw new OptimisticLockVersionMismatchError(oe.name,this.expressionMap.lockVersion,ue)}else{const ue=oe.versionColumn.getEntityValue(I);if(ue!==this.expressionMap.lockVersion)throw new OptimisticLockVersionMismatchError(oe.name,this.expressionMap.lockVersion,ue)}}return I===void 0?null:I}async getOneOrFail(){const e=await this.getOne();if(!e)throw new EntityNotFoundError(this.expressionMap.mainAlias.target,this.expressionMap.parameters);return e}async getMany(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;return(await this.getRawAndEntities()).entities}async getCount(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!1;const oe=await this.executeCountQuery(e);return I&&await e.commitTransaction(),oe}catch(oe){if(I)try{await e.rollbackTransaction()}catch{}throw oe}finally{e!==this.queryRunner&&await e.release()}}async getExists(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!1;const oe=await this.executeExistsQuery(e);return I&&await e.commitTransaction(),oe}catch(oe){if(I)try{await e.rollbackTransaction()}catch{}throw oe}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!0;const oe=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const ue=this.expressionMap.cacheId;this.expressionMap.cacheId=ue&&`${ue}-count`;const bt=await this.executeCountQuery(e),tr=[oe.entities,bt];return I&&await e.commitTransaction(),tr}catch(oe){if(I)try{await e.rollbackTransaction()}catch{}throw oe}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,I]=this.getQueryAndParameters(),oe=this.obtainQueryRunner();let ue=!1;try{this.expressionMap.useTransaction===!0&&oe.isTransactionActive===!1&&(await oe.startTransaction(),ue=!0);const bt=()=>{if(oe!==this.queryRunner)return oe.release()},tr=oe.stream(e,I,bt,bt);return ue&&await oe.commitTransaction(),tr}catch(bt){if(ue)try{await oe.rollbackTransaction()}catch{}throw bt}}cache(e,I){return typeof e=="boolean"?this.expressionMap.cache=e:typeof e=="number"?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):(typeof e=="string"||typeof e=="number")&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),I&&(this.expressionMap.cacheDuration=I),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,I,oe,ue,bt,tr,rr,ir){bt&&this.setParameters(bt);const lr=new JoinAttribute(this.connection,this.expressionMap);lr.direction=e,lr.mapAsEntity=ir,lr.mapToProperty=tr,lr.isMappingMany=rr,lr.entityOrProperty=I,lr.condition=ue,this.expressionMap.joinAttributes.push(lr);const dr=lr.metadata;if(dr){if(dr.deleteDateColumn&&!this.expressionMap.withDeleted){const pr=`${oe}.${dr.deleteDateColumn.propertyName} IS NULL`;lr.condition=lr.condition?` ${lr.condition} AND ${pr}`:`${pr}`}lr.alias=this.expressionMap.createAlias({type:"join",name:oe,metadata:dr}),lr.relation&&lr.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:lr.junctionAlias,metadata:lr.relation.junctionEntityMetadata})}else{let pr="";if(typeof I=="function"){const _r=I(this.subQuery());this.setParameters(_r.getParameters()),pr=_r.getQuery()}else pr=I;const hr=typeof I=="function"||I.substr(0,1)==="("&&I.substr(-1)===")";lr.alias=this.expressionMap.createAlias({type:"join",name:oe,tablePath:hr===!1?I:void 0,subQuery:hr===!0?pr:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new TypeORMError("Cannot build query because main alias is not set (call qb#from method)");const e=[],I=[];if(this.expressionMap.mainAlias.hasMetadata){const rr=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,rr)),I.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,rr))}this.expressionMap.joinAttributes.forEach(rr=>{if(rr.metadata)e.push(...this.buildEscapedEntityColumnSelects(rr.alias.name,rr.metadata)),I.push(...this.findEntityColumnSelects(rr.alias.name,rr.metadata));else if(this.expressionMap.selects.some(lr=>lr.selection===rr.alias.name)){e.push({selection:this.escape(rr.alias.name)+".*"});const lr=this.expressionMap.selects.find(dr=>dr.selection===rr.alias.name);I.push(lr)}}),this.expressionMap.selects.filter(rr=>I.indexOf(rr)===-1).forEach(rr=>e.push({selection:this.replacePropertyNames(rr.selection),aliasName:rr.aliasName})),e.length===0&&e.push({selection:"*"});let oe="";this.expressionMap.useIndex&&DriverUtils.isMySQLFamily(this.connection.driver)&&(oe=` USE INDEX (${this.expressionMap.useIndex})`);const ue=this.expressionMap.aliases.filter(rr=>rr.type==="from"&&(rr.tablePath||rr.subQuery)).map(rr=>rr.subQuery?rr.subQuery+" "+this.escape(rr.name):this.getTableName(rr.tablePath)+" "+this.escape(rr.name)),bt=this.createSelectDistinctExpression(),tr=e.map(rr=>rr.selection+(rr.aliasName?" AS "+this.escape(rr.aliasName):"")).join(", ");return bt+tr+" FROM "+ue.join(", ")+this.createTableLockExpression()+oe}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:I,maxExecutionTime:oe}=this.expressionMap,{driver:ue}=this.connection;let bt="SELECT ";return oe>0&&DriverUtils.isMySQLFamily(ue)&&(bt+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),DriverUtils.isPostgresFamily(ue)&&I.length>0?bt=`SELECT DISTINCT ON (${I.map(rr=>this.replacePropertyNames(rr)).join(", ")}) `:e&&(bt="SELECT DISTINCT "),bt}createJoinExpression(){return this.expressionMap.joinAttributes.map(I=>{const oe=I.relation,ue=I.tablePath,bt=I.alias.name;let tr=I.condition?" AND ("+I.condition+")":"";const rr=I.parentAlias;if(!rr||!oe){const ir=I.alias.subQuery?I.alias.subQuery:this.getTableName(ue);return" "+I.direction+" JOIN "+ir+" "+this.escape(bt)+this.createTableLockExpression()+(I.condition?" ON "+this.replacePropertyNames(I.condition):"")}if(oe.isManyToOne||oe.isOneToOneOwner){const ir=oe.joinColumns.map(lr=>bt+"."+lr.referencedColumn.propertyPath+"="+rr+"."+oe.propertyPath+"."+lr.referencedColumn.propertyPath).join(" AND ");return" "+I.direction+" JOIN "+this.getTableName(ue)+" "+this.escape(bt)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(ir+tr)}else if(oe.isOneToMany||oe.isOneToOneNotOwner){const ir=oe.inverseRelation.joinColumns.map(lr=>(oe.inverseEntityMetadata.tableType==="entity-child"&&oe.inverseEntityMetadata.discriminatorColumn&&(tr+=" AND "+bt+"."+oe.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+oe.inverseEntityMetadata.discriminatorValue+"'"),bt+"."+oe.inverseRelation.propertyPath+"."+lr.referencedColumn.propertyPath+"="+rr+"."+lr.referencedColumn.propertyPath)).join(" AND ");if(!ir)throw new TypeORMError(`Relation ${oe.entityMetadata.name}.${oe.propertyName} does not have join columns.`);return" "+I.direction+" JOIN "+this.getTableName(ue)+" "+this.escape(bt)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(ir+tr)}else{const ir=oe.junctionEntityMetadata.tablePath,lr=I.junctionAlias;let dr="",pr="";return oe.isOwning?(dr=oe.joinColumns.map(hr=>lr+"."+hr.propertyPath+"="+rr+"."+hr.referencedColumn.propertyPath).join(" AND "),pr=oe.inverseJoinColumns.map(hr=>bt+"."+hr.referencedColumn.propertyPath+"="+lr+"."+hr.propertyPath).join(" AND ")):(dr=oe.inverseRelation.inverseJoinColumns.map(hr=>lr+"."+hr.propertyPath+"="+rr+"."+hr.referencedColumn.propertyPath).join(" AND "),pr=oe.inverseRelation.joinColumns.map(hr=>bt+"."+hr.referencedColumn.propertyPath+"="+lr+"."+hr.propertyPath).join(" AND "))," "+I.direction+" JOIN "+this.getTableName(ir)+" "+this.escape(lr)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(dr)+" "+I.direction+" JOIN "+this.getTableName(ue)+" "+this.escape(bt)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(pr+tr)}}).join(" ")}createGroupByExpression(){return!this.expressionMap.groupBys||!this.expressionMap.groupBys.length?"":" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", "))}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length===0?"":" ORDER BY "+Object.keys(e).map(I=>{const oe=typeof e[I]=="string"?e[I]:e[I].order+" "+e[I].nulls,ue=this.expressionMap.selects.find(bt=>bt.selection===I);if(ue&&!ue.aliasName&&I.indexOf(".")!==-1){const bt=I.split("."),tr=bt[0],rr=bt.slice(1).join("."),ir=this.expressionMap.aliases.find(lr=>lr.name===tr);if(ir){const lr=ir.metadata.findColumnWithPropertyPath(rr);if(lr){const dr=DriverUtils.buildAlias(this.connection.driver,void 0,tr,lr.databaseName);return this.escape(dr)+" "+oe}}}return this.replacePropertyNames(I)+" "+oe}).join(", ")}createLimitOffsetExpression(){let e=this.expressionMap.offset,I=this.expressionMap.limit;if(!e&&!I&&this.expressionMap.joinAttributes.length===0&&(e=this.expressionMap.skip,I=this.expressionMap.take),this.connection.driver.options.type==="mssql"){let oe="";if((I||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(oe=" ORDER BY (SELECT NULL)"),I&&e)return oe+" OFFSET "+e+" ROWS FETCH NEXT "+I+" ROWS ONLY";if(I)return oe+" OFFSET 0 ROWS FETCH NEXT "+I+" ROWS ONLY";if(e)return oe+" OFFSET "+e+" ROWS"}else if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){if(I&&e)return" LIMIT "+I+" OFFSET "+e;if(I)return" LIMIT "+I;if(e)throw new OffsetWithoutLimitNotSupportedError}else if(DriverUtils.isSQLiteFamily(this.connection.driver)){if(I&&e)return" LIMIT "+I+" OFFSET "+e;if(I)return" LIMIT "+I;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver.options.type==="oracle"){if(I&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+I+" ROWS ONLY";if(I)return" FETCH NEXT "+I+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(I&&e)return" LIMIT "+I+" OFFSET "+e;if(I)return" LIMIT "+I;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if(this.connection.driver.options.type==="mssql")switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let I="";if(this.expressionMap.lockTables){if(!(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb"))throw new TypeORMError("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new TypeORMError("lockTables cannot be an empty array");I=" OF "+this.expressionMap.lockTables.join(", ")}let oe="";switch(this.expressionMap.onLocked==="nowait"?oe=" NOWAIT":this.expressionMap.onLocked==="skip_locked"&&(oe=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if(e.options.type==="mysql"||e.options.type==="aurora-mysql")return DriverUtils.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+I+oe:" LOCK IN SHARE MODE";if(e.options.type==="mariadb")return" LOCK IN SHARE MODE";if(DriverUtils.isPostgresFamily(e))return" FOR SHARE"+I+oe;if(e.options.type==="oracle")return" FOR UPDATE";if(e.options.type==="mssql")return"";throw new LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(DriverUtils.isMySQLFamily(e)||e.options.type==="aurora-mysql"||e.options.type==="oracle")return" FOR UPDATE"+oe;if(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+I+oe;if(e.options.type==="mssql")return"";throw new LockNotSupportedOnGivenDriverError;case"pessimistic_partial_write":if(DriverUtils.isPostgresFamily(e))return" FOR UPDATE"+I+" SKIP LOCKED";if(DriverUtils.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new LockNotSupportedOnGivenDriverError;case"pessimistic_write_or_fail":if(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+I+" NOWAIT";if(DriverUtils.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new LockNotSupportedOnGivenDriverError;case"for_no_key_update":if(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR NO KEY UPDATE"+I+oe;throw new LockNotSupportedOnGivenDriverError;case"for_key_share":if(DriverUtils.isPostgresFamily(e))return" FOR KEY SHARE"+I+oe;throw new LockNotSupportedOnGivenDriverError;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map((I,oe)=>{switch(I.type){case"and":return(oe>0?"AND ":"")+this.replacePropertyNames(I.condition);case"or":return(oe>0?"OR ":"")+this.replacePropertyNames(I.condition);default:return this.replacePropertyNames(I.condition)}}).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,I){const oe=this.expressionMap.selects.some(lr=>lr.selection===e),ue=[];if(oe&&ue.push(...I.columns.filter(lr=>lr.isSelect===!0)),ue.push(...I.columns.filter(lr=>this.expressionMap.selects.some(dr=>dr.selection===e+"."+lr.propertyPath))),ue.length===0)return[];const bt=this.expressionMap.queryEntity?I.primaryColumns.filter(lr=>ue.indexOf(lr)===-1):[],tr=[...ue,...bt],rr=[],ir=this.escape(e);return tr.forEach(lr=>{let dr=ir+"."+this.escape(lr.databaseName);lr.isVirtualProperty&&lr.query&&(dr=`(${lr.query(ir)})`),this.connection.driver.spatialTypes.indexOf(lr.type)!==-1&&((DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(dr=`${this.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText"}(${dr})`),DriverUtils.isPostgresFamily(this.connection.driver)&&(lr.precision?dr=`ST_AsGeoJSON(${dr}, ${lr.precision})::json`:dr=`ST_AsGeoJSON(${dr})::json`),this.connection.driver.options.type==="mssql"&&(dr=`${dr}.ToString()`));const pr=this.expressionMap.selects.filter(hr=>hr.selection===e+"."+lr.propertyPath);if(pr.length)pr.forEach(hr=>{rr.push({selection:dr,aliasName:hr.aliasName?hr.aliasName:DriverUtils.buildAlias(this.connection.driver,void 0,e,lr.databaseName),virtual:hr.virtual})});else{if(lr.isVirtualProperty)return;rr.push({selection:dr,aliasName:DriverUtils.buildAlias(this.connection.driver,void 0,e,lr.databaseName),virtual:oe})}}),rr}findEntityColumnSelects(e,I){const oe=this.expressionMap.selects.find(ue=>ue.selection===e);return oe?[oe]:this.expressionMap.selects.filter(ue=>I.columns.some(bt=>ue.selection===e+"."+bt.propertyPath))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,oe=this.expressionMap.mainAlias.metadata.primaryColumns,ue=this.escape(e);if(this.expressionMap.joinAttributes.length===0&&this.expressionMap.relationIdAttributes.length===0&&this.expressionMap.relationCountAttributes.length===0)return"COUNT(1)";if(this.connection.driver.options.type==="cockroachdb"||DriverUtils.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+oe.map(bt=>`${ue}.${this.escape(bt.databaseName)}`).join(", ")+"))";if(DriverUtils.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+oe.map(bt=>`${ue}.${this.escape(bt.databaseName)}`).join(", ")+")";if(this.connection.driver.options.type==="mssql"){const bt=oe.map(tr=>`${ue}.${this.escape(tr.databaseName)}`).join(", '|;|', ");return oe.length===1?`COUNT(DISTINCT(${bt}))`:`COUNT(DISTINCT(CONCAT(${bt})))`}return this.connection.driver.options.type==="spanner"?oe.length===1?`COUNT(DISTINCT(${ue}.${this.escape(oe[0].databaseName)}))`:`COUNT(DISTINCT(CONCAT(${oe.map(tr=>`CAST(${ue}.${this.escape(tr.databaseName)} AS STRING)`).join(", '|;|', ")})))`:"COUNT(DISTINCT("+oe.map(bt=>`${ue}.${this.escape(bt.databaseName)}`).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const I=this.computeCountExpression(),oe=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(I,"cnt").setOption("disable-global-order").loadRawResults(e);return!oe||!oe[0]||!oe[0].cnt?0:parseInt(oe[0].cnt)}async executeExistsQuery(e){return(await this.connection.createQueryBuilder().fromDummy().select("1","row_exists").whereExists(this).limit(1).loadRawResults(e)).length>0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.findOptions.loadEagerRelations!==!1&&this.expressionMap.relationLoadStrategy==="join"&&this.buildEagerRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere(this.conditions.substr(0,1)!=="("?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach(e=>{e.select&&!e.selection?e.type==="inner"?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):e.type==="inner"?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)}),this.findOptions.skip!==void 0&&this.skip(this.findOptions.skip),this.findOptions.take!==void 0&&this.take(this.findOptions.take),typeof this.findOptions.cache=="number"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="boolean"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="object"&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach(e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)}),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach(e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)}),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach(e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)}),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach(e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)})),this.findOptions.lock){if(this.findOptions.lock.mode==="optimistic")this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if(this.findOptions.lock.mode==="pessimistic_read"||this.findOptions.lock.mode==="pessimistic_write"||this.findOptions.lock.mode==="dirty_read"||this.findOptions.lock.mode==="pessimistic_partial_write"||this.findOptions.lock.mode==="pessimistic_write_or_fail"||this.findOptions.lock.mode==="for_no_key_update"||this.findOptions.lock.mode==="for_key_share"){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map(I=>{const oe=this.expressionMap.aliases.find(ue=>ue.metadata.tableNameWithoutPrefix===I);if(!oe)throw new TypeORMError(`"${I}" is not part of this query`);return this.escape(oe.name)}):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}}this.findOptions.loadRelationIds===!0?this.loadAllRelationIds():typeof this.findOptions.loadRelationIds=="object"&&this.loadAllRelationIds(this.findOptions.loadRelationIds),this.findOptions.loadEagerRelations!==!1&&FindOptionsUtils.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),this.findOptions.transaction===!0&&(this.expressionMap.useTransaction=!0)}}concatRelationMetadata(e){this.relationMetadatas.push(e)}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new TypeORMError('Alias is not set. Use "from" method to set an alias.');if((this.expressionMap.lockMode==="pessimistic_read"||this.expressionMap.lockMode==="pessimistic_write"||this.expressionMap.lockMode==="pessimistic_partial_write"||this.expressionMap.lockMode==="pessimistic_write_or_fail"||this.expressionMap.lockMode==="for_no_key_update"||this.expressionMap.lockMode==="for_key_share")&&!e.isTransactionActive)throw new PessimisticLockTransactionRequiredError;if(this.expressionMap.lockMode==="optimistic"){const ir=this.expressionMap.mainAlias.metadata;if(!ir.versionColumn&&!ir.updateDateColumn)throw new NoVersionOrUpdateDateColumnError(ir.name)}const I=new RelationIdLoader$1(this.connection,e,this.expressionMap.relationIdAttributes),oe=new RelationCountLoader(this.connection,e,this.expressionMap.relationCountAttributes);new RelationIdMetadataToAttributeTransformer(this.expressionMap).transform(),new RelationCountMetadataToAttributeTransformer(this.expressionMap).transform();let tr=[],rr=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[ir,lr]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),dr=this.expressionMap.mainAlias.metadata,pr=this.expressionMap.mainAlias.name,hr=dr.primaryColumns.map(wr=>{const Tr=this.escape("distinctAlias"),Ar=this.escape(DriverUtils.buildAlias(this.connection.driver,void 0,pr,wr.databaseName));lr[Ar]||(lr[Ar]="ASC");const Sr=DriverUtils.buildAlias(this.connection.driver,void 0,"ids_"+pr,wr.databaseName);return`${Tr}.${Ar} AS ${this.escape(Sr)}`}),_r=this.clone(),yr=_r.expressionMap.timeTravel;if(tr=await new SelectQueryBuilder(this.connection,e).select(`DISTINCT ${hr.join(", ")}`).addSelect(ir).from(`(${_r.orderBy().timeTravelQuery(!1).getQuery()})`,"distinctAlias").timeTravelQuery(yr).offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(lr).cache(this.expressionMap.cache&&this.expressionMap.cacheId?`${this.expressionMap.cacheId}-pagination`:this.expressionMap.cache,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),tr.length>0){let wr="";const Tr={};if(dr.hasMultiplePrimaryKeys)wr=tr.map((Ar,Sr)=>dr.primaryColumns.map(Mr=>{const vr=`orm_distinct_ids_${Sr}_${Mr.databaseName}`,Lr=DriverUtils.buildAlias(this.connection.driver,void 0,"ids_"+pr,Mr.databaseName);return Tr[vr]=Ar[Lr],`${pr}.${Mr.propertyPath}=:${vr}`}).join(" AND ")).join(" OR ");else{const Ar=DriverUtils.buildAlias(this.connection.driver,void 0,"ids_"+pr,dr.primaryColumns[0].databaseName),Sr=tr.map(vr=>vr[Ar]);Sr.every(vr=>typeof vr=="number")?wr=`${pr}.${dr.primaryColumns[0].propertyPath} IN (${Sr.join(", ")})`:(Tr.orm_distinct_ids=Sr,wr=pr+"."+dr.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}tr=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:wr}).setParameters(Tr).loadRawResults(e)}}else tr=await this.loadRawResults(e);if(tr.length>0){const ir=await I.load(tr),lr=await oe.load(tr);rr=new RawSqlResultsToEntityTransformer(this.expressionMap,this.connection.driver,ir,lr,this.queryRunner).transform(tr,this.expressionMap.mainAlias),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,rr)}if(this.expressionMap.relationLoadStrategy==="query"){const ir=new RelationIdLoader(this.connection,e);await Promise.all(this.relationMetadatas.map(async lr=>{const dr=lr.inverseEntityMetadata.target,pr=lr.inverseEntityMetadata.targetName,hr=Array.isArray(this.findOptions.select)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,_r=Array.isArray(this.findOptions.relations)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,yr=this.createQueryBuilder(e).select(pr).from(dr,pr).setFindOptions({select:hr?OrmUtils.deepValue(hr,lr.propertyPath):void 0,order:this.findOptions.order?OrmUtils.deepValue(this.findOptions.order,lr.propertyPath):void 0,relations:_r?OrmUtils.deepValue(_r,lr.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(rr.length>0){const wr=await ir.loadManyToManyRelationIdsAndGroup(lr,rr,void 0,yr);rr.forEach(Tr=>{const Ar=wr.find(Sr=>Sr.entity===Tr);if(Ar){const Sr=Ar.related===void 0?null:Ar.related;lr.setEntityValue(Tr,Sr)}})}}))}return{raw:tr,entities:rr}}createOrderByCombinedWithSelectExpression(e){const I=this.expressionMap.allOrderBys,oe=Object.keys(I).map(bt=>{if(bt.indexOf(".")!==-1){const tr=bt.split("."),rr=tr[0],ir=tr.slice(1).join("."),dr=this.expressionMap.findAliasByName(rr).metadata.findColumnWithPropertyPath(ir);return this.escape(e)+"."+this.escape(DriverUtils.buildAlias(this.connection.driver,void 0,rr,dr.databaseName))}else return this.expressionMap.selects.find(tr=>tr.selection===bt||tr.aliasName===bt)?this.escape(e)+"."+this.escape(bt):""}).join(", "),ue={};return Object.keys(I).forEach(bt=>{if(bt.indexOf(".")!==-1){const tr=bt.split("."),rr=tr[0],ir=tr.slice(1).join("."),dr=this.expressionMap.findAliasByName(rr).metadata.findColumnWithPropertyPath(ir);ue[this.escape(e)+"."+this.escape(DriverUtils.buildAlias(this.connection.driver,void 0,rr,dr.databaseName))]=I[bt]}else this.expressionMap.selects.find(tr=>tr.selection===bt||tr.aliasName===bt)?ue[this.escape(e)+"."+this.escape(bt)]=I[bt]:ue[bt]=I[bt]}),[oe,ue]}async loadRawResults(e){const[I,oe]=this.getQueryAndParameters(),ue=I+" -- PARAMETERS: "+JSON.stringify(oe,(dr,pr)=>typeof pr=="bigint"?pr.toString():pr),bt=typeof this.connection.options.cache=="object"?this.connection.options.cache:{};let tr;const rr=bt.alwaysEnabled&&this.expressionMap.cache!==!1||this.expressionMap.cache===!0;let ir=!1;if(this.connection.queryResultCache&&rr)try{if(tr=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:ue,duration:this.expressionMap.cacheDuration||bt.duration||1e3},e),tr&&!this.connection.queryResultCache.isExpired(tr))return JSON.parse(tr.result)}catch(dr){if(!bt.ignoreErrors)throw dr;ir=!0}const lr=await e.query(I,oe,!0);if(!ir&&this.connection.queryResultCache&&rr)try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:ue,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||bt.duration||1e3,result:JSON.stringify(lr.records)},tr,e)}catch(dr){if(!bt.ignoreErrors)throw dr}return lr.records}mergeExpressionMap(e){return ObjectUtils.assign(this.expressionMap,e),this}normalizeNumber(e){return typeof e=="number"||e===void 0||e===null?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner(this.connection.defaultReplicationModeForReads())}buildSelect(e,I,oe,ue){for(let bt in e){if(e[bt]===void 0||e[bt]===!1)continue;const tr=ue?ue+"."+bt:bt,rr=I.findColumnWithPropertyPathStrict(tr),ir=I.findEmbeddedWithPropertyPath(tr),lr=I.findRelationWithPropertyPath(tr);if(!ir&&!rr&&!lr)throw new EntityPropertyNotFoundError(tr,I);rr?this.selects.push(oe+"."+tr):ir&&this.buildSelect(e[bt],I,oe,tr)}}buildRelations(e,I,oe,ue,bt){e&&Object.keys(e).forEach(tr=>{const rr=e[tr],ir=bt?bt+"."+tr:tr,lr=oe.findEmbeddedWithPropertyPath(ir),dr=oe.findRelationWithPropertyPath(ir);if(!lr&&!dr)throw new EntityPropertyNotFoundError(ir,oe);if(lr)this.buildRelations(rr,typeof I=="object"?OrmUtils.deepValue(I,lr.propertyPath):void 0,oe,ue,ir);else if(dr){let pr=ue+"_"+ir.replace(".","_");pr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},ue,pr),(rr===!0||typeof rr=="object")&&(this.expressionMap.relationLoadStrategy==="query"?this.concatRelationMetadata(dr):(this.joins.push({type:"left",select:!0,selection:I&&typeof I[tr]=="object"?I[tr]:void 0,alias:pr,parentAlias:ue,relationMetadata:dr}),I&&typeof I[tr]=="object"&&this.buildSelect(I[tr],dr.inverseEntityMetadata,pr))),typeof rr=="object"&&this.expressionMap.relationLoadStrategy==="join"&&this.buildRelations(rr,typeof I=="object"?OrmUtils.deepValue(I,dr.propertyPath):void 0,dr.inverseEntityMetadata,pr,void 0)}})}buildEagerRelations(e,I,oe,ue,bt){e&&Object.keys(e).forEach(tr=>{const rr=e[tr],ir=bt?bt+"."+tr:tr,lr=oe.findEmbeddedWithPropertyPath(ir),dr=oe.findRelationWithPropertyPath(ir);if(!lr&&!dr)throw new EntityPropertyNotFoundError(ir,oe);if(lr)this.buildEagerRelations(rr,typeof I=="object"?OrmUtils.deepValue(I,lr.propertyPath):void 0,oe,ue,ir);else if(dr){let pr=ue+"_"+ir.replace(".","_");pr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},ue,pr),(rr===!0||typeof rr=="object")&&dr.inverseEntityMetadata.eagerRelations.forEach(hr=>{let _r=pr+"_"+hr.propertyPath.replace(".","_");_r=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},pr,_r),this.joins.find(wr=>wr.alias===_r)||this.joins.push({type:"left",select:!0,alias:_r,parentAlias:pr,selection:void 0,relationMetadata:hr}),I&&typeof I[tr]=="object"&&this.buildSelect(I[tr],dr.inverseEntityMetadata,pr)}),typeof rr=="object"&&this.buildEagerRelations(rr,typeof I=="object"?OrmUtils.deepValue(I,dr.propertyPath):void 0,dr.inverseEntityMetadata,pr,void 0)}})}buildOrder(e,I,oe,ue){for(let bt in e){if(e[bt]===void 0)continue;const tr=ue?ue+"."+bt:bt,rr=I.findColumnWithPropertyPathStrict(tr),ir=I.findEmbeddedWithPropertyPath(tr),lr=I.findRelationWithPropertyPath(tr);if(!ir&&!rr&&!lr)throw new EntityPropertyNotFoundError(tr,I);if(rr){let dr=typeof e[bt]=="object"?e[bt].direction:e[bt];dr=dr==="DESC"||dr==="desc"||dr===-1?"DESC":"ASC";let pr=typeof e[bt]=="object"?e[bt].nulls:void 0;pr=pr?.toLowerCase()==="first"?"NULLS FIRST":pr?.toLowerCase()==="last"?"NULLS LAST":void 0;let hr=`${oe}.${tr}`;this.addOrderBy(hr,dr,pr)}else if(ir)this.buildOrder(e[bt],I,oe,tr);else if(lr){let dr=oe+"_"+tr.replace(".","_");dr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},oe,dr),this.joins.find(hr=>hr.alias===dr)||this.joins.push({type:"left",select:!1,alias:dr,parentAlias:oe,selection:void 0,relationMetadata:lr}),this.buildOrder(e[bt],lr.inverseEntityMetadata,dr)}}}buildWhere(e,I,oe,ue){let bt="";if(Array.isArray(e))e.length&&(bt=e.map(tr=>this.buildWhere(tr,I,oe,ue)).filter(tr=>!!tr).map(tr=>"("+tr+")").join(" OR "));else{let tr=[];for(let rr in e){if(e[rr]===void 0||e[rr]===null)continue;const ir=ue?ue+"."+rr:rr,lr=I.findColumnWithPropertyPathStrict(ir),dr=I.findEmbeddedWithPropertyPath(ir),pr=I.findRelationWithPropertyPath(ir);if(!dr&&!lr&&!pr)throw new EntityPropertyNotFoundError(ir,I);if(lr){let hr=`${oe}.${ir}`;lr.isVirtualProperty&&lr.query&&(hr=`(${lr.query(oe)})`);let _r=e[rr];InstanceChecker.isEqualOperator(e[rr])&&(_r=e[rr].value),lr.transformer&&(_r instanceof FindOperator?_r.transformValue(lr.transformer):_r=ApplyValueTransformers.transformTo(lr.transformer,_r)),tr.push(this.createWhereConditionExpression(this.getWherePredicateCondition(hr,_r)))}else if(dr){const hr=this.buildWhere(e[rr],I,oe,ir);hr&&tr.push(hr)}else if(pr){if(typeof e[rr]=="object"&&Object.keys(e[rr]).every(_r=>e[rr][_r]===void 0))continue;if(InstanceChecker.isFindOperator(e[rr]))if(e[rr].type==="moreThan"||e[rr].type==="lessThan"||e[rr].type==="moreThanOrEqual"||e[rr].type==="lessThanOrEqual"){let hr="";e[rr].type==="moreThan"?hr=">":e[rr].type==="lessThan"?hr="<":e[rr].type==="moreThanOrEqual"?hr=">=":e[rr].type==="lessThanOrEqual"&&(hr="<=");const _r=this.subQuery();if(pr.isManyToManyOwner)_r.select("COUNT(*)").from(pr.joinTableName,pr.joinTableName).where(pr.joinColumns.map(yr=>`${pr.joinTableName}.${yr.propertyName} = ${oe}.${yr.referencedColumn.propertyName}`).join(" AND "));else if(pr.isManyToManyNotOwner)_r.select("COUNT(*)").from(pr.inverseRelation.joinTableName,pr.inverseRelation.joinTableName).where(pr.inverseRelation.inverseJoinColumns.map(yr=>`${pr.inverseRelation.joinTableName}.${yr.propertyName} = ${oe}.${yr.referencedColumn.propertyName}`).join(" AND "));else if(pr.isOneToMany)_r.select("COUNT(*)").from(pr.inverseEntityMetadata.target,pr.inverseEntityMetadata.tableName).where(pr.inverseRelation.joinColumns.map(yr=>`${pr.inverseEntityMetadata.tableName}.${yr.propertyName} = ${oe}.${yr.referencedColumn.propertyName}`).join(" AND "));else throw new Error("This relation isn't supported by given find operator");this.andWhere(_r.getSql()+" "+hr+" "+parseInt(e[rr].value))}else if(pr.isManyToOne||pr.isOneToOne&&pr.isOneToOneOwner){const hr=`${oe}.${ir}`;tr.push(this.createWhereConditionExpression(this.getWherePredicateCondition(hr,e[rr])))}else throw new Error("This relation isn't supported by given find operator");else{let hr=oe+"_"+pr.propertyPath.replace(".","_");hr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},oe,hr),this.joins.find(wr=>wr.alias===hr)||this.joins.push({type:"left",select:!1,selection:void 0,alias:hr,parentAlias:oe,relationMetadata:pr});const yr=this.buildWhere(e[rr],pr.inverseEntityMetadata,hr);yr&&tr.push(yr)}}}bt=tr.length?"("+tr.join(") AND (")+")":tr.join(" AND ")}return bt.length?"("+bt+")":bt}}class UpdateResult{constructor(){this.generatedMaps=[]}static from(e){const I=new this;return I.raw=e.records,I.affected=e.affected,I}}class SoftDeleteQueryBuilder extends QueryBuilder{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const oe=new ReturningResultsEntityUpdator(e,this.expressionMap);this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=oe.getSoftDeletionReturningColumns());const[ue,bt]=this.getQueryAndParameters(),tr=await e.query(ue,bt,!0),rr=UpdateResult.from(tr);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await oe.update(rr,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),I&&await e.commitTransaction(),rr}catch(oe){if(I)try{await e.rollbackTransaction()}catch{}throw oe}finally{e!==this.queryRunner&&await e.release()}}from(e,I){e=InstanceChecker.isEntitySchema(e)?e.options.name:e;const oe=this.createFromAlias(e,I);return this.expressionMap.setMainAlias(oe),this}where(e,I){this.expressionMap.wheres=[];const oe=this.getWhereCondition(e);return oe&&(this.expressionMap.wheres=[{type:"simple",condition:oe}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}orderBy(e,I="ASC",oe){return e?typeof e=="object"?this.expressionMap.orderBys=e:oe?this.expressionMap.orderBys={[e]:{order:I,nulls:oe}}:this.expressionMap.orderBys={[e]:I}:this.expressionMap.orderBys={},this}addOrderBy(e,I="ASC",oe){return oe?this.expressionMap.orderBys[e]={order:I,nulls:oe}:this.expressionMap.orderBys[e]=I,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new TypeORMError(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const I=Array.isArray(e)?e:[e];return I.forEach(oe=>{const ue=this.expressionMap.mainAlias.metadata.getEntityIdMap(oe);if(!ue)throw new TypeORMError("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(ue)}),this.expressionMap.whereEntities=I,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new TypeORMError(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new MissingDeleteDateColumnError(e);const I=[];switch(this.expressionMap.queryType){case"soft-delete":I.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":I.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new TypeORMError('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&I.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&I.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),I.length<=0)throw new UpdateValuesMissingError;const oe=this.createWhereExpression(),ue=this.createReturningExpression("update");return ue===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${I.join(", ")}${oe}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${I.join(", ")} OUTPUT ${ue}${oe}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${I.join(", ")}${oe} RETURNING ${ue}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(I=>typeof e[I]=="string"?this.replacePropertyNames(I)+" "+e[I]:this.replacePropertyNames(I)+" "+e[I].order+" "+e[I].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(DriverUtils.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new LimitOnUpdateNotSupportedError}return""}}class UpdateQueryBuilder extends QueryBuilder{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let oe=null,ue=null;const bt=new ReturningResultsEntityUpdator(e,this.expressionMap),tr=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const hr of this.expressionMap.returning)tr.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(hr));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=bt.getUpdationReturningColumns(),tr.push(...this.expressionMap.extraReturningColumns.filter(hr=>!tr.includes(hr)))),tr.length>0&&this.connection.driver.options.type==="mssql"&&(oe=this.connection.driver.buildTableVariableDeclaration("@OutputTable",tr),ue="SELECT * FROM @OutputTable");const[rr,ir]=this.getQueryAndParameters(),lr=[oe,rr,ue],dr=await e.query(lr.filter(hr=>hr!=null).join(`;

`),ir,!0),pr=UpdateResult.from(dr);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await bt.update(pr,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),I&&await e.commitTransaction(),pr}catch(oe){if(I)try{await e.rollbackTransaction()}catch{}throw oe}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,I){this.expressionMap.wheres=[];const oe=this.getWhereCondition(e);return oe&&(this.expressionMap.wheres=[{type:"simple",condition:oe}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}orderBy(e,I="ASC",oe){return e?typeof e=="object"?this.expressionMap.orderBys=e:oe?this.expressionMap.orderBys={[e]:{order:I,nulls:oe}}:this.expressionMap.orderBys={[e]:I}:this.expressionMap.orderBys={},this}addOrderBy(e,I="ASC",oe){return oe?this.expressionMap.orderBys[e]={order:I,nulls:oe}:this.expressionMap.orderBys[e]=I,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new TypeORMError(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const I=Array.isArray(e)?e:[e];return I.forEach(oe=>{const ue=this.expressionMap.mainAlias.metadata.getEntityIdMap(oe);if(!ue)throw new TypeORMError("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(ue)}),this.expressionMap.whereEntities=I,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),I=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,oe={};for(let ir in e)e[ir]!==void 0&&(oe[ir]=e[ir]);const ue=[],bt=[];if(I?(this.createPropertyPath(I,oe).forEach(ir=>{const lr=I.findColumnsWithPropertyPath(ir);if(lr.length<=0)throw new EntityPropertyNotFoundError(ir,I);lr.forEach(dr=>{if(!dr.isUpdate||bt.includes(dr))return;bt.push(dr);let pr=dr.getEntityValue(oe);if(dr.referencedColumn&&typeof pr=="object"&&!(pr instanceof Date)&&pr!==null&&!Buffer$7.isBuffer(pr)?pr=dr.referencedColumn.getEntityValue(pr):typeof pr!="function"&&(pr=this.connection.driver.preparePersistentValue(pr,dr)),typeof pr=="function")ue.push(this.escape(dr.databaseName)+" = "+pr());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&pr===null)ue.push(this.escape(dr.databaseName)+" = NULL");else{this.connection.driver.options.type==="mssql"&&(pr=this.connection.driver.parametrizeValue(dr,pr));const hr=this.createParameter(pr);let _r=null;if((DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(dr.type)!==-1){const wr=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";dr.srid!=null?_r=`${wr}(${hr}, ${dr.srid})`:_r=`${wr}(${hr})`}else DriverUtils.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(dr.type)!==-1?dr.srid!=null?_r=`ST_SetSRID(ST_GeomFromGeoJSON(${hr}), ${dr.srid})::${dr.type}`:_r=`ST_GeomFromGeoJSON(${hr})::${dr.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(dr.type)!==-1?_r=dr.type+"::STGeomFromText("+hr+", "+(dr.srid||"0")+")":_r=hr;ue.push(this.escape(dr.databaseName)+" = "+_r)}})}),(ue.length>0||Object.keys(oe).length===0)&&(I.versionColumn&&bt.indexOf(I.versionColumn)===-1&&ue.push(this.escape(I.versionColumn.databaseName)+" = "+this.escape(I.versionColumn.databaseName)+" + 1"),I.updateDateColumn&&bt.indexOf(I.updateDateColumn)===-1&&ue.push(this.escape(I.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(oe).map(ir=>{let lr=oe[ir];if(typeof lr=="function")ue.push(this.escape(ir)+" = "+lr());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&lr===null)ue.push(this.escape(ir)+" = NULL");else{const dr=this.createParameter(lr);ue.push(this.escape(ir)+" = "+dr)}}),ue.length<=0)throw new UpdateValuesMissingError;const tr=this.createWhereExpression(),rr=this.createReturningExpression("update");return rr===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${ue.join(", ")}${tr}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${ue.join(", ")} OUTPUT ${rr}${tr}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${ue.join(", ")}${tr} RETURNING ${rr}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(I=>typeof e[I]=="string"?this.replacePropertyNames(I)+" "+e[I]:this.replacePropertyNames(I)+" "+e[I].order+" "+e[I].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")return" LIMIT "+e;throw new LimitOnUpdateNotSupportedError}return""}getValueSet(){if(typeof this.expressionMap.valuesSet=="object")return this.expressionMap.valuesSet;throw new UpdateValuesMissingError}}function registerQueryBuilders(){QueryBuilder.registerQueryBuilderClass("DeleteQueryBuilder",ae=>new DeleteQueryBuilder(ae)),QueryBuilder.registerQueryBuilderClass("InsertQueryBuilder",ae=>new InsertQueryBuilder(ae)),QueryBuilder.registerQueryBuilderClass("RelationQueryBuilder",ae=>new RelationQueryBuilder(ae)),QueryBuilder.registerQueryBuilderClass("SelectQueryBuilder",ae=>new SelectQueryBuilder(ae)),QueryBuilder.registerQueryBuilderClass("SoftDeleteQueryBuilder",ae=>new SoftDeleteQueryBuilder(ae)),QueryBuilder.registerQueryBuilderClass("UpdateQueryBuilder",ae=>new UpdateQueryBuilder(ae))}class RandomGenerator{static sha1(e){let I=function(Lr,es){return Lr<<es|Lr>>>32-es},oe=function(Lr){let es="",ss,os;for(ss=7;ss>=0;ss--)os=Lr>>>ss*4&15,es+=os.toString(16);return es},ue,bt,tr,rr=new Array(80),ir=1732584193,lr=4023233417,dr=2562383102,pr=271733878,hr=3285377520,_r,yr,wr,Tr,Ar,Sr;e=encodeURIComponent(e);let Mr=e.length,vr=[];for(bt=0;bt<Mr-3;bt+=4)tr=e.charCodeAt(bt)<<24|e.charCodeAt(bt+1)<<16|e.charCodeAt(bt+2)<<8|e.charCodeAt(bt+3),vr.push(tr);switch(Mr%4){case 0:bt=2147483648;break;case 1:bt=e.charCodeAt(Mr-1)<<24|8388608;break;case 2:bt=e.charCodeAt(Mr-2)<<24|e.charCodeAt(Mr-1)<<16|32768;break;case 3:bt=e.charCodeAt(Mr-3)<<24|e.charCodeAt(Mr-2)<<16|e.charCodeAt(Mr-1)<<8|128;break}for(vr.push(bt);vr.length%16!==14;)vr.push(0);for(vr.push(Mr>>>29),vr.push(Mr<<3&4294967295),ue=0;ue<vr.length;ue+=16){for(bt=0;bt<16;bt++)rr[bt]=vr[ue+bt];for(bt=16;bt<=79;bt++)rr[bt]=I(rr[bt-3]^rr[bt-8]^rr[bt-14]^rr[bt-16],1);for(_r=ir,yr=lr,wr=dr,Tr=pr,Ar=hr,bt=0;bt<=19;bt++)Sr=I(_r,5)+(yr&wr|~yr&Tr)+Ar+rr[bt]+1518500249&4294967295,Ar=Tr,Tr=wr,wr=I(yr,30),yr=_r,_r=Sr;for(bt=20;bt<=39;bt++)Sr=I(_r,5)+(yr^wr^Tr)+Ar+rr[bt]+1859775393&4294967295,Ar=Tr,Tr=wr,wr=I(yr,30),yr=_r,_r=Sr;for(bt=40;bt<=59;bt++)Sr=I(_r,5)+(yr&wr|yr&Tr|wr&Tr)+Ar+rr[bt]+2400959708&4294967295,Ar=Tr,Tr=wr,wr=I(yr,30),yr=_r,_r=Sr;for(bt=60;bt<=79;bt++)Sr=I(_r,5)+(yr^wr^Tr)+Ar+rr[bt]+3395469782&4294967295,Ar=Tr,Tr=wr,wr=I(yr,30),yr=_r,_r=Sr;ir=ir+_r&4294967295,lr=lr+yr&4294967295,dr=dr+wr&4294967295,pr=pr+Tr&4294967295,hr=hr+Ar&4294967295}return Sr=oe(ir)+oe(lr)+oe(dr)+oe(pr)+oe(hr),Sr.toLowerCase()}}class DefaultNamingStrategy{constructor(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}getTableName(e){return typeof e!="string"&&(e=e.name),e.split(".").pop()}tableName(e,I){return I||snakeCase(e)}closureJunctionTableName(e){return e+"_closure"}columnName(e,I,oe){const ue=I||e;return oe.length?camelCase(oe.join("_"))+titleCase(ue):ue}relationName(e){return e}primaryKeyName(e,I){const oe=[...I];oe.sort();const tr=`${this.getTableName(e).replace(".","_")}_${oe.join("_")}`;return"PK_"+RandomGenerator.sha1(tr).substr(0,27)}uniqueConstraintName(e,I){const oe=[...I];oe.sort();const tr=`${this.getTableName(e).replace(".","_")}_${oe.join("_")}`;return"UQ_"+RandomGenerator.sha1(tr).substr(0,27)}relationConstraintName(e,I,oe){const ue=[...I];ue.sort();let rr=`${this.getTableName(e).replace(".","_")}_${ue.join("_")}`;return oe&&(rr+=`_${oe}`),"REL_"+RandomGenerator.sha1(rr).substr(0,26)}defaultConstraintName(e,I){const bt=`${this.getTableName(e).replace(".","_")}_${I}`;return"DF_"+RandomGenerator.sha1(bt).substr(0,27)}foreignKeyName(e,I,oe,ue){const bt=[...I];bt.sort();const ir=`${this.getTableName(e).replace(".","_")}_${bt.join("_")}`;return"FK_"+RandomGenerator.sha1(ir).substr(0,27)}indexName(e,I,oe){const ue=[...I];ue.sort();let rr=`${this.getTableName(e).replace(".","_")}_${ue.join("_")}`;return oe&&(rr+=`_${oe}`),"IDX_"+RandomGenerator.sha1(rr).substr(0,26)}checkConstraintName(e,I,oe){const tr=`${this.getTableName(e).replace(".","_")}_${I}`,rr="CHK_"+RandomGenerator.sha1(tr).substr(0,26);return oe?`${rr}_ENUM`:rr}exclusionConstraintName(e,I){const bt=`${this.getTableName(e).replace(".","_")}_${I}`;return"XCL_"+RandomGenerator.sha1(bt).substr(0,26)}joinColumnName(e,I){return camelCase(e+"_"+I)}joinTableName(e,I,oe,ue){return snakeCase(e+"_"+oe.replace(/\./gi,"_")+"_"+I)}joinTableColumnDuplicationPrefix(e,I){return e+"_"+I}joinTableColumnName(e,I,oe){return camelCase(e+"_"+(oe||I))}joinTableInverseColumnName(e,I,oe){return this.joinTableColumnName(e,I,oe)}prefixTableName(e,I){return e+I}}class TableColumn{constructor(e){this["@instanceof"]=Symbol.for("TableColumn"),this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=this.zerofill?!0:e.unsigned||!1,this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.generatedIdentity=e.generatedIdentity,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.primaryKeyConstraintName=e.primaryKeyConstraintName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}clone(){return new TableColumn({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,primaryKeyConstraintName:this.primaryKeyConstraintName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,generatedIdentity:this.generatedIdentity,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})}}class TableIndex{constructor(e){this["@instanceof"]=Symbol.for("TableIndex"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isConcurrent=!!e.isConcurrent,this.isFulltext=!!e.isFulltext,this.isNullFiltered=!!e.isNullFiltered,this.parser=e.parser,this.where=e.where?e.where:""}clone(){return new TableIndex({name:this.name,columnNames:[...this.columnNames],isUnique:this.isUnique,isSpatial:this.isSpatial,isConcurrent:this.isConcurrent,isFulltext:this.isFulltext,isNullFiltered:this.isNullFiltered,parser:this.parser,where:this.where})}static create(e){return new TableIndex({name:e.name,columnNames:e.columns.map(I=>I.databaseName),isUnique:e.isUnique,isSpatial:e.isSpatial,isConcurrent:e.isConcurrent,isFulltext:e.isFulltext,isNullFiltered:e.isNullFiltered,parser:e.parser,where:e.where})}}class TableForeignKey{constructor(e){this["@instanceof"]=Symbol.for("TableForeignKey"),this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedDatabase=e.referencedDatabase,this.referencedSchema=e.referencedSchema,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}clone(){return new TableForeignKey({name:this.name,columnNames:[...this.columnNames],referencedColumnNames:[...this.referencedColumnNames],referencedDatabase:this.referencedDatabase,referencedSchema:this.referencedSchema,referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})}static create(e,I){return new TableForeignKey({name:e.name,columnNames:e.columnNames,referencedColumnNames:e.referencedColumnNames,referencedDatabase:e.referencedEntityMetadata.database,referencedSchema:e.referencedEntityMetadata.schema,referencedTableName:e.referencedTablePath,onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable})}}class TableUtils{static createTableColumnOptions(e,I){return{name:e.databaseName,length:I.getColumnLength(e),width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:I.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,generatedIdentity:e.generatedIdentity,isNullable:e.isNullable,type:I.normalizeType(e),isPrimary:e.isPrimary,isUnique:I.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map(oe=>oe+""):e.enum,enumName:e.enumName,primaryKeyConstraintName:e.primaryKeyConstraintName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}}}class TableUnique{constructor(e){this["@instanceof"]=Symbol.for("TableUnique"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.deferrable=e.deferrable}clone(){return new TableUnique({name:this.name,columnNames:[...this.columnNames],deferrable:this.deferrable})}static create(e){return new TableUnique({name:e.name,columnNames:e.columns.map(I=>I.databaseName),deferrable:e.deferrable})}}class TableCheck{constructor(e){this["@instanceof"]=Symbol.for("TableCheck"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}clone(){return new TableCheck({name:this.name,columnNames:this.columnNames?[...this.columnNames]:[],expression:this.expression})}static create(e){return new TableCheck({name:e.name,expression:e.expression})}}class TableExclusion{constructor(e){this["@instanceof"]=Symbol.for("TableExclusion"),this.name=e.name,this.expression=e.expression}clone(){return new TableExclusion({name:this.name,expression:this.expression})}static create(e){return new TableExclusion({name:e.name,expression:e.expression})}}class Table{constructor(e){this["@instanceof"]=Symbol.for("Table"),this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,this.withoutRowid=!1,e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,e.columns&&(this.columns=e.columns.map(I=>new TableColumn(I))),e.indices&&(this.indices=e.indices.map(I=>new TableIndex(I))),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map(I=>new TableForeignKey({...I,referencedDatabase:I?.referencedDatabase||e.database,referencedSchema:I?.referencedSchema||e.schema}))),e.uniques&&(this.uniques=e.uniques.map(I=>new TableUnique(I))),e.checks&&(this.checks=e.checks.map(I=>new TableCheck(I))),e.exclusions&&(this.exclusions=e.exclusions.map(I=>new TableExclusion(I))),e.justCreated!==void 0&&(this.justCreated=e.justCreated),e.withoutRowid&&(this.withoutRowid=e.withoutRowid),this.engine=e.engine,this.comment=e.comment)}get primaryColumns(){return this.columns.filter(e=>e.isPrimary)}clone(){return new Table({schema:this.schema,database:this.database,name:this.name,columns:this.columns.map(e=>e.clone()),indices:this.indices.map(e=>e.clone()),foreignKeys:this.foreignKeys.map(e=>e.clone()),uniques:this.uniques.map(e=>e.clone()),checks:this.checks.map(e=>e.clone()),exclusions:this.exclusions.map(e=>e.clone()),justCreated:this.justCreated,withoutRowid:this.withoutRowid,engine:this.engine,comment:this.comment})}addColumn(e){this.columns.push(e)}removeColumn(e){const I=this.columns.find(oe=>oe.name===e.name);I&&this.columns.splice(this.columns.indexOf(I),1)}addUniqueConstraint(e){if(this.uniques.push(e),e.columnNames.length===1){const I=this.columns.find(oe=>oe.name===e.columnNames[0]);I&&(I.isUnique=!0)}}removeUniqueConstraint(e){const I=this.uniques.find(oe=>oe.name===e.name);if(I&&(this.uniques.splice(this.uniques.indexOf(I),1),I.columnNames.length===1)){const oe=this.columns.find(ue=>ue.name===I.columnNames[0]);oe&&(oe.isUnique=!1)}}addCheckConstraint(e){this.checks.push(e)}removeCheckConstraint(e){const I=this.checks.find(oe=>oe.name===e.name);I&&this.checks.splice(this.checks.indexOf(I),1)}addExclusionConstraint(e){this.exclusions.push(e)}removeExclusionConstraint(e){const I=this.exclusions.find(oe=>oe.name===e.name);I&&this.exclusions.splice(this.exclusions.indexOf(I),1)}addForeignKey(e){this.foreignKeys.push(e)}removeForeignKey(e){const I=this.foreignKeys.find(oe=>oe.name===e.name);I&&this.foreignKeys.splice(this.foreignKeys.indexOf(I),1)}addIndex(e,I=!1){if(this.indices.push(e),e.columnNames.length===1&&e.isUnique&&I){const oe=this.columns.find(ue=>ue.name===e.columnNames[0]);oe&&(oe.isUnique=!0)}}removeIndex(e,I=!1){const oe=this.indices.find(ue=>ue.name===e.name);if(oe&&(this.indices.splice(this.indices.indexOf(oe),1),oe.columnNames.length===1&&oe.isUnique&&I)){const ue=this.columns.find(bt=>bt.name===oe.columnNames[0]);ue&&(ue.isUnique=this.indices.some(bt=>bt.columnNames.length===1&&bt.columnNames[0]===ue.name&&!!oe.isUnique))}}findColumnByName(e){return this.columns.find(I=>I.name===e)}findColumnIndices(e){return this.indices.filter(I=>!!I.columnNames.find(oe=>oe===e.name))}findColumnForeignKeys(e){return this.foreignKeys.filter(I=>!!I.columnNames.find(oe=>oe===e.name))}findColumnUniques(e){return this.uniques.filter(I=>!!I.columnNames.find(oe=>oe===e.name))}findColumnChecks(e){return this.checks.filter(I=>!!I.columnNames.find(oe=>oe===e.name))}static create(e,I){const oe=e.database===I.database?void 0:e.database,ue=e.schema===I.options.schema?void 0:e.schema,bt={database:e.database,schema:e.schema,name:I.buildTableName(e.tableName,ue,oe),withoutRowid:e.withoutRowid,engine:e.engine,columns:e.columns.filter(tr=>tr&&!tr.isVirtualProperty).map(tr=>TableUtils.createTableColumnOptions(tr,I)),indices:e.indices.filter(tr=>tr.synchronize===!0).map(tr=>TableIndex.create(tr)),uniques:e.uniques.map(tr=>TableUnique.create(tr)),checks:e.checks.map(tr=>TableCheck.create(tr)),exclusions:e.exclusions.map(tr=>TableExclusion.create(tr)),comment:e.comment};return new Table(bt)}}class Migration{constructor(e,I,oe,ue,bt){this.id=e,this.timestamp=I,this.name=oe,this.instance=ue,this.transaction=bt}}class MssqlParameter{constructor(e,I,...oe){this.value=e,this.type=I,this["@instanceof"]=Symbol.for("MssqlParameter"),this.params=[],this.params=oe||[]}}class MigrationExecutor{constructor(e,I){this.connection=e,this.queryRunner=I,this.transaction="all";const{schema:oe}=this.connection.driver.options,ue=this.connection.driver.database;this.migrationsDatabase=ue,this.migrationsSchema=oe,this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,oe,ue)}async executeMigration(e){return this.withQueryRunner(async I=>{await this.createMigrationsTableIfNotExist(I);const oe=this.connection.driver.createSchemaBuilder();return InstanceChecker.isRdbmsSchemaBuilder(oe)&&await oe.createMetadataTableIfNecessary(I),await I.beforeMigration(),await e.instance.up(I),await I.afterMigration(),await this.insertExecutedMigration(I,e),e})}async getAllMigrations(){return Promise.resolve(this.getMigrations())}async getExecutedMigrations(){return this.withQueryRunner(async e=>(await this.createMigrationsTableIfNotExist(e),await this.loadExecutedMigrations(e)))}async getPendingMigrations(){const e=await this.getAllMigrations(),I=await this.getExecutedMigrations();return e.filter(oe=>!I.find(ue=>ue.name===oe.name))}insertMigration(e){return this.withQueryRunner(I=>this.insertExecutedMigration(I,e))}deleteMigration(e){return this.withQueryRunner(I=>this.deleteExecutedMigration(I,e))}async showMigrations(){let e=!1;const I=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(I);const oe=await this.loadExecutedMigrations(I),ue=this.getMigrations();for(const bt of ue){const tr=oe.find(rr=>rr.name===bt.name);tr?this.connection.logger.logSchemaBuild(`[X] ${tr.id} ${bt.name}`):(e=!0,this.connection.logger.logSchemaBuild(`[ ] ${bt.name}`))}return this.queryRunner||await I.release(),e}async executePendingMigrations(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const I=this.connection.driver.createSchemaBuilder();InstanceChecker.isRdbmsSchemaBuilder(I)&&await I.createMetadataTableIfNecessary(e);const oe=await this.loadExecutedMigrations(e);let ue=this.getLatestTimestampMigration(oe);const bt=this.getMigrations(),tr=[],rr=bt.filter(dr=>!oe.find(hr=>hr.name===dr.name));if(!rr.length)return this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner||await e.release(),[];if(this.connection.logger.logSchemaBuild(`${oe.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${bt.length} migrations were found in the source code.`),ue&&this.connection.logger.logSchemaBuild(`${ue.name} is the last executed migration. It was executed on ${new Date(ue.timestamp).toString()}.`),this.connection.logger.logSchemaBuild(`${rr.length} migrations are new migrations must be executed.`),this.transaction==="all"){const dr=rr.filter(pr=>pr.instance?.transaction!==void 0);if(dr.length>0){const pr=new ForbiddenTransactionModeOverrideError(dr);throw this.connection.logger.logMigration(`Migrations failed, error: ${pr.message}`),pr}}const ir={each:!0,none:!1,all:!1}[this.transaction];for(const dr of rr)if(dr.instance){const pr=dr.instance.transaction;pr===void 0?dr.transaction=ir:dr.transaction=pr}let lr=!1;this.transaction==="all"&&!e.isTransactionActive&&(await e.beforeMigration(),await e.startTransaction(),lr=!0);try{for(const dr of rr){if(this.fake){await this.insertExecutedMigration(e,dr);continue}dr.transaction&&!e.isTransactionActive&&(await e.beforeMigration(),await e.startTransaction(),lr=!0),await dr.instance.up(e).catch(pr=>{throw this.connection.logger.logMigration(`Migration "${dr.name}" failed, error: ${pr?.message}`),pr}).then(async()=>{await this.insertExecutedMigration(e,dr),dr.transaction&&lr&&(await e.commitTransaction(),await e.afterMigration())}).then(()=>{tr.push(dr),this.connection.logger.logSchemaBuild(`Migration ${dr.name} has been ${this.fake?"(fake)":""} executed successfully.`)})}this.transaction==="all"&&lr&&(await e.commitTransaction(),await e.afterMigration())}catch(dr){if(lr)try{await e.rollbackTransaction()}catch{}throw dr}finally{this.queryRunner||await e.release()}return tr}async undoLastMigration(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const I=this.connection.driver.createSchemaBuilder();InstanceChecker.isRdbmsSchemaBuilder(I)&&await I.createMetadataTableIfNecessary(e);const oe=await this.loadExecutedMigrations(e);let ue=this.getLatestExecutedMigration(oe);if(!ue){this.connection.logger.logSchemaBuild("No migrations were found in the database. Nothing to revert!");return}const tr=this.getMigrations().find(ir=>ir.name===ue.name);if(!tr)throw new TypeORMError(`No migration ${ue.name} was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.`);this.connection.logger.logSchemaBuild(`${oe.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${ue.name} is the last executed migration. It was executed on ${new Date(ue.timestamp).toString()}.`),this.connection.logger.logSchemaBuild("Now reverting it...");let rr=!1;this.transaction!=="none"&&!e.isTransactionActive&&(await e.startTransaction(),rr=!0);try{this.fake||(await e.beforeMigration(),await tr.instance.down(e),await e.afterMigration()),await this.deleteExecutedMigration(e,tr),this.connection.logger.logSchemaBuild(`Migration ${tr.name} has been ${this.fake?"(fake)":""} reverted successfully.`),rr&&await e.commitTransaction()}catch(ir){if(rr)try{await e.rollbackTransaction()}catch{}throw ir}finally{this.queryRunner||await e.release()}}async createMigrationsTableIfNotExist(e){if(this.connection.driver.options.type==="mongodb")return;await e.hasTable(this.migrationsTable)||await e.createTable(new Table({database:this.migrationsDatabase,schema:this.migrationsSchema,name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))}async loadExecutedMigrations(e){return this.connection.driver.options.type==="mongodb"?e.cursor(this.migrationsTableName,{}).sort({_id:-1}).toArray():(await this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()).map(oe=>new Migration(parseInt(oe.id),parseInt(oe.timestamp),oe.name))}getMigrations(){const e=this.connection.migrations.map(I=>{const oe=I.name||I.constructor.name,ue=parseInt(oe.substr(-13),10);if(!ue||isNaN(ue))throw new TypeORMError(`${oe} migration name is wrong. Migration class name should have a JavaScript timestamp appended.`);return new Migration(void 0,ue,oe,I)});return this.checkForDuplicateMigrations(e),e.sort((I,oe)=>I.timestamp-oe.timestamp)}checkForDuplicateMigrations(e){const I=e.map(ue=>ue.name),oe=Array.from(new Set(I.filter((ue,bt)=>I.indexOf(ue)<bt)));if(oe.length>0)throw Error(`Duplicate migrations: ${oe.join(", ")}`)}getLatestTimestampMigration(e){const I=e.map(oe=>oe).sort((oe,ue)=>(oe.timestamp-ue.timestamp)*-1);return I.length>0?I[0]:void 0}getLatestExecutedMigration(e){return e.length>0?e[0]:void 0}async insertExecutedMigration(e,I){const oe={};this.connection.driver.options.type==="mssql"?(oe.timestamp=new MssqlParameter(I.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),oe.name=new MssqlParameter(I.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(oe.timestamp=I.timestamp,oe.name=I.name),this.connection.driver.options.type==="mongodb"?await e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insertOne(oe):await e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(oe).execute()}async deleteExecutedMigration(e,I){const oe={};if(this.connection.driver.options.type==="mssql"?(oe.timestamp=new MssqlParameter(I.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),oe.name=new MssqlParameter(I.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(oe.timestamp=I.timestamp,oe.name=I.name),this.connection.driver.options.type==="mongodb")await e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(oe);else{const ue=e.manager.createQueryBuilder();await ue.delete().from(this.migrationsTable).where(`${ue.escape("timestamp")} = :timestamp`).andWhere(`${ue.escape("name")} = :name`).setParameters(oe).execute()}}async withQueryRunner(e){const I=this.queryRunner||this.connection.createQueryRunner();try{return await e(I)}finally{this.queryRunner||await I.release()}}}function createDFS(ae,e,I){let oe=[],ue={};return function bt(tr){ue[tr]=!0,oe.push(tr),ae[tr].forEach(function(rr){if(!ue[rr])bt(rr);else if(oe.indexOf(rr)>=0)throw oe.push(rr),new TypeORMError(`Dependency Cycle Found: ${oe.join(" -> ")}`)}),oe.pop(),(!e||ae[tr].length===0)&&I.indexOf(tr)===-1&&I.push(tr)}}class DepGraph{constructor(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}addNode(e,I){this.hasNode(e)||(arguments.length===2?this.nodes[e]=I:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])}removeNode(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(I){Object.keys(I).forEach(function(oe){const ue=I[oe].indexOf(e);ue>=0&&I[oe].splice(ue,1)})}))}hasNode(e){return this.nodes.hasOwnProperty(e)}getNodeData(e){if(this.hasNode(e))return this.nodes[e];throw new TypeORMError(`Node does not exist: ${e}`)}setNodeData(e,I){if(this.hasNode(e))this.nodes[e]=I;else throw new TypeORMError(`Node does not exist: ${e}`)}addDependency(e,I){if(!this.hasNode(e))throw new TypeORMError(`Node does not exist: ${e}`);if(!this.hasNode(I))throw new TypeORMError(`Node does not exist: ${I}`);return this.outgoingEdges[e].indexOf(I)===-1&&this.outgoingEdges[e].push(I),this.incomingEdges[I].indexOf(e)===-1&&this.incomingEdges[I].push(e),!0}removeDependency(e,I){let oe;this.hasNode(e)&&(oe=this.outgoingEdges[e].indexOf(I),oe>=0&&this.outgoingEdges[e].splice(oe,1)),this.hasNode(I)&&(oe=this.incomingEdges[I].indexOf(e),oe>=0&&this.incomingEdges[I].splice(oe,1))}dependenciesOf(e,I){if(this.hasNode(e)){let oe=[];createDFS(this.outgoingEdges,I,oe)(e);let bt=oe.indexOf(e);return bt>=0&&oe.splice(bt,1),oe}else throw new TypeORMError(`Node does not exist: ${e}`)}dependantsOf(e,I){if(this.hasNode(e)){let oe=[];createDFS(this.incomingEdges,I,oe)(e);let bt=oe.indexOf(e);return bt>=0&&oe.splice(bt,1),oe}else throw new TypeORMError(`Node does not exist: ${e}`)}overallOrder(e){let I=this,oe=[],ue=Object.keys(this.nodes);if(ue.length===0)return oe;{let bt=createDFS(this.outgoingEdges,!1,[]);ue.forEach(function(rr){bt(rr)});let tr=createDFS(this.outgoingEdges,e,oe);return ue.filter(function(rr){return I.incomingEdges[rr].length===0}).forEach(function(rr){tr(rr)}),oe}}}class EntityMetadataValidator{validateMany(e,I){e.forEach(oe=>this.validate(oe,e,I)),this.validateDependencies(e),this.validateEagerRelations(e)}validate(e,I,oe){if(!e.primaryColumns.length&&!e.isJunction)throw new MissingPrimaryColumnError(e);if(e.primaryColumns.length>1&&!e.primaryColumns.every((tr,rr,ir)=>tr.primaryKeyConstraintName===ir[0].primaryKeyConstraintName))throw new TypeORMError(`Entity ${e.name} has multiple primary columns with different constraint names. Constraint names should be the equal.`);if(e.inheritancePattern==="STI"||e.tableType==="entity-child"){if(!e.discriminatorColumn)throw new TypeORMError(`Entity ${e.name} using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?`);if(typeof e.discriminatorValue>"u")throw new TypeORMError(`Entity ${e.name} has an undefined discriminator value. Discriminator value should be defined.`);const bt=I.find(tr=>tr!==e&&(tr.inheritancePattern==="STI"||tr.tableType==="entity-child")&&tr.tableName===e.tableName&&tr.discriminatorValue===e.discriminatorValue&&tr.inheritanceTree.some(rr=>e.inheritanceTree.indexOf(rr)!==-1));if(bt)throw new TypeORMError(`Entities ${e.name} and ${bt.name} have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.`)}if(e.relationCounts.forEach(bt=>{if(bt.relation.isManyToOne||bt.relation.isOneToOne)throw new TypeORMError("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),oe.options.type!=="mongodb"&&e.columns.filter(bt=>!bt.isVirtualProperty).forEach(bt=>{const tr=oe.normalizeType(bt);if(oe.supportedDataTypes.indexOf(tr)===-1)throw new DataTypeNotSupportedError(bt,tr,oe.options.type);if(bt.length&&oe.withLengthColumnTypes.indexOf(tr)===-1)throw new TypeORMError(`Column ${bt.propertyName} of Entity ${e.name} does not support length property.`);if(bt.type==="enum"&&!bt.enum&&!bt.enumName)throw new TypeORMError(`Column "${bt.propertyName}" of Entity "${e.name}" is defined as enum, but missing "enum" or "enumName" properties.`)}),(DriverUtils.isMySQLFamily(oe)||oe.options.type==="aurora-mysql")&&e.columns.filter(tr=>tr.isGenerated&&tr.generationStrategy!=="uuid").length>1)throw new TypeORMError(`Error in ${e.name} entity. There can be only one auto-increment column in MySql table.`);if(DriverUtils.isMySQLFamily(oe)&&I.filter(tr=>tr.database).length===0&&!oe.database)throw new NoConnectionOptionError("database");if(oe.options.type==="mssql"&&e.columns.filter(tr=>tr.charset).length>1)throw new TypeORMError("Character set specifying is not supported in Sql Server");if(oe.options.type==="postgres"){const bt=e.columns.find(tr=>tr.asExpression&&(!tr.generatedType||tr.generatedType==="VIRTUAL"));if(bt)throw new TypeORMError(`Column "${bt.propertyName}" of Entity "${e.name}" is defined as VIRTUAL, but Postgres supports only STORED generated columns.`)}const ue=e.create(void 0,{fromDeserializer:!0});e.relations.forEach(bt=>{if(bt.isManyToMany||bt.isOneToMany){if(bt.persistenceEnabled===!1)return;const tr=bt.getEntityValue(ue);if(Array.isArray(tr))throw new InitializedRelationError(bt)}}),e.relations.forEach(bt=>{if(oe.supportedOnDeleteTypes&&bt.onDelete&&!oe.supportedOnDeleteTypes.includes(bt.onDelete))throw new TypeORMError(`OnDeleteType "${bt.onDelete}" is not supported for ${oe.options.type}!`);if(oe.supportedOnUpdateTypes&&bt.onUpdate&&!oe.supportedOnUpdateTypes.includes(bt.onUpdate))throw new TypeORMError(`OnUpdateType "${bt.onUpdate}" is not valid for ${oe.options.type}!`)}),e.relations.forEach(bt=>{if(bt.isCascadeRemove&&bt.inverseRelation&&bt.inverseRelation.isCascadeRemove)throw new TypeORMError(`Relation ${e.name}#${bt.propertyName} and ${bt.inverseRelation.entityMetadata.name}#${bt.inverseRelation.propertyName} both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.`)}),e.eagerRelations.forEach(bt=>{})}validateDependencies(e){const I=new DepGraph;e.forEach(oe=>{I.addNode(oe.name)}),e.forEach(oe=>{oe.relationsWithJoinColumns.filter(ue=>!ue.isNullable).forEach(ue=>{I.addDependency(oe.name,ue.inverseEntityMetadata.name)})});try{I.overallOrder()}catch(oe){throw new CircularRelationsError(oe.toString().replace("Error: Dependency Cycle Found: ",""))}}validateEagerRelations(e){e.forEach(I=>{I.eagerRelations.forEach(oe=>{if(oe.inverseRelation&&oe.inverseRelation.isEager)throw new TypeORMError(`Circular eager relations are disallowed. ${I.targetName}#${oe.propertyPath} contains "eager: true", and its inverse side ${oe.inverseEntityMetadata.targetName}#${oe.inverseRelation.propertyPath} contains "eager: true" as well. Remove "eager: true" from one side of the relation.`)})})}}class MongoDriver{}class MongoEntityManager{}class MongoRepository{}class CockroachDriver{}class SqlServerDriver{}class SapDriver{}class MysqlDriver{}class OracleDriver{}class SqliteDriver{}class BetterSqlite3Driver{}class TreeRepositoryUtils{static createRelationMaps(e,I,oe,ue){return ue.map(bt=>{const tr=I.treeParentRelation.joinColumns[0],rr=tr.referencedColumn??I.primaryColumns[0],ir=tr.givenDatabaseName||tr.databaseName,lr=rr.givenDatabaseName||rr.databaseName,dr=bt[oe+"_"+lr],pr=bt[oe+"_"+ir];return{id:e.connection.driver.prepareHydratedValue(dr,rr),parentId:e.connection.driver.prepareHydratedValue(pr,tr)}})}static buildChildrenEntityTree(e,I,oe,ue,bt){const tr=e.treeChildrenRelation.propertyName;if(bt.depth===0){I[tr]=[];return}const ir=e.treeParentRelation.joinColumns[0].referencedColumn??e.primaryColumns[0],lr=ir.getEntityValue(I),dr=ue.filter(hr=>hr.parentId===lr),pr=new Set(dr.map(hr=>hr.id));I[tr]=oe.filter(hr=>pr.has(ir.getEntityValue(hr))),I[tr].forEach(hr=>{TreeRepositoryUtils.buildChildrenEntityTree(e,hr,oe,ue,{...bt,depth:bt.depth-1})})}static buildParentEntityTree(e,I,oe,ue){const bt=e.treeParentRelation.propertyName,rr=e.treeParentRelation.joinColumns[0].referencedColumn??e.primaryColumns[0],ir=rr.getEntityValue(I),lr=ue.find(pr=>pr.id===ir),dr=oe.find(pr=>lr?rr.getEntityValue(pr)===lr.parentId:!1);dr&&(I[bt]=dr,TreeRepositoryUtils.buildParentEntityTree(e,I[bt],oe,ue))}}class Repository{get metadata(){return this.manager.connection.getMetadata(this.target)}constructor(e,I,oe){this.target=e,this.manager=I,this.queryRunner=oe}createQueryBuilder(e,I){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,I||this.queryRunner)}hasId(e){return this.manager.hasId(this.metadata.target,e)}getId(e){return this.manager.getId(this.metadata.target,e)}create(e){return this.manager.create(this.metadata.target,e)}merge(e,...I){return this.manager.merge(this.metadata.target,e,...I)}preload(e){return this.manager.preload(this.metadata.target,e)}save(e,I){return this.manager.save(this.metadata.target,e,I)}remove(e,I){return this.manager.remove(this.metadata.target,e,I)}softRemove(e,I){return this.manager.softRemove(this.metadata.target,e,I)}recover(e,I){return this.manager.recover(this.metadata.target,e,I)}insert(e){return this.manager.insert(this.metadata.target,e)}update(e,I){return this.manager.update(this.metadata.target,e,I)}upsert(e,I){return this.manager.upsert(this.metadata.target,e,I)}delete(e){return this.manager.delete(this.metadata.target,e)}softDelete(e){return this.manager.softDelete(this.metadata.target,e)}restore(e){return this.manager.restore(this.metadata.target,e)}exist(e){return this.manager.exists(this.metadata.target,e)}exists(e){return this.manager.exists(this.metadata.target,e)}existsBy(e){return this.manager.existsBy(this.metadata.target,e)}count(e){return this.manager.count(this.metadata.target,e)}countBy(e){return this.manager.countBy(this.metadata.target,e)}sum(e,I){return this.manager.sum(this.metadata.target,e,I)}average(e,I){return this.manager.average(this.metadata.target,e,I)}minimum(e,I){return this.manager.minimum(this.metadata.target,e,I)}maximum(e,I){return this.manager.maximum(this.metadata.target,e,I)}async find(e){return this.manager.find(this.metadata.target,e)}async findBy(e){return this.manager.findBy(this.metadata.target,e)}findAndCount(e){return this.manager.findAndCount(this.metadata.target,e)}findAndCountBy(e){return this.manager.findAndCountBy(this.metadata.target,e)}async findByIds(e){return this.manager.findByIds(this.metadata.target,e)}async findOne(e){return this.manager.findOne(this.metadata.target,e)}async findOneBy(e){return this.manager.findOneBy(this.metadata.target,e)}async findOneById(e){return this.manager.findOneById(this.metadata.target,e)}async findOneOrFail(e){return this.manager.findOneOrFail(this.metadata.target,e)}async findOneByOrFail(e){return this.manager.findOneByOrFail(this.metadata.target,e)}query(e,I){return this.manager.query(e,I)}clear(){return this.manager.clear(this.metadata.target)}increment(e,I,oe){return this.manager.increment(this.metadata.target,e,I,oe)}decrement(e,I,oe){return this.manager.decrement(this.metadata.target,e,I,oe)}extend(e){const I=this.constructor,{target:oe,manager:ue,queryRunner:bt}=this,tr=class extends I{constructor(rr,ir,lr){super(rr,ir,lr)}};for(const rr in e)tr.prototype[rr]=e[rr];return new tr(oe,ue,bt)}}class TreeRepository extends Repository{async findTrees(e){const I=await this.findRoots(e);return await Promise.all(I.map(oe=>this.findDescendantsTree(oe,e))),I}findRoots(e){const I=rr=>this.manager.connection.driver.escape(rr),oe=rr=>this.manager.connection.driver.escape(rr),ue=this.metadata.treeParentRelation.joinColumns[0],bt=ue.givenDatabaseName||ue.databaseName,tr=this.createQueryBuilder("treeEntity");return FindOptionsUtils.applyOptionsToTreeQueryBuilder(tr,e),tr.where(`${I("treeEntity")}.${oe(bt)} IS NULL`).getMany()}findDescendants(e,I){const oe=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);return FindOptionsUtils.applyOptionsToTreeQueryBuilder(oe,I),oe.getMany()}async findDescendantsTree(e,I){const oe=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);FindOptionsUtils.applyOptionsToTreeQueryBuilder(oe,I);const ue=await oe.getRawAndEntities(),bt=TreeRepositoryUtils.createRelationMaps(this.manager,this.metadata,"treeEntity",ue.raw);return TreeRepositoryUtils.buildChildrenEntityTree(this.metadata,e,ue.entities,bt,{depth:-1,...I}),e}countDescendants(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()}createDescendantsQueryBuilder(e,I,oe){const ue=bt=>this.manager.connection.driver.escape(bt);if(this.metadata.treeType==="closure-table"){const bt=this.metadata.closureJunctionTable.descendantColumns.map(ir=>ue(I)+"."+ue(ir.propertyPath)+" = "+ue(e)+"."+ue(ir.referencedColumn.propertyPath)).join(" AND "),tr={},rr=this.metadata.closureJunctionTable.ancestorColumns.map(ir=>(tr[ir.referencedColumn.propertyName]=ir.referencedColumn.getEntityValue(oe),ue(I)+"."+ue(ir.propertyPath)+" = :"+ir.referencedColumn.propertyName)).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,I,bt).where(rr).setParameters(tr)}else if(this.metadata.treeType==="nested-set"){const bt=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath,tr={},rr=this.metadata.treeParentRelation.joinColumns.map(ir=>{const lr=ir.referencedColumn.propertyPath.replace(".","_");return tr[lr]=ir.referencedColumn.getEntityValue(oe),"joined."+ir.referencedColumn.propertyPath+" = :"+lr}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",bt).where(rr,tr)}else if(this.metadata.treeType==="materialized-path")return this.createQueryBuilder(e).where(bt=>{const tr=bt.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(oe));return DriverUtils.isSQLiteFamily(this.manager.connection.driver)?`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE ${tr.getQuery()} || '%'`:`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE NULLIF(CONCAT(${tr.getQuery()}, '%'), '%')`});throw new TypeORMError("Supported only in tree entities")}findAncestors(e,I){const oe=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);return FindOptionsUtils.applyOptionsToTreeQueryBuilder(oe,I),oe.getMany()}async findAncestorsTree(e,I){const oe=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);FindOptionsUtils.applyOptionsToTreeQueryBuilder(oe,I);const ue=await oe.getRawAndEntities(),bt=TreeRepositoryUtils.createRelationMaps(this.manager,this.metadata,"treeEntity",ue.raw);return TreeRepositoryUtils.buildParentEntityTree(this.metadata,e,ue.entities,bt),e}countAncestors(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()}createAncestorsQueryBuilder(e,I,oe){if(this.metadata.treeType==="closure-table"){const ue=this.metadata.closureJunctionTable.ancestorColumns.map(rr=>I+"."+rr.propertyPath+" = "+e+"."+rr.referencedColumn.propertyPath).join(" AND "),bt={},tr=this.metadata.closureJunctionTable.descendantColumns.map(rr=>(bt[rr.referencedColumn.propertyName]=rr.referencedColumn.getEntityValue(oe),I+"."+rr.propertyPath+" = :"+rr.referencedColumn.propertyName)).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,I,ue).where(tr).setParameters(bt)}else if(this.metadata.treeType==="nested-set"){const ue="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath,bt={},tr=this.metadata.treeParentRelation.joinColumns.map(rr=>{const ir=rr.referencedColumn.propertyPath.replace(".","_");return bt[ir]=rr.referencedColumn.getEntityValue(oe),"joined."+rr.referencedColumn.propertyPath+" = :"+ir}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",ue).where(tr,bt)}else if(this.metadata.treeType==="materialized-path")return this.createQueryBuilder(e).where(ue=>{const bt=ue.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(oe));return DriverUtils.isSQLiteFamily(this.manager.connection.driver)?`${bt.getQuery()} LIKE ${e}.${this.metadata.materializedPathColumn.propertyPath} || '%'`:`${bt.getQuery()} LIKE CONCAT(${e}.${this.metadata.materializedPathColumn.propertyPath}, '%')`});throw new TypeORMError("Supported only in tree entities")}}class PlainObjectToNewEntityTransformer{transform(e,I,oe,ue=!1){return this.groupAndTransform(e,I,oe,ue),e}groupAndTransform(e,I,oe,ue=!1){oe.nonVirtualColumns.forEach(bt=>{const tr=bt.getEntityValue(I);tr!==void 0&&bt.setEntityValue(e,tr)}),oe.relations.length&&oe.relations.forEach(bt=>{let tr=bt.getEntityValue(e);const rr=bt.getEntityValue(I,ue);if(rr!==void 0)if(bt.isOneToMany||bt.isManyToMany){if(!Array.isArray(rr))return;tr||(tr=[],bt.setEntityValue(e,tr)),rr.forEach(ir=>{let lr=tr.find(pr=>bt.inverseEntityMetadata.compareEntities(ir,pr));const dr=bt.inverseEntityMetadata.findInheritanceMetadata(ir);lr||(lr=dr.create(void 0,{fromDeserializer:!0}),tr.push(lr)),this.groupAndTransform(lr,ir,dr,ue)})}else{if(!ObjectUtils.isObject(rr)){ObjectUtils.isObject(tr)||bt.setEntityValue(e,rr);return}const ir=bt.inverseEntityMetadata.findInheritanceMetadata(rr);tr||(tr=ir.create(void 0,{fromDeserializer:!0}),bt.setEntityValue(e,tr)),this.groupAndTransform(tr,rr,ir,ue)}})}}class LoadMapItem{constructor(e,I,oe,ue){this.plainEntity=e,this.metadata=I,this.parentLoadMapItem=oe,this.relation=ue}get target(){return this.metadata.target}get id(){return this.metadata.getEntityIdMixedMap(this.plainEntity)}}class LoadMap{constructor(){this.loadMapItems=[]}get mainLoadMapItem(){return this.loadMapItems.find(e=>!e.relation&&!e.parentLoadMapItem)}addLoadMap(e){this.loadMapItems.find(oe=>oe.target===e.target&&oe.id===e.id)||this.loadMapItems.push(e)}fillEntities(e,I){I.forEach(oe=>{const ue=this.loadMapItems.find(bt=>bt.target===e&&bt.metadata.compareEntities(oe,bt.plainEntity));ue&&(ue.entity=oe)})}groupByTargetIds(){const e=[];return this.loadMapItems.forEach(I=>{let oe=e.find(ue=>ue.target===I.target);oe||(oe={target:I.target,ids:[]},e.push(oe)),oe.ids.push(I.id)}),e}}class PlainObjectToDatabaseEntityTransformer{constructor(e){this.manager=e}async transform(e,I){if(!I.hasAllPrimaryKeys(e))return Promise.reject("Given object does not have a primary column, cannot transform it to database entity.");const oe=new LoadMap,ue=(bt,tr,rr,ir)=>{const lr=new LoadMapItem(bt,tr,rr,ir);oe.addLoadMap(lr),tr.extractRelationValuesFromEntity(bt,I.relations).filter(dr=>dr!=null).forEach(([dr,pr,hr])=>ue(pr,hr,lr,dr))};return ue(e,I),await Promise.all(oe.groupByTargetIds().map(bt=>this.manager.findByIds(bt.target,bt.ids).then(tr=>oe.fillEntities(bt.target,tr)))),oe.loadMapItems.forEach(bt=>{!bt.relation||!bt.entity||!bt.parentLoadMapItem||!bt.parentLoadMapItem.entity||(bt.relation.isManyToMany||bt.relation.isOneToMany?(bt.parentLoadMapItem.entity[bt.relation.propertyName]||(bt.parentLoadMapItem.entity[bt.relation.propertyName]=[]),bt.parentLoadMapItem.entity[bt.relation.propertyName].push(bt.entity)):bt.parentLoadMapItem.entity[bt.relation.propertyName]=bt.entity)}),oe.mainLoadMapItem?oe.mainLoadMapItem.entity:void 0}}class AbstractRepository{get repository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)}get treeRepository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)}createQueryBuilder(e){const I=this.getCustomRepositoryTarget(this.constructor);if(!I)throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(I).createQueryBuilder(e)}createQueryBuilderFor(e,I){return this.getRepositoryFor(e).createQueryBuilder(I)}getRepositoryFor(e){return this.manager.getRepository(e)}getTreeRepositoryFor(e){return this.manager.getTreeRepository(e)}getCustomRepositoryTarget(e){const I=getMetadataArgsStorage().entityRepositories.find(oe=>oe.target===(typeof e=="function"?e:e.constructor));if(!I)throw new CustomRepositoryNotFoundError(e);return I.entity}}class SubjectTopoligicalSorter{constructor(e){this.subjects=[...e],this.metadatas=this.getUniqueMetadatas(this.subjects)}sort(e){if(!this.metadatas.length)return this.subjects;const I=[];if(e==="delete"){const rr=this.subjects.filter(ir=>!ir.entity&&!ir.databaseEntity);I.push(...rr),this.removeAlreadySorted(rr)}const oe=this.getNonNullableDependencies();let ue=this.toposort(oe);e==="insert"&&(ue=ue.reverse()),ue.forEach(rr=>{const ir=this.subjects.filter(lr=>lr.metadata.targetName===rr||lr.metadata.inheritanceTree.some(dr=>dr.name===rr));I.push(...ir),this.removeAlreadySorted(ir)});const bt=this.getDependencies();let tr=this.toposort(bt);return e==="insert"&&(tr=tr.reverse()),tr.forEach(rr=>{const ir=this.subjects.filter(lr=>lr.metadata.targetName===rr);I.push(...ir),this.removeAlreadySorted(ir)}),I.push(...this.subjects),I}removeAlreadySorted(e){e.forEach(I=>{this.subjects.splice(this.subjects.indexOf(I),1)})}getUniqueMetadatas(e){const I=[];return e.forEach(oe=>{I.indexOf(oe.metadata)===-1&&I.push(oe.metadata)}),I}getNonNullableDependencies(){return this.metadatas.reduce((e,I)=>(I.relationsWithJoinColumns.forEach(oe=>{oe.isNullable||e.push([I.targetName,oe.inverseEntityMetadata.targetName])}),e),[])}getDependencies(){return this.metadatas.reduce((e,I)=>(I.relationsWithJoinColumns.forEach(oe=>{oe.inverseEntityMetadata!==I&&e.push([I.targetName,oe.inverseEntityMetadata.targetName])}),e),[])}toposort(e){function I(lr){let dr=[];for(let pr=0,hr=lr.length;pr<hr;pr++){let _r=lr[pr];dr.indexOf(_r[0])<0&&dr.push(_r[0]),dr.indexOf(_r[1])<0&&dr.push(_r[1])}return dr}const oe=I(e);let ue=oe.length,bt=new Array(ue),tr={},rr=ue;for(;rr--;)tr[rr]||ir(oe[rr],rr,[]);function ir(lr,dr,pr){if(pr.indexOf(lr)>=0)throw new TypeORMError("Cyclic dependency: "+JSON.stringify(lr));if(!~oe.indexOf(lr))throw new TypeORMError("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(lr));if(tr[dr])return;tr[dr]=!0;let hr=e.filter(function(_r){return _r[0]===lr});if(dr=hr.length){let _r=pr.concat(lr);do{let yr=hr[--dr][1];ir(yr,oe.indexOf(yr),_r)}while(dr)}bt[--ue]=lr}return bt}}var dayjs_min={exports:{}};(function(ae,e){(function(I,oe){ae.exports=oe()})(commonjsGlobal,function(){var I=1e3,oe=6e4,ue=36e5,bt="millisecond",tr="second",rr="minute",ir="hour",lr="day",dr="week",pr="month",hr="quarter",_r="year",yr="date",wr="Invalid Date",Tr=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Ar=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Sr={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(Or){var Dr=["th","st","nd","rd"],Ur=Or%100;return"["+Or+(Dr[(Ur-20)%10]||Dr[Ur]||Dr[0])+"]"}},Mr=function(Or,Dr,Ur){var kr=String(Or);return!kr||kr.length>=Dr?Or:""+Array(Dr+1-kr.length).join(Ur)+Or},vr={s:Mr,z:function(Or){var Dr=-Or.utcOffset(),Ur=Math.abs(Dr),kr=Math.floor(Ur/60),Qr=Ur%60;return(Dr<=0?"+":"-")+Mr(kr,2,"0")+":"+Mr(Qr,2,"0")},m:function Or(Dr,Ur){if(Dr.date()<Ur.date())return-Or(Ur,Dr);var kr=12*(Ur.year()-Dr.year())+(Ur.month()-Dr.month()),Qr=Dr.clone().add(kr,pr),is=Ur-Qr<0,cs=Dr.clone().add(kr+(is?-1:1),pr);return+(-(kr+(Ur-Qr)/(is?Qr-cs:cs-Qr))||0)},a:function(Or){return Or<0?Math.ceil(Or)||0:Math.floor(Or)},p:function(Or){return{M:pr,y:_r,w:dr,d:lr,D:yr,h:ir,m:rr,s:tr,ms:bt,Q:hr}[Or]||String(Or||"").toLowerCase().replace(/s$/,"")},u:function(Or){return Or===void 0}},Lr="en",es={};es[Lr]=Sr;var ss="$isDayjsObject",os=function(Or){return Or instanceof zr||!(!Or||!Or[ss])},$r=function Or(Dr,Ur,kr){var Qr;if(!Dr)return Lr;if(typeof Dr=="string"){var is=Dr.toLowerCase();es[is]&&(Qr=is),Ur&&(es[is]=Ur,Qr=is);var cs=Dr.split("-");if(!Qr&&cs.length>1)return Or(cs[0])}else{var _s=Dr.name;es[_s]=Dr,Qr=_s}return!kr&&Qr&&(Lr=Qr),Qr||!kr&&Lr},ns=function(Or,Dr){if(os(Or))return Or.clone();var Ur=typeof Dr=="object"?Dr:{};return Ur.date=Or,Ur.args=arguments,new zr(Ur)},Nr=vr;Nr.l=$r,Nr.i=os,Nr.w=function(Or,Dr){return ns(Or,{locale:Dr.$L,utc:Dr.$u,x:Dr.$x,$offset:Dr.$offset})};var zr=function(){function Or(Ur){this.$L=$r(Ur.locale,null,!0),this.parse(Ur),this.$x=this.$x||Ur.x||{},this[ss]=!0}var Dr=Or.prototype;return Dr.parse=function(Ur){this.$d=function(kr){var Qr=kr.date,is=kr.utc;if(Qr===null)return new Date(NaN);if(Nr.u(Qr))return new Date;if(Qr instanceof Date)return new Date(Qr);if(typeof Qr=="string"&&!/Z$/i.test(Qr)){var cs=Qr.match(Tr);if(cs){var _s=cs[2]-1||0,as=(cs[7]||"0").substring(0,3);return is?new Date(Date.UTC(cs[1],_s,cs[3]||1,cs[4]||0,cs[5]||0,cs[6]||0,as)):new Date(cs[1],_s,cs[3]||1,cs[4]||0,cs[5]||0,cs[6]||0,as)}}return new Date(Qr)}(Ur),this.init()},Dr.init=function(){var Ur=this.$d;this.$y=Ur.getFullYear(),this.$M=Ur.getMonth(),this.$D=Ur.getDate(),this.$W=Ur.getDay(),this.$H=Ur.getHours(),this.$m=Ur.getMinutes(),this.$s=Ur.getSeconds(),this.$ms=Ur.getMilliseconds()},Dr.$utils=function(){return Nr},Dr.isValid=function(){return this.$d.toString()!==wr},Dr.isSame=function(Ur,kr){var Qr=ns(Ur);return this.startOf(kr)<=Qr&&Qr<=this.endOf(kr)},Dr.isAfter=function(Ur,kr){return ns(Ur)<this.startOf(kr)},Dr.isBefore=function(Ur,kr){return this.endOf(kr)<ns(Ur)},Dr.$g=function(Ur,kr,Qr){return Nr.u(Ur)?this[kr]:this.set(Qr,Ur)},Dr.unix=function(){return Math.floor(this.valueOf()/1e3)},Dr.valueOf=function(){return this.$d.getTime()},Dr.startOf=function(Ur,kr){var Qr=this,is=!!Nr.u(kr)||kr,cs=Nr.p(Ur),_s=function(Cs,Es){var xs=Nr.w(Qr.$u?Date.UTC(Qr.$y,Es,Cs):new Date(Qr.$y,Es,Cs),Qr);return is?xs:xs.endOf(lr)},as=function(Cs,Es){return Nr.w(Qr.toDate()[Cs].apply(Qr.toDate("s"),(is?[0,0,0,0]:[23,59,59,999]).slice(Es)),Qr)},gs=this.$W,hs=this.$M,ps=this.$D,Ms="set"+(this.$u?"UTC":"");switch(cs){case _r:return is?_s(1,0):_s(31,11);case pr:return is?_s(1,hs):_s(0,hs+1);case dr:var bs=this.$locale().weekStart||0,Ts=(gs<bs?gs+7:gs)-bs;return _s(is?ps-Ts:ps+(6-Ts),hs);case lr:case yr:return as(Ms+"Hours",0);case ir:return as(Ms+"Minutes",1);case rr:return as(Ms+"Seconds",2);case tr:return as(Ms+"Milliseconds",3);default:return this.clone()}},Dr.endOf=function(Ur){return this.startOf(Ur,!1)},Dr.$set=function(Ur,kr){var Qr,is=Nr.p(Ur),cs="set"+(this.$u?"UTC":""),_s=(Qr={},Qr[lr]=cs+"Date",Qr[yr]=cs+"Date",Qr[pr]=cs+"Month",Qr[_r]=cs+"FullYear",Qr[ir]=cs+"Hours",Qr[rr]=cs+"Minutes",Qr[tr]=cs+"Seconds",Qr[bt]=cs+"Milliseconds",Qr)[is],as=is===lr?this.$D+(kr-this.$W):kr;if(is===pr||is===_r){var gs=this.clone().set(yr,1);gs.$d[_s](as),gs.init(),this.$d=gs.set(yr,Math.min(this.$D,gs.daysInMonth())).$d}else _s&&this.$d[_s](as);return this.init(),this},Dr.set=function(Ur,kr){return this.clone().$set(Ur,kr)},Dr.get=function(Ur){return this[Nr.p(Ur)]()},Dr.add=function(Ur,kr){var Qr,is=this;Ur=Number(Ur);var cs=Nr.p(kr),_s=function(hs){var ps=ns(is);return Nr.w(ps.date(ps.date()+Math.round(hs*Ur)),is)};if(cs===pr)return this.set(pr,this.$M+Ur);if(cs===_r)return this.set(_r,this.$y+Ur);if(cs===lr)return _s(1);if(cs===dr)return _s(7);var as=(Qr={},Qr[rr]=oe,Qr[ir]=ue,Qr[tr]=I,Qr)[cs]||1,gs=this.$d.getTime()+Ur*as;return Nr.w(gs,this)},Dr.subtract=function(Ur,kr){return this.add(-1*Ur,kr)},Dr.format=function(Ur){var kr=this,Qr=this.$locale();if(!this.isValid())return Qr.invalidDate||wr;var is=Ur||"YYYY-MM-DDTHH:mm:ssZ",cs=Nr.z(this),_s=this.$H,as=this.$m,gs=this.$M,hs=Qr.weekdays,ps=Qr.months,Ms=Qr.meridiem,bs=function(Es,xs,As,Rs){return Es&&(Es[xs]||Es(kr,is))||As[xs].slice(0,Rs)},Ts=function(Es){return Nr.s(_s%12||12,Es,"0")},Cs=Ms||function(Es,xs,As){var Rs=Es<12?"AM":"PM";return As?Rs.toLowerCase():Rs};return is.replace(Ar,function(Es,xs){return xs||function(As){switch(As){case"YY":return String(kr.$y).slice(-2);case"YYYY":return Nr.s(kr.$y,4,"0");case"M":return gs+1;case"MM":return Nr.s(gs+1,2,"0");case"MMM":return bs(Qr.monthsShort,gs,ps,3);case"MMMM":return bs(ps,gs);case"D":return kr.$D;case"DD":return Nr.s(kr.$D,2,"0");case"d":return String(kr.$W);case"dd":return bs(Qr.weekdaysMin,kr.$W,hs,2);case"ddd":return bs(Qr.weekdaysShort,kr.$W,hs,3);case"dddd":return hs[kr.$W];case"H":return String(_s);case"HH":return Nr.s(_s,2,"0");case"h":return Ts(1);case"hh":return Ts(2);case"a":return Cs(_s,as,!0);case"A":return Cs(_s,as,!1);case"m":return String(as);case"mm":return Nr.s(as,2,"0");case"s":return String(kr.$s);case"ss":return Nr.s(kr.$s,2,"0");case"SSS":return Nr.s(kr.$ms,3,"0");case"Z":return cs}return null}(Es)||cs.replace(":","")})},Dr.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},Dr.diff=function(Ur,kr,Qr){var is,cs=this,_s=Nr.p(kr),as=ns(Ur),gs=(as.utcOffset()-this.utcOffset())*oe,hs=this-as,ps=function(){return Nr.m(cs,as)};switch(_s){case _r:is=ps()/12;break;case pr:is=ps();break;case hr:is=ps()/3;break;case dr:is=(hs-gs)/6048e5;break;case lr:is=(hs-gs)/864e5;break;case ir:is=hs/ue;break;case rr:is=hs/oe;break;case tr:is=hs/I;break;default:is=hs}return Qr?is:Nr.a(is)},Dr.daysInMonth=function(){return this.endOf(pr).$D},Dr.$locale=function(){return es[this.$L]},Dr.locale=function(Ur,kr){if(!Ur)return this.$L;var Qr=this.clone(),is=$r(Ur,kr,!0);return is&&(Qr.$L=is),Qr},Dr.clone=function(){return Nr.w(this.$d,this)},Dr.toDate=function(){return new Date(this.valueOf())},Dr.toJSON=function(){return this.isValid()?this.toISOString():null},Dr.toISOString=function(){return this.$d.toISOString()},Dr.toString=function(){return this.$d.toUTCString()},Or}(),Ir=zr.prototype;return ns.prototype=Ir,[["$ms",bt],["$s",tr],["$m",rr],["$H",ir],["$W",lr],["$M",pr],["$y",_r],["$D",yr]].forEach(function(Or){Ir[Or[1]]=function(Dr){return this.$g(Dr,Or[0],Or[1])}}),ns.extend=function(Or,Dr){return Or.$i||(Or(Dr,zr,ns),Or.$i=!0),ns},ns.locale=$r,ns.isDayjs=os,ns.unix=function(Or){return ns(1e3*Or)},ns.en=es[Lr],ns.Ls=es,ns.p={},ns})})(dayjs_min);var dayjs_minExports=dayjs_min.exports,dayjs=getDefaultExportFromCjs$1(dayjs_minExports);class DateUtils{static normalizeHydratedDate(e){return e&&(typeof e=="string"?new Date(e):e)}static mixedDateToDateString(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e}static mixedDateToDate(e,I=!1,oe=!0){let ue=typeof e=="string"?dayjs(e).toDate():e;return I&&(ue=new Date(ue.getUTCFullYear(),ue.getUTCMonth(),ue.getUTCDate(),ue.getUTCHours(),ue.getUTCMinutes(),ue.getUTCSeconds(),ue.getUTCMilliseconds())),oe||ue.setUTCMilliseconds(0),ue}static mixedDateToTimeString(e,I=!1){return e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(I?"":":"+this.formatZerolessValue(e.getSeconds())):e}static mixedTimeToDate(e){if(typeof e=="string"){const[I,oe,ue]=e.split(":"),bt=new Date;return I&&bt.setHours(parseInt(I)),oe&&bt.setMinutes(parseInt(oe)),ue&&bt.setSeconds(parseInt(ue)),bt}return e}static mixedTimeToString(e,I=!1){return e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(I?"":":"+e.getSeconds()):e,typeof e=="string"?e.split(":").map(oe=>oe.length===1?"0"+oe:oe).join(":"):e}static mixedDateToDatetimeString(e,I){if(typeof e=="string"&&(e=new Date(e)),e instanceof Date){let oe=this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());I&&(oe+=`.${this.formatMilliseconds(e.getMilliseconds())}`),e=oe}return e}static mixedDateToUtcDatetimeString(e){return typeof e=="string"&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear(),4)+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e}static simpleArrayToString(e){return Array.isArray(e)?e.map(I=>String(I)).join(","):e}static stringToSimpleArray(e){return typeof e=="string"?e.length>0?e.split(","):[]:e}static simpleJsonToString(e){return JSON.stringify(e)}static stringToSimpleJson(e){return typeof e=="string"?JSON.parse(e):e}static simpleEnumToString(e){return""+e}static stringToSimpleEnum(e,I){return I.enum&&!isNaN(e)&&I.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e}static formatZerolessValue(e,I=2){return`${"0".repeat(I)}${e}`.slice(-I)}static formatMilliseconds(e){return e<10?"00"+e:e<100?"0"+e:String(e)}}class SubjectChangedColumnsComputer{compute(e){e.forEach(I=>{this.computeDiffColumns(I),this.computeDiffRelationalColumns(e,I)})}computeDiffColumns(e){e.entity&&e.metadata.columns.forEach(I=>{if(I.isVirtual||I.isDiscriminator)return;const oe=e.changeMaps.find(bt=>bt.column===I);oe&&e.changeMaps.splice(e.changeMaps.indexOf(oe),1);const ue=I.getEntityValue(e.entity);if(ue!==void 0){if(e.databaseEntity){const bt=I.type!=="json"&&I.type!=="jsonb";let tr=I.getEntityValue(e.databaseEntity,bt);if(I.relationMetadata){const ir=I.relationMetadata.getEntityValue(e.entity);if(ir!=null)return}let rr=ue;if(ue!==null){switch(I.type){case"date":rr=DateUtils.mixedDateToDateString(ue);break;case"time":case"time with time zone":case"time without time zone":case"timetz":rr=DateUtils.mixedDateToTimeString(ue);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":rr=DateUtils.mixedDateToUtcDatetimeString(ue),tr=DateUtils.mixedDateToUtcDatetimeString(tr);break;case"json":case"jsonb":if(OrmUtils.deepCompare(ue,tr))return;break;case"simple-array":rr=DateUtils.simpleArrayToString(ue),tr=DateUtils.simpleArrayToString(tr);break;case"simple-enum":rr=DateUtils.simpleEnumToString(ue),tr=DateUtils.simpleEnumToString(tr);break;case"simple-json":rr=DateUtils.simpleJsonToString(ue),tr=DateUtils.simpleJsonToString(tr);break}I.transformer&&(rr=ApplyValueTransformers.transformTo(I.transformer,ue))}if(Buffer$7.isBuffer(rr)&&Buffer$7.isBuffer(tr)){if(rr.equals(tr))return}else if(rr===tr)return}e.diffColumns.includes(I)||e.diffColumns.push(I),e.changeMaps.push({column:I,value:ue})}})}computeDiffRelationalColumns(e,I){I.entity&&I.metadata.relationsWithJoinColumns.forEach(oe=>{let ue=oe.getEntityValue(I.entity);if(ue===void 0)return;if(I.databaseEntity){let rr=ue;rr!==null&&ObjectUtils.isObject(rr)&&(rr=oe.getRelationIdMap(rr));const ir=oe.getEntityValue(I.databaseEntity);if(OrmUtils.compareIds(rr,ir))return;I.diffRelations.push(oe)}const bt=e.find(rr=>rr.mustBeInserted&&rr.entity===ue);bt&&(ue=bt);const tr=I.changeMaps.find(rr=>rr.relation===oe);tr?tr.value=ue:I.changeMaps.push({relation:oe,value:ue})})}}class NestedSetMultipleRootError extends TypeORMError{constructor(){super("Nested sets do not support multiple root entities.")}}class NestedSetSubjectExecutor{constructor(e){this.queryRunner=e}async insert(e){const I=lr=>this.queryRunner.connection.driver.escape(lr),oe=this.getTableName(e.metadata.tablePath),ue=I(e.metadata.nestedSetLeftColumn.databaseName),bt=I(e.metadata.nestedSetRightColumn.databaseName);let tr=e.metadata.treeParentRelation.getEntityValue(e.entity);!tr&&e.parentSubject&&e.parentSubject.entity&&(tr=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const rr=e.metadata.getEntityIdMap(tr);let ir;if(rr&&(ir=await this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(rr).getRawOne().then(lr=>{const dr=lr?lr.right:void 0;return typeof dr=="string"?parseInt(dr):dr})),ir!==void 0)await this.queryRunner.query(`UPDATE ${oe} SET ${ue} = CASE WHEN ${ue} > ${ir} THEN ${ue} + 2 ELSE ${ue} END,${bt} = ${bt} + 2 WHERE ${bt} >= ${ir}`),OrmUtils.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(ir),e.metadata.nestedSetRightColumn.createValueMap(ir+1));else{if(!await this.isUniqueRootEntity(e,tr))throw new NestedSetMultipleRootError;OrmUtils.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2))}}async update(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.entity);let oe=e.databaseEntity;if(!oe&&I&&(oe=e.metadata.treeChildrenRelation.getEntityValue(I).find(rr=>Object.entries(e.identifier).every(([ir,lr])=>rr[ir]===lr))),oe===void 0||I===void 0)return;const ue=e.metadata.treeParentRelation.getEntityValue(oe),bt=e.metadata.getEntityIdMap(ue),tr=e.metadata.getEntityIdMap(I);if(!OrmUtils.compareIds(bt,tr)){if(I){const rr=yr=>this.queryRunner.connection.driver.escape(yr),ir=this.getTableName(e.metadata.tablePath),lr=rr(e.metadata.nestedSetLeftColumn.databaseName),dr=rr(e.metadata.nestedSetRightColumn.databaseName),pr=e.metadata.getEntityIdMap(oe);let hr;pr&&(hr=(await this.getNestedSetIds(e.metadata,pr))[0]);let _r;if(tr&&(_r=(await this.getNestedSetIds(e.metadata,tr))[0]),hr!==void 0&&_r!==void 0){const yr=_r.left>hr.left,wr=hr.right-hr.left+1;let Tr;yr?Tr=_r.left-hr.right:Tr=_r.right-hr.left;const Ar=`WHEN ${lr} >= ${hr.left} AND ${lr} < ${hr.right} THEN ${lr} + ${Tr} `,Sr=`WHEN ${dr} > ${hr.left} AND ${dr} <= ${hr.right} THEN ${dr} + ${Tr} `;yr?await this.queryRunner.query(`UPDATE ${ir} SET ${lr} = CASE WHEN ${lr} > ${hr.right} AND ${lr} <= ${_r.left} THEN ${lr} - ${wr} `+Ar+`ELSE ${lr} END, ${dr} = CASE WHEN ${dr} > ${hr.right} AND ${dr} < ${_r.left} THEN ${dr} - ${wr} `+Sr+`ELSE ${dr} END`):await this.queryRunner.query(`UPDATE ${ir} SET ${lr} = CASE WHEN ${lr} < ${hr.left} AND ${lr} > ${_r.right} THEN ${lr} + ${wr} `+Ar+`ELSE ${lr} END, ${dr} = CASE WHEN ${dr} < ${hr.left} AND ${dr} >= ${_r.right} THEN ${dr} + ${wr} `+Sr+`ELSE ${dr} END`)}}else if(!await this.isUniqueRootEntity(e,I))throw new NestedSetMultipleRootError}}async remove(e){Array.isArray(e)||(e=[e]);const I=e[0].metadata,oe=lr=>this.queryRunner.connection.driver.escape(lr),ue=this.getTableName(I.tablePath),bt=oe(I.nestedSetLeftColumn.databaseName),tr=oe(I.nestedSetRightColumn.databaseName);let rr=[];for(const lr of e){const dr=I.getEntityIdMap(lr.entity);dr&&rr.push(dr)}let ir=await this.getNestedSetIds(I,rr);for(const lr of ir){const dr=lr.right-lr.left+1;await this.queryRunner.query(`UPDATE ${ue} SET ${bt} = CASE WHEN ${bt} > ${lr.left} THEN ${bt} - ${dr} ELSE ${bt} END, ${tr} = CASE WHEN ${tr} > ${lr.right} THEN ${tr} - ${dr} ELSE ${tr} END`)}}getNestedSetIds(e,I){const oe={left:`${e.targetName}.${e.nestedSetLeftColumn.propertyPath}`,right:`${e.targetName}.${e.nestedSetRightColumn.propertyPath}`},ue=this.queryRunner.manager.createQueryBuilder();return Object.entries(oe).forEach(([bt,tr])=>{ue.addSelect(tr,bt)}),ue.from(e.target,e.targetName).whereInIds(I).orderBy(oe.right,"DESC").getRawMany().then(bt=>{const tr=[];for(const rr of bt){const ir={};for(const lr of Object.keys(oe)){const dr=rr?rr[lr]:void 0;ir[lr]=typeof dr=="string"?parseInt(dr):dr}tr.push(ir)}return tr})}async isUniqueRootEntity(e,I){const oe=lr=>this.queryRunner.connection.driver.escape(lr),ue=this.getTableName(e.metadata.tablePath),bt=[],tr=e.metadata.treeParentRelation.joinColumns.map(lr=>{const dr=oe(lr.databaseName),pr=lr.getEntityValue(I);if(pr==null)return`${dr} IS NULL`;bt.push(pr);const hr=this.queryRunner.connection.driver.createParameter("entity_"+lr.databaseName,bt.length-1);return`${dr} = ${hr}`}).join(" AND "),rr="count",ir=await this.queryRunner.query(`SELECT COUNT(1) AS ${oe(rr)} FROM ${ue} WHERE ${tr}`,bt,!0);return parseInt(ir.records[0][rr])===0}getTableName(e){return e.split(".").map(I=>I===""?I:this.queryRunner.connection.driver.escape(I)).join(".")}}class ClosureSubjectExecutor{constructor(e){this.queryRunner=e}async insert(e){const I={};e.metadata.closureJunctionTable.ancestorColumns.forEach(ue=>{I[ue.databaseName]=e.identifier}),e.metadata.closureJunctionTable.descendantColumns.forEach(ue=>{I[ue.databaseName]=e.identifier}),await this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(I).updateEntity(!1).callListeners(!1).execute();let oe=e.metadata.treeParentRelation.getEntityValue(e.entity);if(!oe&&e.parentSubject&&e.parentSubject.entity&&(oe=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),oe){const ue=pr=>this.queryRunner.connection.driver.escape(pr),bt=this.getTableName(e.metadata.closureJunctionTable.tablePath),tr=[],rr=e.metadata.closureJunctionTable.ancestorColumns.map(pr=>ue(pr.databaseName)),ir=e.metadata.closureJunctionTable.descendantColumns.map(pr=>ue(pr.databaseName)),lr=e.metadata.primaryColumns.map(pr=>(tr.push(pr.getEntityValue(e.insertedValueSet?e.insertedValueSet:e.entity)),this.queryRunner.connection.driver.createParameter("child_entity_"+pr.databaseName,tr.length-1))),dr=e.metadata.closureJunctionTable.descendantColumns.map(pr=>{const hr=ue(pr.databaseName),_r=pr.referencedColumn.getEntityValue(oe);if(!_r)throw new CannotAttachTreeChildrenEntityError(e.metadata.name);tr.push(_r);const yr=this.queryRunner.connection.driver.createParameter("parent_entity_"+pr.referencedColumn.databaseName,tr.length-1);return`${hr} = ${yr}`});await this.queryRunner.query(`INSERT INTO ${bt} (${[...rr,...ir].join(", ")}) SELECT ${rr.join(", ")}, ${lr.join(", ")} FROM ${bt} WHERE ${dr.join(" AND ")}`,tr)}}async update(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.entity);let oe=e.databaseEntity;if(!oe&&I&&(oe=e.metadata.treeChildrenRelation.getEntityValue(I).find(_r=>Object.entries(e.identifier).every(([yr,wr])=>_r[yr]===wr))),oe===void 0||I===void 0)return;const ue=e.metadata.treeParentRelation.getEntityValue(oe),bt=e.metadata.getEntityIdMap(ue),tr=e.metadata.getEntityIdMap(I);if(OrmUtils.compareIds(bt,tr))return;const rr=_r=>this.queryRunner.connection.driver.escape(_r),ir=e.metadata.closureJunctionTable,lr=ir.ancestorColumns.map(_r=>rr(_r.databaseName)),dr=ir.descendantColumns.map(_r=>rr(_r.databaseName)),pr=(_r,yr)=>{const wr=`sub${yr}`,Tr=_r.createQueryBuilder().select(dr.join(", ")).from(ir.tablePath,wr);for(const Ar of ir.ancestorColumns)Tr.andWhere(`${rr(wr)}.${rr(Ar.databaseName)} = :value_${Ar.referencedColumn.databaseName}`);return _r.createQueryBuilder().select(dr.join(", ")).from(`(${Tr.getQuery()})`,yr).setParameters(Tr.getParameters()).getQuery()},hr={};for(const _r of e.metadata.primaryColumns)hr[`value_${_r.databaseName}`]=oe[_r.databaseName];if(await this.queryRunner.manager.createQueryBuilder().delete().from(ir.tablePath).where(_r=>`(${dr.join(", ")}) IN (${pr(_r,"descendant")})`).andWhere(_r=>`(${lr.join(", ")}) NOT IN (${pr(_r,"ancestor")})`).setParameters(hr).execute(),I){const _r=[],yr=this.getTableName(ir.tablePath),wr=rr("supertree"),Tr=rr("subtree"),Ar=[...lr.map(vr=>`${wr}.${vr}`),...dr.map(vr=>`${Tr}.${vr}`)],Sr=e.metadata.closureJunctionTable.ancestorColumns.map(vr=>{const Lr=rr(vr.databaseName),es=vr.referencedColumn.getEntityValue(oe);_r.push(es);const ss=this.queryRunner.connection.driver.createParameter("entity_"+vr.referencedColumn.databaseName,_r.length-1);return`${Tr}.${Lr} = ${ss}`}),Mr=e.metadata.closureJunctionTable.descendantColumns.map(vr=>{const Lr=rr(vr.databaseName),es=vr.referencedColumn.getEntityValue(I);if(!es)throw new CannotAttachTreeChildrenEntityError(e.metadata.name);_r.push(es);const ss=this.queryRunner.connection.driver.createParameter("parent_entity_"+vr.referencedColumn.databaseName,_r.length-1);return`${wr}.${Lr} = ${ss}`});await this.queryRunner.query(`INSERT INTO ${yr} (${[...lr,...dr].join(", ")}) SELECT ${Ar.join(", ")} FROM ${yr} AS ${wr}, ${yr} AS ${Tr} WHERE ${[...Sr,...Mr].join(" AND ")}`,_r)}}async remove(e){if(this.queryRunner.connection.driver.options.type!=="mssql")return;Array.isArray(e)||(e=[e]);const I=ir=>this.queryRunner.connection.driver.escape(ir),oe=e.map(ir=>ir.identifier),ue=e[0].metadata.closureJunctionTable,bt=ir=>ir.map(lr=>{const dr=oe.map(pr=>pr[lr.referencedColumn.databaseName]);return`${I(lr.databaseName)} IN (${dr.join(", ")})`}).join(" AND "),tr=bt(ue.ancestorColumns),rr=bt(ue.descendantColumns);await this.queryRunner.manager.createQueryBuilder().delete().from(ue.tablePath).where(tr).orWhere(rr).execute()}getTableName(e){return e.split(".").map(I=>I===""?I:this.queryRunner.connection.driver.escape(I)).join(".")}}class EntityMetadata{constructor(e){this["@instanceof"]=Symbol.for("EntityMetadata"),this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isAlwaysUsingConstructor=!0,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.beforeSoftRemoveListeners=[],this.beforeRecoverListeners=[],this.afterRemoveListeners=[],this.afterSoftRemoveListeners=[],this.afterRecoverListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.treeOptions=e.tableTree?e.tableTree.options:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid,this.dependsOn=this.tableMetadataArgs.dependsOn}create(e,I){const oe=!!(I&&I.pojo===!0);let ue;return typeof this.target=="function"&&!oe?!I?.fromDeserializer||this.isAlwaysUsingConstructor?ue=new this.target:ue=Object.create(this.target.prototype):ue={},this.connection.options.typename&&(ue[this.connection.options.typename]=this.targetName),this.lazyRelations.forEach(bt=>this.connection.relationLoader.enableLazyLoad(bt,ue,e)),ue}hasId(e){return e?this.primaryColumns.every(I=>{const oe=I.getEntityValue(e);return oe!=null&&oe!==""}):!1}hasAllPrimaryKeys(e){return this.primaryColumns.every(I=>{const oe=I.getEntityValue(e);return oe!=null})}ensureEntityIdMap(e){if(ObjectUtils.isObject(e))return e;if(this.hasMultiplePrimaryKeys)throw new CannotCreateEntityIdMapError(this,e);return this.primaryColumns[0].createValueMap(e)}getEntityIdMap(e){if(e)return EntityMetadata.getValueMap(e,this.primaryColumns,{skipNulls:!0})}getEntityIdMixedMap(e){if(!e)return e;const I=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?I:I&&this.primaryColumns[0].getEntityValue(I)}compareEntities(e,I){const oe=this.getEntityIdMap(e);if(!oe)return!1;const ue=this.getEntityIdMap(I);return ue?OrmUtils.compareIds(oe,ue):!1}findColumnWithPropertyName(e){return this.columns.find(I=>I.propertyName===e)}findColumnWithDatabaseName(e){return this.columns.find(I=>I.databaseName===e)}hasColumnWithPropertyPath(e){return this.columns.some(oe=>oe.propertyPath===e)||this.hasRelationWithPropertyPath(e)}findColumnWithPropertyPath(e){const I=this.columns.find(ue=>ue.propertyPath===e);if(I)return I;const oe=this.relations.find(ue=>ue.propertyPath===e);if(oe&&oe.joinColumns.length===1)return oe.joinColumns[0]}findColumnWithPropertyPathStrict(e){return this.columns.find(I=>I.propertyPath===e)}findColumnsWithPropertyPath(e){const I=this.columns.find(ue=>ue.propertyPath===e);if(I)return[I];const oe=this.findRelationWithPropertyPath(e);return oe&&oe.joinColumns?oe.joinColumns:[]}hasRelationWithPropertyPath(e){return this.relations.some(I=>I.propertyPath===e)}findRelationWithPropertyPath(e){return this.relations.find(I=>I.propertyPath===e)}hasEmbeddedWithPropertyPath(e){return this.allEmbeddeds.some(I=>I.propertyPath===e)}findEmbeddedWithPropertyPath(e){return this.allEmbeddeds.find(I=>I.propertyPath===e)}mapPropertyPathsToColumns(e){return e.map(I=>{const oe=this.findColumnWithPropertyPath(I);if(oe==null)throw new EntityPropertyNotFoundError(I,this);return oe})}extractRelationValuesFromEntity(e,I){const oe=[];return I.forEach(ue=>{const bt=ue.getEntityValue(e);Array.isArray(bt)?bt.forEach(tr=>oe.push([ue,tr,EntityMetadata.getInverseEntityMetadata(tr,ue)])):bt&&oe.push([ue,bt,EntityMetadata.getInverseEntityMetadata(bt,ue)])}),oe}findInheritanceMetadata(e){if(this.inheritancePattern==="STI"&&this.childEntityMetadatas.length>0){let I;return this.discriminatorColumn&&(I=e[this.discriminatorColumn.propertyName]),this.childEntityMetadatas.find(oe=>I===oe.discriminatorValue||e.constructor===oe.target)||this}return this}static getInverseEntityMetadata(e,I){return I.inverseEntityMetadata.findInheritanceMetadata(e)}static createPropertyPath(e,I,oe=""){const ue=[];return Object.keys(I).forEach(bt=>{const tr=oe?oe+"."+bt:bt;if(e.hasEmbeddedWithPropertyPath(tr)){const rr=this.createPropertyPath(e,I[bt],tr);ue.push(...rr)}else{const rr=oe?oe+"."+bt:bt;ue.push(rr)}}),ue}static difference(e,I){return e.filter(oe=>!I.find(ue=>OrmUtils.compareIds(oe,ue)))}static getValueMap(e,I,oe){return I.reduce((ue,bt)=>{const tr=bt.getEntityValueMap(e,oe);if(!(ue===void 0||tr===null||tr===void 0))return OrmUtils.mergeDeep(ue,tr)},{})}build(){const e=this.connection.namingStrategy,I=this.connection.options.entityPrefix,oe=this.connection.options.entitySkipConstructor;this.engine=this.tableMetadataArgs.engine,this.database=this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:this.connection.options?.hasOwnProperty("schema")&&(this.schema=this.connection.options.schema),this.givenTableName=this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=this.tableMetadataArgs.synchronize!==!1,this.targetName=typeof this.tableMetadataArgs.target=="function"?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,this.tableMetadataArgs.type==="closure-junction"?this.tableNameWithoutPrefix=e.closureJunctionTableName(this.givenTableName):this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.tableNameWithoutPrefix=e.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=e.tableName(this.targetName,this.givenTableName),this.tableMetadataArgs.type==="junction"&&this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=shorten(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=I?e.prefixTableName(I,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid===!0,this.tablePath=this.connection.driver.buildTableName(this.tableName,this.schema,this.database),this.orderBy=typeof this.tableMetadataArgs.orderBy=="function"?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,oe!==void 0&&(this.isAlwaysUsingConstructor=!oe),this.isJunction=this.tableMetadataArgs.type==="closure-junction"||this.tableMetadataArgs.type==="junction",this.isClosureJunction=this.tableMetadataArgs.type==="closure-junction",this.comment=this.tableMetadataArgs.comment}registerColumn(e){this.ownColumns.indexOf(e)===-1&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce((I,oe)=>I.concat(oe.columnsFromTree),this.ownColumns),this.primaryColumns=this.columns.filter(I=>I.isPrimary),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter(I=>I.isGenerated||I.generationStrategy==="uuid").length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach(I=>I.registerColumn(e)))}createPropertiesMap(){const e={};return this.columns.forEach(I=>OrmUtils.mergeDeep(e,I.createValueMap(I.propertyPath))),this.relations.forEach(I=>OrmUtils.mergeDeep(e,I.createValueMap(I.propertyPath))),e}getInsertionReturningColumns(){return this.columns.filter(e=>e.default!==void 0||e.asExpression!==void 0||e.isGenerated||e.isCreateDate||e.isUpdateDate||e.isDeleteDate||e.isVersion)}}class MaterializedPathSubjectExecutor{constructor(e){this.queryRunner=e}async insert(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const oe=e.metadata.getEntityIdMap(I);let ue="";oe&&(ue=await this.getEntityPath(e,oe));const bt=e.metadata.treeParentRelation.joinColumns.map(tr=>tr.referencedColumn.getEntityValue(e.insertedValueSet)).join("_");await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[e.metadata.materializedPathColumn.propertyPath]:ue+bt+"."}).where(e.identifier).execute()}async update(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.entity);let oe=e.databaseEntity;!oe&&I&&(oe=e.metadata.treeChildrenRelation.getEntityValue(I).find(pr=>Object.entries(e.identifier).every(([hr,_r])=>pr[hr]===_r)));const ue=e.metadata.treeParentRelation.getEntityValue(oe),bt=this.getEntityParentReferencedColumnMap(e,ue),tr=this.getEntityParentReferencedColumnMap(e,I);if(OrmUtils.compareIds(bt,tr))return;let rr="";tr&&(rr=await this.getEntityPath(e,tr));let ir="";bt&&(ir=await this.getEntityPath(e,bt)||"");const lr=e.metadata.treeParentRelation.joinColumns.map(pr=>pr.referencedColumn.getEntityValue(oe)).join("_"),dr=e.metadata.materializedPathColumn.propertyPath;await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[dr]:()=>`REPLACE(${this.queryRunner.connection.driver.escape(dr)}, '${ir}${lr}.', '${rr}${lr}.')`}).where(`${dr} LIKE :path`,{path:`${ir}${lr}.%`}).execute()}getEntityParentReferencedColumnMap(e,I){if(I)return EntityMetadata.getValueMap(I,e.metadata.treeParentRelation.joinColumns.map(oe=>oe.referencedColumn).filter(oe=>oe!=null),{skipNulls:!0})}getEntityPath(e,I){const oe=e.metadata,ue=(Array.isArray(I)?I:[I]).map(bt=>oe.ensureEntityIdMap(bt));return this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).where(new Brackets(bt=>{for(const tr of ue)bt.orWhere(new Brackets(rr=>rr.where(tr)))})).getRawOne().then(bt=>bt?bt.path:"")}}class SubjectExecutor{constructor(e,I,oe){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=I,this.options=oe,this.validate(),this.recompute()}async execute(){let e;(!this.options||this.options.listeners!==!1)&&(e=this.broadcastBeforeEventsForAll(),e.promises.length>0&&await Promise.all(e.promises)),e&&e.count>0&&(this.insertSubjects.forEach(I=>I.recompute()),this.updateSubjects.forEach(I=>I.recompute()),this.removeSubjects.forEach(I=>I.recompute()),this.softRemoveSubjects.forEach(I=>I.recompute()),this.recoverSubjects.forEach(I=>I.recompute()),this.recompute()),this.insertSubjects=new SubjectTopoligicalSorter(this.insertSubjects).sort("insert"),await this.executeInsertOperations(),this.updateSubjects=this.allSubjects.filter(I=>I.mustBeUpdated),await this.executeUpdateOperations(),this.removeSubjects=new SubjectTopoligicalSorter(this.removeSubjects).sort("delete"),await this.executeRemoveOperations(),this.softRemoveSubjects=this.allSubjects.filter(I=>I.mustBeSoftRemoved),await this.executeSoftRemoveOperations(),this.recoverSubjects=this.allSubjects.filter(I=>I.mustBeRecovered),await this.executeRecoverOperations(),this.updateSpecialColumnsInPersistedEntities(),(!this.options||this.options.listeners!==!1)&&(e=this.broadcastAfterEventsForAll(),e.promises.length>0&&await Promise.all(e.promises))}validate(){this.allSubjects.forEach(e=>{if(e.mustBeUpdated&&e.mustBeRemoved)throw new SubjectRemovedAndUpdatedError(e)})}recompute(){new SubjectChangedColumnsComputer().compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter(e=>e.mustBeInserted),this.updateSubjects=this.allSubjects.filter(e=>e.mustBeUpdated),this.removeSubjects=this.allSubjects.filter(e=>e.mustBeRemoved),this.softRemoveSubjects=this.allSubjects.filter(e=>e.mustBeSoftRemoved),this.recoverSubjects=this.allSubjects.filter(e=>e.mustBeRecovered),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0}broadcastBeforeEventsForAll(){const e=new BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeInsertEvent(e,I.metadata,I.entity)),this.updateSubjects.length&&this.updateSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeUpdateEvent(e,I.metadata,I.entity,I.databaseEntity,I.diffColumns,I.diffRelations)),this.removeSubjects.length&&this.removeSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeSoftRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.recoverSubjects.length&&this.recoverSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeRecoverEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),e}broadcastAfterEventsForAll(){const e=new BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterInsertEvent(e,I.metadata,I.entity,I.identifier)),this.updateSubjects.length&&this.updateSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterUpdateEvent(e,I.metadata,I.entity,I.databaseEntity,I.diffColumns,I.diffRelations)),this.removeSubjects.length&&this.removeSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterSoftRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.recoverSubjects.length&&this.recoverSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterRecoverEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),e}async executeInsertOperations(){const[e,I]=this.groupBulkSubjects(this.insertSubjects,"insert");for(const oe of I){const ue=e[oe],bt=[],tr=[],rr=[];if(this.queryRunner.connection.driver.options.type==="mongodb"?ue.forEach(ir=>{ir.metadata.createDateColumn&&ir.entity&&(ir.entity[ir.metadata.createDateColumn.databaseName]=new Date),ir.metadata.updateDateColumn&&ir.entity&&(ir.entity[ir.metadata.updateDateColumn.databaseName]=new Date),ir.createValueSetAndPopChangeMap(),tr.push(ir),bt.push(ir.entity)}):this.queryRunner.connection.driver.options.type==="oracle"?ue.forEach(ir=>{rr.push(ir)}):ue.forEach(ir=>{ir.changeMaps.length===0||ir.metadata.treeType||this.queryRunner.connection.driver.options.type==="oracle"||this.queryRunner.connection.driver.options.type==="sap"?rr.push(ir):(tr.push(ir),bt.push(ir.createValueSetAndPopChangeMap()))}),InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const ir=await this.queryRunner.manager.insert(ue[0].metadata.target,bt);ue.forEach((lr,dr)=>{lr.identifier=ir.identifiers[dr],lr.generatedMap=ir.generatedMaps[dr],lr.insertedValueSet=bt[dr]})}else{if(bt.length>0){const ir=await this.queryRunner.manager.createQueryBuilder().insert().into(ue[0].metadata.target).values(bt).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1).execute();tr.forEach((lr,dr)=>{lr.identifier=ir.identifiers[dr],lr.generatedMap=ir.generatedMaps[dr],lr.insertedValueSet=bt[dr]})}if(rr.length>0)for(const ir of rr)ir.insertedValueSet=ir.createValueSetAndPopChangeMap(),ir.metadata.treeType==="nested-set"&&await new NestedSetSubjectExecutor(this.queryRunner).insert(ir),await this.queryRunner.manager.createQueryBuilder().insert().into(ir.metadata.target).values(ir.insertedValueSet).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1).execute().then(lr=>{ir.identifier=lr.identifiers[0],ir.generatedMap=lr.generatedMaps[0]}),ir.metadata.treeType==="closure-table"?await new ClosureSubjectExecutor(this.queryRunner).insert(ir):ir.metadata.treeType==="materialized-path"&&await new MaterializedPathSubjectExecutor(this.queryRunner).insert(ir)}ue.forEach(ir=>{ir.generatedMap&&ir.metadata.columns.forEach(lr=>{const dr=lr.getEntityValue(ir.generatedMap);if(dr!=null){const pr=this.queryRunner.connection.driver.prepareHydratedValue(dr,lr);lr.setEntityValue(ir.generatedMap,pr)}})})}}async executeUpdateOperations(){const e=async bt=>{if(!bt.identifier)throw new SubjectWithoutIdentifierError(bt);if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const tr=this.cloneMongoSubjectEntity(bt);bt.metadata.objectIdColumn&&bt.metadata.objectIdColumn.propertyName&&delete tr[bt.metadata.objectIdColumn.propertyName],bt.metadata.createDateColumn&&bt.metadata.createDateColumn.propertyName&&delete tr[bt.metadata.createDateColumn.propertyName],bt.metadata.updateDateColumn&&bt.metadata.updateDateColumn.propertyName&&(tr[bt.metadata.updateDateColumn.propertyName]=new Date),await this.queryRunner.manager.update(bt.metadata.target,bt.identifier,tr)}else{const tr=bt.createValueSetAndPopChangeMap();switch(bt.metadata.treeType){case"nested-set":await new NestedSetSubjectExecutor(this.queryRunner).update(bt);break;case"closure-table":await new ClosureSubjectExecutor(this.queryRunner).update(bt);break;case"materialized-path":await new MaterializedPathSubjectExecutor(this.queryRunner).update(bt);break}const rr=this.queryRunner.manager.createQueryBuilder().update(bt.metadata.target).set(tr).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1);bt.entity?rr.whereEntity(bt.identifier):rr.where(bt.identifier);let lr=(await rr.execute()).generatedMaps[0];lr&&(bt.metadata.columns.forEach(dr=>{const pr=dr.getEntityValue(lr);if(pr!=null){const hr=this.queryRunner.connection.driver.prepareHydratedValue(pr,dr);dr.setEntityValue(lr,hr)}}),bt.generatedMap||(bt.generatedMap={}),Object.assign(bt.generatedMap,lr))}},I=[],oe=[];for(const bt of this.updateSubjects)bt.metadata.treeType==="nested-set"?I.push(bt):oe.push(bt);const ue=new Promise(async(bt,tr)=>{for(const rr of I)try{await e(rr)}catch(ir){tr(ir)}bt()});await Promise.all([...oe.map(e),ue])}async executeRemoveOperations(){const[e,I]=this.groupBulkSubjects(this.removeSubjects,"delete");for(const oe of I){const ue=e[oe],bt=ue.map(tr=>{if(!tr.identifier)throw new SubjectWithoutIdentifierError(tr);return tr.identifier});if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager))await this.queryRunner.manager.delete(ue[0].metadata.target,bt);else{switch(ue[0].metadata.treeType){case"nested-set":await new NestedSetSubjectExecutor(this.queryRunner).remove(ue);break;case"closure-table":await new ClosureSubjectExecutor(this.queryRunner).remove(ue);break}await this.queryRunner.manager.createQueryBuilder().delete().from(ue[0].metadata.target).where(bt).callListeners(!1).execute()}}}cloneMongoSubjectEntity(e){const I={};if(e.entity)for(const oe of e.metadata.columns)OrmUtils.mergeDeep(I,oe.getEntityValueMap(e.entity));return I}async executeSoftRemoveOperations(){await Promise.all(this.softRemoveSubjects.map(async e=>{if(!e.identifier)throw new SubjectWithoutIdentifierError(e);let I;if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const oe=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete oe[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete oe[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(oe[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(oe[e.metadata.deleteDateColumn.propertyName]=new Date),I=await this.queryRunner.manager.update(e.metadata.target,e.identifier,oe)}else{const oe=this.queryRunner.manager.createQueryBuilder().softDelete().from(e.metadata.target).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1);e.entity?oe.whereEntity(e.identifier):oe.where(e.identifier),I=await oe.execute()}e.generatedMap=I.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach(oe=>{const ue=oe.getEntityValue(e.generatedMap);if(ue!=null){const bt=this.queryRunner.connection.driver.prepareHydratedValue(ue,oe);oe.setEntityValue(e.generatedMap,bt)}})}))}async executeRecoverOperations(){await Promise.all(this.recoverSubjects.map(async e=>{if(!e.identifier)throw new SubjectWithoutIdentifierError(e);let I;if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const oe=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete oe[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete oe[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(oe[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(oe[e.metadata.deleteDateColumn.propertyName]=null),I=await this.queryRunner.manager.update(e.metadata.target,e.identifier,oe)}else{const oe=this.queryRunner.manager.createQueryBuilder().restore().from(e.metadata.target).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1);e.entity?oe.whereEntity(e.identifier):oe.where(e.identifier),I=await oe.execute()}e.generatedMap=I.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach(oe=>{const ue=oe.getEntityValue(e.generatedMap);if(ue!=null){const bt=this.queryRunner.connection.driver.prepareHydratedValue(ue,oe);oe.setEntityValue(e.generatedMap,bt)}})}))}updateSpecialColumnsInPersistedEntities(){this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.softRemoveSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.recoverSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach(e=>{e.entity&&e.metadata.primaryColumns.forEach(I=>{I.setEntityValue(e.entity,void 0)})}),this.allSubjects.forEach(e=>{e.entity&&(e.metadata.relationIds.forEach(I=>{I.setValue(e.entity)}),InstanceChecker.isMongoEntityManager(this.queryRunner.manager)&&e.metadata.objectIdColumn&&e.metadata.objectIdColumn.databaseName&&e.metadata.objectIdColumn.databaseName!==e.metadata.objectIdColumn.propertyName&&delete e.entity[e.metadata.objectIdColumn.databaseName])})}updateSpecialColumnsInInsertedAndUpdatedEntities(e){e.forEach(I=>{I.entity&&(I.metadata.columns.forEach(oe=>{I.metadata.childEntityMetadatas.length>0&&I.metadata.childEntityMetadatas.map(ue=>ue.target).indexOf(oe.target)!==-1||oe.isVirtual||oe.isDeleteDate||(oe.isNullable&&oe.getEntityValue(I.entity)===void 0&&oe.setEntityValue(I.entity,null),I.updatedRelationMaps.length>0&&I.updatedRelationMaps.forEach(ue=>{ue.relation.joinColumns.forEach(bt=>{bt.isVirtual!==!0&&bt.setEntityValue(I.entity,ObjectUtils.isObject(ue.value)?bt.referencedColumn.getEntityValue(ue.value):ue.value)})}))}),I.generatedMap&&this.queryRunner.manager.merge(I.metadata.target,I.entity,I.generatedMap))})}groupBulkSubjects(e,I){const oe={},ue=[],bt=e.some(rr=>rr.metadata.getInsertionReturningColumns().length>0),tr=I==="delete"||this.queryRunner.connection.driver.isReturningSqlSupported("insert")||bt===!1;return e.forEach((rr,ir)=>{const lr=tr||rr.metadata.isJunction?rr.metadata.name:rr.metadata.name+"_"+ir;oe[lr]?oe[lr].push(rr):(oe[lr]=[rr],ue.push(lr))}),[oe,ue]}}class Subject{constructor(e){this["@instanceof"]=Symbol.for("Subject"),this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,e.canBeInserted!==void 0&&(this.canBeInserted=e.canBeInserted),e.canBeUpdated!==void 0&&(this.canBeUpdated=e.canBeUpdated),e.mustBeRemoved!==void 0&&(this.mustBeRemoved=e.mustBeRemoved),e.canBeSoftRemoved!==void 0&&(this.canBeSoftRemoved=e.canBeSoftRemoved),e.canBeRecovered!==void 0&&(this.canBeRecovered=e.canBeRecovered),e.identifier!==void 0&&(this.identifier=e.identifier),e.changeMaps!==void 0&&this.changeMaps.push(...e.changeMaps),this.recompute()}get mustBeInserted(){return this.canBeInserted&&!this.databaseEntity}get mustBeUpdated(){return this.canBeUpdated&&this.identifier&&(this.databaseEntityLoaded===!1||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.some(e=>!e.column||e.column.isUpdate)}get mustBeSoftRemoved(){return this.canBeSoftRemoved&&this.identifier&&(this.databaseEntityLoaded===!1||this.databaseEntityLoaded&&this.databaseEntity)}get mustBeRecovered(){return this.canBeRecovered&&this.identifier&&(this.databaseEntityLoaded===!1||this.databaseEntityLoaded&&this.databaseEntity)}createValueSetAndPopChangeMap(){const e=[],I=this.changeMaps.reduce((oe,ue)=>{let bt=ue.value;InstanceChecker.isSubject(bt)&&(bt=bt.insertedValueSet?bt.insertedValueSet:bt.entity);let tr;if(this.metadata.isJunction&&ue.column)tr=ue.column.createValueMap(ue.column.referencedColumn.getEntityValue(bt));else if(ue.column)tr=ue.column.createValueMap(bt);else if(ue.relation)if(ObjectUtils.isObject(bt)&&!Buffer$7.isBuffer(bt)){const rr=ue.relation.getRelationIdMap(bt);if(rr===void 0)return e.push(ue),this.canBeUpdated=!0,oe;tr=ue.relation.createValueMap(rr),this.updatedRelationMaps.push({relation:ue.relation,value:rr})}else tr=ue.relation.createValueMap(bt),this.updatedRelationMaps.push({relation:ue.relation,value:bt});return OrmUtils.mergeDeep(oe,tr),oe},{});return this.changeMaps=e,I}recompute(){this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach(e=>{if(e.relationMetadata&&e.relationMetadata.inverseEntityMetadata===this.parentSubject.metadata){const I=e.referencedColumn.getEntityValue(this.parentSubject.entity);e.setEntityValue(this.entityWithFulfilledIds,I)}}),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))}}class OneToManySubjectBuilder{constructor(e){this.subjects=e}build(){this.subjects.forEach(e=>{e.metadata.oneToManyRelations.forEach(I=>{I.persistenceEnabled!==!1&&this.buildForSubjectRelation(e,I)})})}buildForSubjectRelation(e,I){let oe=[];if(e.databaseEntity){const tr=I.getEntityValue(e.databaseEntity);tr&&(oe=tr.map(rr=>I.inverseEntityMetadata.getEntityIdMap(rr)))}let ue=I.getEntityValue(e.entity);if(ue===null&&(ue=[]),ue===void 0)return;const bt=[];ue.forEach(tr=>{let rr=I.inverseEntityMetadata.getEntityIdMap(tr),ir=this.subjects.find(dr=>dr.entity===tr);if(ir&&(rr=ir.identifier),!rr){if(!ir)return;ir.changeMaps.push({relation:I.inverseRelation,value:e});return}oe.find(dr=>OrmUtils.compareIds(rr,dr))||(ir||(ir=new Subject({metadata:I.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:rr}),this.subjects.push(ir)),ir.changeMaps.push({relation:I.inverseRelation,value:e})),bt.push(rr)}),I.inverseRelation?.orphanedRowAction!=="disable"&&EntityMetadata.difference(oe,bt).forEach(tr=>{const rr=new Subject({metadata:I.inverseEntityMetadata,parentSubject:e,identifier:tr});!I.inverseRelation||I.inverseRelation.orphanedRowAction==="nullify"?(rr.canBeUpdated=!0,rr.changeMaps=[{relation:I.inverseRelation,value:null}]):I.inverseRelation.orphanedRowAction==="delete"?rr.mustBeRemoved=!0:I.inverseRelation.orphanedRowAction==="soft-delete"&&(rr.canBeSoftRemoved=!0),this.subjects.push(rr)})}}class OneToOneInverseSideSubjectBuilder{constructor(e){this.subjects=e}build(){this.subjects.forEach(e=>{e.metadata.oneToOneRelations.forEach(I=>{I.isOwning||I.persistenceEnabled===!1||this.buildForSubjectRelation(e,I)})})}buildForSubjectRelation(e,I){let oe;e.databaseEntity&&(oe=I.getEntityValue(e.databaseEntity));let ue=I.getEntityValue(e.entity);if(ue===void 0)return;if(ue===null){if(oe){const ir=new Subject({metadata:I.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:oe,changeMaps:[{relation:I.inverseRelation,value:null}]});this.subjects.push(ir)}return}let bt=I.inverseEntityMetadata.getEntityIdMap(ue),tr=this.subjects.find(ir=>!!ir.entity&&ir.entity===ue);if(tr&&(bt=tr.identifier),!bt){if(!tr)return;tr.changeMaps.push({relation:I.inverseRelation,value:e})}oe&&OrmUtils.compareIds(bt,oe)||(tr||(tr=new Subject({metadata:I.inverseEntityMetadata,canBeUpdated:!0,identifier:bt}),this.subjects.push(tr)),tr.changeMaps.push({relation:I.inverseRelation,value:e}))}}class ManyToManySubjectBuilder{constructor(e){this.subjects=e}build(){this.subjects.forEach(e=>{e.entity&&e.metadata.manyToManyRelations.forEach(I=>{I.persistenceEnabled!==!1&&this.buildForSubjectRelation(e,I)})})}buildForAllRemoval(e){e.databaseEntity&&e.metadata.manyToManyRelations.forEach(I=>{if(I.persistenceEnabled===!1)return;I.getEntityValue(e.databaseEntity).forEach(ue=>{const bt=new Subject({metadata:I.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,I,ue)});this.subjects.push(bt)})})}buildForSubjectRelation(e,I){let oe=[];if(e.databaseEntity){const rr=I.getEntityValue(e.databaseEntity);rr&&(oe=rr.map(ir=>I.inverseEntityMetadata.getEntityIdMap(ir)))}let ue=I.getEntityValue(e.entity);if(ue===null&&(ue=[]),!Array.isArray(ue))return;ue.forEach(rr=>{let ir=I.inverseEntityMetadata.getEntityIdMap(rr);const lr=this.subjects.find(yr=>yr.entity===rr);if(lr&&(ir=lr.identifier),!ir&&!lr||oe.find(yr=>OrmUtils.compareIds(yr,ir)))return;const pr=I.isOwning?e:lr||rr,hr=I.isOwning?lr||rr:e,_r=new Subject({metadata:I.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});this.subjects.push(_r),I.junctionEntityMetadata.ownerColumns.forEach(yr=>{_r.changeMaps.push({column:yr,value:pr})}),I.junctionEntityMetadata.inverseColumns.forEach(yr=>{_r.changeMaps.push({column:yr,value:hr})})});const bt=[];ue.forEach(rr=>{let ir=I.inverseEntityMetadata.getEntityIdMap(rr);const lr=this.subjects.find(dr=>dr.entity===rr);lr&&(ir=lr.identifier),ir!=null&&bt.push(ir)}),oe.filter(rr=>!bt.find(ir=>OrmUtils.compareIds(ir,rr))).forEach(rr=>{const ir=new Subject({metadata:I.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,I,rr)});this.subjects.push(ir)})}buildJunctionIdentifier(e,I,oe){const ue=I.isOwning?e.entity:oe,bt=I.isOwning?oe:e.entity,tr={};return I.junctionEntityMetadata.ownerColumns.forEach(rr=>{OrmUtils.mergeDeep(tr,rr.createValueMap(rr.referencedColumn.getEntityValue(ue)))}),I.junctionEntityMetadata.inverseColumns.forEach(rr=>{OrmUtils.mergeDeep(tr,rr.createValueMap(rr.referencedColumn.getEntityValue(bt)))}),tr}}class SubjectDatabaseEntityLoader{constructor(e,I){this.queryRunner=e,this.subjects=I}async load(e){const I=this.groupByEntityTargets().map(async oe=>{const ue=[],bt=[];if(oe.subjects.forEach(lr=>{lr.databaseEntity||!lr.identifier||(ue.push(lr.identifier),bt.push(lr))}),!ue.length)return;const tr=[];e==="save"||e==="soft-remove"||e==="recover"?oe.subjects.forEach(lr=>{lr.metadata.relations.forEach(dr=>{dr.getEntityValue(lr.entityWithFulfilledIds)!==void 0&&tr.indexOf(dr.propertyPath)===-1&&tr.push(dr.propertyPath)})}):tr.push(...oe.subjects[0].metadata.manyToManyRelations.map(lr=>lr.propertyPath));const rr={loadEagerRelations:!1,loadRelationIds:{relations:tr,disableMixedMap:!0},withDeleted:!0};let ir=[];this.queryRunner.connection.driver.options.type==="mongodb"?ir=await this.queryRunner.manager.getRepository(oe.target).findByIds(ue,rr):ir=await this.queryRunner.manager.getRepository(oe.target).createQueryBuilder().setFindOptions(rr).whereInIds(ue).getMany(),ir.forEach(lr=>{this.findByPersistEntityLike(oe.target,lr).forEach(pr=>{pr.databaseEntity=lr,pr.identifier||(pr.identifier=pr.metadata.hasAllPrimaryKeys(lr)?pr.metadata.getEntityIdMap(lr):void 0)})});for(let lr of bt)lr.databaseEntityLoaded=!0});await Promise.all(I)}findByPersistEntityLike(e,I){return this.subjects.filter(oe=>oe.entity?oe.entity===I?!0:oe.metadata.target===e&&oe.metadata.compareEntities(oe.entityWithFulfilledIds,I):!1)}groupByEntityTargets(){return this.subjects.reduce((e,I)=>{let oe=e.find(ue=>ue.target===I.metadata.target);return oe||(oe={target:I.metadata.target,subjects:[]},e.push(oe)),oe.subjects.push(I),e},[])}}class CascadesSubjectBuilder{constructor(e){this.allSubjects=e}build(e,I){e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach(([oe,ue,bt])=>{if(ue==null||!oe.isCascadeInsert&&!oe.isCascadeUpdate&&!oe.isCascadeSoftRemove&&!oe.isCascadeRecover||!ObjectUtils.isObject(ue))return;const tr=this.findByPersistEntityLike(bt.target,ue);if(tr){tr.canBeInserted===!1&&(tr.canBeInserted=oe.isCascadeInsert===!0&&I==="save"),tr.canBeUpdated===!1&&(tr.canBeUpdated=oe.isCascadeUpdate===!0&&I==="save"),tr.canBeSoftRemoved===!1&&(tr.canBeSoftRemoved=oe.isCascadeSoftRemove===!0&&I==="soft-remove"),tr.canBeRecovered===!1&&(tr.canBeRecovered=oe.isCascadeRecover===!0&&I==="recover");return}const rr=new Subject({metadata:bt,parentSubject:e,entity:ue,canBeInserted:oe.isCascadeInsert===!0&&I==="save",canBeUpdated:oe.isCascadeUpdate===!0&&I==="save",canBeSoftRemoved:oe.isCascadeSoftRemove===!0&&I==="soft-remove",canBeRecovered:oe.isCascadeRecover===!0&&I==="recover"});this.allSubjects.push(rr),this.build(rr,I)})}findByPersistEntityLike(e,I){return this.allSubjects.find(oe=>oe.entity?oe.entity===I?!0:oe.metadata.target===e&&oe.metadata.compareEntities(oe.entityWithFulfilledIds,I):!1)}}class EntityPersistExecutor{constructor(e,I,oe,ue,bt,tr){this.connection=e,this.queryRunner=I,this.mode=oe,this.target=ue,this.entity=bt,this.options=tr}async execute(){if(!this.entity||typeof this.entity!="object")return Promise.reject(new MustBeEntityError(this.mode,this.entity));await Promise.resolve();const e=this.queryRunner||this.connection.createQueryRunner();let I=e.data;this.options&&this.options.data&&(e.data=this.options.data);try{const oe=Array.isArray(this.entity)?this.entity:[this.entity],ue=this.options&&this.options.chunk&&this.options.chunk>0?OrmUtils.chunk(oe,this.options.chunk):[oe],tr=(await Promise.all(ue.map(async ir=>{const lr=[];ir.forEach(pr=>{const hr=this.target?this.target:pr.constructor;if(hr===Object)throw new CannotDetermineEntityError(this.mode);let _r=this.connection.getMetadata(hr).findInheritanceMetadata(pr);lr.push(new Subject({metadata:_r,entity:pr,canBeInserted:this.mode==="save",canBeUpdated:this.mode==="save",mustBeRemoved:this.mode==="remove",canBeSoftRemoved:this.mode==="soft-remove",canBeRecovered:this.mode==="recover"}))});const dr=new CascadesSubjectBuilder(lr);return lr.forEach(pr=>{dr.build(pr,this.mode)}),await new SubjectDatabaseEntityLoader(e,lr).load(this.mode),this.mode==="save"||this.mode==="soft-remove"||this.mode==="recover"?(new OneToManySubjectBuilder(lr).build(),new OneToOneInverseSideSubjectBuilder(lr).build(),new ManyToManySubjectBuilder(lr).build()):lr.forEach(pr=>{pr.mustBeRemoved&&new ManyToManySubjectBuilder(lr).buildForAllRemoval(pr)}),new SubjectExecutor(e,lr,this.options)}))).filter(ir=>ir.hasExecutableOperations);if(tr.length===0)return;let rr=!1;try{e.isTransactionActive||this.connection.driver.transactionSupport!=="none"&&(!this.options||this.options.transaction!==!1)&&(rr=!0,await e.startTransaction());for(const ir of tr)await ir.execute();rr===!0&&await e.commitTransaction()}catch(ir){if(rr)try{await e.rollbackTransaction()}catch{}throw ir}}finally{e.data=I,this.queryRunner||await e.release()}}}class EntityManager{constructor(e,I){this["@instanceof"]=Symbol.for("EntityManager"),this.repositories=new Map,this.treeRepositories=[],this.plainObjectToEntityTransformer=new PlainObjectToNewEntityTransformer,this.connection=e,I&&(this.queryRunner=I,ObjectUtils.assign(this.queryRunner,{manager:this}))}async transaction(e,I){const oe=typeof e=="string"?e:void 0,ue=typeof e=="function"?e:I;if(!ue)throw new TypeORMError("Transaction method requires callback in second parameter if isolation level is supplied.");if(this.queryRunner&&this.queryRunner.isReleased)throw new QueryRunnerProviderAlreadyReleasedError;const bt=this.queryRunner||this.connection.createQueryRunner();try{await bt.startTransaction(oe);const tr=await ue(bt.manager);return await bt.commitTransaction(),tr}catch(tr){try{await bt.rollbackTransaction()}catch{}throw tr}finally{this.queryRunner||await bt.release()}}async query(e,I){return this.connection.query(e,I,this.queryRunner)}createQueryBuilder(e,I,oe){return I?this.connection.createQueryBuilder(e,I,oe||this.queryRunner):this.connection.createQueryBuilder(e||oe||this.queryRunner)}hasId(e,I){const oe=arguments.length===2?e:e.constructor,ue=arguments.length===2?I:e;return this.connection.getMetadata(oe).hasId(ue)}getId(e,I){const oe=arguments.length===2?e:e.constructor,ue=arguments.length===2?I:e;return this.connection.getMetadata(oe).getEntityIdMixedMap(ue)}create(e,I){const oe=this.connection.getMetadata(e);if(!I)return oe.create(this.queryRunner);if(Array.isArray(I))return I.map(bt=>this.create(e,bt));const ue=oe.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(ue,I,oe,!0),ue}merge(e,I,...oe){const ue=this.connection.getMetadata(e);return oe.forEach(bt=>this.plainObjectToEntityTransformer.transform(I,bt,ue)),I}async preload(e,I){const oe=this.connection.getMetadata(e),bt=await new PlainObjectToDatabaseEntityTransformer(this.connection.manager).transform(I,oe);if(bt)return this.merge(e,bt,I)}save(e,I,oe){let ue=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0;const bt=ue?I:e,tr=ue?oe:I;return InstanceChecker.isEntitySchema(ue)&&(ue=ue.options.name),Array.isArray(bt)&&bt.length===0?Promise.resolve(bt):new EntityPersistExecutor(this.connection,this.queryRunner,"save",ue,bt,tr).execute().then(()=>bt)}remove(e,I,oe){const ue=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0,bt=ue?I:e,tr=ue?oe:I;return Array.isArray(bt)&&bt.length===0?Promise.resolve(bt):new EntityPersistExecutor(this.connection,this.queryRunner,"remove",ue,bt,tr).execute().then(()=>bt)}softRemove(e,I,oe){let ue=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0;const bt=ue?I:e,tr=ue?oe:I;return InstanceChecker.isEntitySchema(ue)&&(ue=ue.options.name),Array.isArray(bt)&&bt.length===0?Promise.resolve(bt):new EntityPersistExecutor(this.connection,this.queryRunner,"soft-remove",ue,bt,tr).execute().then(()=>bt)}recover(e,I,oe){let ue=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0;const bt=ue?I:e,tr=ue?oe:I;return InstanceChecker.isEntitySchema(ue)&&(ue=ue.options.name),Array.isArray(bt)&&bt.length===0?Promise.resolve(bt):new EntityPersistExecutor(this.connection,this.queryRunner,"recover",ue,bt,tr).execute().then(()=>bt)}async insert(e,I){return this.createQueryBuilder().insert().into(e).values(I).execute()}async upsert(e,I,oe){const ue=this.connection.getMetadata(e);let bt;Array.isArray(oe)?bt={conflictPaths:oe}:bt=oe;let tr;Array.isArray(I)?tr=I:tr=[I];const rr=ue.mapPropertyPathsToColumns(Array.isArray(bt.conflictPaths)?bt.conflictPaths:Object.keys(bt.conflictPaths)),ir=ue.columns.filter(lr=>!rr.includes(lr)&&tr.some(dr=>typeof lr.getEntityValue(dr)<"u"));return this.createQueryBuilder().insert().into(e).values(tr).orUpdate([...rr,...ir].map(lr=>lr.databaseName),rr.map(lr=>lr.databaseName),{skipUpdateIfNoValuesChanged:bt.skipUpdateIfNoValuesChanged,indexPredicate:bt.indexPredicate,upsertType:bt.upsertType||this.connection.driver.supportedUpsertTypes[0]}).execute()}update(e,I,oe){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the update method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().update(e).set(oe).whereInIds(I).execute():this.createQueryBuilder().update(e).set(oe).where(I).execute()}delete(e,I){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the delete method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().delete().from(e).whereInIds(I).execute():this.createQueryBuilder().delete().from(e).where(I).execute()}softDelete(e,I){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the delete method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().softDelete().from(e).whereInIds(I).execute():this.createQueryBuilder().softDelete().from(e).where(I).execute()}restore(e,I){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the delete method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().restore().from(e).whereInIds(I).execute():this.createQueryBuilder().restore().from(e).where(I).execute()}exists(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||oe.name).setFindOptions(I||{}).getExists()}async existsBy(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,oe.name).setFindOptions({where:I}).getExists()}count(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||oe.name).setFindOptions(I||{}).getCount()}countBy(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,oe.name).setFindOptions({where:I}).getCount()}sum(e,I,oe){return this.callAggregateFun(e,"SUM",I,oe)}average(e,I,oe){return this.callAggregateFun(e,"AVG",I,oe)}minimum(e,I,oe){return this.callAggregateFun(e,"MIN",I,oe)}maximum(e,I,oe){return this.callAggregateFun(e,"MAX",I,oe)}async callAggregateFun(e,I,oe,ue={}){const bt=this.connection.getMetadata(e),tr=bt.columns.find(ir=>ir.propertyPath===oe);if(!tr)throw new TypeORMError(`Column "${oe}" was not found in table "${bt.name}"`);const rr=await this.createQueryBuilder(e,bt.name).setFindOptions({where:ue}).select(`${I}(${this.connection.driver.escape(tr.databaseName)})`,I).getRawOne();return rr[I]===null?null:parseFloat(rr[I])}async find(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||oe.name).setFindOptions(I||{}).getMany()}async findBy(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,oe.name).setFindOptions({where:I}).getMany()}findAndCount(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||oe.name).setFindOptions(I||{}).getManyAndCount()}findAndCountBy(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,oe.name).setFindOptions({where:I}).getManyAndCount()}async findByIds(e,I){if(!I.length)return Promise.resolve([]);const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,oe.name).andWhereInIds(I).getMany()}async findOne(e,I){let ue=this.connection.getMetadata(e).name;if(I&&I.join&&(ue=I.join.alias),!I.where)throw new Error("You must provide selection conditions in order to find a single row.");return this.createQueryBuilder(e,ue).setFindOptions({...I,take:1}).getOne()}async findOneBy(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,oe.name).setFindOptions({where:I,take:1}).getOne()}async findOneById(e,I){const oe=this.connection.getMetadata(e);return this.createQueryBuilder(e,oe.name).setFindOptions({take:1}).whereInIds(oe.ensureEntityIdMap(I)).getOne()}async findOneOrFail(e,I){return this.findOne(e,I).then(oe=>oe===null?Promise.reject(new EntityNotFoundError(e,I)):Promise.resolve(oe))}async findOneByOrFail(e,I){return this.findOneBy(e,I).then(oe=>oe===null?Promise.reject(new EntityNotFoundError(e,I)):Promise.resolve(oe))}async clear(e){const I=this.connection.getMetadata(e),oe=this.queryRunner||this.connection.createQueryRunner();try{return await oe.clearTable(I.tablePath)}finally{this.queryRunner||await oe.release()}}async increment(e,I,oe,ue){const bt=this.connection.getMetadata(e),tr=bt.findColumnWithPropertyPath(oe);if(!tr)throw new TypeORMError(`Column ${oe} was not found in ${bt.targetName} entity.`);if(isNaN(Number(ue)))throw new TypeORMError(`Value "${ue}" is not a number.`);const rr=oe.split(".").reduceRight((ir,lr)=>({[lr]:ir}),()=>this.connection.driver.escape(tr.databaseName)+" + "+ue);return this.createQueryBuilder(e,"entity").update(e).set(rr).where(I).execute()}async decrement(e,I,oe,ue){const bt=this.connection.getMetadata(e),tr=bt.findColumnWithPropertyPath(oe);if(!tr)throw new TypeORMError(`Column ${oe} was not found in ${bt.targetName} entity.`);if(isNaN(Number(ue)))throw new TypeORMError(`Value "${ue}" is not a number.`);const rr=oe.split(".").reduceRight((ir,lr)=>({[lr]:ir}),()=>this.connection.driver.escape(tr.databaseName)+" - "+ue);return this.createQueryBuilder(e,"entity").update(e).set(rr).where(I).execute()}getRepository(e){const I=this.repositories.get(e);if(I)return I;if(this.connection.driver.options.type==="mongodb"){const oe=new MongoRepository(e,this,this.queryRunner);return this.repositories.set(e,oe),oe}else{const oe=new Repository(e,this,this.queryRunner);return this.repositories.set(e,oe),oe}}getTreeRepository(e){if(this.connection.driver.treeSupport===!1)throw new TreeRepositoryNotSupportedError(this.connection.driver);const I=this.treeRepositories.find(ue=>ue.target===e);if(I)return I;const oe=new TreeRepository(e,this,this.queryRunner);return this.treeRepositories.push(oe),oe}getMongoRepository(e){return this.connection.getMongoRepository(e)}withRepository(e){const I=e.constructor,{target:oe,manager:ue,queryRunner:bt,...tr}=e;return Object.assign(new I(e.target,this),{...tr})}getCustomRepository(e){const I=getMetadataArgsStorage().entityRepositories.find(bt=>bt.target===(typeof e=="function"?e:e.constructor));if(!I)throw new CustomRepositoryNotFoundError(e);const oe=I.entity?this.connection.getMetadata(I.entity):void 0,ue=new I.target(this,oe);if(ue instanceof AbstractRepository)ue.manager||(ue.manager=this);else{if(!oe)throw new CustomRepositoryCannotInheritRepositoryError(e);ue.manager=this,ue.metadata=oe}return ue}async release(){if(!this.queryRunner)throw new NoNeedToReleaseEntityManagerError;return this.queryRunner.release()}}class SqljsEntityManager extends EntityManager{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("SqljsEntityManager"),this.driver=e.driver}async loadDatabase(e){await this.driver.load(e)}async saveDatabase(e){await this.driver.save(e)}exportDatabase(){return this.driver.export()}}class EntityManagerFactory{create(e,I){return e.driver.options.type==="mongodb"?new MongoEntityManager(e):e.driver.options.type==="sqljs"?new SqljsEntityManager(e,I):new EntityManager(e,I)}}class View{constructor(e){this["@instanceof"]=Symbol.for("View"),this.indices=[],e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}clone(){return new View({database:this.database,schema:this.schema,name:this.name,expression:this.expression,materialized:this.materialized})}addIndex(e){this.indices.push(e)}removeIndex(e){const I=this.indices.find(oe=>oe.name===e.name);I&&this.indices.splice(this.indices.indexOf(I),1)}static create(e,I){const oe={database:e.database,schema:e.schema,name:I.buildTableName(e.tableName,e.schema,e.database),expression:e.expression,materialized:e.tableMetadataArgs.materialized};return new View(oe)}}class ViewUtils{static viewMetadataCmp(e,I){return!e||!I?0:e.dependsOn&&(e.dependsOn.has(I.target)||e.dependsOn.has(I.name))?1:I.dependsOn&&(I.dependsOn.has(e.target)||I.dependsOn.has(e.name))?-1:0}}class RdbmsSchemaBuilder{constructor(e){this.connection=e,this["@instanceof"]=Symbol.for("RdbmsSchemaBuilder")}async build(){this.queryRunner=this.connection.createQueryRunner(),this.currentDatabase=this.connection.driver.database,this.currentSchema=this.connection.driver.schema;const e=this.connection.driver.options.type!=="cockroachdb"&&this.connection.driver.options.type!=="spanner"&&this.connection.options.migrationsTransactionMode!=="none";await this.queryRunner.beforeMigration(),e&&await this.queryRunner.startTransaction();try{await this.createMetadataTableIfNecessary(this.queryRunner);const I=this.entityToSyncMetadatas.map(ue=>this.getTablePath(ue)),oe=this.viewEntityToSyncMetadatas.map(ue=>this.getTablePath(ue));await this.queryRunner.getTables(I),await this.queryRunner.getViews(oe),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),e&&await this.queryRunner.commitTransaction()}catch(I){try{e&&await this.queryRunner.rollbackTransaction()}catch{}throw I}finally{await this.queryRunner.afterMigration(),await this.queryRunner.release()}}async createMetadataTableIfNecessary(e){(this.viewEntityToSyncMetadatas.length>0||this.hasGeneratedColumns())&&await this.createTypeormMetadataTable(e)}async log(){this.queryRunner=this.connection.createQueryRunner();try{const e=this.entityToSyncMetadatas.map(oe=>this.getTablePath(oe)),I=this.viewEntityToSyncMetadatas.map(oe=>this.getTablePath(oe));return await this.queryRunner.getTables(e),await this.queryRunner.getViews(I),this.queryRunner.enableSqlMemory(),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),this.queryRunner.getMemorySql()}finally{this.queryRunner.disableSqlMemory(),await this.queryRunner.release()}}get entityToSyncMetadatas(){return this.connection.entityMetadatas.filter(e=>e.synchronize&&e.tableType!=="entity-child"&&e.tableType!=="view")}get viewEntityToSyncMetadatas(){return this.connection.entityMetadatas.filter(e=>e.tableType==="view"&&e.synchronize).sort(ViewUtils.viewMetadataCmp)}hasGeneratedColumns(){return this.connection.entityMetadatas.some(e=>e.columns.some(I=>I.generatedType))}async executeSchemaSyncOperationsInProperOrder(){await this.dropOldViews(),await this.dropOldForeignKeys(),await this.dropOldIndices(),await this.dropOldChecks(),await this.dropOldExclusions(),await this.dropCompositeUniqueConstraints(),await this.renameColumns(),await this.changeTableComment(),await this.createNewTables(),await this.dropRemovedColumns(),await this.addNewColumns(),await this.updatePrimaryKeys(),await this.updateExistColumns(),await this.createNewIndices(),await this.createNewChecks(),await this.createNewExclusions(),await this.createCompositeUniqueConstraints(),await this.createForeignKeys(),await this.createViews(),await this.createNewViewIndices()}getTablePath(e){const I=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(I.tableName,I.schema||this.currentSchema,I.database||this.currentDatabase)}async dropOldForeignKeys(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=I.foreignKeys.filter(ue=>{const bt=e.foreignKeys.find(tr=>ue.name===tr.name&&this.getTablePath(ue)===this.getTablePath(tr.referencedEntityMetadata));return!bt||bt.onDelete&&bt.onDelete!==ue.onDelete||bt.onUpdate&&bt.onUpdate!==ue.onUpdate});oe.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old foreign keys of ${I.name}: ${oe.map(ue=>ue.name).join(", ")}`),await this.queryRunner.dropForeignKeys(I,oe))}}async renameTables(){}async renameColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I||e.columns.length!==I.columns.length)continue;const oe=e.columns.filter(tr=>!tr.isVirtualProperty).filter(tr=>!I.columns.find(rr=>rr.name===tr.databaseName&&rr.type===this.connection.driver.normalizeType(tr)&&rr.isNullable===tr.isNullable&&rr.isUnique===this.connection.driver.normalizeIsUnique(tr)));if(oe.length===0||oe.length>1)continue;const ue=I.columns.filter(tr=>!e.columns.find(rr=>!rr.isVirtualProperty&&rr.databaseName===tr.name&&this.connection.driver.normalizeType(rr)===tr.type&&rr.isNullable===tr.isNullable&&this.connection.driver.normalizeIsUnique(rr)===tr.isUnique));if(ue.length===0||ue.length>1)continue;const bt=ue[0].clone();bt.name=oe[0].databaseName,this.connection.logger.logSchemaBuild(`renaming column "${ue[0].name}" in "${I.name}" to "${bt.name}"`),await this.queryRunner.renameColumn(I,ue[0],bt)}}async dropOldIndices(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=I.indices.filter(ue=>{const bt=e.indices.find(tr=>tr.name===ue.name);return bt?bt.synchronize===!1?!1:bt.isUnique!==ue.isUnique||bt.isSpatial!==ue.isSpatial||this.connection.driver.isFullTextColumnTypeSupported()&&bt.isFulltext!==ue.isFulltext||bt.columns.length!==ue.columnNames.length?!0:!bt.columns.every(tr=>ue.columnNames.indexOf(tr.databaseName)!==-1):!0}).map(async ue=>{this.connection.logger.logSchemaBuild(`dropping an index: "${ue.name}" from table ${I.name}`),await this.queryRunner.dropIndex(I,ue)});await Promise.all(oe)}if(this.connection.options.type==="postgres"){const e=this.queryRunner;for(const I of this.viewEntityToSyncMetadatas){const oe=this.queryRunner.loadedViews.find(bt=>this.getTablePath(bt)===this.getTablePath(I));if(!oe)continue;const ue=oe.indices.filter(bt=>{const tr=I.indices.find(rr=>rr.name===bt.name);return tr?tr.synchronize===!1?!1:tr.isUnique!==bt.isUnique||tr.isSpatial!==bt.isSpatial||this.connection.driver.isFullTextColumnTypeSupported()&&tr.isFulltext!==bt.isFulltext||tr.columns.length!==bt.columnNames.length?!0:!tr.columns.every(rr=>bt.columnNames.indexOf(rr.databaseName)!==-1):!0}).map(async bt=>{this.connection.logger.logSchemaBuild(`dropping an index: "${bt.name}" from view ${oe.name}`),await e.dropViewIndex(oe,bt)});await Promise.all(ue)}}}async dropOldChecks(){if(!(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"))for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=I.checks.filter(ue=>!e.checks.find(bt=>bt.name===ue.name));oe.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old check constraint: ${oe.map(ue=>`"${ue.name}"`).join(", ")} from table "${I.name}"`),await this.queryRunner.dropCheckConstraints(I,oe))}}async dropCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=I.uniques.filter(ue=>ue.columnNames.length>1&&!e.uniques.find(bt=>bt.name===ue.name));oe.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old unique constraint: ${oe.map(ue=>`"${ue.name}"`).join(", ")} from table "${I.name}"`),await this.queryRunner.dropUniqueConstraints(I,oe))}}async dropOldExclusions(){if(this.connection.driver.options.type==="postgres")for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=I.exclusions.filter(ue=>!e.exclusions.find(bt=>bt.name===ue.name));oe.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old exclusion constraint: ${oe.map(ue=>`"${ue.name}"`).join(", ")} from table "${I.name}"`),await this.queryRunner.dropExclusionConstraints(I,oe))}}async changeTableComment(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(oe=>this.getTablePath(oe)===this.getTablePath(e));if(I&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="postgres")){const oe=e.comment;await this.queryRunner.changeTableComment(I,oe)}}}async createNewTables(){for(const e of this.entityToSyncMetadatas){if(this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e)))continue;this.connection.logger.logSchemaBuild(`creating a new table: ${this.getTablePath(e)}`);const oe=Table.create(e,this.connection.driver);await this.queryRunner.createTable(oe,!1,!1),this.queryRunner.loadedTables.push(oe)}}async createViews(){for(const e of this.viewEntityToSyncMetadatas){if(this.queryRunner.loadedViews.find(ue=>{const bt=typeof ue.expression=="string"?ue.expression.trim():ue.expression(this.connection).getQuery(),tr=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.getTablePath(ue)===this.getTablePath(e)&&bt===tr}))continue;this.connection.logger.logSchemaBuild(`creating a new view: ${this.getTablePath(e)}`);const oe=View.create(e,this.connection.driver);await this.queryRunner.createView(oe,!0),this.queryRunner.loadedViews.push(oe)}}async dropOldViews(){const e=[],I=this.viewEntityToSyncMetadatas,oe=new Map;for(const tr of this.queryRunner.loadedViews){const rr=I.find(ir=>this.getTablePath(tr)===this.getTablePath(ir));rr&&oe.set(tr,rr)}for(const tr of this.queryRunner.loadedViews){const rr=oe.get(tr);if(!rr)continue;const ir=typeof tr.expression=="string"?tr.expression.trim():tr.expression(this.connection).getQuery(),lr=typeof rr.expression=="string"?rr.expression.trim():rr.expression(this.connection).getQuery();ir!==lr&&(this.connection.logger.logSchemaBuild(`dropping an old view: ${tr.name}`),e.push(tr))}const ue=tr=>{const rr=oe.get(tr);let ir=[tr];if(!rr)return ir;for(const[lr,dr]of oe.entries())lr!==tr&&dr.dependsOn&&(dr.dependsOn.has(rr.target)||dr.dependsOn.has(rr.name))&&(ir=ir.concat(ue(lr)));return ir},bt=new Set(e.map(tr=>ue(tr)).reduce((tr,rr)=>tr.concat(rr),[]).sort((tr,rr)=>ViewUtils.viewMetadataCmp(oe.get(tr),oe.get(rr))).reverse());for(const tr of bt)await this.queryRunner.dropView(tr);this.queryRunner.loadedViews=this.queryRunner.loadedViews.filter(tr=>!bt.has(tr))}async dropRemovedColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=I.columns.filter(ue=>!e.columns.find(bt=>bt.isVirtualProperty||bt.databaseName===ue.name));oe.length!==0&&(this.connection.logger.logSchemaBuild(`columns dropped in ${I.name}: `+oe.map(ue=>ue.name).join(", ")),await this.queryRunner.dropColumns(I,oe))}}async addNewColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const oe=e.columns.filter(tr=>!tr.isVirtualProperty&&!I.columns.find(rr=>rr.name===tr.databaseName));if(oe.length===0)continue;const bt=this.metadataColumnsToTableColumnOptions(oe).map(tr=>new TableColumn(tr));bt.length!==0&&(this.connection.logger.logSchemaBuild("new columns added: "+oe.map(tr=>tr.databaseName).join(", ")),await this.queryRunner.addColumns(I,bt))}}async updatePrimaryKeys(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(bt=>this.getTablePath(bt)===this.getTablePath(e));if(!I)continue;const oe=e.columns.filter(bt=>bt.isPrimary);if(I.columns.filter(bt=>bt.isPrimary).length!==oe.length&&oe.length>1){const bt=oe.map(tr=>new TableColumn(TableUtils.createTableColumnOptions(tr,this.connection.driver)));await this.queryRunner.updatePrimaryKeys(I,bt)}}}async updateExistColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(bt=>this.getTablePath(bt)===this.getTablePath(e));if(!I)continue;const oe=this.connection.driver.findChangedColumns(I.columns,e.columns);if(oe.length===0)continue;for(const bt of oe)await this.dropColumnReferencedForeignKeys(this.getTablePath(e),bt.databaseName);for(const bt of oe)await this.dropColumnCompositeIndices(this.getTablePath(e),bt.databaseName);if(!(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="spanner"))for(const bt of oe)await this.dropColumnCompositeUniques(this.getTablePath(e),bt.databaseName);const ue=oe.map(bt=>{const tr=I.columns.find(lr=>lr.name===bt.databaseName),rr=TableUtils.createTableColumnOptions(bt,this.connection.driver),ir=new TableColumn(rr);return{oldColumn:tr,newColumn:ir}});ue.length!==0&&(this.connection.logger.logSchemaBuild(`columns changed in "${I.name}". updating: `+oe.map(bt=>bt.databaseName).join(", ")),await this.queryRunner.changeColumns(I,ue))}}async createNewIndices(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=e.indices.filter(ue=>!I.indices.find(bt=>bt.name===ue.name)&&ue.synchronize===!0).map(ue=>TableIndex.create(ue));oe.length!==0&&(this.connection.logger.logSchemaBuild(`adding new indices ${oe.map(ue=>`"${ue.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createIndices(I,oe))}}async createNewViewIndices(){if(this.connection.options.type!=="postgres"||!DriverUtils.isPostgresFamily(this.connection.driver))return;const e=this.queryRunner;for(const I of this.viewEntityToSyncMetadatas){const oe=this.queryRunner.loadedViews.find(bt=>{const tr=typeof bt.expression=="string"?bt.expression.trim():bt.expression(this.connection).getQuery(),rr=typeof I.expression=="string"?I.expression.trim():I.expression(this.connection).getQuery();return this.getTablePath(bt)===this.getTablePath(I)&&tr===rr});if(!oe||!oe.materialized)continue;const ue=I.indices.filter(bt=>!oe.indices.find(tr=>tr.name===bt.name)&&bt.synchronize===!0).map(bt=>TableIndex.create(bt));ue.length!==0&&(this.connection.logger.logSchemaBuild(`adding new indices ${ue.map(bt=>`"${bt.name}"`).join(", ")} in view "${oe.name}"`),await e.createViewIndices(oe,ue))}}async createNewChecks(){if(!(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"))for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=e.checks.filter(ue=>!I.checks.find(bt=>bt.name===ue.name)).map(ue=>TableCheck.create(ue));oe.length!==0&&(this.connection.logger.logSchemaBuild(`adding new check constraints: ${oe.map(ue=>`"${ue.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createCheckConstraints(I,oe))}}async createCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=e.uniques.filter(ue=>ue.columns.length>1&&!I.uniques.find(bt=>bt.name===ue.name)).map(ue=>TableUnique.create(ue));oe.length!==0&&(this.connection.logger.logSchemaBuild(`adding new unique constraints: ${oe.map(ue=>`"${ue.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createUniqueConstraints(I,oe))}}async createNewExclusions(){if(this.connection.driver.options.type==="postgres")for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ue=>this.getTablePath(ue)===this.getTablePath(e));if(!I)continue;const oe=e.exclusions.filter(ue=>!I.exclusions.find(bt=>bt.name===ue.name)).map(ue=>TableExclusion.create(ue));oe.length!==0&&(this.connection.logger.logSchemaBuild(`adding new exclusion constraints: ${oe.map(ue=>`"${ue.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createExclusionConstraints(I,oe))}}async createForeignKeys(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(bt=>this.getTablePath(bt)===this.getTablePath(e));if(!I)continue;const oe=e.foreignKeys.filter(bt=>!I.foreignKeys.find(tr=>tr.name===bt.name&&this.getTablePath(tr)===this.getTablePath(bt.referencedEntityMetadata)));if(oe.length===0)continue;const ue=oe.map(bt=>TableForeignKey.create(bt,this.connection.driver));this.connection.logger.logSchemaBuild(`creating a foreign keys: ${oe.map(bt=>bt.name).join(", ")} on table "${I.name}"`),await this.queryRunner.createForeignKeys(I,ue)}}async dropColumnReferencedForeignKeys(e,I){const oe=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===e);if(!oe)return;const ue=[],bt=oe.foreignKeys.find(tr=>tr.columnNames.indexOf(I)!==-1);if(bt){const tr=oe.clone();tr.foreignKeys=[bt],ue.push(tr),oe.removeForeignKey(bt)}for(const tr of this.queryRunner.loadedTables){const rr=tr.foreignKeys.filter(ir=>this.getTablePath(ir)===e&&ir.referencedColumnNames.indexOf(I)!==-1);if(rr.length>0){const ir=tr.clone();ir.foreignKeys=rr,ue.push(ir),rr.forEach(lr=>tr.removeForeignKey(lr))}}if(ue.length>0)for(const tr of ue)this.connection.logger.logSchemaBuild(`dropping related foreign keys of ${tr.name}: ${tr.foreignKeys.map(rr=>rr.name).join(", ")}`),await this.queryRunner.dropForeignKeys(tr,tr.foreignKeys)}async dropColumnCompositeIndices(e,I){const oe=this.queryRunner.loadedTables.find(bt=>this.getTablePath(bt)===e);if(!oe)return;const ue=oe.indices.filter(bt=>bt.columnNames.length>1&&bt.columnNames.indexOf(I)!==-1);ue.length!==0&&(this.connection.logger.logSchemaBuild(`dropping related indices of "${e}"."${I}": ${ue.map(bt=>bt.name).join(", ")}`),await this.queryRunner.dropIndices(oe,ue))}async dropColumnCompositeUniques(e,I){const oe=this.queryRunner.loadedTables.find(bt=>this.getTablePath(bt)===e);if(!oe)return;const ue=oe.uniques.filter(bt=>bt.columnNames.length>1&&bt.columnNames.indexOf(I)!==-1);ue.length!==0&&(this.connection.logger.logSchemaBuild(`dropping related unique constraints of "${e}"."${I}": ${ue.map(bt=>bt.name).join(", ")}`),await this.queryRunner.dropUniqueConstraints(oe,ue))}metadataColumnsToTableColumnOptions(e){return e.map(I=>TableUtils.createTableColumnOptions(I,this.connection.driver))}async createTypeormMetadataTable(e){const I=this.currentSchema,oe=this.currentDatabase,ue=this.connection.driver.buildTableName(this.connection.metadataTableName,I,oe),bt=this.connection.driver.options.type==="spanner";await e.createTable(new Table({database:oe,schema:I,name:ue,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1,isPrimary:bt},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0,isPrimary:bt},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0,isPrimary:bt},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0,isPrimary:bt},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0,isPrimary:bt},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0,isPrimary:bt}]}),!0)}}class AbstractSqliteDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime","json"],this.supportedUpsertTypes=["on-conflict-do-update"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.cteCapabilities={enabled:!0,requiresRecursiveHint:!0},this.attachedDatabases={},this.connection=e,this.options=e.options,this.database=DriverUtils.buildDriverOptions(this.options).database}async connect(){this.databaseConnection=await this.createDatabaseConnection()}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise((e,I)=>{this.queryRunner=void 0,this.databaseConnection.close(oe=>oe?I(oe):e())})}hasAttachedDatabases(){return!!Object.keys(this.attachedDatabases).length}getAttachedDatabaseHandleByRelativePath(e){return this.attachedDatabases?.[e]?.attachHandle}getAttachedDatabasePathRelativeByHandle(e){return Object.values(this.attachedDatabases).find(({attachHandle:I})=>e===I)?.attachFilepathRelative}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null?e:I.type===Boolean||I.type==="boolean"?e===!0?1:0:I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="time"?DateUtils.mixedDateToTimeString(e):I.type==="datetime"||I.type===Date?DateUtils.mixedDateToUtcDatetimeString(e):I.type==="json"||I.type==="simple-json"?DateUtils.simpleJsonToString(e):I.type==="simple-array"?DateUtils.simpleArrayToString(e):I.type==="simple-enum"?DateUtils.simpleEnumToString(e):e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:(I.type===Boolean||I.type==="boolean"?e=!!e:I.type==="datetime"||I.type===Date?(e&&typeof e=="string"&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=DateUtils.normalizeHydratedDate(e)):I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="time"?e=DateUtils.mixedTimeToString(e):I.type==="json"||I.type==="simple-json"?e=DateUtils.stringToSimpleJson(e):I.type==="simple-array"?e=DateUtils.stringToSimpleArray(e):I.type==="simple-enum"?e=DateUtils.stringToSimpleEnum(e,I):I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}escapeQueryWithParameters(e,I,oe){const ue=Object.keys(oe).map(bt=>typeof oe[bt]=="boolean"?oe[bt]===!0?1:0:oe[bt]instanceof Date?DateUtils.mixedDateToUtcDatetimeString(oe[bt]):oe[bt]);return!I||!Object.keys(I).length?[e,ue]:(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(bt,tr,rr)=>{if(!I.hasOwnProperty(rr))return bt;let ir=I[rr];return tr?ir.map(lr=>(ue.push(lr),this.createParameter(rr,ue.length-1))).join(", "):typeof ir=="function"?ir():typeof ir=="number"?String(ir):typeof ir=="boolean"?(ue.push(+ir),this.createParameter(rr,ue.length-1)):ir instanceof Date?(ue.push(DateUtils.mixedDateToUtcDatetimeString(ir)),this.createParameter(rr,ue.length-1)):(ue.push(ir),this.createParameter(rr,ue.length-1))}),[e,ue])}escape(e){return'"'+e+'"'}buildTableName(e,I,oe){return e}parseTableName(e){const I=this.database,oe=void 0;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const bt=this.parseTableName(e.schema?`"${e.schema}"."${e.name}"`:e.name);return{database:e.database||bt.database||I,schema:e.schema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isTableForeignKey(e)){const bt=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||bt.database||I,schema:e.referencedSchema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||oe,tableName:e.tableName};const ue=e.split(".");return ue.length===3?{database:ue[0]||I,schema:ue[1]||oe,tableName:ue[2]}:ue.length===2?{database:this.getAttachedDatabasePathRelativeByHandle(ue[0])??I,schema:ue[0],tableName:ue[1]}:{database:I,schema:oe,tableName:e}}normalizeType(e){return e.type===Number||e.type==="int"?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":e.type==="uuid"?"varchar":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"varchar":e.type||""}normalizeDefault(e){const I=e.default;if(typeof I=="number")return""+I;if(typeof I=="boolean")return I?"1":"0";if(typeof I=="function")return I();if(typeof I=="string")return`'${I}'`;if(I!=null)return`${I}`}normalizeIsUnique(e){return e.entityMetadata.uniques.some(I=>I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let I=e.type;return e.enum?"varchar":(e.length?I+="("+e.length+")":e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+="("+e.precision+","+e.scale+")":e.precision!==null&&e.precision!==void 0&&(I+="("+e.precision+")"),e.isArray&&(I+=" array"),I)}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,I,oe,ue){const bt=e.generatedColumns.reduce((tr,rr)=>{let ir;return rr.generationStrategy==="increment"&&I&&(ir=I-ue+oe+1),ir?OrmUtils.mergeDeep(tr,rr.createValueMap(ir)):tr},{});return Object.keys(bt).length>0?bt:void 0}findChangedColumns(e,I){return I.filter(oe=>{const ue=e.find(tr=>tr.name===oe.databaseName);return ue?ue.name!==oe.databaseName||ue.type!==this.normalizeType(oe)||ue.length!==oe.length||ue.precision!==oe.precision||ue.scale!==oe.scale||this.normalizeDefault(oe)!==ue.default||ue.isPrimary!==oe.isPrimary||ue.isNullable!==oe.isNullable||ue.generatedType!==oe.generatedType||ue.asExpression!==oe.asExpression||ue.isUnique!==this.normalizeIsUnique(oe)||ue.enum&&oe.enum&&!OrmUtils.isArraysEqual(ue.enum,oe.enum.map(tr=>tr+""))||oe.generationStrategy!=="uuid"&&ue.isGenerated!==oe.isGenerated:!1})}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,I){return"?"}createDatabaseConnection(){throw new TypeORMError("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")}loadDependencies(){}}class Query{constructor(e,I){this.query=e,this.parameters=I,this["@instanceof"]=Symbol.for("Query")}}class SqlInMemory{constructor(){this.upQueries=[],this.downQueries=[]}}class BaseQueryRunner{constructor(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new SqlInMemory,this.transactionDepth=0,this.cachedTablePaths={}}async beforeMigration(){}async afterMigration(){}async getTable(e){return this.loadedTables=await this.loadTables([e]),this.loadedTables.length>0?this.loadedTables[0]:void 0}async getTables(e){return e?(this.loadedTables=await this.loadTables(e),this.loadedTables):await this.loadTables(e)}async getView(e){return this.loadedViews=await this.loadViews([e]),this.loadedViews.length>0?this.loadedViews[0]:void 0}async getViews(e){return this.loadedViews=await this.loadViews(e),this.loadedViews}enableSqlMemory(){this.sqlInMemory=new SqlInMemory,this.sqlMemoryMode=!0}disableSqlMemory(){this.sqlInMemory=new SqlInMemory,this.sqlMemoryMode=!1}clearSqlMemory(){this.sqlInMemory=new SqlInMemory}getMemorySql(){return this.sqlInMemory}async executeMemoryUpSql(){for(const{query:e,parameters:I}of this.sqlInMemory.upQueries)await this.query(e,I)}async executeMemoryDownSql(){for(const{query:e,parameters:I}of this.sqlInMemory.downQueries.reverse())await this.query(e,I)}getReplicationMode(){return this.mode}async getCachedView(e){const I=this.loadedViews.find(ue=>ue.name===e);if(I)return I;const oe=await this.loadViews([e]);if(oe.length>0)return this.loadedViews.push(oe[0]),oe[0];throw new TypeORMError(`View "${e}" does not exist.`)}async getCachedTable(e){if(e in this.cachedTablePaths){const oe=this.cachedTablePaths[e],ue=this.loadedTables.find(bt=>this.getTablePath(bt)===oe);if(ue)return ue}const I=await this.loadTables([e]);if(I.length>0){const oe=this.getTablePath(I[0]),ue=this.loadedTables.find(bt=>this.getTablePath(bt)===oe);return ue||(this.cachedTablePaths[e]=this.getTablePath(I[0]),this.loadedTables.push(I[0]),I[0])}else throw new TypeORMError(`Table "${e}" does not exist.`)}replaceCachedTable(e,I){const oe=this.getTablePath(e),ue=this.loadedTables.find(bt=>this.getTablePath(bt)===oe);for(const[bt,tr]of Object.entries(this.cachedTablePaths))tr===oe&&(this.cachedTablePaths[bt]=this.getTablePath(I));ue&&(ue.database=I.database,ue.schema=I.schema,ue.name=I.name,ue.columns=I.columns,ue.indices=I.indices,ue.foreignKeys=I.foreignKeys,ue.uniques=I.uniques,ue.checks=I.checks,ue.justCreated=I.justCreated,ue.engine=I.engine,ue.comment=I.comment)}getTablePath(e){const I=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(I.tableName,I.schema,I.database)}getTypeormMetadataTableName(){const e=this.connection.driver.options;return this.connection.driver.buildTableName(this.connection.metadataTableName,e.schema,e.database)}selectTypeormMetadataSql({database:e,schema:I,table:oe,type:ue,name:bt}){const tr=this.connection.createQueryBuilder(),rr=tr.select().from(this.getTypeormMetadataTableName(),"t").where(`${tr.escape("type")} = :type`,{type:ue}).andWhere(`${tr.escape("name")} = :name`,{name:bt});e&&rr.andWhere(`${tr.escape("database")} = :database`,{database:e}),I&&rr.andWhere(`${tr.escape("schema")} = :schema`,{schema:I}),oe&&rr.andWhere(`${tr.escape("table")} = :table`,{table:oe});const[ir,lr]=rr.getQueryAndParameters();return new Query(ir,lr)}insertTypeormMetadataSql({database:e,schema:I,table:oe,type:ue,name:bt,value:tr}){const[rr,ir]=this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({database:e,schema:I,table:oe,type:ue,name:bt,value:tr}).getQueryAndParameters();return new Query(rr,ir)}deleteTypeormMetadataSql({database:e,schema:I,table:oe,type:ue,name:bt}){const tr=this.connection.createQueryBuilder(),rr=tr.delete().from(this.getTypeormMetadataTableName()).where(`${tr.escape("type")} = :type`,{type:ue}).andWhere(`${tr.escape("name")} = :name`,{name:bt});e&&rr.andWhere(`${tr.escape("database")} = :database`,{database:e}),I&&rr.andWhere(`${tr.escape("schema")} = :schema`,{schema:I}),oe&&rr.andWhere(`${tr.escape("table")} = :table`,{table:oe});const[ir,lr]=rr.getQueryAndParameters();return new Query(ir,lr)}isColumnChanged(e,I,oe,ue,bt=!0){return e.charset!==I.charset||e.collation!==I.collation||e.precision!==I.precision||e.scale!==I.scale||e.width!==I.width||e.zerofill!==I.zerofill||e.unsigned!==I.unsigned||e.asExpression!==I.asExpression||oe&&e.default!==I.default||e.onUpdate!==I.onUpdate||e.isNullable!==I.isNullable||ue&&e.comment!==I.comment||bt&&this.isEnumChanged(e,I)}isEnumChanged(e,I){return!OrmUtils.isArraysEqual(e.enum||[],I.enum||[])}isDefaultColumnLength(e,I,oe){if(this.connection.hasMetadata(e.name)){const bt=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(bt&&this.connection.driver.getColumnLength(bt))return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].length?this.connection.driver.dataTypeDefaults[I.type].length.toString()===oe.toString():!1}isDefaultColumnPrecision(e,I,oe){if(this.connection.hasMetadata(e.name)){const bt=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(bt&&bt.precision!==null&&bt.precision!==void 0)return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].precision!==null&&this.connection.driver.dataTypeDefaults[I.type].precision!==void 0?this.connection.driver.dataTypeDefaults[I.type].precision===oe:!1}isDefaultColumnScale(e,I,oe){if(this.connection.hasMetadata(e.name)){const bt=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(bt&&bt.scale!==null&&bt.scale!==void 0)return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].scale!==null&&this.connection.driver.dataTypeDefaults[I.type].scale!==void 0?this.connection.driver.dataTypeDefaults[I.type].scale===oe:!1}async executeQueries(e,I){if(InstanceChecker.isQuery(e)&&(e=[e]),InstanceChecker.isQuery(I)&&(I=[I]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...I),this.sqlMemoryMode===!0)return Promise.resolve();for(const{query:oe,parameters:ue}of e)await this.query(oe,ue)}generateIndexName(e,I){return this.connection.namingStrategy.indexName(e,I.columnNames,I.where)}}var MetadataTableType;(function(ae){ae.VIEW="VIEW",ae.MATERIALIZED_VIEW="MATERIALIZED_VIEW",ae.GENERATED_COLUMN="GENERATED_COLUMN"})(MetadataTableType||(MetadataTableType={}));class AbstractSqliteQueryRunner extends BaseQueryRunner{constructor(){super(),this.transactionPromise=null}connect(){return Promise.resolve(this.driver.databaseConnection)}release(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()}async startTransaction(e){if(this.driver.transactionSupport==="none")throw new TypeORMError(`Transactions aren't supported by ${this.connection.driver.options.type}.`);if(this.isTransactionActive&&this.driver.transactionSupport==="simple")throw new TransactionAlreadyStartedError;if(e&&e!=="READ UNCOMMITTED"&&e!=="SERIALIZABLE")throw new TypeORMError("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,e&&(e==="READ UNCOMMITTED"?await this.query("PRAGMA read_uncommitted = true"):await this.query("PRAGMA read_uncommitted = false")),await this.query("BEGIN TRANSACTION")):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth-1}`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("COMMIT"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("ROLLBACK"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}stream(e,I,oe,ue){throw new TypeORMError("Stream is not supported by sqlite driver.")}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return Promise.resolve(!1)}async getCurrentDatabase(){return Promise.resolve(void 0)}async hasSchema(e){throw new TypeORMError("This driver does not support table schemas")}async getCurrentSchema(){return Promise.resolve(void 0)}async hasTable(e){const oe=`SELECT * FROM "sqlite_master" WHERE "type" = 'table' AND "name" = '${InstanceChecker.isTable(e)?e.name:e}'`;return!!(await this.query(oe)).length}async hasColumn(e,I){const oe=InstanceChecker.isTable(e)?e.name:e,ue=`PRAGMA table_xinfo(${this.escapePath(oe)})`;return!!(await this.query(ue)).find(tr=>tr.name===I)}async createDatabase(e,I){return Promise.resolve()}async dropDatabase(e,I){return Promise.resolve()}async createSchema(e,I){return Promise.resolve()}async dropSchema(e,I){return Promise.resolve()}async createTable(e,I=!1,oe=!0,ue=!0){const bt=[],tr=[];if(I&&await this.hasTable(e))return Promise.resolve();bt.push(this.createTableSql(e,oe)),tr.push(this.dropTableSql(e)),ue&&e.indices.forEach(ir=>{ir.name||(ir.name=this.connection.namingStrategy.indexName(e,ir.columnNames,ir.where)),bt.push(this.createIndexSql(e,ir)),tr.push(this.dropIndexSql(ir))});const rr=e.columns.filter(ir=>ir.generatedType&&ir.asExpression);for(const ir of rr){const lr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:ir.name,value:ir.asExpression}),dr=this.deleteTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:ir.name});bt.push(lr),tr.push(dr)}await this.executeQueries(bt,tr)}async dropTable(e,I,oe=!0,ue=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const bt=oe,tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),rr=[],ir=[];ue&&tr.indices.forEach(dr=>{rr.push(this.dropIndexSql(dr)),ir.push(this.createIndexSql(tr,dr))}),rr.push(this.dropTableSql(tr,I)),ir.push(this.createTableSql(tr,bt));const lr=tr.columns.filter(dr=>dr.generatedType&&dr.asExpression);for(const dr of lr){const pr=this.deleteTypeormMetadataSql({table:tr.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name}),hr=this.insertTypeormMetadataSql({table:tr.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name,value:dr.asExpression});rr.push(pr),ir.push(hr)}await this.executeQueries(rr,ir)}async createView(e,I=!1){const oe=[],ue=[];oe.push(this.createViewSql(e)),I&&oe.push(this.insertViewDefinitionSql(e)),ue.push(this.dropViewSql(e)),I&&ue.push(this.deleteViewDefinitionSql(e)),await this.executeQueries(oe,ue)}async dropView(e){const I=InstanceChecker.isView(e)?e.name:e,oe=await this.getCachedView(I),ue=[],bt=[];ue.push(this.deleteViewDefinitionSql(oe)),ue.push(this.dropViewSql(oe)),bt.push(this.insertViewDefinitionSql(oe)),bt.push(this.createViewSql(oe)),await this.executeQueries(ue,bt)}async renameTable(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();ue.name=I;const bt=new Query(`ALTER TABLE ${this.escapePath(oe.name)} RENAME TO ${this.escapePath(I)}`),tr=new Query(`ALTER TABLE ${this.escapePath(I)} RENAME TO ${this.escapePath(oe.name)}`);await this.executeQueries(bt,tr),ue.uniques.forEach(rr=>{const ir=this.connection.namingStrategy.uniqueConstraintName(oe,rr.columnNames);rr.name===ir&&(rr.name=this.connection.namingStrategy.uniqueConstraintName(ue,rr.columnNames))}),ue.foreignKeys.forEach(rr=>{const ir=this.connection.namingStrategy.foreignKeyName(oe,rr.columnNames,this.getTablePath(rr),rr.referencedColumnNames);rr.name===ir&&(rr.name=this.connection.namingStrategy.foreignKeyName(ue,rr.columnNames,this.getTablePath(rr),rr.referencedColumnNames))}),ue.indices.forEach(rr=>{const ir=this.connection.namingStrategy.indexName(oe,rr.columnNames,rr.where);rr.name===ir&&(rr.name=this.connection.namingStrategy.indexName(ue,rr.columnNames,rr.where))}),oe.name=ue.name,await this.recreateTable(ue,oe)}async addColumn(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);return this.addColumns(oe,[I])}async addColumns(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>ue.addColumn(bt)),await this.recreateTable(ue,oe)}async renameColumn(e,I,oe){const ue=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),bt=InstanceChecker.isTableColumn(I)?I:ue.columns.find(rr=>rr.name===I);if(!bt)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);let tr;return InstanceChecker.isTableColumn(oe)?tr=oe:(tr=bt.clone(),tr.name=oe),this.changeColumn(ue,bt,tr)}async changeColumn(e,I,oe){const ue=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),bt=InstanceChecker.isTableColumn(I)?I:ue.columns.find(tr=>tr.name===I);if(!bt)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);await this.changeColumns(ue,[{oldColumn:bt,newColumn:oe}])}async changeColumns(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>{bt.newColumn.name!==bt.oldColumn.name&&(ue.findColumnUniques(bt.oldColumn).forEach(rr=>{const ir=this.connection.namingStrategy.uniqueConstraintName(oe,rr.columnNames);rr.columnNames.splice(rr.columnNames.indexOf(bt.oldColumn.name),1),rr.columnNames.push(bt.newColumn.name),rr.name===ir&&(rr.name=this.connection.namingStrategy.uniqueConstraintName(ue,rr.columnNames))}),ue.findColumnForeignKeys(bt.oldColumn).forEach(rr=>{const ir=this.connection.namingStrategy.foreignKeyName(oe,rr.columnNames,this.getTablePath(rr),rr.referencedColumnNames);rr.columnNames.splice(rr.columnNames.indexOf(bt.oldColumn.name),1),rr.columnNames.push(bt.newColumn.name),rr.name===ir&&(rr.name=this.connection.namingStrategy.foreignKeyName(ue,rr.columnNames,this.getTablePath(rr),rr.referencedColumnNames))}),ue.findColumnIndices(bt.oldColumn).forEach(rr=>{const ir=this.connection.namingStrategy.indexName(oe,rr.columnNames,rr.where);rr.columnNames.splice(rr.columnNames.indexOf(bt.oldColumn.name),1),rr.columnNames.push(bt.newColumn.name),rr.name===ir&&(rr.name=this.connection.namingStrategy.indexName(ue,rr.columnNames,rr.where))}));const tr=ue.columns.find(rr=>rr.name===bt.oldColumn.name);tr&&(ue.columns[ue.columns.indexOf(tr)]=bt.newColumn)}),await this.recreateTable(ue,oe)}async dropColumn(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableColumn(I)?I:oe.findColumnByName(I);if(!ue)throw new TypeORMError(`Column "${I}" was not found in table "${oe.name}"`);await this.dropColumns(oe,[ue])}async dropColumns(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>{const tr=InstanceChecker.isTableColumn(bt)?bt:oe.findColumnByName(bt);if(!tr)throw new Error(`Column "${bt}" was not found in table "${oe.name}"`);ue.removeColumn(tr),ue.findColumnUniques(tr).forEach(rr=>ue.removeUniqueConstraint(rr)),ue.findColumnIndices(tr).forEach(rr=>ue.removeIndex(rr)),ue.findColumnForeignKeys(tr).forEach(rr=>ue.removeForeignKey(rr))}),await this.recreateTable(ue,oe)}async createPrimaryKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();ue.columns.forEach(bt=>{I.find(tr=>tr===bt.name)&&(bt.isPrimary=!0)}),await this.recreateTable(ue,oe),oe.columns.forEach(bt=>{I.find(tr=>tr===bt.name)&&(bt.isPrimary=!0)})}async updatePrimaryKeys(e,I){await Promise.resolve()}async dropPrimaryKey(e){const I=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),oe=I.clone();oe.primaryColumns.forEach(ue=>{ue.isPrimary=!1}),await this.recreateTable(oe,I),I.primaryColumns.forEach(ue=>{ue.isPrimary=!1})}async createUniqueConstraint(e,I){await this.createUniqueConstraints(e,[I])}async createUniqueConstraints(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>ue.addUniqueConstraint(bt)),await this.recreateTable(ue,oe)}async dropUniqueConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableUnique(I)?I:oe.uniques.find(bt=>bt.name===I);if(!ue)throw new TypeORMError(`Supplied unique constraint was not found in table ${oe.name}`);await this.dropUniqueConstraints(oe,[ue])}async dropUniqueConstraints(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>ue.removeUniqueConstraint(bt)),await this.recreateTable(ue,oe)}async createCheckConstraint(e,I){await this.createCheckConstraints(e,[I])}async createCheckConstraints(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>ue.addCheckConstraint(bt)),await this.recreateTable(ue,oe)}async dropCheckConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableCheck(I)?I:oe.checks.find(bt=>bt.name===I);if(!ue)throw new TypeORMError(`Supplied check constraint was not found in table ${oe.name}`);await this.dropCheckConstraints(oe,[ue])}async dropCheckConstraints(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>ue.removeCheckConstraint(bt)),await this.recreateTable(ue,oe)}async createExclusionConstraint(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async createExclusionConstraints(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async dropExclusionConstraint(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async dropExclusionConstraints(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async createForeignKey(e,I){await this.createForeignKeys(e,[I])}async createForeignKeys(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>ue.addForeignKey(bt)),await this.recreateTable(ue,oe)}async dropForeignKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableForeignKey(I)?I:oe.foreignKeys.find(bt=>bt.name===I);if(!ue)throw new TypeORMError(`Supplied foreign key was not found in table ${oe.name}`);await this.dropForeignKeys(e,[ue])}async dropForeignKeys(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone();I.forEach(bt=>ue.removeForeignKey(bt)),await this.recreateTable(ue,oe)}async createIndex(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(oe,I));const ue=this.createIndexSql(oe,I),bt=this.dropIndexSql(I);await this.executeQueries(ue,bt),oe.addIndex(I)}async createIndices(e,I){const oe=I.map(ue=>this.createIndex(e,ue));await Promise.all(oe)}async dropIndex(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableIndex(I)?I:oe.indices.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied index ${I} was not found in table ${oe.name}`);ue.name||(ue.name=this.generateIndexName(oe,ue));const bt=this.dropIndexSql(ue),tr=this.createIndexSql(oe,ue);await this.executeQueries(bt,tr),oe.removeIndex(ue)}async dropIndices(e,I){const oe=I.map(ue=>this.dropIndex(e,ue));await Promise.all(oe)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)}`)}async clearDatabase(e){let I;e&&this.driver.getAttachedDatabaseHandleByRelativePath(e)&&(I=this.driver.getAttachedDatabaseHandleByRelativePath(e)),await this.query("PRAGMA foreign_keys = OFF");const oe=this.isTransactionActive;oe||await this.startTransaction();try{const ue=I?`SELECT 'DROP VIEW "${I}"."' || name || '";' as query FROM "${I}"."sqlite_master" WHERE "type" = 'view'`:`SELECT 'DROP VIEW "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'view'`,bt=await this.query(ue);await Promise.all(bt.map(ir=>this.query(ir.query)));const tr=I?`SELECT 'DROP TABLE "${I}"."' || name || '";' as query FROM "${I}"."sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`:`SELECT 'DROP TABLE "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`,rr=await this.query(tr);await Promise.all(rr.map(ir=>this.query(ir.query))),oe||await this.commitTransaction()}catch(ue){try{oe||await this.rollbackTransaction()}catch{}throw ue}finally{await this.query("PRAGMA foreign_keys = ON")}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const oe=e.map(tr=>"'"+tr+"'").join(", ");let ue=`SELECT "t".* FROM "${this.getTypeormMetadataTableName()}" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = 'view' WHERE "t"."type" = '${MetadataTableType.VIEW}'`;return oe.length>0&&(ue+=` AND "t"."name" IN (${oe})`),(await this.query(ue)).map(tr=>{const rr=new View;return rr.name=tr.name,rr.expression=tr.value,rr})}async loadTableRecords(e,I){let oe;const[ue,bt]=this.splitTablePath(e);return ue&&this.driver.getAttachedDatabasePathRelativeByHandle(ue)&&(oe=this.driver.getAttachedDatabasePathRelativeByHandle(ue)),this.query(`SELECT ${oe?`'${oe}'`:null} as database, ${ue?`'${ue}'`:null} as schema, * FROM ${ue?`"${ue}".`:""}${this.escapePath("sqlite_master")} WHERE "type" = '${I}' AND "${I==="table"?"name":"tbl_name"}" IN ('${bt}')`)}async loadPragmaRecords(e,I){const[,oe]=this.splitTablePath(e);return this.query(`PRAGMA ${I}("${oe}")`)}async loadTables(e){if(e&&e.length===0)return[];let I=[],oe;if(e){const ue=e.filter(rr=>rr.split(".").length===1).map(rr=>`'${rr}'`),bt=e.filter(rr=>rr.split(".").length>1),tr=rr=>{const ir=[...bt.map(lr=>this.loadTableRecords(lr,rr))];return ue.length&&ir.push(this.query(`SELECT * FROM "sqlite_master" WHERE "type" = '${rr}' AND "${rr==="table"?"name":"tbl_name"}" IN (${ue})`)),ir};I=(await Promise.all(tr("table"))).reduce((rr,ir)=>[...rr,...ir],[]).filter(Boolean),oe=(await Promise.all(tr("index"))).reduce((rr,ir)=>[...rr,...ir],[]).filter(Boolean)}else{I.push(...await this.query(`SELECT * FROM "sqlite_master" WHERE "type" = 'table'`));const bt=I.map(({name:tr})=>`'${tr}'`).join(", ");oe=await this.query(`SELECT * FROM "sqlite_master" WHERE "type" = 'index' AND "tbl_name" IN (${bt})`)}return I.length===0?[]:Promise.all(I.map(async ue=>{const bt=ue.database&&this.driver.getAttachedDatabaseHandleByRelativePath(ue.database)?`${this.driver.getAttachedDatabaseHandleByRelativePath(ue.database)}.${ue.name}`:ue.name,tr=ue.sql,rr=tr.includes("WITHOUT ROWID"),ir=new Table({name:bt,withoutRowid:rr}),[lr,dr,pr]=await Promise.all([this.loadPragmaRecords(bt,"table_xinfo"),this.loadPragmaRecords(bt,"index_list"),this.loadPragmaRecords(bt,"foreign_key_list")]);let hr;const _r=ue.sql;let yr=_r.toUpperCase().indexOf("AUTOINCREMENT");if(yr!==-1){hr=_r.substr(0,yr);const Nr=hr.lastIndexOf(","),zr=hr.lastIndexOf("(");Nr!==-1?(hr=hr.substr(Nr),hr=hr.substr(0,hr.lastIndexOf('"')),hr=hr.substr(hr.indexOf('"')+1)):zr!==-1&&(hr=hr.substr(zr),hr=hr.substr(0,hr.lastIndexOf('"')),hr=hr.substr(hr.indexOf('"')+1))}ir.columns=await Promise.all(lr.map(async Nr=>{const zr=new TableColumn;if(zr.name=Nr.name,zr.type=Nr.type.toLowerCase(),zr.default=Nr.dflt_value!==null&&Nr.dflt_value!==void 0?Nr.dflt_value:void 0,zr.isNullable=Nr.notnull===0,zr.isPrimary=Nr.pk>0,zr.comment="",zr.isGenerated=hr===Nr.name,zr.isGenerated&&(zr.generationStrategy="increment"),Nr.hidden===2||Nr.hidden===3){zr.generatedType=Nr.hidden===2?"VIRTUAL":"STORED";const Or=this.selectTypeormMetadataSql({table:ir.name,type:MetadataTableType.GENERATED_COLUMN,name:zr.name}),Dr=await this.query(Or.query,Or.parameters);Dr[0]&&Dr[0].value?zr.asExpression=Dr[0].value:zr.asExpression=""}zr.type==="varchar"&&(zr.enum=OrmUtils.parseSqlCheckExpression(tr,zr.name));let Ir=zr.type.indexOf("(");if(Ir!==-1){const Or=zr.type;let Dr=Or.substr(0,Ir);if(this.driver.withLengthColumnTypes.find(Ur=>Ur===Dr)){let Ur=parseInt(Or.substring(Ir+1,Or.length-1));Ur&&(zr.length=Ur.toString(),zr.type=Dr)}if(this.driver.withPrecisionColumnTypes.find(Ur=>Ur===Dr)){const Ur=new RegExp(`^${Dr}\\((\\d+),?\\s?(\\d+)?\\)`),kr=Or.match(Ur);kr&&kr[1]&&(zr.precision=+kr[1]),this.driver.withScaleColumnTypes.find(Qr=>Qr===Dr)&&kr&&kr[2]&&(zr.scale=+kr[2]),zr.type=Dr}}return zr}));let wr;const Tr=[],Ar=/CONSTRAINT "([^"]*)" FOREIGN KEY ?\((.*?)\) REFERENCES "([^"]*)"/g;for(;(wr=Ar.exec(tr))!==null;)Tr.push({name:wr[1],columns:wr[2].substr(1,wr[2].length-2).split('", "'),referencedTableName:wr[3]});const Sr=OrmUtils.uniq(pr,Nr=>Nr.id);ir.foreignKeys=Sr.map(Nr=>{const zr=pr.filter(Ur=>Ur.id===Nr.id&&Ur.table===Nr.table),Ir=zr.map(Ur=>Ur.from),Or=zr.map(Ur=>Ur.to),Dr=Tr.find(Ur=>Ur.referencedTableName===Nr.table&&Ur.columns.every(kr=>Ir.indexOf(kr)!==-1));return new TableForeignKey({name:Dr?.name,columnNames:Ir,referencedTableName:Nr.table,referencedColumnNames:Or,onDelete:Nr.on_delete,onUpdate:Nr.on_update})});let Mr;const vr=[],Lr=/CONSTRAINT "([^"]*)" UNIQUE ?\((.*?)\)/g;for(;(Mr=Lr.exec(tr))!==null;)vr.push({name:Mr[1],columns:Mr[2].substr(1,Mr[2].length-2).split('", "')});const es=dr.filter(Nr=>Nr.origin==="u").map(Nr=>Nr.name).filter((Nr,zr,Ir)=>Ir.indexOf(Nr)===zr).map(async Nr=>{const zr=dr.find(Ur=>Ur.name===Nr),Or=(await this.query(`PRAGMA index_info("${zr.name}")`)).sort((Ur,kr)=>parseInt(Ur.seqno)-parseInt(kr.seqno)).map(Ur=>Ur.name);if(Or.length===1){const Ur=ir.columns.find(kr=>!!Or.find(Qr=>Qr===kr.name));Ur&&(Ur.isUnique=!0)}const Dr=vr.find(Ur=>Ur.columns.every(kr=>Or.indexOf(kr)!==-1));return new TableUnique({name:Dr?Dr.name:this.connection.namingStrategy.uniqueConstraintName(ir,Or),columnNames:Or})});ir.uniques=await Promise.all(es);let ss;const os=/CONSTRAINT "([^"]*)" CHECK ?(\(.*?\))([,]|[)]$)/g;for(;(ss=os.exec(tr))!==null;)ir.checks.push(new TableCheck({name:ss[1],expression:ss[2]}));const $r=dr.filter(Nr=>Nr.origin==="c").map(Nr=>Nr.name).filter((Nr,zr,Ir)=>Ir.indexOf(Nr)===zr).map(async Nr=>{const zr=oe.find(is=>is.name===Nr),Ir=/WHERE (.*)/.exec(zr.sql),Or=dr.find(is=>is.name===Nr),Ur=(await this.query(`PRAGMA index_info("${Or.name}")`)).sort((is,cs)=>parseInt(is.seqno)-parseInt(cs.seqno)).map(is=>is.name),kr=`${ue.database?`${ue.database}.`:""}${Or.name}`,Qr=Or.unique==="1"||Or.unique===1;return new TableIndex({table:ir,name:kr,columnNames:Ur,isUnique:Qr,where:Ir?Ir[1]:void 0})}),ns=await Promise.all($r);return ir.indices=ns.filter(Nr=>!!Nr),ir}))}createTableSql(e,I,oe){const ue=e.columns.filter(_r=>_r.isPrimary),bt=ue.find(_r=>_r.isGenerated&&_r.generationStrategy==="increment"),tr=ue.length>1;if(tr&&bt)throw new TypeORMError("Sqlite does not support AUTOINCREMENT on composite primary key");const rr=e.columns.map(_r=>this.buildCreateColumnSql(_r,tr)).join(", "),[ir]=this.splitTablePath(e.name);let lr=`CREATE TABLE ${this.escapePath(e.name)} (${rr}`,[dr,pr]=this.splitTablePath(e.name);const hr=oe?`${dr?`${dr}.`:""}${pr.replace(/^temporary_/,"")}`:e.name;if(e.columns.filter(_r=>_r.isUnique).forEach(_r=>{e.uniques.some(wr=>wr.columnNames.length===1&&wr.columnNames[0]===_r.name)||e.uniques.push(new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(e,[_r.name]),columnNames:[_r.name]}))}),e.uniques.length>0){const _r=e.uniques.map(yr=>{const wr=yr.name?yr.name:this.connection.namingStrategy.uniqueConstraintName(hr,yr.columnNames),Tr=yr.columnNames.map(Ar=>`"${Ar}"`).join(", ");return`CONSTRAINT "${wr}" UNIQUE (${Tr})`}).join(", ");lr+=`, ${_r}`}if(e.checks.length>0){const _r=e.checks.map(yr=>`CONSTRAINT "${yr.name?yr.name:this.connection.namingStrategy.checkConstraintName(hr,yr.expression)}" CHECK (${yr.expression})`).join(", ");lr+=`, ${_r}`}if(e.foreignKeys.length>0&&I){const _r=e.foreignKeys.filter(yr=>{const[wr]=this.splitTablePath(yr.referencedTableName);return wr===ir}).map(yr=>{const[,wr]=this.splitTablePath(yr.referencedTableName),Tr=yr.columnNames.map(Mr=>`"${Mr}"`).join(", ");yr.name||(yr.name=this.connection.namingStrategy.foreignKeyName(hr,yr.columnNames,this.getTablePath(yr),yr.referencedColumnNames));const Ar=yr.referencedColumnNames.map(Mr=>`"${Mr}"`).join(", ");let Sr=`CONSTRAINT "${yr.name}" FOREIGN KEY (${Tr}) REFERENCES "${wr}" (${Ar})`;return yr.onDelete&&(Sr+=` ON DELETE ${yr.onDelete}`),yr.onUpdate&&(Sr+=` ON UPDATE ${yr.onUpdate}`),yr.deferrable&&(Sr+=` DEFERRABLE ${yr.deferrable}`),Sr}).join(", ");lr+=`, ${_r}`}if(ue.length>1){const _r=ue.map(yr=>`"${yr.name}"`).join(", ");lr+=`, PRIMARY KEY (${_r})`}return lr+=")",e.withoutRowid&&(lr+=" WITHOUT ROWID"),new Query(lr)}dropTableSql(e,I){const oe=InstanceChecker.isTable(e)?e.name:e,ue=I?`DROP TABLE IF EXISTS ${this.escapePath(oe)}`:`DROP TABLE ${this.escapePath(oe)}`;return new Query(ue)}createViewSql(e){return typeof e.expression=="string"?new Query(`CREATE VIEW "${e.name}" AS ${e.expression}`):new Query(`CREATE VIEW "${e.name}" AS ${e.expression(this.connection).getQuery()}`)}insertViewDefinitionSql(e){const I=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:MetadataTableType.VIEW,name:e.name,value:I})}dropViewSql(e){const I=InstanceChecker.isView(e)?e.name:e;return new Query(`DROP VIEW "${I}"`)}deleteViewDefinitionSql(e){const I=InstanceChecker.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:MetadataTableType.VIEW,name:I})}createIndexSql(e,I){const oe=I.columnNames.map(tr=>`"${tr}"`).join(", "),[ue,bt]=this.splitTablePath(e.name);return new Query(`CREATE ${I.isUnique?"UNIQUE ":""}INDEX ${ue?`"${ue}".`:""}${this.escapePath(I.name)} ON "${bt}" (${oe}) ${I.where?"WHERE "+I.where:""}`)}dropIndexSql(e){let I=InstanceChecker.isTableIndex(e)?e.name:e;return new Query(`DROP INDEX ${this.escapePath(I)}`)}buildCreateColumnSql(e,I){let oe='"'+e.name+'"';return InstanceChecker.isColumnMetadata(e)?oe+=" "+this.driver.normalizeType(e):oe+=" "+this.connection.driver.createFullType(e),e.enum&&(oe+=' CHECK( "'+e.name+'" IN ('+e.enum.map(ue=>"'"+ue+"'").join(",")+") )"),e.isPrimary&&!I&&(oe+=" PRIMARY KEY"),e.isGenerated===!0&&e.generationStrategy==="increment"&&(oe+=" AUTOINCREMENT"),e.collation&&(oe+=" COLLATE "+e.collation),e.isNullable!==!0&&(oe+=" NOT NULL"),e.asExpression?oe+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`:e.default!==void 0&&e.default!==null&&(oe+=" DEFAULT ("+e.default+")"),oe}async recreateTable(e,I,oe=!0){const ue=[],bt=[];I.indices.forEach(lr=>{ue.push(this.dropIndexSql(lr)),bt.push(this.createIndexSql(I,lr))});let[tr,rr]=this.splitTablePath(e.name),[,ir]=this.splitTablePath(I.name);if(e.name=rr=`${tr?`${tr}.`:""}temporary_${rr}`,ue.push(this.createTableSql(e,!0,!0)),bt.push(this.dropTableSql(e)),oe){let lr=e.columns.filter(pr=>!pr.generatedType).map(pr=>`"${pr.name}"`),dr=I.columns.filter(pr=>!pr.generatedType).map(pr=>`"${pr.name}"`);dr.length<lr.length?lr=e.columns.filter(pr=>{const hr=I.columns.find(_r=>_r.name===pr.name);return hr&&hr.generatedType?!1:!pr.generatedType&&hr}).map(pr=>`"${pr.name}"`):dr.length>lr.length&&(dr=I.columns.filter(pr=>!pr.generatedType&&e.columns.find(hr=>hr.name===pr.name)).map(pr=>`"${pr.name}"`)),ue.push(new Query(`INSERT INTO ${this.escapePath(e.name)}(${lr.join(", ")}) SELECT ${dr.join(", ")} FROM ${this.escapePath(I.name)}`)),bt.push(new Query(`INSERT INTO ${this.escapePath(I.name)}(${dr.join(", ")}) SELECT ${lr.join(", ")} FROM ${this.escapePath(e.name)}`))}ue.push(this.dropTableSql(I)),bt.push(this.createTableSql(I,!0)),ue.push(new Query(`ALTER TABLE ${this.escapePath(e.name)} RENAME TO ${this.escapePath(ir)}`)),bt.push(new Query(`ALTER TABLE ${this.escapePath(I.name)} RENAME TO ${this.escapePath(rr)}`)),e.name=I.name,e.indices.forEach(lr=>{lr.name||(lr.name=this.connection.namingStrategy.indexName(e,lr.columnNames,lr.where)),ue.push(this.createIndexSql(e,lr)),bt.push(this.dropIndexSql(lr))}),I.columns.filter(lr=>{const dr=e.columns.find(pr=>pr.name===lr.name);return lr.generatedType&&lr.asExpression&&(!dr||!dr.generatedType&&!dr.asExpression)}).forEach(lr=>{const dr=this.deleteTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:lr.name}),pr=this.insertTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:lr.name,value:lr.asExpression});ue.push(dr),bt.push(pr)}),e.columns.filter(lr=>lr.generatedType&&lr.asExpression&&!I.columns.some(dr=>dr.name===lr.name)).forEach(lr=>{const dr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:lr.name,value:lr.asExpression}),pr=this.deleteTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:lr.name});ue.push(dr),bt.push(pr)}),e.columns.filter(lr=>lr.generatedType&&lr.asExpression).forEach(lr=>{const dr=I.columns.find(wr=>wr.name===lr.name&&wr.generatedType&&lr.generatedType&&wr.asExpression!==lr.asExpression);if(!dr)return;const pr=this.deleteTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name}),hr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:lr.name,value:lr.asExpression});ue.push(pr),ue.push(hr);const _r=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name,value:dr.asExpression}),yr=this.deleteTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:lr.name});bt.push(_r),bt.push(yr)}),await this.executeQueries(ue,bt),this.replaceCachedTable(I,e)}splitTablePath(e){return e.indexOf(".")!==-1?e.split("."):[void 0,e]}escapePath(e,I){return(InstanceChecker.isTable(e)||InstanceChecker.isView(e)?e.name:e).replace(/^\.+|\.+$/g,"").split(".").map(ue=>I?ue:`"${ue}"`).join(".")}changeTableComment(e,I){throw new TypeORMError("sqlit driver does not support change comment.")}}class Broadcaster{constructor(e){this.queryRunner=e}async broadcast(e,...I){const oe=new BroadcasterResult,ue=this[`broadcast${e}Event`];typeof ue=="function"&&ue.call(this,oe,...I),await oe.wait()}broadcastBeforeInsertEvent(e,I,oe){oe&&I.beforeInsertListeners.length&&I.beforeInsertListeners.forEach(ue=>{if(ue.isAllowed(oe)){const bt=ue.execute(oe);bt instanceof Promise&&e.promises.push(bt),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ue=>{if(this.isAllowedSubscriber(ue,I.target)&&ue.beforeInsert){const bt=ue.beforeInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I});bt instanceof Promise&&e.promises.push(bt),e.count++}})}broadcastBeforeUpdateEvent(e,I,oe,ue,bt,tr){oe&&I.beforeUpdateListeners.length&&I.beforeUpdateListeners.forEach(rr=>{if(rr.isAllowed(oe)){const ir=rr.execute(oe);ir instanceof Promise&&e.promises.push(ir),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(rr=>{if(this.isAllowedSubscriber(rr,I.target)&&rr.beforeUpdate){const ir=rr.beforeUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,updatedColumns:bt||[],updatedRelations:tr||[]});ir instanceof Promise&&e.promises.push(ir),e.count++}})}broadcastBeforeRemoveEvent(e,I,oe,ue,bt){oe&&I.beforeRemoveListeners.length&&I.beforeRemoveListeners.forEach(tr=>{if(tr.isAllowed(oe)){const rr=tr.execute(oe);rr instanceof Promise&&e.promises.push(rr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(this.isAllowedSubscriber(tr,I.target)&&tr.beforeRemove){const rr=tr.beforeRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,entityId:I.getEntityIdMixedMap(ue??bt)});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastBeforeSoftRemoveEvent(e,I,oe,ue,bt){oe&&I.beforeSoftRemoveListeners.length&&I.beforeSoftRemoveListeners.forEach(tr=>{if(tr.isAllowed(oe)){const rr=tr.execute(oe);rr instanceof Promise&&e.promises.push(rr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(this.isAllowedSubscriber(tr,I.target)&&tr.beforeSoftRemove){const rr=tr.beforeSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,entityId:I.getEntityIdMixedMap(ue??bt)});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastBeforeRecoverEvent(e,I,oe,ue,bt){oe&&I.beforeRecoverListeners.length&&I.beforeRecoverListeners.forEach(tr=>{if(tr.isAllowed(oe)){const rr=tr.execute(oe);rr instanceof Promise&&e.promises.push(rr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(this.isAllowedSubscriber(tr,I.target)&&tr.beforeRecover){const rr=tr.beforeRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,entityId:I.getEntityIdMixedMap(ue??bt)});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastAfterInsertEvent(e,I,oe,ue){oe&&I.afterInsertListeners.length&&I.afterInsertListeners.forEach(bt=>{if(bt.isAllowed(oe)){const tr=bt.execute(oe);tr instanceof Promise&&e.promises.push(tr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(bt=>{if(this.isAllowedSubscriber(bt,I.target)&&bt.afterInsert){const tr=bt.afterInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,entityId:I.getEntityIdMixedMap(ue)});tr instanceof Promise&&e.promises.push(tr),e.count++}})}broadcastBeforeQueryEvent(e,I,oe){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ue=>{if(ue.beforeQuery){const bt=ue.beforeQuery({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,query:I,parameters:oe});bt instanceof Promise&&e.promises.push(bt),e.count++}})}broadcastAfterQueryEvent(e,I,oe,ue,bt,tr,rr){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ir=>{if(ir.afterQuery){const lr=ir.afterQuery({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,query:I,parameters:oe,success:ue,executionTime:bt,rawResults:tr,error:rr});lr instanceof Promise&&e.promises.push(lr),e.count++}})}broadcastBeforeTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.beforeTransactionStart){const oe=I.beforeTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});oe instanceof Promise&&e.promises.push(oe),e.count++}})}broadcastAfterTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.afterTransactionStart){const oe=I.afterTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});oe instanceof Promise&&e.promises.push(oe),e.count++}})}broadcastBeforeTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.beforeTransactionCommit){const oe=I.beforeTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});oe instanceof Promise&&e.promises.push(oe),e.count++}})}broadcastAfterTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.afterTransactionCommit){const oe=I.afterTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});oe instanceof Promise&&e.promises.push(oe),e.count++}})}broadcastBeforeTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.beforeTransactionRollback){const oe=I.beforeTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});oe instanceof Promise&&e.promises.push(oe),e.count++}})}broadcastAfterTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.afterTransactionRollback){const oe=I.afterTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});oe instanceof Promise&&e.promises.push(oe),e.count++}})}broadcastAfterUpdateEvent(e,I,oe,ue,bt,tr){oe&&I.afterUpdateListeners.length&&I.afterUpdateListeners.forEach(rr=>{if(rr.isAllowed(oe)){const ir=rr.execute(oe);ir instanceof Promise&&e.promises.push(ir),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(rr=>{if(this.isAllowedSubscriber(rr,I.target)&&rr.afterUpdate){const ir=rr.afterUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,updatedColumns:bt||[],updatedRelations:tr||[]});ir instanceof Promise&&e.promises.push(ir),e.count++}})}broadcastAfterRemoveEvent(e,I,oe,ue,bt){oe&&I.afterRemoveListeners.length&&I.afterRemoveListeners.forEach(tr=>{if(tr.isAllowed(oe)){const rr=tr.execute(oe);rr instanceof Promise&&e.promises.push(rr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(this.isAllowedSubscriber(tr,I.target)&&tr.afterRemove){const rr=tr.afterRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,entityId:I.getEntityIdMixedMap(ue??bt)});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastAfterSoftRemoveEvent(e,I,oe,ue,bt){oe&&I.afterSoftRemoveListeners.length&&I.afterSoftRemoveListeners.forEach(tr=>{if(tr.isAllowed(oe)){const rr=tr.execute(oe);rr instanceof Promise&&e.promises.push(rr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(this.isAllowedSubscriber(tr,I.target)&&tr.afterSoftRemove){const rr=tr.afterSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,entityId:I.getEntityIdMixedMap(ue??bt)});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastAfterRecoverEvent(e,I,oe,ue,bt){oe&&I.afterRecoverListeners.length&&I.afterRecoverListeners.forEach(tr=>{if(tr.isAllowed(oe)){const rr=tr.execute(oe);rr instanceof Promise&&e.promises.push(rr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(this.isAllowedSubscriber(tr,I.target)&&tr.afterRecover){const rr=tr.afterRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:oe,metadata:I,databaseEntity:ue,entityId:I.getEntityIdMixedMap(ue??bt)});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastLoadEventsForAll(e,I,oe){return this.broadcastLoadEvent(e,I,oe)}broadcastLoadEvent(e,I,oe){const ue=this.queryRunner.connection.subscribers.filter(bt=>this.isAllowedSubscriber(bt,I.target)&&bt.afterLoad);if(I.relations.length||I.afterLoadListeners.length||ue.length){const bt=oe.filter(tr=>!(tr instanceof Promise));I.relations.length&&I.relations.forEach(tr=>{bt.forEach(rr=>{if(tr.isLazy&&!rr.hasOwnProperty(tr.propertyName))return;const ir=tr.getEntityValue(rr);ObjectUtils.isObject(ir)&&this.broadcastLoadEvent(e,tr.inverseEntityMetadata,Array.isArray(ir)?ir:[ir])})}),I.afterLoadListeners.length&&I.afterLoadListeners.forEach(tr=>{bt.forEach(rr=>{if(tr.isAllowed(rr)){const ir=tr.execute(rr);ir instanceof Promise&&e.promises.push(ir),e.count++}})}),ue.forEach(tr=>{bt.forEach(rr=>{const ir=tr.afterLoad(rr,{entity:rr,metadata:I,connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});ir instanceof Promise&&e.promises.push(ir),e.count++})})}}isAllowedSubscriber(e,I){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===I||e.listenTo().isPrototypeOf(I)}}class QueryResult{constructor(){this.records=[]}}class CordovaQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=await this.connect(),bt=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(bt,e,I);const tr=+new Date;try{const rr=await new Promise(async(hr,_r)=>{ue.executeSql(e,I,yr=>hr(yr),yr=>_r(yr))}),ir=this.driver.options.maxQueryExecutionTime,dr=+new Date-tr;this.broadcaster.broadcastAfterQueryEvent(bt,e,I,!0,dr,rr,void 0),ir&&dr>ir&&this.driver.connection.logger.logQuerySlow(dr,e,I,this);const pr=new QueryResult;if(e.substr(0,11)==="INSERT INTO")pr.raw=rr.insertId;else{let hr=[];for(let _r=0;_r<rr.rows.length;_r++)hr.push(rr.rows.item(_r));pr.records=hr,pr.raw=hr}return oe?pr:pr.raw}catch(rr){throw this.driver.connection.logger.logQueryError(rr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(bt,e,I,!1,void 0,void 0,rr),new QueryFailedError(e,I,rr)}finally{await bt.wait()}}async startTransaction(){throw new TypeORMError("Transactions are not supported by the Cordova driver")}async commitTransaction(){throw new TypeORMError("Transactions are not supported by the Cordova driver")}async rollbackTransaction(){throw new TypeORMError("Transactions are not supported by the Cordova driver")}async clearDatabase(){await this.query("PRAGMA foreign_keys = OFF");try{const I=await this.query(`SELECT 'DROP VIEW "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'view'`),ue=await this.query(`SELECT 'DROP TABLE "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`);await Promise.all(I.map(bt=>this.query(bt.query))),await Promise.all(ue.map(bt=>this.query(bt.query)))}finally{await this.query("PRAGMA foreign_keys = ON")}}parametrize(e,I=0){return Object.keys(e).map((oe,ue)=>`"${oe}"=?`)}}class CordovaDriver extends AbstractSqliteDriver{constructor(e){super(e),this.transactionSupport="none",this.database=this.options.database,this.loadDependencies()}async disconnect(){return this.queryRunner=void 0,new Promise((e,I)=>{this.databaseConnection.close(e,I)})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new CordovaQueryRunner(this)),this.queryRunner}async createDatabaseConnection(){const e=Object.assign({},{name:this.options.database,location:this.options.location},this.options.extra||{}),I=await new Promise((oe,ue)=>{this.sqlite.openDatabase(e,bt=>oe(bt),bt=>ue(bt))});return await new Promise((oe,ue)=>{I.executeSql("PRAGMA foreign_keys = ON",[],()=>oe(),bt=>ue(bt))}),I}loadDependencies(){try{const e=this.options.driver||window.sqlitePlugin;this.sqlite=e}catch{throw new DriverPackageNotInstalledError("Cordova-SQLite","cordova-sqlite-storage")}}}class ReactNativeQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return new Promise(async(ue,bt)=>{const tr=await this.connect(),rr=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(rr,e,I);const ir=+new Date;tr.executeSql(e,I,async lr=>{const dr=this.driver.options.maxQueryExecutionTime,hr=+new Date-ir;this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!0,hr,lr,void 0),dr&&hr>dr&&this.driver.connection.logger.logQuerySlow(hr,e,I,this),rr.promises.length>0&&await Promise.all(rr.promises);const _r=new QueryResult;if(lr?.hasOwnProperty("rowsAffected")&&(_r.affected=lr.rowsAffected),lr?.hasOwnProperty("rows")){let yr=[];for(let wr=0;wr<lr.rows.length;wr++)yr.push(lr.rows.item(wr));_r.raw=yr,_r.records=yr}e.substr(0,11)==="INSERT INTO"&&(_r.raw=lr.insertId),ue(oe?_r:_r.raw)},async lr=>{this.driver.connection.logger.logQueryError(lr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!1,void 0,void 0,lr),await rr.wait(),bt(new QueryFailedError(e,I,lr))})})}parametrize(e,I=0){return Object.keys(e).map((oe,ue)=>`"${oe}"=?`)}}class ReactNativeDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.supportedUpsertTypes=["on-conflict-do-update"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.cteCapabilities={enabled:!0,requiresRecursiveHint:!0},this.attachedDatabases={},this.connection=e,this.options=e.options,this.database=this.options.database,this.loadDependencies()}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new ReactNativeQueryRunner(this)),this.queryRunner}async connect(){this.databaseConnection=await this.createDatabaseConnection()}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise((e,I)=>{this.queryRunner=void 0,this.databaseConnection.close(e,I)})}hasAttachedDatabases(){return!!Object.keys(this.attachedDatabases).length}getAttachedDatabaseHandleByRelativePath(e){return this.attachedDatabases?.[e]?.attachHandle}getAttachedDatabasePathRelativeByHandle(e){return Object.values(this.attachedDatabases).find(({attachHandle:I})=>e===I)?.attachFilepathRelative}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null?e:I.type===Boolean||I.type==="boolean"?e===!0?1:0:I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="time"?DateUtils.mixedDateToTimeString(e):I.type==="datetime"||I.type===Date?DateUtils.mixedDateToUtcDatetimeString(e):I.type==="simple-array"?DateUtils.simpleArrayToString(e):I.type==="simple-json"?DateUtils.simpleJsonToString(e):I.type==="simple-enum"?DateUtils.simpleEnumToString(e):e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:(I.type===Boolean||I.type==="boolean"?e=!!e:I.type==="datetime"||I.type===Date?(e&&typeof e=="string"&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=DateUtils.normalizeHydratedDate(e)):I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="time"?e=DateUtils.mixedTimeToString(e):I.type==="simple-array"?e=DateUtils.stringToSimpleArray(e):I.type==="simple-json"?e=DateUtils.stringToSimpleJson(e):I.type==="simple-enum"?e=DateUtils.stringToSimpleEnum(e,I):I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}escapeQueryWithParameters(e,I,oe){const ue=Object.keys(oe).map(bt=>typeof oe[bt]=="boolean"?oe[bt]===!0?1:0:oe[bt]instanceof Date?DateUtils.mixedDateToUtcDatetimeString(oe[bt]):oe[bt]);return!I||!Object.keys(I).length?[e,ue]:(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(bt,tr,rr)=>{if(!I.hasOwnProperty(rr))return bt;let ir=I[rr];return tr?ir.map(lr=>(ue.push(lr),this.createParameter(rr,ue.length-1))).join(", "):typeof ir=="function"?ir():typeof ir=="number"?String(ir):typeof ir=="boolean"?(ue.push(+ir),this.createParameter(rr,ue.length-1)):ir instanceof Date?(ue.push(DateUtils.mixedDateToUtcDatetimeString(ir)),this.createParameter(rr,ue.length-1)):(ue.push(ir),this.createParameter(rr,ue.length-1))}),[e,ue])}escape(e){return'"'+e+'"'}buildTableName(e,I,oe){return e}parseTableName(e){const I=this.database,oe=void 0;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const bt=this.parseTableName(e.schema?`"${e.schema}"."${e.name}"`:e.name);return{database:e.database||bt.database||I,schema:e.schema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isTableForeignKey(e)){const bt=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||bt.database||I,schema:e.referencedSchema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||oe,tableName:e.tableName};const ue=e.split(".");return ue.length===3?{database:ue[0]||I,schema:ue[1]||oe,tableName:ue[2]}:ue.length===2?{database:this.getAttachedDatabasePathRelativeByHandle(ue[0])??I,schema:ue[0],tableName:ue[1]}:{database:I,schema:oe,tableName:e}}normalizeType(e){return e.type===Number||e.type==="int"?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":e.type==="uuid"?"varchar":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"varchar":e.type||""}normalizeDefault(e){const I=e.default;if(typeof I=="number")return""+I;if(typeof I=="boolean")return I?"1":"0";if(typeof I=="function")return I();if(typeof I=="string")return`'${I}'`;if(I!=null)return`${I}`}normalizeIsUnique(e){return e.entityMetadata.uniques.some(I=>I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let I=e.type;return e.enum?"varchar":(e.length?I+="("+e.length+")":e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+="("+e.precision+","+e.scale+")":e.precision!==null&&e.precision!==void 0&&(I+="("+e.precision+")"),e.isArray&&(I+=" array"),I)}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,I,oe,ue){const bt=e.generatedColumns.reduce((tr,rr)=>{let ir;return rr.generationStrategy==="increment"&&I&&(ir=I-ue+oe+1),ir?OrmUtils.mergeDeep(tr,rr.createValueMap(ir)):tr},{});return Object.keys(bt).length>0?bt:void 0}findChangedColumns(e,I){return I.filter(oe=>{const ue=e.find(tr=>tr.name===oe.databaseName);return ue?ue.name!==oe.databaseName||ue.type!==this.normalizeType(oe)||ue.length!==oe.length||ue.precision!==oe.precision||ue.scale!==oe.scale||this.normalizeDefault(oe)!==ue.default||ue.isPrimary!==oe.isPrimary||ue.isNullable!==oe.isNullable||ue.generatedType!==oe.generatedType||ue.asExpression!==oe.asExpression||ue.isUnique!==this.normalizeIsUnique(oe)||ue.enum&&oe.enum&&!OrmUtils.isArraysEqual(ue.enum,oe.enum.map(tr=>tr+""))||oe.generationStrategy!=="uuid"&&ue.isGenerated!==oe.isGenerated:!1})}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,I){return"?"}createDatabaseConnection(){return new Promise((e,I)=>{const oe=Object.assign({},{name:this.options.database,location:this.options.location},this.options.extra||{});this.sqlite.openDatabase(oe,ue=>{const bt=ue;bt.executeSql("PRAGMA foreign_keys = ON",[],tr=>{e(bt)},tr=>{I(tr)})},ue=>{I(ue)})})}loadDependencies(){try{const e=this.options.driver||require("react-native-sqlite-storage");this.sqlite=e}catch{throw new DriverPackageNotInstalledError("React-Native","react-native-sqlite-storage")}}}class NativescriptQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=this.driver.connection;return new Promise(async(bt,tr)=>{const rr=await this.connect(),ir=e.substr(0,11)==="INSERT INTO";ue.logger.logQuery(e,I,this);const lr=(pr,hr)=>{const _r=this.driver.options.maxQueryExecutionTime,wr=+new Date-dr;_r&&wr>_r&&ue.logger.logQuerySlow(wr,e,I,this),pr&&(ue.logger.logQueryError(pr,e,I,this),tr(new QueryFailedError(e,I,pr)));const Tr=new QueryResult;Tr.raw=hr,!ir&&Array.isArray(hr)&&(Tr.records=hr),bt(oe?Tr:Tr.raw)},dr=+new Date;ir?rr.execSQL(e,I,lr):rr.all(e,I,lr)})}parametrize(e,I=0){return Object.keys(e).map((oe,ue)=>`"${oe}"=?`)}}class NativescriptDriver extends AbstractSqliteDriver{constructor(e){super(e),this.connection=e,this.options=e.options,this.database=this.options.database,this.driver=this.options.driver,this.loadDependencies()}async disconnect(){return new Promise((e,I)=>{this.queryRunner=void 0,this.databaseConnection.close().then(e).catch(I)})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new NativescriptQueryRunner(this)),this.queryRunner}normalizeType(e){return e.type===Buffer$7?"blob":super.normalizeType(e)}createDatabaseConnection(){return new Promise((e,I)=>{const oe=Object.assign({},{readOnly:this.options.readOnly,key:this.options.key,multithreading:this.options.multithreading,migrate:this.options.migrate,iosFlags:this.options.iosFlags,androidFlags:this.options.androidFlags},this.options.extra||{});new this.sqlite(this.options.database,oe,(ue,bt)=>{if(ue)return I(ue);bt.resultType(this.sqlite.RESULTSASOBJECT),bt.execSQL("PRAGMA foreign_keys = ON",[],(tr,rr)=>{if(tr)return I(tr);e(bt)})})})}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new DriverPackageNotInstalledError("Nativescript","nativescript-sqlite")}}class SqljsQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.isDirty=!1,this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async flush(){this.isDirty&&(await this.driver.autoSave(),this.isDirty=!1)}async release(){return await this.flush(),super.release()}async commitTransaction(){await super.commitTransaction(),this.isTransactionActive||await this.flush()}async query(e,I=[],oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=e.trim().split(" ",1)[0],bt=this.driver.databaseConnection,tr=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(tr,e,I);const rr=+new Date;let ir;try{ir=bt.prepare(e),I&&(I=I.map(yr=>typeof yr<"u"?yr:null),ir.bind(I));const lr=this.driver.options.maxQueryExecutionTime,pr=+new Date-rr;lr&&pr>lr&&this.driver.connection.logger.logQuerySlow(pr,e,I,this);const hr=[];for(;ir.step();)hr.push(ir.getAsObject());this.broadcaster.broadcastAfterQueryEvent(tr,e,I,!0,pr,hr,void 0);const _r=new QueryResult;return _r.affected=bt.getRowsModified(),_r.records=hr,_r.raw=hr,ir.free(),ue!=="SELECT"&&(this.isDirty=!0),oe?_r:_r.raw}catch(lr){throw ir&&ir.free(),this.driver.connection.logger.logQueryError(lr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(tr,e,I,!1,void 0,void 0,lr),new QueryFailedError(e,I,lr)}finally{await tr.wait()}}}class SqljsDriver extends AbstractSqliteDriver{constructor(e){if(super(e),this.options.autoSave&&!this.options.location&&!this.options.autoSaveCallback)throw new DriverOptionNotSetError("location or autoSaveCallback");this.loadDependencies()}async connect(){this.databaseConnection=await this.createDatabaseConnection()}async disconnect(){this.queryRunner=void 0,this.databaseConnection.close()}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new SqljsQueryRunner(this)),this.queryRunner}async load(e,I=!0){if(typeof e=="string")if(PlatformTools.type==="node")if(PlatformTools.fileExist(e)){const oe=PlatformTools.readFileSync(e);return this.createDatabaseConnectionWithImport(oe)}else{if(I)throw new TypeORMError(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}else{let oe=null;if(this.options.useLocalForage)if(window.localforage)oe=await window.localforage.getItem(e);else throw new TypeORMError("localforage is not defined - please import localforage.js into your site");else oe=PlatformTools.getGlobalVariable().localStorage.getItem(e);if(oe!=null)return this.createDatabaseConnectionWithImport(JSON.parse(oe));if(I)throw new TypeORMError(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}else return this.createDatabaseConnectionWithImport(e)}async save(e){if(!e&&!this.options.location)throw new TypeORMError("No location is set, specify a location parameter or add the location option to your configuration");let I="";if(e?I=e:this.options.location&&(I=this.options.location),PlatformTools.type==="node")try{const oe=Buffer$7.from(this.databaseConnection.export());await PlatformTools.writeFile(I,oe)}catch(oe){throw new TypeORMError(`Could not save database, error: ${oe}`)}else{const oe=this.databaseConnection.export(),ue=[].slice.call(oe);if(this.options.useLocalForage)if(window.localforage)await window.localforage.setItem(I,JSON.stringify(ue));else throw new TypeORMError("localforage is not defined - please import localforage.js into your site");else PlatformTools.getGlobalVariable().localStorage.setItem(I,JSON.stringify(ue))}}async autoSave(){this.options.autoSave&&!this.queryRunner?.isTransactionActive&&(this.options.autoSaveCallback?await this.options.autoSaveCallback(this.export()):await this.save())}export(){return this.databaseConnection.export()}createGeneratedMap(e,I){const oe=e.generatedColumns.reduce((ue,bt)=>{if(bt.isPrimary&&bt.generationStrategy==="increment"){const tr="SELECT last_insert_rowid()";try{let rr=this.databaseConnection.exec(tr);return this.connection.logger.logQuery(tr),OrmUtils.mergeDeep(ue,bt.createValueMap(rr[0].values[0][0]))}catch(rr){this.connection.logger.logQueryError(rr,tr,[])}}return ue},{});return Object.keys(oe).length>0?oe:void 0}createDatabaseConnection(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)}async createDatabaseConnectionWithImport(e){const oe=typeof this.sqlite.Database=="function"?this.sqlite:await this.sqlite(this.options.sqlJsConfig);return e&&e.length>0?this.databaseConnection=new oe.Database(e):this.databaseConnection=new oe.Database,this.databaseConnection.exec("PRAGMA foreign_keys = ON"),this.databaseConnection}loadDependencies(){if(PlatformTools.type==="browser"){const e=this.options.driver||window.SQL;this.sqlite=e}else try{const e=this.options.driver||PlatformTools.load("sql.js");this.sqlite=e}catch{throw new DriverPackageNotInstalledError("sql.js","sql.js")}}}class PostgresQueryRunner extends BaseQueryRunner{constructor(e,I){super(),this.driver=e,this.connection=e.connection,this.mode=I,this.broadcaster=new Broadcaster(this)}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.mode==="slave"&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(([e,I])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const oe=ue=>this.releasePostgresConnection(ue);return this.releaseCallback=ue=>{this.databaseConnection.removeListener("error",oe),I(ue)},this.databaseConnection.on("error",oe),this.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(([e,I])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const oe=ue=>this.releasePostgresConnection(ue);return this.releaseCallback=ue=>{this.databaseConnection.removeListener("error",oe),I(ue)},this.databaseConnection.on("error",oe),this.databaseConnection}),this.databaseConnectionPromise)}async releasePostgresConnection(e){if(this.isReleased)return;this.isReleased=!0,this.releaseCallback&&(this.releaseCallback(e),this.releaseCallback=void 0);const I=this.driver.connectedQueryRunners.indexOf(this);I!==-1&&this.driver.connectedQueryRunners.splice(I,1)}release(){return this.releasePostgresConnection()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,await this.query("START TRANSACTION"),e&&await this.query("SET TRANSACTION ISOLATION LEVEL "+e)):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth-1}`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("COMMIT"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("ROLLBACK"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=await this.connect(),bt=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(bt,e,I);try{const tr=+new Date,rr=await ue.query(e,I),ir=this.driver.options.maxQueryExecutionTime,dr=+new Date-tr;this.broadcaster.broadcastAfterQueryEvent(bt,e,I,!0,dr,rr,void 0),ir&&dr>ir&&this.driver.connection.logger.logQuerySlow(dr,e,I,this);const pr=new QueryResult;if(rr){switch(rr.hasOwnProperty("rows")&&(pr.records=rr.rows),rr.hasOwnProperty("rowCount")&&(pr.affected=rr.rowCount),rr.command){case"DELETE":case"UPDATE":pr.raw=[rr.rows,rr.rowCount];break;default:pr.raw=rr.rows}if(!oe)return pr.raw}return pr}catch(tr){throw this.driver.connection.logger.logQueryError(tr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(bt,e,I,!1,void 0,void 0,tr),new QueryFailedError(e,I,tr)}finally{await bt.wait()}}async stream(e,I,oe,ue){const bt=this.driver.loadStreamDependency();if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=await this.connect();this.driver.connection.logger.logQuery(e,I,this);const rr=tr.query(new bt(e,I));return oe&&rr.on("end",oe),ue&&rr.on("error",ue),rr}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return!!(await this.query(`SELECT * FROM pg_database WHERE datname='${e}';`)).length}async getCurrentDatabase(){return(await this.query("SELECT * FROM current_database()"))[0].current_database}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){return(await this.query("SELECT * FROM current_schema()"))[0].current_schema}async hasTable(e){const I=this.driver.parseTableName(e);I.schema||(I.schema=await this.getCurrentSchema());const oe=`SELECT * FROM "information_schema"."tables" WHERE "table_schema" = '${I.schema}' AND "table_name" = '${I.tableName}'`;return!!(await this.query(oe)).length}async hasColumn(e,I){const oe=this.driver.parseTableName(e);oe.schema||(oe.schema=await this.getCurrentSchema());const ue=`SELECT * FROM "information_schema"."columns" WHERE "table_schema" = '${oe.schema}' AND "table_name" = '${oe.tableName}' AND "column_name" = '${I}'`;return!!(await this.query(ue)).length}async createDatabase(e,I){if(I&&await this.hasDatabase(e))return Promise.resolve();const oe=`CREATE DATABASE "${e}"`,ue=`DROP DATABASE "${e}"`;await this.executeQueries(new Query(oe),new Query(ue))}async dropDatabase(e,I){const oe=I?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,ue=`CREATE DATABASE "${e}"`;await this.executeQueries(new Query(oe),new Query(ue))}async createSchema(e,I){const oe=e.indexOf(".")===-1?e:e.split(".")[1],ue=I?`CREATE SCHEMA IF NOT EXISTS "${oe}"`:`CREATE SCHEMA "${oe}"`,bt=`DROP SCHEMA "${oe}" CASCADE`;await this.executeQueries(new Query(ue),new Query(bt))}async dropSchema(e,I,oe){const ue=e.indexOf(".")===-1?e:e.split(".")[1],bt=I?`DROP SCHEMA IF EXISTS "${ue}" ${oe?"CASCADE":""}`:`DROP SCHEMA "${ue}" ${oe?"CASCADE":""}`,tr=`CREATE SCHEMA "${ue}"`;await this.executeQueries(new Query(bt),new Query(tr))}async createTable(e,I=!1,oe=!0,ue=!0){if(I&&await this.hasTable(e))return Promise.resolve();const bt=[],tr=[],rr=e.columns.filter(dr=>dr.type==="enum"||dr.type==="simple-enum"),ir=[];for(const dr of rr){const pr=await this.hasEnumType(e,dr),hr=this.buildEnumName(e,dr);!pr&&ir.indexOf(hr)===-1&&(ir.push(hr),bt.push(this.createEnumTypeSql(e,dr,hr)),tr.push(this.dropEnumTypeSql(e,dr,hr)))}const lr=e.columns.filter(dr=>dr.generatedType==="STORED"&&dr.asExpression);for(const dr of lr){const pr=(await this.getTableNameWithSchema(e.name)).split("."),hr=pr[1],_r=pr[0],yr=this.insertTypeormMetadataSql({database:this.driver.database,schema:_r,table:hr,type:MetadataTableType.GENERATED_COLUMN,name:dr.name,value:dr.asExpression}),wr=this.deleteTypeormMetadataSql({database:this.driver.database,schema:_r,table:hr,type:MetadataTableType.GENERATED_COLUMN,name:dr.name});bt.push(yr),tr.push(wr)}bt.push(this.createTableSql(e,oe)),tr.push(this.dropTableSql(e)),oe&&e.foreignKeys.forEach(dr=>tr.push(this.dropForeignKeySql(e,dr))),ue&&e.indices.forEach(dr=>{dr.name||(dr.name=this.connection.namingStrategy.indexName(e,dr.columnNames,dr.where)),bt.push(this.createIndexSql(e,dr)),tr.push(this.dropIndexSql(e,dr))}),e.comment&&(bt.push(new Query("COMMENT ON TABLE "+this.escapePath(e)+" IS '"+e.comment+"'")),tr.push(new Query("COMMENT ON TABLE "+this.escapePath(e)+" IS NULL"))),await this.executeQueries(bt,tr)}async dropTable(e,I,oe=!0,ue=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const bt=oe,tr=this.getTablePath(e),rr=await this.getCachedTable(tr),ir=[],lr=[];ue&&rr.indices.forEach(pr=>{ir.push(this.dropIndexSql(rr,pr)),lr.push(this.createIndexSql(rr,pr))}),oe&&rr.foreignKeys.forEach(pr=>ir.push(this.dropForeignKeySql(rr,pr))),ir.push(this.dropTableSql(rr)),lr.push(this.createTableSql(rr,bt));const dr=rr.columns.filter(pr=>pr.generatedType&&pr.asExpression);for(const pr of dr){const hr=(await this.getTableNameWithSchema(rr.name)).split("."),_r=hr[1],yr=hr[0],wr=this.deleteTypeormMetadataSql({database:this.driver.database,schema:yr,table:_r,type:MetadataTableType.GENERATED_COLUMN,name:pr.name}),Tr=this.insertTypeormMetadataSql({database:this.driver.database,schema:yr,table:_r,type:MetadataTableType.GENERATED_COLUMN,name:pr.name,value:pr.asExpression});ir.push(wr),lr.push(Tr)}await this.executeQueries(ir,lr)}async createView(e,I=!1){const oe=[],ue=[];oe.push(this.createViewSql(e)),I&&oe.push(await this.insertViewDefinitionSql(e)),ue.push(this.dropViewSql(e)),I&&ue.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(oe,ue)}async dropView(e){const I=InstanceChecker.isView(e)?e.name:e,oe=await this.getCachedView(I),ue=[],bt=[];ue.push(await this.deleteViewDefinitionSql(oe)),ue.push(this.dropViewSql(oe)),bt.push(await this.insertViewDefinitionSql(oe)),bt.push(this.createViewSql(oe)),await this.executeQueries(ue,bt)}async renameTable(e,I){const oe=[],ue=[],bt=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=bt.clone(),{schema:rr,tableName:ir}=this.driver.parseTableName(bt);if(tr.name=rr?`${rr}.${I}`:I,oe.push(new Query(`ALTER TABLE ${this.escapePath(bt)} RENAME TO "${I}"`)),ue.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME TO "${ir}"`)),tr.primaryColumns.length>0&&!tr.primaryColumns[0].primaryKeyConstraintName){const dr=tr.primaryColumns.map(_r=>_r.name),pr=this.connection.namingStrategy.primaryKeyName(bt,dr),hr=this.connection.namingStrategy.primaryKeyName(tr,dr);oe.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${pr}" TO "${hr}"`)),ue.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${hr}" TO "${pr}"`))}tr.columns.map(dr=>{if(dr.isGenerated&&dr.generationStrategy==="increment"){const pr=this.buildSequencePath(bt,dr.name),hr=this.buildSequenceName(bt,dr.name),_r=this.buildSequencePath(tr,dr.name),yr=this.buildSequenceName(tr,dr.name),wr=`ALTER SEQUENCE ${this.escapePath(pr)} RENAME TO "${yr}"`,Tr=`ALTER SEQUENCE ${this.escapePath(_r)} RENAME TO "${hr}"`;oe.push(new Query(wr)),ue.push(new Query(Tr))}}),tr.uniques.forEach(dr=>{const pr=this.connection.namingStrategy.uniqueConstraintName(bt,dr.columnNames);if(dr.name!==pr)return;const hr=this.connection.namingStrategy.uniqueConstraintName(tr,dr.columnNames);oe.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${dr.name}" TO "${hr}"`)),ue.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${hr}" TO "${dr.name}"`)),dr.name=hr}),tr.indices.forEach(dr=>{const pr=this.connection.namingStrategy.indexName(bt,dr.columnNames,dr.where);if(dr.name!==pr)return;const{schema:hr}=this.driver.parseTableName(tr),_r=this.connection.namingStrategy.indexName(tr,dr.columnNames,dr.where),yr=hr?`ALTER INDEX "${hr}"."${dr.name}" RENAME TO "${_r}"`:`ALTER INDEX "${dr.name}" RENAME TO "${_r}"`,wr=hr?`ALTER INDEX "${hr}"."${_r}" RENAME TO "${dr.name}"`:`ALTER INDEX "${_r}" RENAME TO "${dr.name}"`;oe.push(new Query(yr)),ue.push(new Query(wr)),dr.name=_r}),tr.foreignKeys.forEach(dr=>{const pr=this.connection.namingStrategy.foreignKeyName(bt,dr.columnNames,this.getTablePath(dr),dr.referencedColumnNames);if(dr.name!==pr)return;const hr=this.connection.namingStrategy.foreignKeyName(tr,dr.columnNames,this.getTablePath(dr),dr.referencedColumnNames);oe.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${dr.name}" TO "${hr}"`)),ue.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${hr}" TO "${dr.name}"`)),dr.name=hr});const lr=tr.columns.filter(dr=>dr.type==="enum"||dr.type==="simple-enum");for(let dr of lr){if(dr.enumName)continue;const pr=await this.getUserDefinedTypeName(bt,dr);oe.push(new Query(`ALTER TYPE "${pr.schema}"."${pr.name}" RENAME TO ${this.buildEnumName(tr,dr,!1)}`)),ue.push(new Query(`ALTER TYPE ${this.buildEnumName(tr,dr)} RENAME TO "${pr.name}"`))}await this.executeQueries(oe,ue)}async addColumn(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone(),bt=[],tr=[];if((I.type==="enum"||I.type==="simple-enum")&&(await this.hasEnumType(oe,I)||(bt.push(this.createEnumTypeSql(oe,I)),tr.push(this.dropEnumTypeSql(oe,I)))),bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD ${this.buildCreateColumnSql(oe,I)}`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP COLUMN "${I.name}"`)),I.isPrimary){const ir=ue.primaryColumns;if(ir.length>0){const pr=ir[0].primaryKeyConstraintName?ir[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(ue,ir.map(_r=>_r.name)),hr=ir.map(_r=>`"${_r.name}"`).join(", ");bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP CONSTRAINT "${pr}"`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD CONSTRAINT "${pr}" PRIMARY KEY (${hr})`))}ir.push(I);const lr=ir[0].primaryKeyConstraintName?ir[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(ue,ir.map(pr=>pr.name)),dr=ir.map(pr=>`"${pr.name}"`).join(", ");bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD CONSTRAINT "${lr}" PRIMARY KEY (${dr})`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP CONSTRAINT "${lr}"`))}const rr=ue.indices.find(ir=>ir.columnNames.length===1&&ir.columnNames[0]===I.name);if(rr&&(bt.push(this.createIndexSql(oe,rr)),tr.push(this.dropIndexSql(oe,rr))),I.isUnique){const ir=new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(oe,[I.name]),columnNames:[I.name]});ue.uniques.push(ir),bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD CONSTRAINT "${ir.name}" UNIQUE ("${I.name}")`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP CONSTRAINT "${ir.name}"`))}if(I.generatedType==="STORED"&&I.asExpression){const ir=(await this.getTableNameWithSchema(oe.name)).split("."),lr=ir[1],dr=ir[0],pr=this.insertTypeormMetadataSql({database:this.driver.database,schema:dr,table:lr,type:MetadataTableType.GENERATED_COLUMN,name:I.name,value:I.asExpression}),hr=this.deleteTypeormMetadataSql({database:this.driver.database,schema:dr,table:lr,type:MetadataTableType.GENERATED_COLUMN,name:I.name});bt.push(pr),tr.push(hr)}I.comment&&(bt.push(new Query(`COMMENT ON COLUMN ${this.escapePath(oe)}."${I.name}" IS ${this.escapeComment(I.comment)}`)),tr.push(new Query(`COMMENT ON COLUMN ${this.escapePath(oe)}."${I.name}" IS ${this.escapeComment(I.comment)}`))),await this.executeQueries(bt,tr),ue.addColumn(I),this.replaceCachedTable(oe,ue)}async addColumns(e,I){for(const oe of I)await this.addColumn(e,oe)}async renameColumn(e,I,oe){const ue=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),bt=InstanceChecker.isTableColumn(I)?I:ue.columns.find(rr=>rr.name===I);if(!bt)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);let tr;return InstanceChecker.isTableColumn(oe)?tr=oe:(tr=bt.clone(),tr.name=oe),this.changeColumn(ue,bt,tr)}async changeColumn(e,I,oe){const ue=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);let bt=ue.clone();const tr=[],rr=[];let ir=!1;const lr=InstanceChecker.isTableColumn(I)?I:ue.columns.find(dr=>dr.name===I);if(!lr)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);if(lr.type!==oe.type||lr.length!==oe.length||oe.isArray!==lr.isArray||!lr.generatedType&&oe.generatedType==="STORED"||lr.asExpression!==oe.asExpression&&oe.generatedType==="STORED")await this.dropColumn(ue,lr),await this.addColumn(ue,oe),bt=ue.clone();else{if(lr.name!==oe.name){if(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME COLUMN "${lr.name}" TO "${oe.name}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME COLUMN "${oe.name}" TO "${lr.name}"`)),lr.type==="enum"||lr.type==="simple-enum"){const pr=await this.getUserDefinedTypeName(ue,lr);tr.push(new Query(`ALTER TYPE "${pr.schema}"."${pr.name}" RENAME TO ${this.buildEnumName(ue,oe,!1)}`)),rr.push(new Query(`ALTER TYPE ${this.buildEnumName(ue,oe)} RENAME TO "${pr.name}"`))}if(lr.isPrimary===!0&&!lr.primaryKeyConstraintName){const hr=bt.primaryColumns.map(wr=>wr.name),_r=this.connection.namingStrategy.primaryKeyName(bt,hr);hr.splice(hr.indexOf(lr.name),1),hr.push(oe.name);const yr=this.connection.namingStrategy.primaryKeyName(bt,hr);tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME CONSTRAINT "${_r}" TO "${yr}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME CONSTRAINT "${yr}" TO "${_r}"`))}if(lr.isGenerated===!0&&oe.generationStrategy==="increment"){const pr=this.buildSequencePath(ue,lr.name),hr=this.buildSequenceName(ue,lr.name),_r=this.buildSequencePath(ue,oe.name),yr=this.buildSequenceName(ue,oe.name),wr=`ALTER SEQUENCE ${this.escapePath(pr)} RENAME TO "${yr}"`,Tr=`ALTER SEQUENCE ${this.escapePath(_r)} RENAME TO "${hr}"`;tr.push(new Query(wr)),rr.push(new Query(Tr))}bt.findColumnUniques(lr).forEach(pr=>{const hr=this.connection.namingStrategy.uniqueConstraintName(bt,pr.columnNames);if(pr.name!==hr)return;pr.columnNames.splice(pr.columnNames.indexOf(lr.name),1),pr.columnNames.push(oe.name);const _r=this.connection.namingStrategy.uniqueConstraintName(bt,pr.columnNames);tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME CONSTRAINT "${pr.name}" TO "${_r}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME CONSTRAINT "${_r}" TO "${pr.name}"`)),pr.name=_r}),bt.findColumnIndices(lr).forEach(pr=>{const hr=this.connection.namingStrategy.indexName(bt,pr.columnNames,pr.where);if(pr.name!==hr)return;pr.columnNames.splice(pr.columnNames.indexOf(lr.name),1),pr.columnNames.push(oe.name);const{schema:_r}=this.driver.parseTableName(ue),yr=this.connection.namingStrategy.indexName(bt,pr.columnNames,pr.where),wr=_r?`ALTER INDEX "${_r}"."${pr.name}" RENAME TO "${yr}"`:`ALTER INDEX "${pr.name}" RENAME TO "${yr}"`,Tr=_r?`ALTER INDEX "${_r}"."${yr}" RENAME TO "${pr.name}"`:`ALTER INDEX "${yr}" RENAME TO "${pr.name}"`;tr.push(new Query(wr)),rr.push(new Query(Tr)),pr.name=yr}),bt.findColumnForeignKeys(lr).forEach(pr=>{const hr=this.connection.namingStrategy.foreignKeyName(bt,pr.columnNames,this.getTablePath(pr),pr.referencedColumnNames);if(pr.name!==hr)return;pr.columnNames.splice(pr.columnNames.indexOf(lr.name),1),pr.columnNames.push(oe.name);const _r=this.connection.namingStrategy.foreignKeyName(bt,pr.columnNames,this.getTablePath(pr),pr.referencedColumnNames);tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME CONSTRAINT "${pr.name}" TO "${_r}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME CONSTRAINT "${_r}" TO "${pr.name}"`)),pr.name=_r});const dr=bt.columns.find(pr=>pr.name===lr.name);bt.columns[bt.columns.indexOf(dr)].name=oe.name,lr.name=oe.name}if((oe.precision!==lr.precision||oe.scale!==lr.scale)&&(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${this.driver.createFullType(oe)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${this.driver.createFullType(lr)}`))),(oe.type==="enum"||oe.type==="simple-enum")&&(lr.type==="enum"||lr.type==="simple-enum")&&(!OrmUtils.isArraysEqual(oe.enum,lr.enum)||oe.enumName!==lr.enumName)){const dr=oe.isArray?"[]":"",pr=this.buildEnumName(ue,oe),hr=this.buildEnumName(ue,lr),_r=this.buildEnumName(ue,lr,!1),yr=this.buildEnumName(ue,lr,!0,!1,!0),wr=this.buildEnumName(ue,lr,!1,!1,!0);tr.push(new Query(`ALTER TYPE ${hr} RENAME TO ${wr}`)),rr.push(new Query(`ALTER TYPE ${yr} RENAME TO ${_r}`)),tr.push(this.createEnumTypeSql(ue,oe,pr)),rr.push(this.dropEnumTypeSql(ue,oe,pr)),lr.default!==null&&lr.default!==void 0&&(ir=!0,tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" DROP DEFAULT`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" SET DEFAULT ${lr.default}`)));const Tr=`${pr}${dr} USING "${oe.name}"::"text"::${pr}${dr}`,Ar=`${yr}${dr} USING "${oe.name}"::"text"::${yr}${dr}`;tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${Tr}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${Ar}`)),oe.default!==null&&oe.default!==void 0&&(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT ${oe.default}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`))),tr.push(this.dropEnumTypeSql(ue,lr,yr)),rr.push(this.createEnumTypeSql(ue,lr,yr))}if(lr.isNullable!==oe.isNullable&&(oe.isNullable?(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" DROP NOT NULL`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" SET NOT NULL`))):(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" SET NOT NULL`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" DROP NOT NULL`)))),lr.comment!==oe.comment&&(tr.push(new Query(`COMMENT ON COLUMN ${this.escapePath(ue)}."${lr.name}" IS ${this.escapeComment(oe.comment)}`)),rr.push(new Query(`COMMENT ON COLUMN ${this.escapePath(ue)}."${oe.name}" IS ${this.escapeComment(lr.comment)}`))),oe.isPrimary!==lr.isPrimary){const dr=bt.primaryColumns;if(dr.length>0){const pr=dr[0].primaryKeyConstraintName?dr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(bt,dr.map(_r=>_r.name)),hr=dr.map(_r=>`"${_r.name}"`).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP CONSTRAINT "${pr}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD CONSTRAINT "${pr}" PRIMARY KEY (${hr})`))}if(oe.isPrimary===!0){dr.push(oe);const pr=bt.columns.find(yr=>yr.name===oe.name);pr.isPrimary=!0;const hr=dr[0].primaryKeyConstraintName?dr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(bt,dr.map(yr=>yr.name)),_r=dr.map(yr=>`"${yr.name}"`).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD CONSTRAINT "${hr}" PRIMARY KEY (${_r})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP CONSTRAINT "${hr}"`))}else{const pr=dr.find(_r=>_r.name===oe.name);dr.splice(dr.indexOf(pr),1);const hr=bt.columns.find(_r=>_r.name===oe.name);if(hr.isPrimary=!1,dr.length>0){const _r=dr[0].primaryKeyConstraintName?dr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(bt,dr.map(wr=>wr.name)),yr=dr.map(wr=>`"${wr.name}"`).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD CONSTRAINT "${_r}" PRIMARY KEY (${yr})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP CONSTRAINT "${_r}"`))}}}if(oe.isUnique!==lr.isUnique)if(oe.isUnique===!0){const dr=new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(ue,[oe.name]),columnNames:[oe.name]});bt.uniques.push(dr),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD CONSTRAINT "${dr.name}" UNIQUE ("${oe.name}")`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP CONSTRAINT "${dr.name}"`))}else{const dr=bt.uniques.find(pr=>pr.columnNames.length===1&&!!pr.columnNames.find(hr=>hr===oe.name));bt.uniques.splice(bt.uniques.indexOf(dr),1),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP CONSTRAINT "${dr.name}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD CONSTRAINT "${dr.name}" UNIQUE ("${oe.name}")`))}if(lr.isGenerated!==oe.isGenerated&&(lr.isGenerated&&(lr.generationStrategy==="uuid"?(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" DROP DEFAULT`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${lr.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):lr.generationStrategy==="increment"&&(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(ue,oe))}')`)),tr.push(new Query(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(ue,oe))}`)),rr.push(new Query(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(ue,oe))} OWNED BY ${this.escapePath(ue)}."${oe.name}"`)))),oe.generationStrategy==="uuid"?oe.isGenerated===!0?(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT ${this.driver.uuidGenerator}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`))):(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):oe.generationStrategy==="increment"&&(oe.isGenerated===!0?(tr.push(new Query(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(ue,oe))} OWNED BY ${this.escapePath(ue)}."${oe.name}"`)),rr.push(new Query(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(ue,oe))}`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(ue,oe))}')`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`))):(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(ue,oe))}')`)),tr.push(new Query(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(ue,oe))}`)),rr.push(new Query(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(ue,oe))} OWNED BY ${this.escapePath(ue)}."${oe.name}"`))))),oe.default!==lr.default&&!ir&&(oe.default!==null&&oe.default!==void 0?(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT ${oe.default}`)),lr.default!==null&&lr.default!==void 0?rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT ${lr.default}`)):rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`))):lr.default!==null&&lr.default!==void 0&&(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" DROP DEFAULT`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" SET DEFAULT ${lr.default}`)))),((oe.spatialFeatureType||"").toLowerCase()!==(lr.spatialFeatureType||"").toLowerCase()||oe.srid!==lr.srid)&&(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${this.driver.createFullType(oe)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${this.driver.createFullType(lr)}`))),oe.generatedType!==lr.generatedType&&(!oe.generatedType||oe.generatedType==="VIRTUAL")){const dr=(await this.getTableNameWithSchema(ue.name)).split("."),pr=dr[1],hr=dr[0];tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} RENAME COLUMN "${lr.name}" TO "TEMP_OLD_${lr.name}"`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD ${this.buildCreateColumnSql(ue,oe)}`)),tr.push(new Query(`UPDATE ${this.escapePath(ue)} SET "${oe.name}" = "TEMP_OLD_${lr.name}"`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP COLUMN "TEMP_OLD_${lr.name}"`)),tr.push(this.deleteTypeormMetadataSql({database:this.driver.database,schema:hr,table:pr,type:MetadataTableType.GENERATED_COLUMN,name:lr.name})),rr.push(this.insertTypeormMetadataSql({database:this.driver.database,schema:hr,table:pr,type:MetadataTableType.GENERATED_COLUMN,name:lr.name,value:lr.asExpression})),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD ${this.buildCreateColumnSql(ue,lr)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP COLUMN "${oe.name}"`))}}await this.executeQueries(tr,rr),this.replaceCachedTable(ue,bt)}async changeColumns(e,I){for(const{oldColumn:oe,newColumn:ue}of I)await this.changeColumn(e,oe,ue)}async dropColumn(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableColumn(I)?I:oe.findColumnByName(I);if(!ue)throw new TypeORMError(`Column "${I}" was not found in table "${oe.name}"`);const bt=oe.clone(),tr=[],rr=[];if(ue.isPrimary){const pr=ue.primaryKeyConstraintName?ue.primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(bt,bt.primaryColumns.map(yr=>yr.name)),hr=bt.primaryColumns.map(yr=>`"${yr.name}"`).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} DROP CONSTRAINT "${pr}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} ADD CONSTRAINT "${pr}" PRIMARY KEY (${hr})`));const _r=bt.findColumnByName(ue.name);if(_r.isPrimary=!1,bt.primaryColumns.length>0){const yr=bt.primaryColumns[0].primaryKeyConstraintName?bt.primaryColumns[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(bt,bt.primaryColumns.map(Tr=>Tr.name)),wr=bt.primaryColumns.map(Tr=>`"${Tr.name}"`).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} ADD CONSTRAINT "${yr}" PRIMARY KEY (${wr})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} DROP CONSTRAINT "${yr}"`))}}const ir=bt.indices.find(pr=>pr.columnNames.length===1&&pr.columnNames[0]===ue.name);ir&&(bt.indices.splice(bt.indices.indexOf(ir),1),tr.push(this.dropIndexSql(oe,ir)),rr.push(this.createIndexSql(oe,ir)));const lr=bt.checks.find(pr=>!!pr.columnNames&&pr.columnNames.length===1&&pr.columnNames[0]===ue.name);lr&&(bt.checks.splice(bt.checks.indexOf(lr),1),tr.push(this.dropCheckConstraintSql(oe,lr)),rr.push(this.createCheckConstraintSql(oe,lr)));const dr=bt.uniques.find(pr=>pr.columnNames.length===1&&pr.columnNames[0]===ue.name);if(dr&&(bt.uniques.splice(bt.uniques.indexOf(dr),1),tr.push(this.dropUniqueConstraintSql(oe,dr)),rr.push(this.createUniqueConstraintSql(oe,dr))),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP COLUMN "${ue.name}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD ${this.buildCreateColumnSql(oe,ue)}`)),(ue.type==="enum"||ue.type==="simple-enum")&&await this.hasEnumType(oe,ue)){const hr=await this.getUserDefinedTypeName(oe,ue),_r=`"${hr.schema}"."${hr.name}"`;tr.push(this.dropEnumTypeSql(oe,ue,_r)),rr.push(this.createEnumTypeSql(oe,ue,_r))}if(ue.generatedType==="STORED"){const pr=(await this.getTableNameWithSchema(oe.name)).split("."),hr=pr[1],_r=pr[0],yr=this.deleteTypeormMetadataSql({database:this.driver.database,schema:_r,table:hr,type:MetadataTableType.GENERATED_COLUMN,name:ue.name}),wr=this.insertTypeormMetadataSql({database:this.driver.database,schema:_r,table:hr,type:MetadataTableType.GENERATED_COLUMN,name:ue.name,value:ue.asExpression});tr.push(yr),rr.push(wr)}await this.executeQueries(tr,rr),bt.removeColumn(ue),this.replaceCachedTable(oe,bt)}async dropColumns(e,I){for(const oe of I)await this.dropColumn(e,oe)}async createPrimaryKey(e,I,oe){const ue=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),bt=ue.clone(),tr=this.createPrimaryKeySql(ue,I,oe);bt.columns.forEach(ir=>{I.find(lr=>lr===ir.name)&&(ir.isPrimary=!0)});const rr=this.dropPrimaryKeySql(bt);await this.executeQueries(tr,rr),this.replaceCachedTable(ue,bt)}async updatePrimaryKeys(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone(),bt=I.map(pr=>pr.name),tr=[],rr=[],ir=ue.primaryColumns;if(ir.length>0){const pr=ir[0].primaryKeyConstraintName?ir[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(ue,ir.map(_r=>_r.name)),hr=ir.map(_r=>`"${_r.name}"`).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP CONSTRAINT "${pr}"`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD CONSTRAINT "${pr}" PRIMARY KEY (${hr})`))}ue.columns.filter(pr=>bt.indexOf(pr.name)!==-1).forEach(pr=>pr.isPrimary=!0);const lr=ir[0]?.primaryKeyConstraintName?ir[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(ue,bt),dr=bt.map(pr=>`"${pr}"`).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD CONSTRAINT "${lr}" PRIMARY KEY (${dr})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP CONSTRAINT "${lr}"`)),await this.executeQueries(tr,rr),this.replaceCachedTable(oe,ue)}async dropPrimaryKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=this.dropPrimaryKeySql(oe),bt=this.createPrimaryKeySql(oe,oe.primaryColumns.map(tr=>tr.name),I);await this.executeQueries(ue,bt),oe.primaryColumns.forEach(tr=>{tr.isPrimary=!1})}async createUniqueConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.uniqueConstraintName(oe,I.columnNames));const ue=this.createUniqueConstraintSql(oe,I),bt=this.dropUniqueConstraintSql(oe,I);await this.executeQueries(ue,bt),oe.addUniqueConstraint(I)}async createUniqueConstraints(e,I){for(const oe of I)await this.createUniqueConstraint(e,oe)}async dropUniqueConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableUnique(I)?I:oe.uniques.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied unique constraint was not found in table ${oe.name}`);const bt=this.dropUniqueConstraintSql(oe,ue),tr=this.createUniqueConstraintSql(oe,ue);await this.executeQueries(bt,tr),oe.removeUniqueConstraint(ue)}async dropUniqueConstraints(e,I){for(const oe of I)await this.dropUniqueConstraint(e,oe)}async createCheckConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.checkConstraintName(oe,I.expression));const ue=this.createCheckConstraintSql(oe,I),bt=this.dropCheckConstraintSql(oe,I);await this.executeQueries(ue,bt),oe.addCheckConstraint(I)}async createCheckConstraints(e,I){const oe=I.map(ue=>this.createCheckConstraint(e,ue));await Promise.all(oe)}async dropCheckConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableCheck(I)?I:oe.checks.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied check constraint was not found in table ${oe.name}`);const bt=this.dropCheckConstraintSql(oe,ue),tr=this.createCheckConstraintSql(oe,ue);await this.executeQueries(bt,tr),oe.removeCheckConstraint(ue)}async dropCheckConstraints(e,I){const oe=I.map(ue=>this.dropCheckConstraint(e,ue));await Promise.all(oe)}async createExclusionConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.exclusionConstraintName(oe,I.expression));const ue=this.createExclusionConstraintSql(oe,I),bt=this.dropExclusionConstraintSql(oe,I);await this.executeQueries(ue,bt),oe.addExclusionConstraint(I)}async createExclusionConstraints(e,I){const oe=I.map(ue=>this.createExclusionConstraint(e,ue));await Promise.all(oe)}async dropExclusionConstraint(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableExclusion(I)?I:oe.exclusions.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied exclusion constraint was not found in table ${oe.name}`);const bt=this.dropExclusionConstraintSql(oe,ue),tr=this.createExclusionConstraintSql(oe,ue);await this.executeQueries(bt,tr),oe.removeExclusionConstraint(ue)}async dropExclusionConstraints(e,I){const oe=I.map(ue=>this.dropExclusionConstraint(e,ue));await Promise.all(oe)}async createForeignKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.foreignKeyName(oe,I.columnNames,this.getTablePath(I),I.referencedColumnNames));const ue=this.createForeignKeySql(oe,I),bt=this.dropForeignKeySql(oe,I);await this.executeQueries(ue,bt),oe.addForeignKey(I)}async createForeignKeys(e,I){for(const oe of I)await this.createForeignKey(e,oe)}async dropForeignKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableForeignKey(I)?I:oe.foreignKeys.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied foreign key was not found in table ${oe.name}`);ue.name||(ue.name=this.connection.namingStrategy.foreignKeyName(oe,ue.columnNames,this.getTablePath(ue),ue.referencedColumnNames));const bt=this.dropForeignKeySql(oe,ue),tr=this.createForeignKeySql(oe,ue);await this.executeQueries(bt,tr),oe.removeForeignKey(ue)}async dropForeignKeys(e,I){for(const oe of I)await this.dropForeignKey(e,oe)}async createIndex(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(oe,I));const ue=this.createIndexSql(oe,I),bt=this.dropIndexSql(oe,I);await this.executeQueries(ue,bt),oe.addIndex(I)}async createViewIndex(e,I){const oe=InstanceChecker.isView(e)?e:await this.getCachedView(e);I.name||(I.name=this.generateIndexName(oe,I));const ue=this.createViewIndexSql(oe,I),bt=this.dropIndexSql(oe,I);await this.executeQueries(ue,bt),oe.addIndex(I)}async createIndices(e,I){for(const oe of I)await this.createIndex(e,oe)}async createViewIndices(e,I){for(const oe of I)await this.createViewIndex(e,oe)}async dropIndex(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableIndex(I)?I:oe.indices.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied index ${I} was not found in table ${oe.name}`);ue.name||(ue.name=this.generateIndexName(oe,ue));const bt=this.dropIndexSql(oe,ue),tr=this.createIndexSql(oe,ue);await this.executeQueries(bt,tr),oe.removeIndex(ue)}async dropViewIndex(e,I){const oe=InstanceChecker.isView(e)?e:await this.getCachedView(e),ue=InstanceChecker.isTableIndex(I)?I:oe.indices.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied index ${I} was not found in view ${oe.name}`);ue.name||(ue.name=this.generateIndexName(oe,ue));const bt=this.dropIndexSql(oe,ue),tr=this.createViewIndexSql(oe,ue);await this.executeQueries(bt,tr),oe.removeIndex(ue)}async dropIndices(e,I){for(const oe of I)await this.dropIndex(e,oe)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(){const e=[];this.connection.entityMetadatas.filter(ue=>ue.schema).forEach(ue=>{!!e.find(tr=>tr===ue.schema)||e.push(ue.schema)}),e.push(this.driver.options.schema||"current_schema()");const I=e.map(ue=>ue==="current_schema()"?ue:"'"+ue+"'").join(", "),oe=this.isTransactionActive;oe||await this.startTransaction();try{const ue=await this.getVersion(),bt=`SELECT 'DROP VIEW IF EXISTS "' || schemaname || '"."' || viewname || '" CASCADE;' as "query" FROM "pg_views" WHERE "schemaname" IN (${I}) AND "viewname" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')`,tr=await this.query(bt);if(await Promise.all(tr.map(lr=>this.query(lr.query))),VersionUtils.isGreaterOrEqual(ue,"9.3")){const lr=`SELECT 'DROP MATERIALIZED VIEW IF EXISTS "' || schemaname || '"."' || matviewname || '" CASCADE;' as "query" FROM "pg_matviews" WHERE "schemaname" IN (${I})`,dr=await this.query(lr);await Promise.all(dr.map(pr=>this.query(pr.query)))}const rr=`SELECT 'DROP TABLE IF EXISTS "' || schemaname || '"."' || tablename || '" CASCADE;' as "query" FROM "pg_tables" WHERE "schemaname" IN (${I}) AND "tablename" NOT IN ('spatial_ref_sys')`,ir=await this.query(rr);await Promise.all(ir.map(lr=>this.query(lr.query))),await this.dropEnumTypes(I),oe||await this.commitTransaction()}catch(ue){try{oe||await this.rollbackTransaction()}catch{}throw ue}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const oe=await this.getCurrentDatabase(),ue=await this.getCurrentSchema(),bt=e.length===0?"1=1":e.map(pr=>this.driver.parseTableName(pr)).map(({schema:pr,tableName:hr})=>(pr||(pr=this.driver.options.schema||ue),`("t"."schema" = '${pr}' AND "t"."name" = '${hr}')`)).join(" OR "),rr=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN 't' THEN 'TRUE' ELSE'FALSE' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN ('m') AND "cnst"."contype" IS NULL AND (${e.length===0?"1=1":e.map(pr=>this.driver.parseTableName(pr)).map(({schema:pr,tableName:hr})=>(pr||(pr=this.driver.options.schema||ue),`("ns"."nspname" = '${pr}' AND "t"."relname" = '${hr}')`)).join(" OR ")})`,ir=`SELECT "t".* FROM ${this.escapePath(this.getTypeormMetadataTableName())} "t" INNER JOIN "pg_catalog"."pg_class" "c" ON "c"."relname" = "t"."name" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "c"."relnamespace" AND "n"."nspname" = "t"."schema" WHERE "t"."type" IN ('${MetadataTableType.VIEW}', '${MetadataTableType.MATERIALIZED_VIEW}') ${bt?`AND (${bt})`:""}`,lr=await this.query(ir),dr=await this.query(rr);return lr.map(pr=>{const hr=OrmUtils.uniq(dr.filter(wr=>wr.table_name===pr.name&&wr.table_schema===pr.schema),wr=>wr.constraint_name),_r=new View,yr=pr.schema===ue&&!this.driver.options.schema?void 0:pr.schema;return _r.database=oe,_r.schema=pr.schema,_r.name=this.driver.buildTableName(pr.name,yr),_r.expression=pr.value,_r.materialized=pr.type===MetadataTableType.MATERIALIZED_VIEW,_r.indices=hr.map(wr=>{const Tr=dr.filter(Ar=>Ar.table_schema===wr.table_schema&&Ar.table_name===wr.table_name&&Ar.constraint_name===wr.constraint_name);return new TableIndex({view:_r,name:wr.constraint_name,columnNames:Tr.map(Ar=>Ar.column_name),isUnique:wr.is_unique==="TRUE",where:wr.condition,isFulltext:!1})}),_r})}async loadTables(e){if(e&&e.length===0)return[];const I=await this.getCurrentSchema(),oe=await this.getCurrentDatabase(),ue=[];if(!e)ue.push(...await this.query(`SELECT "table_schema", "table_name", obj_description(('"' || "table_schema" || '"."' || "table_name" || '"')::regclass, 'pg_class') AS table_comment FROM "information_schema"."tables"`));else{const Mr=`SELECT "table_schema", "table_name", obj_description(('"' || "table_schema" || '"."' || "table_name" || '"')::regclass, 'pg_class') AS table_comment FROM "information_schema"."tables" WHERE `+e.map(vr=>this.driver.parseTableName(vr)).map(({schema:vr,tableName:Lr})=>`("table_schema" = '${vr||I}' AND "table_name" = '${Lr}')`).join(" OR ");ue.push(...await this.query(Mr))}if(ue.length===0)return[];const tr=`SELECT columns.*, pg_catalog.col_description(('"' || table_catalog || '"."' || table_schema || '"."' || table_name || '"')::regclass::oid, ordinal_position) AS description, ('"' || "udt_schema" || '"."' || "udt_name" || '"')::"regtype" AS "regtype", pg_catalog.format_type("col_attr"."atttypid", "col_attr"."atttypmod") AS "format_type" FROM "information_schema"."columns" LEFT JOIN "pg_catalog"."pg_attribute" AS "col_attr" ON "col_attr"."attname" = "columns"."column_name" AND "col_attr"."attrelid" = ( SELECT "cls"."oid" FROM "pg_catalog"."pg_class" AS "cls" LEFT JOIN "pg_catalog"."pg_namespace" AS "ns" ON "ns"."oid" = "cls"."relnamespace" WHERE "cls"."relname" = "columns"."table_name" AND "ns"."nspname" = "columns"."table_schema" ) WHERE `+ue.map(({table_schema:Sr,table_name:Mr})=>`("table_schema" = '${Sr}' AND "table_name" = '${Mr}')`).join(" OR "),rr=ue.map(({table_schema:Sr,table_name:Mr})=>`("ns"."nspname" = '${Sr}' AND "t"."relname" = '${Mr}')`).join(" OR "),ir=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN 'p' THEN 'PRIMARY' WHEN 'u' THEN 'UNIQUE' WHEN 'c' THEN 'CHECK' WHEN 'x' THEN 'EXCLUDE' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" IN ('r', 'p') AND (${rr})`,lr=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN 't' THEN 'TRUE' ELSE'FALSE' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name", "am"."amname" AS "index_type" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" INNER JOIN "pg_am" "am" ON "i"."relam" = "am"."oid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN ('r', 'p') AND "cnst"."contype" IS NULL AND (${rr})`,dr=ue.map(({table_schema:Sr,table_name:Mr})=>`("ns"."nspname" = '${Sr}' AND "cl"."relname" = '${Mr}')`).join(" OR "),hr=await this.hasSupportForPartitionedTables()?` AND "cl"."relispartition" = 'f'`:"",_r=`SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update", "con"."condeferrable" AS "deferrable", "con"."condeferred" AS "deferred" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", "con1"."condeferrable", CASE WHEN "con1"."condeferred" THEN 'INITIALLY DEFERRED' ELSE 'INITIALLY IMMEDIATE' END as condeferred, CASE "con1"."confdeltype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confdeltype", CASE "con1"."confupdtype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = 'f' AND (${dr}) ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" ${hr}INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"`,[yr,wr,Tr,Ar]=await Promise.all([this.query(tr),this.query(ir),this.query(lr),this.query(_r)]);return Promise.all(ue.map(async Sr=>{const Mr=new Table,vr=(Nr,zr)=>Nr[zr]===I&&(!this.driver.options.schema||this.driver.options.schema===I)?void 0:Nr[zr],Lr=vr(Sr,"table_schema");Mr.database=oe,Mr.schema=Sr.table_schema,Mr.comment=Sr.table_comment,Mr.name=this.driver.buildTableName(Sr.table_name,Lr),Mr.columns=await Promise.all(yr.filter(Nr=>Nr.table_name===Sr.table_name&&Nr.table_schema===Sr.table_schema).map(async Nr=>{const zr=wr.filter(kr=>kr.table_name===Nr.table_name&&kr.table_schema===Nr.table_schema&&kr.column_name===Nr.column_name),Ir=new TableColumn;if(Ir.name=Nr.column_name,Ir.type=Nr.regtype.toLowerCase(),Ir.type==="numeric"||Ir.type==="numeric[]"||Ir.type==="decimal"||Ir.type==="float"){let kr=Nr.numeric_precision,Qr=Nr.numeric_scale;if(Nr.data_type==="ARRAY"){const is=Nr.format_type.match(/^numeric\(([0-9]+),([0-9]+)\)\[\]$/);is&&(kr=+is[1],Qr=+is[2])}kr!==null&&!this.isDefaultColumnPrecision(Mr,Ir,kr)?Ir.precision=kr:Qr!==null&&!this.isDefaultColumnScale(Mr,Ir,Qr)&&(Ir.precision=void 0),Qr!==null&&!this.isDefaultColumnScale(Mr,Ir,Qr)?Ir.scale=Qr:kr!==null&&!this.isDefaultColumnPrecision(Mr,Ir,kr)&&(Ir.scale=void 0)}if((Ir.type==="interval"||Ir.type==="time without time zone"||Ir.type==="time with time zone"||Ir.type==="timestamp without time zone"||Ir.type==="timestamp with time zone")&&(Ir.precision=this.isDefaultColumnPrecision(Mr,Ir,Nr.datetime_precision)?void 0:Nr.datetime_precision),Nr.data_type==="USER-DEFINED"||Nr.data_type==="ARRAY"){const{name:kr}=await this.getUserDefinedTypeName(Mr,Ir),is=this.buildEnumName(Mr,Ir,!1,!0)!==kr?kr:void 0,cs=`SELECT "e"."enumlabel" AS "value" FROM "pg_enum" "e" INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${Sr.table_schema}' AND "t"."typname" = '${is||kr}'`,_s=await this.query(cs);if(_s.length&&(Ir.type="enum",Ir.enum=_s.map(as=>as.value),Ir.enumName=is),Nr.data_type==="ARRAY"){Ir.isArray=!0;const as=Ir.type.replace("[]","");Ir.type=this.connection.driver.normalizeType({type:as})}}if(Ir.type==="geometry"||Ir.type==="geography"){const kr=`SELECT * FROM (SELECT "f_table_schema" "table_schema", "f_table_name" "table_name", "f_${Ir.type}_column" "column_name", "srid", "type" FROM "${Ir.type}_columns") AS _ WHERE "column_name" = '${Nr.column_name}' AND "table_schema" = '${Nr.table_schema}' AND "table_name" = '${Nr.table_name}'`,Qr=await this.query(kr);Qr.length>0&&(Ir.spatialFeatureType=Qr[0].type,Ir.srid=Qr[0].srid)}if(this.driver.withLengthColumnTypes.indexOf(Ir.type)!==-1){let kr;if(Ir.isArray){const Qr=/\((\d+)\)/.exec(Nr.format_type);kr=Qr?Qr[1]:void 0}else Nr.character_maximum_length&&(kr=Nr.character_maximum_length.toString());kr&&(Ir.length=this.isDefaultColumnLength(Mr,Ir,kr)?"":kr)}Ir.isNullable=Nr.is_nullable==="YES";const Or=zr.find(kr=>kr.constraint_type==="PRIMARY");if(Or){Ir.isPrimary=!0;const Qr=wr.filter(cs=>cs.table_name===Nr.table_name&&cs.table_schema===Nr.table_schema&&cs.column_name!==Nr.column_name&&cs.constraint_type==="PRIMARY").map(cs=>cs.column_name);Qr.push(Nr.column_name);const is=this.connection.namingStrategy.primaryKeyName(Mr,Qr);Or.constraint_name!==is&&(Ir.primaryKeyConstraintName=Or.constraint_name)}const Dr=zr.filter(kr=>kr.constraint_type==="UNIQUE"),Ur=Dr.every(kr=>wr.some(Qr=>Qr.constraint_type==="UNIQUE"&&Qr.constraint_name===kr.constraint_name&&Qr.column_name!==Nr.column_name));if(Ir.isUnique=Dr.length>0&&!Ur,Nr.is_identity==="YES")Ir.isGenerated=!0,Ir.generationStrategy="identity",Ir.generatedIdentity=Nr.identity_generation;else if(Nr.column_default!==null&&Nr.column_default!==void 0){const kr=`nextval('${this.buildSequenceName(Mr,Nr.column_name)}'::regclass)`,Qr=`nextval('${this.buildSequencePath(Mr,Nr.column_name)}'::regclass)`,is=Nr.column_default.replace(/"/g,"");is===kr||is===Qr?(Ir.isGenerated=!0,Ir.generationStrategy="increment"):Nr.column_default==="gen_random_uuid()"||/^uuid_generate_v\d\(\)/.test(Nr.column_default)?Ir.type==="uuid"?(Ir.isGenerated=!0,Ir.generationStrategy="uuid"):Ir.default=Nr.column_default:Nr.column_default==="now()"||Nr.column_default.indexOf("'now'::text")!==-1?Ir.default=Nr.column_default:(Ir.default=Nr.column_default.replace(/::[\w\s.[\]\-"]+/g,""),Ir.default=Ir.default.replace(/^(-?\d+)$/,"'$1'"))}if(Nr.is_generated==="ALWAYS"&&Nr.generation_expression){Ir.generatedType="STORED";const kr=this.selectTypeormMetadataSql({database:oe,schema:Sr.table_schema,table:Sr.table_name,type:MetadataTableType.GENERATED_COLUMN,name:Ir.name}),Qr=await this.query(kr.query,kr.parameters);Qr[0]&&Qr[0].value?Ir.asExpression=Qr[0].value:Ir.asExpression=""}return Ir.comment=Nr.description?Nr.description:void 0,Nr.character_set_name&&(Ir.charset=Nr.character_set_name),Nr.collation_name&&(Ir.collation=Nr.collation_name),Ir}));const es=OrmUtils.uniq(wr.filter(Nr=>Nr.table_name===Sr.table_name&&Nr.table_schema===Sr.table_schema&&Nr.constraint_type==="UNIQUE"),Nr=>Nr.constraint_name);Mr.uniques=es.map(Nr=>{const zr=wr.filter(Ir=>Ir.constraint_name===Nr.constraint_name);return new TableUnique({name:Nr.constraint_name,columnNames:zr.map(Ir=>Ir.column_name),deferrable:Nr.deferrable?Nr.deferred:void 0})});const ss=OrmUtils.uniq(wr.filter(Nr=>Nr.table_name===Sr.table_name&&Nr.table_schema===Sr.table_schema&&Nr.constraint_type==="CHECK"),Nr=>Nr.constraint_name);Mr.checks=ss.map(Nr=>{const zr=wr.filter(Ir=>Ir.constraint_name===Nr.constraint_name);return new TableCheck({name:Nr.constraint_name,columnNames:zr.map(Ir=>Ir.column_name),expression:Nr.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})});const os=OrmUtils.uniq(wr.filter(Nr=>Nr.table_name===Sr.table_name&&Nr.table_schema===Sr.table_schema&&Nr.constraint_type==="EXCLUDE"),Nr=>Nr.constraint_name);Mr.exclusions=os.map(Nr=>new TableExclusion({name:Nr.constraint_name,expression:Nr.expression.substring(8)}));const $r=OrmUtils.uniq(Ar.filter(Nr=>Nr.table_name===Sr.table_name&&Nr.table_schema===Sr.table_schema),Nr=>Nr.constraint_name);Mr.foreignKeys=$r.map(Nr=>{const zr=Ar.filter(Dr=>Dr.constraint_name===Nr.constraint_name),Ir=vr(Nr,"referenced_table_schema"),Or=this.driver.buildTableName(Nr.referenced_table_name,Ir);return new TableForeignKey({name:Nr.constraint_name,columnNames:zr.map(Dr=>Dr.column_name),referencedSchema:Nr.referenced_table_schema,referencedTableName:Or,referencedColumnNames:zr.map(Dr=>Dr.referenced_column_name),onDelete:Nr.on_delete,onUpdate:Nr.on_update,deferrable:Nr.deferrable?Nr.deferred:void 0})});const ns=OrmUtils.uniq(Tr.filter(Nr=>Nr.table_name===Sr.table_name&&Nr.table_schema===Sr.table_schema),Nr=>Nr.constraint_name);return Mr.indices=ns.map(Nr=>{const zr=Tr.filter(Ir=>Ir.table_schema===Nr.table_schema&&Ir.table_name===Nr.table_name&&Ir.constraint_name===Nr.constraint_name);return new TableIndex({table:Mr,name:Nr.constraint_name,columnNames:zr.map(Ir=>Ir.column_name),isUnique:Nr.is_unique==="TRUE",where:Nr.condition,isSpatial:Nr.index_type==="gist",isFulltext:!1})}),Mr}))}createTableSql(e,I){const oe=e.columns.map(tr=>this.buildCreateColumnSql(e,tr)).join(", ");let ue=`CREATE TABLE ${this.escapePath(e)} (${oe}`;if(e.columns.filter(tr=>tr.isUnique).forEach(tr=>{e.uniques.some(ir=>ir.columnNames.length===1&&ir.columnNames[0]===tr.name)||e.uniques.push(new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(e,[tr.name]),columnNames:[tr.name]}))}),e.uniques.length>0){const tr=e.uniques.map(rr=>{const ir=rr.name?rr.name:this.connection.namingStrategy.uniqueConstraintName(e,rr.columnNames),lr=rr.columnNames.map(pr=>`"${pr}"`).join(", ");let dr=`CONSTRAINT "${ir}" UNIQUE (${lr})`;return rr.deferrable&&(dr+=` DEFERRABLE ${rr.deferrable}`),dr}).join(", ");ue+=`, ${tr}`}if(e.checks.length>0){const tr=e.checks.map(rr=>`CONSTRAINT "${rr.name?rr.name:this.connection.namingStrategy.checkConstraintName(e,rr.expression)}" CHECK (${rr.expression})`).join(", ");ue+=`, ${tr}`}if(e.exclusions.length>0){const tr=e.exclusions.map(rr=>`CONSTRAINT "${rr.name?rr.name:this.connection.namingStrategy.exclusionConstraintName(e,rr.expression)}" EXCLUDE ${rr.expression}`).join(", ");ue+=`, ${tr}`}if(e.foreignKeys.length>0&&I){const tr=e.foreignKeys.map(rr=>{const ir=rr.columnNames.map(pr=>`"${pr}"`).join(", ");rr.name||(rr.name=this.connection.namingStrategy.foreignKeyName(e,rr.columnNames,this.getTablePath(rr),rr.referencedColumnNames));const lr=rr.referencedColumnNames.map(pr=>`"${pr}"`).join(", ");let dr=`CONSTRAINT "${rr.name}" FOREIGN KEY (${ir}) REFERENCES ${this.escapePath(this.getTablePath(rr))} (${lr})`;return rr.onDelete&&(dr+=` ON DELETE ${rr.onDelete}`),rr.onUpdate&&(dr+=` ON UPDATE ${rr.onUpdate}`),rr.deferrable&&(dr+=` DEFERRABLE ${rr.deferrable}`),dr}).join(", ");ue+=`, ${tr}`}const bt=e.columns.filter(tr=>tr.isPrimary);if(bt.length>0){const tr=bt[0].primaryKeyConstraintName?bt[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(e,bt.map(ir=>ir.name)),rr=bt.map(ir=>`"${ir.name}"`).join(", ");ue+=`, CONSTRAINT "${tr}" PRIMARY KEY (${rr})`}return ue+=")",e.columns.filter(tr=>tr.comment).forEach(tr=>ue+=`; COMMENT ON COLUMN ${this.escapePath(e)}."${tr.name}" IS ${this.escapeComment(tr.comment)}`),new Query(ue)}async getVersion(){return(await this.query("SELECT version()"))[0].version.replace(/^PostgreSQL ([\d.]+) .*$/,"$1")}dropTableSql(e){return new Query(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const I=e.materialized?"MATERIALIZED ":"",oe=this.escapePath(e);return typeof e.expression=="string"?new Query(`CREATE ${I}VIEW ${oe} AS ${e.expression}`):new Query(`CREATE ${I}VIEW ${oe} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const I=await this.getCurrentSchema();let{schema:oe,tableName:ue}=this.driver.parseTableName(e);oe||(oe=I);const bt=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW,tr=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:bt,schema:oe,name:ue,value:tr})}dropViewSql(e){const I=e.materialized?"MATERIALIZED ":"";return new Query(`DROP ${I}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const I=await this.getCurrentSchema();let{schema:oe,tableName:ue}=this.driver.parseTableName(e);oe||(oe=I);const bt=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW;return this.deleteTypeormMetadataSql({type:bt,schema:oe,name:ue})}async dropEnumTypes(e){const I=`SELECT 'DROP TYPE IF EXISTS "' || n.nspname || '"."' || t.typname || '" CASCADE;' as "query" FROM "pg_type" "t" INNER JOIN "pg_enum" "e" ON "e"."enumtypid" = "t"."oid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" IN (${e}) GROUP BY "n"."nspname", "t"."typname"`,oe=await this.query(I);await Promise.all(oe.map(ue=>this.query(ue.query)))}async hasEnumType(e,I){let{schema:oe}=this.driver.parseTableName(e);oe||(oe=await this.getCurrentSchema());const ue=this.buildEnumName(e,I,!1,!0),bt=`SELECT "n"."nspname", "t"."typname" FROM "pg_type" "t" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${oe}' AND "t"."typname" = '${ue}'`;return!!(await this.query(bt)).length}createEnumTypeSql(e,I,oe){oe||(oe=this.buildEnumName(e,I));const ue=I.enum.map(bt=>`'${bt.replace("'","''")}'`).join(", ");return new Query(`CREATE TYPE ${oe} AS ENUM(${ue})`)}dropEnumTypeSql(e,I,oe){return oe||(oe=this.buildEnumName(e,I)),new Query(`DROP TYPE ${oe}`)}createIndexSql(e,I){const oe=I.columnNames.map(ue=>`"${ue}"`).join(", ");return new Query(`CREATE ${I.isUnique?"UNIQUE ":""}INDEX${I.isConcurrent?" CONCURRENTLY":""} "${I.name}" ON ${this.escapePath(e)} ${I.isSpatial?"USING GiST ":""}(${oe}) ${I.where?"WHERE "+I.where:""}`)}createViewIndexSql(e,I){const oe=I.columnNames.map(ue=>`"${ue}"`).join(", ");return new Query(`CREATE ${I.isUnique?"UNIQUE ":""}INDEX "${I.name}" ON ${this.escapePath(e)} (${oe}) ${I.where?"WHERE "+I.where:""}`)}dropIndexSql(e,I){const oe=InstanceChecker.isTableIndex(I)?I.name:I,ue=InstanceChecker.isTableIndex(I)?I.isConcurrent:!1,{schema:bt}=this.driver.parseTableName(e);return bt?new Query(`DROP INDEX ${ue?"CONCURRENTLY ":""}"${bt}"."${oe}"`):new Query(`DROP INDEX ${ue?"CONCURRENTLY ":""}"${oe}"`)}createPrimaryKeySql(e,I,oe){const ue=oe||this.connection.namingStrategy.primaryKeyName(e,I),bt=I.map(tr=>`"${tr}"`).join(", ");return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${ue}" PRIMARY KEY (${bt})`)}dropPrimaryKeySql(e){if(!e.primaryColumns.length)throw new TypeORMError(`Table ${e} has no primary keys.`);const I=e.primaryColumns.map(bt=>bt.name),oe=e.primaryColumns[0].primaryKeyConstraintName,ue=oe||this.connection.namingStrategy.primaryKeyName(e,I);return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${ue}"`)}createUniqueConstraintSql(e,I){const oe=I.columnNames.map(bt=>'"'+bt+'"').join(", ");let ue=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" UNIQUE (${oe})`;return I.deferrable&&(ue+=` DEFERRABLE ${I.deferrable}`),new Query(ue)}dropUniqueConstraintSql(e,I){const oe=InstanceChecker.isTableUnique(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${oe}"`)}createCheckConstraintSql(e,I){return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" CHECK (${I.expression})`)}dropCheckConstraintSql(e,I){const oe=InstanceChecker.isTableCheck(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${oe}"`)}createExclusionConstraintSql(e,I){return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" EXCLUDE ${I.expression}`)}dropExclusionConstraintSql(e,I){const oe=InstanceChecker.isTableExclusion(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${oe}"`)}createForeignKeySql(e,I){const oe=I.columnNames.map(tr=>'"'+tr+'"').join(", "),ue=I.referencedColumnNames.map(tr=>'"'+tr+'"').join(",");let bt=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" FOREIGN KEY (${oe}) REFERENCES ${this.escapePath(this.getTablePath(I))}(${ue})`;return I.onDelete&&(bt+=` ON DELETE ${I.onDelete}`),I.onUpdate&&(bt+=` ON UPDATE ${I.onUpdate}`),I.deferrable&&(bt+=` DEFERRABLE ${I.deferrable}`),new Query(bt)}dropForeignKeySql(e,I){const oe=InstanceChecker.isTableForeignKey(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${oe}"`)}buildSequenceName(e,I){const{tableName:oe}=this.driver.parseTableName(e),ue=InstanceChecker.isTableColumn(I)?I.name:I;let bt=`${oe}_${ue}_seq`;return bt.length>this.connection.driver.maxAliasLength&&(bt=`${oe.substring(0,29)}_${ue.substring(0,Math.max(29,63-e.name.length-5))}_seq`),bt}buildSequencePath(e,I){const{schema:oe}=this.driver.parseTableName(e);return oe?`${oe}.${this.buildSequenceName(e,I)}`:this.buildSequenceName(e,I)}buildEnumName(e,I,oe=!0,ue,bt){const{schema:tr,tableName:rr}=this.driver.parseTableName(e);let ir=I.enumName?I.enumName:`${rr}_${I.name.toLowerCase()}_enum`;return tr&&oe&&(ir=`${tr}.${ir}`),bt&&(ir=ir+"_old"),ir.split(".").map(lr=>ue?lr:`"${lr}"`).join(".")}async getUserDefinedTypeName(e,I){let{schema:oe,tableName:ue}=this.driver.parseTableName(e);oe||(oe=await this.getCurrentSchema());const bt=await this.query(`SELECT "udt_schema", "udt_name" FROM "information_schema"."columns" WHERE "table_schema" = '${oe}' AND "table_name" = '${ue}' AND "column_name"='${I.name}'`);let tr=bt[0].udt_name;return tr.indexOf("_")===0&&(tr=tr.substr(1,tr.length)),{schema:bt[0].udt_schema,name:tr}}escapeComment(e){return!e||e.length===0?"NULL":(e=e.replace(/'/g,"''").replace(/\u0000/g,""),`'${e}'`)}escapePath(e){const{schema:I,tableName:oe}=this.driver.parseTableName(e);return I&&I!==this.driver.searchSchema?`"${I}"."${oe}"`:`"${oe}"`}async getTableNameWithSchema(e){const I=InstanceChecker.isTable(e)?e.name:e;return I.indexOf(".")===-1?`${(await this.query("SELECT current_schema()"))[0].current_schema}.${I}`:`${I.split(".")[0]}.${I.split(".")[1]}`}buildCreateColumnSql(e,I){let oe='"'+I.name+'"';if(I.isGenerated===!0&&I.generationStrategy!=="uuid")if(I.generationStrategy==="identity"){const ue=I.generatedIdentity||"BY DEFAULT";oe+=` ${I.type} GENERATED ${ue} AS IDENTITY`}else(I.type==="integer"||I.type==="int"||I.type==="int4")&&(oe+=" SERIAL"),(I.type==="smallint"||I.type==="int2")&&(oe+=" SMALLSERIAL"),(I.type==="bigint"||I.type==="int8")&&(oe+=" BIGSERIAL");return I.type==="enum"||I.type==="simple-enum"?(oe+=" "+this.buildEnumName(e,I),I.isArray&&(oe+=" array")):(!I.isGenerated||I.type==="uuid")&&(oe+=" "+this.connection.driver.createFullType(I)),I.generatedType==="STORED"&&I.asExpression&&(oe+=` GENERATED ALWAYS AS (${I.asExpression}) STORED`),I.charset&&(oe+=' CHARACTER SET "'+I.charset+'"'),I.collation&&(oe+=' COLLATE "'+I.collation+'"'),I.isNullable!==!0&&(oe+=" NOT NULL"),I.default!==void 0&&I.default!==null&&(oe+=" DEFAULT "+I.default),I.isGenerated&&I.generationStrategy==="uuid"&&!I.default&&(oe+=` DEFAULT ${this.driver.uuidGenerator}`),oe}async hasSupportForPartitionedTables(){return!!(await this.query("SELECT TRUE FROM information_schema.columns WHERE table_name = 'pg_class' and column_name = 'relispartition'")).length}async changeTableComment(e,I){const oe=[],ue=[],bt=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I=this.escapeComment(I);const tr=this.escapeComment(bt.comment);if(I===tr)return;const rr=bt.clone();oe.push(new Query(`COMMENT ON TABLE ${this.escapePath(rr)} IS ${I}`)),ue.push(new Query(`COMMENT ON TABLE ${this.escapePath(bt)} IS ${tr}`)),await this.executeQueries(oe,ue),bt.comment=rr.comment,this.replaceCachedTable(bt,rr)}}class PostgresDriver{constructor(e){this.slaves=[],this.connectedQueryRunners=[],this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","int2","int4","int8","smallint","integer","bigint","decimal","numeric","real","float","float4","float8","double precision","money","character varying","varchar","character","char","text","citext","hstore","bytea","bit","varbit","bit varying","timetz","timestamptz","timestamp","timestamp without time zone","timestamp with time zone","date","time","time without time zone","time with time zone","interval","bool","boolean","enum","point","line","lseg","box","path","polygon","circle","cidr","inet","macaddr","tsvector","tsquery","uuid","xml","json","jsonb","int4range","int8range","numrange","tsrange","tstzrange","daterange","int4multirange","int8multirange","nummultirange","tsmultirange","tstzmultirange","datemultirange","geometry","geography","cube","ltree"],this.supportedUpsertTypes=["on-conflict-do-update"],this.spatialTypes=["geometry","geography"],this.withLengthColumnTypes=["character varying","varchar","character","char","bit","varbit","bit varying"],this.withPrecisionColumnTypes=["numeric","decimal","interval","time without time zone","time with time zone","timestamp without time zone","timestamp with time zone"],this.withScaleColumnTypes=["numeric","decimal"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"now()",updateDate:"timestamp",updateDateDefault:"now()",deleteDate:"timestamp",deleteDateNullable:!0,version:"int4",treeLevel:"int4",migrationId:"int4",migrationName:"varchar",migrationTimestamp:"int8",cacheId:"int4",cacheIdentifier:"varchar",cacheTime:"int8",cacheDuration:"int4",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.parametersPrefix="$",this.dataTypeDefaults={character:{length:1},bit:{length:1},interval:{precision:6},"time without time zone":{precision:6},"time with time zone":{precision:6},"timestamp without time zone":{precision:6},"timestamp with time zone":{precision:6}},this.maxAliasLength=63,this.isGeneratedColumnsSupported=!1,this.cteCapabilities={enabled:!0,writable:!0,requiresRecursiveHint:!0,materializedHint:!0},e&&(this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.options.useUTC,this.loadDependencies(),this.database=DriverUtils.buildDriverOptions(this.options.replication?this.options.replication.master:this.options).database,this.schema=DriverUtils.buildDriverOptions(this.options).schema)}async connect(){if(this.options.replication?(this.slaves=await Promise.all(this.options.replication.slaves.map(e=>this.createPool(this.options,e))),this.master=await this.createPool(this.options,this.options.replication.master)):this.master=await this.createPool(this.options,this.options),!this.database||!this.searchSchema){const e=await this.createQueryRunner("master");this.database||(this.database=await e.getCurrentDatabase()),this.searchSchema||(this.searchSchema=await e.getCurrentSchema()),await e.release()}this.schema||(this.schema=this.searchSchema)}async afterConnect(){const e=await this.checkMetadataForExtensions(),[I,oe]=await this.obtainMasterConnection();(this.options.installExtensions===void 0||this.options.installExtensions)&&e.hasExtensions&&await this.enableExtensions(e,I);const tr=(await this.executeQuery(I,"SELECT version();")).rows[0].version.replace(/^PostgreSQL ([\d.]+) .*$/,"$1");this.version=tr,this.isGeneratedColumnsSupported=VersionUtils.isGreaterOrEqual(tr,"12.0"),await oe()}async enableExtensions(e,I){const{logger:oe}=this.connection,{hasUuidColumns:ue,hasCitextColumns:bt,hasHstoreColumns:tr,hasCubeColumns:rr,hasGeometryColumns:ir,hasLtreeColumns:lr,hasExclusionConstraints:dr}=e;if(ue)try{await this.executeQuery(I,`CREATE EXTENSION IF NOT EXISTS "${this.options.uuidExtension||"uuid-ossp"}"`)}catch{oe.log("warn",`At least one of the entities has uuid column, but the '${this.options.uuidExtension||"uuid-ossp"}' extension cannot be installed automatically. Please install it manually using superuser rights, or select another uuid extension.`)}if(bt)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "citext"')}catch{oe.log("warn","At least one of the entities has citext column, but the 'citext' extension cannot be installed automatically. Please install it manually using superuser rights")}if(tr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "hstore"')}catch{oe.log("warn","At least one of the entities has hstore column, but the 'hstore' extension cannot be installed automatically. Please install it manually using superuser rights")}if(ir)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "postgis"')}catch{oe.log("warn","At least one of the entities has a geometry column, but the 'postgis' extension cannot be installed automatically. Please install it manually using superuser rights")}if(rr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "cube"')}catch{oe.log("warn","At least one of the entities has a cube column, but the 'cube' extension cannot be installed automatically. Please install it manually using superuser rights")}if(lr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "ltree"')}catch{oe.log("warn","At least one of the entities has a ltree column, but the 'ltree' extension cannot be installed automatically. Please install it manually using superuser rights")}if(dr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "btree_gist"')}catch{oe.log("warn","At least one of the entities has an exclusion constraint, but the 'btree_gist' extension cannot be installed automatically. Please install it manually using superuser rights")}}async checkMetadataForExtensions(){const e=this.connection.entityMetadatas.some(ir=>ir.generatedColumns.filter(lr=>lr.generationStrategy==="uuid").length>0),I=this.connection.entityMetadatas.some(ir=>ir.columns.filter(lr=>lr.type==="citext").length>0),oe=this.connection.entityMetadatas.some(ir=>ir.columns.filter(lr=>lr.type==="hstore").length>0),ue=this.connection.entityMetadatas.some(ir=>ir.columns.filter(lr=>lr.type==="cube").length>0),bt=this.connection.entityMetadatas.some(ir=>ir.columns.filter(lr=>this.spatialTypes.indexOf(lr.type)>=0).length>0),tr=this.connection.entityMetadatas.some(ir=>ir.columns.filter(lr=>lr.type==="ltree").length>0),rr=this.connection.entityMetadatas.some(ir=>ir.exclusions.length>0);return{hasUuidColumns:e,hasCitextColumns:I,hasHstoreColumns:oe,hasCubeColumns:ue,hasGeometryColumns:bt,hasLtreeColumns:tr,hasExclusionConstraints:rr,hasExtensions:e||I||oe||bt||ue||tr||rr}}async disconnect(){if(!this.master)return Promise.reject(new ConnectionIsNotSetError("postgres"));await this.closePool(this.master),await Promise.all(this.slaves.map(e=>this.closePool(e))),this.master=void 0,this.slaves=[]}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}createQueryRunner(e){return new PostgresQueryRunner(this,e)}preparePersistentValue(e,I){if(I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null)return e;if(I.type===Boolean)return e===!0?1:0;if(I.type==="date")return DateUtils.mixedDateToDateString(e);if(I.type==="time")return DateUtils.mixedDateToTimeString(e);if(I.type==="datetime"||I.type===Date||I.type==="timestamp"||I.type==="timestamp with time zone"||I.type==="timestamp without time zone")return DateUtils.mixedDateToDate(e);if(["json","jsonb",...this.spatialTypes].indexOf(I.type)>=0)return JSON.stringify(e);if(I.type==="hstore"){if(typeof e=="string")return e;{const oe=ue=>ue===null||typeof ue>"u"?"NULL":`"${`${ue}`.replace(/(?=["\\])/g,"\\")}"`;return Object.keys(e).map(ue=>oe(ue)+"=>"+oe(e[ue])).join(",")}}else{if(I.type==="simple-array")return DateUtils.simpleArrayToString(e);if(I.type==="simple-json")return DateUtils.simpleJsonToString(e);if(I.type==="cube")return I.isArray?`{${e.map(oe=>`"(${oe.join(",")})"`).join(",")}}`:`(${e.join(",")})`;if(I.type==="ltree")return e.split(".").filter(Boolean).join(".").replace(/[\s]+/g,"_");if((I.type==="enum"||I.type==="simple-enum")&&!I.isArray)return""+e}return e}prepareHydratedValue(e,I){if(e==null)return I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e;if(I.type===Boolean)e=!!e;else if(I.type==="datetime"||I.type===Date||I.type==="timestamp"||I.type==="timestamp with time zone"||I.type==="timestamp without time zone")e=DateUtils.normalizeHydratedDate(e);else if(I.type==="date")e=DateUtils.mixedDateToDateString(e);else if(I.type==="time")e=DateUtils.mixedTimeToString(e);else if(I.type==="hstore"){if(I.hstoreType==="object"){const oe=tr=>tr.replace(/\\./g,rr=>rr[1]),ue=/"([^"\\]*(?:\\.[^"\\]*)*)"=>(?:(NULL)|"([^"\\]*(?:\\.[^"\\]*)*)")(?:,|$)/g,bt={};`${e}`.replace(ue,(tr,rr,ir,lr)=>(bt[oe(rr)]=ir?null:oe(lr),"")),e=bt}}else if(I.type==="simple-array")e=DateUtils.stringToSimpleArray(e);else if(I.type==="simple-json")e=DateUtils.stringToSimpleJson(e);else if(I.type==="cube")if(e=e.replace(/[()\s]+/g,""),I.isArray){const oe=/(?:"((?:[\d\s.,])*)")|(?:(NULL))/g,ue=e;e=[];let bt=null;for(;(bt=oe.exec(ue))!==null;)bt[1]!==void 0?e.push(bt[1].split(",").filter(Boolean).map(Number)):e.push(void 0)}else e=e.split(",").filter(Boolean).map(Number);else if(I.type==="enum"||I.type==="simple-enum")if(I.isArray){if(e==="{}")return[];e=e.substr(1,e.length-2).split(",").map(oe=>(oe.startsWith('"')&&oe.endsWith('"')&&(oe=oe.slice(1,-1)),oe=oe.replace(/(\\\\)/g,"\\"),oe.replace(/(\\")/g,'"'))),e=e.map(oe=>!isNaN(+oe)&&I.enum.indexOf(parseInt(oe))>=0?parseInt(oe):oe)}else e=!isNaN(+e)&&I.enum.indexOf(parseInt(e))>=0?parseInt(e):e;else I.type===Number&&(e=isNaN(+e)?e:parseInt(e));return I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e}escapeQueryWithParameters(e,I,oe){const ue=Object.keys(oe).map(tr=>oe[tr]);if(!I||!Object.keys(I).length)return[e,ue];const bt=new Map;return e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(tr,rr,ir)=>{if(!I.hasOwnProperty(ir))return tr;if(bt.has(ir))return this.parametersPrefix+bt.get(ir);let lr=I[ir];return rr?lr.map(dr=>(ue.push(dr),this.createParameter(ir,ue.length-1))).join(", "):typeof lr=="function"?lr():(ue.push(lr),bt.set(ir,ue.length),this.createParameter(ir,ue.length-1))}),[e,ue]}escape(e){return'"'+e+'"'}buildTableName(e,I){let oe=[e];return I&&oe.unshift(I),oe.join(".")}parseTableName(e){const I=this.database,oe=this.schema;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const bt=this.parseTableName(e.name);return{database:e.database||bt.database||I,schema:e.schema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isTableForeignKey(e)){const bt=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||bt.database||I,schema:e.referencedSchema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||oe,tableName:e.tableName};const ue=e.split(".");return{database:I,schema:(ue.length>1?ue[0]:void 0)||oe,tableName:ue.length>1?ue[1]:ue[0]}}normalizeType(e){return e.type===Number||e.type==="int"||e.type==="int4"?"integer":e.type===String||e.type==="varchar"?"character varying":e.type===Date||e.type==="timestamp"?"timestamp without time zone":e.type==="timestamptz"?"timestamp with time zone":e.type==="time"?"time without time zone":e.type==="timetz"?"time with time zone":e.type===Boolean||e.type==="bool"?"boolean":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"enum":e.type==="int2"?"smallint":e.type==="int8"?"bigint":e.type==="decimal"?"numeric":e.type==="float8"||e.type==="float"?"double precision":e.type==="float4"?"real":e.type==="char"?"character":e.type==="varbit"?"bit varying":e.type||""}normalizeDefault(e){const I=e.default;if(I!=null){if(e.isArray&&Array.isArray(I))return`'{${I.map(oe=>`${oe}`).join(",")}}'`;if((e.type==="enum"||e.type==="simple-enum"||typeof I=="number"||typeof I=="string")&&I!==void 0)return`'${I}'`;if(typeof I=="boolean")return I?"true":"false";if(typeof I=="function"){const oe=I();return this.normalizeDatetimeFunction(oe)}return typeof I=="object"?`'${JSON.stringify(I)}'`:`${I}`}}defaultEqual(e,I){if(["json","jsonb"].includes(e.type)&&!["function","undefined"].includes(typeof e.default)){const ue=typeof I.default=="string"?JSON.parse(I.default.substring(1,I.default.length-1)):I.default;return OrmUtils.deepCompare(e.default,ue)}return this.lowerDefaultValueIfNecessary(this.normalizeDefault(e))===I.default}normalizeIsUnique(e){return e.entityMetadata.uniques.some(I=>I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let I=e.type;return e.length?I+="("+e.length+")":e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+="("+e.precision+","+e.scale+")":e.precision!==null&&e.precision!==void 0&&(I+="("+e.precision+")"),e.type==="time without time zone"?I="TIME"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":""):e.type==="time with time zone"?I="TIME"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":"")+" WITH TIME ZONE":e.type==="timestamp without time zone"?I="TIMESTAMP"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":""):e.type==="timestamp with time zone"?I="TIMESTAMP"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":"")+" WITH TIME ZONE":this.spatialTypes.indexOf(e.type)>=0&&(e.spatialFeatureType!=null&&e.srid!=null?I=`${e.type}(${e.spatialFeatureType},${e.srid})`:e.spatialFeatureType!=null?I=`${e.type}(${e.spatialFeatureType})`:I=e.type),e.isArray&&(I+=" array"),I}async obtainMasterConnection(){if(!this.master)throw new TypeORMError("Driver not Connected");return new Promise((e,I)=>{this.master.connect((oe,ue,bt)=>{oe?I(oe):e([ue,bt])})})}async obtainSlaveConnection(){if(!this.slaves.length)return this.obtainMasterConnection();const e=Math.floor(Math.random()*this.slaves.length);return new Promise((I,oe)=>{this.slaves[e].connect((ue,bt,tr)=>{ue?oe(ue):I([bt,tr])})})}createGeneratedMap(e,I){if(I)return Object.keys(I).reduce((oe,ue)=>{const bt=e.findColumnWithDatabaseName(ue);return bt&&OrmUtils.mergeDeep(oe,bt.createValueMap(I[ue])),oe},{})}findChangedColumns(e,I){return I.filter(oe=>{const ue=e.find(tr=>tr.name===oe.databaseName);return ue?ue.name!==oe.databaseName||ue.type!==this.normalizeType(oe)||ue.length!==oe.length||ue.isArray!==oe.isArray||ue.precision!==oe.precision||oe.scale!==void 0&&ue.scale!==oe.scale||ue.comment!==this.escapeComment(oe.comment)||!ue.isGenerated&&!this.defaultEqual(oe,ue)||ue.isPrimary!==oe.isPrimary||ue.isNullable!==oe.isNullable||ue.isUnique!==this.normalizeIsUnique(oe)||ue.enumName!==oe.enumName||ue.enum&&oe.enum&&!OrmUtils.isArraysEqual(ue.enum,oe.enum.map(tr=>tr+""))||ue.isGenerated!==oe.isGenerated||(ue.spatialFeatureType||"").toLowerCase()!==(oe.spatialFeatureType||"").toLowerCase()||ue.srid!==oe.srid||ue.generatedType!==oe.generatedType||(ue.asExpression||"").trim()!==(oe.asExpression||"").trim():!1})}lowerDefaultValueIfNecessary(e){return e&&e.split("'").map((I,oe)=>oe%2===1?I:I.toLowerCase()).join("'")}isReturningSqlSupported(){return!0}isUUIDGenerationSupported(){return!0}isFullTextColumnTypeSupported(){return!1}get uuidGenerator(){return this.options.uuidExtension==="pgcrypto"?"gen_random_uuid()":"uuid_generate_v4()"}createParameter(e,I){return this.parametersPrefix+(I+1)}loadStreamDependency(){try{return PlatformTools.load("pg-query-stream")}catch{throw new TypeORMError("To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.")}}loadDependencies(){try{const e=this.options.driver||PlatformTools.load("pg");this.postgres=e;try{(this.options.nativeDriver||PlatformTools.load("pg-native"))&&this.postgres.native&&(this.postgres=this.postgres.native)}catch{}}catch{throw new DriverPackageNotInstalledError("Postgres","pg")}}async createPool(e,I){const{logger:oe}=this.connection;I=Object.assign({},I);const ue=Object.assign({},{connectionString:I.url,host:I.host,user:I.username,password:I.password,database:I.database,port:I.port,ssl:I.ssl,connectionTimeoutMillis:e.connectTimeoutMS,application_name:e.applicationName??I.applicationName,max:e.poolSize},e.extra||{});e.parseInt8!==void 0&&(this.postgres.defaults&&Object.getOwnPropertyDescriptor(this.postgres.defaults,"parseInt8")?.set?this.postgres.defaults.parseInt8=e.parseInt8:oe.log("warn","Attempted to set parseInt8 option, but the postgres driver does not support setting defaults.parseInt8. This option will be ignored."));const bt=new this.postgres.Pool(ue),tr=e.poolErrorHandler||(rr=>oe.log("warn",`Postgres pool raised an error. ${rr}`));return bt.on("error",tr),new Promise((rr,ir)=>{bt.connect((lr,dr,pr)=>{if(lr)return ir(lr);e.logNotifications&&(dr.on("notice",hr=>{hr&&this.connection.logger.log("info",hr.message)}),dr.on("notification",hr=>{hr&&this.connection.logger.log("info",`Received NOTIFY on channel ${hr.channel}: ${hr.payload}.`)})),pr(),rr(bt)})})}async closePool(e){for(;this.connectedQueryRunners.length;)await this.connectedQueryRunners[0].release();return new Promise((I,oe)=>{e.end(ue=>ue?oe(ue):I())})}executeQuery(e,I){return this.connection.logger.logQuery(I),new Promise((oe,ue)=>{e.query(I,(bt,tr)=>bt?ue(bt):oe(tr))})}normalizeDatetimeFunction(e){const I=e.toUpperCase();if(I.indexOf("CURRENT_TIMESTAMP")!==-1||I.indexOf("CURRENT_DATE")!==-1||I.indexOf("CURRENT_TIME")!==-1||I.indexOf("LOCALTIMESTAMP")!==-1||I.indexOf("LOCALTIME")!==-1){const ue=e.match(/\(\d+\)/);if(I.indexOf("CURRENT_TIMESTAMP")!==-1)return ue?`('now'::text)::timestamp${ue[0]} with time zone`:"now()";if(I==="CURRENT_DATE")return"('now'::text)::date";if(I.indexOf("CURRENT_TIME")!==-1)return ue?`('now'::text)::time${ue[0]} with time zone`:"('now'::text)::time with time zone";if(I.indexOf("LOCALTIMESTAMP")!==-1)return ue?`('now'::text)::timestamp${ue[0]} without time zone`:"('now'::text)::timestamp without time zone";if(I.indexOf("LOCALTIME")!==-1)return ue?`('now'::text)::time${ue[0]} without time zone`:"('now'::text)::time without time zone"}return e}escapeComment(e){return e&&(e=e.replace(/\u0000/g,""),e)}}class ExpoQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async startTransaction(){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive&&typeof this.transaction>"u")throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive&&typeof this.transaction>"u")throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async beforeMigration(){const e=await this.connect();return new Promise((I,oe)=>{e.exec([{sql:"PRAGMA foreign_keys = OFF",args:[]}],!1,ue=>ue?oe(ue):I())})}async afterMigration(){const e=await this.connect();return new Promise((I,oe)=>{e.exec([{sql:"PRAGMA foreign_keys = ON",args:[]}],!1,ue=>ue?oe(ue):I())})}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return new Promise(async(ue,bt)=>{const tr=await this.connect(),rr=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(rr,e,I);const ir=+new Date;tr.transaction(async lr=>{typeof this.transaction>"u"&&(await this.startTransaction(),this.transaction=lr),this.transaction.executeSql(e,I,async(dr,pr)=>{const hr=this.driver.options.maxQueryExecutionTime,yr=+new Date-ir;this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!0,yr,pr,void 0),await rr.wait(),hr&&yr>hr&&this.driver.connection.logger.logQuerySlow(yr,e,I,this);const wr=new QueryResult;if(pr?.hasOwnProperty("rowsAffected")&&(wr.affected=pr.rowsAffected),pr?.hasOwnProperty("rows")){let Tr=[];for(let Ar=0;Ar<pr.rows.length;Ar++)Tr.push(pr.rows.item(Ar));wr.raw=Tr,wr.records=Tr}e.startsWith("INSERT INTO")&&(wr.raw=pr.insertId),ue(oe?wr:wr.raw)},async(dr,pr)=>{this.driver.connection.logger.logQueryError(pr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!1,void 0,void 0,pr),await rr.wait(),bt(new QueryFailedError(e,I,pr))})},async lr=>{await this.rollbackTransaction(),bt(lr)},()=>{this.isTransactionActive=!1,this.transaction=void 0})})}}class ExpoDriver extends AbstractSqliteDriver{constructor(e){super(e),this.database=this.options.database,this.sqlite=this.options.driver}async disconnect(){return new Promise((e,I)=>{try{this.queryRunner=void 0,this.databaseConnection._db.close(),this.databaseConnection=void 0,e()}catch(oe){I(oe)}})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new ExpoQueryRunner(this)),this.queryRunner}createDatabaseConnection(){return new Promise((e,I)=>{try{const oe=this.sqlite.openDatabase(this.options.database);oe.transaction(ue=>{ue.executeSql("PRAGMA foreign_keys = ON",[],(bt,tr)=>{e(oe)},(bt,tr)=>{I({transaction:bt,error:tr})})},ue=>{I(ue)})}catch(oe){I(oe)}})}}class AuroraMysqlQueryRunner extends BaseQueryRunner{constructor(e,I){super(),this.driver=e,this.connection=e.connection,this.client=I,this.broadcaster=new Broadcaster(this)}async connect(){return{}}release(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,await this.client.startTransaction()):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth-1}`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.commitTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.rollbackTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=await this.client.query(e,I),bt=new QueryResult;return bt.raw=ue,ue?.hasOwnProperty("records")&&Array.isArray(ue.records)&&(bt.records=ue.records),ue?.hasOwnProperty("numberOfRecordsUpdated")&&(bt.affected=ue.numberOfRecordsUpdated),oe?bt:bt.raw}stream(e,I,oe,ue){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return new Promise(async(bt,tr)=>{try{const ir=(await this.connect()).query(e,I);oe&&ir.on("end",oe),ue&&ir.on("error",ue),bt(ir)}catch(rr){tr(rr)}})}async getDatabases(){return Promise.resolve([])}async getSchemas(e){throw new TypeORMError("MySql driver does not support table schemas")}async hasDatabase(e){return!!(await this.query(`SELECT * FROM \`INFORMATION_SCHEMA\`.\`SCHEMATA\` WHERE \`SCHEMA_NAME\` = '${e}'`)).length}async getCurrentDatabase(){return(await this.query("SELECT DATABASE() AS `db_name`"))[0].db_name}async hasSchema(e){throw new TypeORMError("MySql driver does not support table schemas")}async getCurrentSchema(){return(await this.query("SELECT SCHEMA() AS `schema_name`"))[0].schema_name}async hasTable(e){const I=this.driver.parseTableName(e),oe=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${I.database}' AND \`TABLE_NAME\` = '${I.tableName}'`;return!!(await this.query(oe)).length}async hasColumn(e,I){const oe=this.driver.parseTableName(e),ue=InstanceChecker.isTableColumn(I)?I.name:I,bt=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${oe.database}' AND \`TABLE_NAME\` = '${oe.tableName}' AND \`COLUMN_NAME\` = '${ue}'`;return!!(await this.query(bt)).length}async createDatabase(e,I){const oe=I?`CREATE DATABASE IF NOT EXISTS \`${e}\``:`CREATE DATABASE \`${e}\``,ue=`DROP DATABASE \`${e}\``;await this.executeQueries(new Query(oe),new Query(ue))}async dropDatabase(e,I){const oe=I?`DROP DATABASE IF EXISTS \`${e}\``:`DROP DATABASE \`${e}\``,ue=`CREATE DATABASE \`${e}\``;await this.executeQueries(new Query(oe),new Query(ue))}async createSchema(e,I){throw new TypeORMError("Schema create queries are not supported by MySql driver.")}async dropSchema(e,I){throw new TypeORMError("Schema drop queries are not supported by MySql driver.")}async createTable(e,I=!1,oe=!0){if(I&&await this.hasTable(e))return Promise.resolve();const ue=[],bt=[];return ue.push(this.createTableSql(e,oe)),bt.push(this.dropTableSql(e)),e.indices.forEach(tr=>bt.push(this.dropIndexSql(e,tr))),oe&&e.foreignKeys.forEach(tr=>bt.push(this.dropForeignKeySql(e,tr))),this.executeQueries(ue,bt)}async dropTable(e,I,oe=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const ue=oe,bt=this.getTablePath(e),tr=await this.getCachedTable(bt),rr=[],ir=[];oe&&tr.foreignKeys.forEach(lr=>rr.push(this.dropForeignKeySql(tr,lr))),tr.indices.forEach(lr=>rr.push(this.dropIndexSql(tr,lr))),rr.push(this.dropTableSql(tr)),ir.push(this.createTableSql(tr,ue)),await this.executeQueries(rr,ir)}async createView(e,I=!1){const oe=[],ue=[];oe.push(this.createViewSql(e)),I&&oe.push(await this.insertViewDefinitionSql(e)),ue.push(this.dropViewSql(e)),I&&ue.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(oe,ue)}async dropView(e){const I=InstanceChecker.isView(e)?e.name:e,oe=await this.getCachedView(I),ue=[],bt=[];ue.push(await this.deleteViewDefinitionSql(oe)),ue.push(this.dropViewSql(oe)),bt.push(await this.insertViewDefinitionSql(oe)),bt.push(this.createViewSql(oe)),await this.executeQueries(ue,bt)}async renameTable(e,I){const oe=[],ue=[],bt=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=bt.clone(),{database:rr}=this.driver.parseTableName(bt);tr.name=rr?`${rr}.${I}`:I,oe.push(new Query(`RENAME TABLE ${this.escapePath(bt)} TO ${this.escapePath(tr)}`)),ue.push(new Query(`RENAME TABLE ${this.escapePath(tr)} TO ${this.escapePath(bt)}`)),tr.indices.forEach(ir=>{const lr=ir.columnNames.map(hr=>`\`${hr}\``).join(", "),dr=this.connection.namingStrategy.indexName(tr,ir.columnNames,ir.where);let pr="";ir.isUnique&&(pr+="UNIQUE "),ir.isSpatial&&(pr+="SPATIAL "),ir.isFulltext&&(pr+="FULLTEXT "),oe.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP INDEX \`${ir.name}\`, ADD ${pr}INDEX \`${dr}\` (${lr})`)),ue.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP INDEX \`${dr}\`, ADD ${pr}INDEX \`${ir.name}\` (${lr})`)),ir.name=dr}),tr.foreignKeys.forEach(ir=>{const lr=ir.columnNames.map(yr=>`\`${yr}\``).join(", "),dr=ir.referencedColumnNames.map(yr=>`\`${yr}\``).join(","),pr=this.connection.namingStrategy.foreignKeyName(tr,ir.columnNames);let hr=`ALTER TABLE ${this.escapePath(tr)} DROP FOREIGN KEY \`${ir.name}\`, ADD CONSTRAINT \`${pr}\` FOREIGN KEY (${lr}) REFERENCES ${this.escapePath(this.getTablePath(ir))}(${dr})`;ir.onDelete&&(hr+=` ON DELETE ${ir.onDelete}`),ir.onUpdate&&(hr+=` ON UPDATE ${ir.onUpdate}`);let _r=`ALTER TABLE ${this.escapePath(tr)} DROP FOREIGN KEY \`${pr}\`, ADD CONSTRAINT \`${ir.name}\` FOREIGN KEY (${lr}) REFERENCES ${this.escapePath(this.getTablePath(ir))}(${dr})`;ir.onDelete&&(_r+=` ON DELETE ${ir.onDelete}`),ir.onUpdate&&(_r+=` ON UPDATE ${ir.onUpdate}`),oe.push(new Query(hr)),ue.push(new Query(_r)),ir.name=pr}),await this.executeQueries(oe,ue),bt.name=tr.name,this.replaceCachedTable(bt,tr)}async addColumn(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone(),bt=[],tr=[],rr=ue.primaryColumns.length>0;if(bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD ${this.buildCreateColumnSql(I,rr,!1)}`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP COLUMN \`${I.name}\``)),I.isPrimary&&rr){const lr=ue.columns.find(hr=>hr.isGenerated&&hr.generationStrategy==="increment");if(lr){const hr=lr.clone();hr.isGenerated=!1,hr.generationStrategy=void 0,bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${I.name}\` ${this.buildCreateColumnSql(hr,!0)}`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${hr.name}\` ${this.buildCreateColumnSql(I,!0)}`))}const dr=ue.primaryColumns;let pr=dr.map(hr=>`\`${hr.name}\``).join(", ");if(bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP PRIMARY KEY`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD PRIMARY KEY (${pr})`)),dr.push(I),pr=dr.map(hr=>`\`${hr.name}\``).join(", "),bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD PRIMARY KEY (${pr})`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP PRIMARY KEY`)),lr){const hr=lr.clone();hr.isGenerated=!1,hr.generationStrategy=void 0,bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${hr.name}\` ${this.buildCreateColumnSql(I,!0)}`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${I.name}\` ${this.buildCreateColumnSql(hr,!0)}`))}}const ir=ue.indices.find(lr=>lr.columnNames.length===1&&lr.columnNames[0]===I.name);if(ir)bt.push(this.createIndexSql(oe,ir)),tr.push(this.dropIndexSql(oe,ir));else if(I.isUnique){const lr=new TableIndex({name:this.connection.namingStrategy.indexName(oe,[I.name]),columnNames:[I.name],isUnique:!0});ue.indices.push(lr),ue.uniques.push(new TableUnique({name:lr.name,columnNames:lr.columnNames})),bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD UNIQUE INDEX \`${lr.name}\` (\`${I.name}\`)`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP INDEX \`${lr.name}\``))}await this.executeQueries(bt,tr),ue.addColumn(I),this.replaceCachedTable(oe,ue)}async addColumns(e,I){for(const oe of I)await this.addColumn(e,oe)}async renameColumn(e,I,oe){const ue=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),bt=InstanceChecker.isTableColumn(I)?I:ue.columns.find(rr=>rr.name===I);if(!bt)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);let tr;InstanceChecker.isTableColumn(oe)?tr=oe:(tr=bt.clone(),tr.name=oe),await this.changeColumn(ue,bt,tr)}async changeColumn(e,I,oe){const ue=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);let bt=ue.clone();const tr=[],rr=[],ir=InstanceChecker.isTableColumn(I)?I:ue.columns.find(lr=>lr.name===I);if(!ir)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);if(oe.isGenerated!==ir.isGenerated&&oe.generationStrategy!=="uuid"||ir.type!==oe.type||ir.length!==oe.length||ir.generatedType!==oe.generatedType)await this.dropColumn(ue,ir),await this.addColumn(ue,oe),bt=ue.clone();else{if(oe.name!==ir.name){tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${ir.name}\` \`${oe.name}\` ${this.buildCreateColumnSql(ir,!0,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${oe.name}\` \`${ir.name}\` ${this.buildCreateColumnSql(ir,!0,!0)}`)),bt.findColumnIndices(ir).forEach(dr=>{dr.columnNames.splice(dr.columnNames.indexOf(ir.name),1),dr.columnNames.push(oe.name);const pr=dr.columnNames.map(yr=>`\`${yr}\``).join(", "),hr=this.connection.namingStrategy.indexName(bt,dr.columnNames,dr.where);let _r="";dr.isUnique&&(_r+="UNIQUE "),dr.isSpatial&&(_r+="SPATIAL "),dr.isFulltext&&(_r+="FULLTEXT "),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP INDEX \`${dr.name}\`, ADD ${_r}INDEX \`${hr}\` (${pr})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP INDEX \`${hr}\`, ADD ${_r}INDEX \`${dr.name}\` (${pr})`)),dr.name=hr}),bt.findColumnForeignKeys(ir).forEach(dr=>{dr.columnNames.splice(dr.columnNames.indexOf(ir.name),1),dr.columnNames.push(oe.name);const pr=dr.columnNames.map(Tr=>`\`${Tr}\``).join(", "),hr=dr.referencedColumnNames.map(Tr=>`\`${Tr}\``).join(","),_r=this.connection.namingStrategy.foreignKeyName(bt,dr.columnNames);let yr=`ALTER TABLE ${this.escapePath(ue)} DROP FOREIGN KEY \`${dr.name}\`, ADD CONSTRAINT \`${_r}\` FOREIGN KEY (${pr}) REFERENCES ${this.escapePath(this.getTablePath(dr))}(${hr})`;dr.onDelete&&(yr+=` ON DELETE ${dr.onDelete}`),dr.onUpdate&&(yr+=` ON UPDATE ${dr.onUpdate}`);let wr=`ALTER TABLE ${this.escapePath(ue)} DROP FOREIGN KEY \`${_r}\`, ADD CONSTRAINT \`${dr.name}\` FOREIGN KEY (${pr}) REFERENCES ${this.escapePath(this.getTablePath(dr))}(${hr})`;dr.onDelete&&(wr+=` ON DELETE ${dr.onDelete}`),dr.onUpdate&&(wr+=` ON UPDATE ${dr.onUpdate}`),tr.push(new Query(yr)),rr.push(new Query(wr)),dr.name=_r});const lr=bt.columns.find(dr=>dr.name===ir.name);bt.columns[bt.columns.indexOf(lr)].name=oe.name,ir.name=oe.name}if(this.isColumnChanged(ir,oe,!0)&&(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${ir.name}\` ${this.buildCreateColumnSql(oe,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${oe.name}\` ${this.buildCreateColumnSql(ir,!0)}`))),oe.isPrimary!==ir.isPrimary){const lr=bt.columns.find(pr=>pr.isGenerated&&pr.generationStrategy==="increment");if(lr){const pr=lr.clone();pr.isGenerated=!1,pr.generationStrategy=void 0,tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${lr.name}\` ${this.buildCreateColumnSql(pr,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${pr.name}\` ${this.buildCreateColumnSql(lr,!0)}`))}const dr=bt.primaryColumns;if(dr.length>0){const pr=dr.map(hr=>`\`${hr.name}\``).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP PRIMARY KEY`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD PRIMARY KEY (${pr})`))}if(oe.isPrimary===!0){dr.push(oe);const pr=bt.columns.find(_r=>_r.name===oe.name);pr.isPrimary=!0;const hr=dr.map(_r=>`\`${_r.name}\``).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD PRIMARY KEY (${hr})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP PRIMARY KEY`))}else{const pr=dr.find(_r=>_r.name===oe.name);dr.splice(dr.indexOf(pr),1);const hr=bt.columns.find(_r=>_r.name===oe.name);if(hr.isPrimary=!1,dr.length>0){const _r=dr.map(yr=>`\`${yr.name}\``).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD PRIMARY KEY (${_r})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP PRIMARY KEY`))}}if(lr){const pr=lr.clone();pr.isGenerated=!1,pr.generationStrategy=void 0,tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${pr.name}\` ${this.buildCreateColumnSql(lr,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} CHANGE \`${lr.name}\` ${this.buildCreateColumnSql(pr,!0)}`))}}if(oe.isUnique!==ir.isUnique)if(oe.isUnique===!0){const lr=new TableIndex({name:this.connection.namingStrategy.indexName(ue,[oe.name]),columnNames:[oe.name],isUnique:!0});bt.indices.push(lr),bt.uniques.push(new TableUnique({name:lr.name,columnNames:lr.columnNames})),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD UNIQUE INDEX \`${lr.name}\` (\`${oe.name}\`)`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP INDEX \`${lr.name}\``))}else{const lr=bt.indices.find(pr=>pr.columnNames.length===1&&pr.isUnique===!0&&!!pr.columnNames.find(hr=>hr===oe.name));bt.indices.splice(bt.indices.indexOf(lr),1);const dr=bt.uniques.find(pr=>pr.name===lr.name);bt.uniques.splice(bt.uniques.indexOf(dr),1),tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} DROP INDEX \`${lr.name}\``)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ADD UNIQUE INDEX \`${lr.name}\` (\`${oe.name}\`)`))}}await this.executeQueries(tr,rr),this.replaceCachedTable(ue,bt)}async changeColumns(e,I){for(const{oldColumn:oe,newColumn:ue}of I)await this.changeColumn(e,oe,ue)}async dropColumn(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableColumn(I)?I:oe.findColumnByName(I);if(!ue)throw new TypeORMError(`Column "${I}" was not found in table "${oe.name}"`);const bt=oe.clone(),tr=[],rr=[];if(ue.isPrimary){const lr=bt.columns.find(hr=>hr.isGenerated&&hr.generationStrategy==="increment");if(lr){const hr=lr.clone();hr.isGenerated=!1,hr.generationStrategy=void 0,tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${lr.name}\` ${this.buildCreateColumnSql(hr,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${hr.name}\` ${this.buildCreateColumnSql(lr,!0)}`))}const dr=bt.primaryColumns.map(hr=>`\`${hr.name}\``).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} DROP PRIMARY KEY`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} ADD PRIMARY KEY (${dr})`));const pr=bt.findColumnByName(ue.name);if(pr.isPrimary=!1,bt.primaryColumns.length>0){const hr=bt.primaryColumns.map(_r=>`\`${_r.name}\``).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} ADD PRIMARY KEY (${hr})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(bt)} DROP PRIMARY KEY`))}if(lr&&lr.name!==ue.name){const hr=lr.clone();hr.isGenerated=!1,hr.generationStrategy=void 0,tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${hr.name}\` ${this.buildCreateColumnSql(lr,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${lr.name}\` ${this.buildCreateColumnSql(hr,!0)}`))}}const ir=bt.indices.find(lr=>lr.columnNames.length===1&&lr.columnNames[0]===ue.name);if(ir)bt.indices.splice(bt.indices.indexOf(ir),1),tr.push(this.dropIndexSql(oe,ir)),rr.push(this.createIndexSql(oe,ir));else if(ue.isUnique){const lr=this.connection.namingStrategy.uniqueConstraintName(oe,[ue.name]),dr=bt.uniques.find(_r=>_r.name===lr);dr&&bt.uniques.splice(bt.uniques.indexOf(dr),1);const pr=this.connection.namingStrategy.indexName(oe,[ue.name]),hr=bt.indices.find(_r=>_r.name===pr);hr&&bt.indices.splice(bt.indices.indexOf(hr),1),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP INDEX \`${pr}\``)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD UNIQUE INDEX \`${pr}\` (\`${ue.name}\`)`))}tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP COLUMN \`${ue.name}\``)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD ${this.buildCreateColumnSql(ue,!0)}`)),await this.executeQueries(tr,rr),bt.removeColumn(ue),this.replaceCachedTable(oe,bt)}async dropColumns(e,I){for(const oe of I)await this.dropColumn(e,oe)}async createPrimaryKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone(),bt=this.createPrimaryKeySql(oe,I),tr=this.dropPrimaryKeySql(oe);await this.executeQueries(bt,tr),ue.columns.forEach(rr=>{I.find(ir=>ir===rr.name)&&(rr.isPrimary=!0)}),this.replaceCachedTable(oe,ue)}async updatePrimaryKeys(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=oe.clone(),bt=I.map(hr=>hr.name),tr=[],rr=[],ir=ue.columns.find(hr=>hr.isGenerated&&hr.generationStrategy==="increment");if(ir){const hr=ir.clone();hr.isGenerated=!1,hr.generationStrategy=void 0,tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${ir.name}\` ${this.buildCreateColumnSql(hr,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${hr.name}\` ${this.buildCreateColumnSql(ir,!0)}`))}const lr=ue.primaryColumns;if(lr.length>0){const hr=lr.map(_r=>`\`${_r.name}\``).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP PRIMARY KEY`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD PRIMARY KEY (${hr})`))}ue.columns.filter(hr=>bt.indexOf(hr.name)!==-1).forEach(hr=>hr.isPrimary=!0);const dr=bt.map(hr=>`\`${hr}\``).join(", ");tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD PRIMARY KEY (${dr})`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP PRIMARY KEY`));const pr=ir||I.find(hr=>hr.isGenerated&&hr.generationStrategy==="increment");if(pr){const hr=pr.clone();hr.isGenerated=!1,hr.generationStrategy=void 0,tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${hr.name}\` ${this.buildCreateColumnSql(pr,!0)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} CHANGE \`${pr.name}\` ${this.buildCreateColumnSql(hr,!0)}`));const _r=ue.columns.find(yr=>yr.name===pr.name);_r.isGenerated=!0,_r.generationStrategy="increment"}await this.executeQueries(tr,rr),this.replaceCachedTable(oe,ue)}async dropPrimaryKey(e){const I=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),oe=this.dropPrimaryKeySql(I),ue=this.createPrimaryKeySql(I,I.primaryColumns.map(bt=>bt.name));await this.executeQueries(oe,ue),I.primaryColumns.forEach(bt=>{bt.isPrimary=!1})}async createUniqueConstraint(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,I){throw new TypeORMError("MySql does not support check constraints.")}async createCheckConstraints(e,I){throw new TypeORMError("MySql does not support check constraints.")}async dropCheckConstraint(e,I){throw new TypeORMError("MySql does not support check constraints.")}async dropCheckConstraints(e,I){throw new TypeORMError("MySql does not support check constraints.")}async createExclusionConstraint(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async createExclusionConstraints(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async dropExclusionConstraint(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async dropExclusionConstraints(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async createForeignKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.foreignKeyName(oe,I.columnNames));const ue=this.createForeignKeySql(oe,I),bt=this.dropForeignKeySql(oe,I);await this.executeQueries(ue,bt),oe.addForeignKey(I)}async createForeignKeys(e,I){const oe=I.map(ue=>this.createForeignKey(e,ue));await Promise.all(oe)}async dropForeignKey(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableForeignKey(I)?I:oe.foreignKeys.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied foreign key was not found in table ${oe.name}`);const bt=this.dropForeignKeySql(oe,ue),tr=this.createForeignKeySql(oe,ue);await this.executeQueries(bt,tr),oe.removeForeignKey(ue)}async dropForeignKeys(e,I){const oe=I.map(ue=>this.dropForeignKey(e,ue));await Promise.all(oe)}async createIndex(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(oe,I));const ue=this.createIndexSql(oe,I),bt=this.dropIndexSql(oe,I);await this.executeQueries(ue,bt),oe.addIndex(I,!0)}async createIndices(e,I){const oe=I.map(ue=>this.createIndex(e,ue));await Promise.all(oe)}async dropIndex(e,I){const oe=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ue=InstanceChecker.isTableIndex(I)?I:oe.indices.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied index ${I} was not found in table ${oe.name}`);ue.name||(ue.name=this.generateIndexName(oe,ue));const bt=this.dropIndexSql(oe,ue),tr=this.createIndexSql(oe,ue);await this.executeQueries(bt,tr),oe.removeIndex(ue,!0)}async dropIndices(e,I){const oe=I.map(ue=>this.dropIndex(e,ue));await Promise.all(oe)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(e){const I=e||this.driver.database;if(I){if(!await this.hasDatabase(I))return Promise.resolve()}else throw new TypeORMError("Can not clear database. No database is specified");const oe=this.isTransactionActive;oe||await this.startTransaction();try{const ue=`SELECT concat('DROP VIEW IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`VIEWS\` WHERE \`TABLE_SCHEMA\` = '${I}'`,bt=await this.query(ue);await Promise.all(bt.map(dr=>this.query(dr.query)));const tr="SET FOREIGN_KEY_CHECKS = 0;",rr=`SELECT concat('DROP TABLE IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_SCHEMA\` = '${I}'`,ir="SET FOREIGN_KEY_CHECKS = 1;";await this.query(tr);const lr=await this.query(rr);await Promise.all(lr.map(dr=>this.query(dr.query))),await this.query(ir),oe||await this.commitTransaction()}catch(ue){try{oe||await this.rollbackTransaction()}catch{}throw ue}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const oe=await this.getCurrentDatabase(),ue=e.map(rr=>{let{database:ir,tableName:lr}=this.driver.parseTableName(rr);return ir||(ir=oe),`(\`t\`.\`schema\` = '${ir}' AND \`t\`.\`name\` = '${lr}')`}).join(" OR "),bt=`SELECT \`t\`.*, \`v\`.\`check_option\` FROM ${this.escapePath(this.getTypeormMetadataTableName())} \`t\` INNER JOIN \`information_schema\`.\`views\` \`v\` ON \`v\`.\`table_schema\` = \`t\`.\`schema\` AND \`v\`.\`table_name\` = \`t\`.\`name\` WHERE \`t\`.\`type\` = '${MetadataTableType.VIEW}' ${ue?`AND (${ue})`:""}`;return(await this.query(bt)).map(rr=>{const ir=new View,lr=rr.schema===oe?void 0:rr.schema;return ir.database=rr.schema,ir.name=this.driver.buildTableName(rr.name,void 0,lr),ir.expression=rr.value,ir})}async loadTables(e){if(e&&e.length===0)return[];const I=[],oe=await this.getCurrentDatabase();if(!e)I.push(...await this.query("SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES`"));else{const Sr="SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES` WHERE "+e.map(Mr=>{let[vr,Lr]=Mr.split(".");return Lr||(Lr=vr,vr=this.driver.database||oe),`(\`TABLE_SCHEMA\` = '${vr}' AND \`TABLE_NAME\` = '${Lr}')`}).join(" OR ");I.push(...await this.query(Sr))}if(I.length===0)return[];const ue=I.map(({TABLE_NAME:Ar,TABLE_SCHEMA:Sr})=>`(\`TABLE_SCHEMA\` = '${Sr}' AND \`TABLE_NAME\` = '${Ar}')`).join(" OR "),bt="SELECT * FROM `INFORMATION_SCHEMA`.`COLUMNS` WHERE "+ue,tr=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` WHERE \`CONSTRAINT_NAME\` = 'PRIMARY' AND (${ue})`,rr="SELECT `SCHEMA_NAME`, `DEFAULT_CHARACTER_SET_NAME` as `CHARSET`, `DEFAULT_COLLATION_NAME` AS `COLLATION` FROM `INFORMATION_SCHEMA`.`SCHEMATA`",lr=`SELECT \`s\`.* FROM \`INFORMATION_SCHEMA\`.\`STATISTICS\` \`s\` LEFT JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`rc\` ON \`s\`.\`INDEX_NAME\` = \`rc\`.\`CONSTRAINT_NAME\` WHERE (${I.map(({TABLE_NAME:Ar,TABLE_SCHEMA:Sr})=>`(\`s\`.\`TABLE_SCHEMA\` = '${Sr}' AND \`s\`.\`TABLE_NAME\` = '${Ar}')`).join(" OR ")}) AND \`s\`.\`INDEX_NAME\` != 'PRIMARY' AND \`rc\`.\`CONSTRAINT_NAME\` IS NULL`,pr="SELECT `kcu`.`TABLE_SCHEMA`, `kcu`.`TABLE_NAME`, `kcu`.`CONSTRAINT_NAME`, `kcu`.`COLUMN_NAME`, `kcu`.`REFERENCED_TABLE_SCHEMA`, `kcu`.`REFERENCED_TABLE_NAME`, `kcu`.`REFERENCED_COLUMN_NAME`, `rc`.`DELETE_RULE` `ON_DELETE`, `rc`.`UPDATE_RULE` `ON_UPDATE` FROM `INFORMATION_SCHEMA`.`KEY_COLUMN_USAGE` `kcu` INNER JOIN `INFORMATION_SCHEMA`.`REFERENTIAL_CONSTRAINTS` `rc` ON `rc`.`constraint_name` = `kcu`.`constraint_name` WHERE "+I.map(({TABLE_NAME:Ar,TABLE_SCHEMA:Sr})=>`(\`kcu\`.\`TABLE_SCHEMA\` = '${Sr}' AND \`kcu\`.\`TABLE_NAME\` = '${Ar}')`).join(" OR "),[hr,_r,yr,wr,Tr]=await Promise.all([this.query(bt),this.query(tr),this.query(rr),this.query(lr),this.query(pr)]);return Promise.all(I.map(async Ar=>{const Sr=new Table,Mr=yr.find($r=>$r.SCHEMA_NAME===Ar.TABLE_SCHEMA),vr=Mr.COLLATION,Lr=Mr.CHARSET,es=Ar.TABLE_SCHEMA===oe?void 0:Ar.TABLE_SCHEMA;Sr.database=Ar.TABLE_SCHEMA,Sr.name=this.driver.buildTableName(Ar.TABLE_NAME,void 0,es),Sr.columns=hr.filter($r=>$r.TABLE_NAME===Ar.TABLE_NAME&&$r.TABLE_SCHEMA===Ar.TABLE_SCHEMA).map($r=>{const ns=wr.filter(Dr=>Dr.TABLE_NAME===Ar.TABLE_NAME&&Dr.TABLE_SCHEMA===Ar.TABLE_SCHEMA&&Dr.COLUMN_NAME===$r.COLUMN_NAME&&parseInt(Dr.NON_UNIQUE,10)===0),Nr=this.connection.entityMetadatas.find(Dr=>this.getTablePath(Sr)===this.getTablePath(Dr)),zr=ns.length>0&&Nr&&Nr.indices.some(Dr=>ns.some(Ur=>Dr.name===Ur.INDEX_NAME&&Dr.synchronize===!1)),Ir=ns.every(Dr=>wr.some(Ur=>Ur.INDEX_NAME===Dr.INDEX_NAME&&Ur.COLUMN_NAME!==$r.COLUMN_NAME)),Or=new TableColumn;if(Or.name=$r.COLUMN_NAME,Or.type=$r.DATA_TYPE.toLowerCase(),Or.unsigned=Or.zerofill?!0:$r.COLUMN_TYPE.indexOf("unsigned")!==-1,this.driver.withWidthColumnTypes.indexOf(Or.type)!==-1){const Dr=$r.COLUMN_TYPE.substring($r.COLUMN_TYPE.indexOf("(")+1,$r.COLUMN_TYPE.indexOf(")"));Or.width=Dr&&!this.isDefaultColumnWidth(Sr,Or,parseInt(Dr))?parseInt(Dr):void 0}if($r.COLUMN_DEFAULT===null||$r.COLUMN_DEFAULT===void 0?Or.default=void 0:Or.default=$r.COLUMN_DEFAULT==="CURRENT_TIMESTAMP"?$r.COLUMN_DEFAULT:`'${$r.COLUMN_DEFAULT}'`,$r.EXTRA.indexOf("on update")!==-1&&(Or.onUpdate=$r.EXTRA.substring($r.EXTRA.indexOf("on update")+10)),$r.GENERATION_EXPRESSION&&(Or.asExpression=$r.GENERATION_EXPRESSION,Or.generatedType=$r.EXTRA.indexOf("VIRTUAL")!==-1?"VIRTUAL":"STORED"),Or.isUnique=ns.length>0&&!zr&&!Ir,Or.isNullable=$r.IS_NULLABLE==="YES",Or.isPrimary=_r.some(Dr=>Dr.TABLE_NAME===$r.TABLE_NAME&&Dr.TABLE_SCHEMA===$r.TABLE_SCHEMA&&Dr.COLUMN_NAME===$r.COLUMN_NAME),Or.zerofill=$r.COLUMN_TYPE.indexOf("zerofill")!==-1,Or.isGenerated=$r.EXTRA.indexOf("auto_increment")!==-1,Or.isGenerated&&(Or.generationStrategy="increment"),Or.comment=typeof $r.COLUMN_COMMENT=="string"&&$r.COLUMN_COMMENT.length===0?void 0:$r.COLUMN_COMMENT,$r.CHARACTER_SET_NAME&&(Or.charset=$r.CHARACTER_SET_NAME===Lr?void 0:$r.CHARACTER_SET_NAME),$r.COLLATION_NAME&&(Or.collation=$r.COLLATION_NAME===vr?void 0:$r.COLLATION_NAME),this.driver.withLengthColumnTypes.indexOf(Or.type)!==-1&&$r.CHARACTER_MAXIMUM_LENGTH){const Dr=$r.CHARACTER_MAXIMUM_LENGTH.toString();Or.length=this.isDefaultColumnLength(Sr,Or,Dr)?"":Dr}if((Or.type==="decimal"||Or.type==="double"||Or.type==="float")&&($r.NUMERIC_PRECISION!==null&&!this.isDefaultColumnPrecision(Sr,Or,$r.NUMERIC_PRECISION)&&(Or.precision=parseInt($r.NUMERIC_PRECISION)),$r.NUMERIC_SCALE!==null&&!this.isDefaultColumnScale(Sr,Or,$r.NUMERIC_SCALE)&&(Or.scale=parseInt($r.NUMERIC_SCALE))),Or.type==="enum"||Or.type==="simple-enum"||Or.type==="set"){const Dr=$r.COLUMN_TYPE,Ur=Dr.substring(Dr.indexOf("(")+1,Dr.lastIndexOf(")")).split(",");Or.enum=Ur.map(kr=>kr.substring(1,kr.length-1)),Or.length=""}return(Or.type==="datetime"||Or.type==="time"||Or.type==="timestamp")&&$r.DATETIME_PRECISION!==null&&$r.DATETIME_PRECISION!==void 0&&!this.isDefaultColumnPrecision(Sr,Or,parseInt($r.DATETIME_PRECISION))&&(Or.precision=parseInt($r.DATETIME_PRECISION)),Or});const ss=OrmUtils.uniq(Tr.filter($r=>$r.TABLE_NAME===Ar.TABLE_NAME&&$r.TABLE_SCHEMA===Ar.TABLE_SCHEMA),$r=>$r.CONSTRAINT_NAME);Sr.foreignKeys=ss.map($r=>{const ns=Tr.filter(Ir=>Ir.CONSTRAINT_NAME===$r.CONSTRAINT_NAME),Nr=$r.REFERENCED_TABLE_SCHEMA===oe?void 0:$r.REFERENCED_TABLE_SCHEMA,zr=this.driver.buildTableName($r.REFERENCED_TABLE_NAME,void 0,Nr);return new TableForeignKey({name:$r.CONSTRAINT_NAME,columnNames:ns.map(Ir=>Ir.COLUMN_NAME),referencedDatabase:$r.REFERENCED_TABLE_SCHEMA,referencedTableName:zr,referencedColumnNames:ns.map(Ir=>Ir.REFERENCED_COLUMN_NAME),onDelete:$r.ON_DELETE,onUpdate:$r.ON_UPDATE})});const os=OrmUtils.uniq(wr.filter($r=>$r.TABLE_NAME===Ar.TABLE_NAME&&$r.TABLE_SCHEMA===Ar.TABLE_SCHEMA),$r=>$r.INDEX_NAME);return Sr.indices=os.map($r=>{const ns=wr.filter(zr=>zr.TABLE_SCHEMA===$r.TABLE_SCHEMA&&zr.TABLE_NAME===$r.TABLE_NAME&&zr.INDEX_NAME===$r.INDEX_NAME),Nr=parseInt($r.NON_UNIQUE,10);return new TableIndex({table:Sr,name:$r.INDEX_NAME,columnNames:ns.map(zr=>zr.COLUMN_NAME),isUnique:Nr===0,isSpatial:$r.INDEX_TYPE==="SPATIAL",isFulltext:$r.INDEX_TYPE==="FULLTEXT"})}),Sr}))}createTableSql(e,I){const oe=e.columns.map(bt=>this.buildCreateColumnSql(bt,!0)).join(", ");let ue=`CREATE TABLE ${this.escapePath(e)} (${oe}`;if(e.columns.filter(bt=>bt.isUnique).forEach(bt=>{const tr=e.indices.some(ir=>ir.columnNames.length===1&&!!ir.isUnique&&ir.columnNames.indexOf(bt.name)!==-1),rr=e.uniques.some(ir=>ir.columnNames.length===1&&ir.columnNames.indexOf(bt.name)!==-1);!tr&&!rr&&e.indices.push(new TableIndex({name:this.connection.namingStrategy.uniqueConstraintName(e,[bt.name]),columnNames:[bt.name],isUnique:!0}))}),e.uniques.length>0&&e.uniques.forEach(bt=>{e.indices.some(rr=>rr.name===bt.name)||e.indices.push(new TableIndex({name:bt.name,columnNames:bt.columnNames,isUnique:!0}))}),e.indices.length>0){const bt=e.indices.map(tr=>{const rr=tr.columnNames.map(lr=>`\`${lr}\``).join(", ");tr.name||(tr.name=this.connection.namingStrategy.indexName(e,tr.columnNames,tr.where));let ir="";return tr.isUnique&&(ir+="UNIQUE "),tr.isSpatial&&(ir+="SPATIAL "),tr.isFulltext&&(ir+="FULLTEXT "),`${ir}INDEX \`${tr.name}\` (${rr})`}).join(", ");ue+=`, ${bt}`}if(e.foreignKeys.length>0&&I){const bt=e.foreignKeys.map(tr=>{const rr=tr.columnNames.map(dr=>`\`${dr}\``).join(", ");tr.name||(tr.name=this.connection.namingStrategy.foreignKeyName(e,tr.columnNames));const ir=tr.referencedColumnNames.map(dr=>`\`${dr}\``).join(", ");let lr=`CONSTRAINT \`${tr.name}\` FOREIGN KEY (${rr}) REFERENCES ${this.escapePath(this.getTablePath(tr))} (${ir})`;return tr.onDelete&&(lr+=` ON DELETE ${tr.onDelete}`),tr.onUpdate&&(lr+=` ON UPDATE ${tr.onUpdate}`),lr}).join(", ");ue+=`, ${bt}`}if(e.primaryColumns.length>0){const bt=e.primaryColumns.map(tr=>`\`${tr.name}\``).join(", ");ue+=`, PRIMARY KEY (${bt})`}return ue+=`) ENGINE=${e.engine||"InnoDB"}`,new Query(ue)}dropTableSql(e){return new Query(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){return typeof e.expression=="string"?new Query(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression}`):new Query(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const I=await this.getCurrentDatabase(),oe=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:MetadataTableType.VIEW,schema:I,name:e.name,value:oe})}dropViewSql(e){return new Query(`DROP VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const I=await this.getCurrentDatabase(),oe=InstanceChecker.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:MetadataTableType.VIEW,schema:I,name:oe})}createIndexSql(e,I){const oe=I.columnNames.map(bt=>`\`${bt}\``).join(", ");let ue="";return I.isUnique&&(ue+="UNIQUE "),I.isSpatial&&(ue+="SPATIAL "),I.isFulltext&&(ue+="FULLTEXT "),new Query(`CREATE ${ue}INDEX \`${I.name}\` ON ${this.escapePath(e)} (${oe})`)}dropIndexSql(e,I){let oe=InstanceChecker.isTableIndex(I)?I.name:I;return new Query(`DROP INDEX \`${oe}\` ON ${this.escapePath(e)}`)}createPrimaryKeySql(e,I){const oe=I.map(ue=>`\`${ue}\``).join(", ");return new Query(`ALTER TABLE ${this.escapePath(e)} ADD PRIMARY KEY (${oe})`)}dropPrimaryKeySql(e){return new Query(`ALTER TABLE ${this.escapePath(e)} DROP PRIMARY KEY`)}createForeignKeySql(e,I){const oe=I.columnNames.map(tr=>`\`${tr}\``).join(", "),ue=I.referencedColumnNames.map(tr=>`\`${tr}\``).join(",");let bt=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${I.name}\` FOREIGN KEY (${oe}) REFERENCES ${this.escapePath(this.getTablePath(I))}(${ue})`;return I.onDelete&&(bt+=` ON DELETE ${I.onDelete}`),I.onUpdate&&(bt+=` ON UPDATE ${I.onUpdate}`),new Query(bt)}dropForeignKeySql(e,I){const oe=InstanceChecker.isTableForeignKey(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP FOREIGN KEY \`${oe}\``)}escapeComment(e){return!e||e.length===0?"''":(e=e.replace(/\\/g,"\\\\").replace(/'/g,"''").replace(/\u0000/g,""),`'${e}'`)}escapePath(e){const{database:I,tableName:oe}=this.driver.parseTableName(e);return I&&I!==this.driver.database?`\`${I}\`.\`${oe}\``:`\`${oe}\``}buildCreateColumnSql(e,I,oe=!1){let ue="";return oe?ue=this.connection.driver.createFullType(e):ue=`\`${e.name}\` ${this.connection.driver.createFullType(e)}`,e.asExpression&&(ue+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`),e.zerofill?ue+=" ZEROFILL":e.unsigned&&(ue+=" UNSIGNED"),e.enum&&(ue+=` (${e.enum.map(bt=>"'"+bt+"'").join(", ")})`),e.charset&&(ue+=` CHARACTER SET "${e.charset}"`),e.collation&&(ue+=` COLLATE "${e.collation}"`),e.isNullable||(ue+=" NOT NULL"),e.isNullable&&(ue+=" NULL"),e.isPrimary&&!I&&(ue+=" PRIMARY KEY"),e.isGenerated&&e.generationStrategy==="increment"&&(ue+=" AUTO_INCREMENT"),e.comment&&(ue+=` COMMENT ${this.escapeComment(e.comment)}`),e.default!==void 0&&e.default!==null&&(ue+=` DEFAULT ${e.default}`),e.onUpdate&&(ue+=` ON UPDATE ${e.onUpdate}`),ue}isDefaultColumnWidth(e,I,oe){if(this.connection.hasMetadata(e.name)){const tr=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(tr&&tr.width)return!1}const ue=this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].width;if(ue){const tr=["int","tinyint","smallint","mediumint"].indexOf(I.type)!==-1;return I.unsigned&&tr?ue-1===oe:ue===oe}return!1}changeTableComment(e,I){throw new TypeORMError("aurora-mysql driver does not support change table comment.")}}class AuroraMysqlDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["bit","int","integer","tinyint","smallint","mediumint","bigint","float","double","double precision","real","decimal","dec","numeric","fixed","bool","boolean","date","datetime","timestamp","time","year","char","nchar","national char","varchar","nvarchar","national varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","set","binary","varbinary","json","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.supportedUpsertTypes=["on-duplicate-key-update"],this.spatialTypes=["geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.withLengthColumnTypes=["char","varchar","nvarchar","binary","varbinary"],this.withWidthColumnTypes=["bit","tinyint","smallint","mediumint","int","integer","bigint"],this.withPrecisionColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real","time","datetime","timestamp"],this.withScaleColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real"],this.unsignedAndZerofillTypes=["int","integer","smallint","tinyint","mediumint","bigint","decimal","dec","numeric","fixed","float","double","double precision","real"],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:"CURRENT_TIMESTAMP(6)",updateDate:"datetime",updateDatePrecision:6,updateDateDefault:"CURRENT_TIMESTAMP(6)",deleteDate:"datetime",deleteDatePrecision:6,deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255},"national varchar":{length:255},char:{length:1},binary:{length:1},varbinary:{length:255},decimal:{precision:10,scale:0},dec:{precision:10,scale:0},numeric:{precision:10,scale:0},fixed:{precision:10,scale:0},float:{precision:12},double:{precision:22},time:{precision:0},datetime:{precision:0},timestamp:{precision:0},bit:{width:1},int:{width:11},integer:{width:11},tinyint:{width:4},smallint:{width:6},mediumint:{width:9},bigint:{width:20}},this.maxAliasLength=63,this.cteCapabilities={enabled:!1},this.connection=e,this.options=e.options,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,oe)=>this.connection.logger.logQuery(I,oe),this.options.serviceConfigOptions,this.options.formatOptions),this.database=DriverUtils.buildDriverOptions(this.options).database}async connect(){if(!this.database){const e=await this.createQueryRunner("master");this.database=await e.getCurrentDatabase(),await e.release()}}afterConnect(){return Promise.resolve()}async disconnect(){}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}createQueryRunner(e){return new AuroraMysqlQueryRunner(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,oe)=>this.connection.logger.logQuery(I,oe),this.options.serviceConfigOptions,this.options.formatOptions))}escapeQueryWithParameters(e,I,oe){const ue=Object.keys(oe).map(bt=>oe[bt]);return!I||!Object.keys(I).length?[e,ue]:(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(bt,tr,rr)=>{if(!I.hasOwnProperty(rr))return bt;let ir=I[rr];return tr?ir.map(lr=>(ue.push(lr),this.createParameter(rr,ue.length-1))).join(", "):typeof ir=="function"?ir():(ue.push(ir),this.createParameter(rr,ue.length-1))}),[e,ue])}escape(e){return"`"+e+"`"}buildTableName(e,I,oe){let ue=[e];return oe&&ue.unshift(oe),ue.join(".")}parseTableName(e){const I=this.database,oe=void 0;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const bt=this.parseTableName(e.name);return{database:e.database||bt.database||I,schema:e.schema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isTableForeignKey(e)){const bt=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||bt.database||I,schema:e.referencedSchema||bt.schema||oe,tableName:bt.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||oe,tableName:e.tableName};const ue=e.split(".");return{database:(ue.length>1?ue[0]:void 0)||I,schema:oe,tableName:ue.length>1?ue[1]:ue[0]}}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),!this.options.formatOptions||this.options.formatOptions.castParameters!==!1?this.client.preparePersistentValue(e,I):e==null?e:I.type===Boolean?e===!0?1:0:I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="time"?DateUtils.mixedDateToTimeString(e):I.type==="json"?JSON.stringify(e):I.type==="timestamp"||I.type==="datetime"||I.type===Date?DateUtils.mixedDateToDate(e):I.type==="simple-array"||I.type==="set"?DateUtils.simpleArrayToString(e):I.type==="simple-json"?DateUtils.simpleJsonToString(e):I.type==="enum"||I.type==="simple-enum"?""+e:e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:!this.options.formatOptions||this.options.formatOptions.castParameters!==!1?this.client.prepareHydratedValue(e,I):(I.type===Boolean||I.type==="bool"||I.type==="boolean"?e=!!e:I.type==="datetime"||I.type===Date?e=DateUtils.normalizeHydratedDate(e):I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="json"?e=typeof e=="string"?JSON.parse(e):e:I.type==="time"?e=DateUtils.mixedTimeToString(e):I.type==="simple-array"||I.type==="set"?e=DateUtils.stringToSimpleArray(e):I.type==="simple-json"?e=DateUtils.stringToSimpleJson(e):(I.type==="enum"||I.type==="simple-enum")&&I.enum&&!isNaN(e)&&I.enum.indexOf(parseInt(e))>=0?e=parseInt(e):I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}normalizeType(e){return e.type===Number||e.type==="integer"?"int":e.type===String?"varchar":e.type===Date?"datetime":e.type===Buffer$7?"blob":e.type===Boolean?"tinyint":e.type==="uuid"?"varchar":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"enum":e.type==="double precision"||e.type==="real"?"double":e.type==="dec"||e.type==="numeric"||e.type==="fixed"?"decimal":e.type==="bool"||e.type==="boolean"?"tinyint":e.type==="nvarchar"||e.type==="national varchar"?"varchar":e.type==="nchar"||e.type==="national char"?"char":e.type||""}normalizeDefault(e){const I=e.default;if(I!==null){if((e.type==="enum"||e.type==="simple-enum")&&I!==void 0)return`'${I}'`;if(e.type==="set"&&I!==void 0)return`'${DateUtils.simpleArrayToString(I)}'`;if(typeof I=="number")return`${I}`;if(typeof I=="boolean")return I?"1":"0";if(typeof I=="function")return I();if(typeof I=="string")return`'${I}'`;if(I!==void 0)return`${I}`}}normalizeIsUnique(e){return e.entityMetadata.indices.some(I=>I.isUnique&&I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){if(e.length)return e.length.toString();if(e.generationStrategy==="uuid")return"36";switch(e.type){case String:case"varchar":case"nvarchar":case"national varchar":return"255";case"varbinary":return"255";default:return""}}createFullType(e){let I=e.type;return this.getColumnLength(e)?I+=`(${this.getColumnLength(e)})`:e.width?I+=`(${e.width})`:e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+=`(${e.precision},${e.scale})`:e.precision!==null&&e.precision!==void 0&&(I+=`(${e.precision})`),e.isArray&&(I+=" array"),I}obtainMasterConnection(){return new Promise((e,I)=>{this.poolCluster?this.poolCluster.getConnection("MASTER",(oe,ue)=>{oe?I(oe):e(this.prepareDbConnection(ue))}):this.pool?this.pool.getConnection((oe,ue)=>{oe?I(oe):e(this.prepareDbConnection(ue))}):I(new TypeORMError("Connection is not established with mysql database"))})}obtainSlaveConnection(){return this.poolCluster?new Promise((e,I)=>{this.poolCluster.getConnection("SLAVE*",(oe,ue)=>{oe?I(oe):e(this.prepareDbConnection(ue))})}):this.obtainMasterConnection()}createGeneratedMap(e,I,oe){const ue=e.generatedColumns.reduce((bt,tr)=>{let rr;return tr.generationStrategy==="increment"&&I.insertId&&(rr=I.insertId+oe),OrmUtils.mergeDeep(bt,tr.createValueMap(rr))},{});return Object.keys(ue).length>0?ue:void 0}findChangedColumns(e,I){return I.filter(oe=>{const ue=e.find(tr=>tr.name===oe.databaseName);if(!ue)return!1;let bt=oe.length;return!bt&&oe.generationStrategy==="uuid"&&(bt=this.getColumnLength(oe)),ue.name!==oe.databaseName||ue.type!==this.normalizeType(oe)||ue.length!==bt||ue.width!==oe.width||ue.precision!==oe.precision||ue.scale!==oe.scale||ue.zerofill!==oe.zerofill||ue.unsigned!==oe.unsigned||ue.asExpression!==oe.asExpression||ue.generatedType!==oe.generatedType||ue.comment!==this.escapeComment(oe.comment)||!this.compareDefaultValues(this.normalizeDefault(oe),ue.default)||ue.enum&&oe.enum&&!OrmUtils.isArraysEqual(ue.enum,oe.enum.map(tr=>tr+""))||ue.onUpdate!==oe.onUpdate||ue.isPrimary!==oe.isPrimary||ue.isNullable!==oe.isNullable||ue.isUnique!==this.normalizeIsUnique(oe)||oe.generationStrategy!=="uuid"&&ue.isGenerated!==oe.isGenerated})}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!0}createParameter(e,I){return"?"}loadDependencies(){const e=this.options.driver||PlatformTools.load("typeorm-aurora-data-api-driver");this.DataApiDriver=e,this.DataApiDriver=this.DataApiDriver.default||this.DataApiDriver}createConnectionOptions(e,I){return I=Object.assign({},I,DriverUtils.buildDriverOptions(I)),Object.assign({},{resourceArn:e.resourceArn,secretArn:e.secretArn,database:e.database,region:e.region,type:e.type},{host:I.host,user:I.username,password:I.password,database:I.database,port:I.port,ssl:e.ssl},e.extra||{})}async createPool(e){return{}}prepareDbConnection(e){const{logger:I}=this.connection;return e.listeners("error").length===0&&e.on("error",oe=>I.log("warn",`MySQL connection raised an error. ${oe}`)),e}compareDefaultValues(e,I){return typeof e=="string"&&typeof I=="string"&&(e=e.replace(/^'+|'+$/g,""),I=I.replace(/^'+|'+$/g,"")),e===I}escapeComment(e){return e&&(e=e.replace(/\u0000/g,""),e)}}class PostgresQueryRunnerWrapper extends PostgresQueryRunner{constructor(e,I){super(e,I)}}class AuroraPostgresQueryRunner extends PostgresQueryRunnerWrapper{constructor(e,I,oe){super(e,oe),this.client=I}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.mode==="slave"&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(([e,I])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=I,this.databaseConnection)):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(([e,I])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=I,this.databaseConnection)),this.databaseConnectionPromise)}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,await this.client.startTransaction()):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth} - 1`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.commitTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.rollbackTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=await this.client.query(e,I),bt=new QueryResult;return bt.raw=ue,ue?.hasOwnProperty("records")&&Array.isArray(ue.records)&&(bt.records=ue.records),ue?.hasOwnProperty("numberOfRecordsUpdated")&&(bt.affected=ue.numberOfRecordsUpdated),oe?bt:bt.raw}changeTableComment(e,I){throw new TypeORMError("aurora-postgres driver does not support change comment.")}}class PostgresWrapper extends PostgresDriver{}class AuroraPostgresDriver extends PostgresWrapper{constructor(e){super(),this.transactionSupport="nested",this.connection=e,this.options=e.options,this.isReplicated=!1,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,oe)=>this.connection.logger.logQuery(I,oe),this.options.serviceConfigOptions,this.options.formatOptions),this.database=DriverUtils.buildDriverOptions(this.options).database}async connect(){}async disconnect(){}createQueryRunner(e){return new AuroraPostgresQueryRunner(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,oe)=>this.connection.logger.logQuery(I,oe),this.options.serviceConfigOptions,this.options.formatOptions),e)}preparePersistentValue(e,I){return this.options.formatOptions&&this.options.formatOptions.castParameters===!1?super.preparePersistentValue(e,I):(I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),this.client.preparePersistentValue(e,I))}prepareHydratedValue(e,I){return this.options.formatOptions&&this.options.formatOptions.castParameters===!1?super.prepareHydratedValue(e,I):(I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),this.client.prepareHydratedValue(e,I))}loadDependencies(){const e=this.options.driver||PlatformTools.load("typeorm-aurora-data-api-driver"),{pg:I}=e;this.DataApiDriver=I}executeQuery(e,I){return this.connection.query(I)}async afterConnect(){const e=await this.checkMetadataForExtensions();return e.hasExtensions&&await this.enableExtensions(e,this.connection),Promise.resolve()}}class CapacitorQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async executeSet(e){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return(await this.connect()).executeSet(e,!1)}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=await this.connect();this.driver.connection.logger.logQuery(e,I,this);const bt=e.substring(0,e.indexOf(" ")!==-1?e.indexOf(" "):void 0);try{let tr;["BEGIN","ROLLBACK","COMMIT","CREATE","ALTER","DROP"].indexOf(bt)!==-1?tr=await ue.execute(e,!1):["INSERT","UPDATE","DELETE","PRAGMA"].indexOf(bt)!==-1?tr=await ue.run(e,I,!1):tr=await ue.query(e,I||[]);const rr=new QueryResult;return tr?.hasOwnProperty("values")&&(rr.raw=tr.values,rr.records=tr.values),tr?.hasOwnProperty("changes")&&(rr.affected=tr.changes.changes,rr.raw=tr.changes.lastId||tr.changes.changes),oe?rr:rr.raw}catch(tr){throw this.driver.connection.logger.logQueryError(tr,e,I,this),new QueryFailedError(e,I,tr)}}parametrize(e){return Object.keys(e).map(I=>`"${I}"=?`)}}class CapacitorDriver extends AbstractSqliteDriver{constructor(e){super(e),this.database=this.options.database,this.driver=this.options.driver,this.sqlite=this.options.driver}async connect(){this.databaseConnection=this.createDatabaseConnection(),await this.databaseConnection}async disconnect(){return this.queryRunner=void 0,(await this.databaseConnection).close().then(()=>{this.databaseConnection=void 0})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new CapacitorQueryRunner(this)),this.queryRunner}async createDatabaseConnection(){const e=this.options.mode||"no-encryption",I=e!=="no-encryption",oe=typeof this.options.version>"u"?1:this.options.version,ue=await this.sqlite.createConnection(this.options.database,I,e,oe);return await ue.open(),await ue.run("PRAGMA foreign_keys = ON"),this.options.journalMode&&["DELETE","TRUNCATE","PERSIST","MEMORY","WAL","OFF"].indexOf(this.options.journalMode)!==-1&&await ue.run(`PRAGMA journal_mode = ${this.options.journalMode}`),ue}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new DriverPackageNotInstalledError("Capacitor","@capacitor-community/sqlite")}}class SpannerQueryRunner extends BaseQueryRunner{constructor(e,I){super(),this.driver=e,this.connection=e.connection,this.mode=I,this.broadcaster=new Broadcaster(this)}async connect(){if(this.session)return Promise.resolve(this.session);const[e]=await this.driver.instanceDatabase.createSession({});return this.session=e,this.sessionTransaction=await e.transaction(),this.session}async release(){return this.isReleased=!0,this.session&&await this.session.delete(),this.session=void 0,Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}await this.connect(),await this.sessionTransaction.begin(),this.connection.logger.logQuery("START TRANSACTION"),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),await this.sessionTransaction.commit(),this.connection.logger.logQuery("COMMIT"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),await this.sessionTransaction.rollback(),this.connection.logger.logQuery("ROLLBACK"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,oe=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ue=new BroadcasterResult;try{const bt=+new Date;await this.connect();let tr;const rr=e.startsWith("SELECT"),ir=rr&&!this.isTransactionActive?this.driver.instanceDatabase:this.sessionTransaction;!this.isTransactionActive&&!rr&&await this.sessionTransaction.begin();try{this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(ue,e,I),tr=await ir.run({sql:e,params:I?I.reduce((_r,yr,wr)=>(_r["param"+wr]=yr,_r),{}):void 0,json:!0}),!this.isTransactionActive&&!rr&&await this.sessionTransaction.commit()}catch(_r){try{!this.isTransactionActive&&!rr&&await this.sessionTransaction.rollback()}catch{}throw _r}const lr=this.driver.options.maxQueryExecutionTime,pr=+new Date-bt;this.broadcaster.broadcastAfterQueryEvent(ue,e,I,!0,pr,tr,void 0),lr&&pr>lr&&this.driver.connection.logger.logQuerySlow(pr,e,I,this);const hr=new QueryResult;return hr.raw=tr,hr.records=tr?tr[0]:[],tr&&tr[1]&&tr[1].rowCountExact&&(hr.affected=parseInt(tr[1].rowCountExact)),oe?hr:hr.records}catch(bt){throw this.driver.connection.logger.logQueryError(bt,e,I,this),this.broadcaster.broadcastAfterQueryEvent(ue,e,I,!1,void 0,void 0,bt),new QueryFailedError(e,I,bt)}finally{await ue.wait()}}async updateDDL(e,I){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;this.driver.connection.logger.logQuery(e,I,this);try{const oe=+new Date,[ue]=await this.driver.instanceDatabase.updateSchema(e);await ue.promise();const bt=this.driver.options.maxQueryExecutionTime,rr=+new Date-oe;bt&&rr>bt&&this.driver.connection.logger.logQuerySlow(rr,e,I,this)}catch(oe){throw this.driver.connection.logger.logQueryError(oe,e,I,this),new QueryFailedError(e,I,oe)}}async stream(e,I,oe,ue){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;try{this.driver.connection.logger.logQuery(e,I,this);const bt={sql:e,params:I?I.reduce((rr,ir,lr)=>(rr["param"+lr]=ir,rr),{}):void 0,json:!0},tr=this.driver.instanceDatabase.runStream(bt);return oe&&tr.on("end",oe),ue&&tr.on("error",ue),tr}catch(bt){throw this.driver.connection.logger.logQueryError(bt,e,I,this),new QueryFailedError(e,I,bt)}}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){throw new TypeORMError("Check database queries are not supported by Spanner driver.")}async getCurrentDatabase(){throw new TypeORMError("Check database queries are not supported by Spanner driver.")}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){throw new TypeORMError("Check schema queries are not supported by Spanner driver.")}async hasTable(e){const oe=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` = '${e instanceof Table?e.name:e}'`;return!!(await this.query(oe)).length}async hasColumn(e,I){const ue=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` = '${e instanceof Table?e.name:e}' AND \`COLUMN_NAME\` = '${I}'`;return!!(await this.query(ue)).length}async createDatabase(e,I){if(I&&await this.hasDatabase(e))return Promise.resolve();const oe=`CREATE DATABASE "${e}"`,ue=`DROP DATABASE "${e}"`;await this.executeQueries(new Query(oe),new Query(ue))}async dropDatabase(e,I){const oe=I?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,ue=`CREATE DATABASE "${e}"`;await this.executeQueries(new Query(oe),new Query(ue))}async createSchema(e,I){return Promise.resolve()}async dropSchema(e,I,oe){return Promise.resolve()}async createTable(e,I=!1,oe=!0,ue=!0){if(I&&await this.hasTable(e))return Promise.resolve();const bt=[],tr=[];bt.push(this.createTableSql(e,oe)),tr.push(this.dropTableSql(e)),oe&&e.foreignKeys.forEach(ir=>tr.push(this.dropForeignKeySql(e,ir))),ue&&e.indices.forEach(ir=>{ir.name||(ir.name=this.connection.namingStrategy.indexName(e,ir.columnNames,ir.where)),bt.push(this.createIndexSql(e,ir)),tr.push(this.dropIndexSql(e,ir))});const rr=e.columns.filter(ir=>ir.generatedType&&ir.asExpression);for(const ir of rr){const lr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:ir.name,value:ir.asExpression}),dr=this.deleteTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:ir.name});bt.push(lr),tr.push(dr)}await this.executeQueries(bt,tr)}async dropTable(e,I,oe=!0,ue=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const bt=oe,tr=this.getTablePath(e),rr=await this.getCachedTable(tr),ir=[],lr=[];ue&&rr.indices.forEach(pr=>{ir.push(this.dropIndexSql(rr,pr)),lr.push(this.createIndexSql(rr,pr))}),oe&&rr.foreignKeys.forEach(pr=>ir.push(this.dropForeignKeySql(rr,pr))),ir.push(this.dropTableSql(rr)),lr.push(this.createTableSql(rr,bt));const dr=rr.columns.filter(pr=>pr.generatedType&&pr.asExpression);for(const pr of dr){const hr=this.deleteTypeormMetadataSql({table:rr.name,type:MetadataTableType.GENERATED_COLUMN,name:pr.name}),_r=this.insertTypeormMetadataSql({table:rr.name,type:MetadataTableType.GENERATED_COLUMN,name:pr.name,value:pr.asExpression});ir.push(hr),lr.push(_r)}await this.executeQueries(ir,lr)}async createView(e){const I=[],oe=[];I.push(this.createViewSql(e)),I.push(await this.insertViewDefinitionSql(e)),oe.push(this.dropViewSql(e)),oe.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(I,oe)}async dropView(e){const I=e instanceof View?e.name:e,oe=await this.getCachedView(I),ue=[],bt=[];ue.push(await this.deleteViewDefinitionSql(oe)),ue.push(this.dropViewSql(oe)),bt.push(await this.insertViewDefinitionSql(oe)),bt.push(this.createViewSql(oe)),await this.executeQueries(ue,bt)}async renameTable(e,I){throw new TypeORMError("Rename table queries are not supported by Spanner driver.")}async addColumn(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e),ue=oe.clone(),bt=[],tr=[];bt.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD ${this.buildCreateColumnSql(I)}`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP COLUMN ${this.driver.escape(I.name)}`));const rr=ue.indices.find(ir=>ir.columnNames.length===1&&ir.columnNames[0]===I.name);if(rr)bt.push(this.createIndexSql(oe,rr)),tr.push(this.dropIndexSql(oe,rr));else if(I.isUnique){const ir=new TableIndex({name:this.connection.namingStrategy.indexName(oe,[I.name]),columnNames:[I.name],isUnique:!0});ue.indices.push(ir),ue.uniques.push(new TableUnique({name:ir.name,columnNames:ir.columnNames})),bt.push(this.createIndexSql(oe,ir)),tr.push(this.dropIndexSql(oe,ir))}if(I.generatedType&&I.asExpression){const ir=this.insertTypeormMetadataSql({table:oe.name,type:MetadataTableType.GENERATED_COLUMN,name:I.name,value:I.asExpression}),lr=this.deleteTypeormMetadataSql({table:oe.name,type:MetadataTableType.GENERATED_COLUMN,name:I.name});bt.push(ir),tr.push(lr)}await this.executeQueries(bt,tr),ue.addColumn(I),this.replaceCachedTable(oe,ue)}async addColumns(e,I){for(const oe of I)await this.addColumn(e,oe)}async renameColumn(e,I,oe){const ue=e instanceof Table?e:await this.getCachedTable(e),bt=I instanceof TableColumn?I:ue.columns.find(rr=>rr.name===I);if(!bt)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);let tr;return oe instanceof TableColumn?tr=oe:(tr=bt.clone(),tr.name=oe),this.changeColumn(ue,bt,tr)}async changeColumn(e,I,oe){const ue=e instanceof Table?e:await this.getCachedTable(e);let bt=ue.clone();const tr=[],rr=[],ir=I instanceof TableColumn?I:ue.columns.find(lr=>lr.name===I);if(!ir)throw new TypeORMError(`Column "${I}" was not found in the "${ue.name}" table.`);if(ir.name!==oe.name||ir.type!==oe.type||ir.length!==oe.length||ir.isArray!==oe.isArray||ir.generatedType!==oe.generatedType||ir.asExpression!==oe.asExpression)await this.dropColumn(ue,ir),await this.addColumn(ue,oe),bt=ue.clone();else if((oe.precision!==ir.precision||oe.scale!==ir.scale)&&(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${this.driver.createFullType(oe)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${oe.name}" TYPE ${this.driver.createFullType(ir)}`))),ir.isNullable!==oe.isNullable&&(oe.isNullable?(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${ir.name}" DROP NOT NULL`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${ir.name}" SET NOT NULL`))):(tr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${ir.name}" SET NOT NULL`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(ue)} ALTER COLUMN "${ir.name}" DROP NOT NULL`)))),oe.isUnique!==ir.isUnique)if(oe.isUnique===!0){const lr=new TableIndex({name:this.connection.namingStrategy.indexName(ue,[oe.name]),columnNames:[oe.name],isUnique:!0});bt.indices.push(lr),bt.uniques.push(new TableUnique({name:lr.name,columnNames:lr.columnNames})),tr.push(this.createIndexSql(ue,lr)),rr.push(this.dropIndexSql(ue,lr))}else{const lr=bt.indices.find(pr=>pr.columnNames.length===1&&pr.isUnique===!0&&!!pr.columnNames.find(hr=>hr===oe.name));bt.indices.splice(bt.indices.indexOf(lr),1);const dr=bt.uniques.find(pr=>pr.name===lr.name);bt.uniques.splice(bt.uniques.indexOf(dr),1),tr.push(this.dropIndexSql(ue,lr)),rr.push(this.createIndexSql(ue,lr))}await this.executeQueries(tr,rr),this.replaceCachedTable(ue,bt)}async changeColumns(e,I){for(const{oldColumn:oe,newColumn:ue}of I)await this.changeColumn(e,oe,ue)}async dropColumn(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e),ue=I instanceof TableColumn?I:oe.findColumnByName(I);if(!ue)throw new TypeORMError(`Column "${I}" was not found in table "${oe.name}"`);const bt=oe.clone(),tr=[],rr=[],ir=bt.indices.find(dr=>dr.columnNames.length===1&&dr.columnNames[0]===ue.name);ir&&(bt.indices.splice(bt.indices.indexOf(ir),1),tr.push(this.dropIndexSql(oe,ir)),rr.push(this.createIndexSql(oe,ir)));const lr=bt.checks.find(dr=>!!dr.columnNames&&dr.columnNames.length===1&&dr.columnNames[0]===ue.name);if(lr&&(bt.checks.splice(bt.checks.indexOf(lr),1),tr.push(this.dropCheckConstraintSql(oe,lr)),rr.push(this.createCheckConstraintSql(oe,lr))),tr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} DROP COLUMN ${this.driver.escape(ue.name)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(oe)} ADD ${this.buildCreateColumnSql(ue)}`)),ue.generatedType&&ue.asExpression){const dr=this.deleteTypeormMetadataSql({table:oe.name,type:MetadataTableType.GENERATED_COLUMN,name:ue.name}),pr=this.insertTypeormMetadataSql({table:oe.name,type:MetadataTableType.GENERATED_COLUMN,name:ue.name,value:ue.asExpression});tr.push(dr),rr.push(pr)}await this.executeQueries(tr,rr),bt.removeColumn(ue),this.replaceCachedTable(oe,bt)}async dropColumns(e,I){for(const oe of I)await this.dropColumn(e,oe)}async createPrimaryKey(e,I){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async updatePrimaryKeys(e,I){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async dropPrimaryKey(e){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async createUniqueConstraint(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.checkConstraintName(oe,I.expression));const ue=this.createCheckConstraintSql(oe,I),bt=this.dropCheckConstraintSql(oe,I);await this.executeQueries(ue,bt),oe.addCheckConstraint(I)}async createCheckConstraints(e,I){const oe=I.map(ue=>this.createCheckConstraint(e,ue));await Promise.all(oe)}async dropCheckConstraint(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e),ue=I instanceof TableCheck?I:oe.checks.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied check constraint was not found in table ${oe.name}`);const bt=this.dropCheckConstraintSql(oe,ue),tr=this.createCheckConstraintSql(oe,ue);await this.executeQueries(bt,tr),oe.removeCheckConstraint(ue)}async dropCheckConstraints(e,I){const oe=I.map(ue=>this.dropCheckConstraint(e,ue));await Promise.all(oe)}async createExclusionConstraint(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async createExclusionConstraints(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async dropExclusionConstraint(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async dropExclusionConstraints(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async createForeignKey(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.foreignKeyName(oe,I.columnNames,this.getTablePath(I),I.referencedColumnNames));const ue=this.createForeignKeySql(oe,I),bt=this.dropForeignKeySql(oe,I);await this.executeQueries(ue,bt),oe.addForeignKey(I)}async createForeignKeys(e,I){for(const oe of I)await this.createForeignKey(e,oe)}async dropForeignKey(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e),ue=I instanceof TableForeignKey?I:oe.foreignKeys.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied foreign key was not found in table ${oe.name}`);const bt=this.dropForeignKeySql(oe,ue),tr=this.createForeignKeySql(oe,ue);await this.executeQueries(bt,tr),oe.removeForeignKey(ue)}async dropForeignKeys(e,I){for(const oe of I)await this.dropForeignKey(e,oe)}async createIndex(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(oe,I));const ue=this.createIndexSql(oe,I),bt=this.dropIndexSql(oe,I);await this.executeQueries(ue,bt),oe.addIndex(I)}async createIndices(e,I){for(const oe of I)await this.createIndex(e,oe)}async dropIndex(e,I){const oe=e instanceof Table?e:await this.getCachedTable(e),ue=I instanceof TableIndex?I:oe.indices.find(rr=>rr.name===I);if(!ue)throw new TypeORMError(`Supplied index ${I} was not found in table ${oe.name}`);ue.name||(ue.name=this.generateIndexName(oe,ue));const bt=this.dropIndexSql(oe,ue),tr=this.createIndexSql(oe,ue);await this.executeQueries(bt,tr),oe.removeIndex(ue)}async dropIndices(e,I){for(const oe of I)await this.dropIndex(e,oe)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)} WHERE true`)}async clearDatabase(){const I=await this.query("SELECT concat('DROP INDEX `', INDEX_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`INDEXES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `INDEX_TYPE` = 'INDEX' AND `SPANNER_IS_MANAGED` = false"),ue=await this.query("SELECT concat('ALTER TABLE `', TABLE_NAME, '`', ' DROP CONSTRAINT `', CONSTRAINT_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLE_CONSTRAINTS` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `CONSTRAINT_TYPE` = 'FOREIGN KEY'"),tr=await this.query("SELECT concat('DROP TABLE `', TABLE_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'");if(!I.length&&!ue.length&&!tr.length)return;const rr=this.isTransactionActive;rr||await this.startTransaction();try{for(let ir of I)await this.updateDDL(ir.query);for(let ir of ue)await this.updateDDL(ir.query);for(let ir of tr)await this.updateDDL(ir.query);await this.commitTransaction()}catch(ir){try{rr||await this.rollbackTransaction()}catch{}throw ir}}async executeMemoryUpSql(){for(const{query:e,parameters:I}of this.sqlInMemory.upQueries)this.isDMLQuery(e)?await this.query(e,I):await this.updateDDL(e,I)}async executeMemoryDownSql(){for(const{query:e,parameters:I}of this.sqlInMemory.downQueries.reverse())this.isDMLQuery(e)?await this.query(e,I):await this.updateDDL(e,I)}async loadViews(e){return Promise.resolve([])}async loadTables(e){if(e&&e.length===0)return[];const I=[];if(!e||!e.length)I.push(...await this.query("SELECT `TABLE_NAME` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'"));else{const yr=`SELECT \`TABLE_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` IN (${e.map(wr=>`'${wr}'`).join(", ")})`;I.push(...await this.query(yr))}if(!I.length)return[];const oe=I.map(yr=>`'${yr.TABLE_NAME}'`).join(", "),ue=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` IN (${oe})`,bt=`SELECT \`KCU\`.\`TABLE_NAME\`, \`KCU\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'PRIMARY KEY' AND \`TC\`.\`TABLE_NAME\` IN (${oe})`,tr=`SELECT \`I\`.\`TABLE_NAME\`, \`I\`.\`INDEX_NAME\`, \`I\`.\`IS_UNIQUE\`, \`I\`.\`IS_NULL_FILTERED\`, \`IC\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`INDEXES\` \`I\` INNER JOIN \`INFORMATION_SCHEMA\`.\`INDEX_COLUMNS\` \`IC\` ON \`IC\`.\`INDEX_NAME\` = \`I\`.\`INDEX_NAME\` AND \`IC\`.\`TABLE_NAME\` = \`I\`.\`TABLE_NAME\` WHERE \`I\`.\`TABLE_CATALOG\` = '' AND \`I\`.\`TABLE_SCHEMA\` = '' AND \`I\`.\`TABLE_NAME\` IN (${oe}) AND \`I\`.\`INDEX_TYPE\` = 'INDEX' AND \`I\`.\`SPANNER_IS_MANAGED\` = false`,rr=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`CC\`.\`CHECK_CLAUSE\`, \`CCU\`.\`COLUMN_NAME\`FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CHECK_CONSTRAINTS\` \`CC\` ON \`CC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'CHECK' AND \`TC\`.\`TABLE_NAME\` IN (${oe}) AND \`TC\`.\`CONSTRAINT_NAME\` NOT LIKE 'CK_IS_NOT_NULL%'`,ir=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`KCU\`.\`COLUMN_NAME\`, \`CTU\`.\`TABLE_NAME\` AS \`REFERENCED_TABLE_NAME\`, \`CCU\`.\`COLUMN_NAME\` AS \`REFERENCED_COLUMN_NAME\`, \`RC\`.\`UPDATE_RULE\`, \`RC\`.\`DELETE_RULE\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_TABLE_USAGE\` \`CTU\` ON \`CTU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`RC\` ON \`RC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'FOREIGN KEY' AND \`TC\`.\`TABLE_NAME\` IN (${oe})`,[lr,dr,pr,hr,_r]=await Promise.all([this.query(ue),this.query(bt),this.query(tr),this.query(rr),this.query(ir)]);return Promise.all(I.map(async yr=>{const wr=new Table;wr.name=this.driver.buildTableName(yr.TABLE_NAME),wr.columns=await Promise.all(lr.filter(Mr=>Mr.TABLE_NAME===yr.TABLE_NAME).map(async Mr=>{const vr=pr.filter(ns=>ns.TABLE_NAME===yr.TABLE_NAME&&ns.COLUMN_NAME===Mr.COLUMN_NAME&&ns.IS_UNIQUE===!0),Lr=this.connection.entityMetadatas.find(ns=>this.getTablePath(wr)===this.getTablePath(ns)),es=vr.length>0&&Lr&&Lr.indices.some(ns=>vr.some(Nr=>ns.name===Nr.INDEX_NAME&&ns.synchronize===!1)),ss=vr.every(ns=>pr.some(Nr=>Nr.INDEX_NAME===ns.INDEX_NAME&&Nr.COLUMN_NAME!==Mr.COLUMN_NAME)),os=new TableColumn;os.name=Mr.COLUMN_NAME;let $r=Mr.SPANNER_TYPE.toLowerCase();if($r.indexOf("array")!==-1&&(os.isArray=!0,$r=$r.substring($r.indexOf("<")+1,$r.indexOf(">"))),$r.indexOf("(")!==-1?os.type=$r.substring(0,$r.indexOf("(")):os.type=$r,this.driver.withLengthColumnTypes.indexOf(os.type)!==-1&&(os.length=$r.substring($r.indexOf("(")+1,$r.indexOf(")"))),Mr.IS_GENERATED==="ALWAYS"){os.asExpression=Mr.GENERATION_EXPRESSION,os.generatedType="STORED";const ns=this.selectTypeormMetadataSql({table:yr.TABLE_NAME,type:MetadataTableType.GENERATED_COLUMN,name:os.name}),Nr=await this.query(ns.query,ns.parameters);Nr[0]&&Nr[0].value?os.asExpression=Nr[0].value:os.asExpression=""}return os.isUnique=vr.length>0&&!es&&!ss,os.isNullable=Mr.IS_NULLABLE==="YES",os.isPrimary=dr.some(ns=>ns.TABLE_NAME===Mr.TABLE_NAME&&ns.COLUMN_NAME===Mr.COLUMN_NAME),os}));const Tr=_r.filter(Mr=>Mr.TABLE_NAME===yr.TABLE_NAME);wr.foreignKeys=OrmUtils.uniq(Tr,Mr=>Mr.CONSTRAINT_NAME).map(Mr=>{const vr=Tr.filter(Lr=>Lr.CONSTRAINT_NAME===Mr.CONSTRAINT_NAME);return new TableForeignKey({name:Mr.CONSTRAINT_NAME,columnNames:OrmUtils.uniq(vr.map(Lr=>Lr.COLUMN_NAME)),referencedDatabase:Mr.REFERENCED_TABLE_SCHEMA,referencedTableName:Mr.REFERENCED_TABLE_NAME,referencedColumnNames:OrmUtils.uniq(vr.map(Lr=>Lr.REFERENCED_COLUMN_NAME)),onDelete:Mr.DELETE_RULE,onUpdate:Mr.UPDATE_RULE})});const Ar=pr.filter(Mr=>Mr.TABLE_NAME===yr.TABLE_NAME);wr.indices=OrmUtils.uniq(Ar,Mr=>Mr.INDEX_NAME).map(Mr=>{const vr=Ar.filter(Lr=>Lr.INDEX_NAME===Mr.INDEX_NAME);return new TableIndex({table:wr,name:Mr.INDEX_NAME,columnNames:vr.map(Lr=>Lr.COLUMN_NAME),isUnique:Mr.IS_UNIQUE,isNullFiltered:Mr.IS_NULL_FILTERED})});const Sr=hr.filter(Mr=>Mr.TABLE_NAME===yr.TABLE_NAME);return wr.checks=OrmUtils.uniq(Sr,Mr=>Mr.CONSTRAINT_NAME).map(Mr=>{const vr=Sr.filter(Lr=>Lr.CONSTRAINT_NAME===Mr.CONSTRAINT_NAME);return new TableCheck({name:Mr.CONSTRAINT_NAME,columnNames:vr.map(Lr=>Lr.COLUMN_NAME),expression:Mr.CHECK_CLAUSE})}),wr}))}createTableSql(e,I){const oe=e.columns.map(tr=>this.buildCreateColumnSql(tr)).join(", ");let ue=`CREATE TABLE ${this.escapePath(e)} (${oe}`;if(e.columns.filter(tr=>tr.isUnique).forEach(tr=>{const rr=e.indices.some(lr=>lr.columnNames.length===1&&!!lr.isUnique&&lr.columnNames.indexOf(tr.name)!==-1),ir=e.uniques.some(lr=>lr.columnNames.length===1&&lr.columnNames.indexOf(tr.name)!==-1);!rr&&!ir&&e.indices.push(new TableIndex({name:this.connection.namingStrategy.uniqueConstraintName(e,[tr.name]),columnNames:[tr.name],isUnique:!0}))}),e.uniques.length>0&&e.uniques.forEach(tr=>{e.indices.some(ir=>ir.name===tr.name)||e.indices.push(new TableIndex({name:tr.name,columnNames:tr.columnNames,isUnique:!0}))}),e.checks.length>0){const tr=e.checks.map(rr=>`CONSTRAINT \`${rr.name?rr.name:this.connection.namingStrategy.checkConstraintName(e,rr.expression)}\` CHECK (${rr.expression})`).join(", ");ue+=`, ${tr}`}if(e.foreignKeys.length>0&&I){const tr=e.foreignKeys.map(rr=>{const ir=rr.columnNames.map(dr=>`\`${dr}\``).join(", ");rr.name||(rr.name=this.connection.namingStrategy.foreignKeyName(e,rr.columnNames,this.getTablePath(rr),rr.referencedColumnNames));const lr=rr.referencedColumnNames.map(dr=>`\`${dr}\``).join(", ");return`CONSTRAINT \`${rr.name}\` FOREIGN KEY (${ir}) REFERENCES ${this.escapePath(this.getTablePath(rr))} (${lr})`}).join(", ");ue+=`, ${tr}`}ue+=")";const bt=e.columns.filter(tr=>tr.isPrimary);if(bt.length>0){const tr=bt.map(rr=>this.driver.escape(rr.name)).join(", ");ue+=` PRIMARY KEY (${tr})`}return new Query(ue)}dropTableSql(e){return new Query(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const I=e.materialized?"MATERIALIZED ":"",oe=this.escapePath(e),ue=typeof e.expression=="string"?e.expression:e.expression(this.connection).getQuery();return new Query(`CREATE ${I}VIEW ${oe} SQL SECURITY INVOKER AS ${ue}`)}async insertViewDefinitionSql(e){let{schema:I,tableName:oe}=this.driver.parseTableName(e);const ue=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW,bt=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:ue,schema:I,name:oe,value:bt})}dropViewSql(e){const I=e.materialized?"MATERIALIZED ":"";return new Query(`DROP ${I}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){let{schema:I,tableName:oe}=this.driver.parseTableName(e);const ue=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW;return this.deleteTypeormMetadataSql({type:ue,schema:I,name:oe})}createIndexSql(e,I){const oe=I.columnNames.map(bt=>this.driver.escape(bt)).join(", ");let ue="";return I.isUnique&&(ue+="UNIQUE "),I.isNullFiltered&&(ue+="NULL_FILTERED "),new Query(`CREATE ${ue}INDEX \`${I.name}\` ON ${this.escapePath(e)} (${oe})`)}dropIndexSql(e,I){let oe=I instanceof TableIndex?I.name:I;return new Query(`DROP INDEX \`${oe}\``)}createCheckConstraintSql(e,I){return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${I.name}\` CHECK (${I.expression})`)}dropCheckConstraintSql(e,I){const oe=I instanceof TableCheck?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${oe}\``)}createForeignKeySql(e,I){const oe=I.columnNames.map(tr=>this.driver.escape(tr)).join(", "),ue=I.referencedColumnNames.map(tr=>this.driver.escape(tr)).join(",");let bt=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${I.name}\` FOREIGN KEY (${oe}) REFERENCES ${this.escapePath(this.getTablePath(I))} (${ue})`;return new Query(bt)}dropForeignKeySql(e,I){const oe=I instanceof TableForeignKey?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${oe}\``)}escapePath(e){const{tableName:I}=this.driver.parseTableName(e);return`\`${I}\``}buildCreateColumnSql(e){let I=`${this.driver.escape(e.name)} ${this.connection.driver.createFullType(e)}`;return e.generatedType==="STORED"&&e.asExpression?I+=` AS (${e.asExpression}) STORED`:e.isNullable||(I+=" NOT NULL"),I}async executeQueries(e,I){if(e instanceof Query&&(e=[e]),I instanceof Query&&(I=[I]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...I),this.sqlMemoryMode===!0)return Promise.resolve();for(const{query:oe,parameters:ue}of e)this.isDMLQuery(oe)?await this.query(oe,ue):await this.updateDDL(oe,ue)}isDMLQuery(e){return e.startsWith("INSERT")||e.startsWith("UPDATE")||e.startsWith("DELETE")}changeTableComment(e,I){throw new TypeORMError("spanner driver does not support change table comment.")}}class SpannerDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="none",this.supportedDataTypes=["bool","int64","float64","numeric","string","json","bytes","date","timestamp","array"],this.supportedUpsertTypes=[],this.spatialTypes=[],this.withLengthColumnTypes=["string","bytes"],this.withWidthColumnTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"",updateDate:"timestamp",updateDateDefault:"",deleteDate:"timestamp",deleteDateNullable:!0,version:"int64",treeLevel:"int64",migrationId:"int64",migrationName:"string",migrationTimestamp:"int64",cacheId:"string",cacheIdentifier:"string",cacheTime:"int64",cacheDuration:"int64",cacheQuery:"string",cacheResult:"string",metadataType:"string",metadataDatabase:"string",metadataSchema:"string",metadataTable:"string",metadataName:"string",metadataValue:"string"},this.parametersPrefix="@param",this.dataTypeDefaults={},this.maxAliasLength=63,this.cteCapabilities={enabled:!0},this._isReturningSqlSupported={delete:!1,insert:!1,update:!1},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}async connect(){this.instance=this.spanner.instance(this.options.instanceId),this.instanceDatabase=this.instance.database(this.options.databaseId)}afterConnect(){return Promise.resolve()}async disconnect(){this.instanceDatabase.close()}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}createQueryRunner(e){return new SpannerQueryRunner(this,e)}escapeQueryWithParameters(e,I,oe){const ue=Object.keys(oe).map(tr=>oe[tr]);if(!I||!Object.keys(I).length)return[e,ue];const bt=new Map;return e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(tr,rr,ir)=>{if(!I.hasOwnProperty(ir))return tr;if(bt.has(ir))return this.parametersPrefix+bt.get(ir);let lr=I[ir];return lr===null?tr:rr?lr.map(dr=>(ue.push(dr),this.createParameter(ir,ue.length-1))).join(", "):lr instanceof Function?lr():(ue.push(lr),bt.set(ir,ue.length-1),this.createParameter(ir,ue.length-1))}),e=e.replace(/([ ]+)?=([ ]+)?:(\.\.\.)?([A-Za-z0-9_.]+)/g,(tr,rr,ir,lr,dr)=>I.hasOwnProperty(dr)&&I[dr]===null?" IS NULL":tr),[e,ue]}escape(e){return`\`${e}\``}buildTableName(e,I,oe){let ue=[e];return oe&&ue.unshift(oe),ue.join(".")}parseTableName(e){const I=this.database,oe=void 0;if(e instanceof Table||e instanceof View){const bt=this.parseTableName(e.name);return{database:e.database||bt.database||I,schema:e.schema||bt.schema||oe,tableName:bt.tableName}}if(e instanceof TableForeignKey){const bt=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||bt.database||I,schema:e.referencedSchema||bt.schema||oe,tableName:bt.tableName}}if(e instanceof EntityMetadata)return{database:e.database||I,schema:e.schema||oe,tableName:e.tableName};const ue=e.split(".");return{database:(ue.length>1?ue[0]:void 0)||I,schema:oe,tableName:ue.length>1?ue[1]:ue[0]}}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null?e:I.type==="numeric"?(this.options.driver||PlatformTools.load("spanner")).Spanner.numeric(e):I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="json"?e:I.type==="timestamp"||I.type===Date?DateUtils.mixedDateToDate(e):e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:(I.type===Boolean||I.type==="bool"?e=!!e:I.type==="timestamp"||I.type===Date?e=new Date(e):I.type==="numeric"?e=e.value:I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="json"?e=typeof e=="string"?JSON.parse(e):e:I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}normalizeType(e){return e.type===Number?"int64":e.type===String||e.type==="uuid"?"string":e.type===Date?"timestamp":e.type===Buffer$7?"bytes":e.type===Boolean?"bool":e.type||""}normalizeDefault(e){return e.default===""?`"${e.default}"`:`${e.default}`}normalizeIsUnique(e){return e.entityMetadata.indices.some(I=>I.isUnique&&I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){if(e.length)return e.length.toString();if(e.generationStrategy==="uuid")return"36";switch(e.type){case String:case"string":case"bytes":return"max";default:return""}}createFullType(e){let I=e.type;return this.getColumnLength(e)?I+=`(${this.getColumnLength(e)})`:e.width?I+=`(${e.width})`:e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+=`(${e.precision},${e.scale})`:e.precision!==null&&e.precision!==void 0&&(I+=`(${e.precision})`),e.isArray&&(I=`array<${I}>`),I}obtainMasterConnection(){return this.instanceDatabase}obtainSlaveConnection(){return this.instanceDatabase}createGeneratedMap(e,I,oe){if(!I)return;if(I.insertId===void 0)return Object.keys(I).reduce((bt,tr)=>{const rr=e.findColumnWithDatabaseName(tr);return rr&&OrmUtils.mergeDeep(bt,rr.createValueMap(I[tr])),bt},{});const ue=e.generatedColumns.reduce((bt,tr)=>{let rr;return tr.generationStrategy==="increment"&&I.insertId&&(rr=I.insertId+oe),OrmUtils.mergeDeep(bt,tr.createValueMap(rr))},{});return Object.keys(ue).length>0?ue:void 0}findChangedColumns(e,I){return I.filter(oe=>{const ue=e.find(tr=>tr.name===oe.databaseName);return ue?ue.name!==oe.databaseName||ue.type!==this.normalizeType(oe)||ue.length!==this.getColumnLength(oe)||ue.asExpression!==oe.asExpression||ue.generatedType!==oe.generatedType||ue.isPrimary!==oe.isPrimary||!this.compareNullableValues(oe,ue)||ue.isUnique!==this.normalizeIsUnique(oe):!1})}isReturningSqlSupported(e){return this._isReturningSqlSupported[e]}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,I){return this.parametersPrefix+I}loadDependencies(){try{const e=this.options.driver||PlatformTools.load("spanner");this.spanner=new e.Spanner({projectId:this.options.projectId})}catch(e){throw console.error(e),new DriverPackageNotInstalledError("Spanner","@google-cloud/spanner")}}compareNullableValues(e,I){return e.generatedType?!0:e.isNullable===I.isNullable}compareDefaultValues(e,I){return typeof e=="string"&&typeof I=="string"&&(e=e.replace(/^'+|'+$/g,""),I=I.replace(/^'+|'+$/g,"")),e===I}normalizeDatetimeFunction(e){if(!e)return e;if(e.toUpperCase().indexOf("CURRENT_TIMESTAMP")!==-1||e.toUpperCase().indexOf("NOW")!==-1){const oe=e.match(/\(\d+\)/);return oe?`CURRENT_TIMESTAMP${oe[0]}`:"CURRENT_TIMESTAMP"}else return e}escapeComment(e){return e&&(e=e.replace(/\u0000/g,""),e)}}class DriverFactory{create(e){const{type:I}=e.options;switch(I){case"mysql":return new MysqlDriver(e);case"postgres":return new PostgresDriver(e);case"cockroachdb":return new CockroachDriver(e);case"sap":return new SapDriver(e);case"mariadb":return new MysqlDriver(e);case"sqlite":return new SqliteDriver(e);case"better-sqlite3":return new BetterSqlite3Driver(e);case"cordova":return new CordovaDriver(e);case"nativescript":return new NativescriptDriver(e);case"react-native":return new ReactNativeDriver(e);case"sqljs":return new SqljsDriver(e);case"oracle":return new OracleDriver(e);case"mssql":return new SqlServerDriver(e);case"mongodb":return new MongoDriver(e);case"expo":return new ExpoDriver(e);case"aurora-mysql":return new AuroraMysqlDriver(e);case"aurora-postgres":return new AuroraPostgresDriver(e);case"capacitor":return new CapacitorDriver(e);case"spanner":return new SpannerDriver(e);default:throw new MissingDriverError(I,["aurora-mysql","aurora-postgres","better-sqlite3","capacitor","cockroachdb","cordova","expo","mariadb","mongodb","mssql","mysql","nativescript","oracle","postgres","react-native","sap","sqlite","sqljs","spanner"])}}}function importClassesFromDirectories(ae,e,I=[".js",".cjs",".ts"]){return[]}const defaultContainer=new class{constructor(){this.instances=[]}get(ae){let e=this.instances.find(I=>I.type===ae);return e||(e={type:ae,object:new ae},this.instances.push(e)),e.object}};function getFromContainer(ae){return defaultContainer.get(ae)}class ColumnMetadata{constructor(e){this["@instanceof"]=Symbol.for("ColumnMetadata"),this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isVirtualProperty=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),e.args.options.default===null&&(this.isNullable=!0),e.args.options.nullable!==void 0&&(this.isNullable=e.args.options.nullable),e.args.options.select!==void 0&&(this.isSelect=e.args.options.select),e.args.options.insert!==void 0&&(this.isInsert=e.args.options.insert),e.args.options.update!==void 0&&(this.isUpdate=e.args.options.update),e.args.options.readonly!==void 0&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),e.args.options.default!==void 0&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),e.args.options.generatedIdentity&&(this.generatedIdentity=e.args.options.generatedIdentity),e.args.options.scale!==null&&e.args.options.scale!==void 0&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),e.args.options.precision!==null&&(this.precision=e.args.options.precision),e.args.options.enum&&(ObjectUtils.isObject(e.args.options.enum)&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter(I=>isNaN(+I)&&typeof e.args.options.enum[I]!="function").map(I=>e.args.options.enum[I]):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.primaryKeyConstraintName&&(this.primaryKeyConstraintName=e.args.options.primaryKeyConstraintName),e.args.options.foreignKeyConstraintName&&(this.foreignKeyConstraintName=e.args.options.foreignKeyConstraintName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtualProperty=e.args.mode==="virtual-property",this.isVirtual=e.args.mode==="virtual",this.isTreeLevel=e.args.mode==="treeLevel",this.isCreateDate=e.args.mode==="createDate",this.isUpdateDate=e.args.mode==="updateDate",this.isDeleteDate=e.args.mode==="deleteDate",this.isVersion=e.args.mode==="version",this.isObjectId=e.args.mode==="objectId"),this.isVirtualProperty&&(this.isInsert=!1,this.isUpdate=!1),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),e.args.options.srid!==void 0&&(this.srid=e.args.options.srid),e.args.options.query&&(this.query=e.args.options.query),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.createDateDefault),this.precision===void 0&&e.args.options.precision===void 0&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.updateDateDefault),this.onUpdate||(this.onUpdate=e.connection.driver.mappedDataTypes.updateDateDefault),this.precision===void 0&&e.args.options.precision===void 0&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),this.precision===void 0&&e.args.options.precision===void 0&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}createValueMap(e,I=!1){if(this.embeddedMetadata){const oe=[...this.embeddedMetadata.parentPropertyNames],ue=(bt,tr)=>{const rr=bt.shift();return rr?(tr[rr]={},ue(bt,tr[rr]),tr):((this.generationStrategy==="increment"||this.generationStrategy==="rowid")&&this.type==="bigint"&&e!==null&&(e=String(e)),tr[I?this.databaseName:this.propertyName]=e,tr)};return ue(oe,{})}else return(this.generationStrategy==="increment"||this.generationStrategy==="rowid")&&this.type==="bigint"&&e!==null&&(e=String(e)),{[I?this.databaseName:this.propertyName]:e}}getEntityValueMap(e,I){if(this.embeddedMetadata){const ue=[...this.embeddedMetadata.parentPropertyNames],bt=this.embeddedMetadata.isArray,tr=(ir,lr)=>{if(lr===void 0)return{};const dr=ir.shift();if(dr){const pr=tr(ir,lr[dr]);return Object.keys(pr).length>0?{[dr]:pr}:{}}return bt&&Array.isArray(lr)?lr.map(pr=>({[this.propertyName]:pr[this.propertyName]})):lr[this.propertyName]!==void 0?{[this.propertyName]:lr[this.propertyName]}:{}},rr=tr(ue,e);return Object.keys(rr).length>0?rr:void 0}else if(this.relationMetadata&&!Object.getOwnPropertyDescriptor(e,this.relationMetadata.propertyName)?.get&&e[this.relationMetadata.propertyName]&&ObjectUtils.isObject(e[this.relationMetadata.propertyName])){const ue=this.relationMetadata.joinColumns.reduce((bt,tr)=>{const rr=tr.referencedColumn.getEntityValueMap(e[this.relationMetadata.propertyName]);return rr===void 0?bt:OrmUtils.mergeDeep(bt,rr)},{});return Object.keys(ue).length>0?{[this.propertyName]:ue}:void 0}else return e[this.propertyName]!==void 0?{[this.propertyName]:e[this.propertyName]}:void 0}getEntityValue(e,I=!1){if(e==null)return;let oe;if(this.embeddedMetadata){const ue=[...this.embeddedMetadata.parentPropertyNames],bt=this.embeddedMetadata.isArray,tr=(ir,lr)=>{const dr=ir.shift();return dr&&lr?tr(ir,lr[dr]):lr},rr=tr(ue,e);if(rr)if(this.relationMetadata&&this.referencedColumn){const ir=this.relationMetadata.getEntityValue(rr);ir&&ObjectUtils.isObject(ir)&&!InstanceChecker.isFindOperator(ir)&&!Buffer$7.isBuffer(ir)?oe=this.referencedColumn.getEntityValue(ir):rr[this.propertyName]&&ObjectUtils.isObject(rr[this.propertyName])&&!InstanceChecker.isFindOperator(rr[this.propertyName])&&!Buffer$7.isBuffer(rr[this.propertyName])&&!(rr[this.propertyName]instanceof Date)?oe=this.referencedColumn.getEntityValue(rr[this.propertyName]):oe=rr[this.propertyName]}else this.referencedColumn?oe=this.referencedColumn.getEntityValue(rr[this.propertyName]):bt&&Array.isArray(rr)?oe=rr.map(ir=>ir[this.propertyName]):oe=rr[this.propertyName]}else if(this.relationMetadata&&this.referencedColumn){const ue=this.relationMetadata.getEntityValue(e);ue&&ObjectUtils.isObject(ue)&&!InstanceChecker.isFindOperator(ue)&&typeof ue!="function"&&!Buffer$7.isBuffer(ue)?oe=this.referencedColumn.getEntityValue(ue):e[this.propertyName]&&ObjectUtils.isObject(e[this.propertyName])&&!InstanceChecker.isFindOperator(e[this.propertyName])&&typeof e[this.propertyName]!="function"&&!Buffer$7.isBuffer(e[this.propertyName])&&!(e[this.propertyName]instanceof Date)?oe=this.referencedColumn.getEntityValue(e[this.propertyName]):oe=e[this.propertyName]}else this.referencedColumn?oe=this.referencedColumn.getEntityValue(e[this.propertyName]):oe=e[this.propertyName];return I&&this.transformer&&(oe=ApplyValueTransformers.transformTo(this.transformer,oe)),oe}setEntityValue(e,I){if(this.embeddedMetadata){const oe=(ue,bt)=>{const tr=ue.shift();return tr?(bt[tr.propertyName]||(bt[tr.propertyName]=tr.create()),oe(ue,bt[tr.propertyName]),bt):(bt[this.propertyName]=I,bt)};return oe([...this.embeddedMetadata.embeddedMetadataTree],e)}else!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in e||(e[this.propertyName]={}),e[this.propertyName][this.referencedColumn.propertyName]=I):e[this.propertyName]=I}compareEntityValue(e,I){const oe=this.getEntityValue(e);return ObjectUtils.isObject(oe)?oe.equals(I):oe===I}build(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this}buildPropertyPath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e}buildDatabasePath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e}buildDatabaseName(e){let I=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver.options.type==="mongodb"&&(I=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,I)}}class IndexMetadata{constructor(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.isNullFiltered=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,e.args.synchronize!==null&&e.args.synchronize!==void 0&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.isNullFiltered=!!e.args.nullFiltered,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.isConcurrent=e.args.concurrent,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}build(e){if(this.synchronize===!1)return this.name=this.givenName,this;const I={};if(this.givenColumnNames){let oe=[];if(Array.isArray(this.givenColumnNames))oe=this.givenColumnNames.map(ue=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+ue:ue.trim()),oe.forEach(ue=>I[ue]=1);else{const ue=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(ue)?(oe=ue.map(bt=>String(bt)),oe.forEach(bt=>I[bt]=1)):(oe=Object.keys(ue).map(bt=>String(bt)),Object.keys(ue).forEach(bt=>I[bt]=ue[bt]))}this.columns=oe.map(ue=>{const bt=this.entityMetadata.columns.find(lr=>lr.propertyPath===ue);if(bt)return[bt];const tr=this.entityMetadata.relations.find(lr=>lr.isWithJoinColumn&&lr.propertyName===ue);if(tr)return tr.joinColumns;const rr=this.givenName?'"'+this.givenName+'" ':"",ir=this.entityMetadata.targetName;throw new TypeORMError(`Index ${rr}contains column that is missing in the entity (${ir}): `+ue)}).reduce((ue,bt)=>ue.concat(bt))}return this.columnNamesWithOrderingMap=Object.keys(I).reduce((oe,ue)=>{const bt=this.entityMetadata.columns.find(tr=>tr.propertyPath===ue);return bt&&(oe[bt.databasePath]=I[ue]),oe},{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tableName,this.columns.map(oe=>oe.databaseName),this.where),this}}class RelationMetadata{constructor(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.createForeignKeyConstraints=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;const I=e.args;this.target=I.target,this.propertyName=I.propertyName,this.relationType=I.relationType,I.inverseSideProperty&&(this.givenInverseSidePropertyFactory=I.inverseSideProperty),this.isLazy=I.isLazy||!1,this.isCascadeInsert=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("insert")!==-1,this.isCascadeUpdate=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("update")!==-1,this.isCascadeRemove=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("remove")!==-1,this.isCascadeSoftRemove=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("soft-remove")!==-1,this.isCascadeRecover=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("recover")!==-1,this.isNullable=!(I.options.nullable===!1||this.isPrimary),this.onDelete=I.options.onDelete,this.onUpdate=I.options.onUpdate,this.deferrable=I.options.deferrable,this.createForeignKeyConstraints=I.options.createForeignKeyConstraints!==!1,this.isEager=I.options.eager||!1,this.persistenceEnabled=I.options.persistence!==!1,this.orphanedRowAction=I.options.orphanedRowAction||"nullify",this.isTreeParent=I.isTreeParent||!1,this.isTreeChildren=I.isTreeChildren||!1,typeof I.type=="function"?this.type=typeof I.type=="function"?I.type():I.type:InstanceChecker.isEntitySchema(I.type)?this.type=I.type.options.name:ObjectUtils.isObject(I.type)&&typeof I.type.name=="string"?this.type=I.type.name:this.type=I.type,this.isOneToOne=this.relationType==="one-to-one",this.isOneToMany=this.relationType==="one-to-many",this.isManyToOne=this.relationType==="many-to-one",this.isManyToMany=this.relationType==="many-to-many",this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}getRelationIdMap(e){const oe=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(ue=>ue.referencedColumn);return EntityMetadata.getValueMap(e,oe)}ensureRelationIdMap(e){if(ObjectUtils.isObject(e))return e;const oe=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(ue=>ue.referencedColumn);if(oe.length>1)throw new TypeORMError("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return oe[0].createValueMap(e)}getEntityValue(e,I=!1){if(e!=null)if(this.embeddedMetadata){const oe=[...this.embeddedMetadata.parentPropertyNames],ue=(tr,rr)=>{const ir=tr.shift();return ir?rr[ir]?ue(tr,rr[ir]):void 0:rr},bt=ue(oe,e);return this.isLazy?bt["__"+this.propertyName+"__"]!==void 0?bt["__"+this.propertyName+"__"]:I===!0?bt[this.propertyName]:void 0:bt?bt[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}else return this.isLazy?e["__"+this.propertyName+"__"]!==void 0?e["__"+this.propertyName+"__"]:I===!0?e[this.propertyName]:void 0:e[this.propertyName]}setEntityValue(e,I){const oe=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){const ue=(bt,tr)=>{const rr=bt.shift();return rr?(tr[rr.propertyName]||(tr[rr.propertyName]=rr.create()),ue(bt,tr[rr.propertyName]),tr):(tr[oe]=I,tr)};return ue([...this.embeddedMetadata.embeddedMetadataTree],e)}else e[oe]=I}createValueMap(e){if(this.embeddedMetadata){const I=[...this.embeddedMetadata.parentPropertyNames],oe=(ue,bt)=>{const tr=ue.shift();return tr?(bt[tr]={},oe(ue,bt[tr]),bt):(bt[this.propertyName]=e,bt)};return oe(I,{})}else return{[this.propertyName]:e}}build(){this.propertyPath=this.buildPropertyPath()}registerForeignKeys(...e){this.foreignKeys.push(...e)}registerJoinColumns(e=[],I=[]){this.joinColumns=e,this.inverseJoinColumns=I,this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner}registerJunctionEntityMetadata(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)}buildInverseSidePropertyPath(){if(this.givenInverseSidePropertyFactory){const e=this.inverseEntityMetadata.propertiesMap;if(typeof this.givenInverseSidePropertyFactory=="function")return this.givenInverseSidePropertyFactory(e);if(typeof this.givenInverseSidePropertyFactory=="string")return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""}buildPropertyPath(){return!this.embeddedMetadata||!this.embeddedMetadata.parentPropertyNames.length?this.propertyName:this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName}}class EmbeddedMetadata{constructor(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isAlwaysUsingConstructor=!0,this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}create(e){return typeof this.type!="function"?{}:e?.fromDeserializer||!this.isAlwaysUsingConstructor?Object.create(this.type.prototype):new this.type}build(e){return this.embeddeds.forEach(I=>I.build(e)),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),e.options.entitySkipConstructor&&(this.isAlwaysUsingConstructor=!e.options.entitySkipConstructor),this}buildPartialPrefix(){if(this.customPrefix===void 0||this.customPrefix===!0)return[this.propertyName];if(this.customPrefix===""||this.customPrefix===!1)return[];if(typeof this.customPrefix=="string")return[this.customPrefix];throw new TypeORMError(`Invalid prefix option given for ${this.entityMetadata.targetName}#${this.propertyName}`)}buildPrefix(e){if(e.driver.options.type==="mongodb")return this.propertyName;let I=[];return this.parentEmbeddedMetadata&&I.push(this.parentEmbeddedMetadata.buildPrefix(e)),I.push(...this.buildPartialPrefix()),I.join("_")}buildParentPropertyNames(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]}buildParentPrefixes(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()}buildEmbeddedMetadataTree(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]}buildColumnsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildColumnsFromTree()),this.columns)}buildRelationsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildRelationsFromTree()),this.relations)}buildListenersFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildListenersFromTree()),this.listeners)}buildIndicesFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildIndicesFromTree()),this.indices)}buildUniquesFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildUniquesFromTree()),this.uniques)}buildRelationIdsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildRelationIdsFromTree()),this.relationIds)}buildRelationCountsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildRelationCountsFromTree()),this.relationCounts)}}class RelationIdMetadata{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}setValue(e){const I=this.relation.getEntityValue(e);if(Array.isArray(I))e[this.propertyName]=I.map(oe=>this.relation.inverseEntityMetadata.getEntityIdMixedMap(oe)).filter(oe=>oe!=null);else{const oe=this.relation.inverseEntityMetadata.getEntityIdMixedMap(I);oe!==void 0&&(e[this.propertyName]=oe)}}build(){const e=typeof this.relationNameOrFactory=="function"?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,I=this.entityMetadata.findRelationWithPropertyPath(e);if(!I)throw new TypeORMError(`Cannot find relation ${e}. Wrong relation specified for @RelationId decorator.`);this.relation=I}}class RelationCountMetadata{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}build(){const e=typeof this.relationNameOrFactory=="function"?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,I=this.entityMetadata.findRelationWithPropertyPath(e);if(!I)throw new TypeORMError(`Cannot find relation ${e}. Wrong relation specified for @RelationCount decorator.`);this.relation=I}}class EventListenerTypes{}EventListenerTypes.AFTER_LOAD="after-load";EventListenerTypes.BEFORE_INSERT="before-insert";EventListenerTypes.AFTER_INSERT="after-insert";EventListenerTypes.BEFORE_UPDATE="before-update";EventListenerTypes.AFTER_UPDATE="after-update";EventListenerTypes.BEFORE_REMOVE="before-remove";EventListenerTypes.AFTER_REMOVE="after-remove";EventListenerTypes.BEFORE_SOFT_REMOVE="before-soft-remove";EventListenerTypes.AFTER_SOFT_REMOVE="after-soft-remove";EventListenerTypes.BEFORE_RECOVER="before-recover";EventListenerTypes.AFTER_RECOVER="after-recover";class ForeignKeyMetadata{constructor(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,this.givenName=e.name,e.namingStrategy&&this.build(e.namingStrategy)}build(e){this.columnNames=this.columns.map(I=>I.databaseName),this.referencedColumnNames=this.referencedColumns.map(I=>I.databaseName),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=this.givenName?this.givenName:e.foreignKeyName(this.entityMetadata.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)}}class JunctionEntityMetadataBuilder{constructor(e){this.connection=e}build(e,I){const oe=this.collectReferencedColumns(e,I),ue=this.collectInverseReferencedColumns(e,I),bt=I.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),tr=new EntityMetadata({connection:this.connection,args:{target:"",name:bt,type:"junction",database:I.database||e.entityMetadata.database,schema:I.schema||e.entityMetadata.schema,synchronize:I.synchronize}});tr.build();const rr=oe.map(lr=>{const dr=I.joinColumns?I.joinColumns.find(hr=>(!hr.referencedColumnName||hr.referencedColumnName===lr.propertyName)&&!!hr.name):void 0,pr=dr&&dr.name?dr.name:this.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,lr.propertyName,lr.databaseName);return new ColumnMetadata({connection:this.connection,entityMetadata:tr,referencedColumn:lr,args:{target:"",mode:"virtual",propertyName:pr,options:{name:pr,length:!lr.length&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.normalizeType(lr)!=="uuid"&&(lr.generationStrategy==="uuid"||lr.type==="uuid")?"36":lr.length,width:lr.width,type:lr.type,precision:lr.precision,scale:lr.scale,charset:lr.charset,collation:lr.collation,zerofill:lr.zerofill,unsigned:lr.zerofill?!0:lr.unsigned,enum:lr.enum,enumName:lr.enumName,foreignKeyConstraintName:dr?.foreignKeyConstraintName,nullable:!1,primary:!0}}})}),ir=ue.map(lr=>{const dr=I.inverseJoinColumns?I.inverseJoinColumns.find(hr=>(!hr.referencedColumnName||hr.referencedColumnName===lr.propertyName)&&!!hr.name):void 0,pr=dr&&dr.name?dr.name:this.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,lr.propertyName,lr.databaseName);return new ColumnMetadata({connection:this.connection,entityMetadata:tr,referencedColumn:lr,args:{target:"",mode:"virtual",propertyName:pr,options:{length:!lr.length&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.normalizeType(lr)!=="uuid"&&(lr.generationStrategy==="uuid"||lr.type==="uuid")?"36":lr.length,width:lr.width,type:lr.type,precision:lr.precision,scale:lr.scale,charset:lr.charset,collation:lr.collation,zerofill:lr.zerofill,unsigned:lr.zerofill?!0:lr.unsigned,enum:lr.enum,enumName:lr.enumName,foreignKeyConstraintName:dr?.foreignKeyConstraintName,name:pr,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(rr,ir),tr.ownerColumns=rr,tr.inverseColumns=ir,tr.ownColumns=[...rr,...ir],tr.ownColumns.forEach(lr=>lr.relationMetadata=e),tr.foreignKeys=e.createForeignKeyConstraints?[new ForeignKeyMetadata({entityMetadata:tr,referencedEntityMetadata:e.entityMetadata,columns:rr,referencedColumns:oe,name:rr[0]?.foreignKeyConstraintName,onDelete:this.connection.driver.options.type==="spanner"?"NO ACTION":e.onDelete||"CASCADE",onUpdate:this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="spanner"?"NO ACTION":e.onUpdate||"CASCADE"}),new ForeignKeyMetadata({entityMetadata:tr,referencedEntityMetadata:e.inverseEntityMetadata,columns:ir,referencedColumns:ue,name:ir[0]?.foreignKeyConstraintName,onDelete:this.connection.driver.options.type==="spanner"?"NO ACTION":e.inverseRelation?e.inverseRelation.onDelete:"CASCADE",onUpdate:this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="spanner"?"NO ACTION":e.inverseRelation?e.inverseRelation.onUpdate:"CASCADE"})]:[],tr.ownIndices=[new IndexMetadata({entityMetadata:tr,columns:rr,args:{target:tr.target,synchronize:!0}}),new IndexMetadata({entityMetadata:tr,columns:ir,args:{target:tr.target,synchronize:!0}})],tr}collectReferencedColumns(e,I){const oe=I.joinColumns?I.joinColumns.find(ue=>!!ue.referencedColumnName):!1;return!I.joinColumns||I.joinColumns&&!oe?e.entityMetadata.columns.filter(ue=>ue.isPrimary):I.joinColumns.map(ue=>{const bt=e.entityMetadata.columns.find(tr=>tr.propertyName===ue.referencedColumnName);if(!bt)throw new TypeORMError(`Referenced column ${ue.referencedColumnName} was not found in entity ${e.entityMetadata.name}`);return bt})}collectInverseReferencedColumns(e,I){const oe=!!I.inverseJoinColumns,ue=oe?I.inverseJoinColumns.find(bt=>!!bt.referencedColumnName):!1;return!oe||oe&&!ue?e.inverseEntityMetadata.primaryColumns:I.inverseJoinColumns.map(bt=>{const tr=e.inverseEntityMetadata.ownColumns.find(rr=>rr.propertyName===bt.referencedColumnName);if(!tr)throw new TypeORMError(`Referenced column ${bt.referencedColumnName} was not found in entity ${e.inverseEntityMetadata.name}`);return tr})}changeDuplicatedColumnNames(e,I){e.forEach(oe=>{I.forEach(ue=>{if(oe.givenDatabaseName===ue.givenDatabaseName){const bt=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(oe.propertyName,1);oe.propertyName=bt,oe.givenDatabaseName=bt;const tr=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(ue.propertyName,2);ue.propertyName=tr,ue.givenDatabaseName=tr}})})}}class ClosureJunctionEntityMetadataBuilder{constructor(e){this.connection=e}build(e){const I=new EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.treeOptions&&e.treeOptions.closureTableName?e.treeOptions.closureTableName:e.tableNameWithoutPrefix,type:"closure-junction"}});return I.build(),e.primaryColumns.forEach(oe=>{I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,closureType:"ancestor",referencedColumn:oe,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.ancestorColumnName?e.treeOptions.ancestorColumnName(oe):oe.propertyName+"_ancestor",options:{primary:!0,length:oe.length,type:oe.type}}})),I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,closureType:"descendant",referencedColumn:oe,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.descendantColumnName?e.treeOptions.descendantColumnName(oe):oe.propertyName+"_descendant",options:{primary:!0,length:oe.length,type:oe.type}}}))}),I.ownIndices=[new IndexMetadata({entityMetadata:I,columns:[I.ownColumns[0]],args:{target:I.target,synchronize:!0}}),new IndexMetadata({entityMetadata:I,columns:[I.ownColumns[1]],args:{target:I.target,synchronize:!0}})],e.treeLevelColumn&&I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),I.foreignKeys=[new ForeignKeyMetadata({entityMetadata:I,referencedEntityMetadata:e,columns:[I.ownColumns[0]],referencedColumns:e.primaryColumns,onDelete:this.connection.driver.options.type==="mssql"?"NO ACTION":"CASCADE"}),new ForeignKeyMetadata({entityMetadata:I,referencedEntityMetadata:e,columns:[I.ownColumns[1]],referencedColumns:e.primaryColumns,onDelete:this.connection.driver.options.type==="mssql"?"NO ACTION":"CASCADE"})],I}}class UniqueMetadata{constructor(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns,this.deferrable=e.args.deferrable)}build(e){const I={};if(this.givenColumnNames){let oe=[];if(Array.isArray(this.givenColumnNames))oe=this.givenColumnNames.map(ue=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+ue:ue.trim()),oe.forEach(ue=>I[ue]=1);else{const ue=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(ue)?(oe=ue.map(bt=>String(bt)),oe.forEach(bt=>I[bt]=1)):(oe=Object.keys(ue).map(bt=>String(bt)),Object.keys(ue).forEach(bt=>I[bt]=ue[bt]))}this.columns=oe.map(ue=>{const bt=this.entityMetadata.columns.find(lr=>lr.propertyPath===ue);if(bt)return[bt];const tr=this.entityMetadata.relations.find(lr=>lr.isWithJoinColumn&&lr.propertyName===ue);if(tr)return tr.joinColumns;const rr=this.givenName?'"'+this.givenName+'" ':"",ir=this.entityMetadata.targetName;throw new TypeORMError(`Unique constraint ${rr}contains column that is missing in the entity (${ir}): `+ue)}).reduce((ue,bt)=>ue.concat(bt))}return this.columnNamesWithOrderingMap=Object.keys(I).reduce((oe,ue)=>{const bt=this.entityMetadata.columns.find(tr=>tr.propertyPath===ue);return bt&&(oe[bt.databasePath]=I[ue]),oe},{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tableName,this.columns.map(oe=>oe.databaseName)),this}}class RelationJoinColumnBuilder{constructor(e){this.connection=e}build(e,I){const oe=this.collectReferencedColumns(e,I),ue=this.collectColumns(e,I,oe);if(!oe.length||!I.createForeignKeyConstraints)return{foreignKey:void 0,columns:ue,uniqueConstraint:void 0};const bt=new ForeignKeyMetadata({name:e[0]?.foreignKeyConstraintName,entityMetadata:I.entityMetadata,referencedEntityMetadata:I.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:ue,referencedColumns:oe,onDelete:I.onDelete,onUpdate:I.onUpdate,deferrable:I.deferrable});if(ue.every(rr=>rr.isPrimary)||!I.isOneToOne)return{foreignKey:bt,columns:ue,uniqueConstraint:void 0};const tr=new UniqueMetadata({entityMetadata:I.entityMetadata,columns:bt.columns,args:{name:this.connection.namingStrategy.relationConstraintName(I.entityMetadata.tableName,bt.columns.map(rr=>rr.databaseName)),target:I.entityMetadata.target}});return tr.build(this.connection.namingStrategy),{foreignKey:bt,columns:ue,uniqueConstraint:tr}}collectReferencedColumns(e,I){const oe=e.find(tr=>!!tr.referencedColumnName),ue=e.length===0&&I.isManyToOne,bt=e.length>0&&!oe;return ue||bt?I.inverseEntityMetadata.primaryColumns:e.map(tr=>{const rr=I.inverseEntityMetadata.ownColumns.find(ir=>ir.propertyName===tr.referencedColumnName);if(!rr)throw new TypeORMError(`Referenced column ${tr.referencedColumnName} was not found in entity ${I.inverseEntityMetadata.name}`);return rr})}collectColumns(e,I,oe){return oe.map(ue=>{const bt=e.find(lr=>(!lr.referencedColumnName||lr.referencedColumnName===ue.propertyName)&&!!lr.name),tr=bt?bt.name:this.connection.namingStrategy.joinColumnName(I.propertyName,ue.propertyName);let ir=(I.embeddedMetadata?I.embeddedMetadata.columns:I.entityMetadata.ownColumns).find(lr=>lr.databaseNameWithoutPrefixes===tr);return ir||(ir=new ColumnMetadata({connection:this.connection,entityMetadata:I.entityMetadata,embeddedMetadata:I.embeddedMetadata,args:{target:"",mode:"virtual",propertyName:I.propertyName,options:{name:tr,type:ue.type,length:!ue.length&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.normalizeType(ue)!=="uuid"&&(ue.generationStrategy==="uuid"||ue.type==="uuid")?"36":ue.length,width:ue.width,charset:ue.charset,collation:ue.collation,precision:ue.precision,scale:ue.scale,zerofill:ue.zerofill,unsigned:ue.unsigned,comment:ue.comment,enum:ue.enum,enumName:ue.enumName,primary:I.isPrimary,nullable:I.isNullable}}}),I.entityMetadata.registerColumn(ir)),ir.referencedColumn=ue,ir.type=ue.type,ir.relationMetadata=I,ir.build(this.connection),ir})}}class EntityListenerMetadata{constructor(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}isAllowed(e){return this.entityMetadata.target===e.constructor||typeof this.entityMetadata.target=="function"&&e.constructor.prototype instanceof this.entityMetadata.target}execute(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))}callEntityEmbeddedMethod(e,I){const oe=I.shift();!oe||!e[oe]||(I.length===0?Array.isArray(e[oe])?e[oe].map(ue=>ue[this.propertyName]()):e[oe][this.propertyName]():e[oe]&&this.callEntityEmbeddedMethod(e[oe],I))}}class CheckMetadata{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tableName,this.expression),this}}class ExclusionMetadata{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tableName,this.expression),this}}class EntityMetadataBuilder{constructor(e,I){this.connection=e,this.metadataArgsStorage=I,this.junctionEntityMetadataBuilder=new JunctionEntityMetadataBuilder(e),this.closureJunctionEntityMetadataBuilder=new ClosureJunctionEntityMetadataBuilder(e),this.relationJoinColumnBuilder=new RelationJoinColumnBuilder(e)}build(e){const ue=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(bt=>bt.type==="regular"||bt.type==="closure"||bt.type==="entity-child"||bt.type==="view").map(bt=>this.createEntityMetadata(bt));return ue.forEach(bt=>this.computeParentEntityMetadata(ue,bt)),ue.forEach(bt=>{bt.childEntityMetadatas=ue.filter(tr=>typeof bt.target=="function"&&typeof tr.target=="function"&&MetadataUtils.isInherited(tr.target,bt.target))}),ue.filter(bt=>bt.tableType!=="entity-child").forEach(bt=>bt.build()),ue.filter(bt=>bt.tableType==="entity-child").forEach(bt=>bt.build()),ue.filter(bt=>bt.tableType!=="entity-child").forEach(bt=>this.computeEntityMetadataStep1(ue,bt)),ue.filter(bt=>bt.tableType==="entity-child").forEach(bt=>this.computeEntityMetadataStep1(ue,bt)),ue.forEach(bt=>this.computeEntityMetadataStep2(bt)),ue.forEach(bt=>this.computeInverseProperties(bt,ue)),ue.filter(bt=>bt.tableType!=="entity-child").forEach(bt=>{bt.relations.filter(tr=>tr.isOneToOne||tr.isManyToOne).forEach(tr=>{const rr=this.metadataArgsStorage.filterJoinColumns(tr.target,tr.propertyName),{foreignKey:ir,columns:lr,uniqueConstraint:dr}=this.relationJoinColumnBuilder.build(rr,tr);if(ir&&(tr.registerForeignKeys(ir),bt.foreignKeys.push(ir)),lr&&tr.registerJoinColumns(lr),dr)if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="mssql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){const pr=new IndexMetadata({entityMetadata:dr.entityMetadata,columns:dr.columns,args:{target:dr.target,name:dr.name,unique:!0,synchronize:!0}});this.connection.driver.options.type==="mssql"&&(pr.where=pr.columns.map(hr=>`${this.connection.driver.escape(hr.databaseName)} IS NOT NULL`).join(" AND ")),this.connection.driver.options.type==="spanner"&&(pr.isNullFiltered=!0),tr.embeddedMetadata?tr.embeddedMetadata.indices.push(pr):tr.entityMetadata.ownIndices.push(pr),this.computeEntityMetadataStep2(bt)}else tr.embeddedMetadata?tr.embeddedMetadata.uniques.push(dr):tr.entityMetadata.ownUniques.push(dr),this.computeEntityMetadataStep2(bt);if(ir&&this.connection.driver.options.type==="cockroachdb"){const pr=new IndexMetadata({entityMetadata:tr.entityMetadata,columns:ir.columns,args:{target:tr.entityMetadata.target,synchronize:!0}});tr.embeddedMetadata?tr.embeddedMetadata.indices.push(pr):tr.entityMetadata.ownIndices.push(pr),this.computeEntityMetadataStep2(bt)}}),bt.relations.filter(tr=>tr.isManyToMany).forEach(tr=>{const rr=this.metadataArgsStorage.findJoinTable(tr.target,tr.propertyName);if(!rr)return;const ir=this.junctionEntityMetadataBuilder.build(tr,rr);tr.registerForeignKeys(...ir.foreignKeys),tr.registerJoinColumns(ir.ownIndices[0].columns,ir.ownIndices[1].columns),tr.registerJunctionEntityMetadata(ir),this.computeEntityMetadataStep2(ir),this.computeInverseProperties(ir,ue),ue.push(ir)})}),ue.forEach(bt=>{bt.relationsWithJoinColumns=bt.relations.filter(tr=>tr.isWithJoinColumn),bt.hasNonNullableRelations=bt.relationsWithJoinColumns.some(tr=>!tr.isNullable||tr.isPrimary)}),ue.filter(bt=>bt.treeType==="closure-table").forEach(bt=>{const tr=this.closureJunctionEntityMetadataBuilder.build(bt);bt.closureJunctionTable=tr,this.computeEntityMetadataStep2(tr),this.computeInverseProperties(tr,ue),ue.push(tr)}),ue.filter(bt=>bt.inheritancePattern==="STI"&&bt.discriminatorColumn).forEach(bt=>this.createKeysForTableInheritance(bt)),ue.forEach(bt=>{bt.indices.forEach(tr=>tr.build(this.connection.namingStrategy))}),ue.forEach(bt=>{bt.uniques.forEach(tr=>tr.build(this.connection.namingStrategy))}),ue.forEach(bt=>{bt.checks.forEach(tr=>tr.build(this.connection.namingStrategy))}),ue.forEach(bt=>{bt.exclusions.forEach(tr=>tr.build(this.connection.namingStrategy))}),ue.filter(bt=>typeof bt.target=="function").forEach(bt=>{bt.relations.filter(tr=>tr.isLazy).forEach(tr=>{this.connection.relationLoader.enableLazyLoad(tr,bt.target.prototype)})}),ue.forEach(bt=>{bt.columns.forEach(tr=>{const rr=this.metadataArgsStorage.findGenerated(tr.target,tr.propertyName);rr&&(tr.isGenerated=!0,tr.generationStrategy=rr.strategy,rr.strategy==="uuid"?tr.type="uuid":rr.strategy==="rowid"?tr.type="int":tr.type=tr.type||Number,tr.build(this.connection),this.computeEntityMetadataStep2(bt))})}),ue}createEntityMetadata(e){const I=typeof e.target=="function"?MetadataUtils.getInheritanceTree(e.target):[e.target],oe=this.metadataArgsStorage.findInheritanceType(e.target),ue=this.metadataArgsStorage.findTree(e.target);let bt;return(oe&&oe.pattern==="STI"||e.type==="entity-child")&&(bt=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(tr=>tr.target).filter(tr=>typeof tr=="function"),I.push(...bt)),new EntityMetadata({connection:this.connection,args:e,inheritanceTree:I,tableTree:ue,inheritancePattern:oe?oe.pattern:void 0})}computeParentEntityMetadata(e,I){I.tableType==="entity-child"&&(I.parentEntityMetadata=e.find(oe=>oe.inheritanceTree.indexOf(I.target)!==-1&&oe.inheritancePattern==="STI"))}computeEntityMetadataStep1(e,I){const oe=this.metadataArgsStorage.findInheritanceType(I.target),ue=this.metadataArgsStorage.findDiscriminatorValue(I.target);if(typeof ue<"u"?I.discriminatorValue=ue.value:I.discriminatorValue=I.target.name,I.embeddeds=this.createEmbeddedsRecursively(I,this.metadataArgsStorage.filterEmbeddeds(I.inheritanceTree)).map(tr=>(I.inheritancePattern==="STI"&&(tr.columns=tr.columns.map(rr=>(rr.isNullable=!0,rr))),tr)),I.ownColumns=this.metadataArgsStorage.filterColumns(I.inheritanceTree).map(tr=>{if(I.tableType==="entity-child")return I.parentEntityMetadata.ownColumns.find(lr=>lr.propertyName===tr.propertyName);if(I.tableType==="regular"&&tr.target!==I.target){const lr=this.metadataArgsStorage.columns.find(dr=>dr.propertyName===tr.propertyName&&dr.target===I.target);lr&&lr.options.default&&(tr.options.default=lr.options.default)}const rr=new ColumnMetadata({connection:this.connection,entityMetadata:I,args:tr});return e.find(lr=>lr.tableType==="entity-child"&&lr.target===tr.target)&&(rr.isNullable=!0),rr}),oe&&oe.column){const tr=oe.column&&oe.column.name?oe.column.name:"type";let rr=I.ownColumns.find(ir=>ir.propertyName===tr);rr?rr.isDiscriminator=!0:(rr=new ColumnMetadata({connection:this.connection,entityMetadata:I,args:{target:I.target,mode:"virtual",propertyName:tr,options:oe.column||{name:tr,type:"varchar",nullable:!1}}}),rr.isVirtual=!0,rr.isDiscriminator=!0,I.ownColumns.push(rr))}if(I.tableType==="entity-child"){const tr=I.parentEntityMetadata.ownColumns.find(rr=>rr.isDiscriminator);tr&&!I.ownColumns.find(rr=>rr===tr)&&I.ownColumns.push(tr),I.inheritancePattern=I.parentEntityMetadata.inheritancePattern,!I.treeType&&I.parentEntityMetadata.treeType&&(I.treeType=I.parentEntityMetadata.treeType,I.treeOptions=I.parentEntityMetadata.treeOptions,I.treeParentRelation=I.parentEntityMetadata.treeParentRelation,I.treeLevelColumn=I.parentEntityMetadata.treeLevelColumn)}const{namingStrategy:bt}=this.connection;if(I.treeType==="materialized-path")I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,materializedPath:!0,args:{target:I.target,mode:"virtual",propertyName:"mpath",options:{name:bt.materializedPathColumnName,type:String,nullable:!0,default:""}}}));else if(I.treeType==="nested-set"){const{left:tr,right:rr}=bt.nestedSetColumnNames;I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,nestedSetLeft:!0,args:{target:I.target,mode:"virtual",propertyName:tr,options:{name:tr,type:Number,nullable:!1,default:1}}})),I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,nestedSetRight:!0,args:{target:I.target,mode:"virtual",propertyName:rr,options:{name:rr,type:Number,nullable:!1,default:2}}}))}if(I.ownRelations=this.metadataArgsStorage.filterRelations(I.inheritanceTree).map(tr=>{if(I.tableType==="entity-child"){const rr=I.parentEntityMetadata.ownRelations.find(lr=>lr.propertyName===tr.propertyName),ir=typeof tr.type=="function"?tr.type():tr.type;if(rr.type!==ir){const lr=Object.create(rr);return lr.type=ir,lr}return rr}return new RelationMetadata({entityMetadata:I,args:tr})}),I.relationIds=this.metadataArgsStorage.filterRelationIds(I.inheritanceTree).map(tr=>I.tableType==="entity-child"?I.parentEntityMetadata.relationIds.find(rr=>rr.propertyName===tr.propertyName):new RelationIdMetadata({entityMetadata:I,args:tr})),I.relationCounts=this.metadataArgsStorage.filterRelationCounts(I.inheritanceTree).map(tr=>I.tableType==="entity-child"?I.parentEntityMetadata.relationCounts.find(rr=>rr.propertyName===tr.propertyName):new RelationCountMetadata({entityMetadata:I,args:tr})),I.ownListeners=this.metadataArgsStorage.filterListeners(I.inheritanceTree).map(tr=>new EntityListenerMetadata({entityMetadata:I,args:tr})),I.checks=this.metadataArgsStorage.filterChecks(I.inheritanceTree).map(tr=>new CheckMetadata({entityMetadata:I,args:tr})),this.connection.driver.options.type==="postgres"&&(I.exclusions=this.metadataArgsStorage.filterExclusions(I.inheritanceTree).map(tr=>new ExclusionMetadata({entityMetadata:I,args:tr}))),this.connection.driver.options.type==="cockroachdb"){I.ownIndices=this.metadataArgsStorage.filterIndices(I.inheritanceTree).filter(rr=>!rr.unique).map(rr=>new IndexMetadata({entityMetadata:I,args:rr}));const tr=this.metadataArgsStorage.filterIndices(I.inheritanceTree).filter(rr=>rr.unique).map(rr=>new UniqueMetadata({entityMetadata:I,args:{target:rr.target,name:rr.name,columns:rr.columns}}));I.ownUniques.push(...tr)}else I.ownIndices=this.metadataArgsStorage.filterIndices(I.inheritanceTree).map(tr=>new IndexMetadata({entityMetadata:I,args:tr}));if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){const tr=this.metadataArgsStorage.filterUniques(I.inheritanceTree).map(rr=>new IndexMetadata({entityMetadata:I,args:{target:rr.target,name:rr.name,columns:rr.columns,unique:!0,synchronize:!0}}));I.ownIndices.push(...tr)}else{const tr=this.metadataArgsStorage.filterUniques(I.inheritanceTree).map(rr=>new UniqueMetadata({entityMetadata:I,args:rr}));I.ownUniques.push(...tr)}}createEmbeddedsRecursively(e,I){return I.map(oe=>{const ue=new EmbeddedMetadata({entityMetadata:e,args:oe}),bt=typeof ue.type=="function"?MetadataUtils.getInheritanceTree(ue.type):[ue.type];return ue.columns=this.metadataArgsStorage.filterColumns(bt).map(tr=>new ColumnMetadata({connection:this.connection,entityMetadata:e,embeddedMetadata:ue,args:tr})),ue.relations=this.metadataArgsStorage.filterRelations(bt).map(tr=>new RelationMetadata({entityMetadata:e,embeddedMetadata:ue,args:tr})),ue.listeners=this.metadataArgsStorage.filterListeners(bt).map(tr=>new EntityListenerMetadata({entityMetadata:e,embeddedMetadata:ue,args:tr})),ue.indices=this.metadataArgsStorage.filterIndices(bt).map(tr=>new IndexMetadata({entityMetadata:e,embeddedMetadata:ue,args:tr})),ue.uniques=this.metadataArgsStorage.filterUniques(bt).map(tr=>new UniqueMetadata({entityMetadata:e,embeddedMetadata:ue,args:tr})),ue.relationIds=this.metadataArgsStorage.filterRelationIds(bt).map(tr=>new RelationIdMetadata({entityMetadata:e,args:tr})),ue.relationCounts=this.metadataArgsStorage.filterRelationCounts(bt).map(tr=>new RelationCountMetadata({entityMetadata:e,args:tr})),ue.embeddeds=this.createEmbeddedsRecursively(e,this.metadataArgsStorage.filterEmbeddeds(bt)),ue.embeddeds.forEach(tr=>tr.parentEmbeddedMetadata=ue),e.allEmbeddeds.push(ue),ue})}computeEntityMetadataStep2(e){e.embeddeds.forEach(I=>I.build(this.connection)),e.embeddeds.forEach(I=>{I.columnsFromTree.forEach(oe=>oe.build(this.connection)),I.relationsFromTree.forEach(oe=>oe.build())}),e.ownColumns.forEach(I=>I.build(this.connection)),e.ownRelations.forEach(I=>I.build()),e.relations=e.embeddeds.reduce((I,oe)=>I.concat(oe.relationsFromTree),e.ownRelations),e.eagerRelations=e.relations.filter(I=>I.isEager),e.lazyRelations=e.relations.filter(I=>I.isLazy),e.oneToOneRelations=e.relations.filter(I=>I.isOneToOne),e.oneToManyRelations=e.relations.filter(I=>I.isOneToMany),e.manyToOneRelations=e.relations.filter(I=>I.isManyToOne),e.manyToManyRelations=e.relations.filter(I=>I.isManyToMany),e.ownerOneToOneRelations=e.relations.filter(I=>I.isOneToOneOwner),e.ownerManyToManyRelations=e.relations.filter(I=>I.isManyToManyOwner),e.treeParentRelation=e.relations.find(I=>I.isTreeParent),e.treeChildrenRelation=e.relations.find(I=>I.isTreeChildren),e.columns=e.embeddeds.reduce((I,oe)=>I.concat(oe.columnsFromTree),e.ownColumns),e.listeners=e.embeddeds.reduce((I,oe)=>I.concat(oe.listenersFromTree),e.ownListeners),e.afterLoadListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_LOAD),e.afterInsertListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_INSERT),e.afterUpdateListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_UPDATE),e.afterRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_REMOVE),e.afterSoftRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_SOFT_REMOVE),e.afterRecoverListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_RECOVER),e.beforeInsertListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_INSERT),e.beforeUpdateListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_UPDATE),e.beforeRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_REMOVE),e.beforeSoftRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_SOFT_REMOVE),e.beforeRecoverListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_RECOVER),e.indices=e.embeddeds.reduce((I,oe)=>I.concat(oe.indicesFromTree),e.ownIndices),e.uniques=e.embeddeds.reduce((I,oe)=>I.concat(oe.uniquesFromTree),e.ownUniques),e.primaryColumns=e.columns.filter(I=>I.isPrimary),e.nonVirtualColumns=e.columns.filter(I=>!I.isVirtual),e.ancestorColumns=e.columns.filter(I=>I.closureType==="ancestor"),e.descendantColumns=e.columns.filter(I=>I.closureType==="descendant"),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter(I=>I.isGenerated||I.isObjectId),e.hasUUIDGeneratedColumns=e.columns.filter(I=>I.isGenerated||I.generationStrategy==="uuid").length>0,e.createDateColumn=e.columns.find(I=>I.isCreateDate),e.updateDateColumn=e.columns.find(I=>I.isUpdateDate),e.deleteDateColumn=e.columns.find(I=>I.isDeleteDate),e.versionColumn=e.columns.find(I=>I.isVersion),e.discriminatorColumn=e.columns.find(I=>I.isDiscriminator),e.treeLevelColumn=e.columns.find(I=>I.isTreeLevel),e.nestedSetLeftColumn=e.columns.find(I=>I.isNestedSetLeft),e.nestedSetRightColumn=e.columns.find(I=>I.isNestedSetRight),e.materializedPathColumn=e.columns.find(I=>I.isMaterializedPath),e.objectIdColumn=e.columns.find(I=>I.isObjectId),e.foreignKeys.forEach(I=>I.build(this.connection.namingStrategy)),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(I=>I.build()),e.relationCounts.forEach(I=>I.build()),e.embeddeds.forEach(I=>{I.relationIdsFromTree.forEach(oe=>oe.build()),I.relationCountsFromTree.forEach(oe=>oe.build())})}computeInverseProperties(e,I){e.relations.forEach(oe=>{const ue=I.find(bt=>bt.target===oe.type||typeof oe.type=="string"&&(bt.targetName===oe.type||bt.givenTableName===oe.type));if(!ue)throw new TypeORMError("Entity metadata for "+e.name+"#"+oe.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");oe.inverseEntityMetadata=ue,oe.inverseSidePropertyPath=oe.buildInverseSidePropertyPath(),oe.inverseRelation=ue.relations.find(bt=>bt.propertyPath===oe.inverseSidePropertyPath)})}createKeysForTableInheritance(e){e.indices.some(({givenColumnNames:oe})=>!!oe&&Array.isArray(oe)&&oe.length===1&&oe[0]===e.discriminatorColumn?.databaseName)||e.indices.push(new IndexMetadata({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))}}class EntitySchemaEmbeddedError extends TypeORMError{static createEntitySchemaIsRequiredException(e){return new EntitySchemaEmbeddedError(`EntitySchema is required for ${e} embedded field`)}static createTargetIsRequired(e){return new EntitySchemaEmbeddedError(`Target field is required for ${e} embedded EntitySchema`)}constructor(e){super(e)}}class EntitySchemaTransformer{transform(e){const I=new MetadataArgsStorage;return e.forEach(oe=>{const ue=oe.options,bt={target:ue.target||ue.name,name:ue.tableName,database:ue.database,schema:ue.schema,type:ue.type||"regular",orderBy:ue.orderBy,synchronize:ue.synchronize,withoutRowid:!!ue.withoutRowid,expression:ue.expression};I.tables.push(bt);const{inheritance:tr}=ue;tr&&I.inheritances.push({target:ue.target,pattern:tr.pattern??"STI",column:tr.column?typeof tr.column=="string"?{name:tr.column}:tr.column:void 0});const{discriminatorValue:rr}=ue;rr&&I.discriminatorValues.push({target:ue.target||ue.name,value:rr}),this.transformColumnsRecursive(ue,I)}),I}transformColumnsRecursive(e,I){Object.keys(e.columns).forEach(oe=>{const bt=e.columns[oe];let tr="regular";bt.createDate&&(tr="createDate"),bt.updateDate&&(tr="updateDate"),bt.deleteDate&&(tr="deleteDate"),bt.version&&(tr="version"),bt.treeChildrenCount&&(tr="treeChildrenCount"),bt.treeLevel&&(tr="treeLevel"),bt.objectId&&(tr="objectId");const rr={target:e.target||e.name,mode:tr,propertyName:oe,options:{type:bt.type,name:bt.objectId?"_id":bt.name,primaryKeyConstraintName:bt.primaryKeyConstraintName,length:bt.length,width:bt.width,nullable:bt.nullable,readonly:bt.readonly,update:bt.update,select:bt.select,insert:bt.insert,primary:bt.primary,unique:bt.unique,comment:bt.comment,default:bt.default,onUpdate:bt.onUpdate,precision:bt.precision,scale:bt.scale,zerofill:bt.zerofill,unsigned:bt.unsigned,charset:bt.charset,collation:bt.collation,enum:bt.enum,enumName:bt.enumName,asExpression:bt.asExpression,generatedType:bt.generatedType,hstoreType:bt.hstoreType,array:bt.array,transformer:bt.transformer,spatialFeatureType:bt.spatialFeatureType,srid:bt.srid}};if(I.columns.push(rr),bt.generated){const ir={target:e.target||e.name,propertyName:oe,strategy:typeof bt.generated=="string"?bt.generated:"increment"};I.generations.push(ir)}bt.unique&&I.uniques.push({target:e.target||e.name,columns:[oe]})}),e.relations&&Object.keys(e.relations).forEach(oe=>{const ue=e.relations[oe],bt={target:e.target||e.name,propertyName:oe,relationType:ue.type,isLazy:ue.lazy||!1,type:ue.target,inverseSideProperty:ue.inverseSide,isTreeParent:ue.treeParent,isTreeChildren:ue.treeChildren,options:{eager:ue.eager||!1,cascade:ue.cascade,nullable:ue.nullable,onDelete:ue.onDelete,onUpdate:ue.onUpdate,deferrable:ue.deferrable,createForeignKeyConstraints:ue.createForeignKeyConstraints,persistence:ue.persistence,orphanedRowAction:ue.orphanedRowAction}};if(I.relations.push(bt),ue.joinColumn)if(typeof ue.joinColumn=="boolean"){const tr={target:e.target||e.name,propertyName:oe};I.joinColumns.push(tr)}else{const tr=Array.isArray(ue.joinColumn)?ue.joinColumn:[ue.joinColumn];for(const rr of tr){const ir={target:e.target||e.name,propertyName:oe,name:rr.name,referencedColumnName:rr.referencedColumnName,foreignKeyConstraintName:rr.foreignKeyConstraintName};I.joinColumns.push(ir)}}if(ue.joinTable)if(typeof ue.joinTable=="boolean"){const tr={target:e.target||e.name,propertyName:oe};I.joinTables.push(tr)}else{const tr={target:e.target||e.name,propertyName:oe,name:ue.joinTable.name,database:ue.joinTable.database,schema:ue.joinTable.schema,joinColumns:ue.joinTable.joinColumn?[ue.joinTable.joinColumn]:ue.joinTable.joinColumns,inverseJoinColumns:ue.joinTable.inverseJoinColumn?[ue.joinTable.inverseJoinColumn]:ue.joinTable.inverseJoinColumns};I.joinTables.push(tr)}}),e.relationIds&&Object.keys(e.relationIds).forEach(oe=>{const ue=e.relationIds[oe],bt={propertyName:oe,relation:ue.relationName,target:e.target||e.name,alias:ue.alias,queryBuilderFactory:ue.queryBuilderFactory};I.relationIds.push(bt)}),e.indices&&e.indices.forEach(oe=>{const ue={target:e.target||e.name,name:oe.name,unique:oe.unique===!0,spatial:oe.spatial===!0,fulltext:oe.fulltext===!0,nullFiltered:oe.nullFiltered===!0,parser:oe.parser,synchronize:oe.synchronize!==!1,where:oe.where,sparse:oe.sparse,columns:oe.columns};I.indices.push(ue)}),e.uniques&&e.uniques.forEach(oe=>{const ue={target:e.target||e.name,name:oe.name,columns:oe.columns,deferrable:oe.deferrable};I.uniques.push(ue)}),e.checks&&e.checks.forEach(oe=>{const ue={target:e.target||e.name,name:oe.name,expression:oe.expression};I.checks.push(ue)}),e.exclusions&&e.exclusions.forEach(oe=>{const ue={target:e.target||e.name,name:oe.name,expression:oe.expression};I.exclusions.push(ue)}),e.embeddeds&&Object.keys(e.embeddeds).forEach(oe=>{const ue=e.embeddeds[oe];if(!ue.schema)throw EntitySchemaEmbeddedError.createEntitySchemaIsRequiredException(oe);const bt=ue.schema.options;I.embeddeds.push({target:e.target||e.name,propertyName:oe,isArray:ue.array===!0,prefix:ue.prefix!==void 0?ue.prefix:void 0,type:()=>bt?.target||bt.name}),this.transformColumnsRecursive(bt,I)})}}class ConnectionMetadataBuilder{constructor(e){this.connection=e}async buildMigrations(e){const[I,oe]=OrmUtils.splitClassesAndStrings(e);return[...I,...await importClassesFromDirectories(this.connection.logger)].map(bt=>getFromContainer(bt))}async buildSubscribers(e){const[I,oe]=OrmUtils.splitClassesAndStrings(e||[]),ue=[...I,...await importClassesFromDirectories(this.connection.logger)];return getMetadataArgsStorage().filterSubscribers(ue).map(bt=>getFromContainer(bt.target))}async buildEntityMetadatas(e){const[I,oe]=OrmUtils.splitClassesAndStrings(e||[]),ue=I.filter(dr=>!InstanceChecker.isEntitySchema(dr)),bt=I.filter(dr=>InstanceChecker.isEntitySchema(dr)),tr=[...ue,...await importClassesFromDirectories(this.connection.logger)];tr.forEach(dr=>{InstanceChecker.isEntitySchema(dr)&&bt.push(dr)});const rr=new EntityMetadataBuilder(this.connection,getMetadataArgsStorage()).build(tr),ir=new EntitySchemaTransformer().transform(bt),lr=new EntityMetadataBuilder(this.connection,ir).build();return[...rr,...lr]}}class AbstractLogger{constructor(e){this.options=e}logQuery(e,I,oe){this.isLogEnabledFor("query")&&this.writeLog("query",{type:"query",prefix:"query",message:e,format:"sql",parameters:I},oe)}logQueryError(e,I,oe,ue){this.isLogEnabledFor("query-error")&&this.writeLog("warn",[{type:"query-error",prefix:"query failed",message:I,format:"sql",parameters:oe},{type:"query-error",prefix:"error",message:e}],ue)}logQuerySlow(e,I,oe,ue){this.isLogEnabledFor("query-slow")&&this.writeLog("warn",[{type:"query-slow",prefix:"query is slow",message:I,format:"sql",parameters:oe,additionalInfo:{time:e}},{type:"query-slow",prefix:"execution time",message:e}],ue)}logSchemaBuild(e,I){this.isLogEnabledFor("schema-build")&&this.writeLog("schema",{type:"schema-build",message:e},I)}logMigration(e,I){this.isLogEnabledFor("migration")&&this.writeLog("log",{type:"migration",message:e},I)}log(e,I,oe){switch(e){case"log":if(!this.isLogEnabledFor("log"))return;this.writeLog("log",{type:"log",message:I},oe);break;case"info":if(!this.isLogEnabledFor("info"))return;this.writeLog("info",{type:"info",prefix:"info",message:I},oe);break;case"warn":if(!this.isLogEnabledFor("warn"))return;this.writeLog("warn",{type:"warn",message:I},oe);break}}isLogEnabledFor(e){switch(e){case"query":return this.options==="all"||this.options===!0||Array.isArray(this.options)&&this.options.indexOf("query")!==-1;case"error":case"query-error":return this.options==="all"||this.options===!0||Array.isArray(this.options)&&this.options.indexOf("error")!==-1;case"query-slow":return!0;case"schema":case"schema-build":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("schema")!==-1;case"migration":return!0;case"log":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("log")!==-1;case"info":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("info")!==-1;case"warn":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("warn")!==-1;default:return!1}}prepareLogMessages(e,I){I={addColonToPrefix:!0,appendParameterAsComment:!0,highlightSql:!0,...I};const oe=Array.isArray(e)?e:[e];for(let ue of oe){if(typeof ue!="object"&&(ue={message:ue}),ue.format==="sql"){let bt=String(ue.message);I.appendParameterAsComment&&ue.parameters&&ue.parameters.length&&(bt+=` -- PARAMETERS: ${this.stringifyParams(ue.parameters)}`),I.highlightSql&&(bt=PlatformTools.highlightSql(bt)),ue.message=bt}I.addColonToPrefix&&ue.prefix&&(ue.prefix+=":")}return oe}stringifyParams(e){try{return JSON.stringify(e)}catch{return e}}}class SimpleConsoleLogger extends AbstractLogger{writeLog(e,I,oe){const ue=this.prepareLogMessages(I,{highlightSql:!1});for(let bt of ue)switch(bt.type??e){case"log":case"schema-build":case"migration":console.log(bt.message);break;case"info":case"query":bt.prefix?console.info(bt.prefix,bt.message):console.info(bt.message);break;case"warn":case"query-slow":bt.prefix?console.warn(bt.prefix,bt.message):console.warn(bt.message);break;case"error":case"query-error":bt.prefix?console.error(bt.prefix,bt.message):console.error(bt.message);break}}}class AdvancedConsoleLogger extends AbstractLogger{writeLog(e,I,oe){const ue=this.prepareLogMessages(I);for(let bt of ue)switch(bt.type??e){case"log":case"schema-build":case"migration":PlatformTools.log(String(bt.message));break;case"info":case"query":bt.prefix?PlatformTools.logInfo(bt.prefix,bt.message):PlatformTools.log(String(bt.message));break;case"warn":case"query-slow":bt.prefix?PlatformTools.logWarn(bt.prefix,bt.message):console.warn(PlatformTools.warn(String(bt.message)));break;case"error":case"query-error":bt.prefix?PlatformTools.logError(bt.prefix,String(bt.message)):console.error(PlatformTools.error(String(bt.message)));break}}}class DummyLogger{logQuery(){throw new Error("This logger is not applicable in a browser context")}logQueryError(){throw new Error("This logger is not applicable in a browser context")}logQuerySlow(){throw new Error("This logger is not applicable in a browser context")}logSchemaBuild(){throw new Error("This logger is not applicable in a browser context")}logMigration(){throw new Error("This logger is not applicable in a browser context")}log(){throw new Error("This logger is not applicable in a browser context")}}class FileLogger extends DummyLogger{}function getDefaultExportFromCjs(ae){return ae&&ae.__esModule&&Object.prototype.hasOwnProperty.call(ae,"default")?ae.default:ae}var browser$1={exports:{}},process=browser$1.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(ae){if(cachedSetTimeout===setTimeout)return setTimeout(ae,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(ae,0);try{return cachedSetTimeout(ae,0)}catch{try{return cachedSetTimeout.call(null,ae,0)}catch{return cachedSetTimeout.call(this,ae,0)}}}function runClearTimeout(ae){if(cachedClearTimeout===clearTimeout)return clearTimeout(ae);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(ae);try{return cachedClearTimeout(ae)}catch{try{return cachedClearTimeout.call(null,ae)}catch{return cachedClearTimeout.call(this,ae)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var ae=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(ae)}}process.nextTick=function(ae){var e=new Array(arguments.length-1);if(arguments.length>1)for(var I=1;I<arguments.length;I++)e[I-1]=arguments[I];queue.push(new Item(ae,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(ae,e){this.fun=ae,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(ae){return[]};process.binding=function(ae){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(ae){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports$1=browser$1.exports;const process$1=getDefaultExportFromCjs(browserExports$1);var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var ae=1e3,e=ae*60,I=e*60,oe=I*24,ue=oe*7,bt=oe*365.25;ms=function(dr,pr){pr=pr||{};var hr=typeof dr;if(hr==="string"&&dr.length>0)return tr(dr);if(hr==="number"&&isFinite(dr))return pr.long?ir(dr):rr(dr);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(dr))};function tr(dr){if(dr=String(dr),!(dr.length>100)){var pr=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(dr);if(pr){var hr=parseFloat(pr[1]),_r=(pr[2]||"ms").toLowerCase();switch(_r){case"years":case"year":case"yrs":case"yr":case"y":return hr*bt;case"weeks":case"week":case"w":return hr*ue;case"days":case"day":case"d":return hr*oe;case"hours":case"hour":case"hrs":case"hr":case"h":return hr*I;case"minutes":case"minute":case"mins":case"min":case"m":return hr*e;case"seconds":case"second":case"secs":case"sec":case"s":return hr*ae;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return hr;default:return}}}}function rr(dr){var pr=Math.abs(dr);return pr>=oe?Math.round(dr/oe)+"d":pr>=I?Math.round(dr/I)+"h":pr>=e?Math.round(dr/e)+"m":pr>=ae?Math.round(dr/ae)+"s":dr+"ms"}function ir(dr){var pr=Math.abs(dr);return pr>=oe?lr(dr,pr,oe,"day"):pr>=I?lr(dr,pr,I,"hour"):pr>=e?lr(dr,pr,e,"minute"):pr>=ae?lr(dr,pr,ae,"second"):dr+" ms"}function lr(dr,pr,hr,_r){var yr=pr>=hr*1.5;return Math.round(dr/hr)+" "+_r+(yr?"s":"")}return ms}function setup(ae){I.debug=I,I.default=I,I.coerce=ir,I.disable=bt,I.enable=ue,I.enabled=tr,I.humanize=requireMs(),I.destroy=lr,Object.keys(ae).forEach(dr=>{I[dr]=ae[dr]}),I.names=[],I.skips=[],I.formatters={};function e(dr){let pr=0;for(let hr=0;hr<dr.length;hr++)pr=(pr<<5)-pr+dr.charCodeAt(hr),pr|=0;return I.colors[Math.abs(pr)%I.colors.length]}I.selectColor=e;function I(dr){let pr,hr=null,_r,yr;function wr(...Tr){if(!wr.enabled)return;const Ar=wr,Sr=Number(new Date),Mr=Sr-(pr||Sr);Ar.diff=Mr,Ar.prev=pr,Ar.curr=Sr,pr=Sr,Tr[0]=I.coerce(Tr[0]),typeof Tr[0]!="string"&&Tr.unshift("%O");let vr=0;Tr[0]=Tr[0].replace(/%([a-zA-Z%])/g,(es,ss)=>{if(es==="%%")return"%";vr++;const os=I.formatters[ss];if(typeof os=="function"){const $r=Tr[vr];es=os.call(Ar,$r),Tr.splice(vr,1),vr--}return es}),I.formatArgs.call(Ar,Tr),(Ar.log||I.log).apply(Ar,Tr)}return wr.namespace=dr,wr.useColors=I.useColors(),wr.color=I.selectColor(dr),wr.extend=oe,wr.destroy=I.destroy,Object.defineProperty(wr,"enabled",{enumerable:!0,configurable:!1,get:()=>hr!==null?hr:(_r!==I.namespaces&&(_r=I.namespaces,yr=I.enabled(dr)),yr),set:Tr=>{hr=Tr}}),typeof I.init=="function"&&I.init(wr),wr}function oe(dr,pr){const hr=I(this.namespace+(typeof pr>"u"?":":pr)+dr);return hr.log=this.log,hr}function ue(dr){I.save(dr),I.namespaces=dr,I.names=[],I.skips=[];let pr;const hr=(typeof dr=="string"?dr:"").split(/[\s,]+/),_r=hr.length;for(pr=0;pr<_r;pr++)hr[pr]&&(dr=hr[pr].replace(/\*/g,".*?"),dr[0]==="-"?I.skips.push(new RegExp("^"+dr.slice(1)+"$")):I.names.push(new RegExp("^"+dr+"$")))}function bt(){const dr=[...I.names.map(rr),...I.skips.map(rr).map(pr=>"-"+pr)].join(",");return I.enable(""),dr}function tr(dr){if(dr[dr.length-1]==="*")return!0;let pr,hr;for(pr=0,hr=I.skips.length;pr<hr;pr++)if(I.skips[pr].test(dr))return!1;for(pr=0,hr=I.names.length;pr<hr;pr++)if(I.names[pr].test(dr))return!0;return!1}function rr(dr){return dr.toString().substring(2,dr.toString().length-2).replace(/\.\*\?$/,"*")}function ir(dr){return dr instanceof Error?dr.stack||dr.message:dr}function lr(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return I.enable(I.load()),I}var common=setup;(function(ae,e){var I={};e.formatArgs=ue,e.save=bt,e.load=tr,e.useColors=oe,e.storage=rr(),e.destroy=(()=>{let lr=!1;return()=>{lr||(lr=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function oe(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let lr;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(lr=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(lr[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ue(lr){if(lr[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+lr[0]+(this.useColors?"%c ":" ")+"+"+ae.exports.humanize(this.diff),!this.useColors)return;const dr="color: "+this.color;lr.splice(1,0,dr,"color: inherit");let pr=0,hr=0;lr[0].replace(/%[a-zA-Z%]/g,_r=>{_r!=="%%"&&(pr++,_r==="%c"&&(hr=pr))}),lr.splice(hr,0,dr)}e.log=console.debug||console.log||(()=>{});function bt(lr){try{lr?e.storage.setItem("debug",lr):e.storage.removeItem("debug")}catch{}}function tr(){let lr;try{lr=e.storage.getItem("debug")}catch{}return!lr&&typeof process$1<"u"&&"env"in process$1&&(lr=I.DEBUG),lr}function rr(){try{return localStorage}catch{}}ae.exports=common(e);const{formatters:ir}=ae.exports;ir.j=function(lr){try{return JSON.stringify(lr)}catch(dr){return"[UnexpectedJSONParseError]: "+dr.message}}})(browser,browser.exports);var browserExports=browser.exports;class DebugLogger extends AbstractLogger{constructor(){super(...arguments),this.logger={log:browserExports.debug("typeorm:log"),info:browserExports.debug("typeorm:info"),warn:browserExports.debug("typeorm:warn"),error:browserExports.debug("typeorm:error"),query:browserExports.debug("typeorm:query:log"),"query-error":browserExports.debug("typeorm:query:error"),"query-slow":browserExports.debug("typeorm:query:slow"),"schema-build":browserExports.debug("typeorm:schema"),migration:browserExports.debug("typeorm:migration")}}isLogEnabledFor(e){switch(e){case"query":return this.logger.query.enabled;case"query-error":return this.logger["query-error"].enabled;case"query-slow":return!0;case"schema":case"schema-build":return this.logger["schema-build"].enabled;case"migration":return this.logger.migration.enabled;case"log":return this.logger.log.enabled;case"info":return this.logger.info.enabled;case"warn":return this.logger.warn.enabled;default:return!1}}writeLog(e,I,oe){const ue=this.prepareLogMessages(I,{appendParameterAsComment:!1});for(let bt of ue){const tr=bt.type??e;tr in this.logger&&(bt.prefix?this.logger[tr](bt.prefix,bt.message):this.logger[tr](bt.message),bt.parameters&&bt.parameters.length&&this.logger[tr]("parameters:",bt.parameters))}}}class LoggerFactory{create(e,I){if(ObjectUtils.isObject(e))return e;if(e)switch(e){case"simple-console":return new SimpleConsoleLogger(I);case"file":return new FileLogger(I);case"advanced-console":return new AdvancedConsoleLogger(I);case"debug":return new DebugLogger}return new AdvancedConsoleLogger(I)}}class RedisQueryResultCache{constructor(e,I){this.connection=e,this.clientType=I,this.redis=this.loadRedis()}async connect(){const e=this.connection.options.cache;if(this.clientType==="redis")this.client=this.redis.createClient({...e?.options,legacyMode:!0}),typeof this.connection.options.cache=="object"&&this.connection.options.cache.ignoreErrors&&this.client.on("error",I=>{this.connection.logger.log("warn",I)}),"connect"in this.client&&await this.client.connect();else if(this.clientType==="ioredis")e&&e.port?e.options?this.client=new this.redis(e.port,e.options):this.client=new this.redis(e.port):e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if(this.clientType==="ioredis/cluster")if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else if(e&&e.options&&e.options.startupNodes)this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options);else throw new TypeORMError(`options.startupNodes required for ${this.clientType}.`)}async disconnect(){return new Promise((e,I)=>{this.client.quit((oe,ue)=>{if(oe)return I(oe);e(),this.client=void 0})})}async synchronize(e){}getFromCache(e,I){return new Promise((oe,ue)=>{e.identifier?this.client.get(e.identifier,(bt,tr)=>{if(bt)return ue(bt);oe(JSON.parse(tr))}):e.query?this.client.get(e.query,(bt,tr)=>{if(bt)return ue(bt);oe(JSON.parse(tr))}):oe(void 0)})}isExpired(e){return e.time+e.duration<new Date().getTime()}async storeInCache(e,I,oe){return new Promise((ue,bt)=>{e.identifier?this.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,(tr,rr)=>{if(tr)return bt(tr);ue()}):e.query&&this.client.set(e.query,JSON.stringify(e),"PX",e.duration,(tr,rr)=>{if(tr)return bt(tr);ue()})})}async clear(e){return new Promise((I,oe)=>{this.client.flushdb((ue,bt)=>{if(ue)return oe(ue);I()})})}async remove(e,I){await Promise.all(e.map(oe=>this.deleteKey(oe)))}deleteKey(e){return new Promise((I,oe)=>{this.client.del(e,(ue,bt)=>{if(ue)return oe(ue);I()})})}loadRedis(){try{return this.clientType==="ioredis/cluster"?PlatformTools.load("ioredis"):PlatformTools.load(this.clientType)}catch{throw new TypeORMError(`Cannot use cache because ${this.clientType} is not installed. Please run "npm i ${this.clientType} --save".`)}}}class DbQueryResultCache{constructor(e){this.connection=e;const{schema:I}=this.connection.driver.options,oe=this.connection.driver.database,bt=(typeof this.connection.options.cache=="object"?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheDatabase=oe,this.queryResultCacheSchema=I,this.queryResultCacheTable=this.connection.driver.buildTableName(bt,I,oe)}async connect(){}async disconnect(){}async synchronize(e){e=this.getQueryRunner(e);const I=this.connection.driver;await e.hasTable(this.queryResultCacheTable)||await e.createTable(new Table({database:this.queryResultCacheDatabase,schema:this.queryResultCacheSchema,name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:I.normalizeType({type:I.mappedDataTypes.cacheId}),generationStrategy:I.options.type==="spanner"?"uuid":"increment",isGenerated:!0},{name:"identifier",type:I.normalizeType({type:I.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:I.normalizeType({type:I.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:I.normalizeType({type:I.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:I.normalizeType({type:I.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:I.normalizeType({type:I.mappedDataTypes.cacheResult}),isNullable:!1}]}))}getFromCache(e,I){I=this.getQueryRunner(I);const oe=this.connection.createQueryBuilder(I).select().from(this.queryResultCacheTable,"cache");return e.identifier?oe.where(`${oe.escape("cache")}.${oe.escape("identifier")} = :identifier`).setParameters({identifier:this.connection.driver.options.type==="mssql"?new MssqlParameter(e.identifier,"nvarchar"):e.identifier}).cache(!1).getRawOne():e.query?this.connection.driver.options.type==="oracle"?oe.where(`dbms_lob.compare(${oe.escape("cache")}.${oe.escape("query")}, :query) = 0`,{query:e.query}).cache(!1).getRawOne():oe.where(`${oe.escape("cache")}.${oe.escape("query")} = :query`).setParameters({query:this.connection.driver.options.type==="mssql"?new MssqlParameter(e.query,"nvarchar"):e.query}).cache(!1).getRawOne():Promise.resolve(void 0)}isExpired(e){const I=typeof e.duration=="string"?parseInt(e.duration):e.duration;return(typeof e.time=="string"?parseInt(e.time):e.time)+I<new Date().getTime()}async storeInCache(e,I,oe){const ue=oe===void 0||oe?.getReplicationMode()==="slave";(oe===void 0||ue)&&(oe=this.connection.createQueryRunner("master"));let bt=e;if(this.connection.driver.options.type==="mssql"&&(bt={identifier:new MssqlParameter(e.identifier,"nvarchar"),time:new MssqlParameter(e.time,"bigint"),duration:new MssqlParameter(e.duration,"int"),query:new MssqlParameter(e.query,"nvarchar"),result:new MssqlParameter(e.result,"nvarchar")}),I&&I.identifier){const tr=oe.manager.createQueryBuilder().update(this.queryResultCacheTable).set(bt);tr.where(`${tr.escape("identifier")} = :condition`,{condition:bt.identifier}),await tr.execute()}else if(I&&I.query){const tr=oe.manager.createQueryBuilder().update(this.queryResultCacheTable).set(bt);this.connection.driver.options.type==="oracle"?tr.where('dbms_lob.compare("query", :condition) = 0',{condition:bt.query}):tr.where(`${tr.escape("query")} = :condition`,{condition:bt.query}),await tr.execute()}else this.connection.driver.options.type==="spanner"&&!bt.id&&(bt.id=v4()),await oe.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(bt).execute();ue&&await oe.release()}async clear(e){return this.getQueryRunner(e).clearTable(this.queryResultCacheTable)}async remove(e,I){let oe=I||this.getQueryRunner();await Promise.all(e.map(ue=>{const bt=oe.manager.createQueryBuilder();return bt.delete().from(this.queryResultCacheTable).where(`${bt.escape("identifier")} = :identifier`,{identifier:ue}).execute()})),I||await oe.release()}getQueryRunner(e){return e||this.connection.createQueryRunner()}}class QueryResultCacheFactory{constructor(e){this.connection=e}create(){if(!this.connection.options.cache)throw new TypeORMError("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");const e=this.connection.options.cache;return e.provider&&typeof e.provider=="function"?e.provider(this.connection):e.type==="redis"||e.type==="ioredis"||e.type==="ioredis/cluster"?new RedisQueryResultCache(this.connection,e.type):new DbQueryResultCache(this.connection)}}class RelationLoader{constructor(e){this.connection=e}load(e,I,oe,ue){return oe&&oe.isReleased&&(oe=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,I,oe,ue):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,I,oe,ue):e.isManyToManyOwner?this.loadManyToManyOwner(e,I,oe,ue):this.loadManyToManyNotOwner(e,I,oe,ue)}loadManyToOneOrOneToOneOwner(e,I,oe,ue){const bt=Array.isArray(I)?I:[I],tr=e.entityMetadata.name,rr=ue||this.connection.createQueryBuilder(oe).select(e.propertyName).from(e.type,e.propertyName),ir=rr.expressionMap.mainAlias.name,lr=e.entityMetadata.primaryColumns,pr=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map(hr=>`${e.entityMetadata.name}.${hr.propertyName} = ${ir}.${hr.referencedColumn.propertyName}`).join(" AND ");if(rr.innerJoin(e.entityMetadata.target,tr,pr),lr.length===1)rr.where(`${tr}.${lr[0].propertyPath} IN (:...${tr+"_"+lr[0].propertyName})`),rr.setParameter(tr+"_"+lr[0].propertyName,bt.map(hr=>lr[0].getEntityValue(hr,!0)));else{const hr=bt.map((_r,yr)=>lr.map((wr,Tr)=>{const Ar=tr+"_entity_"+yr+"_"+Tr;return rr.setParameter(Ar,wr.getEntityValue(_r,!0)),tr+"."+wr.propertyPath+" = :"+Ar}).join(" AND ")).map(_r=>"("+_r+")").join(" OR ");rr.where(hr)}return FindOptionsUtils.joinEagerRelations(rr,rr.alias,rr.expressionMap.mainAlias.metadata),rr.getMany()}loadOneToManyOrOneToOneNotOwner(e,I,oe,ue){const bt=Array.isArray(I)?I:[I],tr=e.inverseRelation.joinColumns,rr=ue||this.connection.createQueryBuilder(oe).select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName),ir=rr.expressionMap.mainAlias.name;if(tr.length===1)rr.where(`${ir}.${tr[0].propertyPath} IN (:...${ir+"_"+tr[0].propertyName})`),rr.setParameter(ir+"_"+tr[0].propertyName,bt.map(lr=>tr[0].referencedColumn.getEntityValue(lr,!0)));else{const lr=bt.map((dr,pr)=>tr.map((hr,_r)=>{const yr=ir+"_entity_"+pr+"_"+_r;return rr.setParameter(yr,hr.referencedColumn.getEntityValue(dr,!0)),ir+"."+hr.propertyPath+" = :"+yr}).join(" AND ")).map(dr=>"("+dr+")").join(" OR ");rr.where(lr)}return FindOptionsUtils.joinEagerRelations(rr,rr.alias,rr.expressionMap.mainAlias.metadata),rr.getMany()}loadManyToManyOwner(e,I,oe,ue){const bt=Array.isArray(I)?I:[I],tr=e.joinColumns.reduce((hr,_r)=>(hr[_r.propertyName]=bt.map(yr=>_r.referencedColumn.getEntityValue(yr,!0)),hr),{}),rr=ue||this.connection.createQueryBuilder(oe).select(e.propertyName).from(e.type,e.propertyName),ir=rr.expressionMap.mainAlias.name,lr=e.junctionEntityMetadata.tableName,dr=e.joinColumns.map(hr=>`${lr}.${hr.propertyName} IN (:...${hr.propertyName})`),pr=e.inverseJoinColumns.map(hr=>`${lr}.${hr.propertyName}=${ir}.${hr.referencedColumn.propertyName}`);return rr.innerJoin(lr,lr,[...dr,...pr].join(" AND ")).setParameters(tr),FindOptionsUtils.joinEagerRelations(rr,rr.alias,rr.expressionMap.mainAlias.metadata),rr.getMany()}loadManyToManyNotOwner(e,I,oe,ue){const bt=Array.isArray(I)?I:[I],tr=ue||this.connection.createQueryBuilder(oe).select(e.propertyName).from(e.type,e.propertyName),rr=tr.expressionMap.mainAlias.name,ir=e.junctionEntityMetadata.tableName,lr=e.inverseRelation.joinColumns.map(hr=>`${ir}.${hr.propertyName} = ${rr}.${hr.referencedColumn.propertyName}`),dr=e.inverseRelation.inverseJoinColumns.map(hr=>`${ir}.${hr.propertyName} IN (:...${hr.propertyName})`),pr=e.inverseRelation.inverseJoinColumns.reduce((hr,_r)=>(hr[_r.propertyName]=bt.map(yr=>_r.referencedColumn.getEntityValue(yr,!0)),hr),{});return tr.innerJoin(ir,ir,[...lr,...dr].join(" AND ")).setParameters(pr),FindOptionsUtils.joinEagerRelations(tr,tr.alias,tr.expressionMap.mainAlias.metadata),tr.getMany()}enableLazyLoad(e,I,oe){const ue=this,bt="__"+e.propertyName+"__",tr="__promise_"+e.propertyName+"__",rr="__has_"+e.propertyName+"__",ir=(dr,pr)=>(dr[bt]=pr,dr[rr]=!0,delete dr[tr],pr),lr=(dr,pr)=>(delete dr[rr],delete dr[bt],dr[tr]=pr,pr.then(hr=>dr[tr]===pr?ir(dr,hr):hr),pr);Object.defineProperty(I,e.propertyName,{get:function(){if(this[rr]===!0||this[bt]!==void 0)return Promise.resolve(this[bt]);if(this[tr])return this[tr];const dr=ue.load(e,this,oe).then(pr=>e.isOneToOne||e.isManyToOne?pr.length===0?null:pr[0]:pr);return lr(this,dr)},set:function(dr){dr instanceof Promise?lr(this,dr):ir(this,dr)},configurable:!0,enumerable:!1})}}registerQueryBuilders();class DataSource{constructor(e){this["@instanceof"]=Symbol.for("DataSource"),this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.entityMetadatasMap=new Map,registerQueryBuilders(),this.name=e.name||"default",this.options=e,this.logger=new LoggerFactory().create(this.options.logger,this.options.logging),this.driver=new DriverFactory().create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new DefaultNamingStrategy,this.metadataTableName=e.metadataTableName||"typeorm_metadata",this.queryResultCache=e.cache?new QueryResultCacheFactory(this).create():void 0,this.relationLoader=new RelationLoader(this),this.relationIdLoader=new RelationIdLoader(this),this.isInitialized=!1}get isConnected(){return this.isInitialized}get mongoManager(){if(!InstanceChecker.isMongoEntityManager(this.manager))throw new TypeORMError("MongoEntityManager is only available for MongoDB databases.");return this.manager}get sqljsManager(){if(!InstanceChecker.isSqljsEntityManager(this.manager))throw new TypeORMError("SqljsEntityManager is only available for Sqljs databases.");return this.manager}setOptions(e){return Object.assign(this.options,e),(e.logger||e.logging)&&(this.logger=new LoggerFactory().create(e.logger||this.options.logger,e.logging||this.options.logging)),e.namingStrategy&&(this.namingStrategy=e.namingStrategy),e.cache&&(this.queryResultCache=new QueryResultCacheFactory(this).create()),e.database&&(this.driver.database=DriverUtils.buildDriverOptions(this.options).database),this}async initialize(){if(this.isInitialized)throw new CannotConnectAlreadyConnectedError(this.name);await this.driver.connect(),this.queryResultCache&&await this.queryResultCache.connect(),ObjectUtils.assign(this,{isInitialized:!0});try{await this.buildMetadatas(),await this.driver.afterConnect(),this.options.dropSchema&&await this.dropDatabase(),this.options.migrationsRun&&await this.runMigrations({transaction:this.options.migrationsTransactionMode}),this.options.synchronize&&await this.synchronize()}catch(e){throw await this.destroy(),e}return this}async connect(){return this.initialize()}async destroy(){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);await this.driver.disconnect(),this.queryResultCache&&await this.queryResultCache.disconnect(),ObjectUtils.assign(this,{isInitialized:!1})}async close(){return this.destroy()}async synchronize(e=!1){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);e&&await this.dropDatabase(),await this.driver.createSchemaBuilder().build()}async dropDatabase(){const e=this.createQueryRunner();try{if(this.driver.options.type==="mssql"||DriverUtils.isMySQLFamily(this.driver)||this.driver.options.type==="aurora-mysql"||DriverUtils.isSQLiteFamily(this.driver)){const I=[];if(this.entityMetadatas.forEach(oe=>{oe.database&&I.indexOf(oe.database)===-1&&I.push(oe.database)}),I.length===0&&this.driver.database&&I.push(this.driver.database),I.length===0)await e.clearDatabase();else for(const oe of I)await e.clearDatabase(oe)}else await e.clearDatabase()}finally{await e.release()}}async runMigrations(e){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);const I=new MigrationExecutor(this);return I.transaction=e?.transaction||this.options?.migrationsTransactionMode||"all",I.fake=e&&e.fake||!1,await I.executePendingMigrations()}async undoLastMigration(e){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);const I=new MigrationExecutor(this);I.transaction=e&&e.transaction||"all",I.fake=e&&e.fake||!1,await I.undoLastMigration()}async showMigrations(){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);return await new MigrationExecutor(this).showMigrations()}hasMetadata(e){return!!this.findMetadata(e)}getMetadata(e){const I=this.findMetadata(e);if(!I)throw new EntityMetadataNotFoundError(e);return I}getRepository(e){return this.manager.getRepository(e)}getTreeRepository(e){return this.manager.getTreeRepository(e)}getMongoRepository(e){if(this.driver.options.type!=="mongodb")throw new TypeORMError("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)}getCustomRepository(e){return this.manager.getCustomRepository(e)}async transaction(e,I){return this.manager.transaction(e,I)}async query(e,I,oe){if(InstanceChecker.isMongoEntityManager(this.manager))throw new TypeORMError("Queries aren't supported by MongoDB.");if(oe&&oe.isReleased)throw new QueryRunnerProviderAlreadyReleasedError;const ue=oe||this.createQueryRunner();try{return await ue.query(e,I)}finally{oe||await ue.release()}}createQueryBuilder(e,I,oe){if(InstanceChecker.isMongoEntityManager(this.manager))throw new TypeORMError("Query Builder is not supported by MongoDB.");if(I){I=DriverUtils.buildAlias(this.driver,void 0,I);const ue=this.getMetadata(e);return new SelectQueryBuilder(this,oe).select(I).from(ue.target,I)}else return new SelectQueryBuilder(this,e)}createQueryRunner(e="master"){const I=this.driver.createQueryRunner(e),oe=this.createEntityManager(I);return Object.assign(I,{manager:oe}),I}getManyToManyMetadata(e,I){const oe=this.getMetadata(e).findRelationWithPropertyPath(I);if(!oe)throw new TypeORMError(`Relation "${I}" was not found in ${e} entity.`);if(!oe.isManyToMany)throw new TypeORMError(`Relation "${e}#${I}" does not have a many-to-many relationship.You can use this method only on many-to-many relations.`);return oe.junctionEntityMetadata}createEntityManager(e){return new EntityManagerFactory().create(this,e)}findMetadata(e){const I=this.entityMetadatasMap.get(e);if(I)return I;for(let[oe,ue]of this.entityMetadatasMap){if(InstanceChecker.isEntitySchema(e)&&ue.name===e.options.name)return ue;if(typeof e=="string"){if(e.indexOf(".")!==-1){if(ue.tablePath===e)return ue}else if(ue.name===e||ue.tableName===e)return ue}if(ObjectUtils.isObjectWithName(e)&&typeof e.name=="string"){if(e.name.indexOf(".")!==-1){if(ue.tablePath===e.name)return ue}else if(ue.name===e.name||ue.tableName===e.name)return ue}}}async buildMetadatas(){const e=new ConnectionMetadataBuilder(this),I=new EntityMetadataValidator,oe=ObjectUtils.mixedListToArray(this.options.subscribers||[]),ue=await e.buildSubscribers(oe);ObjectUtils.assign(this,{subscribers:ue});const bt=ObjectUtils.mixedListToArray(this.options.entities||[]),tr=await e.buildEntityMetadatas(bt);ObjectUtils.assign(this,{entityMetadatas:tr,entityMetadatasMap:new Map(tr.map(lr=>[lr.target,lr]))});const rr=ObjectUtils.mixedListToArray(this.options.migrations||[]),ir=await e.buildMigrations(rr);ObjectUtils.assign(this,{migrations:ir}),I.validateMany(this.entityMetadatas.filter(lr=>lr.tableType!=="view"),this.driver);for(let lr of tr)InstanceChecker.isBaseEntityConstructor(lr.target)&&lr.target.useDataSource(this)}defaultReplicationModeForReads(){if("replication"in this.driver.options){const e=this.driver.options.replication.defaultMode;if(e)return e}return"slave"}}function getMetadataArgsStorage(){const ae=PlatformTools.getGlobalVariable();return ae.typeormMetadataArgsStorage||(ae.typeormMetadataArgsStorage=new MetadataArgsStorage),ae.typeormMetadataArgsStorage}function Column(ae,e){return function(I,oe){let ue;typeof ae=="string"||typeof ae=="function"?ue=ae:ae&&(e=ae,ue=ae.type),e||(e={});const bt=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",I,oe):void 0;if(!ue&&bt&&(ue=bt),!e.type&&ue&&(e.type=ue),e.type==="hstore"&&!e.hstoreType&&(e.hstoreType=bt===Object?"object":"string"),typeof ae=="function")getMetadataArgsStorage().embeddeds.push({target:I.constructor,propertyName:oe,isArray:bt===Array||e.array===!0,prefix:e.prefix!==void 0?e.prefix:void 0,type:ae});else{if(!e.type)throw new ColumnTypeUndefinedError(I,oe);e.unique===!0&&getMetadataArgsStorage().uniques.push({target:I.constructor,columns:[oe]}),getMetadataArgsStorage().columns.push({target:I.constructor,propertyName:oe,mode:"regular",options:e}),e.generated&&getMetadataArgsStorage().generations.push({target:I.constructor,propertyName:oe,strategy:typeof e.generated=="string"?e.generated:"increment"})}}}function CreateDateColumn(ae){return function(e,I){getMetadataArgsStorage().columns.push({target:e.constructor,propertyName:I,mode:"createDate",options:{}})}}function PrimaryGeneratedColumn(ae,e){const I={};let oe;return oe=ae,ObjectUtils.isObject(ae)&&(oe="increment",Object.assign(I,ae)),ObjectUtils.isObject(e)&&Object.assign(I,e),function(ue,bt){I.type||(oe==="increment"||oe==="identity"?I.type=Number:oe==="uuid"?I.type="uuid":oe==="rowid"&&(I.type="int")),I.primary=!0,getMetadataArgsStorage().columns.push({target:ue.constructor,propertyName:bt,mode:"regular",options:I}),getMetadataArgsStorage().generations.push({target:ue.constructor,propertyName:bt,strategy:oe})}}function UpdateDateColumn(ae){return function(e,I){getMetadataArgsStorage().columns.push({target:e.constructor,propertyName:I,mode:"updateDate",options:{}})}}function JoinColumn(ae){return function(e,I){(Array.isArray(ae)?ae:[ae||{}]).forEach(ue=>{getMetadataArgsStorage().joinColumns.push({target:e.constructor,propertyName:I,name:ue.name,referencedColumnName:ue.referencedColumnName,foreignKeyConstraintName:ue.foreignKeyConstraintName})})}}function ManyToOne(ae,e,I){let oe;return ObjectUtils.isObject(e)?I=e:oe=e,function(ue,bt){I||(I={});let tr=I&&I.lazy===!0;if(!tr&&Reflect&&Reflect.getMetadata){const rr=Reflect.getMetadata("design:type",ue,bt);rr&&typeof rr.name=="string"&&rr.name.toLowerCase()==="promise"&&(tr=!0)}getMetadataArgsStorage().relations.push({target:ue.constructor,propertyName:bt,relationType:"many-to-one",isLazy:tr,type:ae,inverseSideProperty:oe,options:I})}}function OneToMany(ae,e,I){return function(oe,ue){I||(I={});let bt=I&&I.lazy===!0;if(!bt&&Reflect&&Reflect.getMetadata){const tr=Reflect.getMetadata("design:type",oe,ue);tr&&typeof tr.name=="string"&&tr.name.toLowerCase()==="promise"&&(bt=!0)}getMetadataArgsStorage().relations.push({target:oe.constructor,propertyName:ue,isLazy:bt,relationType:"one-to-many",type:ae,inverseSideProperty:e,options:I})}}function OneToOne(ae,e,I){let oe;return ObjectUtils.isObject(e)?I=e:oe=e,function(ue,bt){I||(I={});let tr=!!(I&&I.lazy===!0);if(!tr&&Reflect&&Reflect.getMetadata){const rr=Reflect.getMetadata("design:type",ue,bt);rr&&typeof rr.name=="string"&&rr.name.toLowerCase()==="promise"&&(tr=!0)}getMetadataArgsStorage().relations.push({target:ue.constructor,propertyName:bt,isLazy:tr,relationType:"one-to-one",type:ae,inverseSideProperty:oe,options:I})}}function Entity(ae,e){const I=(ObjectUtils.isObject(ae)?ae:e)||{},oe=typeof ae=="string"?ae:I.name;return function(ue){getMetadataArgsStorage().tables.push({target:ue,name:oe,type:"regular",orderBy:I.orderBy?I.orderBy:void 0,engine:I.engine?I.engine:void 0,database:I.database?I.database:void 0,schema:I.schema?I.schema:void 0,synchronize:I.synchronize,withoutRowid:I.withoutRowid,comment:I.comment?I.comment:void 0})}}function Any(ae){return new FindOperator("any",ae)}function ArrayContainedBy(ae){return new FindOperator("arrayContainedBy",ae)}function ArrayContains(ae){return new FindOperator("arrayContains",ae)}function ArrayOverlap(ae){return new FindOperator("arrayOverlap",ae)}function Between(ae,e){return new FindOperator("between",[ae,e],!0,!0)}class EqualOperator extends FindOperator{constructor(e){super("equal",e),this["@instanceof"]=Symbol.for("EqualOperator")}}function Equal(ae){return new EqualOperator(ae)}function IsNull(){return new FindOperator("isNull",void 0,!1)}function LessThan(ae){return new FindOperator("lessThan",ae)}function LessThanOrEqual(ae){return new FindOperator("lessThanOrEqual",ae)}function Like(ae){return new FindOperator("like",ae)}function MoreThan(ae){return new FindOperator("moreThan",ae)}function MoreThanOrEqual(ae){return new FindOperator("moreThanOrEqual",ae)}function Not(ae){return new FindOperator("not",ae)}function Raw(ae,e){return typeof ae!="function"?new FindOperator("raw",ae,!1):new FindOperator("raw",[],!0,!0,ae,e)}var p=Object.create,i=Object.defineProperty,c=Object.getOwnPropertyDescriptor,f$1=Object.getOwnPropertyNames,l$1=Object.getPrototypeOf,s$1=Object.prototype.hasOwnProperty,a=ae=>{throw TypeError(ae)},_$1=(ae,e)=>()=>(ae&&(e=ae(ae=0)),e),u$1=(ae,e)=>()=>(e||ae((e={exports:{}}).exports,e),e.exports),D$2=(ae,e)=>{for(var I in e)i(ae,I,{get:e[I],enumerable:!0})},d$1=(ae,e,I,oe)=>{if(e&&typeof e=="object"||typeof e=="function")for(let ue of f$1(e))!s$1.call(ae,ue)&&ue!==I&&i(ae,ue,{get:()=>e[ue],enumerable:!(oe=c(e,ue))||oe.enumerable});return ae},F=(ae,e,I)=>(I=ae!=null?p(l$1(ae)):{},d$1(i(I,"default",{value:ae,enumerable:!0}),ae)),n=(ae,e,I)=>e.has(ae)||a("Cannot "+I),g$3=(ae,e,I)=>(n(ae,e,"read from private field"),I?I.call(ae):e.get(ae)),L$3=(ae,e,I)=>e.has(ae)?a("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(ae):e.set(ae,I),h$2=(ae,e,I,oe)=>(n(ae,e,"write to private field"),e.set(ae,I),I),P$1=(ae,e,I)=>(n(ae,e,"access private method"),I),R$2=(ae,e,I,oe)=>({set _(ue){h$2(ae,e,ue)},get _(){return g$3(ae,e,oe)}}),x$1=_$1(()=>{});x$1();var t=async(ae,e)=>({bundlePath:new URL("/NoLLMChat/assets/uuid-ossp.tar-Dgyn50KL.gz",import.meta.url)}),o$3={name:"uuid-ossp",setup:t};const DATABASE_LOG_CONFIG={logging:["error","migration"],logger:"debug"},logDebug=(...ae)=>{};var eventemitter3={exports:{}};(function(ae){var e=Object.prototype.hasOwnProperty,I="~";function oe(){}Object.create&&(oe.prototype=Object.create(null),new oe().__proto__||(I=!1));function ue(ir,lr,dr){this.fn=ir,this.context=lr,this.once=dr||!1}function bt(ir,lr,dr,pr,hr){if(typeof dr!="function")throw new TypeError("The listener must be a function");var _r=new ue(dr,pr||ir,hr),yr=I?I+lr:lr;return ir._events[yr]?ir._events[yr].fn?ir._events[yr]=[ir._events[yr],_r]:ir._events[yr].push(_r):(ir._events[yr]=_r,ir._eventsCount++),ir}function tr(ir,lr){--ir._eventsCount===0?ir._events=new oe:delete ir._events[lr]}function rr(){this._events=new oe,this._eventsCount=0}rr.prototype.eventNames=function(){var lr=[],dr,pr;if(this._eventsCount===0)return lr;for(pr in dr=this._events)e.call(dr,pr)&&lr.push(I?pr.slice(1):pr);return Object.getOwnPropertySymbols?lr.concat(Object.getOwnPropertySymbols(dr)):lr},rr.prototype.listeners=function(lr){var dr=I?I+lr:lr,pr=this._events[dr];if(!pr)return[];if(pr.fn)return[pr.fn];for(var hr=0,_r=pr.length,yr=new Array(_r);hr<_r;hr++)yr[hr]=pr[hr].fn;return yr},rr.prototype.listenerCount=function(lr){var dr=I?I+lr:lr,pr=this._events[dr];return pr?pr.fn?1:pr.length:0},rr.prototype.emit=function(lr,dr,pr,hr,_r,yr){var wr=I?I+lr:lr;if(!this._events[wr])return!1;var Tr=this._events[wr],Ar=arguments.length,Sr,Mr;if(Tr.fn){switch(Tr.once&&this.removeListener(lr,Tr.fn,void 0,!0),Ar){case 1:return Tr.fn.call(Tr.context),!0;case 2:return Tr.fn.call(Tr.context,dr),!0;case 3:return Tr.fn.call(Tr.context,dr,pr),!0;case 4:return Tr.fn.call(Tr.context,dr,pr,hr),!0;case 5:return Tr.fn.call(Tr.context,dr,pr,hr,_r),!0;case 6:return Tr.fn.call(Tr.context,dr,pr,hr,_r,yr),!0}for(Mr=1,Sr=new Array(Ar-1);Mr<Ar;Mr++)Sr[Mr-1]=arguments[Mr];Tr.fn.apply(Tr.context,Sr)}else{var vr=Tr.length,Lr;for(Mr=0;Mr<vr;Mr++)switch(Tr[Mr].once&&this.removeListener(lr,Tr[Mr].fn,void 0,!0),Ar){case 1:Tr[Mr].fn.call(Tr[Mr].context);break;case 2:Tr[Mr].fn.call(Tr[Mr].context,dr);break;case 3:Tr[Mr].fn.call(Tr[Mr].context,dr,pr);break;case 4:Tr[Mr].fn.call(Tr[Mr].context,dr,pr,hr);break;default:if(!Sr)for(Lr=1,Sr=new Array(Ar-1);Lr<Ar;Lr++)Sr[Lr-1]=arguments[Lr];Tr[Mr].fn.apply(Tr[Mr].context,Sr)}}return!0},rr.prototype.on=function(lr,dr,pr){return bt(this,lr,dr,pr,!1)},rr.prototype.once=function(lr,dr,pr){return bt(this,lr,dr,pr,!0)},rr.prototype.removeListener=function(lr,dr,pr,hr){var _r=I?I+lr:lr;if(!this._events[_r])return this;if(!dr)return tr(this,_r),this;var yr=this._events[_r];if(yr.fn)yr.fn===dr&&(!hr||yr.once)&&(!pr||yr.context===pr)&&tr(this,_r);else{for(var wr=0,Tr=[],Ar=yr.length;wr<Ar;wr++)(yr[wr].fn!==dr||hr&&!yr[wr].once||pr&&yr[wr].context!==pr)&&Tr.push(yr[wr]);Tr.length?this._events[_r]=Tr.length===1?Tr[0]:Tr:tr(this,_r)}return this},rr.prototype.removeAllListeners=function(lr){var dr;return lr?(dr=I?I+lr:lr,this._events[dr]&&tr(this,dr)):(this._events=new oe,this._eventsCount=0),this},rr.prototype.off=rr.prototype.removeListener,rr.prototype.addListener=rr.prototype.on,rr.prefixed=I,rr.EventEmitter=rr,ae.exports=rr})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs$1(eventemitter3Exports),gn={};D$2(gn,{ABSTIME:()=>Pt,ACLITEM:()=>Gt,BIT:()=>_t,BOOL:()=>ge$1,BPCHAR:()=>ze,BYTEA:()=>we$1,CHAR:()=>At,CID:()=>xt,CIDR:()=>Ct,CIRCLE:()=>Lt,DATE:()=>qe,FLOAT4:()=>_e,FLOAT8:()=>je,GTSVECTOR:()=>an,INET:()=>Ft,INT2:()=>ve,INT4:()=>Qe,INT8:()=>Ae$1,INTERVAL:()=>Qt,JSON:()=>Se,JSONB:()=>Ye,MACADDR:()=>Vt,MACADDR8:()=>Ot,MONEY:()=>kt,NUMERIC:()=>zt,OID:()=>We,PATH:()=>Rt,PG_DEPENDENCIES:()=>nn,PG_LSN:()=>en,PG_NDISTINCT:()=>tn,PG_NODE_TREE:()=>Mt,POLYGON:()=>Et,REFCURSOR:()=>Ht,REGCLASS:()=>Kt,REGCONFIG:()=>on,REGDICTIONARY:()=>un,REGNAMESPACE:()=>ln,REGOPER:()=>$t,REGOPERATOR:()=>Yt,REGPROC:()=>St,REGPROCEDURE:()=>qt,REGROLE:()=>cn,REGTYPE:()=>Jt,RELTIME:()=>Ut,SMGR:()=>Tt,TEXT:()=>G$1,TID:()=>Dt,TIME:()=>vt,TIMESTAMP:()=>$e,TIMESTAMPTZ:()=>De$1,TIMETZ:()=>Wt,TINTERVAL:()=>Nt,TSQUERY:()=>sn,TSVECTOR:()=>rn,TXID_SNAPSHOT:()=>Zt,UUID:()=>Xt,VARBIT:()=>jt,VARCHAR:()=>He,XID:()=>Bt,XML:()=>It,arrayParser:()=>bn,arraySerializer:()=>Je,parseType:()=>le,parsers:()=>pn,serializers:()=>dn,types:()=>Ke});x$1();var gt=globalThis.JSON.parse,wt=globalThis.JSON.stringify,ge$1=16,we$1=17,At=18,Ae$1=20,ve=21,Qe=23,St=24,G$1=25,We=26,Dt=27,Bt=28,xt=29,Se=114,It=142,Mt=194,Tt=210,Rt=602,Et=604,Ct=650,_e=700,je=701,Pt=702,Ut=703,Nt=704,Lt=718,Ot=774,kt=790,Vt=829,Ft=869,Gt=1033,ze=1042,He=1043,qe=1082,vt=1083,$e=1114,De$1=1184,Qt=1186,Wt=1266,_t=1560,jt=1562,zt=1700,Ht=1790,qt=2202,$t=2203,Yt=2204,Kt=2205,Jt=2206,Xt=2950,Zt=2970,en=3220,tn=3361,nn=3402,rn=3614,sn=3615,an=3642,on=3734,un=3769,Ye=3802,ln=4089,cn=4096,Ke={string:{to:G$1,from:[G$1,He,ze],serialize:ae=>{if(typeof ae=="string")return ae;if(typeof ae=="number")return ae.toString();throw new Error("Invalid input for string type")},parse:ae=>ae},number:{to:0,from:[ve,Qe,We,_e,je],serialize:ae=>ae.toString(),parse:ae=>+ae},bigint:{to:Ae$1,from:[Ae$1],serialize:ae=>ae.toString(),parse:ae=>{let e=BigInt(ae);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:Se,from:[Se,Ye],serialize:ae=>typeof ae=="string"?ae:wt(ae),parse:ae=>gt(ae)},boolean:{to:ge$1,from:[ge$1],serialize:ae=>{if(typeof ae!="boolean")throw new Error("Invalid input for boolean type");return ae?"t":"f"},parse:ae=>ae==="t"},date:{to:De$1,from:[qe,$e,De$1],serialize:ae=>{if(typeof ae=="string")return ae;if(typeof ae=="number")return new Date(ae).toISOString();if(ae instanceof Date)return ae.toISOString();throw new Error("Invalid input for date type")},parse:ae=>new Date(ae)},bytea:{to:we$1,from:[we$1],serialize:ae=>{if(!(ae instanceof Uint8Array))throw new Error("Invalid input for bytea type");return"\\x"+Array.from(ae).map(e=>e.toString(16).padStart(2,"0")).join("")},parse:ae=>{let e=ae.slice(2);return Uint8Array.from({length:e.length/2},(I,oe)=>parseInt(e.substring(oe*2,(oe+1)*2),16))}}},Be$1=fn(Ke),pn=Be$1.parsers,dn=Be$1.serializers;function le(ae,e,I){if(ae===null)return null;let oe=I?.[e]??Be$1.parsers[e];return oe?oe(ae,e):ae}function fn(ae){return Object.keys(ae).reduce(({parsers:e,serializers:I},oe)=>{let{to:ue,from:bt,serialize:tr,parse:rr}=ae[oe];return I[ue]=tr,I[oe]=tr,e[oe]=rr,Array.isArray(bt)?bt.forEach(ir=>{e[ir]=rr,I[ir]=tr}):(e[bt]=rr,I[bt]=tr),{parsers:e,serializers:I}},{parsers:{},serializers:{}})}var mn=/\\/g,yn=/"/g;function hn(ae){return ae.replace(mn,"\\\\").replace(yn,'\\"')}function Je(ae,e,I){if(Array.isArray(ae)===!1)return ae;if(!ae.length)return"{}";let oe=ae[0],ue=I===1020?";":",";return Array.isArray(oe)?`{${ae.map(bt=>Je(bt,e,I)).join(ue)}}`:`{${ae.map(bt=>(bt===void 0&&(bt=null),bt===null?"null":'"'+hn(e?e(bt):bt.toString())+'"')).join(ue)}}`}var be$1={i:0,char:null,str:"",quoted:!1,last:0,p:null};function bn(ae,e,I){return be$1.i=be$1.last=0,Xe(be$1,ae,e,I)[0]}function Xe(ae,e,I,oe){let ue=[],bt=oe===1020?";":",";for(;ae.i<e.length;ae.i++){if(ae.char=e[ae.i],ae.quoted)ae.char==="\\"?ae.str+=e[++ae.i]:ae.char==='"'?(ue.push(I?I(ae.str):ae.str),ae.str="",ae.quoted=e[ae.i+1]==='"',ae.last=ae.i+2):ae.str+=ae.char;else if(ae.char==='"')ae.quoted=!0;else if(ae.char==="{")ae.last=++ae.i,ue.push(Xe(ae,e,I,oe));else if(ae.char==="}"){ae.quoted=!1,ae.last<ae.i&&ue.push(I?I(e.slice(ae.last,ae.i)):e.slice(ae.last,ae.i)),ae.last=ae.i+1;break}else ae.char===bt&&ae.p!=="}"&&ae.p!=='"'&&(ue.push(I?I(e.slice(ae.last,ae.i)):e.slice(ae.last,ae.i)),ae.last=ae.i+1);ae.p=ae.char}return ae.last<ae.i&&ue.push(I?I(e.slice(ae.last,ae.i+1)):e.slice(ae.last,ae.i+1)),ue}var Sn={};D$2(Sn,{parseDescribeStatementResults:()=>xe$1,parseResults:()=>wn});x$1();function wn(ae,e,I,oe){let ue=[],bt={rows:[],fields:[]},tr=0,rr={...e,...I?.parsers},ir=ae.filter(lr=>lr.name==="rowDescription"||lr.name==="dataRow"||lr.name==="commandComplete");return ir.forEach((lr,dr)=>{if(lr.name==="rowDescription"){let pr=lr;bt.fields=pr.fields.map(hr=>({name:hr.name,dataTypeID:hr.dataTypeID}))}else if(lr.name==="dataRow"&&bt){let pr=lr;I?.rowMode==="array"?bt.rows.push(pr.fields.map((hr,_r)=>le(hr,bt.fields[_r].dataTypeID,rr))):bt.rows.push(Object.fromEntries(pr.fields.map((hr,_r)=>[bt.fields[_r].name,le(hr,bt.fields[_r].dataTypeID,rr)])))}else lr.name==="commandComplete"&&(tr+=An(lr),dr===ir.length-1?ue.push({...bt,affectedRows:tr,...oe?{blob:oe}:{}}):ue.push(bt),bt={rows:[],fields:[]})}),ue.length===0&&ue.push({rows:[],fields:[]}),ue}function An(ae){let e=ae.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":return parseInt(e[1],10);default:return 0}}function xe$1(ae){let e=ae.find(I=>I.name==="parameterDescription");return e?e.dataTypeIDs:[]}var Ne={};D$2(Ne,{AuthenticationCleartextPassword:()=>Q,AuthenticationMD5Password:()=>W$1,AuthenticationOk:()=>v$1,AuthenticationSASL:()=>_,AuthenticationSASLContinue:()=>j,AuthenticationSASLFinal:()=>z$1,BackendKeyDataMessage:()=>X$1,CommandCompleteMessage:()=>te$1,CopyDataMessage:()=>H$1,CopyResponse:()=>q$1,DataRowMessage:()=>ne,DatabaseError:()=>C$2,Field:()=>$$1,NoticeMessage:()=>re,NotificationResponseMessage:()=>Z$1,ParameterDescriptionMessage:()=>K$1,ParameterStatusMessage:()=>J,ReadyForQueryMessage:()=>ee$1,RowDescriptionMessage:()=>Y$1,bindComplete:()=>Me,closeComplete:()=>Te,copyDone:()=>Ue,emptyQuery:()=>Pe,noData:()=>Re,parseComplete:()=>Ie$1,portalSuspended:()=>Ee$1,replicationStart:()=>Ce});x$1();var Ie$1={name:"parseComplete",length:5},Me={name:"bindComplete",length:5},Te={name:"closeComplete",length:5},Re={name:"noData",length:5},Ee$1={name:"portalSuspended",length:5},Ce={name:"replicationStart",length:4},Pe={name:"emptyQuery",length:4},Ue={name:"copyDone",length:4},v$1=class{constructor(e){this.length=e,this.name="authenticationOk"}},Q=class{constructor(ae){this.length=ae,this.name="authenticationCleartextPassword"}},W$1=class{constructor(e,I){this.length=e,this.salt=I,this.name="authenticationMD5Password"}},_=class{constructor(ae,e){this.length=ae,this.mechanisms=e,this.name="authenticationSASL"}},j=class{constructor(ae,e){this.length=ae,this.data=e,this.name="authenticationSASLContinue"}},z$1=class{constructor(e,I){this.length=e,this.data=I,this.name="authenticationSASLFinal"}},C$2=class extends Error{constructor(e,I,oe){super(e),this.length=I,this.name=oe}},H$1=class{constructor(e,I){this.length=e,this.chunk=I,this.name="copyData"}},q$1=class{constructor(e,I,oe,ue){this.length=e,this.name=I,this.binary=oe,this.columnTypes=new Array(ue)}},$$1=class{constructor(e,I,oe,ue,bt,tr,rr){this.name=e,this.tableID=I,this.columnID=oe,this.dataTypeID=ue,this.dataTypeSize=bt,this.dataTypeModifier=tr,this.format=rr}},Y$1=class{constructor(e,I){this.length=e,this.fieldCount=I,this.name="rowDescription",this.fields=new Array(this.fieldCount)}},K$1=class{constructor(e,I){this.length=e,this.parameterCount=I,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}},J=class{constructor(ae,e,I){this.length=ae,this.parameterName=e,this.parameterValue=I,this.name="parameterStatus"}},X$1=class{constructor(e,I,oe){this.length=e,this.processID=I,this.secretKey=oe,this.name="backendKeyData"}},Z$1=class{constructor(e,I,oe,ue){this.length=e,this.processId=I,this.channel=oe,this.payload=ue,this.name="notification"}},ee$1=class{constructor(e,I){this.length=e,this.status=I,this.name="readyForQuery"}},te$1=class{constructor(e,I){this.length=e,this.text=I,this.name="commandComplete"}},ne=class{constructor(ae,e){this.length=ae,this.fields=e,this.name="dataRow",this.fieldCount=e.length}},re=class{constructor(ae,e){this.length=ae,this.message=e,this.name="notice"}},qn={};D$2(qn,{Parser:()=>he$1,messages:()=>Ne,serialize:()=>k$1});x$1();x$1();x$1();x$1();function P(ae){let e=ae.length;for(let I=ae.length-1;I>=0;I--){let oe=ae.charCodeAt(I);oe>127&&oe<=2047?e++:oe>2047&&oe<=65535&&(e+=2),oe>=56320&&oe<=57343&&I--}return e}var b$1,g$2,N$1,pe,L$2,S,ce$1,U,Ze,R$1=class{constructor(e=256){this.size=e,L$3(this,S),L$3(this,b$1),L$3(this,g$2,5),L$3(this,N$1,!1),L$3(this,pe,new TextEncoder),L$3(this,L$2,0),h$2(this,b$1,P$1(this,S,ce$1).call(this,e))}addInt32(e){return P$1(this,S,U).call(this,4),g$3(this,b$1).setInt32(g$3(this,g$2),e,g$3(this,N$1)),h$2(this,g$2,g$3(this,g$2)+4),this}addInt16(e){return P$1(this,S,U).call(this,2),g$3(this,b$1).setInt16(g$3(this,g$2),e,g$3(this,N$1)),h$2(this,g$2,g$3(this,g$2)+2),this}addCString(e){return e&&this.addString(e),P$1(this,S,U).call(this,1),g$3(this,b$1).setUint8(g$3(this,g$2),0),R$2(this,g$2)._++,this}addString(e=""){let I=P(e);return P$1(this,S,U).call(this,I),g$3(this,pe).encodeInto(e,new Uint8Array(g$3(this,b$1).buffer,g$3(this,g$2))),h$2(this,g$2,g$3(this,g$2)+I),this}add(e){return P$1(this,S,U).call(this,e.byteLength),new Uint8Array(g$3(this,b$1).buffer).set(new Uint8Array(e),g$3(this,g$2)),h$2(this,g$2,g$3(this,g$2)+e.byteLength),this}flush(e){let I=P$1(this,S,Ze).call(this,e);return h$2(this,g$2,5),h$2(this,b$1,P$1(this,S,ce$1).call(this,this.size)),new Uint8Array(I)}};b$1=new WeakMap,g$2=new WeakMap,N$1=new WeakMap,pe=new WeakMap,L$2=new WeakMap,S=new WeakSet,ce$1=function(ae){return new DataView(new ArrayBuffer(ae))},U=function(ae){if(g$3(this,b$1).byteLength-g$3(this,g$2)<ae){let e=g$3(this,b$1).buffer,I=e.byteLength+(e.byteLength>>1)+ae;h$2(this,b$1,P$1(this,S,ce$1).call(this,I)),new Uint8Array(g$3(this,b$1).buffer).set(new Uint8Array(e))}},Ze=function(ae){if(ae){g$3(this,b$1).setUint8(g$3(this,L$2),ae);let e=g$3(this,g$2)-(g$3(this,L$2)+1);g$3(this,b$1).setInt32(g$3(this,L$2)+1,e,g$3(this,N$1))}return g$3(this,b$1).buffer.slice(ae?0:5,g$3(this,g$2))};var m=new R$1,Dn=ae=>{m.addInt16(3).addInt16(0);for(let oe of Object.keys(ae))m.addCString(oe).addCString(ae[oe]);m.addCString("client_encoding").addCString("UTF8");let e=m.addCString("").flush(),I=e.byteLength+4;return new R$1().addInt32(I).add(e).flush()},Bn=()=>{let ae=new DataView(new ArrayBuffer(8));return ae.setInt32(0,8,!1),ae.setInt32(4,80877103,!1),new Uint8Array(ae.buffer)},xn=ae=>m.addCString(ae).flush(112),In=(ae,e)=>(m.addCString(ae).addInt32(P(e)).addString(e),m.flush(112)),Mn=ae=>m.addString(ae).flush(112),Tn=ae=>m.addCString(ae).flush(81),Rn=[],En=ae=>{let e=ae.name??"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let I=m.addCString(e).addCString(ae.text).addInt16(ae.types?.length??0);return ae.types?.forEach(oe=>I.addInt32(oe)),m.flush(80)},O$1=new R$1,Cn=(ae,e)=>{for(let I=0;I<ae.length;I++){let oe=e?e(ae[I],I):ae[I];if(oe===null)m.addInt16(0),O$1.addInt32(-1);else if(oe instanceof ArrayBuffer||ArrayBuffer.isView(oe)){let ue=ArrayBuffer.isView(oe)?oe.buffer.slice(oe.byteOffset,oe.byteOffset+oe.byteLength):oe;m.addInt16(1),O$1.addInt32(ue.byteLength),O$1.add(ue)}else m.addInt16(0),O$1.addInt32(P(oe)),O$1.addString(oe)}},Pn=(ae={})=>{let e=ae.portal??"",I=ae.statement??"",oe=ae.binary??!1,ue=ae.values??Rn,bt=ue.length;return m.addCString(e).addCString(I),m.addInt16(bt),Cn(ue,ae.valueMapper),m.addInt16(bt),m.add(O$1.flush()),m.addInt16(oe?1:0),m.flush(66)},Un=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),Nn=ae=>{if(!ae||!ae.portal&&!ae.rows)return Un;let e=ae.portal??"",I=ae.rows??0,oe=P(e),ue=4+oe+1+4,bt=new DataView(new ArrayBuffer(1+ue));return bt.setUint8(0,69),bt.setInt32(1,ue,!1),new TextEncoder().encodeInto(e,new Uint8Array(bt.buffer,5)),bt.setUint8(oe+5,0),bt.setUint32(bt.byteLength-4,I,!1),new Uint8Array(bt.buffer)},Ln=(ae,e)=>{let I=new DataView(new ArrayBuffer(16));return I.setInt32(0,16,!1),I.setInt16(4,1234,!1),I.setInt16(6,5678,!1),I.setInt32(8,ae,!1),I.setInt32(12,e,!1),new Uint8Array(I.buffer)},Le=(ae,e)=>{let I=new R$1;return I.addCString(e),I.flush(ae)},On=m.addCString("P").flush(68),kn=m.addCString("S").flush(68),Vn=ae=>ae.name?Le(68,`${ae.type}${ae.name??""}`):ae.type==="P"?On:kn,Fn=ae=>{let e=`${ae.type}${ae.name??""}`;return Le(67,e)},Gn=ae=>m.add(ae).flush(100),vn=ae=>Le(102,ae),de=ae=>new Uint8Array([ae,0,0,0,4]),Qn=de(72),Wn=de(83),_n=de(88),jn=de(99),k$1={startup:Dn,password:xn,requestSsl:Bn,sendSASLInitialResponseMessage:In,sendSCRAMClientFinalMessage:Mn,query:Tn,parse:En,bind:Pn,execute:Nn,describe:Vn,close:Fn,flush:()=>Qn,sync:()=>Wn,end:()=>_n,copyData:Gn,copyDone:()=>jn,copyFail:vn,cancel:Ln};x$1();x$1();var Oe$1={text:0,binary:1};x$1();var zn=new ArrayBuffer(0),T$1,w$1,me,ye$1,se,fe=class{constructor(ae=0){L$3(this,T$1,new DataView(zn)),L$3(this,w$1),L$3(this,me,"utf-8"),L$3(this,ye$1,new TextDecoder(g$3(this,me))),L$3(this,se,!1),h$2(this,w$1,ae)}setBuffer(ae,e){h$2(this,w$1,ae),h$2(this,T$1,new DataView(e))}int16(){let ae=g$3(this,T$1).getInt16(g$3(this,w$1),g$3(this,se));return h$2(this,w$1,g$3(this,w$1)+2),ae}byte(){let ae=g$3(this,T$1).getUint8(g$3(this,w$1));return R$2(this,w$1)._++,ae}int32(){let ae=g$3(this,T$1).getInt32(g$3(this,w$1),g$3(this,se));return h$2(this,w$1,g$3(this,w$1)+4),ae}string(ae){return g$3(this,ye$1).decode(this.bytes(ae))}cstring(){let ae=g$3(this,w$1),e=ae;for(;g$3(this,T$1).getUint8(e++)!==0;);let I=this.string(e-ae-1);return h$2(this,w$1,e),I}bytes(ae){let e=g$3(this,T$1).buffer.slice(g$3(this,w$1),g$3(this,w$1)+ae);return h$2(this,w$1,g$3(this,w$1)+ae),new Uint8Array(e)}};T$1=new WeakMap,w$1=new WeakMap,me=new WeakMap,ye$1=new WeakMap,se=new WeakMap;var ke=1,Hn=4,et=ke+Hn,tt=new ArrayBuffer(0),A$1,D$1,B$1,o$2,l,nt,rt,st,it,at,ot,ut,Ve,lt,ct,pt,dt,ft,mt,yt,ht,Fe,he$1=class{constructor(){L$3(this,l),L$3(this,A$1,new DataView(tt)),L$3(this,D$1,0),L$3(this,B$1,0),L$3(this,o$2,new fe)}parse(e,I){P$1(this,l,nt).call(this,ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e);let oe=g$3(this,B$1)+g$3(this,D$1),ue=g$3(this,B$1);for(;ue+et<=oe;){let bt=g$3(this,A$1).getUint8(ue),tr=g$3(this,A$1).getUint32(ue+ke,!1),rr=ke+tr;if(rr+ue<=oe){let ir=P$1(this,l,rt).call(this,ue+et,bt,tr,g$3(this,A$1).buffer);I(ir),ue+=rr}else break}ue===oe?(h$2(this,A$1,new DataView(tt)),h$2(this,D$1,0),h$2(this,B$1,0)):(h$2(this,D$1,oe-ue),h$2(this,B$1,ue))}};A$1=new WeakMap,D$1=new WeakMap,B$1=new WeakMap,o$2=new WeakMap,l=new WeakSet,nt=function(ae){if(g$3(this,D$1)>0){let e=g$3(this,D$1)+ae.byteLength;if(e+g$3(this,B$1)>g$3(this,A$1).byteLength){let I;if(e<=g$3(this,A$1).byteLength&&g$3(this,B$1)>=g$3(this,D$1))I=g$3(this,A$1).buffer;else{let oe=g$3(this,A$1).byteLength*2;for(;e>=oe;)oe*=2;I=new ArrayBuffer(oe)}new Uint8Array(I).set(new Uint8Array(g$3(this,A$1).buffer,g$3(this,B$1),g$3(this,D$1))),h$2(this,A$1,new DataView(I)),h$2(this,B$1,0)}new Uint8Array(g$3(this,A$1).buffer).set(new Uint8Array(ae),g$3(this,B$1)+g$3(this,D$1)),h$2(this,D$1,e)}else h$2(this,A$1,new DataView(ae)),h$2(this,B$1,0),h$2(this,D$1,ae.byteLength)},rt=function(ae,e,I,oe){switch(e){case 50:return Me;case 49:return Ie$1;case 51:return Te;case 110:return Re;case 115:return Ee$1;case 99:return Ue;case 87:return Ce;case 73:return Pe;case 68:return P$1(this,l,ft).call(this,ae,I,oe);case 67:return P$1(this,l,it).call(this,ae,I,oe);case 90:return P$1(this,l,st).call(this,ae,I,oe);case 65:return P$1(this,l,lt).call(this,ae,I,oe);case 82:return P$1(this,l,ht).call(this,ae,I,oe);case 83:return P$1(this,l,mt).call(this,ae,I,oe);case 75:return P$1(this,l,yt).call(this,ae,I,oe);case 69:return P$1(this,l,Fe).call(this,ae,I,oe,"error");case 78:return P$1(this,l,Fe).call(this,ae,I,oe,"notice");case 84:return P$1(this,l,ct).call(this,ae,I,oe);case 116:return P$1(this,l,dt).call(this,ae,I,oe);case 71:return P$1(this,l,ot).call(this,ae,I,oe);case 72:return P$1(this,l,ut).call(this,ae,I,oe);case 100:return P$1(this,l,at).call(this,ae,I,oe);default:return new C$2("received invalid response: "+e.toString(16),I,"error")}},st=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).string(1);return new ee$1(e,oe)},it=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).cstring();return new te$1(e,oe)},at=function(ae,e,I){let oe=I.slice(ae,ae+(e-4));return new H$1(e,new Uint8Array(oe))},ot=function(ae,e,I){return P$1(this,l,Ve).call(this,ae,e,I,"copyInResponse")},ut=function(ae,e,I){return P$1(this,l,Ve).call(this,ae,e,I,"copyOutResponse")},Ve=function(ae,e,I,oe){g$3(this,o$2).setBuffer(ae,I);let ue=g$3(this,o$2).byte()!==0,bt=g$3(this,o$2).int16(),tr=new q$1(e,oe,ue,bt);for(let rr=0;rr<bt;rr++)tr.columnTypes[rr]=g$3(this,o$2).int16();return tr},lt=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).int32(),ue=g$3(this,o$2).cstring(),bt=g$3(this,o$2).cstring();return new Z$1(e,oe,ue,bt)},ct=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).int16(),ue=new Y$1(e,oe);for(let bt=0;bt<oe;bt++)ue.fields[bt]=P$1(this,l,pt).call(this);return ue},pt=function(){let ae=g$3(this,o$2).cstring(),e=g$3(this,o$2).int32(),I=g$3(this,o$2).int16(),oe=g$3(this,o$2).int32(),ue=g$3(this,o$2).int16(),bt=g$3(this,o$2).int32(),tr=g$3(this,o$2).int16()===0?Oe$1.text:Oe$1.binary;return new $$1(ae,e,I,oe,ue,bt,tr)},dt=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).int16(),ue=new K$1(e,oe);for(let bt=0;bt<oe;bt++)ue.dataTypeIDs[bt]=g$3(this,o$2).int32();return ue},ft=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).int16(),ue=new Array(oe);for(let bt=0;bt<oe;bt++){let tr=g$3(this,o$2).int32();ue[bt]=tr===-1?null:g$3(this,o$2).string(tr)}return new ne(e,ue)},mt=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).cstring(),ue=g$3(this,o$2).cstring();return new J(e,oe,ue)},yt=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).int32(),ue=g$3(this,o$2).int32();return new X$1(e,oe,ue)},ht=function(ae,e,I){g$3(this,o$2).setBuffer(ae,I);let oe=g$3(this,o$2).int32();switch(oe){case 0:return new v$1(e);case 3:return new Q(e);case 5:return new W$1(e,g$3(this,o$2).bytes(4));case 10:{let ue=[];for(;;){let bt=g$3(this,o$2).cstring();if(bt.length===0)return new _(e,ue);ue.push(bt)}}case 11:return new j(e,g$3(this,o$2).string(e-8));case 12:return new z$1(e,g$3(this,o$2).string(e-8));default:throw new Error("Unknown authenticationOk message type "+oe)}},Fe=function(ae,e,I,oe){g$3(this,o$2).setBuffer(ae,I);let ue={},bt=g$3(this,o$2).string(1);for(;bt!=="\0";)ue[bt]=g$3(this,o$2).cstring(),bt=g$3(this,o$2).string(1);let tr=ue.M,rr=oe==="notice"?new re(e,tr):new C$2(tr,e,oe);return rr.severity=ue.S,rr.code=ue.C,rr.detail=ue.D,rr.hint=ue.H,rr.position=ue.P,rr.internalPosition=ue.p,rr.internalQuery=ue.q,rr.where=ue.W,rr.schema=ue.s,rr.table=ue.t,rr.column=ue.c,rr.dataType=ue.d,rr.constraint=ue.n,rr.file=ue.F,rr.line=ue.L,rr.routine=ue.R,rr};x$1();var Ge=typeof process$1=="object"&&typeof process$1.versions=="object"&&typeof process$1.versions.node=="string",ie;async function Er(){if(Ge||ie)return;let ae=new URL("/NoLLMChat/assets/postgres-BwytDQ9E.wasm",import.meta.url);ie=fetch(ae)}var V;async function Cr(ae,e){if(e||V)return WebAssembly.instantiate(e||V,ae),{instance:await WebAssembly.instantiate(e||V,ae),module:e||V};let I=new URL("/NoLLMChat/assets/postgres-BwytDQ9E.wasm",import.meta.url);if(Ge){let oe=await(await import("./__vite-browser-external-9wXp6ZBx.js")).readFile(I),{module:ue,instance:bt}=await WebAssembly.instantiate(oe,ae);return V=ue,{instance:bt,module:ue}}else{ie||(ie=fetch(I));let oe=await ie,{module:ue,instance:bt}=await WebAssembly.instantiateStreaming(oe,ae);return V=ue,{instance:bt,module:ue}}}async function Pr(){let ae=new URL("/NoLLMChat/assets/postgres-DaF_UcUd.data",import.meta.url);return Ge?(await(await import("./__vite-browser-external-9wXp6ZBx.js")).readFile(ae)).buffer:(await fetch(ae)).arrayBuffer()}x$1();var o$1={part:"part",container:"container"};function s(ae,e,...I){let oe=ae.length-1,ue=I.length-1;if(ue!==-1){if(ue===0){ae[oe]=ae[oe]+I[0]+e;return}ae[oe]=ae[oe]+I[0],ae.push(...I.slice(1,ue)),ae.push(I[ue]+e)}}function y(ae,...e){let I=[ae[0]];I.raw=[ae.raw[0]];let oe=[];for(let ue=0;ue<e.length;ue++){let bt=e[ue],tr=ue+1;if(bt?._templateType===o$1.part){s(I,ae[tr],bt.str),s(I.raw,ae.raw[tr],bt.str);continue}if(bt?._templateType===o$1.container){s(I,ae[tr],...bt.strings),s(I.raw,ae.raw[tr],...bt.strings.raw),oe.push(...bt.values);continue}I.push(ae[tr]),I.raw.push(ae.raw[tr]),oe.push(bt)}return{_templateType:"container",strings:I,values:oe}}function g$1(ae,...e){let{strings:I,values:oe}=y(ae,...e);return{query:[I[0],...oe.flatMap((ue,bt)=>[`$${bt+1}`,I[bt+1]])].join(""),params:oe}}x$1();var b,u,r,o,d,h$1,f,v=class{constructor(){L$3(this,r),this.serializers={...dn},this.parsers={...pn},L$3(this,b,!1),L$3(this,u,!1)}async _initArrayTypes(){if(g$3(this,b))return;h$2(this,b,!0);let ae=await this.query(`
      SELECT b.oid, b.typarray
      FROM pg_catalog.pg_type a
      LEFT JOIN pg_catalog.pg_type b ON b.oid = a.typelem
      WHERE a.typcategory = 'A'
      GROUP BY b.oid, b.typarray
      ORDER BY b.oid
    `);for(let e of ae.rows)this.serializers[e.typarray]=I=>Je(I,this.serializers[e.oid],e.typarray),this.parsers[e.typarray]=I=>bn(I,this.parsers[e.oid],e.typarray)}async query(ae,e,I){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await P$1(this,r,d).call(this,ae,e,I))}async sql(ae,...e){let{query:I,params:oe}=g$1(ae,...e);return await this.query(I,oe)}async exec(ae,e){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await P$1(this,r,h$1).call(this,ae,e))}async describeQuery(ae,e){try{await P$1(this,r,o).call(this,k$1.parse({text:ae,types:e?.paramTypes}),e);let I=await P$1(this,r,o).call(this,k$1.describe({type:"S"}),e),oe=I.messages.find(rr=>rr.name==="parameterDescription"),ue=I.messages.find(rr=>rr.name==="rowDescription"),bt=oe?.dataTypeIDs.map(rr=>({dataTypeID:rr,serializer:this.serializers[rr]}))??[],tr=ue?.fields.map(rr=>({name:rr.name,dataTypeID:rr.dataTypeID,parser:this.parsers[rr.dataTypeID]}))??[];return{queryParams:bt,resultFields:tr}}finally{await P$1(this,r,o).call(this,k$1.sync(),e)}}async transaction(ae){return await this._checkReady(),await this._runExclusiveTransaction(async()=>{await P$1(this,r,h$1).call(this,"BEGIN"),h$2(this,u,!0);let e=!1,I=()=>{if(e)throw new Error("Transaction is closed")},oe={query:async(ue,bt,tr)=>(I(),await P$1(this,r,d).call(this,ue,bt,tr)),sql:async(ue,...bt)=>{let{query:tr,params:rr}=g$1(ue,...bt);return await P$1(this,r,d).call(this,tr,rr)},exec:async(ue,bt)=>(I(),await P$1(this,r,h$1).call(this,ue,bt)),rollback:async()=>{I(),await P$1(this,r,h$1).call(this,"ROLLBACK"),e=!0},get closed(){return e}};try{let ue=await ae(oe);return e||(e=!0,await P$1(this,r,h$1).call(this,"COMMIT")),h$2(this,u,!1),ue}catch(ue){throw e||await P$1(this,r,h$1).call(this,"ROLLBACK"),h$2(this,u,!1),ue}})}};b=new WeakMap,u=new WeakMap,r=new WeakSet,o=async function(ae,e={}){return await this.execProtocol(ae,{...e,syncToFs:!1})},d=async function(ae,e=[],I){return await this._runExclusiveQuery(async()=>{P$1(this,r,f).call(this,"runQuery",ae,e,I),await this._handleBlob(I?.blob);let oe;try{let{messages:bt}=await P$1(this,r,o).call(this,k$1.parse({text:ae,types:I?.paramTypes}),I),tr=xe$1((await P$1(this,r,o).call(this,k$1.describe({type:"S"}),I)).messages),rr=e.map((ir,lr)=>{let dr=tr[lr];if(ir==null)return null;let pr=I?.serializers?.[dr]??this.serializers[dr];return pr?pr(ir):ir.toString()});oe=[...bt,...(await P$1(this,r,o).call(this,k$1.bind({values:rr}),I)).messages,...(await P$1(this,r,o).call(this,k$1.describe({type:"P"}),I)).messages,...(await P$1(this,r,o).call(this,k$1.execute({}),I)).messages]}finally{await P$1(this,r,o).call(this,k$1.sync(),I)}await this._cleanupBlob(),g$3(this,u)||await this.syncToFs();let ue=await this._getWrittenBlob();return wn(oe,this.parsers,I,ue)[0]})},h$1=async function(ae,e){return await this._runExclusiveQuery(async()=>{P$1(this,r,f).call(this,"runExec",ae,e),await this._handleBlob(e?.blob);let I;try{I=(await P$1(this,r,o).call(this,k$1.query(ae),e)).messages}finally{await P$1(this,r,o).call(this,k$1.sync(),e)}this._cleanupBlob(),g$3(this,u)||await this.syncToFs();let oe=await this._getWrittenBlob();return wn(I,this.parsers,e,oe)})},f=function(...ae){this.debug>0&&console.log(...ae)};var w=u$1((ae,e)=>{x$1();var I=9007199254740991,oe=function(Ar){return Ar}();function ue(Ar){return Ar===oe}function bt(Ar){return typeof Ar=="string"||Object.prototype.toString.call(Ar)=="[object String]"}function tr(Ar){return Object.prototype.toString.call(Ar)=="[object Date]"}function rr(Ar){return Ar!==null&&typeof Ar=="object"}function ir(Ar){return typeof Ar=="function"}function lr(Ar){return typeof Ar=="number"&&Ar>-1&&Ar%1==0&&Ar<=I}function dr(Ar){return Object.prototype.toString.call(Ar)=="[object Array]"}function pr(Ar){return rr(Ar)&&!ir(Ar)&&lr(Ar.length)}function hr(Ar){return Object.prototype.toString.call(Ar)=="[object ArrayBuffer]"}function _r(Ar,Sr){return Array.prototype.map.call(Ar,Sr)}function yr(Ar,Sr){var Mr=oe;return ir(Sr)&&Array.prototype.every.call(Ar,function(vr,Lr,es){var ss=Sr(vr,Lr,es);return ss&&(Mr=vr),!ss}),Mr}function wr(Ar){return Object.assign.apply(null,arguments)}function Tr(Ar){var Sr,Mr,vr;if(bt(Ar)){for(Mr=Ar.length,vr=new Uint8Array(Mr),Sr=0;Sr<Mr;Sr++)vr[Sr]=Ar.charCodeAt(Sr)&255;return vr}return hr(Ar)?new Uint8Array(Ar):rr(Ar)&&hr(Ar.buffer)?new Uint8Array(Ar.buffer):pr(Ar)?new Uint8Array(Ar):rr(Ar)&&ir(Ar.toString)?Tr(Ar.toString()):new Uint8Array}e.exports.MAX_SAFE_INTEGER=I,e.exports.isUndefined=ue,e.exports.isString=bt,e.exports.isObject=rr,e.exports.isDateTime=tr,e.exports.isFunction=ir,e.exports.isArray=dr,e.exports.isArrayLike=pr,e.exports.isArrayBuffer=hr,e.exports.map=_r,e.exports.find=yr,e.exports.extend=wr,e.exports.toUint8Array=Tr}),x=u$1((ae,e)=>{x$1();var I="\0";e.exports={NULL_CHAR:I,TMAGIC:"ustar"+I+"00",OLDGNU_MAGIC:"ustar  "+I,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}}),L$1=u$1((ae,e)=>{x$1();var I=w(),oe=x(),ue=512,bt=oe.TPERMALL,tr=0,rr=0,ir=[["name",100,0,function(Sr,Mr){return pr(Sr[Mr[0]],Mr[1])},function(Sr,Mr,vr){return yr(Sr.slice(Mr,Mr+vr[1]))}],["mode",8,100,function(Sr,Mr){var vr=Sr[Mr[0]]||bt;return vr=vr&oe.TPERMMASK,hr(vr,Mr[1],bt)},function(Sr,Mr,vr){var Lr=wr(Sr.slice(Mr,Mr+vr[1]));return Lr&=oe.TPERMMASK,Lr}],["uid",8,108,function(Sr,Mr){return hr(Sr[Mr[0]],Mr[1],tr)},function(Sr,Mr,vr){return wr(Sr.slice(Mr,Mr+vr[1]))}],["gid",8,116,function(Sr,Mr){return hr(Sr[Mr[0]],Mr[1],rr)},function(Sr,Mr,vr){return wr(Sr.slice(Mr,Mr+vr[1]))}],["size",12,124,function(Sr,Mr){return hr(Sr.data.length,Mr[1])},function(Sr,Mr,vr){return wr(Sr.slice(Mr,Mr+vr[1]))}],["modifyTime",12,136,function(Sr,Mr){return _r(Sr[Mr[0]],Mr[1])},function(Sr,Mr,vr){return Tr(Sr.slice(Mr,Mr+vr[1]))}],["checksum",8,148,function(Sr,Mr){return"        "},function(Sr,Mr,vr){return wr(Sr.slice(Mr,Mr+vr[1]))}],["type",1,156,function(Sr,Mr){return""+(parseInt(Sr[Mr[0]],10)||0)%8},function(Sr,Mr,vr){return(parseInt(String.fromCharCode(Sr[Mr]),10)||0)%8}],["linkName",100,157,function(Sr,Mr){return""},function(Sr,Mr,vr){return yr(Sr.slice(Mr,Mr+vr[1]))}],["ustar",8,257,function(Sr,Mr){return oe.TMAGIC},function(Sr,Mr,vr){return dr(yr(Sr.slice(Mr,Mr+vr[1]),!0))},function(Sr,Mr){return Sr[Mr[0]]==oe.TMAGIC||Sr[Mr[0]]==oe.OLDGNU_MAGIC}],["owner",32,265,function(Sr,Mr){return pr(Sr[Mr[0]],Mr[1])},function(Sr,Mr,vr){return yr(Sr.slice(Mr,Mr+vr[1]))}],["group",32,297,function(Sr,Mr){return pr(Sr[Mr[0]],Mr[1])},function(Sr,Mr,vr){return yr(Sr.slice(Mr,Mr+vr[1]))}],["majorNumber",8,329,function(Sr,Mr){return""},function(Sr,Mr,vr){return wr(Sr.slice(Mr,Mr+vr[1]))}],["minorNumber",8,337,function(Sr,Mr){return""},function(Sr,Mr,vr){return wr(Sr.slice(Mr,Mr+vr[1]))}],["prefix",131,345,function(Sr,Mr){return pr(Sr[Mr[0]],Mr[1])},function(Sr,Mr,vr){return yr(Sr.slice(Mr,Mr+vr[1]))}],["accessTime",12,476,function(Sr,Mr){return _r(Sr[Mr[0]],Mr[1])},function(Sr,Mr,vr){return Tr(Sr.slice(Mr,Mr+vr[1]))}],["createTime",12,488,function(Sr,Mr){return _r(Sr[Mr[0]],Mr[1])},function(Sr,Mr,vr){return Tr(Sr.slice(Mr,Mr+vr[1]))}]],lr=function(Sr){var Mr=Sr[Sr.length-1];return Mr[2]+Mr[1]}(ir);function dr(Sr){if(Sr.length==8){var Mr=Sr.split("");if(Mr[5]==oe.NULL_CHAR)return(Mr[6]==" "||Mr[6]==oe.NULL_CHAR)&&(Mr[6]="0"),(Mr[7]==" "||Mr[7]==oe.NULL_CHAR)&&(Mr[7]="0"),Mr=Mr.join(""),Mr==oe.TMAGIC?Mr:Sr;if(Mr[7]==oe.NULL_CHAR)return Mr[5]==oe.NULL_CHAR&&(Mr[5]=" "),Mr[6]==oe.NULL_CHAR&&(Mr[6]=" "),Mr==oe.OLDGNU_MAGIC?Mr:Sr}return Sr}function pr(Sr,Mr){return Mr-=1,I.isUndefined(Sr)&&(Sr=""),Sr=(""+Sr).substr(0,Mr),Sr+oe.NULL_CHAR}function hr(Sr,Mr,vr){for(vr=parseInt(vr)||0,Mr-=1,Sr=(parseInt(Sr)||vr).toString(8).substr(-Mr,Mr);Sr.length<Mr;)Sr="0"+Sr;return Sr+oe.NULL_CHAR}function _r(Sr,Mr){if(I.isDateTime(Sr))Sr=Math.floor(1*Sr/1e3);else if(Sr=parseInt(Sr,10),isFinite(Sr)){if(Sr<=0)return""}else Sr=Math.floor(1*new Date/1e3);return hr(Sr,Mr,0)}function yr(Sr,Mr){var vr=String.fromCharCode.apply(null,Sr);if(Mr)return vr;var Lr=vr.indexOf(oe.NULL_CHAR);return Lr>=0?vr.substr(0,Lr):vr}function wr(Sr){var Mr=String.fromCharCode.apply(null,Sr);return parseInt(Mr.replace(/^0+$/g,""),8)||0}function Tr(Sr){return Sr.length==0||Sr[0]==0?null:new Date(1e3*wr(Sr))}function Ar(Sr,Mr,vr){var Lr=parseInt(Mr,10)||0,es=Math.min(Lr+lr,Sr.length),ss=0,os=0,$r=0;vr&&ir.every(function(Ir){return Ir[0]=="checksum"?(os=Lr+Ir[2],$r=os+Ir[1],!1):!0});for(var ns=32,Nr=Lr;Nr<es;Nr++){var zr=Nr>=os&&Nr<$r?ns:Sr[Nr];ss=(ss+zr)%262144}return ss}e.exports.recordSize=ue,e.exports.defaultFileMode=bt,e.exports.defaultUid=tr,e.exports.defaultGid=rr,e.exports.posixHeader=ir,e.exports.effectiveHeaderSize=lr,e.exports.calculateChecksum=Ar,e.exports.formatTarString=pr,e.exports.formatTarNumber=hr,e.exports.formatTarDateTime=_r,e.exports.parseTarString=yr,e.exports.parseTarNumber=wr,e.exports.parseTarDateTime=Tr}),er=u$1((ae,e)=>{x$1();var I=x(),oe=w(),ue=L$1();function bt(pr){return ue.recordSize}function tr(pr){return Math.ceil(pr.data.length/ue.recordSize)*ue.recordSize}function rr(pr){var hr=0;return pr.forEach(function(_r){hr+=bt()+tr(_r)}),hr+=ue.recordSize*2,new Uint8Array(hr)}function ir(pr,hr,_r){_r=parseInt(_r)||0;var yr=_r;ue.posixHeader.forEach(function(Mr){for(var vr=Mr[3](hr,Mr),Lr=vr.length,es=0;es<Lr;es+=1)pr[yr+es]=vr.charCodeAt(es)&255;yr+=Mr[1]});var wr=oe.find(ue.posixHeader,function(Mr){return Mr[0]=="checksum"});if(wr){var Tr=ue.calculateChecksum(pr,_r,!0),Ar=ue.formatTarNumber(Tr,wr[1]-2)+I.NULL_CHAR+" ";yr=_r+wr[2];for(var Sr=0;Sr<Ar.length;Sr+=1)pr[yr]=Ar.charCodeAt(Sr)&255,yr++}return _r+bt()}function lr(pr,hr,_r){return _r=parseInt(_r,10)||0,pr.set(hr.data,_r),_r+tr(hr)}function dr(pr){pr=oe.map(pr,function(yr){return oe.extend({},yr,{data:oe.toUint8Array(yr.data)})});var hr=rr(pr),_r=0;return pr.forEach(function(yr){_r=ir(hr,yr,_r),_r=lr(hr,yr,_r)}),hr}e.exports.tar=dr}),nr=u$1((ae,e)=>{x$1();var I=x(),oe=w(),ue=L$1(),bt={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},tr={size:!0,checksum:!0,ustar:!0},rr={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function ir(wr){return ue.recordSize}function lr(wr){return Math.ceil(wr/ue.recordSize)*ue.recordSize}function dr(wr,Tr){for(var Ar=Tr,Sr=Math.min(wr.length,Tr+ue.recordSize*2),Mr=Ar;Mr<Sr;Mr++)if(wr[Mr]!=0)return!1;return!0}function pr(wr,Tr,Ar){if(wr.length-Tr<ue.recordSize){if(Ar.checkFileSize)throw new Error(rr.unexpectedEndOfFile);return null}Tr=parseInt(Tr)||0;var Sr={},Mr=Tr;if(ue.posixHeader.forEach(function(es){Sr[es[0]]=es[4](wr,Mr,es),Mr+=es[1]}),Sr.type!=0&&(Sr.size=0),Ar.checkHeader&&ue.posixHeader.forEach(function(es){if(oe.isFunction(es[5])&&!es[5](Sr,es)){var ss=new Error(rr.fileCorrupted);throw ss.data={offset:Tr+es[2],field:es[0]},ss}}),Ar.checkChecksum){var vr=ue.calculateChecksum(wr,Tr,!0);if(vr!=Sr.checksum){var Lr=new Error(rr.checksumCheckFailed);throw Lr.data={offset:Tr,header:Sr,checksum:vr},Lr}}return Sr}function hr(wr,Tr,Ar,Sr){return Sr.extractData?Ar.size<=0?new Uint8Array:wr.slice(Tr,Tr+Ar.size):null}function _r(wr,Tr){var Ar={};return ue.posixHeader.forEach(function(Sr){var Mr=Sr[0];tr[Mr]||(Ar[Mr]=wr[Mr])}),Ar.isOldGNUFormat=wr.ustar==I.OLDGNU_MAGIC,Tr&&(Ar.data=Tr),Ar}function yr(wr,Tr){Tr=oe.extend({},bt,Tr);for(var Ar=[],Sr=0,Mr=wr.length;Mr-Sr>=ue.recordSize;){wr=oe.toUint8Array(wr);var vr=pr(wr,Sr,Tr);if(!vr)break;Sr+=ir();var Lr=hr(wr,Sr,vr,Tr);if(Ar.push(_r(vr,Lr)),Sr+=lr(vr.size),dr(wr,Sr))break}return Ar}e.exports.untar=yr}),or=u$1((ae,e)=>{x$1();var I=w(),oe=x(),ue=er(),bt=nr();I.extend(e.exports,ue,bt,oe)});x$1();x$1();var h=F(or());async function H(ae,e,I="pgdata",oe="auto"){let ue=jr(ae,e),[bt,tr]=await Br(ue,oe),rr=I+(tr?".tar.gz":".tar"),ir=tr?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([bt],rr,{type:ir}):new Blob([bt],{type:ir})}var Gr=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"];async function ce(ae,e,I){let oe=new Uint8Array(await e.arrayBuffer()),ue=typeof File<"u"&&e instanceof File?e.name:void 0;(Gr.includes(e.type)||ue?.endsWith(".tgz")||ue?.endsWith(".tar.gz"))&&(oe=await Wr(oe));let bt=(0,h.untar)(oe);for(let tr of bt){let rr=I+tr.name,ir=rr.split("/").slice(0,-1);for(let lr=1;lr<=ir.length;lr++){let dr=ir.slice(0,lr).join("/");ae.analyzePath(dr).exists||ae.mkdir(dr)}tr.type===h.REGTYPE?(ae.writeFile(rr,tr.data),ae.utime(rr,ar(tr.modifyTime),ar(tr.modifyTime))):tr.type===h.DIRTYPE&&ae.mkdir(rr)}}function Hr(ae,e){let I=[],oe=ue=>{ae.readdir(ue).forEach(bt=>{if(bt==="."||bt==="..")return;let tr=ue+"/"+bt,rr=ae.stat(tr),ir=ae.isFile(rr.mode)?ae.readFile(tr,{encoding:"binary"}):new Uint8Array(0);I.push({name:tr.substring(e.length),mode:rr.mode,size:rr.size,type:ae.isFile(rr.mode)?h.REGTYPE:h.DIRTYPE,modifyTime:rr.mtime,data:ir}),ae.isDir(rr.mode)&&oe(tr)})};return oe(e),I}function jr(ae,e){let I=Hr(ae,e);return(0,h.tar)(I)}async function Br(ae,e="auto"){if(e==="none")return[ae,!1];if(typeof CompressionStream<"u")return[await qr(ae),!0];if(typeof process$1<"u"&&process$1.versions&&process$1.versions.node)return[await Yr(ae),!0];if(e==="auto")return[ae,!1];throw new Error("Compression not supported in this environment")}async function qr(ae){let e=new CompressionStream("gzip"),I=e.writable.getWriter(),oe=e.readable.getReader();I.write(ae),I.close();let ue=[];for(;;){let{value:rr,done:ir}=await oe.read();if(ir)break;rr&&ue.push(rr)}let bt=new Uint8Array(ue.reduce((rr,ir)=>rr+ir.length,0)),tr=0;return ue.forEach(rr=>{bt.set(rr,tr),tr+=rr.length}),bt}async function Yr(ae){let{promisify:e}=await import("./__vite-browser-external-9wXp6ZBx.js"),{gzip:I}=await import("./__vite-browser-external-9wXp6ZBx.js");return await e(I)(ae)}async function Wr(ae){if(typeof CompressionStream<"u")return await Xr(ae);if(typeof process$1<"u"&&process$1.versions&&process$1.versions.node)return await Kr(ae);throw new Error("Unsupported environment for decompression")}async function Xr(ae){let e=new DecompressionStream("gzip"),I=e.writable.getWriter(),oe=e.readable.getReader();I.write(ae),I.close();let ue=[];for(;;){let{value:rr,done:ir}=await oe.read();if(ir)break;rr&&ue.push(rr)}let bt=new Uint8Array(ue.reduce((rr,ir)=>rr+ir.length,0)),tr=0;return ue.forEach(rr=>{bt.set(rr,tr),tr+=rr.length}),bt}async function Kr(ae){let{promisify:e}=await import("./__vite-browser-external-9wXp6ZBx.js"),{gunzip:I}=await import("./__vite-browser-external-9wXp6ZBx.js");return await e(I)(ae)}function ar(ae){return ae?typeof ae=="number"?ae:Math.floor(ae.getTime()/1e3):Math.floor(Date.now()/1e3)}var Vr="/tmp/pglite",C$1=Vr+"/base",sr=class{constructor(ae){this.dataDir=ae}async init(ae,e){return this.pg=ae,{emscriptenOpts:e}}async syncToFs(ae){}async initialSyncFs(){}async closeFs(){}async dumpTar(ae,e){return H(this.pg.Module.FS,C$1,ae,e)}},ur=class{constructor(ae,{debug:e=!1}={}){this.dataDir=ae,this.debug=e}async syncToFs(ae){}async initialSyncFs(){}async closeFs(){}async dumpTar(ae,e){return H(this.pg.Module.FS,C$1,ae,e)}async init(ae,e){return this.pg=ae,{emscriptenOpts:{...e,preRun:[...e.preRun||[],I=>{let oe=Zr(I,this);I.FS.mkdir(C$1),I.FS.mount(oe,{},C$1)}]}}}},cr={EBADF:8,EBADFD:127,EEXIST:20,EINVAL:28,EISDIR:31,ENODEV:43,ENOENT:44,ENOTDIR:54,ENOTEMPTY:55},Zr=(ae,e)=>{let I=ae.FS,oe=e.debug?console.log:null,ue={tryFSOperation(bt){try{return bt()}catch(tr){throw tr.code?tr.code==="UNKNOWN"?new I.ErrnoError(cr.EINVAL):new I.ErrnoError(tr.code):tr}},mount(bt){return ue.createNode(null,"/",16895,0)},syncfs(bt,tr,rr){},createNode(bt,tr,rr,ir){if(!I.isDir(rr)&&!I.isFile(rr))throw new I.ErrnoError(28);let lr=I.createNode(bt,tr,rr);return lr.node_ops=ue.node_ops,lr.stream_ops=ue.stream_ops,lr},getMode:function(bt){return oe?.("getMode",bt),ue.tryFSOperation(()=>e.lstat(bt).mode)},realPath:function(bt){let tr=[];for(;bt.parent!==bt;)tr.push(bt.name),bt=bt.parent;return tr.push(bt.mount.opts.root),tr.reverse(),tr.join("/")},node_ops:{getattr(bt){oe?.("getattr",ue.realPath(bt));let tr=ue.realPath(bt);return ue.tryFSOperation(()=>{let rr=e.lstat(tr);return{...rr,dev:0,ino:bt.id,nlink:1,rdev:bt.rdev,atime:new Date(rr.atime),mtime:new Date(rr.mtime),ctime:new Date(rr.ctime)}})},setattr(bt,tr){oe?.("setattr",ue.realPath(bt),tr);let rr=ue.realPath(bt);ue.tryFSOperation(()=>{tr.mode!==void 0&&e.chmod(rr,tr.mode),tr.size!==void 0&&e.truncate(rr,tr.size),tr.timestamp!==void 0&&e.utimes(rr,tr.timestamp,tr.timestamp),tr.size!==void 0&&e.truncate(rr,tr.size)})},lookup(bt,tr){oe?.("lookup",ue.realPath(bt),tr);let rr=[ue.realPath(bt),tr].join("/"),ir=ue.getMode(rr);return ue.createNode(bt,tr,ir)},mknod(bt,tr,rr,ir){oe?.("mknod",ue.realPath(bt),tr,rr,ir);let lr=ue.createNode(bt,tr,rr,ir),dr=ue.realPath(lr);return ue.tryFSOperation(()=>(I.isDir(lr.mode)?e.mkdir(dr,{mode:rr}):e.writeFile(dr,"",{mode:rr}),lr))},rename(bt,tr,rr){oe?.("rename",ue.realPath(bt),ue.realPath(tr),rr);let ir=ue.realPath(bt),lr=[ue.realPath(tr),rr].join("/");ue.tryFSOperation(()=>{e.rename(ir,lr)}),bt.name=rr},unlink(bt,tr){oe?.("unlink",ue.realPath(bt),tr);let rr=[ue.realPath(bt),tr].join("/");try{e.unlink(rr)}catch{}},rmdir(bt,tr){oe?.("rmdir",ue.realPath(bt),tr);let rr=[ue.realPath(bt),tr].join("/");return ue.tryFSOperation(()=>{e.rmdir(rr)})},readdir(bt){oe?.("readdir",ue.realPath(bt));let tr=ue.realPath(bt);return ue.tryFSOperation(()=>e.readdir(tr))},symlink(bt,tr,rr){throw oe?.("symlink",ue.realPath(bt),tr,rr),new I.ErrnoError(63)},readlink(bt){throw oe?.("readlink",ue.realPath(bt)),new I.ErrnoError(63)}},stream_ops:{open(bt){oe?.("open stream",ue.realPath(bt.node));let tr=ue.realPath(bt.node);return ue.tryFSOperation(()=>{I.isFile(bt.node.mode)&&(bt.shared.refcount=1,bt.nfd=e.open(tr))})},close(bt){return oe?.("close stream",ue.realPath(bt.node)),ue.tryFSOperation(()=>{I.isFile(bt.node.mode)&&bt.nfd&&--bt.shared.refcount===0&&e.close(bt.nfd)})},dup(bt){oe?.("dup stream",ue.realPath(bt.node)),bt.shared.refcount++},read(bt,tr,rr,ir,lr){return oe?.("read stream",ue.realPath(bt.node),rr,ir,lr),ir===0?0:ue.tryFSOperation(()=>e.read(bt.nfd,tr,rr,ir,lr))},write(bt,tr,rr,ir,lr){return oe?.("write stream",ue.realPath(bt.node),rr,ir,lr),ue.tryFSOperation(()=>e.write(bt.nfd,tr.buffer,rr,ir,lr))},llseek(bt,tr,rr){oe?.("llseek stream",ue.realPath(bt.node),tr,rr);let ir=tr;if(rr===1?ir+=bt.position:rr===2&&I.isFile(bt.node.mode)&&ue.tryFSOperation(()=>{let lr=e.fstat(bt.nfd);ir+=lr.size}),ir<0)throw new I.ErrnoError(28);return ir},mmap(bt,tr,rr,ir,lr){if(oe?.("mmap stream",ue.realPath(bt.node),tr,rr,ir,lr),!I.isFile(bt.node.mode))throw new I.ErrnoError(cr.ENODEV);let dr=ae.mmapAlloc(tr);return ue.stream_ops.read(bt,ae.HEAP8,dr,tr,rr),{ptr:dr,allocated:!0}},msync(bt,tr,rr,ir,lr){return oe?.("msync stream",ue.realPath(bt.node),rr,ir,lr),ue.stream_ops.write(bt,tr,0,ir,rr),0}}};return ue},Module=(()=>{var _scriptName=import.meta.url;return async function(moduleArg={}){var moduleRtn,Module=moduleArg,readyPromiseResolve,readyPromiseReject,readyPromise=new Promise((ae,e)=>{readyPromiseResolve=ae,readyPromiseReject=e}),ENVIRONMENT_IS_WEB=typeof window=="object",ENVIRONMENT_IS_WORKER=typeof importScripts=="function",ENVIRONMENT_IS_NODE=typeof process$1=="object"&&typeof process$1.versions=="object"&&typeof process$1.versions.node=="string"&&process$1.type!="renderer";if(ENVIRONMENT_IS_NODE){const{createRequire:ae}=await import("./__vite-browser-external-9wXp6ZBx.js");let e=import.meta.url;e.startsWith("data:")&&(e="/");var require=ae(e)}Module.expectedDataFileDownloads||(Module.expectedDataFileDownloads=0),Module.expectedDataFileDownloads++,(()=>{var ae=typeof ENVIRONMENT_IS_PTHREAD<"u"&&ENVIRONMENT_IS_PTHREAD,e=typeof ENVIRONMENT_IS_WASM_WORKER<"u"&&ENVIRONMENT_IS_WASM_WORKER;if(ae||e)return;function I(oe){typeof window=="object"?window.encodeURIComponent(window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/"):typeof process$1>"u"&&typeof location<"u"&&encodeURIComponent(location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/");var ue="postgres.data",bt="postgres.data";typeof Module.locateFilePackage=="function"&&!Module.locateFile&&(Module.locateFile=Module.locateFilePackage,err("warning: you defined Module.locateFilePackage, that has been renamed to Module.locateFile (using your locateFilePackage for now)"));var tr=Module.locateFile?Module.locateFile(bt,""):bt,rr=oe.remote_package_size;function ir(_r,yr,wr,Tr){if(typeof process$1=="object"&&typeof process$1.versions=="object"&&typeof process$1.versions.node=="string"){require("fs").readFile(_r,(Ar,Sr)=>{Ar?Tr(Ar):wr(Sr.buffer)});return}Module.dataFileDownloads??={},fetch(_r).catch(Ar=>Promise.reject(new Error(`Network Error: ${_r}`,{cause:Ar}))).then(Ar=>{if(!Ar.ok)return Promise.reject(new Error(`${Ar.status}: ${Ar.url}`));if(!Ar.body&&Ar.arrayBuffer)return Ar.arrayBuffer().then(wr);const Sr=Ar.body.getReader(),Mr=()=>Sr.read().then(os).catch($r=>Promise.reject(new Error(`Unexpected error while handling : ${Ar.url} ${$r}`,{cause:$r}))),vr=[],Lr=Ar.headers,es=Number(Lr.get("Content-Length")??yr);let ss=0;const os=({done:$r,value:ns})=>{if($r){const Nr=new Uint8Array(vr.map(Ir=>Ir.length).reduce((Ir,Or)=>Ir+Or,0));let zr=0;for(const Ir of vr)Nr.set(Ir,zr),zr+=Ir.length;wr(Nr.buffer)}else{vr.push(ns),ss+=ns.length,Module.dataFileDownloads[_r]={loaded:ss,total:es};let Nr=0,zr=0;for(const Ir of Object.values(Module.dataFileDownloads))Nr+=Ir.loaded,zr+=Ir.total;return Module.setStatus?.(`Downloading data... (${Nr}/${zr})`),Mr()}};return Module.setStatus?.("Downloading data..."),Mr()})}function lr(_r){console.error("package error:",_r)}var dr=null,pr=Module.getPreloadedPackage?Module.getPreloadedPackage(tr,rr):null;pr||ir(tr,rr,_r=>{dr?(dr(_r),dr=null):pr=_r},lr);function hr(_r){function yr(Mr,vr){if(!Mr)throw vr+new Error().stack}_r.FS_createPath("/","home",!0,!0),_r.FS_createPath("/home","web_user",!0,!0),_r.FS_createPath("/","tmp",!0,!0),_r.FS_createPath("/tmp","pglite",!0,!0),_r.FS_createPath("/tmp/pglite","bin",!0,!0),_r.FS_createPath("/tmp/pglite","lib",!0,!0),_r.FS_createPath("/tmp/pglite/lib","postgresql",!0,!0),_r.FS_createPath("/tmp/pglite/lib/postgresql","pgxs",!0,!0),_r.FS_createPath("/tmp/pglite/lib/postgresql/pgxs","config",!0,!0),_r.FS_createPath("/tmp/pglite/lib/postgresql/pgxs","src",!0,!0),_r.FS_createPath("/tmp/pglite/lib/postgresql/pgxs/src","makefiles",!0,!0),_r.FS_createPath("/tmp/pglite/lib/postgresql/pgxs/src","test",!0,!0),_r.FS_createPath("/tmp/pglite/lib/postgresql/pgxs/src/test","isolation",!0,!0),_r.FS_createPath("/tmp/pglite/lib/postgresql/pgxs/src/test","regress",!0,!0),_r.FS_createPath("/tmp/pglite","share",!0,!0),_r.FS_createPath("/tmp/pglite/share","postgresql",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql","extension",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql","timezone",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Africa",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","America",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","Argentina",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","Indiana",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","Kentucky",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","North_Dakota",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Antarctica",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Arctic",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Asia",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Atlantic",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Australia",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Brazil",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Canada",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Chile",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Etc",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Europe",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Indian",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Mexico",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","Pacific",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql/timezone","US",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql","timezonesets",!0,!0),_r.FS_createPath("/tmp/pglite/share/postgresql","tsearch_data",!0,!0);function wr(Mr,vr,Lr){this.start=Mr,this.end=vr,this.audio=Lr}wr.prototype={requests:{},open:function(Mr,vr){this.name=vr,this.requests[vr]=this,_r.addRunDependency(`fp ${this.name}`)},send:function(){},onload:function(){var Mr=this.byteArray.subarray(this.start,this.end);this.finish(Mr)},finish:function(Mr){var vr=this;_r.FS_createDataFile(this.name,null,Mr,!0,!0,!0),_r.removeRunDependency(`fp ${vr.name}`),this.requests[this.name]=null}};for(var Tr=oe.files,Ar=0;Ar<Tr.length;++Ar)new wr(Tr[Ar].start,Tr[Ar].end,Tr[Ar].audio||0).open("GET",Tr[Ar].filename);function Sr(Mr){yr(Mr,"Loading data file failed."),yr(Mr.constructor.name===ArrayBuffer.name,"bad input to processPackageData");var vr=new Uint8Array(Mr);wr.prototype.byteArray=vr;for(var Lr=oe.files,es=0;es<Lr.length;++es)wr.prototype.requests[Lr[es].filename].onload();_r.removeRunDependency("datafile_postgres.data")}_r.addRunDependency("datafile_postgres.data"),_r.preloadResults||(_r.preloadResults={}),_r.preloadResults[ue]={fromCache:!1},pr?(Sr(pr),pr=null):dr=Sr}Module.calledRun?hr(Module):(Module.preRun||(Module.preRun=[]),Module.preRun.push(hr))}I({files:[{filename:"/home/web_user/.pgpass",start:0,end:135},{filename:"/tmp/pglite/bin/initdb",start:135,end:147},{filename:"/tmp/pglite/bin/postgres",start:147,end:159},{filename:"/tmp/pglite/lib/postgresql/cyrillic_and_mic.so",start:159,end:5738},{filename:"/tmp/pglite/lib/postgresql/dict_snowball.so",start:5738,end:580838},{filename:"/tmp/pglite/lib/postgresql/euc2004_sjis2004.so",start:580838,end:583216},{filename:"/tmp/pglite/lib/postgresql/euc_cn_and_mic.so",start:583216,end:584483},{filename:"/tmp/pglite/lib/postgresql/euc_jp_and_sjis.so",start:584483,end:592223},{filename:"/tmp/pglite/lib/postgresql/euc_kr_and_mic.so",start:592223,end:593530},{filename:"/tmp/pglite/lib/postgresql/euc_tw_and_big5.so",start:593530,end:598650},{filename:"/tmp/pglite/lib/postgresql/latin2_and_win1250.so",start:598650,end:600595},{filename:"/tmp/pglite/lib/postgresql/latin_and_mic.so",start:600595,end:602068},{filename:"/tmp/pglite/lib/postgresql/libpqwalreceiver.so",start:602068,end:725255},{filename:"/tmp/pglite/lib/postgresql/pgoutput.so",start:725255,end:741345},{filename:"/tmp/pglite/lib/postgresql/pgxs/config/install-sh",start:741345,end:755342},{filename:"/tmp/pglite/lib/postgresql/pgxs/config/missing",start:755342,end:756690},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/Makefile.global",start:756690,end:792812},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/Makefile.port",start:792812,end:793088},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/Makefile.shlib",start:793088,end:809126},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/makefiles/pgxs.mk",start:809126,end:824054},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/nls-global.mk",start:824054,end:830939},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/test/isolation/isolationtester.cjs",start:830939,end:927086},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/test/isolation/pg_isolation_regress.cjs",start:927086,end:1003500},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/test/regress/pg_regress.cjs",start:1003500,end:1079904},{filename:"/tmp/pglite/lib/postgresql/plpgsql.so",start:1079904,end:1239297},{filename:"/tmp/pglite/password",start:1239297,end:1239306},{filename:"/tmp/pglite/share/postgresql/errcodes.txt",start:1239306,end:1272764},{filename:"/tmp/pglite/share/postgresql/extension/plpgsql--1.0.sql",start:1272764,end:1273422},{filename:"/tmp/pglite/share/postgresql/extension/plpgsql.control",start:1273422,end:1273615},{filename:"/tmp/pglite/share/postgresql/fix-CVE-2024-4317.sql",start:1273615,end:1279380},{filename:"/tmp/pglite/share/postgresql/information_schema.sql",start:1279380,end:1394355},{filename:"/tmp/pglite/share/postgresql/pg_hba.conf.sample",start:1394355,end:1399980},{filename:"/tmp/pglite/share/postgresql/pg_ident.conf.sample",start:1399980,end:1402620},{filename:"/tmp/pglite/share/postgresql/pg_service.conf.sample",start:1402620,end:1403224},{filename:"/tmp/pglite/share/postgresql/postgres.bki",start:1403224,end:2347328},{filename:"/tmp/pglite/share/postgresql/postgresql.conf.sample",start:2347328,end:2376975},{filename:"/tmp/pglite/share/postgresql/psqlrc.sample",start:2376975,end:2377253},{filename:"/tmp/pglite/share/postgresql/snowball_create.sql",start:2377253,end:2421429},{filename:"/tmp/pglite/share/postgresql/sql_features.txt",start:2421429,end:2457110},{filename:"/tmp/pglite/share/postgresql/system_constraints.sql",start:2457110,end:2466005},{filename:"/tmp/pglite/share/postgresql/system_functions.sql",start:2466005,end:2489320},{filename:"/tmp/pglite/share/postgresql/system_views.sql",start:2489320,end:2539593},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Abidjan",start:2539593,end:2539723},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Accra",start:2539723,end:2539853},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Addis_Ababa",start:2539853,end:2540044},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Algiers",start:2540044,end:2540514},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Asmara",start:2540514,end:2540705},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Asmera",start:2540705,end:2540896},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bamako",start:2540896,end:2541026},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bangui",start:2541026,end:2541206},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Banjul",start:2541206,end:2541336},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bissau",start:2541336,end:2541485},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Blantyre",start:2541485,end:2541616},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Brazzaville",start:2541616,end:2541796},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bujumbura",start:2541796,end:2541927},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Cairo",start:2541927,end:2543236},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Casablanca",start:2543236,end:2545155},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Ceuta",start:2545155,end:2545717},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Conakry",start:2545717,end:2545847},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Dakar",start:2545847,end:2545977},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Dar_es_Salaam",start:2545977,end:2546168},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Djibouti",start:2546168,end:2546359},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Douala",start:2546359,end:2546539},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/El_Aaiun",start:2546539,end:2548369},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Freetown",start:2548369,end:2548499},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Gaborone",start:2548499,end:2548630},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Harare",start:2548630,end:2548761},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Johannesburg",start:2548761,end:2548951},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Juba",start:2548951,end:2549409},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Kampala",start:2549409,end:2549600},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Khartoum",start:2549600,end:2550058},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Kigali",start:2550058,end:2550189},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Kinshasa",start:2550189,end:2550369},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lagos",start:2550369,end:2550549},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Libreville",start:2550549,end:2550729},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lome",start:2550729,end:2550859},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Luanda",start:2550859,end:2551039},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lubumbashi",start:2551039,end:2551170},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lusaka",start:2551170,end:2551301},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Malabo",start:2551301,end:2551481},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Maputo",start:2551481,end:2551612},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Maseru",start:2551612,end:2551802},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Mbabane",start:2551802,end:2551992},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Mogadishu",start:2551992,end:2552183},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Monrovia",start:2552183,end:2552347},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Nairobi",start:2552347,end:2552538},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Ndjamena",start:2552538,end:2552698},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Niamey",start:2552698,end:2552878},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Nouakchott",start:2552878,end:2553008},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Ouagadougou",start:2553008,end:2553138},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Porto-Novo",start:2553138,end:2553318},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Sao_Tome",start:2553318,end:2553491},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Timbuktu",start:2553491,end:2553621},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Tripoli",start:2553621,end:2554052},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Tunis",start:2554052,end:2554501},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Windhoek",start:2554501,end:2555139},{filename:"/tmp/pglite/share/postgresql/timezone/America/Adak",start:2555139,end:2556108},{filename:"/tmp/pglite/share/postgresql/timezone/America/Anchorage",start:2556108,end:2557085},{filename:"/tmp/pglite/share/postgresql/timezone/America/Anguilla",start:2557085,end:2557262},{filename:"/tmp/pglite/share/postgresql/timezone/America/Antigua",start:2557262,end:2557439},{filename:"/tmp/pglite/share/postgresql/timezone/America/Araguaina",start:2557439,end:2558031},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Buenos_Aires",start:2558031,end:2558739},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Catamarca",start:2558739,end:2559447},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/ComodRivadavia",start:2559447,end:2560155},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Cordoba",start:2560155,end:2560863},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Jujuy",start:2560863,end:2561553},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/La_Rioja",start:2561553,end:2562270},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Mendoza",start:2562270,end:2562978},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Rio_Gallegos",start:2562978,end:2563686},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Salta",start:2563686,end:2564376},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/San_Juan",start:2564376,end:2565093},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/San_Luis",start:2565093,end:2565810},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Tucuman",start:2565810,end:2566536},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Ushuaia",start:2566536,end:2567244},{filename:"/tmp/pglite/share/postgresql/timezone/America/Aruba",start:2567244,end:2567421},{filename:"/tmp/pglite/share/postgresql/timezone/America/Asuncion",start:2567421,end:2568305},{filename:"/tmp/pglite/share/postgresql/timezone/America/Atikokan",start:2568305,end:2568454},{filename:"/tmp/pglite/share/postgresql/timezone/America/Atka",start:2568454,end:2569423},{filename:"/tmp/pglite/share/postgresql/timezone/America/Bahia",start:2569423,end:2570105},{filename:"/tmp/pglite/share/postgresql/timezone/America/Bahia_Banderas",start:2570105,end:2570833},{filename:"/tmp/pglite/share/postgresql/timezone/America/Barbados",start:2570833,end:2571111},{filename:"/tmp/pglite/share/postgresql/timezone/America/Belem",start:2571111,end:2571505},{filename:"/tmp/pglite/share/postgresql/timezone/America/Belize",start:2571505,end:2572550},{filename:"/tmp/pglite/share/postgresql/timezone/America/Blanc-Sablon",start:2572550,end:2572727},{filename:"/tmp/pglite/share/postgresql/timezone/America/Boa_Vista",start:2572727,end:2573157},{filename:"/tmp/pglite/share/postgresql/timezone/America/Bogota",start:2573157,end:2573336},{filename:"/tmp/pglite/share/postgresql/timezone/America/Boise",start:2573336,end:2574335},{filename:"/tmp/pglite/share/postgresql/timezone/America/Buenos_Aires",start:2574335,end:2575043},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cambridge_Bay",start:2575043,end:2575926},{filename:"/tmp/pglite/share/postgresql/timezone/America/Campo_Grande",start:2575926,end:2576878},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cancun",start:2576878,end:2577407},{filename:"/tmp/pglite/share/postgresql/timezone/America/Caracas",start:2577407,end:2577597},{filename:"/tmp/pglite/share/postgresql/timezone/America/Catamarca",start:2577597,end:2578305},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cayenne",start:2578305,end:2578456},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cayman",start:2578456,end:2578605},{filename:"/tmp/pglite/share/postgresql/timezone/America/Chicago",start:2578605,end:2580359},{filename:"/tmp/pglite/share/postgresql/timezone/America/Chihuahua",start:2580359,end:2581050},{filename:"/tmp/pglite/share/postgresql/timezone/America/Ciudad_Juarez",start:2581050,end:2581768},{filename:"/tmp/pglite/share/postgresql/timezone/America/Coral_Harbour",start:2581768,end:2581917},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cordoba",start:2581917,end:2582625},{filename:"/tmp/pglite/share/postgresql/timezone/America/Costa_Rica",start:2582625,end:2582857},{filename:"/tmp/pglite/share/postgresql/timezone/America/Creston",start:2582857,end:2583097},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cuiaba",start:2583097,end:2584031},{filename:"/tmp/pglite/share/postgresql/timezone/America/Curacao",start:2584031,end:2584208},{filename:"/tmp/pglite/share/postgresql/timezone/America/Danmarkshavn",start:2584208,end:2584655},{filename:"/tmp/pglite/share/postgresql/timezone/America/Dawson",start:2584655,end:2585684},{filename:"/tmp/pglite/share/postgresql/timezone/America/Dawson_Creek",start:2585684,end:2586367},{filename:"/tmp/pglite/share/postgresql/timezone/America/Denver",start:2586367,end:2587409},{filename:"/tmp/pglite/share/postgresql/timezone/America/Detroit",start:2587409,end:2588308},{filename:"/tmp/pglite/share/postgresql/timezone/America/Dominica",start:2588308,end:2588485},{filename:"/tmp/pglite/share/postgresql/timezone/America/Edmonton",start:2588485,end:2589455},{filename:"/tmp/pglite/share/postgresql/timezone/America/Eirunepe",start:2589455,end:2589891},{filename:"/tmp/pglite/share/postgresql/timezone/America/El_Salvador",start:2589891,end:2590067},{filename:"/tmp/pglite/share/postgresql/timezone/America/Ensenada",start:2590067,end:2591092},{filename:"/tmp/pglite/share/postgresql/timezone/America/Fort_Nelson",start:2591092,end:2592540},{filename:"/tmp/pglite/share/postgresql/timezone/America/Fort_Wayne",start:2592540,end:2593071},{filename:"/tmp/pglite/share/postgresql/timezone/America/Fortaleza",start:2593071,end:2593555},{filename:"/tmp/pglite/share/postgresql/timezone/America/Glace_Bay",start:2593555,end:2594435},{filename:"/tmp/pglite/share/postgresql/timezone/America/Godthab",start:2594435,end:2595400},{filename:"/tmp/pglite/share/postgresql/timezone/America/Goose_Bay",start:2595400,end:2596980},{filename:"/tmp/pglite/share/postgresql/timezone/America/Grand_Turk",start:2596980,end:2597833},{filename:"/tmp/pglite/share/postgresql/timezone/America/Grenada",start:2597833,end:2598010},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guadeloupe",start:2598010,end:2598187},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guatemala",start:2598187,end:2598399},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guayaquil",start:2598399,end:2598578},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guyana",start:2598578,end:2598759},{filename:"/tmp/pglite/share/postgresql/timezone/America/Halifax",start:2598759,end:2600431},{filename:"/tmp/pglite/share/postgresql/timezone/America/Havana",start:2600431,end:2601548},{filename:"/tmp/pglite/share/postgresql/timezone/America/Hermosillo",start:2601548,end:2601834},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Indianapolis",start:2601834,end:2602365},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Knox",start:2602365,end:2603381},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Marengo",start:2603381,end:2603948},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Petersburg",start:2603948,end:2604631},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Tell_City",start:2604631,end:2605153},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Vevay",start:2605153,end:2605522},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Vincennes",start:2605522,end:2606080},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Winamac",start:2606080,end:2606692},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indianapolis",start:2606692,end:2607223},{filename:"/tmp/pglite/share/postgresql/timezone/America/Inuvik",start:2607223,end:2608040},{filename:"/tmp/pglite/share/postgresql/timezone/America/Iqaluit",start:2608040,end:2608895},{filename:"/tmp/pglite/share/postgresql/timezone/America/Jamaica",start:2608895,end:2609234},{filename:"/tmp/pglite/share/postgresql/timezone/America/Jujuy",start:2609234,end:2609924},{filename:"/tmp/pglite/share/postgresql/timezone/America/Juneau",start:2609924,end:2610890},{filename:"/tmp/pglite/share/postgresql/timezone/America/Kentucky/Louisville",start:2610890,end:2612132},{filename:"/tmp/pglite/share/postgresql/timezone/America/Kentucky/Monticello",start:2612132,end:2613104},{filename:"/tmp/pglite/share/postgresql/timezone/America/Knox_IN",start:2613104,end:2614120},{filename:"/tmp/pglite/share/postgresql/timezone/America/Kralendijk",start:2614120,end:2614297},{filename:"/tmp/pglite/share/postgresql/timezone/America/La_Paz",start:2614297,end:2614467},{filename:"/tmp/pglite/share/postgresql/timezone/America/Lima",start:2614467,end:2614750},{filename:"/tmp/pglite/share/postgresql/timezone/America/Los_Angeles",start:2614750,end:2616044},{filename:"/tmp/pglite/share/postgresql/timezone/America/Louisville",start:2616044,end:2617286},{filename:"/tmp/pglite/share/postgresql/timezone/America/Lower_Princes",start:2617286,end:2617463},{filename:"/tmp/pglite/share/postgresql/timezone/America/Maceio",start:2617463,end:2617965},{filename:"/tmp/pglite/share/postgresql/timezone/America/Managua",start:2617965,end:2618260},{filename:"/tmp/pglite/share/postgresql/timezone/America/Manaus",start:2618260,end:2618672},{filename:"/tmp/pglite/share/postgresql/timezone/America/Marigot",start:2618672,end:2618849},{filename:"/tmp/pglite/share/postgresql/timezone/America/Martinique",start:2618849,end:2619027},{filename:"/tmp/pglite/share/postgresql/timezone/America/Matamoros",start:2619027,end:2619464},{filename:"/tmp/pglite/share/postgresql/timezone/America/Mazatlan",start:2619464,end:2620182},{filename:"/tmp/pglite/share/postgresql/timezone/America/Mendoza",start:2620182,end:2620890},{filename:"/tmp/pglite/share/postgresql/timezone/America/Menominee",start:2620890,end:2621807},{filename:"/tmp/pglite/share/postgresql/timezone/America/Merida",start:2621807,end:2622461},{filename:"/tmp/pglite/share/postgresql/timezone/America/Metlakatla",start:2622461,end:2623056},{filename:"/tmp/pglite/share/postgresql/timezone/America/Mexico_City",start:2623056,end:2623829},{filename:"/tmp/pglite/share/postgresql/timezone/America/Miquelon",start:2623829,end:2624379},{filename:"/tmp/pglite/share/postgresql/timezone/America/Moncton",start:2624379,end:2625872},{filename:"/tmp/pglite/share/postgresql/timezone/America/Monterrey",start:2625872,end:2626516},{filename:"/tmp/pglite/share/postgresql/timezone/America/Montevideo",start:2626516,end:2627485},{filename:"/tmp/pglite/share/postgresql/timezone/America/Montreal",start:2627485,end:2629202},{filename:"/tmp/pglite/share/postgresql/timezone/America/Montserrat",start:2629202,end:2629379},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nassau",start:2629379,end:2631096},{filename:"/tmp/pglite/share/postgresql/timezone/America/New_York",start:2631096,end:2632840},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nipigon",start:2632840,end:2634557},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nome",start:2634557,end:2635532},{filename:"/tmp/pglite/share/postgresql/timezone/America/Noronha",start:2635532,end:2636016},{filename:"/tmp/pglite/share/postgresql/timezone/America/North_Dakota/Beulah",start:2636016,end:2637059},{filename:"/tmp/pglite/share/postgresql/timezone/America/North_Dakota/Center",start:2637059,end:2638049},{filename:"/tmp/pglite/share/postgresql/timezone/America/North_Dakota/New_Salem",start:2638049,end:2639039},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nuuk",start:2639039,end:2640004},{filename:"/tmp/pglite/share/postgresql/timezone/America/Ojinaga",start:2640004,end:2640713},{filename:"/tmp/pglite/share/postgresql/timezone/America/Panama",start:2640713,end:2640862},{filename:"/tmp/pglite/share/postgresql/timezone/America/Pangnirtung",start:2640862,end:2641717},{filename:"/tmp/pglite/share/postgresql/timezone/America/Paramaribo",start:2641717,end:2641904},{filename:"/tmp/pglite/share/postgresql/timezone/America/Phoenix",start:2641904,end:2642144},{filename:"/tmp/pglite/share/postgresql/timezone/America/Port-au-Prince",start:2642144,end:2642709},{filename:"/tmp/pglite/share/postgresql/timezone/America/Port_of_Spain",start:2642709,end:2642886},{filename:"/tmp/pglite/share/postgresql/timezone/America/Porto_Acre",start:2642886,end:2643304},{filename:"/tmp/pglite/share/postgresql/timezone/America/Porto_Velho",start:2643304,end:2643698},{filename:"/tmp/pglite/share/postgresql/timezone/America/Puerto_Rico",start:2643698,end:2643875},{filename:"/tmp/pglite/share/postgresql/timezone/America/Punta_Arenas",start:2643875,end:2645093},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rainy_River",start:2645093,end:2646387},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rankin_Inlet",start:2646387,end:2647194},{filename:"/tmp/pglite/share/postgresql/timezone/America/Recife",start:2647194,end:2647678},{filename:"/tmp/pglite/share/postgresql/timezone/America/Regina",start:2647678,end:2648316},{filename:"/tmp/pglite/share/postgresql/timezone/America/Resolute",start:2648316,end:2649123},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rio_Branco",start:2649123,end:2649541},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rosario",start:2649541,end:2650249},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santa_Isabel",start:2650249,end:2651274},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santarem",start:2651274,end:2651683},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santiago",start:2651683,end:2653037},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santo_Domingo",start:2653037,end:2653354},{filename:"/tmp/pglite/share/postgresql/timezone/America/Sao_Paulo",start:2653354,end:2654306},{filename:"/tmp/pglite/share/postgresql/timezone/America/Scoresbysund",start:2654306,end:2655290},{filename:"/tmp/pglite/share/postgresql/timezone/America/Shiprock",start:2655290,end:2656332},{filename:"/tmp/pglite/share/postgresql/timezone/America/Sitka",start:2656332,end:2657288},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Barthelemy",start:2657288,end:2657465},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Johns",start:2657465,end:2659343},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Kitts",start:2659343,end:2659520},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Lucia",start:2659520,end:2659697},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Thomas",start:2659697,end:2659874},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Vincent",start:2659874,end:2660051},{filename:"/tmp/pglite/share/postgresql/timezone/America/Swift_Current",start:2660051,end:2660419},{filename:"/tmp/pglite/share/postgresql/timezone/America/Tegucigalpa",start:2660419,end:2660613},{filename:"/tmp/pglite/share/postgresql/timezone/America/Thule",start:2660613,end:2661068},{filename:"/tmp/pglite/share/postgresql/timezone/America/Thunder_Bay",start:2661068,end:2662785},{filename:"/tmp/pglite/share/postgresql/timezone/America/Tijuana",start:2662785,end:2663810},{filename:"/tmp/pglite/share/postgresql/timezone/America/Toronto",start:2663810,end:2665527},{filename:"/tmp/pglite/share/postgresql/timezone/America/Tortola",start:2665527,end:2665704},{filename:"/tmp/pglite/share/postgresql/timezone/America/Vancouver",start:2665704,end:2667034},{filename:"/tmp/pglite/share/postgresql/timezone/America/Virgin",start:2667034,end:2667211},{filename:"/tmp/pglite/share/postgresql/timezone/America/Whitehorse",start:2667211,end:2668240},{filename:"/tmp/pglite/share/postgresql/timezone/America/Winnipeg",start:2668240,end:2669534},{filename:"/tmp/pglite/share/postgresql/timezone/America/Yakutat",start:2669534,end:2670480},{filename:"/tmp/pglite/share/postgresql/timezone/America/Yellowknife",start:2670480,end:2671450},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Casey",start:2671450,end:2671737},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Davis",start:2671737,end:2671934},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/DumontDUrville",start:2671934,end:2672088},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Macquarie",start:2672088,end:2673064},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Mawson",start:2673064,end:2673216},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/McMurdo",start:2673216,end:2674259},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Palmer",start:2674259,end:2675146},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Rothera",start:2675146,end:2675278},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/South_Pole",start:2675278,end:2676321},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Syowa",start:2676321,end:2676454},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Troll",start:2676454,end:2676631},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Vostok",start:2676631,end:2676801},{filename:"/tmp/pglite/share/postgresql/timezone/Arctic/Longyearbyen",start:2676801,end:2677506},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Aden",start:2677506,end:2677639},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Almaty",start:2677639,end:2678257},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Amman",start:2678257,end:2679185},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Anadyr",start:2679185,end:2679928},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Aqtau",start:2679928,end:2680534},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Aqtobe",start:2680534,end:2681149},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ashgabat",start:2681149,end:2681524},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ashkhabad",start:2681524,end:2681899},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Atyrau",start:2681899,end:2682515},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Baghdad",start:2682515,end:2683145},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Bahrain",start:2683145,end:2683297},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Baku",start:2683297,end:2684041},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Bangkok",start:2684041,end:2684193},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Barnaul",start:2684193,end:2684946},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Beirut",start:2684946,end:2685678},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Bishkek",start:2685678,end:2686296},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Brunei",start:2686296,end:2686616},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Calcutta",start:2686616,end:2686836},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Chita",start:2686836,end:2687586},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Choibalsan",start:2687586,end:2688205},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Chongqing",start:2688205,end:2688598},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Chungking",start:2688598,end:2688991},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Colombo",start:2688991,end:2689238},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dacca",start:2689238,end:2689469},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Damascus",start:2689469,end:2690703},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dhaka",start:2690703,end:2690934},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dili",start:2690934,end:2691104},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dubai",start:2691104,end:2691237},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dushanbe",start:2691237,end:2691603},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Famagusta",start:2691603,end:2692543},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Gaza",start:2692543,end:2694989},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Harbin",start:2694989,end:2695382},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Hebron",start:2695382,end:2697846},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ho_Chi_Minh",start:2697846,end:2698082},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Hong_Kong",start:2698082,end:2698857},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Hovd",start:2698857,end:2699451},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Irkutsk",start:2699451,end:2700211},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Istanbul",start:2700211,end:2701411},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Jakarta",start:2701411,end:2701659},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Jayapura",start:2701659,end:2701830},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Jerusalem",start:2701830,end:2702904},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kabul",start:2702904,end:2703063},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kamchatka",start:2703063,end:2703790},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Karachi",start:2703790,end:2704056},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kashgar",start:2704056,end:2704189},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kathmandu",start:2704189,end:2704350},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Katmandu",start:2704350,end:2704511},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Khandyga",start:2704511,end:2705286},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kolkata",start:2705286,end:2705506},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Krasnoyarsk",start:2705506,end:2706247},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kuala_Lumpur",start:2706247,end:2706503},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kuching",start:2706503,end:2706823},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kuwait",start:2706823,end:2706956},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Macao",start:2706956,end:2707747},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Macau",start:2707747,end:2708538},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Magadan",start:2708538,end:2709289},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Makassar",start:2709289,end:2709479},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Manila",start:2709479,end:2709717},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Muscat",start:2709717,end:2709850},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Nicosia",start:2709850,end:2710447},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Novokuznetsk",start:2710447,end:2711173},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Novosibirsk",start:2711173,end:2711926},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Omsk",start:2711926,end:2712667},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Oral",start:2712667,end:2713292},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Phnom_Penh",start:2713292,end:2713444},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Pontianak",start:2713444,end:2713691},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Pyongyang",start:2713691,end:2713874},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Qatar",start:2713874,end:2714026},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Qostanay",start:2714026,end:2714650},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Qyzylorda",start:2714650,end:2715274},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Rangoon",start:2715274,end:2715461},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Riyadh",start:2715461,end:2715594},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Saigon",start:2715594,end:2715830},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Sakhalin",start:2715830,end:2716585},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Samarkand",start:2716585,end:2716951},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Seoul",start:2716951,end:2717366},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Shanghai",start:2717366,end:2717759},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Singapore",start:2717759,end:2718015},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Srednekolymsk",start:2718015,end:2718757},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Taipei",start:2718757,end:2719268},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tashkent",start:2719268,end:2719634},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tbilisi",start:2719634,end:2720263},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tehran",start:2720263,end:2721075},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tel_Aviv",start:2721075,end:2722149},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Thimbu",start:2722149,end:2722303},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Thimphu",start:2722303,end:2722457},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tokyo",start:2722457,end:2722670},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tomsk",start:2722670,end:2723423},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ujung_Pandang",start:2723423,end:2723613},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ulaanbaatar",start:2723613,end:2724207},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ulan_Bator",start:2724207,end:2724801},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Urumqi",start:2724801,end:2724934},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ust-Nera",start:2724934,end:2725705},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Vientiane",start:2725705,end:2725857},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Vladivostok",start:2725857,end:2726599},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yakutsk",start:2726599,end:2727340},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yangon",start:2727340,end:2727527},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yekaterinburg",start:2727527,end:2728287},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yerevan",start:2728287,end:2728995},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Azores",start:2728995,end:2730448},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Bermuda",start:2730448,end:2731472},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Canary",start:2731472,end:2731950},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Cape_Verde",start:2731950,end:2732125},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Faeroe",start:2732125,end:2732566},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Faroe",start:2732566,end:2733007},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Jan_Mayen",start:2733007,end:2733712},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Madeira",start:2733712,end:2735165},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Reykjavik",start:2735165,end:2735295},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/South_Georgia",start:2735295,end:2735427},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/St_Helena",start:2735427,end:2735557},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Stanley",start:2735557,end:2736346},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/ACT",start:2736346,end:2737250},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Adelaide",start:2737250,end:2738171},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Brisbane",start:2738171,end:2738460},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Broken_Hill",start:2738460,end:2739401},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Canberra",start:2739401,end:2740305},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Currie",start:2740305,end:2741308},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Darwin",start:2741308,end:2741542},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Eucla",start:2741542,end:2741856},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Hobart",start:2741856,end:2742859},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/LHI",start:2742859,end:2743551},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Lindeman",start:2743551,end:2743876},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Lord_Howe",start:2743876,end:2744568},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Melbourne",start:2744568,end:2745472},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/NSW",start:2745472,end:2746376},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/North",start:2746376,end:2746610},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Perth",start:2746610,end:2746916},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Queensland",start:2746916,end:2747205},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/South",start:2747205,end:2748126},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Sydney",start:2748126,end:2749030},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Tasmania",start:2749030,end:2750033},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Victoria",start:2750033,end:2750937},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/West",start:2750937,end:2751243},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Yancowinna",start:2751243,end:2752184},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/Acre",start:2752184,end:2752602},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/DeNoronha",start:2752602,end:2753086},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/East",start:2753086,end:2754038},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/West",start:2754038,end:2754450},{filename:"/tmp/pglite/share/postgresql/timezone/CET",start:2754450,end:2755071},{filename:"/tmp/pglite/share/postgresql/timezone/CST6CDT",start:2755071,end:2756022},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Atlantic",start:2756022,end:2757694},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Central",start:2757694,end:2758988},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Eastern",start:2758988,end:2760705},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Mountain",start:2760705,end:2761675},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Newfoundland",start:2761675,end:2763553},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Pacific",start:2763553,end:2764883},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Saskatchewan",start:2764883,end:2765521},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Yukon",start:2765521,end:2766550},{filename:"/tmp/pglite/share/postgresql/timezone/Chile/Continental",start:2766550,end:2767904},{filename:"/tmp/pglite/share/postgresql/timezone/Chile/EasterIsland",start:2767904,end:2769078},{filename:"/tmp/pglite/share/postgresql/timezone/Cuba",start:2769078,end:2770195},{filename:"/tmp/pglite/share/postgresql/timezone/EET",start:2770195,end:2770692},{filename:"/tmp/pglite/share/postgresql/timezone/EST",start:2770692,end:2770803},{filename:"/tmp/pglite/share/postgresql/timezone/EST5EDT",start:2770803,end:2771754},{filename:"/tmp/pglite/share/postgresql/timezone/Egypt",start:2771754,end:2773063},{filename:"/tmp/pglite/share/postgresql/timezone/Eire",start:2773063,end:2774559},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT",start:2774559,end:2774670},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+0",start:2774670,end:2774781},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+1",start:2774781,end:2774894},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+10",start:2774894,end:2775008},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+11",start:2775008,end:2775122},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+12",start:2775122,end:2775236},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+2",start:2775236,end:2775349},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+3",start:2775349,end:2775462},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+4",start:2775462,end:2775575},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+5",start:2775575,end:2775688},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+6",start:2775688,end:2775801},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+7",start:2775801,end:2775914},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+8",start:2775914,end:2776027},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+9",start:2776027,end:2776140},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-0",start:2776140,end:2776251},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-1",start:2776251,end:2776365},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-10",start:2776365,end:2776480},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-11",start:2776480,end:2776595},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-12",start:2776595,end:2776710},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-13",start:2776710,end:2776825},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-14",start:2776825,end:2776940},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-2",start:2776940,end:2777054},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-3",start:2777054,end:2777168},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-4",start:2777168,end:2777282},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-5",start:2777282,end:2777396},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-6",start:2777396,end:2777510},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-7",start:2777510,end:2777624},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-8",start:2777624,end:2777738},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-9",start:2777738,end:2777852},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT0",start:2777852,end:2777963},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/Greenwich",start:2777963,end:2778074},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/UCT",start:2778074,end:2778185},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/UTC",start:2778185,end:2778296},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/Universal",start:2778296,end:2778407},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/Zulu",start:2778407,end:2778518},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Amsterdam",start:2778518,end:2779621},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Andorra",start:2779621,end:2780010},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Astrakhan",start:2780010,end:2780736},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Athens",start:2780736,end:2781418},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Belfast",start:2781418,end:2783017},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Belgrade",start:2783017,end:2783495},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Berlin",start:2783495,end:2784200},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Bratislava",start:2784200,end:2784923},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Brussels",start:2784923,end:2786026},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Bucharest",start:2786026,end:2786687},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Budapest",start:2786687,end:2787453},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Busingen",start:2787453,end:2787950},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Chisinau",start:2787950,end:2788705},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Copenhagen",start:2788705,end:2789410},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Dublin",start:2789410,end:2790906},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Gibraltar",start:2790906,end:2792126},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Guernsey",start:2792126,end:2793725},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Helsinki",start:2793725,end:2794206},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Isle_of_Man",start:2794206,end:2795805},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Istanbul",start:2795805,end:2797005},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Jersey",start:2797005,end:2798604},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kaliningrad",start:2798604,end:2799508},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kiev",start:2799508,end:2800066},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kirov",start:2800066,end:2800801},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kyiv",start:2800801,end:2801359},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Lisbon",start:2801359,end:2802813},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Ljubljana",start:2802813,end:2803291},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/London",start:2803291,end:2804890},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Luxembourg",start:2804890,end:2805993},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Madrid",start:2805993,end:2806890},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Malta",start:2806890,end:2807818},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Mariehamn",start:2807818,end:2808299},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Minsk",start:2808299,end:2809107},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Monaco",start:2809107,end:2810212},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Moscow",start:2810212,end:2811120},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Nicosia",start:2811120,end:2811717},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Oslo",start:2811717,end:2812422},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Paris",start:2812422,end:2813527},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Podgorica",start:2813527,end:2814005},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Prague",start:2814005,end:2814728},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Riga",start:2814728,end:2815422},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Rome",start:2815422,end:2816369},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Samara",start:2816369,end:2817101},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/San_Marino",start:2817101,end:2818048},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Sarajevo",start:2818048,end:2818526},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Saratov",start:2818526,end:2819252},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Simferopol",start:2819252,end:2820117},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Skopje",start:2820117,end:2820595},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Sofia",start:2820595,end:2821187},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Stockholm",start:2821187,end:2821892},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Tallinn",start:2821892,end:2822567},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Tirane",start:2822567,end:2823171},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Tiraspol",start:2823171,end:2823926},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Ulyanovsk",start:2823926,end:2824686},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Uzhgorod",start:2824686,end:2825244},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vaduz",start:2825244,end:2825741},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vatican",start:2825741,end:2826688},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vienna",start:2826688,end:2827346},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vilnius",start:2827346,end:2828022},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Volgograd",start:2828022,end:2828775},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Warsaw",start:2828775,end:2829698},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Zagreb",start:2829698,end:2830176},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Zaporozhye",start:2830176,end:2830734},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Zurich",start:2830734,end:2831231},{filename:"/tmp/pglite/share/postgresql/timezone/Factory",start:2831231,end:2831344},{filename:"/tmp/pglite/share/postgresql/timezone/GB",start:2831344,end:2832943},{filename:"/tmp/pglite/share/postgresql/timezone/GB-Eire",start:2832943,end:2834542},{filename:"/tmp/pglite/share/postgresql/timezone/GMT",start:2834542,end:2834653},{filename:"/tmp/pglite/share/postgresql/timezone/GMT+0",start:2834653,end:2834764},{filename:"/tmp/pglite/share/postgresql/timezone/GMT-0",start:2834764,end:2834875},{filename:"/tmp/pglite/share/postgresql/timezone/GMT0",start:2834875,end:2834986},{filename:"/tmp/pglite/share/postgresql/timezone/Greenwich",start:2834986,end:2835097},{filename:"/tmp/pglite/share/postgresql/timezone/HST",start:2835097,end:2835209},{filename:"/tmp/pglite/share/postgresql/timezone/Hongkong",start:2835209,end:2835984},{filename:"/tmp/pglite/share/postgresql/timezone/Iceland",start:2835984,end:2836114},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Antananarivo",start:2836114,end:2836305},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Chagos",start:2836305,end:2836457},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Christmas",start:2836457,end:2836609},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Cocos",start:2836609,end:2836796},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Comoro",start:2836796,end:2836987},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Kerguelen",start:2836987,end:2837139},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Mahe",start:2837139,end:2837272},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Maldives",start:2837272,end:2837424},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Mauritius",start:2837424,end:2837603},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Mayotte",start:2837603,end:2837794},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Reunion",start:2837794,end:2837927},{filename:"/tmp/pglite/share/postgresql/timezone/Iran",start:2837927,end:2838739},{filename:"/tmp/pglite/share/postgresql/timezone/Israel",start:2838739,end:2839813},{filename:"/tmp/pglite/share/postgresql/timezone/Jamaica",start:2839813,end:2840152},{filename:"/tmp/pglite/share/postgresql/timezone/Japan",start:2840152,end:2840365},{filename:"/tmp/pglite/share/postgresql/timezone/Kwajalein",start:2840365,end:2840584},{filename:"/tmp/pglite/share/postgresql/timezone/Libya",start:2840584,end:2841015},{filename:"/tmp/pglite/share/postgresql/timezone/MET",start:2841015,end:2841636},{filename:"/tmp/pglite/share/postgresql/timezone/MST",start:2841636,end:2841747},{filename:"/tmp/pglite/share/postgresql/timezone/MST7MDT",start:2841747,end:2842698},{filename:"/tmp/pglite/share/postgresql/timezone/Mexico/BajaNorte",start:2842698,end:2843723},{filename:"/tmp/pglite/share/postgresql/timezone/Mexico/BajaSur",start:2843723,end:2844441},{filename:"/tmp/pglite/share/postgresql/timezone/Mexico/General",start:2844441,end:2845214},{filename:"/tmp/pglite/share/postgresql/timezone/NZ",start:2845214,end:2846257},{filename:"/tmp/pglite/share/postgresql/timezone/NZ-CHAT",start:2846257,end:2847065},{filename:"/tmp/pglite/share/postgresql/timezone/Navajo",start:2847065,end:2848107},{filename:"/tmp/pglite/share/postgresql/timezone/PRC",start:2848107,end:2848500},{filename:"/tmp/pglite/share/postgresql/timezone/PST8PDT",start:2848500,end:2849451},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Apia",start:2849451,end:2849858},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Auckland",start:2849858,end:2850901},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Bougainville",start:2850901,end:2851102},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Chatham",start:2851102,end:2851910},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Chuuk",start:2851910,end:2852064},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Easter",start:2852064,end:2853238},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Efate",start:2853238,end:2853580},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Enderbury",start:2853580,end:2853752},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Fakaofo",start:2853752,end:2853905},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Fiji",start:2853905,end:2854301},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Funafuti",start:2854301,end:2854435},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Galapagos",start:2854435,end:2854610},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Gambier",start:2854610,end:2854742},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Guadalcanal",start:2854742,end:2854876},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Guam",start:2854876,end:2855226},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Honolulu",start:2855226,end:2855447},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Johnston",start:2855447,end:2855668},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kanton",start:2855668,end:2855840},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kiritimati",start:2855840,end:2856014},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kosrae",start:2856014,end:2856256},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kwajalein",start:2856256,end:2856475},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Majuro",start:2856475,end:2856609},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Marquesas",start:2856609,end:2856748},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Midway",start:2856748,end:2856894},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Nauru",start:2856894,end:2857077},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Niue",start:2857077,end:2857231},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Norfolk",start:2857231,end:2857478},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Noumea",start:2857478,end:2857676},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Pago_Pago",start:2857676,end:2857822},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Palau",start:2857822,end:2857970},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Pitcairn",start:2857970,end:2858123},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Pohnpei",start:2858123,end:2858257},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Ponape",start:2858257,end:2858391},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Port_Moresby",start:2858391,end:2858545},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Rarotonga",start:2858545,end:2858951},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Saipan",start:2858951,end:2859301},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Samoa",start:2859301,end:2859447},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Tahiti",start:2859447,end:2859580},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Tarawa",start:2859580,end:2859714},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Tongatapu",start:2859714,end:2859951},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Truk",start:2859951,end:2860105},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Wake",start:2860105,end:2860239},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Wallis",start:2860239,end:2860373},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Yap",start:2860373,end:2860527},{filename:"/tmp/pglite/share/postgresql/timezone/Poland",start:2860527,end:2861450},{filename:"/tmp/pglite/share/postgresql/timezone/Portugal",start:2861450,end:2862904},{filename:"/tmp/pglite/share/postgresql/timezone/ROC",start:2862904,end:2863415},{filename:"/tmp/pglite/share/postgresql/timezone/ROK",start:2863415,end:2863830},{filename:"/tmp/pglite/share/postgresql/timezone/Singapore",start:2863830,end:2864086},{filename:"/tmp/pglite/share/postgresql/timezone/Turkey",start:2864086,end:2865286},{filename:"/tmp/pglite/share/postgresql/timezone/UCT",start:2865286,end:2865397},{filename:"/tmp/pglite/share/postgresql/timezone/US/Alaska",start:2865397,end:2866374},{filename:"/tmp/pglite/share/postgresql/timezone/US/Aleutian",start:2866374,end:2867343},{filename:"/tmp/pglite/share/postgresql/timezone/US/Arizona",start:2867343,end:2867583},{filename:"/tmp/pglite/share/postgresql/timezone/US/Central",start:2867583,end:2869337},{filename:"/tmp/pglite/share/postgresql/timezone/US/East-Indiana",start:2869337,end:2869868},{filename:"/tmp/pglite/share/postgresql/timezone/US/Eastern",start:2869868,end:2871612},{filename:"/tmp/pglite/share/postgresql/timezone/US/Hawaii",start:2871612,end:2871833},{filename:"/tmp/pglite/share/postgresql/timezone/US/Indiana-Starke",start:2871833,end:2872849},{filename:"/tmp/pglite/share/postgresql/timezone/US/Michigan",start:2872849,end:2873748},{filename:"/tmp/pglite/share/postgresql/timezone/US/Mountain",start:2873748,end:2874790},{filename:"/tmp/pglite/share/postgresql/timezone/US/Pacific",start:2874790,end:2876084},{filename:"/tmp/pglite/share/postgresql/timezone/US/Samoa",start:2876084,end:2876230},{filename:"/tmp/pglite/share/postgresql/timezone/UTC",start:2876230,end:2876341},{filename:"/tmp/pglite/share/postgresql/timezone/Universal",start:2876341,end:2876452},{filename:"/tmp/pglite/share/postgresql/timezone/W-SU",start:2876452,end:2877360},{filename:"/tmp/pglite/share/postgresql/timezone/WET",start:2877360,end:2877854},{filename:"/tmp/pglite/share/postgresql/timezone/Zulu",start:2877854,end:2877965},{filename:"/tmp/pglite/share/postgresql/timezonesets/Africa.txt",start:2877965,end:2884938},{filename:"/tmp/pglite/share/postgresql/timezonesets/America.txt",start:2884938,end:2895945},{filename:"/tmp/pglite/share/postgresql/timezonesets/Antarctica.txt",start:2895945,end:2897079},{filename:"/tmp/pglite/share/postgresql/timezonesets/Asia.txt",start:2897079,end:2905390},{filename:"/tmp/pglite/share/postgresql/timezonesets/Atlantic.txt",start:2905390,end:2908923},{filename:"/tmp/pglite/share/postgresql/timezonesets/Australia",start:2908923,end:2910058},{filename:"/tmp/pglite/share/postgresql/timezonesets/Australia.txt",start:2910058,end:2913442},{filename:"/tmp/pglite/share/postgresql/timezonesets/Default",start:2913442,end:2940692},{filename:"/tmp/pglite/share/postgresql/timezonesets/Etc.txt",start:2940692,end:2941942},{filename:"/tmp/pglite/share/postgresql/timezonesets/Europe.txt",start:2941942,end:2950724},{filename:"/tmp/pglite/share/postgresql/timezonesets/India",start:2950724,end:2951317},{filename:"/tmp/pglite/share/postgresql/timezonesets/Indian.txt",start:2951317,end:2952578},{filename:"/tmp/pglite/share/postgresql/timezonesets/Pacific.txt",start:2952578,end:2956346},{filename:"/tmp/pglite/share/postgresql/tsearch_data/danish.stop",start:2956346,end:2956770},{filename:"/tmp/pglite/share/postgresql/tsearch_data/dutch.stop",start:2956770,end:2957223},{filename:"/tmp/pglite/share/postgresql/tsearch_data/english.stop",start:2957223,end:2957845},{filename:"/tmp/pglite/share/postgresql/tsearch_data/finnish.stop",start:2957845,end:2959424},{filename:"/tmp/pglite/share/postgresql/tsearch_data/french.stop",start:2959424,end:2960229},{filename:"/tmp/pglite/share/postgresql/tsearch_data/german.stop",start:2960229,end:2961578},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hungarian.stop",start:2961578,end:2962805},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample.affix",start:2962805,end:2963048},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_long.affix",start:2963048,end:2963681},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_long.dict",start:2963681,end:2963779},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_num.affix",start:2963779,end:2964241},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_num.dict",start:2964241,end:2964370},{filename:"/tmp/pglite/share/postgresql/tsearch_data/ispell_sample.affix",start:2964370,end:2964835},{filename:"/tmp/pglite/share/postgresql/tsearch_data/ispell_sample.dict",start:2964835,end:2964916},{filename:"/tmp/pglite/share/postgresql/tsearch_data/italian.stop",start:2964916,end:2966570},{filename:"/tmp/pglite/share/postgresql/tsearch_data/nepali.stop",start:2966570,end:2970831},{filename:"/tmp/pglite/share/postgresql/tsearch_data/norwegian.stop",start:2970831,end:2971682},{filename:"/tmp/pglite/share/postgresql/tsearch_data/portuguese.stop",start:2971682,end:2972949},{filename:"/tmp/pglite/share/postgresql/tsearch_data/russian.stop",start:2972949,end:2974184},{filename:"/tmp/pglite/share/postgresql/tsearch_data/spanish.stop",start:2974184,end:2976362},{filename:"/tmp/pglite/share/postgresql/tsearch_data/swedish.stop",start:2976362,end:2976921},{filename:"/tmp/pglite/share/postgresql/tsearch_data/synonym_sample.syn",start:2976921,end:2976994},{filename:"/tmp/pglite/share/postgresql/tsearch_data/thesaurus_sample.ths",start:2976994,end:2977467},{filename:"/tmp/pglite/share/postgresql/tsearch_data/turkish.stop",start:2977467,end:2977727},{filename:"/tmp/pglite/share/postgresql/tsearch_data/unaccent.rules",start:2977727,end:2987666},{filename:"/tmp/pglite/share/postgresql/tsearch_data/xsyn_sample.rules",start:2987666,end:2987805}],remote_package_size:2987805})})();var moduleOverrides=Object.assign({},Module),arguments_=[],thisProgram="./this.program",quit_=(ae,e)=>{throw e},scriptDirectory="";function locateFile(ae){return Module.locateFile?Module.locateFile(ae,scriptDirectory):scriptDirectory+ae}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs"),nodePath=require("path");import.meta.url.startsWith("data:")||(scriptDirectory=nodePath.dirname(require("url").fileURLToPath(import.meta.url))+"/"),readBinary=ae=>{ae=isFileURI(ae)?new URL(ae):nodePath.normalize(ae);var e=fs.readFileSync(ae);return e},readAsync=(ae,e=!0)=>(ae=isFileURI(ae)?new URL(ae):nodePath.normalize(ae),new Promise((I,oe)=>{fs.readFile(ae,e?void 0:"utf8",(ue,bt)=>{ue?oe(ue):I(e?bt.buffer:bt)})})),!Module.thisProgram&&process$1.argv.length>1&&(thisProgram=process$1.argv[1].replace(/\\/g,"/")),arguments_=process$1.argv.slice(2),quit_=(ae,e)=>{throw process$1.exitCode=ae,e}}else(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:typeof document<"u"&&document.currentScript&&(scriptDirectory=document.currentScript.src),_scriptName&&(scriptDirectory=_scriptName),scriptDirectory.startsWith("blob:")?scriptDirectory="":scriptDirectory=scriptDirectory.substr(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1),ENVIRONMENT_IS_WORKER&&(readBinary=ae=>{var e=new XMLHttpRequest;return e.open("GET",ae,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),readAsync=ae=>isFileURI(ae)?new Promise((e,I)=>{var oe=new XMLHttpRequest;oe.open("GET",ae,!0),oe.responseType="arraybuffer",oe.onload=()=>{if(oe.status==200||oe.status==0&&oe.response){e(oe.response);return}I(oe.status)},oe.onerror=I,oe.send(null)}):fetch(ae,{credentials:"same-origin"}).then(e=>e.ok?e.arrayBuffer():Promise.reject(new Error(e.status+" : "+e.url))));var out=Module.print||console.log.bind(console),err=Module.printErr||console.error.bind(console);Object.assign(Module,moduleOverrides),moduleOverrides=null,Module.arguments&&(arguments_=Module.arguments),Module.thisProgram&&(thisProgram=Module.thisProgram);var dynamicLibraries=Module.dynamicLibraries||[],wasmBinary=Module.wasmBinary,wasmMemory,ABORT=!1,EXITSTATUS;function assert(ae,e){ae||abort(e)}var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPF64;function updateMemoryViews(){var ae=wasmMemory.buffer;Module.HEAP8=HEAP8=new Int8Array(ae),Module.HEAP16=HEAP16=new Int16Array(ae),Module.HEAPU8=HEAPU8=new Uint8Array(ae),Module.HEAPU16=HEAPU16=new Uint16Array(ae),Module.HEAP32=HEAP32=new Int32Array(ae),Module.HEAPU32=HEAPU32=new Uint32Array(ae),Module.HEAPF32=HEAPF32=new Float32Array(ae),Module.HEAPF64=HEAPF64=new Float64Array(ae),Module.HEAP64=HEAP64=new BigInt64Array(ae),Module.HEAPU64=new BigUint64Array(ae)}if(Module.wasmMemory)wasmMemory=Module.wasmMemory;else{var INITIAL_MEMORY=Module.INITIAL_MEMORY||134217728;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:32768})}updateMemoryViews();var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATPOSTRUN__=[],__RELOC_FUNCS__=[],runtimeInitialized=!1;function preRun(){if(Module.preRun)for(typeof Module.preRun=="function"&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=!0,callRuntimeCallbacks(__RELOC_FUNCS__),!Module.noFSInit&&!FS.initialized&&FS.init(),FS.ignorePermissions=!1,SOCKFS.root=FS.mount(SOCKFS,{},null),PIPEFS.root=FS.mount(PIPEFS,{},null),callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function postRun(){if(Module.postRun)for(typeof Module.postRun=="function"&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(ae){__ATPRERUN__.unshift(ae)}function addOnInit(ae){__ATINIT__.unshift(ae)}function addOnPostRun(ae){__ATPOSTRUN__.unshift(ae)}var runDependencies=0,dependenciesFulfilled=null;function getUniqueRunDependency(ae){return ae}function addRunDependency(ae){runDependencies++,Module.monitorRunDependencies?.(runDependencies)}function removeRunDependency(ae){if(runDependencies--,Module.monitorRunDependencies?.(runDependencies),runDependencies==0&&dependenciesFulfilled){var e=dependenciesFulfilled;dependenciesFulfilled=null,e()}}function abort(ae){Module.onAbort?.(ae),ae="Aborted("+ae+")",err(ae),ABORT=!0,ae+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(ae);throw readyPromiseReject(e),e}var dataURIPrefix="data:application/octet-stream;base64,",isDataURI=ae=>ae.startsWith(dataURIPrefix),isFileURI=ae=>ae.startsWith("file://");function findWasmBinary(){if(Module.locateFile){var ae="postgres.wasm";return isDataURI(ae)?ae:locateFile(ae)}return new URL("/NoLLMChat/assets/postgres-BwytDQ9E.wasm",import.meta.url).href}var wasmBinaryFile;function getBinarySync(ae){if(ae==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(ae);throw"both async and sync fetching of the wasm failed"}function getBinaryPromise(ae){return wasmBinary?Promise.resolve().then(()=>getBinarySync(ae)):readAsync(ae).then(e=>new Uint8Array(e),()=>getBinarySync(ae))}function instantiateArrayBuffer(ae,e,I){return getBinaryPromise(ae).then(oe=>WebAssembly.instantiate(oe,e)).then(I,oe=>{err(`failed to asynchronously prepare wasm: ${oe}`),abort(oe)})}function instantiateAsync(ae,e,I,oe){return!ae&&typeof WebAssembly.instantiateStreaming=="function"&&!isDataURI(e)&&!isFileURI(e)&&!ENVIRONMENT_IS_NODE&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(ue=>{var bt=WebAssembly.instantiateStreaming(ue,I);return bt.then(oe,function(tr){return err(`wasm streaming compile failed: ${tr}`),err("falling back to ArrayBuffer instantiation"),instantiateArrayBuffer(e,I,oe)})}):instantiateArrayBuffer(e,I,oe)}function getWasmImports(){return{env:wasmImports,wasi_snapshot_preview1:wasmImports,"GOT.mem":new Proxy(wasmImports,GOTHandler),"GOT.func":new Proxy(wasmImports,GOTHandler)}}function createWasm(){var ae=getWasmImports();function e(oe,ue){wasmExports=oe.exports,wasmExports=relocateExports(wasmExports,67108864);var bt=getDylinkMetadata(ue);return bt.neededDynlibs&&(dynamicLibraries=bt.neededDynlibs.concat(dynamicLibraries)),mergeLibSymbols(wasmExports),LDSO.init(),loadDylibs(),addOnInit(wasmExports.__wasm_call_ctors),__RELOC_FUNCS__.push(wasmExports.__wasm_apply_data_relocs),removeRunDependency(),wasmExports}addRunDependency();function I(oe){e(oe.instance,oe.module)}if(Module.instantiateWasm)try{return Module.instantiateWasm(ae,e)}catch(oe){err(`Module.instantiateWasm callback failed with error: ${oe}`),readyPromiseReject(oe)}return wasmBinaryFile??=findWasmBinary(),instantiateAsync(wasmBinary,wasmBinaryFile,ae,I).catch(readyPromiseReject),{}}var ASM_CONSTS={69124656:ae=>{Module.is_worker=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Module.FD_BUFFER_MAX=ae,Module.emscripten_copy_to=console.warn},69124829:()=>{Module.postMessage=function(e){console.log("# 1252: onCustomMessage:",__FILE__,e)}},69124954:()=>{if(Module.is_worker){let ae=function(e){console.log("onCustomMessage:",e)};Module.onCustomMessage=ae}else Module.postMessage=function(e){switch(e.type){case"raw":{stringToUTF8(e.data,shm_rawinput,Module.FD_BUFFER_MAX);break}case"stdin":{stringToUTF8(e.data,1,Module.FD_BUFFER_MAX);break}case"rcon":{stringToUTF8(e.data,shm_rcon,Module.FD_BUFFER_MAX);break}default:console.warn("custom_postMessage?",e)}}}};function is_web_env(){try{if(window)return 1}catch{return 0}}is_web_env.sig="i";function ExitStatus(ae){this.name="ExitStatus",this.message=`Program terminated with exit(${ae})`,this.status=ae}var GOT={},currentModuleWeakSymbols=new Set([]),GOTHandler={get(ae,e){var I=GOT[e];return I||(I=GOT[e]=new WebAssembly.Global({value:"i32",mutable:!0})),currentModuleWeakSymbols.has(e)||(I.required=!0),I}},callRuntimeCallbacks=ae=>{for(;ae.length>0;)ae.shift()(Module)},UTF8Decoder=typeof TextDecoder<"u"?new TextDecoder:void 0,UTF8ArrayToString=(ae,e,I)=>{for(var oe=e+I,ue=e;ae[ue]&&!(ue>=oe);)++ue;if(ue-e>16&&ae.buffer&&UTF8Decoder)return UTF8Decoder.decode(ae.subarray(e,ue));for(var bt="";e<ue;){var tr=ae[e++];if(!(tr&128)){bt+=String.fromCharCode(tr);continue}var rr=ae[e++]&63;if((tr&224)==192){bt+=String.fromCharCode((tr&31)<<6|rr);continue}var ir=ae[e++]&63;if((tr&240)==224?tr=(tr&15)<<12|rr<<6|ir:tr=(tr&7)<<18|rr<<12|ir<<6|ae[e++]&63,tr<65536)bt+=String.fromCharCode(tr);else{var lr=tr-65536;bt+=String.fromCharCode(55296|lr>>10,56320|lr&1023)}}return bt},getDylinkMetadata=ae=>{var e=0,I=0;function oe(){return ae[e++]}function ue(){for(var zr=0,Ir=1;;){var Or=ae[e++];if(zr+=(Or&127)*Ir,Ir*=128,!(Or&128))break}return zr}function bt(){var zr=ue();return e+=zr,UTF8ArrayToString(ae,e-zr,zr)}function tr(zr,Ir){if(zr)throw new Error(Ir)}var rr="dylink.0";if(ae instanceof WebAssembly.Module){var ir=WebAssembly.Module.customSections(ae,rr);ir.length===0&&(rr="dylink",ir=WebAssembly.Module.customSections(ae,rr)),tr(ir.length===0,"need dylink section"),ae=new Uint8Array(ir[0]),I=ae.length}else{var lr=new Uint32Array(new Uint8Array(ae.subarray(0,24)).buffer),dr=lr[0]==1836278016;tr(!dr,"need to see wasm magic number"),tr(ae[8]!==0,"need the dylink section to be first"),e=9;var pr=ue();I=e+pr,rr=bt()}var hr={neededDynlibs:[],tlsExports:new Set,weakImports:new Set};if(rr=="dylink"){hr.memorySize=ue(),hr.memoryAlign=ue(),hr.tableSize=ue(),hr.tableAlign=ue();for(var _r=ue(),yr=0;yr<_r;++yr){var wr=bt();hr.neededDynlibs.push(wr)}}else{tr(rr!=="dylink.0");for(var Tr=1,Ar=2,Sr=3,Mr=4,vr=256,Lr=3,es=1;e<I;){var ss=oe(),os=ue();if(ss===Tr)hr.memorySize=ue(),hr.memoryAlign=ue(),hr.tableSize=ue(),hr.tableAlign=ue();else if(ss===Ar)for(var _r=ue(),yr=0;yr<_r;++yr)wr=bt(),hr.neededDynlibs.push(wr);else if(ss===Sr)for(var $r=ue();$r--;){var ns=bt(),Nr=ue();Nr&vr&&hr.tlsExports.add(ns)}else if(ss===Mr)for(var $r=ue();$r--;){bt();var ns=bt(),Nr=ue();(Nr&Lr)==es&&hr.weakImports.add(ns)}else e+=os}}return hr};function getValue(ae,e="i8"){switch(e.endsWith("*")&&(e="*"),e){case"i1":return HEAP8[ae];case"i8":return HEAP8[ae];case"i16":return HEAP16[ae>>1];case"i32":return HEAP32[ae>>2];case"i64":return HEAP64[ae>>3];case"float":return HEAPF32[ae>>2];case"double":return HEAPF64[ae>>3];case"*":return HEAPU32[ae>>2];default:abort(`invalid type for getValue: ${e}`)}}var newDSO=(ae,e,I)=>{var oe={refcount:1/0,name:ae,exports:I,global:!0};return LDSO.loadedLibsByName[ae]=oe,e!=null&&(LDSO.loadedLibsByHandle[e]=oe),oe},LDSO={loadedLibsByName:{},loadedLibsByHandle:{},init(){newDSO("__main__",0,wasmImports)}},___heap_base=73476080,alignMemory=(ae,e)=>Math.ceil(ae/e)*e,getMemory=ae=>{if(runtimeInitialized)return _calloc(ae,1);var e=___heap_base,I=e+alignMemory(ae,16);return ___heap_base=I,GOT.__heap_base.value=I,e},isInternalSym=ae=>["__cpp_exception","__c_longjmp","__wasm_apply_data_relocs","__dso_handle","__tls_size","__tls_align","__set_stack_limits","_emscripten_tls_init","__wasm_init_tls","__wasm_call_ctors","__start_em_asm","__stop_em_asm","__start_em_js","__stop_em_js"].includes(ae)||ae.startsWith("__em_js__"),uleb128Encode=(ae,e)=>{ae<128?e.push(ae):e.push(ae%128|128,ae>>7)},sigToWasmTypes=ae=>{for(var e={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},I={parameters:[],results:ae[0]=="v"?[]:[e[ae[0]]]},oe=1;oe<ae.length;++oe)I.parameters.push(e[ae[oe]]);return I},generateFuncType=(ae,e)=>{var I=ae.slice(0,1),oe=ae.slice(1),ue={i:127,p:127,j:126,f:125,d:124,e:111};e.push(96),uleb128Encode(oe.length,e);for(var bt=0;bt<oe.length;++bt)e.push(ue[oe[bt]]);I=="v"?e.push(0):e.push(1,ue[I])},convertJsFunctionToWasm=(ae,e)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(sigToWasmTypes(e),ae);var I=[1];generateFuncType(e,I);var oe=[0,97,115,109,1,0,0,0,1];uleb128Encode(I.length,oe),oe.push(...I),oe.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var ue=new WebAssembly.Module(new Uint8Array(oe)),bt=new WebAssembly.Instance(ue,{e:{f:ae}}),tr=bt.exports.f;return tr},wasmTableMirror=[],wasmTable=new WebAssembly.Table({initial:5358,element:"anyfunc"}),getWasmTableEntry=ae=>{var e=wasmTableMirror[ae];return e||(ae>=wasmTableMirror.length&&(wasmTableMirror.length=ae+1),wasmTableMirror[ae]=e=wasmTable.get(ae)),e},updateTableMap=(ae,e)=>{if(functionsInTableMap)for(var I=ae;I<ae+e;I++){var oe=getWasmTableEntry(I);oe&&functionsInTableMap.set(oe,I)}},functionsInTableMap,getFunctionAddress=ae=>(functionsInTableMap||(functionsInTableMap=new WeakMap,updateTableMap(0,wasmTable.length)),functionsInTableMap.get(ae)||0),freeTableIndexes=[],getEmptyTableSlot=()=>{if(freeTableIndexes.length)return freeTableIndexes.pop();try{wasmTable.grow(1)}catch(ae){throw ae instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":ae}return wasmTable.length-1},setWasmTableEntry=(ae,e)=>{wasmTable.set(ae,e),wasmTableMirror[ae]=wasmTable.get(ae)},addFunction=(ae,e)=>{var I=getFunctionAddress(ae);if(I)return I;var oe=getEmptyTableSlot();try{setWasmTableEntry(oe,ae)}catch(bt){if(!(bt instanceof TypeError))throw bt;var ue=convertJsFunctionToWasm(ae,e);setWasmTableEntry(oe,ue)}return functionsInTableMap.set(ae,oe),oe},updateGOT=(ae,e)=>{for(var I in ae)if(!isInternalSym(I)){var oe=ae[I];GOT[I]||=new WebAssembly.Global({value:"i32",mutable:!0}),GOT[I].value==0&&(typeof oe=="function"?GOT[I].value=addFunction(oe):typeof oe=="number"?GOT[I].value=oe:err(`unhandled export type for '${I}': ${typeof oe}`))}},relocateExports=(ae,e,I)=>{var oe={};for(var ue in ae){var bt=ae[ue];typeof bt=="object"&&(bt=bt.value),typeof bt=="number"&&(bt+=e),oe[ue]=bt}return updateGOT(oe),oe},isSymbolDefined=ae=>{var e=wasmImports[ae];return!(!e||e.stub)},dynCall=(ae,e,I=[])=>{var oe=getWasmTableEntry(e)(...I);return oe},stackSave=()=>_emscripten_stack_get_current(),stackRestore=ae=>__emscripten_stack_restore(ae),createInvokeFunction=ae=>(e,...I)=>{var oe=stackSave();try{return dynCall(ae,e,I)}catch(ue){if(stackRestore(oe),ue!==ue+0)throw ue;if(_setThrew(1,0),ae[0]=="j")return 0n}},resolveGlobalSymbol=(ae,e=!1)=>{var I;return isSymbolDefined(ae)?I=wasmImports[ae]:ae.startsWith("invoke_")&&(I=wasmImports[ae]=createInvokeFunction(ae.split("_")[1])),{sym:I,name:ae}},UTF8ToString=(ae,e)=>ae?UTF8ArrayToString(HEAPU8,ae,e):"",loadWebAssemblyModule=(binary,flags,libName,localScope,handle)=>{var metadata=getDylinkMetadata(binary);currentModuleWeakSymbols=metadata.weakImports;function loadModule(){var firstLoad=!handle||!HEAP8[handle+8];if(firstLoad){var memAlign=Math.pow(2,metadata.memoryAlign),memoryBase=metadata.memorySize?alignMemory(getMemory(metadata.memorySize+memAlign),memAlign):0,tableBase=metadata.tableSize?wasmTable.length:0;handle&&(HEAP8[handle+8]=1,HEAPU32[handle+12>>2]=memoryBase,HEAP32[handle+16>>2]=metadata.memorySize,HEAPU32[handle+20>>2]=tableBase,HEAP32[handle+24>>2]=metadata.tableSize)}else memoryBase=HEAPU32[handle+12>>2],tableBase=HEAPU32[handle+20>>2];var tableGrowthNeeded=tableBase+metadata.tableSize-wasmTable.length;tableGrowthNeeded>0&&wasmTable.grow(tableGrowthNeeded);var moduleExports;function resolveSymbol(ae){var e=resolveGlobalSymbol(ae).sym;return!e&&localScope&&(e=localScope[ae]),e||(e=moduleExports[ae]),e}var proxyHandler={get(ae,e){switch(e){case"__memory_base":return memoryBase;case"__table_base":return tableBase}if(e in wasmImports&&!wasmImports[e].stub)return wasmImports[e];if(!(e in ae)){var I;ae[e]=(...oe)=>(I||=resolveSymbol(e),I(...oe))}return ae[e]}},proxy=new Proxy({},proxyHandler),info={"GOT.mem":new Proxy({},GOTHandler),"GOT.func":new Proxy({},GOTHandler),env:proxy,wasi_snapshot_preview1:proxy};function postInstantiation(module,instance){updateTableMap(tableBase,metadata.tableSize),moduleExports=relocateExports(instance.exports,memoryBase),flags.allowUndefined||reportUndefinedSymbols();function addEmAsm(addr,body){for(var args=[],arity=0;arity<16&&body.indexOf("$"+arity)!=-1;arity++)args.push("$"+arity);args=args.join(",");var func=`(${args}) => { ${body} };`;ASM_CONSTS[start]=eval(func)}if("__start_em_asm"in moduleExports)for(var start=moduleExports.__start_em_asm,stop=moduleExports.__stop_em_asm;start<stop;){var jsString=UTF8ToString(start);addEmAsm(start,jsString),start=HEAPU8.indexOf(0,start)+1}function addEmJs(name,cSig,body){var jsArgs=[];if(cSig=cSig.slice(1,-1),cSig!="void"){cSig=cSig.split(",");for(var i in cSig){var jsArg=cSig[i].split(" ").pop();jsArgs.push(jsArg.replaceAll("*",""))}}var func=`(${jsArgs}) => ${body};`;moduleExports[name]=eval(func)}for(var name in moduleExports)if(name.startsWith("__em_js__")){var start=moduleExports[name],jsString=UTF8ToString(start),parts=jsString.split("<::>");addEmJs(name.replace("__em_js__",""),parts[0],parts[1]),delete moduleExports[name]}var applyRelocs=moduleExports.__wasm_apply_data_relocs;applyRelocs&&(runtimeInitialized?applyRelocs():__RELOC_FUNCS__.push(applyRelocs));var init=moduleExports.__wasm_call_ctors;return init&&(runtimeInitialized?init():__ATINIT__.push(init)),moduleExports}if(flags.loadAsync){if(binary instanceof WebAssembly.Module){var instance=new WebAssembly.Instance(binary,info);return Promise.resolve(postInstantiation(binary,instance))}return WebAssembly.instantiate(binary,info).then(ae=>postInstantiation(ae.module,ae.instance))}var module=binary instanceof WebAssembly.Module?binary:new WebAssembly.Module(binary),instance=new WebAssembly.Instance(module,info);return postInstantiation(module,instance)}return flags.loadAsync?metadata.neededDynlibs.reduce((ae,e)=>ae.then(()=>loadDynamicLibrary(e,flags,localScope)),Promise.resolve()).then(loadModule):(metadata.neededDynlibs.forEach(ae=>loadDynamicLibrary(ae,flags,localScope)),loadModule())},mergeLibSymbols=(ae,e)=>{for(var[I,oe]of Object.entries(ae)){const ue=tr=>{isSymbolDefined(tr)||(wasmImports[tr]=oe)};ue(I);const bt="__main_argc_argv";I=="main"&&ue(bt),I==bt&&ue("main")}},asyncLoad=(ae,e,I,oe)=>{var ue=`al ${ae}`;readAsync(ae).then(bt=>{e(new Uint8Array(bt)),ue&&removeRunDependency()},bt=>{if(I)I();else throw`Loading data file "${ae}" failed.`}),ue&&addRunDependency()},preloadPlugins=Module.preloadPlugins||[],registerWasmPlugin=()=>{var ae={promiseChainEnd:Promise.resolve(),canHandle:e=>!Module.noWasmDecoding&&e.endsWith(".so"),handle:(e,I,oe,ue)=>{ae.promiseChainEnd=ae.promiseChainEnd.then(()=>loadWebAssemblyModule(e,{loadAsync:!0,nodelete:!0},I,{})).then(bt=>{preloadedWasm[I]=bt,oe(e)},bt=>{err(`failed to instantiate wasm: ${I}: ${bt}`),ue()})}};preloadPlugins.push(ae)},preloadedWasm={};function loadDynamicLibrary(ae,e={global:!0,nodelete:!0},I,oe){var ue=LDSO.loadedLibsByName[ae];if(ue)return e.global?ue.global||(ue.global=!0,mergeLibSymbols(ue.exports)):I&&Object.assign(I,ue.exports),e.nodelete&&ue.refcount!==1/0&&(ue.refcount=1/0),ue.refcount++,oe&&(LDSO.loadedLibsByHandle[oe]=ue),e.loadAsync?Promise.resolve(!0):!0;ue=newDSO(ae,oe,"loading"),ue.refcount=e.nodelete?1/0:1,ue.global=e.global;function bt(){if(oe){var ir=HEAPU32[oe+28>>2],lr=HEAPU32[oe+32>>2];if(ir&&lr){var dr=HEAP8.slice(ir,ir+lr);return e.loadAsync?Promise.resolve(dr):dr}}var pr=locateFile(ae);if(e.loadAsync)return new Promise((hr,_r)=>asyncLoad(pr,hr,_r));if(!readBinary)throw new Error(`${pr}: file not found, and synchronous loading of external files is not available`);return readBinary(pr)}function tr(){var ir=preloadedWasm[ae];return ir?e.loadAsync?Promise.resolve(ir):ir:e.loadAsync?bt().then(lr=>loadWebAssemblyModule(lr,e,ae,I,oe)):loadWebAssemblyModule(bt(),e,ae,I,oe)}function rr(ir){ue.global?mergeLibSymbols(ir):I&&Object.assign(I,ir),ue.exports=ir}return e.loadAsync?tr().then(ir=>(rr(ir),!0)):(rr(tr()),!0)}var reportUndefinedSymbols=()=>{for(var[ae,e]of Object.entries(GOT))if(e.value==0){var I=resolveGlobalSymbol(ae,!0).sym;if(!I&&!e.required)continue;if(typeof I=="function")e.value=addFunction(I,I.sig);else if(typeof I=="number")e.value=I;else throw new Error(`bad export type for '${ae}': ${typeof I}`)}},loadDylibs=()=>{if(!dynamicLibraries.length){reportUndefinedSymbols();return}addRunDependency(),dynamicLibraries.reduce((ae,e)=>ae.then(()=>loadDynamicLibrary(e,{loadAsync:!0,global:!0,nodelete:!0,allowUndefined:!0})),Promise.resolve()).then(()=>{reportUndefinedSymbols(),removeRunDependency()})},noExitRuntime=Module.noExitRuntime||!0;function setValue(ae,e,I="i8"){switch(I.endsWith("*")&&(I="*"),I){case"i1":HEAP8[ae]=e;break;case"i8":HEAP8[ae]=e;break;case"i16":HEAP16[ae>>1]=e;break;case"i32":HEAP32[ae>>2]=e;break;case"i64":HEAP64[ae>>3]=BigInt(e);break;case"float":HEAPF32[ae>>2]=e;break;case"double":HEAPF64[ae>>3]=e;break;case"*":HEAPU32[ae>>2]=e;break;default:abort(`invalid type for setValue: ${I}`)}}var ___assert_fail=(ae,e,I,oe)=>{abort(`Assertion failed: ${UTF8ToString(ae)}, at: `+[e?UTF8ToString(e):"unknown filename",I,oe?UTF8ToString(oe):"unknown function"])};___assert_fail.sig="vppip";var ___call_sighandler=(ae,e)=>getWasmTableEntry(ae)(e);___call_sighandler.sig="vpi";var ___memory_base=new WebAssembly.Global({value:"i32",mutable:!1},67108864),___stack_pointer=new WebAssembly.Global({value:"i32",mutable:!0},73476080),PATH={isAbs:ae=>ae.charAt(0)==="/",splitPath:ae=>{var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return e.exec(ae).slice(1)},normalizeArray:(ae,e)=>{for(var I=0,oe=ae.length-1;oe>=0;oe--){var ue=ae[oe];ue==="."?ae.splice(oe,1):ue===".."?(ae.splice(oe,1),I++):I&&(ae.splice(oe,1),I--)}if(e)for(;I;I--)ae.unshift("..");return ae},normalize:ae=>{var e=PATH.isAbs(ae),I=ae.substr(-1)==="/";return ae=PATH.normalizeArray(ae.split("/").filter(oe=>!!oe),!e).join("/"),!ae&&!e&&(ae="."),ae&&I&&(ae+="/"),(e?"/":"")+ae},dirname:ae=>{var e=PATH.splitPath(ae),I=e[0],oe=e[1];return!I&&!oe?".":(oe&&(oe=oe.substr(0,oe.length-1)),I+oe)},basename:ae=>{if(ae==="/")return"/";ae=PATH.normalize(ae),ae=ae.replace(/\/$/,"");var e=ae.lastIndexOf("/");return e===-1?ae:ae.substr(e+1)},join:(...ae)=>PATH.normalize(ae.join("/")),join2:(ae,e)=>PATH.normalize(ae+"/"+e)},initRandomFill=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return oe=>crypto.getRandomValues(oe);if(ENVIRONMENT_IS_NODE)try{var ae=require("crypto"),e=ae.randomFillSync;if(e)return oe=>ae.randomFillSync(oe);var I=ae.randomBytes;return oe=>(oe.set(I(oe.byteLength)),oe)}catch{}abort("initRandomDevice")},randomFill=ae=>(randomFill=initRandomFill())(ae),PATH_FS={resolve:(...ae)=>{for(var e="",I=!1,oe=ae.length-1;oe>=-1&&!I;oe--){var ue=oe>=0?ae[oe]:FS.cwd();if(typeof ue!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!ue)return"";e=ue+"/"+e,I=PATH.isAbs(ue)}return e=PATH.normalizeArray(e.split("/").filter(bt=>!!bt),!I).join("/"),(I?"/":"")+e||"."},relative:(ae,e)=>{ae=PATH_FS.resolve(ae).substr(1),e=PATH_FS.resolve(e).substr(1);function I(lr){for(var dr=0;dr<lr.length&&lr[dr]==="";dr++);for(var pr=lr.length-1;pr>=0&&lr[pr]==="";pr--);return dr>pr?[]:lr.slice(dr,pr-dr+1)}for(var oe=I(ae.split("/")),ue=I(e.split("/")),bt=Math.min(oe.length,ue.length),tr=bt,rr=0;rr<bt;rr++)if(oe[rr]!==ue[rr]){tr=rr;break}for(var ir=[],rr=tr;rr<oe.length;rr++)ir.push("..");return ir=ir.concat(ue.slice(tr)),ir.join("/")}},FS_stdin_getChar_buffer=[],lengthBytesUTF8=ae=>{for(var e=0,I=0;I<ae.length;++I){var oe=ae.charCodeAt(I);oe<=127?e++:oe<=2047?e+=2:oe>=55296&&oe<=57343?(e+=4,++I):e+=3}return e},stringToUTF8Array=(ae,e,I,oe)=>{if(!(oe>0))return 0;for(var ue=I,bt=I+oe-1,tr=0;tr<ae.length;++tr){var rr=ae.charCodeAt(tr);if(rr>=55296&&rr<=57343){var ir=ae.charCodeAt(++tr);rr=65536+((rr&1023)<<10)|ir&1023}if(rr<=127){if(I>=bt)break;e[I++]=rr}else if(rr<=2047){if(I+1>=bt)break;e[I++]=192|rr>>6,e[I++]=128|rr&63}else if(rr<=65535){if(I+2>=bt)break;e[I++]=224|rr>>12,e[I++]=128|rr>>6&63,e[I++]=128|rr&63}else{if(I+3>=bt)break;e[I++]=240|rr>>18,e[I++]=128|rr>>12&63,e[I++]=128|rr>>6&63,e[I++]=128|rr&63}}return e[I]=0,I-ue};function intArrayFromString(ae,e,I){var oe=lengthBytesUTF8(ae)+1,ue=new Array(oe),bt=stringToUTF8Array(ae,ue,0,ue.length);return ue.length=bt,ue}var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var ae=null;if(ENVIRONMENT_IS_NODE){var e=256,I=Buffer$7.alloc(e),oe=0,ue=process$1.stdin.fd;try{oe=fs.readSync(ue,I,0,e)}catch(bt){if(bt.toString().includes("EOF"))oe=0;else throw bt}oe>0&&(ae=I.slice(0,oe).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(ae=window.prompt("Input: "),ae!==null&&(ae+=`
`));if(!ae)return null;FS_stdin_getChar_buffer=intArrayFromString(ae)}return FS_stdin_getChar_buffer.shift()},TTY={ttys:[],init(){},shutdown(){},register(ae,e){TTY.ttys[ae]={input:[],output:[],ops:e},FS.registerDevice(ae,TTY.stream_ops)},stream_ops:{open(ae){var e=TTY.ttys[ae.node.rdev];if(!e)throw new FS.ErrnoError(43);ae.tty=e,ae.seekable=!1},close(ae){ae.tty.ops.fsync(ae.tty)},fsync(ae){ae.tty.ops.fsync(ae.tty)},read(ae,e,I,oe,ue){if(!ae.tty||!ae.tty.ops.get_char)throw new FS.ErrnoError(60);for(var bt=0,tr=0;tr<oe;tr++){var rr;try{rr=ae.tty.ops.get_char(ae.tty)}catch{throw new FS.ErrnoError(29)}if(rr===void 0&&bt===0)throw new FS.ErrnoError(6);if(rr==null)break;bt++,e[I+tr]=rr}return bt&&(ae.node.timestamp=Date.now()),bt},write(ae,e,I,oe,ue){if(!ae.tty||!ae.tty.ops.put_char)throw new FS.ErrnoError(60);try{for(var bt=0;bt<oe;bt++)ae.tty.ops.put_char(ae.tty,e[I+bt])}catch{throw new FS.ErrnoError(29)}return oe&&(ae.node.timestamp=Date.now()),bt}},default_tty_ops:{get_char(ae){return FS_stdin_getChar()},put_char(ae,e){e===null||e===10?(out(UTF8ArrayToString(ae.output,0)),ae.output=[]):e!=0&&ae.output.push(e)},fsync(ae){ae.output&&ae.output.length>0&&(out(UTF8ArrayToString(ae.output,0)),ae.output=[])},ioctl_tcgets(ae){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(ae,e,I){return 0},ioctl_tiocgwinsz(ae){return[24,80]}},default_tty1_ops:{put_char(ae,e){e===null||e===10?(err(UTF8ArrayToString(ae.output,0)),ae.output=[]):e!=0&&ae.output.push(e)},fsync(ae){ae.output&&ae.output.length>0&&(err(UTF8ArrayToString(ae.output,0)),ae.output=[])}}},zeroMemory=(ae,e)=>(HEAPU8.fill(0,ae,ae+e),ae),mmapAlloc=ae=>{ae=alignMemory(ae,65536);var e=_emscripten_builtin_memalign(65536,ae);return e?zeroMemory(e,ae):0},MEMFS={ops_table:null,mount(ae){return MEMFS.createNode(null,"/",16895,0)},createNode(ae,e,I,oe){if(FS.isBlkdev(I)||FS.isFIFO(I))throw new FS.ErrnoError(63);MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var ue=FS.createNode(ae,e,I,oe);return FS.isDir(ue.mode)?(ue.node_ops=MEMFS.ops_table.dir.node,ue.stream_ops=MEMFS.ops_table.dir.stream,ue.contents={}):FS.isFile(ue.mode)?(ue.node_ops=MEMFS.ops_table.file.node,ue.stream_ops=MEMFS.ops_table.file.stream,ue.usedBytes=0,ue.contents=null):FS.isLink(ue.mode)?(ue.node_ops=MEMFS.ops_table.link.node,ue.stream_ops=MEMFS.ops_table.link.stream):FS.isChrdev(ue.mode)&&(ue.node_ops=MEMFS.ops_table.chrdev.node,ue.stream_ops=MEMFS.ops_table.chrdev.stream),ue.timestamp=Date.now(),ae&&(ae.contents[e]=ue,ae.timestamp=ue.timestamp),ue},getFileDataAsTypedArray(ae){return ae.contents?ae.contents.subarray?ae.contents.subarray(0,ae.usedBytes):new Uint8Array(ae.contents):new Uint8Array(0)},expandFileStorage(ae,e){var I=ae.contents?ae.contents.length:0;if(!(I>=e)){var oe=1024*1024;e=Math.max(e,I*(I<oe?2:1.125)>>>0),I!=0&&(e=Math.max(e,256));var ue=ae.contents;ae.contents=new Uint8Array(e),ae.usedBytes>0&&ae.contents.set(ue.subarray(0,ae.usedBytes),0)}},resizeFileStorage(ae,e){if(ae.usedBytes!=e)if(e==0)ae.contents=null,ae.usedBytes=0;else{var I=ae.contents;ae.contents=new Uint8Array(e),I&&ae.contents.set(I.subarray(0,Math.min(e,ae.usedBytes))),ae.usedBytes=e}},node_ops:{getattr(ae){var e={};return e.dev=FS.isChrdev(ae.mode)?ae.id:1,e.ino=ae.id,e.mode=ae.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=ae.rdev,FS.isDir(ae.mode)?e.size=4096:FS.isFile(ae.mode)?e.size=ae.usedBytes:FS.isLink(ae.mode)?e.size=ae.link.length:e.size=0,e.atime=new Date(ae.timestamp),e.mtime=new Date(ae.timestamp),e.ctime=new Date(ae.timestamp),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr(ae,e){e.mode!==void 0&&(ae.mode=e.mode),e.timestamp!==void 0&&(ae.timestamp=e.timestamp),e.size!==void 0&&MEMFS.resizeFileStorage(ae,e.size)},lookup(ae,e){throw FS.genericErrors[44]},mknod(ae,e,I,oe){return MEMFS.createNode(ae,e,I,oe)},rename(ae,e,I){if(FS.isDir(ae.mode)){var oe;try{oe=FS.lookupNode(e,I)}catch{}if(oe)for(var ue in oe.contents)throw new FS.ErrnoError(55)}delete ae.parent.contents[ae.name],ae.parent.timestamp=Date.now(),ae.name=I,e.contents[I]=ae,e.timestamp=ae.parent.timestamp},unlink(ae,e){delete ae.contents[e],ae.timestamp=Date.now()},rmdir(ae,e){var I=FS.lookupNode(ae,e);for(var oe in I.contents)throw new FS.ErrnoError(55);delete ae.contents[e],ae.timestamp=Date.now()},readdir(ae){var e=[".",".."];for(var I of Object.keys(ae.contents))e.push(I);return e},symlink(ae,e,I){var oe=MEMFS.createNode(ae,e,41471,0);return oe.link=I,oe},readlink(ae){if(!FS.isLink(ae.mode))throw new FS.ErrnoError(28);return ae.link}},stream_ops:{read(ae,e,I,oe,ue){var bt=ae.node.contents;if(ue>=ae.node.usedBytes)return 0;var tr=Math.min(ae.node.usedBytes-ue,oe);if(tr>8&&bt.subarray)e.set(bt.subarray(ue,ue+tr),I);else for(var rr=0;rr<tr;rr++)e[I+rr]=bt[ue+rr];return tr},write(ae,e,I,oe,ue,bt){if(e.buffer===HEAP8.buffer&&(bt=!1),!oe)return 0;var tr=ae.node;if(tr.timestamp=Date.now(),e.subarray&&(!tr.contents||tr.contents.subarray)){if(bt)return tr.contents=e.subarray(I,I+oe),tr.usedBytes=oe,oe;if(tr.usedBytes===0&&ue===0)return tr.contents=e.slice(I,I+oe),tr.usedBytes=oe,oe;if(ue+oe<=tr.usedBytes)return tr.contents.set(e.subarray(I,I+oe),ue),oe}if(MEMFS.expandFileStorage(tr,ue+oe),tr.contents.subarray&&e.subarray)tr.contents.set(e.subarray(I,I+oe),ue);else for(var rr=0;rr<oe;rr++)tr.contents[ue+rr]=e[I+rr];return tr.usedBytes=Math.max(tr.usedBytes,ue+oe),oe},llseek(ae,e,I){var oe=e;if(I===1?oe+=ae.position:I===2&&FS.isFile(ae.node.mode)&&(oe+=ae.node.usedBytes),oe<0)throw new FS.ErrnoError(28);return oe},allocate(ae,e,I){MEMFS.expandFileStorage(ae.node,e+I),ae.node.usedBytes=Math.max(ae.node.usedBytes,e+I)},mmap(ae,e,I,oe,ue){if(!FS.isFile(ae.node.mode))throw new FS.ErrnoError(43);var bt,tr,rr=ae.node.contents;if(!(ue&2)&&rr&&rr.buffer===HEAP8.buffer)tr=!1,bt=rr.byteOffset;else{if(tr=!0,bt=mmapAlloc(e),!bt)throw new FS.ErrnoError(48);rr&&((I>0||I+e<rr.length)&&(rr.subarray?rr=rr.subarray(I,I+e):rr=Array.prototype.slice.call(rr,I,I+e)),HEAP8.set(rr,bt))}return{ptr:bt,allocated:tr}},msync(ae,e,I,oe,ue){return MEMFS.stream_ops.write(ae,e,0,oe,I,!1),0}}},FS_createDataFile=(ae,e,I,oe,ue,bt)=>{FS.createDataFile(ae,e,I,oe,ue,bt)},FS_handledByPreloadPlugin=(ae,e,I,oe)=>{typeof Browser<"u"&&Browser.init();var ue=!1;return preloadPlugins.forEach(bt=>{ue||bt.canHandle(e)&&(bt.handle(ae,e,I,oe),ue=!0)}),ue},FS_createPreloadedFile=(ae,e,I,oe,ue,bt,tr,rr,ir,lr)=>{var dr=e?PATH_FS.resolve(PATH.join2(ae,e)):ae;function pr(hr){function _r(yr){lr?.(),rr||FS_createDataFile(ae,e,yr,oe,ue,ir),bt?.(),removeRunDependency()}FS_handledByPreloadPlugin(hr,dr,_r,()=>{tr?.(),removeRunDependency()})||_r(hr)}addRunDependency(),typeof I=="string"?asyncLoad(I,pr,tr):pr(I)},FS_modeStringToFlags=ae=>{var e={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},I=e[ae];if(typeof I>"u")throw new Error(`Unknown file open mode: ${ae}`);return I},FS_getMode=(ae,e)=>{var I=0;return ae&&(I|=365),e&&(I|=146),I},IDBFS={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var ae=null;return typeof window=="object"&&(ae=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),ae},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",queuePersist:ae=>{function e(){ae.idbPersistState==="again"?I():ae.idbPersistState=0}function I(){ae.idbPersistState="idb",IDBFS.syncfs(ae,!1,e)}ae.idbPersistState?ae.idbPersistState==="idb"&&(ae.idbPersistState="again"):ae.idbPersistState=setTimeout(I,0)},mount:ae=>{var e=MEMFS.mount(ae);if(ae?.opts?.autoPersist){e.idbPersistState=0;var I=e.node_ops;e.node_ops=Object.assign({},e.node_ops),e.node_ops.mknod=(oe,ue,bt,tr)=>{var rr=I.mknod(oe,ue,bt,tr);return rr.node_ops=e.node_ops,rr.idbfs_mount=e.mount,rr.memfs_stream_ops=rr.stream_ops,rr.stream_ops=Object.assign({},rr.stream_ops),rr.stream_ops.write=(ir,lr,dr,pr,hr,_r)=>(ir.node.isModified=!0,rr.memfs_stream_ops.write(ir,lr,dr,pr,hr,_r)),rr.stream_ops.close=ir=>{var lr=ir.node;if(lr.isModified&&(IDBFS.queuePersist(lr.idbfs_mount),lr.isModified=!1),lr.memfs_stream_ops.close)return lr.memfs_stream_ops.close(ir)},rr},e.node_ops.mkdir=(...oe)=>(IDBFS.queuePersist(e.mount),I.mkdir(...oe)),e.node_ops.rmdir=(...oe)=>(IDBFS.queuePersist(e.mount),I.rmdir(...oe)),e.node_ops.symlink=(...oe)=>(IDBFS.queuePersist(e.mount),I.symlink(...oe)),e.node_ops.unlink=(...oe)=>(IDBFS.queuePersist(e.mount),I.unlink(...oe)),e.node_ops.rename=(...oe)=>(IDBFS.queuePersist(e.mount),I.rename(...oe))}return e},syncfs:(ae,e,I)=>{IDBFS.getLocalSet(ae,(oe,ue)=>{if(oe)return I(oe);IDBFS.getRemoteSet(ae,(bt,tr)=>{if(bt)return I(bt);var rr=e?tr:ue,ir=e?ue:tr;IDBFS.reconcile(rr,ir,I)})})},quit:()=>{Object.values(IDBFS.dbs).forEach(ae=>ae.close()),IDBFS.dbs={}},getDB:(ae,e)=>{var I=IDBFS.dbs[ae];if(I)return e(null,I);var oe;try{oe=IDBFS.indexedDB().open(ae,IDBFS.DB_VERSION)}catch(ue){return e(ue)}if(!oe)return e("Unable to connect to IndexedDB");oe.onupgradeneeded=ue=>{var bt=ue.target.result,tr=ue.target.transaction,rr;bt.objectStoreNames.contains(IDBFS.DB_STORE_NAME)?rr=tr.objectStore(IDBFS.DB_STORE_NAME):rr=bt.createObjectStore(IDBFS.DB_STORE_NAME),rr.indexNames.contains("timestamp")||rr.createIndex("timestamp","timestamp",{unique:!1})},oe.onsuccess=()=>{I=oe.result,IDBFS.dbs[ae]=I,e(null,I)},oe.onerror=ue=>{e(ue.target.error),ue.preventDefault()}},getLocalSet:(ae,e)=>{var I={};function oe(ir){return ir!=="."&&ir!==".."}function ue(ir){return lr=>PATH.join2(ir,lr)}for(var bt=FS.readdir(ae.mountpoint).filter(oe).map(ue(ae.mountpoint));bt.length;){var tr=bt.pop(),rr;try{rr=FS.stat(tr)}catch(ir){return e(ir)}FS.isDir(rr.mode)&&bt.push(...FS.readdir(tr).filter(oe).map(ue(tr))),I[tr]={timestamp:rr.mtime}}return e(null,{type:"local",entries:I})},getRemoteSet:(ae,e)=>{var I={};IDBFS.getDB(ae.mountpoint,(oe,ue)=>{if(oe)return e(oe);try{var bt=ue.transaction([IDBFS.DB_STORE_NAME],"readonly");bt.onerror=ir=>{e(ir.target.error),ir.preventDefault()};var tr=bt.objectStore(IDBFS.DB_STORE_NAME),rr=tr.index("timestamp");rr.openKeyCursor().onsuccess=ir=>{var lr=ir.target.result;if(!lr)return e(null,{type:"remote",db:ue,entries:I});I[lr.primaryKey]={timestamp:lr.key},lr.continue()}}catch(ir){return e(ir)}})},loadLocalEntry:(ae,e)=>{var I,oe;try{var ue=FS.lookupPath(ae);oe=ue.node,I=FS.stat(ae)}catch(bt){return e(bt)}return FS.isDir(I.mode)?e(null,{timestamp:I.mtime,mode:I.mode}):FS.isFile(I.mode)?(oe.contents=MEMFS.getFileDataAsTypedArray(oe),e(null,{timestamp:I.mtime,mode:I.mode,contents:oe.contents})):e(new Error("node type not supported"))},storeLocalEntry:(ae,e,I)=>{try{if(FS.isDir(e.mode))FS.mkdirTree(ae,e.mode);else if(FS.isFile(e.mode))FS.writeFile(ae,e.contents,{canOwn:!0});else return I(new Error("node type not supported"));FS.chmod(ae,e.mode),FS.utime(ae,e.timestamp,e.timestamp)}catch(oe){return I(oe)}I(null)},removeLocalEntry:(ae,e)=>{try{var I=FS.stat(ae);FS.isDir(I.mode)?FS.rmdir(ae):FS.isFile(I.mode)&&FS.unlink(ae)}catch(oe){return e(oe)}e(null)},loadRemoteEntry:(ae,e,I)=>{var oe=ae.get(e);oe.onsuccess=ue=>I(null,ue.target.result),oe.onerror=ue=>{I(ue.target.error),ue.preventDefault()}},storeRemoteEntry:(ae,e,I,oe)=>{try{var ue=ae.put(I,e)}catch(bt){oe(bt);return}ue.onsuccess=bt=>oe(),ue.onerror=bt=>{oe(bt.target.error),bt.preventDefault()}},removeRemoteEntry:(ae,e,I)=>{var oe=ae.delete(e);oe.onsuccess=ue=>I(),oe.onerror=ue=>{I(ue.target.error),ue.preventDefault()}},reconcile:(ae,e,I)=>{var oe=0,ue=[];Object.keys(ae.entries).forEach(pr=>{var hr=ae.entries[pr],_r=e.entries[pr];(!_r||hr.timestamp.getTime()!=_r.timestamp.getTime())&&(ue.push(pr),oe++)});var bt=[];if(Object.keys(e.entries).forEach(pr=>{ae.entries[pr]||(bt.push(pr),oe++)}),!oe)return I(null);var tr=!1,rr=ae.type==="remote"?ae.db:e.db,ir=rr.transaction([IDBFS.DB_STORE_NAME],"readwrite"),lr=ir.objectStore(IDBFS.DB_STORE_NAME);function dr(pr){if(pr&&!tr)return tr=!0,I(pr)}ir.onerror=ir.onabort=pr=>{dr(pr.target.error),pr.preventDefault()},ir.oncomplete=pr=>{tr||I(null)},ue.sort().forEach(pr=>{e.type==="local"?IDBFS.loadRemoteEntry(lr,pr,(hr,_r)=>{if(hr)return dr(hr);IDBFS.storeLocalEntry(pr,_r,dr)}):IDBFS.loadLocalEntry(pr,(hr,_r)=>{if(hr)return dr(hr);IDBFS.storeRemoteEntry(lr,pr,_r,dr)})}),bt.sort().reverse().forEach(pr=>{e.type==="local"?IDBFS.removeLocalEntry(pr,dr):IDBFS.removeRemoteEntry(lr,pr,dr)})}},ERRNO_CODES={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},NODEFS={isWindows:!1,staticInit(){NODEFS.isWindows=!!process$1.platform.match(/^win/);var ae=process$1.binding("constants");ae.fs&&(ae=ae.fs),NODEFS.flagsForNodeMap={1024:ae.O_APPEND,64:ae.O_CREAT,128:ae.O_EXCL,256:ae.O_NOCTTY,0:ae.O_RDONLY,2:ae.O_RDWR,4096:ae.O_SYNC,512:ae.O_TRUNC,1:ae.O_WRONLY,131072:ae.O_NOFOLLOW}},convertNodeCode(ae){var e=ae.code;return ERRNO_CODES[e]},tryFSOperation(ae){try{return ae()}catch(e){throw e.code?e.code==="UNKNOWN"?new FS.ErrnoError(28):new FS.ErrnoError(NODEFS.convertNodeCode(e)):e}},mount(ae){return NODEFS.createNode(null,"/",NODEFS.getMode(ae.opts.root),0)},createNode(ae,e,I,oe){if(!FS.isDir(I)&&!FS.isFile(I)&&!FS.isLink(I))throw new FS.ErrnoError(28);var ue=FS.createNode(ae,e,I);return ue.node_ops=NODEFS.node_ops,ue.stream_ops=NODEFS.stream_ops,ue},getMode(ae){var e;return NODEFS.tryFSOperation(()=>(e=fs.lstatSync(ae),NODEFS.isWindows&&(e.mode|=(e.mode&292)>>2),e.mode))},realPath(ae){for(var e=[];ae.parent!==ae;)e.push(ae.name),ae=ae.parent;return e.push(ae.mount.opts.root),e.reverse(),PATH.join(...e)},flagsForNode(ae){ae&=-2097153,ae&=-2049,ae&=-32769,ae&=-524289,ae&=-65537;var e=0;for(var I in NODEFS.flagsForNodeMap)ae&I&&(e|=NODEFS.flagsForNodeMap[I],ae^=I);if(ae)throw new FS.ErrnoError(28);return e},node_ops:{getattr(ae){var e=NODEFS.realPath(ae),I;return NODEFS.tryFSOperation(()=>I=fs.lstatSync(e)),NODEFS.isWindows&&(I.blksize||(I.blksize=4096),I.blocks||(I.blocks=(I.size+I.blksize-1)/I.blksize|0),I.mode|=(I.mode&292)>>2),{dev:I.dev,ino:I.ino,mode:I.mode,nlink:I.nlink,uid:I.uid,gid:I.gid,rdev:I.rdev,size:I.size,atime:I.atime,mtime:I.mtime,ctime:I.ctime,blksize:I.blksize,blocks:I.blocks}},setattr(ae,e){var I=NODEFS.realPath(ae);NODEFS.tryFSOperation(()=>{if(e.mode!==void 0&&(fs.chmodSync(I,e.mode),ae.mode=e.mode),e.timestamp!==void 0){var oe=new Date(e.timestamp);fs.utimesSync(I,oe,oe)}e.size!==void 0&&fs.truncateSync(I,e.size)})},lookup(ae,e){var I=PATH.join2(NODEFS.realPath(ae),e),oe=NODEFS.getMode(I);return NODEFS.createNode(ae,e,oe)},mknod(ae,e,I,oe){var ue=NODEFS.createNode(ae,e,I,oe),bt=NODEFS.realPath(ue);return NODEFS.tryFSOperation(()=>{FS.isDir(ue.mode)?fs.mkdirSync(bt,ue.mode):fs.writeFileSync(bt,"",{mode:ue.mode})}),ue},rename(ae,e,I){var oe=NODEFS.realPath(ae),ue=PATH.join2(NODEFS.realPath(e),I);NODEFS.tryFSOperation(()=>fs.renameSync(oe,ue)),ae.name=I},unlink(ae,e){var I=PATH.join2(NODEFS.realPath(ae),e);NODEFS.tryFSOperation(()=>fs.unlinkSync(I))},rmdir(ae,e){var I=PATH.join2(NODEFS.realPath(ae),e);NODEFS.tryFSOperation(()=>fs.rmdirSync(I))},readdir(ae){var e=NODEFS.realPath(ae);return NODEFS.tryFSOperation(()=>fs.readdirSync(e))},symlink(ae,e,I){var oe=PATH.join2(NODEFS.realPath(ae),e);NODEFS.tryFSOperation(()=>fs.symlinkSync(I,oe))},readlink(ae){var e=NODEFS.realPath(ae);return NODEFS.tryFSOperation(()=>fs.readlinkSync(e))}},stream_ops:{open(ae){var e=NODEFS.realPath(ae.node);NODEFS.tryFSOperation(()=>{FS.isFile(ae.node.mode)&&(ae.shared.refcount=1,ae.nfd=fs.openSync(e,NODEFS.flagsForNode(ae.flags)))})},close(ae){NODEFS.tryFSOperation(()=>{FS.isFile(ae.node.mode)&&ae.nfd&&--ae.shared.refcount===0&&fs.closeSync(ae.nfd)})},dup(ae){ae.shared.refcount++},read(ae,e,I,oe,ue){return oe===0?0:NODEFS.tryFSOperation(()=>fs.readSync(ae.nfd,new Int8Array(e.buffer,I,oe),0,oe,ue))},write(ae,e,I,oe,ue){return NODEFS.tryFSOperation(()=>fs.writeSync(ae.nfd,new Int8Array(e.buffer,I,oe),0,oe,ue))},llseek(ae,e,I){var oe=e;if(I===1?oe+=ae.position:I===2&&FS.isFile(ae.node.mode)&&NODEFS.tryFSOperation(()=>{var ue=fs.fstatSync(ae.nfd);oe+=ue.size}),oe<0)throw new FS.ErrnoError(28);return oe},mmap(ae,e,I,oe,ue){if(!FS.isFile(ae.node.mode))throw new FS.ErrnoError(43);var bt=mmapAlloc(e);return NODEFS.stream_ops.read(ae,HEAP8,bt,e,I),{ptr:bt,allocated:!0}},msync(ae,e,I,oe,ue){return NODEFS.stream_ops.write(ae,e,0,oe,I,!1),0}}},FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(ae){this.name="ErrnoError",this.errno=ae}},genericErrors:{},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){this.shared={}}get object(){return this.node}set object(ae){this.node=ae}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(ae){this.shared.flags=ae}get position(){return this.shared.position}set position(ae){this.shared.position=ae}},FSNode:class{constructor(ae,e,I,oe){ae||(ae=this),this.parent=ae,this.mount=ae.mount,this.mounted=null,this.id=FS.nextInode++,this.name=e,this.mode=I,this.node_ops={},this.stream_ops={},this.rdev=oe,this.readMode=365,this.writeMode=146}get read(){return(this.mode&this.readMode)===this.readMode}set read(ae){ae?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(ae){ae?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(ae,e={}){if(ae=PATH_FS.resolve(ae),!ae)return{path:"",node:null};var I={follow_mount:!0,recurse_count:0};if(e=Object.assign(I,e),e.recurse_count>8)throw new FS.ErrnoError(32);for(var oe=ae.split("/").filter(pr=>!!pr),ue=FS.root,bt="/",tr=0;tr<oe.length;tr++){var rr=tr===oe.length-1;if(rr&&e.parent)break;if(ue=FS.lookupNode(ue,oe[tr]),bt=PATH.join2(bt,oe[tr]),FS.isMountpoint(ue)&&(!rr||rr&&e.follow_mount)&&(ue=ue.mounted.root),!rr||e.follow)for(var ir=0;FS.isLink(ue.mode);){var lr=FS.readlink(bt);bt=PATH_FS.resolve(PATH.dirname(bt),lr);var dr=FS.lookupPath(bt,{recurse_count:e.recurse_count+1});if(ue=dr.node,ir++>40)throw new FS.ErrnoError(32)}}return{path:bt,node:ue}},getPath(ae){for(var e;;){if(FS.isRoot(ae)){var I=ae.mount.mountpoint;return e?I[I.length-1]!=="/"?`${I}/${e}`:I+e:I}e=e?`${ae.name}/${e}`:ae.name,ae=ae.parent}},hashName(ae,e){for(var I=0,oe=0;oe<e.length;oe++)I=(I<<5)-I+e.charCodeAt(oe)|0;return(ae+I>>>0)%FS.nameTable.length},hashAddNode(ae){var e=FS.hashName(ae.parent.id,ae.name);ae.name_next=FS.nameTable[e],FS.nameTable[e]=ae},hashRemoveNode(ae){var e=FS.hashName(ae.parent.id,ae.name);if(FS.nameTable[e]===ae)FS.nameTable[e]=ae.name_next;else for(var I=FS.nameTable[e];I;){if(I.name_next===ae){I.name_next=ae.name_next;break}I=I.name_next}},lookupNode(ae,e){var I=FS.mayLookup(ae);if(I)throw new FS.ErrnoError(I);for(var oe=FS.hashName(ae.id,e),ue=FS.nameTable[oe];ue;ue=ue.name_next){var bt=ue.name;if(ue.parent.id===ae.id&&bt===e)return ue}return FS.lookup(ae,e)},createNode(ae,e,I,oe){var ue=new FS.FSNode(ae,e,I,oe);return FS.hashAddNode(ue),ue},destroyNode(ae){FS.hashRemoveNode(ae)},isRoot(ae){return ae===ae.parent},isMountpoint(ae){return!!ae.mounted},isFile(ae){return(ae&61440)===32768},isDir(ae){return(ae&61440)===16384},isLink(ae){return(ae&61440)===40960},isChrdev(ae){return(ae&61440)===8192},isBlkdev(ae){return(ae&61440)===24576},isFIFO(ae){return(ae&61440)===4096},isSocket(ae){return(ae&49152)===49152},flagsToPermissionString(ae){var e=["r","w","rw"][ae&3];return ae&512&&(e+="w"),e},nodePermissions(ae,e){return FS.ignorePermissions?0:e.includes("r")&&!(ae.mode&292)||e.includes("w")&&!(ae.mode&146)||e.includes("x")&&!(ae.mode&73)?2:0},mayLookup(ae){if(!FS.isDir(ae.mode))return 54;var e=FS.nodePermissions(ae,"x");return e||(ae.node_ops.lookup?0:2)},mayCreate(ae,e){try{var I=FS.lookupNode(ae,e);return 20}catch{}return FS.nodePermissions(ae,"wx")},mayDelete(ae,e,I){var oe;try{oe=FS.lookupNode(ae,e)}catch(bt){return bt.errno}var ue=FS.nodePermissions(ae,"wx");if(ue)return ue;if(I){if(!FS.isDir(oe.mode))return 54;if(FS.isRoot(oe)||FS.getPath(oe)===FS.cwd())return 10}else if(FS.isDir(oe.mode))return 31;return 0},mayOpen(ae,e){return ae?FS.isLink(ae.mode)?32:FS.isDir(ae.mode)&&(FS.flagsToPermissionString(e)!=="r"||e&512)?31:FS.nodePermissions(ae,FS.flagsToPermissionString(e)):44},MAX_OPEN_FDS:4096,nextfd(){for(var ae=0;ae<=FS.MAX_OPEN_FDS;ae++)if(!FS.streams[ae])return ae;throw new FS.ErrnoError(33)},getStreamChecked(ae){var e=FS.getStream(ae);if(!e)throw new FS.ErrnoError(8);return e},getStream:ae=>FS.streams[ae],createStream(ae,e=-1){return ae=Object.assign(new FS.FSStream,ae),e==-1&&(e=FS.nextfd()),ae.fd=e,FS.streams[e]=ae,ae},closeStream(ae){FS.streams[ae]=null},dupStream(ae,e=-1){var I=FS.createStream(ae,e);return I.stream_ops?.dup?.(I),I},chrdev_stream_ops:{open(ae){var e=FS.getDevice(ae.node.rdev);ae.stream_ops=e.stream_ops,ae.stream_ops.open?.(ae)},llseek(){throw new FS.ErrnoError(70)}},major:ae=>ae>>8,minor:ae=>ae&255,makedev:(ae,e)=>ae<<8|e,registerDevice(ae,e){FS.devices[ae]={stream_ops:e}},getDevice:ae=>FS.devices[ae],getMounts(ae){for(var e=[],I=[ae];I.length;){var oe=I.pop();e.push(oe),I.push(...oe.mounts)}return e},syncfs(ae,e){typeof ae=="function"&&(e=ae,ae=!1),FS.syncFSRequests++,FS.syncFSRequests>1&&err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var I=FS.getMounts(FS.root.mount),oe=0;function ue(tr){return FS.syncFSRequests--,e(tr)}function bt(tr){if(tr)return bt.errored?void 0:(bt.errored=!0,ue(tr));++oe>=I.length&&ue(null)}I.forEach(tr=>{if(!tr.type.syncfs)return bt(null);tr.type.syncfs(tr,ae,bt)})},mount(ae,e,I){var oe=I==="/",ue=!I,bt;if(oe&&FS.root)throw new FS.ErrnoError(10);if(!oe&&!ue){var tr=FS.lookupPath(I,{follow_mount:!1});if(I=tr.path,bt=tr.node,FS.isMountpoint(bt))throw new FS.ErrnoError(10);if(!FS.isDir(bt.mode))throw new FS.ErrnoError(54)}var rr={type:ae,opts:e,mountpoint:I,mounts:[]},ir=ae.mount(rr);return ir.mount=rr,rr.root=ir,oe?FS.root=ir:bt&&(bt.mounted=rr,bt.mount&&bt.mount.mounts.push(rr)),ir},unmount(ae){var e=FS.lookupPath(ae,{follow_mount:!1});if(!FS.isMountpoint(e.node))throw new FS.ErrnoError(28);var I=e.node,oe=I.mounted,ue=FS.getMounts(oe);Object.keys(FS.nameTable).forEach(tr=>{for(var rr=FS.nameTable[tr];rr;){var ir=rr.name_next;ue.includes(rr.mount)&&FS.destroyNode(rr),rr=ir}}),I.mounted=null;var bt=I.mount.mounts.indexOf(oe);I.mount.mounts.splice(bt,1)},lookup(ae,e){return ae.node_ops.lookup(ae,e)},mknod(ae,e,I){var oe=FS.lookupPath(ae,{parent:!0}),ue=oe.node,bt=PATH.basename(ae);if(!bt||bt==="."||bt==="..")throw new FS.ErrnoError(28);var tr=FS.mayCreate(ue,bt);if(tr)throw new FS.ErrnoError(tr);if(!ue.node_ops.mknod)throw new FS.ErrnoError(63);return ue.node_ops.mknod(ue,bt,e,I)},create(ae,e){return e=e!==void 0?e:438,e&=4095,e|=32768,FS.mknod(ae,e,0)},mkdir(ae,e){return e=e!==void 0?e:511,e&=1023,e|=16384,FS.mknod(ae,e,0)},mkdirTree(ae,e){for(var I=ae.split("/"),oe="",ue=0;ue<I.length;++ue)if(I[ue]){oe+="/"+I[ue];try{FS.mkdir(oe,e)}catch(bt){if(bt.errno!=20)throw bt}}},mkdev(ae,e,I){return typeof I>"u"&&(I=e,e=438),e|=8192,FS.mknod(ae,e,I)},symlink(ae,e){if(!PATH_FS.resolve(ae))throw new FS.ErrnoError(44);var I=FS.lookupPath(e,{parent:!0}),oe=I.node;if(!oe)throw new FS.ErrnoError(44);var ue=PATH.basename(e),bt=FS.mayCreate(oe,ue);if(bt)throw new FS.ErrnoError(bt);if(!oe.node_ops.symlink)throw new FS.ErrnoError(63);return oe.node_ops.symlink(oe,ue,ae)},rename(ae,e){var I=PATH.dirname(ae),oe=PATH.dirname(e),ue=PATH.basename(ae),bt=PATH.basename(e),tr,rr,ir;if(tr=FS.lookupPath(ae,{parent:!0}),rr=tr.node,tr=FS.lookupPath(e,{parent:!0}),ir=tr.node,!rr||!ir)throw new FS.ErrnoError(44);if(rr.mount!==ir.mount)throw new FS.ErrnoError(75);var lr=FS.lookupNode(rr,ue),dr=PATH_FS.relative(ae,oe);if(dr.charAt(0)!==".")throw new FS.ErrnoError(28);if(dr=PATH_FS.relative(e,I),dr.charAt(0)!==".")throw new FS.ErrnoError(55);var pr;try{pr=FS.lookupNode(ir,bt)}catch{}if(lr!==pr){var hr=FS.isDir(lr.mode),_r=FS.mayDelete(rr,ue,hr);if(_r)throw new FS.ErrnoError(_r);if(_r=pr?FS.mayDelete(ir,bt,hr):FS.mayCreate(ir,bt),_r)throw new FS.ErrnoError(_r);if(!rr.node_ops.rename)throw new FS.ErrnoError(63);if(FS.isMountpoint(lr)||pr&&FS.isMountpoint(pr))throw new FS.ErrnoError(10);if(ir!==rr&&(_r=FS.nodePermissions(rr,"w"),_r))throw new FS.ErrnoError(_r);FS.hashRemoveNode(lr);try{rr.node_ops.rename(lr,ir,bt),lr.parent=ir}catch(yr){throw yr}finally{FS.hashAddNode(lr)}}},rmdir(ae){var e=FS.lookupPath(ae,{parent:!0}),I=e.node,oe=PATH.basename(ae),ue=FS.lookupNode(I,oe),bt=FS.mayDelete(I,oe,!0);if(bt)throw new FS.ErrnoError(bt);if(!I.node_ops.rmdir)throw new FS.ErrnoError(63);if(FS.isMountpoint(ue))throw new FS.ErrnoError(10);I.node_ops.rmdir(I,oe),FS.destroyNode(ue)},readdir(ae){var e=FS.lookupPath(ae,{follow:!0}),I=e.node;if(!I.node_ops.readdir)throw new FS.ErrnoError(54);return I.node_ops.readdir(I)},unlink(ae){var e=FS.lookupPath(ae,{parent:!0}),I=e.node;if(!I)throw new FS.ErrnoError(44);var oe=PATH.basename(ae),ue=FS.lookupNode(I,oe),bt=FS.mayDelete(I,oe,!1);if(bt)throw new FS.ErrnoError(bt);if(!I.node_ops.unlink)throw new FS.ErrnoError(63);if(FS.isMountpoint(ue))throw new FS.ErrnoError(10);I.node_ops.unlink(I,oe),FS.destroyNode(ue)},readlink(ae){var e=FS.lookupPath(ae),I=e.node;if(!I)throw new FS.ErrnoError(44);if(!I.node_ops.readlink)throw new FS.ErrnoError(28);return PATH_FS.resolve(FS.getPath(I.parent),I.node_ops.readlink(I))},stat(ae,e){var I=FS.lookupPath(ae,{follow:!e}),oe=I.node;if(!oe)throw new FS.ErrnoError(44);if(!oe.node_ops.getattr)throw new FS.ErrnoError(63);return oe.node_ops.getattr(oe)},lstat(ae){return FS.stat(ae,!0)},chmod(ae,e,I){var oe;if(typeof ae=="string"){var ue=FS.lookupPath(ae,{follow:!I});oe=ue.node}else oe=ae;if(!oe.node_ops.setattr)throw new FS.ErrnoError(63);oe.node_ops.setattr(oe,{mode:e&4095|oe.mode&-4096,timestamp:Date.now()})},lchmod(ae,e){FS.chmod(ae,e,!0)},fchmod(ae,e){var I=FS.getStreamChecked(ae);FS.chmod(I.node,e)},chown(ae,e,I,oe){var ue;if(typeof ae=="string"){var bt=FS.lookupPath(ae,{follow:!oe});ue=bt.node}else ue=ae;if(!ue.node_ops.setattr)throw new FS.ErrnoError(63);ue.node_ops.setattr(ue,{timestamp:Date.now()})},lchown(ae,e,I){FS.chown(ae,e,I,!0)},fchown(ae,e,I){var oe=FS.getStreamChecked(ae);FS.chown(oe.node,e,I)},truncate(ae,e){if(e<0)throw new FS.ErrnoError(28);var I;if(typeof ae=="string"){var oe=FS.lookupPath(ae,{follow:!0});I=oe.node}else I=ae;if(!I.node_ops.setattr)throw new FS.ErrnoError(63);if(FS.isDir(I.mode))throw new FS.ErrnoError(31);if(!FS.isFile(I.mode))throw new FS.ErrnoError(28);var ue=FS.nodePermissions(I,"w");if(ue)throw new FS.ErrnoError(ue);I.node_ops.setattr(I,{size:e,timestamp:Date.now()})},ftruncate(ae,e){var I=FS.getStreamChecked(ae);if(!(I.flags&2097155))throw new FS.ErrnoError(28);FS.truncate(I.node,e)},utime(ae,e,I){var oe=FS.lookupPath(ae,{follow:!0}),ue=oe.node;ue.node_ops.setattr(ue,{timestamp:Math.max(e,I)})},open(ae,e,I){if(ae==="")throw new FS.ErrnoError(44);e=typeof e=="string"?FS_modeStringToFlags(e):e,e&64?(I=typeof I>"u"?438:I,I=I&4095|32768):I=0;var oe;if(typeof ae=="object")oe=ae;else{ae=PATH.normalize(ae);try{var ue=FS.lookupPath(ae,{follow:!(e&131072)});oe=ue.node}catch{}}var bt=!1;if(e&64)if(oe){if(e&128)throw new FS.ErrnoError(20)}else oe=FS.mknod(ae,I,0),bt=!0;if(!oe)throw new FS.ErrnoError(44);if(FS.isChrdev(oe.mode)&&(e&=-513),e&65536&&!FS.isDir(oe.mode))throw new FS.ErrnoError(54);if(!bt){var tr=FS.mayOpen(oe,e);if(tr)throw new FS.ErrnoError(tr)}e&512&&!bt&&FS.truncate(oe,0),e&=-131713;var rr=FS.createStream({node:oe,path:FS.getPath(oe),flags:e,seekable:!0,position:0,stream_ops:oe.stream_ops,ungotten:[],error:!1});return rr.stream_ops.open&&rr.stream_ops.open(rr),Module.logReadFiles&&!(e&1)&&(ae in FS.readFiles||(FS.readFiles[ae]=1)),rr},close(ae){if(FS.isClosed(ae))throw new FS.ErrnoError(8);ae.getdents&&(ae.getdents=null);try{ae.stream_ops.close&&ae.stream_ops.close(ae)}catch(e){throw e}finally{FS.closeStream(ae.fd)}ae.fd=null},isClosed(ae){return ae.fd===null},llseek(ae,e,I){if(FS.isClosed(ae))throw new FS.ErrnoError(8);if(!ae.seekable||!ae.stream_ops.llseek)throw new FS.ErrnoError(70);if(I!=0&&I!=1&&I!=2)throw new FS.ErrnoError(28);return ae.position=ae.stream_ops.llseek(ae,e,I),ae.ungotten=[],ae.position},read(ae,e,I,oe,ue){if(oe<0||ue<0)throw new FS.ErrnoError(28);if(FS.isClosed(ae))throw new FS.ErrnoError(8);if((ae.flags&2097155)===1)throw new FS.ErrnoError(8);if(FS.isDir(ae.node.mode))throw new FS.ErrnoError(31);if(!ae.stream_ops.read)throw new FS.ErrnoError(28);var bt=typeof ue<"u";if(!bt)ue=ae.position;else if(!ae.seekable)throw new FS.ErrnoError(70);var tr=ae.stream_ops.read(ae,e,I,oe,ue);return bt||(ae.position+=tr),tr},write(ae,e,I,oe,ue,bt){if(oe<0||ue<0)throw new FS.ErrnoError(28);if(FS.isClosed(ae))throw new FS.ErrnoError(8);if(!(ae.flags&2097155))throw new FS.ErrnoError(8);if(FS.isDir(ae.node.mode))throw new FS.ErrnoError(31);if(!ae.stream_ops.write)throw new FS.ErrnoError(28);ae.seekable&&ae.flags&1024&&FS.llseek(ae,0,2);var tr=typeof ue<"u";if(!tr)ue=ae.position;else if(!ae.seekable)throw new FS.ErrnoError(70);var rr=ae.stream_ops.write(ae,e,I,oe,ue,bt);return tr||(ae.position+=rr),rr},allocate(ae,e,I){if(FS.isClosed(ae))throw new FS.ErrnoError(8);if(e<0||I<=0)throw new FS.ErrnoError(28);if(!(ae.flags&2097155))throw new FS.ErrnoError(8);if(!FS.isFile(ae.node.mode)&&!FS.isDir(ae.node.mode))throw new FS.ErrnoError(43);if(!ae.stream_ops.allocate)throw new FS.ErrnoError(138);ae.stream_ops.allocate(ae,e,I)},mmap(ae,e,I,oe,ue){if(oe&2&&!(ue&2)&&(ae.flags&2097155)!==2)throw new FS.ErrnoError(2);if((ae.flags&2097155)===1)throw new FS.ErrnoError(2);if(!ae.stream_ops.mmap)throw new FS.ErrnoError(43);if(!e)throw new FS.ErrnoError(28);return ae.stream_ops.mmap(ae,e,I,oe,ue)},msync(ae,e,I,oe,ue){return ae.stream_ops.msync?ae.stream_ops.msync(ae,e,I,oe,ue):0},ioctl(ae,e,I){if(!ae.stream_ops.ioctl)throw new FS.ErrnoError(59);return ae.stream_ops.ioctl(ae,e,I)},readFile(ae,e={}){if(e.flags=e.flags||0,e.encoding=e.encoding||"binary",e.encoding!=="utf8"&&e.encoding!=="binary")throw new Error(`Invalid encoding type "${e.encoding}"`);var I,oe=FS.open(ae,e.flags),ue=FS.stat(ae),bt=ue.size,tr=new Uint8Array(bt);return FS.read(oe,tr,0,bt,0),e.encoding==="utf8"?I=UTF8ArrayToString(tr,0):e.encoding==="binary"&&(I=tr),FS.close(oe),I},writeFile(ae,e,I={}){I.flags=I.flags||577;var oe=FS.open(ae,I.flags,I.mode);if(typeof e=="string"){var ue=new Uint8Array(lengthBytesUTF8(e)+1),bt=stringToUTF8Array(e,ue,0,ue.length);FS.write(oe,ue,0,bt,void 0,I.canOwn)}else if(ArrayBuffer.isView(e))FS.write(oe,e,0,e.byteLength,void 0,I.canOwn);else throw new Error("Unsupported data type");FS.close(oe)},cwd:()=>FS.currentPath,chdir(ae){var e=FS.lookupPath(ae,{follow:!0});if(e.node===null)throw new FS.ErrnoError(44);if(!FS.isDir(e.node.mode))throw new FS.ErrnoError(54);var I=FS.nodePermissions(e.node,"x");if(I)throw new FS.ErrnoError(I);FS.currentPath=e.path},createDefaultDirectories(){FS.mkdir("/tmp"),FS.mkdir("/home"),FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev"),FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(oe,ue,bt,tr,rr)=>tr}),FS.mkdev("/dev/null",FS.makedev(1,3)),TTY.register(FS.makedev(5,0),TTY.default_tty_ops),TTY.register(FS.makedev(6,0),TTY.default_tty1_ops),FS.mkdev("/dev/tty",FS.makedev(5,0)),FS.mkdev("/dev/tty1",FS.makedev(6,0));var ae=new Uint8Array(1024),e=0,I=()=>(e===0&&(e=randomFill(ae).byteLength),ae[--e]);FS.createDevice("/dev","random",I),FS.createDevice("/dev","urandom",I),FS.mkdir("/dev/shm"),FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var ae=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd"),FS.mount({mount(){var e=FS.createNode(ae,"fd",16895,73);return e.node_ops={lookup(I,oe){var ue=+oe,bt=FS.getStreamChecked(ue),tr={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>bt.path}};return tr.parent=tr,tr}},e}},{},"/proc/self/fd")},createStandardStreams(ae,e,I){ae?FS.createDevice("/dev","stdin",ae):FS.symlink("/dev/tty","/dev/stdin"),e?FS.createDevice("/dev","stdout",null,e):FS.symlink("/dev/tty","/dev/stdout"),I?FS.createDevice("/dev","stderr",null,I):FS.symlink("/dev/tty1","/dev/stderr"),FS.open("/dev/stdin",0),FS.open("/dev/stdout",1),FS.open("/dev/stderr",1)},staticInit(){[44].forEach(ae=>{FS.genericErrors[ae]=new FS.ErrnoError(ae),FS.genericErrors[ae].stack="<generic error, no stack>"}),FS.nameTable=new Array(4096),FS.mount(MEMFS,{},"/"),FS.createDefaultDirectories(),FS.createDefaultDevices(),FS.createSpecialDirectories(),FS.filesystems={MEMFS,IDBFS,NODEFS}},init(ae,e,I){FS.initialized=!0,ae??=Module.stdin,e??=Module.stdout,I??=Module.stderr,FS.createStandardStreams(ae,e,I)},quit(){FS.initialized=!1,_fflush(0);for(var ae=0;ae<FS.streams.length;ae++){var e=FS.streams[ae];e&&FS.close(e)}},findObject(ae,e){var I=FS.analyzePath(ae,e);return I.exists?I.object:null},analyzePath(ae,e){try{var I=FS.lookupPath(ae,{follow:!e});ae=I.path}catch{}var oe={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var I=FS.lookupPath(ae,{parent:!0});oe.parentExists=!0,oe.parentPath=I.path,oe.parentObject=I.node,oe.name=PATH.basename(ae),I=FS.lookupPath(ae,{follow:!e}),oe.exists=!0,oe.path=I.path,oe.object=I.node,oe.name=I.node.name,oe.isRoot=I.path==="/"}catch(ue){oe.error=ue.errno}return oe},createPath(ae,e,I,oe){ae=typeof ae=="string"?ae:FS.getPath(ae);for(var ue=e.split("/").reverse();ue.length;){var bt=ue.pop();if(bt){var tr=PATH.join2(ae,bt);try{FS.mkdir(tr)}catch{}ae=tr}}return tr},createFile(ae,e,I,oe,ue){var bt=PATH.join2(typeof ae=="string"?ae:FS.getPath(ae),e),tr=FS_getMode(oe,ue);return FS.create(bt,tr)},createDataFile(ae,e,I,oe,ue,bt){var tr=e;ae&&(ae=typeof ae=="string"?ae:FS.getPath(ae),tr=e?PATH.join2(ae,e):ae);var rr=FS_getMode(oe,ue),ir=FS.create(tr,rr);if(I){if(typeof I=="string"){for(var lr=new Array(I.length),dr=0,pr=I.length;dr<pr;++dr)lr[dr]=I.charCodeAt(dr);I=lr}FS.chmod(ir,rr|146);var hr=FS.open(ir,577);FS.write(hr,I,0,I.length,0,bt),FS.close(hr),FS.chmod(ir,rr)}},createDevice(ae,e,I,oe){var ue=PATH.join2(typeof ae=="string"?ae:FS.getPath(ae),e),bt=FS_getMode(!!I,!!oe);FS.createDevice.major??=64;var tr=FS.makedev(FS.createDevice.major++,0);return FS.registerDevice(tr,{open(rr){rr.seekable=!1},close(rr){oe?.buffer?.length&&oe(10)},read(rr,ir,lr,dr,pr){for(var hr=0,_r=0;_r<dr;_r++){var yr;try{yr=I()}catch{throw new FS.ErrnoError(29)}if(yr===void 0&&hr===0)throw new FS.ErrnoError(6);if(yr==null)break;hr++,ir[lr+_r]=yr}return hr&&(rr.node.timestamp=Date.now()),hr},write(rr,ir,lr,dr,pr){for(var hr=0;hr<dr;hr++)try{oe(ir[lr+hr])}catch{throw new FS.ErrnoError(29)}return dr&&(rr.node.timestamp=Date.now()),hr}}),FS.mkdev(ue,bt,tr)},forceLoadFile(ae){if(ae.isDevice||ae.isFolder||ae.link||ae.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{ae.contents=readBinary(ae.url),ae.usedBytes=ae.contents.length}catch{throw new FS.ErrnoError(29)}},createLazyFile(ae,e,I,oe,ue){class bt{constructor(){this.lengthKnown=!1,this.chunks=[]}get(_r){if(!(_r>this.length-1||_r<0)){var yr=_r%this.chunkSize,wr=_r/this.chunkSize|0;return this.getter(wr)[yr]}}setDataGetter(_r){this.getter=_r}cacheLength(){var _r=new XMLHttpRequest;if(_r.open("HEAD",I,!1),_r.send(null),!(_r.status>=200&&_r.status<300||_r.status===304))throw new Error("Couldn't load "+I+". Status: "+_r.status);var yr=Number(_r.getResponseHeader("Content-length")),wr,Tr=(wr=_r.getResponseHeader("Accept-Ranges"))&&wr==="bytes",Ar=(wr=_r.getResponseHeader("Content-Encoding"))&&wr==="gzip",Sr=1024*1024;Tr||(Sr=yr);var Mr=(Lr,es)=>{if(Lr>es)throw new Error("invalid range ("+Lr+", "+es+") or no bytes requested!");if(es>yr-1)throw new Error("only "+yr+" bytes available! programmer error!");var ss=new XMLHttpRequest;if(ss.open("GET",I,!1),yr!==Sr&&ss.setRequestHeader("Range","bytes="+Lr+"-"+es),ss.responseType="arraybuffer",ss.overrideMimeType&&ss.overrideMimeType("text/plain; charset=x-user-defined"),ss.send(null),!(ss.status>=200&&ss.status<300||ss.status===304))throw new Error("Couldn't load "+I+". Status: "+ss.status);return ss.response!==void 0?new Uint8Array(ss.response||[]):intArrayFromString(ss.responseText||"")},vr=this;vr.setDataGetter(Lr=>{var es=Lr*Sr,ss=(Lr+1)*Sr-1;if(ss=Math.min(ss,yr-1),typeof vr.chunks[Lr]>"u"&&(vr.chunks[Lr]=Mr(es,ss)),typeof vr.chunks[Lr]>"u")throw new Error("doXHR failed!");return vr.chunks[Lr]}),(Ar||!yr)&&(Sr=yr=1,yr=this.getter(0).length,Sr=yr,out("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=yr,this._chunkSize=Sr,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var tr=new bt,rr={isDevice:!1,contents:tr}}else var rr={isDevice:!1,url:I};var ir=FS.createFile(ae,e,rr,oe,ue);rr.contents?ir.contents=rr.contents:rr.url&&(ir.contents=null,ir.url=rr.url),Object.defineProperties(ir,{usedBytes:{get:function(){return this.contents.length}}});var lr={},dr=Object.keys(ir.stream_ops);dr.forEach(hr=>{var _r=ir.stream_ops[hr];lr[hr]=(...yr)=>(FS.forceLoadFile(ir),_r(...yr))});function pr(hr,_r,yr,wr,Tr){var Ar=hr.node.contents;if(Tr>=Ar.length)return 0;var Sr=Math.min(Ar.length-Tr,wr);if(Ar.slice)for(var Mr=0;Mr<Sr;Mr++)_r[yr+Mr]=Ar[Tr+Mr];else for(var Mr=0;Mr<Sr;Mr++)_r[yr+Mr]=Ar.get(Tr+Mr);return Sr}return lr.read=(hr,_r,yr,wr,Tr)=>(FS.forceLoadFile(ir),pr(hr,_r,yr,wr,Tr)),lr.mmap=(hr,_r,yr,wr,Tr)=>{FS.forceLoadFile(ir);var Ar=mmapAlloc(_r);if(!Ar)throw new FS.ErrnoError(48);return pr(hr,HEAP8,Ar,_r,yr),{ptr:Ar,allocated:!0}},ir.stream_ops=lr,ir}},SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(ae,e,I){if(PATH.isAbs(e))return e;var oe;if(ae===-100)oe=FS.cwd();else{var ue=SYSCALLS.getStreamFromFD(ae);oe=ue.path}if(e.length==0){if(!I)throw new FS.ErrnoError(44);return oe}return PATH.join2(oe,e)},doStat(ae,e,I){var oe=ae(e);HEAP32[I>>2]=oe.dev,HEAP32[I+4>>2]=oe.mode,HEAPU32[I+8>>2]=oe.nlink,HEAP32[I+12>>2]=oe.uid,HEAP32[I+16>>2]=oe.gid,HEAP32[I+20>>2]=oe.rdev,HEAP64[I+24>>3]=BigInt(oe.size),HEAP32[I+32>>2]=4096,HEAP32[I+36>>2]=oe.blocks;var ue=oe.atime.getTime(),bt=oe.mtime.getTime(),tr=oe.ctime.getTime();return HEAP64[I+40>>3]=BigInt(Math.floor(ue/1e3)),HEAPU32[I+48>>2]=ue%1e3*1e3*1e3,HEAP64[I+56>>3]=BigInt(Math.floor(bt/1e3)),HEAPU32[I+64>>2]=bt%1e3*1e3*1e3,HEAP64[I+72>>3]=BigInt(Math.floor(tr/1e3)),HEAPU32[I+80>>2]=tr%1e3*1e3*1e3,HEAP64[I+88>>3]=BigInt(oe.ino),0},doMsync(ae,e,I,oe,ue){if(!FS.isFile(e.node.mode))throw new FS.ErrnoError(43);if(oe&2)return 0;var bt=HEAPU8.slice(ae,ae+I);FS.msync(e,bt,ue,I,oe)},getStreamFromFD(ae){var e=FS.getStreamChecked(ae);return e},varargs:void 0,getStr(ae){var e=UTF8ToString(ae);return e}};function ___syscall__newselect(ae,e,I,oe,ue){try{for(var bt=0,tr=e?HEAP32[e>>2]:0,rr=e?HEAP32[e+4>>2]:0,ir=I?HEAP32[I>>2]:0,lr=I?HEAP32[I+4>>2]:0,dr=oe?HEAP32[oe>>2]:0,pr=oe?HEAP32[oe+4>>2]:0,hr=0,_r=0,yr=0,wr=0,Tr=0,Ar=0,Sr=(e?HEAP32[e>>2]:0)|(I?HEAP32[I>>2]:0)|(oe?HEAP32[oe>>2]:0),Mr=(e?HEAP32[e+4>>2]:0)|(I?HEAP32[I+4>>2]:0)|(oe?HEAP32[oe+4>>2]:0),vr=function(zr,Ir,Or,Dr){return zr<32?Ir&Dr:Or&Dr},Lr=0;Lr<ae;Lr++){var es=1<<Lr%32;if(vr(Lr,Sr,Mr,es)){var ss=SYSCALLS.getStreamFromFD(Lr),os=SYSCALLS.DEFAULT_POLLMASK;if(ss.stream_ops.poll){var $r=-1;if(ue){var ns=e?HEAP32[ue>>2]:0,Nr=e?HEAP32[ue+4>>2]:0;$r=(ns+Nr/1e6)*1e3}os=ss.stream_ops.poll(ss,$r)}os&1&&vr(Lr,tr,rr,es)&&(Lr<32?hr=hr|es:_r=_r|es,bt++),os&4&&vr(Lr,ir,lr,es)&&(Lr<32?yr=yr|es:wr=wr|es,bt++),os&2&&vr(Lr,dr,pr,es)&&(Lr<32?Tr=Tr|es:Ar=Ar|es,bt++)}}return e&&(HEAP32[e>>2]=hr,HEAP32[e+4>>2]=_r),I&&(HEAP32[I>>2]=yr,HEAP32[I+4>>2]=wr),oe&&(HEAP32[oe>>2]=Tr,HEAP32[oe+4>>2]=Ar),bt}catch(zr){if(typeof FS>"u"||zr.name!=="ErrnoError")throw zr;return-zr.errno}}___syscall__newselect.sig="iipppp";var SOCKFS={mount(ae){return Module.websocket=Module.websocket&&typeof Module.websocket=="object"?Module.websocket:{},Module.websocket._callbacks={},Module.websocket.on=function(e,I){return typeof I=="function"&&(this._callbacks[e]=I),this},Module.websocket.emit=function(e,I){typeof this._callbacks[e]=="function"&&this._callbacks[e].call(this,I)},FS.createNode(null,"/",16895,0)},createSocket(ae,e,I){e&=-526337;var oe=e==1;if(oe&&I&&I!=6)throw new FS.ErrnoError(66);var ue={family:ae,type:e,protocol:I,server:null,error:null,peers:{},pending:[],recv_queue:[],sock_ops:SOCKFS.websocket_sock_ops},bt=SOCKFS.nextname(),tr=FS.createNode(SOCKFS.root,bt,49152,0);tr.sock=ue;var rr=FS.createStream({path:bt,node:tr,flags:2,seekable:!1,stream_ops:SOCKFS.stream_ops});return ue.stream=rr,ue},getSocket(ae){var e=FS.getStream(ae);return!e||!FS.isSocket(e.node.mode)?null:e.node.sock},stream_ops:{poll(ae){var e=ae.node.sock;return e.sock_ops.poll(e)},ioctl(ae,e,I){var oe=ae.node.sock;return oe.sock_ops.ioctl(oe,e,I)},read(ae,e,I,oe,ue){var bt=ae.node.sock,tr=bt.sock_ops.recvmsg(bt,oe);return tr?(e.set(tr.buffer,I),tr.buffer.length):0},write(ae,e,I,oe,ue){var bt=ae.node.sock;return bt.sock_ops.sendmsg(bt,e,I,oe)},close(ae){var e=ae.node.sock;e.sock_ops.close(e)}},nextname(){return SOCKFS.nextname.current||(SOCKFS.nextname.current=0),"socket["+SOCKFS.nextname.current+++"]"},websocket_sock_ops:{createPeer(ae,e,I){var oe;if(typeof e=="object"&&(oe=e,e=null,I=null),oe)if(oe._socket)e=oe._socket.remoteAddress,I=oe._socket.remotePort;else{var ue=/ws[s]?:\/\/([^:]+):(\d+)/.exec(oe.url);if(!ue)throw new Error("WebSocket URL must be in the format ws(s)://address:port");e=ue[1],I=parseInt(ue[2],10)}else try{var bt=Module.websocket&&typeof Module.websocket=="object",tr="ws:#".replace("#","//");if(bt&&typeof Module.websocket.url=="string"&&(tr=Module.websocket.url),tr==="ws://"||tr==="wss://"){var rr=e.split("/");tr=tr+rr[0]+":"+I+"/"+rr.slice(1).join("/")}var ir="binary";bt&&typeof Module.websocket.subprotocol=="string"&&(ir=Module.websocket.subprotocol);var lr=void 0;ir!=="null"&&(ir=ir.replace(/^ +| +$/g,"").split(/ *, */),lr=ir),bt&&Module.websocket.subprotocol===null&&(ir="null",lr=void 0);var dr;ENVIRONMENT_IS_NODE?dr=require("ws"):dr=WebSocket,oe=new dr(tr,lr),oe.binaryType="arraybuffer"}catch{throw new FS.ErrnoError(23)}var pr={addr:e,port:I,socket:oe,dgram_send_queue:[]};return SOCKFS.websocket_sock_ops.addPeer(ae,pr),SOCKFS.websocket_sock_ops.handlePeerEvents(ae,pr),ae.type===2&&typeof ae.sport<"u"&&pr.dgram_send_queue.push(new Uint8Array([255,255,255,255,112,111,114,116,(ae.sport&65280)>>8,ae.sport&255])),pr},getPeer(ae,e,I){return ae.peers[e+":"+I]},addPeer(ae,e){ae.peers[e.addr+":"+e.port]=e},removePeer(ae,e){delete ae.peers[e.addr+":"+e.port]},handlePeerEvents(ae,e){var I=!0,oe=function(){Module.websocket.emit("open",ae.stream.fd);try{for(var bt=e.dgram_send_queue.shift();bt;)e.socket.send(bt),bt=e.dgram_send_queue.shift()}catch{e.socket.close()}};function ue(bt){if(typeof bt=="string"){var tr=new TextEncoder;bt=tr.encode(bt)}else{if(assert(bt.byteLength!==void 0),bt.byteLength==0)return;bt=new Uint8Array(bt)}var rr=I;if(I=!1,rr&&bt.length===10&&bt[0]===255&&bt[1]===255&&bt[2]===255&&bt[3]===255&&bt[4]===112&&bt[5]===111&&bt[6]===114&&bt[7]===116){var ir=bt[8]<<8|bt[9];SOCKFS.websocket_sock_ops.removePeer(ae,e),e.port=ir,SOCKFS.websocket_sock_ops.addPeer(ae,e);return}ae.recv_queue.push({addr:e.addr,port:e.port,data:bt}),Module.websocket.emit("message",ae.stream.fd)}ENVIRONMENT_IS_NODE?(e.socket.on("open",oe),e.socket.on("message",function(bt,tr){tr&&ue(new Uint8Array(bt).buffer)}),e.socket.on("close",function(){Module.websocket.emit("close",ae.stream.fd)}),e.socket.on("error",function(bt){ae.error=14,Module.websocket.emit("error",[ae.stream.fd,ae.error,"ECONNREFUSED: Connection refused"])})):(e.socket.onopen=oe,e.socket.onclose=function(){Module.websocket.emit("close",ae.stream.fd)},e.socket.onmessage=function(tr){ue(tr.data)},e.socket.onerror=function(bt){ae.error=14,Module.websocket.emit("error",[ae.stream.fd,ae.error,"ECONNREFUSED: Connection refused"])})},poll(ae){if(ae.type===1&&ae.server)return ae.pending.length?65:0;var e=0,I=ae.type===1?SOCKFS.websocket_sock_ops.getPeer(ae,ae.daddr,ae.dport):null;return(ae.recv_queue.length||!I||I&&I.socket.readyState===I.socket.CLOSING||I&&I.socket.readyState===I.socket.CLOSED)&&(e|=65),(!I||I&&I.socket.readyState===I.socket.OPEN)&&(e|=4),(I&&I.socket.readyState===I.socket.CLOSING||I&&I.socket.readyState===I.socket.CLOSED)&&(e|=16),e},ioctl(ae,e,I){switch(e){case 21531:var oe=0;return ae.recv_queue.length&&(oe=ae.recv_queue[0].data.length),HEAP32[I>>2]=oe,0;default:return 28}},close(ae){if(ae.server){try{ae.server.close()}catch{}ae.server=null}for(var e=Object.keys(ae.peers),I=0;I<e.length;I++){var oe=ae.peers[e[I]];try{oe.socket.close()}catch{}SOCKFS.websocket_sock_ops.removePeer(ae,oe)}return 0},bind(ae,e,I){if(typeof ae.saddr<"u"||typeof ae.sport<"u")throw new FS.ErrnoError(28);if(ae.saddr=e,ae.sport=I,ae.type===2){ae.server&&(ae.server.close(),ae.server=null);try{ae.sock_ops.listen(ae,0)}catch(oe){if(oe.name!=="ErrnoError"||oe.errno!==138)throw oe}}},connect(ae,e,I){if(ae.server)throw new FS.ErrnoError(138);if(typeof ae.daddr<"u"&&typeof ae.dport<"u"){var oe=SOCKFS.websocket_sock_ops.getPeer(ae,ae.daddr,ae.dport);if(oe)throw oe.socket.readyState===oe.socket.CONNECTING?new FS.ErrnoError(7):new FS.ErrnoError(30)}var ue=SOCKFS.websocket_sock_ops.createPeer(ae,e,I);throw ae.daddr=ue.addr,ae.dport=ue.port,new FS.ErrnoError(26)},listen(ae,e){if(!ENVIRONMENT_IS_NODE)throw new FS.ErrnoError(138);if(ae.server)throw new FS.ErrnoError(28);var I=require("ws").Server,oe=ae.saddr;ae.server=new I({host:oe,port:ae.sport}),Module.websocket.emit("listen",ae.stream.fd),ae.server.on("connection",function(ue){if(ae.type===1){var bt=SOCKFS.createSocket(ae.family,ae.type,ae.protocol),tr=SOCKFS.websocket_sock_ops.createPeer(bt,ue);bt.daddr=tr.addr,bt.dport=tr.port,ae.pending.push(bt),Module.websocket.emit("connection",bt.stream.fd)}else SOCKFS.websocket_sock_ops.createPeer(ae,ue),Module.websocket.emit("connection",ae.stream.fd)}),ae.server.on("close",function(){Module.websocket.emit("close",ae.stream.fd),ae.server=null}),ae.server.on("error",function(ue){ae.error=23,Module.websocket.emit("error",[ae.stream.fd,ae.error,"EHOSTUNREACH: Host is unreachable"])})},accept(ae){if(!ae.server||!ae.pending.length)throw new FS.ErrnoError(28);var e=ae.pending.shift();return e.stream.flags=ae.stream.flags,e},getname(ae,e){var I,oe;if(e){if(ae.daddr===void 0||ae.dport===void 0)throw new FS.ErrnoError(53);I=ae.daddr,oe=ae.dport}else I=ae.saddr||0,oe=ae.sport||0;return{addr:I,port:oe}},sendmsg(ae,e,I,oe,ue,bt){if(ae.type===2){if((ue===void 0||bt===void 0)&&(ue=ae.daddr,bt=ae.dport),ue===void 0||bt===void 0)throw new FS.ErrnoError(17)}else ue=ae.daddr,bt=ae.dport;var tr=SOCKFS.websocket_sock_ops.getPeer(ae,ue,bt);if(ae.type===1){if(!tr||tr.socket.readyState===tr.socket.CLOSING||tr.socket.readyState===tr.socket.CLOSED)throw new FS.ErrnoError(53);if(tr.socket.readyState===tr.socket.CONNECTING)throw new FS.ErrnoError(6)}ArrayBuffer.isView(e)&&(I+=e.byteOffset,e=e.buffer);var rr;if(rr=e.slice(I,I+oe),ae.type===2&&(!tr||tr.socket.readyState!==tr.socket.OPEN))return(!tr||tr.socket.readyState===tr.socket.CLOSING||tr.socket.readyState===tr.socket.CLOSED)&&(tr=SOCKFS.websocket_sock_ops.createPeer(ae,ue,bt)),tr.dgram_send_queue.push(rr),oe;try{return tr.socket.send(rr),oe}catch{throw new FS.ErrnoError(28)}},recvmsg(ae,e){if(ae.type===1&&ae.server)throw new FS.ErrnoError(53);var I=ae.recv_queue.shift();if(!I){if(ae.type===1){var oe=SOCKFS.websocket_sock_ops.getPeer(ae,ae.daddr,ae.dport);if(!oe)throw new FS.ErrnoError(53);if(oe.socket.readyState===oe.socket.CLOSING||oe.socket.readyState===oe.socket.CLOSED)return null;throw new FS.ErrnoError(6)}throw new FS.ErrnoError(6)}var ue=I.data.byteLength||I.data.length,bt=I.data.byteOffset||0,tr=I.data.buffer||I.data,rr=Math.min(e,ue),ir={buffer:new Uint8Array(tr,bt,rr),addr:I.addr,port:I.port};if(ae.type===1&&rr<ue){var lr=ue-rr;I.data=new Uint8Array(tr,bt+rr,lr),ae.recv_queue.unshift(I)}return ir}}},getSocketFromFD=ae=>{var e=SOCKFS.getSocket(ae);if(!e)throw new FS.ErrnoError(8);return e},inetNtop4=ae=>(ae&255)+"."+(ae>>8&255)+"."+(ae>>16&255)+"."+(ae>>24&255),inetNtop6=ae=>{var e="",I=0,oe=0,ue=0,bt=0,tr=0,rr=0,ir=[ae[0]&65535,ae[0]>>16,ae[1]&65535,ae[1]>>16,ae[2]&65535,ae[2]>>16,ae[3]&65535,ae[3]>>16],lr=!0,dr="";for(rr=0;rr<5;rr++)if(ir[rr]!==0){lr=!1;break}if(lr){if(dr=inetNtop4(ir[6]|ir[7]<<16),ir[5]===-1)return e="::ffff:",e+=dr,e;if(ir[5]===0)return e="::",dr==="0.0.0.0"&&(dr=""),dr==="0.0.0.1"&&(dr="1"),e+=dr,e}for(I=0;I<8;I++)ir[I]===0&&(I-ue>1&&(tr=0),ue=I,tr++),tr>oe&&(oe=tr,bt=I-oe+1);for(I=0;I<8;I++){if(oe>1&&ir[I]===0&&I>=bt&&I<bt+oe){I===bt&&(e+=":",bt===0&&(e+=":"));continue}e+=Number(_ntohs(ir[I]&65535)).toString(16),e+=I<7?":":""}return e},readSockaddr=(ae,e)=>{var I=HEAP16[ae>>1],oe=_ntohs(HEAPU16[ae+2>>1]),ue;switch(I){case 2:if(e!==16)return{errno:28};ue=HEAP32[ae+4>>2],ue=inetNtop4(ue);break;case 10:if(e!==28)return{errno:28};ue=[HEAP32[ae+8>>2],HEAP32[ae+12>>2],HEAP32[ae+16>>2],HEAP32[ae+20>>2]],ue=inetNtop6(ue);break;default:return{errno:5}}return{family:I,addr:ue,port:oe}},inetPton4=ae=>{for(var e=ae.split("."),I=0;I<4;I++){var oe=Number(e[I]);if(isNaN(oe))return null;e[I]=oe}return(e[0]|e[1]<<8|e[2]<<16|e[3]<<24)>>>0},jstoi_q=ae=>parseInt(ae),inetPton6=ae=>{var e,I,oe,ue,bt=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,tr=[];if(!bt.test(ae))return null;if(ae==="::")return[0,0,0,0,0,0,0,0];for(ae.startsWith("::")?ae=ae.replace("::","Z:"):ae=ae.replace("::",":Z:"),ae.indexOf(".")>0?(ae=ae.replace(new RegExp("[.]","g"),":"),e=ae.split(":"),e[e.length-4]=jstoi_q(e[e.length-4])+jstoi_q(e[e.length-3])*256,e[e.length-3]=jstoi_q(e[e.length-2])+jstoi_q(e[e.length-1])*256,e=e.slice(0,e.length-2)):e=ae.split(":"),oe=0,ue=0,I=0;I<e.length;I++)if(typeof e[I]=="string")if(e[I]==="Z"){for(ue=0;ue<8-e.length+1;ue++)tr[I+ue]=0;oe=ue-1}else tr[I+oe]=_htons(parseInt(e[I],16));else tr[I+oe]=e[I];return[tr[1]<<16|tr[0],tr[3]<<16|tr[2],tr[5]<<16|tr[4],tr[7]<<16|tr[6]]},DNS={address_map:{id:1,addrs:{},names:{}},lookup_name(ae){var e=inetPton4(ae);if(e!==null||(e=inetPton6(ae),e!==null))return ae;var I;if(DNS.address_map.addrs[ae])I=DNS.address_map.addrs[ae];else{var oe=DNS.address_map.id++;assert(oe<65535,"exceeded max address mappings of 65535"),I="172.29."+(oe&255)+"."+(oe&65280),DNS.address_map.names[I]=ae,DNS.address_map.addrs[ae]=I}return I},lookup_addr(ae){return DNS.address_map.names[ae]?DNS.address_map.names[ae]:null}},getSocketAddress=(ae,e)=>{var I=readSockaddr(ae,e);if(I.errno)throw new FS.ErrnoError(I.errno);return I.addr=DNS.lookup_addr(I.addr)||I.addr,I};function ___syscall_bind(ae,e,I,oe,ue,bt){try{var tr=getSocketFromFD(ae),rr=getSocketAddress(e,I);return tr.sock_ops.bind(tr,rr.addr,rr.port),0}catch(ir){if(typeof FS>"u"||ir.name!=="ErrnoError")throw ir;return-ir.errno}}___syscall_bind.sig="iippiii";function ___syscall_chdir(ae){try{return ae=SYSCALLS.getStr(ae),FS.chdir(ae),0}catch(e){if(typeof FS>"u"||e.name!=="ErrnoError")throw e;return-e.errno}}___syscall_chdir.sig="ip";function ___syscall_chmod(ae,e){try{return ae=SYSCALLS.getStr(ae),FS.chmod(ae,e),0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_chmod.sig="ipi";function ___syscall_connect(ae,e,I,oe,ue,bt){try{var tr=getSocketFromFD(ae),rr=getSocketAddress(e,I);return tr.sock_ops.connect(tr,rr.addr,rr.port),0}catch(ir){if(typeof FS>"u"||ir.name!=="ErrnoError")throw ir;return-ir.errno}}___syscall_connect.sig="iippiii";function ___syscall_dup(ae){try{var e=SYSCALLS.getStreamFromFD(ae);return FS.dupStream(e).fd}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_dup.sig="ii";function ___syscall_dup3(ae,e,I){try{var oe=SYSCALLS.getStreamFromFD(ae);if(oe.fd===e)return-28;if(e<0||e>=FS.MAX_OPEN_FDS)return-8;var ue=FS.getStream(e);return ue&&FS.close(ue),FS.dupStream(oe,e).fd}catch(bt){if(typeof FS>"u"||bt.name!=="ErrnoError")throw bt;return-bt.errno}}___syscall_dup3.sig="iiii";function ___syscall_faccessat(ae,e,I,oe){try{if(e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(ae,e),I&-8)return-28;var ue=FS.lookupPath(e,{follow:!0}),bt=ue.node;if(!bt)return-44;var tr="";return I&4&&(tr+="r"),I&2&&(tr+="w"),I&1&&(tr+="x"),tr&&FS.nodePermissions(bt,tr)?-2:0}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}___syscall_faccessat.sig="iipii";var ___syscall_fadvise64=(ae,e,I,oe)=>0;___syscall_fadvise64.sig="iijji";var INT53_MAX=9007199254740992,INT53_MIN=-9007199254740992,bigintToI53Checked=ae=>ae<INT53_MIN||ae>INT53_MAX?NaN:Number(ae);function ___syscall_fallocate(ae,e,I,oe){I=bigintToI53Checked(I),oe=bigintToI53Checked(oe);try{if(isNaN(I))return 61;var ue=SYSCALLS.getStreamFromFD(ae);return FS.allocate(ue,I,oe),0}catch(bt){if(typeof FS>"u"||bt.name!=="ErrnoError")throw bt;return-bt.errno}}___syscall_fallocate.sig="iiijj";function syscallGetVarargI(){var ae=HEAP32[+SYSCALLS.varargs>>2];return SYSCALLS.varargs+=4,ae}var syscallGetVarargP=syscallGetVarargI;function ___syscall_fcntl64(ae,e,I){SYSCALLS.varargs=I;try{var oe=SYSCALLS.getStreamFromFD(ae);switch(e){case 0:{var ue=syscallGetVarargI();if(ue<0)return-28;for(;FS.streams[ue];)ue++;var bt;return bt=FS.dupStream(oe,ue),bt.fd}case 1:case 2:return 0;case 3:return oe.flags;case 4:{var ue=syscallGetVarargI();return oe.flags|=ue,0}case 12:{var ue=syscallGetVarargP(),tr=0;return HEAP16[ue+tr>>1]=2,0}case 13:case 14:return 0}return-28}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}___syscall_fcntl64.sig="iiip";function ___syscall_fdatasync(ae){try{var e=SYSCALLS.getStreamFromFD(ae);return 0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_fdatasync.sig="ii";function ___syscall_fstat64(ae,e){try{var I=SYSCALLS.getStreamFromFD(ae);return SYSCALLS.doStat(FS.stat,I.path,e)}catch(oe){if(typeof FS>"u"||oe.name!=="ErrnoError")throw oe;return-oe.errno}}___syscall_fstat64.sig="iip";function ___syscall_ftruncate64(ae,e){e=bigintToI53Checked(e);try{return isNaN(e)?61:(FS.ftruncate(ae,e),0)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_ftruncate64.sig="iij";var stringToUTF8=(ae,e,I)=>stringToUTF8Array(ae,HEAPU8,e,I);function ___syscall_getcwd(ae,e){try{if(e===0)return-28;var I=FS.cwd(),oe=lengthBytesUTF8(I)+1;return e<oe?-68:(stringToUTF8(I,ae,e),oe)}catch(ue){if(typeof FS>"u"||ue.name!=="ErrnoError")throw ue;return-ue.errno}}___syscall_getcwd.sig="ipp";function ___syscall_getdents64(ae,e,I){try{var oe=SYSCALLS.getStreamFromFD(ae);oe.getdents||=FS.readdir(oe.path);for(var ue=280,bt=0,tr=FS.llseek(oe,0,1),rr=Math.floor(tr/ue);rr<oe.getdents.length&&bt+ue<=I;){var ir,lr,dr=oe.getdents[rr];if(dr===".")ir=oe.node.id,lr=4;else if(dr===".."){var pr=FS.lookupPath(oe.path,{parent:!0});ir=pr.node.id,lr=4}else{var hr=FS.lookupNode(oe.node,dr);ir=hr.id,lr=FS.isChrdev(hr.mode)?2:FS.isDir(hr.mode)?4:FS.isLink(hr.mode)?10:8}HEAP64[e+bt>>3]=BigInt(ir),HEAP64[e+bt+8>>3]=BigInt((rr+1)*ue),HEAP16[e+bt+16>>1]=280,HEAP8[e+bt+18]=lr,stringToUTF8(dr,e+bt+19,256),bt+=ue,rr+=1}return FS.llseek(oe,rr*ue,0),bt}catch(_r){if(typeof FS>"u"||_r.name!=="ErrnoError")throw _r;return-_r.errno}}___syscall_getdents64.sig="iipp";var writeSockaddr=(ae,e,I,oe,ue)=>{switch(e){case 2:I=inetPton4(I),zeroMemory(ae,16),ue&&(HEAP32[ue>>2]=16),HEAP16[ae>>1]=e,HEAP32[ae+4>>2]=I,HEAP16[ae+2>>1]=_htons(oe);break;case 10:I=inetPton6(I),zeroMemory(ae,28),ue&&(HEAP32[ue>>2]=28),HEAP32[ae>>2]=e,HEAP32[ae+8>>2]=I[0],HEAP32[ae+12>>2]=I[1],HEAP32[ae+16>>2]=I[2],HEAP32[ae+20>>2]=I[3],HEAP16[ae+2>>1]=_htons(oe);break;default:return 5}return 0};function ___syscall_getsockname(ae,e,I,oe,ue,bt){try{var tr=getSocketFromFD(ae),rr=writeSockaddr(e,tr.family,DNS.lookup_name(tr.saddr||"0.0.0.0"),tr.sport,I);return 0}catch(ir){if(typeof FS>"u"||ir.name!=="ErrnoError")throw ir;return-ir.errno}}___syscall_getsockname.sig="iippiii";function ___syscall_getsockopt(ae,e,I,oe,ue,bt){try{var tr=getSocketFromFD(ae);return e===1&&I===4?(HEAP32[oe>>2]=tr.error,HEAP32[ue>>2]=4,tr.error=null,0):-50}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}___syscall_getsockopt.sig="iiiippi";function ___syscall_ioctl(ae,e,I){SYSCALLS.varargs=I;try{var oe=SYSCALLS.getStreamFromFD(ae);switch(e){case 21509:return oe.tty?0:-59;case 21505:{if(!oe.tty)return-59;if(oe.tty.ops.ioctl_tcgets){var ue=oe.tty.ops.ioctl_tcgets(oe),bt=syscallGetVarargP();HEAP32[bt>>2]=ue.c_iflag||0,HEAP32[bt+4>>2]=ue.c_oflag||0,HEAP32[bt+8>>2]=ue.c_cflag||0,HEAP32[bt+12>>2]=ue.c_lflag||0;for(var tr=0;tr<32;tr++)HEAP8[bt+tr+17]=ue.c_cc[tr]||0;return 0}return 0}case 21510:case 21511:case 21512:return oe.tty?0:-59;case 21506:case 21507:case 21508:{if(!oe.tty)return-59;if(oe.tty.ops.ioctl_tcsets){for(var bt=syscallGetVarargP(),rr=HEAP32[bt>>2],ir=HEAP32[bt+4>>2],lr=HEAP32[bt+8>>2],dr=HEAP32[bt+12>>2],pr=[],tr=0;tr<32;tr++)pr.push(HEAP8[bt+tr+17]);return oe.tty.ops.ioctl_tcsets(oe.tty,e,{c_iflag:rr,c_oflag:ir,c_cflag:lr,c_lflag:dr,c_cc:pr})}return 0}case 21519:{if(!oe.tty)return-59;var bt=syscallGetVarargP();return HEAP32[bt>>2]=0,0}case 21520:return oe.tty?-28:-59;case 21531:{var bt=syscallGetVarargP();return FS.ioctl(oe,e,bt)}case 21523:{if(!oe.tty)return-59;if(oe.tty.ops&&oe.tty.ops.ioctl_tiocgwinsz){var hr=oe.tty.ops.ioctl_tiocgwinsz(oe.tty),bt=syscallGetVarargP();HEAP16[bt>>1]=hr[0],HEAP16[bt+2>>1]=hr[1]}return 0}case 21524:return oe.tty?0:-59;case 21515:return oe.tty?0:-59;default:return-28}}catch(_r){if(typeof FS>"u"||_r.name!=="ErrnoError")throw _r;return-_r.errno}}___syscall_ioctl.sig="iiip";function ___syscall_lstat64(ae,e){try{return ae=SYSCALLS.getStr(ae),SYSCALLS.doStat(FS.lstat,ae,e)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_lstat64.sig="ipp";function ___syscall_mkdirat(ae,e,I){try{return e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(ae,e),e=PATH.normalize(e),e[e.length-1]==="/"&&(e=e.substr(0,e.length-1)),FS.mkdir(e,I,0),0}catch(oe){if(typeof FS>"u"||oe.name!=="ErrnoError")throw oe;return-oe.errno}}___syscall_mkdirat.sig="iipi";function ___syscall_newfstatat(ae,e,I,oe){try{e=SYSCALLS.getStr(e);var ue=oe&256,bt=oe&4096;return oe=oe&-6401,e=SYSCALLS.calculateAt(ae,e,bt),SYSCALLS.doStat(ue?FS.lstat:FS.stat,e,I)}catch(tr){if(typeof FS>"u"||tr.name!=="ErrnoError")throw tr;return-tr.errno}}___syscall_newfstatat.sig="iippi";function ___syscall_openat(ae,e,I,oe){SYSCALLS.varargs=oe;try{e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(ae,e);var ue=oe?syscallGetVarargI():0;return FS.open(e,I,ue).fd}catch(bt){if(typeof FS>"u"||bt.name!=="ErrnoError")throw bt;return-bt.errno}}___syscall_openat.sig="iipip";var PIPEFS={BUCKET_BUFFER_SIZE:8192,mount(ae){return FS.createNode(null,"/",16895,0)},createPipe(){var ae={buckets:[],refcnt:2};ae.buckets.push({buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:0,roffset:0});var e=PIPEFS.nextname(),I=PIPEFS.nextname(),oe=FS.createNode(PIPEFS.root,e,4096,0),ue=FS.createNode(PIPEFS.root,I,4096,0);oe.pipe=ae,ue.pipe=ae;var bt=FS.createStream({path:e,node:oe,flags:0,seekable:!1,stream_ops:PIPEFS.stream_ops});oe.stream=bt;var tr=FS.createStream({path:I,node:ue,flags:1,seekable:!1,stream_ops:PIPEFS.stream_ops});return ue.stream=tr,{readable_fd:bt.fd,writable_fd:tr.fd}},stream_ops:{poll(ae){var e=ae.node.pipe;if((ae.flags&2097155)===1)return 260;if(e.buckets.length>0)for(var I=0;I<e.buckets.length;I++){var oe=e.buckets[I];if(oe.offset-oe.roffset>0)return 65}return 0},ioctl(ae,e,I){return 28},fsync(ae){return 28},read(ae,e,I,oe,ue){for(var bt=ae.node.pipe,tr=0,rr=0;rr<bt.buckets.length;rr++){var ir=bt.buckets[rr];tr+=ir.offset-ir.roffset}var lr=e.subarray(I,I+oe);if(oe<=0)return 0;if(tr==0)throw new FS.ErrnoError(6);for(var dr=Math.min(tr,oe),pr=dr,hr=0,rr=0;rr<bt.buckets.length;rr++){var _r=bt.buckets[rr],yr=_r.offset-_r.roffset;if(dr<=yr){var wr=_r.buffer.subarray(_r.roffset,_r.offset);dr<yr?(wr=wr.subarray(0,dr),_r.roffset+=dr):hr++,lr.set(wr);break}else{var wr=_r.buffer.subarray(_r.roffset,_r.offset);lr.set(wr),lr=lr.subarray(wr.byteLength),dr-=wr.byteLength,hr++}}return hr&&hr==bt.buckets.length&&(hr--,bt.buckets[hr].offset=0,bt.buckets[hr].roffset=0),bt.buckets.splice(0,hr),pr},write(ae,e,I,oe,ue){var bt=ae.node.pipe,tr=e.subarray(I,I+oe),rr=tr.byteLength;if(rr<=0)return 0;var ir=null;bt.buckets.length==0?(ir={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:0,roffset:0},bt.buckets.push(ir)):ir=bt.buckets[bt.buckets.length-1],assert(ir.offset<=PIPEFS.BUCKET_BUFFER_SIZE);var lr=PIPEFS.BUCKET_BUFFER_SIZE-ir.offset;if(lr>=rr)return ir.buffer.set(tr,ir.offset),ir.offset+=rr,rr;lr>0&&(ir.buffer.set(tr.subarray(0,lr),ir.offset),ir.offset+=lr,tr=tr.subarray(lr,tr.byteLength));for(var dr=tr.byteLength/PIPEFS.BUCKET_BUFFER_SIZE|0,pr=tr.byteLength%PIPEFS.BUCKET_BUFFER_SIZE,hr=0;hr<dr;hr++){var _r={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:PIPEFS.BUCKET_BUFFER_SIZE,roffset:0};bt.buckets.push(_r),_r.buffer.set(tr.subarray(0,PIPEFS.BUCKET_BUFFER_SIZE)),tr=tr.subarray(PIPEFS.BUCKET_BUFFER_SIZE,tr.byteLength)}if(pr>0){var _r={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:tr.byteLength,roffset:0};bt.buckets.push(_r),_r.buffer.set(tr)}return rr},close(ae){var e=ae.node.pipe;e.refcnt--,e.refcnt===0&&(e.buckets=null)}},nextname(){return PIPEFS.nextname.current||(PIPEFS.nextname.current=0),"pipe["+PIPEFS.nextname.current+++"]"}};function ___syscall_pipe(ae){try{if(ae==0)throw new FS.ErrnoError(21);var e=PIPEFS.createPipe();return HEAP32[ae>>2]=e.readable_fd,HEAP32[ae+4>>2]=e.writable_fd,0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_pipe.sig="ip";function ___syscall_poll(ae,e,I){try{for(var oe=0,ue=0;ue<e;ue++){var bt=ae+8*ue,tr=HEAP32[bt>>2],rr=HEAP16[bt+4>>1],ir=32,lr=FS.getStream(tr);lr&&(ir=SYSCALLS.DEFAULT_POLLMASK,lr.stream_ops.poll&&(ir=lr.stream_ops.poll(lr,-1))),ir&=rr|8|16,ir&&oe++,HEAP16[bt+6>>1]=ir}return oe}catch(dr){if(typeof FS>"u"||dr.name!=="ErrnoError")throw dr;return-dr.errno}}___syscall_poll.sig="ipii";function ___syscall_readlinkat(ae,e,I,oe){try{if(e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(ae,e),oe<=0)return-28;var ue=FS.readlink(e),bt=Math.min(oe,lengthBytesUTF8(ue)),tr=HEAP8[I+bt];return stringToUTF8(ue,I,oe+1),HEAP8[I+bt]=tr,bt}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}___syscall_readlinkat.sig="iippp";function ___syscall_recvfrom(ae,e,I,oe,ue,bt){try{var tr=getSocketFromFD(ae),rr=tr.sock_ops.recvmsg(tr,I);if(!rr)return 0;if(ue)var ir=writeSockaddr(ue,tr.family,DNS.lookup_name(rr.addr),rr.port,bt);return HEAPU8.set(rr.buffer,e),rr.buffer.byteLength}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return-lr.errno}}___syscall_recvfrom.sig="iippipp";function ___syscall_renameat(ae,e,I,oe){try{return e=SYSCALLS.getStr(e),oe=SYSCALLS.getStr(oe),e=SYSCALLS.calculateAt(ae,e),oe=SYSCALLS.calculateAt(I,oe),FS.rename(e,oe),0}catch(ue){if(typeof FS>"u"||ue.name!=="ErrnoError")throw ue;return-ue.errno}}___syscall_renameat.sig="iipip";function ___syscall_rmdir(ae){try{return ae=SYSCALLS.getStr(ae),FS.rmdir(ae),0}catch(e){if(typeof FS>"u"||e.name!=="ErrnoError")throw e;return-e.errno}}___syscall_rmdir.sig="ip";function ___syscall_sendto(ae,e,I,oe,ue,bt){try{var tr=getSocketFromFD(ae);if(!ue)return FS.write(tr.stream,HEAP8,e,I);var rr=getSocketAddress(ue,bt);return tr.sock_ops.sendmsg(tr,HEAP8,e,I,rr.addr,rr.port)}catch(ir){if(typeof FS>"u"||ir.name!=="ErrnoError")throw ir;return-ir.errno}}___syscall_sendto.sig="iippipp";function ___syscall_socket(ae,e,I){try{var oe=SOCKFS.createSocket(ae,e,I);return oe.stream.fd}catch(ue){if(typeof FS>"u"||ue.name!=="ErrnoError")throw ue;return-ue.errno}}___syscall_socket.sig="iiiiiii";function ___syscall_stat64(ae,e){try{return ae=SYSCALLS.getStr(ae),SYSCALLS.doStat(FS.stat,ae,e)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_stat64.sig="ipp";function ___syscall_symlink(ae,e){try{return ae=SYSCALLS.getStr(ae),e=SYSCALLS.getStr(e),FS.symlink(ae,e),0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_symlink.sig="ipp";function ___syscall_truncate64(ae,e){e=bigintToI53Checked(e);try{return isNaN(e)?61:(ae=SYSCALLS.getStr(ae),FS.truncate(ae,e),0)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_truncate64.sig="ipj";function ___syscall_unlinkat(ae,e,I){try{return e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(ae,e),I===0?FS.unlink(e):I===512?FS.rmdir(e):abort("Invalid flags passed to unlinkat"),0}catch(oe){if(typeof FS>"u"||oe.name!=="ErrnoError")throw oe;return-oe.errno}}___syscall_unlinkat.sig="iipi";var ___table_base=new WebAssembly.Global({value:"i32",mutable:!1},1),__abort_js=()=>{abort("")};__abort_js.sig="v";var ENV={},stackAlloc=ae=>__emscripten_stack_alloc(ae),stringToUTF8OnStack=ae=>{var e=lengthBytesUTF8(ae)+1,I=stackAlloc(e);return stringToUTF8(ae,I,e),I},dlSetError=ae=>{var e=stackSave(),I=stringToUTF8OnStack(ae);___dl_seterr(I,0),stackRestore(e)},dlopenInternal=(ae,e)=>{var I=UTF8ToString(ae+36),oe=HEAP32[ae+4>>2];I=PATH.normalize(I);var ue=!!(oe&256),bt=ue?null:{},tr={global:ue,nodelete:!!(oe&4096),loadAsync:e.loadAsync};if(e.loadAsync)return loadDynamicLibrary(I,tr,bt,ae);try{return loadDynamicLibrary(I,tr,bt,ae)}catch(rr){return dlSetError(`Could not load dynamic lib: ${I}
${rr}`),0}},__dlopen_js=ae=>dlopenInternal(ae,{loadAsync:!1});__dlopen_js.sig="pp";var __dlsym_js=(ae,e,I)=>{e=UTF8ToString(e);var oe,ue,bt=LDSO.loadedLibsByHandle[ae];if(!bt.exports.hasOwnProperty(e)||bt.exports[e].stub)return dlSetError(`Tried to lookup unknown symbol "${e}" in dynamic lib: ${bt.name}`),0;if(ue=Object.keys(bt.exports).indexOf(e),oe=bt.exports[e],typeof oe=="function"){var tr=getFunctionAddress(oe);tr?oe=tr:(oe=addFunction(oe,oe.sig),HEAPU32[I>>2]=ue)}return oe};__dlsym_js.sig="pppp";var nowIsMonotonic=1,__emscripten_get_now_is_monotonic=()=>nowIsMonotonic;__emscripten_get_now_is_monotonic.sig="i";var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=!1,runtimeKeepaliveCounter=0};__emscripten_runtime_keepalive_clear.sig="v";var __emscripten_system=ae=>{if(ENVIRONMENT_IS_NODE){if(!ae)return 1;var e=UTF8ToString(ae);if(!e.length)return 0;var I=require("child_process"),oe=I.spawnSync(e,[],{shell:!0,stdio:"inherit"}),ue=(tr,rr)=>tr<<8|rr;if(oe.status===null){var bt=tr=>{switch(tr){case"SIGHUP":return 1;case"SIGQUIT":return 3;case"SIGFPE":return 8;case"SIGKILL":return 9;case"SIGALRM":return 14;case"SIGTERM":return 15;default:return 2}};return ue(0,bt(oe.signal))}return ue(oe.status,0)}return ae?-52:0};__emscripten_system.sig="ip";var __emscripten_throw_longjmp=()=>{throw 1/0};__emscripten_throw_longjmp.sig="v";function __gmtime_js(ae,e){ae=bigintToI53Checked(ae);var I=new Date(ae*1e3);HEAP32[e>>2]=I.getUTCSeconds(),HEAP32[e+4>>2]=I.getUTCMinutes(),HEAP32[e+8>>2]=I.getUTCHours(),HEAP32[e+12>>2]=I.getUTCDate(),HEAP32[e+16>>2]=I.getUTCMonth(),HEAP32[e+20>>2]=I.getUTCFullYear()-1900,HEAP32[e+24>>2]=I.getUTCDay();var oe=Date.UTC(I.getUTCFullYear(),0,1,0,0,0,0),ue=(I.getTime()-oe)/(1e3*60*60*24)|0;HEAP32[e+28>>2]=ue}__gmtime_js.sig="vjp";var isLeapYear=ae=>ae%4===0&&(ae%100!==0||ae%400===0),MONTH_DAYS_LEAP_CUMULATIVE=[0,31,60,91,121,152,182,213,244,274,305,335],MONTH_DAYS_REGULAR_CUMULATIVE=[0,31,59,90,120,151,181,212,243,273,304,334],ydayFromDate=ae=>{var e=isLeapYear(ae.getFullYear()),I=e?MONTH_DAYS_LEAP_CUMULATIVE:MONTH_DAYS_REGULAR_CUMULATIVE,oe=I[ae.getMonth()]+ae.getDate()-1;return oe};function __localtime_js(ae,e){ae=bigintToI53Checked(ae);var I=new Date(ae*1e3);HEAP32[e>>2]=I.getSeconds(),HEAP32[e+4>>2]=I.getMinutes(),HEAP32[e+8>>2]=I.getHours(),HEAP32[e+12>>2]=I.getDate(),HEAP32[e+16>>2]=I.getMonth(),HEAP32[e+20>>2]=I.getFullYear()-1900,HEAP32[e+24>>2]=I.getDay();var oe=ydayFromDate(I)|0;HEAP32[e+28>>2]=oe,HEAP32[e+36>>2]=-(I.getTimezoneOffset()*60);var ue=new Date(I.getFullYear(),0,1),bt=new Date(I.getFullYear(),6,1).getTimezoneOffset(),tr=ue.getTimezoneOffset(),rr=(bt!=tr&&I.getTimezoneOffset()==Math.min(tr,bt))|0;HEAP32[e+32>>2]=rr}__localtime_js.sig="vjp";function __mmap_js(ae,e,I,oe,ue,bt,tr){ue=bigintToI53Checked(ue);try{if(isNaN(ue))return 61;var rr=SYSCALLS.getStreamFromFD(oe),ir=FS.mmap(rr,ae,ue,e,I),lr=ir.ptr;return HEAP32[bt>>2]=ir.allocated,HEAPU32[tr>>2]=lr,0}catch(dr){if(typeof FS>"u"||dr.name!=="ErrnoError")throw dr;return-dr.errno}}__mmap_js.sig="ipiiijpp";function __munmap_js(ae,e,I,oe,ue,bt){bt=bigintToI53Checked(bt);try{var tr=SYSCALLS.getStreamFromFD(ue);I&2&&SYSCALLS.doMsync(ae,tr,e,oe,bt)}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}__munmap_js.sig="ippiiij";var timers={},handleException=ae=>{if(ae instanceof ExitStatus||ae=="unwind")return EXITSTATUS;quit_(1,ae)},runtimeKeepaliveCounter=0,keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0,_proc_exit=ae=>{EXITSTATUS=ae,keepRuntimeAlive()||(Module.onExit?.(ae),ABORT=!0),quit_(ae,new ExitStatus(ae))};_proc_exit.sig="vi";var exitJS=(ae,e)=>{EXITSTATUS=ae,_proc_exit(ae)},_exit=exitJS;_exit.sig="vi";var maybeExit=()=>{if(!keepRuntimeAlive())try{_exit(EXITSTATUS)}catch(ae){handleException(ae)}},callUserCallback=ae=>{if(!ABORT)try{ae(),maybeExit()}catch(e){handleException(e)}},_emscripten_get_now=()=>performance.now();_emscripten_get_now.sig="d";var __setitimer_js=(ae,e)=>{if(timers[ae]&&(clearTimeout(timers[ae].id),delete timers[ae]),!e)return 0;var I=setTimeout(()=>{delete timers[ae],callUserCallback(()=>__emscripten_timeout(ae,_emscripten_get_now()))},e);return timers[ae]={id:I,timeout_ms:e},0};__setitimer_js.sig="iid";var __tzset_js=(ae,e,I,oe)=>{var ue=new Date().getFullYear(),bt=new Date(ue,0,1),tr=new Date(ue,6,1),rr=bt.getTimezoneOffset(),ir=tr.getTimezoneOffset(),lr=Math.max(rr,ir);HEAPU32[ae>>2]=lr*60,HEAP32[e>>2]=+(rr!=ir);var dr=_r=>{var yr=_r>=0?"-":"+",wr=Math.abs(_r),Tr=String(Math.floor(wr/60)).padStart(2,"0"),Ar=String(wr%60).padStart(2,"0");return`UTC${yr}${Tr}${Ar}`},pr=dr(rr),hr=dr(ir);ir<rr?(stringToUTF8(pr,I,17),stringToUTF8(hr,oe,17)):(stringToUTF8(pr,oe,17),stringToUTF8(hr,I,17))};__tzset_js.sig="vpppp";var readEmAsmArgsArray=[],readEmAsmArgs=(ae,e)=>{readEmAsmArgsArray.length=0;for(var I;I=HEAPU8[ae++];){var oe=I!=105;oe&=I!=112,e+=oe&&e%8?4:0,readEmAsmArgsArray.push(I==112?HEAPU32[e>>2]:I==106?HEAP64[e>>3]:I==105?HEAP32[e>>2]:HEAPF64[e>>3]),e+=oe?8:4}return readEmAsmArgsArray},runEmAsmFunction=(ae,e,I)=>{var oe=readEmAsmArgs(e,I);return ASM_CONSTS[ae](...oe)},_emscripten_asm_const_int=(ae,e,I)=>runEmAsmFunction(ae,e,I);_emscripten_asm_const_int.sig="ippp";var _emscripten_date_now=()=>Date.now();_emscripten_date_now.sig="d";var _emscripten_force_exit=ae=>{__emscripten_runtime_keepalive_clear(),_exit(ae)};_emscripten_force_exit.sig="vi";var getHeapMax=()=>2147483648,growMemory=ae=>{var e=wasmMemory.buffer,I=(ae-e.byteLength+65535)/65536;try{return wasmMemory.grow(I),updateMemoryViews(),1}catch{}},_emscripten_resize_heap=ae=>{var e=HEAPU8.length;ae>>>=0;var I=getHeapMax();if(ae>I)return!1;for(var oe=1;oe<=4;oe*=2){var ue=e*(1+.2/oe);ue=Math.min(ue,ae+100663296);var bt=Math.min(I,alignMemory(Math.max(ae,ue),65536)),tr=growMemory(bt);if(tr)return!0}return!1};_emscripten_resize_heap.sig="ip";var _emscripten_set_main_loop_timing=(ae,e)=>{if(MainLoop.timingMode=ae,MainLoop.timingValue=e,!MainLoop.func)return 1;if(MainLoop.running||(MainLoop.running=!0),ae==0)MainLoop.scheduler=function(){var tr=Math.max(0,MainLoop.tickStartTime+e-_emscripten_get_now())|0;setTimeout(MainLoop.runner,tr)},MainLoop.method="timeout";else if(ae==1)MainLoop.scheduler=function(){MainLoop.requestAnimationFrame(MainLoop.runner)},MainLoop.method="rAF";else if(ae==2){if(typeof MainLoop.setImmediate>"u")if(typeof setImmediate>"u"){var I=[],oe="setimmediate",ue=bt=>{(bt.data===oe||bt.data.target===oe)&&(bt.stopPropagation(),I.shift()())};addEventListener("message",ue,!0),MainLoop.setImmediate=bt=>{I.push(bt),ENVIRONMENT_IS_WORKER?(Module.setImmediates??=[],Module.setImmediates.push(bt),postMessage({target:oe})):postMessage(oe,"*")}}else MainLoop.setImmediate=setImmediate;MainLoop.scheduler=function(){MainLoop.setImmediate(MainLoop.runner)},MainLoop.method="immediate"}return 0};_emscripten_set_main_loop_timing.sig="iii";var MainLoop={running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],preMainLoop:[],postMainLoop:[],pause(){MainLoop.scheduler=null,MainLoop.currentlyRunningMainloop++},resume(){MainLoop.currentlyRunningMainloop++;var ae=MainLoop.timingMode,e=MainLoop.timingValue,I=MainLoop.func;MainLoop.func=null,setMainLoop(I,0,!1,MainLoop.arg,!0),_emscripten_set_main_loop_timing(ae,e),MainLoop.scheduler()},updateStatus(){if(Module.setStatus){var ae=Module.statusMessage||"Please wait...",e=MainLoop.remainingBlockers??0,I=MainLoop.expectedBlockers??0;e?e<I?Module.setStatus("{message} ({expected - remaining}/{expected})"):Module.setStatus(ae):Module.setStatus("")}},init(){Module.preMainLoop&&MainLoop.preMainLoop.push(Module.preMainLoop),Module.postMainLoop&&MainLoop.postMainLoop.push(Module.postMainLoop)},runIter(ae){if(!ABORT){for(var e of MainLoop.preMainLoop)if(e()===!1)return;callUserCallback(ae);for(var I of MainLoop.postMainLoop)I()}},nextRAF:0,fakeRequestAnimationFrame(ae){var e=Date.now();if(MainLoop.nextRAF===0)MainLoop.nextRAF=e+1e3/60;else for(;e+2>=MainLoop.nextRAF;)MainLoop.nextRAF+=1e3/60;var I=Math.max(MainLoop.nextRAF-e,0);setTimeout(ae,I)},requestAnimationFrame(ae){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(ae);return}var e=MainLoop.fakeRequestAnimationFrame;e(ae)}},setMainLoop=(ae,e,I,oe,ue)=>{MainLoop.func=ae,MainLoop.arg=oe;var bt=MainLoop.currentlyRunningMainloop;function tr(){return bt<MainLoop.currentlyRunningMainloop?(maybeExit(),!1):!0}if(MainLoop.running=!1,MainLoop.runner=function(){if(!ABORT){if(MainLoop.queue.length>0){var ir=MainLoop.queue.shift();if(ir.func(ir.arg),MainLoop.remainingBlockers){var lr=MainLoop.remainingBlockers,dr=lr%1==0?lr-1:Math.floor(lr);ir.counted?MainLoop.remainingBlockers=dr:(dr=dr+.5,MainLoop.remainingBlockers=(8*lr+dr)/9)}if(MainLoop.updateStatus(),!tr())return;setTimeout(MainLoop.runner,0);return}if(tr()){if(MainLoop.currentFrameNumber=MainLoop.currentFrameNumber+1|0,MainLoop.timingMode==1&&MainLoop.timingValue>1&&MainLoop.currentFrameNumber%MainLoop.timingValue!=0){MainLoop.scheduler();return}else MainLoop.timingMode==0&&(MainLoop.tickStartTime=_emscripten_get_now());MainLoop.runIter(ae),tr()&&MainLoop.scheduler()}}},ue||(e&&e>0?_emscripten_set_main_loop_timing(0,1e3/e):_emscripten_set_main_loop_timing(1,1),MainLoop.scheduler()),I)throw"unwind"},_emscripten_set_main_loop=(ae,e,I)=>{var oe=getWasmTableEntry(ae);setMainLoop(oe,e,I)};_emscripten_set_main_loop.sig="vpii";var getExecutableName=()=>thisProgram||"./this.program",getEnvStrings=()=>{if(!getEnvStrings.strings){var ae=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:ae,_:getExecutableName()};for(var I in ENV)ENV[I]===void 0?delete e[I]:e[I]=ENV[I];var oe=[];for(var I in e)oe.push(`${I}=${e[I]}`);getEnvStrings.strings=oe}return getEnvStrings.strings},stringToAscii=(ae,e)=>{for(var I=0;I<ae.length;++I)HEAP8[e++]=ae.charCodeAt(I);HEAP8[e]=0},_environ_get=(ae,e)=>{var I=0;return getEnvStrings().forEach((oe,ue)=>{var bt=e+I;HEAPU32[ae+ue*4>>2]=bt,stringToAscii(oe,bt),I+=oe.length+1}),0};_environ_get.sig="ipp";var _environ_sizes_get=(ae,e)=>{var I=getEnvStrings();HEAPU32[ae>>2]=I.length;var oe=0;return I.forEach(ue=>oe+=ue.length+1),HEAPU32[e>>2]=oe,0};_environ_sizes_get.sig="ipp";function _fd_close(ae){try{var e=SYSCALLS.getStreamFromFD(ae);return FS.close(e),0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return I.errno}}_fd_close.sig="ii";function _fd_fdstat_get(ae,e){try{var I=0,oe=0,ue=0,bt=SYSCALLS.getStreamFromFD(ae),tr=bt.tty?2:FS.isDir(bt.mode)?3:FS.isLink(bt.mode)?7:4;return HEAP8[e]=tr,HEAP16[e+2>>1]=ue,HEAP64[e+8>>3]=BigInt(I),HEAP64[e+16>>3]=BigInt(oe),0}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return rr.errno}}_fd_fdstat_get.sig="iip";var doReadv=(ae,e,I,oe)=>{for(var ue=0,bt=0;bt<I;bt++){var tr=HEAPU32[e>>2],rr=HEAPU32[e+4>>2];e+=8;var ir=FS.read(ae,HEAP8,tr,rr,oe);if(ir<0)return-1;if(ue+=ir,ir<rr)break;typeof oe<"u"&&(oe+=ir)}return ue};function _fd_pread(ae,e,I,oe,ue){oe=bigintToI53Checked(oe);try{if(isNaN(oe))return 61;var bt=SYSCALLS.getStreamFromFD(ae),tr=doReadv(bt,e,I,oe);return HEAPU32[ue>>2]=tr,0}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return rr.errno}}_fd_pread.sig="iippjp";var doWritev=(ae,e,I,oe)=>{for(var ue=0,bt=0;bt<I;bt++){var tr=HEAPU32[e>>2],rr=HEAPU32[e+4>>2];e+=8;var ir=FS.write(ae,HEAP8,tr,rr,oe);if(ir<0)return-1;if(ue+=ir,ir<rr)break;typeof oe<"u"&&(oe+=ir)}return ue};function _fd_pwrite(ae,e,I,oe,ue){oe=bigintToI53Checked(oe);try{if(isNaN(oe))return 61;var bt=SYSCALLS.getStreamFromFD(ae),tr=doWritev(bt,e,I,oe);return HEAPU32[ue>>2]=tr,0}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return rr.errno}}_fd_pwrite.sig="iippjp";function _fd_read(ae,e,I,oe){try{var ue=SYSCALLS.getStreamFromFD(ae),bt=doReadv(ue,e,I);return HEAPU32[oe>>2]=bt,0}catch(tr){if(typeof FS>"u"||tr.name!=="ErrnoError")throw tr;return tr.errno}}_fd_read.sig="iippp";function _fd_seek(ae,e,I,oe){e=bigintToI53Checked(e);try{if(isNaN(e))return 61;var ue=SYSCALLS.getStreamFromFD(ae);return FS.llseek(ue,e,I),HEAP64[oe>>3]=BigInt(ue.position),ue.getdents&&e===0&&I===0&&(ue.getdents=null),0}catch(bt){if(typeof FS>"u"||bt.name!=="ErrnoError")throw bt;return bt.errno}}_fd_seek.sig="iijip";function _fd_sync(ae){try{var e=SYSCALLS.getStreamFromFD(ae);return e.stream_ops?.fsync?e.stream_ops.fsync(e):0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return I.errno}}_fd_sync.sig="ii";function _fd_write(ae,e,I,oe){try{var ue=SYSCALLS.getStreamFromFD(ae),bt=doWritev(ue,e,I);return HEAPU32[oe>>2]=bt,0}catch(tr){if(typeof FS>"u"||tr.name!=="ErrnoError")throw tr;return tr.errno}}_fd_write.sig="iippp";var _getaddrinfo=(ae,e,I,oe)=>{var ue=0,bt=0,tr=0,rr=0,ir=0,lr=0,dr;function pr(hr,_r,yr,wr,Tr,Ar){var Sr,Mr,vr,Lr;return Mr=hr===10?28:16,Tr=hr===10?inetNtop6(Tr):inetNtop4(Tr),Sr=_malloc(Mr),Lr=writeSockaddr(Sr,hr,Tr,Ar),assert(!Lr),vr=_malloc(32),HEAP32[vr+4>>2]=hr,HEAP32[vr+8>>2]=_r,HEAP32[vr+12>>2]=yr,HEAPU32[vr+24>>2]=wr,HEAPU32[vr+20>>2]=Sr,hr===10?HEAP32[vr+16>>2]=28:HEAP32[vr+16>>2]=16,HEAP32[vr+28>>2]=0,vr}if(I&&(tr=HEAP32[I>>2],rr=HEAP32[I+4>>2],ir=HEAP32[I+8>>2],lr=HEAP32[I+12>>2]),ir&&!lr&&(lr=ir===2?17:6),!ir&&lr&&(ir=lr===17?2:1),lr===0&&(lr=6),ir===0&&(ir=1),!ae&&!e)return-2;if(tr&-1088||I!==0&&HEAP32[I>>2]&2&&!ae)return-1;if(tr&32)return-2;if(ir!==0&&ir!==1&&ir!==2)return-7;if(rr!==0&&rr!==2&&rr!==10)return-6;if(e&&(e=UTF8ToString(e),bt=parseInt(e,10),isNaN(bt)))return tr&1024?-2:-8;if(!ae)return rr===0&&(rr=2),tr&1||(rr===2?ue=_htonl(2130706433):ue=[0,0,0,1]),dr=pr(rr,ir,lr,null,ue,bt),HEAPU32[oe>>2]=dr,0;if(ae=UTF8ToString(ae),ue=inetPton4(ae),ue!==null)if(rr===0||rr===2)rr=2;else if(rr===10&&tr&8)ue=[0,0,_htonl(65535),ue],rr=10;else return-2;else if(ue=inetPton6(ae),ue!==null)if(rr===0||rr===10)rr=10;else return-2;return ue!=null?(dr=pr(rr,ir,lr,ae,ue,bt),HEAPU32[oe>>2]=dr,0):tr&4?-2:(ae=DNS.lookup_name(ae),ue=inetPton4(ae),rr===0?rr=2:rr===10&&(ue=[0,0,_htonl(65535),ue]),dr=pr(rr,ir,lr,null,ue,bt),HEAPU32[oe>>2]=dr,0)};_getaddrinfo.sig="ipppp";var _getnameinfo=(ae,e,I,oe,ue,bt,tr)=>{var rr=readSockaddr(ae,e);if(rr.errno)return-6;var ir=rr.port,lr=rr.addr,dr=!1;if(I&&oe){var pr;if(tr&1||!(pr=DNS.lookup_addr(lr))){if(tr&8)return-2}else lr=pr;var hr=stringToUTF8(lr,I,oe);hr+1>=oe&&(dr=!0)}if(ue&&bt){ir=""+ir;var hr=stringToUTF8(ir,ue,bt);hr+1>=bt&&(dr=!0)}return dr?-12:0};_getnameinfo.sig="ipipipii";var stringToNewUTF8=ae=>{var e=lengthBytesUTF8(ae)+1,I=_malloc(e);return I&&stringToUTF8(ae,I,e),I},getCFunc=ae=>{var e=Module["_"+ae];return e},writeArrayToMemory=(ae,e)=>{HEAP8.set(ae,e)},ccall=(ae,e,I,oe,ue)=>{var bt={string:yr=>{var wr=0;return yr!=null&&yr!==0&&(wr=stringToUTF8OnStack(yr)),wr},array:yr=>{var wr=stackAlloc(yr.length);return writeArrayToMemory(yr,wr),wr}};function tr(yr){return e==="string"?UTF8ToString(yr):e==="boolean"?!!yr:yr}var rr=getCFunc(ae),ir=[],lr=0;if(oe)for(var dr=0;dr<oe.length;dr++){var pr=bt[I[dr]];pr?(lr===0&&(lr=stackSave()),ir[dr]=pr(oe[dr])):ir[dr]=oe[dr]}var hr=rr(...ir);function _r(yr){return lr!==0&&stackRestore(lr),tr(yr)}return hr=_r(hr),hr},cwrap=(ae,e,I,oe)=>{var ue=!I||I.every(tr=>tr==="number"||tr==="boolean"),bt=e!=="string";return bt&&ue&&!oe?getCFunc(ae):(...tr)=>ccall(ae,e,I,tr)},FS_createPath=FS.createPath,FS_unlink=ae=>FS.unlink(ae),FS_createLazyFile=FS.createLazyFile,FS_createDevice=FS.createDevice,setTempRet0=ae=>__emscripten_tempret_set(ae),_setTempRet0=setTempRet0;Module._setTempRet0=_setTempRet0;var getTempRet0=ae=>__emscripten_tempret_get(),_getTempRet0=getTempRet0;Module._getTempRet0=_getTempRet0,registerWasmPlugin(),FS.createPreloadedFile=FS_createPreloadedFile,FS.staticInit(),Module.FS_createPath=FS.createPath,Module.FS_createDataFile=FS.createDataFile,Module.FS_createPreloadedFile=FS.createPreloadedFile,Module.FS_unlink=FS.unlink,Module.FS_createLazyFile=FS.createLazyFile,Module.FS_createDevice=FS.createDevice,ENVIRONMENT_IS_NODE&&NODEFS.staticInit(),Module.requestAnimationFrame=MainLoop.requestAnimationFrame,Module.pauseMainLoop=MainLoop.pause,Module.resumeMainLoop=MainLoop.resume,MainLoop.init();var wasmImports={__assert_fail:___assert_fail,__call_sighandler:___call_sighandler,__heap_base:___heap_base,__indirect_function_table:wasmTable,__memory_base:___memory_base,__stack_pointer:___stack_pointer,__syscall__newselect:___syscall__newselect,__syscall_bind:___syscall_bind,__syscall_chdir:___syscall_chdir,__syscall_chmod:___syscall_chmod,__syscall_connect:___syscall_connect,__syscall_dup:___syscall_dup,__syscall_dup3:___syscall_dup3,__syscall_faccessat:___syscall_faccessat,__syscall_fadvise64:___syscall_fadvise64,__syscall_fallocate:___syscall_fallocate,__syscall_fcntl64:___syscall_fcntl64,__syscall_fdatasync:___syscall_fdatasync,__syscall_fstat64:___syscall_fstat64,__syscall_ftruncate64:___syscall_ftruncate64,__syscall_getcwd:___syscall_getcwd,__syscall_getdents64:___syscall_getdents64,__syscall_getsockname:___syscall_getsockname,__syscall_getsockopt:___syscall_getsockopt,__syscall_ioctl:___syscall_ioctl,__syscall_lstat64:___syscall_lstat64,__syscall_mkdirat:___syscall_mkdirat,__syscall_newfstatat:___syscall_newfstatat,__syscall_openat:___syscall_openat,__syscall_pipe:___syscall_pipe,__syscall_poll:___syscall_poll,__syscall_readlinkat:___syscall_readlinkat,__syscall_recvfrom:___syscall_recvfrom,__syscall_renameat:___syscall_renameat,__syscall_rmdir:___syscall_rmdir,__syscall_sendto:___syscall_sendto,__syscall_socket:___syscall_socket,__syscall_stat64:___syscall_stat64,__syscall_symlink:___syscall_symlink,__syscall_truncate64:___syscall_truncate64,__syscall_unlinkat:___syscall_unlinkat,__table_base:___table_base,_abort_js:__abort_js,_dlopen_js:__dlopen_js,_dlsym_js:__dlsym_js,_emscripten_get_now_is_monotonic:__emscripten_get_now_is_monotonic,_emscripten_runtime_keepalive_clear:__emscripten_runtime_keepalive_clear,_emscripten_system:__emscripten_system,_emscripten_throw_longjmp:__emscripten_throw_longjmp,_gmtime_js:__gmtime_js,_localtime_js:__localtime_js,_mmap_js:__mmap_js,_munmap_js:__munmap_js,_setitimer_js:__setitimer_js,_tzset_js:__tzset_js,emscripten_asm_const_int:_emscripten_asm_const_int,emscripten_date_now:_emscripten_date_now,emscripten_force_exit:_emscripten_force_exit,emscripten_get_now:_emscripten_get_now,emscripten_resize_heap:_emscripten_resize_heap,emscripten_set_main_loop:_emscripten_set_main_loop,environ_get:_environ_get,environ_sizes_get:_environ_sizes_get,exit:_exit,fd_close:_fd_close,fd_fdstat_get:_fd_fdstat_get,fd_pread:_fd_pread,fd_pwrite:_fd_pwrite,fd_read:_fd_read,fd_seek:_fd_seek,fd_sync:_fd_sync,fd_write:_fd_write,getTempRet0:_getTempRet0,getaddrinfo:_getaddrinfo,getnameinfo:_getnameinfo,invoke_di,invoke_i,invoke_id,invoke_ii,invoke_iii,invoke_iiii,invoke_iiiii,invoke_iiiiii,invoke_iiiiiii,invoke_iiiiiiii,invoke_iiiiiiiii,invoke_iiiiiiiiii,invoke_iiiiiiiiiiiiiiiii,invoke_iiiiiji,invoke_iiiij,invoke_iiiijii,invoke_iiij,invoke_iiji,invoke_ij,invoke_ijiiiii,invoke_ijiiiiii,invoke_ji,invoke_jii,invoke_jiiii,invoke_jiiiii,invoke_jiiiiiiii,invoke_v,invoke_vi,invoke_vid,invoke_vii,invoke_viii,invoke_viiii,invoke_viiiii,invoke_viiiiii,invoke_viiiiiii,invoke_viiiiiiii,invoke_viiiiiiiii,invoke_viiiiiiiiiiii,invoke_viiij,invoke_viij,invoke_viiji,invoke_viijii,invoke_viijiiii,invoke_vij,invoke_viji,invoke_vijiji,invoke_vj,invoke_vji,is_web_env,memory:wasmMemory,proc_exit:_proc_exit,setTempRet0:_setTempRet0},wasmExports=createWasm();Module._ScanKeywordLookup=(ae,e)=>(Module._ScanKeywordLookup=wasmExports.ScanKeywordLookup)(ae,e),Module._pg_snprintf=(ae,e,I,oe)=>(Module._pg_snprintf=wasmExports.pg_snprintf)(ae,e,I,oe),Module._strlen=ae=>(Module._strlen=wasmExports.strlen)(ae),Module._memset=(ae,e,I)=>(Module._memset=wasmExports.memset)(ae,e,I),Module._strchr=(ae,e)=>(Module._strchr=wasmExports.strchr)(ae,e),Module._PQserverVersion=ae=>(Module._PQserverVersion=wasmExports.PQserverVersion)(ae),Module._strstr=(ae,e)=>(Module._strstr=wasmExports.strstr)(ae,e),Module._pg_fprintf=(ae,e,I)=>(Module._pg_fprintf=wasmExports.pg_fprintf)(ae,e,I),Module._strspn=(ae,e)=>(Module._strspn=wasmExports.strspn)(ae,e);var _malloc=Module._malloc=ae=>(_malloc=Module._malloc=wasmExports.malloc)(ae);Module._pg_strcasecmp=(ae,e)=>(Module._pg_strcasecmp=wasmExports.pg_strcasecmp)(ae,e),Module._strcmp=(ae,e)=>(Module._strcmp=wasmExports.strcmp)(ae,e),Module._free=ae=>(Module._free=wasmExports.free)(ae),Module._pg_tolower=ae=>(Module._pg_tolower=wasmExports.pg_tolower)(ae),Module._memchr=(ae,e,I)=>(Module._memchr=wasmExports.memchr)(ae,e,I),Module._getenv=ae=>(Module._getenv=wasmExports.getenv)(ae),Module._fileno=ae=>(Module._fileno=wasmExports.fileno)(ae),Module._isatty=ae=>(Module._isatty=wasmExports.isatty)(ae),Module._strdup=ae=>(Module._strdup=wasmExports.strdup)(ae),Module.___errno_location=()=>(Module.___errno_location=wasmExports.__errno_location)();var _fflush=Module._fflush=ae=>(_fflush=Module._fflush=wasmExports.fflush)(ae);Module._pg_vsnprintf=(ae,e,I,oe)=>(Module._pg_vsnprintf=wasmExports.pg_vsnprintf)(ae,e,I,oe),Module._pg_malloc_extended=(ae,e)=>(Module._pg_malloc_extended=wasmExports.pg_malloc_extended)(ae,e),Module._find_base_rel=(ae,e)=>(Module._find_base_rel=wasmExports.find_base_rel)(ae,e),Module._errstart_cold=(ae,e)=>(Module._errstart_cold=wasmExports.errstart_cold)(ae,e),Module._errmsg_internal=(ae,e)=>(Module._errmsg_internal=wasmExports.errmsg_internal)(ae,e),Module._errfinish=(ae,e,I)=>(Module._errfinish=wasmExports.errfinish)(ae,e,I),Module._puts=ae=>(Module._puts=wasmExports.puts)(ae),Module._lappend=(ae,e)=>(Module._lappend=wasmExports.lappend)(ae,e),Module._list_concat=(ae,e)=>(Module._list_concat=wasmExports.list_concat)(ae,e),Module._bms_equal=(ae,e)=>(Module._bms_equal=wasmExports.bms_equal)(ae,e),Module._add_path=(ae,e)=>(Module._add_path=wasmExports.add_path)(ae,e),Module._pathkeys_contained_in=(ae,e)=>(Module._pathkeys_contained_in=wasmExports.pathkeys_contained_in)(ae,e),Module._bms_is_subset=(ae,e)=>(Module._bms_is_subset=wasmExports.bms_is_subset)(ae,e),Module._list_make1_impl=(ae,e)=>(Module._list_make1_impl=wasmExports.list_make1_impl)(ae,e),Module._create_sort_path=(ae,e,I,oe,ue)=>(Module._create_sort_path=wasmExports.create_sort_path)(ae,e,I,oe,ue),Module._palloc0=ae=>(Module._palloc0=wasmExports.palloc0)(ae),Module._check_stack_depth=()=>(Module._check_stack_depth=wasmExports.check_stack_depth)(),Module._list_free=ae=>(Module._list_free=wasmExports.list_free)(ae),Module._bms_overlap=(ae,e)=>(Module._bms_overlap=wasmExports.bms_overlap)(ae,e),Module._exprType=ae=>(Module._exprType=wasmExports.exprType)(ae),Module._exprTypmod=ae=>(Module._exprTypmod=wasmExports.exprTypmod)(ae),Module._set_baserel_size_estimates=(ae,e)=>(Module._set_baserel_size_estimates=wasmExports.set_baserel_size_estimates)(ae,e),Module._copyObjectImpl=ae=>(Module._copyObjectImpl=wasmExports.copyObjectImpl)(ae),Module._pull_var_clause=(ae,e)=>(Module._pull_var_clause=wasmExports.pull_var_clause)(ae,e),Module._pfree=ae=>(Module._pfree=wasmExports.pfree)(ae),Module._pull_varattnos=(ae,e,I)=>(Module._pull_varattnos=wasmExports.pull_varattnos)(ae,e,I),Module._bms_is_member=(ae,e)=>(Module._bms_is_member=wasmExports.bms_is_member)(ae,e),Module._clamp_row_est=ae=>(Module._clamp_row_est=wasmExports.clamp_row_est)(ae),Module._get_opfamily_member=(ae,e,I,oe)=>(Module._get_opfamily_member=wasmExports.get_opfamily_member)(ae,e,I,oe),Module._bms_add_member=(ae,e)=>(Module._bms_add_member=wasmExports.bms_add_member)(ae,e),Module._bms_membership=ae=>(Module._bms_membership=wasmExports.bms_membership)(ae),Module._join_clause_is_movable_to=(ae,e)=>(Module._join_clause_is_movable_to=wasmExports.join_clause_is_movable_to)(ae,e),Module._generate_implied_equalities_for_column=(ae,e,I,oe,ue)=>(Module._generate_implied_equalities_for_column=wasmExports.generate_implied_equalities_for_column)(ae,e,I,oe,ue),Module._palloc=ae=>(Module._palloc=wasmExports.palloc)(ae),Module._pg_qsort=(ae,e,I,oe)=>(Module._pg_qsort=wasmExports.pg_qsort)(ae,e,I,oe),Module._equal=(ae,e)=>(Module._equal=wasmExports.equal)(ae,e),Module._bms_add_members=(ae,e)=>(Module._bms_add_members=wasmExports.bms_add_members)(ae,e),Module._bms_next_member=(ae,e)=>(Module._bms_next_member=wasmExports.bms_next_member)(ae,e),Module._estimate_num_groups=(ae,e,I,oe,ue)=>(Module._estimate_num_groups=wasmExports.estimate_num_groups)(ae,e,I,oe,ue),Module._list_copy=ae=>(Module._list_copy=wasmExports.list_copy)(ae),Module._bms_union=(ae,e)=>(Module._bms_union=wasmExports.bms_union)(ae,e),Module._get_plan_rowmark=(ae,e)=>(Module._get_plan_rowmark=wasmExports.get_plan_rowmark)(ae,e),Module._contain_mutable_functions=ae=>(Module._contain_mutable_functions=wasmExports.contain_mutable_functions)(ae),Module._list_member_oid=(ae,e)=>(Module._list_member_oid=wasmExports.list_member_oid)(ae,e),Module._MemoryContextAllocZeroAligned=(ae,e)=>(Module._MemoryContextAllocZeroAligned=wasmExports.MemoryContextAllocZeroAligned)(ae,e),Module._make_restrictinfo=(ae,e,I,oe,ue,bt,tr,rr,ir,lr)=>(Module._make_restrictinfo=wasmExports.make_restrictinfo)(ae,e,I,oe,ue,bt,tr,rr,ir,lr),Module._list_member=(ae,e)=>(Module._list_member=wasmExports.list_member)(ae,e),Module._bms_del_member=(ae,e)=>(Module._bms_del_member=wasmExports.bms_del_member)(ae,e),Module._list_make2_impl=(ae,e,I)=>(Module._list_make2_impl=wasmExports.list_make2_impl)(ae,e,I),Module._lappend_int=(ae,e)=>(Module._lappend_int=wasmExports.lappend_int)(ae,e),Module._bms_free=ae=>(Module._bms_free=wasmExports.bms_free)(ae),Module._lappend_oid=(ae,e)=>(Module._lappend_oid=wasmExports.lappend_oid)(ae,e),Module._update_mergeclause_eclasses=(ae,e)=>(Module._update_mergeclause_eclasses=wasmExports.update_mergeclause_eclasses)(ae,e),Module._bms_nonempty_difference=(ae,e)=>(Module._bms_nonempty_difference=wasmExports.bms_nonempty_difference)(ae,e),Module._bms_num_members=ae=>(Module._bms_num_members=wasmExports.bms_num_members)(ae),Module._lookup_type_cache=(ae,e)=>(Module._lookup_type_cache=wasmExports.lookup_type_cache)(ae,e),Module._errcode=ae=>(Module._errcode=wasmExports.errcode)(ae),Module._errmsg=(ae,e)=>(Module._errmsg=wasmExports.errmsg)(ae,e),Module._find_join_rel=(ae,e)=>(Module._find_join_rel=wasmExports.find_join_rel)(ae,e),Module._clauselist_selectivity=(ae,e,I,oe,ue)=>(Module._clauselist_selectivity=wasmExports.clauselist_selectivity)(ae,e,I,oe,ue),Module._estimate_expression_value=(ae,e)=>(Module._estimate_expression_value=wasmExports.estimate_expression_value)(ae,e),Module._get_tablespace_page_costs=(ae,e,I)=>(Module._get_tablespace_page_costs=wasmExports.get_tablespace_page_costs)(ae,e,I),Module._log=ae=>(Module._log=wasmExports.log)(ae),Module._cost_qual_eval=(ae,e,I)=>(Module._cost_qual_eval=wasmExports.cost_qual_eval)(ae,e,I),Module._cost_sort=(ae,e,I,oe,ue,bt,tr,rr,ir)=>(Module._cost_sort=wasmExports.cost_sort)(ae,e,I,oe,ue,bt,tr,rr,ir),Module._getTypeInputInfo=(ae,e,I)=>(Module._getTypeInputInfo=wasmExports.getTypeInputInfo)(ae,e,I),Module._getTypeOutputInfo=(ae,e,I)=>(Module._getTypeOutputInfo=wasmExports.getTypeOutputInfo)(ae,e,I),Module._list_member_ptr=(ae,e)=>(Module._list_member_ptr=wasmExports.list_member_ptr)(ae,e),Module._list_delete_cell=(ae,e)=>(Module._list_delete_cell=wasmExports.list_delete_cell)(ae,e),Module._bms_make_singleton=ae=>(Module._bms_make_singleton=wasmExports.bms_make_singleton)(ae),Module._eclass_useful_for_merging=(ae,e,I)=>(Module._eclass_useful_for_merging=wasmExports.eclass_useful_for_merging)(ae,e,I),Module._make_canonical_pathkey=(ae,e,I,oe,ue)=>(Module._make_canonical_pathkey=wasmExports.make_canonical_pathkey)(ae,e,I,oe,ue),Module._get_sortgroupref_tle=(ae,e)=>(Module._get_sortgroupref_tle=wasmExports.get_sortgroupref_tle)(ae,e),Module._errdetail=(ae,e)=>(Module._errdetail=wasmExports.errdetail)(ae,e),Module._create_projection_path=(ae,e,I,oe)=>(Module._create_projection_path=wasmExports.create_projection_path)(ae,e,I,oe),Module._pstrdup=ae=>(Module._pstrdup=wasmExports.pstrdup)(ae),Module._makeTargetEntry=(ae,e,I,oe)=>(Module._makeTargetEntry=wasmExports.makeTargetEntry)(ae,e,I,oe),Module._makeVar=(ae,e,I,oe,ue,bt)=>(Module._makeVar=wasmExports.makeVar)(ae,e,I,oe,ue,bt),Module._grouping_is_sortable=ae=>(Module._grouping_is_sortable=wasmExports.grouping_is_sortable)(ae),Module._ProcessInterrupts=()=>(Module._ProcessInterrupts=wasmExports.ProcessInterrupts)(),Module._table_open=(ae,e)=>(Module._table_open=wasmExports.table_open)(ae,e),Module._tlist_member=(ae,e)=>(Module._tlist_member=wasmExports.tlist_member)(ae,e),Module._table_close=(ae,e)=>(Module._table_close=wasmExports.table_close)(ae,e),Module._SearchSysCache1=(ae,e)=>(Module._SearchSysCache1=wasmExports.SearchSysCache1)(ae,e),Module._get_typlenbyval=(ae,e,I)=>(Module._get_typlenbyval=wasmExports.get_typlenbyval)(ae,e,I),Module._SysCacheGetAttr=(ae,e,I,oe)=>(Module._SysCacheGetAttr=wasmExports.SysCacheGetAttr)(ae,e,I,oe),Module._text_to_cstring=ae=>(Module._text_to_cstring=wasmExports.text_to_cstring)(ae),Module._ReleaseSysCache=ae=>(Module._ReleaseSysCache=wasmExports.ReleaseSysCache)(ae),Module._datumIsEqual=(ae,e,I,oe)=>(Module._datumIsEqual=wasmExports.datumIsEqual)(ae,e,I,oe),Module._get_agg_clause_costs=(ae,e,I)=>(Module._get_agg_clause_costs=wasmExports.get_agg_clause_costs)(ae,e,I),Module._make_orclause=ae=>(Module._make_orclause=wasmExports.make_orclause)(ae),Module._SearchSysCacheAttName=(ae,e)=>(Module._SearchSysCacheAttName=wasmExports.SearchSysCacheAttName)(ae,e),Module._get_rel_name=ae=>(Module._get_rel_name=wasmExports.get_rel_name)(ae),Module._memcpy=(ae,e,I)=>(Module._memcpy=wasmExports.memcpy)(ae,e,I),Module._get_translated_update_targetlist=(ae,e,I,oe)=>(Module._get_translated_update_targetlist=wasmExports.get_translated_update_targetlist)(ae,e,I,oe),Module._add_row_identity_var=(ae,e,I,oe)=>(Module._add_row_identity_var=wasmExports.add_row_identity_var)(ae,e,I,oe),Module._get_baserel_parampathinfo=(ae,e,I)=>(Module._get_baserel_parampathinfo=wasmExports.get_baserel_parampathinfo)(ae,e,I),Module._list_sort=(ae,e)=>(Module._list_sort=wasmExports.list_sort)(ae,e),Module._create_foreignscan_path=(ae,e,I,oe,ue,bt,tr,rr,ir,lr)=>(Module._create_foreignscan_path=wasmExports.create_foreignscan_path)(ae,e,I,oe,ue,bt,tr,rr,ir,lr),Module._create_foreign_join_path=(ae,e,I,oe,ue,bt,tr,rr,ir,lr)=>(Module._create_foreign_join_path=wasmExports.create_foreign_join_path)(ae,e,I,oe,ue,bt,tr,rr,ir,lr),Module._create_foreign_upper_path=(ae,e,I,oe,ue,bt,tr,rr,ir)=>(Module._create_foreign_upper_path=wasmExports.create_foreign_upper_path)(ae,e,I,oe,ue,bt,tr,rr,ir),Module._adjust_limit_rows_costs=(ae,e,I,oe,ue)=>(Module._adjust_limit_rows_costs=wasmExports.adjust_limit_rows_costs)(ae,e,I,oe,ue),Module._copy_pathtarget=ae=>(Module._copy_pathtarget=wasmExports.copy_pathtarget)(ae),Module._makeString=ae=>(Module._makeString=wasmExports.makeString)(ae),Module._get_rel_all_updated_cols=(ae,e)=>(Module._get_rel_all_updated_cols=wasmExports.get_rel_all_updated_cols)(ae,e),Module._pg_detoast_datum=ae=>(Module._pg_detoast_datum=wasmExports.pg_detoast_datum)(ae),Module._ArrayGetNItems=(ae,e)=>(Module._ArrayGetNItems=wasmExports.ArrayGetNItems)(ae,e),Module._get_typlenbyvalalign=(ae,e,I,oe)=>(Module._get_typlenbyvalalign=wasmExports.get_typlenbyvalalign)(ae,e,I,oe),Module._deconstruct_array=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._deconstruct_array=wasmExports.deconstruct_array)(ae,e,I,oe,ue,bt,tr,rr),Module._CreateExecutorState=()=>(Module._CreateExecutorState=wasmExports.CreateExecutorState)(),Module._ExecInitExpr=(ae,e)=>(Module._ExecInitExpr=wasmExports.ExecInitExpr)(ae,e),Module._MakePerTupleExprContext=ae=>(Module._MakePerTupleExprContext=wasmExports.MakePerTupleExprContext)(ae),Module._FreeExecutorState=ae=>(Module._FreeExecutorState=wasmExports.FreeExecutorState)(ae),Module._errstart=(ae,e)=>(Module._errstart=wasmExports.errstart)(ae,e),Module._hash_create=(ae,e,I,oe)=>(Module._hash_create=wasmExports.hash_create)(ae,e,I,oe),Module._CacheRegisterSyscacheCallback=(ae,e,I)=>(Module._CacheRegisterSyscacheCallback=wasmExports.CacheRegisterSyscacheCallback)(ae,e,I),Module._hash_search=(ae,e,I,oe)=>(Module._hash_search=wasmExports.hash_search)(ae,e,I,oe),Module._list_free_deep=ae=>(Module._list_free_deep=wasmExports.list_free_deep)(ae),Module._hash_seq_init=(ae,e)=>(Module._hash_seq_init=wasmExports.hash_seq_init)(ae,e),Module._hash_seq_search=ae=>(Module._hash_seq_search=wasmExports.hash_seq_search)(ae),Module._add_to_flat_tlist=(ae,e)=>(Module._add_to_flat_tlist=wasmExports.add_to_flat_tlist)(ae,e),Module._get_sortgrouplist_exprs=(ae,e)=>(Module._get_sortgrouplist_exprs=wasmExports.get_sortgrouplist_exprs)(ae,e),Module._get_sortgroupref_clause_noerr=(ae,e)=>(Module._get_sortgroupref_clause_noerr=wasmExports.get_sortgroupref_clause_noerr)(ae,e),Module._repalloc=(ae,e)=>(Module._repalloc=wasmExports.repalloc)(ae,e),Module._add_new_columns_to_pathtarget=(ae,e)=>(Module._add_new_columns_to_pathtarget=wasmExports.add_new_columns_to_pathtarget)(ae,e),Module._GetUserId=()=>(Module._GetUserId=wasmExports.GetUserId)(),Module._list_append_unique_ptr=(ae,e)=>(Module._list_append_unique_ptr=wasmExports.list_append_unique_ptr)(ae,e),Module._extract_actual_clauses=(ae,e)=>(Module._extract_actual_clauses=wasmExports.extract_actual_clauses)(ae,e),Module._errdetail_relkind_not_supported=ae=>(Module._errdetail_relkind_not_supported=wasmExports.errdetail_relkind_not_supported)(ae),Module._RecoveryInProgress=()=>(Module._RecoveryInProgress=wasmExports.RecoveryInProgress)(),Module._RelationGetIndexList=ae=>(Module._RelationGetIndexList=wasmExports.RelationGetIndexList)(ae),Module._index_open=(ae,e)=>(Module._index_open=wasmExports.index_open)(ae,e),Module._index_close=(ae,e)=>(Module._index_close=wasmExports.index_close)(ae,e),Module._TransactionIdPrecedes=(ae,e)=>(Module._TransactionIdPrecedes=wasmExports.TransactionIdPrecedes)(ae,e),Module._RelationGetNumberOfBlocksInFork=(ae,e)=>(Module._RelationGetNumberOfBlocksInFork=wasmExports.RelationGetNumberOfBlocksInFork)(ae,e),Module._stringToNode=ae=>(Module._stringToNode=wasmExports.stringToNode)(ae),Module._memcmp=(ae,e,I)=>(Module._memcmp=wasmExports.memcmp)(ae,e,I),Module._fmgr_info_copy=(ae,e,I)=>(Module._fmgr_info_copy=wasmExports.fmgr_info_copy)(ae,e,I),Module._SearchSysCache2=(ae,e,I)=>(Module._SearchSysCache2=wasmExports.SearchSysCache2)(ae,e,I),Module._list_member_int=(ae,e)=>(Module._list_member_int=wasmExports.list_member_int)(ae,e),Module._datumCopy=(ae,e,I)=>(Module._datumCopy=wasmExports.datumCopy)(ae,e,I),Module._list_make3_impl=(ae,e,I,oe)=>(Module._list_make3_impl=wasmExports.list_make3_impl)(ae,e,I,oe),Module._SysCacheGetAttrNotNull=(ae,e,I)=>(Module._SysCacheGetAttrNotNull=wasmExports.SysCacheGetAttrNotNull)(ae,e,I),Module._pg_detoast_datum_copy=ae=>(Module._pg_detoast_datum_copy=wasmExports.pg_detoast_datum_copy)(ae),Module._object_aclcheck=(ae,e,I,oe)=>(Module._object_aclcheck=wasmExports.object_aclcheck)(ae,e,I,oe),Module._AllocSetContextCreateInternal=(ae,e,I,oe,ue)=>(Module._AllocSetContextCreateInternal=wasmExports.AllocSetContextCreateInternal)(ae,e,I,oe,ue),Module._MemoryContextDelete=ae=>(Module._MemoryContextDelete=wasmExports.MemoryContextDelete)(ae),Module._geterrposition=()=>(Module._geterrposition=wasmExports.geterrposition)(),Module._errposition=ae=>(Module._errposition=wasmExports.errposition)(ae),Module._internalerrposition=ae=>(Module._internalerrposition=wasmExports.internalerrposition)(ae),Module._internalerrquery=ae=>(Module._internalerrquery=wasmExports.internalerrquery)(ae),Module._set_errcontext_domain=ae=>(Module._set_errcontext_domain=wasmExports.set_errcontext_domain)(ae),Module._errcontext_msg=(ae,e)=>(Module._errcontext_msg=wasmExports.errcontext_msg)(ae,e),Module._list_delete_last=ae=>(Module._list_delete_last=wasmExports.list_delete_last)(ae),Module._lookup_rowtype_tupdesc_domain=(ae,e,I)=>(Module._lookup_rowtype_tupdesc_domain=wasmExports.lookup_rowtype_tupdesc_domain)(ae,e,I),Module._DecrTupleDescRefCount=ae=>(Module._DecrTupleDescRefCount=wasmExports.DecrTupleDescRefCount)(ae),Module._type_is_rowtype=ae=>(Module._type_is_rowtype=wasmExports.type_is_rowtype)(ae),Module._Int64GetDatum=ae=>(Module._Int64GetDatum=wasmExports.Int64GetDatum)(ae),Module._GetSysCacheHashValue=(ae,e,I,oe,ue)=>(Module._GetSysCacheHashValue=wasmExports.GetSysCacheHashValue)(ae,e,I,oe,ue),Module._addRTEPermissionInfo=(ae,e)=>(Module._addRTEPermissionInfo=wasmExports.addRTEPermissionInfo)(ae,e),Module._change_plan_targetlist=(ae,e,I)=>(Module._change_plan_targetlist=wasmExports.change_plan_targetlist)(ae,e,I),Module._make_foreignscan=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._make_foreignscan=wasmExports.make_foreignscan)(ae,e,I,oe,ue,bt,tr,rr),Module._standard_planner=(ae,e,I,oe)=>(Module._standard_planner=wasmExports.standard_planner)(ae,e,I,oe),Module._plan_create_index_workers=(ae,e)=>(Module._plan_create_index_workers=wasmExports.plan_create_index_workers)(ae,e),Module._psprintf=(ae,e)=>(Module._psprintf=wasmExports.psprintf)(ae,e),Module._format_type_be=ae=>(Module._format_type_be=wasmExports.format_type_be)(ae),Module._pg_sprintf=(ae,e,I)=>(Module._pg_sprintf=wasmExports.pg_sprintf)(ae,e,I),Module._pg_prng_double=ae=>(Module._pg_prng_double=wasmExports.pg_prng_double)(ae),Module._pg_prng_uint64_range=(ae,e,I)=>(Module._pg_prng_uint64_range=wasmExports.pg_prng_uint64_range)(ae,e,I),Module._qsort_arg=(ae,e,I,oe,ue)=>(Module._qsort_arg=wasmExports.qsort_arg)(ae,e,I,oe,ue),Module._FunctionCall2Coll=(ae,e,I,oe)=>(Module._FunctionCall2Coll=wasmExports.FunctionCall2Coll)(ae,e,I,oe),Module._parser_errposition=(ae,e)=>(Module._parser_errposition=wasmExports.parser_errposition)(ae,e),Module._ExecPrepareExpr=(ae,e)=>(Module._ExecPrepareExpr=wasmExports.ExecPrepareExpr)(ae,e),Module._RegisterSnapshot=ae=>(Module._RegisterSnapshot=wasmExports.RegisterSnapshot)(ae),Module._MemoryContextReset=ae=>(Module._MemoryContextReset=wasmExports.MemoryContextReset)(ae),Module._UnregisterSnapshot=ae=>(Module._UnregisterSnapshot=wasmExports.UnregisterSnapshot)(ae),Module._ExecDropSingleTupleTableSlot=ae=>(Module._ExecDropSingleTupleTableSlot=wasmExports.ExecDropSingleTupleTableSlot)(ae),Module._relation_open=(ae,e)=>(Module._relation_open=wasmExports.relation_open)(ae,e),Module._MemoryContextAllocZero=(ae,e)=>(Module._MemoryContextAllocZero=wasmExports.MemoryContextAllocZero)(ae,e),Module._get_fn_expr_argtype=(ae,e)=>(Module._get_fn_expr_argtype=wasmExports.get_fn_expr_argtype)(ae,e),Module._relation_close=(ae,e)=>(Module._relation_close=wasmExports.relation_close)(ae,e),Module._get_element_type=ae=>(Module._get_element_type=wasmExports.get_element_type)(ae),Module._GetActiveSnapshot=()=>(Module._GetActiveSnapshot=wasmExports.GetActiveSnapshot)(),Module._ScanKeyInit=(ae,e,I,oe,ue)=>(Module._ScanKeyInit=wasmExports.ScanKeyInit)(ae,e,I,oe,ue),Module._systable_beginscan=(ae,e,I,oe,ue,bt)=>(Module._systable_beginscan=wasmExports.systable_beginscan)(ae,e,I,oe,ue,bt),Module._systable_getnext=ae=>(Module._systable_getnext=wasmExports.systable_getnext)(ae),Module._getmissingattr=(ae,e,I)=>(Module._getmissingattr=wasmExports.getmissingattr)(ae,e,I),Module._nocachegetattr=(ae,e,I)=>(Module._nocachegetattr=wasmExports.nocachegetattr)(ae,e,I),Module._systable_endscan=ae=>(Module._systable_endscan=wasmExports.systable_endscan)(ae),Module._get_rel_relkind=ae=>(Module._get_rel_relkind=wasmExports.get_rel_relkind)(ae),Module._MemoryContextStrdup=(ae,e)=>(Module._MemoryContextStrdup=wasmExports.MemoryContextStrdup)(ae,e),Module._MemoryContextSetIdentifier=(ae,e)=>(Module._MemoryContextSetIdentifier=wasmExports.MemoryContextSetIdentifier)(ae,e),Module._MemoryContextSetParent=(ae,e)=>(Module._MemoryContextSetParent=wasmExports.MemoryContextSetParent)(ae,e),Module._fmgr_info_cxt=(ae,e,I)=>(Module._fmgr_info_cxt=wasmExports.fmgr_info_cxt)(ae,e,I),Module._stat=(ae,e)=>(Module._stat=wasmExports.stat)(ae,e),Module._errcode_for_file_access=()=>(Module._errcode_for_file_access=wasmExports.errcode_for_file_access)(),Module._on_shmem_exit=(ae,e)=>(Module._on_shmem_exit=wasmExports.on_shmem_exit)(ae,e),Module._errhint=(ae,e)=>(Module._errhint=wasmExports.errhint)(ae,e),Module._getpid=()=>(Module._getpid=wasmExports.getpid)(),Module._LWLockAcquire=(ae,e)=>(Module._LWLockAcquire=wasmExports.LWLockAcquire)(ae,e),Module._LWLockRelease=ae=>(Module._LWLockRelease=wasmExports.LWLockRelease)(ae),Module._unlink=ae=>(Module._unlink=wasmExports.unlink)(ae),Module._strcpy=(ae,e)=>(Module._strcpy=wasmExports.strcpy)(ae,e),Module._wait_result_to_str=ae=>(Module._wait_result_to_str=wasmExports.wait_result_to_str)(ae),Module._replace_percent_placeholders=(ae,e,I,oe)=>(Module._replace_percent_placeholders=wasmExports.replace_percent_placeholders)(ae,e,I,oe),Module._strlcpy=(ae,e,I)=>(Module._strlcpy=wasmExports.strlcpy)(ae,e,I),Module._fd_durable_rename=(ae,e,I)=>(Module._fd_durable_rename=wasmExports.fd_durable_rename)(ae,e,I),Module._AllocateFile=(ae,e)=>(Module._AllocateFile=wasmExports.AllocateFile)(ae,e),Module._FreeFile=ae=>(Module._FreeFile=wasmExports.FreeFile)(ae),Module._errmsg_plural=(ae,e,I,oe)=>(Module._errmsg_plural=wasmExports.errmsg_plural)(ae,e,I,oe),Module._XLogBeginInsert=()=>(Module._XLogBeginInsert=wasmExports.XLogBeginInsert)(),Module._XLogRegisterData=(ae,e)=>(Module._XLogRegisterData=wasmExports.XLogRegisterData)(ae,e),Module._XLogInsert=(ae,e)=>(Module._XLogInsert=wasmExports.XLogInsert)(ae,e),Module._GetMultiXactIdMembers=(ae,e,I,oe)=>(Module._GetMultiXactIdMembers=wasmExports.GetMultiXactIdMembers)(ae,e,I,oe),Module._TransactionIdIsInProgress=ae=>(Module._TransactionIdIsInProgress=wasmExports.TransactionIdIsInProgress)(ae),Module._TransactionIdDidCommit=ae=>(Module._TransactionIdDidCommit=wasmExports.TransactionIdDidCommit)(ae),Module._pg_usleep=ae=>(Module._pg_usleep=wasmExports.pg_usleep)(ae),Module._TransactionIdIsCurrentTransactionId=ae=>(Module._TransactionIdIsCurrentTransactionId=wasmExports.TransactionIdIsCurrentTransactionId)(ae),Module._ReadMultiXactIdRange=(ae,e)=>(Module._ReadMultiXactIdRange=wasmExports.ReadMultiXactIdRange)(ae,e),Module._initStringInfo=ae=>(Module._initStringInfo=wasmExports.initStringInfo)(ae),Module._appendStringInfo=(ae,e,I)=>(Module._appendStringInfo=wasmExports.appendStringInfo)(ae,e,I),Module._appendStringInfoChar=(ae,e)=>(Module._appendStringInfoChar=wasmExports.appendStringInfoChar)(ae,e),Module._MemoryContextAlloc=(ae,e)=>(Module._MemoryContextAlloc=wasmExports.MemoryContextAlloc)(ae,e),Module._MultiXactIdPrecedes=(ae,e)=>(Module._MultiXactIdPrecedes=wasmExports.MultiXactIdPrecedes)(ae,e),Module._add_size=(ae,e)=>(Module._add_size=wasmExports.add_size)(ae,e),Module._ShmemInitStruct=(ae,e,I)=>(Module._ShmemInitStruct=wasmExports.ShmemInitStruct)(ae,e,I),Module._MultiXactIdPrecedesOrEquals=(ae,e)=>(Module._MultiXactIdPrecedesOrEquals=wasmExports.MultiXactIdPrecedesOrEquals)(ae,e),Module._init_MultiFuncCall=ae=>(Module._init_MultiFuncCall=wasmExports.init_MultiFuncCall)(ae),Module._get_call_result_type=(ae,e,I)=>(Module._get_call_result_type=wasmExports.get_call_result_type)(ae,e,I),Module._TupleDescGetAttInMetadata=ae=>(Module._TupleDescGetAttInMetadata=wasmExports.TupleDescGetAttInMetadata)(ae),Module._per_MultiFuncCall=ae=>(Module._per_MultiFuncCall=wasmExports.per_MultiFuncCall)(ae),Module._BuildTupleFromCStrings=(ae,e)=>(Module._BuildTupleFromCStrings=wasmExports.BuildTupleFromCStrings)(ae,e),Module._HeapTupleHeaderGetDatum=ae=>(Module._HeapTupleHeaderGetDatum=wasmExports.HeapTupleHeaderGetDatum)(ae),Module._end_MultiFuncCall=(ae,e)=>(Module._end_MultiFuncCall=wasmExports.end_MultiFuncCall)(ae,e),Module._before_shmem_exit=(ae,e)=>(Module._before_shmem_exit=wasmExports.before_shmem_exit)(ae,e),Module._CreateTemplateTupleDesc=ae=>(Module._CreateTemplateTupleDesc=wasmExports.CreateTemplateTupleDesc)(ae),Module._TupleDescInitEntry=(ae,e,I,oe,ue,bt)=>(Module._TupleDescInitEntry=wasmExports.TupleDescInitEntry)(ae,e,I,oe,ue,bt),Module._BlessTupleDesc=ae=>(Module._BlessTupleDesc=wasmExports.BlessTupleDesc)(ae),Module._cstring_to_text=ae=>(Module._cstring_to_text=wasmExports.cstring_to_text)(ae),Module._heap_form_tuple=(ae,e,I)=>(Module._heap_form_tuple=wasmExports.heap_form_tuple)(ae,e,I),Module._OpenTransientFile=(ae,e)=>(Module._OpenTransientFile=wasmExports.OpenTransientFile)(ae,e),Module._fstat=(ae,e)=>(Module._fstat=wasmExports.fstat)(ae,e),Module._read=(ae,e,I)=>(Module._read=wasmExports.read)(ae,e,I),Module._CloseTransientFile=ae=>(Module._CloseTransientFile=wasmExports.CloseTransientFile)(ae),Module._superuser_arg=ae=>(Module._superuser_arg=wasmExports.superuser_arg)(ae),Module._GetCurrentTimestamp=()=>(Module._GetCurrentTimestamp=wasmExports.GetCurrentTimestamp)(),Module._wal_segment_close=ae=>(Module._wal_segment_close=wasmExports.wal_segment_close)(ae),Module._wal_segment_open=(ae,e,I)=>(Module._wal_segment_open=wasmExports.wal_segment_open)(ae,e,I),Module._XLogReaderAllocate=(ae,e,I,oe)=>(Module._XLogReaderAllocate=wasmExports.XLogReaderAllocate)(ae,e,I,oe),Module._XLogReadRecord=(ae,e)=>(Module._XLogReadRecord=wasmExports.XLogReadRecord)(ae,e),Module._XLogReaderFree=ae=>(Module._XLogReaderFree=wasmExports.XLogReaderFree)(ae),Module._write=(ae,e,I)=>(Module._write=wasmExports.write)(ae,e,I),Module._fd_fsync_fname=(ae,e)=>(Module._fd_fsync_fname=wasmExports.fd_fsync_fname)(ae,e),Module._AllocateDir=ae=>(Module._AllocateDir=wasmExports.AllocateDir)(ae),Module._ReadDir=(ae,e)=>(Module._ReadDir=wasmExports.ReadDir)(ae,e),Module._strtoul=(ae,e,I)=>(Module._strtoul=wasmExports.strtoul)(ae,e,I),Module._FreeDir=ae=>(Module._FreeDir=wasmExports.FreeDir)(ae),Module._access=(ae,e)=>(Module._access=wasmExports.access)(ae,e),Module._palloc_extended=(ae,e)=>(Module._palloc_extended=wasmExports.palloc_extended)(ae,e),Module._XLogFindNextRecord=(ae,e)=>(Module._XLogFindNextRecord=wasmExports.XLogFindNextRecord)(ae,e),Module._XLogRecGetBlockTagExtended=(ae,e,I,oe,ue,bt)=>(Module._XLogRecGetBlockTagExtended=wasmExports.XLogRecGetBlockTagExtended)(ae,e,I,oe,ue,bt),Module._RestoreBlockImage=(ae,e,I)=>(Module._RestoreBlockImage=wasmExports.RestoreBlockImage)(ae,e,I),Module._LWLockInitialize=(ae,e)=>(Module._LWLockInitialize=wasmExports.LWLockInitialize)(ae,e),Module._pwrite=(ae,e,I,oe)=>(Module._pwrite=wasmExports.pwrite)(ae,e,I,oe),Module._lseek=(ae,e,I)=>(Module._lseek=wasmExports.lseek)(ae,e,I),Module._strtol=(ae,e,I)=>(Module._strtol=wasmExports.strtol)(ae,e,I),Module._CreateParallelContext=(ae,e,I)=>(Module._CreateParallelContext=wasmExports.CreateParallelContext)(ae,e,I),Module._GetCurrentSubTransactionId=()=>(Module._GetCurrentSubTransactionId=wasmExports.GetCurrentSubTransactionId)(),Module._InitializeParallelDSM=ae=>(Module._InitializeParallelDSM=wasmExports.InitializeParallelDSM)(ae),Module._GetTransactionSnapshot=()=>(Module._GetTransactionSnapshot=wasmExports.GetTransactionSnapshot)(),Module._dsm_create=(ae,e)=>(Module._dsm_create=wasmExports.dsm_create)(ae,e),Module._dsm_segment_address=ae=>(Module._dsm_segment_address=wasmExports.dsm_segment_address)(ae),Module._shm_toc_allocate=(ae,e)=>(Module._shm_toc_allocate=wasmExports.shm_toc_allocate)(ae,e),Module._GetUserIdAndSecContext=(ae,e)=>(Module._GetUserIdAndSecContext=wasmExports.GetUserIdAndSecContext)(ae,e),Module._s_init_lock_sema=(ae,e)=>(Module._s_init_lock_sema=wasmExports.s_init_lock_sema)(ae,e),Module._shm_toc_insert=(ae,e,I)=>(Module._shm_toc_insert=wasmExports.shm_toc_insert)(ae,e,I),Module._WaitForParallelWorkersToFinish=ae=>(Module._WaitForParallelWorkersToFinish=wasmExports.WaitForParallelWorkersToFinish)(ae),Module._shm_toc_lookup=(ae,e,I)=>(Module._shm_toc_lookup=wasmExports.shm_toc_lookup)(ae,e,I),Module._WaitLatch=(ae,e,I,oe)=>(Module._WaitLatch=wasmExports.WaitLatch)(ae,e,I,oe),Module._ResetLatch=ae=>(Module._ResetLatch=wasmExports.ResetLatch)(ae),Module._WaitForBackgroundWorkerShutdown=ae=>(Module._WaitForBackgroundWorkerShutdown=wasmExports.WaitForBackgroundWorkerShutdown)(ae),Module._LaunchParallelWorkers=ae=>(Module._LaunchParallelWorkers=wasmExports.LaunchParallelWorkers)(ae),Module._dsm_segment_handle=ae=>(Module._dsm_segment_handle=wasmExports.dsm_segment_handle)(ae),Module._RegisterDynamicBackgroundWorker=(ae,e)=>(Module._RegisterDynamicBackgroundWorker=wasmExports.RegisterDynamicBackgroundWorker)(ae,e),Module._WaitForParallelWorkersToAttach=ae=>(Module._WaitForParallelWorkersToAttach=wasmExports.WaitForParallelWorkersToAttach)(ae),Module._DestroyParallelContext=ae=>(Module._DestroyParallelContext=wasmExports.DestroyParallelContext)(ae),Module._dsm_detach=ae=>(Module._dsm_detach=wasmExports.dsm_detach)(ae),Module._appendBinaryStringInfo=(ae,e,I)=>(Module._appendBinaryStringInfo=wasmExports.appendBinaryStringInfo)(ae,e,I),Module._pq_getmsgint=(ae,e)=>(Module._pq_getmsgint=wasmExports.pq_getmsgint)(ae,e),Module._die=ae=>(Module._die=wasmExports.die)(ae),Module._pqsignal=(ae,e)=>(Module._pqsignal=wasmExports.pqsignal)(ae,e),Module._BackgroundWorkerUnblockSignals=()=>(Module._BackgroundWorkerUnblockSignals=wasmExports.BackgroundWorkerUnblockSignals)(),Module._dsm_attach=ae=>(Module._dsm_attach=wasmExports.dsm_attach)(ae),Module._enlargeStringInfo=(ae,e)=>(Module._enlargeStringInfo=wasmExports.enlargeStringInfo)(ae,e),Module._BackgroundWorkerInitializeConnectionByOid=(ae,e,I)=>(Module._BackgroundWorkerInitializeConnectionByOid=wasmExports.BackgroundWorkerInitializeConnectionByOid)(ae,e,I),Module._GetDatabaseEncoding=()=>(Module._GetDatabaseEncoding=wasmExports.GetDatabaseEncoding)(),Module._StartTransactionCommand=()=>(Module._StartTransactionCommand=wasmExports.StartTransactionCommand)(),Module._CommitTransactionCommand=()=>(Module._CommitTransactionCommand=wasmExports.CommitTransactionCommand)(),Module._PushActiveSnapshot=ae=>(Module._PushActiveSnapshot=wasmExports.PushActiveSnapshot)(ae),Module._SetUserIdAndSecContext=(ae,e)=>(Module._SetUserIdAndSecContext=wasmExports.SetUserIdAndSecContext)(ae,e),Module._EnterParallelMode=()=>(Module._EnterParallelMode=wasmExports.EnterParallelMode)(),Module._ExitParallelMode=()=>(Module._ExitParallelMode=wasmExports.ExitParallelMode)(),Module._PopActiveSnapshot=()=>(Module._PopActiveSnapshot=wasmExports.PopActiveSnapshot)(),Module._tas_sema=ae=>(Module._tas_sema=wasmExports.tas_sema)(ae),Module._s_lock=(ae,e,I,oe)=>(Module._s_lock=wasmExports.s_lock)(ae,e,I,oe),Module._s_unlock_sema=ae=>(Module._s_unlock_sema=wasmExports.s_unlock_sema)(ae),Module._XLogRecStoreStats=(ae,e)=>(Module._XLogRecStoreStats=wasmExports.XLogRecStoreStats)(ae,e),Module._clock_gettime=(ae,e)=>(Module._clock_gettime=wasmExports.clock_gettime)(ae,e),Module._time=ae=>(Module._time=wasmExports.time)(ae),Module._close=ae=>(Module._close=wasmExports.close)(ae),Module._ReleaseExternalFD=()=>(Module._ReleaseExternalFD=wasmExports.ReleaseExternalFD)(),Module._strncmp=(ae,e,I)=>(Module._strncmp=wasmExports.strncmp)(ae,e,I),Module._SplitIdentifierString=(ae,e,I)=>(Module._SplitIdentifierString=wasmExports.SplitIdentifierString)(ae,e,I),Module._pre_format_elog_string=(ae,e)=>(Module._pre_format_elog_string=wasmExports.pre_format_elog_string)(ae,e),Module._format_elog_string=(ae,e)=>(Module._format_elog_string=wasmExports.format_elog_string)(ae,e),Module._guc_malloc=(ae,e)=>(Module._guc_malloc=wasmExports.guc_malloc)(ae,e),Module._SetConfigOption=(ae,e,I,oe)=>(Module._SetConfigOption=wasmExports.SetConfigOption)(ae,e,I,oe),Module._gettimeofday=(ae,e)=>(Module._gettimeofday=wasmExports.gettimeofday)(ae,e),Module._pg_strong_random=(ae,e)=>(Module._pg_strong_random=wasmExports.pg_strong_random)(ae,e),Module._GetFlushRecPtr=ae=>(Module._GetFlushRecPtr=wasmExports.GetFlushRecPtr)(ae),Module._GetXLogReplayRecPtr=ae=>(Module._GetXLogReplayRecPtr=wasmExports.GetXLogReplayRecPtr)(ae),Module._timestamptz_to_str=ae=>(Module._timestamptz_to_str=wasmExports.timestamptz_to_str)(ae),Module._sscanf=(ae,e,I)=>(Module._sscanf=wasmExports.sscanf)(ae,e,I),Module._TimestampDifferenceMilliseconds=(ae,e)=>(Module._TimestampDifferenceMilliseconds=wasmExports.TimestampDifferenceMilliseconds)(ae,e),Module._UnlockReleaseBuffer=ae=>(Module._UnlockReleaseBuffer=wasmExports.UnlockReleaseBuffer)(ae),Module.___wasm_setjmp_test=(ae,e)=>(Module.___wasm_setjmp_test=wasmExports.__wasm_setjmp_test)(ae,e),Module.___wasm_setjmp=(ae,e,I)=>(Module.___wasm_setjmp=wasmExports.__wasm_setjmp)(ae,e,I),Module._cancel_before_shmem_exit=(ae,e)=>(Module._cancel_before_shmem_exit=wasmExports.cancel_before_shmem_exit)(ae,e),Module._pg_re_throw=()=>(Module._pg_re_throw=wasmExports.pg_re_throw)(),Module._emscripten_longjmp=(ae,e)=>(Module._emscripten_longjmp=wasmExports.emscripten_longjmp)(ae,e),Module._ferror=ae=>(Module._ferror=wasmExports.ferror)(ae),Module._RmgrNotFound=ae=>(Module._RmgrNotFound=wasmExports.RmgrNotFound)(ae),Module._InitMaterializedSRF=(ae,e)=>(Module._InitMaterializedSRF=wasmExports.InitMaterializedSRF)(ae,e),Module._tuplestore_putvalues=(ae,e,I,oe)=>(Module._tuplestore_putvalues=wasmExports.tuplestore_putvalues)(ae,e,I,oe),Module._hash_destroy=ae=>(Module._hash_destroy=wasmExports.hash_destroy)(ae),Module._smgropen=(ae,e)=>(Module._smgropen=wasmExports.smgropen)(ae,e),Module._smgrexists=(ae,e)=>(Module._smgrexists=wasmExports.smgrexists)(ae,e),Module._pg_detoast_datum_packed=ae=>(Module._pg_detoast_datum_packed=wasmExports.pg_detoast_datum_packed)(ae),Module._makeStringInfo=()=>(Module._makeStringInfo=wasmExports.makeStringInfo)(),Module._numeric_in=ae=>(Module._numeric_in=wasmExports.numeric_in)(ae),Module._DirectFunctionCall3Coll=(ae,e,I,oe,ue)=>(Module._DirectFunctionCall3Coll=wasmExports.DirectFunctionCall3Coll)(ae,e,I,oe,ue),Module._DirectFunctionCall2Coll=(ae,e,I,oe)=>(Module._DirectFunctionCall2Coll=wasmExports.DirectFunctionCall2Coll)(ae,e,I,oe),Module._GetCurrentCommandId=ae=>(Module._GetCurrentCommandId=wasmExports.GetCurrentCommandId)(ae),Module._GetCurrentTransactionNestLevel=()=>(Module._GetCurrentTransactionNestLevel=wasmExports.GetCurrentTransactionNestLevel)(),Module._CommandCounterIncrement=()=>(Module._CommandCounterIncrement=wasmExports.CommandCounterIncrement)(),Module._ResourceOwnerCreate=(ae,e)=>(Module._ResourceOwnerCreate=wasmExports.ResourceOwnerCreate)(ae,e),Module._AtEOXact_GUC=(ae,e)=>(Module._AtEOXact_GUC=wasmExports.AtEOXact_GUC)(ae,e),Module._ResourceOwnerDelete=ae=>(Module._ResourceOwnerDelete=wasmExports.ResourceOwnerDelete)(ae),Module._ConditionVariableCancelSleep=()=>(Module._ConditionVariableCancelSleep=wasmExports.ConditionVariableCancelSleep)(),Module._AtEOSubXact_Files=(ae,e,I)=>(Module._AtEOSubXact_Files=wasmExports.AtEOSubXact_Files)(ae,e,I),Module._RegisterXactCallback=(ae,e)=>(Module._RegisterXactCallback=wasmExports.RegisterXactCallback)(ae,e),Module._RegisterSubXactCallback=(ae,e)=>(Module._RegisterSubXactCallback=wasmExports.RegisterSubXactCallback)(ae,e),Module._NewGUCNestLevel=()=>(Module._NewGUCNestLevel=wasmExports.NewGUCNestLevel)(),Module._BeginInternalSubTransaction=ae=>(Module._BeginInternalSubTransaction=wasmExports.BeginInternalSubTransaction)(ae),Module._ReleaseCurrentSubTransaction=()=>(Module._ReleaseCurrentSubTransaction=wasmExports.ReleaseCurrentSubTransaction)(),Module._RollbackAndReleaseCurrentSubTransaction=()=>(Module._RollbackAndReleaseCurrentSubTransaction=wasmExports.RollbackAndReleaseCurrentSubTransaction)(),Module._errdetail_internal=(ae,e)=>(Module._errdetail_internal=wasmExports.errdetail_internal)(ae,e),Module._log_newpage_buffer=(ae,e)=>(Module._log_newpage_buffer=wasmExports.log_newpage_buffer)(ae,e),Module._log_newpage_range=(ae,e,I,oe,ue)=>(Module._log_newpage_range=wasmExports.log_newpage_range)(ae,e,I,oe,ue),Module._ReadBufferExtended=(ae,e,I,oe,ue)=>(Module._ReadBufferExtended=wasmExports.ReadBufferExtended)(ae,e,I,oe,ue),Module._LockBuffer=(ae,e)=>(Module._LockBuffer=wasmExports.LockBuffer)(ae,e),Module._MarkBufferDirty=ae=>(Module._MarkBufferDirty=wasmExports.MarkBufferDirty)(ae),Module._ConditionVariableInit=ae=>(Module._ConditionVariableInit=wasmExports.ConditionVariableInit)(ae),Module._timestamptz_in=ae=>(Module._timestamptz_in=wasmExports.timestamptz_in)(ae),Module._fscanf=(ae,e,I)=>(Module._fscanf=wasmExports.fscanf)(ae,e,I),Module._appendStringInfoString=(ae,e)=>(Module._appendStringInfoString=wasmExports.appendStringInfoString)(ae,e),Module._ParseDateTime=(ae,e,I,oe,ue,bt,tr)=>(Module._ParseDateTime=wasmExports.ParseDateTime)(ae,e,I,oe,ue,bt,tr),Module._DecodeDateTime=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._DecodeDateTime=wasmExports.DecodeDateTime)(ae,e,I,oe,ue,bt,tr,rr),Module._GenericXLogStart=ae=>(Module._GenericXLogStart=wasmExports.GenericXLogStart)(ae),Module._GenericXLogRegisterBuffer=(ae,e,I)=>(Module._GenericXLogRegisterBuffer=wasmExports.GenericXLogRegisterBuffer)(ae,e,I),Module._GenericXLogFinish=ae=>(Module._GenericXLogFinish=wasmExports.GenericXLogFinish)(ae),Module._GenericXLogAbort=ae=>(Module._GenericXLogAbort=wasmExports.GenericXLogAbort)(ae),Module._hash_get_num_entries=ae=>(Module._hash_get_num_entries=wasmExports.hash_get_num_entries)(ae),Module._LockBufferForCleanup=ae=>(Module._LockBufferForCleanup=wasmExports.LockBufferForCleanup)(ae),Module._ReleaseBuffer=ae=>(Module._ReleaseBuffer=wasmExports.ReleaseBuffer)(ae),Module._read_local_xlog_page_no_wait=(ae,e,I,oe,ue)=>(Module._read_local_xlog_page_no_wait=wasmExports.read_local_xlog_page_no_wait)(ae,e,I,oe,ue),Module._fgets=(ae,e,I)=>(Module._fgets=wasmExports.fgets)(ae,e,I),Module._SearchSysCacheExists=(ae,e,I,oe,ue)=>(Module._SearchSysCacheExists=wasmExports.SearchSysCacheExists)(ae,e,I,oe,ue),Module._convert_tuples_by_position=(ae,e,I)=>(Module._convert_tuples_by_position=wasmExports.convert_tuples_by_position)(ae,e,I),Module._build_attrmap_by_name_if_req=(ae,e,I)=>(Module._build_attrmap_by_name_if_req=wasmExports.build_attrmap_by_name_if_req)(ae,e,I),Module._execute_attr_map_tuple=(ae,e)=>(Module._execute_attr_map_tuple=wasmExports.execute_attr_map_tuple)(ae,e),Module._heap_deform_tuple=(ae,e,I,oe)=>(Module._heap_deform_tuple=wasmExports.heap_deform_tuple)(ae,e,I,oe),Module._execute_attr_map_slot=(ae,e,I)=>(Module._execute_attr_map_slot=wasmExports.execute_attr_map_slot)(ae,e,I),Module._slot_getsomeattrs_int=(ae,e)=>(Module._slot_getsomeattrs_int=wasmExports.slot_getsomeattrs_int)(ae,e),Module._ExecStoreVirtualTuple=ae=>(Module._ExecStoreVirtualTuple=wasmExports.ExecStoreVirtualTuple)(ae),Module._free_attrmap=ae=>(Module._free_attrmap=wasmExports.free_attrmap)(ae),Module._DatumGetEOHP=ae=>(Module._DatumGetEOHP=wasmExports.DatumGetEOHP)(ae),Module._EOH_get_flat_size=ae=>(Module._EOH_get_flat_size=wasmExports.EOH_get_flat_size)(ae),Module._EOH_flatten_into=(ae,e,I)=>(Module._EOH_flatten_into=wasmExports.EOH_flatten_into)(ae,e,I),Module._heap_modify_tuple_by_cols=(ae,e,I,oe,ue,bt)=>(Module._heap_modify_tuple_by_cols=wasmExports.heap_modify_tuple_by_cols)(ae,e,I,oe,ue,bt),Module._heap_freetuple=ae=>(Module._heap_freetuple=wasmExports.heap_freetuple)(ae),Module._hash_bytes=(ae,e)=>(Module._hash_bytes=wasmExports.hash_bytes)(ae,e),Module._format_type_with_typemod=(ae,e)=>(Module._format_type_with_typemod=wasmExports.format_type_with_typemod)(ae,e),Module._RelationIdGetRelation=ae=>(Module._RelationIdGetRelation=wasmExports.RelationIdGetRelation)(ae),Module._try_relation_open=(ae,e)=>(Module._try_relation_open=wasmExports.try_relation_open)(ae,e),Module._relation_openrv=(ae,e)=>(Module._relation_openrv=wasmExports.relation_openrv)(ae,e),Module._RangeVarGetRelidExtended=(ae,e,I,oe,ue)=>(Module._RangeVarGetRelidExtended=wasmExports.RangeVarGetRelidExtended)(ae,e,I,oe,ue),Module._RelationClose=ae=>(Module._RelationClose=wasmExports.RelationClose)(ae),Module._fmgr_info=(ae,e)=>(Module._fmgr_info=wasmExports.fmgr_info)(ae,e),Module._OutputFunctionCall=(ae,e)=>(Module._OutputFunctionCall=wasmExports.OutputFunctionCall)(ae,e),Module._pg_printf=(ae,e)=>(Module._pg_printf=wasmExports.pg_printf)(ae,e),Module._OidOutputFunctionCall=(ae,e)=>(Module._OidOutputFunctionCall=wasmExports.OidOutputFunctionCall)(ae,e),Module._CreateTupleDescCopy=ae=>(Module._CreateTupleDescCopy=wasmExports.CreateTupleDescCopy)(ae),Module._CreateTupleDescCopyConstr=ae=>(Module._CreateTupleDescCopyConstr=wasmExports.CreateTupleDescCopyConstr)(ae),Module._TupleDescInitEntryCollation=(ae,e,I)=>(Module._TupleDescInitEntryCollation=wasmExports.TupleDescInitEntryCollation)(ae,e,I),Module._typenameTypeIdAndMod=(ae,e,I,oe)=>(Module._typenameTypeIdAndMod=wasmExports.typenameTypeIdAndMod)(ae,e,I,oe),Module._detoast_external_attr=ae=>(Module._detoast_external_attr=wasmExports.detoast_external_attr)(ae),Module._index_form_tuple=(ae,e,I)=>(Module._index_form_tuple=wasmExports.index_form_tuple)(ae,e,I),Module._nocache_index_getattr=(ae,e,I)=>(Module._nocache_index_getattr=wasmExports.nocache_index_getattr)(ae,e,I),Module._index_deform_tuple=(ae,e,I,oe)=>(Module._index_deform_tuple=wasmExports.index_deform_tuple)(ae,e,I,oe),Module._add_reloption_kind=()=>(Module._add_reloption_kind=wasmExports.add_reloption_kind)(),Module._init_local_reloptions=(ae,e)=>(Module._init_local_reloptions=wasmExports.init_local_reloptions)(ae,e),Module._register_reloptions_validator=(ae,e)=>(Module._register_reloptions_validator=wasmExports.register_reloptions_validator)(ae,e),Module._add_int_reloption=(ae,e,I,oe,ue,bt,tr)=>(Module._add_int_reloption=wasmExports.add_int_reloption)(ae,e,I,oe,ue,bt,tr),Module._add_local_int_reloption=(ae,e,I,oe,ue,bt,tr)=>(Module._add_local_int_reloption=wasmExports.add_local_int_reloption)(ae,e,I,oe,ue,bt,tr),Module._deconstruct_array_builtin=(ae,e,I,oe,ue)=>(Module._deconstruct_array_builtin=wasmExports.deconstruct_array_builtin)(ae,e,I,oe,ue),Module._accumArrayResult=(ae,e,I,oe,ue)=>(Module._accumArrayResult=wasmExports.accumArrayResult)(ae,e,I,oe,ue),Module._defGetString=ae=>(Module._defGetString=wasmExports.defGetString)(ae),Module._defGetBoolean=ae=>(Module._defGetBoolean=wasmExports.defGetBoolean)(ae),Module._makeArrayResult=(ae,e)=>(Module._makeArrayResult=wasmExports.makeArrayResult)(ae,e),Module._untransformRelOptions=ae=>(Module._untransformRelOptions=wasmExports.untransformRelOptions)(ae),Module._makeDefElem=(ae,e,I)=>(Module._makeDefElem=wasmExports.makeDefElem)(ae,e,I),Module._build_reloptions=(ae,e,I,oe,ue,bt)=>(Module._build_reloptions=wasmExports.build_reloptions)(ae,e,I,oe,ue,bt),Module._parse_bool=(ae,e)=>(Module._parse_bool=wasmExports.parse_bool)(ae,e),Module._parse_int=(ae,e,I,oe)=>(Module._parse_int=wasmExports.parse_int)(ae,e,I,oe),Module._parse_real=(ae,e,I,oe)=>(Module._parse_real=wasmExports.parse_real)(ae,e,I,oe),Module._pg_ltoa=(ae,e)=>(Module._pg_ltoa=wasmExports.pg_ltoa)(ae,e),Module._toast_open_indexes=(ae,e,I,oe)=>(Module._toast_open_indexes=wasmExports.toast_open_indexes)(ae,e,I,oe),Module._toast_close_indexes=(ae,e,I)=>(Module._toast_close_indexes=wasmExports.toast_close_indexes)(ae,e,I),Module._systable_beginscan_ordered=(ae,e,I,oe,ue)=>(Module._systable_beginscan_ordered=wasmExports.systable_beginscan_ordered)(ae,e,I,oe,ue),Module._systable_getnext_ordered=(ae,e)=>(Module._systable_getnext_ordered=wasmExports.systable_getnext_ordered)(ae,e),Module._systable_endscan_ordered=ae=>(Module._systable_endscan_ordered=wasmExports.systable_endscan_ordered)(ae),Module._init_toast_snapshot=ae=>(Module._init_toast_snapshot=wasmExports.init_toast_snapshot)(ae),Module.__bt_allequalimage=(ae,e)=>(Module.__bt_allequalimage=wasmExports._bt_allequalimage)(ae,e),Module._RelationGetIndexScan=(ae,e,I)=>(Module._RelationGetIndexScan=wasmExports.RelationGetIndexScan)(ae,e,I),Module._memmove=(ae,e,I)=>(Module._memmove=wasmExports.memmove)(ae,e,I),Module._tbm_add_tuples=(ae,e,I,oe)=>(Module._tbm_add_tuples=wasmExports.tbm_add_tuples)(ae,e,I,oe),Module._ConditionVariableSleep=(ae,e)=>(Module._ConditionVariableSleep=wasmExports.ConditionVariableSleep)(ae,e),Module._ConditionVariableSignal=ae=>(Module._ConditionVariableSignal=wasmExports.ConditionVariableSignal)(ae),Module._LockRelationForExtension=(ae,e)=>(Module._LockRelationForExtension=wasmExports.LockRelationForExtension)(ae,e),Module._UnlockRelationForExtension=(ae,e)=>(Module._UnlockRelationForExtension=wasmExports.UnlockRelationForExtension)(ae,e),Module._pgstat_progress_update_param=(ae,e)=>(Module._pgstat_progress_update_param=wasmExports.pgstat_progress_update_param)(ae,e),Module._vacuum_delay_point=()=>(Module._vacuum_delay_point=wasmExports.vacuum_delay_point)(),Module.__bt_checkpage=(ae,e)=>(Module.__bt_checkpage=wasmExports._bt_checkpage)(ae,e),Module._RecordFreeIndexPage=(ae,e)=>(Module._RecordFreeIndexPage=wasmExports.RecordFreeIndexPage)(ae,e),Module.__bt_relbuf=(ae,e)=>(Module.__bt_relbuf=wasmExports._bt_relbuf)(ae,e),Module._IndexFreeSpaceMapVacuum=ae=>(Module._IndexFreeSpaceMapVacuum=wasmExports.IndexFreeSpaceMapVacuum)(ae),Module.__bt_mkscankey=(ae,e)=>(Module.__bt_mkscankey=wasmExports._bt_mkscankey)(ae,e),Module._ReadBuffer=(ae,e)=>(Module._ReadBuffer=wasmExports.ReadBuffer)(ae,e),Module._PageGetFreeSpace=ae=>(Module._PageGetFreeSpace=wasmExports.PageGetFreeSpace)(ae),Module.__bt_compare=(ae,e,I,oe)=>(Module.__bt_compare=wasmExports._bt_compare)(ae,e,I,oe),Module._smgrsetowner=(ae,e)=>(Module._smgrsetowner=wasmExports.smgrsetowner)(ae,e),Module.__bt_search=(ae,e,I,oe,ue,bt)=>(Module.__bt_search=wasmExports._bt_search)(ae,e,I,oe,ue,bt),Module.__bt_binsrch_insert=(ae,e)=>(Module.__bt_binsrch_insert=wasmExports._bt_binsrch_insert)(ae,e),Module._ItemPointerCompare=(ae,e)=>(Module._ItemPointerCompare=wasmExports.ItemPointerCompare)(ae,e),Module._BufferGetBlockNumber=ae=>(Module._BufferGetBlockNumber=wasmExports.BufferGetBlockNumber)(ae),Module.__bt_freestack=ae=>(Module.__bt_freestack=wasmExports._bt_freestack)(ae),Module._pg_prng_uint32=ae=>(Module._pg_prng_uint32=wasmExports.pg_prng_uint32)(ae),Module._PageAddItemExtended=(ae,e,I,oe,ue)=>(Module._PageAddItemExtended=wasmExports.PageAddItemExtended)(ae,e,I,oe,ue),Module._bsearch=(ae,e,I,oe,ue)=>(Module._bsearch=wasmExports.bsearch)(ae,e,I,oe,ue),Module._btboolcmp=ae=>(Module._btboolcmp=wasmExports.btboolcmp)(ae),Module._btint2cmp=ae=>(Module._btint2cmp=wasmExports.btint2cmp)(ae),Module._btint4cmp=ae=>(Module._btint4cmp=wasmExports.btint4cmp)(ae),Module._btint8cmp=ae=>(Module._btint8cmp=wasmExports.btint8cmp)(ae),Module._btoidcmp=ae=>(Module._btoidcmp=wasmExports.btoidcmp)(ae),Module._btcharcmp=ae=>(Module._btcharcmp=wasmExports.btcharcmp)(ae),Module._table_parallelscan_estimate=(ae,e)=>(Module._table_parallelscan_estimate=wasmExports.table_parallelscan_estimate)(ae,e),Module._tuplesort_estimate_shared=ae=>(Module._tuplesort_estimate_shared=wasmExports.tuplesort_estimate_shared)(ae),Module._table_parallelscan_initialize=(ae,e,I)=>(Module._table_parallelscan_initialize=wasmExports.table_parallelscan_initialize)(ae,e,I),Module._tuplesort_initialize_shared=(ae,e,I)=>(Module._tuplesort_initialize_shared=wasmExports.tuplesort_initialize_shared)(ae,e,I),Module._tuplesort_end=ae=>(Module._tuplesort_end=wasmExports.tuplesort_end)(ae),Module._tuplesort_performsort=ae=>(Module._tuplesort_performsort=wasmExports.tuplesort_performsort)(ae),Module._pgstat_report_activity=(ae,e)=>(Module._pgstat_report_activity=wasmExports.pgstat_report_activity)(ae,e),Module._tuplesort_attach_shared=(ae,e)=>(Module._tuplesort_attach_shared=wasmExports.tuplesort_attach_shared)(ae,e),Module._BuildIndexInfo=ae=>(Module._BuildIndexInfo=wasmExports.BuildIndexInfo)(ae),Module._table_beginscan_parallel=(ae,e)=>(Module._table_beginscan_parallel=wasmExports.table_beginscan_parallel)(ae,e),Module._PageIndexTupleOverwrite=(ae,e,I,oe)=>(Module._PageIndexTupleOverwrite=wasmExports.PageIndexTupleOverwrite)(ae,e,I,oe),Module.__bt_form_posting=(ae,e,I)=>(Module.__bt_form_posting=wasmExports._bt_form_posting)(ae,e,I),Module._PageGetExactFreeSpace=ae=>(Module._PageGetExactFreeSpace=wasmExports.PageGetExactFreeSpace)(ae),Module.__bt_metaversion=(ae,e,I)=>(Module.__bt_metaversion=wasmExports._bt_metaversion)(ae,e,I),Module._index_getprocinfo=(ae,e,I)=>(Module._index_getprocinfo=wasmExports.index_getprocinfo)(ae,e,I),Module._ItemPointerEquals=(ae,e)=>(Module._ItemPointerEquals=wasmExports.ItemPointerEquals)(ae,e),Module.__bt_check_natts=(ae,e,I,oe)=>(Module.__bt_check_natts=wasmExports._bt_check_natts)(ae,e,I,oe),Module._PageInit=(ae,e,I)=>(Module._PageInit=wasmExports.PageInit)(ae,e,I),Module._GetFreeIndexPage=ae=>(Module._GetFreeIndexPage=wasmExports.GetFreeIndexPage)(ae),Module._ConditionalLockBuffer=ae=>(Module._ConditionalLockBuffer=wasmExports.ConditionalLockBuffer)(ae),Module._ExtendBufferedRel=(ae,e,I,oe)=>(Module._ExtendBufferedRel=wasmExports.ExtendBufferedRel)(ae,e,I,oe),Module._PageIndexMultiDelete=(ae,e,I)=>(Module._PageIndexMultiDelete=wasmExports.PageIndexMultiDelete)(ae,e,I),Module._GetOldestNonRemovableTransactionId=ae=>(Module._GetOldestNonRemovableTransactionId=wasmExports.GetOldestNonRemovableTransactionId)(ae),Module._SearchSysCacheList=(ae,e,I,oe,ue)=>(Module._SearchSysCacheList=wasmExports.SearchSysCacheList)(ae,e,I,oe,ue),Module._check_amproc_signature=(ae,e,I,oe,ue,bt)=>(Module._check_amproc_signature=wasmExports.check_amproc_signature)(ae,e,I,oe,ue,bt),Module._check_amoptsproc_signature=ae=>(Module._check_amoptsproc_signature=wasmExports.check_amoptsproc_signature)(ae),Module._format_procedure=ae=>(Module._format_procedure=wasmExports.format_procedure)(ae),Module._format_operator=ae=>(Module._format_operator=wasmExports.format_operator)(ae),Module._check_amop_signature=(ae,e,I,oe)=>(Module._check_amop_signature=wasmExports.check_amop_signature)(ae,e,I,oe),Module._identify_opfamily_groups=(ae,e)=>(Module._identify_opfamily_groups=wasmExports.identify_opfamily_groups)(ae,e),Module._ReleaseCatCacheList=ae=>(Module._ReleaseCatCacheList=wasmExports.ReleaseCatCacheList)(ae),Module._TestForOldSnapshot_impl=(ae,e)=>(Module._TestForOldSnapshot_impl=wasmExports.TestForOldSnapshot_impl)(ae,e),Module._pgstat_assoc_relation=ae=>(Module._pgstat_assoc_relation=wasmExports.pgstat_assoc_relation)(ae),Module._XLogRecGetBlockRefInfo=(ae,e,I,oe,ue)=>(Module._XLogRecGetBlockRefInfo=wasmExports.XLogRecGetBlockRefInfo)(ae,e,I,oe,ue),Module._strncpy=(ae,e,I)=>(Module._strncpy=wasmExports.strncpy)(ae,e,I),Module._index_getprocid=(ae,e,I)=>(Module._index_getprocid=wasmExports.index_getprocid)(ae,e,I),Module._gistcheckpage=(ae,e)=>(Module._gistcheckpage=wasmExports.gistcheckpage)(ae,e),Module._FunctionCall1Coll=(ae,e,I)=>(Module._FunctionCall1Coll=wasmExports.FunctionCall1Coll)(ae,e,I),Module._pairingheap_remove_first=ae=>(Module._pairingheap_remove_first=wasmExports.pairingheap_remove_first)(ae),Module._pairingheap_add=(ae,e)=>(Module._pairingheap_add=wasmExports.pairingheap_add)(ae,e),Module._pow=(ae,e)=>(Module._pow=wasmExports.pow)(ae,e),Module._GenerationContextCreate=(ae,e,I,oe,ue)=>(Module._GenerationContextCreate=wasmExports.GenerationContextCreate)(ae,e,I,oe,ue),Module._float_overflow_error=()=>(Module._float_overflow_error=wasmExports.float_overflow_error)(),Module._float_underflow_error=()=>(Module._float_underflow_error=wasmExports.float_underflow_error)(),Module._DirectFunctionCall5Coll=(ae,e,I,oe,ue,bt,tr)=>(Module._DirectFunctionCall5Coll=wasmExports.DirectFunctionCall5Coll)(ae,e,I,oe,ue,bt,tr),Module._Float8GetDatum=ae=>(Module._Float8GetDatum=wasmExports.Float8GetDatum)(ae),Module._pairingheap_allocate=(ae,e)=>(Module._pairingheap_allocate=wasmExports.pairingheap_allocate)(ae,e),Module.__hash_getbuf=(ae,e,I,oe)=>(Module.__hash_getbuf=wasmExports._hash_getbuf)(ae,e,I,oe),Module.__hash_relbuf=(ae,e)=>(Module.__hash_relbuf=wasmExports._hash_relbuf)(ae,e),Module.__hash_get_indextuple_hashkey=ae=>(Module.__hash_get_indextuple_hashkey=wasmExports._hash_get_indextuple_hashkey)(ae),Module.__hash_getbuf_with_strategy=(ae,e,I,oe,ue)=>(Module.__hash_getbuf_with_strategy=wasmExports._hash_getbuf_with_strategy)(ae,e,I,oe,ue),Module._hash_bytes_extended=(ae,e,I)=>(Module._hash_bytes_extended=wasmExports.hash_bytes_extended)(ae,e,I),Module.__hash_ovflblkno_to_bitno=(ae,e)=>(Module.__hash_ovflblkno_to_bitno=wasmExports._hash_ovflblkno_to_bitno)(ae,e),Module._pg_class_aclcheck=(ae,e,I)=>(Module._pg_class_aclcheck=wasmExports.pg_class_aclcheck)(ae,e,I),Module._ExecFetchSlotHeapTuple=(ae,e,I)=>(Module._ExecFetchSlotHeapTuple=wasmExports.ExecFetchSlotHeapTuple)(ae,e,I),Module._HeapTupleSatisfiesUpdate=(ae,e,I)=>(Module._HeapTupleSatisfiesUpdate=wasmExports.HeapTupleSatisfiesUpdate)(ae,e,I),Module._HeapTupleGetUpdateXid=ae=>(Module._HeapTupleGetUpdateXid=wasmExports.HeapTupleGetUpdateXid)(ae),Module._HeapTupleSatisfiesVacuum=(ae,e,I)=>(Module._HeapTupleSatisfiesVacuum=wasmExports.HeapTupleSatisfiesVacuum)(ae,e,I),Module._HeapTupleSatisfiesVisibility=(ae,e,I)=>(Module._HeapTupleSatisfiesVisibility=wasmExports.HeapTupleSatisfiesVisibility)(ae,e,I),Module._PageGetHeapFreeSpace=ae=>(Module._PageGetHeapFreeSpace=wasmExports.PageGetHeapFreeSpace)(ae),Module._ftruncate=(ae,e)=>(Module._ftruncate=wasmExports.ftruncate)(ae,e),Module._heap_getnext=(ae,e)=>(Module._heap_getnext=wasmExports.heap_getnext)(ae,e),Module._MakeSingleTupleTableSlot=(ae,e)=>(Module._MakeSingleTupleTableSlot=wasmExports.MakeSingleTupleTableSlot)(ae,e),Module._ExecStoreHeapTuple=(ae,e,I)=>(Module._ExecStoreHeapTuple=wasmExports.ExecStoreHeapTuple)(ae,e,I),Module._visibilitymap_pin=(ae,e,I)=>(Module._visibilitymap_pin=wasmExports.visibilitymap_pin)(ae,e,I),Module._visibilitymap_clear=(ae,e,I,oe)=>(Module._visibilitymap_clear=wasmExports.visibilitymap_clear)(ae,e,I,oe),Module._visibilitymap_get_status=(ae,e,I)=>(Module._visibilitymap_get_status=wasmExports.visibilitymap_get_status)(ae,e,I),Module._visibilitymap_prepare_truncate=(ae,e)=>(Module._visibilitymap_prepare_truncate=wasmExports.visibilitymap_prepare_truncate)(ae,e),Module._get_namespace_name=ae=>(Module._get_namespace_name=wasmExports.get_namespace_name)(ae),Module._vac_estimate_reltuples=(ae,e,I,oe)=>(Module._vac_estimate_reltuples=wasmExports.vac_estimate_reltuples)(ae,e,I,oe),Module._PrefetchBuffer=(ae,e,I,oe)=>(Module._PrefetchBuffer=wasmExports.PrefetchBuffer)(ae,e,I,oe),Module._WalUsageAccumDiff=(ae,e,I)=>(Module._WalUsageAccumDiff=wasmExports.WalUsageAccumDiff)(ae,e,I),Module._BufferUsageAccumDiff=(ae,e,I)=>(Module._BufferUsageAccumDiff=wasmExports.BufferUsageAccumDiff)(ae,e,I),Module._GetRecordedFreeSpace=(ae,e)=>(Module._GetRecordedFreeSpace=wasmExports.GetRecordedFreeSpace)(ae,e),Module._heap_tuple_needs_eventual_freeze=ae=>(Module._heap_tuple_needs_eventual_freeze=wasmExports.heap_tuple_needs_eventual_freeze)(ae),Module._GetAccessStrategy=ae=>(Module._GetAccessStrategy=wasmExports.GetAccessStrategy)(ae),Module._FreeAccessStrategy=ae=>(Module._FreeAccessStrategy=wasmExports.FreeAccessStrategy)(ae),Module._ginPostingListDecode=(ae,e)=>(Module._ginPostingListDecode=wasmExports.ginPostingListDecode)(ae,e),Module._LockPage=(ae,e,I)=>(Module._LockPage=wasmExports.LockPage)(ae,e,I),Module._UnlockPage=(ae,e,I)=>(Module._UnlockPage=wasmExports.UnlockPage)(ae,e,I),Module._object_ownercheck=(ae,e,I)=>(Module._object_ownercheck=wasmExports.object_ownercheck)(ae,e,I),Module._aclcheck_error=(ae,e,I)=>(Module._aclcheck_error=wasmExports.aclcheck_error)(ae,e,I),Module._FunctionCall4Coll=(ae,e,I,oe,ue,bt)=>(Module._FunctionCall4Coll=wasmExports.FunctionCall4Coll)(ae,e,I,oe,ue,bt),Module._varstr_cmp=(ae,e,I,oe,ue)=>(Module._varstr_cmp=wasmExports.varstr_cmp)(ae,e,I,oe,ue),Module._table_openrv=(ae,e)=>(Module._table_openrv=wasmExports.table_openrv)(ae,e),Module._get_fn_opclass_options=ae=>(Module._get_fn_opclass_options=wasmExports.get_fn_opclass_options)(ae),Module._pg_popcount=(ae,e)=>(Module._pg_popcount=wasmExports.pg_popcount)(ae,e),Module._brin_deform_tuple=(ae,e,I)=>(Module._brin_deform_tuple=wasmExports.brin_deform_tuple)(ae,e,I),Module._brin_build_desc=ae=>(Module._brin_build_desc=wasmExports.brin_build_desc)(ae),Module._IndexGetRelation=(ae,e)=>(Module._IndexGetRelation=wasmExports.IndexGetRelation)(ae,e),Module._brin_free_desc=ae=>(Module._brin_free_desc=wasmExports.brin_free_desc)(ae),Module._numeric_sub=ae=>(Module._numeric_sub=wasmExports.numeric_sub)(ae),Module._DirectFunctionCall1Coll=(ae,e,I)=>(Module._DirectFunctionCall1Coll=wasmExports.DirectFunctionCall1Coll)(ae,e,I),Module._cstring_to_text_with_len=(ae,e)=>(Module._cstring_to_text_with_len=wasmExports.cstring_to_text_with_len)(ae,e),Module._bbsink_forward_begin_backup=ae=>(Module._bbsink_forward_begin_backup=wasmExports.bbsink_forward_begin_backup)(ae),Module._bbsink_forward_begin_archive=(ae,e)=>(Module._bbsink_forward_begin_archive=wasmExports.bbsink_forward_begin_archive)(ae,e),Module._bbsink_forward_archive_contents=(ae,e)=>(Module._bbsink_forward_archive_contents=wasmExports.bbsink_forward_archive_contents)(ae,e),Module._bbsink_forward_end_archive=ae=>(Module._bbsink_forward_end_archive=wasmExports.bbsink_forward_end_archive)(ae),Module._bbsink_forward_begin_manifest=ae=>(Module._bbsink_forward_begin_manifest=wasmExports.bbsink_forward_begin_manifest)(ae),Module._bbsink_forward_manifest_contents=(ae,e)=>(Module._bbsink_forward_manifest_contents=wasmExports.bbsink_forward_manifest_contents)(ae,e),Module._bbsink_forward_end_manifest=ae=>(Module._bbsink_forward_end_manifest=wasmExports.bbsink_forward_end_manifest)(ae),Module._bbsink_forward_end_backup=(ae,e,I)=>(Module._bbsink_forward_end_backup=wasmExports.bbsink_forward_end_backup)(ae,e,I),Module._bbsink_forward_cleanup=ae=>(Module._bbsink_forward_cleanup=wasmExports.bbsink_forward_cleanup)(ae),Module._geteuid=()=>(Module._geteuid=wasmExports.geteuid)(),Module._atoi=ae=>(Module._atoi=wasmExports.atoi)(ae),Module._pg_checksum_page=(ae,e)=>(Module._pg_checksum_page=wasmExports.pg_checksum_page)(ae,e),Module._escape_json=(ae,e)=>(Module._escape_json=wasmExports.escape_json)(ae,e),Module._BaseBackupAddTarget=(ae,e,I)=>(Module._BaseBackupAddTarget=wasmExports.BaseBackupAddTarget)(ae,e,I),Module._CreateDestReceiver=ae=>(Module._CreateDestReceiver=wasmExports.CreateDestReceiver)(ae),Module._has_privs_of_role=(ae,e)=>(Module._has_privs_of_role=wasmExports.has_privs_of_role)(ae,e),Module._list_make4_impl=(ae,e,I,oe,ue)=>(Module._list_make4_impl=wasmExports.list_make4_impl)(ae,e,I,oe,ue),Module._list_make5_impl=(ae,e,I,oe,ue,bt)=>(Module._list_make5_impl=wasmExports.list_make5_impl)(ae,e,I,oe,ue,bt),Module._lappend_xid=(ae,e)=>(Module._lappend_xid=wasmExports.lappend_xid)(ae,e),Module._list_member_xid=(ae,e)=>(Module._list_member_xid=wasmExports.list_member_xid)(ae,e),Module._list_delete=(ae,e)=>(Module._list_delete=wasmExports.list_delete)(ae,e),Module._CleanQuerytext=(ae,e,I)=>(Module._CleanQuerytext=wasmExports.CleanQuerytext)(ae,e,I),Module._scanner_isspace=ae=>(Module._scanner_isspace=wasmExports.scanner_isspace)(ae),Module._EnableQueryId=()=>(Module._EnableQueryId=wasmExports.EnableQueryId)(),Module._get_rel_type_id=ae=>(Module._get_rel_type_id=wasmExports.get_rel_type_id)(ae),Module._makeRangeVar=(ae,e,I)=>(Module._makeRangeVar=wasmExports.makeRangeVar)(ae,e,I),Module._makeTypeName=ae=>(Module._makeTypeName=wasmExports.makeTypeName)(ae),Module._makeTypeNameFromNameList=ae=>(Module._makeTypeNameFromNameList=wasmExports.makeTypeNameFromNameList)(ae),Module._MemoryContextAllocExtended=(ae,e,I)=>(Module._MemoryContextAllocExtended=wasmExports.MemoryContextAllocExtended)(ae,e,I),Module._exprIsLengthCoercion=(ae,e)=>(Module._exprIsLengthCoercion=wasmExports.exprIsLengthCoercion)(ae,e),Module._strip_implicit_coercions=ae=>(Module._strip_implicit_coercions=wasmExports.strip_implicit_coercions)(ae),Module._exprLocation=ae=>(Module._exprLocation=wasmExports.exprLocation)(ae),Module._makeParamList=ae=>(Module._makeParamList=wasmExports.makeParamList)(ae),Module._appendStringInfoStringQuoted=(ae,e,I)=>(Module._appendStringInfoStringQuoted=wasmExports.appendStringInfoStringQuoted)(ae,e,I),Module._get_typcollation=ae=>(Module._get_typcollation=wasmExports.get_typcollation)(ae),Module._makeInteger=ae=>(Module._makeInteger=wasmExports.makeInteger)(ae),Module._makeBoolean=ae=>(Module._makeBoolean=wasmExports.makeBoolean)(ae),Module._GetForeignDataWrapper=ae=>(Module._GetForeignDataWrapper=wasmExports.GetForeignDataWrapper)(ae),Module._GetSysCacheOid=(ae,e,I,oe,ue,bt)=>(Module._GetSysCacheOid=wasmExports.GetSysCacheOid)(ae,e,I,oe,ue,bt),Module._GetForeignServer=ae=>(Module._GetForeignServer=wasmExports.GetForeignServer)(ae),Module._GetForeignServerExtended=(ae,e)=>(Module._GetForeignServerExtended=wasmExports.GetForeignServerExtended)(ae,e),Module._GetForeignServerByName=(ae,e)=>(Module._GetForeignServerByName=wasmExports.GetForeignServerByName)(ae,e),Module._GetUserMapping=(ae,e)=>(Module._GetUserMapping=wasmExports.GetUserMapping)(ae,e),Module._GetUserNameFromId=(ae,e)=>(Module._GetUserNameFromId=wasmExports.GetUserNameFromId)(ae,e),Module._GetForeignTable=ae=>(Module._GetForeignTable=wasmExports.GetForeignTable)(ae),Module._GetForeignColumnOptions=(ae,e)=>(Module._GetForeignColumnOptions=wasmExports.GetForeignColumnOptions)(ae,e),Module._initClosestMatch=(ae,e,I)=>(Module._initClosestMatch=wasmExports.initClosestMatch)(ae,e,I),Module._updateClosestMatch=(ae,e)=>(Module._updateClosestMatch=wasmExports.updateClosestMatch)(ae,e),Module._getClosestMatch=ae=>(Module._getClosestMatch=wasmExports.getClosestMatch)(ae),Module._GetExistingLocalJoinPath=ae=>(Module._GetExistingLocalJoinPath=wasmExports.GetExistingLocalJoinPath)(ae),Module._LWLockRegisterTranche=(ae,e)=>(Module._LWLockRegisterTranche=wasmExports.LWLockRegisterTranche)(ae,e),Module._GetNamedLWLockTranche=ae=>(Module._GetNamedLWLockTranche=wasmExports.GetNamedLWLockTranche)(ae),Module._LWLockNewTrancheId=()=>(Module._LWLockNewTrancheId=wasmExports.LWLockNewTrancheId)(),Module._RequestNamedLWLockTranche=(ae,e)=>(Module._RequestNamedLWLockTranche=wasmExports.RequestNamedLWLockTranche)(ae,e),Module._resetStringInfo=ae=>(Module._resetStringInfo=wasmExports.resetStringInfo)(ae),Module._ShmemInitHash=(ae,e,I,oe,ue)=>(Module._ShmemInitHash=wasmExports.ShmemInitHash)(ae,e,I,oe,ue),Module._hash_estimate_size=(ae,e)=>(Module._hash_estimate_size=wasmExports.hash_estimate_size)(ae,e),Module._smgrread=(ae,e,I,oe)=>(Module._smgrread=wasmExports.smgrread)(ae,e,I,oe),Module._smgrtruncate=(ae,e,I,oe)=>(Module._smgrtruncate=wasmExports.smgrtruncate)(ae,e,I,oe),Module._BackendXidGetPid=ae=>(Module._BackendXidGetPid=wasmExports.BackendXidGetPid)(ae),Module._superuser=()=>(Module._superuser=wasmExports.superuser)(),Module._fcntl=(ae,e,I)=>(Module._fcntl=wasmExports.fcntl)(ae,e,I),Module._AddWaitEventToSet=(ae,e,I,oe,ue)=>(Module._AddWaitEventToSet=wasmExports.AddWaitEventToSet)(ae,e,I,oe,ue),Module._poll=(ae,e,I)=>(Module._poll=wasmExports.poll)(ae,e,I),Module._WaitLatchOrSocket=(ae,e,I,oe,ue)=>(Module._WaitLatchOrSocket=wasmExports.WaitLatchOrSocket)(ae,e,I,oe,ue),Module._GetNumRegisteredWaitEvents=ae=>(Module._GetNumRegisteredWaitEvents=wasmExports.GetNumRegisteredWaitEvents)(ae),Module._RequestAddinShmemSpace=ae=>(Module._RequestAddinShmemSpace=wasmExports.RequestAddinShmemSpace)(ae),Module._procsignal_sigusr1_handler=ae=>(Module._procsignal_sigusr1_handler=wasmExports.procsignal_sigusr1_handler)(ae),Module._wasm_OpenPipeStream=(ae,e)=>(Module._wasm_OpenPipeStream=wasmExports.wasm_OpenPipeStream)(ae,e),Module._fopen=(ae,e)=>(Module._fopen=wasmExports.fopen)(ae,e),Module._fiprintf=(ae,e,I)=>(Module._fiprintf=wasmExports.fiprintf)(ae,e,I),Module._fclose=ae=>(Module._fclose=wasmExports.fclose)(ae),Module._fsync_fname_ext=(ae,e,I,oe)=>(Module._fsync_fname_ext=wasmExports.fsync_fname_ext)(ae,e,I,oe),Module._rename=(ae,e)=>(Module._rename=wasmExports.rename)(ae,e),Module._dup=ae=>(Module._dup=wasmExports.dup)(ae),Module._open=(ae,e,I)=>(Module._open=wasmExports.open)(ae,e,I),Module._AcquireExternalFD=()=>(Module._AcquireExternalFD=wasmExports.AcquireExternalFD)(),Module._realloc=(ae,e)=>(Module._realloc=wasmExports.realloc)(ae,e),Module._pclose=ae=>(Module._pclose=wasmExports.pclose)(ae),Module._ClosePipeStream=ae=>(Module._ClosePipeStream=wasmExports.ClosePipeStream)(ae),Module._copy_file=(ae,e)=>(Module._copy_file=wasmExports.copy_file)(ae,e),Module._have_free_buffer=()=>(Module._have_free_buffer=wasmExports.have_free_buffer)(),Module._LockBufHdr=ae=>(Module._LockBufHdr=wasmExports.LockBufHdr)(ae);var _calloc=Module._calloc=(ae,e)=>(_calloc=Module._calloc=wasmExports.calloc)(ae,e);Module._pg_md5_encrypt=(ae,e,I,oe,ue)=>(Module._pg_md5_encrypt=wasmExports.pg_md5_encrypt)(ae,e,I,oe,ue),Module._plain_crypt_verify=(ae,e,I,oe)=>(Module._plain_crypt_verify=wasmExports.plain_crypt_verify)(ae,e,I,oe),Module._feof=ae=>(Module._feof=wasmExports.feof)(ae),Module._pg_strip_crlf=ae=>(Module._pg_strip_crlf=wasmExports.pg_strip_crlf)(ae),Module._pg_getaddrinfo_all=(ae,e,I,oe)=>(Module._pg_getaddrinfo_all=wasmExports.pg_getaddrinfo_all)(ae,e,I,oe),Module._pg_freeaddrinfo_all=(ae,e)=>(Module._pg_freeaddrinfo_all=wasmExports.pg_freeaddrinfo_all)(ae,e),Module._gai_strerror=ae=>(Module._gai_strerror=wasmExports.gai_strerror)(ae),Module._pg_mb2wchar_with_len=(ae,e,I)=>(Module._pg_mb2wchar_with_len=wasmExports.pg_mb2wchar_with_len)(ae,e,I),Module._pg_regcomp=(ae,e,I,oe,ue)=>(Module._pg_regcomp=wasmExports.pg_regcomp)(ae,e,I,oe,ue),Module._pg_regerror=(ae,e,I,oe)=>(Module._pg_regerror=wasmExports.pg_regerror)(ae,e,I,oe),Module._get_role_oid=(ae,e)=>(Module._get_role_oid=wasmExports.get_role_oid)(ae,e),Module._strcat=(ae,e)=>(Module._strcat=wasmExports.strcat)(ae,e),Module._pg_getnameinfo_all=(ae,e,I,oe,ue,bt,tr)=>(Module._pg_getnameinfo_all=wasmExports.pg_getnameinfo_all)(ae,e,I,oe,ue,bt,tr),Module._pg_strtoint32=ae=>(Module._pg_strtoint32=wasmExports.pg_strtoint32)(ae),Module._getpeereid=(ae,e,I)=>(Module._getpeereid=wasmExports.getpeereid)(ae,e,I),Module._socket=(ae,e,I)=>(Module._socket=wasmExports.socket)(ae,e,I),Module._connect=(ae,e,I)=>(Module._connect=wasmExports.connect)(ae,e,I),Module._send=(ae,e,I,oe)=>(Module._send=wasmExports.send)(ae,e,I,oe),Module._recv=(ae,e,I,oe)=>(Module._recv=wasmExports.recv)(ae,e,I,oe),Module._pq_sendtext=(ae,e,I)=>(Module._pq_sendtext=wasmExports.pq_sendtext)(ae,e,I),Module._pq_sendfloat4=(ae,e)=>(Module._pq_sendfloat4=wasmExports.pq_sendfloat4)(ae,e),Module._pq_sendfloat8=(ae,e)=>(Module._pq_sendfloat8=wasmExports.pq_sendfloat8)(ae,e),Module._pq_begintypsend=ae=>(Module._pq_begintypsend=wasmExports.pq_begintypsend)(ae),Module._pq_endtypsend=ae=>(Module._pq_endtypsend=wasmExports.pq_endtypsend)(ae),Module._pq_getmsgfloat4=ae=>(Module._pq_getmsgfloat4=wasmExports.pq_getmsgfloat4)(ae),Module._pq_getmsgfloat8=ae=>(Module._pq_getmsgfloat8=wasmExports.pq_getmsgfloat8)(ae),Module._pq_getmsgtext=(ae,e,I)=>(Module._pq_getmsgtext=wasmExports.pq_getmsgtext)(ae,e,I),Module._be_lo_unlink=ae=>(Module._be_lo_unlink=wasmExports.be_lo_unlink)(ae),Module._text_to_cstring_buffer=(ae,e,I)=>(Module._text_to_cstring_buffer=wasmExports.text_to_cstring_buffer)(ae,e,I),Module._explicit_bzero=(ae,e)=>(Module._explicit_bzero=wasmExports.explicit_bzero)(ae,e),Module._setsockopt=(ae,e,I,oe,ue)=>(Module._setsockopt=wasmExports.setsockopt)(ae,e,I,oe,ue),Module._getsockname=(ae,e,I)=>(Module._getsockname=wasmExports.getsockname)(ae,e,I),Module._pq_recvbuf_fill=(ae,e)=>(Module._pq_recvbuf_fill=wasmExports.pq_recvbuf_fill)(ae,e),Module._fread=(ae,e,I,oe)=>(Module._fread=wasmExports.fread)(ae,e,I,oe),Module._fwrite=(ae,e,I,oe)=>(Module._fwrite=wasmExports.fwrite)(ae,e,I,oe),Module._getsockopt=(ae,e,I,oe,ue)=>(Module._getsockopt=wasmExports.getsockopt)(ae,e,I,oe,ue),Module._sigemptyset=ae=>(Module._sigemptyset=wasmExports.sigemptyset)(ae),Module._pg_b64_enc_len=ae=>(Module._pg_b64_enc_len=wasmExports.pg_b64_enc_len)(ae),Module._pg_b64_encode=(ae,e,I,oe)=>(Module._pg_b64_encode=wasmExports.pg_b64_encode)(ae,e,I,oe),Module._pg_b64_dec_len=ae=>(Module._pg_b64_dec_len=wasmExports.pg_b64_dec_len)(ae),Module._pg_b64_decode=(ae,e,I,oe)=>(Module._pg_b64_decode=wasmExports.pg_b64_decode)(ae,e,I,oe),Module._pg_hmac_create=ae=>(Module._pg_hmac_create=wasmExports.pg_hmac_create)(ae),Module._pg_hmac_init=(ae,e,I)=>(Module._pg_hmac_init=wasmExports.pg_hmac_init)(ae,e,I),Module._pg_hmac_update=(ae,e,I)=>(Module._pg_hmac_update=wasmExports.pg_hmac_update)(ae,e,I),Module._pg_hmac_final=(ae,e,I)=>(Module._pg_hmac_final=wasmExports.pg_hmac_final)(ae,e,I),Module._pg_hmac_error=ae=>(Module._pg_hmac_error=wasmExports.pg_hmac_error)(ae),Module._pg_hmac_free=ae=>(Module._pg_hmac_free=wasmExports.pg_hmac_free)(ae),Module._scram_H=(ae,e,I,oe,ue)=>(Module._scram_H=wasmExports.scram_H)(ae,e,I,oe,ue),Module._pg_saslprep=(ae,e)=>(Module._pg_saslprep=wasmExports.pg_saslprep)(ae,e),Module._scram_build_secret=(ae,e,I,oe,ue,bt,tr)=>(Module._scram_build_secret=wasmExports.scram_build_secret)(ae,e,I,oe,ue,bt,tr),Module._scram_SaltedPassword=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._scram_SaltedPassword=wasmExports.scram_SaltedPassword)(ae,e,I,oe,ue,bt,tr,rr),Module._scram_ServerKey=(ae,e,I,oe,ue)=>(Module._scram_ServerKey=wasmExports.scram_ServerKey)(ae,e,I,oe,ue),Module._pg_initdb=()=>(Module._pg_initdb=wasmExports.pg_initdb)(),Module._pg_initdb_main=()=>(Module._pg_initdb_main=wasmExports.pg_initdb_main)(),Module.___cxa_throw=(ae,e,I)=>(Module.___cxa_throw=wasmExports.__cxa_throw)(ae,e,I),Module._main_repl=()=>(Module._main_repl=wasmExports.main_repl)(),Module._main=(ae,e)=>(Module._main=wasmExports.__main_argc_argv)(ae,e),Module._setenv=(ae,e,I)=>(Module._setenv=wasmExports.setenv)(ae,e,I),Module._pg_repl_raf=()=>(Module._pg_repl_raf=wasmExports.pg_repl_raf)(),Module._bloom_create=(ae,e,I)=>(Module._bloom_create=wasmExports.bloom_create)(ae,e,I),Module._bloom_free=ae=>(Module._bloom_free=wasmExports.bloom_free)(ae),Module._bloom_add_element=(ae,e,I)=>(Module._bloom_add_element=wasmExports.bloom_add_element)(ae,e,I),Module._bloom_lacks_element=(ae,e,I)=>(Module._bloom_lacks_element=wasmExports.bloom_lacks_element)(ae,e,I),Module._bloom_prop_bits_set=ae=>(Module._bloom_prop_bits_set=wasmExports.bloom_prop_bits_set)(ae),Module._pairingheap_free=ae=>(Module._pairingheap_free=wasmExports.pairingheap_free)(ae),Module._pairingheap_first=ae=>(Module._pairingheap_first=wasmExports.pairingheap_first)(ae),Module._get_relkind_objtype=ae=>(Module._get_relkind_objtype=wasmExports.get_relkind_objtype)(ae),Module._coerce_to_target_type=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._coerce_to_target_type=wasmExports.coerce_to_target_type)(ae,e,I,oe,ue,bt,tr,rr),Module._t_isdigit=ae=>(Module._t_isdigit=wasmExports.t_isdigit)(ae),Module._pg_mblen=ae=>(Module._pg_mblen=wasmExports.pg_mblen)(ae),Module._t_isspace=ae=>(Module._t_isspace=wasmExports.t_isspace)(ae),Module._t_isalnum=ae=>(Module._t_isalnum=wasmExports.t_isalnum)(ae),Module._isalnum=ae=>(Module._isalnum=wasmExports.isalnum)(ae),Module._tsearch_readline_begin=(ae,e)=>(Module._tsearch_readline_begin=wasmExports.tsearch_readline_begin)(ae,e),Module._tsearch_readline=ae=>(Module._tsearch_readline=wasmExports.tsearch_readline)(ae),Module._pg_any_to_server=(ae,e,I)=>(Module._pg_any_to_server=wasmExports.pg_any_to_server)(ae,e,I),Module._tsearch_readline_end=ae=>(Module._tsearch_readline_end=wasmExports.tsearch_readline_end)(ae),Module._lowerstr=ae=>(Module._lowerstr=wasmExports.lowerstr)(ae),Module._lowerstr_with_len=(ae,e)=>(Module._lowerstr_with_len=wasmExports.lowerstr_with_len)(ae,e),Module._pg_database_encoding_max_length=()=>(Module._pg_database_encoding_max_length=wasmExports.pg_database_encoding_max_length)(),Module._tolower=ae=>(Module._tolower=wasmExports.tolower)(ae),Module._readstoplist=(ae,e,I)=>(Module._readstoplist=wasmExports.readstoplist)(ae,e,I),Module._searchstoplist=(ae,e)=>(Module._searchstoplist=wasmExports.searchstoplist)(ae,e),Module._get_tsearch_config_filename=(ae,e)=>(Module._get_tsearch_config_filename=wasmExports.get_tsearch_config_filename)(ae,e),Module._pnstrdup=(ae,e)=>(Module._pnstrdup=wasmExports.pnstrdup)(ae,e),Module._textToQualifiedNameList=ae=>(Module._textToQualifiedNameList=wasmExports.textToQualifiedNameList)(ae),Module._DirectFunctionCall4Coll=(ae,e,I,oe,ue,bt)=>(Module._DirectFunctionCall4Coll=wasmExports.DirectFunctionCall4Coll)(ae,e,I,oe,ue,bt),Module._lookup_ts_dictionary_cache=ae=>(Module._lookup_ts_dictionary_cache=wasmExports.lookup_ts_dictionary_cache)(ae),Module._isxdigit=ae=>(Module._isxdigit=wasmExports.isxdigit)(ae),Module._get_restriction_variable=(ae,e,I,oe,ue,bt)=>(Module._get_restriction_variable=wasmExports.get_restriction_variable)(ae,e,I,oe,ue,bt),Module._get_attstatsslot=(ae,e,I,oe,ue)=>(Module._get_attstatsslot=wasmExports.get_attstatsslot)(ae,e,I,oe,ue),Module._free_attstatsslot=ae=>(Module._free_attstatsslot=wasmExports.free_attstatsslot)(ae),Module._construct_array_builtin=(ae,e,I)=>(Module._construct_array_builtin=wasmExports.construct_array_builtin)(ae,e,I),Module._LookupTypeName=(ae,e,I,oe)=>(Module._LookupTypeName=wasmExports.LookupTypeName)(ae,e,I,oe),Module._NameListToString=ae=>(Module._NameListToString=wasmExports.NameListToString)(ae),Module._get_collation_oid=(ae,e)=>(Module._get_collation_oid=wasmExports.get_collation_oid)(ae,e),Module._typeStringToTypeName=(ae,e)=>(Module._typeStringToTypeName=wasmExports.typeStringToTypeName)(ae,e),Module._raw_parser=(ae,e)=>(Module._raw_parser=wasmExports.raw_parser)(ae,e),Module._errsave_start=(ae,e)=>(Module._errsave_start=wasmExports.errsave_start)(ae,e),Module._errsave_finish=(ae,e,I,oe)=>(Module._errsave_finish=wasmExports.errsave_finish)(ae,e,I,oe),Module._transformExpr=(ae,e,I)=>(Module._transformExpr=wasmExports.transformExpr)(ae,e,I),Module._get_base_element_type=ae=>(Module._get_base_element_type=wasmExports.get_base_element_type)(ae),Module._lookup_rowtype_tupdesc=(ae,e)=>(Module._lookup_rowtype_tupdesc=wasmExports.lookup_rowtype_tupdesc)(ae,e),Module._quote_qualified_identifier=(ae,e)=>(Module._quote_qualified_identifier=wasmExports.quote_qualified_identifier)(ae,e),Module._get_attname=(ae,e,I)=>(Module._get_attname=wasmExports.get_attname)(ae,e,I),Module._get_rel_namespace=ae=>(Module._get_rel_namespace=wasmExports.get_rel_namespace)(ae),Module._makeRangeVarFromNameList=ae=>(Module._makeRangeVarFromNameList=wasmExports.makeRangeVarFromNameList)(ae),Module._varstr_levenshtein_less_equal=(ae,e,I,oe,ue,bt,tr,rr,ir)=>(Module._varstr_levenshtein_less_equal=wasmExports.varstr_levenshtein_less_equal)(ae,e,I,oe,ue,bt,tr,rr,ir),Module._core_yylex=(ae,e,I)=>(Module._core_yylex=wasmExports.core_yylex)(ae,e,I),Module._pg_mbstrlen_with_len=(ae,e)=>(Module._pg_mbstrlen_with_len=wasmExports.pg_mbstrlen_with_len)(ae,e),Module._truncate_identifier=(ae,e,I)=>(Module._truncate_identifier=wasmExports.truncate_identifier)(ae,e,I),Module._downcase_truncate_identifier=(ae,e,I)=>(Module._downcase_truncate_identifier=wasmExports.downcase_truncate_identifier)(ae,e,I),Module._getc=ae=>(Module._getc=wasmExports.getc)(ae),Module._clearerr=ae=>(Module._clearerr=wasmExports.clearerr)(ae),Module._scanner_init=(ae,e,I,oe)=>(Module._scanner_init=wasmExports.scanner_init)(ae,e,I,oe),Module._scanner_finish=ae=>(Module._scanner_finish=wasmExports.scanner_finish)(ae),Module._bit_in=ae=>(Module._bit_in=wasmExports.bit_in)(ae),Module._construct_array=(ae,e,I,oe,ue,bt)=>(Module._construct_array=wasmExports.construct_array)(ae,e,I,oe,ue,bt),Module._canonicalize_path=ae=>(Module._canonicalize_path=wasmExports.canonicalize_path)(ae),Module._path_is_prefix_of_path=(ae,e)=>(Module._path_is_prefix_of_path=wasmExports.path_is_prefix_of_path)(ae,e),Module._namein=ae=>(Module._namein=wasmExports.namein)(ae),Module._SetTuplestoreDestReceiverParams=(ae,e,I,oe,ue,bt)=>(Module._SetTuplestoreDestReceiverParams=wasmExports.SetTuplestoreDestReceiverParams)(ae,e,I,oe,ue,bt),Module._MemoryContextDeleteChildren=ae=>(Module._MemoryContextDeleteChildren=wasmExports.MemoryContextDeleteChildren)(ae),Module._set_config_option=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._set_config_option=wasmExports.set_config_option)(ae,e,I,oe,ue,bt,tr,rr),Module._ReleaseCachedPlan=(ae,e)=>(Module._ReleaseCachedPlan=wasmExports.ReleaseCachedPlan)(ae,e),Module._tuplestore_begin_heap=(ae,e,I)=>(Module._tuplestore_begin_heap=wasmExports.tuplestore_begin_heap)(ae,e,I),Module._ExecForceStoreHeapTuple=(ae,e,I)=>(Module._ExecForceStoreHeapTuple=wasmExports.ExecForceStoreHeapTuple)(ae,e,I),Module._tuplestore_end=ae=>(Module._tuplestore_end=wasmExports.tuplestore_end)(ae),Module._strtod=(ae,e)=>(Module._strtod=wasmExports.strtod)(ae,e),Module._pg_encoding_to_char_private=ae=>(Module._pg_encoding_to_char_private=wasmExports.pg_encoding_to_char_private)(ae),Module._GetDatabaseEncodingName=()=>(Module._GetDatabaseEncodingName=wasmExports.GetDatabaseEncodingName)(),Module._pg_is_ascii=ae=>(Module._pg_is_ascii=wasmExports.pg_is_ascii)(ae),Module._pg_get_encoding_from_locale=(ae,e)=>(Module._pg_get_encoding_from_locale=wasmExports.pg_get_encoding_from_locale)(ae,e),Module._pg_encoding_max_length=ae=>(Module._pg_encoding_max_length=wasmExports.pg_encoding_max_length)(ae),Module._report_invalid_encoding=(ae,e,I)=>(Module._report_invalid_encoding=wasmExports.report_invalid_encoding)(ae,e,I),Module._NextCopyFrom=(ae,e,I,oe)=>(Module._NextCopyFrom=wasmExports.NextCopyFrom)(ae,e,I,oe),Module._InputFunctionCall=(ae,e,I,oe)=>(Module._InputFunctionCall=wasmExports.InputFunctionCall)(ae,e,I,oe),Module._defGetStreamingMode=ae=>(Module._defGetStreamingMode=wasmExports.defGetStreamingMode)(ae),Module._pg_lsn_in=ae=>(Module._pg_lsn_in=wasmExports.pg_lsn_in)(ae),Module._quote_identifier=ae=>(Module._quote_identifier=wasmExports.quote_identifier)(ae),Module._quote_literal_cstr=ae=>(Module._quote_literal_cstr=wasmExports.quote_literal_cstr)(ae),Module._SPI_connect=()=>(Module._SPI_connect=wasmExports.SPI_connect)(),Module._SPI_exec=(ae,e)=>(Module._SPI_exec=wasmExports.SPI_exec)(ae,e),Module._SPI_execute=(ae,e,I)=>(Module._SPI_execute=wasmExports.SPI_execute)(ae,e,I),Module._SPI_getvalue=(ae,e,I)=>(Module._SPI_getvalue=wasmExports.SPI_getvalue)(ae,e,I),Module._SPI_finish=()=>(Module._SPI_finish=wasmExports.SPI_finish)(),Module._pg_char_to_encoding_private=ae=>(Module._pg_char_to_encoding_private=wasmExports.pg_char_to_encoding_private)(ae),Module._BlockSampler_Init=(ae,e,I,oe)=>(Module._BlockSampler_Init=wasmExports.BlockSampler_Init)(ae,e,I,oe),Module._reservoir_init_selection_state=(ae,e)=>(Module._reservoir_init_selection_state=wasmExports.reservoir_init_selection_state)(ae,e),Module._BlockSampler_HasMore=ae=>(Module._BlockSampler_HasMore=wasmExports.BlockSampler_HasMore)(ae),Module._BlockSampler_Next=ae=>(Module._BlockSampler_Next=wasmExports.BlockSampler_Next)(ae),Module._reservoir_get_next_S=(ae,e,I)=>(Module._reservoir_get_next_S=wasmExports.reservoir_get_next_S)(ae,e,I),Module._sampler_random_fract=ae=>(Module._sampler_random_fract=wasmExports.sampler_random_fract)(ae),Module._ProcessConfigFile=ae=>(Module._ProcessConfigFile=wasmExports.ProcessConfigFile)(ae),Module._nextval=ae=>(Module._nextval=wasmExports.nextval)(ae),Module._ProcessCopyOptions=(ae,e,I,oe)=>(Module._ProcessCopyOptions=wasmExports.ProcessCopyOptions)(ae,e,I,oe),Module._pg_server_to_any=(ae,e,I)=>(Module._pg_server_to_any=wasmExports.pg_server_to_any)(ae,e,I),Module._pg_encoding_mblen=(ae,e)=>(Module._pg_encoding_mblen=wasmExports.pg_encoding_mblen)(ae,e),Module._GetTopMostAncestorInPublication=(ae,e,I)=>(Module._GetTopMostAncestorInPublication=wasmExports.GetTopMostAncestorInPublication)(ae,e,I),Module._pub_collist_to_bitmapset=(ae,e,I)=>(Module._pub_collist_to_bitmapset=wasmExports.pub_collist_to_bitmapset)(ae,e,I),Module._get_typtype=ae=>(Module._get_typtype=wasmExports.get_typtype)(ae),Module._Async_Notify=(ae,e)=>(Module._Async_Notify=wasmExports.Async_Notify)(ae,e),Module._ExplainBeginOutput=ae=>(Module._ExplainBeginOutput=wasmExports.ExplainBeginOutput)(ae),Module._NewExplainState=()=>(Module._NewExplainState=wasmExports.NewExplainState)(),Module._ExplainEndOutput=ae=>(Module._ExplainEndOutput=wasmExports.ExplainEndOutput)(ae),Module._appendStringInfoSpaces=(ae,e)=>(Module._appendStringInfoSpaces=wasmExports.appendStringInfoSpaces)(ae,e),Module._ExplainPrintPlan=(ae,e)=>(Module._ExplainPrintPlan=wasmExports.ExplainPrintPlan)(ae,e),Module._ExplainPrintTriggers=(ae,e)=>(Module._ExplainPrintTriggers=wasmExports.ExplainPrintTriggers)(ae,e),Module._ExplainPrintJITSummary=(ae,e)=>(Module._ExplainPrintJITSummary=wasmExports.ExplainPrintJITSummary)(ae,e),Module._InstrEndLoop=ae=>(Module._InstrEndLoop=wasmExports.InstrEndLoop)(ae),Module._ExplainPropertyInteger=(ae,e,I,oe)=>(Module._ExplainPropertyInteger=wasmExports.ExplainPropertyInteger)(ae,e,I,oe),Module._ExplainQueryText=(ae,e)=>(Module._ExplainQueryText=wasmExports.ExplainQueryText)(ae,e),Module._ExplainPropertyText=(ae,e,I)=>(Module._ExplainPropertyText=wasmExports.ExplainPropertyText)(ae,e,I),Module._ExplainQueryParameters=(ae,e,I)=>(Module._ExplainQueryParameters=wasmExports.ExplainQueryParameters)(ae,e,I),Module._get_namespace_name_or_temp=ae=>(Module._get_namespace_name_or_temp=wasmExports.get_namespace_name_or_temp)(ae),Module._get_func_namespace=ae=>(Module._get_func_namespace=wasmExports.get_func_namespace)(ae),Module._construct_empty_array=ae=>(Module._construct_empty_array=wasmExports.construct_empty_array)(ae),Module._GetCommandTagName=ae=>(Module._GetCommandTagName=wasmExports.GetCommandTagName)(ae),Module._CreateExprContext=ae=>(Module._CreateExprContext=wasmExports.CreateExprContext)(ae),Module._EnsurePortalSnapshotExists=()=>(Module._EnsurePortalSnapshotExists=wasmExports.EnsurePortalSnapshotExists)(),Module._BeginCopyFrom=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._BeginCopyFrom=wasmExports.BeginCopyFrom)(ae,e,I,oe,ue,bt,tr,rr),Module._EndCopyFrom=ae=>(Module._EndCopyFrom=wasmExports.EndCopyFrom)(ae),Module._get_extension_oid=(ae,e)=>(Module._get_extension_oid=wasmExports.get_extension_oid)(ae,e),Module._strrchr=(ae,e)=>(Module._strrchr=wasmExports.strrchr)(ae,e),Module._getExtensionOfObject=(ae,e)=>(Module._getExtensionOfObject=wasmExports.getExtensionOfObject)(ae,e),Module._GetRelationPublications=ae=>(Module._GetRelationPublications=wasmExports.GetRelationPublications)(ae),Module._ExecStoreAllNullTuple=ae=>(Module._ExecStoreAllNullTuple=wasmExports.ExecStoreAllNullTuple)(ae),Module._CopyFromErrorCallback=ae=>(Module._CopyFromErrorCallback=wasmExports.CopyFromErrorCallback)(ae),Module._ExecInitRangeTable=(ae,e,I)=>(Module._ExecInitRangeTable=wasmExports.ExecInitRangeTable)(ae,e,I),Module._format_type_extended=(ae,e,I)=>(Module._format_type_extended=wasmExports.format_type_extended)(ae,e,I),Module._ExecReScan=ae=>(Module._ExecReScan=wasmExports.ExecReScan)(ae),Module._ExecInitExprList=(ae,e)=>(Module._ExecInitExprList=wasmExports.ExecInitExprList)(ae,e),Module._InstrAlloc=(ae,e,I)=>(Module._InstrAlloc=wasmExports.InstrAlloc)(ae,e,I),Module._standard_ExecutorStart=(ae,e)=>(Module._standard_ExecutorStart=wasmExports.standard_ExecutorStart)(ae,e),Module._standard_ExecutorRun=(ae,e,I,oe)=>(Module._standard_ExecutorRun=wasmExports.standard_ExecutorRun)(ae,e,I,oe),Module._standard_ExecutorFinish=ae=>(Module._standard_ExecutorFinish=wasmExports.standard_ExecutorFinish)(ae),Module._standard_ExecutorEnd=ae=>(Module._standard_ExecutorEnd=wasmExports.standard_ExecutorEnd)(ae),Module._get_partition_ancestors=ae=>(Module._get_partition_ancestors=wasmExports.get_partition_ancestors)(ae),Module._MakeTupleTableSlot=(ae,e)=>(Module._MakeTupleTableSlot=wasmExports.MakeTupleTableSlot)(ae,e),Module._ExecFindJunkAttributeInTlist=(ae,e)=>(Module._ExecFindJunkAttributeInTlist=wasmExports.ExecFindJunkAttributeInTlist)(ae,e),Module._ExecGetReturningSlot=(ae,e)=>(Module._ExecGetReturningSlot=wasmExports.ExecGetReturningSlot)(ae,e),Module._ExecAsyncResponse=ae=>(Module._ExecAsyncResponse=wasmExports.ExecAsyncResponse)(ae),Module._ExecAsyncRequestDone=(ae,e)=>(Module._ExecAsyncRequestDone=wasmExports.ExecAsyncRequestDone)(ae,e),Module._ExecAsyncRequestPending=ae=>(Module._ExecAsyncRequestPending=wasmExports.ExecAsyncRequestPending)(ae),Module._InstrUpdateTupleCount=(ae,e)=>(Module._InstrUpdateTupleCount=wasmExports.InstrUpdateTupleCount)(ae,e),Module._ExecOpenScanRelation=(ae,e,I)=>(Module._ExecOpenScanRelation=wasmExports.ExecOpenScanRelation)(ae,e,I),Module._ExecInitExprWithParams=(ae,e)=>(Module._ExecInitExprWithParams=wasmExports.ExecInitExprWithParams)(ae,e),Module._ExprEvalPushStep=(ae,e)=>(Module._ExprEvalPushStep=wasmExports.ExprEvalPushStep)(ae,e),Module._get_call_expr_argtype=(ae,e)=>(Module._get_call_expr_argtype=wasmExports.get_call_expr_argtype)(ae,e),Module._MakeExpandedObjectReadOnlyInternal=ae=>(Module._MakeExpandedObjectReadOnlyInternal=wasmExports.MakeExpandedObjectReadOnlyInternal)(ae),Module._SPI_connect_ext=ae=>(Module._SPI_connect_ext=wasmExports.SPI_connect_ext)(ae),Module._SPI_commit=()=>(Module._SPI_commit=wasmExports.SPI_commit)(),Module._CopyErrorData=()=>(Module._CopyErrorData=wasmExports.CopyErrorData)(),Module._FlushErrorState=()=>(Module._FlushErrorState=wasmExports.FlushErrorState)(),Module._ReThrowError=ae=>(Module._ReThrowError=wasmExports.ReThrowError)(ae),Module._SPI_commit_and_chain=()=>(Module._SPI_commit_and_chain=wasmExports.SPI_commit_and_chain)(),Module._SPI_rollback=()=>(Module._SPI_rollback=wasmExports.SPI_rollback)(),Module._SPI_rollback_and_chain=()=>(Module._SPI_rollback_and_chain=wasmExports.SPI_rollback_and_chain)(),Module._SPI_freetuptable=ae=>(Module._SPI_freetuptable=wasmExports.SPI_freetuptable)(ae),Module._SPI_execute_extended=(ae,e)=>(Module._SPI_execute_extended=wasmExports.SPI_execute_extended)(ae,e),Module._SPI_execp=(ae,e,I,oe)=>(Module._SPI_execp=wasmExports.SPI_execp)(ae,e,I,oe),Module._SPI_execute_plan_extended=(ae,e)=>(Module._SPI_execute_plan_extended=wasmExports.SPI_execute_plan_extended)(ae,e),Module._SPI_execute_plan_with_paramlist=(ae,e,I,oe)=>(Module._SPI_execute_plan_with_paramlist=wasmExports.SPI_execute_plan_with_paramlist)(ae,e,I,oe),Module._SPI_prepare=(ae,e,I)=>(Module._SPI_prepare=wasmExports.SPI_prepare)(ae,e,I),Module._SPI_prepare_extended=(ae,e)=>(Module._SPI_prepare_extended=wasmExports.SPI_prepare_extended)(ae,e),Module._SPI_keepplan=ae=>(Module._SPI_keepplan=wasmExports.SPI_keepplan)(ae),Module._SPI_freeplan=ae=>(Module._SPI_freeplan=wasmExports.SPI_freeplan)(ae),Module._SPI_copytuple=ae=>(Module._SPI_copytuple=wasmExports.SPI_copytuple)(ae),Module._SPI_returntuple=(ae,e)=>(Module._SPI_returntuple=wasmExports.SPI_returntuple)(ae,e),Module._SPI_fnumber=(ae,e)=>(Module._SPI_fnumber=wasmExports.SPI_fnumber)(ae,e),Module._SPI_fname=(ae,e)=>(Module._SPI_fname=wasmExports.SPI_fname)(ae,e),Module._SPI_getbinval=(ae,e,I,oe)=>(Module._SPI_getbinval=wasmExports.SPI_getbinval)(ae,e,I,oe),Module._SPI_gettype=(ae,e)=>(Module._SPI_gettype=wasmExports.SPI_gettype)(ae,e),Module._SPI_gettypeid=(ae,e)=>(Module._SPI_gettypeid=wasmExports.SPI_gettypeid)(ae,e),Module._SPI_getrelname=ae=>(Module._SPI_getrelname=wasmExports.SPI_getrelname)(ae),Module._SPI_palloc=ae=>(Module._SPI_palloc=wasmExports.SPI_palloc)(ae),Module._SPI_datumTransfer=(ae,e,I)=>(Module._SPI_datumTransfer=wasmExports.SPI_datumTransfer)(ae,e,I),Module._datumTransfer=(ae,e,I)=>(Module._datumTransfer=wasmExports.datumTransfer)(ae,e,I),Module._SPI_cursor_open_with_paramlist=(ae,e,I,oe)=>(Module._SPI_cursor_open_with_paramlist=wasmExports.SPI_cursor_open_with_paramlist)(ae,e,I,oe),Module._SPI_cursor_parse_open=(ae,e,I)=>(Module._SPI_cursor_parse_open=wasmExports.SPI_cursor_parse_open)(ae,e,I),Module._SPI_cursor_find=ae=>(Module._SPI_cursor_find=wasmExports.SPI_cursor_find)(ae),Module._SPI_cursor_fetch=(ae,e,I)=>(Module._SPI_cursor_fetch=wasmExports.SPI_cursor_fetch)(ae,e,I),Module._SPI_scroll_cursor_fetch=(ae,e,I)=>(Module._SPI_scroll_cursor_fetch=wasmExports.SPI_scroll_cursor_fetch)(ae,e,I),Module._SPI_scroll_cursor_move=(ae,e,I)=>(Module._SPI_scroll_cursor_move=wasmExports.SPI_scroll_cursor_move)(ae,e,I),Module._SPI_cursor_close=ae=>(Module._SPI_cursor_close=wasmExports.SPI_cursor_close)(ae),Module._SPI_result_code_string=ae=>(Module._SPI_result_code_string=wasmExports.SPI_result_code_string)(ae),Module._SPI_plan_get_plan_sources=ae=>(Module._SPI_plan_get_plan_sources=wasmExports.SPI_plan_get_plan_sources)(ae),Module._SPI_plan_get_cached_plan=ae=>(Module._SPI_plan_get_cached_plan=wasmExports.SPI_plan_get_cached_plan)(ae),Module._SPI_register_trigger_data=ae=>(Module._SPI_register_trigger_data=wasmExports.SPI_register_trigger_data)(ae),Module._tuplestore_tuple_count=ae=>(Module._tuplestore_tuple_count=wasmExports.tuplestore_tuple_count)(ae),Module._tuplesort_gettupleslot=(ae,e,I,oe,ue)=>(Module._tuplesort_gettupleslot=wasmExports.tuplesort_gettupleslot)(ae,e,I,oe,ue),Module._tuplesort_begin_heap=(ae,e,I,oe,ue,bt,tr,rr,ir)=>(Module._tuplesort_begin_heap=wasmExports.tuplesort_begin_heap)(ae,e,I,oe,ue,bt,tr,rr,ir),Module._tuplesort_reset=ae=>(Module._tuplesort_reset=wasmExports.tuplesort_reset)(ae),Module._tuplesort_puttupleslot=(ae,e)=>(Module._tuplesort_puttupleslot=wasmExports.tuplesort_puttupleslot)(ae,e),Module._construct_md_array=(ae,e,I,oe,ue,bt,tr,rr,ir)=>(Module._construct_md_array=wasmExports.construct_md_array)(ae,e,I,oe,ue,bt,tr,rr,ir),Module._expanded_record_fetch_tupdesc=ae=>(Module._expanded_record_fetch_tupdesc=wasmExports.expanded_record_fetch_tupdesc)(ae),Module._expanded_record_fetch_field=(ae,e,I)=>(Module._expanded_record_fetch_field=wasmExports.expanded_record_fetch_field)(ae,e,I),Module._MemoryContextGetParent=ae=>(Module._MemoryContextGetParent=wasmExports.MemoryContextGetParent)(ae),Module._DeleteExpandedObject=ae=>(Module._DeleteExpandedObject=wasmExports.DeleteExpandedObject)(ae),Module._FreeExprContext=(ae,e)=>(Module._FreeExprContext=wasmExports.FreeExprContext)(ae,e),Module._ExecGetResultRelCheckAsUser=(ae,e)=>(Module._ExecGetResultRelCheckAsUser=wasmExports.ExecGetResultRelCheckAsUser)(ae,e),Module._MemoryContextMemAllocated=(ae,e)=>(Module._MemoryContextMemAllocated=wasmExports.MemoryContextMemAllocated)(ae,e),Module._tuplestore_puttuple=(ae,e)=>(Module._tuplestore_puttuple=wasmExports.tuplestore_puttuple)(ae,e),Module._standard_ProcessUtility=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._standard_ProcessUtility=wasmExports.standard_ProcessUtility)(ae,e,I,oe,ue,bt,tr,rr),Module._sigaddset=(ae,e)=>(Module._sigaddset=wasmExports.sigaddset)(ae,e),Module._fsync_pgdata=(ae,e)=>(Module._fsync_pgdata=wasmExports.fsync_pgdata)(ae,e),Module._get_restricted_token=()=>(Module._get_restricted_token=wasmExports.get_restricted_token)(),Module._pg_malloc=ae=>(Module._pg_malloc=wasmExports.pg_malloc)(ae),Module._pg_realloc=(ae,e)=>(Module._pg_realloc=wasmExports.pg_realloc)(ae,e),Module._pg_strdup=ae=>(Module._pg_strdup=wasmExports.pg_strdup)(ae),Module._simple_prompt=(ae,e)=>(Module._simple_prompt=wasmExports.simple_prompt)(ae,e),Module._interactive_file=()=>(Module._interactive_file=wasmExports.interactive_file)(),Module._interactive_one=()=>(Module._interactive_one=wasmExports.interactive_one)(),Module._EmitErrorReport=()=>(Module._EmitErrorReport=wasmExports.EmitErrorReport)(),Module._pg_shutdown=()=>(Module._pg_shutdown=wasmExports.pg_shutdown)(),Module._errhidestmt=ae=>(Module._errhidestmt=wasmExports.errhidestmt)(ae),Module._interactive_write=ae=>(Module._interactive_write=wasmExports.interactive_write)(ae),Module._interactive_read=()=>(Module._interactive_read=wasmExports.interactive_read)(),Module._SignalHandlerForConfigReload=ae=>(Module._SignalHandlerForConfigReload=wasmExports.SignalHandlerForConfigReload)(ae),Module._PQconnectStartParams=(ae,e,I)=>(Module._PQconnectStartParams=wasmExports.PQconnectStartParams)(ae,e,I),Module._PQstatus=ae=>(Module._PQstatus=wasmExports.PQstatus)(ae),Module._PQsocket=ae=>(Module._PQsocket=wasmExports.PQsocket)(ae),Module._ProcessWalRcvInterrupts=()=>(Module._ProcessWalRcvInterrupts=wasmExports.ProcessWalRcvInterrupts)(),Module._PQconnectPoll=ae=>(Module._PQconnectPoll=wasmExports.PQconnectPoll)(ae),Module._PQconnectionUsedPassword=ae=>(Module._PQconnectionUsedPassword=wasmExports.PQconnectionUsedPassword)(ae),Module._PQfinish=ae=>(Module._PQfinish=wasmExports.PQfinish)(ae),Module._PQresultStatus=ae=>(Module._PQresultStatus=wasmExports.PQresultStatus)(ae),Module._PQclear=ae=>(Module._PQclear=wasmExports.PQclear)(ae),Module._PQerrorMessage=ae=>(Module._PQerrorMessage=wasmExports.PQerrorMessage)(ae),Module._pchomp=ae=>(Module._pchomp=wasmExports.pchomp)(ae),Module._PQnfields=ae=>(Module._PQnfields=wasmExports.PQnfields)(ae),Module._PQntuples=ae=>(Module._PQntuples=wasmExports.PQntuples)(ae),Module._PQgetvalue=(ae,e,I)=>(Module._PQgetvalue=wasmExports.PQgetvalue)(ae,e,I),Module._PQconsumeInput=ae=>(Module._PQconsumeInput=wasmExports.PQconsumeInput)(ae),Module._PQgetisnull=(ae,e,I)=>(Module._PQgetisnull=wasmExports.PQgetisnull)(ae,e,I),Module._PQresultErrorField=(ae,e)=>(Module._PQresultErrorField=wasmExports.PQresultErrorField)(ae,e),Module._PQsendQuery=(ae,e)=>(Module._PQsendQuery=wasmExports.PQsendQuery)(ae,e),Module._PQisBusy=ae=>(Module._PQisBusy=wasmExports.PQisBusy)(ae),Module._PQgetResult=ae=>(Module._PQgetResult=wasmExports.PQgetResult)(ae),Module._CacheRegisterRelcacheCallback=(ae,e)=>(Module._CacheRegisterRelcacheCallback=wasmExports.CacheRegisterRelcacheCallback)(ae,e),Module._hash_seq_term=ae=>(Module._hash_seq_term=wasmExports.hash_seq_term)(ae),Module._SignalHandlerForShutdownRequest=ae=>(Module._SignalHandlerForShutdownRequest=wasmExports.SignalHandlerForShutdownRequest)(ae),Module._replorigin_by_oid=(ae,e,I)=>(Module._replorigin_by_oid=wasmExports.replorigin_by_oid)(ae,e,I),Module._logicalrep_write_begin=(ae,e)=>(Module._logicalrep_write_begin=wasmExports.logicalrep_write_begin)(ae,e),Module._logicalrep_write_commit=(ae,e,I)=>(Module._logicalrep_write_commit=wasmExports.logicalrep_write_commit)(ae,e,I),Module._logicalrep_write_begin_prepare=(ae,e)=>(Module._logicalrep_write_begin_prepare=wasmExports.logicalrep_write_begin_prepare)(ae,e),Module._logicalrep_write_prepare=(ae,e,I)=>(Module._logicalrep_write_prepare=wasmExports.logicalrep_write_prepare)(ae,e,I),Module._logicalrep_write_commit_prepared=(ae,e,I)=>(Module._logicalrep_write_commit_prepared=wasmExports.logicalrep_write_commit_prepared)(ae,e,I),Module._logicalrep_write_rollback_prepared=(ae,e,I,oe)=>(Module._logicalrep_write_rollback_prepared=wasmExports.logicalrep_write_rollback_prepared)(ae,e,I,oe),Module._logicalrep_write_stream_prepare=(ae,e,I)=>(Module._logicalrep_write_stream_prepare=wasmExports.logicalrep_write_stream_prepare)(ae,e,I),Module._logicalrep_write_origin=(ae,e,I)=>(Module._logicalrep_write_origin=wasmExports.logicalrep_write_origin)(ae,e,I),Module._logicalrep_write_insert=(ae,e,I,oe,ue,bt)=>(Module._logicalrep_write_insert=wasmExports.logicalrep_write_insert)(ae,e,I,oe,ue,bt),Module._logicalrep_write_update=(ae,e,I,oe,ue,bt,tr)=>(Module._logicalrep_write_update=wasmExports.logicalrep_write_update)(ae,e,I,oe,ue,bt,tr),Module._logicalrep_write_delete=(ae,e,I,oe,ue,bt)=>(Module._logicalrep_write_delete=wasmExports.logicalrep_write_delete)(ae,e,I,oe,ue,bt),Module._logicalrep_write_truncate=(ae,e,I,oe,ue,bt)=>(Module._logicalrep_write_truncate=wasmExports.logicalrep_write_truncate)(ae,e,I,oe,ue,bt),Module._logicalrep_write_message=(ae,e,I,oe,ue,bt,tr)=>(Module._logicalrep_write_message=wasmExports.logicalrep_write_message)(ae,e,I,oe,ue,bt,tr),Module._logicalrep_write_rel=(ae,e,I,oe)=>(Module._logicalrep_write_rel=wasmExports.logicalrep_write_rel)(ae,e,I,oe),Module._logicalrep_write_typ=(ae,e,I)=>(Module._logicalrep_write_typ=wasmExports.logicalrep_write_typ)(ae,e,I),Module._logicalrep_write_stream_start=(ae,e,I)=>(Module._logicalrep_write_stream_start=wasmExports.logicalrep_write_stream_start)(ae,e,I),Module._logicalrep_write_stream_stop=ae=>(Module._logicalrep_write_stream_stop=wasmExports.logicalrep_write_stream_stop)(ae),Module._logicalrep_write_stream_commit=(ae,e,I)=>(Module._logicalrep_write_stream_commit=wasmExports.logicalrep_write_stream_commit)(ae,e,I),Module._logicalrep_write_stream_abort=(ae,e,I,oe,ue,bt)=>(Module._logicalrep_write_stream_abort=wasmExports.logicalrep_write_stream_abort)(ae,e,I,oe,ue,bt),Module._FreeErrorData=ae=>(Module._FreeErrorData=wasmExports.FreeErrorData)(ae),Module._RelidByRelfilenumber=(ae,e)=>(Module._RelidByRelfilenumber=wasmExports.RelidByRelfilenumber)(ae,e),Module._array_contains_nulls=ae=>(Module._array_contains_nulls=wasmExports.array_contains_nulls)(ae),Module._OutputPluginPrepareWrite=(ae,e)=>(Module._OutputPluginPrepareWrite=wasmExports.OutputPluginPrepareWrite)(ae,e),Module._OutputPluginWrite=(ae,e)=>(Module._OutputPluginWrite=wasmExports.OutputPluginWrite)(ae,e),Module._OutputPluginUpdateProgress=(ae,e)=>(Module._OutputPluginUpdateProgress=wasmExports.OutputPluginUpdateProgress)(ae,e),Module._RegisterBackgroundWorker=ae=>(Module._RegisterBackgroundWorker=wasmExports.RegisterBackgroundWorker)(ae),Module._toupper=ae=>(Module._toupper=wasmExports.toupper)(ae),Module._pg_reg_getinitialstate=ae=>(Module._pg_reg_getinitialstate=wasmExports.pg_reg_getinitialstate)(ae),Module._pg_reg_getfinalstate=ae=>(Module._pg_reg_getfinalstate=wasmExports.pg_reg_getfinalstate)(ae),Module._pg_reg_getnumoutarcs=(ae,e)=>(Module._pg_reg_getnumoutarcs=wasmExports.pg_reg_getnumoutarcs)(ae,e),Module._pg_reg_getoutarcs=(ae,e,I,oe)=>(Module._pg_reg_getoutarcs=wasmExports.pg_reg_getoutarcs)(ae,e,I,oe),Module._pg_reg_getnumcolors=ae=>(Module._pg_reg_getnumcolors=wasmExports.pg_reg_getnumcolors)(ae),Module._pg_reg_colorisbegin=(ae,e)=>(Module._pg_reg_colorisbegin=wasmExports.pg_reg_colorisbegin)(ae,e),Module._pg_reg_colorisend=(ae,e)=>(Module._pg_reg_colorisend=wasmExports.pg_reg_colorisend)(ae,e),Module._pg_reg_getnumcharacters=(ae,e)=>(Module._pg_reg_getnumcharacters=wasmExports.pg_reg_getnumcharacters)(ae,e),Module._pg_reg_getcharacters=(ae,e,I,oe)=>(Module._pg_reg_getcharacters=wasmExports.pg_reg_getcharacters)(ae,e,I,oe),Module._GetConfigOption=(ae,e,I)=>(Module._GetConfigOption=wasmExports.GetConfigOption)(ae,e,I),Module._pg_prng_seed_check=ae=>(Module._pg_prng_seed_check=wasmExports.pg_prng_seed_check)(ae),Module._pg_prng_seed=(ae,e)=>(Module._pg_prng_seed=wasmExports.pg_prng_seed)(ae,e),Module._fputc=(ae,e)=>(Module._fputc=wasmExports.fputc)(ae,e),Module._WaitForBackgroundWorkerStartup=(ae,e)=>(Module._WaitForBackgroundWorkerStartup=wasmExports.WaitForBackgroundWorkerStartup)(ae,e),Module._dlsym=(ae,e)=>(Module._dlsym=wasmExports.dlsym)(ae,e),Module._dlopen=(ae,e)=>(Module._dlopen=wasmExports.dlopen)(ae,e),Module._dlerror=()=>(Module._dlerror=wasmExports.dlerror)(),Module._dlclose=ae=>(Module._dlclose=wasmExports.dlclose)(ae),Module._find_rendezvous_variable=ae=>(Module._find_rendezvous_variable=wasmExports.find_rendezvous_variable)(ae),Module._resolve_polymorphic_argtypes=(ae,e,I,oe)=>(Module._resolve_polymorphic_argtypes=wasmExports.resolve_polymorphic_argtypes)(ae,e,I,oe),Module._get_func_arg_info=(ae,e,I,oe)=>(Module._get_func_arg_info=wasmExports.get_func_arg_info)(ae,e,I,oe),Module._CallerFInfoFunctionCall2=(ae,e,I,oe,ue)=>(Module._CallerFInfoFunctionCall2=wasmExports.CallerFInfoFunctionCall2)(ae,e,I,oe,ue),Module._FunctionCall0Coll=(ae,e)=>(Module._FunctionCall0Coll=wasmExports.FunctionCall0Coll)(ae,e),Module._get_fn_expr_rettype=ae=>(Module._get_fn_expr_rettype=wasmExports.get_fn_expr_rettype)(ae),Module._has_fn_opclass_options=ae=>(Module._has_fn_opclass_options=wasmExports.has_fn_opclass_options)(ae),Module._CheckFunctionValidatorAccess=(ae,e)=>(Module._CheckFunctionValidatorAccess=wasmExports.CheckFunctionValidatorAccess)(ae,e),Module._pg_do_encoding_conversion=(ae,e,I,oe)=>(Module._pg_do_encoding_conversion=wasmExports.pg_do_encoding_conversion)(ae,e,I,oe),Module._MemoryContextAllocHuge=(ae,e)=>(Module._MemoryContextAllocHuge=wasmExports.MemoryContextAllocHuge)(ae,e),Module._pg_utf_mblen=ae=>(Module._pg_utf_mblen=wasmExports.pg_utf_mblen)(ae),Module._pg_wchar2mb_with_len=(ae,e,I)=>(Module._pg_wchar2mb_with_len=wasmExports.pg_wchar2mb_with_len)(ae,e,I),Module._check_encoding_conversion_args=(ae,e,I,oe,ue)=>(Module._check_encoding_conversion_args=wasmExports.check_encoding_conversion_args)(ae,e,I,oe,ue),Module._report_untranslatable_char=(ae,e,I,oe)=>(Module._report_untranslatable_char=wasmExports.report_untranslatable_char)(ae,e,I,oe),Module._local2local=(ae,e,I,oe,ue,bt,tr)=>(Module._local2local=wasmExports.local2local)(ae,e,I,oe,ue,bt,tr),Module._latin2mic=(ae,e,I,oe,ue,bt)=>(Module._latin2mic=wasmExports.latin2mic)(ae,e,I,oe,ue,bt),Module._mic2latin=(ae,e,I,oe,ue,bt)=>(Module._mic2latin=wasmExports.mic2latin)(ae,e,I,oe,ue,bt),Module._latin2mic_with_table=(ae,e,I,oe,ue,bt,tr)=>(Module._latin2mic_with_table=wasmExports.latin2mic_with_table)(ae,e,I,oe,ue,bt,tr),Module._mic2latin_with_table=(ae,e,I,oe,ue,bt,tr)=>(Module._mic2latin_with_table=wasmExports.mic2latin_with_table)(ae,e,I,oe,ue,bt,tr),Module._pg_encoding_verifymbchar=(ae,e,I)=>(Module._pg_encoding_verifymbchar=wasmExports.pg_encoding_verifymbchar)(ae,e,I),Module._ResourceOwnerReleaseAllPlanCacheRefs=ae=>(Module._ResourceOwnerReleaseAllPlanCacheRefs=wasmExports.ResourceOwnerReleaseAllPlanCacheRefs)(ae),Module._RegisterResourceReleaseCallback=(ae,e)=>(Module._RegisterResourceReleaseCallback=wasmExports.RegisterResourceReleaseCallback)(ae,e),Module._is_publishable_relation=ae=>(Module._is_publishable_relation=wasmExports.is_publishable_relation)(ae),Module._GetSchemaPublications=ae=>(Module._GetSchemaPublications=wasmExports.GetSchemaPublications)(ae),Module._err_generic_string=(ae,e)=>(Module._err_generic_string=wasmExports.err_generic_string)(ae,e),Module._get_rel_relispartition=ae=>(Module._get_rel_relispartition=wasmExports.get_rel_relispartition)(ae),Module._texteq=ae=>(Module._texteq=wasmExports.texteq)(ae),Module._get_typsubscript=(ae,e)=>(Module._get_typsubscript=wasmExports.get_typsubscript)(ae,e),Module._CachedPlanAllowsSimpleValidityCheck=(ae,e,I)=>(Module._CachedPlanAllowsSimpleValidityCheck=wasmExports.CachedPlanAllowsSimpleValidityCheck)(ae,e,I),Module._CachedPlanIsSimplyValid=(ae,e,I)=>(Module._CachedPlanIsSimplyValid=wasmExports.CachedPlanIsSimplyValid)(ae,e,I),Module._GetCachedExpression=ae=>(Module._GetCachedExpression=wasmExports.GetCachedExpression)(ae),Module._FreeCachedExpression=ae=>(Module._FreeCachedExpression=wasmExports.FreeCachedExpression)(ae),Module._strlcat=(ae,e,I)=>(Module._strlcat=wasmExports.strlcat)(ae,e,I),Module._pg_bindtextdomain=ae=>(Module._pg_bindtextdomain=wasmExports.pg_bindtextdomain)(ae),Module._tidin=ae=>(Module._tidin=wasmExports.tidin)(ae),Module._tidout=ae=>(Module._tidout=wasmExports.tidout)(ae),Module._btfloat4cmp=ae=>(Module._btfloat4cmp=wasmExports.btfloat4cmp)(ae),Module._btfloat8cmp=ae=>(Module._btfloat8cmp=wasmExports.btfloat8cmp)(ae),Module._btnamecmp=ae=>(Module._btnamecmp=wasmExports.btnamecmp)(ae),Module._bttextcmp=ae=>(Module._bttextcmp=wasmExports.bttextcmp)(ae),Module._cash_cmp=ae=>(Module._cash_cmp=wasmExports.cash_cmp)(ae),Module._text_lt=ae=>(Module._text_lt=wasmExports.text_lt)(ae),Module._text_le=ae=>(Module._text_le=wasmExports.text_le)(ae),Module._text_gt=ae=>(Module._text_gt=wasmExports.text_gt)(ae),Module._text_ge=ae=>(Module._text_ge=wasmExports.text_ge)(ae),Module._current_query=ae=>(Module._current_query=wasmExports.current_query)(ae),Module._macaddr_eq=ae=>(Module._macaddr_eq=wasmExports.macaddr_eq)(ae),Module._macaddr_lt=ae=>(Module._macaddr_lt=wasmExports.macaddr_lt)(ae),Module._macaddr_le=ae=>(Module._macaddr_le=wasmExports.macaddr_le)(ae),Module._macaddr_gt=ae=>(Module._macaddr_gt=wasmExports.macaddr_gt)(ae),Module._macaddr_ge=ae=>(Module._macaddr_ge=wasmExports.macaddr_ge)(ae),Module._macaddr_cmp=ae=>(Module._macaddr_cmp=wasmExports.macaddr_cmp)(ae),Module._inet_in=ae=>(Module._inet_in=wasmExports.inet_in)(ae),Module._network_cmp=ae=>(Module._network_cmp=wasmExports.network_cmp)(ae),Module._bpchareq=ae=>(Module._bpchareq=wasmExports.bpchareq)(ae),Module._bpcharlt=ae=>(Module._bpcharlt=wasmExports.bpcharlt)(ae),Module._bpcharle=ae=>(Module._bpcharle=wasmExports.bpcharle)(ae),Module._bpchargt=ae=>(Module._bpchargt=wasmExports.bpchargt)(ae),Module._bpcharge=ae=>(Module._bpcharge=wasmExports.bpcharge)(ae),Module._bpcharcmp=ae=>(Module._bpcharcmp=wasmExports.bpcharcmp)(ae),Module._date_eq=ae=>(Module._date_eq=wasmExports.date_eq)(ae),Module._date_lt=ae=>(Module._date_lt=wasmExports.date_lt)(ae),Module._date_le=ae=>(Module._date_le=wasmExports.date_le)(ae),Module._date_gt=ae=>(Module._date_gt=wasmExports.date_gt)(ae),Module._date_ge=ae=>(Module._date_ge=wasmExports.date_ge)(ae),Module._date_cmp=ae=>(Module._date_cmp=wasmExports.date_cmp)(ae),Module._time_lt=ae=>(Module._time_lt=wasmExports.time_lt)(ae),Module._time_le=ae=>(Module._time_le=wasmExports.time_le)(ae),Module._time_gt=ae=>(Module._time_gt=wasmExports.time_gt)(ae),Module._time_ge=ae=>(Module._time_ge=wasmExports.time_ge)(ae),Module._time_cmp=ae=>(Module._time_cmp=wasmExports.time_cmp)(ae),Module._date_mi=ae=>(Module._date_mi=wasmExports.date_mi)(ae),Module._time_eq=ae=>(Module._time_eq=wasmExports.time_eq)(ae),Module._timestamp_eq=ae=>(Module._timestamp_eq=wasmExports.timestamp_eq)(ae),Module._timestamp_lt=ae=>(Module._timestamp_lt=wasmExports.timestamp_lt)(ae),Module._timestamp_le=ae=>(Module._timestamp_le=wasmExports.timestamp_le)(ae),Module._timestamp_ge=ae=>(Module._timestamp_ge=wasmExports.timestamp_ge)(ae),Module._timestamp_gt=ae=>(Module._timestamp_gt=wasmExports.timestamp_gt)(ae),Module._interval_eq=ae=>(Module._interval_eq=wasmExports.interval_eq)(ae),Module._interval_lt=ae=>(Module._interval_lt=wasmExports.interval_lt)(ae),Module._interval_le=ae=>(Module._interval_le=wasmExports.interval_le)(ae),Module._interval_ge=ae=>(Module._interval_ge=wasmExports.interval_ge)(ae),Module._interval_gt=ae=>(Module._interval_gt=wasmExports.interval_gt)(ae),Module._interval_um=ae=>(Module._interval_um=wasmExports.interval_um)(ae),Module._interval_mi=ae=>(Module._interval_mi=wasmExports.interval_mi)(ae),Module._timestamp_mi=ae=>(Module._timestamp_mi=wasmExports.timestamp_mi)(ae),Module._quote_ident=ae=>(Module._quote_ident=wasmExports.quote_ident)(ae),Module._timestamp_in=ae=>(Module._timestamp_in=wasmExports.timestamp_in)(ae),Module._timestamp_cmp=ae=>(Module._timestamp_cmp=wasmExports.timestamp_cmp)(ae),Module._interval_cmp=ae=>(Module._interval_cmp=wasmExports.interval_cmp)(ae),Module._timetz_cmp=ae=>(Module._timetz_cmp=wasmExports.timetz_cmp)(ae),Module._varbit_in=ae=>(Module._varbit_in=wasmExports.varbit_in)(ae),Module._biteq=ae=>(Module._biteq=wasmExports.biteq)(ae),Module._bitge=ae=>(Module._bitge=wasmExports.bitge)(ae),Module._bitgt=ae=>(Module._bitgt=wasmExports.bitgt)(ae),Module._bitle=ae=>(Module._bitle=wasmExports.bitle)(ae),Module._bitlt=ae=>(Module._bitlt=wasmExports.bitlt)(ae),Module._bitcmp=ae=>(Module._bitcmp=wasmExports.bitcmp)(ae),Module._time_mi_time=ae=>(Module._time_mi_time=wasmExports.time_mi_time)(ae),Module._numeric_eq=ae=>(Module._numeric_eq=wasmExports.numeric_eq)(ae),Module._numeric_gt=ae=>(Module._numeric_gt=wasmExports.numeric_gt)(ae),Module._numeric_ge=ae=>(Module._numeric_ge=wasmExports.numeric_ge)(ae),Module._numeric_lt=ae=>(Module._numeric_lt=wasmExports.numeric_lt)(ae),Module._numeric_le=ae=>(Module._numeric_le=wasmExports.numeric_le)(ae),Module._numeric_div=ae=>(Module._numeric_div=wasmExports.numeric_div)(ae),Module._numeric_float4=ae=>(Module._numeric_float4=wasmExports.numeric_float4)(ae),Module._numeric_cmp=ae=>(Module._numeric_cmp=wasmExports.numeric_cmp)(ae),Module._byteaeq=ae=>(Module._byteaeq=wasmExports.byteaeq)(ae),Module._bytealt=ae=>(Module._bytealt=wasmExports.bytealt)(ae),Module._byteale=ae=>(Module._byteale=wasmExports.byteale)(ae),Module._byteagt=ae=>(Module._byteagt=wasmExports.byteagt)(ae),Module._byteage=ae=>(Module._byteage=wasmExports.byteage)(ae),Module._byteacmp=ae=>(Module._byteacmp=wasmExports.byteacmp)(ae),Module._to_hex32=ae=>(Module._to_hex32=wasmExports.to_hex32)(ae),Module._uuid_in=ae=>(Module._uuid_in=wasmExports.uuid_in)(ae),Module._uuid_out=ae=>(Module._uuid_out=wasmExports.uuid_out)(ae),Module._uuid_cmp=ae=>(Module._uuid_cmp=wasmExports.uuid_cmp)(ae),Module._gen_random_uuid=ae=>(Module._gen_random_uuid=wasmExports.gen_random_uuid)(ae),Module._enum_lt=ae=>(Module._enum_lt=wasmExports.enum_lt)(ae),Module._enum_gt=ae=>(Module._enum_gt=wasmExports.enum_gt)(ae),Module._enum_le=ae=>(Module._enum_le=wasmExports.enum_le)(ae),Module._enum_ge=ae=>(Module._enum_ge=wasmExports.enum_ge)(ae),Module._enum_cmp=ae=>(Module._enum_cmp=wasmExports.enum_cmp)(ae),Module._arraycontsel=ae=>(Module._arraycontsel=wasmExports.arraycontsel)(ae),Module._arraycontjoinsel=ae=>(Module._arraycontjoinsel=wasmExports.arraycontjoinsel)(ae),Module._macaddr8_eq=ae=>(Module._macaddr8_eq=wasmExports.macaddr8_eq)(ae),Module._macaddr8_lt=ae=>(Module._macaddr8_lt=wasmExports.macaddr8_lt)(ae),Module._macaddr8_le=ae=>(Module._macaddr8_le=wasmExports.macaddr8_le)(ae),Module._macaddr8_gt=ae=>(Module._macaddr8_gt=wasmExports.macaddr8_gt)(ae),Module._macaddr8_ge=ae=>(Module._macaddr8_ge=wasmExports.macaddr8_ge)(ae),Module._macaddr8_cmp=ae=>(Module._macaddr8_cmp=wasmExports.macaddr8_cmp)(ae),Module._PinPortal=ae=>(Module._PinPortal=wasmExports.PinPortal)(ae),Module._UnpinPortal=ae=>(Module._UnpinPortal=wasmExports.UnpinPortal)(ae),Module._strnlen=(ae,e)=>(Module._strnlen=wasmExports.strnlen)(ae,e),Module._DefineCustomBoolVariable=(ae,e,I,oe,ue,bt,tr,rr,ir,lr)=>(Module._DefineCustomBoolVariable=wasmExports.DefineCustomBoolVariable)(ae,e,I,oe,ue,bt,tr,rr,ir,lr),Module._DefineCustomIntVariable=(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr)=>(Module._DefineCustomIntVariable=wasmExports.DefineCustomIntVariable)(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr),Module._DefineCustomRealVariable=(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr)=>(Module._DefineCustomRealVariable=wasmExports.DefineCustomRealVariable)(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr),Module._DefineCustomStringVariable=(ae,e,I,oe,ue,bt,tr,rr,ir,lr)=>(Module._DefineCustomStringVariable=wasmExports.DefineCustomStringVariable)(ae,e,I,oe,ue,bt,tr,rr,ir,lr),Module._DefineCustomEnumVariable=(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr)=>(Module._DefineCustomEnumVariable=wasmExports.DefineCustomEnumVariable)(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr),Module._MarkGUCPrefixReserved=ae=>(Module._MarkGUCPrefixReserved=wasmExports.MarkGUCPrefixReserved)(ae),Module._strcspn=(ae,e)=>(Module._strcspn=wasmExports.strcspn)(ae,e),Module._sampler_random_init_state=(ae,e)=>(Module._sampler_random_init_state=wasmExports.sampler_random_init_state)(ae,e),Module._unpack_sql_state=ae=>(Module._unpack_sql_state=wasmExports.unpack_sql_state)(ae),Module._JsonbValueToJsonb=ae=>(Module._JsonbValueToJsonb=wasmExports.JsonbValueToJsonb)(ae),Module._ArrayGetIntegerTypmods=(ae,e)=>(Module._ArrayGetIntegerTypmods=wasmExports.ArrayGetIntegerTypmods)(ae,e),Module._numeric_is_nan=ae=>(Module._numeric_is_nan=wasmExports.numeric_is_nan)(ae),Module._log10=ae=>(Module._log10=wasmExports.log10)(ae),Module.___multi3=(ae,e,I,oe,ue)=>(Module.___multi3=wasmExports.__multi3)(ae,e,I,oe,ue),Module._int64_to_numeric=ae=>(Module._int64_to_numeric=wasmExports.int64_to_numeric)(ae),Module._numeric_float8_no_overflow=ae=>(Module._numeric_float8_no_overflow=wasmExports.numeric_float8_no_overflow)(ae),Module._pg_xml_init=ae=>(Module._pg_xml_init=wasmExports.pg_xml_init)(ae),Module._xmlInitParser=()=>(Module._xmlInitParser=wasmExports.xmlInitParser)(),Module._xml_ereport=(ae,e,I,oe)=>(Module._xml_ereport=wasmExports.xml_ereport)(ae,e,I,oe),Module._pg_xml_done=(ae,e)=>(Module._pg_xml_done=wasmExports.pg_xml_done)(ae,e),Module._xmlXPathNewContext=ae=>(Module._xmlXPathNewContext=wasmExports.xmlXPathNewContext)(ae),Module._xmlXPathFreeContext=ae=>(Module._xmlXPathFreeContext=wasmExports.xmlXPathFreeContext)(ae),Module._xmlFreeDoc=ae=>(Module._xmlFreeDoc=wasmExports.xmlFreeDoc)(ae),Module._xmlXPathCompile=ae=>(Module._xmlXPathCompile=wasmExports.xmlXPathCompile)(ae),Module._xmlXPathCompiledEval=(ae,e)=>(Module._xmlXPathCompiledEval=wasmExports.xmlXPathCompiledEval)(ae,e),Module._xmlXPathFreeCompExpr=ae=>(Module._xmlXPathFreeCompExpr=wasmExports.xmlXPathFreeCompExpr)(ae),Module._xmlStrdup=ae=>(Module._xmlStrdup=wasmExports.xmlStrdup)(ae),Module._initArrayResult=(ae,e,I)=>(Module._initArrayResult=wasmExports.initArrayResult)(ae,e,I),Module._xmlXPathCastNodeToString=ae=>(Module._xmlXPathCastNodeToString=wasmExports.xmlXPathCastNodeToString)(ae),Module._TransferExpandedObject=(ae,e)=>(Module._TransferExpandedObject=wasmExports.TransferExpandedObject)(ae,e),Module._pushJsonbValue=(ae,e,I)=>(Module._pushJsonbValue=wasmExports.pushJsonbValue)(ae,e,I),Module._varstr_levenshtein=(ae,e,I,oe,ue,bt,tr,rr)=>(Module._varstr_levenshtein=wasmExports.varstr_levenshtein)(ae,e,I,oe,ue,bt,tr,rr),Module._utf8_to_unicode=ae=>(Module._utf8_to_unicode=wasmExports.utf8_to_unicode)(ae),Module._generic_restriction_selectivity=(ae,e,I,oe,ue,bt)=>(Module._generic_restriction_selectivity=wasmExports.generic_restriction_selectivity)(ae,e,I,oe,ue,bt),Module._convert_network_to_scalar=(ae,e,I)=>(Module._convert_network_to_scalar=wasmExports.convert_network_to_scalar)(ae,e,I),Module._genericcostestimate=(ae,e,I,oe)=>(Module._genericcostestimate=wasmExports.genericcostestimate)(ae,e,I,oe),Module._IsValidJsonNumber=(ae,e)=>(Module._IsValidJsonNumber=wasmExports.IsValidJsonNumber)(ae,e),Module._array_create_iterator=(ae,e,I)=>(Module._array_create_iterator=wasmExports.array_create_iterator)(ae,e,I),Module._array_iterate=(ae,e,I)=>(Module._array_iterate=wasmExports.array_iterate)(ae,e,I),Module._pg_inet_net_ntop=(ae,e,I,oe,ue)=>(Module._pg_inet_net_ntop=wasmExports.pg_inet_net_ntop)(ae,e,I,oe,ue),Module._expand_array=(ae,e,I)=>(Module._expand_array=wasmExports.expand_array)(ae,e,I),Module._forkname_to_number=ae=>(Module._forkname_to_number=wasmExports.forkname_to_number)(ae),Module._path_is_relative_and_below_cwd=ae=>(Module._path_is_relative_and_below_cwd=wasmExports.path_is_relative_and_below_cwd)(ae),Module._make_expanded_record_from_typeid=(ae,e,I)=>(Module._make_expanded_record_from_typeid=wasmExports.make_expanded_record_from_typeid)(ae,e,I),Module._make_expanded_record_from_tupdesc=(ae,e)=>(Module._make_expanded_record_from_tupdesc=wasmExports.make_expanded_record_from_tupdesc)(ae,e),Module._make_expanded_record_from_exprecord=(ae,e)=>(Module._make_expanded_record_from_exprecord=wasmExports.make_expanded_record_from_exprecord)(ae,e),Module._expanded_record_set_tuple=(ae,e,I,oe)=>(Module._expanded_record_set_tuple=wasmExports.expanded_record_set_tuple)(ae,e,I,oe),Module._domain_check=(ae,e,I,oe,ue)=>(Module._domain_check=wasmExports.domain_check)(ae,e,I,oe,ue),Module._expanded_record_get_tuple=ae=>(Module._expanded_record_get_tuple=wasmExports.expanded_record_get_tuple)(ae),Module._deconstruct_expanded_record=ae=>(Module._deconstruct_expanded_record=wasmExports.deconstruct_expanded_record)(ae),Module._expanded_record_lookup_field=(ae,e,I)=>(Module._expanded_record_lookup_field=wasmExports.expanded_record_lookup_field)(ae,e,I),Module._expanded_record_set_field_internal=(ae,e,I,oe,ue,bt)=>(Module._expanded_record_set_field_internal=wasmExports.expanded_record_set_field_internal)(ae,e,I,oe,ue,bt),Module._expanded_record_set_fields=(ae,e,I,oe)=>(Module._expanded_record_set_fields=wasmExports.expanded_record_set_fields)(ae,e,I,oe),Module._float8in_internal=(ae,e,I,oe,ue)=>(Module._float8in_internal=wasmExports.float8in_internal)(ae,e,I,oe,ue),Module._str_tolower=(ae,e,I)=>(Module._str_tolower=wasmExports.str_tolower)(ae,e,I),Module._pg_get_indexdef_columns_extended=(ae,e)=>(Module._pg_get_indexdef_columns_extended=wasmExports.pg_get_indexdef_columns_extended)(ae,e),Module._RelationIsVisible=ae=>(Module._RelationIsVisible=wasmExports.RelationIsVisible)(ae),Module._float4in_internal=(ae,e,I,oe,ue)=>(Module._float4in_internal=wasmExports.float4in_internal)(ae,e,I,oe,ue),Module._strtof=(ae,e)=>(Module._strtof=wasmExports.strtof)(ae,e),Module._float_to_shortest_decimal_buf=(ae,e)=>(Module._float_to_shortest_decimal_buf=wasmExports.float_to_shortest_decimal_buf)(ae,e),Module._float8out_internal=ae=>(Module._float8out_internal=wasmExports.float8out_internal)(ae),Module._acos=ae=>(Module._acos=wasmExports.acos)(ae),Module._asin=ae=>(Module._asin=wasmExports.asin)(ae),Module._cos=ae=>(Module._cos=wasmExports.cos)(ae),Module._sin=ae=>(Module._sin=wasmExports.sin)(ae),Module._fmod=(ae,e)=>(Module._fmod=wasmExports.fmod)(ae,e),Module._localtime=ae=>(Module._localtime=wasmExports.localtime)(ae),Module._strftime=(ae,e,I,oe)=>(Module._strftime=wasmExports.strftime)(ae,e,I,oe),Module._in_error_recursion_trouble=()=>(Module._in_error_recursion_trouble=wasmExports.in_error_recursion_trouble)(),Module._getinternalerrposition=()=>(Module._getinternalerrposition=wasmExports.getinternalerrposition)(),Module._GetErrorContextStack=()=>(Module._GetErrorContextStack=wasmExports.GetErrorContextStack)(),Module._GetPublicationByName=(ae,e)=>(Module._GetPublicationByName=wasmExports.GetPublicationByName)(ae,e),Module._function_parse_error_transpose=ae=>(Module._function_parse_error_transpose=wasmExports.function_parse_error_transpose)(ae),Module._RelnameGetRelid=ae=>(Module._RelnameGetRelid=wasmExports.RelnameGetRelid)(ae),Module._fputs=(ae,e)=>(Module._fputs=wasmExports.fputs)(ae,e),Module._popen=(ae,e)=>(Module._popen=wasmExports.popen)(ae,e),Module._float_to_shortest_decimal_bufn=(ae,e)=>(Module._float_to_shortest_decimal_bufn=wasmExports.float_to_shortest_decimal_bufn)(ae,e),Module._pg_prng_uint64=ae=>(Module._pg_prng_uint64=wasmExports.pg_prng_uint64)(ae),Module._scram_ClientKey=(ae,e,I,oe,ue)=>(Module._scram_ClientKey=wasmExports.scram_ClientKey)(ae,e,I,oe,ue),Module._pg_encoding_dsplen=(ae,e)=>(Module._pg_encoding_dsplen=wasmExports.pg_encoding_dsplen)(ae,e),Module._getcwd=(ae,e)=>(Module._getcwd=wasmExports.getcwd)(ae,e),Module._pg_get_user_home_dir=(ae,e,I)=>(Module._pg_get_user_home_dir=wasmExports.pg_get_user_home_dir)(ae,e,I),Module._nanosleep=(ae,e)=>(Module._nanosleep=wasmExports.nanosleep)(ae,e),Module._snprintf=(ae,e,I,oe)=>(Module._snprintf=wasmExports.snprintf)(ae,e,I,oe),Module._pg_strerror_r=(ae,e,I)=>(Module._pg_strerror_r=wasmExports.pg_strerror_r)(ae,e,I),Module._pthread_mutex_lock=ae=>(Module._pthread_mutex_lock=wasmExports.pthread_mutex_lock)(ae),Module._pthread_mutex_unlock=ae=>(Module._pthread_mutex_unlock=wasmExports.pthread_mutex_unlock)(ae),Module._strncat=(ae,e,I)=>(Module._strncat=wasmExports.strncat)(ae,e,I),Module._PQexec=(ae,e)=>(Module._PQexec=wasmExports.PQexec)(ae,e),Module._PQsetSingleRowMode=ae=>(Module._PQsetSingleRowMode=wasmExports.PQsetSingleRowMode)(ae),Module._PQcmdStatus=ae=>(Module._PQcmdStatus=wasmExports.PQcmdStatus)(ae),Module._pthread_sigmask=(ae,e,I)=>(Module._pthread_sigmask=wasmExports.pthread_sigmask)(ae,e,I),Module._sigismember=(ae,e)=>(Module._sigismember=wasmExports.sigismember)(ae,e),Module._sigpending=ae=>(Module._sigpending=wasmExports.sigpending)(ae),Module._sigwait=(ae,e)=>(Module._sigwait=wasmExports.sigwait)(ae,e),Module._isolat1ToUTF8=(ae,e,I,oe)=>(Module._isolat1ToUTF8=wasmExports.isolat1ToUTF8)(ae,e,I,oe),Module._UTF8Toisolat1=(ae,e,I,oe)=>(Module._UTF8Toisolat1=wasmExports.UTF8Toisolat1)(ae,e,I,oe),Module._vfprintf=(ae,e,I)=>(Module._vfprintf=wasmExports.vfprintf)(ae,e,I),Module._vsnprintf=(ae,e,I,oe)=>(Module._vsnprintf=wasmExports.vsnprintf)(ae,e,I,oe),Module._xmlParserValidityWarning=(ae,e,I)=>(Module._xmlParserValidityWarning=wasmExports.xmlParserValidityWarning)(ae,e,I),Module._xmlParserValidityError=(ae,e,I)=>(Module._xmlParserValidityError=wasmExports.xmlParserValidityError)(ae,e,I),Module._xmlParserError=(ae,e,I)=>(Module._xmlParserError=wasmExports.xmlParserError)(ae,e,I),Module._xmlParserWarning=(ae,e,I)=>(Module._xmlParserWarning=wasmExports.xmlParserWarning)(ae,e,I),Module._fprintf=(ae,e,I)=>(Module._fprintf=wasmExports.fprintf)(ae,e,I),Module.___xmlParserInputBufferCreateFilename=(ae,e)=>(Module.___xmlParserInputBufferCreateFilename=wasmExports.__xmlParserInputBufferCreateFilename)(ae,e),Module.___xmlOutputBufferCreateFilename=(ae,e,I)=>(Module.___xmlOutputBufferCreateFilename=wasmExports.__xmlOutputBufferCreateFilename)(ae,e,I),Module._xmlSAX2InternalSubset=(ae,e,I,oe)=>(Module._xmlSAX2InternalSubset=wasmExports.xmlSAX2InternalSubset)(ae,e,I,oe),Module._xmlSAX2IsStandalone=ae=>(Module._xmlSAX2IsStandalone=wasmExports.xmlSAX2IsStandalone)(ae),Module._xmlSAX2HasInternalSubset=ae=>(Module._xmlSAX2HasInternalSubset=wasmExports.xmlSAX2HasInternalSubset)(ae),Module._xmlSAX2HasExternalSubset=ae=>(Module._xmlSAX2HasExternalSubset=wasmExports.xmlSAX2HasExternalSubset)(ae),Module._xmlSAX2ResolveEntity=(ae,e,I)=>(Module._xmlSAX2ResolveEntity=wasmExports.xmlSAX2ResolveEntity)(ae,e,I),Module._xmlSAX2GetEntity=(ae,e)=>(Module._xmlSAX2GetEntity=wasmExports.xmlSAX2GetEntity)(ae,e),Module._xmlSAX2EntityDecl=(ae,e,I,oe,ue,bt)=>(Module._xmlSAX2EntityDecl=wasmExports.xmlSAX2EntityDecl)(ae,e,I,oe,ue,bt),Module._xmlSAX2NotationDecl=(ae,e,I,oe)=>(Module._xmlSAX2NotationDecl=wasmExports.xmlSAX2NotationDecl)(ae,e,I,oe),Module._xmlSAX2AttributeDecl=(ae,e,I,oe,ue,bt,tr)=>(Module._xmlSAX2AttributeDecl=wasmExports.xmlSAX2AttributeDecl)(ae,e,I,oe,ue,bt,tr),Module._xmlSAX2ElementDecl=(ae,e,I,oe)=>(Module._xmlSAX2ElementDecl=wasmExports.xmlSAX2ElementDecl)(ae,e,I,oe),Module._xmlSAX2UnparsedEntityDecl=(ae,e,I,oe,ue)=>(Module._xmlSAX2UnparsedEntityDecl=wasmExports.xmlSAX2UnparsedEntityDecl)(ae,e,I,oe,ue),Module._xmlSAX2SetDocumentLocator=(ae,e)=>(Module._xmlSAX2SetDocumentLocator=wasmExports.xmlSAX2SetDocumentLocator)(ae,e),Module._xmlSAX2StartDocument=ae=>(Module._xmlSAX2StartDocument=wasmExports.xmlSAX2StartDocument)(ae),Module._xmlSAX2EndDocument=ae=>(Module._xmlSAX2EndDocument=wasmExports.xmlSAX2EndDocument)(ae),Module._xmlSAX2StartElement=(ae,e,I)=>(Module._xmlSAX2StartElement=wasmExports.xmlSAX2StartElement)(ae,e,I),Module._xmlSAX2EndElement=(ae,e)=>(Module._xmlSAX2EndElement=wasmExports.xmlSAX2EndElement)(ae,e),Module._xmlSAX2Reference=(ae,e)=>(Module._xmlSAX2Reference=wasmExports.xmlSAX2Reference)(ae,e),Module._xmlSAX2Characters=(ae,e,I)=>(Module._xmlSAX2Characters=wasmExports.xmlSAX2Characters)(ae,e,I),Module._xmlSAX2ProcessingInstruction=(ae,e,I)=>(Module._xmlSAX2ProcessingInstruction=wasmExports.xmlSAX2ProcessingInstruction)(ae,e,I),Module._xmlSAX2Comment=(ae,e)=>(Module._xmlSAX2Comment=wasmExports.xmlSAX2Comment)(ae,e),Module._xmlSAX2GetParameterEntity=(ae,e)=>(Module._xmlSAX2GetParameterEntity=wasmExports.xmlSAX2GetParameterEntity)(ae,e),Module._xmlSAX2CDataBlock=(ae,e,I)=>(Module._xmlSAX2CDataBlock=wasmExports.xmlSAX2CDataBlock)(ae,e,I),Module._xmlSAX2ExternalSubset=(ae,e,I,oe)=>(Module._xmlSAX2ExternalSubset=wasmExports.xmlSAX2ExternalSubset)(ae,e,I,oe),Module._xmlSAX2GetPublicId=ae=>(Module._xmlSAX2GetPublicId=wasmExports.xmlSAX2GetPublicId)(ae),Module._xmlSAX2GetSystemId=ae=>(Module._xmlSAX2GetSystemId=wasmExports.xmlSAX2GetSystemId)(ae),Module._xmlSAX2GetLineNumber=ae=>(Module._xmlSAX2GetLineNumber=wasmExports.xmlSAX2GetLineNumber)(ae),Module._xmlSAX2GetColumnNumber=ae=>(Module._xmlSAX2GetColumnNumber=wasmExports.xmlSAX2GetColumnNumber)(ae),Module._xmlSAX2IgnorableWhitespace=(ae,e,I)=>(Module._xmlSAX2IgnorableWhitespace=wasmExports.xmlSAX2IgnorableWhitespace)(ae,e,I),Module._xmlHashDefaultDeallocator=(ae,e)=>(Module._xmlHashDefaultDeallocator=wasmExports.xmlHashDefaultDeallocator)(ae,e),Module._iconv_open=(ae,e)=>(Module._iconv_open=wasmExports.iconv_open)(ae,e),Module._iconv_close=ae=>(Module._iconv_close=wasmExports.iconv_close)(ae),Module._iconv=(ae,e,I,oe,ue)=>(Module._iconv=wasmExports.iconv)(ae,e,I,oe,ue),Module._UTF8ToHtml=(ae,e,I,oe)=>(Module._UTF8ToHtml=wasmExports.UTF8ToHtml)(ae,e,I,oe),Module._xmlReadMemory=(ae,e,I,oe,ue)=>(Module._xmlReadMemory=wasmExports.xmlReadMemory)(ae,e,I,oe,ue),Module._xmlSAX2StartElementNs=(ae,e,I,oe,ue,bt,tr,rr,ir)=>(Module._xmlSAX2StartElementNs=wasmExports.xmlSAX2StartElementNs)(ae,e,I,oe,ue,bt,tr,rr,ir),Module._xmlSAX2EndElementNs=(ae,e,I,oe)=>(Module._xmlSAX2EndElementNs=wasmExports.xmlSAX2EndElementNs)(ae,e,I,oe),Module.___cxa_atexit=(ae,e,I)=>(Module.___cxa_atexit=wasmExports.__cxa_atexit)(ae,e,I),Module._xmlDocGetRootElement=ae=>(Module._xmlDocGetRootElement=wasmExports.xmlDocGetRootElement)(ae),Module._xmlFileMatch=ae=>(Module._xmlFileMatch=wasmExports.xmlFileMatch)(ae),Module._xmlFileOpen=ae=>(Module._xmlFileOpen=wasmExports.xmlFileOpen)(ae),Module._xmlFileRead=(ae,e,I)=>(Module._xmlFileRead=wasmExports.xmlFileRead)(ae,e,I),Module._xmlFileClose=ae=>(Module._xmlFileClose=wasmExports.xmlFileClose)(ae),Module._gzread=(ae,e,I)=>(Module._gzread=wasmExports.gzread)(ae,e,I),Module._gzclose=ae=>(Module._gzclose=wasmExports.gzclose)(ae),Module._gzdirect=ae=>(Module._gzdirect=wasmExports.gzdirect)(ae),Module._gzdopen=(ae,e)=>(Module._gzdopen=wasmExports.gzdopen)(ae,e),Module._gzopen=(ae,e)=>(Module._gzopen=wasmExports.gzopen)(ae,e),Module._gzwrite=(ae,e,I)=>(Module._gzwrite=wasmExports.gzwrite)(ae,e,I),Module._xmlUCSIsCatNd=ae=>(Module._xmlUCSIsCatNd=wasmExports.xmlUCSIsCatNd)(ae),Module._xmlUCSIsCatP=ae=>(Module._xmlUCSIsCatP=wasmExports.xmlUCSIsCatP)(ae),Module._xmlUCSIsCatZ=ae=>(Module._xmlUCSIsCatZ=wasmExports.xmlUCSIsCatZ)(ae),Module._xmlUCSIsCatC=ae=>(Module._xmlUCSIsCatC=wasmExports.xmlUCSIsCatC)(ae),Module._xmlUCSIsCatL=ae=>(Module._xmlUCSIsCatL=wasmExports.xmlUCSIsCatL)(ae),Module._xmlUCSIsCatLu=ae=>(Module._xmlUCSIsCatLu=wasmExports.xmlUCSIsCatLu)(ae),Module._xmlUCSIsCatLl=ae=>(Module._xmlUCSIsCatLl=wasmExports.xmlUCSIsCatLl)(ae),Module._xmlUCSIsCatLt=ae=>(Module._xmlUCSIsCatLt=wasmExports.xmlUCSIsCatLt)(ae),Module._xmlUCSIsCatLm=ae=>(Module._xmlUCSIsCatLm=wasmExports.xmlUCSIsCatLm)(ae),Module._xmlUCSIsCatLo=ae=>(Module._xmlUCSIsCatLo=wasmExports.xmlUCSIsCatLo)(ae),Module._xmlUCSIsCatM=ae=>(Module._xmlUCSIsCatM=wasmExports.xmlUCSIsCatM)(ae),Module._xmlUCSIsCatMn=ae=>(Module._xmlUCSIsCatMn=wasmExports.xmlUCSIsCatMn)(ae),Module._xmlUCSIsCatMc=ae=>(Module._xmlUCSIsCatMc=wasmExports.xmlUCSIsCatMc)(ae),Module._xmlUCSIsCatMe=ae=>(Module._xmlUCSIsCatMe=wasmExports.xmlUCSIsCatMe)(ae),Module._xmlUCSIsCatN=ae=>(Module._xmlUCSIsCatN=wasmExports.xmlUCSIsCatN)(ae),Module._xmlUCSIsCatNl=ae=>(Module._xmlUCSIsCatNl=wasmExports.xmlUCSIsCatNl)(ae),Module._xmlUCSIsCatNo=ae=>(Module._xmlUCSIsCatNo=wasmExports.xmlUCSIsCatNo)(ae),Module._xmlUCSIsCatPc=ae=>(Module._xmlUCSIsCatPc=wasmExports.xmlUCSIsCatPc)(ae),Module._xmlUCSIsCatPd=ae=>(Module._xmlUCSIsCatPd=wasmExports.xmlUCSIsCatPd)(ae),Module._xmlUCSIsCatPs=ae=>(Module._xmlUCSIsCatPs=wasmExports.xmlUCSIsCatPs)(ae),Module._xmlUCSIsCatPe=ae=>(Module._xmlUCSIsCatPe=wasmExports.xmlUCSIsCatPe)(ae),Module._xmlUCSIsCatPi=ae=>(Module._xmlUCSIsCatPi=wasmExports.xmlUCSIsCatPi)(ae),Module._xmlUCSIsCatPf=ae=>(Module._xmlUCSIsCatPf=wasmExports.xmlUCSIsCatPf)(ae),Module._xmlUCSIsCatPo=ae=>(Module._xmlUCSIsCatPo=wasmExports.xmlUCSIsCatPo)(ae),Module._xmlUCSIsCatZs=ae=>(Module._xmlUCSIsCatZs=wasmExports.xmlUCSIsCatZs)(ae),Module._xmlUCSIsCatZl=ae=>(Module._xmlUCSIsCatZl=wasmExports.xmlUCSIsCatZl)(ae),Module._xmlUCSIsCatZp=ae=>(Module._xmlUCSIsCatZp=wasmExports.xmlUCSIsCatZp)(ae),Module._xmlUCSIsCatS=ae=>(Module._xmlUCSIsCatS=wasmExports.xmlUCSIsCatS)(ae),Module._xmlUCSIsCatSm=ae=>(Module._xmlUCSIsCatSm=wasmExports.xmlUCSIsCatSm)(ae),Module._xmlUCSIsCatSc=ae=>(Module._xmlUCSIsCatSc=wasmExports.xmlUCSIsCatSc)(ae),Module._xmlUCSIsCatSk=ae=>(Module._xmlUCSIsCatSk=wasmExports.xmlUCSIsCatSk)(ae),Module._xmlUCSIsCatSo=ae=>(Module._xmlUCSIsCatSo=wasmExports.xmlUCSIsCatSo)(ae),Module._xmlUCSIsCatCc=ae=>(Module._xmlUCSIsCatCc=wasmExports.xmlUCSIsCatCc)(ae),Module._xmlUCSIsCatCf=ae=>(Module._xmlUCSIsCatCf=wasmExports.xmlUCSIsCatCf)(ae),Module._xmlUCSIsCatCo=ae=>(Module._xmlUCSIsCatCo=wasmExports.xmlUCSIsCatCo)(ae),Module._xmlUCSIsAegeanNumbers=ae=>(Module._xmlUCSIsAegeanNumbers=wasmExports.xmlUCSIsAegeanNumbers)(ae),Module._xmlUCSIsAlphabeticPresentationForms=ae=>(Module._xmlUCSIsAlphabeticPresentationForms=wasmExports.xmlUCSIsAlphabeticPresentationForms)(ae),Module._xmlUCSIsArabic=ae=>(Module._xmlUCSIsArabic=wasmExports.xmlUCSIsArabic)(ae),Module._xmlUCSIsArabicPresentationFormsA=ae=>(Module._xmlUCSIsArabicPresentationFormsA=wasmExports.xmlUCSIsArabicPresentationFormsA)(ae),Module._xmlUCSIsArabicPresentationFormsB=ae=>(Module._xmlUCSIsArabicPresentationFormsB=wasmExports.xmlUCSIsArabicPresentationFormsB)(ae),Module._xmlUCSIsArmenian=ae=>(Module._xmlUCSIsArmenian=wasmExports.xmlUCSIsArmenian)(ae),Module._xmlUCSIsArrows=ae=>(Module._xmlUCSIsArrows=wasmExports.xmlUCSIsArrows)(ae),Module._xmlUCSIsBasicLatin=ae=>(Module._xmlUCSIsBasicLatin=wasmExports.xmlUCSIsBasicLatin)(ae),Module._xmlUCSIsBengali=ae=>(Module._xmlUCSIsBengali=wasmExports.xmlUCSIsBengali)(ae),Module._xmlUCSIsBlockElements=ae=>(Module._xmlUCSIsBlockElements=wasmExports.xmlUCSIsBlockElements)(ae),Module._xmlUCSIsBopomofo=ae=>(Module._xmlUCSIsBopomofo=wasmExports.xmlUCSIsBopomofo)(ae),Module._xmlUCSIsBopomofoExtended=ae=>(Module._xmlUCSIsBopomofoExtended=wasmExports.xmlUCSIsBopomofoExtended)(ae),Module._xmlUCSIsBoxDrawing=ae=>(Module._xmlUCSIsBoxDrawing=wasmExports.xmlUCSIsBoxDrawing)(ae),Module._xmlUCSIsBraillePatterns=ae=>(Module._xmlUCSIsBraillePatterns=wasmExports.xmlUCSIsBraillePatterns)(ae),Module._xmlUCSIsBuhid=ae=>(Module._xmlUCSIsBuhid=wasmExports.xmlUCSIsBuhid)(ae),Module._xmlUCSIsByzantineMusicalSymbols=ae=>(Module._xmlUCSIsByzantineMusicalSymbols=wasmExports.xmlUCSIsByzantineMusicalSymbols)(ae),Module._xmlUCSIsCJKCompatibility=ae=>(Module._xmlUCSIsCJKCompatibility=wasmExports.xmlUCSIsCJKCompatibility)(ae),Module._xmlUCSIsCJKCompatibilityForms=ae=>(Module._xmlUCSIsCJKCompatibilityForms=wasmExports.xmlUCSIsCJKCompatibilityForms)(ae),Module._xmlUCSIsCJKCompatibilityIdeographs=ae=>(Module._xmlUCSIsCJKCompatibilityIdeographs=wasmExports.xmlUCSIsCJKCompatibilityIdeographs)(ae),Module._xmlUCSIsCJKCompatibilityIdeographsSupplement=ae=>(Module._xmlUCSIsCJKCompatibilityIdeographsSupplement=wasmExports.xmlUCSIsCJKCompatibilityIdeographsSupplement)(ae),Module._xmlUCSIsCJKRadicalsSupplement=ae=>(Module._xmlUCSIsCJKRadicalsSupplement=wasmExports.xmlUCSIsCJKRadicalsSupplement)(ae),Module._xmlUCSIsCJKSymbolsandPunctuation=ae=>(Module._xmlUCSIsCJKSymbolsandPunctuation=wasmExports.xmlUCSIsCJKSymbolsandPunctuation)(ae),Module._xmlUCSIsCJKUnifiedIdeographs=ae=>(Module._xmlUCSIsCJKUnifiedIdeographs=wasmExports.xmlUCSIsCJKUnifiedIdeographs)(ae),Module._xmlUCSIsCJKUnifiedIdeographsExtensionA=ae=>(Module._xmlUCSIsCJKUnifiedIdeographsExtensionA=wasmExports.xmlUCSIsCJKUnifiedIdeographsExtensionA)(ae),Module._xmlUCSIsCJKUnifiedIdeographsExtensionB=ae=>(Module._xmlUCSIsCJKUnifiedIdeographsExtensionB=wasmExports.xmlUCSIsCJKUnifiedIdeographsExtensionB)(ae),Module._xmlUCSIsCherokee=ae=>(Module._xmlUCSIsCherokee=wasmExports.xmlUCSIsCherokee)(ae),Module._xmlUCSIsCombiningDiacriticalMarks=ae=>(Module._xmlUCSIsCombiningDiacriticalMarks=wasmExports.xmlUCSIsCombiningDiacriticalMarks)(ae),Module._xmlUCSIsCombiningDiacriticalMarksforSymbols=ae=>(Module._xmlUCSIsCombiningDiacriticalMarksforSymbols=wasmExports.xmlUCSIsCombiningDiacriticalMarksforSymbols)(ae),Module._xmlUCSIsCombiningHalfMarks=ae=>(Module._xmlUCSIsCombiningHalfMarks=wasmExports.xmlUCSIsCombiningHalfMarks)(ae),Module._xmlUCSIsCombiningMarksforSymbols=ae=>(Module._xmlUCSIsCombiningMarksforSymbols=wasmExports.xmlUCSIsCombiningMarksforSymbols)(ae),Module._xmlUCSIsControlPictures=ae=>(Module._xmlUCSIsControlPictures=wasmExports.xmlUCSIsControlPictures)(ae),Module._xmlUCSIsCurrencySymbols=ae=>(Module._xmlUCSIsCurrencySymbols=wasmExports.xmlUCSIsCurrencySymbols)(ae),Module._xmlUCSIsCypriotSyllabary=ae=>(Module._xmlUCSIsCypriotSyllabary=wasmExports.xmlUCSIsCypriotSyllabary)(ae),Module._xmlUCSIsCyrillic=ae=>(Module._xmlUCSIsCyrillic=wasmExports.xmlUCSIsCyrillic)(ae),Module._xmlUCSIsCyrillicSupplement=ae=>(Module._xmlUCSIsCyrillicSupplement=wasmExports.xmlUCSIsCyrillicSupplement)(ae),Module._xmlUCSIsDeseret=ae=>(Module._xmlUCSIsDeseret=wasmExports.xmlUCSIsDeseret)(ae),Module._xmlUCSIsDevanagari=ae=>(Module._xmlUCSIsDevanagari=wasmExports.xmlUCSIsDevanagari)(ae),Module._xmlUCSIsDingbats=ae=>(Module._xmlUCSIsDingbats=wasmExports.xmlUCSIsDingbats)(ae),Module._xmlUCSIsEnclosedAlphanumerics=ae=>(Module._xmlUCSIsEnclosedAlphanumerics=wasmExports.xmlUCSIsEnclosedAlphanumerics)(ae),Module._xmlUCSIsEnclosedCJKLettersandMonths=ae=>(Module._xmlUCSIsEnclosedCJKLettersandMonths=wasmExports.xmlUCSIsEnclosedCJKLettersandMonths)(ae),Module._xmlUCSIsEthiopic=ae=>(Module._xmlUCSIsEthiopic=wasmExports.xmlUCSIsEthiopic)(ae),Module._xmlUCSIsGeneralPunctuation=ae=>(Module._xmlUCSIsGeneralPunctuation=wasmExports.xmlUCSIsGeneralPunctuation)(ae),Module._xmlUCSIsGeometricShapes=ae=>(Module._xmlUCSIsGeometricShapes=wasmExports.xmlUCSIsGeometricShapes)(ae),Module._xmlUCSIsGeorgian=ae=>(Module._xmlUCSIsGeorgian=wasmExports.xmlUCSIsGeorgian)(ae),Module._xmlUCSIsGothic=ae=>(Module._xmlUCSIsGothic=wasmExports.xmlUCSIsGothic)(ae),Module._xmlUCSIsGreek=ae=>(Module._xmlUCSIsGreek=wasmExports.xmlUCSIsGreek)(ae),Module._xmlUCSIsGreekExtended=ae=>(Module._xmlUCSIsGreekExtended=wasmExports.xmlUCSIsGreekExtended)(ae),Module._xmlUCSIsGreekandCoptic=ae=>(Module._xmlUCSIsGreekandCoptic=wasmExports.xmlUCSIsGreekandCoptic)(ae),Module._xmlUCSIsGujarati=ae=>(Module._xmlUCSIsGujarati=wasmExports.xmlUCSIsGujarati)(ae),Module._xmlUCSIsGurmukhi=ae=>(Module._xmlUCSIsGurmukhi=wasmExports.xmlUCSIsGurmukhi)(ae),Module._xmlUCSIsHalfwidthandFullwidthForms=ae=>(Module._xmlUCSIsHalfwidthandFullwidthForms=wasmExports.xmlUCSIsHalfwidthandFullwidthForms)(ae),Module._xmlUCSIsHangulCompatibilityJamo=ae=>(Module._xmlUCSIsHangulCompatibilityJamo=wasmExports.xmlUCSIsHangulCompatibilityJamo)(ae),Module._xmlUCSIsHangulJamo=ae=>(Module._xmlUCSIsHangulJamo=wasmExports.xmlUCSIsHangulJamo)(ae),Module._xmlUCSIsHangulSyllables=ae=>(Module._xmlUCSIsHangulSyllables=wasmExports.xmlUCSIsHangulSyllables)(ae),Module._xmlUCSIsHanunoo=ae=>(Module._xmlUCSIsHanunoo=wasmExports.xmlUCSIsHanunoo)(ae),Module._xmlUCSIsHebrew=ae=>(Module._xmlUCSIsHebrew=wasmExports.xmlUCSIsHebrew)(ae),Module._xmlUCSIsHighPrivateUseSurrogates=ae=>(Module._xmlUCSIsHighPrivateUseSurrogates=wasmExports.xmlUCSIsHighPrivateUseSurrogates)(ae),Module._xmlUCSIsHighSurrogates=ae=>(Module._xmlUCSIsHighSurrogates=wasmExports.xmlUCSIsHighSurrogates)(ae),Module._xmlUCSIsHiragana=ae=>(Module._xmlUCSIsHiragana=wasmExports.xmlUCSIsHiragana)(ae),Module._xmlUCSIsIPAExtensions=ae=>(Module._xmlUCSIsIPAExtensions=wasmExports.xmlUCSIsIPAExtensions)(ae),Module._xmlUCSIsIdeographicDescriptionCharacters=ae=>(Module._xmlUCSIsIdeographicDescriptionCharacters=wasmExports.xmlUCSIsIdeographicDescriptionCharacters)(ae),Module._xmlUCSIsKanbun=ae=>(Module._xmlUCSIsKanbun=wasmExports.xmlUCSIsKanbun)(ae),Module._xmlUCSIsKangxiRadicals=ae=>(Module._xmlUCSIsKangxiRadicals=wasmExports.xmlUCSIsKangxiRadicals)(ae),Module._xmlUCSIsKannada=ae=>(Module._xmlUCSIsKannada=wasmExports.xmlUCSIsKannada)(ae),Module._xmlUCSIsKatakana=ae=>(Module._xmlUCSIsKatakana=wasmExports.xmlUCSIsKatakana)(ae),Module._xmlUCSIsKatakanaPhoneticExtensions=ae=>(Module._xmlUCSIsKatakanaPhoneticExtensions=wasmExports.xmlUCSIsKatakanaPhoneticExtensions)(ae),Module._xmlUCSIsKhmer=ae=>(Module._xmlUCSIsKhmer=wasmExports.xmlUCSIsKhmer)(ae),Module._xmlUCSIsKhmerSymbols=ae=>(Module._xmlUCSIsKhmerSymbols=wasmExports.xmlUCSIsKhmerSymbols)(ae),Module._xmlUCSIsLao=ae=>(Module._xmlUCSIsLao=wasmExports.xmlUCSIsLao)(ae),Module._xmlUCSIsLatin1Supplement=ae=>(Module._xmlUCSIsLatin1Supplement=wasmExports.xmlUCSIsLatin1Supplement)(ae),Module._xmlUCSIsLatinExtendedA=ae=>(Module._xmlUCSIsLatinExtendedA=wasmExports.xmlUCSIsLatinExtendedA)(ae),Module._xmlUCSIsLatinExtendedB=ae=>(Module._xmlUCSIsLatinExtendedB=wasmExports.xmlUCSIsLatinExtendedB)(ae),Module._xmlUCSIsLatinExtendedAdditional=ae=>(Module._xmlUCSIsLatinExtendedAdditional=wasmExports.xmlUCSIsLatinExtendedAdditional)(ae),Module._xmlUCSIsLetterlikeSymbols=ae=>(Module._xmlUCSIsLetterlikeSymbols=wasmExports.xmlUCSIsLetterlikeSymbols)(ae),Module._xmlUCSIsLimbu=ae=>(Module._xmlUCSIsLimbu=wasmExports.xmlUCSIsLimbu)(ae),Module._xmlUCSIsLinearBIdeograms=ae=>(Module._xmlUCSIsLinearBIdeograms=wasmExports.xmlUCSIsLinearBIdeograms)(ae),Module._xmlUCSIsLinearBSyllabary=ae=>(Module._xmlUCSIsLinearBSyllabary=wasmExports.xmlUCSIsLinearBSyllabary)(ae),Module._xmlUCSIsLowSurrogates=ae=>(Module._xmlUCSIsLowSurrogates=wasmExports.xmlUCSIsLowSurrogates)(ae),Module._xmlUCSIsMalayalam=ae=>(Module._xmlUCSIsMalayalam=wasmExports.xmlUCSIsMalayalam)(ae),Module._xmlUCSIsMathematicalAlphanumericSymbols=ae=>(Module._xmlUCSIsMathematicalAlphanumericSymbols=wasmExports.xmlUCSIsMathematicalAlphanumericSymbols)(ae),Module._xmlUCSIsMathematicalOperators=ae=>(Module._xmlUCSIsMathematicalOperators=wasmExports.xmlUCSIsMathematicalOperators)(ae),Module._xmlUCSIsMiscellaneousMathematicalSymbolsA=ae=>(Module._xmlUCSIsMiscellaneousMathematicalSymbolsA=wasmExports.xmlUCSIsMiscellaneousMathematicalSymbolsA)(ae),Module._xmlUCSIsMiscellaneousMathematicalSymbolsB=ae=>(Module._xmlUCSIsMiscellaneousMathematicalSymbolsB=wasmExports.xmlUCSIsMiscellaneousMathematicalSymbolsB)(ae),Module._xmlUCSIsMiscellaneousSymbols=ae=>(Module._xmlUCSIsMiscellaneousSymbols=wasmExports.xmlUCSIsMiscellaneousSymbols)(ae),Module._xmlUCSIsMiscellaneousSymbolsandArrows=ae=>(Module._xmlUCSIsMiscellaneousSymbolsandArrows=wasmExports.xmlUCSIsMiscellaneousSymbolsandArrows)(ae),Module._xmlUCSIsMiscellaneousTechnical=ae=>(Module._xmlUCSIsMiscellaneousTechnical=wasmExports.xmlUCSIsMiscellaneousTechnical)(ae),Module._xmlUCSIsMongolian=ae=>(Module._xmlUCSIsMongolian=wasmExports.xmlUCSIsMongolian)(ae),Module._xmlUCSIsMusicalSymbols=ae=>(Module._xmlUCSIsMusicalSymbols=wasmExports.xmlUCSIsMusicalSymbols)(ae),Module._xmlUCSIsMyanmar=ae=>(Module._xmlUCSIsMyanmar=wasmExports.xmlUCSIsMyanmar)(ae),Module._xmlUCSIsNumberForms=ae=>(Module._xmlUCSIsNumberForms=wasmExports.xmlUCSIsNumberForms)(ae),Module._xmlUCSIsOgham=ae=>(Module._xmlUCSIsOgham=wasmExports.xmlUCSIsOgham)(ae),Module._xmlUCSIsOldItalic=ae=>(Module._xmlUCSIsOldItalic=wasmExports.xmlUCSIsOldItalic)(ae),Module._xmlUCSIsOpticalCharacterRecognition=ae=>(Module._xmlUCSIsOpticalCharacterRecognition=wasmExports.xmlUCSIsOpticalCharacterRecognition)(ae),Module._xmlUCSIsOriya=ae=>(Module._xmlUCSIsOriya=wasmExports.xmlUCSIsOriya)(ae),Module._xmlUCSIsOsmanya=ae=>(Module._xmlUCSIsOsmanya=wasmExports.xmlUCSIsOsmanya)(ae),Module._xmlUCSIsPhoneticExtensions=ae=>(Module._xmlUCSIsPhoneticExtensions=wasmExports.xmlUCSIsPhoneticExtensions)(ae),Module._xmlUCSIsPrivateUse=ae=>(Module._xmlUCSIsPrivateUse=wasmExports.xmlUCSIsPrivateUse)(ae),Module._xmlUCSIsPrivateUseArea=ae=>(Module._xmlUCSIsPrivateUseArea=wasmExports.xmlUCSIsPrivateUseArea)(ae),Module._xmlUCSIsRunic=ae=>(Module._xmlUCSIsRunic=wasmExports.xmlUCSIsRunic)(ae),Module._xmlUCSIsShavian=ae=>(Module._xmlUCSIsShavian=wasmExports.xmlUCSIsShavian)(ae),Module._xmlUCSIsSinhala=ae=>(Module._xmlUCSIsSinhala=wasmExports.xmlUCSIsSinhala)(ae),Module._xmlUCSIsSmallFormVariants=ae=>(Module._xmlUCSIsSmallFormVariants=wasmExports.xmlUCSIsSmallFormVariants)(ae),Module._xmlUCSIsSpacingModifierLetters=ae=>(Module._xmlUCSIsSpacingModifierLetters=wasmExports.xmlUCSIsSpacingModifierLetters)(ae),Module._xmlUCSIsSpecials=ae=>(Module._xmlUCSIsSpecials=wasmExports.xmlUCSIsSpecials)(ae),Module._xmlUCSIsSuperscriptsandSubscripts=ae=>(Module._xmlUCSIsSuperscriptsandSubscripts=wasmExports.xmlUCSIsSuperscriptsandSubscripts)(ae),Module._xmlUCSIsSupplementalArrowsA=ae=>(Module._xmlUCSIsSupplementalArrowsA=wasmExports.xmlUCSIsSupplementalArrowsA)(ae),Module._xmlUCSIsSupplementalArrowsB=ae=>(Module._xmlUCSIsSupplementalArrowsB=wasmExports.xmlUCSIsSupplementalArrowsB)(ae),Module._xmlUCSIsSupplementalMathematicalOperators=ae=>(Module._xmlUCSIsSupplementalMathematicalOperators=wasmExports.xmlUCSIsSupplementalMathematicalOperators)(ae),Module._xmlUCSIsSupplementaryPrivateUseAreaA=ae=>(Module._xmlUCSIsSupplementaryPrivateUseAreaA=wasmExports.xmlUCSIsSupplementaryPrivateUseAreaA)(ae),Module._xmlUCSIsSupplementaryPrivateUseAreaB=ae=>(Module._xmlUCSIsSupplementaryPrivateUseAreaB=wasmExports.xmlUCSIsSupplementaryPrivateUseAreaB)(ae),Module._xmlUCSIsSyriac=ae=>(Module._xmlUCSIsSyriac=wasmExports.xmlUCSIsSyriac)(ae),Module._xmlUCSIsTagalog=ae=>(Module._xmlUCSIsTagalog=wasmExports.xmlUCSIsTagalog)(ae),Module._xmlUCSIsTagbanwa=ae=>(Module._xmlUCSIsTagbanwa=wasmExports.xmlUCSIsTagbanwa)(ae),Module._xmlUCSIsTags=ae=>(Module._xmlUCSIsTags=wasmExports.xmlUCSIsTags)(ae),Module._xmlUCSIsTaiLe=ae=>(Module._xmlUCSIsTaiLe=wasmExports.xmlUCSIsTaiLe)(ae),Module._xmlUCSIsTaiXuanJingSymbols=ae=>(Module._xmlUCSIsTaiXuanJingSymbols=wasmExports.xmlUCSIsTaiXuanJingSymbols)(ae),Module._xmlUCSIsTamil=ae=>(Module._xmlUCSIsTamil=wasmExports.xmlUCSIsTamil)(ae),Module._xmlUCSIsTelugu=ae=>(Module._xmlUCSIsTelugu=wasmExports.xmlUCSIsTelugu)(ae),Module._xmlUCSIsThaana=ae=>(Module._xmlUCSIsThaana=wasmExports.xmlUCSIsThaana)(ae),Module._xmlUCSIsThai=ae=>(Module._xmlUCSIsThai=wasmExports.xmlUCSIsThai)(ae),Module._xmlUCSIsTibetan=ae=>(Module._xmlUCSIsTibetan=wasmExports.xmlUCSIsTibetan)(ae),Module._xmlUCSIsUgaritic=ae=>(Module._xmlUCSIsUgaritic=wasmExports.xmlUCSIsUgaritic)(ae),Module._xmlUCSIsUnifiedCanadianAboriginalSyllabics=ae=>(Module._xmlUCSIsUnifiedCanadianAboriginalSyllabics=wasmExports.xmlUCSIsUnifiedCanadianAboriginalSyllabics)(ae),Module._xmlUCSIsVariationSelectors=ae=>(Module._xmlUCSIsVariationSelectors=wasmExports.xmlUCSIsVariationSelectors)(ae),Module._xmlUCSIsVariationSelectorsSupplement=ae=>(Module._xmlUCSIsVariationSelectorsSupplement=wasmExports.xmlUCSIsVariationSelectorsSupplement)(ae),Module._xmlUCSIsYiRadicals=ae=>(Module._xmlUCSIsYiRadicals=wasmExports.xmlUCSIsYiRadicals)(ae),Module._xmlUCSIsYiSyllables=ae=>(Module._xmlUCSIsYiSyllables=wasmExports.xmlUCSIsYiSyllables)(ae),Module._xmlUCSIsYijingHexagramSymbols=ae=>(Module._xmlUCSIsYijingHexagramSymbols=wasmExports.xmlUCSIsYijingHexagramSymbols)(ae),Module._xmlUCSIsCatCs=ae=>(Module._xmlUCSIsCatCs=wasmExports.xmlUCSIsCatCs)(ae),Module.___small_fprintf=(ae,e,I)=>(Module.___small_fprintf=wasmExports.__small_fprintf)(ae,e,I),Module._xmlXPathBooleanFunction=(ae,e)=>(Module._xmlXPathBooleanFunction=wasmExports.xmlXPathBooleanFunction)(ae,e),Module._xmlXPathCeilingFunction=(ae,e)=>(Module._xmlXPathCeilingFunction=wasmExports.xmlXPathCeilingFunction)(ae,e),Module._xmlXPathCountFunction=(ae,e)=>(Module._xmlXPathCountFunction=wasmExports.xmlXPathCountFunction)(ae,e),Module._xmlXPathConcatFunction=(ae,e)=>(Module._xmlXPathConcatFunction=wasmExports.xmlXPathConcatFunction)(ae,e),Module._xmlXPathContainsFunction=(ae,e)=>(Module._xmlXPathContainsFunction=wasmExports.xmlXPathContainsFunction)(ae,e),Module._xmlXPathIdFunction=(ae,e)=>(Module._xmlXPathIdFunction=wasmExports.xmlXPathIdFunction)(ae,e),Module._xmlXPathFalseFunction=(ae,e)=>(Module._xmlXPathFalseFunction=wasmExports.xmlXPathFalseFunction)(ae,e),Module._xmlXPathFloorFunction=(ae,e)=>(Module._xmlXPathFloorFunction=wasmExports.xmlXPathFloorFunction)(ae,e),Module._xmlXPathLastFunction=(ae,e)=>(Module._xmlXPathLastFunction=wasmExports.xmlXPathLastFunction)(ae,e),Module._xmlXPathLangFunction=(ae,e)=>(Module._xmlXPathLangFunction=wasmExports.xmlXPathLangFunction)(ae,e),Module._xmlXPathLocalNameFunction=(ae,e)=>(Module._xmlXPathLocalNameFunction=wasmExports.xmlXPathLocalNameFunction)(ae,e),Module._xmlXPathNotFunction=(ae,e)=>(Module._xmlXPathNotFunction=wasmExports.xmlXPathNotFunction)(ae,e),Module._xmlXPathNamespaceURIFunction=(ae,e)=>(Module._xmlXPathNamespaceURIFunction=wasmExports.xmlXPathNamespaceURIFunction)(ae,e),Module._xmlXPathNormalizeFunction=(ae,e)=>(Module._xmlXPathNormalizeFunction=wasmExports.xmlXPathNormalizeFunction)(ae,e),Module._xmlXPathNumberFunction=(ae,e)=>(Module._xmlXPathNumberFunction=wasmExports.xmlXPathNumberFunction)(ae,e),Module._xmlXPathPositionFunction=(ae,e)=>(Module._xmlXPathPositionFunction=wasmExports.xmlXPathPositionFunction)(ae,e),Module._xmlXPathRoundFunction=(ae,e)=>(Module._xmlXPathRoundFunction=wasmExports.xmlXPathRoundFunction)(ae,e),Module._xmlXPathStringFunction=(ae,e)=>(Module._xmlXPathStringFunction=wasmExports.xmlXPathStringFunction)(ae,e),Module._xmlXPathStringLengthFunction=(ae,e)=>(Module._xmlXPathStringLengthFunction=wasmExports.xmlXPathStringLengthFunction)(ae,e),Module._xmlXPathStartsWithFunction=(ae,e)=>(Module._xmlXPathStartsWithFunction=wasmExports.xmlXPathStartsWithFunction)(ae,e),Module._xmlXPathSubstringFunction=(ae,e)=>(Module._xmlXPathSubstringFunction=wasmExports.xmlXPathSubstringFunction)(ae,e),Module._xmlXPathSubstringBeforeFunction=(ae,e)=>(Module._xmlXPathSubstringBeforeFunction=wasmExports.xmlXPathSubstringBeforeFunction)(ae,e),Module._xmlXPathSubstringAfterFunction=(ae,e)=>(Module._xmlXPathSubstringAfterFunction=wasmExports.xmlXPathSubstringAfterFunction)(ae,e),Module._xmlXPathSumFunction=(ae,e)=>(Module._xmlXPathSumFunction=wasmExports.xmlXPathSumFunction)(ae,e),Module._xmlXPathTrueFunction=(ae,e)=>(Module._xmlXPathTrueFunction=wasmExports.xmlXPathTrueFunction)(ae,e),Module._xmlXPathTranslateFunction=(ae,e)=>(Module._xmlXPathTranslateFunction=wasmExports.xmlXPathTranslateFunction)(ae,e),Module._xmlXPathNextSelf=(ae,e)=>(Module._xmlXPathNextSelf=wasmExports.xmlXPathNextSelf)(ae,e),Module._xmlXPathNextChild=(ae,e)=>(Module._xmlXPathNextChild=wasmExports.xmlXPathNextChild)(ae,e),Module._xmlXPathNextDescendant=(ae,e)=>(Module._xmlXPathNextDescendant=wasmExports.xmlXPathNextDescendant)(ae,e),Module._xmlXPathNextDescendantOrSelf=(ae,e)=>(Module._xmlXPathNextDescendantOrSelf=wasmExports.xmlXPathNextDescendantOrSelf)(ae,e),Module._xmlXPathNextParent=(ae,e)=>(Module._xmlXPathNextParent=wasmExports.xmlXPathNextParent)(ae,e),Module._xmlXPathNextAncestor=(ae,e)=>(Module._xmlXPathNextAncestor=wasmExports.xmlXPathNextAncestor)(ae,e),Module._xmlXPathNextAncestorOrSelf=(ae,e)=>(Module._xmlXPathNextAncestorOrSelf=wasmExports.xmlXPathNextAncestorOrSelf)(ae,e),Module._xmlXPathNextFollowingSibling=(ae,e)=>(Module._xmlXPathNextFollowingSibling=wasmExports.xmlXPathNextFollowingSibling)(ae,e),Module._xmlXPathNextPrecedingSibling=(ae,e)=>(Module._xmlXPathNextPrecedingSibling=wasmExports.xmlXPathNextPrecedingSibling)(ae,e),Module._xmlXPathNextFollowing=(ae,e)=>(Module._xmlXPathNextFollowing=wasmExports.xmlXPathNextFollowing)(ae,e),Module._xmlXPathNextNamespace=(ae,e)=>(Module._xmlXPathNextNamespace=wasmExports.xmlXPathNextNamespace)(ae,e),Module._xmlXPathNextAttribute=(ae,e)=>(Module._xmlXPathNextAttribute=wasmExports.xmlXPathNextAttribute)(ae,e),Module._zcalloc=(ae,e,I)=>(Module._zcalloc=wasmExports.zcalloc)(ae,e,I),Module._zcfree=(ae,e)=>(Module._zcfree=wasmExports.zcfree)(ae,e),Module._strerror=ae=>(Module._strerror=wasmExports.strerror)(ae);var ___dl_seterr=(ae,e)=>(___dl_seterr=wasmExports.__dl_seterr)(ae,e);Module._putc=(ae,e)=>(Module._putc=wasmExports.putc)(ae,e),Module._gmtime=ae=>(Module._gmtime=wasmExports.gmtime)(ae);var _htonl=ae=>(_htonl=wasmExports.htonl)(ae),_htons=ae=>(_htons=wasmExports.htons)(ae);Module._ioctl=(ae,e,I)=>(Module._ioctl=wasmExports.ioctl)(ae,e,I);var _emscripten_builtin_memalign=(ae,e)=>(_emscripten_builtin_memalign=wasmExports.emscripten_builtin_memalign)(ae,e),_ntohs=ae=>(_ntohs=wasmExports.ntohs)(ae);Module._srand=ae=>(Module._srand=wasmExports.srand)(ae),Module._rand=()=>(Module._rand=wasmExports.rand)();var __emscripten_timeout=(ae,e)=>(__emscripten_timeout=wasmExports._emscripten_timeout)(ae,e);Module.___floatsitf=(ae,e)=>(Module.___floatsitf=wasmExports.__floatsitf)(ae,e),Module.___multf3=(ae,e,I,oe,ue)=>(Module.___multf3=wasmExports.__multf3)(ae,e,I,oe,ue),Module.___extenddftf2=(ae,e)=>(Module.___extenddftf2=wasmExports.__extenddftf2)(ae,e),Module.___getf2=(ae,e,I,oe)=>(Module.___getf2=wasmExports.__getf2)(ae,e,I,oe),Module.___subtf3=(ae,e,I,oe,ue)=>(Module.___subtf3=wasmExports.__subtf3)(ae,e,I,oe,ue),Module.___letf2=(ae,e,I,oe)=>(Module.___letf2=wasmExports.__letf2)(ae,e,I,oe),Module.___lttf2=(ae,e,I,oe)=>(Module.___lttf2=wasmExports.__lttf2)(ae,e,I,oe);var _setThrew=(ae,e)=>(_setThrew=wasmExports.setThrew)(ae,e),__emscripten_tempret_set=ae=>(__emscripten_tempret_set=wasmExports._emscripten_tempret_set)(ae),__emscripten_tempret_get=()=>(__emscripten_tempret_get=wasmExports._emscripten_tempret_get)();Module.___fixtfsi=(ae,e)=>(Module.___fixtfsi=wasmExports.__fixtfsi)(ae,e);var __emscripten_stack_restore=ae=>(__emscripten_stack_restore=wasmExports._emscripten_stack_restore)(ae),__emscripten_stack_alloc=ae=>(__emscripten_stack_alloc=wasmExports._emscripten_stack_alloc)(ae),_emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports.emscripten_stack_get_current)();Module._ScanKeywords=69101764,Module._stderr=69124192,Module._stdout=69124496,Module._CurrentMemoryContext=69176164,Module._cpu_tuple_cost=68959584,Module._cpu_operator_cost=68959600,Module._work_mem=68988032,Module._seq_page_cost=68959568,Module._InterruptPending=69172816,Module._error_context_stack=69181512,Module._planner_hook=69125600,Module._IsUnderPostmaster=69172889,Module._ParallelWorkerNumber=68959812,Module._maintenance_work_mem=68988048,Module._max_parallel_maintenance_workers=68988052,Module._CacheMemoryContext=69176180,Module._DataDir=69172868,Module._MainLWLockArray=69127724,Module._ShmemVariableCache=69127536,Module._wal_segment_size=68959864,Module._CritSectionCount=69172864,Module._TopMemoryContext=69176168,Module._TopTransactionContext=69176188,Module._MyProc=69129380,Module._MyDatabaseId=69172872,Module._InterruptHoldoffCount=69172856,Module._XactIsoLevel=68968340,Module._MyProcPid=69172956,Module._MyLatch=69172988,Module._pgWalUsage=69145856,Module._wal_level=68959844,Module._NBuffers=68988056,Module._GUC_check_errdetail_string=69176808,Module._RmgrTable=68960080,Module._CurrentResourceOwner=69148968,Module.___THREW__=69281700,Module.___threwValue=69281704,Module._PG_exception_stack=69181516,Module._process_shared_preload_libraries_in_progress=69176140,Module._pg_global_prng_state=69267952,Module._TopTransactionResourceOwner=69148976,Module._LocalBufferBlockPointers=69131152,Module._BufferBlocks=69131196,Module._SnapshotAnyData=68986408,Module._debug_query_string=69147036,Module._old_snapshot_threshold=69148708,Module._TTSOpsHeapTuple=68982872,Module._pgBufferUsage=69145744,Module._TTSOpsVirtual=68982824,Module._shmem_startup_hook=69130992,Module._BufferDescriptors=69131192,Module._ClientAuthentication_hook=69136448,Module._MyProcPort=69172976,Module._cma_rsize=69146852,Module._SOCKET_DATA=69185960,Module._SOCKET_FILE=69185956,Module._stdin=69124344,Module._progname=69146804,Module._post_parse_analyze_hook=69145344,Module._ScanKeywordTokens=68333312,Module._TTSOpsMinimalTuple=68982920,Module._check_password_hook=69145452,Module._DateStyle=68988020,Module._WalReceiverFunctions=69148088,Module._SPI_processed=69145880,Module._SPI_tuptable=69145888,Module._ConfigReloadPending=69148220,Module._check_function_bodies=69036310,Module._ExecutorStart_hook=69145724,Module._ExecutorRun_hook=69145728,Module._ExecutorFinish_hook=69145732,Module._ExecutorEnd_hook=69145736,Module._SPI_result=69145892,Module._ProcessUtility_hook=69146756,Module._single_mode_feed=69146820,Module._cma_wsize=69146860,Module._quote_all_identifiers=69146809,Module._application_name=69178180,Module._ShutdownRequestPending=69148224,Module._cluster_name=69036364,Module._Log_directory=69148232,Module._Log_filename=69148236,Module._MyStartTime=69172960,Module._oldSnapshotControl=69148712,Module._pg_crc32_table=68445312,Module._IntervalStyle=69172896,Module._shmem_request_hook=69176144,Module._extra_float_digits=69093036,Module._xmlStructuredError=69268316,Module._xmlStructuredErrorContext=69268324,Module._xmlGenericErrorContext=69268320,Module._xmlGenericError=69106068,Module._xmlIsBaseCharGroup=69105832,Module._xmlIsDigitGroup=69105864,Module._xmlIsCombiningGroup=69105848,Module._xmlIsExtenderGroup=69105880,Module._xmlFree=69106032,Module._pg_number_of_ones=68765008,Module._IDB_STAGE=69185968,Module._IDB_PIPE_FP=69185964,Module._pg_scram_mech=69105776,Module._pg_g_threadlock=69103880,Module._pgresStatus=69105568,Module._xmlIsPubidChar_tab=68765296,Module._xmlGetWarningsDefaultValue=69106060,Module._xmlMalloc=69106036,Module._xmlRealloc=69106044,Module._xmlLastError=69268336,Module._xmlMallocAtomic=69106040,Module._xmlMemStrdup=69106048,Module._xmlBufferAllocScheme=69106052,Module._xmlDefaultBufferSize=69106056,Module._xmlParserDebugEntities=69268276,Module._xmlDoValidityCheckingDefaultValue=69268280,Module._xmlLoadExtDtdDefaultValue=69268284,Module._xmlPedanticParserDefaultValue=69268288,Module._xmlLineNumbersDefaultValue=69268292,Module._xmlKeepBlanksDefaultValue=69106064,Module._xmlSubstituteEntitiesDefaultValue=69268296,Module._xmlRegisterNodeDefaultValue=69268300,Module._xmlDeregisterNodeDefaultValue=69268304,Module._xmlParserInputBufferCreateFilenameValue=69268308,Module._xmlOutputBufferCreateFilenameValue=69268312,Module._xmlIndentTreeOutput=69106072,Module._xmlTreeIndentString=69106076,Module._xmlSaveNoEmptyTags=69268328,Module._xmlDefaultSAXHandler=69106080,Module._xmlDefaultSAXLocator=69106192,Module._xmlParserMaxDepth=69106852,Module._xmlStringText=68767104,Module._xmlStringComment=68767119,Module._xmlStringTextNoenc=68767109,Module._xmlXPathNAN=69269e3,Module._xmlXPathNINF=69269016,Module._xmlXPathPINF=69269008,Module._z_errmsg=69123408,Module.__length_code=68786768,Module.__dist_code=68786256;function invoke_iii(ae,e,I){var oe=stackSave();try{return getWasmTableEntry(ae)(e,I)}catch(ue){if(stackRestore(oe),ue!==ue+0)throw ue;_setThrew(1,0)}}function invoke_ii(ae,e){var I=stackSave();try{return getWasmTableEntry(ae)(e)}catch(oe){if(stackRestore(I),oe!==oe+0)throw oe;_setThrew(1,0)}}function invoke_viii(ae,e,I,oe){var ue=stackSave();try{getWasmTableEntry(ae)(e,I,oe)}catch(bt){if(stackRestore(ue),bt!==bt+0)throw bt;_setThrew(1,0)}}function invoke_v(ae){var e=stackSave();try{getWasmTableEntry(ae)()}catch(I){if(stackRestore(e),I!==I+0)throw I;_setThrew(1,0)}}function invoke_vii(ae,e,I){var oe=stackSave();try{getWasmTableEntry(ae)(e,I)}catch(ue){if(stackRestore(oe),ue!==ue+0)throw ue;_setThrew(1,0)}}function invoke_jii(ae,e,I){var oe=stackSave();try{return getWasmTableEntry(ae)(e,I)}catch(ue){if(stackRestore(oe),ue!==ue+0)throw ue;return _setThrew(1,0),0n}}function invoke_vi(ae,e){var I=stackSave();try{getWasmTableEntry(ae)(e)}catch(oe){if(stackRestore(I),oe!==oe+0)throw oe;_setThrew(1,0)}}function invoke_iiiii(ae,e,I,oe,ue){var bt=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue)}catch(tr){if(stackRestore(bt),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_iiii(ae,e,I,oe){var ue=stackSave();try{return getWasmTableEntry(ae)(e,I,oe)}catch(bt){if(stackRestore(ue),bt!==bt+0)throw bt;_setThrew(1,0)}}function invoke_ji(ae,e){var I=stackSave();try{return getWasmTableEntry(ae)(e)}catch(oe){if(stackRestore(I),oe!==oe+0)throw oe;return _setThrew(1,0),0n}}function invoke_viiiii(ae,e,I,oe,ue,bt){var tr=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_i(ae){var e=stackSave();try{return getWasmTableEntry(ae)()}catch(I){if(stackRestore(e),I!==I+0)throw I;_setThrew(1,0)}}function invoke_jiiiiiiii(ae,e,I,oe,ue,bt,tr,rr,ir){var lr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;return _setThrew(1,0),0n}}function invoke_jiiiii(ae,e,I,oe,ue,bt){var tr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;return _setThrew(1,0),0n}}function invoke_viiii(ae,e,I,oe,ue){var bt=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue)}catch(tr){if(stackRestore(bt),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_iiiiiiiii(ae,e,I,oe,ue,bt,tr,rr,ir){var lr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;_setThrew(1,0)}}function invoke_vji(ae,e,I){var oe=stackSave();try{getWasmTableEntry(ae)(e,I)}catch(ue){if(stackRestore(oe),ue!==ue+0)throw ue;_setThrew(1,0)}}function invoke_iiiijii(ae,e,I,oe,ue,bt,tr){var rr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_vijiji(ae,e,I,oe,ue,bt){var tr=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_viji(ae,e,I,oe){var ue=stackSave();try{getWasmTableEntry(ae)(e,I,oe)}catch(bt){if(stackRestore(ue),bt!==bt+0)throw bt;_setThrew(1,0)}}function invoke_iiiiii(ae,e,I,oe,ue,bt){var tr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_viiiiii(ae,e,I,oe,ue,bt,tr){var rr=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_viiji(ae,e,I,oe,ue){var bt=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue)}catch(tr){if(stackRestore(bt),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_iiji(ae,e,I,oe){var ue=stackSave();try{return getWasmTableEntry(ae)(e,I,oe)}catch(bt){if(stackRestore(ue),bt!==bt+0)throw bt;_setThrew(1,0)}}function invoke_vid(ae,e,I){var oe=stackSave();try{getWasmTableEntry(ae)(e,I)}catch(ue){if(stackRestore(oe),ue!==ue+0)throw ue;_setThrew(1,0)}}function invoke_iiiij(ae,e,I,oe,ue){var bt=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue)}catch(tr){if(stackRestore(bt),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_iiiiiii(ae,e,I,oe,ue,bt,tr){var rr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_ij(ae,e){var I=stackSave();try{return getWasmTableEntry(ae)(e)}catch(oe){if(stackRestore(I),oe!==oe+0)throw oe;_setThrew(1,0)}}function invoke_viiiiiii(ae,e,I,oe,ue,bt,tr,rr){var ir=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_viiij(ae,e,I,oe,ue){var bt=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue)}catch(tr){if(stackRestore(bt),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_viiiiiiiii(ae,e,I,oe,ue,bt,tr,rr,ir,lr){var dr=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr,ir,lr)}catch(pr){if(stackRestore(dr),pr!==pr+0)throw pr;_setThrew(1,0)}}function invoke_vij(ae,e,I){var oe=stackSave();try{getWasmTableEntry(ae)(e,I)}catch(ue){if(stackRestore(oe),ue!==ue+0)throw ue;_setThrew(1,0)}}function invoke_iiiiiiiiiiiiiiiii(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr,hr,_r,yr,wr,Tr){var Ar=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr,hr,_r,yr,wr,Tr)}catch(Sr){if(stackRestore(Ar),Sr!==Sr+0)throw Sr;_setThrew(1,0)}}function invoke_vj(ae,e){var I=stackSave();try{getWasmTableEntry(ae)(e)}catch(oe){if(stackRestore(I),oe!==oe+0)throw oe;_setThrew(1,0)}}function invoke_iiiiiiiiii(ae,e,I,oe,ue,bt,tr,rr,ir,lr){var dr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr,ir,lr)}catch(pr){if(stackRestore(dr),pr!==pr+0)throw pr;_setThrew(1,0)}}function invoke_viiiiiiii(ae,e,I,oe,ue,bt,tr,rr,ir){var lr=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;_setThrew(1,0)}}function invoke_iiij(ae,e,I,oe){var ue=stackSave();try{return getWasmTableEntry(ae)(e,I,oe)}catch(bt){if(stackRestore(ue),bt!==bt+0)throw bt;_setThrew(1,0)}}function invoke_jiiii(ae,e,I,oe,ue){var bt=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue)}catch(tr){if(stackRestore(bt),tr!==tr+0)throw tr;return _setThrew(1,0),0n}}function invoke_viiiiiiiiiiii(ae,e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr,hr){var _r=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr,ir,lr,dr,pr,hr)}catch(yr){if(stackRestore(_r),yr!==yr+0)throw yr;_setThrew(1,0)}}function invoke_ijiiiiii(ae,e,I,oe,ue,bt,tr,rr){var ir=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_viijii(ae,e,I,oe,ue,bt){var tr=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_iiiiiji(ae,e,I,oe,ue,bt,tr){var rr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_viijiiii(ae,e,I,oe,ue,bt,tr,rr){var ir=stackSave();try{getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_viij(ae,e,I,oe){var ue=stackSave();try{getWasmTableEntry(ae)(e,I,oe)}catch(bt){if(stackRestore(ue),bt!==bt+0)throw bt;_setThrew(1,0)}}function invoke_iiiiiiii(ae,e,I,oe,ue,bt,tr,rr){var ir=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_di(ae,e){var I=stackSave();try{return getWasmTableEntry(ae)(e)}catch(oe){if(stackRestore(I),oe!==oe+0)throw oe;_setThrew(1,0)}}function invoke_id(ae,e){var I=stackSave();try{return getWasmTableEntry(ae)(e)}catch(oe){if(stackRestore(I),oe!==oe+0)throw oe;_setThrew(1,0)}}function invoke_ijiiiii(ae,e,I,oe,ue,bt,tr){var rr=stackSave();try{return getWasmTableEntry(ae)(e,I,oe,ue,bt,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}Module.addRunDependency=addRunDependency,Module.removeRunDependency=removeRunDependency,Module.callMain=callMain,Module.ccall=ccall,Module.cwrap=cwrap,Module.setValue=setValue,Module.getValue=getValue,Module.UTF8ToString=UTF8ToString,Module.stringToNewUTF8=stringToNewUTF8,Module.stringToUTF8OnStack=stringToUTF8OnStack,Module.FS_createPreloadedFile=FS_createPreloadedFile,Module.FS_unlink=FS_unlink,Module.FS_createPath=FS_createPath,Module.FS_createDevice=FS_createDevice,Module.FS=FS,Module.FS_createDataFile=FS_createDataFile,Module.FS_createLazyFile=FS_createLazyFile;var calledRun;dependenciesFulfilled=function ae(){calledRun||run(),calledRun||(dependenciesFulfilled=ae)};function callMain(ae=[]){var e=resolveGlobalSymbol("main").sym;if(e){ae.unshift(thisProgram);var I=ae.length,oe=stackAlloc((I+1)*4),ue=oe;ae.forEach(tr=>{HEAPU32[ue>>2]=stringToUTF8OnStack(tr),ue+=4}),HEAPU32[ue>>2]=0;try{var bt=e(I,oe);return exitJS(bt,!0),bt}catch(tr){return handleException(tr)}}}function run(ae=arguments_){if(runDependencies>0||(preRun(),runDependencies>0))return;function e(){calledRun||(calledRun=!0,Module.calledRun=!0,!ABORT&&(initRuntime(),preMain(),readyPromiseResolve(Module),Module.onRuntimeInitialized?.(),shouldRunNow&&callMain(ae),postRun()))}Module.setStatus?(Module.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>Module.setStatus(""),1),e()},1)):e()}if(Module.preInit)for(typeof Module.preInit=="function"&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;return Module.noInitialRun&&(shouldRunNow=!1),run(),moduleRtn=readyPromise,moduleRtn}})();x$1();x$1();x$1();var Oe=new Error("request for lock canceled"),De=function(ae,e,I,oe){function ue(bt){return bt instanceof I?bt:new I(function(tr){tr(bt)})}return new(I||(I=Promise))(function(bt,tr){function rr(dr){try{lr(oe.next(dr))}catch(pr){tr(pr)}}function ir(dr){try{lr(oe.throw(dr))}catch(pr){tr(pr)}}function lr(dr){dr.done?bt(dr.value):ue(dr.value).then(rr,ir)}lr((oe=oe.apply(ae,[])).next())})},Z=class{constructor(ae,e=Oe){this._value=ae,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(ae=1){if(ae<=0)throw new Error(`invalid weight ${ae}: must be positive`);return new Promise((e,I)=>{this._weightedQueues[ae-1]||(this._weightedQueues[ae-1]=[]),this._weightedQueues[ae-1].push({resolve:e,reject:I}),this._dispatch()})}runExclusive(ae,e=1){return De(this,void 0,void 0,function*(){let[I,oe]=yield this.acquire(e);try{return yield ae(I)}finally{oe()}})}waitForUnlock(ae=1){if(ae<=0)throw new Error(`invalid weight ${ae}: must be positive`);return new Promise(e=>{this._weightedWaiters[ae-1]||(this._weightedWaiters[ae-1]=[]),this._weightedWaiters[ae-1].push(e),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(ae){this._value=ae,this._dispatch()}release(ae=1){if(ae<=0)throw new Error(`invalid weight ${ae}: must be positive`);this._value+=ae,this._dispatch()}cancel(){this._weightedQueues.forEach(ae=>ae.forEach(e=>e.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var ae;for(let e=this._value;e>0;e--){let I=(ae=this._weightedQueues[e-1])===null||ae===void 0?void 0:ae.shift();if(!I)continue;let oe=this._value,ue=e;this._value-=e,e=this._value+1,I.resolve([oe,this._newReleaser(ue)])}this._drainUnlockWaiters()}_newReleaser(ae){let e=!1;return()=>{e||(e=!0,this.release(ae))}}_drainUnlockWaiters(){for(let ae=this._value;ae>0;ae--)this._weightedWaiters[ae-1]&&(this._weightedWaiters[ae-1].forEach(e=>e()),this._weightedWaiters[ae-1]=[])}},Ae=function(ae,e,I,oe){function ue(bt){return bt instanceof I?bt:new I(function(tr){tr(bt)})}return new(I||(I=Promise))(function(bt,tr){function rr(dr){try{lr(oe.next(dr))}catch(pr){tr(pr)}}function ir(dr){try{lr(oe.throw(dr))}catch(pr){tr(pr)}}function lr(dr){dr.done?bt(dr.value):ue(dr.value).then(rr,ir)}lr((oe=oe.apply(ae,[])).next())})},R=class{constructor(ae){this._semaphore=new Z(1,ae)}acquire(){return Ae(this,void 0,void 0,function*(){let[,ae]=yield this._semaphore.acquire();return ae})}runExclusive(ae){return this._semaphore.runExclusive(()=>ae())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};x$1();var ye=F(or());async function ee(ae){if(Ge){let e=await import("./__vite-browser-external-9wXp6ZBx.js"),I=await import("./__vite-browser-external-9wXp6ZBx.js"),{Writable:oe}=await import("./__vite-browser-external-9wXp6ZBx.js"),{pipeline:ue}=await import("./__vite-browser-external-9wXp6ZBx.js");if(!e.existsSync(ae))throw new Error(`Extension bundle not found: ${ae}`);let bt=I.createGunzip(),tr=[];return await ue(e.createReadStream(ae),bt,new oe({write(rr,ir,lr){tr.push(rr),lr()}})),new Blob(tr)}else{let e=await fetch(ae.toString());if(!e.ok||!e.body)return null;if(e.headers.get("Content-Encoding")==="gzip")return e.blob();{let I=new DecompressionStream("gzip");return new Response(e.body.pipeThrough(I)).blob()}}}async function he(ae,e){for(let I in ae.pg_extensions){let oe;try{oe=await ae.pg_extensions[I]}catch(ue){console.error("Failed to fetch extension:",I,ue);continue}if(oe){let ue=new Uint8Array(await oe.arrayBuffer());Ie(ae,I,ue,e)}else console.error("Could not get binary data for extension:",I)}}function Ie(ae,e,I,oe){ye.default.untar(I).forEach(ue=>{if(!ue.name.startsWith(".")){let bt=ae.WASM_PREFIX+"/"+ue.name;if(ue.name.endsWith(".so")){let tr=(...ir)=>{oe("pgfs:ext OK",bt,ir)},rr=(...ir)=>{oe("pgfs:ext FAIL",bt,ir)};ae.FS.createPreloadedFile(Be(bt),ue.name.split("/").pop().slice(0,-3),ue.data,!0,!0,tr,rr,!1)}else ae.FS.writeFile(bt,ue.data)}})}function Be(ae){let e=ae.lastIndexOf("/");return e>0?ae.slice(0,e):ae}x$1();x$1();var q=class extends sr{async init(ae,e){return this.pg=ae,{emscriptenOpts:{...e,preRun:[...e.preRun||[],I=>{let oe=I.FS.filesystems.IDBFS;I.FS.mkdir("/pglite"),I.FS.mkdir(`/pglite/${this.dataDir}`),I.FS.mount(oe,{},`/pglite/${this.dataDir}`),I.FS.symlink(`/pglite/${this.dataDir}`,C$1)}]}}}initialSyncFs(){return new Promise((ae,e)=>{this.pg.Module.FS.syncfs(!0,I=>{I?e(I):ae()})})}syncToFs(ae){return new Promise((e,I)=>{this.pg.Module.FS.syncfs(!1,oe=>{oe?I(oe):e()})})}async closeFs(){let ae=this.pg.Module.FS.filesystems.IDBFS.dbs[this.dataDir];ae&&ae.close(),this.pg.Module.FS.quit()}};x$1();var L=class extends sr{async closeFs(){this.pg.Module.FS.quit()}};function xe(ae){let e;if(ae?.startsWith("file://")){if(ae=ae.slice(7),!ae)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else ae?.startsWith("idb://")?(ae=ae.slice(6),e="idbfs"):ae?.startsWith("opfs-ahp://")?(ae=ae.slice(11),e="opfs-ahp"):!ae||ae?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:ae,fsType:e}}async function ge(ae,e){let I;if(ae&&e==="nodefs"){let{NodeFS:oe}=await import("./nodefs-BpD-TKwT.js");I=new oe(ae)}else if(ae&&e==="idbfs")I=new q(ae);else if(ae&&e==="opfs-ahp"){let{OpfsAhpFS:oe}=await import("./opfs-ahp-Df8XCTO7.js");I=new oe(ae)}else I=new L;return I}x$1();var we=Module,B,M,O,N,k,K,X,Y,G,z,$,C,D,T,g,A,E,Ee,W,te=class Gs extends v{constructor(e={},I={}){super(),L$3(this,E),L$3(this,B,!1),L$3(this,M,!1),L$3(this,O,!1),L$3(this,N,!1),L$3(this,k,!1),L$3(this,K,new R),L$3(this,X,new R),L$3(this,Y,new R),L$3(this,G,!1),this.debug=0,L$3(this,z),L$3(this,$,[]),L$3(this,C,new he$1),L$3(this,D),L$3(this,T),L$3(this,g,new Map),L$3(this,A,new Set),typeof e=="string"?I={dataDir:e,...I}:I=e,this.dataDir=I.dataDir,I.parsers!==void 0&&(this.parsers={...this.parsers,...I.parsers}),I.serializers!==void 0&&(this.serializers={...this.serializers,...I.serializers}),I?.debug!==void 0&&(this.debug=I.debug),I?.relaxedDurability!==void 0&&h$2(this,k,I.relaxedDurability),h$2(this,z,I.extensions??{}),this.waitReady=P$1(this,E,Ee).call(this,I??{})}static async create(e,I){let oe=typeof e=="string"?{dataDir:e,...I??{}}:e??{},ue=new Gs(oe);return await ue.waitReady,ue}get Module(){return this.mod}get ready(){return g$3(this,B)&&!g$3(this,M)&&!g$3(this,O)}get closed(){return g$3(this,O)}async close(){await this._checkReady(),h$2(this,M,!0);for(let e of g$3(this,$))await e();try{await this.execProtocol(k$1.end()),this.mod._pg_shutdown()}catch(e){let I=e;if(!(I.name==="ExitStatus"&&I.status===0))throw e}await this.fs.closeFs(),h$2(this,O,!0),h$2(this,M,!1)}async[Symbol.asyncDispose](){await this.close()}async _handleBlob(e){h$2(this,D,e?await e.arrayBuffer():void 0)}async _cleanupBlob(){h$2(this,D,void 0)}async _getWrittenBlob(){if(!g$3(this,T))return;let e=new Blob(g$3(this,T));return h$2(this,T,void 0),e}async _checkReady(){if(g$3(this,M))throw new Error("PGlite is closing");if(g$3(this,O))throw new Error("PGlite is closed");g$3(this,B)||await this.waitReady}async execProtocolRaw(e,{syncToFs:I=!0}={}){let oe=e.length,ue=this.mod;ue._interactive_write(oe),ue.HEAPU8.set(e,1),ue._interactive_one();let bt=oe+2,tr=bt+ue._interactive_read(),rr=ue.HEAPU8.subarray(bt,tr);return I&&await this.syncToFs(),rr}async execProtocol(e,{syncToFs:I=!0,throwOnError:oe=!0,onNotice:ue}={}){let bt=await this.execProtocolRaw(e,{syncToFs:I}),tr=[];return g$3(this,C).parse(bt,rr=>{if(rr instanceof C$2){if(h$2(this,C,new he$1),oe)throw rr}else if(rr instanceof re)this.debug>0&&console.warn(rr),ue&&ue(rr);else if(rr instanceof te$1)switch(rr.text){case"BEGIN":h$2(this,N,!0);break;case"COMMIT":case"ROLLBACK":h$2(this,N,!1);break}else if(rr instanceof Z$1){let ir=g$3(this,g).get(rr.channel);ir&&ir.forEach(lr=>{queueMicrotask(()=>lr(rr.payload))}),g$3(this,A).forEach(lr=>{queueMicrotask(()=>lr(rr.channel,rr.payload))})}tr.push(rr)}),{messages:tr,data:bt}}isInTransaction(){return g$3(this,N)}async syncToFs(){if(g$3(this,G))return;h$2(this,G,!0);let e=async()=>{await g$3(this,Y).runExclusive(async()=>{h$2(this,G,!1),await this.fs.syncToFs(g$3(this,k))})};g$3(this,k)?e():await e()}async listen(e,I){return g$3(this,g).has(e)||g$3(this,g).set(e,new Set),g$3(this,g).get(e).add(I),await this.exec(`LISTEN "${e}"`),async()=>{await this.unlisten(e,I)}}async unlisten(e,I){I?(g$3(this,g).get(e)?.delete(I),g$3(this,g).get(e)?.size===0&&(await this.exec(`UNLISTEN "${e}"`),g$3(this,g).delete(e))):(await this.exec(`UNLISTEN "${e}"`),g$3(this,g).delete(e))}onNotification(e){return g$3(this,A).add(e),()=>{g$3(this,A).delete(e)}}offNotification(e){g$3(this,A).delete(e)}async dumpDataDir(e){let I=this.dataDir?.split("/").pop()??"pgdata";return this.fs.dumpTar(I,e)}_runExclusiveQuery(e){return g$3(this,K).runExclusive(e)}_runExclusiveTransaction(e){return g$3(this,X).runExclusive(e)}};B=new WeakMap,M=new WeakMap,O=new WeakMap,N=new WeakMap,k=new WeakMap,K=new WeakMap,X=new WeakMap,Y=new WeakMap,G=new WeakMap,z=new WeakMap,$=new WeakMap,C=new WeakMap,D=new WeakMap,T=new WeakMap,g=new WeakMap,A=new WeakMap,E=new WeakSet,Ee=async function(ae){if(ae.fs)this.fs=ae.fs;else{let{dataDir:lr,fsType:dr}=xe(ae.dataDir);this.fs=await ge(lr,dr)}let e={},I=[],oe=[`PGDATA=${C$1}`,`PREFIX=${Vr}`,`PGUSER=${ae.username??"postgres"}`,`PGDATABASE=${ae.database??"template1"}`,"MODE=REACT","REPL=N",...this.debug?["-d",this.debug.toString()]:[]];ae.wasmModule||Er();let ue=ae.fsBundle?ae.fsBundle.arrayBuffer():Pr(),bt;ue.then(lr=>{bt=lr});let tr={WASM_PREFIX:Vr,arguments:oe,INITIAL_MEMORY:ae.initialMemory,noExitRuntime:!0,...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},instantiateWasm:(lr,dr)=>(Cr(lr,ae.wasmModule).then(({instance:pr,module:hr})=>{dr(pr,hr)}),{}),getPreloadedPackage:(lr,dr)=>{if(lr==="postgres.data"){if(bt.byteLength!==dr)throw new Error(`Invalid FS bundle size: ${bt.byteLength} !== ${dr}`);return bt}throw new Error(`Unknown package: ${lr}`)},preRun:[lr=>{let dr=lr.FS.makedev(64,0),pr={open:hr=>{},close:hr=>{},read:(hr,_r,yr,wr,Tr)=>{let Ar=g$3(this,D);if(!Ar)throw new Error("No /dev/blob File or Blob provided to read from");let Sr=new Uint8Array(Ar);if(Tr>=Sr.length)return 0;let Mr=Math.min(Sr.length-Tr,wr);for(let vr=0;vr<Mr;vr++)_r[yr+vr]=Sr[Tr+vr];return Mr},write:(hr,_r,yr,wr,Tr)=>(g$3(this,T)??h$2(this,T,[]),g$3(this,T).push(_r.slice(yr,yr+wr)),wr),llseek:(hr,_r,yr)=>{let wr=g$3(this,D);if(!wr)throw new Error("No /dev/blob File or Blob provided to llseek");let Tr=_r;if(yr===1?Tr+=hr.position:yr===2&&(Tr=new Uint8Array(wr).length),Tr<0)throw new lr.FS.ErrnoError(28);return Tr}};lr.FS.registerDevice(dr,pr),lr.FS.mkdev("/dev/blob",dr)}]},{emscriptenOpts:rr}=await this.fs.init(this,tr);tr=rr;for(let[lr,dr]of Object.entries(g$3(this,z)))if(dr instanceof URL)e[lr]=ee(dr);else{let pr=await dr.setup(this,tr);if(pr.emscriptenOpts&&(tr=pr.emscriptenOpts),pr.namespaceObj){let hr=this;hr[lr]=pr.namespaceObj}pr.bundlePath&&(e[lr]=ee(pr.bundlePath)),pr.init&&I.push(pr.init),pr.close&&g$3(this,$).push(pr.close)}if(tr.pg_extensions=e,await ue,this.mod=await we(tr),await this.fs.initialSyncFs(),ae.loadDataDir){if(this.mod.FS.analyzePath(C$1+"/PG_VERSION").exists)throw new Error("Database already exists, cannot load from tarball");P$1(this,E,W).call(this,"pglite: loading data from tarball"),await ce(this.mod.FS,ae.loadDataDir,C$1)}this.mod.FS.analyzePath(C$1+"/PG_VERSION").exists?P$1(this,E,W).call(this,"pglite: found DB, resuming"):P$1(this,E,W).call(this,"pglite: no db"),await he(this.mod,(...lr)=>P$1(this,E,W).call(this,...lr));let ir=this.mod._pg_initdb();if(!ir)throw new Error("INITDB failed to return value");if(ir&1)throw new Error("INITDB failed");if(ir&2){let lr=ae.username??"postgres",dr=ae.database??"template1";if(ir&4){if(!(ir&12))throw new Error("Invalid db/user combination")}else if(dr!=="template1"&&lr!=="postgres")throw new Error("INITDB created a new datadir, but an alternative db/user was requested")}await this.syncToFs(),h$2(this,B,!0),await this.exec("SET search_path TO public;"),await this._initArrayTypes();for(let lr of I)await lr()},W=function(...ae){this.debug>0&&console.log(...ae)};var be=te;x$1();class PGliteInstance{static{this.instance=null}static{this.options={}}static async getInstance(){return PGliteInstance.instance||(PGliteInstance.options||console.warn("PGlite constructor options are not provided. Creating instance with default options."),PGliteInstance.instance=await be.create(PGliteInstance.options)),PGliteInstance.instance}static setOptions(e){PGliteInstance.options=e}static async close(){PGliteInstance.instance&&(await PGliteInstance.instance.close(),PGliteInstance.instance=null)}}class PGlitePool extends EventEmitter{constructor(){super()}doneCallback(){}async connect(e){try{await PGliteInstance.getInstance(),e(null,this,this.doneCallback)}catch(I){e(I,null,this.doneCallback)}}async query(e,I,oe){const ue=await PGliteInstance.getInstance();let bt=oe,tr=I;return typeof I=="function"&&(bt=I,tr=void 0),ue.query(e,tr).then(rr=>(bt&&bt(null,rr),rr)).catch(rr=>{throw bt&&bt(rr,null),rr})}end(e){PGliteInstance.close().then(()=>e(null)).catch(I=>e(I))}}class PGliteDriver{constructor(e){e&&PGliteInstance.setOptions(e)}get driver(){return class{static{this.Pool=PGlitePool}static{this.pool=PGlitePool}}}}const processes=new Map,WOKER_INIT_MESSAGE_ID="_WORKER_INIT_";function sendToMainThread(ae,e,I){!processes.get(ae)&&ae!==WOKER_INIT_MESSAGE_ID||self.postMessage({messageId:ae,type:e,payload:I})}function handlePayloadFunc(ae){return async e=>{try{const I=await ae(e);sendToMainThread(e.messageId,"complete",I)}catch(I){sendToMainThread(e.messageId,"error",{error:I instanceof Error?I.message:"An error occurred",error_code:"UNKNOWN_ERROR"})}finally{processes.delete(e.messageId)}}}function listenForMessages(ae,e){self.addEventListener("message",async I=>{processes.set(I.data.messageId,Promise.race([handlePayloadFunc(ae)(I.data),new Promise(oe=>setTimeout(()=>oe(!0),12e4)).then(()=>{processes.has(I.data.messageId)&&(sendToMainThread(I.data.messageId,"error",{error:"Operation timed out",error_code:"TIMEOUT_ERROR"}),processes.delete(I.data.messageId))})])),sendToMainThread(I.data.messageId,"started","Started processing")})}async function init(ae){typeof ae=="function"&&await ae(),sendToMainThread(WOKER_INIT_MESSAGE_ID,"complete","Worker initialized")}const TABLE_NAMES={Thread:"threads",Message:"messages",LLM:"llms",FlowNode:"flow_nodes",FlowEdge:"flow_edges",Prompt:"prompts",PromptVariable:"prompt_variables",Session:"sessions",Schema:"schemas",SchemaItem:"schema_items",JSONData:"json_data",CSVData:"csv_data",ToolDefinition:"tool_definitions",VectorDatabase:"vector_databases",JSONLData:"jsonl_data",FlowNodeData:"flow_node_data"};var __defProp$f=Object.defineProperty,__getOwnPropDesc$f=Object.getOwnPropertyDescriptor,__decorateClass$f=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$f(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$f(e,I,ue),ue};let Thread=class{};__decorateClass$f([PrimaryGeneratedColumn("uuid")],Thread.prototype,"id",2);__decorateClass$f([Column({type:"text"})],Thread.prototype,"title",2);__decorateClass$f([Column({type:"text"})],Thread.prototype,"status",2);__decorateClass$f([Column({type:"text",nullable:!0})],Thread.prototype,"userId",2);__decorateClass$f([CreateDateColumn()],Thread.prototype,"created_at",2);__decorateClass$f([UpdateDateColumn()],Thread.prototype,"updated_at",2);__decorateClass$f([OneToMany(()=>Message,ae=>ae.thread,{onDelete:"CASCADE"})],Thread.prototype,"messages",2);__decorateClass$f([Column("uuid",{nullable:!0})],Thread.prototype,"schema_id",2);__decorateClass$f([ManyToOne(()=>Schema,ae=>ae.threads,{createForeignKeyConstraints:!1}),JoinColumn({name:"schema_id"})],Thread.prototype,"schema",2);__decorateClass$f([Column("uuid")],Thread.prototype,"initial_llm_id",2);__decorateClass$f([ManyToOne(()=>LLM,ae=>ae.threads,{createForeignKeyConstraints:!1}),JoinColumn({name:"initial_llm_id"})],Thread.prototype,"llm",2);__decorateClass$f([Column("uuid")],Thread.prototype,"session_id",2);__decorateClass$f([ManyToOne(()=>Session,ae=>ae.threads,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Thread.prototype,"session",2);Thread=__decorateClass$f([Entity({name:TABLE_NAMES.Thread})],Thread);var __defProp$e=Object.defineProperty,__getOwnPropDesc$e=Object.getOwnPropertyDescriptor,__decorateClass$e=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$e(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$e(e,I,ue),ue};let Message=class{};__decorateClass$e([PrimaryGeneratedColumn("uuid")],Message.prototype,"id",2);__decorateClass$e([Column({type:"text"})],Message.prototype,"content",2);__decorateClass$e([Column({type:"text"})],Message.prototype,"role",2);__decorateClass$e([Column({type:"text"})],Message.prototype,"status",2);__decorateClass$e([Column({type:"text",nullable:!0})],Message.prototype,"metadata",2);__decorateClass$e([Column({type:"text",nullable:!0})],Message.prototype,"output",2);__decorateClass$e([Column({type:"boolean",nullable:!0})],Message.prototype,"hidden",2);__decorateClass$e([CreateDateColumn()],Message.prototype,"created_at",2);__decorateClass$e([UpdateDateColumn()],Message.prototype,"updated_at",2);__decorateClass$e([Column("uuid",{nullable:!0})],Message.prototype,"parent_message_id",2);__decorateClass$e([OneToOne(()=>Message,ae=>ae.message,{createForeignKeyConstraints:!1}),JoinColumn({name:"parent_message_id"})],Message.prototype,"message",2);__decorateClass$e([Column("uuid")],Message.prototype,"thread_id",2);__decorateClass$e([ManyToOne(()=>Thread,ae=>ae.messages,{createForeignKeyConstraints:!1}),JoinColumn({name:"thread_id"})],Message.prototype,"thread",2);__decorateClass$e([Column("uuid")],Message.prototype,"llm_id",2);__decorateClass$e([ManyToOne(()=>LLM,ae=>ae.messages,{createForeignKeyConstraints:!1}),JoinColumn({name:"llm_id"})],Message.prototype,"llm",2);__decorateClass$e([Column("uuid",{nullable:!0})],Message.prototype,"prompt_id",2);__decorateClass$e([ManyToOne(()=>Prompt,ae=>ae.messages,{createForeignKeyConstraints:!1}),JoinColumn({name:"prompt_id"})],Message.prototype,"prompt",2);Message=__decorateClass$e([Entity({name:TABLE_NAMES.Message})],Message);var __defProp$d=Object.defineProperty,__getOwnPropDesc$d=Object.getOwnPropertyDescriptor,__decorateClass$d=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$d(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$d(e,I,ue),ue};let LLM=class{};__decorateClass$d([PrimaryGeneratedColumn("uuid")],LLM.prototype,"id",2);__decorateClass$d([Column({type:"text"})],LLM.prototype,"name",2);__decorateClass$d([Column({type:"text"})],LLM.prototype,"status",2);__decorateClass$d([Column({type:"text"})],LLM.prototype,"provider",2);__decorateClass$d([Column({type:"text"})],LLM.prototype,"model_type",2);__decorateClass$d([Column({type:"boolean",nullable:!0})],LLM.prototype,"function_calling",2);__decorateClass$d([Column({type:"text",nullable:!0})],LLM.prototype,"metadata",2);__decorateClass$d([Column({type:"text",nullable:!0})],LLM.prototype,"connection_info",2);__decorateClass$d([CreateDateColumn()],LLM.prototype,"created_at",2);__decorateClass$d([UpdateDateColumn()],LLM.prototype,"updated_at",2);__decorateClass$d([OneToMany(()=>Message,ae=>ae.thread)],LLM.prototype,"messages",2);__decorateClass$d([OneToMany(()=>Thread,ae=>ae.llm)],LLM.prototype,"threads",2);__decorateClass$d([Column("uuid")],LLM.prototype,"session_id",2);__decorateClass$d([ManyToOne(()=>Session,ae=>ae.llms,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],LLM.prototype,"session",2);LLM=__decorateClass$d([Entity({name:TABLE_NAMES.LLM})],LLM);var __defProp$c=Object.defineProperty,__getOwnPropDesc$c=Object.getOwnPropertyDescriptor,__decorateClass$c=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$c(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$c(e,I,ue),ue};let FlowNode=class{};__decorateClass$c([PrimaryGeneratedColumn("uuid")],FlowNode.prototype,"id",2);__decorateClass$c([Column({type:"text"})],FlowNode.prototype,"node_type",2);__decorateClass$c([Column({type:"text",nullable:!0})],FlowNode.prototype,"source_id",2);__decorateClass$c([Column({type:"text",nullable:!0})],FlowNode.prototype,"source_type",2);__decorateClass$c([Column({type:"float"})],FlowNode.prototype,"x",2);__decorateClass$c([Column({type:"float"})],FlowNode.prototype,"y",2);__decorateClass$c([Column({type:"float",nullable:!0})],FlowNode.prototype,"width",2);__decorateClass$c([Column({type:"float",nullable:!0})],FlowNode.prototype,"height",2);__decorateClass$c([Column({type:"json",nullable:!0})],FlowNode.prototype,"data",2);__decorateClass$c([Column({type:"json",nullable:!0})],FlowNode.prototype,"metadata",2);__decorateClass$c([CreateDateColumn()],FlowNode.prototype,"created_at",2);__decorateClass$c([UpdateDateColumn()],FlowNode.prototype,"updated_at",2);__decorateClass$c([Column("uuid")],FlowNode.prototype,"session_id",2);__decorateClass$c([ManyToOne(()=>Session,ae=>ae.flow_nodes,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],FlowNode.prototype,"session",2);FlowNode=__decorateClass$c([Entity({name:TABLE_NAMES.FlowNode})],FlowNode);var __defProp$b=Object.defineProperty,__getOwnPropDesc$b=Object.getOwnPropertyDescriptor,__decorateClass$b=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$b(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$b(e,I,ue),ue};let FlowEdge=class{};__decorateClass$b([PrimaryGeneratedColumn("uuid")],FlowEdge.prototype,"id",2);__decorateClass$b([Column({nullable:!0,type:"text"})],FlowEdge.prototype,"type",2);__decorateClass$b([Column({type:"text"})],FlowEdge.prototype,"source",2);__decorateClass$b([Column({type:"text"})],FlowEdge.prototype,"target",2);__decorateClass$b([Column({nullable:!0,type:"text"})],FlowEdge.prototype,"sourceHandle",2);__decorateClass$b([Column({nullable:!0,type:"text"})],FlowEdge.prototype,"targetHandle",2);__decorateClass$b([Column({default:!1,type:"boolean"})],FlowEdge.prototype,"animated",2);__decorateClass$b([Column({default:!1,type:"boolean"})],FlowEdge.prototype,"hidden",2);__decorateClass$b([Column({default:!0,type:"boolean"})],FlowEdge.prototype,"deletable",2);__decorateClass$b([Column({default:!0,type:"boolean"})],FlowEdge.prototype,"selectable",2);__decorateClass$b([CreateDateColumn()],FlowEdge.prototype,"created_at",2);__decorateClass$b([UpdateDateColumn()],FlowEdge.prototype,"updated_at",2);__decorateClass$b([Column("uuid")],FlowEdge.prototype,"session_id",2);__decorateClass$b([ManyToOne(()=>Session,ae=>ae.flow_edges,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],FlowEdge.prototype,"session",2);FlowEdge=__decorateClass$b([Entity({name:TABLE_NAMES.FlowEdge})],FlowEdge);var __defProp$a=Object.defineProperty,__getOwnPropDesc$a=Object.getOwnPropertyDescriptor,__decorateClass$a=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$a(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$a(e,I,ue),ue};let Prompt=class{};__decorateClass$a([PrimaryGeneratedColumn("uuid")],Prompt.prototype,"id",2);__decorateClass$a([Column({type:"text",nullable:!0})],Prompt.prototype,"prefix",2);__decorateClass$a([Column({type:"text"})],Prompt.prototype,"content",2);__decorateClass$a([Column({type:"text",nullable:!0})],Prompt.prototype,"suffix",2);__decorateClass$a([Column({type:"text"})],Prompt.prototype,"type",2);__decorateClass$a([Column({type:"text"})],Prompt.prototype,"role",2);__decorateClass$a([Column({type:"text"})],Prompt.prototype,"status",2);__decorateClass$a([Column({type:"text",nullable:!0})],Prompt.prototype,"metadata",2);__decorateClass$a([CreateDateColumn()],Prompt.prototype,"created_at",2);__decorateClass$a([UpdateDateColumn()],Prompt.prototype,"updated_at",2);__decorateClass$a([OneToMany(()=>Message,ae=>ae.prompt)],Prompt.prototype,"messages",2);__decorateClass$a([OneToMany(()=>PromptVariable,ae=>ae.prompt,{onDelete:"CASCADE"})],Prompt.prototype,"variables",2);__decorateClass$a([Column("uuid")],Prompt.prototype,"session_id",2);__decorateClass$a([ManyToOne(()=>Session,ae=>ae.prompts,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Prompt.prototype,"session",2);Prompt=__decorateClass$a([Entity({name:TABLE_NAMES.Prompt})],Prompt);var __defProp$9=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$9(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$9(e,I,ue),ue};let PromptVariable=class{};__decorateClass$9([PrimaryGeneratedColumn("uuid")],PromptVariable.prototype,"id",2);__decorateClass$9([Column({type:"text"})],PromptVariable.prototype,"name",2);__decorateClass$9([Column({type:"text"})],PromptVariable.prototype,"type",2);__decorateClass$9([Column({type:"text",nullable:!0})],PromptVariable.prototype,"value",2);__decorateClass$9([Column({type:"text"})],PromptVariable.prototype,"map_field",2);__decorateClass$9([Column({type:"text",nullable:!0})],PromptVariable.prototype,"map_key",2);__decorateClass$9([Column({type:"text"})],PromptVariable.prototype,"map_id",2);__decorateClass$9([Column({type:"text"})],PromptVariable.prototype,"map_type",2);__decorateClass$9([Column({type:"text",nullable:!0})],PromptVariable.prototype,"metadata",2);__decorateClass$9([CreateDateColumn()],PromptVariable.prototype,"created_at",2);__decorateClass$9([UpdateDateColumn()],PromptVariable.prototype,"updated_at",2);__decorateClass$9([OneToMany(()=>Message,ae=>ae.prompt)],PromptVariable.prototype,"messages",2);__decorateClass$9([Column("uuid",{nullable:!0})],PromptVariable.prototype,"prompt_id",2);__decorateClass$9([ManyToOne(()=>Prompt,ae=>ae.variables,{createForeignKeyConstraints:!1}),JoinColumn({name:"prompt_id"})],PromptVariable.prototype,"prompt",2);PromptVariable=__decorateClass$9([Entity({name:TABLE_NAMES.PromptVariable})],PromptVariable);var __defProp$8=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$8(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$8(e,I,ue),ue};let Session=class{};__decorateClass$8([PrimaryGeneratedColumn("uuid")],Session.prototype,"id",2);__decorateClass$8([Column({type:"text"})],Session.prototype,"name",2);__decorateClass$8([Column({type:"text"})],Session.prototype,"status",2);__decorateClass$8([Column({type:"text",nullable:!0})],Session.prototype,"metadata",2);__decorateClass$8([CreateDateColumn()],Session.prototype,"created_at",2);__decorateClass$8([UpdateDateColumn()],Session.prototype,"updated_at",2);__decorateClass$8([OneToMany(()=>Prompt,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"prompts",2);__decorateClass$8([OneToMany(()=>Thread,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"threads",2);__decorateClass$8([OneToMany(()=>LLM,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"llms",2);__decorateClass$8([OneToMany(()=>FlowNode,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"flow_nodes",2);__decorateClass$8([OneToMany(()=>FlowEdge,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"flow_edges",2);__decorateClass$8([OneToMany(()=>Schema,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"schemas",2);__decorateClass$8([OneToMany(()=>CSVData,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"csv_datas",2);__decorateClass$8([OneToMany(()=>VectorDatabase,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"vector_databases",2);__decorateClass$8([OneToMany(()=>JSONData,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"json_datas",2);__decorateClass$8([OneToMany(()=>JSONLData,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"jsonl_datas",2);__decorateClass$8([OneToMany(()=>ToolDefinition,ae=>ae.session,{onDelete:"CASCADE"})],Session.prototype,"tool_definitions",2);Session=__decorateClass$8([Entity({name:TABLE_NAMES.Session})],Session);var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$7(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$7(e,I,ue),ue};let Schema=class{};__decorateClass$7([PrimaryGeneratedColumn("uuid")],Schema.prototype,"id",2);__decorateClass$7([Column({type:"text"})],Schema.prototype,"name",2);__decorateClass$7([CreateDateColumn()],Schema.prototype,"created_at",2);__decorateClass$7([UpdateDateColumn()],Schema.prototype,"updated_at",2);__decorateClass$7([OneToMany(()=>SchemaItem,ae=>ae.schema,{onDelete:"CASCADE"})],Schema.prototype,"schema_items",2);__decorateClass$7([OneToMany(()=>Thread,ae=>ae.schema)],Schema.prototype,"threads",2);__decorateClass$7([Column("uuid")],Schema.prototype,"session_id",2);__decorateClass$7([ManyToOne(()=>Session,ae=>ae.schemas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Schema.prototype,"session",2);Schema=__decorateClass$7([Entity({name:TABLE_NAMES.Schema})],Schema);var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$6(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$6(e,I,ue),ue};let SchemaItem=class{};__decorateClass$6([PrimaryGeneratedColumn("uuid")],SchemaItem.prototype,"id",2);__decorateClass$6([Column({type:"text"})],SchemaItem.prototype,"name",2);__decorateClass$6([Column({type:"text",nullable:!0})],SchemaItem.prototype,"description",2);__decorateClass$6([Column({type:"boolean"})],SchemaItem.prototype,"required",2);__decorateClass$6([Column({type:"text"})],SchemaItem.prototype,"type",2);__decorateClass$6([Column({type:"text",nullable:!0})],SchemaItem.prototype,"metadata",2);__decorateClass$6([Column({type:"text",nullable:!0})],SchemaItem.prototype,"enum",2);__decorateClass$6([CreateDateColumn()],SchemaItem.prototype,"created_at",2);__decorateClass$6([UpdateDateColumn()],SchemaItem.prototype,"updated_at",2);__decorateClass$6([OneToMany(()=>SchemaItem,ae=>ae.parent)],SchemaItem.prototype,"schemas",2);__decorateClass$6([Column("uuid",{nullable:!0})],SchemaItem.prototype,"parent_id",2);__decorateClass$6([ManyToOne(()=>SchemaItem,ae=>ae.schemas,{createForeignKeyConstraints:!1}),JoinColumn({name:"parent_id"})],SchemaItem.prototype,"parent",2);__decorateClass$6([Column("uuid")],SchemaItem.prototype,"schema_id",2);__decorateClass$6([ManyToOne(()=>Schema,ae=>ae.schema_items,{createForeignKeyConstraints:!1}),JoinColumn({name:"schema_id"})],SchemaItem.prototype,"schema",2);__decorateClass$6([Column("uuid")],SchemaItem.prototype,"session_id",2);__decorateClass$6([ManyToOne(()=>Session,ae=>ae.schemas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],SchemaItem.prototype,"session",2);SchemaItem=__decorateClass$6([Entity({name:TABLE_NAMES.SchemaItem})],SchemaItem);var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$5(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$5(e,I,ue),ue};let JSONData=class{};__decorateClass$5([PrimaryGeneratedColumn("uuid")],JSONData.prototype,"id",2);__decorateClass$5([Column({type:"text"})],JSONData.prototype,"headers",2);__decorateClass$5([Column({type:"text"})],JSONData.prototype,"json",2);__decorateClass$5([Column({type:"text",nullable:!0})],JSONData.prototype,"metadata",2);__decorateClass$5([CreateDateColumn()],JSONData.prototype,"created_at",2);__decorateClass$5([UpdateDateColumn()],JSONData.prototype,"updated_at",2);__decorateClass$5([Column("uuid")],JSONData.prototype,"session_id",2);__decorateClass$5([ManyToOne(()=>Session,ae=>ae.json_datas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],JSONData.prototype,"session",2);JSONData=__decorateClass$5([Entity({name:TABLE_NAMES.JSONData})],JSONData);var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$4(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$4(e,I,ue),ue};let CSVData=class{};__decorateClass$4([PrimaryGeneratedColumn("uuid")],CSVData.prototype,"id",2);__decorateClass$4([Column({type:"text"})],CSVData.prototype,"headers",2);__decorateClass$4([Column({type:"text"})],CSVData.prototype,"csv",2);__decorateClass$4([Column({type:"text",nullable:!0})],CSVData.prototype,"metadata",2);__decorateClass$4([CreateDateColumn()],CSVData.prototype,"created_at",2);__decorateClass$4([UpdateDateColumn()],CSVData.prototype,"updated_at",2);__decorateClass$4([Column("uuid")],CSVData.prototype,"session_id",2);__decorateClass$4([ManyToOne(()=>Session,ae=>ae.csv_datas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],CSVData.prototype,"session",2);CSVData=__decorateClass$4([Entity({name:TABLE_NAMES.CSVData})],CSVData);var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$3(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$3(e,I,ue),ue};let ToolDefinition=class{};__decorateClass$3([PrimaryGeneratedColumn("uuid")],ToolDefinition.prototype,"id",2);__decorateClass$3([Column({type:"text"})],ToolDefinition.prototype,"name",2);__decorateClass$3([Column({type:"text"})],ToolDefinition.prototype,"description",2);__decorateClass$3([Column({type:"text",nullable:!0})],ToolDefinition.prototype,"type",2);__decorateClass$3([Column({type:"text",nullable:!0})],ToolDefinition.prototype,"metadata",2);__decorateClass$3([CreateDateColumn()],ToolDefinition.prototype,"created_at",2);__decorateClass$3([UpdateDateColumn()],ToolDefinition.prototype,"updated_at",2);__decorateClass$3([Column("uuid")],ToolDefinition.prototype,"session_id",2);__decorateClass$3([ManyToOne(()=>Session,ae=>ae.tool_definitions,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],ToolDefinition.prototype,"session",2);ToolDefinition=__decorateClass$3([Entity({name:TABLE_NAMES.ToolDefinition})],ToolDefinition);var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$2(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$2(e,I,ue),ue};let VectorDatabase=class{};__decorateClass$2([PrimaryGeneratedColumn("uuid")],VectorDatabase.prototype,"id",2);__decorateClass$2([Column({type:"text"})],VectorDatabase.prototype,"name",2);__decorateClass$2([Column({type:"text"})],VectorDatabase.prototype,"type",2);__decorateClass$2([Column({type:"text",nullable:!0})],VectorDatabase.prototype,"provider",2);__decorateClass$2([Column({type:"text",nullable:!0})],VectorDatabase.prototype,"storage",2);__decorateClass$2([Column({type:"text",nullable:!0})],VectorDatabase.prototype,"metadata",2);__decorateClass$2([CreateDateColumn()],VectorDatabase.prototype,"created_at",2);__decorateClass$2([UpdateDateColumn()],VectorDatabase.prototype,"updated_at",2);__decorateClass$2([Column("uuid")],VectorDatabase.prototype,"session_id",2);__decorateClass$2([ManyToOne(()=>Session,ae=>ae.vector_databases,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],VectorDatabase.prototype,"session",2);VectorDatabase=__decorateClass$2([Entity({name:TABLE_NAMES.VectorDatabase})],VectorDatabase);var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc$1(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp$1(e,I,ue),ue};let JSONLData=class{};__decorateClass$1([PrimaryGeneratedColumn("uuid")],JSONLData.prototype,"id",2);__decorateClass$1([Column({type:"text"})],JSONLData.prototype,"headers",2);__decorateClass$1([Column({type:"text"})],JSONLData.prototype,"jsonl",2);__decorateClass$1([Column({type:"text",nullable:!0})],JSONLData.prototype,"metadata",2);__decorateClass$1([CreateDateColumn()],JSONLData.prototype,"created_at",2);__decorateClass$1([UpdateDateColumn()],JSONLData.prototype,"updated_at",2);__decorateClass$1([Column("uuid")],JSONLData.prototype,"session_id",2);__decorateClass$1([ManyToOne(()=>Session,ae=>ae.jsonl_datas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],JSONLData.prototype,"session",2);JSONLData=__decorateClass$1([Entity({name:TABLE_NAMES.JSONLData})],JSONLData);var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(ae,e,I,oe)=>{for(var ue=oe>1?void 0:oe?__getOwnPropDesc(e,I):e,bt=ae.length-1,tr;bt>=0;bt--)(tr=ae[bt])&&(ue=(oe?tr(e,I,ue):tr(ue))||ue);return oe&&ue&&__defProp(e,I,ue),ue};let FlowNodeData=class{};__decorateClass([PrimaryGeneratedColumn("uuid")],FlowNodeData.prototype,"id",2);__decorateClass([Column({type:"json",nullable:!0})],FlowNodeData.prototype,"data",2);__decorateClass([Column({type:"json",nullable:!0})],FlowNodeData.prototype,"metadata",2);__decorateClass([Column({type:"json",nullable:!0})],FlowNodeData.prototype,"properties",2);__decorateClass([CreateDateColumn()],FlowNodeData.prototype,"created_at",2);__decorateClass([UpdateDateColumn()],FlowNodeData.prototype,"updated_at",2);__decorateClass([Column("uuid")],FlowNodeData.prototype,"session_id",2);__decorateClass([ManyToOne(()=>Session,ae=>ae.flow_nodes,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],FlowNodeData.prototype,"session",2);FlowNodeData=__decorateClass([Entity({name:TABLE_NAMES.FlowNodeData})],FlowNodeData);const entitiesMap={LLM,Thread,Message,FlowNode,FlowEdge,Prompt,PromptVariable,Session,Schema,SchemaItem,JSONData,CSVData,ToolDefinition,VectorDatabase,JSONLData,FlowNodeData},isPlainObject=ae=>!!ae&&typeof ae=="object"&&!Array.isArray(ae),isFindOperator=ae=>!!ae&&typeof ae=="object"&&"type"in ae&&"@instanceof"in ae,reconstructFindOperator=ae=>{if(isPlainObject(ae)&&isFindOperator(ae))switch(ae.type){case"moreThan":return MoreThan(ae.value);case"lessThan":return LessThan(ae.value);case"equal":return Equal(ae.value);case"like":return Like(ae.value);case"in":return In$1(ae.value);case"not":return Not(ae.value);case"isNull":return IsNull();case"between":return Between(ae.value[0],ae.value[1]);case"lessThanOrEqual":return LessThanOrEqual(ae.value);case"moreThanOrEqual":return MoreThanOrEqual(ae.value);case"any":return Any(ae.value);case"arrayContainedBy":return ArrayContainedBy(ae.value);case"arrayContains":return ArrayContains(ae.value);case"arrayOverlap":return ArrayOverlap(ae.value);case"raw":return Raw(`${ae.value}`);default:throw new Error(`Unsupported FindOperator type: ${ae.type}`)}return ae},transformBridgeJSONObjectToQuery=ae=>{if(ae==null||typeof ae=="string"||typeof ae=="number")return ae;if(typeof ae=="object"){if(Array.isArray(ae))return ae.map(I=>transformBridgeJSONObjectToQuery(I));const e={};return Object.keys(ae).forEach(I=>{const oe=ae[I];isFindOperator(oe)?e[I]=reconstructFindOperator(oe):oe&&typeof oe=="object"&&oe!==null?e[I]=transformBridgeJSONObjectToQuery(oe):e[I]=oe}),e}return ae};var WorkerExecutionType=(ae=>(ae.INIT="init",ae.REPOSITORY_EXECUTE="repository-execute",ae.RAW_QUERY_EXECUTE="raw-query-execute",ae))(WorkerExecutionType||{});let appDataSource,initProcess;const initDatabase=async()=>{if(appDataSource=new DataSource({type:"postgres",driver:new PGliteDriver({dataDir:"idb://local-db",extensions:{uuid_ossp:o$3}}).driver,entities:Object.values(entitiesMap),logging:[...DATABASE_LOG_CONFIG.logging],synchronize:!0,logger:DATABASE_LOG_CONFIG.logger,entitySkipConstructor:!0}),!appDataSource)throw new Error("Database not initialized");await appDataSource.initialize(),initProcess=void 0},getRepositoryAction=async(ae,e,I)=>{if(!appDataSource)throw new Error("Database not initialized");if(!entitiesMap[ae])throw new Error(`Entity not found: ${ae}`);switch(e){case"find":return appDataSource.getRepository(entitiesMap[ae]).find(transformBridgeJSONObjectToQuery(I));case"findOne":return appDataSource.getRepository(entitiesMap[ae]).findOne(transformBridgeJSONObjectToQuery(I));case"count":return appDataSource.getRepository(entitiesMap[ae]).count(transformBridgeJSONObjectToQuery(I));case"save":return appDataSource.getRepository(entitiesMap[ae]).save(I);case"update":if(typeof I!="object"||!("id"in I)||!("update"in I))throw new Error("Invalid data for update");return appDataSource.getRepository(entitiesMap[ae]).update(I.id,I.update);case"delete":if(typeof I!="string"&&typeof I!="number")throw new Error("Invalid data for delete");return appDataSource.getRepository(entitiesMap[ae]).delete(I);default:throw new Error(`Unknown action: ${e}`)}};async function handlePayload(ae){if(!(!ae.messageId||!Object.keys(ae).length))switch(logDebug("Database worker received message:",ae,ae.type),ae.type){case WorkerExecutionType.INIT:return appDataSource||initProcess?"Database already initialized":(initProcess=init(),await initProcess,initProcess=void 0,"Database initialized");case WorkerExecutionType.REPOSITORY_EXECUTE:{if(initProcess&&await initProcess,!appDataSource)throw new Error("Database not initialized");const[I,oe,ue]=ae.payload;return getRepositoryAction(I,oe,ue)}case WorkerExecutionType.RAW_QUERY_EXECUTE:{if(initProcess&&await initProcess,!appDataSource)throw new Error("Database not initialized");return appDataSource.query(...ae.payload)}default:throw new Error("Invalid operation")}}listenForMessages(handlePayload);init(async()=>{initProcess=initDatabase()});export{C$1 as C,L$3 as L,P$1 as P,R$2 as R,cr as c,g$3 as g,h$2 as h,sr as s,ur as u,x$1 as x};
