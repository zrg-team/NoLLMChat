var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(k){return k&&k.__esModule&&Object.prototype.hasOwnProperty.call(k,"default")?k.default:k}var _Reflect={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var hasRequired_Reflect;function require_Reflect(){if(hasRequired_Reflect)return _Reflect;hasRequired_Reflect=1;var k;return function(e){(function(I){var B=typeof globalThis=="object"?globalThis:typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:dr(),tr=rr(e);typeof B.Reflect<"u"&&(tr=rr(B.Reflect,tr)),I(tr,B),typeof B.Reflect>"u"&&(B.Reflect=e);function rr(mr,hr){return function(fr,_r){Object.defineProperty(mr,fr,{configurable:!0,writable:!0,value:_r}),hr&&hr(fr,_r)}}function ir(){try{return Function("return this;")()}catch{}}function lr(){try{return(0,eval)("(function() { return this; })()")}catch{}}function dr(){return ir()||lr()}})(function(I,B){var tr=Object.prototype.hasOwnProperty,rr=typeof Symbol=="function",ir=rr&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",lr=rr&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",dr=typeof Object.create=="function",mr={__proto__:[]}instanceof Array,hr=!dr&&!mr,fr={create:dr?function(){return wr(Object.create(null))}:mr?function(){return wr({__proto__:null})}:function(){return wr({})},has:hr?function(yr,Cr){return tr.call(yr,Cr)}:function(yr,Cr){return Cr in yr},get:hr?function(yr,Cr){return tr.call(yr,Cr)?yr[Cr]:void 0}:function(yr,Cr){return yr[Cr]}},_r=Object.getPrototypeOf(Function),gr=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Xs(),Sr=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ra(),Ar=typeof WeakMap=="function"?WeakMap:Ir(),Or=rr?Symbol.for("@reflect-metadata:registry"):void 0,Fr=ea(),vr=Ks(Fr);function xr(yr,Cr,Dr,zr){if(gs(Dr)){if(!Hs(yr))throw new TypeError;if(!sa(Cr))throw new TypeError;return ts(yr,Cr)}else{if(!Hs(yr))throw new TypeError;if(!Ns(Cr))throw new TypeError;if(!Ns(zr)&&!gs(zr)&&!xs(zr))throw new TypeError;return xs(zr)&&(zr=void 0),Dr=Os(Dr),rs(yr,Cr,Dr,zr)}}I("decorate",xr);function kr(yr,Cr){function Dr(zr,Jr){if(!Ns(zr))throw new TypeError;if(!gs(Jr)&&!aa(Jr))throw new TypeError;ys(yr,Cr,zr,Jr)}return Dr}I("metadata",kr);function Gr(yr,Cr,Dr,zr){if(!Ns(Dr))throw new TypeError;return gs(zr)||(zr=Os(zr)),ys(yr,Cr,Dr,zr)}I("defineMetadata",Gr);function is(yr,Cr,Dr){if(!Ns(Cr))throw new TypeError;return gs(Dr)||(Dr=Os(Dr)),ss(yr,Cr,Dr)}I("hasMetadata",is);function as(yr,Cr,Dr){if(!Ns(Cr))throw new TypeError;return gs(Dr)||(Dr=Os(Dr)),ls(yr,Cr,Dr)}I("hasOwnMetadata",as);function cs(yr,Cr,Dr){if(!Ns(Cr))throw new TypeError;return gs(Dr)||(Dr=Os(Dr)),os(yr,Cr,Dr)}I("getMetadata",cs);function es(yr,Cr,Dr){if(!Ns(Cr))throw new TypeError;return gs(Dr)||(Dr=Os(Dr)),us(yr,Cr,Dr)}I("getOwnMetadata",es);function ps(yr,Cr){if(!Ns(yr))throw new TypeError;return gs(Cr)||(Cr=Os(Cr)),bs(yr,Cr)}I("getMetadataKeys",ps);function Ur(yr,Cr){if(!Ns(yr))throw new TypeError;return gs(Cr)||(Cr=Os(Cr)),As(yr,Cr)}I("getOwnMetadataKeys",Ur);function Lr(yr,Cr,Dr){if(!Ns(Cr))throw new TypeError;if(gs(Dr)||(Dr=Os(Dr)),!Ns(Cr))throw new TypeError;gs(Dr)||(Dr=Os(Dr));var zr=ta(Cr,Dr,!1);return gs(zr)?!1:zr.OrdinaryDeleteMetadata(yr,Cr,Dr)}I("deleteMetadata",Lr);function ts(yr,Cr){for(var Dr=yr.length-1;Dr>=0;--Dr){var zr=yr[Dr],Jr=zr(Cr);if(!gs(Jr)&&!xs(Jr)){if(!sa(Jr))throw new TypeError;Cr=Jr}}return Cr}function rs(yr,Cr,Dr,zr){for(var Jr=yr.length-1;Jr>=0;--Jr){var Ss=yr[Jr],Ts=Ss(Cr,Dr,zr);if(!gs(Ts)&&!xs(Ts)){if(!Ns(Ts))throw new TypeError;zr=Ts}}return zr}function ss(yr,Cr,Dr){var zr=ls(yr,Cr,Dr);if(zr)return!0;var Jr=Ps(Cr);return xs(Jr)?!1:ss(yr,Jr,Dr)}function ls(yr,Cr,Dr){var zr=ta(Cr,Dr,!1);return gs(zr)?!1:ks(zr.OrdinaryHasOwnMetadata(yr,Cr,Dr))}function os(yr,Cr,Dr){var zr=ls(yr,Cr,Dr);if(zr)return us(yr,Cr,Dr);var Jr=Ps(Cr);if(!xs(Jr))return os(yr,Jr,Dr)}function us(yr,Cr,Dr){var zr=ta(Cr,Dr,!1);if(!gs(zr))return zr.OrdinaryGetOwnMetadata(yr,Cr,Dr)}function ys(yr,Cr,Dr,zr){var Jr=ta(Dr,zr,!0);Jr.OrdinaryDefineOwnMetadata(yr,Cr,Dr,zr)}function bs(yr,Cr){var Dr=As(yr,Cr),zr=Ps(yr);if(zr===null)return Dr;var Jr=bs(zr,Cr);if(Jr.length<=0)return Dr;if(Dr.length<=0)return Jr;for(var Ss=new Sr,Ts=[],Ms=0,_s=Dr;Ms<_s.length;Ms++){var hs=_s[Ms],ws=Ss.has(hs);ws||(Ss.add(hs),Ts.push(hs))}for(var Es=0,Cs=Jr;Es<Cs.length;Es++){var hs=Cs[Es],ws=Ss.has(hs);ws||(Ss.add(hs),Ts.push(hs))}return Ts}function As(yr,Cr){var Dr=ta(yr,Cr,!1);return Dr?Dr.OrdinaryOwnMetadataKeys(yr,Cr):[]}function vs(yr){if(yr===null)return 1;switch(typeof yr){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return yr===null?1:6;default:return 6}}function gs(yr){return yr===void 0}function xs(yr){return yr===null}function Is(yr){return typeof yr=="symbol"}function Ns(yr){return typeof yr=="object"?yr!==null:typeof yr=="function"}function Vs(yr,Cr){switch(vs(yr)){case 0:return yr;case 1:return yr;case 2:return yr;case 3:return yr;case 4:return yr;case 5:return yr}var Dr="string",zr=Ys(yr,ir);if(zr!==void 0){var Jr=zr.call(yr,Dr);if(Ns(Jr))throw new TypeError;return Jr}return Ls(yr)}function Ls(yr,Cr){var Dr,zr;{var Jr=yr.toString;if(Gs(Jr)){var zr=Jr.call(yr);if(!Ns(zr))return zr}var Dr=yr.valueOf;if(Gs(Dr)){var zr=Dr.call(yr);if(!Ns(zr))return zr}}throw new TypeError}function ks(yr){return!!yr}function Fs(yr){return""+yr}function Os(yr){var Cr=Vs(yr);return Is(Cr)?Cr:Fs(Cr)}function Hs(yr){return Array.isArray?Array.isArray(yr):yr instanceof Object?yr instanceof Array:Object.prototype.toString.call(yr)==="[object Array]"}function Gs(yr){return typeof yr=="function"}function sa(yr){return typeof yr=="function"}function aa(yr){switch(vs(yr)){case 3:return!0;case 4:return!0;default:return!1}}function Ws(yr,Cr){return yr===Cr||yr!==yr&&Cr!==Cr}function Ys(yr,Cr){var Dr=yr[Cr];if(Dr!=null){if(!Gs(Dr))throw new TypeError;return Dr}}function na(yr){var Cr=Ys(yr,lr);if(!Gs(Cr))throw new TypeError;var Dr=Cr.call(yr);if(!Ns(Dr))throw new TypeError;return Dr}function ia(yr){return yr.value}function Zs(yr){var Cr=yr.next();return Cr.done?!1:Cr}function Qs(yr){var Cr=yr.return;Cr&&Cr.call(yr)}function Ps(yr){var Cr=Object.getPrototypeOf(yr);if(typeof yr!="function"||yr===_r||Cr!==_r)return Cr;var Dr=yr.prototype,zr=Dr&&Object.getPrototypeOf(Dr);if(zr==null||zr===Object.prototype)return Cr;var Jr=zr.constructor;return typeof Jr!="function"||Jr===yr?Cr:Jr}function Bs(){var yr;!gs(Or)&&typeof B.Reflect<"u"&&!(Or in B.Reflect)&&typeof B.Reflect.defineMetadata=="function"&&(yr=oa(B.Reflect));var Cr,Dr,zr,Jr=new Ar,Ss={registerProvider:Ts,getProvider:_s,setProvider:ws};return Ss;function Ts(Es){if(!Object.isExtensible(Ss))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case yr===Es:break;case gs(Cr):Cr=Es;break;case Cr===Es:break;case gs(Dr):Dr=Es;break;case Dr===Es:break;default:zr===void 0&&(zr=new Sr),zr.add(Es);break}}function Ms(Es,Cs){if(!gs(Cr)){if(Cr.isProviderFor(Es,Cs))return Cr;if(!gs(Dr)){if(Dr.isProviderFor(Es,Cs))return Cr;if(!gs(zr))for(var $s=na(zr);;){var Ds=Zs($s);if(!Ds)return;var Js=ia(Ds);if(Js.isProviderFor(Es,Cs))return Qs($s),Js}}}if(!gs(yr)&&yr.isProviderFor(Es,Cs))return yr}function _s(Es,Cs){var $s=Jr.get(Es),Ds;return gs($s)||(Ds=$s.get(Cs)),gs(Ds)&&(Ds=Ms(Es,Cs),gs(Ds)||(gs($s)&&($s=new gr,Jr.set(Es,$s)),$s.set(Cs,Ds))),Ds}function hs(Es){if(gs(Es))throw new TypeError;return Cr===Es||Dr===Es||!gs(zr)&&zr.has(Es)}function ws(Es,Cs,$s){if(!hs($s))throw new Error("Metadata provider not registered.");var Ds=_s(Es,Cs);if(Ds!==$s){if(!gs(Ds))return!1;var Js=Jr.get(Es);gs(Js)&&(Js=new gr,Jr.set(Es,Js)),Js.set(Cs,$s)}return!0}}function ea(){var yr;return!gs(Or)&&Ns(B.Reflect)&&Object.isExtensible(B.Reflect)&&(yr=B.Reflect[Or]),gs(yr)&&(yr=Bs()),!gs(Or)&&Ns(B.Reflect)&&Object.isExtensible(B.Reflect)&&Object.defineProperty(B.Reflect,Or,{enumerable:!1,configurable:!1,writable:!1,value:yr}),yr}function Ks(yr){var Cr=new Ar,Dr={isProviderFor:function(hs,ws){var Es=Cr.get(hs);return gs(Es)?!1:Es.has(ws)},OrdinaryDefineOwnMetadata:Ts,OrdinaryHasOwnMetadata:Jr,OrdinaryGetOwnMetadata:Ss,OrdinaryOwnMetadataKeys:Ms,OrdinaryDeleteMetadata:_s};return Fr.registerProvider(Dr),Dr;function zr(hs,ws,Es){var Cs=Cr.get(hs),$s=!1;if(gs(Cs)){if(!Es)return;Cs=new gr,Cr.set(hs,Cs),$s=!0}var Ds=Cs.get(ws);if(gs(Ds)){if(!Es)return;if(Ds=new gr,Cs.set(ws,Ds),!yr.setProvider(hs,ws,Dr))throw Cs.delete(ws),$s&&Cr.delete(hs),new Error("Wrong provider for target.")}return Ds}function Jr(hs,ws,Es){var Cs=zr(ws,Es,!1);return gs(Cs)?!1:ks(Cs.has(hs))}function Ss(hs,ws,Es){var Cs=zr(ws,Es,!1);if(!gs(Cs))return Cs.get(hs)}function Ts(hs,ws,Es,Cs){var $s=zr(Es,Cs,!0);$s.set(hs,ws)}function Ms(hs,ws){var Es=[],Cs=zr(hs,ws,!1);if(gs(Cs))return Es;for(var $s=Cs.keys(),Ds=na($s),Js=0;;){var Pr=Zs(Ds);if(!Pr)return Es.length=Js,Es;var Mr=ia(Pr);try{Es[Js]=Mr}catch(br){try{Qs(Ds)}finally{throw br}}Js++}}function _s(hs,ws,Es){var Cs=zr(ws,Es,!1);if(gs(Cs)||!Cs.delete(hs))return!1;if(Cs.size===0){var $s=Cr.get(ws);gs($s)||($s.delete(Es),$s.size===0&&Cr.delete($s))}return!0}}function oa(yr){var Cr=yr.defineMetadata,Dr=yr.hasOwnMetadata,zr=yr.getOwnMetadata,Jr=yr.getOwnMetadataKeys,Ss=yr.deleteMetadata,Ts=new Ar,Ms={isProviderFor:function(_s,hs){var ws=Ts.get(_s);return!gs(ws)&&ws.has(hs)?!0:Jr(_s,hs).length?(gs(ws)&&(ws=new Sr,Ts.set(_s,ws)),ws.add(hs),!0):!1},OrdinaryDefineOwnMetadata:Cr,OrdinaryHasOwnMetadata:Dr,OrdinaryGetOwnMetadata:zr,OrdinaryOwnMetadataKeys:Jr,OrdinaryDeleteMetadata:Ss};return Ms}function ta(yr,Cr,Dr){var zr=Fr.getProvider(yr,Cr);if(!gs(zr))return zr;if(Dr){if(Fr.setProvider(yr,Cr,vr))return vr;throw new Error("Illegal state.")}}function Xs(){var yr={},Cr=[],Dr=function(){function Ms(_s,hs,ws){this._index=0,this._keys=_s,this._values=hs,this._selector=ws}return Ms.prototype["@@iterator"]=function(){return this},Ms.prototype[lr]=function(){return this},Ms.prototype.next=function(){var _s=this._index;if(_s>=0&&_s<this._keys.length){var hs=this._selector(this._keys[_s],this._values[_s]);return _s+1>=this._keys.length?(this._index=-1,this._keys=Cr,this._values=Cr):this._index++,{value:hs,done:!1}}return{value:void 0,done:!0}},Ms.prototype.throw=function(_s){throw this._index>=0&&(this._index=-1,this._keys=Cr,this._values=Cr),_s},Ms.prototype.return=function(_s){return this._index>=0&&(this._index=-1,this._keys=Cr,this._values=Cr),{value:_s,done:!0}},Ms}(),zr=function(){function Ms(){this._keys=[],this._values=[],this._cacheKey=yr,this._cacheIndex=-2}return Object.defineProperty(Ms.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ms.prototype.has=function(_s){return this._find(_s,!1)>=0},Ms.prototype.get=function(_s){var hs=this._find(_s,!1);return hs>=0?this._values[hs]:void 0},Ms.prototype.set=function(_s,hs){var ws=this._find(_s,!0);return this._values[ws]=hs,this},Ms.prototype.delete=function(_s){var hs=this._find(_s,!1);if(hs>=0){for(var ws=this._keys.length,Es=hs+1;Es<ws;Es++)this._keys[Es-1]=this._keys[Es],this._values[Es-1]=this._values[Es];return this._keys.length--,this._values.length--,Ws(_s,this._cacheKey)&&(this._cacheKey=yr,this._cacheIndex=-2),!0}return!1},Ms.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=yr,this._cacheIndex=-2},Ms.prototype.keys=function(){return new Dr(this._keys,this._values,Jr)},Ms.prototype.values=function(){return new Dr(this._keys,this._values,Ss)},Ms.prototype.entries=function(){return new Dr(this._keys,this._values,Ts)},Ms.prototype["@@iterator"]=function(){return this.entries()},Ms.prototype[lr]=function(){return this.entries()},Ms.prototype._find=function(_s,hs){if(!Ws(this._cacheKey,_s)){this._cacheIndex=-1;for(var ws=0;ws<this._keys.length;ws++)if(Ws(this._keys[ws],_s)){this._cacheIndex=ws;break}}return this._cacheIndex<0&&hs&&(this._cacheIndex=this._keys.length,this._keys.push(_s),this._values.push(void 0)),this._cacheIndex},Ms}();return zr;function Jr(Ms,_s){return Ms}function Ss(Ms,_s){return _s}function Ts(Ms,_s){return[Ms,_s]}}function ra(){var yr=function(){function Cr(){this._map=new gr}return Object.defineProperty(Cr.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Cr.prototype.has=function(Dr){return this._map.has(Dr)},Cr.prototype.add=function(Dr){return this._map.set(Dr,Dr),this},Cr.prototype.delete=function(Dr){return this._map.delete(Dr)},Cr.prototype.clear=function(){this._map.clear()},Cr.prototype.keys=function(){return this._map.keys()},Cr.prototype.values=function(){return this._map.keys()},Cr.prototype.entries=function(){return this._map.entries()},Cr.prototype["@@iterator"]=function(){return this.keys()},Cr.prototype[lr]=function(){return this.keys()},Cr}();return yr}function Ir(){var yr=16,Cr=fr.create(),Dr=zr();return function(){function _s(){this._key=zr()}return _s.prototype.has=function(hs){var ws=Jr(hs,!1);return ws!==void 0?fr.has(ws,this._key):!1},_s.prototype.get=function(hs){var ws=Jr(hs,!1);return ws!==void 0?fr.get(ws,this._key):void 0},_s.prototype.set=function(hs,ws){var Es=Jr(hs,!0);return Es[this._key]=ws,this},_s.prototype.delete=function(hs){var ws=Jr(hs,!1);return ws!==void 0?delete ws[this._key]:!1},_s.prototype.clear=function(){this._key=zr()},_s}();function zr(){var _s;do _s="@@WeakMap@@"+Ms();while(fr.has(Cr,_s));return Cr[_s]=!0,_s}function Jr(_s,hs){if(!tr.call(_s,Dr)){if(!hs)return;Object.defineProperty(_s,Dr,{value:fr.create()})}return _s[Dr]}function Ss(_s,hs){for(var ws=0;ws<hs;++ws)_s[ws]=Math.random()*255|0;return _s}function Ts(_s){if(typeof Uint8Array=="function"){var hs=new Uint8Array(_s);return typeof crypto<"u"?crypto.getRandomValues(hs):typeof msCrypto<"u"?msCrypto.getRandomValues(hs):Ss(hs,_s),hs}return Ss(new Array(_s),_s)}function Ms(){var _s=Ts(yr);_s[6]=_s[6]&79|64,_s[8]=_s[8]&191|128;for(var hs="",ws=0;ws<yr;++ws){var Es=_s[ws];(ws===4||ws===6||ws===8)&&(hs+="-"),Es<16&&(hs+="0"),hs+=Es.toString(16).toLowerCase()}return hs}}function wr(yr){return yr.__=void 0,delete yr.__,yr}})}(k||(k={})),_Reflect}require_Reflect();class MetadataUtils{static getInheritanceTree(e){const I=[e],B=tr=>{const rr=Object.getPrototypeOf(tr);rr&&rr.name&&(I.push(rr),B(rr))};return B(e),I}static isInherited(e,I){return e.prototype instanceof I}static filterByTarget(e,I){return I?e.filter(B=>B.target&&I.indexOf(B.target)!==-1):e}}class MetadataArgsStorage{constructor(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}filterTables(e){return this.filterByTarget(this.tables,e)}filterColumns(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)}findGenerated(e,I){return this.generations.find(B=>(Array.isArray(e)?e.indexOf(B.target)!==-1:B.target===e)&&B.propertyName===I)}findTree(e){return this.trees.find(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterRelations(e){return this.filterByTargetAndWithoutDuplicateRelationProperties(this.relations,e)}filterRelationIds(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)}filterRelationCounts(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)}filterIndices(e){return this.indices.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterUniques(e){return this.uniques.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterChecks(e){return this.checks.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterExclusions(e){return this.exclusions.filter(I=>Array.isArray(e)?e.indexOf(I.target)!==-1:I.target===e)}filterListeners(e){return this.filterByTarget(this.entityListeners,e)}filterEmbeddeds(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)}findJoinTable(e,I){return this.joinTables.find(B=>B.target===e&&B.propertyName===I)}filterJoinColumns(e,I){return this.joinColumns.filter(B=>B.target===e&&B.propertyName===I)}filterSubscribers(e){return this.filterByTarget(this.entitySubscribers,e)}filterNamingStrategies(e){return this.filterByTarget(this.namingStrategies,e)}filterTransactionEntityManagers(e,I){return this.transactionEntityManagers.filter(B=>(Array.isArray(e)?e.indexOf(B.target)!==-1:B.target===e)&&B.methodName===I)}filterTransactionRepository(e,I){return this.transactionRepositories.filter(B=>(Array.isArray(e)?e.indexOf(B.target)!==-1:B.target===e)&&B.methodName===I)}filterSingleTableChildren(e){return this.tables.filter(I=>typeof I.target=="function"&&typeof e=="function"&&MetadataUtils.isInherited(I.target,e)&&I.type==="entity-child")}findInheritanceType(e){return this.inheritances.find(I=>I.target===e)}findDiscriminatorValue(e){return this.discriminatorValues.find(I=>I.target===e)}filterByTarget(e,I){return e.filter(B=>Array.isArray(I)?I.indexOf(B.target)!==-1:B.target===I)}filterByTargetAndWithoutDuplicateProperties(e,I){const B=[];return e.forEach(tr=>{(Array.isArray(I)?I.indexOf(tr.target)!==-1:tr.target===I)&&(B.find(ir=>ir.propertyName===tr.propertyName)||B.push(tr))}),B}filterByTargetAndWithoutDuplicateRelationProperties(e,I){const B=[];return e.forEach(tr=>{if(Array.isArray(I)?I.indexOf(tr.target)!==-1:tr.target===I){const ir=B.findIndex(lr=>lr.propertyName===tr.propertyName);if(Array.isArray(I)&&ir!==-1&&I.indexOf(tr.target)<I.indexOf(B[ir].target)){const lr=Object.create(B[ir]);lr.type=tr.type,B[ir]=lr}else ir===-1&&B.push(tr)}}),B}filterByTargetAndWithoutDuplicateEmbeddedProperties(e,I){const B=[];return e.forEach(tr=>{(Array.isArray(I)?I.indexOf(tr.target)!==-1:tr.target===I)&&(B.find(lr=>lr.prefix===tr.prefix&&lr.propertyName===tr.propertyName)||B.push(tr))}),B}}const global$1=globalThis||void 0||self;var buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$1=0,len=code.length;i$1<len;++i$1)lookup[i$1]=code[i$1],revLookup[code.charCodeAt(i$1)]=i$1;revLookup[45]=62;revLookup[95]=63;function getLens(k){var e=k.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=k.indexOf("=");I===-1&&(I=e);var B=I===e?0:4-I%4;return[I,B]}function byteLength(k){var e=getLens(k),I=e[0],B=e[1];return(I+B)*3/4-B}function _byteLength(k,e,I){return(e+I)*3/4-I}function toByteArray(k){var e,I=getLens(k),B=I[0],tr=I[1],rr=new Arr(_byteLength(k,B,tr)),ir=0,lr=tr>0?B-4:B,dr;for(dr=0;dr<lr;dr+=4)e=revLookup[k.charCodeAt(dr)]<<18|revLookup[k.charCodeAt(dr+1)]<<12|revLookup[k.charCodeAt(dr+2)]<<6|revLookup[k.charCodeAt(dr+3)],rr[ir++]=e>>16&255,rr[ir++]=e>>8&255,rr[ir++]=e&255;return tr===2&&(e=revLookup[k.charCodeAt(dr)]<<2|revLookup[k.charCodeAt(dr+1)]>>4,rr[ir++]=e&255),tr===1&&(e=revLookup[k.charCodeAt(dr)]<<10|revLookup[k.charCodeAt(dr+1)]<<4|revLookup[k.charCodeAt(dr+2)]>>2,rr[ir++]=e>>8&255,rr[ir++]=e&255),rr}function tripletToBase64(k){return lookup[k>>18&63]+lookup[k>>12&63]+lookup[k>>6&63]+lookup[k&63]}function encodeChunk(k,e,I){for(var B,tr=[],rr=e;rr<I;rr+=3)B=(k[rr]<<16&16711680)+(k[rr+1]<<8&65280)+(k[rr+2]&255),tr.push(tripletToBase64(B));return tr.join("")}function fromByteArray(k){for(var e,I=k.length,B=I%3,tr=[],rr=16383,ir=0,lr=I-B;ir<lr;ir+=rr)tr.push(encodeChunk(k,ir,ir+rr>lr?lr:ir+rr));return B===1?(e=k[I-1],tr.push(lookup[e>>2]+lookup[e<<4&63]+"==")):B===2&&(e=(k[I-2]<<8)+k[I-1],tr.push(lookup[e>>10]+lookup[e>>4&63]+lookup[e<<2&63]+"=")),tr.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(k,e,I,B,tr){var rr,ir,lr=tr*8-B-1,dr=(1<<lr)-1,mr=dr>>1,hr=-7,fr=I?tr-1:0,_r=I?-1:1,gr=k[e+fr];for(fr+=_r,rr=gr&(1<<-hr)-1,gr>>=-hr,hr+=lr;hr>0;rr=rr*256+k[e+fr],fr+=_r,hr-=8);for(ir=rr&(1<<-hr)-1,rr>>=-hr,hr+=B;hr>0;ir=ir*256+k[e+fr],fr+=_r,hr-=8);if(rr===0)rr=1-mr;else{if(rr===dr)return ir?NaN:(gr?-1:1)*(1/0);ir=ir+Math.pow(2,B),rr=rr-mr}return(gr?-1:1)*ir*Math.pow(2,rr-B)};ieee754.write=function(k,e,I,B,tr,rr){var ir,lr,dr,mr=rr*8-tr-1,hr=(1<<mr)-1,fr=hr>>1,_r=tr===23?Math.pow(2,-24)-Math.pow(2,-77):0,gr=B?0:rr-1,Sr=B?1:-1,Ar=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(lr=isNaN(e)?1:0,ir=hr):(ir=Math.floor(Math.log(e)/Math.LN2),e*(dr=Math.pow(2,-ir))<1&&(ir--,dr*=2),ir+fr>=1?e+=_r/dr:e+=_r*Math.pow(2,1-fr),e*dr>=2&&(ir++,dr/=2),ir+fr>=hr?(lr=0,ir=hr):ir+fr>=1?(lr=(e*dr-1)*Math.pow(2,tr),ir=ir+fr):(lr=e*Math.pow(2,fr-1)*Math.pow(2,tr),ir=0));tr>=8;k[I+gr]=lr&255,gr+=Sr,lr/=256,tr-=8);for(ir=ir<<tr|lr,mr+=tr;mr>0;k[I+gr]=ir&255,gr+=Sr,ir/=256,mr-=8);k[I+gr-Sr]|=Ar*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(k){const e=base64Js,I=ieee754,B=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;k.Buffer=hr,k.SlowBuffer=Gr,k.INSPECT_MAX_BYTES=50;const tr=2147483647;k.kMaxLength=tr;const{Uint8Array:rr,ArrayBuffer:ir,SharedArrayBuffer:lr}=globalThis;hr.TYPED_ARRAY_SUPPORT=dr(),!hr.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function dr(){try{const Ir=new rr(1),wr={foo:function(){return 42}};return Object.setPrototypeOf(wr,rr.prototype),Object.setPrototypeOf(Ir,wr),Ir.foo()===42}catch{return!1}}Object.defineProperty(hr.prototype,"parent",{enumerable:!0,get:function(){if(hr.isBuffer(this))return this.buffer}}),Object.defineProperty(hr.prototype,"offset",{enumerable:!0,get:function(){if(hr.isBuffer(this))return this.byteOffset}});function mr(Ir){if(Ir>tr)throw new RangeError('The value "'+Ir+'" is invalid for option "size"');const wr=new rr(Ir);return Object.setPrototypeOf(wr,hr.prototype),wr}function hr(Ir,wr,yr){if(typeof Ir=="number"){if(typeof wr=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Sr(Ir)}return fr(Ir,wr,yr)}hr.poolSize=8192;function fr(Ir,wr,yr){if(typeof Ir=="string")return Ar(Ir,wr);if(ir.isView(Ir))return Fr(Ir);if(Ir==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ir);if(Ks(Ir,ir)||Ir&&Ks(Ir.buffer,ir)||typeof lr<"u"&&(Ks(Ir,lr)||Ir&&Ks(Ir.buffer,lr)))return vr(Ir,wr,yr);if(typeof Ir=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Cr=Ir.valueOf&&Ir.valueOf();if(Cr!=null&&Cr!==Ir)return hr.from(Cr,wr,yr);const Dr=xr(Ir);if(Dr)return Dr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Ir[Symbol.toPrimitive]=="function")return hr.from(Ir[Symbol.toPrimitive]("string"),wr,yr);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ir)}hr.from=function(Ir,wr,yr){return fr(Ir,wr,yr)},Object.setPrototypeOf(hr.prototype,rr.prototype),Object.setPrototypeOf(hr,rr);function _r(Ir){if(typeof Ir!="number")throw new TypeError('"size" argument must be of type number');if(Ir<0)throw new RangeError('The value "'+Ir+'" is invalid for option "size"')}function gr(Ir,wr,yr){return _r(Ir),Ir<=0?mr(Ir):wr!==void 0?typeof yr=="string"?mr(Ir).fill(wr,yr):mr(Ir).fill(wr):mr(Ir)}hr.alloc=function(Ir,wr,yr){return gr(Ir,wr,yr)};function Sr(Ir){return _r(Ir),mr(Ir<0?0:kr(Ir)|0)}hr.allocUnsafe=function(Ir){return Sr(Ir)},hr.allocUnsafeSlow=function(Ir){return Sr(Ir)};function Ar(Ir,wr){if((typeof wr!="string"||wr==="")&&(wr="utf8"),!hr.isEncoding(wr))throw new TypeError("Unknown encoding: "+wr);const yr=is(Ir,wr)|0;let Cr=mr(yr);const Dr=Cr.write(Ir,wr);return Dr!==yr&&(Cr=Cr.slice(0,Dr)),Cr}function Or(Ir){const wr=Ir.length<0?0:kr(Ir.length)|0,yr=mr(wr);for(let Cr=0;Cr<wr;Cr+=1)yr[Cr]=Ir[Cr]&255;return yr}function Fr(Ir){if(Ks(Ir,rr)){const wr=new rr(Ir);return vr(wr.buffer,wr.byteOffset,wr.byteLength)}return Or(Ir)}function vr(Ir,wr,yr){if(wr<0||Ir.byteLength<wr)throw new RangeError('"offset" is outside of buffer bounds');if(Ir.byteLength<wr+(yr||0))throw new RangeError('"length" is outside of buffer bounds');let Cr;return wr===void 0&&yr===void 0?Cr=new rr(Ir):yr===void 0?Cr=new rr(Ir,wr):Cr=new rr(Ir,wr,yr),Object.setPrototypeOf(Cr,hr.prototype),Cr}function xr(Ir){if(hr.isBuffer(Ir)){const wr=kr(Ir.length)|0,yr=mr(wr);return yr.length===0||Ir.copy(yr,0,0,wr),yr}if(Ir.length!==void 0)return typeof Ir.length!="number"||oa(Ir.length)?mr(0):Or(Ir);if(Ir.type==="Buffer"&&Array.isArray(Ir.data))return Or(Ir.data)}function kr(Ir){if(Ir>=tr)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+tr.toString(16)+" bytes");return Ir|0}function Gr(Ir){return+Ir!=Ir&&(Ir=0),hr.alloc(+Ir)}hr.isBuffer=function(wr){return wr!=null&&wr._isBuffer===!0&&wr!==hr.prototype},hr.compare=function(wr,yr){if(Ks(wr,rr)&&(wr=hr.from(wr,wr.offset,wr.byteLength)),Ks(yr,rr)&&(yr=hr.from(yr,yr.offset,yr.byteLength)),!hr.isBuffer(wr)||!hr.isBuffer(yr))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(wr===yr)return 0;let Cr=wr.length,Dr=yr.length;for(let zr=0,Jr=Math.min(Cr,Dr);zr<Jr;++zr)if(wr[zr]!==yr[zr]){Cr=wr[zr],Dr=yr[zr];break}return Cr<Dr?-1:Dr<Cr?1:0},hr.isEncoding=function(wr){switch(String(wr).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},hr.concat=function(wr,yr){if(!Array.isArray(wr))throw new TypeError('"list" argument must be an Array of Buffers');if(wr.length===0)return hr.alloc(0);let Cr;if(yr===void 0)for(yr=0,Cr=0;Cr<wr.length;++Cr)yr+=wr[Cr].length;const Dr=hr.allocUnsafe(yr);let zr=0;for(Cr=0;Cr<wr.length;++Cr){let Jr=wr[Cr];if(Ks(Jr,rr))zr+Jr.length>Dr.length?(hr.isBuffer(Jr)||(Jr=hr.from(Jr)),Jr.copy(Dr,zr)):rr.prototype.set.call(Dr,Jr,zr);else if(hr.isBuffer(Jr))Jr.copy(Dr,zr);else throw new TypeError('"list" argument must be an Array of Buffers');zr+=Jr.length}return Dr};function is(Ir,wr){if(hr.isBuffer(Ir))return Ir.length;if(ir.isView(Ir)||Ks(Ir,ir))return Ir.byteLength;if(typeof Ir!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Ir);const yr=Ir.length,Cr=arguments.length>2&&arguments[2]===!0;if(!Cr&&yr===0)return 0;let Dr=!1;for(;;)switch(wr){case"ascii":case"latin1":case"binary":return yr;case"utf8":case"utf-8":return Zs(Ir).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yr*2;case"hex":return yr>>>1;case"base64":return Bs(Ir).length;default:if(Dr)return Cr?-1:Zs(Ir).length;wr=(""+wr).toLowerCase(),Dr=!0}}hr.byteLength=is;function as(Ir,wr,yr){let Cr=!1;if((wr===void 0||wr<0)&&(wr=0),wr>this.length||((yr===void 0||yr>this.length)&&(yr=this.length),yr<=0)||(yr>>>=0,wr>>>=0,yr<=wr))return"";for(Ir||(Ir="utf8");;)switch(Ir){case"hex":return vs(this,wr,yr);case"utf8":case"utf-8":return os(this,wr,yr);case"ascii":return bs(this,wr,yr);case"latin1":case"binary":return As(this,wr,yr);case"base64":return ls(this,wr,yr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gs(this,wr,yr);default:if(Cr)throw new TypeError("Unknown encoding: "+Ir);Ir=(Ir+"").toLowerCase(),Cr=!0}}hr.prototype._isBuffer=!0;function cs(Ir,wr,yr){const Cr=Ir[wr];Ir[wr]=Ir[yr],Ir[yr]=Cr}hr.prototype.swap16=function(){const wr=this.length;if(wr%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let yr=0;yr<wr;yr+=2)cs(this,yr,yr+1);return this},hr.prototype.swap32=function(){const wr=this.length;if(wr%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let yr=0;yr<wr;yr+=4)cs(this,yr,yr+3),cs(this,yr+1,yr+2);return this},hr.prototype.swap64=function(){const wr=this.length;if(wr%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let yr=0;yr<wr;yr+=8)cs(this,yr,yr+7),cs(this,yr+1,yr+6),cs(this,yr+2,yr+5),cs(this,yr+3,yr+4);return this},hr.prototype.toString=function(){const wr=this.length;return wr===0?"":arguments.length===0?os(this,0,wr):as.apply(this,arguments)},hr.prototype.toLocaleString=hr.prototype.toString,hr.prototype.equals=function(wr){if(!hr.isBuffer(wr))throw new TypeError("Argument must be a Buffer");return this===wr?!0:hr.compare(this,wr)===0},hr.prototype.inspect=function(){let wr="";const yr=k.INSPECT_MAX_BYTES;return wr=this.toString("hex",0,yr).replace(/(.{2})/g,"$1 ").trim(),this.length>yr&&(wr+=" ... "),"<Buffer "+wr+">"},B&&(hr.prototype[B]=hr.prototype.inspect),hr.prototype.compare=function(wr,yr,Cr,Dr,zr){if(Ks(wr,rr)&&(wr=hr.from(wr,wr.offset,wr.byteLength)),!hr.isBuffer(wr))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof wr);if(yr===void 0&&(yr=0),Cr===void 0&&(Cr=wr?wr.length:0),Dr===void 0&&(Dr=0),zr===void 0&&(zr=this.length),yr<0||Cr>wr.length||Dr<0||zr>this.length)throw new RangeError("out of range index");if(Dr>=zr&&yr>=Cr)return 0;if(Dr>=zr)return-1;if(yr>=Cr)return 1;if(yr>>>=0,Cr>>>=0,Dr>>>=0,zr>>>=0,this===wr)return 0;let Jr=zr-Dr,Ss=Cr-yr;const Ts=Math.min(Jr,Ss),Ms=this.slice(Dr,zr),_s=wr.slice(yr,Cr);for(let hs=0;hs<Ts;++hs)if(Ms[hs]!==_s[hs]){Jr=Ms[hs],Ss=_s[hs];break}return Jr<Ss?-1:Ss<Jr?1:0};function es(Ir,wr,yr,Cr,Dr){if(Ir.length===0)return-1;if(typeof yr=="string"?(Cr=yr,yr=0):yr>2147483647?yr=2147483647:yr<-2147483648&&(yr=-2147483648),yr=+yr,oa(yr)&&(yr=Dr?0:Ir.length-1),yr<0&&(yr=Ir.length+yr),yr>=Ir.length){if(Dr)return-1;yr=Ir.length-1}else if(yr<0)if(Dr)yr=0;else return-1;if(typeof wr=="string"&&(wr=hr.from(wr,Cr)),hr.isBuffer(wr))return wr.length===0?-1:ps(Ir,wr,yr,Cr,Dr);if(typeof wr=="number")return wr=wr&255,typeof rr.prototype.indexOf=="function"?Dr?rr.prototype.indexOf.call(Ir,wr,yr):rr.prototype.lastIndexOf.call(Ir,wr,yr):ps(Ir,[wr],yr,Cr,Dr);throw new TypeError("val must be string, number or Buffer")}function ps(Ir,wr,yr,Cr,Dr){let zr=1,Jr=Ir.length,Ss=wr.length;if(Cr!==void 0&&(Cr=String(Cr).toLowerCase(),Cr==="ucs2"||Cr==="ucs-2"||Cr==="utf16le"||Cr==="utf-16le")){if(Ir.length<2||wr.length<2)return-1;zr=2,Jr/=2,Ss/=2,yr/=2}function Ts(_s,hs){return zr===1?_s[hs]:_s.readUInt16BE(hs*zr)}let Ms;if(Dr){let _s=-1;for(Ms=yr;Ms<Jr;Ms++)if(Ts(Ir,Ms)===Ts(wr,_s===-1?0:Ms-_s)){if(_s===-1&&(_s=Ms),Ms-_s+1===Ss)return _s*zr}else _s!==-1&&(Ms-=Ms-_s),_s=-1}else for(yr+Ss>Jr&&(yr=Jr-Ss),Ms=yr;Ms>=0;Ms--){let _s=!0;for(let hs=0;hs<Ss;hs++)if(Ts(Ir,Ms+hs)!==Ts(wr,hs)){_s=!1;break}if(_s)return Ms}return-1}hr.prototype.includes=function(wr,yr,Cr){return this.indexOf(wr,yr,Cr)!==-1},hr.prototype.indexOf=function(wr,yr,Cr){return es(this,wr,yr,Cr,!0)},hr.prototype.lastIndexOf=function(wr,yr,Cr){return es(this,wr,yr,Cr,!1)};function Ur(Ir,wr,yr,Cr){yr=Number(yr)||0;const Dr=Ir.length-yr;Cr?(Cr=Number(Cr),Cr>Dr&&(Cr=Dr)):Cr=Dr;const zr=wr.length;Cr>zr/2&&(Cr=zr/2);let Jr;for(Jr=0;Jr<Cr;++Jr){const Ss=parseInt(wr.substr(Jr*2,2),16);if(oa(Ss))return Jr;Ir[yr+Jr]=Ss}return Jr}function Lr(Ir,wr,yr,Cr){return ea(Zs(wr,Ir.length-yr),Ir,yr,Cr)}function ts(Ir,wr,yr,Cr){return ea(Qs(wr),Ir,yr,Cr)}function rs(Ir,wr,yr,Cr){return ea(Bs(wr),Ir,yr,Cr)}function ss(Ir,wr,yr,Cr){return ea(Ps(wr,Ir.length-yr),Ir,yr,Cr)}hr.prototype.write=function(wr,yr,Cr,Dr){if(yr===void 0)Dr="utf8",Cr=this.length,yr=0;else if(Cr===void 0&&typeof yr=="string")Dr=yr,Cr=this.length,yr=0;else if(isFinite(yr))yr=yr>>>0,isFinite(Cr)?(Cr=Cr>>>0,Dr===void 0&&(Dr="utf8")):(Dr=Cr,Cr=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const zr=this.length-yr;if((Cr===void 0||Cr>zr)&&(Cr=zr),wr.length>0&&(Cr<0||yr<0)||yr>this.length)throw new RangeError("Attempt to write outside buffer bounds");Dr||(Dr="utf8");let Jr=!1;for(;;)switch(Dr){case"hex":return Ur(this,wr,yr,Cr);case"utf8":case"utf-8":return Lr(this,wr,yr,Cr);case"ascii":case"latin1":case"binary":return ts(this,wr,yr,Cr);case"base64":return rs(this,wr,yr,Cr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ss(this,wr,yr,Cr);default:if(Jr)throw new TypeError("Unknown encoding: "+Dr);Dr=(""+Dr).toLowerCase(),Jr=!0}},hr.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ls(Ir,wr,yr){return wr===0&&yr===Ir.length?e.fromByteArray(Ir):e.fromByteArray(Ir.slice(wr,yr))}function os(Ir,wr,yr){yr=Math.min(Ir.length,yr);const Cr=[];let Dr=wr;for(;Dr<yr;){const zr=Ir[Dr];let Jr=null,Ss=zr>239?4:zr>223?3:zr>191?2:1;if(Dr+Ss<=yr){let Ts,Ms,_s,hs;switch(Ss){case 1:zr<128&&(Jr=zr);break;case 2:Ts=Ir[Dr+1],(Ts&192)===128&&(hs=(zr&31)<<6|Ts&63,hs>127&&(Jr=hs));break;case 3:Ts=Ir[Dr+1],Ms=Ir[Dr+2],(Ts&192)===128&&(Ms&192)===128&&(hs=(zr&15)<<12|(Ts&63)<<6|Ms&63,hs>2047&&(hs<55296||hs>57343)&&(Jr=hs));break;case 4:Ts=Ir[Dr+1],Ms=Ir[Dr+2],_s=Ir[Dr+3],(Ts&192)===128&&(Ms&192)===128&&(_s&192)===128&&(hs=(zr&15)<<18|(Ts&63)<<12|(Ms&63)<<6|_s&63,hs>65535&&hs<1114112&&(Jr=hs))}}Jr===null?(Jr=65533,Ss=1):Jr>65535&&(Jr-=65536,Cr.push(Jr>>>10&1023|55296),Jr=56320|Jr&1023),Cr.push(Jr),Dr+=Ss}return ys(Cr)}const us=4096;function ys(Ir){const wr=Ir.length;if(wr<=us)return String.fromCharCode.apply(String,Ir);let yr="",Cr=0;for(;Cr<wr;)yr+=String.fromCharCode.apply(String,Ir.slice(Cr,Cr+=us));return yr}function bs(Ir,wr,yr){let Cr="";yr=Math.min(Ir.length,yr);for(let Dr=wr;Dr<yr;++Dr)Cr+=String.fromCharCode(Ir[Dr]&127);return Cr}function As(Ir,wr,yr){let Cr="";yr=Math.min(Ir.length,yr);for(let Dr=wr;Dr<yr;++Dr)Cr+=String.fromCharCode(Ir[Dr]);return Cr}function vs(Ir,wr,yr){const Cr=Ir.length;(!wr||wr<0)&&(wr=0),(!yr||yr<0||yr>Cr)&&(yr=Cr);let Dr="";for(let zr=wr;zr<yr;++zr)Dr+=ta[Ir[zr]];return Dr}function gs(Ir,wr,yr){const Cr=Ir.slice(wr,yr);let Dr="";for(let zr=0;zr<Cr.length-1;zr+=2)Dr+=String.fromCharCode(Cr[zr]+Cr[zr+1]*256);return Dr}hr.prototype.slice=function(wr,yr){const Cr=this.length;wr=~~wr,yr=yr===void 0?Cr:~~yr,wr<0?(wr+=Cr,wr<0&&(wr=0)):wr>Cr&&(wr=Cr),yr<0?(yr+=Cr,yr<0&&(yr=0)):yr>Cr&&(yr=Cr),yr<wr&&(yr=wr);const Dr=this.subarray(wr,yr);return Object.setPrototypeOf(Dr,hr.prototype),Dr};function xs(Ir,wr,yr){if(Ir%1!==0||Ir<0)throw new RangeError("offset is not uint");if(Ir+wr>yr)throw new RangeError("Trying to access beyond buffer length")}hr.prototype.readUintLE=hr.prototype.readUIntLE=function(wr,yr,Cr){wr=wr>>>0,yr=yr>>>0,Cr||xs(wr,yr,this.length);let Dr=this[wr],zr=1,Jr=0;for(;++Jr<yr&&(zr*=256);)Dr+=this[wr+Jr]*zr;return Dr},hr.prototype.readUintBE=hr.prototype.readUIntBE=function(wr,yr,Cr){wr=wr>>>0,yr=yr>>>0,Cr||xs(wr,yr,this.length);let Dr=this[wr+--yr],zr=1;for(;yr>0&&(zr*=256);)Dr+=this[wr+--yr]*zr;return Dr},hr.prototype.readUint8=hr.prototype.readUInt8=function(wr,yr){return wr=wr>>>0,yr||xs(wr,1,this.length),this[wr]},hr.prototype.readUint16LE=hr.prototype.readUInt16LE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,2,this.length),this[wr]|this[wr+1]<<8},hr.prototype.readUint16BE=hr.prototype.readUInt16BE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,2,this.length),this[wr]<<8|this[wr+1]},hr.prototype.readUint32LE=hr.prototype.readUInt32LE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,4,this.length),(this[wr]|this[wr+1]<<8|this[wr+2]<<16)+this[wr+3]*16777216},hr.prototype.readUint32BE=hr.prototype.readUInt32BE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,4,this.length),this[wr]*16777216+(this[wr+1]<<16|this[wr+2]<<8|this[wr+3])},hr.prototype.readBigUInt64LE=Xs(function(wr){wr=wr>>>0,Ws(wr,"offset");const yr=this[wr],Cr=this[wr+7];(yr===void 0||Cr===void 0)&&Ys(wr,this.length-8);const Dr=yr+this[++wr]*2**8+this[++wr]*2**16+this[++wr]*2**24,zr=this[++wr]+this[++wr]*2**8+this[++wr]*2**16+Cr*2**24;return BigInt(Dr)+(BigInt(zr)<<BigInt(32))}),hr.prototype.readBigUInt64BE=Xs(function(wr){wr=wr>>>0,Ws(wr,"offset");const yr=this[wr],Cr=this[wr+7];(yr===void 0||Cr===void 0)&&Ys(wr,this.length-8);const Dr=yr*2**24+this[++wr]*2**16+this[++wr]*2**8+this[++wr],zr=this[++wr]*2**24+this[++wr]*2**16+this[++wr]*2**8+Cr;return(BigInt(Dr)<<BigInt(32))+BigInt(zr)}),hr.prototype.readIntLE=function(wr,yr,Cr){wr=wr>>>0,yr=yr>>>0,Cr||xs(wr,yr,this.length);let Dr=this[wr],zr=1,Jr=0;for(;++Jr<yr&&(zr*=256);)Dr+=this[wr+Jr]*zr;return zr*=128,Dr>=zr&&(Dr-=Math.pow(2,8*yr)),Dr},hr.prototype.readIntBE=function(wr,yr,Cr){wr=wr>>>0,yr=yr>>>0,Cr||xs(wr,yr,this.length);let Dr=yr,zr=1,Jr=this[wr+--Dr];for(;Dr>0&&(zr*=256);)Jr+=this[wr+--Dr]*zr;return zr*=128,Jr>=zr&&(Jr-=Math.pow(2,8*yr)),Jr},hr.prototype.readInt8=function(wr,yr){return wr=wr>>>0,yr||xs(wr,1,this.length),this[wr]&128?(255-this[wr]+1)*-1:this[wr]},hr.prototype.readInt16LE=function(wr,yr){wr=wr>>>0,yr||xs(wr,2,this.length);const Cr=this[wr]|this[wr+1]<<8;return Cr&32768?Cr|4294901760:Cr},hr.prototype.readInt16BE=function(wr,yr){wr=wr>>>0,yr||xs(wr,2,this.length);const Cr=this[wr+1]|this[wr]<<8;return Cr&32768?Cr|4294901760:Cr},hr.prototype.readInt32LE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,4,this.length),this[wr]|this[wr+1]<<8|this[wr+2]<<16|this[wr+3]<<24},hr.prototype.readInt32BE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,4,this.length),this[wr]<<24|this[wr+1]<<16|this[wr+2]<<8|this[wr+3]},hr.prototype.readBigInt64LE=Xs(function(wr){wr=wr>>>0,Ws(wr,"offset");const yr=this[wr],Cr=this[wr+7];(yr===void 0||Cr===void 0)&&Ys(wr,this.length-8);const Dr=this[wr+4]+this[wr+5]*2**8+this[wr+6]*2**16+(Cr<<24);return(BigInt(Dr)<<BigInt(32))+BigInt(yr+this[++wr]*2**8+this[++wr]*2**16+this[++wr]*2**24)}),hr.prototype.readBigInt64BE=Xs(function(wr){wr=wr>>>0,Ws(wr,"offset");const yr=this[wr],Cr=this[wr+7];(yr===void 0||Cr===void 0)&&Ys(wr,this.length-8);const Dr=(yr<<24)+this[++wr]*2**16+this[++wr]*2**8+this[++wr];return(BigInt(Dr)<<BigInt(32))+BigInt(this[++wr]*2**24+this[++wr]*2**16+this[++wr]*2**8+Cr)}),hr.prototype.readFloatLE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,4,this.length),I.read(this,wr,!0,23,4)},hr.prototype.readFloatBE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,4,this.length),I.read(this,wr,!1,23,4)},hr.prototype.readDoubleLE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,8,this.length),I.read(this,wr,!0,52,8)},hr.prototype.readDoubleBE=function(wr,yr){return wr=wr>>>0,yr||xs(wr,8,this.length),I.read(this,wr,!1,52,8)};function Is(Ir,wr,yr,Cr,Dr,zr){if(!hr.isBuffer(Ir))throw new TypeError('"buffer" argument must be a Buffer instance');if(wr>Dr||wr<zr)throw new RangeError('"value" argument is out of bounds');if(yr+Cr>Ir.length)throw new RangeError("Index out of range")}hr.prototype.writeUintLE=hr.prototype.writeUIntLE=function(wr,yr,Cr,Dr){if(wr=+wr,yr=yr>>>0,Cr=Cr>>>0,!Dr){const Ss=Math.pow(2,8*Cr)-1;Is(this,wr,yr,Cr,Ss,0)}let zr=1,Jr=0;for(this[yr]=wr&255;++Jr<Cr&&(zr*=256);)this[yr+Jr]=wr/zr&255;return yr+Cr},hr.prototype.writeUintBE=hr.prototype.writeUIntBE=function(wr,yr,Cr,Dr){if(wr=+wr,yr=yr>>>0,Cr=Cr>>>0,!Dr){const Ss=Math.pow(2,8*Cr)-1;Is(this,wr,yr,Cr,Ss,0)}let zr=Cr-1,Jr=1;for(this[yr+zr]=wr&255;--zr>=0&&(Jr*=256);)this[yr+zr]=wr/Jr&255;return yr+Cr},hr.prototype.writeUint8=hr.prototype.writeUInt8=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,1,255,0),this[yr]=wr&255,yr+1},hr.prototype.writeUint16LE=hr.prototype.writeUInt16LE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,2,65535,0),this[yr]=wr&255,this[yr+1]=wr>>>8,yr+2},hr.prototype.writeUint16BE=hr.prototype.writeUInt16BE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,2,65535,0),this[yr]=wr>>>8,this[yr+1]=wr&255,yr+2},hr.prototype.writeUint32LE=hr.prototype.writeUInt32LE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,4,4294967295,0),this[yr+3]=wr>>>24,this[yr+2]=wr>>>16,this[yr+1]=wr>>>8,this[yr]=wr&255,yr+4},hr.prototype.writeUint32BE=hr.prototype.writeUInt32BE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,4,4294967295,0),this[yr]=wr>>>24,this[yr+1]=wr>>>16,this[yr+2]=wr>>>8,this[yr+3]=wr&255,yr+4};function Ns(Ir,wr,yr,Cr,Dr){aa(wr,Cr,Dr,Ir,yr,7);let zr=Number(wr&BigInt(4294967295));Ir[yr++]=zr,zr=zr>>8,Ir[yr++]=zr,zr=zr>>8,Ir[yr++]=zr,zr=zr>>8,Ir[yr++]=zr;let Jr=Number(wr>>BigInt(32)&BigInt(4294967295));return Ir[yr++]=Jr,Jr=Jr>>8,Ir[yr++]=Jr,Jr=Jr>>8,Ir[yr++]=Jr,Jr=Jr>>8,Ir[yr++]=Jr,yr}function Vs(Ir,wr,yr,Cr,Dr){aa(wr,Cr,Dr,Ir,yr,7);let zr=Number(wr&BigInt(4294967295));Ir[yr+7]=zr,zr=zr>>8,Ir[yr+6]=zr,zr=zr>>8,Ir[yr+5]=zr,zr=zr>>8,Ir[yr+4]=zr;let Jr=Number(wr>>BigInt(32)&BigInt(4294967295));return Ir[yr+3]=Jr,Jr=Jr>>8,Ir[yr+2]=Jr,Jr=Jr>>8,Ir[yr+1]=Jr,Jr=Jr>>8,Ir[yr]=Jr,yr+8}hr.prototype.writeBigUInt64LE=Xs(function(wr,yr=0){return Ns(this,wr,yr,BigInt(0),BigInt("0xffffffffffffffff"))}),hr.prototype.writeBigUInt64BE=Xs(function(wr,yr=0){return Vs(this,wr,yr,BigInt(0),BigInt("0xffffffffffffffff"))}),hr.prototype.writeIntLE=function(wr,yr,Cr,Dr){if(wr=+wr,yr=yr>>>0,!Dr){const Ts=Math.pow(2,8*Cr-1);Is(this,wr,yr,Cr,Ts-1,-Ts)}let zr=0,Jr=1,Ss=0;for(this[yr]=wr&255;++zr<Cr&&(Jr*=256);)wr<0&&Ss===0&&this[yr+zr-1]!==0&&(Ss=1),this[yr+zr]=(wr/Jr>>0)-Ss&255;return yr+Cr},hr.prototype.writeIntBE=function(wr,yr,Cr,Dr){if(wr=+wr,yr=yr>>>0,!Dr){const Ts=Math.pow(2,8*Cr-1);Is(this,wr,yr,Cr,Ts-1,-Ts)}let zr=Cr-1,Jr=1,Ss=0;for(this[yr+zr]=wr&255;--zr>=0&&(Jr*=256);)wr<0&&Ss===0&&this[yr+zr+1]!==0&&(Ss=1),this[yr+zr]=(wr/Jr>>0)-Ss&255;return yr+Cr},hr.prototype.writeInt8=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,1,127,-128),wr<0&&(wr=255+wr+1),this[yr]=wr&255,yr+1},hr.prototype.writeInt16LE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,2,32767,-32768),this[yr]=wr&255,this[yr+1]=wr>>>8,yr+2},hr.prototype.writeInt16BE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,2,32767,-32768),this[yr]=wr>>>8,this[yr+1]=wr&255,yr+2},hr.prototype.writeInt32LE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,4,2147483647,-2147483648),this[yr]=wr&255,this[yr+1]=wr>>>8,this[yr+2]=wr>>>16,this[yr+3]=wr>>>24,yr+4},hr.prototype.writeInt32BE=function(wr,yr,Cr){return wr=+wr,yr=yr>>>0,Cr||Is(this,wr,yr,4,2147483647,-2147483648),wr<0&&(wr=4294967295+wr+1),this[yr]=wr>>>24,this[yr+1]=wr>>>16,this[yr+2]=wr>>>8,this[yr+3]=wr&255,yr+4},hr.prototype.writeBigInt64LE=Xs(function(wr,yr=0){return Ns(this,wr,yr,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),hr.prototype.writeBigInt64BE=Xs(function(wr,yr=0){return Vs(this,wr,yr,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ls(Ir,wr,yr,Cr,Dr,zr){if(yr+Cr>Ir.length)throw new RangeError("Index out of range");if(yr<0)throw new RangeError("Index out of range")}function ks(Ir,wr,yr,Cr,Dr){return wr=+wr,yr=yr>>>0,Dr||Ls(Ir,wr,yr,4),I.write(Ir,wr,yr,Cr,23,4),yr+4}hr.prototype.writeFloatLE=function(wr,yr,Cr){return ks(this,wr,yr,!0,Cr)},hr.prototype.writeFloatBE=function(wr,yr,Cr){return ks(this,wr,yr,!1,Cr)};function Fs(Ir,wr,yr,Cr,Dr){return wr=+wr,yr=yr>>>0,Dr||Ls(Ir,wr,yr,8),I.write(Ir,wr,yr,Cr,52,8),yr+8}hr.prototype.writeDoubleLE=function(wr,yr,Cr){return Fs(this,wr,yr,!0,Cr)},hr.prototype.writeDoubleBE=function(wr,yr,Cr){return Fs(this,wr,yr,!1,Cr)},hr.prototype.copy=function(wr,yr,Cr,Dr){if(!hr.isBuffer(wr))throw new TypeError("argument should be a Buffer");if(Cr||(Cr=0),!Dr&&Dr!==0&&(Dr=this.length),yr>=wr.length&&(yr=wr.length),yr||(yr=0),Dr>0&&Dr<Cr&&(Dr=Cr),Dr===Cr||wr.length===0||this.length===0)return 0;if(yr<0)throw new RangeError("targetStart out of bounds");if(Cr<0||Cr>=this.length)throw new RangeError("Index out of range");if(Dr<0)throw new RangeError("sourceEnd out of bounds");Dr>this.length&&(Dr=this.length),wr.length-yr<Dr-Cr&&(Dr=wr.length-yr+Cr);const zr=Dr-Cr;return this===wr&&typeof rr.prototype.copyWithin=="function"?this.copyWithin(yr,Cr,Dr):rr.prototype.set.call(wr,this.subarray(Cr,Dr),yr),zr},hr.prototype.fill=function(wr,yr,Cr,Dr){if(typeof wr=="string"){if(typeof yr=="string"?(Dr=yr,yr=0,Cr=this.length):typeof Cr=="string"&&(Dr=Cr,Cr=this.length),Dr!==void 0&&typeof Dr!="string")throw new TypeError("encoding must be a string");if(typeof Dr=="string"&&!hr.isEncoding(Dr))throw new TypeError("Unknown encoding: "+Dr);if(wr.length===1){const Jr=wr.charCodeAt(0);(Dr==="utf8"&&Jr<128||Dr==="latin1")&&(wr=Jr)}}else typeof wr=="number"?wr=wr&255:typeof wr=="boolean"&&(wr=Number(wr));if(yr<0||this.length<yr||this.length<Cr)throw new RangeError("Out of range index");if(Cr<=yr)return this;yr=yr>>>0,Cr=Cr===void 0?this.length:Cr>>>0,wr||(wr=0);let zr;if(typeof wr=="number")for(zr=yr;zr<Cr;++zr)this[zr]=wr;else{const Jr=hr.isBuffer(wr)?wr:hr.from(wr,Dr),Ss=Jr.length;if(Ss===0)throw new TypeError('The value "'+wr+'" is invalid for argument "value"');for(zr=0;zr<Cr-yr;++zr)this[zr+yr]=Jr[zr%Ss]}return this};const Os={};function Hs(Ir,wr,yr){Os[Ir]=class extends yr{constructor(){super(),Object.defineProperty(this,"message",{value:wr.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Ir}]`,this.stack,delete this.name}get code(){return Ir}set code(Dr){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Dr,writable:!0})}toString(){return`${this.name} [${Ir}]: ${this.message}`}}}Hs("ERR_BUFFER_OUT_OF_BOUNDS",function(Ir){return Ir?`${Ir} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Hs("ERR_INVALID_ARG_TYPE",function(Ir,wr){return`The "${Ir}" argument must be of type number. Received type ${typeof wr}`},TypeError),Hs("ERR_OUT_OF_RANGE",function(Ir,wr,yr){let Cr=`The value of "${Ir}" is out of range.`,Dr=yr;return Number.isInteger(yr)&&Math.abs(yr)>2**32?Dr=Gs(String(yr)):typeof yr=="bigint"&&(Dr=String(yr),(yr>BigInt(2)**BigInt(32)||yr<-(BigInt(2)**BigInt(32)))&&(Dr=Gs(Dr)),Dr+="n"),Cr+=` It must be ${wr}. Received ${Dr}`,Cr},RangeError);function Gs(Ir){let wr="",yr=Ir.length;const Cr=Ir[0]==="-"?1:0;for(;yr>=Cr+4;yr-=3)wr=`_${Ir.slice(yr-3,yr)}${wr}`;return`${Ir.slice(0,yr)}${wr}`}function sa(Ir,wr,yr){Ws(wr,"offset"),(Ir[wr]===void 0||Ir[wr+yr]===void 0)&&Ys(wr,Ir.length-(yr+1))}function aa(Ir,wr,yr,Cr,Dr,zr){if(Ir>yr||Ir<wr){const Jr=typeof wr=="bigint"?"n":"";let Ss;throw wr===0||wr===BigInt(0)?Ss=`>= 0${Jr} and < 2${Jr} ** ${(zr+1)*8}${Jr}`:Ss=`>= -(2${Jr} ** ${(zr+1)*8-1}${Jr}) and < 2 ** ${(zr+1)*8-1}${Jr}`,new Os.ERR_OUT_OF_RANGE("value",Ss,Ir)}sa(Cr,Dr,zr)}function Ws(Ir,wr){if(typeof Ir!="number")throw new Os.ERR_INVALID_ARG_TYPE(wr,"number",Ir)}function Ys(Ir,wr,yr){throw Math.floor(Ir)!==Ir?(Ws(Ir,yr),new Os.ERR_OUT_OF_RANGE("offset","an integer",Ir)):wr<0?new Os.ERR_BUFFER_OUT_OF_BOUNDS:new Os.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${wr}`,Ir)}const na=/[^+/0-9A-Za-z-_]/g;function ia(Ir){if(Ir=Ir.split("=")[0],Ir=Ir.trim().replace(na,""),Ir.length<2)return"";for(;Ir.length%4!==0;)Ir=Ir+"=";return Ir}function Zs(Ir,wr){wr=wr||1/0;let yr;const Cr=Ir.length;let Dr=null;const zr=[];for(let Jr=0;Jr<Cr;++Jr){if(yr=Ir.charCodeAt(Jr),yr>55295&&yr<57344){if(!Dr){if(yr>56319){(wr-=3)>-1&&zr.push(239,191,189);continue}else if(Jr+1===Cr){(wr-=3)>-1&&zr.push(239,191,189);continue}Dr=yr;continue}if(yr<56320){(wr-=3)>-1&&zr.push(239,191,189),Dr=yr;continue}yr=(Dr-55296<<10|yr-56320)+65536}else Dr&&(wr-=3)>-1&&zr.push(239,191,189);if(Dr=null,yr<128){if((wr-=1)<0)break;zr.push(yr)}else if(yr<2048){if((wr-=2)<0)break;zr.push(yr>>6|192,yr&63|128)}else if(yr<65536){if((wr-=3)<0)break;zr.push(yr>>12|224,yr>>6&63|128,yr&63|128)}else if(yr<1114112){if((wr-=4)<0)break;zr.push(yr>>18|240,yr>>12&63|128,yr>>6&63|128,yr&63|128)}else throw new Error("Invalid code point")}return zr}function Qs(Ir){const wr=[];for(let yr=0;yr<Ir.length;++yr)wr.push(Ir.charCodeAt(yr)&255);return wr}function Ps(Ir,wr){let yr,Cr,Dr;const zr=[];for(let Jr=0;Jr<Ir.length&&!((wr-=2)<0);++Jr)yr=Ir.charCodeAt(Jr),Cr=yr>>8,Dr=yr%256,zr.push(Dr),zr.push(Cr);return zr}function Bs(Ir){return e.toByteArray(ia(Ir))}function ea(Ir,wr,yr,Cr){let Dr;for(Dr=0;Dr<Cr&&!(Dr+yr>=wr.length||Dr>=Ir.length);++Dr)wr[Dr+yr]=Ir[Dr];return Dr}function Ks(Ir,wr){return Ir instanceof wr||Ir!=null&&Ir.constructor!=null&&Ir.constructor.name!=null&&Ir.constructor.name===wr.name}function oa(Ir){return Ir!==Ir}const ta=function(){const Ir="0123456789abcdef",wr=new Array(256);for(let yr=0;yr<16;++yr){const Cr=yr*16;for(let Dr=0;Dr<16;++Dr)wr[Cr+Dr]=Ir[yr]+Ir[Dr]}return wr}();function Xs(Ir){return typeof BigInt>"u"?ra:Ir}function ra(){throw new Error("BigInt not supported")}})(buffer);const Buffer=buffer.Buffer,Buffer$1=buffer.Buffer;class PlatformTools{static getGlobalVariable(){return typeof window<"u"?window:global$1}static load(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: require("${e}").`);return""}static pathNormalize(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.normalize("${e}").`);return""}static pathExtname(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.extname("${e}").`);return""}static pathResolve(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.resolve("${e}").`);return""}static fileExist(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.existsSync("${e}").`);return!1}static dotenv(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "${e}" }).`)}static getEnvVariable(e){}static readFileSync(e){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("${e}").`);return null}static appendFileSync(e,I){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("${e}").`)}static writeFile(e,I){if(this.type==="browser")throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.writeFile("${e}").`);return Promise.reject(null)}static highlightSql(e){return e}static highlightJson(e){return e}static logInfo(e,I){console.info(e+" ",I)}static logError(e,I){console.error(e+" ",I)}static logWarn(e,I){console.warn(e+" ",I)}static log(e){console.log(e)}static warn(e){return e}}PlatformTools.type="browser";typeof window<"u"&&(window.Buffer=Buffer$1);typeof global$1<"u"&&typeof require<"u"&&(global$1.Buffer=require("buffer/").Buffer);class ObjectUtils{static isObject(e){return e!==null&&typeof e=="object"}static isObjectWithName(e){return e!==null&&typeof e=="object"&&e.name!==void 0}static assign(e,...I){for(const B of I)for(const tr of Object.getOwnPropertyNames(B))e[tr]=B[tr]}static mixedListToArray(e){return e!==null&&typeof e=="object"?Object.keys(e).map(I=>e[I]):e}}class TypeORMError extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}class SubjectWithoutIdentifierError extends TypeORMError{constructor(e){super(`Internal error. Subject ${e.metadata.targetName} must have an identifier to perform operation.`)}}class CannotConnectAlreadyConnectedError extends TypeORMError{constructor(e){super(`Cannot create a "${e}" connection because connection to the database already established.`)}}class LockNotSupportedOnGivenDriverError extends TypeORMError{constructor(){super("Locking not supported on given driver.")}}class ConnectionIsNotSetError extends TypeORMError{constructor(e){super(`Connection with ${e} database is not established. Check connection configuration.`)}}class CannotCreateEntityIdMapError extends TypeORMError{constructor(e,I){super();const B=e.primaryColumns.reduce((tr,rr,ir)=>(rr.setEntityValue(tr,ir+1),tr),{});this.message=`Cannot use given entity id "${I}" because "${e.targetName}" contains multiple primary columns, you must provide object in following form: ${JSON.stringify(B)} as an id.`}}class CannotDetermineEntityError extends TypeORMError{constructor(e){super(`Cannot ${e}, given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.`)}}class UpdateValuesMissingError extends TypeORMError{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}class TreeRepositoryNotSupportedError extends TypeORMError{constructor(e){super(`Tree repositories are not supported in ${e.options.type} driver.`)}}class CustomRepositoryNotFoundError extends TypeORMError{constructor(e){super(`Custom repository ${typeof e=="function"?e.name:e.constructor.name} was not found. Did you forgot to put @EntityRepository decorator on it?`)}}class TransactionNotStartedError extends TypeORMError{constructor(){super("Transaction is not started yet, start transaction before committing or rolling it back.")}}class TransactionAlreadyStartedError extends TypeORMError{constructor(){super("Transaction already started for the given connection, commit current transaction before starting a new one.")}}class InstanceChecker{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return typeof e=="function"&&typeof e.hasId=="function"&&typeof e.save=="function"&&typeof e.useDataSource=="function"}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,I){return typeof e=="object"&&e!==null&&e["@instanceof"]===Symbol.for(I)}}class EntityNotFoundError extends TypeORMError{constructor(e,I){super(),this.entityClass=e,this.criteria=I,this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(I)}`}stringifyTarget(e){return InstanceChecker.isEntitySchema(e)?e.options.name:typeof e=="function"||ObjectUtils.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch{}return""+e}}class EntityMetadataNotFoundError extends TypeORMError{constructor(e){super(),this.message=`No metadata for "${this.stringifyTarget(e)}" was found.`}stringifyTarget(e){return InstanceChecker.isEntitySchema(e)?e.options.name:typeof e=="function"||ObjectUtils.isObject(e)&&"name"in e?e.name:e}}class MustBeEntityError extends TypeORMError{constructor(e,I){super(`Cannot ${e}, given value must be an entity, instead "${I}" is given.`)}}class OptimisticLockVersionMismatchError extends TypeORMError{constructor(e,I,B){super(`The optimistic lock on entity ${e} failed, version ${I} was expected, but is actually ${B}.`)}}class LimitOnUpdateNotSupportedError extends TypeORMError{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}class CustomRepositoryCannotInheritRepositoryError extends TypeORMError{constructor(e){super(`Custom entity repository ${typeof e=="function"?e.name:e.constructor.name}  cannot inherit Repository class without entity being set in the @EntityRepository decorator.`)}}class QueryRunnerProviderAlreadyReleasedError extends TypeORMError{constructor(){super("Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.")}}class CannotAttachTreeChildrenEntityError extends TypeORMError{constructor(e){super(`Cannot attach entity "${e}" to its parent. Please make sure parent is saved in the database before saving children nodes.`)}}class CustomRepositoryDoesNotHaveEntityError extends TypeORMError{constructor(e){super(`Custom repository ${typeof e=="function"?e.name:e.constructor.name} does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? `)}}class MissingDeleteDateColumnError extends TypeORMError{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}class CircularRelationsError extends TypeORMError{constructor(e){super(`Circular relations detected: ${e}. To resolve this issue you need to set nullable: true somewhere in this dependency structure.`)}}class ReturningStatementNotSupportedError extends TypeORMError{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}class MissingPrimaryColumnError extends TypeORMError{constructor(e){super(`Entity "${e.name}" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.`)}}class EntityPropertyNotFoundError extends TypeORMError{constructor(e,I){super(e),Object.setPrototypeOf(this,EntityPropertyNotFoundError.prototype),this.message=`Property "${e}" was not found in "${I.targetName}". Make sure your query is correct.`}}class MissingDriverError extends TypeORMError{constructor(e,I=[]){super(`Wrong driver: "${e}" given. Supported drivers are: ${I.map(B=>`"${B}"`).join(", ")}.`)}}class DriverPackageNotInstalledError extends TypeORMError{constructor(e,I){super(`${e} package has not been found installed. Try to install it: npm install ${I} --save`)}}class NoVersionOrUpdateDateColumnError extends TypeORMError{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}class InsertValuesMissingError extends TypeORMError{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}class OptimisticLockCanNotBeUsedError extends TypeORMError{constructor(){super("The optimistic lock can be used only with getOne() method.")}}class DriverOptionNotSetError extends TypeORMError{constructor(e){super(`Driver option (${e}) is not set. Please set it to perform connection to the database.`)}}class FindRelationsNotFoundError extends TypeORMError{constructor(e){super(),e.length===1?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map(I=>`"${I}"`).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}class PessimisticLockTransactionRequiredError extends TypeORMError{constructor(){super("An open transaction is required for pessimistic lock.")}}class DataTypeNotSupportedError extends TypeORMError{constructor(e,I,B){super();const tr=typeof I=="string"?I:I.name;this.message=`Data type "${tr}" in "${e.entityMetadata.targetName}.${e.propertyName}" is not supported by "${B}" database.`}}class InitializedRelationError extends TypeORMError{constructor(e){super(`Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "${e.entityMetadata.targetName}#${e.propertyPath}". This is ORM requirement to make relations to work properly. Refer docs for more information.`)}}class QueryFailedError extends TypeORMError{constructor(e,I,B){if(super(B.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,"")),this.query=e,this.parameters=I,this.driverError=B,B){const{name:tr,...rr}=B;ObjectUtils.assign(this,{...rr})}}}class NoNeedToReleaseEntityManagerError extends TypeORMError{constructor(){super("Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.")}}class SubjectRemovedAndUpdatedError extends TypeORMError{constructor(e){super(`Removed entity "${e.metadata.name}" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).`)}}class ColumnTypeUndefinedError extends TypeORMError{constructor(e,I){super(`Column type for ${e.constructor.name}#${I} is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.`)}}class QueryRunnerAlreadyReleasedError extends TypeORMError{constructor(){super("Query runner already released. Cannot run queries anymore.")}}class OffsetWithoutLimitNotSupportedError extends TypeORMError{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}class CannotExecuteNotConnectedError extends TypeORMError{constructor(e){super(`Cannot execute operation on "${e}" connection because connection is not yet established.`)}}class NoConnectionOptionError extends TypeORMError{constructor(e){super(`Option "${e}" is not set in your connection options, please define "${e}" option in your connection options or ormconfig.json`)}}class ForbiddenTransactionModeOverrideError extends TypeORMError{constructor(e){const I=e.map(B=>`"${B.name}"`);super(`Migrations ${I.join(", ")} override the transaction mode, but the global transaction mode is "all"`)}}class Alias{constructor(e){ObjectUtils.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new TypeORMError(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}class QueryBuilderUtils{static isAliasProperty(e){if(typeof e!="string"||e.indexOf(".")===-1)return!1;const[I,B]=e.split(".");return!(!I||!B||e.indexOf("(")!==-1||e.indexOf(")")!==-1)}}var sha_js={exports:{}},inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(e,I){I&&(e.super_=I,e.prototype=Object.create(I.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,I){if(I){e.super_=I;var B=function(){};B.prototype=I.prototype,e.prototype=new B,e.prototype.constructor=e}}),inherits_browser.exports}var safeBuffer={exports:{}},dist={},hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,function(k){Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},I={};I.byteLength=hr,I.toByteArray=_r,I.fromByteArray=Ar;for(var B=[],tr=[],rr=typeof Uint8Array<"u"?Uint8Array:Array,ir="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lr=0,dr=ir.length;lr<dr;++lr)B[lr]=ir[lr],tr[ir.charCodeAt(lr)]=lr;tr[45]=62,tr[95]=63;function mr(vr){var xr=vr.length;if(xr%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var kr=vr.indexOf("=");kr===-1&&(kr=xr);var Gr=kr===xr?0:4-kr%4;return[kr,Gr]}function hr(vr){var xr=mr(vr),kr=xr[0],Gr=xr[1];return(kr+Gr)*3/4-Gr}function fr(vr,xr,kr){return(xr+kr)*3/4-kr}function _r(vr){var xr,kr=mr(vr),Gr=kr[0],is=kr[1],as=new rr(fr(vr,Gr,is)),cs=0,es=is>0?Gr-4:Gr,ps;for(ps=0;ps<es;ps+=4)xr=tr[vr.charCodeAt(ps)]<<18|tr[vr.charCodeAt(ps+1)]<<12|tr[vr.charCodeAt(ps+2)]<<6|tr[vr.charCodeAt(ps+3)],as[cs++]=xr>>16&255,as[cs++]=xr>>8&255,as[cs++]=xr&255;return is===2&&(xr=tr[vr.charCodeAt(ps)]<<2|tr[vr.charCodeAt(ps+1)]>>4,as[cs++]=xr&255),is===1&&(xr=tr[vr.charCodeAt(ps)]<<10|tr[vr.charCodeAt(ps+1)]<<4|tr[vr.charCodeAt(ps+2)]>>2,as[cs++]=xr>>8&255,as[cs++]=xr&255),as}function gr(vr){return B[vr>>18&63]+B[vr>>12&63]+B[vr>>6&63]+B[vr&63]}function Sr(vr,xr,kr){for(var Gr,is=[],as=xr;as<kr;as+=3)Gr=(vr[as]<<16&16711680)+(vr[as+1]<<8&65280)+(vr[as+2]&255),is.push(gr(Gr));return is.join("")}function Ar(vr){for(var xr,kr=vr.length,Gr=kr%3,is=[],as=16383,cs=0,es=kr-Gr;cs<es;cs+=as)is.push(Sr(vr,cs,cs+as>es?es:cs+as));return Gr===1?(xr=vr[kr-1],is.push(B[xr>>2]+B[xr<<4&63]+"==")):Gr===2&&(xr=(vr[kr-2]<<8)+vr[kr-1],is.push(B[xr>>10]+B[xr>>4&63]+B[xr<<2&63]+"=")),is.join("")}var Or={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Or.read=function(vr,xr,kr,Gr,is){var as,cs,es=is*8-Gr-1,ps=(1<<es)-1,Ur=ps>>1,Lr=-7,ts=kr?is-1:0,rs=kr?-1:1,ss=vr[xr+ts];for(ts+=rs,as=ss&(1<<-Lr)-1,ss>>=-Lr,Lr+=es;Lr>0;as=as*256+vr[xr+ts],ts+=rs,Lr-=8);for(cs=as&(1<<-Lr)-1,as>>=-Lr,Lr+=Gr;Lr>0;cs=cs*256+vr[xr+ts],ts+=rs,Lr-=8);if(as===0)as=1-Ur;else{if(as===ps)return cs?NaN:(ss?-1:1)*(1/0);cs=cs+Math.pow(2,Gr),as=as-Ur}return(ss?-1:1)*cs*Math.pow(2,as-Gr)},Or.write=function(vr,xr,kr,Gr,is,as){var cs,es,ps,Ur=as*8-is-1,Lr=(1<<Ur)-1,ts=Lr>>1,rs=is===23?Math.pow(2,-24)-Math.pow(2,-77):0,ss=Gr?0:as-1,ls=Gr?1:-1,os=xr<0||xr===0&&1/xr<0?1:0;for(xr=Math.abs(xr),isNaN(xr)||xr===1/0?(es=isNaN(xr)?1:0,cs=Lr):(cs=Math.floor(Math.log(xr)/Math.LN2),xr*(ps=Math.pow(2,-cs))<1&&(cs--,ps*=2),cs+ts>=1?xr+=rs/ps:xr+=rs*Math.pow(2,1-ts),xr*ps>=2&&(cs++,ps/=2),cs+ts>=Lr?(es=0,cs=Lr):cs+ts>=1?(es=(xr*ps-1)*Math.pow(2,is),cs=cs+ts):(es=xr*Math.pow(2,ts-1)*Math.pow(2,is),cs=0));is>=8;vr[kr+ss]=es&255,ss+=ls,es/=256,is-=8);for(cs=cs<<is|es,Ur+=is;Ur>0;vr[kr+ss]=cs&255,ss+=ls,cs/=256,Ur-=8);vr[kr+ss-ls]|=os*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(vr){const xr=I,kr=Or,Gr=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;vr.Buffer=Lr,vr.SlowBuffer=gs,vr.INSPECT_MAX_BYTES=50;const is=2147483647;vr.kMaxLength=is;const{Uint8Array:as,ArrayBuffer:cs,SharedArrayBuffer:es}=globalThis;Lr.TYPED_ARRAY_SUPPORT=ps(),!Lr.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function ps(){try{const Pr=new as(1),Mr={foo:function(){return 42}};return Object.setPrototypeOf(Mr,as.prototype),Object.setPrototypeOf(Pr,Mr),Pr.foo()===42}catch{return!1}}Object.defineProperty(Lr.prototype,"parent",{enumerable:!0,get:function(){if(Lr.isBuffer(this))return this.buffer}}),Object.defineProperty(Lr.prototype,"offset",{enumerable:!0,get:function(){if(Lr.isBuffer(this))return this.byteOffset}});function Ur(Pr){if(Pr>is)throw new RangeError('The value "'+Pr+'" is invalid for option "size"');const Mr=new as(Pr);return Object.setPrototypeOf(Mr,Lr.prototype),Mr}function Lr(Pr,Mr,br){if(typeof Pr=="number"){if(typeof Mr=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return ls(Pr)}return ts(Pr,Mr,br)}Lr.poolSize=8192;function ts(Pr,Mr,br){if(typeof Pr=="string")return os(Pr,Mr);if(cs.isView(Pr))return ys(Pr);if(Pr==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Pr);if(Es(Pr,cs)||Pr&&Es(Pr.buffer,cs)||typeof es<"u"&&(Es(Pr,es)||Pr&&Es(Pr.buffer,es)))return bs(Pr,Mr,br);if(typeof Pr=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const $r=Pr.valueOf&&Pr.valueOf();if($r!=null&&$r!==Pr)return Lr.from($r,Mr,br);const Qr=As(Pr);if(Qr)return Qr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Pr[Symbol.toPrimitive]=="function")return Lr.from(Pr[Symbol.toPrimitive]("string"),Mr,br);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Pr)}Lr.from=function(Pr,Mr,br){return ts(Pr,Mr,br)},Object.setPrototypeOf(Lr.prototype,as.prototype),Object.setPrototypeOf(Lr,as);function rs(Pr){if(typeof Pr!="number")throw new TypeError('"size" argument must be of type number');if(Pr<0)throw new RangeError('The value "'+Pr+'" is invalid for option "size"')}function ss(Pr,Mr,br){return rs(Pr),Pr<=0?Ur(Pr):Mr!==void 0?typeof br=="string"?Ur(Pr).fill(Mr,br):Ur(Pr).fill(Mr):Ur(Pr)}Lr.alloc=function(Pr,Mr,br){return ss(Pr,Mr,br)};function ls(Pr){return rs(Pr),Ur(Pr<0?0:vs(Pr)|0)}Lr.allocUnsafe=function(Pr){return ls(Pr)},Lr.allocUnsafeSlow=function(Pr){return ls(Pr)};function os(Pr,Mr){if((typeof Mr!="string"||Mr==="")&&(Mr="utf8"),!Lr.isEncoding(Mr))throw new TypeError("Unknown encoding: "+Mr);const br=xs(Pr,Mr)|0;let $r=Ur(br);const Qr=$r.write(Pr,Mr);return Qr!==br&&($r=$r.slice(0,Qr)),$r}function us(Pr){const Mr=Pr.length<0?0:vs(Pr.length)|0,br=Ur(Mr);for(let $r=0;$r<Mr;$r+=1)br[$r]=Pr[$r]&255;return br}function ys(Pr){if(Es(Pr,as)){const Mr=new as(Pr);return bs(Mr.buffer,Mr.byteOffset,Mr.byteLength)}return us(Pr)}function bs(Pr,Mr,br){if(Mr<0||Pr.byteLength<Mr)throw new RangeError('"offset" is outside of buffer bounds');if(Pr.byteLength<Mr+(br||0))throw new RangeError('"length" is outside of buffer bounds');let $r;return Mr===void 0&&br===void 0?$r=new as(Pr):br===void 0?$r=new as(Pr,Mr):$r=new as(Pr,Mr,br),Object.setPrototypeOf($r,Lr.prototype),$r}function As(Pr){if(Lr.isBuffer(Pr)){const Mr=vs(Pr.length)|0,br=Ur(Mr);return br.length===0||Pr.copy(br,0,0,Mr),br}if(Pr.length!==void 0)return typeof Pr.length!="number"||Cs(Pr.length)?Ur(0):us(Pr);if(Pr.type==="Buffer"&&Array.isArray(Pr.data))return us(Pr.data)}function vs(Pr){if(Pr>=is)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+is.toString(16)+" bytes");return Pr|0}function gs(Pr){return+Pr!=Pr&&(Pr=0),Lr.alloc(+Pr)}Lr.isBuffer=function(Mr){return Mr!=null&&Mr._isBuffer===!0&&Mr!==Lr.prototype},Lr.compare=function(Mr,br){if(Es(Mr,as)&&(Mr=Lr.from(Mr,Mr.offset,Mr.byteLength)),Es(br,as)&&(br=Lr.from(br,br.offset,br.byteLength)),!Lr.isBuffer(Mr)||!Lr.isBuffer(br))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Mr===br)return 0;let $r=Mr.length,Qr=br.length;for(let ns=0,ds=Math.min($r,Qr);ns<ds;++ns)if(Mr[ns]!==br[ns]){$r=Mr[ns],Qr=br[ns];break}return $r<Qr?-1:Qr<$r?1:0},Lr.isEncoding=function(Mr){switch(String(Mr).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Lr.concat=function(Mr,br){if(!Array.isArray(Mr))throw new TypeError('"list" argument must be an Array of Buffers');if(Mr.length===0)return Lr.alloc(0);let $r;if(br===void 0)for(br=0,$r=0;$r<Mr.length;++$r)br+=Mr[$r].length;const Qr=Lr.allocUnsafe(br);let ns=0;for($r=0;$r<Mr.length;++$r){let ds=Mr[$r];if(Es(ds,as))ns+ds.length>Qr.length?(Lr.isBuffer(ds)||(ds=Lr.from(ds)),ds.copy(Qr,ns)):as.prototype.set.call(Qr,ds,ns);else if(Lr.isBuffer(ds))ds.copy(Qr,ns);else throw new TypeError('"list" argument must be an Array of Buffers');ns+=ds.length}return Qr};function xs(Pr,Mr){if(Lr.isBuffer(Pr))return Pr.length;if(cs.isView(Pr)||Es(Pr,cs))return Pr.byteLength;if(typeof Pr!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Pr);const br=Pr.length,$r=arguments.length>2&&arguments[2]===!0;if(!$r&&br===0)return 0;let Qr=!1;for(;;)switch(Mr){case"ascii":case"latin1":case"binary":return br;case"utf8":case"utf-8":return Ts(Pr).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return br*2;case"hex":return br>>>1;case"base64":return hs(Pr).length;default:if(Qr)return $r?-1:Ts(Pr).length;Mr=(""+Mr).toLowerCase(),Qr=!0}}Lr.byteLength=xs;function Is(Pr,Mr,br){let $r=!1;if((Mr===void 0||Mr<0)&&(Mr=0),Mr>this.length||((br===void 0||br>this.length)&&(br=this.length),br<=0)||(br>>>=0,Mr>>>=0,br<=Mr))return"";for(Pr||(Pr="utf8");;)switch(Pr){case"hex":return Zs(this,Mr,br);case"utf8":case"utf-8":return aa(this,Mr,br);case"ascii":return na(this,Mr,br);case"latin1":case"binary":return ia(this,Mr,br);case"base64":return sa(this,Mr,br);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qs(this,Mr,br);default:if($r)throw new TypeError("Unknown encoding: "+Pr);Pr=(Pr+"").toLowerCase(),$r=!0}}Lr.prototype._isBuffer=!0;function Ns(Pr,Mr,br){const $r=Pr[Mr];Pr[Mr]=Pr[br],Pr[br]=$r}Lr.prototype.swap16=function(){const Mr=this.length;if(Mr%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let br=0;br<Mr;br+=2)Ns(this,br,br+1);return this},Lr.prototype.swap32=function(){const Mr=this.length;if(Mr%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let br=0;br<Mr;br+=4)Ns(this,br,br+3),Ns(this,br+1,br+2);return this},Lr.prototype.swap64=function(){const Mr=this.length;if(Mr%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let br=0;br<Mr;br+=8)Ns(this,br,br+7),Ns(this,br+1,br+6),Ns(this,br+2,br+5),Ns(this,br+3,br+4);return this},Lr.prototype.toString=function(){const Mr=this.length;return Mr===0?"":arguments.length===0?aa(this,0,Mr):Is.apply(this,arguments)},Lr.prototype.toLocaleString=Lr.prototype.toString,Lr.prototype.equals=function(Mr){if(!Lr.isBuffer(Mr))throw new TypeError("Argument must be a Buffer");return this===Mr?!0:Lr.compare(this,Mr)===0},Lr.prototype.inspect=function(){let Mr="";const br=vr.INSPECT_MAX_BYTES;return Mr=this.toString("hex",0,br).replace(/(.{2})/g,"$1 ").trim(),this.length>br&&(Mr+=" ... "),"<Buffer "+Mr+">"},Gr&&(Lr.prototype[Gr]=Lr.prototype.inspect),Lr.prototype.compare=function(Mr,br,$r,Qr,ns){if(Es(Mr,as)&&(Mr=Lr.from(Mr,Mr.offset,Mr.byteLength)),!Lr.isBuffer(Mr))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Mr);if(br===void 0&&(br=0),$r===void 0&&($r=Mr?Mr.length:0),Qr===void 0&&(Qr=0),ns===void 0&&(ns=this.length),br<0||$r>Mr.length||Qr<0||ns>this.length)throw new RangeError("out of range index");if(Qr>=ns&&br>=$r)return 0;if(Qr>=ns)return-1;if(br>=$r)return 1;if(br>>>=0,$r>>>=0,Qr>>>=0,ns>>>=0,this===Mr)return 0;let ds=ns-Qr,Rs=$r-br;const js=Math.min(ds,Rs),Us=this.slice(Qr,ns),zs=Mr.slice(br,$r);for(let qs=0;qs<js;++qs)if(Us[qs]!==zs[qs]){ds=Us[qs],Rs=zs[qs];break}return ds<Rs?-1:Rs<ds?1:0};function Vs(Pr,Mr,br,$r,Qr){if(Pr.length===0)return-1;if(typeof br=="string"?($r=br,br=0):br>2147483647?br=2147483647:br<-2147483648&&(br=-2147483648),br=+br,Cs(br)&&(br=Qr?0:Pr.length-1),br<0&&(br=Pr.length+br),br>=Pr.length){if(Qr)return-1;br=Pr.length-1}else if(br<0)if(Qr)br=0;else return-1;if(typeof Mr=="string"&&(Mr=Lr.from(Mr,$r)),Lr.isBuffer(Mr))return Mr.length===0?-1:Ls(Pr,Mr,br,$r,Qr);if(typeof Mr=="number")return Mr=Mr&255,typeof as.prototype.indexOf=="function"?Qr?as.prototype.indexOf.call(Pr,Mr,br):as.prototype.lastIndexOf.call(Pr,Mr,br):Ls(Pr,[Mr],br,$r,Qr);throw new TypeError("val must be string, number or Buffer")}function Ls(Pr,Mr,br,$r,Qr){let ns=1,ds=Pr.length,Rs=Mr.length;if($r!==void 0&&($r=String($r).toLowerCase(),$r==="ucs2"||$r==="ucs-2"||$r==="utf16le"||$r==="utf-16le")){if(Pr.length<2||Mr.length<2)return-1;ns=2,ds/=2,Rs/=2,br/=2}function js(zs,qs){return ns===1?zs[qs]:zs.readUInt16BE(qs*ns)}let Us;if(Qr){let zs=-1;for(Us=br;Us<ds;Us++)if(js(Pr,Us)===js(Mr,zs===-1?0:Us-zs)){if(zs===-1&&(zs=Us),Us-zs+1===Rs)return zs*ns}else zs!==-1&&(Us-=Us-zs),zs=-1}else for(br+Rs>ds&&(br=ds-Rs),Us=br;Us>=0;Us--){let zs=!0;for(let qs=0;qs<Rs;qs++)if(js(Pr,Us+qs)!==js(Mr,qs)){zs=!1;break}if(zs)return Us}return-1}Lr.prototype.includes=function(Mr,br,$r){return this.indexOf(Mr,br,$r)!==-1},Lr.prototype.indexOf=function(Mr,br,$r){return Vs(this,Mr,br,$r,!0)},Lr.prototype.lastIndexOf=function(Mr,br,$r){return Vs(this,Mr,br,$r,!1)};function ks(Pr,Mr,br,$r){br=Number(br)||0;const Qr=Pr.length-br;$r?($r=Number($r),$r>Qr&&($r=Qr)):$r=Qr;const ns=Mr.length;$r>ns/2&&($r=ns/2);let ds;for(ds=0;ds<$r;++ds){const Rs=parseInt(Mr.substr(ds*2,2),16);if(Cs(Rs))return ds;Pr[br+ds]=Rs}return ds}function Fs(Pr,Mr,br,$r){return ws(Ts(Mr,Pr.length-br),Pr,br,$r)}function Os(Pr,Mr,br,$r){return ws(Ms(Mr),Pr,br,$r)}function Hs(Pr,Mr,br,$r){return ws(hs(Mr),Pr,br,$r)}function Gs(Pr,Mr,br,$r){return ws(_s(Mr,Pr.length-br),Pr,br,$r)}Lr.prototype.write=function(Mr,br,$r,Qr){if(br===void 0)Qr="utf8",$r=this.length,br=0;else if($r===void 0&&typeof br=="string")Qr=br,$r=this.length,br=0;else if(isFinite(br))br=br>>>0,isFinite($r)?($r=$r>>>0,Qr===void 0&&(Qr="utf8")):(Qr=$r,$r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ns=this.length-br;if(($r===void 0||$r>ns)&&($r=ns),Mr.length>0&&($r<0||br<0)||br>this.length)throw new RangeError("Attempt to write outside buffer bounds");Qr||(Qr="utf8");let ds=!1;for(;;)switch(Qr){case"hex":return ks(this,Mr,br,$r);case"utf8":case"utf-8":return Fs(this,Mr,br,$r);case"ascii":case"latin1":case"binary":return Os(this,Mr,br,$r);case"base64":return Hs(this,Mr,br,$r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Gs(this,Mr,br,$r);default:if(ds)throw new TypeError("Unknown encoding: "+Qr);Qr=(""+Qr).toLowerCase(),ds=!0}},Lr.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function sa(Pr,Mr,br){return Mr===0&&br===Pr.length?xr.fromByteArray(Pr):xr.fromByteArray(Pr.slice(Mr,br))}function aa(Pr,Mr,br){br=Math.min(Pr.length,br);const $r=[];let Qr=Mr;for(;Qr<br;){const ns=Pr[Qr];let ds=null,Rs=ns>239?4:ns>223?3:ns>191?2:1;if(Qr+Rs<=br){let js,Us,zs,qs;switch(Rs){case 1:ns<128&&(ds=ns);break;case 2:js=Pr[Qr+1],(js&192)===128&&(qs=(ns&31)<<6|js&63,qs>127&&(ds=qs));break;case 3:js=Pr[Qr+1],Us=Pr[Qr+2],(js&192)===128&&(Us&192)===128&&(qs=(ns&15)<<12|(js&63)<<6|Us&63,qs>2047&&(qs<55296||qs>57343)&&(ds=qs));break;case 4:js=Pr[Qr+1],Us=Pr[Qr+2],zs=Pr[Qr+3],(js&192)===128&&(Us&192)===128&&(zs&192)===128&&(qs=(ns&15)<<18|(js&63)<<12|(Us&63)<<6|zs&63,qs>65535&&qs<1114112&&(ds=qs))}}ds===null?(ds=65533,Rs=1):ds>65535&&(ds-=65536,$r.push(ds>>>10&1023|55296),ds=56320|ds&1023),$r.push(ds),Qr+=Rs}return Ys($r)}const Ws=4096;function Ys(Pr){const Mr=Pr.length;if(Mr<=Ws)return String.fromCharCode.apply(String,Pr);let br="",$r=0;for(;$r<Mr;)br+=String.fromCharCode.apply(String,Pr.slice($r,$r+=Ws));return br}function na(Pr,Mr,br){let $r="";br=Math.min(Pr.length,br);for(let Qr=Mr;Qr<br;++Qr)$r+=String.fromCharCode(Pr[Qr]&127);return $r}function ia(Pr,Mr,br){let $r="";br=Math.min(Pr.length,br);for(let Qr=Mr;Qr<br;++Qr)$r+=String.fromCharCode(Pr[Qr]);return $r}function Zs(Pr,Mr,br){const $r=Pr.length;(!Mr||Mr<0)&&(Mr=0),(!br||br<0||br>$r)&&(br=$r);let Qr="";for(let ns=Mr;ns<br;++ns)Qr+=$s[Pr[ns]];return Qr}function Qs(Pr,Mr,br){const $r=Pr.slice(Mr,br);let Qr="";for(let ns=0;ns<$r.length-1;ns+=2)Qr+=String.fromCharCode($r[ns]+$r[ns+1]*256);return Qr}Lr.prototype.slice=function(Mr,br){const $r=this.length;Mr=~~Mr,br=br===void 0?$r:~~br,Mr<0?(Mr+=$r,Mr<0&&(Mr=0)):Mr>$r&&(Mr=$r),br<0?(br+=$r,br<0&&(br=0)):br>$r&&(br=$r),br<Mr&&(br=Mr);const Qr=this.subarray(Mr,br);return Object.setPrototypeOf(Qr,Lr.prototype),Qr};function Ps(Pr,Mr,br){if(Pr%1!==0||Pr<0)throw new RangeError("offset is not uint");if(Pr+Mr>br)throw new RangeError("Trying to access beyond buffer length")}Lr.prototype.readUintLE=Lr.prototype.readUIntLE=function(Mr,br,$r){Mr=Mr>>>0,br=br>>>0,$r||Ps(Mr,br,this.length);let Qr=this[Mr],ns=1,ds=0;for(;++ds<br&&(ns*=256);)Qr+=this[Mr+ds]*ns;return Qr},Lr.prototype.readUintBE=Lr.prototype.readUIntBE=function(Mr,br,$r){Mr=Mr>>>0,br=br>>>0,$r||Ps(Mr,br,this.length);let Qr=this[Mr+--br],ns=1;for(;br>0&&(ns*=256);)Qr+=this[Mr+--br]*ns;return Qr},Lr.prototype.readUint8=Lr.prototype.readUInt8=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,1,this.length),this[Mr]},Lr.prototype.readUint16LE=Lr.prototype.readUInt16LE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,2,this.length),this[Mr]|this[Mr+1]<<8},Lr.prototype.readUint16BE=Lr.prototype.readUInt16BE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,2,this.length),this[Mr]<<8|this[Mr+1]},Lr.prototype.readUint32LE=Lr.prototype.readUInt32LE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,4,this.length),(this[Mr]|this[Mr+1]<<8|this[Mr+2]<<16)+this[Mr+3]*16777216},Lr.prototype.readUint32BE=Lr.prototype.readUInt32BE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,4,this.length),this[Mr]*16777216+(this[Mr+1]<<16|this[Mr+2]<<8|this[Mr+3])},Lr.prototype.readBigUInt64LE=Ds(function(Mr){Mr=Mr>>>0,Dr(Mr,"offset");const br=this[Mr],$r=this[Mr+7];(br===void 0||$r===void 0)&&zr(Mr,this.length-8);const Qr=br+this[++Mr]*2**8+this[++Mr]*2**16+this[++Mr]*2**24,ns=this[++Mr]+this[++Mr]*2**8+this[++Mr]*2**16+$r*2**24;return BigInt(Qr)+(BigInt(ns)<<BigInt(32))}),Lr.prototype.readBigUInt64BE=Ds(function(Mr){Mr=Mr>>>0,Dr(Mr,"offset");const br=this[Mr],$r=this[Mr+7];(br===void 0||$r===void 0)&&zr(Mr,this.length-8);const Qr=br*2**24+this[++Mr]*2**16+this[++Mr]*2**8+this[++Mr],ns=this[++Mr]*2**24+this[++Mr]*2**16+this[++Mr]*2**8+$r;return(BigInt(Qr)<<BigInt(32))+BigInt(ns)}),Lr.prototype.readIntLE=function(Mr,br,$r){Mr=Mr>>>0,br=br>>>0,$r||Ps(Mr,br,this.length);let Qr=this[Mr],ns=1,ds=0;for(;++ds<br&&(ns*=256);)Qr+=this[Mr+ds]*ns;return ns*=128,Qr>=ns&&(Qr-=Math.pow(2,8*br)),Qr},Lr.prototype.readIntBE=function(Mr,br,$r){Mr=Mr>>>0,br=br>>>0,$r||Ps(Mr,br,this.length);let Qr=br,ns=1,ds=this[Mr+--Qr];for(;Qr>0&&(ns*=256);)ds+=this[Mr+--Qr]*ns;return ns*=128,ds>=ns&&(ds-=Math.pow(2,8*br)),ds},Lr.prototype.readInt8=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,1,this.length),this[Mr]&128?(255-this[Mr]+1)*-1:this[Mr]},Lr.prototype.readInt16LE=function(Mr,br){Mr=Mr>>>0,br||Ps(Mr,2,this.length);const $r=this[Mr]|this[Mr+1]<<8;return $r&32768?$r|4294901760:$r},Lr.prototype.readInt16BE=function(Mr,br){Mr=Mr>>>0,br||Ps(Mr,2,this.length);const $r=this[Mr+1]|this[Mr]<<8;return $r&32768?$r|4294901760:$r},Lr.prototype.readInt32LE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,4,this.length),this[Mr]|this[Mr+1]<<8|this[Mr+2]<<16|this[Mr+3]<<24},Lr.prototype.readInt32BE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,4,this.length),this[Mr]<<24|this[Mr+1]<<16|this[Mr+2]<<8|this[Mr+3]},Lr.prototype.readBigInt64LE=Ds(function(Mr){Mr=Mr>>>0,Dr(Mr,"offset");const br=this[Mr],$r=this[Mr+7];(br===void 0||$r===void 0)&&zr(Mr,this.length-8);const Qr=this[Mr+4]+this[Mr+5]*2**8+this[Mr+6]*2**16+($r<<24);return(BigInt(Qr)<<BigInt(32))+BigInt(br+this[++Mr]*2**8+this[++Mr]*2**16+this[++Mr]*2**24)}),Lr.prototype.readBigInt64BE=Ds(function(Mr){Mr=Mr>>>0,Dr(Mr,"offset");const br=this[Mr],$r=this[Mr+7];(br===void 0||$r===void 0)&&zr(Mr,this.length-8);const Qr=(br<<24)+this[++Mr]*2**16+this[++Mr]*2**8+this[++Mr];return(BigInt(Qr)<<BigInt(32))+BigInt(this[++Mr]*2**24+this[++Mr]*2**16+this[++Mr]*2**8+$r)}),Lr.prototype.readFloatLE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,4,this.length),kr.read(this,Mr,!0,23,4)},Lr.prototype.readFloatBE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,4,this.length),kr.read(this,Mr,!1,23,4)},Lr.prototype.readDoubleLE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,8,this.length),kr.read(this,Mr,!0,52,8)},Lr.prototype.readDoubleBE=function(Mr,br){return Mr=Mr>>>0,br||Ps(Mr,8,this.length),kr.read(this,Mr,!1,52,8)};function Bs(Pr,Mr,br,$r,Qr,ns){if(!Lr.isBuffer(Pr))throw new TypeError('"buffer" argument must be a Buffer instance');if(Mr>Qr||Mr<ns)throw new RangeError('"value" argument is out of bounds');if(br+$r>Pr.length)throw new RangeError("Index out of range")}Lr.prototype.writeUintLE=Lr.prototype.writeUIntLE=function(Mr,br,$r,Qr){if(Mr=+Mr,br=br>>>0,$r=$r>>>0,!Qr){const Rs=Math.pow(2,8*$r)-1;Bs(this,Mr,br,$r,Rs,0)}let ns=1,ds=0;for(this[br]=Mr&255;++ds<$r&&(ns*=256);)this[br+ds]=Mr/ns&255;return br+$r},Lr.prototype.writeUintBE=Lr.prototype.writeUIntBE=function(Mr,br,$r,Qr){if(Mr=+Mr,br=br>>>0,$r=$r>>>0,!Qr){const Rs=Math.pow(2,8*$r)-1;Bs(this,Mr,br,$r,Rs,0)}let ns=$r-1,ds=1;for(this[br+ns]=Mr&255;--ns>=0&&(ds*=256);)this[br+ns]=Mr/ds&255;return br+$r},Lr.prototype.writeUint8=Lr.prototype.writeUInt8=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,1,255,0),this[br]=Mr&255,br+1},Lr.prototype.writeUint16LE=Lr.prototype.writeUInt16LE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,2,65535,0),this[br]=Mr&255,this[br+1]=Mr>>>8,br+2},Lr.prototype.writeUint16BE=Lr.prototype.writeUInt16BE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,2,65535,0),this[br]=Mr>>>8,this[br+1]=Mr&255,br+2},Lr.prototype.writeUint32LE=Lr.prototype.writeUInt32LE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,4,4294967295,0),this[br+3]=Mr>>>24,this[br+2]=Mr>>>16,this[br+1]=Mr>>>8,this[br]=Mr&255,br+4},Lr.prototype.writeUint32BE=Lr.prototype.writeUInt32BE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,4,4294967295,0),this[br]=Mr>>>24,this[br+1]=Mr>>>16,this[br+2]=Mr>>>8,this[br+3]=Mr&255,br+4};function ea(Pr,Mr,br,$r,Qr){Cr(Mr,$r,Qr,Pr,br,7);let ns=Number(Mr&BigInt(4294967295));Pr[br++]=ns,ns=ns>>8,Pr[br++]=ns,ns=ns>>8,Pr[br++]=ns,ns=ns>>8,Pr[br++]=ns;let ds=Number(Mr>>BigInt(32)&BigInt(4294967295));return Pr[br++]=ds,ds=ds>>8,Pr[br++]=ds,ds=ds>>8,Pr[br++]=ds,ds=ds>>8,Pr[br++]=ds,br}function Ks(Pr,Mr,br,$r,Qr){Cr(Mr,$r,Qr,Pr,br,7);let ns=Number(Mr&BigInt(4294967295));Pr[br+7]=ns,ns=ns>>8,Pr[br+6]=ns,ns=ns>>8,Pr[br+5]=ns,ns=ns>>8,Pr[br+4]=ns;let ds=Number(Mr>>BigInt(32)&BigInt(4294967295));return Pr[br+3]=ds,ds=ds>>8,Pr[br+2]=ds,ds=ds>>8,Pr[br+1]=ds,ds=ds>>8,Pr[br]=ds,br+8}Lr.prototype.writeBigUInt64LE=Ds(function(Mr,br=0){return ea(this,Mr,br,BigInt(0),BigInt("0xffffffffffffffff"))}),Lr.prototype.writeBigUInt64BE=Ds(function(Mr,br=0){return Ks(this,Mr,br,BigInt(0),BigInt("0xffffffffffffffff"))}),Lr.prototype.writeIntLE=function(Mr,br,$r,Qr){if(Mr=+Mr,br=br>>>0,!Qr){const js=Math.pow(2,8*$r-1);Bs(this,Mr,br,$r,js-1,-js)}let ns=0,ds=1,Rs=0;for(this[br]=Mr&255;++ns<$r&&(ds*=256);)Mr<0&&Rs===0&&this[br+ns-1]!==0&&(Rs=1),this[br+ns]=(Mr/ds>>0)-Rs&255;return br+$r},Lr.prototype.writeIntBE=function(Mr,br,$r,Qr){if(Mr=+Mr,br=br>>>0,!Qr){const js=Math.pow(2,8*$r-1);Bs(this,Mr,br,$r,js-1,-js)}let ns=$r-1,ds=1,Rs=0;for(this[br+ns]=Mr&255;--ns>=0&&(ds*=256);)Mr<0&&Rs===0&&this[br+ns+1]!==0&&(Rs=1),this[br+ns]=(Mr/ds>>0)-Rs&255;return br+$r},Lr.prototype.writeInt8=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,1,127,-128),Mr<0&&(Mr=255+Mr+1),this[br]=Mr&255,br+1},Lr.prototype.writeInt16LE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,2,32767,-32768),this[br]=Mr&255,this[br+1]=Mr>>>8,br+2},Lr.prototype.writeInt16BE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,2,32767,-32768),this[br]=Mr>>>8,this[br+1]=Mr&255,br+2},Lr.prototype.writeInt32LE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,4,2147483647,-2147483648),this[br]=Mr&255,this[br+1]=Mr>>>8,this[br+2]=Mr>>>16,this[br+3]=Mr>>>24,br+4},Lr.prototype.writeInt32BE=function(Mr,br,$r){return Mr=+Mr,br=br>>>0,$r||Bs(this,Mr,br,4,2147483647,-2147483648),Mr<0&&(Mr=4294967295+Mr+1),this[br]=Mr>>>24,this[br+1]=Mr>>>16,this[br+2]=Mr>>>8,this[br+3]=Mr&255,br+4},Lr.prototype.writeBigInt64LE=Ds(function(Mr,br=0){return ea(this,Mr,br,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),Lr.prototype.writeBigInt64BE=Ds(function(Mr,br=0){return Ks(this,Mr,br,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function oa(Pr,Mr,br,$r,Qr,ns){if(br+$r>Pr.length)throw new RangeError("Index out of range");if(br<0)throw new RangeError("Index out of range")}function ta(Pr,Mr,br,$r,Qr){return Mr=+Mr,br=br>>>0,Qr||oa(Pr,Mr,br,4),kr.write(Pr,Mr,br,$r,23,4),br+4}Lr.prototype.writeFloatLE=function(Mr,br,$r){return ta(this,Mr,br,!0,$r)},Lr.prototype.writeFloatBE=function(Mr,br,$r){return ta(this,Mr,br,!1,$r)};function Xs(Pr,Mr,br,$r,Qr){return Mr=+Mr,br=br>>>0,Qr||oa(Pr,Mr,br,8),kr.write(Pr,Mr,br,$r,52,8),br+8}Lr.prototype.writeDoubleLE=function(Mr,br,$r){return Xs(this,Mr,br,!0,$r)},Lr.prototype.writeDoubleBE=function(Mr,br,$r){return Xs(this,Mr,br,!1,$r)},Lr.prototype.copy=function(Mr,br,$r,Qr){if(!Lr.isBuffer(Mr))throw new TypeError("argument should be a Buffer");if($r||($r=0),!Qr&&Qr!==0&&(Qr=this.length),br>=Mr.length&&(br=Mr.length),br||(br=0),Qr>0&&Qr<$r&&(Qr=$r),Qr===$r||Mr.length===0||this.length===0)return 0;if(br<0)throw new RangeError("targetStart out of bounds");if($r<0||$r>=this.length)throw new RangeError("Index out of range");if(Qr<0)throw new RangeError("sourceEnd out of bounds");Qr>this.length&&(Qr=this.length),Mr.length-br<Qr-$r&&(Qr=Mr.length-br+$r);const ns=Qr-$r;return this===Mr&&typeof as.prototype.copyWithin=="function"?this.copyWithin(br,$r,Qr):as.prototype.set.call(Mr,this.subarray($r,Qr),br),ns},Lr.prototype.fill=function(Mr,br,$r,Qr){if(typeof Mr=="string"){if(typeof br=="string"?(Qr=br,br=0,$r=this.length):typeof $r=="string"&&(Qr=$r,$r=this.length),Qr!==void 0&&typeof Qr!="string")throw new TypeError("encoding must be a string");if(typeof Qr=="string"&&!Lr.isEncoding(Qr))throw new TypeError("Unknown encoding: "+Qr);if(Mr.length===1){const ds=Mr.charCodeAt(0);(Qr==="utf8"&&ds<128||Qr==="latin1")&&(Mr=ds)}}else typeof Mr=="number"?Mr=Mr&255:typeof Mr=="boolean"&&(Mr=Number(Mr));if(br<0||this.length<br||this.length<$r)throw new RangeError("Out of range index");if($r<=br)return this;br=br>>>0,$r=$r===void 0?this.length:$r>>>0,Mr||(Mr=0);let ns;if(typeof Mr=="number")for(ns=br;ns<$r;++ns)this[ns]=Mr;else{const ds=Lr.isBuffer(Mr)?Mr:Lr.from(Mr,Qr),Rs=ds.length;if(Rs===0)throw new TypeError('The value "'+Mr+'" is invalid for argument "value"');for(ns=0;ns<$r-br;++ns)this[ns+br]=ds[ns%Rs]}return this};const ra={};function Ir(Pr,Mr,br){ra[Pr]=class extends br{constructor(){super(),Object.defineProperty(this,"message",{value:Mr.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Pr}]`,this.stack,delete this.name}get code(){return Pr}set code(Qr){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Qr,writable:!0})}toString(){return`${this.name} [${Pr}]: ${this.message}`}}}Ir("ERR_BUFFER_OUT_OF_BOUNDS",function(Pr){return Pr?`${Pr} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ir("ERR_INVALID_ARG_TYPE",function(Pr,Mr){return`The "${Pr}" argument must be of type number. Received type ${typeof Mr}`},TypeError),Ir("ERR_OUT_OF_RANGE",function(Pr,Mr,br){let $r=`The value of "${Pr}" is out of range.`,Qr=br;return Number.isInteger(br)&&Math.abs(br)>2**32?Qr=wr(String(br)):typeof br=="bigint"&&(Qr=String(br),(br>BigInt(2)**BigInt(32)||br<-(BigInt(2)**BigInt(32)))&&(Qr=wr(Qr)),Qr+="n"),$r+=` It must be ${Mr}. Received ${Qr}`,$r},RangeError);function wr(Pr){let Mr="",br=Pr.length;const $r=Pr[0]==="-"?1:0;for(;br>=$r+4;br-=3)Mr=`_${Pr.slice(br-3,br)}${Mr}`;return`${Pr.slice(0,br)}${Mr}`}function yr(Pr,Mr,br){Dr(Mr,"offset"),(Pr[Mr]===void 0||Pr[Mr+br]===void 0)&&zr(Mr,Pr.length-(br+1))}function Cr(Pr,Mr,br,$r,Qr,ns){if(Pr>br||Pr<Mr){const ds=typeof Mr=="bigint"?"n":"";let Rs;throw Mr===0||Mr===BigInt(0)?Rs=`>= 0${ds} and < 2${ds} ** ${(ns+1)*8}${ds}`:Rs=`>= -(2${ds} ** ${(ns+1)*8-1}${ds}) and < 2 ** ${(ns+1)*8-1}${ds}`,new ra.ERR_OUT_OF_RANGE("value",Rs,Pr)}yr($r,Qr,ns)}function Dr(Pr,Mr){if(typeof Pr!="number")throw new ra.ERR_INVALID_ARG_TYPE(Mr,"number",Pr)}function zr(Pr,Mr,br){throw Math.floor(Pr)!==Pr?(Dr(Pr,br),new ra.ERR_OUT_OF_RANGE("offset","an integer",Pr)):Mr<0?new ra.ERR_BUFFER_OUT_OF_BOUNDS:new ra.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${Mr}`,Pr)}const Jr=/[^+/0-9A-Za-z-_]/g;function Ss(Pr){if(Pr=Pr.split("=")[0],Pr=Pr.trim().replace(Jr,""),Pr.length<2)return"";for(;Pr.length%4!==0;)Pr=Pr+"=";return Pr}function Ts(Pr,Mr){Mr=Mr||1/0;let br;const $r=Pr.length;let Qr=null;const ns=[];for(let ds=0;ds<$r;++ds){if(br=Pr.charCodeAt(ds),br>55295&&br<57344){if(!Qr){if(br>56319){(Mr-=3)>-1&&ns.push(239,191,189);continue}else if(ds+1===$r){(Mr-=3)>-1&&ns.push(239,191,189);continue}Qr=br;continue}if(br<56320){(Mr-=3)>-1&&ns.push(239,191,189),Qr=br;continue}br=(Qr-55296<<10|br-56320)+65536}else Qr&&(Mr-=3)>-1&&ns.push(239,191,189);if(Qr=null,br<128){if((Mr-=1)<0)break;ns.push(br)}else if(br<2048){if((Mr-=2)<0)break;ns.push(br>>6|192,br&63|128)}else if(br<65536){if((Mr-=3)<0)break;ns.push(br>>12|224,br>>6&63|128,br&63|128)}else if(br<1114112){if((Mr-=4)<0)break;ns.push(br>>18|240,br>>12&63|128,br>>6&63|128,br&63|128)}else throw new Error("Invalid code point")}return ns}function Ms(Pr){const Mr=[];for(let br=0;br<Pr.length;++br)Mr.push(Pr.charCodeAt(br)&255);return Mr}function _s(Pr,Mr){let br,$r,Qr;const ns=[];for(let ds=0;ds<Pr.length&&!((Mr-=2)<0);++ds)br=Pr.charCodeAt(ds),$r=br>>8,Qr=br%256,ns.push(Qr),ns.push($r);return ns}function hs(Pr){return xr.toByteArray(Ss(Pr))}function ws(Pr,Mr,br,$r){let Qr;for(Qr=0;Qr<$r&&!(Qr+br>=Mr.length||Qr>=Pr.length);++Qr)Mr[Qr+br]=Pr[Qr];return Qr}function Es(Pr,Mr){return Pr instanceof Mr||Pr!=null&&Pr.constructor!=null&&Pr.constructor.name!=null&&Pr.constructor.name===Mr.name}function Cs(Pr){return Pr!==Pr}const $s=function(){const Pr="0123456789abcdef",Mr=new Array(256);for(let br=0;br<16;++br){const $r=br*16;for(let Qr=0;Qr<16;++Qr)Mr[$r+Qr]=Pr[br]+Pr[Qr]}return Mr}();function Ds(Pr){return typeof BigInt>"u"?Js:Pr}function Js(){throw new Error("BigInt not supported")}})(e);const Fr=e.Buffer;k.Blob=e.Blob,k.BlobOptions=e.BlobOptions,k.Buffer=e.Buffer,k.File=e.File,k.FileOptions=e.FileOptions,k.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,k.SlowBuffer=e.SlowBuffer,k.TranscodeEncoding=e.TranscodeEncoding,k.atob=e.atob,k.btoa=e.btoa,k.constants=e.constants,k.default=Fr,k.isAscii=e.isAscii,k.isUtf8=e.isUtf8,k.kMaxLength=e.kMaxLength,k.kStringMaxLength=e.kStringMaxLength,k.resolveObjectURL=e.resolveObjectURL,k.transcode=e.transcode}(dist)),dist}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,function(k,e){var I=requireDist(),B=I.Buffer;function tr(ir,lr){for(var dr in ir)lr[dr]=ir[dr]}B.from&&B.alloc&&B.allocUnsafe&&B.allocUnsafeSlow?k.exports=I:(tr(I,e),e.Buffer=rr);function rr(ir,lr,dr){return B(ir,lr,dr)}rr.prototype=Object.create(B.prototype),tr(B,rr),rr.from=function(ir,lr,dr){if(typeof ir=="number")throw new TypeError("Argument must not be a number");return B(ir,lr,dr)},rr.alloc=function(ir,lr,dr){if(typeof ir!="number")throw new TypeError("Argument must be a number");var mr=B(ir);return lr!==void 0?typeof dr=="string"?mr.fill(lr,dr):mr.fill(lr):mr.fill(0),mr},rr.allocUnsafe=function(ir){if(typeof ir!="number")throw new TypeError("Argument must be a number");return B(ir)},rr.allocUnsafeSlow=function(ir){if(typeof ir!="number")throw new TypeError("Argument must be a number");return I.SlowBuffer(ir)}}(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var hash$1,hasRequiredHash;function requireHash(){if(hasRequiredHash)return hash$1;hasRequiredHash=1;var k=requireSafeBuffer().Buffer;function e(I,B){this._block=k.alloc(I),this._finalSize=B,this._blockSize=I,this._len=0}return e.prototype.update=function(I,B){typeof I=="string"&&(B=B||"utf8",I=k.from(I,B));for(var tr=this._block,rr=this._blockSize,ir=I.length,lr=this._len,dr=0;dr<ir;){for(var mr=lr%rr,hr=Math.min(ir-dr,rr-mr),fr=0;fr<hr;fr++)tr[mr+fr]=I[dr+fr];lr+=hr,dr+=hr,lr%rr===0&&this._update(tr)}return this._len+=ir,this},e.prototype.digest=function(I){var B=this._len%this._blockSize;this._block[B]=128,this._block.fill(0,B+1),B>=this._finalSize&&(this._update(this._block),this._block.fill(0));var tr=this._len*8;if(tr<=4294967295)this._block.writeUInt32BE(tr,this._blockSize-4);else{var rr=(tr&4294967295)>>>0,ir=(tr-rr)/4294967296;this._block.writeUInt32BE(ir,this._blockSize-8),this._block.writeUInt32BE(rr,this._blockSize-4)}this._update(this._block);var lr=this._hash();return I?lr.toString(I):lr},e.prototype._update=function(){throw new Error("_update must be implemented by subclass")},hash$1=e,hash$1}var sha,hasRequiredSha;function requireSha(){if(hasRequiredSha)return sha;hasRequiredSha=1;var k=requireInherits_browser(),e=requireHash(),I=requireSafeBuffer().Buffer,B=[1518500249,1859775393,-1894007588,-899497514],tr=new Array(80);function rr(){this.init(),this._w=tr,e.call(this,64,56)}k(rr,e),rr.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function ir(mr){return mr<<5|mr>>>27}function lr(mr){return mr<<30|mr>>>2}function dr(mr,hr,fr,_r){return mr===0?hr&fr|~hr&_r:mr===2?hr&fr|hr&_r|fr&_r:hr^fr^_r}return rr.prototype._update=function(mr){for(var hr=this._w,fr=this._a|0,_r=this._b|0,gr=this._c|0,Sr=this._d|0,Ar=this._e|0,Or=0;Or<16;++Or)hr[Or]=mr.readInt32BE(Or*4);for(;Or<80;++Or)hr[Or]=hr[Or-3]^hr[Or-8]^hr[Or-14]^hr[Or-16];for(var Fr=0;Fr<80;++Fr){var vr=~~(Fr/20),xr=ir(fr)+dr(vr,_r,gr,Sr)+Ar+hr[Fr]+B[vr]|0;Ar=Sr,Sr=gr,gr=lr(_r),_r=fr,fr=xr}this._a=fr+this._a|0,this._b=_r+this._b|0,this._c=gr+this._c|0,this._d=Sr+this._d|0,this._e=Ar+this._e|0},rr.prototype._hash=function(){var mr=I.allocUnsafe(20);return mr.writeInt32BE(this._a|0,0),mr.writeInt32BE(this._b|0,4),mr.writeInt32BE(this._c|0,8),mr.writeInt32BE(this._d|0,12),mr.writeInt32BE(this._e|0,16),mr},sha=rr,sha}var sha1,hasRequiredSha1;function requireSha1(){if(hasRequiredSha1)return sha1;hasRequiredSha1=1;var k=requireInherits_browser(),e=requireHash(),I=requireSafeBuffer().Buffer,B=[1518500249,1859775393,-1894007588,-899497514],tr=new Array(80);function rr(){this.init(),this._w=tr,e.call(this,64,56)}k(rr,e),rr.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function ir(hr){return hr<<1|hr>>>31}function lr(hr){return hr<<5|hr>>>27}function dr(hr){return hr<<30|hr>>>2}function mr(hr,fr,_r,gr){return hr===0?fr&_r|~fr&gr:hr===2?fr&_r|fr&gr|_r&gr:fr^_r^gr}return rr.prototype._update=function(hr){for(var fr=this._w,_r=this._a|0,gr=this._b|0,Sr=this._c|0,Ar=this._d|0,Or=this._e|0,Fr=0;Fr<16;++Fr)fr[Fr]=hr.readInt32BE(Fr*4);for(;Fr<80;++Fr)fr[Fr]=ir(fr[Fr-3]^fr[Fr-8]^fr[Fr-14]^fr[Fr-16]);for(var vr=0;vr<80;++vr){var xr=~~(vr/20),kr=lr(_r)+mr(xr,gr,Sr,Ar)+Or+fr[vr]+B[xr]|0;Or=Ar,Ar=Sr,Sr=dr(gr),gr=_r,_r=kr}this._a=_r+this._a|0,this._b=gr+this._b|0,this._c=Sr+this._c|0,this._d=Ar+this._d|0,this._e=Or+this._e|0},rr.prototype._hash=function(){var hr=I.allocUnsafe(20);return hr.writeInt32BE(this._a|0,0),hr.writeInt32BE(this._b|0,4),hr.writeInt32BE(this._c|0,8),hr.writeInt32BE(this._d|0,12),hr.writeInt32BE(this._e|0,16),hr},sha1=rr,sha1}var sha256,hasRequiredSha256;function requireSha256(){if(hasRequiredSha256)return sha256;hasRequiredSha256=1;var k=requireInherits_browser(),e=requireHash(),I=requireSafeBuffer().Buffer,B=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],tr=new Array(64);function rr(){this.init(),this._w=tr,e.call(this,64,56)}k(rr,e),rr.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function ir(_r,gr,Sr){return Sr^_r&(gr^Sr)}function lr(_r,gr,Sr){return _r&gr|Sr&(_r|gr)}function dr(_r){return(_r>>>2|_r<<30)^(_r>>>13|_r<<19)^(_r>>>22|_r<<10)}function mr(_r){return(_r>>>6|_r<<26)^(_r>>>11|_r<<21)^(_r>>>25|_r<<7)}function hr(_r){return(_r>>>7|_r<<25)^(_r>>>18|_r<<14)^_r>>>3}function fr(_r){return(_r>>>17|_r<<15)^(_r>>>19|_r<<13)^_r>>>10}return rr.prototype._update=function(_r){for(var gr=this._w,Sr=this._a|0,Ar=this._b|0,Or=this._c|0,Fr=this._d|0,vr=this._e|0,xr=this._f|0,kr=this._g|0,Gr=this._h|0,is=0;is<16;++is)gr[is]=_r.readInt32BE(is*4);for(;is<64;++is)gr[is]=fr(gr[is-2])+gr[is-7]+hr(gr[is-15])+gr[is-16]|0;for(var as=0;as<64;++as){var cs=Gr+mr(vr)+ir(vr,xr,kr)+B[as]+gr[as]|0,es=dr(Sr)+lr(Sr,Ar,Or)|0;Gr=kr,kr=xr,xr=vr,vr=Fr+cs|0,Fr=Or,Or=Ar,Ar=Sr,Sr=cs+es|0}this._a=Sr+this._a|0,this._b=Ar+this._b|0,this._c=Or+this._c|0,this._d=Fr+this._d|0,this._e=vr+this._e|0,this._f=xr+this._f|0,this._g=kr+this._g|0,this._h=Gr+this._h|0},rr.prototype._hash=function(){var _r=I.allocUnsafe(32);return _r.writeInt32BE(this._a,0),_r.writeInt32BE(this._b,4),_r.writeInt32BE(this._c,8),_r.writeInt32BE(this._d,12),_r.writeInt32BE(this._e,16),_r.writeInt32BE(this._f,20),_r.writeInt32BE(this._g,24),_r.writeInt32BE(this._h,28),_r},sha256=rr,sha256}var sha224,hasRequiredSha224;function requireSha224(){if(hasRequiredSha224)return sha224;hasRequiredSha224=1;var k=requireInherits_browser(),e=requireSha256(),I=requireHash(),B=requireSafeBuffer().Buffer,tr=new Array(64);function rr(){this.init(),this._w=tr,I.call(this,64,56)}return k(rr,e),rr.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},rr.prototype._hash=function(){var ir=B.allocUnsafe(28);return ir.writeInt32BE(this._a,0),ir.writeInt32BE(this._b,4),ir.writeInt32BE(this._c,8),ir.writeInt32BE(this._d,12),ir.writeInt32BE(this._e,16),ir.writeInt32BE(this._f,20),ir.writeInt32BE(this._g,24),ir},sha224=rr,sha224}var sha512,hasRequiredSha512;function requireSha512(){if(hasRequiredSha512)return sha512;hasRequiredSha512=1;var k=requireInherits_browser(),e=requireHash(),I=requireSafeBuffer().Buffer,B=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],tr=new Array(160);function rr(){this.init(),this._w=tr,e.call(this,128,112)}k(rr,e),rr.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function ir(Ar,Or,Fr){return Fr^Ar&(Or^Fr)}function lr(Ar,Or,Fr){return Ar&Or|Fr&(Ar|Or)}function dr(Ar,Or){return(Ar>>>28|Or<<4)^(Or>>>2|Ar<<30)^(Or>>>7|Ar<<25)}function mr(Ar,Or){return(Ar>>>14|Or<<18)^(Ar>>>18|Or<<14)^(Or>>>9|Ar<<23)}function hr(Ar,Or){return(Ar>>>1|Or<<31)^(Ar>>>8|Or<<24)^Ar>>>7}function fr(Ar,Or){return(Ar>>>1|Or<<31)^(Ar>>>8|Or<<24)^(Ar>>>7|Or<<25)}function _r(Ar,Or){return(Ar>>>19|Or<<13)^(Or>>>29|Ar<<3)^Ar>>>6}function gr(Ar,Or){return(Ar>>>19|Or<<13)^(Or>>>29|Ar<<3)^(Ar>>>6|Or<<26)}function Sr(Ar,Or){return Ar>>>0<Or>>>0?1:0}return rr.prototype._update=function(Ar){for(var Or=this._w,Fr=this._ah|0,vr=this._bh|0,xr=this._ch|0,kr=this._dh|0,Gr=this._eh|0,is=this._fh|0,as=this._gh|0,cs=this._hh|0,es=this._al|0,ps=this._bl|0,Ur=this._cl|0,Lr=this._dl|0,ts=this._el|0,rs=this._fl|0,ss=this._gl|0,ls=this._hl|0,os=0;os<32;os+=2)Or[os]=Ar.readInt32BE(os*4),Or[os+1]=Ar.readInt32BE(os*4+4);for(;os<160;os+=2){var us=Or[os-30],ys=Or[os-15*2+1],bs=hr(us,ys),As=fr(ys,us);us=Or[os-2*2],ys=Or[os-2*2+1];var vs=_r(us,ys),gs=gr(ys,us),xs=Or[os-7*2],Is=Or[os-7*2+1],Ns=Or[os-16*2],Vs=Or[os-16*2+1],Ls=As+Is|0,ks=bs+xs+Sr(Ls,As)|0;Ls=Ls+gs|0,ks=ks+vs+Sr(Ls,gs)|0,Ls=Ls+Vs|0,ks=ks+Ns+Sr(Ls,Vs)|0,Or[os]=ks,Or[os+1]=Ls}for(var Fs=0;Fs<160;Fs+=2){ks=Or[Fs],Ls=Or[Fs+1];var Os=lr(Fr,vr,xr),Hs=lr(es,ps,Ur),Gs=dr(Fr,es),sa=dr(es,Fr),aa=mr(Gr,ts),Ws=mr(ts,Gr),Ys=B[Fs],na=B[Fs+1],ia=ir(Gr,is,as),Zs=ir(ts,rs,ss),Qs=ls+Ws|0,Ps=cs+aa+Sr(Qs,ls)|0;Qs=Qs+Zs|0,Ps=Ps+ia+Sr(Qs,Zs)|0,Qs=Qs+na|0,Ps=Ps+Ys+Sr(Qs,na)|0,Qs=Qs+Ls|0,Ps=Ps+ks+Sr(Qs,Ls)|0;var Bs=sa+Hs|0,ea=Gs+Os+Sr(Bs,sa)|0;cs=as,ls=ss,as=is,ss=rs,is=Gr,rs=ts,ts=Lr+Qs|0,Gr=kr+Ps+Sr(ts,Lr)|0,kr=xr,Lr=Ur,xr=vr,Ur=ps,vr=Fr,ps=es,es=Qs+Bs|0,Fr=Ps+ea+Sr(es,Qs)|0}this._al=this._al+es|0,this._bl=this._bl+ps|0,this._cl=this._cl+Ur|0,this._dl=this._dl+Lr|0,this._el=this._el+ts|0,this._fl=this._fl+rs|0,this._gl=this._gl+ss|0,this._hl=this._hl+ls|0,this._ah=this._ah+Fr+Sr(this._al,es)|0,this._bh=this._bh+vr+Sr(this._bl,ps)|0,this._ch=this._ch+xr+Sr(this._cl,Ur)|0,this._dh=this._dh+kr+Sr(this._dl,Lr)|0,this._eh=this._eh+Gr+Sr(this._el,ts)|0,this._fh=this._fh+is+Sr(this._fl,rs)|0,this._gh=this._gh+as+Sr(this._gl,ss)|0,this._hh=this._hh+cs+Sr(this._hl,ls)|0},rr.prototype._hash=function(){var Ar=I.allocUnsafe(64);function Or(Fr,vr,xr){Ar.writeInt32BE(Fr,xr),Ar.writeInt32BE(vr,xr+4)}return Or(this._ah,this._al,0),Or(this._bh,this._bl,8),Or(this._ch,this._cl,16),Or(this._dh,this._dl,24),Or(this._eh,this._el,32),Or(this._fh,this._fl,40),Or(this._gh,this._gl,48),Or(this._hh,this._hl,56),Ar},sha512=rr,sha512}var sha384,hasRequiredSha384;function requireSha384(){if(hasRequiredSha384)return sha384;hasRequiredSha384=1;var k=requireInherits_browser(),e=requireSha512(),I=requireHash(),B=requireSafeBuffer().Buffer,tr=new Array(160);function rr(){this.init(),this._w=tr,I.call(this,128,112)}return k(rr,e),rr.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},rr.prototype._hash=function(){var ir=B.allocUnsafe(48);function lr(dr,mr,hr){ir.writeInt32BE(dr,hr),ir.writeInt32BE(mr,hr+4)}return lr(this._ah,this._al,0),lr(this._bh,this._bl,8),lr(this._ch,this._cl,16),lr(this._dh,this._dl,24),lr(this._eh,this._el,32),lr(this._fh,this._fl,40),ir},sha384=rr,sha384}var hasRequiredSha_js;function requireSha_js(){if(hasRequiredSha_js)return sha_js.exports;hasRequiredSha_js=1;var k=sha_js.exports=function(I){I=I.toLowerCase();var B=k[I];if(!B)throw new Error(I+" is not supported (we accept pull requests)");return new B};return k.sha=requireSha(),k.sha1=requireSha1(),k.sha224=requireSha224(),k.sha256=requireSha256(),k.sha384=requireSha384(),k.sha512=requireSha512(),sha_js.exports}var sha_jsExports=requireSha_js(),shajs=getDefaultExportFromCjs$1(sha_jsExports);function camelCase(k,e=!1){return e&&(k=" "+k),k.replace(/^([A-Z])|[\s-_](\w)/g,function(I,B,tr){return tr?tr.toUpperCase():B.toLowerCase()})}function snakeCase(k){return k.replace(/([A-Z])([A-Z])([a-z])/g,"$1_$2$3").replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase()}function titleCase(k){return k.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())}function shorten(k,e={}){const{segmentLength:I=4,separator:B="__",termLength:tr=2}=e;return k.split(B).reduce((lr,dr)=>{const mr=dr.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),hr=mr.length>1?tr:I,fr=mr.map(_r=>_r.substr(0,hr)).join("");return lr.push(fr),lr},[]).join(B)}function hash(k,e={}){const I=shajs("sha1");I.update(k,"utf8");const B=I.digest("hex");return e.length?B.slice(0,e.length):B}class VersionUtils{static isGreaterOrEqual(e,I){const B=parseVersion(e),tr=parseVersion(I);return B[0]>tr[0]||B[0]===tr[0]&&B[1]>tr[1]||B[0]===tr[0]&&B[1]===tr[1]&&B[2]>=tr[2]}}function parseVersion(k=""){const e=[0,0,0];return k.split(".").forEach((I,B)=>e[B]=parseInt(I,10)),e}class DriverUtils{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,I){return e.version!=null&&VersionUtils.isGreaterOrEqual(e.version,I)}static isPostgresFamily(e){return["postgres","aurora-postgres","cockroachdb"].includes(e.options.type)}static buildDriverOptions(e,I){if(e.url){const B=this.parseConnectionUrl(e.url);I&&I.useSid&&B.database&&(B.sid=B.database);for(const tr of Object.keys(B))typeof B[tr]>"u"&&delete B[tr];return Object.assign({},e,B)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,I){if(e.url){const B=this.parseMongoDBConnectionUrl(e.url);I&&I.useSid&&B.database&&(B.sid=B.database);for(const tr of Object.keys(B))typeof B[tr]>"u"&&delete B[tr];return Object.assign({},e,B)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},I,...B){const tr=I&&I.joiner?I.joiner:"_";let rr=B.length===1?B[0]:B.join(tr);if(e&&e>0&&rr.length>e){if(I&&I.shorten===!0){const ir=shorten(rr);if(ir.length<e)return ir}return hash(rr,{length:e})}return rr}static buildColumnAlias({maxAliasLength:e},I,...B){return typeof I=="string"?(B.unshift(I),I={shorten:!1,joiner:"_"}):I=Object.assign({shorten:!1,joiner:"_"},I),this.buildAlias({maxAliasLength:e},I,...B)}static parseConnectionUrl(e){const I=e.split(":")[0],B=e.indexOf("//"),tr=e.substr(B+2),rr=tr.indexOf("/"),ir=rr!==-1?tr.substr(0,rr):tr;let lr=rr!==-1?tr.substr(rr+1):void 0;lr&&lr.indexOf("?")!==-1&&(lr=lr.substr(0,lr.indexOf("?")));const dr=ir.lastIndexOf("@"),mr=ir.substr(0,dr),hr=ir.substr(dr+1);let fr=mr,_r="";const gr=mr.indexOf(":");gr!==-1&&(fr=mr.substr(0,gr),_r=mr.substr(gr+1));const[Sr,Ar]=hr.split(":");return{type:I,host:Sr,username:decodeURIComponent(fr),password:decodeURIComponent(_r),port:Ar?parseInt(Ar):void 0,database:lr||void 0}}static parseMongoDBConnectionUrl(e){const I=e.split(":")[0],B=e.indexOf("//"),tr=e.substr(B+2),rr=tr.indexOf("/"),ir=rr!==-1?tr.substr(0,rr):tr;let lr=rr!==-1?tr.substr(rr+1):void 0,dr="",mr,hr,fr,_r,gr={};if(lr&&lr.indexOf("?")!==-1){dr=lr.substr(lr.indexOf("?")+1,lr.length);const Gr=dr.split("&");let is,as;Gr.forEach(cs=>{is=cs.split("=")[0],as=cs.split("=")[1],gr[is]=as}),_r=gr.replicaSet,lr=lr.substr(0,lr.indexOf("?"))}const Sr=ir.lastIndexOf("@"),Ar=ir.substr(0,Sr),Or=ir.substr(Sr+1);let Fr=Ar,vr="";const xr=Ar.indexOf(":");xr!==-1&&(Fr=Ar.substr(0,xr),vr=Ar.substr(xr+1)),_r?fr=Or:[mr,hr]=Or.split(":");let kr={type:I,host:mr,hostReplicaSet:fr,username:decodeURIComponent(Fr),password:decodeURIComponent(vr),port:hr?parseInt(hr):void 0,database:lr||void 0};for(const[Gr,is]of Object.entries(gr))kr[Gr]=is;return kr}}class JoinAttribute{constructor(e,I,B){this.connection=e,this.queryExpressionMap=I,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,B&&ObjectUtils.assign(this,B)}get isMany(){return this.isMappingMany!==void 0?this.isMappingMany:this.relation?this.relation.isManyToMany||this.relation.isOneToMany:!1}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const I of this.queryExpressionMap.selects)if(I.selection===this.alias.name||this.metadata&&this.metadata.columns.find(B=>I.selection===this.alias.name+"."+B.propertyPath))return!0;return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return;const I=this.queryExpressionMap.findAliasByName(this.parentAlias);let B=I.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(B||I.metadata.parentEntityMetadata&&(B=I.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),B))return B;throw new TypeORMError(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){if(this.relation)return this.relation.inverseEntityMetadata;if(this.connection.hasMetadata(this.entityOrProperty))return this.connection.getMetadata(this.entityOrProperty);if(this.mapAsEntity&&this.connection.hasMetadata(this.mapAsEntity))return this.connection.getMetadata(this.mapAsEntity)}get junctionAlias(){if(!this.relation)throw new TypeORMError("Cannot get junction table for join without relation.");if(typeof this.entityOrProperty!="string")throw new TypeORMError("Junction property is not defined.");const e=this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."));return this.relation.isOwning?DriverUtils.buildAlias(this.connection.driver,void 0,e,this.alias.name):DriverUtils.buildAlias(this.connection.driver,void 0,this.alias.name,e)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}class RelationIdAttribute{constructor(e,I){this.queryExpressionMap=e,this.disableMixedMap=!1,ObjectUtils.assign(this,I||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");const I=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!I)throw new TypeORMError(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return I}get junctionAlias(){const[e,I]=this.relationName.split(".");return e+"_"+I+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}class RelationCountAttribute{constructor(e,I){this.expressionMap=e,ObjectUtils.assign(this,I||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,I]=this.relationName.split(".");return e+"_"+I+"_rc"}get relation(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value is a string representation of alias property");const[e,I]=this.relationName.split("."),tr=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(I);if(!tr)throw new TypeORMError(`Relation with property path ${I} in entity was not found.`);return tr}get metadata(){if(!QueryBuilderUtils.isAliasProperty(this.relationName))throw new TypeORMError("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}class QueryExpressionMap{constructor(e){this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy),this.timeTravel=e.options?.timeTravelQueries||!1}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&this.options.indexOf("disable-global-order")===-1){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce((I,B)=>(I[this.mainAlias.name+"."+B]=e[B],I),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let I=e.name;!I&&e.tablePath&&(I=e.tablePath),!I&&typeof e.target=="function"&&(I=e.target.name),!I&&typeof e.target=="string"&&(I=e.target);const B=new Alias;return B.type=e.type,I&&(B.name=I),e.metadata&&(B.metadata=e.metadata),e.target&&!B.hasMetadata&&(B.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(B.tablePath=e.tablePath),e.subQuery&&(B.subQuery=e.subQuery),this.aliases.push(B),B}findAliasByName(e){const I=this.aliases.find(B=>B.name===e);if(!I)throw new TypeORMError(`"${e}" alias was not found. Maybe you forgot to join it?`);return I}findColumnByAliasExpression(e){const[I,B]=e.split(".");return this.findAliasByName(I).metadata.findColumnWithPropertyName(B)}get relationMetadata(){if(!this.mainAlias)throw new TypeORMError("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new TypeORMError(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new QueryExpressionMap(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map(I=>I),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(I=>e.aliases.push(new Alias(I))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map(I=>new JoinAttribute(this.connection,this,I)),e.relationIdAttributes=this.relationIdAttributes.map(I=>new RelationIdAttribute(this,I)),e.relationCountAttributes=this.relationCountAttributes.map(I=>new RelationCountAttribute(this,I)),e.wheres=this.wheres.map(I=>({...I})),e.havings=this.havings.map(I=>({...I})),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map(I=>I),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.timeTravel=this.timeTravel,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map(I=>({alias:I.alias,queryBuilder:typeof I.queryBuilder=="string"?I.queryBuilder:I.queryBuilder.clone(),options:I.options})),e}}class Brackets{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}class ApplyValueTransformers{static transformFrom(e,I){return Array.isArray(e)?e.slice().reverse().reduce((tr,rr)=>rr.from(tr),I):e.from(I)}static transformTo(e,I){return Array.isArray(e)?e.reduce((B,tr)=>tr.to(B),I):e.to(I)}}class FindOperator{constructor(e,I,B=!0,tr=!1,rr,ir){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=I,this._useParameter=B,this._multipleParameters=tr,this._getSql=rr,this._objectLiteralParameters=ir}get useParameter(){return InstanceChecker.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return InstanceChecker.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return InstanceChecker.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return InstanceChecker.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(InstanceChecker.isFindOperator(this._value))return this._value}get getSql(){return InstanceChecker.isFindOperator(this._value)?this._value.getSql:this._getSql}transformValue(e){this._value instanceof FindOperator?this._value.transformValue(e):this._value=Array.isArray(this._value)&&this._multipleParameters?this._value.map(I=>e&&ApplyValueTransformers.transformTo(e,I)):ApplyValueTransformers.transformTo(e,this._value)}}function In$1(k){return new FindOperator("in",k,!0,!0)}const ESCAPE_REGEXP=/[.*+\-?^${}()|[\]\\]/g,escapeRegExp=k=>k.replace(ESCAPE_REGEXP,"\\$&");class QueryBuilder{constructor(e,I){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,InstanceChecker.isDataSource(e)?(this.connection=e,this.queryRunner=I,this.expressionMap=new QueryExpressionMap(this.connection)):(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone())}static registerQueryBuilderClass(e,I){QueryBuilder.queryBuilderRegistry[e]=I}get alias(){if(!this.expressionMap.mainAlias)throw new TypeORMError("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,I){return this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map(B=>({selection:B})):e&&(this.expressionMap.selects=[{selection:e,aliasName:I}]),InstanceChecker.isSelectQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.SelectQueryBuilder(this)}insert(){return this.expressionMap.queryType="insert",InstanceChecker.isInsertQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.InsertQueryBuilder(this)}update(e,I){const B=I||e;if(e=InstanceChecker.isEntitySchema(e)?e.options.name:e,typeof e=="function"||typeof e=="string"){const tr=this.createFromAlias(e);this.expressionMap.setMainAlias(tr)}return this.expressionMap.queryType="update",this.expressionMap.valuesSet=B,InstanceChecker.isUpdateQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.UpdateQueryBuilder(this)}delete(){return this.expressionMap.queryType="delete",InstanceChecker.isDeleteQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.DeleteQueryBuilder(this)}softDelete(){return this.expressionMap.queryType="soft-delete",InstanceChecker.isSoftDeleteQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}restore(){return this.expressionMap.queryType="restore",InstanceChecker.isSoftDeleteQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}relation(e,I){const B=arguments.length===2?e:void 0,tr=arguments.length===2?I:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=tr,B){const rr=this.createFromAlias(B);this.expressionMap.setMainAlias(rr)}return InstanceChecker.isRelationQueryBuilder(this)?this:QueryBuilder.queryBuilderRegistry.RelationQueryBuilder(this)}hasRelation(e,I){const B=this.connection.getMetadata(e);return(Array.isArray(I)?I:[I]).every(rr=>!!B.findRelationWithPropertyPath(rr))}hasParameter(e){return this.parentQueryBuilder?.hasParameter(e)||e in this.expressionMap.parameters}setParameter(e,I){if(typeof I=="function")throw new TypeORMError(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new TypeORMError("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,I),this.expressionMap.parameters[e]=I,this}setParameters(e){for(const[I,B]of Object.entries(e))this.setParameter(I,B);return this}createParameter(e){let I;do I=`orm_param_${this.parameterIndex++}`;while(this.hasParameter(I));return this.setParameter(I,e),`:${I}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(I=>{this.expressionMap.nativeParameters[I]=e[I]}),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const I=this.expressionMap.mainAlias.metadata;if(I.discriminatorColumn&&I.parentEntityMetadata){const B=I.childEntityMetadatas.filter(tr=>tr.discriminatorColumn).map(tr=>tr.discriminatorValue);B.push(I.discriminatorValue),e.discriminatorColumnValues=B}}return e}printSql(){const[e,I]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,I),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),I=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,I,this.expressionMap.nativeParameters)}async execute(){const[e,I]=this.getQueryAndParameters(),B=this.obtainQueryRunner();try{return await B.query(e,I)}finally{B!==this.queryRunner&&await B.release()}}createQueryBuilder(e){return new this.constructor(this.connection,e??this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,I,B){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:I,options:B||{}}),this}getTableName(e){return e.split(".").map(I=>I===""?I:this.escape(I)).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new TypeORMError('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,I){if(this.connection.hasMetadata(e)){const B=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:I,metadata:this.connection.getMetadata(e),tablePath:B.tablePath})}else{if(typeof e=="string"){const rr=e.substr(0,1)==="("&&e.substr(-1)===")";return this.expressionMap.createAlias({type:"from",name:I,tablePath:rr?void 0:e,subQuery:rr?e:void 0})}const B=e(this.subQuery());this.setParameters(B.getParameters());const tr=B.getQuery();return this.expressionMap.createAlias({type:"from",name:I,subQuery:tr})}}replacePropertyNames(e){return e}replacePropertyNamesForTheWholeQuery(e){const I={};for(const rr of this.expressionMap.aliases){if(!rr.hasMetadata)continue;const ir=this.expressionMap.aliasNamePrefixingEnabled&&rr.name?`${rr.name}.`:"";I[ir]||(I[ir]={});for(const lr of rr.metadata.relations)lr.joinColumns.length>0&&(I[ir][lr.propertyPath]=lr.joinColumns[0].databaseName);for(const lr of rr.metadata.relations){const dr=[...lr.joinColumns,...lr.inverseJoinColumns];for(const mr of dr){const hr=`${lr.propertyPath}.${mr.referencedColumn.propertyPath}`;I[ir][hr]=mr.databaseName}}for(const lr of rr.metadata.columns)I[ir][lr.databaseName]=lr.databaseName;for(const lr of rr.metadata.columns)I[ir][lr.propertyName]=lr.databaseName;for(const lr of rr.metadata.columns)I[ir][lr.propertyPath]=lr.databaseName}const B=Object.keys(I),tr=B.map(rr=>escapeRegExp(rr)).join("|");return B.length>0&&(e=e.replace(new RegExp(`([ =(]|^.{0})${tr?"("+tr+")":""}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),(...rr)=>{let ir,lr,dr;if(tr){if(ir=rr[0],lr=rr[1],dr=rr[3],I[rr[2]][dr])return`${lr}${this.escape(rr[2].substring(0,rr[2].length-1))}.${this.escape(I[rr[2]][dr])}`}else if(ir=rr[0],lr=rr[1],dr=rr[2],I[""][dr])return`${lr}${this.escape(I[""][dr])}`;return ir})),e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace(/\*\//g,"")} */ `:""}createTimeTravelQuery(){return this.expressionMap.queryType==="select"&&this.expressionMap.timeTravel?` AS OF SYSTEM TIME ${this.expressionMap.timeTravel}`:""}createWhereExpression(){const e=[],I=this.createWhereClausesExpression(this.expressionMap.wheres);if(I.length>0&&I!=="1=1"&&e.push(this.replacePropertyNames(I)),this.expressionMap.mainAlias.hasMetadata){const tr=this.expressionMap.mainAlias.metadata;if(this.expressionMap.queryType==="select"&&!this.expressionMap.withDeleted&&tr.deleteDateColumn){const rr=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+tr.deleteDateColumn.propertyName:tr.deleteDateColumn.propertyName,ir=`${this.replacePropertyNames(rr)} IS NULL`;e.push(ir)}if(tr.discriminatorColumn&&tr.parentEntityMetadata){const rr=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+tr.discriminatorColumn.databaseName:tr.discriminatorColumn.databaseName,ir=`${this.replacePropertyNames(rr)} IN (:...discriminatorColumnValues)`;e.push(ir)}}if(this.expressionMap.extraAppendedAndWhereCondition){const tr=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(tr)}let B="";return B+=this.createTimeTravelQuery(),e.length?e.length===1?B+=` WHERE ${e[0]}`:B+=` WHERE ( ${e.join(" ) AND ( ")} )`:B+="",B}createReturningExpression(e){const I=this.getReturningColumns(),B=this.connection.driver;if(typeof this.expressionMap.returning!="string"&&this.expressionMap.extraReturningColumns.length>0&&B.isReturningSqlSupported(e)&&I.push(...this.expressionMap.extraReturningColumns.filter(tr=>I.indexOf(tr)===-1)),I.length){let tr=I.map(rr=>{const ir=this.escape(rr.databaseName);return B.options.type==="mssql"?this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update"||this.expressionMap.queryType==="soft-delete"||this.expressionMap.queryType==="restore"?"INSERTED."+ir:this.escape(this.getMainTableName())+"."+ir:ir}).join(", ");return B.options.type==="oracle"&&(tr+=" INTO "+I.map(rr=>this.createParameter({type:B.columnTypeToNativeParameter(rr.type),dir:B.oracle.BIND_OUT})).join(", ")),B.options.type==="mssql"&&(this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update")&&(tr+=" INTO @OutputTable"),tr}else if(typeof this.expressionMap.returning=="string")return this.expressionMap.returning;return""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(I=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(I))}),e}createWhereClausesExpression(e){return e.map((I,B)=>{const tr=this.createWhereConditionExpression(I.condition);switch(I.type){case"and":return(B>0?"AND ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${tr}${this.connection.options.isolateWhereStatements?")":""}`;case"or":return(B>0?"OR ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${tr}${this.connection.options.isolateWhereStatements?")":""}`}return tr}).join(" ").trim()}createWhereConditionExpression(e,I=!1){if(typeof e=="string")return e;if(Array.isArray(e))return e.length===0?"1=1":e.length===1&&!I?this.createWhereClausesExpression(e):"("+this.createWhereClausesExpression(e)+")";const{driver:B}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"jsonContains":return`${e.parameters[0]} ::jsonb @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return B.options.type==="postgres"||B.options.type==="cockroachdb"?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return B.options.type==="cockroachdb"?`${e.parameters[0]}::STRING = ANY(${e.parameters[1]}::STRING[])`:`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`;case"and":return"("+e.parameters.join(" AND ")+")";case"or":return"("+e.parameters.join(" OR ")+")"}throw new TypeError(`Unsupported FindOperator ${FindOperator.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map(B=>{const tr=typeof B.queryBuilder=="string"?B.queryBuilder:B.queryBuilder.getQuery();if(typeof B.queryBuilder!="string"){if(B.queryBuilder.hasCommonTableExpressions())throw new TypeORMError(`Nested CTEs aren't supported (CTE: ${B.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!InstanceChecker.isSelectQueryBuilder(B.queryBuilder))throw new TypeORMError(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${B.alias})`);this.setParameters(B.queryBuilder.getParameters())}let rr=this.escape(B.alias);if(B.options.columnNames){const dr=B.options.columnNames.map(mr=>this.escape(mr));if(InstanceChecker.isSelectQueryBuilder(B.queryBuilder)&&B.queryBuilder.expressionMap.selects.length&&B.options.columnNames.length!==B.queryBuilder.expressionMap.selects.length)throw new TypeORMError(`cte.options.columnNames length (${B.options.columnNames.length}) doesn't match subquery select list length ${B.queryBuilder.expressionMap.selects.length} (CTE: ${B.alias})`);rr+=`(${dr.join(", ")})`}const ir=B.options.recursive&&e?"RECURSIVE":"";let lr="";return this.connection.driver.cteCapabilities.materializedHint&&B.options.materialized!==void 0&&(lr=B.options.materialized?"MATERIALIZED":"NOT MATERIALIZED"),[ir,rr,"AS",lr,`(${tr})`].filter(Boolean).join(" ")}).join(", ")+" "}getWhereInIdsCondition(e){const I=this.expressionMap.mainAlias.metadata,B=(Array.isArray(e)?e:[e]).map(tr=>I.ensureEntityIdMap(tr));if(!I.hasMultiplePrimaryKeys){const tr=I.primaryColumns[0];if(!tr.transformer&&!tr.relationMetadata&&!tr.embeddedMetadata)return{[tr.propertyName]:In$1(B.map(rr=>tr.getEntityValue(rr,!1)))}}return new Brackets(tr=>{for(const rr of B)tr.orWhere(new Brackets(ir=>ir.where(rr)))})}getExistsCondition(e){const I=e.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select("1").setOption("disable-global-order");return[`EXISTS (${I.getQuery()})`,I.getParameters()]}findColumnsForPropertyPath(e){let I=this.expressionMap.mainAlias;const B=[],tr=e.split(".");for(;tr.length>1;){const lr=tr[0];if(!I?.hasMetadata)break;if(I.metadata.hasEmbeddedWithPropertyPath(lr)){tr.unshift(`${tr.shift()}.${tr.shift()}`);continue}if(I.metadata.hasRelationWithPropertyPath(lr)){const dr=this.expressionMap.joinAttributes.find(mr=>mr.relationPropertyPath===lr);if(!dr?.alias){const mr=B.length>0?`${B.join(".")}.${lr}`:lr;throw new Error(`Cannot find alias for relation at ${mr}`)}I=dr.alias,B.push(...lr.split(".")),tr.shift();continue}break}if(!I)throw new Error(`Cannot find alias for property ${e}`);const rr=tr.join("."),ir=I.metadata.findColumnsWithPropertyPath(rr);if(!ir.length)throw new EntityPropertyNotFoundError(e,I.metadata);return[I,B,ir]}createPropertyPath(e,I,B=""){const tr=[];for(const rr of Object.keys(I)){const ir=B?`${B}.${rr}`:rr;if(I[rr]===null||typeof I[rr]!="object"||InstanceChecker.isFindOperator(I[rr])){tr.push(ir);continue}if(e.hasEmbeddedWithPropertyPath(ir)){const lr=this.createPropertyPath(e,I[rr],ir);tr.push(...lr);continue}if(e.hasRelationWithPropertyPath(ir)){const lr=e.findRelationWithPropertyPath(ir);if(lr.relationType==="one-to-one"||lr.relationType==="many-to-one"){const fr=lr.joinColumns.map(gr=>gr.referencedColumn).filter(gr=>!!gr);if(fr.length>0&&fr.every(gr=>gr.getEntityValue(I[rr],!1))){tr.push(ir);continue}}if(lr.relationType==="one-to-many"||lr.relationType==="many-to-many")throw new Error(`Cannot query across ${lr.relationType} for property ${ir}`);const dr=lr.inverseEntityMetadata.primaryColumns;if(dr.length>0&&dr.every(fr=>fr.getEntityValue(I[rr],!1))){const fr=dr.map(_r=>`${ir}.${_r.propertyPath}`);tr.push(...fr);continue}const hr=this.createPropertyPath(lr.inverseEntityMetadata,I[rr]).map(fr=>`${ir}.${fr}`);tr.push(...hr);continue}tr.push(ir)}return tr}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const I=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const B of I){const[tr,rr,ir]=this.findColumnsForPropertyPath(B);for(const lr of ir){let dr=e;for(const fr of rr){if(!dr||!(fr in dr)){dr={};break}dr=dr[fr]}const mr=this.expressionMap.aliasNamePrefixingEnabled?`${tr.name}.${lr.propertyPath}`:lr.propertyPath,hr=lr.getEntityValue(dr,!0);yield[mr,hr]}}}else for(const I of Object.keys(e)){const B=e[I];yield[this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${I}`:I,B]}}getWherePredicateCondition(e,I){if(InstanceChecker.isFindOperator(I)){let B=[];if(I.useParameter)if(I.objectLiteralParameters)this.setParameters(I.objectLiteralParameters);else if(I.multipleParameters)for(const tr of I.value)B.push(this.createParameter(tr));else B.push(this.createParameter(I.value));if(I.type==="raw")return I.getSql?I.getSql(e):{operator:"equal",parameters:[e,I.value]};if(I.type==="not")return I.child?{operator:I.type,condition:this.getWherePredicateCondition(e,I.child)}:{operator:"notEqual",parameters:[e,...B]};if(I.type==="and"){const tr=I.value;return{operator:I.type,parameters:tr.map(rr=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,rr)))}}else if(I.type==="or"){const tr=I.value;return{operator:I.type,parameters:tr.map(rr=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,rr)))}}else return{operator:I.type,parameters:[e,...B]}}else return{operator:"equal",parameters:[e,this.createParameter(I)]}}getWhereCondition(e){if(typeof e=="string")return e;if(InstanceChecker.isBrackets(e)){const tr=this.createQueryBuilder();return tr.parentQueryBuilder=this,tr.expressionMap.mainAlias=this.expressionMap.mainAlias,tr.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,tr.expressionMap.parameters=this.expressionMap.parameters,tr.expressionMap.nativeParameters=this.expressionMap.nativeParameters,tr.expressionMap.wheres=[],e.whereFactory(tr),{operator:InstanceChecker.isNotBrackets(e)?"not":"brackets",condition:tr.expressionMap.wheres}}if(typeof e=="function")return e(this);const I=Array.isArray(e)?e:[e],B=[];for(const tr of I){const rr=[];for(const[ir,lr]of this.getPredicates(tr))rr.push({type:"and",condition:this.getWherePredicateCondition(ir,lr)});B.push({type:"or",condition:rr})}return B.length===1?B[0].condition:B}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}QueryBuilder.queryBuilderRegistry={};class DeleteResult{static from(e){const I=new this;return I.raw=e.records,I.affected=e.affected,I}}class DeleteQueryBuilder extends QueryBuilder{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const[e,I]=this.getQueryAndParameters(),B=this.obtainQueryRunner();let tr=!1;try{this.expressionMap.useTransaction===!0&&B.isTransactionActive===!1&&(await B.startTransaction(),tr=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await B.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const rr=await B.query(e,I,!0),ir=DeleteResult.from(rr);return this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await B.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),tr&&await B.commitTransaction(),ir}catch(rr){if(tr)try{await B.rollbackTransaction()}catch{}throw rr}finally{B!==this.queryRunner&&await B.release()}}from(e,I){e=InstanceChecker.isEntitySchema(e)?e.options.name:e;const B=this.createFromAlias(e,I);return this.expressionMap.setMainAlias(B),this}where(e,I){this.expressionMap.wheres=[];const B=this.getWhereCondition(e);return B&&(this.expressionMap.wheres=[{type:"simple",condition:B}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),I=this.createWhereExpression(),B=this.createReturningExpression("delete");return B===""?`DELETE FROM ${e}${I}`:this.connection.driver.options.type==="mssql"?`DELETE FROM ${e} OUTPUT ${B}${I}`:`DELETE FROM ${e}${I} RETURNING ${B}`}}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let k=0;k<256;++k)byteToHex.push((k+256).toString(16).slice(1));function unsafeStringify(k,e=0){return byteToHex[k[e+0]]+byteToHex[k[e+1]]+byteToHex[k[e+2]]+byteToHex[k[e+3]]+"-"+byteToHex[k[e+4]]+byteToHex[k[e+5]]+"-"+byteToHex[k[e+6]]+byteToHex[k[e+7]]+"-"+byteToHex[k[e+8]]+byteToHex[k[e+9]]+"-"+byteToHex[k[e+10]]+byteToHex[k[e+11]]+byteToHex[k[e+12]]+byteToHex[k[e+13]]+byteToHex[k[e+14]]+byteToHex[k[e+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native={randomUUID};function v4(k,e,I){if(native.randomUUID&&!e&&!k)return native.randomUUID();k=k||{};const B=k.random||(k.rng||rng)();return B[6]=B[6]&15|64,B[8]=B[8]&63|128,unsafeStringify(B)}class BroadcasterResult{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}class InsertResult{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const I=new this;return I.raw=e.raw,I}}class ReturningResultsEntityUpdator{constructor(e,I){this.queryRunner=e,this.expressionMap=I}async update(e,I){const B=this.expressionMap.mainAlias.metadata;await Promise.all(I.map(async(tr,rr)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((dr,mr,hr)=>(dr[this.expressionMap.extraReturningColumns[hr].databaseName]=mr[0],dr),{}));const ir=Array.isArray(e.raw)?e.raw[rr]:e.raw,lr=this.queryRunner.connection.driver.createGeneratedMap(B,ir);lr&&(this.queryRunner.manager.merge(B.target,tr,lr),e.generatedMaps.push(lr))}else{const ir=this.expressionMap.extraReturningColumns;if(ir.length>0){const lr=this.expressionMap.mainAlias.metadata.getEntityIdMap(tr);if(!lr)throw new TypeORMError("Cannot update entity because entity id is not set in the entity.");const dr=await this.queryRunner.manager.createQueryBuilder().select(B.primaryColumns.map(mr=>B.targetName+"."+mr.propertyPath)).addSelect(ir.map(mr=>B.targetName+"."+mr.propertyPath)).from(B.target,B.targetName).where(lr).withDeleted().setOption("create-pojo").getOne();dr&&(this.queryRunner.manager.merge(B.target,tr,dr),e.generatedMaps.push(dr))}}}))}async insert(e,I){const B=this.expressionMap.mainAlias.metadata;let tr=B.getInsertionReturningColumns();const rr=this.queryRunner.connection.driver.isReturningSqlSupported("insert");tr=tr.filter(lr=>lr.isGenerated?rr===!0:!0);const ir=I.map((lr,dr)=>{this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((fr,_r,gr)=>(fr[this.expressionMap.extraReturningColumns[gr].databaseName]=_r[0],fr),{}));const mr=Array.isArray(e.raw)?e.raw[dr]:e.raw,hr=this.queryRunner.connection.driver.createGeneratedMap(B,mr,dr,I.length)||{};return dr in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(B.target,hr,this.expressionMap.locallyGenerated[dr]),this.queryRunner.manager.merge(B.target,lr,hr),hr});if(tr.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const lr=I.map(mr=>{const hr=B.getEntityIdMap(mr);if(!hr)throw new TypeORMError("Cannot update entity because entity id is not set in the entity.");return hr}),dr=await this.queryRunner.manager.createQueryBuilder().select(B.primaryColumns.map(mr=>B.targetName+"."+mr.propertyPath)).addSelect(tr.map(mr=>B.targetName+"."+mr.propertyPath)).from(B.target,B.targetName).where(lr).setOption("create-pojo").getMany();I.forEach((mr,hr)=>{this.queryRunner.manager.merge(B.target,ir[hr],dr[hr]),this.queryRunner.manager.merge(B.target,mr,dr[hr])})}I.forEach((lr,dr)=>{const mr=B.getEntityIdMap(lr);e.identifiers.push(mr),e.generatedMaps.push(ir[dr])})}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion)}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion||e.isDeleteDate)}}class InsertQueryBuilder extends QueryBuilder{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.getValueSets();if(e.length===0)return new InsertResult;const I=this.obtainQueryRunner();let B=!1;try{if(this.expressionMap.useTransaction===!0&&I.isTransactionActive===!1&&(await I.startTransaction(),B=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const Sr=new BroadcasterResult;e.forEach(Ar=>{I.broadcaster.broadcastBeforeInsertEvent(Sr,this.expressionMap.mainAlias.metadata,Ar)}),await Sr.wait()}let tr=null,rr=null;const ir=new ReturningResultsEntityUpdator(I,this.expressionMap),lr=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const Sr of this.expressionMap.returning)lr.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(Sr));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver.options.type==="oracle"||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),lr.push(...this.expressionMap.extraReturningColumns.filter(Sr=>!lr.includes(Sr)))),lr.length>0&&this.connection.driver.options.type==="mssql"&&(tr=this.connection.driver.buildTableVariableDeclaration("@OutputTable",lr),rr="SELECT * FROM @OutputTable");const[dr,mr]=this.getQueryAndParameters(),fr=[tr,dr,rr].filter(Sr=>Sr!=null).join(`;

`),_r=await I.query(fr,mr,!0),gr=InsertResult.from(_r);if(this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&await ir.insert(gr,e),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const Sr=new BroadcasterResult;e.forEach(Ar=>{I.broadcaster.broadcastAfterInsertEvent(Sr,this.expressionMap.mainAlias.metadata,Ar)}),await Sr.wait()}return B&&await I.commitTransaction(),gr}catch(tr){if(B)try{await I.rollbackTransaction()}catch{}throw tr}finally{I!==this.queryRunner&&await I.release()}}into(e,I){e=InstanceChecker.isEntitySchema(e)?e.options.name:e;const B=this.createFromAlias(e);return this.expressionMap.setMainAlias(B),this.expressionMap.insertColumns=I||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,I,B){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:I,skipUpdateIfNoValuesChanged:B?.skipUpdateIfNoValuesChanged,indexPredicate:B?.indexPredicate,upsertType:B?.upsertType},this):(this.expressionMap.onUpdate={conflict:e?.conflict_target,columns:e?.columns,overwrite:e?.overwrite,skipUpdateIfNoValuesChanged:B?.skipUpdateIfNoValuesChanged,upsertType:B?.upsertType},this)}createInsertExpression(){const e=this.getTableName(this.getMainTableName()),I=this.createValuesExpression(),B=this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),tr=this.createColumnNamesExpression();let rr="INSERT ";if(this.expressionMap.onUpdate?.upsertType==="primary-key"&&(rr="UPSERT "),(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(rr+=`${this.expressionMap.onIgnore?" IGNORE ":""}`),rr+=`INTO ${e}`,this.alias!==this.getMainTableName()&&DriverUtils.isPostgresFamily(this.connection.driver)&&(rr+=` AS "${this.alias}"`),tr?rr+=`(${tr})`:!I&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(rr+="()"),B&&this.connection.driver.options.type==="mssql"&&(rr+=` OUTPUT ${B}`),I?(this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="sap")&&this.getValueSets().length>1?rr+=` ${I}`:rr+=` VALUES ${I}`:DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"?rr+=" VALUES ()":rr+=" DEFAULT VALUES",this.expressionMap.onUpdate?.upsertType!=="primary-key"){if(this.connection.driver.supportedUpsertTypes.includes("on-conflict-do-update")){if(this.expressionMap.onIgnore)rr+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)rr+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:ir,columns:lr,conflict:dr,skipUpdateIfNoValuesChanged:mr,indexPredicate:hr}=this.expressionMap.onUpdate;let fr="ON CONFLICT";if(Array.isArray(dr)){if(fr+=` ( ${dr.map(gr=>this.escape(gr)).join(", ")} )`,hr&&!DriverUtils.isPostgresFamily(this.connection.driver))throw new TypeORMError("indexPredicate option is not supported by the current database driver");hr&&DriverUtils.isPostgresFamily(this.connection.driver)&&(fr+=` WHERE ( ${hr} )`)}else dr&&(fr+=` ON CONSTRAINT ${this.escape(dr)}`);const _r=[];Array.isArray(ir)?_r.push(...ir.map(gr=>`${this.escape(gr)} = EXCLUDED.${this.escape(gr)}`)):lr&&_r.push(...lr.map(gr=>`${this.escape(gr)} = :${gr}`)),_r.length>0&&(rr+=` ${fr} DO UPDATE SET `,_r.push(...this.expressionMap.mainAlias.metadata.columns.filter(gr=>gr.isUpdateDate&&!ir?.includes(gr.databaseName)&&!(this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1||DriverUtils.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")).map(gr=>`${this.escape(gr.databaseName)} = DEFAULT`)),rr+=_r.join(", "),rr+=" "),Array.isArray(ir)&&mr&&DriverUtils.isPostgresFamily(this.connection.driver)&&(rr+=" WHERE (",rr+=ir.map(gr=>`${e}.${this.escape(gr)} IS DISTINCT FROM EXCLUDED.${this.escape(gr)}`).join(" OR "),rr+=") ")}}else if(this.connection.driver.supportedUpsertTypes.includes("on-duplicate-key-update")){if(this.expressionMap.onUpdate){const{overwrite:ir,columns:lr}=this.expressionMap.onUpdate;Array.isArray(ir)?(rr+=" ON DUPLICATE KEY UPDATE ",rr+=ir.map(dr=>`${this.escape(dr)} = VALUES(${this.escape(dr)})`).join(", "),rr+=" "):Array.isArray(lr)&&(rr+=" ON DUPLICATE KEY UPDATE ",rr+=lr.map(dr=>`${this.escape(dr)} = :${dr}`).join(", "),rr+=" ")}}else if(this.expressionMap.onUpdate)throw new TypeORMError("onUpdate is not supported by the current database driver")}return B&&(DriverUtils.isPostgresFamily(this.connection.driver)||this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="cockroachdb"||DriverUtils.isMySQLFamily(this.connection.driver))&&(rr+=` RETURNING ${B}`),this.connection.driver.options.type==="mssql"&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(ir=>this.expressionMap.insertColumns.length>0?this.expressionMap.insertColumns.indexOf(ir.propertyPath)!==-1:ir.isInsert).some(ir=>this.isOverridingAutoIncrementBehavior(ir))&&(rr=`SET IDENTITY_INSERT ${e} ON; ${rr}; SET IDENTITY_INSERT ${e} OFF`),rr}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(e=>this.expressionMap.insertColumns.length?this.expressionMap.insertColumns.indexOf(e.propertyPath)!==-1:!(!e.isInsert||e.isGenerated&&e.generationStrategy==="increment"&&this.connection.driver.options.type!=="spanner"&&this.connection.driver.options.type!=="oracle"&&!DriverUtils.isSQLiteFamily(this.connection.driver)&&!DriverUtils.isMySQLFamily(this.connection.driver)&&this.connection.driver.options.type!=="aurora-mysql"&&!(this.connection.driver.options.type==="mssql"&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map(I=>this.escape(I.databaseName)).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const I=this.getValueSets();if(I.length===1)return Object.keys(I[0]).map(B=>this.escape(B)).join(", ")}return this.expressionMap.insertColumns.map(I=>this.escape(I)).join(", ")}createValuesExpression(){const e=this.getValueSets(),I=this.getInsertedColumns();if(I.length>0){let B="";return e.forEach((tr,rr)=>{I.forEach((ir,lr)=>{lr===0&&(this.connection.driver.options.type==="oracle"&&e.length>1||this.connection.driver.options.type==="sap"&&e.length>1?B+=" SELECT ":B+="(");let dr=ir.getEntityValue(tr);if(typeof dr!="function"&&(dr=this.connection.driver.preparePersistentValue(dr,ir)),ir.isVersion&&dr===void 0)B+="1";else if(ir.isDiscriminator)B+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(ir.isGenerated&&ir.generationStrategy==="uuid"&&!this.connection.driver.isUUIDGenerationSupported()&&dr===void 0)dr=v4(),B+=this.createParameter(dr),rr in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[rr]={}),ir.setEntityValue(this.expressionMap.locallyGenerated[rr],dr);else if(dr===void 0)this.connection.driver.options.type==="oracle"&&e.length>1||DriverUtils.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?ir.default!==void 0&&ir.default!==null?B+=this.connection.driver.normalizeDefault(ir):B+="NULL":B+="DEFAULT";else if(dr===null&&this.connection.driver.options.type==="spanner")B+="NULL";else if(typeof dr=="function")B+=dr();else{this.connection.driver.options.type==="mssql"&&(dr=this.connection.driver.parametrizeValue(ir,dr));const mr=this.createParameter(dr);if((DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(ir.type)!==-1){const fr=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";ir.srid!=null?B+=`${fr}(${mr}, ${ir.srid})`:B+=`${fr}(${mr})`}else DriverUtils.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(ir.type)!==-1?ir.srid!=null?B+=`ST_SetSRID(ST_GeomFromGeoJSON(${mr}), ${ir.srid})::${ir.type}`:B+=`ST_GeomFromGeoJSON(${mr})::${ir.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(ir.type)!==-1?B+=ir.type+"::STGeomFromText("+mr+", "+(ir.srid||"0")+")":B+=mr}lr===I.length-1?rr===e.length-1?this.connection.driver.options.type==="oracle"&&e.length>1?B+=" FROM DUAL ":this.connection.driver.options.type==="sap"&&e.length>1?B+=" FROM dummy ":B+=")":this.connection.driver.options.type==="oracle"&&e.length>1?B+=" FROM DUAL UNION ALL ":this.connection.driver.options.type==="sap"&&e.length>1?B+=" FROM dummy UNION ALL ":B+="), ":B+=", "})}),B==="()"?"":B}else{let B="";return e.forEach((tr,rr)=>{Object.keys(tr).forEach((lr,dr)=>{dr===0&&(B+="(");const mr=tr[lr];typeof mr=="function"?B+=mr():mr===void 0?this.connection.driver.options.type==="oracle"&&e.length>1||DriverUtils.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?B+="NULL":B+="DEFAULT":mr===null&&this.connection.driver.options.type==="spanner"||(B+=this.createParameter(mr)),dr===Object.keys(tr).length-1?rr===e.length-1?B+=")":B+="), ":B+=", "})}),B==="()"?"":B}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(ObjectUtils.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new InsertValuesMissingError}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&e.generationStrategy==="increment"&&this.getValueSets().some(I=>e.getEntityValue(I)!==void 0&&e.getEntityValue(I)!==null)}}class RelationUpdater{constructor(e,I){this.queryBuilder=e,this.expressionMap=I}async update(e){const I=this.expressionMap.relationMetadata;if(I.isManyToOne||I.isOneToOneOwner){const B=I.joinColumns.reduce((tr,rr)=>{const ir=ObjectUtils.isObject(e)?rr.referencedColumn.getEntityValue(e):e;return rr.setEntityValue(tr,ir),tr},{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(I.entityMetadata.target).set(B).whereInIds(this.expressionMap.of).execute()}else if((I.isOneToOneNotOwner||I.isOneToMany)&&e===null){const B={};I.inverseRelation.joinColumns.forEach(dr=>{B[dr.propertyName]=null});const tr=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],rr={},ir=[];tr.forEach((dr,mr)=>{I.inverseRelation.joinColumns.map((hr,fr)=>{const _r="joinColumn_"+mr+"_"+fr;rr[_r]=ObjectUtils.isObject(dr)?hr.referencedColumn.getEntityValue(dr):dr,ir.push(`${hr.propertyPath} = :${_r}`)})});const lr=ir.map(dr=>"("+dr+")").join(" OR ");if(!lr)return;await this.queryBuilder.createQueryBuilder().update(I.inverseEntityMetadata.target).set(B).where(lr).setParameters(rr).execute()}else if(I.isOneToOneNotOwner||I.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new TypeORMError("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const B=this.expressionMap.of,tr=I.inverseRelation.joinColumns.reduce((rr,ir)=>{const lr=ObjectUtils.isObject(B)?ir.referencedColumn.getEntityValue(B):B;return ir.setEntityValue(rr,lr),rr},{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(I.inverseEntityMetadata.target).set(tr).whereInIds(e).execute()}else{const B=I.junctionEntityMetadata,tr=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],rr=Array.isArray(e)?e:[e],ir=I.isManyToManyOwner?tr:rr,lr=I.isManyToManyOwner?rr:tr,dr=[];if(ir.forEach(mr=>{lr.forEach(hr=>{const fr={};B.ownerColumns.forEach(_r=>{fr[_r.databaseName]=ObjectUtils.isObject(mr)?_r.referencedColumn.getEntityValue(mr):mr}),B.inverseColumns.forEach(_r=>{fr[_r.databaseName]=ObjectUtils.isObject(hr)?_r.referencedColumn.getEntityValue(hr):hr}),dr.push(fr)})}),!dr.length)return;this.queryBuilder.connection.driver.options.type==="oracle"||this.queryBuilder.connection.driver.options.type==="sap"?await Promise.all(dr.map(mr=>this.queryBuilder.createQueryBuilder().insert().into(B.tableName).values(mr).execute())):await this.queryBuilder.createQueryBuilder().insert().into(B.tableName).values(dr).execute()}}}class RelationRemover{constructor(e,I){this.queryBuilder=e,this.expressionMap=I}async remove(e){const I=this.expressionMap.relationMetadata;if(I.isOneToMany){const B=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],tr=Array.isArray(e)?e:[e],rr={};I.inverseRelation.joinColumns.forEach(mr=>{rr[mr.propertyName]=null});const ir={},lr=[];B.forEach((mr,hr)=>{lr.push(...tr.map((fr,_r)=>[...I.inverseRelation.joinColumns.map((gr,Sr)=>{const Ar="joinColumn_"+hr+"_"+_r+"_"+Sr;return ir[Ar]=ObjectUtils.isObject(mr)?gr.referencedColumn.getEntityValue(mr):mr,`${gr.propertyPath} = :${Ar}`}),...I.inverseRelation.entityMetadata.primaryColumns.map((gr,Sr)=>{const Ar="primaryColumn_"+_r+"_"+_r+"_"+Sr;return ir[Ar]=ObjectUtils.isObject(fr)?gr.getEntityValue(fr):fr,`${gr.propertyPath} = :${Ar}`})].join(" AND ")))});const dr=lr.map(mr=>"("+mr+")").join(" OR ");if(!dr)return;await this.queryBuilder.createQueryBuilder().update(I.inverseEntityMetadata.target).set(rr).where(dr).setParameters(ir).execute()}else{const B=I.junctionEntityMetadata,tr=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],rr=Array.isArray(e)?e:[e],ir=I.isManyToManyOwner?tr:rr,lr=I.isManyToManyOwner?rr:tr,dr={},mr=[];ir.forEach((fr,_r)=>{mr.push(...lr.map((gr,Sr)=>[...B.ownerColumns.map((Ar,Or)=>{const Fr="firstValue_"+_r+"_"+Sr+"_"+Or;return dr[Fr]=ObjectUtils.isObject(fr)?Ar.referencedColumn.getEntityValue(fr):fr,`${Ar.databaseName} = :${Fr}`}),...B.inverseColumns.map((Ar,Or)=>{const Fr="secondValue_"+_r+"_"+Sr+"_"+Or;return dr[Fr]=ObjectUtils.isObject(gr)?Ar.referencedColumn.getEntityValue(gr):gr,`${Ar.databaseName} = :${Fr}`})].join(" AND ")))});const hr=mr.map(fr=>"("+fr+")").join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(B.tableName).where(hr).setParameters(dr).execute()}}}class RelationQueryBuilder extends QueryBuilder{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const I=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(I.isManyToMany||I.isOneToMany)throw new TypeORMError(`Set operation is only supported for many-to-one and one-to-one relations. However given "${I.propertyPath}" has ${I.relationType} relation. Use .add() method instead.`);if(I.joinColumns&&I.joinColumns.length>1&&(!ObjectUtils.isObject(e)||Object.keys(e).length<I.joinColumns.length))throw new TypeORMError('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new RelationUpdater(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&e.length===0)return;const I=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(I.isManyToOne||I.isOneToOne)throw new TypeORMError(`Add operation is only supported for many-to-many and one-to-many relations. However given "${I.propertyPath}" has ${I.relationType} relation. Use .set() method instead.`);if(I.joinColumns&&I.joinColumns.length>1&&(!ObjectUtils.isObject(e)||Object.keys(e).length<I.joinColumns.length))throw new TypeORMError('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new RelationUpdater(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&e.length===0)return;const I=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(I.isManyToOne||I.isOneToOne)throw new TypeORMError(`Add operation is only supported for many-to-many and one-to-many relations. However given "${I.propertyPath}" has ${I.relationType} relation. Use .set(null) method instead.`);return new RelationRemover(this,this.expressionMap).remove(e)}async addAndRemove(e,I){await this.remove(I),await this.add(e)}async loadOne(){return this.loadMany().then(e=>e[0])}async loadMany(){let e=this.expressionMap.of;if(!ObjectUtils.isObject(e)){const I=this.expressionMap.mainAlias.metadata;if(I.hasMultiplePrimaryKeys)throw new TypeORMError("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=I.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}class OrmUtils{static chunk(e,I){return Array.from(Array(Math.ceil(e.length/I)),(B,tr)=>e.slice(tr*I,tr*I+I))}static splitClassesAndStrings(e){return[e.filter(I=>typeof I!="string"),e.filter(I=>typeof I=="string")]}static groupBy(e,I){return e.reduce((B,tr)=>{const rr=I(tr);let ir=B.find(lr=>lr.id===rr);return ir||(ir={id:rr,items:[]},B.push(ir)),ir.items.push(tr),B},[])}static uniq(e,I){return e.reduce((B,tr)=>{let rr=!1;if(typeof I=="function"){const ir=I(tr);rr=!!B.find(lr=>I(lr)===ir)}else typeof I=="string"?rr=!!B.find(ir=>ir[I]===tr[I]):rr=B.indexOf(tr)!==-1;return rr||B.push(tr),B},[])}static isPlainObject(e){return e==null?!1:!e.constructor||e.constructor===Object}static mergeArrayKey(e,I,B,tr){if(tr.has(B)){e[I]=tr.get(B);return}if(!(B instanceof Promise)){if(!this.isPlainObject(B)&&!Array.isArray(B)){e[I]=B;return}e[I]||(e[I]=Array.isArray(B)?[]:{}),tr.set(B,e[I]),this.merge(e[I],B,tr),tr.delete(B)}}static mergeObjectKey(e,I,B,tr){if(tr.has(B)){Object.assign(e,{[I]:tr.get(B)});return}if(!(B instanceof Promise)){if(!this.isPlainObject(B)&&!Array.isArray(B)){Object.assign(e,{[I]:B});return}e[I]||Object.assign(e,{[I]:Array.isArray(B)?[]:{}}),tr.set(B,e[I]),this.merge(e[I],B,tr),tr.delete(B)}}static merge(e,I,B=new Map){if(this.isPlainObject(e)&&this.isPlainObject(I))for(const tr of Object.keys(I))tr!=="__proto__"&&this.mergeObjectKey(e,tr,I[tr],B);if(Array.isArray(e)&&Array.isArray(I))for(let tr=0;tr<I.length;tr++)this.mergeArrayKey(e,tr,I[tr],B)}static mergeDeep(e,...I){if(!I.length)return e;for(const B of I)OrmUtils.merge(e,B);return e}static deepCompare(...e){let I,B,tr,rr;if(arguments.length<1)return!0;for(I=1,B=arguments.length;I<B;I++)if(tr=[],rr=[],!this.compare2Objects(tr,rr,arguments[0],arguments[I]))return!1;return!0}static deepValue(e,I){const B=I.split(".");for(let tr=0,rr=B.length;tr<rr;tr++)e=e[B[tr]];return e}static replaceEmptyObjectsWithBooleans(e){for(let I in e)e[I]&&typeof e[I]=="object"&&(Object.keys(e[I]).length===0?e[I]=!0:this.replaceEmptyObjectsWithBooleans(e[I]))}static propertyPathsToTruthyObject(e){let I={};for(let B of e){const tr=B.split(".");if(!tr.length)continue;(!I[tr[0]]||I[tr[0]]===!0)&&(I[tr[0]]={});let rr=I[tr[0]];for(let[ir,lr]of tr.entries())ir!==0&&(rr[lr]?rr=rr[lr]:ir===tr.length-1?(rr[lr]={},rr=null):(rr[lr]={},rr=rr[lr]))}return this.replaceEmptyObjectsWithBooleans(I),I}static compareIds(e,I){return e==null||I===void 0||I===null?!1:(typeof e.id=="string"&&typeof I.id=="string"||typeof e.id=="number"&&typeof I.id=="number")&&Object.keys(e).length===1&&Object.keys(I).length===1?e.id===I.id:OrmUtils.deepCompare(e,I)}static toBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e==="true"||e==="1":typeof e=="number"?e>0:!1}static zipObject(e,I){return e.reduce((B,tr,rr)=>(B[tr]=I[rr],B),{})}static isArraysEqual(e,I){return e.length!==I.length?!1:e.every(B=>I.indexOf(B)!==-1)}static areMutuallyExclusive(...e){return!e.some(B=>{const tr=e.filter(rr=>rr!==B);return B.some(rr=>tr.some(ir=>ir.includes(rr)))})}static parseSqlCheckExpression(e,I){const B=e.match(new RegExp(`"${I}" varchar CHECK\\s*\\(\\s*"${I}"\\s+IN\\s*`));if(B&&B.index){const rr=e.substring(B.index+B[0].length);let ir="",lr="";const dr=[];for(let mr=0;mr<rr.length;mr++){const hr=rr[mr];switch(hr){case",":ir==""?(dr.push(lr),lr=""):lr+=hr;break;case"'":ir==hr?rr[mr+1]===hr?(lr+=hr,mr+=1):ir="":ir=hr;break;case")":if(ir=="")return dr.push(lr),dr;lr+=hr;break;default:ir!=""&&(lr+=hr)}}}}static compare2Objects(e,I,B,tr){let rr;if(Number.isNaN(B)&&Number.isNaN(tr)||B===tr)return!0;if(B===null||tr===null||B===void 0||tr===void 0)return!1;if((typeof B.equals=="function"||typeof B.equals=="function")&&B.equals(tr))return!0;if(typeof B=="function"&&typeof tr=="function"||B instanceof Date&&tr instanceof Date||B instanceof RegExp&&tr instanceof RegExp||typeof B=="string"&&typeof tr=="string"||typeof B=="number"&&typeof tr=="number")return B.toString()===tr.toString();if(!(typeof B=="object"&&typeof tr=="object")||Object.prototype.isPrototypeOf.call(B,tr)||Object.prototype.isPrototypeOf.call(tr,B)||B.constructor!==tr.constructor||B.prototype!==tr.prototype||e.indexOf(B)>-1||I.indexOf(tr)>-1)return!1;for(rr in tr){if(tr.hasOwnProperty(rr)!==B.hasOwnProperty(rr))return!1;if(typeof tr[rr]!=typeof B[rr])return!1}for(rr in B){if(tr.hasOwnProperty(rr)!==B.hasOwnProperty(rr))return!1;if(typeof tr[rr]!=typeof B[rr])return!1;switch(typeof B[rr]){case"object":case"function":if(e.push(B),I.push(tr),!this.compare2Objects(e,I,B[rr],tr[rr]))return!1;e.pop(),I.pop();break;default:if(B[rr]!==tr[rr])return!1;break}}return!0}}class RawSqlResultsToEntityTransformer{constructor(e,I,B,tr,rr){this.expressionMap=e,this.driver=I,this.rawRelationIdResults=B,this.rawRelationCountResults=tr,this.queryRunner=rr}transform(e,I){const B=this.group(e,I),tr=[];return B.forEach(rr=>{const ir=this.transformRawResultsGroup(rr,I);ir!==void 0&&!Object.values(ir).every(lr=>lr===null)&&tr.push(ir)}),tr}group(e,I){const B=new Map,tr=[];return I.metadata.tableType==="view"?tr.push(...I.metadata.columns.map(rr=>DriverUtils.buildAlias(this.driver,void 0,I.name,rr.databaseName))):tr.push(...I.metadata.primaryColumns.map(rr=>DriverUtils.buildAlias(this.driver,void 0,I.name,rr.databaseName))),e.forEach(rr=>{const ir=tr.map(dr=>{const mr=rr[dr];return Buffer.isBuffer(mr)?mr.toString("hex"):ObjectUtils.isObject(mr)?JSON.stringify(mr):mr}).join("_"),lr=B.get(ir);lr?lr.push(rr):B.set(ir,[rr])}),B}transformRawResultsGroup(e,I){let B=I.metadata;if(B.discriminatorColumn){const hr=e.map(_r=>_r[DriverUtils.buildAlias(this.driver,void 0,I.name,I.metadata.discriminatorColumn.databaseName)]),fr=B.childEntityMetadatas.find(_r=>typeof hr.find(gr=>gr===_r.discriminatorValue)<"u");fr&&(B=fr)}let tr=B.create(this.queryRunner,{fromDeserializer:!0,pojo:this.expressionMap.options.indexOf("create-pojo")!==-1});const rr=this.transformColumns(e,I,tr,B),ir=this.transformJoins(e,tr,I,B),lr=this.transformRelationIds(e,I,tr,B),dr=this.transformRelationCounts(e,I,tr);if(rr||B.primaryColumns.filter(hr=>hr.isVirtual===!1).length===0&&(ir||lr||dr))return tr}transformColumns(e,I,B,tr){let rr=!1;return tr.columns.forEach(ir=>{if(tr.childEntityMetadatas.length>0&&tr.childEntityMetadatas.findIndex(dr=>dr.target===ir.target)!==-1)return;const lr=e[0][DriverUtils.buildAlias(this.driver,void 0,I.name,ir.databaseName)];lr===void 0||ir.isVirtual||this.expressionMap.selects.find(dr=>dr.selection===I.name||dr.selection===I.name+"."+ir.propertyPath)&&(ir.setEntityValue(B,this.driver.prepareHydratedValue(lr,ir)),lr!==null&&(rr=!0))}),rr}transformJoins(e,I,B,tr){let rr=!1;return this.expressionMap.joinAttributes.forEach(ir=>{if(!ir.metadata||!ir.isSelected||ir.relation&&!tr.relations.find(dr=>dr===ir.relation))return;if(ir.mapToProperty){if(ir.mapToPropertyParentAlias!==B.name)return}else if(!ir.relation||ir.parentAlias!==B.name||ir.relationPropertyPath!==ir.relation.propertyPath)return;let lr=this.transform(e,ir.alias);lr=ir.isMany?lr:lr[0],lr=!ir.isMany&&lr===void 0?null:lr,lr!==void 0&&(ir.mapToPropertyPropertyName?I[ir.mapToPropertyPropertyName]=lr:ir.relation.setEntityValue(I,lr),rr=!0)}),rr}transformRelationIds(e,I,B,tr){let rr=!1;return this.rawRelationIdResults.forEach((ir,lr)=>{if(ir.relationIdAttribute.parentAlias!==I.name)return;const dr=ir.relationIdAttribute.relation,mr=this.createValueMapFromJoinColumns(dr,ir.relationIdAttribute.parentAlias,e);if(mr==null)return;this.prepareDataForTransformRelationIds();const hr=this.hashEntityIds(dr,mr),fr=this.relationIdMaps[lr][hr]||[],_r=ir.relationIdAttribute.mapToPropertyPropertyPath.split("."),gr=(Sr,Ar,Or)=>{const Fr=Sr.shift();if(Fr&&Sr.length===0)return Ar[Fr]=Or,Ar;if(Fr&&Sr.length>0)gr(Sr,Ar[Fr],Or);else return Ar};dr.isOneToOne||dr.isManyToOne?fr[0]!==void 0&&(gr(_r,B,fr[0]),rr=!0):(gr(_r,B,fr),rr=rr||fr.length>0)}),rr}transformRelationCounts(e,I,B){let tr=!1;return this.rawRelationCountResults.filter(rr=>rr.relationCountAttribute.parentAlias===I.name).forEach(rr=>{const ir=rr.relationCountAttribute.relation;let lr;ir.isOneToMany?lr=ir.inverseRelation.joinColumns[0].referencedColumn.databaseName:lr=ir.isOwning?ir.joinColumns[0].referencedColumn.databaseName:ir.inverseRelation.joinColumns[0].referencedColumn.databaseName;const dr=e[0][DriverUtils.buildAlias(this.driver,void 0,I.name,lr)];dr!=null&&(B[rr.relationCountAttribute.mapToPropertyPropertyName]=0,rr.results.filter(mr=>mr.parentId===dr).forEach(mr=>{B[rr.relationCountAttribute.mapToPropertyPropertyName]=parseInt(mr.cnt),tr=!0}))}),tr}createValueMapFromJoinColumns(e,I,B){let tr;return e.isManyToOne||e.isOneToOneOwner?tr=e.entityMetadata.primaryColumns.map(rr=>rr):e.isOneToMany||e.isOneToOneNotOwner?tr=e.inverseRelation.joinColumns.map(rr=>rr):e.isOwning?tr=e.joinColumns.map(rr=>rr):tr=e.inverseRelation.inverseJoinColumns.map(rr=>rr),tr.reduce((rr,ir)=>(B.forEach(lr=>{e.isManyToOne||e.isOneToOneOwner?rr[ir.databaseName]=this.driver.prepareHydratedValue(lr[DriverUtils.buildAlias(this.driver,void 0,I,ir.databaseName)],ir):rr[ir.databaseName]=this.driver.prepareHydratedValue(lr[DriverUtils.buildAlias(this.driver,void 0,I,ir.referencedColumn.databaseName)],ir.referencedColumn)}),rr),{})}extractEntityPrimaryIds(e,I){let B;return e.isManyToOne||e.isOneToOneOwner?B=e.entityMetadata.primaryColumns.map(tr=>tr):e.isOneToMany||e.isOneToOneNotOwner?B=e.inverseRelation.joinColumns.map(tr=>tr):e.isOwning?B=e.joinColumns.map(tr=>tr):B=e.inverseRelation.inverseJoinColumns.map(tr=>tr),B.reduce((tr,rr)=>(tr[rr.databaseName]=I[rr.databaseName],tr),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map(e=>{const I=e.relationIdAttribute.relation;let B;return I.isManyToOne||I.isOneToOneOwner?B=I.joinColumns:I.isOneToMany||I.isOneToOneNotOwner?B=I.inverseEntityMetadata.primaryColumns:I.isOwning?B=I.inverseJoinColumns:B=I.inverseRelation.joinColumns,e.results.reduce((tr,rr)=>{let ir=B.reduce((lr,dr)=>{let mr=rr[dr.databaseName];return I.isOneToMany||I.isOneToOneNotOwner?(dr.isVirtual&&dr.referencedColumn&&dr.referencedColumn.propertyName!==dr.propertyName&&(mr=dr.referencedColumn.createValueMap(mr)),OrmUtils.mergeDeep(lr,dr.createValueMap(mr))):(!dr.isPrimary&&dr.referencedColumn.referencedColumn&&(mr=dr.referencedColumn.referencedColumn.createValueMap(mr)),OrmUtils.mergeDeep(lr,dr.referencedColumn.createValueMap(mr)))},{});if(B.length===1&&!e.relationIdAttribute.disableMixedMap&&(I.isOneToMany||I.isOneToOneNotOwner?ir=B[0].getEntityValue(ir):ir=B[0].referencedColumn.getEntityValue(ir)),ir!==void 0){const lr=this.hashEntityIds(I,rr);tr[lr]?tr[lr].push(ir):tr[lr]=[ir]}return tr},{})}))}hashEntityIds(e,I){const B=this.extractEntityPrimaryIds(e,I);return JSON.stringify(B)}}let RelationIdLoader$1=class{constructor(e,I,B){this.connection=e,this.queryRunner=I,this.relationIdAttributes=B}async load(e){const I=this.relationIdAttributes.map(async B=>{if(B.relation.isManyToOne||B.relation.isOneToOneOwner){if(B.queryBuilderFactory)throw new TypeORMError("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const tr={},rr=e.map(ir=>{const lr={},dr=[];B.relation.joinColumns.forEach(hr=>{lr[hr.databaseName]=this.connection.driver.prepareHydratedValue(ir[DriverUtils.buildAlias(this.connection.driver,void 0,B.parentAlias,hr.databaseName)],hr.referencedColumn);const fr=`${hr.databaseName}:${lr[hr.databaseName]}`;dr.indexOf(fr)===-1&&dr.push(fr)}),B.relation.entityMetadata.primaryColumns.forEach(hr=>{lr[hr.databaseName]=this.connection.driver.prepareHydratedValue(ir[DriverUtils.buildAlias(this.connection.driver,void 0,B.parentAlias,hr.databaseName)],hr);const fr=`${hr.databaseName}:${lr[hr.databaseName]}`;dr.indexOf(fr)===-1&&dr.push(fr)}),dr.sort();const mr=dr.join("::");return tr[mr]?null:(tr[mr]=!0,lr)}).filter(ir=>ir);return{relationIdAttribute:B,results:rr}}else if(B.relation.isOneToMany||B.relation.isOneToOneNotOwner){const tr=B.relation,rr=tr.isOwning?tr.joinColumns:tr.inverseRelation.joinColumns,ir=tr.inverseEntityMetadata.target,lr=tr.inverseEntityMetadata.tableName,dr=B.alias||lr,mr={},hr={},fr=e.map((Ar,Or)=>{const Fr=[],vr={},xr=rr.map(Gr=>{const is=Gr.databaseName+Or,as=Ar[DriverUtils.buildAlias(this.connection.driver,void 0,B.parentAlias,Gr.referencedColumn.databaseName)],cs=`${dr}:${Gr.propertyPath}:${as}`;return Fr.indexOf(cs)!==-1?"":(Fr.push(cs),vr[is]=as,dr+"."+Gr.propertyPath+" = :"+is)}).filter(Gr=>Gr).join(" AND ");Fr.sort();const kr=Fr.join("::");return mr[kr]?"":(mr[kr]=!0,Object.assign(hr,vr),xr)}).filter(Ar=>Ar).map(Ar=>"("+Ar+")").join(" OR ");if(!fr)return{relationIdAttribute:B,results:[]};const _r=this.connection.createQueryBuilder(this.queryRunner);OrmUtils.uniq([...rr,...tr.inverseRelation.entityMetadata.primaryColumns],Ar=>Ar.propertyPath).forEach(Ar=>{_r.addSelect(dr+"."+Ar.propertyPath,Ar.databaseName)}),_r.from(ir,dr).where("("+fr+")").setParameters(hr),B.queryBuilderFactory&&B.queryBuilderFactory(_r);const Sr=await _r.getRawMany();return Sr.forEach(Ar=>{rr.forEach(Or=>{Ar[Or.databaseName]=this.connection.driver.prepareHydratedValue(Ar[Or.databaseName],Or.referencedColumn)}),tr.inverseRelation.entityMetadata.primaryColumns.forEach(Or=>{Ar[Or.databaseName]=this.connection.driver.prepareHydratedValue(Ar[Or.databaseName],Or)})}),{relationIdAttribute:B,results:Sr}}else{const tr=B.relation,rr=tr.isOwning?tr.joinColumns:tr.inverseRelation.inverseJoinColumns,ir=tr.isOwning?tr.inverseJoinColumns:tr.inverseRelation.joinColumns,lr=B.junctionAlias,dr=B.joinInverseSideMetadata.tableName,mr=B.alias||dr,hr=tr.isOwning?tr.junctionEntityMetadata.tableName:tr.inverseRelation.junctionEntityMetadata.tableName,fr=e.map(xr=>rr.reduce((kr,Gr)=>(kr[Gr.propertyPath]=xr[DriverUtils.buildAlias(this.connection.driver,void 0,B.parentAlias,Gr.referencedColumn.databaseName)],kr),{}));if(fr.length===0)return{relationIdAttribute:B,results:[]};const _r={},gr={},Sr=fr.map((xr,kr)=>{const Gr=[],is={},as=Object.keys(xr).map(es=>{const ps=es+kr,Ur=xr[es],Lr=`${lr}:${es}:${Ur}`;return Gr.indexOf(Lr)!==-1?"":(Gr.push(Lr),is[ps]=Ur,lr+"."+es+" = :"+ps)}).filter(es=>es).join(" AND ");Gr.sort();const cs=Gr.join("::");return gr[cs]?"":(gr[cs]=!0,Object.assign(_r,is),as)}).filter(xr=>xr),Ar=ir.map(xr=>lr+"."+xr.propertyPath+" = "+mr+"."+xr.referencedColumn.propertyPath).join(" AND "),Or=Sr.map(xr=>"("+xr+" AND "+Ar+")").join(" OR "),Fr=this.connection.createQueryBuilder(this.queryRunner);ir.forEach(xr=>{Fr.addSelect(lr+"."+xr.propertyPath,xr.databaseName).addOrderBy(lr+"."+xr.propertyPath)}),rr.forEach(xr=>{Fr.addSelect(lr+"."+xr.propertyPath,xr.databaseName).addOrderBy(lr+"."+xr.propertyPath)}),Fr.from(dr,mr).innerJoin(hr,lr,Or).setParameters(_r),B.queryBuilderFactory&&B.queryBuilderFactory(Fr);const vr=await Fr.getRawMany();return vr.forEach(xr=>{[...rr,...ir].forEach(kr=>{xr[kr.databaseName]=this.connection.driver.prepareHydratedValue(xr[kr.databaseName],kr.referencedColumn)})}),{relationIdAttribute:B,results:vr}}});return Promise.all(I)}};class RelationIdLoader{constructor(e,I){this.connection=e,this.queryRunner=I}load(e,I,B){const tr=Array.isArray(I)?I:[I],rr=Array.isArray(B)?B:B?[B]:void 0;return e.isManyToMany?this.loadForManyToMany(e,tr,rr):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,tr,rr):this.loadForOneToManyAndOneToOneNotOwner(e,tr,rr)}async loadManyToManyRelationIdsAndGroup(e,I,B,tr){const rr=e.isManyToMany||e.isOneToMany,ir=Array.isArray(I)?I:[I];if(!B&&(B=await this.connection.relationLoader.load(e,I,this.queryRunner,tr),!B.length))return ir.map(fr=>({entity:fr,related:rr?[]:void 0}));const lr=await this.load(e,I,B),dr=Array.isArray(B)?B:[B];let mr=[],hr=[];return e.isManyToManyOwner?(mr=e.junctionEntityMetadata.inverseColumns.map(fr=>fr.referencedColumn),hr=e.junctionEntityMetadata.ownerColumns.map(fr=>fr.referencedColumn)):e.isManyToManyNotOwner?(mr=e.junctionEntityMetadata.ownerColumns.map(fr=>fr.referencedColumn),hr=e.junctionEntityMetadata.inverseColumns.map(fr=>fr.referencedColumn)):e.isManyToOne||e.isOneToOneOwner?(mr=e.joinColumns.map(fr=>fr.referencedColumn),hr=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(mr=e.inverseRelation.entityMetadata.primaryColumns,hr=e.inverseRelation.joinColumns.map(fr=>fr.referencedColumn)),ir.map(fr=>{const _r={entity:fr,related:rr?[]:void 0},gr=lr.filter(Sr=>hr.every(Ar=>Ar.compareEntityValue(fr,Sr[Ar.entityMetadata.name+"_"+Ar.propertyAliasName])));return gr.length&&dr.forEach(Sr=>{gr.forEach(Ar=>{mr.every(Fr=>Fr.compareEntityValue(Sr,Ar[DriverUtils.buildAlias(this.connection.driver,void 0,Fr.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+Fr.propertyPath.replace(".","_"))]))&&(rr?_r.related.push(Sr):_r.related=Sr)})}),_r})}loadForManyToMany(e,I,B){const tr=e.junctionEntityMetadata,rr=tr.name,ir=e.isOwning?tr.ownerColumns:tr.inverseColumns,lr=e.isOwning?tr.inverseColumns:tr.ownerColumns,dr=this.connection.createQueryBuilder(this.queryRunner);ir.forEach(_r=>{const gr=DriverUtils.buildAlias(this.connection.driver,void 0,_r.referencedColumn.entityMetadata.name+"_"+_r.referencedColumn.propertyPath.replace(".","_"));dr.addSelect(rr+"."+_r.propertyPath,gr)}),lr.forEach(_r=>{const gr=DriverUtils.buildAlias(this.connection.driver,void 0,_r.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+_r.referencedColumn.propertyPath.replace(".","_"));dr.addSelect(rr+"."+_r.propertyPath,gr)});let mr="";if(ir.length===1){const _r=I.map(Sr=>ir[0].referencedColumn.getEntityValue(Sr));_r.every(Sr=>typeof Sr=="number")?mr=`${rr}.${ir[0].propertyPath} IN (${_r.join(", ")})`:(dr.setParameter("values1",_r),mr=rr+"."+ir[0].propertyPath+" IN (:...values1)")}else mr="("+I.map((_r,gr)=>ir.map(Sr=>{const Ar="entity1_"+gr+"_"+Sr.propertyName;return dr.setParameter(Ar,Sr.referencedColumn.getEntityValue(_r)),rr+"."+Sr.propertyPath+" = :"+Ar}).join(" AND ")).map(_r=>"("+_r+")").join(" OR ")+")";let hr="";if(B)if(lr.length===1){const _r=B.map(Sr=>lr[0].referencedColumn.getEntityValue(Sr));_r.every(Sr=>typeof Sr=="number")?hr=`${rr}.${lr[0].propertyPath} IN (${_r.join(", ")})`:(dr.setParameter("values2",_r),hr=rr+"."+lr[0].propertyPath+" IN (:...values2)")}else hr="("+B.map((_r,gr)=>lr.map(Sr=>{const Ar="entity2_"+gr+"_"+Sr.propertyName;return dr.setParameter(Ar,Sr.referencedColumn.getEntityValue(_r)),rr+"."+Sr.propertyPath+" = :"+Ar}).join(" AND ")).map(_r=>"("+_r+")").join(" OR ")+")";const fr=[mr,hr].filter(_r=>_r.length>0).join(" AND ");return dr.from(tr.target,rr).where(fr).getRawMany()}loadForManyToOneAndOneToOneOwner(e,I,B){const tr=e.entityMetadata.targetName,rr=e.joinColumns.every(dr=>!!e.entityMetadata.nonVirtualColumns.find(mr=>mr===dr));if(B&&rr){let dr=[];if(I.forEach(mr=>{let hr={};e.entityMetadata.primaryColumns.forEach(fr=>{const _r=fr.entityMetadata.name+"_"+fr.propertyPath.replace(".","_");hr[_r]=fr.getEntityValue(mr)}),B.forEach(fr=>{e.joinColumns.forEach(_r=>{const gr=_r.getEntityValue(mr),Sr=_r.referencedColumn.getEntityValue(fr);if(!(gr===void 0||Sr===void 0)&&gr===Sr){const Ar=_r.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+_r.referencedColumn.propertyPath.replace(".","_");hr[Ar]=Sr}})}),Object.keys(hr).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&dr.push(hr)}),dr.length===I.length)return Promise.resolve(dr)}const ir=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(dr=>{const mr=DriverUtils.buildAlias(this.connection.driver,void 0,dr.entityMetadata.name+"_"+dr.propertyPath.replace(".","_"));ir.addSelect(tr+"."+dr.propertyPath,mr)}),e.joinColumns.forEach(dr=>{const mr=DriverUtils.buildAlias(this.connection.driver,void 0,dr.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+dr.referencedColumn.propertyPath.replace(".","_"));ir.addSelect(tr+"."+dr.propertyPath,mr)});let lr="";if(e.entityMetadata.primaryColumns.length===1){const dr=I.map(hr=>e.entityMetadata.primaryColumns[0].getEntityValue(hr));dr.every(hr=>typeof hr=="number")?lr=`${tr}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${dr.join(", ")})`:(ir.setParameter("values",dr),lr=tr+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else lr=I.map((dr,mr)=>e.entityMetadata.primaryColumns.map((hr,fr)=>{const _r="entity"+mr+"_"+fr;return ir.setParameter(_r,hr.getEntityValue(dr)),tr+"."+hr.propertyPath+" = :"+_r}).join(" AND ")).map(dr=>"("+dr+")").join(" OR ");return ir.from(e.entityMetadata.target,tr).where(lr).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,I,B){if(e=e.inverseRelation,e.entityMetadata.primaryColumns.length===e.joinColumns.length&&e.entityMetadata.primaryColumns.every(dr=>e.joinColumns.indexOf(dr)!==-1))return Promise.resolve(I.map(dr=>{const mr={};return e.joinColumns.forEach(function(hr){const fr=hr.referencedColumn.getEntityValue(dr),_r=hr.referencedColumn.entityMetadata.name+"_"+hr.referencedColumn.propertyPath.replace(".","_"),gr=hr.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+hr.propertyPath.replace(".","_");mr[_r]=fr,mr[gr]=fr}),mr}));const tr=e.entityMetadata.targetName,rr=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(lr=>{const dr=DriverUtils.buildAlias(this.connection.driver,void 0,lr.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+lr.propertyPath.replace(".","_"));rr.addSelect(tr+"."+lr.propertyPath,dr)}),e.joinColumns.forEach(lr=>{const dr=DriverUtils.buildAlias(this.connection.driver,void 0,lr.referencedColumn.entityMetadata.name+"_"+lr.referencedColumn.propertyPath.replace(".","_"));rr.addSelect(tr+"."+lr.propertyPath,dr)});let ir="";if(e.joinColumns.length===1){const lr=I.map(mr=>e.joinColumns[0].referencedColumn.getEntityValue(mr));lr.every(mr=>typeof mr=="number")?ir=`${tr}.${e.joinColumns[0].propertyPath} IN (${lr.join(", ")})`:(rr.setParameter("values",lr),ir=tr+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else ir=I.map((lr,dr)=>e.joinColumns.map((mr,hr)=>{const fr="entity"+dr+"_"+hr;return rr.setParameter(fr,mr.referencedColumn.getEntityValue(lr)),tr+"."+mr.propertyPath+" = :"+fr}).join(" AND ")).map(lr=>"("+lr+")").join(" OR ");return rr.from(e.entityMetadata.target,tr).where(ir).getRawMany()}}class RelationIdMetadataToAttributeTransformer{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(e=>{const I=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(I)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationIds.forEach(I=>{const B=this.metadataToAttribute(e.alias.name,I);this.expressionMap.relationIdAttributes.push(B)})})}metadataToAttribute(e,I){return new RelationIdAttribute(this.expressionMap,{relationName:e+"."+I.relation.propertyName,mapToProperty:e+"."+I.propertyName,alias:I.alias,queryBuilderFactory:I.queryBuilderFactory})}}class RelationCountLoader{constructor(e,I,B){this.connection=e,this.queryRunner=I,this.relationCountAttributes=B}async load(e){const I=(tr,rr,ir)=>ir.indexOf(tr)===rr,B=this.relationCountAttributes.map(async tr=>{if(tr.relation.isOneToMany){const rr=tr.relation,ir=rr.inverseRelation,lr=ir.joinColumns[0].referencedColumn.propertyName,dr=rr.inverseEntityMetadata.target,mr=rr.inverseEntityMetadata.tableName,hr=tr.alias||mr,fr=ir.propertyName;let _r=e.map(Sr=>Sr[tr.parentAlias+"_"+lr]).filter(Sr=>!!Sr);if(_r=_r.filter(I),_r.length===0)return{relationCountAttribute:tr,results:[]};const gr=this.connection.createQueryBuilder(this.queryRunner);return gr.select(hr+"."+fr,"parentId").addSelect("COUNT(*)","cnt").from(dr,hr).where(hr+"."+fr+" IN (:...ids)").addGroupBy(hr+"."+fr).setParameter("ids",_r),tr.queryBuilderFactory&&tr.queryBuilderFactory(gr),{relationCountAttribute:tr,results:await gr.getRawMany()}}else{let rr,ir,lr,dr;tr.relation.isOwning?(rr=tr.relation.joinColumns[0].referencedColumn.databaseName,ir=tr.relation.inverseJoinColumns[0].referencedColumn.databaseName,lr=tr.relation.junctionEntityMetadata.columns[0],dr=tr.relation.junctionEntityMetadata.columns[1]):(rr=tr.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,ir=tr.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,lr=tr.relation.junctionEntityMetadata.columns[1],dr=tr.relation.junctionEntityMetadata.columns[0]);let mr=e.map(Or=>Or[tr.parentAlias+"_"+rr]).filter(Or=>!!Or);if(mr=mr.filter(I),mr.length===0)return{relationCountAttribute:tr,results:[]};const hr=tr.junctionAlias,fr=tr.joinInverseSideMetadata.tableName,_r=tr.alias||fr,gr=tr.relation.junctionEntityMetadata.tableName,Sr=hr+"."+lr.propertyName+" IN ("+mr.map(Or=>isNaN(Or)?"'"+Or+"'":Or)+") AND "+hr+"."+dr.propertyName+" = "+_r+"."+ir,Ar=this.connection.createQueryBuilder(this.queryRunner);return Ar.select(hr+"."+lr.propertyName,"parentId").addSelect("COUNT("+Ar.escape(_r)+"."+Ar.escape(ir)+")","cnt").from(fr,_r).innerJoin(gr,hr,Sr).addGroupBy(hr+"."+lr.propertyName),tr.queryBuilderFactory&&tr.queryBuilderFactory(Ar),{relationCountAttribute:tr,results:await Ar.getRawMany()}}});return Promise.all(B)}}class RelationCountMetadataToAttributeTransformer{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(e=>{const I=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(I)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationCounts.forEach(I=>{const B=this.metadataToAttribute(e.alias.name,I);this.expressionMap.relationCountAttributes.push(B)})})}metadataToAttribute(e,I){return new RelationCountAttribute(this.expressionMap,{relationName:e+"."+I.relation.propertyName,mapToProperty:e+"."+I.propertyName,alias:I.alias,queryBuilderFactory:I.queryBuilderFactory})}}class FindOptionsUtils{static isFindOneOptions(e){const I=e;return I&&(Array.isArray(I.select)||Array.isArray(I.relations)||typeof I.select=="object"||typeof I.relations=="object"||typeof I.where=="object"||typeof I.join=="object"||typeof I.order=="object"||typeof I.cache=="object"||typeof I.cache=="boolean"||typeof I.cache=="number"||typeof I.comment=="string"||typeof I.lock=="object"||typeof I.loadRelationIds=="object"||typeof I.loadRelationIds=="boolean"||typeof I.loadEagerRelations=="boolean"||typeof I.withDeleted=="boolean"||typeof I.relationLoadStrategy=="string"||typeof I.transaction=="boolean")}static isFindManyOptions(e){const I=e;return I&&(this.isFindOneOptions(I)||typeof I.skip=="number"||typeof I.take=="number"||typeof I.skip=="string"||typeof I.take=="string")}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,I){if(I?.relations){const B=[...I.relations];if(FindOptionsUtils.applyRelationsRecursively(e,B,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),B.length>0)throw new FindRelationsNotFoundError(B)}return e}static applyRelationsRecursively(e,I,B,tr,rr){let ir=[];if(rr){const lr=new RegExp("^"+rr.replace(".","\\.")+"\\.");ir=I.filter(dr=>dr.match(lr)).map(dr=>tr.findRelationWithPropertyPath(dr.replace(lr,""))).filter(dr=>dr)}else ir=I.map(lr=>tr.findRelationWithPropertyPath(lr)).filter(lr=>lr);ir.forEach(lr=>{let dr=DriverUtils.buildAlias(e.connection.driver,{joiner:"__"},B,lr.propertyPath);const mr=B+"."+lr.propertyPath;e.expressionMap.relationLoadStrategy==="query"?e.concatRelationMetadata(lr):e.leftJoinAndSelect(mr,dr),I.splice(I.indexOf(rr?rr+"."+lr.propertyPath:lr.propertyPath),1);let hr,fr;if(e.expressionMap.relationLoadStrategy==="query")hr=lr.inverseEntityMetadata,fr=dr;else{const _r=e.expressionMap.joinAttributes.find(gr=>gr.entityOrProperty===mr);hr=_r.metadata,fr=_r.alias.name}if(!fr||!hr)throw new EntityPropertyNotFoundError(lr.propertyPath,tr);if(this.applyRelationsRecursively(e,I,fr,hr,rr?rr+"."+lr.propertyPath:lr.propertyPath),e.expressionMap.relationLoadStrategy==="join"){const _r=tr.relations.find(gr=>gr.propertyName===lr.propertyPath);_r&&this.joinEagerRelations(e,dr,_r.inverseEntityMetadata)}})}static joinEagerRelations(e,I,B){B.eagerRelations.forEach(tr=>{let rr=DriverUtils.buildAlias(e.connection.driver,{joiner:"__"},I,tr.propertyName),ir=!0;for(const mr of e.expressionMap.joinAttributes)if(!(mr.condition!==void 0||mr.mapToProperty!==void 0||mr.isMappingMany!==void 0||mr.direction!=="LEFT"||mr.entityOrProperty!==`${I}.${tr.propertyPath}`)){ir=!1,rr=mr.alias.name;break}const lr=!!e.expressionMap.joinAttributes.find(mr=>mr.alias.name===rr);ir&&!lr&&e.leftJoin(I+"."+tr.propertyPath,rr);let dr=!0;for(const mr of e.expressionMap.selects)if(!(mr.aliasName!==void 0||mr.virtual!==void 0||mr.selection!==rr)){dr=!1;break}dr&&e.addSelect(rr),this.joinEagerRelations(e,rr,tr.inverseEntityMetadata)})}}class SelectQueryBuilder extends QueryBuilder{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),this.replacePropertyNamesForTheWholeQuery(e)}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,I){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map(B=>({selection:B}));else if(typeof e=="function"){const B=e(this.subQuery());this.setParameters(B.getParameters()),this.expressionMap.selects.push({selection:B.getQuery(),aliasName:I})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:I}]);return this}addSelect(e,I){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(B=>({selection:B})));else if(typeof e=="function"){const B=e(this.subQuery());this.setParameters(B.getParameters()),this.expressionMap.selects.push({selection:B.getQuery(),aliasName:I})}else e&&this.expressionMap.selects.push({selection:e,aliasName:I});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}fromDummy(){return this.from(this.connection.driver.dummyTableName??"(SELECT 1 AS dummy_column)","dummy_table")}from(e,I){const B=this.createFromAlias(e,I);return this.expressionMap.setMainAlias(B),this}addFrom(e,I){const B=this.createFromAlias(e,I);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(B),this}innerJoin(e,I,B,tr){return this.join("INNER",e,I,B,tr),this}leftJoin(e,I,B,tr){return this.join("LEFT",e,I,B,tr),this}innerJoinAndSelect(e,I,B,tr){return this.addSelect(I),this.innerJoin(e,I,B,tr),this}leftJoinAndSelect(e,I,B,tr){return this.addSelect(I),this.leftJoin(e,I,B,tr),this}innerJoinAndMapMany(e,I,B,tr,rr){return this.addSelect(B),this.join("INNER",I,B,tr,rr,e,!0),this}innerJoinAndMapOne(e,I,B,tr,rr,ir){return this.addSelect(B),this.join("INNER",I,B,tr,rr,e,!1,ir),this}leftJoinAndMapMany(e,I,B,tr,rr){return this.addSelect(B),this.join("LEFT",I,B,tr,rr,e,!0),this}leftJoinAndMapOne(e,I,B,tr,rr,ir){return this.addSelect(B),this.join("LEFT",I,B,tr,rr,e,!1,ir),this}loadRelationIdAndMap(e,I,B,tr){const rr=new RelationIdAttribute(this.expressionMap);return rr.mapToProperty=e,rr.relationName=I,typeof B=="string"&&(rr.alias=B),typeof B=="object"&&B.disableMixedMap&&(rr.disableMixedMap=!0),rr.queryBuilderFactory=tr,this.expressionMap.relationIdAttributes.push(rr),rr.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:rr.junctionAlias,metadata:rr.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,I,B,tr){const rr=new RelationCountAttribute(this.expressionMap);return rr.mapToProperty=e,rr.relationName=I,rr.alias=B,rr.queryBuilderFactory=tr,this.expressionMap.relationCountAttributes.push(rr),this.expressionMap.createAlias({type:"other",name:rr.junctionAlias}),rr.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:rr.junctionAlias,metadata:rr.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach(I=>{e!==void 0&&e.relations!==void 0&&e.relations.indexOf(I.propertyPath)===-1||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+I.propertyPath,this.expressionMap.mainAlias.name+"."+I.propertyPath,e)}),this}where(e,I){this.expressionMap.wheres=[];const B=this.getWhereCondition(e);return B&&(this.expressionMap.wheres=[{type:"simple",condition:B}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereExists(e){return this.where(...this.getExistsCondition(e))}andWhereExists(e){return this.andWhere(...this.getExistsCondition(e))}orWhereExists(e){return this.orWhere(...this.getExistsCondition(e))}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,I){return this.expressionMap.havings.push({type:"simple",condition:e}),I&&this.setParameters(I),this}andHaving(e,I){return this.expressionMap.havings.push({type:"and",condition:e}),I&&this.setParameters(I),this}orHaving(e,I){return this.expressionMap.havings.push({type:"or",condition:e}),I&&this.setParameters(I),this}groupBy(e){return e?this.expressionMap.groupBys=[e]:this.expressionMap.groupBys=[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}timeTravelQuery(e){return this.connection.driver.options.type==="cockroachdb"&&(e===void 0?this.expressionMap.timeTravel="follower_read_timestamp()":this.expressionMap.timeTravel=e),this}orderBy(e,I="ASC",B){if(I!==void 0&&I!=="ASC"&&I!=="DESC")throw new TypeORMError('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(B!==void 0&&B!=="NULLS FIRST"&&B!=="NULLS LAST")throw new TypeORMError('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?typeof e=="object"?this.expressionMap.orderBys=e:B?this.expressionMap.orderBys={[e]:{order:I,nulls:B}}:this.expressionMap.orderBys={[e]:I}:this.expressionMap.orderBys={},this}addOrderBy(e,I="ASC",B){if(I!==void 0&&I!=="ASC"&&I!=="DESC")throw new TypeORMError('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(B!==void 0&&B!=="NULLS FIRST"&&B!=="NULLS LAST")throw new TypeORMError('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return B?this.expressionMap.orderBys[e]={order:I,nulls:B}:this.expressionMap.orderBys[e]=I,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),this.expressionMap.limit!==void 0&&isNaN(this.expressionMap.limit))throw new TypeORMError('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),this.expressionMap.offset!==void 0&&isNaN(this.expressionMap.offset))throw new TypeORMError('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),this.expressionMap.take!==void 0&&isNaN(this.expressionMap.take))throw new TypeORMError('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),this.expressionMap.skip!==void 0&&isNaN(this.expressionMap.skip))throw new TypeORMError('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,I,B){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=I,this.expressionMap.lockTables=B,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0);const B=await this.loadRawResults(e);return I&&await e.commitTransaction(),B}catch(B){if(I)try{await e.rollbackTransaction()}catch{}throw B}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!0;const B=await this.executeEntitiesAndRawResults(e);return I&&await e.commitTransaction(),B}catch(B){if(I)try{await e.rollbackTransaction()}catch{}throw B}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const I=(await this.getRawAndEntities()).entities[0];if(I&&this.expressionMap.lockMode==="optimistic"&&this.expressionMap.lockVersion){const B=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const tr=B.updateDateColumn.getEntityValue(I);if(tr.getTime()!==this.expressionMap.lockVersion.getTime())throw new OptimisticLockVersionMismatchError(B.name,this.expressionMap.lockVersion,tr)}else{const tr=B.versionColumn.getEntityValue(I);if(tr!==this.expressionMap.lockVersion)throw new OptimisticLockVersionMismatchError(B.name,this.expressionMap.lockVersion,tr)}}return I===void 0?null:I}async getOneOrFail(){const e=await this.getOne();if(!e)throw new EntityNotFoundError(this.expressionMap.mainAlias.target,this.expressionMap.parameters);return e}async getMany(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;return(await this.getRawAndEntities()).entities}async getCount(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!1;const B=await this.executeCountQuery(e);return I&&await e.commitTransaction(),B}catch(B){if(I)try{await e.rollbackTransaction()}catch{}throw B}finally{e!==this.queryRunner&&await e.release()}}async getExists(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!1;const B=await this.executeExistsQuery(e);return I&&await e.commitTransaction(),B}catch(B){if(I)try{await e.rollbackTransaction()}catch{}throw B}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if(this.expressionMap.lockMode==="optimistic")throw new OptimisticLockCanNotBeUsedError;const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.queryEntity=!0;const B=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const tr=this.expressionMap.cacheId;this.expressionMap.cacheId=tr&&`${tr}-count`;const rr=await this.executeCountQuery(e),ir=[B.entities,rr];return I&&await e.commitTransaction(),ir}catch(B){if(I)try{await e.rollbackTransaction()}catch{}throw B}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,I]=this.getQueryAndParameters(),B=this.obtainQueryRunner();let tr=!1;try{this.expressionMap.useTransaction===!0&&B.isTransactionActive===!1&&(await B.startTransaction(),tr=!0);const rr=()=>{if(B!==this.queryRunner)return B.release()},ir=B.stream(e,I,rr,rr);return tr&&await B.commitTransaction(),ir}catch(rr){if(tr)try{await B.rollbackTransaction()}catch{}throw rr}}cache(e,I){return typeof e=="boolean"?this.expressionMap.cache=e:typeof e=="number"?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):(typeof e=="string"||typeof e=="number")&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),I&&(this.expressionMap.cacheDuration=I),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,I,B,tr,rr,ir,lr,dr){rr&&this.setParameters(rr);const mr=new JoinAttribute(this.connection,this.expressionMap);mr.direction=e,mr.mapAsEntity=dr,mr.mapToProperty=ir,mr.isMappingMany=lr,mr.entityOrProperty=I,mr.condition=tr,this.expressionMap.joinAttributes.push(mr);const hr=mr.metadata;if(hr){if(hr.deleteDateColumn&&!this.expressionMap.withDeleted){const fr=`${B}.${hr.deleteDateColumn.propertyName} IS NULL`;mr.condition=mr.condition?` ${mr.condition} AND ${fr}`:`${fr}`}mr.alias=this.expressionMap.createAlias({type:"join",name:B,metadata:hr}),mr.relation&&mr.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:mr.junctionAlias,metadata:mr.relation.junctionEntityMetadata})}else{let fr="";if(typeof I=="function"){const gr=I(this.subQuery());this.setParameters(gr.getParameters()),fr=gr.getQuery()}else fr=I;const _r=typeof I=="function"||I.substr(0,1)==="("&&I.substr(-1)===")";mr.alias=this.expressionMap.createAlias({type:"join",name:B,tablePath:_r===!1?I:void 0,subQuery:_r===!0?fr:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new TypeORMError("Cannot build query because main alias is not set (call qb#from method)");const e=[],I=[];if(this.expressionMap.mainAlias.hasMetadata){const lr=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,lr)),I.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,lr))}this.expressionMap.joinAttributes.forEach(lr=>{if(lr.metadata)e.push(...this.buildEscapedEntityColumnSelects(lr.alias.name,lr.metadata)),I.push(...this.findEntityColumnSelects(lr.alias.name,lr.metadata));else if(this.expressionMap.selects.some(mr=>mr.selection===lr.alias.name)){e.push({selection:this.escape(lr.alias.name)+".*"});const mr=this.expressionMap.selects.find(hr=>hr.selection===lr.alias.name);I.push(mr)}}),this.expressionMap.selects.filter(lr=>I.indexOf(lr)===-1).forEach(lr=>e.push({selection:this.replacePropertyNames(lr.selection),aliasName:lr.aliasName})),e.length===0&&e.push({selection:"*"});let B="";this.expressionMap.useIndex&&DriverUtils.isMySQLFamily(this.connection.driver)&&(B=` USE INDEX (${this.expressionMap.useIndex})`);const tr=this.expressionMap.aliases.filter(lr=>lr.type==="from"&&(lr.tablePath||lr.subQuery)).map(lr=>lr.subQuery?lr.subQuery+" "+this.escape(lr.name):this.getTableName(lr.tablePath)+" "+this.escape(lr.name)),rr=this.createSelectDistinctExpression(),ir=e.map(lr=>lr.selection+(lr.aliasName?" AS "+this.escape(lr.aliasName):"")).join(", ");return rr+ir+" FROM "+tr.join(", ")+this.createTableLockExpression()+B}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:I,maxExecutionTime:B}=this.expressionMap,{driver:tr}=this.connection;let rr="SELECT ";return B>0&&DriverUtils.isMySQLFamily(tr)&&(rr+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),DriverUtils.isPostgresFamily(tr)&&I.length>0?rr=`SELECT DISTINCT ON (${I.map(lr=>this.replacePropertyNames(lr)).join(", ")}) `:e&&(rr="SELECT DISTINCT "),rr}createJoinExpression(){return this.expressionMap.joinAttributes.map(I=>{const B=I.relation,tr=I.tablePath,rr=I.alias.name;let ir=I.condition?" AND ("+I.condition+")":"";const lr=I.parentAlias;if(!lr||!B){const dr=I.alias.subQuery?I.alias.subQuery:this.getTableName(tr);return" "+I.direction+" JOIN "+dr+" "+this.escape(rr)+this.createTableLockExpression()+(I.condition?" ON "+this.replacePropertyNames(I.condition):"")}if(B.isManyToOne||B.isOneToOneOwner){const dr=B.joinColumns.map(mr=>rr+"."+mr.referencedColumn.propertyPath+"="+lr+"."+B.propertyPath+"."+mr.referencedColumn.propertyPath).join(" AND ");return" "+I.direction+" JOIN "+this.getTableName(tr)+" "+this.escape(rr)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(dr+ir)}else if(B.isOneToMany||B.isOneToOneNotOwner){const dr=B.inverseRelation.joinColumns.map(mr=>(B.inverseEntityMetadata.tableType==="entity-child"&&B.inverseEntityMetadata.discriminatorColumn&&(ir+=" AND "+rr+"."+B.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+B.inverseEntityMetadata.discriminatorValue+"'"),rr+"."+B.inverseRelation.propertyPath+"."+mr.referencedColumn.propertyPath+"="+lr+"."+mr.referencedColumn.propertyPath)).join(" AND ");if(!dr)throw new TypeORMError(`Relation ${B.entityMetadata.name}.${B.propertyName} does not have join columns.`);return" "+I.direction+" JOIN "+this.getTableName(tr)+" "+this.escape(rr)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(dr+ir)}else{const dr=B.junctionEntityMetadata.tablePath,mr=I.junctionAlias;let hr="",fr="";return B.isOwning?(hr=B.joinColumns.map(_r=>mr+"."+_r.propertyPath+"="+lr+"."+_r.referencedColumn.propertyPath).join(" AND "),fr=B.inverseJoinColumns.map(_r=>rr+"."+_r.referencedColumn.propertyPath+"="+mr+"."+_r.propertyPath).join(" AND ")):(hr=B.inverseRelation.inverseJoinColumns.map(_r=>mr+"."+_r.propertyPath+"="+lr+"."+_r.referencedColumn.propertyPath).join(" AND "),fr=B.inverseRelation.joinColumns.map(_r=>rr+"."+_r.referencedColumn.propertyPath+"="+mr+"."+_r.propertyPath).join(" AND "))," "+I.direction+" JOIN "+this.getTableName(dr)+" "+this.escape(mr)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(hr)+" "+I.direction+" JOIN "+this.getTableName(tr)+" "+this.escape(rr)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(fr+ir)}}).join(" ")}createGroupByExpression(){return!this.expressionMap.groupBys||!this.expressionMap.groupBys.length?"":" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", "))}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length===0?"":" ORDER BY "+Object.keys(e).map(I=>{const B=typeof e[I]=="string"?e[I]:e[I].order+" "+e[I].nulls,tr=this.expressionMap.selects.find(rr=>rr.selection===I);if(tr&&!tr.aliasName&&I.indexOf(".")!==-1){const rr=I.split("."),ir=rr[0],lr=rr.slice(1).join("."),dr=this.expressionMap.aliases.find(mr=>mr.name===ir);if(dr){const mr=dr.metadata.findColumnWithPropertyPath(lr);if(mr){const hr=DriverUtils.buildAlias(this.connection.driver,void 0,ir,mr.databaseName);return this.escape(hr)+" "+B}}}return this.replacePropertyNames(I)+" "+B}).join(", ")}createLimitOffsetExpression(){let e=this.expressionMap.offset,I=this.expressionMap.limit;if(!e&&!I&&this.expressionMap.joinAttributes.length===0&&(e=this.expressionMap.skip,I=this.expressionMap.take),this.connection.driver.options.type==="mssql"){let B="";if((I||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(B=" ORDER BY (SELECT NULL)"),I&&e)return B+" OFFSET "+e+" ROWS FETCH NEXT "+I+" ROWS ONLY";if(I)return B+" OFFSET 0 ROWS FETCH NEXT "+I+" ROWS ONLY";if(e)return B+" OFFSET "+e+" ROWS"}else if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){if(I&&e)return" LIMIT "+I+" OFFSET "+e;if(I)return" LIMIT "+I;if(e)throw new OffsetWithoutLimitNotSupportedError}else if(DriverUtils.isSQLiteFamily(this.connection.driver)){if(I&&e)return" LIMIT "+I+" OFFSET "+e;if(I)return" LIMIT "+I;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver.options.type==="oracle"){if(I&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+I+" ROWS ONLY";if(I)return" FETCH NEXT "+I+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(I&&e)return" LIMIT "+I+" OFFSET "+e;if(I)return" LIMIT "+I;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if(this.connection.driver.options.type==="mssql")switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let I="";if(this.expressionMap.lockTables){if(!(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb"))throw new TypeORMError("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new TypeORMError("lockTables cannot be an empty array");I=" OF "+this.expressionMap.lockTables.join(", ")}let B="";switch(this.expressionMap.onLocked==="nowait"?B=" NOWAIT":this.expressionMap.onLocked==="skip_locked"&&(B=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if(e.options.type==="mysql"||e.options.type==="aurora-mysql")return DriverUtils.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+I+B:" LOCK IN SHARE MODE";if(e.options.type==="mariadb")return" LOCK IN SHARE MODE";if(DriverUtils.isPostgresFamily(e))return" FOR SHARE"+I+B;if(e.options.type==="oracle")return" FOR UPDATE";if(e.options.type==="mssql")return"";throw new LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(DriverUtils.isMySQLFamily(e)||e.options.type==="aurora-mysql"||e.options.type==="oracle")return" FOR UPDATE"+B;if(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+I+B;if(e.options.type==="mssql")return"";throw new LockNotSupportedOnGivenDriverError;case"pessimistic_partial_write":if(DriverUtils.isPostgresFamily(e))return" FOR UPDATE"+I+" SKIP LOCKED";if(DriverUtils.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new LockNotSupportedOnGivenDriverError;case"pessimistic_write_or_fail":if(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+I+" NOWAIT";if(DriverUtils.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new LockNotSupportedOnGivenDriverError;case"for_no_key_update":if(DriverUtils.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR NO KEY UPDATE"+I+B;throw new LockNotSupportedOnGivenDriverError;case"for_key_share":if(DriverUtils.isPostgresFamily(e))return" FOR KEY SHARE"+I+B;throw new LockNotSupportedOnGivenDriverError;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map((I,B)=>{switch(I.type){case"and":return(B>0?"AND ":"")+this.replacePropertyNames(I.condition);case"or":return(B>0?"OR ":"")+this.replacePropertyNames(I.condition);default:return this.replacePropertyNames(I.condition)}}).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,I){const B=this.expressionMap.selects.some(mr=>mr.selection===e),tr=[];if(B&&tr.push(...I.columns.filter(mr=>mr.isSelect===!0)),tr.push(...I.columns.filter(mr=>this.expressionMap.selects.some(hr=>hr.selection===e+"."+mr.propertyPath))),tr.length===0)return[];const rr=this.expressionMap.queryEntity?I.primaryColumns.filter(mr=>tr.indexOf(mr)===-1):[],ir=[...tr,...rr],lr=[],dr=this.escape(e);return ir.forEach(mr=>{let hr=dr+"."+this.escape(mr.databaseName);mr.isVirtualProperty&&mr.query&&(hr=`(${mr.query(dr)})`),this.connection.driver.spatialTypes.indexOf(mr.type)!==-1&&((DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(hr=`${this.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText"}(${hr})`),DriverUtils.isPostgresFamily(this.connection.driver)&&(mr.precision?hr=`ST_AsGeoJSON(${hr}, ${mr.precision})::json`:hr=`ST_AsGeoJSON(${hr})::json`),this.connection.driver.options.type==="mssql"&&(hr=`${hr}.ToString()`));const fr=this.expressionMap.selects.filter(_r=>_r.selection===e+"."+mr.propertyPath);if(fr.length)fr.forEach(_r=>{lr.push({selection:hr,aliasName:_r.aliasName?_r.aliasName:DriverUtils.buildAlias(this.connection.driver,void 0,e,mr.databaseName),virtual:_r.virtual})});else{if(mr.isVirtualProperty)return;lr.push({selection:hr,aliasName:DriverUtils.buildAlias(this.connection.driver,void 0,e,mr.databaseName),virtual:B})}}),lr}findEntityColumnSelects(e,I){const B=this.expressionMap.selects.find(tr=>tr.selection===e);return B?[B]:this.expressionMap.selects.filter(tr=>I.columns.some(rr=>tr.selection===e+"."+rr.propertyPath))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,B=this.expressionMap.mainAlias.metadata.primaryColumns,tr=this.escape(e);if(this.expressionMap.joinAttributes.length===0&&this.expressionMap.relationIdAttributes.length===0&&this.expressionMap.relationCountAttributes.length===0)return"COUNT(1)";if(this.connection.driver.options.type==="cockroachdb"||DriverUtils.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+B.map(rr=>`${tr}.${this.escape(rr.databaseName)}`).join(", ")+"))";if(DriverUtils.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+B.map(rr=>`${tr}.${this.escape(rr.databaseName)}`).join(", ")+")";if(this.connection.driver.options.type==="mssql"){const rr=B.map(ir=>`${tr}.${this.escape(ir.databaseName)}`).join(", '|;|', ");return B.length===1?`COUNT(DISTINCT(${rr}))`:`COUNT(DISTINCT(CONCAT(${rr})))`}return this.connection.driver.options.type==="spanner"?B.length===1?`COUNT(DISTINCT(${tr}.${this.escape(B[0].databaseName)}))`:`COUNT(DISTINCT(CONCAT(${B.map(ir=>`CAST(${tr}.${this.escape(ir.databaseName)} AS STRING)`).join(", '|;|', ")})))`:"COUNT(DISTINCT("+B.map(rr=>`${tr}.${this.escape(rr.databaseName)}`).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const I=this.computeCountExpression(),B=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(I,"cnt").setOption("disable-global-order").loadRawResults(e);return!B||!B[0]||!B[0].cnt?0:parseInt(B[0].cnt)}async executeExistsQuery(e){return(await this.connection.createQueryBuilder().fromDummy().select("1","row_exists").whereExists(this).limit(1).loadRawResults(e)).length>0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.findOptions.loadEagerRelations!==!1&&this.expressionMap.relationLoadStrategy==="join"&&this.buildEagerRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere(this.conditions.substr(0,1)!=="("?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach(e=>{e.select&&!e.selection?e.type==="inner"?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):e.type==="inner"?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)}),this.findOptions.skip!==void 0&&this.skip(this.findOptions.skip),this.findOptions.take!==void 0&&this.take(this.findOptions.take),typeof this.findOptions.cache=="number"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="boolean"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="object"&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach(e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)}),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach(e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)}),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach(e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)}),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach(e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)})),this.findOptions.lock){if(this.findOptions.lock.mode==="optimistic")this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if(this.findOptions.lock.mode==="pessimistic_read"||this.findOptions.lock.mode==="pessimistic_write"||this.findOptions.lock.mode==="dirty_read"||this.findOptions.lock.mode==="pessimistic_partial_write"||this.findOptions.lock.mode==="pessimistic_write_or_fail"||this.findOptions.lock.mode==="for_no_key_update"||this.findOptions.lock.mode==="for_key_share"){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map(I=>{const B=this.expressionMap.aliases.find(tr=>tr.metadata.tableNameWithoutPrefix===I);if(!B)throw new TypeORMError(`"${I}" is not part of this query`);return this.escape(B.name)}):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}}this.findOptions.loadRelationIds===!0?this.loadAllRelationIds():typeof this.findOptions.loadRelationIds=="object"&&this.loadAllRelationIds(this.findOptions.loadRelationIds),this.findOptions.loadEagerRelations!==!1&&FindOptionsUtils.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),this.findOptions.transaction===!0&&(this.expressionMap.useTransaction=!0)}}concatRelationMetadata(e){this.relationMetadatas.push(e)}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new TypeORMError('Alias is not set. Use "from" method to set an alias.');if((this.expressionMap.lockMode==="pessimistic_read"||this.expressionMap.lockMode==="pessimistic_write"||this.expressionMap.lockMode==="pessimistic_partial_write"||this.expressionMap.lockMode==="pessimistic_write_or_fail"||this.expressionMap.lockMode==="for_no_key_update"||this.expressionMap.lockMode==="for_key_share")&&!e.isTransactionActive)throw new PessimisticLockTransactionRequiredError;if(this.expressionMap.lockMode==="optimistic"){const dr=this.expressionMap.mainAlias.metadata;if(!dr.versionColumn&&!dr.updateDateColumn)throw new NoVersionOrUpdateDateColumnError(dr.name)}const I=new RelationIdLoader$1(this.connection,e,this.expressionMap.relationIdAttributes),B=new RelationCountLoader(this.connection,e,this.expressionMap.relationCountAttributes);new RelationIdMetadataToAttributeTransformer(this.expressionMap).transform(),new RelationCountMetadataToAttributeTransformer(this.expressionMap).transform();let ir=[],lr=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[dr,mr]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),hr=this.expressionMap.mainAlias.metadata,fr=this.expressionMap.mainAlias.name,_r=hr.primaryColumns.map(Ar=>{const Or=this.escape("distinctAlias"),Fr=this.escape(DriverUtils.buildAlias(this.connection.driver,void 0,fr,Ar.databaseName));mr[Fr]||(mr[Fr]="ASC");const vr=DriverUtils.buildAlias(this.connection.driver,void 0,"ids_"+fr,Ar.databaseName);return`${Or}.${Fr} AS ${this.escape(vr)}`}),gr=this.clone(),Sr=gr.expressionMap.timeTravel;if(ir=await new SelectQueryBuilder(this.connection,e).select(`DISTINCT ${_r.join(", ")}`).addSelect(dr).from(`(${gr.orderBy().timeTravelQuery(!1).getQuery()})`,"distinctAlias").timeTravelQuery(Sr).offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(mr).cache(this.expressionMap.cache&&this.expressionMap.cacheId?`${this.expressionMap.cacheId}-pagination`:this.expressionMap.cache,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),ir.length>0){let Ar="";const Or={};if(hr.hasMultiplePrimaryKeys)Ar=ir.map((Fr,vr)=>hr.primaryColumns.map(xr=>{const kr=`orm_distinct_ids_${vr}_${xr.databaseName}`,Gr=DriverUtils.buildAlias(this.connection.driver,void 0,"ids_"+fr,xr.databaseName);return Or[kr]=Fr[Gr],`${fr}.${xr.propertyPath}=:${kr}`}).join(" AND ")).join(" OR ");else{const Fr=DriverUtils.buildAlias(this.connection.driver,void 0,"ids_"+fr,hr.primaryColumns[0].databaseName),vr=ir.map(kr=>kr[Fr]);vr.every(kr=>typeof kr=="number")?Ar=`${fr}.${hr.primaryColumns[0].propertyPath} IN (${vr.join(", ")})`:(Or.orm_distinct_ids=vr,Ar=fr+"."+hr.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}ir=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:Ar}).setParameters(Or).loadRawResults(e)}}else ir=await this.loadRawResults(e);if(ir.length>0){const dr=await I.load(ir),mr=await B.load(ir);lr=new RawSqlResultsToEntityTransformer(this.expressionMap,this.connection.driver,dr,mr,this.queryRunner).transform(ir,this.expressionMap.mainAlias),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,lr)}if(this.expressionMap.relationLoadStrategy==="query"){const dr=new RelationIdLoader(this.connection,e);await Promise.all(this.relationMetadatas.map(async mr=>{const hr=mr.inverseEntityMetadata.target,fr=mr.inverseEntityMetadata.targetName,_r=Array.isArray(this.findOptions.select)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,gr=Array.isArray(this.findOptions.relations)?OrmUtils.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,Sr=this.createQueryBuilder(e).select(fr).from(hr,fr).setFindOptions({select:_r?OrmUtils.deepValue(_r,mr.propertyPath):void 0,order:this.findOptions.order?OrmUtils.deepValue(this.findOptions.order,mr.propertyPath):void 0,relations:gr?OrmUtils.deepValue(gr,mr.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(lr.length>0){const Ar=await dr.loadManyToManyRelationIdsAndGroup(mr,lr,void 0,Sr);lr.forEach(Or=>{const Fr=Ar.find(vr=>vr.entity===Or);if(Fr){const vr=Fr.related===void 0?null:Fr.related;mr.setEntityValue(Or,vr)}})}}))}return{raw:ir,entities:lr}}createOrderByCombinedWithSelectExpression(e){const I=this.expressionMap.allOrderBys,B=Object.keys(I).map(rr=>{if(rr.indexOf(".")!==-1){const ir=rr.split("."),lr=ir[0],dr=ir.slice(1).join("."),hr=this.expressionMap.findAliasByName(lr).metadata.findColumnWithPropertyPath(dr);return this.escape(e)+"."+this.escape(DriverUtils.buildAlias(this.connection.driver,void 0,lr,hr.databaseName))}else return this.expressionMap.selects.find(ir=>ir.selection===rr||ir.aliasName===rr)?this.escape(e)+"."+this.escape(rr):""}).join(", "),tr={};return Object.keys(I).forEach(rr=>{if(rr.indexOf(".")!==-1){const ir=rr.split("."),lr=ir[0],dr=ir.slice(1).join("."),hr=this.expressionMap.findAliasByName(lr).metadata.findColumnWithPropertyPath(dr);tr[this.escape(e)+"."+this.escape(DriverUtils.buildAlias(this.connection.driver,void 0,lr,hr.databaseName))]=I[rr]}else this.expressionMap.selects.find(ir=>ir.selection===rr||ir.aliasName===rr)?tr[this.escape(e)+"."+this.escape(rr)]=I[rr]:tr[rr]=I[rr]}),[B,tr]}async loadRawResults(e){const[I,B]=this.getQueryAndParameters(),tr=I+" -- PARAMETERS: "+JSON.stringify(B,(hr,fr)=>typeof fr=="bigint"?fr.toString():fr),rr=typeof this.connection.options.cache=="object"?this.connection.options.cache:{};let ir;const lr=rr.alwaysEnabled&&this.expressionMap.cache!==!1||this.expressionMap.cache===!0;let dr=!1;if(this.connection.queryResultCache&&lr)try{if(ir=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:tr,duration:this.expressionMap.cacheDuration||rr.duration||1e3},e),ir&&!this.connection.queryResultCache.isExpired(ir))return JSON.parse(ir.result)}catch(hr){if(!rr.ignoreErrors)throw hr;dr=!0}const mr=await e.query(I,B,!0);if(!dr&&this.connection.queryResultCache&&lr)try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:tr,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||rr.duration||1e3,result:JSON.stringify(mr.records)},ir,e)}catch(hr){if(!rr.ignoreErrors)throw hr}return mr.records}mergeExpressionMap(e){return ObjectUtils.assign(this.expressionMap,e),this}normalizeNumber(e){return typeof e=="number"||e===void 0||e===null?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner(this.connection.defaultReplicationModeForReads())}buildSelect(e,I,B,tr){for(let rr in e){if(e[rr]===void 0||e[rr]===!1)continue;const ir=tr?tr+"."+rr:rr,lr=I.findColumnWithPropertyPathStrict(ir),dr=I.findEmbeddedWithPropertyPath(ir),mr=I.findRelationWithPropertyPath(ir);if(!dr&&!lr&&!mr)throw new EntityPropertyNotFoundError(ir,I);lr?this.selects.push(B+"."+ir):dr&&this.buildSelect(e[rr],I,B,ir)}}buildRelations(e,I,B,tr,rr){e&&Object.keys(e).forEach(ir=>{const lr=e[ir],dr=rr?rr+"."+ir:ir,mr=B.findEmbeddedWithPropertyPath(dr),hr=B.findRelationWithPropertyPath(dr);if(!mr&&!hr)throw new EntityPropertyNotFoundError(dr,B);if(mr)this.buildRelations(lr,typeof I=="object"?OrmUtils.deepValue(I,mr.propertyPath):void 0,B,tr,dr);else if(hr){let fr=tr+"_"+dr.replace(".","_");fr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},tr,fr),(lr===!0||typeof lr=="object")&&(this.expressionMap.relationLoadStrategy==="query"?this.concatRelationMetadata(hr):(this.joins.push({type:"left",select:!0,selection:I&&typeof I[ir]=="object"?I[ir]:void 0,alias:fr,parentAlias:tr,relationMetadata:hr}),I&&typeof I[ir]=="object"&&this.buildSelect(I[ir],hr.inverseEntityMetadata,fr))),typeof lr=="object"&&this.expressionMap.relationLoadStrategy==="join"&&this.buildRelations(lr,typeof I=="object"?OrmUtils.deepValue(I,hr.propertyPath):void 0,hr.inverseEntityMetadata,fr,void 0)}})}buildEagerRelations(e,I,B,tr,rr){e&&Object.keys(e).forEach(ir=>{const lr=e[ir],dr=rr?rr+"."+ir:ir,mr=B.findEmbeddedWithPropertyPath(dr),hr=B.findRelationWithPropertyPath(dr);if(!mr&&!hr)throw new EntityPropertyNotFoundError(dr,B);if(mr)this.buildEagerRelations(lr,typeof I=="object"?OrmUtils.deepValue(I,mr.propertyPath):void 0,B,tr,dr);else if(hr){let fr=tr+"_"+dr.replace(".","_");fr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},tr,fr),(lr===!0||typeof lr=="object")&&hr.inverseEntityMetadata.eagerRelations.forEach(_r=>{let gr=fr+"_"+_r.propertyPath.replace(".","_");gr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},fr,gr),this.joins.find(Ar=>Ar.alias===gr)||this.joins.push({type:"left",select:!0,alias:gr,parentAlias:fr,selection:void 0,relationMetadata:_r}),I&&typeof I[ir]=="object"&&this.buildSelect(I[ir],hr.inverseEntityMetadata,fr)}),typeof lr=="object"&&this.buildEagerRelations(lr,typeof I=="object"?OrmUtils.deepValue(I,hr.propertyPath):void 0,hr.inverseEntityMetadata,fr,void 0)}})}buildOrder(e,I,B,tr){for(let rr in e){if(e[rr]===void 0)continue;const ir=tr?tr+"."+rr:rr,lr=I.findColumnWithPropertyPathStrict(ir),dr=I.findEmbeddedWithPropertyPath(ir),mr=I.findRelationWithPropertyPath(ir);if(!dr&&!lr&&!mr)throw new EntityPropertyNotFoundError(ir,I);if(lr){let hr=typeof e[rr]=="object"?e[rr].direction:e[rr];hr=hr==="DESC"||hr==="desc"||hr===-1?"DESC":"ASC";let fr=typeof e[rr]=="object"?e[rr].nulls:void 0;fr=fr?.toLowerCase()==="first"?"NULLS FIRST":fr?.toLowerCase()==="last"?"NULLS LAST":void 0;let _r=`${B}.${ir}`;this.addOrderBy(_r,hr,fr)}else if(dr)this.buildOrder(e[rr],I,B,ir);else if(mr){let hr=B+"_"+ir.replace(".","_");hr=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},B,hr),this.joins.find(_r=>_r.alias===hr)||this.joins.push({type:"left",select:!1,alias:hr,parentAlias:B,selection:void 0,relationMetadata:mr}),this.buildOrder(e[rr],mr.inverseEntityMetadata,hr)}}}buildWhere(e,I,B,tr){let rr="";if(Array.isArray(e))e.length&&(rr=e.map(ir=>this.buildWhere(ir,I,B,tr)).filter(ir=>!!ir).map(ir=>"("+ir+")").join(" OR "));else{let ir=[];for(let lr in e){if(e[lr]===void 0||e[lr]===null)continue;const dr=tr?tr+"."+lr:lr,mr=I.findColumnWithPropertyPathStrict(dr),hr=I.findEmbeddedWithPropertyPath(dr),fr=I.findRelationWithPropertyPath(dr);if(!hr&&!mr&&!fr)throw new EntityPropertyNotFoundError(dr,I);if(mr){let _r=`${B}.${dr}`;mr.isVirtualProperty&&mr.query&&(_r=`(${mr.query(B)})`);let gr=e[lr];InstanceChecker.isEqualOperator(e[lr])&&(gr=e[lr].value),mr.transformer&&(gr instanceof FindOperator?gr.transformValue(mr.transformer):gr=ApplyValueTransformers.transformTo(mr.transformer,gr)),ir.push(this.createWhereConditionExpression(this.getWherePredicateCondition(_r,gr)))}else if(hr){const _r=this.buildWhere(e[lr],I,B,dr);_r&&ir.push(_r)}else if(fr){if(typeof e[lr]=="object"&&Object.keys(e[lr]).every(gr=>e[lr][gr]===void 0))continue;if(InstanceChecker.isFindOperator(e[lr]))if(e[lr].type==="moreThan"||e[lr].type==="lessThan"||e[lr].type==="moreThanOrEqual"||e[lr].type==="lessThanOrEqual"){let _r="";e[lr].type==="moreThan"?_r=">":e[lr].type==="lessThan"?_r="<":e[lr].type==="moreThanOrEqual"?_r=">=":e[lr].type==="lessThanOrEqual"&&(_r="<=");const gr=this.subQuery();if(fr.isManyToManyOwner)gr.select("COUNT(*)").from(fr.joinTableName,fr.joinTableName).where(fr.joinColumns.map(Sr=>`${fr.joinTableName}.${Sr.propertyName} = ${B}.${Sr.referencedColumn.propertyName}`).join(" AND "));else if(fr.isManyToManyNotOwner)gr.select("COUNT(*)").from(fr.inverseRelation.joinTableName,fr.inverseRelation.joinTableName).where(fr.inverseRelation.inverseJoinColumns.map(Sr=>`${fr.inverseRelation.joinTableName}.${Sr.propertyName} = ${B}.${Sr.referencedColumn.propertyName}`).join(" AND "));else if(fr.isOneToMany)gr.select("COUNT(*)").from(fr.inverseEntityMetadata.target,fr.inverseEntityMetadata.tableName).where(fr.inverseRelation.joinColumns.map(Sr=>`${fr.inverseEntityMetadata.tableName}.${Sr.propertyName} = ${B}.${Sr.referencedColumn.propertyName}`).join(" AND "));else throw new Error("This relation isn't supported by given find operator");this.andWhere(gr.getSql()+" "+_r+" "+parseInt(e[lr].value))}else if(fr.isManyToOne||fr.isOneToOne&&fr.isOneToOneOwner){const _r=`${B}.${dr}`;ir.push(this.createWhereConditionExpression(this.getWherePredicateCondition(_r,e[lr])))}else throw new Error("This relation isn't supported by given find operator");else{let _r=B+"_"+fr.propertyPath.replace(".","_");_r=DriverUtils.buildAlias(this.connection.driver,{joiner:"__"},B,_r),this.joins.find(Ar=>Ar.alias===_r)||this.joins.push({type:"left",select:!1,selection:void 0,alias:_r,parentAlias:B,relationMetadata:fr});const Sr=this.buildWhere(e[lr],fr.inverseEntityMetadata,_r);Sr&&ir.push(Sr)}}}rr=ir.length?"("+ir.join(") AND (")+")":ir.join(" AND ")}return rr.length?"("+rr+")":rr}}class UpdateResult{constructor(){this.generatedMaps=[]}static from(e){const I=new this;return I.raw=e.records,I.affected=e.affected,I}}class SoftDeleteQueryBuilder extends QueryBuilder{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const B=new ReturningResultsEntityUpdator(e,this.expressionMap);this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=B.getSoftDeletionReturningColumns());const[tr,rr]=this.getQueryAndParameters(),ir=await e.query(tr,rr,!0),lr=UpdateResult.from(ir);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await B.update(lr,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),I&&await e.commitTransaction(),lr}catch(B){if(I)try{await e.rollbackTransaction()}catch{}throw B}finally{e!==this.queryRunner&&await e.release()}}from(e,I){e=InstanceChecker.isEntitySchema(e)?e.options.name:e;const B=this.createFromAlias(e,I);return this.expressionMap.setMainAlias(B),this}where(e,I){this.expressionMap.wheres=[];const B=this.getWhereCondition(e);return B&&(this.expressionMap.wheres=[{type:"simple",condition:B}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}orderBy(e,I="ASC",B){return e?typeof e=="object"?this.expressionMap.orderBys=e:B?this.expressionMap.orderBys={[e]:{order:I,nulls:B}}:this.expressionMap.orderBys={[e]:I}:this.expressionMap.orderBys={},this}addOrderBy(e,I="ASC",B){return B?this.expressionMap.orderBys[e]={order:I,nulls:B}:this.expressionMap.orderBys[e]=I,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new TypeORMError(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const I=Array.isArray(e)?e:[e];return I.forEach(B=>{const tr=this.expressionMap.mainAlias.metadata.getEntityIdMap(B);if(!tr)throw new TypeORMError("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(tr)}),this.expressionMap.whereEntities=I,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new TypeORMError(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new MissingDeleteDateColumnError(e);const I=[];switch(this.expressionMap.queryType){case"soft-delete":I.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":I.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new TypeORMError('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&I.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&I.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),I.length<=0)throw new UpdateValuesMissingError;const B=this.createWhereExpression(),tr=this.createReturningExpression("update");return tr===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${I.join(", ")}${B}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${I.join(", ")} OUTPUT ${tr}${B}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${I.join(", ")}${B} RETURNING ${tr}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(I=>typeof e[I]=="string"?this.replacePropertyNames(I)+" "+e[I]:this.replacePropertyNames(I)+" "+e[I].order+" "+e[I].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(DriverUtils.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new LimitOnUpdateNotSupportedError}return""}}class UpdateQueryBuilder extends QueryBuilder{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let I=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),I=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let B=null,tr=null;const rr=new ReturningResultsEntityUpdator(e,this.expressionMap),ir=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const _r of this.expressionMap.returning)ir.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(_r));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=rr.getUpdationReturningColumns(),ir.push(...this.expressionMap.extraReturningColumns.filter(_r=>!ir.includes(_r)))),ir.length>0&&this.connection.driver.options.type==="mssql"&&(B=this.connection.driver.buildTableVariableDeclaration("@OutputTable",ir),tr="SELECT * FROM @OutputTable");const[lr,dr]=this.getQueryAndParameters(),mr=[B,lr,tr],hr=await e.query(mr.filter(_r=>_r!=null).join(`;

`),dr,!0),fr=UpdateResult.from(hr);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await rr.update(fr,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),I&&await e.commitTransaction(),fr}catch(B){if(I)try{await e.rollbackTransaction()}catch{}throw B}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,I){this.expressionMap.wheres=[];const B=this.getWhereCondition(e);return B&&(this.expressionMap.wheres=[{type:"simple",condition:B}]),I&&this.setParameters(I),this}andWhere(e,I){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}orWhere(e,I){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),I&&this.setParameters(I),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this}orderBy(e,I="ASC",B){return e?typeof e=="object"?this.expressionMap.orderBys=e:B?this.expressionMap.orderBys={[e]:{order:I,nulls:B}}:this.expressionMap.orderBys={[e]:I}:this.expressionMap.orderBys={},this}addOrderBy(e,I="ASC",B){return B?this.expressionMap.orderBys[e]={order:I,nulls:B}:this.expressionMap.orderBys[e]=I,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new TypeORMError(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const I=Array.isArray(e)?e:[e];return I.forEach(B=>{const tr=this.expressionMap.mainAlias.metadata.getEntityIdMap(B);if(!tr)throw new TypeORMError("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(tr)}),this.expressionMap.whereEntities=I,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),I=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,B={};for(let dr in e)e[dr]!==void 0&&(B[dr]=e[dr]);const tr=[],rr=[];if(I?(this.createPropertyPath(I,B).forEach(dr=>{const mr=I.findColumnsWithPropertyPath(dr);if(mr.length<=0)throw new EntityPropertyNotFoundError(dr,I);mr.forEach(hr=>{if(!hr.isUpdate||rr.includes(hr))return;rr.push(hr);let fr=hr.getEntityValue(B);if(hr.referencedColumn&&typeof fr=="object"&&!(fr instanceof Date)&&fr!==null&&!Buffer.isBuffer(fr)?fr=hr.referencedColumn.getEntityValue(fr):typeof fr!="function"&&(fr=this.connection.driver.preparePersistentValue(fr,hr)),typeof fr=="function")tr.push(this.escape(hr.databaseName)+" = "+fr());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&fr===null)tr.push(this.escape(hr.databaseName)+" = NULL");else{this.connection.driver.options.type==="mssql"&&(fr=this.connection.driver.parametrizeValue(hr,fr));const _r=this.createParameter(fr);let gr=null;if((DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(hr.type)!==-1){const Ar=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";hr.srid!=null?gr=`${Ar}(${_r}, ${hr.srid})`:gr=`${Ar}(${_r})`}else DriverUtils.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(hr.type)!==-1?hr.srid!=null?gr=`ST_SetSRID(ST_GeomFromGeoJSON(${_r}), ${hr.srid})::${hr.type}`:gr=`ST_GeomFromGeoJSON(${_r})::${hr.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(hr.type)!==-1?gr=hr.type+"::STGeomFromText("+_r+", "+(hr.srid||"0")+")":gr=_r;tr.push(this.escape(hr.databaseName)+" = "+gr)}})}),(tr.length>0||Object.keys(B).length===0)&&(I.versionColumn&&rr.indexOf(I.versionColumn)===-1&&tr.push(this.escape(I.versionColumn.databaseName)+" = "+this.escape(I.versionColumn.databaseName)+" + 1"),I.updateDateColumn&&rr.indexOf(I.updateDateColumn)===-1&&tr.push(this.escape(I.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(B).map(dr=>{let mr=B[dr];if(typeof mr=="function")tr.push(this.escape(dr)+" = "+mr());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&mr===null)tr.push(this.escape(dr)+" = NULL");else{const hr=this.createParameter(mr);tr.push(this.escape(dr)+" = "+hr)}}),tr.length<=0)throw new UpdateValuesMissingError;const ir=this.createWhereExpression(),lr=this.createReturningExpression("update");return lr===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${tr.join(", ")}${ir}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${tr.join(", ")} OUTPUT ${lr}${ir}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${tr.join(", ")}${ir} RETURNING ${lr}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(I=>typeof e[I]=="string"?this.replacePropertyNames(I)+" "+e[I]:this.replacePropertyNames(I)+" "+e[I].order+" "+e[I].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")return" LIMIT "+e;throw new LimitOnUpdateNotSupportedError}return""}getValueSet(){if(typeof this.expressionMap.valuesSet=="object")return this.expressionMap.valuesSet;throw new UpdateValuesMissingError}}function registerQueryBuilders(){QueryBuilder.registerQueryBuilderClass("DeleteQueryBuilder",k=>new DeleteQueryBuilder(k)),QueryBuilder.registerQueryBuilderClass("InsertQueryBuilder",k=>new InsertQueryBuilder(k)),QueryBuilder.registerQueryBuilderClass("RelationQueryBuilder",k=>new RelationQueryBuilder(k)),QueryBuilder.registerQueryBuilderClass("SelectQueryBuilder",k=>new SelectQueryBuilder(k)),QueryBuilder.registerQueryBuilderClass("SoftDeleteQueryBuilder",k=>new SoftDeleteQueryBuilder(k)),QueryBuilder.registerQueryBuilderClass("UpdateQueryBuilder",k=>new UpdateQueryBuilder(k))}class RandomGenerator{static sha1(e){let I=function(Gr,is){return Gr<<is|Gr>>>32-is},B=function(Gr){let is="",as,cs;for(as=7;as>=0;as--)cs=Gr>>>as*4&15,is+=cs.toString(16);return is},tr,rr,ir,lr=new Array(80),dr=1732584193,mr=4023233417,hr=2562383102,fr=271733878,_r=3285377520,gr,Sr,Ar,Or,Fr,vr;e=encodeURIComponent(e);let xr=e.length,kr=[];for(rr=0;rr<xr-3;rr+=4)ir=e.charCodeAt(rr)<<24|e.charCodeAt(rr+1)<<16|e.charCodeAt(rr+2)<<8|e.charCodeAt(rr+3),kr.push(ir);switch(xr%4){case 0:rr=2147483648;break;case 1:rr=e.charCodeAt(xr-1)<<24|8388608;break;case 2:rr=e.charCodeAt(xr-2)<<24|e.charCodeAt(xr-1)<<16|32768;break;case 3:rr=e.charCodeAt(xr-3)<<24|e.charCodeAt(xr-2)<<16|e.charCodeAt(xr-1)<<8|128;break}for(kr.push(rr);kr.length%16!==14;)kr.push(0);for(kr.push(xr>>>29),kr.push(xr<<3&4294967295),tr=0;tr<kr.length;tr+=16){for(rr=0;rr<16;rr++)lr[rr]=kr[tr+rr];for(rr=16;rr<=79;rr++)lr[rr]=I(lr[rr-3]^lr[rr-8]^lr[rr-14]^lr[rr-16],1);for(gr=dr,Sr=mr,Ar=hr,Or=fr,Fr=_r,rr=0;rr<=19;rr++)vr=I(gr,5)+(Sr&Ar|~Sr&Or)+Fr+lr[rr]+1518500249&4294967295,Fr=Or,Or=Ar,Ar=I(Sr,30),Sr=gr,gr=vr;for(rr=20;rr<=39;rr++)vr=I(gr,5)+(Sr^Ar^Or)+Fr+lr[rr]+1859775393&4294967295,Fr=Or,Or=Ar,Ar=I(Sr,30),Sr=gr,gr=vr;for(rr=40;rr<=59;rr++)vr=I(gr,5)+(Sr&Ar|Sr&Or|Ar&Or)+Fr+lr[rr]+2400959708&4294967295,Fr=Or,Or=Ar,Ar=I(Sr,30),Sr=gr,gr=vr;for(rr=60;rr<=79;rr++)vr=I(gr,5)+(Sr^Ar^Or)+Fr+lr[rr]+3395469782&4294967295,Fr=Or,Or=Ar,Ar=I(Sr,30),Sr=gr,gr=vr;dr=dr+gr&4294967295,mr=mr+Sr&4294967295,hr=hr+Ar&4294967295,fr=fr+Or&4294967295,_r=_r+Fr&4294967295}return vr=B(dr)+B(mr)+B(hr)+B(fr)+B(_r),vr.toLowerCase()}}class DefaultNamingStrategy{constructor(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}getTableName(e){return typeof e!="string"&&(e=e.name),e.split(".").pop()}tableName(e,I){return I||snakeCase(e)}closureJunctionTableName(e){return e+"_closure"}columnName(e,I,B){const tr=I||e;return B.length?camelCase(B.join("_"))+titleCase(tr):tr}relationName(e){return e}primaryKeyName(e,I){const B=[...I];B.sort();const ir=`${this.getTableName(e).replace(".","_")}_${B.join("_")}`;return"PK_"+RandomGenerator.sha1(ir).substr(0,27)}uniqueConstraintName(e,I){const B=[...I];B.sort();const ir=`${this.getTableName(e).replace(".","_")}_${B.join("_")}`;return"UQ_"+RandomGenerator.sha1(ir).substr(0,27)}relationConstraintName(e,I,B){const tr=[...I];tr.sort();let lr=`${this.getTableName(e).replace(".","_")}_${tr.join("_")}`;return B&&(lr+=`_${B}`),"REL_"+RandomGenerator.sha1(lr).substr(0,26)}defaultConstraintName(e,I){const rr=`${this.getTableName(e).replace(".","_")}_${I}`;return"DF_"+RandomGenerator.sha1(rr).substr(0,27)}foreignKeyName(e,I,B,tr){const rr=[...I];rr.sort();const dr=`${this.getTableName(e).replace(".","_")}_${rr.join("_")}`;return"FK_"+RandomGenerator.sha1(dr).substr(0,27)}indexName(e,I,B){const tr=[...I];tr.sort();let lr=`${this.getTableName(e).replace(".","_")}_${tr.join("_")}`;return B&&(lr+=`_${B}`),"IDX_"+RandomGenerator.sha1(lr).substr(0,26)}checkConstraintName(e,I,B){const ir=`${this.getTableName(e).replace(".","_")}_${I}`,lr="CHK_"+RandomGenerator.sha1(ir).substr(0,26);return B?`${lr}_ENUM`:lr}exclusionConstraintName(e,I){const rr=`${this.getTableName(e).replace(".","_")}_${I}`;return"XCL_"+RandomGenerator.sha1(rr).substr(0,26)}joinColumnName(e,I){return camelCase(e+"_"+I)}joinTableName(e,I,B,tr){return snakeCase(e+"_"+B.replace(/\./gi,"_")+"_"+I)}joinTableColumnDuplicationPrefix(e,I){return e+"_"+I}joinTableColumnName(e,I,B){return camelCase(e+"_"+(B||I))}joinTableInverseColumnName(e,I,B){return this.joinTableColumnName(e,I,B)}prefixTableName(e,I){return e+I}}class TableColumn{constructor(e){this["@instanceof"]=Symbol.for("TableColumn"),this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=this.zerofill?!0:e.unsigned||!1,this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.generatedIdentity=e.generatedIdentity,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.primaryKeyConstraintName=e.primaryKeyConstraintName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}clone(){return new TableColumn({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,primaryKeyConstraintName:this.primaryKeyConstraintName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,generatedIdentity:this.generatedIdentity,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})}}class TableIndex{constructor(e){this["@instanceof"]=Symbol.for("TableIndex"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isConcurrent=!!e.isConcurrent,this.isFulltext=!!e.isFulltext,this.isNullFiltered=!!e.isNullFiltered,this.parser=e.parser,this.where=e.where?e.where:""}clone(){return new TableIndex({name:this.name,columnNames:[...this.columnNames],isUnique:this.isUnique,isSpatial:this.isSpatial,isConcurrent:this.isConcurrent,isFulltext:this.isFulltext,isNullFiltered:this.isNullFiltered,parser:this.parser,where:this.where})}static create(e){return new TableIndex({name:e.name,columnNames:e.columns.map(I=>I.databaseName),isUnique:e.isUnique,isSpatial:e.isSpatial,isConcurrent:e.isConcurrent,isFulltext:e.isFulltext,isNullFiltered:e.isNullFiltered,parser:e.parser,where:e.where})}}class TableForeignKey{constructor(e){this["@instanceof"]=Symbol.for("TableForeignKey"),this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedDatabase=e.referencedDatabase,this.referencedSchema=e.referencedSchema,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}clone(){return new TableForeignKey({name:this.name,columnNames:[...this.columnNames],referencedColumnNames:[...this.referencedColumnNames],referencedDatabase:this.referencedDatabase,referencedSchema:this.referencedSchema,referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})}static create(e,I){return new TableForeignKey({name:e.name,columnNames:e.columnNames,referencedColumnNames:e.referencedColumnNames,referencedDatabase:e.referencedEntityMetadata.database,referencedSchema:e.referencedEntityMetadata.schema,referencedTableName:e.referencedTablePath,onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable})}}class TableUtils{static createTableColumnOptions(e,I){return{name:e.databaseName,length:I.getColumnLength(e),width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:I.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,generatedIdentity:e.generatedIdentity,isNullable:e.isNullable,type:I.normalizeType(e),isPrimary:e.isPrimary,isUnique:I.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map(B=>B+""):e.enum,enumName:e.enumName,primaryKeyConstraintName:e.primaryKeyConstraintName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}}}class TableUnique{constructor(e){this["@instanceof"]=Symbol.for("TableUnique"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.deferrable=e.deferrable}clone(){return new TableUnique({name:this.name,columnNames:[...this.columnNames],deferrable:this.deferrable})}static create(e){return new TableUnique({name:e.name,columnNames:e.columns.map(I=>I.databaseName),deferrable:e.deferrable})}}class TableCheck{constructor(e){this["@instanceof"]=Symbol.for("TableCheck"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}clone(){return new TableCheck({name:this.name,columnNames:this.columnNames?[...this.columnNames]:[],expression:this.expression})}static create(e){return new TableCheck({name:e.name,expression:e.expression})}}class TableExclusion{constructor(e){this["@instanceof"]=Symbol.for("TableExclusion"),this.name=e.name,this.expression=e.expression}clone(){return new TableExclusion({name:this.name,expression:this.expression})}static create(e){return new TableExclusion({name:e.name,expression:e.expression})}}class Table{constructor(e){this["@instanceof"]=Symbol.for("Table"),this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,this.withoutRowid=!1,e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,e.columns&&(this.columns=e.columns.map(I=>new TableColumn(I))),e.indices&&(this.indices=e.indices.map(I=>new TableIndex(I))),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map(I=>new TableForeignKey({...I,referencedDatabase:I?.referencedDatabase||e.database,referencedSchema:I?.referencedSchema||e.schema}))),e.uniques&&(this.uniques=e.uniques.map(I=>new TableUnique(I))),e.checks&&(this.checks=e.checks.map(I=>new TableCheck(I))),e.exclusions&&(this.exclusions=e.exclusions.map(I=>new TableExclusion(I))),e.justCreated!==void 0&&(this.justCreated=e.justCreated),e.withoutRowid&&(this.withoutRowid=e.withoutRowid),this.engine=e.engine,this.comment=e.comment)}get primaryColumns(){return this.columns.filter(e=>e.isPrimary)}clone(){return new Table({schema:this.schema,database:this.database,name:this.name,columns:this.columns.map(e=>e.clone()),indices:this.indices.map(e=>e.clone()),foreignKeys:this.foreignKeys.map(e=>e.clone()),uniques:this.uniques.map(e=>e.clone()),checks:this.checks.map(e=>e.clone()),exclusions:this.exclusions.map(e=>e.clone()),justCreated:this.justCreated,withoutRowid:this.withoutRowid,engine:this.engine,comment:this.comment})}addColumn(e){this.columns.push(e)}removeColumn(e){const I=this.columns.find(B=>B.name===e.name);I&&this.columns.splice(this.columns.indexOf(I),1)}addUniqueConstraint(e){if(this.uniques.push(e),e.columnNames.length===1){const I=this.columns.find(B=>B.name===e.columnNames[0]);I&&(I.isUnique=!0)}}removeUniqueConstraint(e){const I=this.uniques.find(B=>B.name===e.name);if(I&&(this.uniques.splice(this.uniques.indexOf(I),1),I.columnNames.length===1)){const B=this.columns.find(tr=>tr.name===I.columnNames[0]);B&&(B.isUnique=!1)}}addCheckConstraint(e){this.checks.push(e)}removeCheckConstraint(e){const I=this.checks.find(B=>B.name===e.name);I&&this.checks.splice(this.checks.indexOf(I),1)}addExclusionConstraint(e){this.exclusions.push(e)}removeExclusionConstraint(e){const I=this.exclusions.find(B=>B.name===e.name);I&&this.exclusions.splice(this.exclusions.indexOf(I),1)}addForeignKey(e){this.foreignKeys.push(e)}removeForeignKey(e){const I=this.foreignKeys.find(B=>B.name===e.name);I&&this.foreignKeys.splice(this.foreignKeys.indexOf(I),1)}addIndex(e,I=!1){if(this.indices.push(e),e.columnNames.length===1&&e.isUnique&&I){const B=this.columns.find(tr=>tr.name===e.columnNames[0]);B&&(B.isUnique=!0)}}removeIndex(e,I=!1){const B=this.indices.find(tr=>tr.name===e.name);if(B&&(this.indices.splice(this.indices.indexOf(B),1),B.columnNames.length===1&&B.isUnique&&I)){const tr=this.columns.find(rr=>rr.name===B.columnNames[0]);tr&&(tr.isUnique=this.indices.some(rr=>rr.columnNames.length===1&&rr.columnNames[0]===tr.name&&!!B.isUnique))}}findColumnByName(e){return this.columns.find(I=>I.name===e)}findColumnIndices(e){return this.indices.filter(I=>!!I.columnNames.find(B=>B===e.name))}findColumnForeignKeys(e){return this.foreignKeys.filter(I=>!!I.columnNames.find(B=>B===e.name))}findColumnUniques(e){return this.uniques.filter(I=>!!I.columnNames.find(B=>B===e.name))}findColumnChecks(e){return this.checks.filter(I=>!!I.columnNames.find(B=>B===e.name))}static create(e,I){const B=e.database===I.database?void 0:e.database,tr=e.schema===I.options.schema?void 0:e.schema,rr={database:e.database,schema:e.schema,name:I.buildTableName(e.tableName,tr,B),withoutRowid:e.withoutRowid,engine:e.engine,columns:e.columns.filter(ir=>ir&&!ir.isVirtualProperty).map(ir=>TableUtils.createTableColumnOptions(ir,I)),indices:e.indices.filter(ir=>ir.synchronize===!0).map(ir=>TableIndex.create(ir)),uniques:e.uniques.map(ir=>TableUnique.create(ir)),checks:e.checks.map(ir=>TableCheck.create(ir)),exclusions:e.exclusions.map(ir=>TableExclusion.create(ir)),comment:e.comment};return new Table(rr)}}class Migration{constructor(e,I,B,tr,rr){this.id=e,this.timestamp=I,this.name=B,this.instance=tr,this.transaction=rr}}class MssqlParameter{constructor(e,I,...B){this.value=e,this.type=I,this["@instanceof"]=Symbol.for("MssqlParameter"),this.params=[],this.params=B||[]}}class MigrationExecutor{constructor(e,I){this.connection=e,this.queryRunner=I,this.transaction="all";const{schema:B}=this.connection.driver.options,tr=this.connection.driver.database;this.migrationsDatabase=tr,this.migrationsSchema=B,this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,B,tr)}async executeMigration(e){return this.withQueryRunner(async I=>{await this.createMigrationsTableIfNotExist(I);const B=this.connection.driver.createSchemaBuilder();return InstanceChecker.isRdbmsSchemaBuilder(B)&&await B.createMetadataTableIfNecessary(I),await I.beforeMigration(),await e.instance.up(I),await I.afterMigration(),await this.insertExecutedMigration(I,e),e})}async getAllMigrations(){return Promise.resolve(this.getMigrations())}async getExecutedMigrations(){return this.withQueryRunner(async e=>(await this.createMigrationsTableIfNotExist(e),await this.loadExecutedMigrations(e)))}async getPendingMigrations(){const e=await this.getAllMigrations(),I=await this.getExecutedMigrations();return e.filter(B=>!I.find(tr=>tr.name===B.name))}insertMigration(e){return this.withQueryRunner(I=>this.insertExecutedMigration(I,e))}deleteMigration(e){return this.withQueryRunner(I=>this.deleteExecutedMigration(I,e))}async showMigrations(){let e=!1;const I=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(I);const B=await this.loadExecutedMigrations(I),tr=this.getMigrations();for(const rr of tr){const ir=B.find(lr=>lr.name===rr.name);ir?this.connection.logger.logSchemaBuild(`[X] ${ir.id} ${rr.name}`):(e=!0,this.connection.logger.logSchemaBuild(`[ ] ${rr.name}`))}return this.queryRunner||await I.release(),e}async executePendingMigrations(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const I=this.connection.driver.createSchemaBuilder();InstanceChecker.isRdbmsSchemaBuilder(I)&&await I.createMetadataTableIfNecessary(e);const B=await this.loadExecutedMigrations(e);let tr=this.getLatestTimestampMigration(B);const rr=this.getMigrations(),ir=[],lr=rr.filter(hr=>!B.find(_r=>_r.name===hr.name));if(!lr.length)return this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner||await e.release(),[];if(this.connection.logger.logSchemaBuild(`${B.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${rr.length} migrations were found in the source code.`),tr&&this.connection.logger.logSchemaBuild(`${tr.name} is the last executed migration. It was executed on ${new Date(tr.timestamp).toString()}.`),this.connection.logger.logSchemaBuild(`${lr.length} migrations are new migrations must be executed.`),this.transaction==="all"){const hr=lr.filter(fr=>fr.instance?.transaction!==void 0);if(hr.length>0){const fr=new ForbiddenTransactionModeOverrideError(hr);throw this.connection.logger.logMigration(`Migrations failed, error: ${fr.message}`),fr}}const dr={each:!0,none:!1,all:!1}[this.transaction];for(const hr of lr)if(hr.instance){const fr=hr.instance.transaction;fr===void 0?hr.transaction=dr:hr.transaction=fr}let mr=!1;this.transaction==="all"&&!e.isTransactionActive&&(await e.beforeMigration(),await e.startTransaction(),mr=!0);try{for(const hr of lr){if(this.fake){await this.insertExecutedMigration(e,hr);continue}hr.transaction&&!e.isTransactionActive&&(await e.beforeMigration(),await e.startTransaction(),mr=!0),await hr.instance.up(e).catch(fr=>{throw this.connection.logger.logMigration(`Migration "${hr.name}" failed, error: ${fr?.message}`),fr}).then(async()=>{await this.insertExecutedMigration(e,hr),hr.transaction&&mr&&(await e.commitTransaction(),await e.afterMigration())}).then(()=>{ir.push(hr),this.connection.logger.logSchemaBuild(`Migration ${hr.name} has been ${this.fake?"(fake)":""} executed successfully.`)})}this.transaction==="all"&&mr&&(await e.commitTransaction(),await e.afterMigration())}catch(hr){if(mr)try{await e.rollbackTransaction()}catch{}throw hr}finally{this.queryRunner||await e.release()}return ir}async undoLastMigration(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const I=this.connection.driver.createSchemaBuilder();InstanceChecker.isRdbmsSchemaBuilder(I)&&await I.createMetadataTableIfNecessary(e);const B=await this.loadExecutedMigrations(e);let tr=this.getLatestExecutedMigration(B);if(!tr){this.connection.logger.logSchemaBuild("No migrations were found in the database. Nothing to revert!");return}const ir=this.getMigrations().find(dr=>dr.name===tr.name);if(!ir)throw new TypeORMError(`No migration ${tr.name} was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.`);this.connection.logger.logSchemaBuild(`${B.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${tr.name} is the last executed migration. It was executed on ${new Date(tr.timestamp).toString()}.`),this.connection.logger.logSchemaBuild("Now reverting it...");let lr=!1;this.transaction!=="none"&&!e.isTransactionActive&&(await e.startTransaction(),lr=!0);try{this.fake||(await e.beforeMigration(),await ir.instance.down(e),await e.afterMigration()),await this.deleteExecutedMigration(e,ir),this.connection.logger.logSchemaBuild(`Migration ${ir.name} has been ${this.fake?"(fake)":""} reverted successfully.`),lr&&await e.commitTransaction()}catch(dr){if(lr)try{await e.rollbackTransaction()}catch{}throw dr}finally{this.queryRunner||await e.release()}}async createMigrationsTableIfNotExist(e){if(this.connection.driver.options.type==="mongodb")return;await e.hasTable(this.migrationsTable)||await e.createTable(new Table({database:this.migrationsDatabase,schema:this.migrationsSchema,name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))}async loadExecutedMigrations(e){return this.connection.driver.options.type==="mongodb"?e.cursor(this.migrationsTableName,{}).sort({_id:-1}).toArray():(await this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()).map(B=>new Migration(parseInt(B.id),parseInt(B.timestamp),B.name))}getMigrations(){const e=this.connection.migrations.map(I=>{const B=I.name||I.constructor.name,tr=parseInt(B.substr(-13),10);if(!tr||isNaN(tr))throw new TypeORMError(`${B} migration name is wrong. Migration class name should have a JavaScript timestamp appended.`);return new Migration(void 0,tr,B,I)});return this.checkForDuplicateMigrations(e),e.sort((I,B)=>I.timestamp-B.timestamp)}checkForDuplicateMigrations(e){const I=e.map(tr=>tr.name),B=Array.from(new Set(I.filter((tr,rr)=>I.indexOf(tr)<rr)));if(B.length>0)throw Error(`Duplicate migrations: ${B.join(", ")}`)}getLatestTimestampMigration(e){const I=e.map(B=>B).sort((B,tr)=>(B.timestamp-tr.timestamp)*-1);return I.length>0?I[0]:void 0}getLatestExecutedMigration(e){return e.length>0?e[0]:void 0}async insertExecutedMigration(e,I){const B={};this.connection.driver.options.type==="mssql"?(B.timestamp=new MssqlParameter(I.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),B.name=new MssqlParameter(I.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(B.timestamp=I.timestamp,B.name=I.name),this.connection.driver.options.type==="mongodb"?await e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insertOne(B):await e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(B).execute()}async deleteExecutedMigration(e,I){const B={};if(this.connection.driver.options.type==="mssql"?(B.timestamp=new MssqlParameter(I.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),B.name=new MssqlParameter(I.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(B.timestamp=I.timestamp,B.name=I.name),this.connection.driver.options.type==="mongodb")await e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(B);else{const tr=e.manager.createQueryBuilder();await tr.delete().from(this.migrationsTable).where(`${tr.escape("timestamp")} = :timestamp`).andWhere(`${tr.escape("name")} = :name`).setParameters(B).execute()}}async withQueryRunner(e){const I=this.queryRunner||this.connection.createQueryRunner();try{return await e(I)}finally{this.queryRunner||await I.release()}}}function createDFS(k,e,I){let B=[],tr={};return function rr(ir){tr[ir]=!0,B.push(ir),k[ir].forEach(function(lr){if(!tr[lr])rr(lr);else if(B.indexOf(lr)>=0)throw B.push(lr),new TypeORMError(`Dependency Cycle Found: ${B.join(" -> ")}`)}),B.pop(),(!e||k[ir].length===0)&&I.indexOf(ir)===-1&&I.push(ir)}}class DepGraph{constructor(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}addNode(e,I){this.hasNode(e)||(arguments.length===2?this.nodes[e]=I:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])}removeNode(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(I){Object.keys(I).forEach(function(B){const tr=I[B].indexOf(e);tr>=0&&I[B].splice(tr,1)})}))}hasNode(e){return this.nodes.hasOwnProperty(e)}getNodeData(e){if(this.hasNode(e))return this.nodes[e];throw new TypeORMError(`Node does not exist: ${e}`)}setNodeData(e,I){if(this.hasNode(e))this.nodes[e]=I;else throw new TypeORMError(`Node does not exist: ${e}`)}addDependency(e,I){if(!this.hasNode(e))throw new TypeORMError(`Node does not exist: ${e}`);if(!this.hasNode(I))throw new TypeORMError(`Node does not exist: ${I}`);return this.outgoingEdges[e].indexOf(I)===-1&&this.outgoingEdges[e].push(I),this.incomingEdges[I].indexOf(e)===-1&&this.incomingEdges[I].push(e),!0}removeDependency(e,I){let B;this.hasNode(e)&&(B=this.outgoingEdges[e].indexOf(I),B>=0&&this.outgoingEdges[e].splice(B,1)),this.hasNode(I)&&(B=this.incomingEdges[I].indexOf(e),B>=0&&this.incomingEdges[I].splice(B,1))}dependenciesOf(e,I){if(this.hasNode(e)){let B=[];createDFS(this.outgoingEdges,I,B)(e);let rr=B.indexOf(e);return rr>=0&&B.splice(rr,1),B}else throw new TypeORMError(`Node does not exist: ${e}`)}dependantsOf(e,I){if(this.hasNode(e)){let B=[];createDFS(this.incomingEdges,I,B)(e);let rr=B.indexOf(e);return rr>=0&&B.splice(rr,1),B}else throw new TypeORMError(`Node does not exist: ${e}`)}overallOrder(e){let I=this,B=[],tr=Object.keys(this.nodes);if(tr.length===0)return B;{let rr=createDFS(this.outgoingEdges,!1,[]);tr.forEach(function(lr){rr(lr)});let ir=createDFS(this.outgoingEdges,e,B);return tr.filter(function(lr){return I.incomingEdges[lr].length===0}).forEach(function(lr){ir(lr)}),B}}}class EntityMetadataValidator{validateMany(e,I){e.forEach(B=>this.validate(B,e,I)),this.validateDependencies(e),this.validateEagerRelations(e)}validate(e,I,B){if(!e.primaryColumns.length&&!e.isJunction)throw new MissingPrimaryColumnError(e);if(e.primaryColumns.length>1&&!e.primaryColumns.every((ir,lr,dr)=>ir.primaryKeyConstraintName===dr[0].primaryKeyConstraintName))throw new TypeORMError(`Entity ${e.name} has multiple primary columns with different constraint names. Constraint names should be the equal.`);if(e.inheritancePattern==="STI"||e.tableType==="entity-child"){if(!e.discriminatorColumn)throw new TypeORMError(`Entity ${e.name} using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?`);if(typeof e.discriminatorValue>"u")throw new TypeORMError(`Entity ${e.name} has an undefined discriminator value. Discriminator value should be defined.`);const rr=I.find(ir=>ir!==e&&(ir.inheritancePattern==="STI"||ir.tableType==="entity-child")&&ir.tableName===e.tableName&&ir.discriminatorValue===e.discriminatorValue&&ir.inheritanceTree.some(lr=>e.inheritanceTree.indexOf(lr)!==-1));if(rr)throw new TypeORMError(`Entities ${e.name} and ${rr.name} have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.`)}if(e.relationCounts.forEach(rr=>{if(rr.relation.isManyToOne||rr.relation.isOneToOne)throw new TypeORMError("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),B.options.type!=="mongodb"&&e.columns.filter(rr=>!rr.isVirtualProperty).forEach(rr=>{const ir=B.normalizeType(rr);if(B.supportedDataTypes.indexOf(ir)===-1)throw new DataTypeNotSupportedError(rr,ir,B.options.type);if(rr.length&&B.withLengthColumnTypes.indexOf(ir)===-1)throw new TypeORMError(`Column ${rr.propertyName} of Entity ${e.name} does not support length property.`);if(rr.type==="enum"&&!rr.enum&&!rr.enumName)throw new TypeORMError(`Column "${rr.propertyName}" of Entity "${e.name}" is defined as enum, but missing "enum" or "enumName" properties.`)}),(DriverUtils.isMySQLFamily(B)||B.options.type==="aurora-mysql")&&e.columns.filter(ir=>ir.isGenerated&&ir.generationStrategy!=="uuid").length>1)throw new TypeORMError(`Error in ${e.name} entity. There can be only one auto-increment column in MySql table.`);if(DriverUtils.isMySQLFamily(B)&&I.filter(ir=>ir.database).length===0&&!B.database)throw new NoConnectionOptionError("database");if(B.options.type==="mssql"&&e.columns.filter(ir=>ir.charset).length>1)throw new TypeORMError("Character set specifying is not supported in Sql Server");if(B.options.type==="postgres"){const rr=e.columns.find(ir=>ir.asExpression&&(!ir.generatedType||ir.generatedType==="VIRTUAL"));if(rr)throw new TypeORMError(`Column "${rr.propertyName}" of Entity "${e.name}" is defined as VIRTUAL, but Postgres supports only STORED generated columns.`)}const tr=e.create(void 0,{fromDeserializer:!0});e.relations.forEach(rr=>{if(rr.isManyToMany||rr.isOneToMany){if(rr.persistenceEnabled===!1)return;const ir=rr.getEntityValue(tr);if(Array.isArray(ir))throw new InitializedRelationError(rr)}}),e.relations.forEach(rr=>{if(B.supportedOnDeleteTypes&&rr.onDelete&&!B.supportedOnDeleteTypes.includes(rr.onDelete))throw new TypeORMError(`OnDeleteType "${rr.onDelete}" is not supported for ${B.options.type}!`);if(B.supportedOnUpdateTypes&&rr.onUpdate&&!B.supportedOnUpdateTypes.includes(rr.onUpdate))throw new TypeORMError(`OnUpdateType "${rr.onUpdate}" is not valid for ${B.options.type}!`)}),e.relations.forEach(rr=>{if(rr.isCascadeRemove&&rr.inverseRelation&&rr.inverseRelation.isCascadeRemove)throw new TypeORMError(`Relation ${e.name}#${rr.propertyName} and ${rr.inverseRelation.entityMetadata.name}#${rr.inverseRelation.propertyName} both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.`)}),e.eagerRelations.forEach(rr=>{})}validateDependencies(e){const I=new DepGraph;e.forEach(B=>{I.addNode(B.name)}),e.forEach(B=>{B.relationsWithJoinColumns.filter(tr=>!tr.isNullable).forEach(tr=>{I.addDependency(B.name,tr.inverseEntityMetadata.name)})});try{I.overallOrder()}catch(B){throw new CircularRelationsError(B.toString().replace("Error: Dependency Cycle Found: ",""))}}validateEagerRelations(e){e.forEach(I=>{I.eagerRelations.forEach(B=>{if(B.inverseRelation&&B.inverseRelation.isEager)throw new TypeORMError(`Circular eager relations are disallowed. ${I.targetName}#${B.propertyPath} contains "eager: true", and its inverse side ${B.inverseEntityMetadata.targetName}#${B.inverseRelation.propertyPath} contains "eager: true" as well. Remove "eager: true" from one side of the relation.`)})})}}class MongoDriver{}class MongoEntityManager{}class MongoRepository{}class CockroachDriver{}class SqlServerDriver{}class SapDriver{}class MysqlDriver{}class OracleDriver{}class SqliteDriver{}class BetterSqlite3Driver{}class TreeRepositoryUtils{static createRelationMaps(e,I,B,tr){return tr.map(rr=>{const ir=I.treeParentRelation.joinColumns[0],lr=ir.referencedColumn??I.primaryColumns[0],dr=ir.givenDatabaseName||ir.databaseName,mr=lr.givenDatabaseName||lr.databaseName,hr=rr[B+"_"+mr],fr=rr[B+"_"+dr];return{id:e.connection.driver.prepareHydratedValue(hr,lr),parentId:e.connection.driver.prepareHydratedValue(fr,ir)}})}static buildChildrenEntityTree(e,I,B,tr,rr){const ir=e.treeChildrenRelation.propertyName;if(rr.depth===0){I[ir]=[];return}const dr=e.treeParentRelation.joinColumns[0].referencedColumn??e.primaryColumns[0],mr=dr.getEntityValue(I),hr=tr.filter(_r=>_r.parentId===mr),fr=new Set(hr.map(_r=>_r.id));I[ir]=B.filter(_r=>fr.has(dr.getEntityValue(_r))),I[ir].forEach(_r=>{TreeRepositoryUtils.buildChildrenEntityTree(e,_r,B,tr,{...rr,depth:rr.depth-1})})}static buildParentEntityTree(e,I,B,tr){const rr=e.treeParentRelation.propertyName,lr=e.treeParentRelation.joinColumns[0].referencedColumn??e.primaryColumns[0],dr=lr.getEntityValue(I),mr=tr.find(fr=>fr.id===dr),hr=B.find(fr=>mr?lr.getEntityValue(fr)===mr.parentId:!1);hr&&(I[rr]=hr,TreeRepositoryUtils.buildParentEntityTree(e,I[rr],B,tr))}}class Repository{get metadata(){return this.manager.connection.getMetadata(this.target)}constructor(e,I,B){this.target=e,this.manager=I,this.queryRunner=B}createQueryBuilder(e,I){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,I||this.queryRunner)}hasId(e){return this.manager.hasId(this.metadata.target,e)}getId(e){return this.manager.getId(this.metadata.target,e)}create(e){return this.manager.create(this.metadata.target,e)}merge(e,...I){return this.manager.merge(this.metadata.target,e,...I)}preload(e){return this.manager.preload(this.metadata.target,e)}save(e,I){return this.manager.save(this.metadata.target,e,I)}remove(e,I){return this.manager.remove(this.metadata.target,e,I)}softRemove(e,I){return this.manager.softRemove(this.metadata.target,e,I)}recover(e,I){return this.manager.recover(this.metadata.target,e,I)}insert(e){return this.manager.insert(this.metadata.target,e)}update(e,I){return this.manager.update(this.metadata.target,e,I)}upsert(e,I){return this.manager.upsert(this.metadata.target,e,I)}delete(e){return this.manager.delete(this.metadata.target,e)}softDelete(e){return this.manager.softDelete(this.metadata.target,e)}restore(e){return this.manager.restore(this.metadata.target,e)}exist(e){return this.manager.exists(this.metadata.target,e)}exists(e){return this.manager.exists(this.metadata.target,e)}existsBy(e){return this.manager.existsBy(this.metadata.target,e)}count(e){return this.manager.count(this.metadata.target,e)}countBy(e){return this.manager.countBy(this.metadata.target,e)}sum(e,I){return this.manager.sum(this.metadata.target,e,I)}average(e,I){return this.manager.average(this.metadata.target,e,I)}minimum(e,I){return this.manager.minimum(this.metadata.target,e,I)}maximum(e,I){return this.manager.maximum(this.metadata.target,e,I)}async find(e){return this.manager.find(this.metadata.target,e)}async findBy(e){return this.manager.findBy(this.metadata.target,e)}findAndCount(e){return this.manager.findAndCount(this.metadata.target,e)}findAndCountBy(e){return this.manager.findAndCountBy(this.metadata.target,e)}async findByIds(e){return this.manager.findByIds(this.metadata.target,e)}async findOne(e){return this.manager.findOne(this.metadata.target,e)}async findOneBy(e){return this.manager.findOneBy(this.metadata.target,e)}async findOneById(e){return this.manager.findOneById(this.metadata.target,e)}async findOneOrFail(e){return this.manager.findOneOrFail(this.metadata.target,e)}async findOneByOrFail(e){return this.manager.findOneByOrFail(this.metadata.target,e)}query(e,I){return this.manager.query(e,I)}clear(){return this.manager.clear(this.metadata.target)}increment(e,I,B){return this.manager.increment(this.metadata.target,e,I,B)}decrement(e,I,B){return this.manager.decrement(this.metadata.target,e,I,B)}extend(e){const I=this.constructor,{target:B,manager:tr,queryRunner:rr}=this,ir=class extends I{constructor(lr,dr,mr){super(lr,dr,mr)}};for(const lr in e)ir.prototype[lr]=e[lr];return new ir(B,tr,rr)}}class TreeRepository extends Repository{async findTrees(e){const I=await this.findRoots(e);return await Promise.all(I.map(B=>this.findDescendantsTree(B,e))),I}findRoots(e){const I=lr=>this.manager.connection.driver.escape(lr),B=lr=>this.manager.connection.driver.escape(lr),tr=this.metadata.treeParentRelation.joinColumns[0],rr=tr.givenDatabaseName||tr.databaseName,ir=this.createQueryBuilder("treeEntity");return FindOptionsUtils.applyOptionsToTreeQueryBuilder(ir,e),ir.where(`${I("treeEntity")}.${B(rr)} IS NULL`).getMany()}findDescendants(e,I){const B=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);return FindOptionsUtils.applyOptionsToTreeQueryBuilder(B,I),B.getMany()}async findDescendantsTree(e,I){const B=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);FindOptionsUtils.applyOptionsToTreeQueryBuilder(B,I);const tr=await B.getRawAndEntities(),rr=TreeRepositoryUtils.createRelationMaps(this.manager,this.metadata,"treeEntity",tr.raw);return TreeRepositoryUtils.buildChildrenEntityTree(this.metadata,e,tr.entities,rr,{depth:-1,...I}),e}countDescendants(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()}createDescendantsQueryBuilder(e,I,B){const tr=rr=>this.manager.connection.driver.escape(rr);if(this.metadata.treeType==="closure-table"){const rr=this.metadata.closureJunctionTable.descendantColumns.map(dr=>tr(I)+"."+tr(dr.propertyPath)+" = "+tr(e)+"."+tr(dr.referencedColumn.propertyPath)).join(" AND "),ir={},lr=this.metadata.closureJunctionTable.ancestorColumns.map(dr=>(ir[dr.referencedColumn.propertyName]=dr.referencedColumn.getEntityValue(B),tr(I)+"."+tr(dr.propertyPath)+" = :"+dr.referencedColumn.propertyName)).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,I,rr).where(lr).setParameters(ir)}else if(this.metadata.treeType==="nested-set"){const rr=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath,ir={},lr=this.metadata.treeParentRelation.joinColumns.map(dr=>{const mr=dr.referencedColumn.propertyPath.replace(".","_");return ir[mr]=dr.referencedColumn.getEntityValue(B),"joined."+dr.referencedColumn.propertyPath+" = :"+mr}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",rr).where(lr,ir)}else if(this.metadata.treeType==="materialized-path")return this.createQueryBuilder(e).where(rr=>{const ir=rr.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(B));return DriverUtils.isSQLiteFamily(this.manager.connection.driver)?`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE ${ir.getQuery()} || '%'`:`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE NULLIF(CONCAT(${ir.getQuery()}, '%'), '%')`});throw new TypeORMError("Supported only in tree entities")}findAncestors(e,I){const B=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);return FindOptionsUtils.applyOptionsToTreeQueryBuilder(B,I),B.getMany()}async findAncestorsTree(e,I){const B=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);FindOptionsUtils.applyOptionsToTreeQueryBuilder(B,I);const tr=await B.getRawAndEntities(),rr=TreeRepositoryUtils.createRelationMaps(this.manager,this.metadata,"treeEntity",tr.raw);return TreeRepositoryUtils.buildParentEntityTree(this.metadata,e,tr.entities,rr),e}countAncestors(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()}createAncestorsQueryBuilder(e,I,B){if(this.metadata.treeType==="closure-table"){const tr=this.metadata.closureJunctionTable.ancestorColumns.map(lr=>I+"."+lr.propertyPath+" = "+e+"."+lr.referencedColumn.propertyPath).join(" AND "),rr={},ir=this.metadata.closureJunctionTable.descendantColumns.map(lr=>(rr[lr.referencedColumn.propertyName]=lr.referencedColumn.getEntityValue(B),I+"."+lr.propertyPath+" = :"+lr.referencedColumn.propertyName)).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,I,tr).where(ir).setParameters(rr)}else if(this.metadata.treeType==="nested-set"){const tr="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath,rr={},ir=this.metadata.treeParentRelation.joinColumns.map(lr=>{const dr=lr.referencedColumn.propertyPath.replace(".","_");return rr[dr]=lr.referencedColumn.getEntityValue(B),"joined."+lr.referencedColumn.propertyPath+" = :"+dr}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",tr).where(ir,rr)}else if(this.metadata.treeType==="materialized-path")return this.createQueryBuilder(e).where(tr=>{const rr=tr.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(B));return DriverUtils.isSQLiteFamily(this.manager.connection.driver)?`${rr.getQuery()} LIKE ${e}.${this.metadata.materializedPathColumn.propertyPath} || '%'`:`${rr.getQuery()} LIKE CONCAT(${e}.${this.metadata.materializedPathColumn.propertyPath}, '%')`});throw new TypeORMError("Supported only in tree entities")}}class PlainObjectToNewEntityTransformer{transform(e,I,B,tr=!1){return this.groupAndTransform(e,I,B,tr),e}groupAndTransform(e,I,B,tr=!1){B.nonVirtualColumns.forEach(rr=>{const ir=rr.getEntityValue(I);ir!==void 0&&rr.setEntityValue(e,ir)}),B.relations.length&&B.relations.forEach(rr=>{let ir=rr.getEntityValue(e);const lr=rr.getEntityValue(I,tr);if(lr!==void 0)if(rr.isOneToMany||rr.isManyToMany){if(!Array.isArray(lr))return;ir||(ir=[],rr.setEntityValue(e,ir)),lr.forEach(dr=>{let mr=ir.find(fr=>rr.inverseEntityMetadata.compareEntities(dr,fr));const hr=rr.inverseEntityMetadata.findInheritanceMetadata(dr);mr||(mr=hr.create(void 0,{fromDeserializer:!0}),ir.push(mr)),this.groupAndTransform(mr,dr,hr,tr)})}else{if(!ObjectUtils.isObject(lr)){ObjectUtils.isObject(ir)||rr.setEntityValue(e,lr);return}const dr=rr.inverseEntityMetadata.findInheritanceMetadata(lr);ir||(ir=dr.create(void 0,{fromDeserializer:!0}),rr.setEntityValue(e,ir)),this.groupAndTransform(ir,lr,dr,tr)}})}}class LoadMapItem{constructor(e,I,B,tr){this.plainEntity=e,this.metadata=I,this.parentLoadMapItem=B,this.relation=tr}get target(){return this.metadata.target}get id(){return this.metadata.getEntityIdMixedMap(this.plainEntity)}}class LoadMap{constructor(){this.loadMapItems=[]}get mainLoadMapItem(){return this.loadMapItems.find(e=>!e.relation&&!e.parentLoadMapItem)}addLoadMap(e){this.loadMapItems.find(B=>B.target===e.target&&B.id===e.id)||this.loadMapItems.push(e)}fillEntities(e,I){I.forEach(B=>{const tr=this.loadMapItems.find(rr=>rr.target===e&&rr.metadata.compareEntities(B,rr.plainEntity));tr&&(tr.entity=B)})}groupByTargetIds(){const e=[];return this.loadMapItems.forEach(I=>{let B=e.find(tr=>tr.target===I.target);B||(B={target:I.target,ids:[]},e.push(B)),B.ids.push(I.id)}),e}}class PlainObjectToDatabaseEntityTransformer{constructor(e){this.manager=e}async transform(e,I){if(!I.hasAllPrimaryKeys(e))return Promise.reject("Given object does not have a primary column, cannot transform it to database entity.");const B=new LoadMap,tr=(rr,ir,lr,dr)=>{const mr=new LoadMapItem(rr,ir,lr,dr);B.addLoadMap(mr),ir.extractRelationValuesFromEntity(rr,I.relations).filter(hr=>hr!=null).forEach(([hr,fr,_r])=>tr(fr,_r,mr,hr))};return tr(e,I),await Promise.all(B.groupByTargetIds().map(rr=>this.manager.findByIds(rr.target,rr.ids).then(ir=>B.fillEntities(rr.target,ir)))),B.loadMapItems.forEach(rr=>{!rr.relation||!rr.entity||!rr.parentLoadMapItem||!rr.parentLoadMapItem.entity||(rr.relation.isManyToMany||rr.relation.isOneToMany?(rr.parentLoadMapItem.entity[rr.relation.propertyName]||(rr.parentLoadMapItem.entity[rr.relation.propertyName]=[]),rr.parentLoadMapItem.entity[rr.relation.propertyName].push(rr.entity)):rr.parentLoadMapItem.entity[rr.relation.propertyName]=rr.entity)}),B.mainLoadMapItem?B.mainLoadMapItem.entity:void 0}}class AbstractRepository{get repository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)}get treeRepository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)}createQueryBuilder(e){const I=this.getCustomRepositoryTarget(this.constructor);if(!I)throw new CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(I).createQueryBuilder(e)}createQueryBuilderFor(e,I){return this.getRepositoryFor(e).createQueryBuilder(I)}getRepositoryFor(e){return this.manager.getRepository(e)}getTreeRepositoryFor(e){return this.manager.getTreeRepository(e)}getCustomRepositoryTarget(e){const I=getMetadataArgsStorage().entityRepositories.find(B=>B.target===(typeof e=="function"?e:e.constructor));if(!I)throw new CustomRepositoryNotFoundError(e);return I.entity}}class SubjectTopoligicalSorter{constructor(e){this.subjects=[...e],this.metadatas=this.getUniqueMetadatas(this.subjects)}sort(e){if(!this.metadatas.length)return this.subjects;const I=[];if(e==="delete"){const lr=this.subjects.filter(dr=>!dr.entity&&!dr.databaseEntity);I.push(...lr),this.removeAlreadySorted(lr)}const B=this.getNonNullableDependencies();let tr=this.toposort(B);e==="insert"&&(tr=tr.reverse()),tr.forEach(lr=>{const dr=this.subjects.filter(mr=>mr.metadata.targetName===lr||mr.metadata.inheritanceTree.some(hr=>hr.name===lr));I.push(...dr),this.removeAlreadySorted(dr)});const rr=this.getDependencies();let ir=this.toposort(rr);return e==="insert"&&(ir=ir.reverse()),ir.forEach(lr=>{const dr=this.subjects.filter(mr=>mr.metadata.targetName===lr);I.push(...dr),this.removeAlreadySorted(dr)}),I.push(...this.subjects),I}removeAlreadySorted(e){e.forEach(I=>{this.subjects.splice(this.subjects.indexOf(I),1)})}getUniqueMetadatas(e){const I=[];return e.forEach(B=>{I.indexOf(B.metadata)===-1&&I.push(B.metadata)}),I}getNonNullableDependencies(){return this.metadatas.reduce((e,I)=>(I.relationsWithJoinColumns.forEach(B=>{B.isNullable||e.push([I.targetName,B.inverseEntityMetadata.targetName])}),e),[])}getDependencies(){return this.metadatas.reduce((e,I)=>(I.relationsWithJoinColumns.forEach(B=>{B.inverseEntityMetadata!==I&&e.push([I.targetName,B.inverseEntityMetadata.targetName])}),e),[])}toposort(e){function I(mr){let hr=[];for(let fr=0,_r=mr.length;fr<_r;fr++){let gr=mr[fr];hr.indexOf(gr[0])<0&&hr.push(gr[0]),hr.indexOf(gr[1])<0&&hr.push(gr[1])}return hr}const B=I(e);let tr=B.length,rr=new Array(tr),ir={},lr=tr;for(;lr--;)ir[lr]||dr(B[lr],lr,[]);function dr(mr,hr,fr){if(fr.indexOf(mr)>=0)throw new TypeORMError("Cyclic dependency: "+JSON.stringify(mr));if(!~B.indexOf(mr))throw new TypeORMError("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(mr));if(ir[hr])return;ir[hr]=!0;let _r=e.filter(function(gr){return gr[0]===mr});if(hr=_r.length){let gr=fr.concat(mr);do{let Sr=_r[--hr][1];dr(Sr,B.indexOf(Sr),gr)}while(hr)}rr[--tr]=mr}return rr}}var dayjs_min$1={exports:{}},dayjs_min=dayjs_min$1.exports,hasRequiredDayjs_min;function requireDayjs_min(){return hasRequiredDayjs_min||(hasRequiredDayjs_min=1,function(k,e){(function(I,B){k.exports=B()})(dayjs_min,function(){var I=1e3,B=6e4,tr=36e5,rr="millisecond",ir="second",lr="minute",dr="hour",mr="day",hr="week",fr="month",_r="quarter",gr="year",Sr="date",Ar="Invalid Date",Or=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Fr=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,vr={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(rs){var ss=["th","st","nd","rd"],ls=rs%100;return"["+rs+(ss[(ls-20)%10]||ss[ls]||ss[0])+"]"}},xr=function(rs,ss,ls){var os=String(rs);return!os||os.length>=ss?rs:""+Array(ss+1-os.length).join(ls)+rs},kr={s:xr,z:function(rs){var ss=-rs.utcOffset(),ls=Math.abs(ss),os=Math.floor(ls/60),us=ls%60;return(ss<=0?"+":"-")+xr(os,2,"0")+":"+xr(us,2,"0")},m:function rs(ss,ls){if(ss.date()<ls.date())return-rs(ls,ss);var os=12*(ls.year()-ss.year())+(ls.month()-ss.month()),us=ss.clone().add(os,fr),ys=ls-us<0,bs=ss.clone().add(os+(ys?-1:1),fr);return+(-(os+(ls-us)/(ys?us-bs:bs-us))||0)},a:function(rs){return rs<0?Math.ceil(rs)||0:Math.floor(rs)},p:function(rs){return{M:fr,y:gr,w:hr,d:mr,D:Sr,h:dr,m:lr,s:ir,ms:rr,Q:_r}[rs]||String(rs||"").toLowerCase().replace(/s$/,"")},u:function(rs){return rs===void 0}},Gr="en",is={};is[Gr]=vr;var as="$isDayjsObject",cs=function(rs){return rs instanceof Lr||!(!rs||!rs[as])},es=function rs(ss,ls,os){var us;if(!ss)return Gr;if(typeof ss=="string"){var ys=ss.toLowerCase();is[ys]&&(us=ys),ls&&(is[ys]=ls,us=ys);var bs=ss.split("-");if(!us&&bs.length>1)return rs(bs[0])}else{var As=ss.name;is[As]=ss,us=As}return!os&&us&&(Gr=us),us||!os&&Gr},ps=function(rs,ss){if(cs(rs))return rs.clone();var ls=typeof ss=="object"?ss:{};return ls.date=rs,ls.args=arguments,new Lr(ls)},Ur=kr;Ur.l=es,Ur.i=cs,Ur.w=function(rs,ss){return ps(rs,{locale:ss.$L,utc:ss.$u,x:ss.$x,$offset:ss.$offset})};var Lr=function(){function rs(ls){this.$L=es(ls.locale,null,!0),this.parse(ls),this.$x=this.$x||ls.x||{},this[as]=!0}var ss=rs.prototype;return ss.parse=function(ls){this.$d=function(os){var us=os.date,ys=os.utc;if(us===null)return new Date(NaN);if(Ur.u(us))return new Date;if(us instanceof Date)return new Date(us);if(typeof us=="string"&&!/Z$/i.test(us)){var bs=us.match(Or);if(bs){var As=bs[2]-1||0,vs=(bs[7]||"0").substring(0,3);return ys?new Date(Date.UTC(bs[1],As,bs[3]||1,bs[4]||0,bs[5]||0,bs[6]||0,vs)):new Date(bs[1],As,bs[3]||1,bs[4]||0,bs[5]||0,bs[6]||0,vs)}}return new Date(us)}(ls),this.init()},ss.init=function(){var ls=this.$d;this.$y=ls.getFullYear(),this.$M=ls.getMonth(),this.$D=ls.getDate(),this.$W=ls.getDay(),this.$H=ls.getHours(),this.$m=ls.getMinutes(),this.$s=ls.getSeconds(),this.$ms=ls.getMilliseconds()},ss.$utils=function(){return Ur},ss.isValid=function(){return this.$d.toString()!==Ar},ss.isSame=function(ls,os){var us=ps(ls);return this.startOf(os)<=us&&us<=this.endOf(os)},ss.isAfter=function(ls,os){return ps(ls)<this.startOf(os)},ss.isBefore=function(ls,os){return this.endOf(os)<ps(ls)},ss.$g=function(ls,os,us){return Ur.u(ls)?this[os]:this.set(us,ls)},ss.unix=function(){return Math.floor(this.valueOf()/1e3)},ss.valueOf=function(){return this.$d.getTime()},ss.startOf=function(ls,os){var us=this,ys=!!Ur.u(os)||os,bs=Ur.p(ls),As=function(ks,Fs){var Os=Ur.w(us.$u?Date.UTC(us.$y,Fs,ks):new Date(us.$y,Fs,ks),us);return ys?Os:Os.endOf(mr)},vs=function(ks,Fs){return Ur.w(us.toDate()[ks].apply(us.toDate("s"),(ys?[0,0,0,0]:[23,59,59,999]).slice(Fs)),us)},gs=this.$W,xs=this.$M,Is=this.$D,Ns="set"+(this.$u?"UTC":"");switch(bs){case gr:return ys?As(1,0):As(31,11);case fr:return ys?As(1,xs):As(0,xs+1);case hr:var Vs=this.$locale().weekStart||0,Ls=(gs<Vs?gs+7:gs)-Vs;return As(ys?Is-Ls:Is+(6-Ls),xs);case mr:case Sr:return vs(Ns+"Hours",0);case dr:return vs(Ns+"Minutes",1);case lr:return vs(Ns+"Seconds",2);case ir:return vs(Ns+"Milliseconds",3);default:return this.clone()}},ss.endOf=function(ls){return this.startOf(ls,!1)},ss.$set=function(ls,os){var us,ys=Ur.p(ls),bs="set"+(this.$u?"UTC":""),As=(us={},us[mr]=bs+"Date",us[Sr]=bs+"Date",us[fr]=bs+"Month",us[gr]=bs+"FullYear",us[dr]=bs+"Hours",us[lr]=bs+"Minutes",us[ir]=bs+"Seconds",us[rr]=bs+"Milliseconds",us)[ys],vs=ys===mr?this.$D+(os-this.$W):os;if(ys===fr||ys===gr){var gs=this.clone().set(Sr,1);gs.$d[As](vs),gs.init(),this.$d=gs.set(Sr,Math.min(this.$D,gs.daysInMonth())).$d}else As&&this.$d[As](vs);return this.init(),this},ss.set=function(ls,os){return this.clone().$set(ls,os)},ss.get=function(ls){return this[Ur.p(ls)]()},ss.add=function(ls,os){var us,ys=this;ls=Number(ls);var bs=Ur.p(os),As=function(xs){var Is=ps(ys);return Ur.w(Is.date(Is.date()+Math.round(xs*ls)),ys)};if(bs===fr)return this.set(fr,this.$M+ls);if(bs===gr)return this.set(gr,this.$y+ls);if(bs===mr)return As(1);if(bs===hr)return As(7);var vs=(us={},us[lr]=B,us[dr]=tr,us[ir]=I,us)[bs]||1,gs=this.$d.getTime()+ls*vs;return Ur.w(gs,this)},ss.subtract=function(ls,os){return this.add(-1*ls,os)},ss.format=function(ls){var os=this,us=this.$locale();if(!this.isValid())return us.invalidDate||Ar;var ys=ls||"YYYY-MM-DDTHH:mm:ssZ",bs=Ur.z(this),As=this.$H,vs=this.$m,gs=this.$M,xs=us.weekdays,Is=us.months,Ns=us.meridiem,Vs=function(Fs,Os,Hs,Gs){return Fs&&(Fs[Os]||Fs(os,ys))||Hs[Os].slice(0,Gs)},Ls=function(Fs){return Ur.s(As%12||12,Fs,"0")},ks=Ns||function(Fs,Os,Hs){var Gs=Fs<12?"AM":"PM";return Hs?Gs.toLowerCase():Gs};return ys.replace(Fr,function(Fs,Os){return Os||function(Hs){switch(Hs){case"YY":return String(os.$y).slice(-2);case"YYYY":return Ur.s(os.$y,4,"0");case"M":return gs+1;case"MM":return Ur.s(gs+1,2,"0");case"MMM":return Vs(us.monthsShort,gs,Is,3);case"MMMM":return Vs(Is,gs);case"D":return os.$D;case"DD":return Ur.s(os.$D,2,"0");case"d":return String(os.$W);case"dd":return Vs(us.weekdaysMin,os.$W,xs,2);case"ddd":return Vs(us.weekdaysShort,os.$W,xs,3);case"dddd":return xs[os.$W];case"H":return String(As);case"HH":return Ur.s(As,2,"0");case"h":return Ls(1);case"hh":return Ls(2);case"a":return ks(As,vs,!0);case"A":return ks(As,vs,!1);case"m":return String(vs);case"mm":return Ur.s(vs,2,"0");case"s":return String(os.$s);case"ss":return Ur.s(os.$s,2,"0");case"SSS":return Ur.s(os.$ms,3,"0");case"Z":return bs}return null}(Fs)||bs.replace(":","")})},ss.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},ss.diff=function(ls,os,us){var ys,bs=this,As=Ur.p(os),vs=ps(ls),gs=(vs.utcOffset()-this.utcOffset())*B,xs=this-vs,Is=function(){return Ur.m(bs,vs)};switch(As){case gr:ys=Is()/12;break;case fr:ys=Is();break;case _r:ys=Is()/3;break;case hr:ys=(xs-gs)/6048e5;break;case mr:ys=(xs-gs)/864e5;break;case dr:ys=xs/tr;break;case lr:ys=xs/B;break;case ir:ys=xs/I;break;default:ys=xs}return us?ys:Ur.a(ys)},ss.daysInMonth=function(){return this.endOf(fr).$D},ss.$locale=function(){return is[this.$L]},ss.locale=function(ls,os){if(!ls)return this.$L;var us=this.clone(),ys=es(ls,os,!0);return ys&&(us.$L=ys),us},ss.clone=function(){return Ur.w(this.$d,this)},ss.toDate=function(){return new Date(this.valueOf())},ss.toJSON=function(){return this.isValid()?this.toISOString():null},ss.toISOString=function(){return this.$d.toISOString()},ss.toString=function(){return this.$d.toUTCString()},rs}(),ts=Lr.prototype;return ps.prototype=ts,[["$ms",rr],["$s",ir],["$m",lr],["$H",dr],["$W",mr],["$M",fr],["$y",gr],["$D",Sr]].forEach(function(rs){ts[rs[1]]=function(ss){return this.$g(ss,rs[0],rs[1])}}),ps.extend=function(rs,ss){return rs.$i||(rs(ss,Lr,ps),rs.$i=!0),ps},ps.locale=es,ps.isDayjs=cs,ps.unix=function(rs){return ps(1e3*rs)},ps.en=is[Gr],ps.Ls=is,ps.p={},ps})}(dayjs_min$1)),dayjs_min$1.exports}var dayjs_minExports=requireDayjs_min(),dayjs=getDefaultExportFromCjs$1(dayjs_minExports);class DateUtils{static normalizeHydratedDate(e){return e&&(typeof e=="string"?new Date(e):e)}static mixedDateToDateString(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e}static mixedDateToDate(e,I=!1,B=!0){let tr=typeof e=="string"?dayjs(e).toDate():e;return I&&(tr=new Date(tr.getUTCFullYear(),tr.getUTCMonth(),tr.getUTCDate(),tr.getUTCHours(),tr.getUTCMinutes(),tr.getUTCSeconds(),tr.getUTCMilliseconds())),B||tr.setUTCMilliseconds(0),tr}static mixedDateToTimeString(e,I=!1){return e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(I?"":":"+this.formatZerolessValue(e.getSeconds())):e}static mixedTimeToDate(e){if(typeof e=="string"){const[I,B,tr]=e.split(":"),rr=new Date;return I&&rr.setHours(parseInt(I)),B&&rr.setMinutes(parseInt(B)),tr&&rr.setSeconds(parseInt(tr)),rr}return e}static mixedTimeToString(e,I=!1){return e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(I?"":":"+e.getSeconds()):e,typeof e=="string"?e.split(":").map(B=>B.length===1?"0"+B:B).join(":"):e}static mixedDateToDatetimeString(e,I){if(typeof e=="string"&&(e=new Date(e)),e instanceof Date){let B=this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());I&&(B+=`.${this.formatMilliseconds(e.getMilliseconds())}`),e=B}return e}static mixedDateToUtcDatetimeString(e){return typeof e=="string"&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear(),4)+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e}static simpleArrayToString(e){return Array.isArray(e)?e.map(I=>String(I)).join(","):e}static stringToSimpleArray(e){return typeof e=="string"?e.length>0?e.split(","):[]:e}static simpleJsonToString(e){return JSON.stringify(e)}static stringToSimpleJson(e){return typeof e=="string"?JSON.parse(e):e}static simpleEnumToString(e){return""+e}static stringToSimpleEnum(e,I){return I.enum&&!isNaN(e)&&I.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e}static formatZerolessValue(e,I=2){return`${"0".repeat(I)}${e}`.slice(-I)}static formatMilliseconds(e){return e<10?"00"+e:e<100?"0"+e:String(e)}}class SubjectChangedColumnsComputer{compute(e){e.forEach(I=>{this.computeDiffColumns(I),this.computeDiffRelationalColumns(e,I)})}computeDiffColumns(e){e.entity&&e.metadata.columns.forEach(I=>{if(I.isVirtual||I.isDiscriminator)return;const B=e.changeMaps.find(rr=>rr.column===I);B&&e.changeMaps.splice(e.changeMaps.indexOf(B),1);const tr=I.getEntityValue(e.entity);if(tr!==void 0){if(e.databaseEntity){const rr=I.type!=="json"&&I.type!=="jsonb";let ir=I.getEntityValue(e.databaseEntity,rr);if(I.relationMetadata){const dr=I.relationMetadata.getEntityValue(e.entity);if(dr!=null)return}let lr=tr;if(tr!==null){switch(I.type){case"date":lr=DateUtils.mixedDateToDateString(tr);break;case"time":case"time with time zone":case"time without time zone":case"timetz":lr=DateUtils.mixedDateToTimeString(tr);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":lr=DateUtils.mixedDateToUtcDatetimeString(tr),ir=DateUtils.mixedDateToUtcDatetimeString(ir);break;case"json":case"jsonb":if(OrmUtils.deepCompare(tr,ir))return;break;case"simple-array":lr=DateUtils.simpleArrayToString(tr),ir=DateUtils.simpleArrayToString(ir);break;case"simple-enum":lr=DateUtils.simpleEnumToString(tr),ir=DateUtils.simpleEnumToString(ir);break;case"simple-json":lr=DateUtils.simpleJsonToString(tr),ir=DateUtils.simpleJsonToString(ir);break}I.transformer&&(lr=ApplyValueTransformers.transformTo(I.transformer,tr))}if(Buffer.isBuffer(lr)&&Buffer.isBuffer(ir)){if(lr.equals(ir))return}else if(lr===ir)return}e.diffColumns.includes(I)||e.diffColumns.push(I),e.changeMaps.push({column:I,value:tr})}})}computeDiffRelationalColumns(e,I){I.entity&&I.metadata.relationsWithJoinColumns.forEach(B=>{let tr=B.getEntityValue(I.entity);if(tr===void 0)return;if(I.databaseEntity){let lr=tr;lr!==null&&ObjectUtils.isObject(lr)&&(lr=B.getRelationIdMap(lr));const dr=B.getEntityValue(I.databaseEntity);if(OrmUtils.compareIds(lr,dr))return;I.diffRelations.push(B)}const rr=e.find(lr=>lr.mustBeInserted&&lr.entity===tr);rr&&(tr=rr);const ir=I.changeMaps.find(lr=>lr.relation===B);ir?ir.value=tr:I.changeMaps.push({relation:B,value:tr})})}}class NestedSetMultipleRootError extends TypeORMError{constructor(){super("Nested sets do not support multiple root entities.")}}class NestedSetSubjectExecutor{constructor(e){this.queryRunner=e}async insert(e){const I=mr=>this.queryRunner.connection.driver.escape(mr),B=this.getTableName(e.metadata.tablePath),tr=I(e.metadata.nestedSetLeftColumn.databaseName),rr=I(e.metadata.nestedSetRightColumn.databaseName);let ir=e.metadata.treeParentRelation.getEntityValue(e.entity);!ir&&e.parentSubject&&e.parentSubject.entity&&(ir=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const lr=e.metadata.getEntityIdMap(ir);let dr;if(lr&&(dr=await this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(lr).getRawOne().then(mr=>{const hr=mr?mr.right:void 0;return typeof hr=="string"?parseInt(hr):hr})),dr!==void 0)await this.queryRunner.query(`UPDATE ${B} SET ${tr} = CASE WHEN ${tr} > ${dr} THEN ${tr} + 2 ELSE ${tr} END,${rr} = ${rr} + 2 WHERE ${rr} >= ${dr}`),OrmUtils.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(dr),e.metadata.nestedSetRightColumn.createValueMap(dr+1));else{if(!await this.isUniqueRootEntity(e,ir))throw new NestedSetMultipleRootError;OrmUtils.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2))}}async update(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.entity);let B=e.databaseEntity;if(!B&&I&&(B=e.metadata.treeChildrenRelation.getEntityValue(I).find(lr=>Object.entries(e.identifier).every(([dr,mr])=>lr[dr]===mr))),B===void 0||I===void 0)return;const tr=e.metadata.treeParentRelation.getEntityValue(B),rr=e.metadata.getEntityIdMap(tr),ir=e.metadata.getEntityIdMap(I);if(!OrmUtils.compareIds(rr,ir)){if(I){const lr=Sr=>this.queryRunner.connection.driver.escape(Sr),dr=this.getTableName(e.metadata.tablePath),mr=lr(e.metadata.nestedSetLeftColumn.databaseName),hr=lr(e.metadata.nestedSetRightColumn.databaseName),fr=e.metadata.getEntityIdMap(B);let _r;fr&&(_r=(await this.getNestedSetIds(e.metadata,fr))[0]);let gr;if(ir&&(gr=(await this.getNestedSetIds(e.metadata,ir))[0]),_r!==void 0&&gr!==void 0){const Sr=gr.left>_r.left,Ar=_r.right-_r.left+1;let Or;Sr?Or=gr.left-_r.right:Or=gr.right-_r.left;const Fr=`WHEN ${mr} >= ${_r.left} AND ${mr} < ${_r.right} THEN ${mr} + ${Or} `,vr=`WHEN ${hr} > ${_r.left} AND ${hr} <= ${_r.right} THEN ${hr} + ${Or} `;Sr?await this.queryRunner.query(`UPDATE ${dr} SET ${mr} = CASE WHEN ${mr} > ${_r.right} AND ${mr} <= ${gr.left} THEN ${mr} - ${Ar} `+Fr+`ELSE ${mr} END, ${hr} = CASE WHEN ${hr} > ${_r.right} AND ${hr} < ${gr.left} THEN ${hr} - ${Ar} `+vr+`ELSE ${hr} END`):await this.queryRunner.query(`UPDATE ${dr} SET ${mr} = CASE WHEN ${mr} < ${_r.left} AND ${mr} > ${gr.right} THEN ${mr} + ${Ar} `+Fr+`ELSE ${mr} END, ${hr} = CASE WHEN ${hr} < ${_r.left} AND ${hr} >= ${gr.right} THEN ${hr} + ${Ar} `+vr+`ELSE ${hr} END`)}}else if(!await this.isUniqueRootEntity(e,I))throw new NestedSetMultipleRootError}}async remove(e){Array.isArray(e)||(e=[e]);const I=e[0].metadata,B=mr=>this.queryRunner.connection.driver.escape(mr),tr=this.getTableName(I.tablePath),rr=B(I.nestedSetLeftColumn.databaseName),ir=B(I.nestedSetRightColumn.databaseName);let lr=[];for(const mr of e){const hr=I.getEntityIdMap(mr.entity);hr&&lr.push(hr)}let dr=await this.getNestedSetIds(I,lr);for(const mr of dr){const hr=mr.right-mr.left+1;await this.queryRunner.query(`UPDATE ${tr} SET ${rr} = CASE WHEN ${rr} > ${mr.left} THEN ${rr} - ${hr} ELSE ${rr} END, ${ir} = CASE WHEN ${ir} > ${mr.right} THEN ${ir} - ${hr} ELSE ${ir} END`)}}getNestedSetIds(e,I){const B={left:`${e.targetName}.${e.nestedSetLeftColumn.propertyPath}`,right:`${e.targetName}.${e.nestedSetRightColumn.propertyPath}`},tr=this.queryRunner.manager.createQueryBuilder();return Object.entries(B).forEach(([rr,ir])=>{tr.addSelect(ir,rr)}),tr.from(e.target,e.targetName).whereInIds(I).orderBy(B.right,"DESC").getRawMany().then(rr=>{const ir=[];for(const lr of rr){const dr={};for(const mr of Object.keys(B)){const hr=lr?lr[mr]:void 0;dr[mr]=typeof hr=="string"?parseInt(hr):hr}ir.push(dr)}return ir})}async isUniqueRootEntity(e,I){const B=mr=>this.queryRunner.connection.driver.escape(mr),tr=this.getTableName(e.metadata.tablePath),rr=[],ir=e.metadata.treeParentRelation.joinColumns.map(mr=>{const hr=B(mr.databaseName),fr=mr.getEntityValue(I);if(fr==null)return`${hr} IS NULL`;rr.push(fr);const _r=this.queryRunner.connection.driver.createParameter("entity_"+mr.databaseName,rr.length-1);return`${hr} = ${_r}`}).join(" AND "),lr="count",dr=await this.queryRunner.query(`SELECT COUNT(1) AS ${B(lr)} FROM ${tr} WHERE ${ir}`,rr,!0);return parseInt(dr.records[0][lr])===0}getTableName(e){return e.split(".").map(I=>I===""?I:this.queryRunner.connection.driver.escape(I)).join(".")}}class ClosureSubjectExecutor{constructor(e){this.queryRunner=e}async insert(e){const I={};e.metadata.closureJunctionTable.ancestorColumns.forEach(tr=>{I[tr.databaseName]=e.identifier}),e.metadata.closureJunctionTable.descendantColumns.forEach(tr=>{I[tr.databaseName]=e.identifier}),await this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(I).updateEntity(!1).callListeners(!1).execute();let B=e.metadata.treeParentRelation.getEntityValue(e.entity);if(!B&&e.parentSubject&&e.parentSubject.entity&&(B=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),B){const tr=fr=>this.queryRunner.connection.driver.escape(fr),rr=this.getTableName(e.metadata.closureJunctionTable.tablePath),ir=[],lr=e.metadata.closureJunctionTable.ancestorColumns.map(fr=>tr(fr.databaseName)),dr=e.metadata.closureJunctionTable.descendantColumns.map(fr=>tr(fr.databaseName)),mr=e.metadata.primaryColumns.map(fr=>(ir.push(fr.getEntityValue(e.insertedValueSet?e.insertedValueSet:e.entity)),this.queryRunner.connection.driver.createParameter("child_entity_"+fr.databaseName,ir.length-1))),hr=e.metadata.closureJunctionTable.descendantColumns.map(fr=>{const _r=tr(fr.databaseName),gr=fr.referencedColumn.getEntityValue(B);if(!gr)throw new CannotAttachTreeChildrenEntityError(e.metadata.name);ir.push(gr);const Sr=this.queryRunner.connection.driver.createParameter("parent_entity_"+fr.referencedColumn.databaseName,ir.length-1);return`${_r} = ${Sr}`});await this.queryRunner.query(`INSERT INTO ${rr} (${[...lr,...dr].join(", ")}) SELECT ${lr.join(", ")}, ${mr.join(", ")} FROM ${rr} WHERE ${hr.join(" AND ")}`,ir)}}async update(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.entity);let B=e.databaseEntity;if(!B&&I&&(B=e.metadata.treeChildrenRelation.getEntityValue(I).find(gr=>Object.entries(e.identifier).every(([Sr,Ar])=>gr[Sr]===Ar))),B===void 0||I===void 0)return;const tr=e.metadata.treeParentRelation.getEntityValue(B),rr=e.metadata.getEntityIdMap(tr),ir=e.metadata.getEntityIdMap(I);if(OrmUtils.compareIds(rr,ir))return;const lr=gr=>this.queryRunner.connection.driver.escape(gr),dr=e.metadata.closureJunctionTable,mr=dr.ancestorColumns.map(gr=>lr(gr.databaseName)),hr=dr.descendantColumns.map(gr=>lr(gr.databaseName)),fr=(gr,Sr)=>{const Ar=`sub${Sr}`,Or=gr.createQueryBuilder().select(hr.join(", ")).from(dr.tablePath,Ar);for(const Fr of dr.ancestorColumns)Or.andWhere(`${lr(Ar)}.${lr(Fr.databaseName)} = :value_${Fr.referencedColumn.databaseName}`);return gr.createQueryBuilder().select(hr.join(", ")).from(`(${Or.getQuery()})`,Sr).setParameters(Or.getParameters()).getQuery()},_r={};for(const gr of e.metadata.primaryColumns)_r[`value_${gr.databaseName}`]=B[gr.databaseName];if(await this.queryRunner.manager.createQueryBuilder().delete().from(dr.tablePath).where(gr=>`(${hr.join(", ")}) IN (${fr(gr,"descendant")})`).andWhere(gr=>`(${mr.join(", ")}) NOT IN (${fr(gr,"ancestor")})`).setParameters(_r).execute(),I){const gr=[],Sr=this.getTableName(dr.tablePath),Ar=lr("supertree"),Or=lr("subtree"),Fr=[...mr.map(kr=>`${Ar}.${kr}`),...hr.map(kr=>`${Or}.${kr}`)],vr=e.metadata.closureJunctionTable.ancestorColumns.map(kr=>{const Gr=lr(kr.databaseName),is=kr.referencedColumn.getEntityValue(B);gr.push(is);const as=this.queryRunner.connection.driver.createParameter("entity_"+kr.referencedColumn.databaseName,gr.length-1);return`${Or}.${Gr} = ${as}`}),xr=e.metadata.closureJunctionTable.descendantColumns.map(kr=>{const Gr=lr(kr.databaseName),is=kr.referencedColumn.getEntityValue(I);if(!is)throw new CannotAttachTreeChildrenEntityError(e.metadata.name);gr.push(is);const as=this.queryRunner.connection.driver.createParameter("parent_entity_"+kr.referencedColumn.databaseName,gr.length-1);return`${Ar}.${Gr} = ${as}`});await this.queryRunner.query(`INSERT INTO ${Sr} (${[...mr,...hr].join(", ")}) SELECT ${Fr.join(", ")} FROM ${Sr} AS ${Ar}, ${Sr} AS ${Or} WHERE ${[...vr,...xr].join(" AND ")}`,gr)}}async remove(e){if(this.queryRunner.connection.driver.options.type!=="mssql")return;Array.isArray(e)||(e=[e]);const I=dr=>this.queryRunner.connection.driver.escape(dr),B=e.map(dr=>dr.identifier),tr=e[0].metadata.closureJunctionTable,rr=dr=>dr.map(mr=>{const hr=B.map(fr=>fr[mr.referencedColumn.databaseName]);return`${I(mr.databaseName)} IN (${hr.join(", ")})`}).join(" AND "),ir=rr(tr.ancestorColumns),lr=rr(tr.descendantColumns);await this.queryRunner.manager.createQueryBuilder().delete().from(tr.tablePath).where(ir).orWhere(lr).execute()}getTableName(e){return e.split(".").map(I=>I===""?I:this.queryRunner.connection.driver.escape(I)).join(".")}}class EntityMetadata{constructor(e){this["@instanceof"]=Symbol.for("EntityMetadata"),this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isAlwaysUsingConstructor=!0,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.beforeSoftRemoveListeners=[],this.beforeRecoverListeners=[],this.afterRemoveListeners=[],this.afterSoftRemoveListeners=[],this.afterRecoverListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.treeOptions=e.tableTree?e.tableTree.options:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid,this.dependsOn=this.tableMetadataArgs.dependsOn}create(e,I){const B=!!(I&&I.pojo===!0);let tr;return typeof this.target=="function"&&!B?!I?.fromDeserializer||this.isAlwaysUsingConstructor?tr=new this.target:tr=Object.create(this.target.prototype):tr={},this.connection.options.typename&&(tr[this.connection.options.typename]=this.targetName),this.lazyRelations.forEach(rr=>this.connection.relationLoader.enableLazyLoad(rr,tr,e)),tr}hasId(e){return e?this.primaryColumns.every(I=>{const B=I.getEntityValue(e);return B!=null&&B!==""}):!1}hasAllPrimaryKeys(e){return this.primaryColumns.every(I=>{const B=I.getEntityValue(e);return B!=null})}ensureEntityIdMap(e){if(ObjectUtils.isObject(e))return e;if(this.hasMultiplePrimaryKeys)throw new CannotCreateEntityIdMapError(this,e);return this.primaryColumns[0].createValueMap(e)}getEntityIdMap(e){if(e)return EntityMetadata.getValueMap(e,this.primaryColumns,{skipNulls:!0})}getEntityIdMixedMap(e){if(!e)return e;const I=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?I:I&&this.primaryColumns[0].getEntityValue(I)}compareEntities(e,I){const B=this.getEntityIdMap(e);if(!B)return!1;const tr=this.getEntityIdMap(I);return tr?OrmUtils.compareIds(B,tr):!1}findColumnWithPropertyName(e){return this.columns.find(I=>I.propertyName===e)}findColumnWithDatabaseName(e){return this.columns.find(I=>I.databaseName===e)}hasColumnWithPropertyPath(e){return this.columns.some(B=>B.propertyPath===e)||this.hasRelationWithPropertyPath(e)}findColumnWithPropertyPath(e){const I=this.columns.find(tr=>tr.propertyPath===e);if(I)return I;const B=this.relations.find(tr=>tr.propertyPath===e);if(B&&B.joinColumns.length===1)return B.joinColumns[0]}findColumnWithPropertyPathStrict(e){return this.columns.find(I=>I.propertyPath===e)}findColumnsWithPropertyPath(e){const I=this.columns.find(tr=>tr.propertyPath===e);if(I)return[I];const B=this.findRelationWithPropertyPath(e);return B&&B.joinColumns?B.joinColumns:[]}hasRelationWithPropertyPath(e){return this.relations.some(I=>I.propertyPath===e)}findRelationWithPropertyPath(e){return this.relations.find(I=>I.propertyPath===e)}hasEmbeddedWithPropertyPath(e){return this.allEmbeddeds.some(I=>I.propertyPath===e)}findEmbeddedWithPropertyPath(e){return this.allEmbeddeds.find(I=>I.propertyPath===e)}mapPropertyPathsToColumns(e){return e.map(I=>{const B=this.findColumnWithPropertyPath(I);if(B==null)throw new EntityPropertyNotFoundError(I,this);return B})}extractRelationValuesFromEntity(e,I){const B=[];return I.forEach(tr=>{const rr=tr.getEntityValue(e);Array.isArray(rr)?rr.forEach(ir=>B.push([tr,ir,EntityMetadata.getInverseEntityMetadata(ir,tr)])):rr&&B.push([tr,rr,EntityMetadata.getInverseEntityMetadata(rr,tr)])}),B}findInheritanceMetadata(e){if(this.inheritancePattern==="STI"&&this.childEntityMetadatas.length>0){let I;return this.discriminatorColumn&&(I=e[this.discriminatorColumn.propertyName]),this.childEntityMetadatas.find(B=>I===B.discriminatorValue||e.constructor===B.target)||this}return this}static getInverseEntityMetadata(e,I){return I.inverseEntityMetadata.findInheritanceMetadata(e)}static createPropertyPath(e,I,B=""){const tr=[];return Object.keys(I).forEach(rr=>{const ir=B?B+"."+rr:rr;if(e.hasEmbeddedWithPropertyPath(ir)){const lr=this.createPropertyPath(e,I[rr],ir);tr.push(...lr)}else{const lr=B?B+"."+rr:rr;tr.push(lr)}}),tr}static difference(e,I){return e.filter(B=>!I.find(tr=>OrmUtils.compareIds(B,tr)))}static getValueMap(e,I,B){return I.reduce((tr,rr)=>{const ir=rr.getEntityValueMap(e,B);if(!(tr===void 0||ir===null||ir===void 0))return OrmUtils.mergeDeep(tr,ir)},{})}build(){const e=this.connection.namingStrategy,I=this.connection.options.entityPrefix,B=this.connection.options.entitySkipConstructor;this.engine=this.tableMetadataArgs.engine,this.database=this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:this.connection.options?.hasOwnProperty("schema")&&(this.schema=this.connection.options.schema),this.givenTableName=this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=this.tableMetadataArgs.synchronize!==!1,this.targetName=typeof this.tableMetadataArgs.target=="function"?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,this.tableMetadataArgs.type==="closure-junction"?this.tableNameWithoutPrefix=e.closureJunctionTableName(this.givenTableName):this.tableMetadataArgs.type==="entity-child"&&this.parentEntityMetadata?this.tableNameWithoutPrefix=e.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=e.tableName(this.targetName,this.givenTableName),this.tableMetadataArgs.type==="junction"&&this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=shorten(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=I?e.prefixTableName(I,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid===!0,this.tablePath=this.connection.driver.buildTableName(this.tableName,this.schema,this.database),this.orderBy=typeof this.tableMetadataArgs.orderBy=="function"?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,B!==void 0&&(this.isAlwaysUsingConstructor=!B),this.isJunction=this.tableMetadataArgs.type==="closure-junction"||this.tableMetadataArgs.type==="junction",this.isClosureJunction=this.tableMetadataArgs.type==="closure-junction",this.comment=this.tableMetadataArgs.comment}registerColumn(e){this.ownColumns.indexOf(e)===-1&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce((I,B)=>I.concat(B.columnsFromTree),this.ownColumns),this.primaryColumns=this.columns.filter(I=>I.isPrimary),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter(I=>I.isGenerated||I.generationStrategy==="uuid").length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach(I=>I.registerColumn(e)))}createPropertiesMap(){const e={};return this.columns.forEach(I=>OrmUtils.mergeDeep(e,I.createValueMap(I.propertyPath))),this.relations.forEach(I=>OrmUtils.mergeDeep(e,I.createValueMap(I.propertyPath))),e}getInsertionReturningColumns(){return this.columns.filter(e=>e.default!==void 0||e.asExpression!==void 0||e.isGenerated||e.isCreateDate||e.isUpdateDate||e.isDeleteDate||e.isVersion)}}class MaterializedPathSubjectExecutor{constructor(e){this.queryRunner=e}async insert(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const B=e.metadata.getEntityIdMap(I);let tr="";B&&(tr=await this.getEntityPath(e,B));const rr=e.metadata.treeParentRelation.joinColumns.map(ir=>ir.referencedColumn.getEntityValue(e.insertedValueSet)).join("_");await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[e.metadata.materializedPathColumn.propertyPath]:tr+rr+"."}).where(e.identifier).execute()}async update(e){let I=e.metadata.treeParentRelation.getEntityValue(e.entity);!I&&e.parentSubject&&e.parentSubject.entity&&(I=e.parentSubject.entity);let B=e.databaseEntity;!B&&I&&(B=e.metadata.treeChildrenRelation.getEntityValue(I).find(fr=>Object.entries(e.identifier).every(([_r,gr])=>fr[_r]===gr)));const tr=e.metadata.treeParentRelation.getEntityValue(B),rr=this.getEntityParentReferencedColumnMap(e,tr),ir=this.getEntityParentReferencedColumnMap(e,I);if(OrmUtils.compareIds(rr,ir))return;let lr="";ir&&(lr=await this.getEntityPath(e,ir));let dr="";rr&&(dr=await this.getEntityPath(e,rr)||"");const mr=e.metadata.treeParentRelation.joinColumns.map(fr=>fr.referencedColumn.getEntityValue(B)).join("_"),hr=e.metadata.materializedPathColumn.propertyPath;await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[hr]:()=>`REPLACE(${this.queryRunner.connection.driver.escape(hr)}, '${dr}${mr}.', '${lr}${mr}.')`}).where(`${hr} LIKE :path`,{path:`${dr}${mr}.%`}).execute()}getEntityParentReferencedColumnMap(e,I){if(I)return EntityMetadata.getValueMap(I,e.metadata.treeParentRelation.joinColumns.map(B=>B.referencedColumn).filter(B=>B!=null),{skipNulls:!0})}getEntityPath(e,I){const B=e.metadata,tr=(Array.isArray(I)?I:[I]).map(rr=>B.ensureEntityIdMap(rr));return this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).where(new Brackets(rr=>{for(const ir of tr)rr.orWhere(new Brackets(lr=>lr.where(ir)))})).getRawOne().then(rr=>rr?rr.path:"")}}class SubjectExecutor{constructor(e,I,B){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=I,this.options=B,this.validate(),this.recompute()}async execute(){let e;(!this.options||this.options.listeners!==!1)&&(e=this.broadcastBeforeEventsForAll(),e.promises.length>0&&await Promise.all(e.promises)),e&&e.count>0&&(this.insertSubjects.forEach(I=>I.recompute()),this.updateSubjects.forEach(I=>I.recompute()),this.removeSubjects.forEach(I=>I.recompute()),this.softRemoveSubjects.forEach(I=>I.recompute()),this.recoverSubjects.forEach(I=>I.recompute()),this.recompute()),this.insertSubjects=new SubjectTopoligicalSorter(this.insertSubjects).sort("insert"),await this.executeInsertOperations(),this.updateSubjects=this.allSubjects.filter(I=>I.mustBeUpdated),await this.executeUpdateOperations(),this.removeSubjects=new SubjectTopoligicalSorter(this.removeSubjects).sort("delete"),await this.executeRemoveOperations(),this.softRemoveSubjects=this.allSubjects.filter(I=>I.mustBeSoftRemoved),await this.executeSoftRemoveOperations(),this.recoverSubjects=this.allSubjects.filter(I=>I.mustBeRecovered),await this.executeRecoverOperations(),this.updateSpecialColumnsInPersistedEntities(),(!this.options||this.options.listeners!==!1)&&(e=this.broadcastAfterEventsForAll(),e.promises.length>0&&await Promise.all(e.promises))}validate(){this.allSubjects.forEach(e=>{if(e.mustBeUpdated&&e.mustBeRemoved)throw new SubjectRemovedAndUpdatedError(e)})}recompute(){new SubjectChangedColumnsComputer().compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter(e=>e.mustBeInserted),this.updateSubjects=this.allSubjects.filter(e=>e.mustBeUpdated),this.removeSubjects=this.allSubjects.filter(e=>e.mustBeRemoved),this.softRemoveSubjects=this.allSubjects.filter(e=>e.mustBeSoftRemoved),this.recoverSubjects=this.allSubjects.filter(e=>e.mustBeRecovered),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0}broadcastBeforeEventsForAll(){const e=new BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeInsertEvent(e,I.metadata,I.entity)),this.updateSubjects.length&&this.updateSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeUpdateEvent(e,I.metadata,I.entity,I.databaseEntity,I.diffColumns,I.diffRelations)),this.removeSubjects.length&&this.removeSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeSoftRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.recoverSubjects.length&&this.recoverSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastBeforeRecoverEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),e}broadcastAfterEventsForAll(){const e=new BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterInsertEvent(e,I.metadata,I.entity,I.identifier)),this.updateSubjects.length&&this.updateSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterUpdateEvent(e,I.metadata,I.entity,I.databaseEntity,I.diffColumns,I.diffRelations)),this.removeSubjects.length&&this.removeSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterSoftRemoveEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),this.recoverSubjects.length&&this.recoverSubjects.forEach(I=>this.queryRunner.broadcaster.broadcastAfterRecoverEvent(e,I.metadata,I.entity,I.databaseEntity,I.identifier)),e}async executeInsertOperations(){const[e,I]=this.groupBulkSubjects(this.insertSubjects,"insert");for(const B of I){const tr=e[B],rr=[],ir=[],lr=[];if(this.queryRunner.connection.driver.options.type==="mongodb"?tr.forEach(dr=>{dr.metadata.createDateColumn&&dr.entity&&(dr.entity[dr.metadata.createDateColumn.databaseName]=new Date),dr.metadata.updateDateColumn&&dr.entity&&(dr.entity[dr.metadata.updateDateColumn.databaseName]=new Date),dr.createValueSetAndPopChangeMap(),ir.push(dr),rr.push(dr.entity)}):this.queryRunner.connection.driver.options.type==="oracle"?tr.forEach(dr=>{lr.push(dr)}):tr.forEach(dr=>{dr.changeMaps.length===0||dr.metadata.treeType||this.queryRunner.connection.driver.options.type==="oracle"||this.queryRunner.connection.driver.options.type==="sap"?lr.push(dr):(ir.push(dr),rr.push(dr.createValueSetAndPopChangeMap()))}),InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const dr=await this.queryRunner.manager.insert(tr[0].metadata.target,rr);tr.forEach((mr,hr)=>{mr.identifier=dr.identifiers[hr],mr.generatedMap=dr.generatedMaps[hr],mr.insertedValueSet=rr[hr]})}else{if(rr.length>0){const dr=await this.queryRunner.manager.createQueryBuilder().insert().into(tr[0].metadata.target).values(rr).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1).execute();ir.forEach((mr,hr)=>{mr.identifier=dr.identifiers[hr],mr.generatedMap=dr.generatedMaps[hr],mr.insertedValueSet=rr[hr]})}if(lr.length>0)for(const dr of lr)dr.insertedValueSet=dr.createValueSetAndPopChangeMap(),dr.metadata.treeType==="nested-set"&&await new NestedSetSubjectExecutor(this.queryRunner).insert(dr),await this.queryRunner.manager.createQueryBuilder().insert().into(dr.metadata.target).values(dr.insertedValueSet).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1).execute().then(mr=>{dr.identifier=mr.identifiers[0],dr.generatedMap=mr.generatedMaps[0]}),dr.metadata.treeType==="closure-table"?await new ClosureSubjectExecutor(this.queryRunner).insert(dr):dr.metadata.treeType==="materialized-path"&&await new MaterializedPathSubjectExecutor(this.queryRunner).insert(dr)}tr.forEach(dr=>{dr.generatedMap&&dr.metadata.columns.forEach(mr=>{const hr=mr.getEntityValue(dr.generatedMap);if(hr!=null){const fr=this.queryRunner.connection.driver.prepareHydratedValue(hr,mr);mr.setEntityValue(dr.generatedMap,fr)}})})}}async executeUpdateOperations(){const e=async rr=>{if(!rr.identifier)throw new SubjectWithoutIdentifierError(rr);if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const ir=this.cloneMongoSubjectEntity(rr);rr.metadata.objectIdColumn&&rr.metadata.objectIdColumn.propertyName&&delete ir[rr.metadata.objectIdColumn.propertyName],rr.metadata.createDateColumn&&rr.metadata.createDateColumn.propertyName&&delete ir[rr.metadata.createDateColumn.propertyName],rr.metadata.updateDateColumn&&rr.metadata.updateDateColumn.propertyName&&(ir[rr.metadata.updateDateColumn.propertyName]=new Date),await this.queryRunner.manager.update(rr.metadata.target,rr.identifier,ir)}else{const ir=rr.createValueSetAndPopChangeMap();switch(rr.metadata.treeType){case"nested-set":await new NestedSetSubjectExecutor(this.queryRunner).update(rr);break;case"closure-table":await new ClosureSubjectExecutor(this.queryRunner).update(rr);break;case"materialized-path":await new MaterializedPathSubjectExecutor(this.queryRunner).update(rr);break}const lr=this.queryRunner.manager.createQueryBuilder().update(rr.metadata.target).set(ir).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1);rr.entity?lr.whereEntity(rr.identifier):lr.where(rr.identifier);let mr=(await lr.execute()).generatedMaps[0];mr&&(rr.metadata.columns.forEach(hr=>{const fr=hr.getEntityValue(mr);if(fr!=null){const _r=this.queryRunner.connection.driver.prepareHydratedValue(fr,hr);hr.setEntityValue(mr,_r)}}),rr.generatedMap||(rr.generatedMap={}),Object.assign(rr.generatedMap,mr))}},I=[],B=[];for(const rr of this.updateSubjects)rr.metadata.treeType==="nested-set"?I.push(rr):B.push(rr);const tr=new Promise(async(rr,ir)=>{for(const lr of I)try{await e(lr)}catch(dr){ir(dr)}rr()});await Promise.all([...B.map(e),tr])}async executeRemoveOperations(){const[e,I]=this.groupBulkSubjects(this.removeSubjects,"delete");for(const B of I){const tr=e[B],rr=tr.map(ir=>{if(!ir.identifier)throw new SubjectWithoutIdentifierError(ir);return ir.identifier});if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager))await this.queryRunner.manager.delete(tr[0].metadata.target,rr);else{switch(tr[0].metadata.treeType){case"nested-set":await new NestedSetSubjectExecutor(this.queryRunner).remove(tr);break;case"closure-table":await new ClosureSubjectExecutor(this.queryRunner).remove(tr);break}await this.queryRunner.manager.createQueryBuilder().delete().from(tr[0].metadata.target).where(rr).callListeners(!1).execute()}}}cloneMongoSubjectEntity(e){const I={};if(e.entity)for(const B of e.metadata.columns)OrmUtils.mergeDeep(I,B.getEntityValueMap(e.entity));return I}async executeSoftRemoveOperations(){await Promise.all(this.softRemoveSubjects.map(async e=>{if(!e.identifier)throw new SubjectWithoutIdentifierError(e);let I;if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const B=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete B[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete B[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(B[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(B[e.metadata.deleteDateColumn.propertyName]=new Date),I=await this.queryRunner.manager.update(e.metadata.target,e.identifier,B)}else{const B=this.queryRunner.manager.createQueryBuilder().softDelete().from(e.metadata.target).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1);e.entity?B.whereEntity(e.identifier):B.where(e.identifier),I=await B.execute()}e.generatedMap=I.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach(B=>{const tr=B.getEntityValue(e.generatedMap);if(tr!=null){const rr=this.queryRunner.connection.driver.prepareHydratedValue(tr,B);B.setEntityValue(e.generatedMap,rr)}})}))}async executeRecoverOperations(){await Promise.all(this.recoverSubjects.map(async e=>{if(!e.identifier)throw new SubjectWithoutIdentifierError(e);let I;if(InstanceChecker.isMongoEntityManager(this.queryRunner.manager)){const B=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete B[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete B[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(B[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(B[e.metadata.deleteDateColumn.propertyName]=null),I=await this.queryRunner.manager.update(e.metadata.target,e.identifier,B)}else{const B=this.queryRunner.manager.createQueryBuilder().restore().from(e.metadata.target).updateEntity(!(this.options&&this.options.reload===!1)).callListeners(!1);e.entity?B.whereEntity(e.identifier):B.where(e.identifier),I=await B.execute()}e.generatedMap=I.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach(B=>{const tr=B.getEntityValue(e.generatedMap);if(tr!=null){const rr=this.queryRunner.connection.driver.prepareHydratedValue(tr,B);B.setEntityValue(e.generatedMap,rr)}})}))}updateSpecialColumnsInPersistedEntities(){this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.softRemoveSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.recoverSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach(e=>{e.entity&&e.metadata.primaryColumns.forEach(I=>{I.setEntityValue(e.entity,void 0)})}),this.allSubjects.forEach(e=>{e.entity&&(e.metadata.relationIds.forEach(I=>{I.setValue(e.entity)}),InstanceChecker.isMongoEntityManager(this.queryRunner.manager)&&e.metadata.objectIdColumn&&e.metadata.objectIdColumn.databaseName&&e.metadata.objectIdColumn.databaseName!==e.metadata.objectIdColumn.propertyName&&delete e.entity[e.metadata.objectIdColumn.databaseName])})}updateSpecialColumnsInInsertedAndUpdatedEntities(e){e.forEach(I=>{I.entity&&(I.metadata.columns.forEach(B=>{I.metadata.childEntityMetadatas.length>0&&I.metadata.childEntityMetadatas.map(tr=>tr.target).indexOf(B.target)!==-1||B.isVirtual||B.isDeleteDate||(B.isNullable&&B.getEntityValue(I.entity)===void 0&&B.setEntityValue(I.entity,null),I.updatedRelationMaps.length>0&&I.updatedRelationMaps.forEach(tr=>{tr.relation.joinColumns.forEach(rr=>{rr.isVirtual!==!0&&rr.setEntityValue(I.entity,ObjectUtils.isObject(tr.value)?rr.referencedColumn.getEntityValue(tr.value):tr.value)})}))}),I.generatedMap&&this.queryRunner.manager.merge(I.metadata.target,I.entity,I.generatedMap))})}groupBulkSubjects(e,I){const B={},tr=[],rr=e.some(lr=>lr.metadata.getInsertionReturningColumns().length>0),ir=I==="delete"||this.queryRunner.connection.driver.isReturningSqlSupported("insert")||rr===!1;return e.forEach((lr,dr)=>{const mr=ir||lr.metadata.isJunction?lr.metadata.name:lr.metadata.name+"_"+dr;B[mr]?B[mr].push(lr):(B[mr]=[lr],tr.push(mr))}),[B,tr]}}class Subject{constructor(e){this["@instanceof"]=Symbol.for("Subject"),this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,e.canBeInserted!==void 0&&(this.canBeInserted=e.canBeInserted),e.canBeUpdated!==void 0&&(this.canBeUpdated=e.canBeUpdated),e.mustBeRemoved!==void 0&&(this.mustBeRemoved=e.mustBeRemoved),e.canBeSoftRemoved!==void 0&&(this.canBeSoftRemoved=e.canBeSoftRemoved),e.canBeRecovered!==void 0&&(this.canBeRecovered=e.canBeRecovered),e.identifier!==void 0&&(this.identifier=e.identifier),e.changeMaps!==void 0&&this.changeMaps.push(...e.changeMaps),this.recompute()}get mustBeInserted(){return this.canBeInserted&&!this.databaseEntity}get mustBeUpdated(){return this.canBeUpdated&&this.identifier&&(this.databaseEntityLoaded===!1||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.some(e=>!e.column||e.column.isUpdate)}get mustBeSoftRemoved(){return this.canBeSoftRemoved&&this.identifier&&(this.databaseEntityLoaded===!1||this.databaseEntityLoaded&&this.databaseEntity)}get mustBeRecovered(){return this.canBeRecovered&&this.identifier&&(this.databaseEntityLoaded===!1||this.databaseEntityLoaded&&this.databaseEntity)}createValueSetAndPopChangeMap(){const e=[],I=this.changeMaps.reduce((B,tr)=>{let rr=tr.value;InstanceChecker.isSubject(rr)&&(rr=rr.insertedValueSet?rr.insertedValueSet:rr.entity);let ir;if(this.metadata.isJunction&&tr.column)ir=tr.column.createValueMap(tr.column.referencedColumn.getEntityValue(rr));else if(tr.column)ir=tr.column.createValueMap(rr);else if(tr.relation)if(ObjectUtils.isObject(rr)&&!Buffer.isBuffer(rr)){const lr=tr.relation.getRelationIdMap(rr);if(lr===void 0)return e.push(tr),this.canBeUpdated=!0,B;ir=tr.relation.createValueMap(lr),this.updatedRelationMaps.push({relation:tr.relation,value:lr})}else ir=tr.relation.createValueMap(rr),this.updatedRelationMaps.push({relation:tr.relation,value:rr});return OrmUtils.mergeDeep(B,ir),B},{});return this.changeMaps=e,I}recompute(){this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach(e=>{if(e.relationMetadata&&e.relationMetadata.inverseEntityMetadata===this.parentSubject.metadata){const I=e.referencedColumn.getEntityValue(this.parentSubject.entity);e.setEntityValue(this.entityWithFulfilledIds,I)}}),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))}}class OneToManySubjectBuilder{constructor(e){this.subjects=e}build(){this.subjects.forEach(e=>{e.metadata.oneToManyRelations.forEach(I=>{I.persistenceEnabled!==!1&&this.buildForSubjectRelation(e,I)})})}buildForSubjectRelation(e,I){let B=[];if(e.databaseEntity){const ir=I.getEntityValue(e.databaseEntity);ir&&(B=ir.map(lr=>I.inverseEntityMetadata.getEntityIdMap(lr)))}let tr=I.getEntityValue(e.entity);if(tr===null&&(tr=[]),tr===void 0)return;const rr=[];tr.forEach(ir=>{let lr=I.inverseEntityMetadata.getEntityIdMap(ir),dr=this.subjects.find(hr=>hr.entity===ir);if(dr&&(lr=dr.identifier),!lr){if(!dr)return;dr.changeMaps.push({relation:I.inverseRelation,value:e});return}B.find(hr=>OrmUtils.compareIds(lr,hr))||(dr||(dr=new Subject({metadata:I.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:lr}),this.subjects.push(dr)),dr.changeMaps.push({relation:I.inverseRelation,value:e})),rr.push(lr)}),I.inverseRelation?.orphanedRowAction!=="disable"&&EntityMetadata.difference(B,rr).forEach(ir=>{const lr=new Subject({metadata:I.inverseEntityMetadata,parentSubject:e,identifier:ir});!I.inverseRelation||I.inverseRelation.orphanedRowAction==="nullify"?(lr.canBeUpdated=!0,lr.changeMaps=[{relation:I.inverseRelation,value:null}]):I.inverseRelation.orphanedRowAction==="delete"?lr.mustBeRemoved=!0:I.inverseRelation.orphanedRowAction==="soft-delete"&&(lr.canBeSoftRemoved=!0),this.subjects.push(lr)})}}class OneToOneInverseSideSubjectBuilder{constructor(e){this.subjects=e}build(){this.subjects.forEach(e=>{e.metadata.oneToOneRelations.forEach(I=>{I.isOwning||I.persistenceEnabled===!1||this.buildForSubjectRelation(e,I)})})}buildForSubjectRelation(e,I){let B;e.databaseEntity&&(B=I.getEntityValue(e.databaseEntity));let tr=I.getEntityValue(e.entity);if(tr===void 0)return;if(tr===null){if(B){const dr=new Subject({metadata:I.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:B,changeMaps:[{relation:I.inverseRelation,value:null}]});this.subjects.push(dr)}return}let rr=I.inverseEntityMetadata.getEntityIdMap(tr),ir=this.subjects.find(dr=>!!dr.entity&&dr.entity===tr);if(ir&&(rr=ir.identifier),!rr){if(!ir)return;ir.changeMaps.push({relation:I.inverseRelation,value:e})}B&&OrmUtils.compareIds(rr,B)||(ir||(ir=new Subject({metadata:I.inverseEntityMetadata,canBeUpdated:!0,identifier:rr}),this.subjects.push(ir)),ir.changeMaps.push({relation:I.inverseRelation,value:e}))}}class ManyToManySubjectBuilder{constructor(e){this.subjects=e}build(){this.subjects.forEach(e=>{e.entity&&e.metadata.manyToManyRelations.forEach(I=>{I.persistenceEnabled!==!1&&this.buildForSubjectRelation(e,I)})})}buildForAllRemoval(e){e.databaseEntity&&e.metadata.manyToManyRelations.forEach(I=>{if(I.persistenceEnabled===!1)return;I.getEntityValue(e.databaseEntity).forEach(tr=>{const rr=new Subject({metadata:I.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,I,tr)});this.subjects.push(rr)})})}buildForSubjectRelation(e,I){let B=[];if(e.databaseEntity){const lr=I.getEntityValue(e.databaseEntity);lr&&(B=lr.map(dr=>I.inverseEntityMetadata.getEntityIdMap(dr)))}let tr=I.getEntityValue(e.entity);if(tr===null&&(tr=[]),!Array.isArray(tr))return;tr.forEach(lr=>{let dr=I.inverseEntityMetadata.getEntityIdMap(lr);const mr=this.subjects.find(Sr=>Sr.entity===lr);if(mr&&(dr=mr.identifier),!dr&&!mr||B.find(Sr=>OrmUtils.compareIds(Sr,dr)))return;const fr=I.isOwning?e:mr||lr,_r=I.isOwning?mr||lr:e,gr=new Subject({metadata:I.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});this.subjects.push(gr),I.junctionEntityMetadata.ownerColumns.forEach(Sr=>{gr.changeMaps.push({column:Sr,value:fr})}),I.junctionEntityMetadata.inverseColumns.forEach(Sr=>{gr.changeMaps.push({column:Sr,value:_r})})});const rr=[];tr.forEach(lr=>{let dr=I.inverseEntityMetadata.getEntityIdMap(lr);const mr=this.subjects.find(hr=>hr.entity===lr);mr&&(dr=mr.identifier),dr!=null&&rr.push(dr)}),B.filter(lr=>!rr.find(dr=>OrmUtils.compareIds(dr,lr))).forEach(lr=>{const dr=new Subject({metadata:I.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,I,lr)});this.subjects.push(dr)})}buildJunctionIdentifier(e,I,B){const tr=I.isOwning?e.entity:B,rr=I.isOwning?B:e.entity,ir={};return I.junctionEntityMetadata.ownerColumns.forEach(lr=>{OrmUtils.mergeDeep(ir,lr.createValueMap(lr.referencedColumn.getEntityValue(tr)))}),I.junctionEntityMetadata.inverseColumns.forEach(lr=>{OrmUtils.mergeDeep(ir,lr.createValueMap(lr.referencedColumn.getEntityValue(rr)))}),ir}}class SubjectDatabaseEntityLoader{constructor(e,I){this.queryRunner=e,this.subjects=I}async load(e){const I=this.groupByEntityTargets().map(async B=>{const tr=[],rr=[];if(B.subjects.forEach(mr=>{mr.databaseEntity||!mr.identifier||(tr.push(mr.identifier),rr.push(mr))}),!tr.length)return;const ir=[];e==="save"||e==="soft-remove"||e==="recover"?B.subjects.forEach(mr=>{mr.metadata.relations.forEach(hr=>{hr.getEntityValue(mr.entityWithFulfilledIds)!==void 0&&ir.indexOf(hr.propertyPath)===-1&&ir.push(hr.propertyPath)})}):ir.push(...B.subjects[0].metadata.manyToManyRelations.map(mr=>mr.propertyPath));const lr={loadEagerRelations:!1,loadRelationIds:{relations:ir,disableMixedMap:!0},withDeleted:!0};let dr=[];this.queryRunner.connection.driver.options.type==="mongodb"?dr=await this.queryRunner.manager.getRepository(B.target).findByIds(tr,lr):dr=await this.queryRunner.manager.getRepository(B.target).createQueryBuilder().setFindOptions(lr).whereInIds(tr).getMany(),dr.forEach(mr=>{this.findByPersistEntityLike(B.target,mr).forEach(fr=>{fr.databaseEntity=mr,fr.identifier||(fr.identifier=fr.metadata.hasAllPrimaryKeys(mr)?fr.metadata.getEntityIdMap(mr):void 0)})});for(let mr of rr)mr.databaseEntityLoaded=!0});await Promise.all(I)}findByPersistEntityLike(e,I){return this.subjects.filter(B=>B.entity?B.entity===I?!0:B.metadata.target===e&&B.metadata.compareEntities(B.entityWithFulfilledIds,I):!1)}groupByEntityTargets(){return this.subjects.reduce((e,I)=>{let B=e.find(tr=>tr.target===I.metadata.target);return B||(B={target:I.metadata.target,subjects:[]},e.push(B)),B.subjects.push(I),e},[])}}class CascadesSubjectBuilder{constructor(e){this.allSubjects=e}build(e,I){e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach(([B,tr,rr])=>{if(tr==null||!B.isCascadeInsert&&!B.isCascadeUpdate&&!B.isCascadeSoftRemove&&!B.isCascadeRecover||!ObjectUtils.isObject(tr))return;const ir=this.findByPersistEntityLike(rr.target,tr);if(ir){ir.canBeInserted===!1&&(ir.canBeInserted=B.isCascadeInsert===!0&&I==="save"),ir.canBeUpdated===!1&&(ir.canBeUpdated=B.isCascadeUpdate===!0&&I==="save"),ir.canBeSoftRemoved===!1&&(ir.canBeSoftRemoved=B.isCascadeSoftRemove===!0&&I==="soft-remove"),ir.canBeRecovered===!1&&(ir.canBeRecovered=B.isCascadeRecover===!0&&I==="recover");return}const lr=new Subject({metadata:rr,parentSubject:e,entity:tr,canBeInserted:B.isCascadeInsert===!0&&I==="save",canBeUpdated:B.isCascadeUpdate===!0&&I==="save",canBeSoftRemoved:B.isCascadeSoftRemove===!0&&I==="soft-remove",canBeRecovered:B.isCascadeRecover===!0&&I==="recover"});this.allSubjects.push(lr),this.build(lr,I)})}findByPersistEntityLike(e,I){return this.allSubjects.find(B=>B.entity?B.entity===I?!0:B.metadata.target===e&&B.metadata.compareEntities(B.entityWithFulfilledIds,I):!1)}}class EntityPersistExecutor{constructor(e,I,B,tr,rr,ir){this.connection=e,this.queryRunner=I,this.mode=B,this.target=tr,this.entity=rr,this.options=ir}async execute(){if(!this.entity||typeof this.entity!="object")return Promise.reject(new MustBeEntityError(this.mode,this.entity));await Promise.resolve();const e=this.queryRunner||this.connection.createQueryRunner();let I=e.data;this.options&&this.options.data&&(e.data=this.options.data);try{const B=Array.isArray(this.entity)?this.entity:[this.entity],tr=this.options&&this.options.chunk&&this.options.chunk>0?OrmUtils.chunk(B,this.options.chunk):[B],ir=(await Promise.all(tr.map(async dr=>{const mr=[];dr.forEach(fr=>{const _r=this.target?this.target:fr.constructor;if(_r===Object)throw new CannotDetermineEntityError(this.mode);let gr=this.connection.getMetadata(_r).findInheritanceMetadata(fr);mr.push(new Subject({metadata:gr,entity:fr,canBeInserted:this.mode==="save",canBeUpdated:this.mode==="save",mustBeRemoved:this.mode==="remove",canBeSoftRemoved:this.mode==="soft-remove",canBeRecovered:this.mode==="recover"}))});const hr=new CascadesSubjectBuilder(mr);return mr.forEach(fr=>{hr.build(fr,this.mode)}),await new SubjectDatabaseEntityLoader(e,mr).load(this.mode),this.mode==="save"||this.mode==="soft-remove"||this.mode==="recover"?(new OneToManySubjectBuilder(mr).build(),new OneToOneInverseSideSubjectBuilder(mr).build(),new ManyToManySubjectBuilder(mr).build()):mr.forEach(fr=>{fr.mustBeRemoved&&new ManyToManySubjectBuilder(mr).buildForAllRemoval(fr)}),new SubjectExecutor(e,mr,this.options)}))).filter(dr=>dr.hasExecutableOperations);if(ir.length===0)return;let lr=!1;try{e.isTransactionActive||this.connection.driver.transactionSupport!=="none"&&(!this.options||this.options.transaction!==!1)&&(lr=!0,await e.startTransaction());for(const dr of ir)await dr.execute();lr===!0&&await e.commitTransaction()}catch(dr){if(lr)try{await e.rollbackTransaction()}catch{}throw dr}}finally{e.data=I,this.queryRunner||await e.release()}}}class EntityManager{constructor(e,I){this["@instanceof"]=Symbol.for("EntityManager"),this.repositories=new Map,this.treeRepositories=[],this.plainObjectToEntityTransformer=new PlainObjectToNewEntityTransformer,this.connection=e,I&&(this.queryRunner=I,ObjectUtils.assign(this.queryRunner,{manager:this}))}async transaction(e,I){const B=typeof e=="string"?e:void 0,tr=typeof e=="function"?e:I;if(!tr)throw new TypeORMError("Transaction method requires callback in second parameter if isolation level is supplied.");if(this.queryRunner&&this.queryRunner.isReleased)throw new QueryRunnerProviderAlreadyReleasedError;const rr=this.queryRunner||this.connection.createQueryRunner();try{await rr.startTransaction(B);const ir=await tr(rr.manager);return await rr.commitTransaction(),ir}catch(ir){try{await rr.rollbackTransaction()}catch{}throw ir}finally{this.queryRunner||await rr.release()}}async query(e,I){return this.connection.query(e,I,this.queryRunner)}createQueryBuilder(e,I,B){return I?this.connection.createQueryBuilder(e,I,B||this.queryRunner):this.connection.createQueryBuilder(e||B||this.queryRunner)}hasId(e,I){const B=arguments.length===2?e:e.constructor,tr=arguments.length===2?I:e;return this.connection.getMetadata(B).hasId(tr)}getId(e,I){const B=arguments.length===2?e:e.constructor,tr=arguments.length===2?I:e;return this.connection.getMetadata(B).getEntityIdMixedMap(tr)}create(e,I){const B=this.connection.getMetadata(e);if(!I)return B.create(this.queryRunner);if(Array.isArray(I))return I.map(rr=>this.create(e,rr));const tr=B.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(tr,I,B,!0),tr}merge(e,I,...B){const tr=this.connection.getMetadata(e);return B.forEach(rr=>this.plainObjectToEntityTransformer.transform(I,rr,tr)),I}async preload(e,I){const B=this.connection.getMetadata(e),rr=await new PlainObjectToDatabaseEntityTransformer(this.connection.manager).transform(I,B);if(rr)return this.merge(e,rr,I)}save(e,I,B){let tr=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0;const rr=tr?I:e,ir=tr?B:I;return InstanceChecker.isEntitySchema(tr)&&(tr=tr.options.name),Array.isArray(rr)&&rr.length===0?Promise.resolve(rr):new EntityPersistExecutor(this.connection,this.queryRunner,"save",tr,rr,ir).execute().then(()=>rr)}remove(e,I,B){const tr=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0,rr=tr?I:e,ir=tr?B:I;return Array.isArray(rr)&&rr.length===0?Promise.resolve(rr):new EntityPersistExecutor(this.connection,this.queryRunner,"remove",tr,rr,ir).execute().then(()=>rr)}softRemove(e,I,B){let tr=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0;const rr=tr?I:e,ir=tr?B:I;return InstanceChecker.isEntitySchema(tr)&&(tr=tr.options.name),Array.isArray(rr)&&rr.length===0?Promise.resolve(rr):new EntityPersistExecutor(this.connection,this.queryRunner,"soft-remove",tr,rr,ir).execute().then(()=>rr)}recover(e,I,B){let tr=arguments.length>1&&(typeof e=="function"||InstanceChecker.isEntitySchema(e)||typeof e=="string")?e:void 0;const rr=tr?I:e,ir=tr?B:I;return InstanceChecker.isEntitySchema(tr)&&(tr=tr.options.name),Array.isArray(rr)&&rr.length===0?Promise.resolve(rr):new EntityPersistExecutor(this.connection,this.queryRunner,"recover",tr,rr,ir).execute().then(()=>rr)}async insert(e,I){return this.createQueryBuilder().insert().into(e).values(I).execute()}async upsert(e,I,B){const tr=this.connection.getMetadata(e);let rr;Array.isArray(B)?rr={conflictPaths:B}:rr=B;let ir;Array.isArray(I)?ir=I:ir=[I];const lr=tr.mapPropertyPathsToColumns(Array.isArray(rr.conflictPaths)?rr.conflictPaths:Object.keys(rr.conflictPaths)),dr=tr.columns.filter(mr=>!lr.includes(mr)&&ir.some(hr=>typeof mr.getEntityValue(hr)<"u"));return this.createQueryBuilder().insert().into(e).values(ir).orUpdate([...lr,...dr].map(mr=>mr.databaseName),lr.map(mr=>mr.databaseName),{skipUpdateIfNoValuesChanged:rr.skipUpdateIfNoValuesChanged,indexPredicate:rr.indexPredicate,upsertType:rr.upsertType||this.connection.driver.supportedUpsertTypes[0]}).execute()}update(e,I,B){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the update method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().update(e).set(B).whereInIds(I).execute():this.createQueryBuilder().update(e).set(B).where(I).execute()}delete(e,I){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the delete method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().delete().from(e).whereInIds(I).execute():this.createQueryBuilder().delete().from(e).where(I).execute()}softDelete(e,I){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the delete method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().softDelete().from(e).whereInIds(I).execute():this.createQueryBuilder().softDelete().from(e).where(I).execute()}restore(e,I){return I==null||I===""||Array.isArray(I)&&I.length===0?Promise.reject(new TypeORMError("Empty criteria(s) are not allowed for the delete method.")):typeof I=="string"||typeof I=="number"||I instanceof Date||Array.isArray(I)?this.createQueryBuilder().restore().from(e).whereInIds(I).execute():this.createQueryBuilder().restore().from(e).where(I).execute()}exists(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||B.name).setFindOptions(I||{}).getExists()}async existsBy(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,B.name).setFindOptions({where:I}).getExists()}count(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||B.name).setFindOptions(I||{}).getCount()}countBy(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,B.name).setFindOptions({where:I}).getCount()}sum(e,I,B){return this.callAggregateFun(e,"SUM",I,B)}average(e,I,B){return this.callAggregateFun(e,"AVG",I,B)}minimum(e,I,B){return this.callAggregateFun(e,"MIN",I,B)}maximum(e,I,B){return this.callAggregateFun(e,"MAX",I,B)}async callAggregateFun(e,I,B,tr={}){const rr=this.connection.getMetadata(e),ir=rr.columns.find(dr=>dr.propertyPath===B);if(!ir)throw new TypeORMError(`Column "${B}" was not found in table "${rr.name}"`);const lr=await this.createQueryBuilder(e,rr.name).setFindOptions({where:tr}).select(`${I}(${this.connection.driver.escape(ir.databaseName)})`,I).getRawOne();return lr[I]===null?null:parseFloat(lr[I])}async find(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||B.name).setFindOptions(I||{}).getMany()}async findBy(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,B.name).setFindOptions({where:I}).getMany()}findAndCount(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,FindOptionsUtils.extractFindManyOptionsAlias(I)||B.name).setFindOptions(I||{}).getManyAndCount()}findAndCountBy(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,B.name).setFindOptions({where:I}).getManyAndCount()}async findByIds(e,I){if(!I.length)return Promise.resolve([]);const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,B.name).andWhereInIds(I).getMany()}async findOne(e,I){let tr=this.connection.getMetadata(e).name;if(I&&I.join&&(tr=I.join.alias),!I.where)throw new Error("You must provide selection conditions in order to find a single row.");return this.createQueryBuilder(e,tr).setFindOptions({...I,take:1}).getOne()}async findOneBy(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,B.name).setFindOptions({where:I,take:1}).getOne()}async findOneById(e,I){const B=this.connection.getMetadata(e);return this.createQueryBuilder(e,B.name).setFindOptions({take:1}).whereInIds(B.ensureEntityIdMap(I)).getOne()}async findOneOrFail(e,I){return this.findOne(e,I).then(B=>B===null?Promise.reject(new EntityNotFoundError(e,I)):Promise.resolve(B))}async findOneByOrFail(e,I){return this.findOneBy(e,I).then(B=>B===null?Promise.reject(new EntityNotFoundError(e,I)):Promise.resolve(B))}async clear(e){const I=this.connection.getMetadata(e),B=this.queryRunner||this.connection.createQueryRunner();try{return await B.clearTable(I.tablePath)}finally{this.queryRunner||await B.release()}}async increment(e,I,B,tr){const rr=this.connection.getMetadata(e),ir=rr.findColumnWithPropertyPath(B);if(!ir)throw new TypeORMError(`Column ${B} was not found in ${rr.targetName} entity.`);if(isNaN(Number(tr)))throw new TypeORMError(`Value "${tr}" is not a number.`);const lr=B.split(".").reduceRight((dr,mr)=>({[mr]:dr}),()=>this.connection.driver.escape(ir.databaseName)+" + "+tr);return this.createQueryBuilder(e,"entity").update(e).set(lr).where(I).execute()}async decrement(e,I,B,tr){const rr=this.connection.getMetadata(e),ir=rr.findColumnWithPropertyPath(B);if(!ir)throw new TypeORMError(`Column ${B} was not found in ${rr.targetName} entity.`);if(isNaN(Number(tr)))throw new TypeORMError(`Value "${tr}" is not a number.`);const lr=B.split(".").reduceRight((dr,mr)=>({[mr]:dr}),()=>this.connection.driver.escape(ir.databaseName)+" - "+tr);return this.createQueryBuilder(e,"entity").update(e).set(lr).where(I).execute()}getRepository(e){const I=this.repositories.get(e);if(I)return I;if(this.connection.driver.options.type==="mongodb"){const B=new MongoRepository(e,this,this.queryRunner);return this.repositories.set(e,B),B}else{const B=new Repository(e,this,this.queryRunner);return this.repositories.set(e,B),B}}getTreeRepository(e){if(this.connection.driver.treeSupport===!1)throw new TreeRepositoryNotSupportedError(this.connection.driver);const I=this.treeRepositories.find(tr=>tr.target===e);if(I)return I;const B=new TreeRepository(e,this,this.queryRunner);return this.treeRepositories.push(B),B}getMongoRepository(e){return this.connection.getMongoRepository(e)}withRepository(e){const I=e.constructor,{target:B,manager:tr,queryRunner:rr,...ir}=e;return Object.assign(new I(e.target,this),{...ir})}getCustomRepository(e){const I=getMetadataArgsStorage().entityRepositories.find(rr=>rr.target===(typeof e=="function"?e:e.constructor));if(!I)throw new CustomRepositoryNotFoundError(e);const B=I.entity?this.connection.getMetadata(I.entity):void 0,tr=new I.target(this,B);if(tr instanceof AbstractRepository)tr.manager||(tr.manager=this);else{if(!B)throw new CustomRepositoryCannotInheritRepositoryError(e);tr.manager=this,tr.metadata=B}return tr}async release(){if(!this.queryRunner)throw new NoNeedToReleaseEntityManagerError;return this.queryRunner.release()}}class SqljsEntityManager extends EntityManager{constructor(e,I){super(e,I),this["@instanceof"]=Symbol.for("SqljsEntityManager"),this.driver=e.driver}async loadDatabase(e){await this.driver.load(e)}async saveDatabase(e){await this.driver.save(e)}exportDatabase(){return this.driver.export()}}class EntityManagerFactory{create(e,I){return e.driver.options.type==="mongodb"?new MongoEntityManager(e):e.driver.options.type==="sqljs"?new SqljsEntityManager(e,I):new EntityManager(e,I)}}class View{constructor(e){this["@instanceof"]=Symbol.for("View"),this.indices=[],e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}clone(){return new View({database:this.database,schema:this.schema,name:this.name,expression:this.expression,materialized:this.materialized})}addIndex(e){this.indices.push(e)}removeIndex(e){const I=this.indices.find(B=>B.name===e.name);I&&this.indices.splice(this.indices.indexOf(I),1)}static create(e,I){const B={database:e.database,schema:e.schema,name:I.buildTableName(e.tableName,e.schema,e.database),expression:e.expression,materialized:e.tableMetadataArgs.materialized};return new View(B)}}class ViewUtils{static viewMetadataCmp(e,I){return!e||!I?0:e.dependsOn&&(e.dependsOn.has(I.target)||e.dependsOn.has(I.name))?1:I.dependsOn&&(I.dependsOn.has(e.target)||I.dependsOn.has(e.name))?-1:0}}class RdbmsSchemaBuilder{constructor(e){this.connection=e,this["@instanceof"]=Symbol.for("RdbmsSchemaBuilder")}async build(){this.queryRunner=this.connection.createQueryRunner(),this.currentDatabase=this.connection.driver.database,this.currentSchema=this.connection.driver.schema;const e=this.connection.driver.options.type!=="cockroachdb"&&this.connection.driver.options.type!=="spanner"&&this.connection.options.migrationsTransactionMode!=="none";await this.queryRunner.beforeMigration(),e&&await this.queryRunner.startTransaction();try{await this.createMetadataTableIfNecessary(this.queryRunner);const I=this.entityToSyncMetadatas.map(tr=>this.getTablePath(tr)),B=this.viewEntityToSyncMetadatas.map(tr=>this.getTablePath(tr));await this.queryRunner.getTables(I),await this.queryRunner.getViews(B),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),e&&await this.queryRunner.commitTransaction()}catch(I){try{e&&await this.queryRunner.rollbackTransaction()}catch{}throw I}finally{await this.queryRunner.afterMigration(),await this.queryRunner.release()}}async createMetadataTableIfNecessary(e){(this.viewEntityToSyncMetadatas.length>0||this.hasGeneratedColumns())&&await this.createTypeormMetadataTable(e)}async log(){this.queryRunner=this.connection.createQueryRunner();try{const e=this.entityToSyncMetadatas.map(B=>this.getTablePath(B)),I=this.viewEntityToSyncMetadatas.map(B=>this.getTablePath(B));return await this.queryRunner.getTables(e),await this.queryRunner.getViews(I),this.queryRunner.enableSqlMemory(),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),this.queryRunner.getMemorySql()}finally{this.queryRunner.disableSqlMemory(),await this.queryRunner.release()}}get entityToSyncMetadatas(){return this.connection.entityMetadatas.filter(e=>e.synchronize&&e.tableType!=="entity-child"&&e.tableType!=="view")}get viewEntityToSyncMetadatas(){return this.connection.entityMetadatas.filter(e=>e.tableType==="view"&&e.synchronize).sort(ViewUtils.viewMetadataCmp)}hasGeneratedColumns(){return this.connection.entityMetadatas.some(e=>e.columns.some(I=>I.generatedType))}async executeSchemaSyncOperationsInProperOrder(){await this.dropOldViews(),await this.dropOldForeignKeys(),await this.dropOldIndices(),await this.dropOldChecks(),await this.dropOldExclusions(),await this.dropCompositeUniqueConstraints(),await this.renameColumns(),await this.changeTableComment(),await this.createNewTables(),await this.dropRemovedColumns(),await this.addNewColumns(),await this.updatePrimaryKeys(),await this.updateExistColumns(),await this.createNewIndices(),await this.createNewChecks(),await this.createNewExclusions(),await this.createCompositeUniqueConstraints(),await this.createForeignKeys(),await this.createViews(),await this.createNewViewIndices()}getTablePath(e){const I=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(I.tableName,I.schema||this.currentSchema,I.database||this.currentDatabase)}async dropOldForeignKeys(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=I.foreignKeys.filter(tr=>{const rr=e.foreignKeys.find(ir=>tr.name===ir.name&&this.getTablePath(tr)===this.getTablePath(ir.referencedEntityMetadata));return!rr||rr.onDelete&&rr.onDelete!==tr.onDelete||rr.onUpdate&&rr.onUpdate!==tr.onUpdate});B.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old foreign keys of ${I.name}: ${B.map(tr=>tr.name).join(", ")}`),await this.queryRunner.dropForeignKeys(I,B))}}async renameTables(){}async renameColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ir=>this.getTablePath(ir)===this.getTablePath(e));if(!I||e.columns.length!==I.columns.length)continue;const B=e.columns.filter(ir=>!ir.isVirtualProperty).filter(ir=>!I.columns.find(lr=>lr.name===ir.databaseName&&lr.type===this.connection.driver.normalizeType(ir)&&lr.isNullable===ir.isNullable&&lr.isUnique===this.connection.driver.normalizeIsUnique(ir)));if(B.length===0||B.length>1)continue;const tr=I.columns.filter(ir=>!e.columns.find(lr=>!lr.isVirtualProperty&&lr.databaseName===ir.name&&this.connection.driver.normalizeType(lr)===ir.type&&lr.isNullable===ir.isNullable&&this.connection.driver.normalizeIsUnique(lr)===ir.isUnique));if(tr.length===0||tr.length>1)continue;const rr=tr[0].clone();rr.name=B[0].databaseName,this.connection.logger.logSchemaBuild(`renaming column "${tr[0].name}" in "${I.name}" to "${rr.name}"`),await this.queryRunner.renameColumn(I,tr[0],rr)}}async dropOldIndices(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=I.indices.filter(tr=>{const rr=e.indices.find(ir=>ir.name===tr.name);return rr?rr.synchronize===!1?!1:rr.isUnique!==tr.isUnique||rr.isSpatial!==tr.isSpatial||this.connection.driver.isFullTextColumnTypeSupported()&&rr.isFulltext!==tr.isFulltext||rr.columns.length!==tr.columnNames.length?!0:!rr.columns.every(ir=>tr.columnNames.indexOf(ir.databaseName)!==-1):!0}).map(async tr=>{this.connection.logger.logSchemaBuild(`dropping an index: "${tr.name}" from table ${I.name}`),await this.queryRunner.dropIndex(I,tr)});await Promise.all(B)}if(this.connection.options.type==="postgres"){const e=this.queryRunner;for(const I of this.viewEntityToSyncMetadatas){const B=this.queryRunner.loadedViews.find(rr=>this.getTablePath(rr)===this.getTablePath(I));if(!B)continue;const tr=B.indices.filter(rr=>{const ir=I.indices.find(lr=>lr.name===rr.name);return ir?ir.synchronize===!1?!1:ir.isUnique!==rr.isUnique||ir.isSpatial!==rr.isSpatial||this.connection.driver.isFullTextColumnTypeSupported()&&ir.isFulltext!==rr.isFulltext||ir.columns.length!==rr.columnNames.length?!0:!ir.columns.every(lr=>rr.columnNames.indexOf(lr.databaseName)!==-1):!0}).map(async rr=>{this.connection.logger.logSchemaBuild(`dropping an index: "${rr.name}" from view ${B.name}`),await e.dropViewIndex(B,rr)});await Promise.all(tr)}}}async dropOldChecks(){if(!(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"))for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=I.checks.filter(tr=>!e.checks.find(rr=>rr.name===tr.name));B.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old check constraint: ${B.map(tr=>`"${tr.name}"`).join(", ")} from table "${I.name}"`),await this.queryRunner.dropCheckConstraints(I,B))}}async dropCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=I.uniques.filter(tr=>tr.columnNames.length>1&&!e.uniques.find(rr=>rr.name===tr.name));B.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old unique constraint: ${B.map(tr=>`"${tr.name}"`).join(", ")} from table "${I.name}"`),await this.queryRunner.dropUniqueConstraints(I,B))}}async dropOldExclusions(){if(this.connection.driver.options.type==="postgres")for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=I.exclusions.filter(tr=>!e.exclusions.find(rr=>rr.name===tr.name));B.length!==0&&(this.connection.logger.logSchemaBuild(`dropping old exclusion constraint: ${B.map(tr=>`"${tr.name}"`).join(", ")} from table "${I.name}"`),await this.queryRunner.dropExclusionConstraints(I,B))}}async changeTableComment(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(B=>this.getTablePath(B)===this.getTablePath(e));if(I&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="postgres")){const B=e.comment;await this.queryRunner.changeTableComment(I,B)}}}async createNewTables(){for(const e of this.entityToSyncMetadatas){if(this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e)))continue;this.connection.logger.logSchemaBuild(`creating a new table: ${this.getTablePath(e)}`);const B=Table.create(e,this.connection.driver);await this.queryRunner.createTable(B,!1,!1),this.queryRunner.loadedTables.push(B)}}async createViews(){for(const e of this.viewEntityToSyncMetadatas){if(this.queryRunner.loadedViews.find(tr=>{const rr=typeof tr.expression=="string"?tr.expression.trim():tr.expression(this.connection).getQuery(),ir=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.getTablePath(tr)===this.getTablePath(e)&&rr===ir}))continue;this.connection.logger.logSchemaBuild(`creating a new view: ${this.getTablePath(e)}`);const B=View.create(e,this.connection.driver);await this.queryRunner.createView(B,!0),this.queryRunner.loadedViews.push(B)}}async dropOldViews(){const e=[],I=this.viewEntityToSyncMetadatas,B=new Map;for(const ir of this.queryRunner.loadedViews){const lr=I.find(dr=>this.getTablePath(ir)===this.getTablePath(dr));lr&&B.set(ir,lr)}for(const ir of this.queryRunner.loadedViews){const lr=B.get(ir);if(!lr)continue;const dr=typeof ir.expression=="string"?ir.expression.trim():ir.expression(this.connection).getQuery(),mr=typeof lr.expression=="string"?lr.expression.trim():lr.expression(this.connection).getQuery();dr!==mr&&(this.connection.logger.logSchemaBuild(`dropping an old view: ${ir.name}`),e.push(ir))}const tr=ir=>{const lr=B.get(ir);let dr=[ir];if(!lr)return dr;for(const[mr,hr]of B.entries())mr!==ir&&hr.dependsOn&&(hr.dependsOn.has(lr.target)||hr.dependsOn.has(lr.name))&&(dr=dr.concat(tr(mr)));return dr},rr=new Set(e.map(ir=>tr(ir)).reduce((ir,lr)=>ir.concat(lr),[]).sort((ir,lr)=>ViewUtils.viewMetadataCmp(B.get(ir),B.get(lr))).reverse());for(const ir of rr)await this.queryRunner.dropView(ir);this.queryRunner.loadedViews=this.queryRunner.loadedViews.filter(ir=>!rr.has(ir))}async dropRemovedColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=I.columns.filter(tr=>!e.columns.find(rr=>rr.isVirtualProperty||rr.databaseName===tr.name));B.length!==0&&(this.connection.logger.logSchemaBuild(`columns dropped in ${I.name}: `+B.map(tr=>tr.name).join(", ")),await this.queryRunner.dropColumns(I,B))}}async addNewColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(ir=>this.getTablePath(ir)===this.getTablePath(e));if(!I)continue;const B=e.columns.filter(ir=>!ir.isVirtualProperty&&!I.columns.find(lr=>lr.name===ir.databaseName));if(B.length===0)continue;const rr=this.metadataColumnsToTableColumnOptions(B).map(ir=>new TableColumn(ir));rr.length!==0&&(this.connection.logger.logSchemaBuild("new columns added: "+B.map(ir=>ir.databaseName).join(", ")),await this.queryRunner.addColumns(I,rr))}}async updatePrimaryKeys(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(rr=>this.getTablePath(rr)===this.getTablePath(e));if(!I)continue;const B=e.columns.filter(rr=>rr.isPrimary);if(I.columns.filter(rr=>rr.isPrimary).length!==B.length&&B.length>1){const rr=B.map(ir=>new TableColumn(TableUtils.createTableColumnOptions(ir,this.connection.driver)));await this.queryRunner.updatePrimaryKeys(I,rr)}}}async updateExistColumns(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(rr=>this.getTablePath(rr)===this.getTablePath(e));if(!I)continue;const B=this.connection.driver.findChangedColumns(I.columns,e.columns);if(B.length===0)continue;for(const rr of B)await this.dropColumnReferencedForeignKeys(this.getTablePath(e),rr.databaseName);for(const rr of B)await this.dropColumnCompositeIndices(this.getTablePath(e),rr.databaseName);if(!(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="spanner"))for(const rr of B)await this.dropColumnCompositeUniques(this.getTablePath(e),rr.databaseName);const tr=B.map(rr=>{const ir=I.columns.find(mr=>mr.name===rr.databaseName),lr=TableUtils.createTableColumnOptions(rr,this.connection.driver),dr=new TableColumn(lr);return{oldColumn:ir,newColumn:dr}});tr.length!==0&&(this.connection.logger.logSchemaBuild(`columns changed in "${I.name}". updating: `+B.map(rr=>rr.databaseName).join(", ")),await this.queryRunner.changeColumns(I,tr))}}async createNewIndices(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=e.indices.filter(tr=>!I.indices.find(rr=>rr.name===tr.name)&&tr.synchronize===!0).map(tr=>TableIndex.create(tr));B.length!==0&&(this.connection.logger.logSchemaBuild(`adding new indices ${B.map(tr=>`"${tr.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createIndices(I,B))}}async createNewViewIndices(){if(this.connection.options.type!=="postgres"||!DriverUtils.isPostgresFamily(this.connection.driver))return;const e=this.queryRunner;for(const I of this.viewEntityToSyncMetadatas){const B=this.queryRunner.loadedViews.find(rr=>{const ir=typeof rr.expression=="string"?rr.expression.trim():rr.expression(this.connection).getQuery(),lr=typeof I.expression=="string"?I.expression.trim():I.expression(this.connection).getQuery();return this.getTablePath(rr)===this.getTablePath(I)&&ir===lr});if(!B||!B.materialized)continue;const tr=I.indices.filter(rr=>!B.indices.find(ir=>ir.name===rr.name)&&rr.synchronize===!0).map(rr=>TableIndex.create(rr));tr.length!==0&&(this.connection.logger.logSchemaBuild(`adding new indices ${tr.map(rr=>`"${rr.name}"`).join(", ")} in view "${B.name}"`),await e.createViewIndices(B,tr))}}async createNewChecks(){if(!(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"))for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=e.checks.filter(tr=>!I.checks.find(rr=>rr.name===tr.name)).map(tr=>TableCheck.create(tr));B.length!==0&&(this.connection.logger.logSchemaBuild(`adding new check constraints: ${B.map(tr=>`"${tr.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createCheckConstraints(I,B))}}async createCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=e.uniques.filter(tr=>tr.columns.length>1&&!I.uniques.find(rr=>rr.name===tr.name)).map(tr=>TableUnique.create(tr));B.length!==0&&(this.connection.logger.logSchemaBuild(`adding new unique constraints: ${B.map(tr=>`"${tr.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createUniqueConstraints(I,B))}}async createNewExclusions(){if(this.connection.driver.options.type==="postgres")for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(tr=>this.getTablePath(tr)===this.getTablePath(e));if(!I)continue;const B=e.exclusions.filter(tr=>!I.exclusions.find(rr=>rr.name===tr.name)).map(tr=>TableExclusion.create(tr));B.length!==0&&(this.connection.logger.logSchemaBuild(`adding new exclusion constraints: ${B.map(tr=>`"${tr.name}"`).join(", ")} in table "${I.name}"`),await this.queryRunner.createExclusionConstraints(I,B))}}async createForeignKeys(){for(const e of this.entityToSyncMetadatas){const I=this.queryRunner.loadedTables.find(rr=>this.getTablePath(rr)===this.getTablePath(e));if(!I)continue;const B=e.foreignKeys.filter(rr=>!I.foreignKeys.find(ir=>ir.name===rr.name&&this.getTablePath(ir)===this.getTablePath(rr.referencedEntityMetadata)));if(B.length===0)continue;const tr=B.map(rr=>TableForeignKey.create(rr,this.connection.driver));this.connection.logger.logSchemaBuild(`creating a foreign keys: ${B.map(rr=>rr.name).join(", ")} on table "${I.name}"`),await this.queryRunner.createForeignKeys(I,tr)}}async dropColumnReferencedForeignKeys(e,I){const B=this.queryRunner.loadedTables.find(ir=>this.getTablePath(ir)===e);if(!B)return;const tr=[],rr=B.foreignKeys.find(ir=>ir.columnNames.indexOf(I)!==-1);if(rr){const ir=B.clone();ir.foreignKeys=[rr],tr.push(ir),B.removeForeignKey(rr)}for(const ir of this.queryRunner.loadedTables){const lr=ir.foreignKeys.filter(dr=>this.getTablePath(dr)===e&&dr.referencedColumnNames.indexOf(I)!==-1);if(lr.length>0){const dr=ir.clone();dr.foreignKeys=lr,tr.push(dr),lr.forEach(mr=>ir.removeForeignKey(mr))}}if(tr.length>0)for(const ir of tr)this.connection.logger.logSchemaBuild(`dropping related foreign keys of ${ir.name}: ${ir.foreignKeys.map(lr=>lr.name).join(", ")}`),await this.queryRunner.dropForeignKeys(ir,ir.foreignKeys)}async dropColumnCompositeIndices(e,I){const B=this.queryRunner.loadedTables.find(rr=>this.getTablePath(rr)===e);if(!B)return;const tr=B.indices.filter(rr=>rr.columnNames.length>1&&rr.columnNames.indexOf(I)!==-1);tr.length!==0&&(this.connection.logger.logSchemaBuild(`dropping related indices of "${e}"."${I}": ${tr.map(rr=>rr.name).join(", ")}`),await this.queryRunner.dropIndices(B,tr))}async dropColumnCompositeUniques(e,I){const B=this.queryRunner.loadedTables.find(rr=>this.getTablePath(rr)===e);if(!B)return;const tr=B.uniques.filter(rr=>rr.columnNames.length>1&&rr.columnNames.indexOf(I)!==-1);tr.length!==0&&(this.connection.logger.logSchemaBuild(`dropping related unique constraints of "${e}"."${I}": ${tr.map(rr=>rr.name).join(", ")}`),await this.queryRunner.dropUniqueConstraints(B,tr))}metadataColumnsToTableColumnOptions(e){return e.map(I=>TableUtils.createTableColumnOptions(I,this.connection.driver))}async createTypeormMetadataTable(e){const I=this.currentSchema,B=this.currentDatabase,tr=this.connection.driver.buildTableName(this.connection.metadataTableName,I,B),rr=this.connection.driver.options.type==="spanner";await e.createTable(new Table({database:B,schema:I,name:tr,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1,isPrimary:rr},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0,isPrimary:rr},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0,isPrimary:rr},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0,isPrimary:rr},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0,isPrimary:rr},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0,isPrimary:rr}]}),!0)}}class AbstractSqliteDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime","json"],this.supportedUpsertTypes=["on-conflict-do-update"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.cteCapabilities={enabled:!0,requiresRecursiveHint:!0},this.attachedDatabases={},this.connection=e,this.options=e.options,this.database=DriverUtils.buildDriverOptions(this.options).database}async connect(){this.databaseConnection=await this.createDatabaseConnection()}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise((e,I)=>{this.queryRunner=void 0,this.databaseConnection.close(B=>B?I(B):e())})}hasAttachedDatabases(){return!!Object.keys(this.attachedDatabases).length}getAttachedDatabaseHandleByRelativePath(e){return this.attachedDatabases?.[e]?.attachHandle}getAttachedDatabasePathRelativeByHandle(e){return Object.values(this.attachedDatabases).find(({attachHandle:I})=>e===I)?.attachFilepathRelative}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null?e:I.type===Boolean||I.type==="boolean"?e===!0?1:0:I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="time"?DateUtils.mixedDateToTimeString(e):I.type==="datetime"||I.type===Date?DateUtils.mixedDateToUtcDatetimeString(e):I.type==="json"||I.type==="simple-json"?DateUtils.simpleJsonToString(e):I.type==="simple-array"?DateUtils.simpleArrayToString(e):I.type==="simple-enum"?DateUtils.simpleEnumToString(e):e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:(I.type===Boolean||I.type==="boolean"?e=!!e:I.type==="datetime"||I.type===Date?(e&&typeof e=="string"&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=DateUtils.normalizeHydratedDate(e)):I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="time"?e=DateUtils.mixedTimeToString(e):I.type==="json"||I.type==="simple-json"?e=DateUtils.stringToSimpleJson(e):I.type==="simple-array"?e=DateUtils.stringToSimpleArray(e):I.type==="simple-enum"?e=DateUtils.stringToSimpleEnum(e,I):I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}escapeQueryWithParameters(e,I,B){const tr=Object.keys(B).map(rr=>typeof B[rr]=="boolean"?B[rr]===!0?1:0:B[rr]instanceof Date?DateUtils.mixedDateToUtcDatetimeString(B[rr]):B[rr]);return!I||!Object.keys(I).length?[e,tr]:(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(rr,ir,lr)=>{if(!I.hasOwnProperty(lr))return rr;let dr=I[lr];return ir?dr.map(mr=>(tr.push(mr),this.createParameter(lr,tr.length-1))).join(", "):typeof dr=="function"?dr():typeof dr=="number"?String(dr):typeof dr=="boolean"?(tr.push(+dr),this.createParameter(lr,tr.length-1)):dr instanceof Date?(tr.push(DateUtils.mixedDateToUtcDatetimeString(dr)),this.createParameter(lr,tr.length-1)):(tr.push(dr),this.createParameter(lr,tr.length-1))}),[e,tr])}escape(e){return'"'+e+'"'}buildTableName(e,I,B){return e}parseTableName(e){const I=this.database,B=void 0;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const rr=this.parseTableName(e.schema?`"${e.schema}"."${e.name}"`:e.name);return{database:e.database||rr.database||I,schema:e.schema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isTableForeignKey(e)){const rr=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||rr.database||I,schema:e.referencedSchema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||B,tableName:e.tableName};const tr=e.split(".");return tr.length===3?{database:tr[0]||I,schema:tr[1]||B,tableName:tr[2]}:tr.length===2?{database:this.getAttachedDatabasePathRelativeByHandle(tr[0])??I,schema:tr[0],tableName:tr[1]}:{database:I,schema:B,tableName:e}}normalizeType(e){return e.type===Number||e.type==="int"?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":e.type==="uuid"?"varchar":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"varchar":e.type||""}normalizeDefault(e){const I=e.default;if(typeof I=="number")return""+I;if(typeof I=="boolean")return I?"1":"0";if(typeof I=="function")return I();if(typeof I=="string")return`'${I}'`;if(I!=null)return`${I}`}normalizeIsUnique(e){return e.entityMetadata.uniques.some(I=>I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let I=e.type;return e.enum?"varchar":(e.length?I+="("+e.length+")":e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+="("+e.precision+","+e.scale+")":e.precision!==null&&e.precision!==void 0&&(I+="("+e.precision+")"),e.isArray&&(I+=" array"),I)}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,I,B,tr){const rr=e.generatedColumns.reduce((ir,lr)=>{let dr;return lr.generationStrategy==="increment"&&I&&(dr=I-tr+B+1),dr?OrmUtils.mergeDeep(ir,lr.createValueMap(dr)):ir},{});return Object.keys(rr).length>0?rr:void 0}findChangedColumns(e,I){return I.filter(B=>{const tr=e.find(ir=>ir.name===B.databaseName);return tr?tr.name!==B.databaseName||tr.type!==this.normalizeType(B)||tr.length!==B.length||tr.precision!==B.precision||tr.scale!==B.scale||this.normalizeDefault(B)!==tr.default||tr.isPrimary!==B.isPrimary||tr.isNullable!==B.isNullable||tr.generatedType!==B.generatedType||tr.asExpression!==B.asExpression||tr.isUnique!==this.normalizeIsUnique(B)||tr.enum&&B.enum&&!OrmUtils.isArraysEqual(tr.enum,B.enum.map(ir=>ir+""))||B.generationStrategy!=="uuid"&&tr.isGenerated!==B.isGenerated:!1})}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,I){return"?"}createDatabaseConnection(){throw new TypeORMError("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")}loadDependencies(){}}class Query{constructor(e,I){this.query=e,this.parameters=I,this["@instanceof"]=Symbol.for("Query")}}class SqlInMemory{constructor(){this.upQueries=[],this.downQueries=[]}}class BaseQueryRunner{constructor(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new SqlInMemory,this.transactionDepth=0,this.cachedTablePaths={}}async beforeMigration(){}async afterMigration(){}async getTable(e){return this.loadedTables=await this.loadTables([e]),this.loadedTables.length>0?this.loadedTables[0]:void 0}async getTables(e){return e?(this.loadedTables=await this.loadTables(e),this.loadedTables):await this.loadTables(e)}async getView(e){return this.loadedViews=await this.loadViews([e]),this.loadedViews.length>0?this.loadedViews[0]:void 0}async getViews(e){return this.loadedViews=await this.loadViews(e),this.loadedViews}enableSqlMemory(){this.sqlInMemory=new SqlInMemory,this.sqlMemoryMode=!0}disableSqlMemory(){this.sqlInMemory=new SqlInMemory,this.sqlMemoryMode=!1}clearSqlMemory(){this.sqlInMemory=new SqlInMemory}getMemorySql(){return this.sqlInMemory}async executeMemoryUpSql(){for(const{query:e,parameters:I}of this.sqlInMemory.upQueries)await this.query(e,I)}async executeMemoryDownSql(){for(const{query:e,parameters:I}of this.sqlInMemory.downQueries.reverse())await this.query(e,I)}getReplicationMode(){return this.mode}async getCachedView(e){const I=this.loadedViews.find(tr=>tr.name===e);if(I)return I;const B=await this.loadViews([e]);if(B.length>0)return this.loadedViews.push(B[0]),B[0];throw new TypeORMError(`View "${e}" does not exist.`)}async getCachedTable(e){if(e in this.cachedTablePaths){const B=this.cachedTablePaths[e],tr=this.loadedTables.find(rr=>this.getTablePath(rr)===B);if(tr)return tr}const I=await this.loadTables([e]);if(I.length>0){const B=this.getTablePath(I[0]),tr=this.loadedTables.find(rr=>this.getTablePath(rr)===B);return tr||(this.cachedTablePaths[e]=this.getTablePath(I[0]),this.loadedTables.push(I[0]),I[0])}else throw new TypeORMError(`Table "${e}" does not exist.`)}replaceCachedTable(e,I){const B=this.getTablePath(e),tr=this.loadedTables.find(rr=>this.getTablePath(rr)===B);for(const[rr,ir]of Object.entries(this.cachedTablePaths))ir===B&&(this.cachedTablePaths[rr]=this.getTablePath(I));tr&&(tr.database=I.database,tr.schema=I.schema,tr.name=I.name,tr.columns=I.columns,tr.indices=I.indices,tr.foreignKeys=I.foreignKeys,tr.uniques=I.uniques,tr.checks=I.checks,tr.justCreated=I.justCreated,tr.engine=I.engine,tr.comment=I.comment)}getTablePath(e){const I=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(I.tableName,I.schema,I.database)}getTypeormMetadataTableName(){const e=this.connection.driver.options;return this.connection.driver.buildTableName(this.connection.metadataTableName,e.schema,e.database)}selectTypeormMetadataSql({database:e,schema:I,table:B,type:tr,name:rr}){const ir=this.connection.createQueryBuilder(),lr=ir.select().from(this.getTypeormMetadataTableName(),"t").where(`${ir.escape("type")} = :type`,{type:tr}).andWhere(`${ir.escape("name")} = :name`,{name:rr});e&&lr.andWhere(`${ir.escape("database")} = :database`,{database:e}),I&&lr.andWhere(`${ir.escape("schema")} = :schema`,{schema:I}),B&&lr.andWhere(`${ir.escape("table")} = :table`,{table:B});const[dr,mr]=lr.getQueryAndParameters();return new Query(dr,mr)}insertTypeormMetadataSql({database:e,schema:I,table:B,type:tr,name:rr,value:ir}){const[lr,dr]=this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({database:e,schema:I,table:B,type:tr,name:rr,value:ir}).getQueryAndParameters();return new Query(lr,dr)}deleteTypeormMetadataSql({database:e,schema:I,table:B,type:tr,name:rr}){const ir=this.connection.createQueryBuilder(),lr=ir.delete().from(this.getTypeormMetadataTableName()).where(`${ir.escape("type")} = :type`,{type:tr}).andWhere(`${ir.escape("name")} = :name`,{name:rr});e&&lr.andWhere(`${ir.escape("database")} = :database`,{database:e}),I&&lr.andWhere(`${ir.escape("schema")} = :schema`,{schema:I}),B&&lr.andWhere(`${ir.escape("table")} = :table`,{table:B});const[dr,mr]=lr.getQueryAndParameters();return new Query(dr,mr)}isColumnChanged(e,I,B,tr,rr=!0){return e.charset!==I.charset||e.collation!==I.collation||e.precision!==I.precision||e.scale!==I.scale||e.width!==I.width||e.zerofill!==I.zerofill||e.unsigned!==I.unsigned||e.asExpression!==I.asExpression||B&&e.default!==I.default||e.onUpdate!==I.onUpdate||e.isNullable!==I.isNullable||tr&&e.comment!==I.comment||rr&&this.isEnumChanged(e,I)}isEnumChanged(e,I){return!OrmUtils.isArraysEqual(e.enum||[],I.enum||[])}isDefaultColumnLength(e,I,B){if(this.connection.hasMetadata(e.name)){const rr=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(rr&&this.connection.driver.getColumnLength(rr))return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].length?this.connection.driver.dataTypeDefaults[I.type].length.toString()===B.toString():!1}isDefaultColumnPrecision(e,I,B){if(this.connection.hasMetadata(e.name)){const rr=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(rr&&rr.precision!==null&&rr.precision!==void 0)return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].precision!==null&&this.connection.driver.dataTypeDefaults[I.type].precision!==void 0?this.connection.driver.dataTypeDefaults[I.type].precision===B:!1}isDefaultColumnScale(e,I,B){if(this.connection.hasMetadata(e.name)){const rr=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(rr&&rr.scale!==null&&rr.scale!==void 0)return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].scale!==null&&this.connection.driver.dataTypeDefaults[I.type].scale!==void 0?this.connection.driver.dataTypeDefaults[I.type].scale===B:!1}async executeQueries(e,I){if(InstanceChecker.isQuery(e)&&(e=[e]),InstanceChecker.isQuery(I)&&(I=[I]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...I),this.sqlMemoryMode===!0)return Promise.resolve();for(const{query:B,parameters:tr}of e)await this.query(B,tr)}generateIndexName(e,I){return this.connection.namingStrategy.indexName(e,I.columnNames,I.where)}}var MetadataTableType;(function(k){k.VIEW="VIEW",k.MATERIALIZED_VIEW="MATERIALIZED_VIEW",k.GENERATED_COLUMN="GENERATED_COLUMN"})(MetadataTableType||(MetadataTableType={}));class AbstractSqliteQueryRunner extends BaseQueryRunner{constructor(){super(),this.transactionPromise=null}connect(){return Promise.resolve(this.driver.databaseConnection)}release(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()}async startTransaction(e){if(this.driver.transactionSupport==="none")throw new TypeORMError(`Transactions aren't supported by ${this.connection.driver.options.type}.`);if(this.isTransactionActive&&this.driver.transactionSupport==="simple")throw new TransactionAlreadyStartedError;if(e&&e!=="READ UNCOMMITTED"&&e!=="SERIALIZABLE")throw new TypeORMError("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,e&&(e==="READ UNCOMMITTED"?await this.query("PRAGMA read_uncommitted = true"):await this.query("PRAGMA read_uncommitted = false")),await this.query("BEGIN TRANSACTION")):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth-1}`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("COMMIT"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("ROLLBACK"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}stream(e,I,B,tr){throw new TypeORMError("Stream is not supported by sqlite driver.")}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return Promise.resolve(!1)}async getCurrentDatabase(){return Promise.resolve(void 0)}async hasSchema(e){throw new TypeORMError("This driver does not support table schemas")}async getCurrentSchema(){return Promise.resolve(void 0)}async hasTable(e){const B=`SELECT * FROM "sqlite_master" WHERE "type" = 'table' AND "name" = '${InstanceChecker.isTable(e)?e.name:e}'`;return!!(await this.query(B)).length}async hasColumn(e,I){const B=InstanceChecker.isTable(e)?e.name:e,tr=`PRAGMA table_xinfo(${this.escapePath(B)})`;return!!(await this.query(tr)).find(ir=>ir.name===I)}async createDatabase(e,I){return Promise.resolve()}async dropDatabase(e,I){return Promise.resolve()}async createSchema(e,I){return Promise.resolve()}async dropSchema(e,I){return Promise.resolve()}async createTable(e,I=!1,B=!0,tr=!0){const rr=[],ir=[];if(I&&await this.hasTable(e))return Promise.resolve();rr.push(this.createTableSql(e,B)),ir.push(this.dropTableSql(e)),tr&&e.indices.forEach(dr=>{dr.name||(dr.name=this.connection.namingStrategy.indexName(e,dr.columnNames,dr.where)),rr.push(this.createIndexSql(e,dr)),ir.push(this.dropIndexSql(dr))});const lr=e.columns.filter(dr=>dr.generatedType&&dr.asExpression);for(const dr of lr){const mr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name,value:dr.asExpression}),hr=this.deleteTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name});rr.push(mr),ir.push(hr)}await this.executeQueries(rr,ir)}async dropTable(e,I,B=!0,tr=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const rr=B,ir=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),lr=[],dr=[];tr&&ir.indices.forEach(hr=>{lr.push(this.dropIndexSql(hr)),dr.push(this.createIndexSql(ir,hr))}),lr.push(this.dropTableSql(ir,I)),dr.push(this.createTableSql(ir,rr));const mr=ir.columns.filter(hr=>hr.generatedType&&hr.asExpression);for(const hr of mr){const fr=this.deleteTypeormMetadataSql({table:ir.name,type:MetadataTableType.GENERATED_COLUMN,name:hr.name}),_r=this.insertTypeormMetadataSql({table:ir.name,type:MetadataTableType.GENERATED_COLUMN,name:hr.name,value:hr.asExpression});lr.push(fr),dr.push(_r)}await this.executeQueries(lr,dr)}async createView(e,I=!1){const B=[],tr=[];B.push(this.createViewSql(e)),I&&B.push(this.insertViewDefinitionSql(e)),tr.push(this.dropViewSql(e)),I&&tr.push(this.deleteViewDefinitionSql(e)),await this.executeQueries(B,tr)}async dropView(e){const I=InstanceChecker.isView(e)?e.name:e,B=await this.getCachedView(I),tr=[],rr=[];tr.push(this.deleteViewDefinitionSql(B)),tr.push(this.dropViewSql(B)),rr.push(this.insertViewDefinitionSql(B)),rr.push(this.createViewSql(B)),await this.executeQueries(tr,rr)}async renameTable(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();tr.name=I;const rr=new Query(`ALTER TABLE ${this.escapePath(B.name)} RENAME TO ${this.escapePath(I)}`),ir=new Query(`ALTER TABLE ${this.escapePath(I)} RENAME TO ${this.escapePath(B.name)}`);await this.executeQueries(rr,ir),tr.uniques.forEach(lr=>{const dr=this.connection.namingStrategy.uniqueConstraintName(B,lr.columnNames);lr.name===dr&&(lr.name=this.connection.namingStrategy.uniqueConstraintName(tr,lr.columnNames))}),tr.foreignKeys.forEach(lr=>{const dr=this.connection.namingStrategy.foreignKeyName(B,lr.columnNames,this.getTablePath(lr),lr.referencedColumnNames);lr.name===dr&&(lr.name=this.connection.namingStrategy.foreignKeyName(tr,lr.columnNames,this.getTablePath(lr),lr.referencedColumnNames))}),tr.indices.forEach(lr=>{const dr=this.connection.namingStrategy.indexName(B,lr.columnNames,lr.where);lr.name===dr&&(lr.name=this.connection.namingStrategy.indexName(tr,lr.columnNames,lr.where))}),B.name=tr.name,await this.recreateTable(tr,B)}async addColumn(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);return this.addColumns(B,[I])}async addColumns(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>tr.addColumn(rr)),await this.recreateTable(tr,B)}async renameColumn(e,I,B){const tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),rr=InstanceChecker.isTableColumn(I)?I:tr.columns.find(lr=>lr.name===I);if(!rr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);let ir;return InstanceChecker.isTableColumn(B)?ir=B:(ir=rr.clone(),ir.name=B),this.changeColumn(tr,rr,ir)}async changeColumn(e,I,B){const tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),rr=InstanceChecker.isTableColumn(I)?I:tr.columns.find(ir=>ir.name===I);if(!rr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);await this.changeColumns(tr,[{oldColumn:rr,newColumn:B}])}async changeColumns(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>{rr.newColumn.name!==rr.oldColumn.name&&(tr.findColumnUniques(rr.oldColumn).forEach(lr=>{const dr=this.connection.namingStrategy.uniqueConstraintName(B,lr.columnNames);lr.columnNames.splice(lr.columnNames.indexOf(rr.oldColumn.name),1),lr.columnNames.push(rr.newColumn.name),lr.name===dr&&(lr.name=this.connection.namingStrategy.uniqueConstraintName(tr,lr.columnNames))}),tr.findColumnForeignKeys(rr.oldColumn).forEach(lr=>{const dr=this.connection.namingStrategy.foreignKeyName(B,lr.columnNames,this.getTablePath(lr),lr.referencedColumnNames);lr.columnNames.splice(lr.columnNames.indexOf(rr.oldColumn.name),1),lr.columnNames.push(rr.newColumn.name),lr.name===dr&&(lr.name=this.connection.namingStrategy.foreignKeyName(tr,lr.columnNames,this.getTablePath(lr),lr.referencedColumnNames))}),tr.findColumnIndices(rr.oldColumn).forEach(lr=>{const dr=this.connection.namingStrategy.indexName(B,lr.columnNames,lr.where);lr.columnNames.splice(lr.columnNames.indexOf(rr.oldColumn.name),1),lr.columnNames.push(rr.newColumn.name),lr.name===dr&&(lr.name=this.connection.namingStrategy.indexName(tr,lr.columnNames,lr.where))}));const ir=tr.columns.find(lr=>lr.name===rr.oldColumn.name);ir&&(tr.columns[tr.columns.indexOf(ir)]=rr.newColumn)}),await this.recreateTable(tr,B)}async dropColumn(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableColumn(I)?I:B.findColumnByName(I);if(!tr)throw new TypeORMError(`Column "${I}" was not found in table "${B.name}"`);await this.dropColumns(B,[tr])}async dropColumns(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>{const ir=InstanceChecker.isTableColumn(rr)?rr:B.findColumnByName(rr);if(!ir)throw new Error(`Column "${rr}" was not found in table "${B.name}"`);tr.removeColumn(ir),tr.findColumnUniques(ir).forEach(lr=>tr.removeUniqueConstraint(lr)),tr.findColumnIndices(ir).forEach(lr=>tr.removeIndex(lr)),tr.findColumnForeignKeys(ir).forEach(lr=>tr.removeForeignKey(lr))}),await this.recreateTable(tr,B)}async createPrimaryKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();tr.columns.forEach(rr=>{I.find(ir=>ir===rr.name)&&(rr.isPrimary=!0)}),await this.recreateTable(tr,B),B.columns.forEach(rr=>{I.find(ir=>ir===rr.name)&&(rr.isPrimary=!0)})}async updatePrimaryKeys(e,I){await Promise.resolve()}async dropPrimaryKey(e){const I=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),B=I.clone();B.primaryColumns.forEach(tr=>{tr.isPrimary=!1}),await this.recreateTable(B,I),I.primaryColumns.forEach(tr=>{tr.isPrimary=!1})}async createUniqueConstraint(e,I){await this.createUniqueConstraints(e,[I])}async createUniqueConstraints(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>tr.addUniqueConstraint(rr)),await this.recreateTable(tr,B)}async dropUniqueConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableUnique(I)?I:B.uniques.find(rr=>rr.name===I);if(!tr)throw new TypeORMError(`Supplied unique constraint was not found in table ${B.name}`);await this.dropUniqueConstraints(B,[tr])}async dropUniqueConstraints(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>tr.removeUniqueConstraint(rr)),await this.recreateTable(tr,B)}async createCheckConstraint(e,I){await this.createCheckConstraints(e,[I])}async createCheckConstraints(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>tr.addCheckConstraint(rr)),await this.recreateTable(tr,B)}async dropCheckConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableCheck(I)?I:B.checks.find(rr=>rr.name===I);if(!tr)throw new TypeORMError(`Supplied check constraint was not found in table ${B.name}`);await this.dropCheckConstraints(B,[tr])}async dropCheckConstraints(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>tr.removeCheckConstraint(rr)),await this.recreateTable(tr,B)}async createExclusionConstraint(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async createExclusionConstraints(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async dropExclusionConstraint(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async dropExclusionConstraints(e,I){throw new TypeORMError("Sqlite does not support exclusion constraints.")}async createForeignKey(e,I){await this.createForeignKeys(e,[I])}async createForeignKeys(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>tr.addForeignKey(rr)),await this.recreateTable(tr,B)}async dropForeignKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableForeignKey(I)?I:B.foreignKeys.find(rr=>rr.name===I);if(!tr)throw new TypeORMError(`Supplied foreign key was not found in table ${B.name}`);await this.dropForeignKeys(e,[tr])}async dropForeignKeys(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone();I.forEach(rr=>tr.removeForeignKey(rr)),await this.recreateTable(tr,B)}async createIndex(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(B,I));const tr=this.createIndexSql(B,I),rr=this.dropIndexSql(I);await this.executeQueries(tr,rr),B.addIndex(I)}async createIndices(e,I){const B=I.map(tr=>this.createIndex(e,tr));await Promise.all(B)}async dropIndex(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableIndex(I)?I:B.indices.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied index ${I} was not found in table ${B.name}`);tr.name||(tr.name=this.generateIndexName(B,tr));const rr=this.dropIndexSql(tr),ir=this.createIndexSql(B,tr);await this.executeQueries(rr,ir),B.removeIndex(tr)}async dropIndices(e,I){const B=I.map(tr=>this.dropIndex(e,tr));await Promise.all(B)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)}`)}async clearDatabase(e){let I;e&&this.driver.getAttachedDatabaseHandleByRelativePath(e)&&(I=this.driver.getAttachedDatabaseHandleByRelativePath(e)),await this.query("PRAGMA foreign_keys = OFF");const B=this.isTransactionActive;B||await this.startTransaction();try{const tr=I?`SELECT 'DROP VIEW "${I}"."' || name || '";' as query FROM "${I}"."sqlite_master" WHERE "type" = 'view'`:`SELECT 'DROP VIEW "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'view'`,rr=await this.query(tr);await Promise.all(rr.map(dr=>this.query(dr.query)));const ir=I?`SELECT 'DROP TABLE "${I}"."' || name || '";' as query FROM "${I}"."sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`:`SELECT 'DROP TABLE "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`,lr=await this.query(ir);await Promise.all(lr.map(dr=>this.query(dr.query))),B||await this.commitTransaction()}catch(tr){try{B||await this.rollbackTransaction()}catch{}throw tr}finally{await this.query("PRAGMA foreign_keys = ON")}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const B=e.map(ir=>"'"+ir+"'").join(", ");let tr=`SELECT "t".* FROM "${this.getTypeormMetadataTableName()}" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = 'view' WHERE "t"."type" = '${MetadataTableType.VIEW}'`;return B.length>0&&(tr+=` AND "t"."name" IN (${B})`),(await this.query(tr)).map(ir=>{const lr=new View;return lr.name=ir.name,lr.expression=ir.value,lr})}async loadTableRecords(e,I){let B;const[tr,rr]=this.splitTablePath(e);return tr&&this.driver.getAttachedDatabasePathRelativeByHandle(tr)&&(B=this.driver.getAttachedDatabasePathRelativeByHandle(tr)),this.query(`SELECT ${B?`'${B}'`:null} as database, ${tr?`'${tr}'`:null} as schema, * FROM ${tr?`"${tr}".`:""}${this.escapePath("sqlite_master")} WHERE "type" = '${I}' AND "${I==="table"?"name":"tbl_name"}" IN ('${rr}')`)}async loadPragmaRecords(e,I){const[,B]=this.splitTablePath(e);return this.query(`PRAGMA ${I}("${B}")`)}async loadTables(e){if(e&&e.length===0)return[];let I=[],B;if(e){const tr=e.filter(lr=>lr.split(".").length===1).map(lr=>`'${lr}'`),rr=e.filter(lr=>lr.split(".").length>1),ir=lr=>{const dr=[...rr.map(mr=>this.loadTableRecords(mr,lr))];return tr.length&&dr.push(this.query(`SELECT * FROM "sqlite_master" WHERE "type" = '${lr}' AND "${lr==="table"?"name":"tbl_name"}" IN (${tr})`)),dr};I=(await Promise.all(ir("table"))).reduce((lr,dr)=>[...lr,...dr],[]).filter(Boolean),B=(await Promise.all(ir("index"))).reduce((lr,dr)=>[...lr,...dr],[]).filter(Boolean)}else{I.push(...await this.query(`SELECT * FROM "sqlite_master" WHERE "type" = 'table'`));const rr=I.map(({name:ir})=>`'${ir}'`).join(", ");B=await this.query(`SELECT * FROM "sqlite_master" WHERE "type" = 'index' AND "tbl_name" IN (${rr})`)}return I.length===0?[]:Promise.all(I.map(async tr=>{const rr=tr.database&&this.driver.getAttachedDatabaseHandleByRelativePath(tr.database)?`${this.driver.getAttachedDatabaseHandleByRelativePath(tr.database)}.${tr.name}`:tr.name,ir=tr.sql,lr=ir.includes("WITHOUT ROWID"),dr=new Table({name:rr,withoutRowid:lr}),[mr,hr,fr]=await Promise.all([this.loadPragmaRecords(rr,"table_xinfo"),this.loadPragmaRecords(rr,"index_list"),this.loadPragmaRecords(rr,"foreign_key_list")]);let _r;const gr=tr.sql;let Sr=gr.toUpperCase().indexOf("AUTOINCREMENT");if(Sr!==-1){_r=gr.substr(0,Sr);const Ur=_r.lastIndexOf(","),Lr=_r.lastIndexOf("(");Ur!==-1?(_r=_r.substr(Ur),_r=_r.substr(0,_r.lastIndexOf('"')),_r=_r.substr(_r.indexOf('"')+1)):Lr!==-1&&(_r=_r.substr(Lr),_r=_r.substr(0,_r.lastIndexOf('"')),_r=_r.substr(_r.indexOf('"')+1))}dr.columns=await Promise.all(mr.map(async Ur=>{const Lr=new TableColumn;if(Lr.name=Ur.name,Lr.type=Ur.type.toLowerCase(),Lr.default=Ur.dflt_value!==null&&Ur.dflt_value!==void 0?Ur.dflt_value:void 0,Lr.isNullable=Ur.notnull===0,Lr.isPrimary=Ur.pk>0,Lr.comment="",Lr.isGenerated=_r===Ur.name,Lr.isGenerated&&(Lr.generationStrategy="increment"),Ur.hidden===2||Ur.hidden===3){Lr.generatedType=Ur.hidden===2?"VIRTUAL":"STORED";const rs=this.selectTypeormMetadataSql({table:dr.name,type:MetadataTableType.GENERATED_COLUMN,name:Lr.name}),ss=await this.query(rs.query,rs.parameters);ss[0]&&ss[0].value?Lr.asExpression=ss[0].value:Lr.asExpression=""}Lr.type==="varchar"&&(Lr.enum=OrmUtils.parseSqlCheckExpression(ir,Lr.name));let ts=Lr.type.indexOf("(");if(ts!==-1){const rs=Lr.type;let ss=rs.substr(0,ts);if(this.driver.withLengthColumnTypes.find(ls=>ls===ss)){let ls=parseInt(rs.substring(ts+1,rs.length-1));ls&&(Lr.length=ls.toString(),Lr.type=ss)}if(this.driver.withPrecisionColumnTypes.find(ls=>ls===ss)){const ls=new RegExp(`^${ss}\\((\\d+),?\\s?(\\d+)?\\)`),os=rs.match(ls);os&&os[1]&&(Lr.precision=+os[1]),this.driver.withScaleColumnTypes.find(us=>us===ss)&&os&&os[2]&&(Lr.scale=+os[2]),Lr.type=ss}}return Lr}));let Ar;const Or=[],Fr=/CONSTRAINT "([^"]*)" FOREIGN KEY ?\((.*?)\) REFERENCES "([^"]*)"/g;for(;(Ar=Fr.exec(ir))!==null;)Or.push({name:Ar[1],columns:Ar[2].substr(1,Ar[2].length-2).split('", "'),referencedTableName:Ar[3]});const vr=OrmUtils.uniq(fr,Ur=>Ur.id);dr.foreignKeys=vr.map(Ur=>{const Lr=fr.filter(ls=>ls.id===Ur.id&&ls.table===Ur.table),ts=Lr.map(ls=>ls.from),rs=Lr.map(ls=>ls.to),ss=Or.find(ls=>ls.referencedTableName===Ur.table&&ls.columns.every(os=>ts.indexOf(os)!==-1));return new TableForeignKey({name:ss?.name,columnNames:ts,referencedTableName:Ur.table,referencedColumnNames:rs,onDelete:Ur.on_delete,onUpdate:Ur.on_update})});let xr;const kr=[],Gr=/CONSTRAINT "([^"]*)" UNIQUE ?\((.*?)\)/g;for(;(xr=Gr.exec(ir))!==null;)kr.push({name:xr[1],columns:xr[2].substr(1,xr[2].length-2).split('", "')});const is=hr.filter(Ur=>Ur.origin==="u").map(Ur=>Ur.name).filter((Ur,Lr,ts)=>ts.indexOf(Ur)===Lr).map(async Ur=>{const Lr=hr.find(ls=>ls.name===Ur),rs=(await this.query(`PRAGMA index_info("${Lr.name}")`)).sort((ls,os)=>parseInt(ls.seqno)-parseInt(os.seqno)).map(ls=>ls.name);if(rs.length===1){const ls=dr.columns.find(os=>!!rs.find(us=>us===os.name));ls&&(ls.isUnique=!0)}const ss=kr.find(ls=>ls.columns.every(os=>rs.indexOf(os)!==-1));return new TableUnique({name:ss?ss.name:this.connection.namingStrategy.uniqueConstraintName(dr,rs),columnNames:rs})});dr.uniques=await Promise.all(is);let as;const cs=/CONSTRAINT "([^"]*)" CHECK ?(\(.*?\))([,]|[)]$)/g;for(;(as=cs.exec(ir))!==null;)dr.checks.push(new TableCheck({name:as[1],expression:as[2]}));const es=hr.filter(Ur=>Ur.origin==="c").map(Ur=>Ur.name).filter((Ur,Lr,ts)=>ts.indexOf(Ur)===Lr).map(async Ur=>{const Lr=B.find(ys=>ys.name===Ur),ts=/WHERE (.*)/.exec(Lr.sql),rs=hr.find(ys=>ys.name===Ur),ls=(await this.query(`PRAGMA index_info("${rs.name}")`)).sort((ys,bs)=>parseInt(ys.seqno)-parseInt(bs.seqno)).map(ys=>ys.name),os=`${tr.database?`${tr.database}.`:""}${rs.name}`,us=rs.unique==="1"||rs.unique===1;return new TableIndex({table:dr,name:os,columnNames:ls,isUnique:us,where:ts?ts[1]:void 0})}),ps=await Promise.all(es);return dr.indices=ps.filter(Ur=>!!Ur),dr}))}createTableSql(e,I,B){const tr=e.columns.filter(gr=>gr.isPrimary),rr=tr.find(gr=>gr.isGenerated&&gr.generationStrategy==="increment"),ir=tr.length>1;if(ir&&rr)throw new TypeORMError("Sqlite does not support AUTOINCREMENT on composite primary key");const lr=e.columns.map(gr=>this.buildCreateColumnSql(gr,ir)).join(", "),[dr]=this.splitTablePath(e.name);let mr=`CREATE TABLE ${this.escapePath(e.name)} (${lr}`,[hr,fr]=this.splitTablePath(e.name);const _r=B?`${hr?`${hr}.`:""}${fr.replace(/^temporary_/,"")}`:e.name;if(e.columns.filter(gr=>gr.isUnique).forEach(gr=>{e.uniques.some(Ar=>Ar.columnNames.length===1&&Ar.columnNames[0]===gr.name)||e.uniques.push(new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(e,[gr.name]),columnNames:[gr.name]}))}),e.uniques.length>0){const gr=e.uniques.map(Sr=>{const Ar=Sr.name?Sr.name:this.connection.namingStrategy.uniqueConstraintName(_r,Sr.columnNames),Or=Sr.columnNames.map(Fr=>`"${Fr}"`).join(", ");return`CONSTRAINT "${Ar}" UNIQUE (${Or})`}).join(", ");mr+=`, ${gr}`}if(e.checks.length>0){const gr=e.checks.map(Sr=>`CONSTRAINT "${Sr.name?Sr.name:this.connection.namingStrategy.checkConstraintName(_r,Sr.expression)}" CHECK (${Sr.expression})`).join(", ");mr+=`, ${gr}`}if(e.foreignKeys.length>0&&I){const gr=e.foreignKeys.filter(Sr=>{const[Ar]=this.splitTablePath(Sr.referencedTableName);return Ar===dr}).map(Sr=>{const[,Ar]=this.splitTablePath(Sr.referencedTableName),Or=Sr.columnNames.map(xr=>`"${xr}"`).join(", ");Sr.name||(Sr.name=this.connection.namingStrategy.foreignKeyName(_r,Sr.columnNames,this.getTablePath(Sr),Sr.referencedColumnNames));const Fr=Sr.referencedColumnNames.map(xr=>`"${xr}"`).join(", ");let vr=`CONSTRAINT "${Sr.name}" FOREIGN KEY (${Or}) REFERENCES "${Ar}" (${Fr})`;return Sr.onDelete&&(vr+=` ON DELETE ${Sr.onDelete}`),Sr.onUpdate&&(vr+=` ON UPDATE ${Sr.onUpdate}`),Sr.deferrable&&(vr+=` DEFERRABLE ${Sr.deferrable}`),vr}).join(", ");mr+=`, ${gr}`}if(tr.length>1){const gr=tr.map(Sr=>`"${Sr.name}"`).join(", ");mr+=`, PRIMARY KEY (${gr})`}return mr+=")",e.withoutRowid&&(mr+=" WITHOUT ROWID"),new Query(mr)}dropTableSql(e,I){const B=InstanceChecker.isTable(e)?e.name:e,tr=I?`DROP TABLE IF EXISTS ${this.escapePath(B)}`:`DROP TABLE ${this.escapePath(B)}`;return new Query(tr)}createViewSql(e){return typeof e.expression=="string"?new Query(`CREATE VIEW "${e.name}" AS ${e.expression}`):new Query(`CREATE VIEW "${e.name}" AS ${e.expression(this.connection).getQuery()}`)}insertViewDefinitionSql(e){const I=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:MetadataTableType.VIEW,name:e.name,value:I})}dropViewSql(e){const I=InstanceChecker.isView(e)?e.name:e;return new Query(`DROP VIEW "${I}"`)}deleteViewDefinitionSql(e){const I=InstanceChecker.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:MetadataTableType.VIEW,name:I})}createIndexSql(e,I){const B=I.columnNames.map(ir=>`"${ir}"`).join(", "),[tr,rr]=this.splitTablePath(e.name);return new Query(`CREATE ${I.isUnique?"UNIQUE ":""}INDEX ${tr?`"${tr}".`:""}${this.escapePath(I.name)} ON "${rr}" (${B}) ${I.where?"WHERE "+I.where:""}`)}dropIndexSql(e){let I=InstanceChecker.isTableIndex(e)?e.name:e;return new Query(`DROP INDEX ${this.escapePath(I)}`)}buildCreateColumnSql(e,I){let B='"'+e.name+'"';return InstanceChecker.isColumnMetadata(e)?B+=" "+this.driver.normalizeType(e):B+=" "+this.connection.driver.createFullType(e),e.enum&&(B+=' CHECK( "'+e.name+'" IN ('+e.enum.map(tr=>"'"+tr+"'").join(",")+") )"),e.isPrimary&&!I&&(B+=" PRIMARY KEY"),e.isGenerated===!0&&e.generationStrategy==="increment"&&(B+=" AUTOINCREMENT"),e.collation&&(B+=" COLLATE "+e.collation),e.isNullable!==!0&&(B+=" NOT NULL"),e.asExpression?B+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`:e.default!==void 0&&e.default!==null&&(B+=" DEFAULT ("+e.default+")"),B}async recreateTable(e,I,B=!0){const tr=[],rr=[];I.indices.forEach(mr=>{tr.push(this.dropIndexSql(mr)),rr.push(this.createIndexSql(I,mr))});let[ir,lr]=this.splitTablePath(e.name),[,dr]=this.splitTablePath(I.name);if(e.name=lr=`${ir?`${ir}.`:""}temporary_${lr}`,tr.push(this.createTableSql(e,!0,!0)),rr.push(this.dropTableSql(e)),B){let mr=e.columns.filter(fr=>!fr.generatedType).map(fr=>`"${fr.name}"`),hr=I.columns.filter(fr=>!fr.generatedType).map(fr=>`"${fr.name}"`);hr.length<mr.length?mr=e.columns.filter(fr=>{const _r=I.columns.find(gr=>gr.name===fr.name);return _r&&_r.generatedType?!1:!fr.generatedType&&_r}).map(fr=>`"${fr.name}"`):hr.length>mr.length&&(hr=I.columns.filter(fr=>!fr.generatedType&&e.columns.find(_r=>_r.name===fr.name)).map(fr=>`"${fr.name}"`)),tr.push(new Query(`INSERT INTO ${this.escapePath(e.name)}(${mr.join(", ")}) SELECT ${hr.join(", ")} FROM ${this.escapePath(I.name)}`)),rr.push(new Query(`INSERT INTO ${this.escapePath(I.name)}(${hr.join(", ")}) SELECT ${mr.join(", ")} FROM ${this.escapePath(e.name)}`))}tr.push(this.dropTableSql(I)),rr.push(this.createTableSql(I,!0)),tr.push(new Query(`ALTER TABLE ${this.escapePath(e.name)} RENAME TO ${this.escapePath(dr)}`)),rr.push(new Query(`ALTER TABLE ${this.escapePath(I.name)} RENAME TO ${this.escapePath(lr)}`)),e.name=I.name,e.indices.forEach(mr=>{mr.name||(mr.name=this.connection.namingStrategy.indexName(e,mr.columnNames,mr.where)),tr.push(this.createIndexSql(e,mr)),rr.push(this.dropIndexSql(mr))}),I.columns.filter(mr=>{const hr=e.columns.find(fr=>fr.name===mr.name);return mr.generatedType&&mr.asExpression&&(!hr||!hr.generatedType&&!hr.asExpression)}).forEach(mr=>{const hr=this.deleteTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:mr.name}),fr=this.insertTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:mr.name,value:mr.asExpression});tr.push(hr),rr.push(fr)}),e.columns.filter(mr=>mr.generatedType&&mr.asExpression&&!I.columns.some(hr=>hr.name===mr.name)).forEach(mr=>{const hr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:mr.name,value:mr.asExpression}),fr=this.deleteTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:mr.name});tr.push(hr),rr.push(fr)}),e.columns.filter(mr=>mr.generatedType&&mr.asExpression).forEach(mr=>{const hr=I.columns.find(Ar=>Ar.name===mr.name&&Ar.generatedType&&mr.generatedType&&Ar.asExpression!==mr.asExpression);if(!hr)return;const fr=this.deleteTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:hr.name}),_r=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:mr.name,value:mr.asExpression});tr.push(fr),tr.push(_r);const gr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:hr.name,value:hr.asExpression}),Sr=this.deleteTypeormMetadataSql({table:I.name,type:MetadataTableType.GENERATED_COLUMN,name:mr.name});rr.push(gr),rr.push(Sr)}),await this.executeQueries(tr,rr),this.replaceCachedTable(I,e)}splitTablePath(e){return e.indexOf(".")!==-1?e.split("."):[void 0,e]}escapePath(e,I){return(InstanceChecker.isTable(e)||InstanceChecker.isView(e)?e.name:e).replace(/^\.+|\.+$/g,"").split(".").map(tr=>I?tr:`"${tr}"`).join(".")}changeTableComment(e,I){throw new TypeORMError("sqlit driver does not support change comment.")}}class Broadcaster{constructor(e){this.queryRunner=e}async broadcast(e,...I){const B=new BroadcasterResult,tr=this[`broadcast${e}Event`];typeof tr=="function"&&tr.call(this,B,...I),await B.wait()}broadcastBeforeInsertEvent(e,I,B){B&&I.beforeInsertListeners.length&&I.beforeInsertListeners.forEach(tr=>{if(tr.isAllowed(B)){const rr=tr.execute(B);rr instanceof Promise&&e.promises.push(rr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(this.isAllowedSubscriber(tr,I.target)&&tr.beforeInsert){const rr=tr.beforeInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastBeforeUpdateEvent(e,I,B,tr,rr,ir){B&&I.beforeUpdateListeners.length&&I.beforeUpdateListeners.forEach(lr=>{if(lr.isAllowed(B)){const dr=lr.execute(B);dr instanceof Promise&&e.promises.push(dr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(lr=>{if(this.isAllowedSubscriber(lr,I.target)&&lr.beforeUpdate){const dr=lr.beforeUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,updatedColumns:rr||[],updatedRelations:ir||[]});dr instanceof Promise&&e.promises.push(dr),e.count++}})}broadcastBeforeRemoveEvent(e,I,B,tr,rr){B&&I.beforeRemoveListeners.length&&I.beforeRemoveListeners.forEach(ir=>{if(ir.isAllowed(B)){const lr=ir.execute(B);lr instanceof Promise&&e.promises.push(lr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ir=>{if(this.isAllowedSubscriber(ir,I.target)&&ir.beforeRemove){const lr=ir.beforeRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,entityId:I.getEntityIdMixedMap(tr??rr)});lr instanceof Promise&&e.promises.push(lr),e.count++}})}broadcastBeforeSoftRemoveEvent(e,I,B,tr,rr){B&&I.beforeSoftRemoveListeners.length&&I.beforeSoftRemoveListeners.forEach(ir=>{if(ir.isAllowed(B)){const lr=ir.execute(B);lr instanceof Promise&&e.promises.push(lr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ir=>{if(this.isAllowedSubscriber(ir,I.target)&&ir.beforeSoftRemove){const lr=ir.beforeSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,entityId:I.getEntityIdMixedMap(tr??rr)});lr instanceof Promise&&e.promises.push(lr),e.count++}})}broadcastBeforeRecoverEvent(e,I,B,tr,rr){B&&I.beforeRecoverListeners.length&&I.beforeRecoverListeners.forEach(ir=>{if(ir.isAllowed(B)){const lr=ir.execute(B);lr instanceof Promise&&e.promises.push(lr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ir=>{if(this.isAllowedSubscriber(ir,I.target)&&ir.beforeRecover){const lr=ir.beforeRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,entityId:I.getEntityIdMixedMap(tr??rr)});lr instanceof Promise&&e.promises.push(lr),e.count++}})}broadcastAfterInsertEvent(e,I,B,tr){B&&I.afterInsertListeners.length&&I.afterInsertListeners.forEach(rr=>{if(rr.isAllowed(B)){const ir=rr.execute(B);ir instanceof Promise&&e.promises.push(ir),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(rr=>{if(this.isAllowedSubscriber(rr,I.target)&&rr.afterInsert){const ir=rr.afterInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,entityId:I.getEntityIdMixedMap(tr)});ir instanceof Promise&&e.promises.push(ir),e.count++}})}broadcastBeforeQueryEvent(e,I,B){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(tr=>{if(tr.beforeQuery){const rr=tr.beforeQuery({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,query:I,parameters:B});rr instanceof Promise&&e.promises.push(rr),e.count++}})}broadcastAfterQueryEvent(e,I,B,tr,rr,ir,lr){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(dr=>{if(dr.afterQuery){const mr=dr.afterQuery({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,query:I,parameters:B,success:tr,executionTime:rr,rawResults:ir,error:lr});mr instanceof Promise&&e.promises.push(mr),e.count++}})}broadcastBeforeTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.beforeTransactionStart){const B=I.beforeTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});B instanceof Promise&&e.promises.push(B),e.count++}})}broadcastAfterTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.afterTransactionStart){const B=I.afterTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});B instanceof Promise&&e.promises.push(B),e.count++}})}broadcastBeforeTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.beforeTransactionCommit){const B=I.beforeTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});B instanceof Promise&&e.promises.push(B),e.count++}})}broadcastAfterTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.afterTransactionCommit){const B=I.afterTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});B instanceof Promise&&e.promises.push(B),e.count++}})}broadcastBeforeTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.beforeTransactionRollback){const B=I.beforeTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});B instanceof Promise&&e.promises.push(B),e.count++}})}broadcastAfterTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(I=>{if(I.afterTransactionRollback){const B=I.afterTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});B instanceof Promise&&e.promises.push(B),e.count++}})}broadcastAfterUpdateEvent(e,I,B,tr,rr,ir){B&&I.afterUpdateListeners.length&&I.afterUpdateListeners.forEach(lr=>{if(lr.isAllowed(B)){const dr=lr.execute(B);dr instanceof Promise&&e.promises.push(dr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(lr=>{if(this.isAllowedSubscriber(lr,I.target)&&lr.afterUpdate){const dr=lr.afterUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,updatedColumns:rr||[],updatedRelations:ir||[]});dr instanceof Promise&&e.promises.push(dr),e.count++}})}broadcastAfterRemoveEvent(e,I,B,tr,rr){B&&I.afterRemoveListeners.length&&I.afterRemoveListeners.forEach(ir=>{if(ir.isAllowed(B)){const lr=ir.execute(B);lr instanceof Promise&&e.promises.push(lr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ir=>{if(this.isAllowedSubscriber(ir,I.target)&&ir.afterRemove){const lr=ir.afterRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,entityId:I.getEntityIdMixedMap(tr??rr)});lr instanceof Promise&&e.promises.push(lr),e.count++}})}broadcastAfterSoftRemoveEvent(e,I,B,tr,rr){B&&I.afterSoftRemoveListeners.length&&I.afterSoftRemoveListeners.forEach(ir=>{if(ir.isAllowed(B)){const lr=ir.execute(B);lr instanceof Promise&&e.promises.push(lr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ir=>{if(this.isAllowedSubscriber(ir,I.target)&&ir.afterSoftRemove){const lr=ir.afterSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,entityId:I.getEntityIdMixedMap(tr??rr)});lr instanceof Promise&&e.promises.push(lr),e.count++}})}broadcastAfterRecoverEvent(e,I,B,tr,rr){B&&I.afterRecoverListeners.length&&I.afterRecoverListeners.forEach(ir=>{if(ir.isAllowed(B)){const lr=ir.execute(B);lr instanceof Promise&&e.promises.push(lr),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(ir=>{if(this.isAllowedSubscriber(ir,I.target)&&ir.afterRecover){const lr=ir.afterRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:B,metadata:I,databaseEntity:tr,entityId:I.getEntityIdMixedMap(tr??rr)});lr instanceof Promise&&e.promises.push(lr),e.count++}})}broadcastLoadEventsForAll(e,I,B){return this.broadcastLoadEvent(e,I,B)}broadcastLoadEvent(e,I,B){const tr=this.queryRunner.connection.subscribers.filter(rr=>this.isAllowedSubscriber(rr,I.target)&&rr.afterLoad);if(I.relations.length||I.afterLoadListeners.length||tr.length){const rr=B.filter(ir=>!(ir instanceof Promise));I.relations.length&&I.relations.forEach(ir=>{rr.forEach(lr=>{if(ir.isLazy&&!lr.hasOwnProperty(ir.propertyName))return;const dr=ir.getEntityValue(lr);ObjectUtils.isObject(dr)&&this.broadcastLoadEvent(e,ir.inverseEntityMetadata,Array.isArray(dr)?dr:[dr])})}),I.afterLoadListeners.length&&I.afterLoadListeners.forEach(ir=>{rr.forEach(lr=>{if(ir.isAllowed(lr)){const dr=ir.execute(lr);dr instanceof Promise&&e.promises.push(dr),e.count++}})}),tr.forEach(ir=>{rr.forEach(lr=>{const dr=ir.afterLoad(lr,{entity:lr,metadata:I,connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});dr instanceof Promise&&e.promises.push(dr),e.count++})})}}isAllowedSubscriber(e,I){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===I||e.listenTo().isPrototypeOf(I)}}class QueryResult{constructor(){this.records=[]}}class CordovaQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=await this.connect(),rr=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(rr,e,I);const ir=+new Date;try{const lr=await new Promise(async(_r,gr)=>{tr.executeSql(e,I,Sr=>_r(Sr),Sr=>gr(Sr))}),dr=this.driver.options.maxQueryExecutionTime,hr=+new Date-ir;this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!0,hr,lr,void 0),dr&&hr>dr&&this.driver.connection.logger.logQuerySlow(hr,e,I,this);const fr=new QueryResult;if(e.substr(0,11)==="INSERT INTO")fr.raw=lr.insertId;else{let _r=[];for(let gr=0;gr<lr.rows.length;gr++)_r.push(lr.rows.item(gr));fr.records=_r,fr.raw=_r}return B?fr:fr.raw}catch(lr){throw this.driver.connection.logger.logQueryError(lr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!1,void 0,void 0,lr),new QueryFailedError(e,I,lr)}finally{await rr.wait()}}async startTransaction(){throw new TypeORMError("Transactions are not supported by the Cordova driver")}async commitTransaction(){throw new TypeORMError("Transactions are not supported by the Cordova driver")}async rollbackTransaction(){throw new TypeORMError("Transactions are not supported by the Cordova driver")}async clearDatabase(){await this.query("PRAGMA foreign_keys = OFF");try{const I=await this.query(`SELECT 'DROP VIEW "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'view'`),tr=await this.query(`SELECT 'DROP TABLE "' || name || '";' as query FROM "sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`);await Promise.all(I.map(rr=>this.query(rr.query))),await Promise.all(tr.map(rr=>this.query(rr.query)))}finally{await this.query("PRAGMA foreign_keys = ON")}}parametrize(e,I=0){return Object.keys(e).map((B,tr)=>`"${B}"=?`)}}class CordovaDriver extends AbstractSqliteDriver{constructor(e){super(e),this.transactionSupport="none",this.database=this.options.database,this.loadDependencies()}async disconnect(){return this.queryRunner=void 0,new Promise((e,I)=>{this.databaseConnection.close(e,I)})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new CordovaQueryRunner(this)),this.queryRunner}async createDatabaseConnection(){const e=Object.assign({},{name:this.options.database,location:this.options.location},this.options.extra||{}),I=await new Promise((B,tr)=>{this.sqlite.openDatabase(e,rr=>B(rr),rr=>tr(rr))});return await new Promise((B,tr)=>{I.executeSql("PRAGMA foreign_keys = ON",[],()=>B(),rr=>tr(rr))}),I}loadDependencies(){try{const e=this.options.driver||window.sqlitePlugin;this.sqlite=e}catch{throw new DriverPackageNotInstalledError("Cordova-SQLite","cordova-sqlite-storage")}}}class ReactNativeQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return new Promise(async(tr,rr)=>{const ir=await this.connect(),lr=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(lr,e,I);const dr=+new Date;ir.executeSql(e,I,async mr=>{const hr=this.driver.options.maxQueryExecutionTime,_r=+new Date-dr;this.broadcaster.broadcastAfterQueryEvent(lr,e,I,!0,_r,mr,void 0),hr&&_r>hr&&this.driver.connection.logger.logQuerySlow(_r,e,I,this),lr.promises.length>0&&await Promise.all(lr.promises);const gr=new QueryResult;if(mr?.hasOwnProperty("rowsAffected")&&(gr.affected=mr.rowsAffected),mr?.hasOwnProperty("rows")){let Sr=[];for(let Ar=0;Ar<mr.rows.length;Ar++)Sr.push(mr.rows.item(Ar));gr.raw=Sr,gr.records=Sr}e.substr(0,11)==="INSERT INTO"&&(gr.raw=mr.insertId),tr(B?gr:gr.raw)},async mr=>{this.driver.connection.logger.logQueryError(mr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(lr,e,I,!1,void 0,void 0,mr),await lr.wait(),rr(new QueryFailedError(e,I,mr))})})}parametrize(e,I=0){return Object.keys(e).map((B,tr)=>`"${B}"=?`)}}class ReactNativeDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.supportedUpsertTypes=["on-conflict-do-update"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.cteCapabilities={enabled:!0,requiresRecursiveHint:!0},this.attachedDatabases={},this.connection=e,this.options=e.options,this.database=this.options.database,this.loadDependencies()}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new ReactNativeQueryRunner(this)),this.queryRunner}async connect(){this.databaseConnection=await this.createDatabaseConnection()}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise((e,I)=>{this.queryRunner=void 0,this.databaseConnection.close(e,I)})}hasAttachedDatabases(){return!!Object.keys(this.attachedDatabases).length}getAttachedDatabaseHandleByRelativePath(e){return this.attachedDatabases?.[e]?.attachHandle}getAttachedDatabasePathRelativeByHandle(e){return Object.values(this.attachedDatabases).find(({attachHandle:I})=>e===I)?.attachFilepathRelative}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null?e:I.type===Boolean||I.type==="boolean"?e===!0?1:0:I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="time"?DateUtils.mixedDateToTimeString(e):I.type==="datetime"||I.type===Date?DateUtils.mixedDateToUtcDatetimeString(e):I.type==="simple-array"?DateUtils.simpleArrayToString(e):I.type==="simple-json"?DateUtils.simpleJsonToString(e):I.type==="simple-enum"?DateUtils.simpleEnumToString(e):e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:(I.type===Boolean||I.type==="boolean"?e=!!e:I.type==="datetime"||I.type===Date?(e&&typeof e=="string"&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=DateUtils.normalizeHydratedDate(e)):I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="time"?e=DateUtils.mixedTimeToString(e):I.type==="simple-array"?e=DateUtils.stringToSimpleArray(e):I.type==="simple-json"?e=DateUtils.stringToSimpleJson(e):I.type==="simple-enum"?e=DateUtils.stringToSimpleEnum(e,I):I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}escapeQueryWithParameters(e,I,B){const tr=Object.keys(B).map(rr=>typeof B[rr]=="boolean"?B[rr]===!0?1:0:B[rr]instanceof Date?DateUtils.mixedDateToUtcDatetimeString(B[rr]):B[rr]);return!I||!Object.keys(I).length?[e,tr]:(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(rr,ir,lr)=>{if(!I.hasOwnProperty(lr))return rr;let dr=I[lr];return ir?dr.map(mr=>(tr.push(mr),this.createParameter(lr,tr.length-1))).join(", "):typeof dr=="function"?dr():typeof dr=="number"?String(dr):typeof dr=="boolean"?(tr.push(+dr),this.createParameter(lr,tr.length-1)):dr instanceof Date?(tr.push(DateUtils.mixedDateToUtcDatetimeString(dr)),this.createParameter(lr,tr.length-1)):(tr.push(dr),this.createParameter(lr,tr.length-1))}),[e,tr])}escape(e){return'"'+e+'"'}buildTableName(e,I,B){return e}parseTableName(e){const I=this.database,B=void 0;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const rr=this.parseTableName(e.schema?`"${e.schema}"."${e.name}"`:e.name);return{database:e.database||rr.database||I,schema:e.schema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isTableForeignKey(e)){const rr=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||rr.database||I,schema:e.referencedSchema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||B,tableName:e.tableName};const tr=e.split(".");return tr.length===3?{database:tr[0]||I,schema:tr[1]||B,tableName:tr[2]}:tr.length===2?{database:this.getAttachedDatabasePathRelativeByHandle(tr[0])??I,schema:tr[0],tableName:tr[1]}:{database:I,schema:B,tableName:e}}normalizeType(e){return e.type===Number||e.type==="int"?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":e.type==="uuid"?"varchar":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"varchar":e.type||""}normalizeDefault(e){const I=e.default;if(typeof I=="number")return""+I;if(typeof I=="boolean")return I?"1":"0";if(typeof I=="function")return I();if(typeof I=="string")return`'${I}'`;if(I!=null)return`${I}`}normalizeIsUnique(e){return e.entityMetadata.uniques.some(I=>I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let I=e.type;return e.enum?"varchar":(e.length?I+="("+e.length+")":e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+="("+e.precision+","+e.scale+")":e.precision!==null&&e.precision!==void 0&&(I+="("+e.precision+")"),e.isArray&&(I+=" array"),I)}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,I,B,tr){const rr=e.generatedColumns.reduce((ir,lr)=>{let dr;return lr.generationStrategy==="increment"&&I&&(dr=I-tr+B+1),dr?OrmUtils.mergeDeep(ir,lr.createValueMap(dr)):ir},{});return Object.keys(rr).length>0?rr:void 0}findChangedColumns(e,I){return I.filter(B=>{const tr=e.find(ir=>ir.name===B.databaseName);return tr?tr.name!==B.databaseName||tr.type!==this.normalizeType(B)||tr.length!==B.length||tr.precision!==B.precision||tr.scale!==B.scale||this.normalizeDefault(B)!==tr.default||tr.isPrimary!==B.isPrimary||tr.isNullable!==B.isNullable||tr.generatedType!==B.generatedType||tr.asExpression!==B.asExpression||tr.isUnique!==this.normalizeIsUnique(B)||tr.enum&&B.enum&&!OrmUtils.isArraysEqual(tr.enum,B.enum.map(ir=>ir+""))||B.generationStrategy!=="uuid"&&tr.isGenerated!==B.isGenerated:!1})}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,I){return"?"}createDatabaseConnection(){return new Promise((e,I)=>{const B=Object.assign({},{name:this.options.database,location:this.options.location},this.options.extra||{});this.sqlite.openDatabase(B,tr=>{const rr=tr;rr.executeSql("PRAGMA foreign_keys = ON",[],ir=>{e(rr)},ir=>{I(ir)})},tr=>{I(tr)})})}loadDependencies(){try{const e=this.options.driver||require("react-native-sqlite-storage");this.sqlite=e}catch{throw new DriverPackageNotInstalledError("React-Native","react-native-sqlite-storage")}}}class NativescriptQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=this.driver.connection;return new Promise(async(rr,ir)=>{const lr=await this.connect(),dr=e.substr(0,11)==="INSERT INTO";tr.logger.logQuery(e,I,this);const mr=(fr,_r)=>{const gr=this.driver.options.maxQueryExecutionTime,Ar=+new Date-hr;gr&&Ar>gr&&tr.logger.logQuerySlow(Ar,e,I,this),fr&&(tr.logger.logQueryError(fr,e,I,this),ir(new QueryFailedError(e,I,fr)));const Or=new QueryResult;Or.raw=_r,!dr&&Array.isArray(_r)&&(Or.records=_r),rr(B?Or:Or.raw)},hr=+new Date;dr?lr.execSQL(e,I,mr):lr.all(e,I,mr)})}parametrize(e,I=0){return Object.keys(e).map((B,tr)=>`"${B}"=?`)}}class NativescriptDriver extends AbstractSqliteDriver{constructor(e){super(e),this.connection=e,this.options=e.options,this.database=this.options.database,this.driver=this.options.driver,this.loadDependencies()}async disconnect(){return new Promise((e,I)=>{this.queryRunner=void 0,this.databaseConnection.close().then(e).catch(I)})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new NativescriptQueryRunner(this)),this.queryRunner}normalizeType(e){return e.type===Buffer?"blob":super.normalizeType(e)}createDatabaseConnection(){return new Promise((e,I)=>{const B=Object.assign({},{readOnly:this.options.readOnly,key:this.options.key,multithreading:this.options.multithreading,migrate:this.options.migrate,iosFlags:this.options.iosFlags,androidFlags:this.options.androidFlags},this.options.extra||{});new this.sqlite(this.options.database,B,(tr,rr)=>{if(tr)return I(tr);rr.resultType(this.sqlite.RESULTSASOBJECT),rr.execSQL("PRAGMA foreign_keys = ON",[],(ir,lr)=>{if(ir)return I(ir);e(rr)})})})}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new DriverPackageNotInstalledError("Nativescript","nativescript-sqlite")}}class SqljsQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.isDirty=!1,this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async flush(){this.isDirty&&(await this.driver.autoSave(),this.isDirty=!1)}async release(){return await this.flush(),super.release()}async commitTransaction(){await super.commitTransaction(),this.isTransactionActive||await this.flush()}async query(e,I=[],B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=e.trim().split(" ",1)[0],rr=this.driver.databaseConnection,ir=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(ir,e,I);const lr=+new Date;let dr;try{dr=rr.prepare(e),I&&(I=I.map(Sr=>typeof Sr<"u"?Sr:null),dr.bind(I));const mr=this.driver.options.maxQueryExecutionTime,fr=+new Date-lr;mr&&fr>mr&&this.driver.connection.logger.logQuerySlow(fr,e,I,this);const _r=[];for(;dr.step();)_r.push(dr.getAsObject());this.broadcaster.broadcastAfterQueryEvent(ir,e,I,!0,fr,_r,void 0);const gr=new QueryResult;return gr.affected=rr.getRowsModified(),gr.records=_r,gr.raw=_r,dr.free(),tr!=="SELECT"&&(this.isDirty=!0),B?gr:gr.raw}catch(mr){throw dr&&dr.free(),this.driver.connection.logger.logQueryError(mr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(ir,e,I,!1,void 0,void 0,mr),new QueryFailedError(e,I,mr)}finally{await ir.wait()}}}class SqljsDriver extends AbstractSqliteDriver{constructor(e){if(super(e),this.options.autoSave&&!this.options.location&&!this.options.autoSaveCallback)throw new DriverOptionNotSetError("location or autoSaveCallback");this.loadDependencies()}async connect(){this.databaseConnection=await this.createDatabaseConnection()}async disconnect(){this.queryRunner=void 0,this.databaseConnection.close()}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new SqljsQueryRunner(this)),this.queryRunner}async load(e,I=!0){if(typeof e=="string")if(PlatformTools.type==="node")if(PlatformTools.fileExist(e)){const B=PlatformTools.readFileSync(e);return this.createDatabaseConnectionWithImport(B)}else{if(I)throw new TypeORMError(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}else{let B=null;if(this.options.useLocalForage)if(window.localforage)B=await window.localforage.getItem(e);else throw new TypeORMError("localforage is not defined - please import localforage.js into your site");else B=PlatformTools.getGlobalVariable().localStorage.getItem(e);if(B!=null)return this.createDatabaseConnectionWithImport(JSON.parse(B));if(I)throw new TypeORMError(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}else return this.createDatabaseConnectionWithImport(e)}async save(e){if(!e&&!this.options.location)throw new TypeORMError("No location is set, specify a location parameter or add the location option to your configuration");let I="";if(e?I=e:this.options.location&&(I=this.options.location),PlatformTools.type==="node")try{const B=Buffer.from(this.databaseConnection.export());await PlatformTools.writeFile(I,B)}catch(B){throw new TypeORMError(`Could not save database, error: ${B}`)}else{const B=this.databaseConnection.export(),tr=[].slice.call(B);if(this.options.useLocalForage)if(window.localforage)await window.localforage.setItem(I,JSON.stringify(tr));else throw new TypeORMError("localforage is not defined - please import localforage.js into your site");else PlatformTools.getGlobalVariable().localStorage.setItem(I,JSON.stringify(tr))}}async autoSave(){this.options.autoSave&&!this.queryRunner?.isTransactionActive&&(this.options.autoSaveCallback?await this.options.autoSaveCallback(this.export()):await this.save())}export(){return this.databaseConnection.export()}createGeneratedMap(e,I){const B=e.generatedColumns.reduce((tr,rr)=>{if(rr.isPrimary&&rr.generationStrategy==="increment"){const ir="SELECT last_insert_rowid()";try{let lr=this.databaseConnection.exec(ir);return this.connection.logger.logQuery(ir),OrmUtils.mergeDeep(tr,rr.createValueMap(lr[0].values[0][0]))}catch(lr){this.connection.logger.logQueryError(lr,ir,[])}}return tr},{});return Object.keys(B).length>0?B:void 0}createDatabaseConnection(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)}async createDatabaseConnectionWithImport(e){const B=typeof this.sqlite.Database=="function"?this.sqlite:await this.sqlite(this.options.sqlJsConfig);return e&&e.length>0?this.databaseConnection=new B.Database(e):this.databaseConnection=new B.Database,this.databaseConnection.exec("PRAGMA foreign_keys = ON"),this.databaseConnection}loadDependencies(){if(PlatformTools.type==="browser"){const e=this.options.driver||window.SQL;this.sqlite=e}else try{const e=this.options.driver||PlatformTools.load("sql.js");this.sqlite=e}catch{throw new DriverPackageNotInstalledError("sql.js","sql.js")}}}class PostgresQueryRunner extends BaseQueryRunner{constructor(e,I){super(),this.driver=e,this.connection=e.connection,this.mode=I,this.broadcaster=new Broadcaster(this)}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.mode==="slave"&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(([e,I])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const B=tr=>this.releasePostgresConnection(tr);return this.releaseCallback=tr=>{this.databaseConnection.removeListener("error",B),I(tr)},this.databaseConnection.on("error",B),this.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(([e,I])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const B=tr=>this.releasePostgresConnection(tr);return this.releaseCallback=tr=>{this.databaseConnection.removeListener("error",B),I(tr)},this.databaseConnection.on("error",B),this.databaseConnection}),this.databaseConnectionPromise)}async releasePostgresConnection(e){if(this.isReleased)return;this.isReleased=!0,this.releaseCallback&&(this.releaseCallback(e),this.releaseCallback=void 0);const I=this.driver.connectedQueryRunners.indexOf(this);I!==-1&&this.driver.connectedQueryRunners.splice(I,1)}release(){return this.releasePostgresConnection()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,await this.query("START TRANSACTION"),e&&await this.query("SET TRANSACTION ISOLATION LEVEL "+e)):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth-1}`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("COMMIT"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.query("ROLLBACK"),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=await this.connect(),rr=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(rr,e,I);try{const ir=+new Date,lr=await tr.query(e,I),dr=this.driver.options.maxQueryExecutionTime,hr=+new Date-ir;this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!0,hr,lr,void 0),dr&&hr>dr&&this.driver.connection.logger.logQuerySlow(hr,e,I,this);const fr=new QueryResult;if(lr){switch(lr.hasOwnProperty("rows")&&(fr.records=lr.rows),lr.hasOwnProperty("rowCount")&&(fr.affected=lr.rowCount),lr.command){case"DELETE":case"UPDATE":fr.raw=[lr.rows,lr.rowCount];break;default:fr.raw=lr.rows}if(!B)return fr.raw}return fr}catch(ir){throw this.driver.connection.logger.logQueryError(ir,e,I,this),this.broadcaster.broadcastAfterQueryEvent(rr,e,I,!1,void 0,void 0,ir),new QueryFailedError(e,I,ir)}finally{await rr.wait()}}async stream(e,I,B,tr){const rr=this.driver.loadStreamDependency();if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const ir=await this.connect();this.driver.connection.logger.logQuery(e,I,this);const lr=ir.query(new rr(e,I));return B&&lr.on("end",B),tr&&lr.on("error",tr),lr}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return!!(await this.query(`SELECT * FROM pg_database WHERE datname='${e}';`)).length}async getCurrentDatabase(){return(await this.query("SELECT * FROM current_database()"))[0].current_database}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){return(await this.query("SELECT * FROM current_schema()"))[0].current_schema}async hasTable(e){const I=this.driver.parseTableName(e);I.schema||(I.schema=await this.getCurrentSchema());const B=`SELECT * FROM "information_schema"."tables" WHERE "table_schema" = '${I.schema}' AND "table_name" = '${I.tableName}'`;return!!(await this.query(B)).length}async hasColumn(e,I){const B=this.driver.parseTableName(e);B.schema||(B.schema=await this.getCurrentSchema());const tr=`SELECT * FROM "information_schema"."columns" WHERE "table_schema" = '${B.schema}' AND "table_name" = '${B.tableName}' AND "column_name" = '${I}'`;return!!(await this.query(tr)).length}async createDatabase(e,I){if(I&&await this.hasDatabase(e))return Promise.resolve();const B=`CREATE DATABASE "${e}"`,tr=`DROP DATABASE "${e}"`;await this.executeQueries(new Query(B),new Query(tr))}async dropDatabase(e,I){const B=I?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,tr=`CREATE DATABASE "${e}"`;await this.executeQueries(new Query(B),new Query(tr))}async createSchema(e,I){const B=e.indexOf(".")===-1?e:e.split(".")[1],tr=I?`CREATE SCHEMA IF NOT EXISTS "${B}"`:`CREATE SCHEMA "${B}"`,rr=`DROP SCHEMA "${B}" CASCADE`;await this.executeQueries(new Query(tr),new Query(rr))}async dropSchema(e,I,B){const tr=e.indexOf(".")===-1?e:e.split(".")[1],rr=I?`DROP SCHEMA IF EXISTS "${tr}" ${B?"CASCADE":""}`:`DROP SCHEMA "${tr}" ${B?"CASCADE":""}`,ir=`CREATE SCHEMA "${tr}"`;await this.executeQueries(new Query(rr),new Query(ir))}async createTable(e,I=!1,B=!0,tr=!0){if(I&&await this.hasTable(e))return Promise.resolve();const rr=[],ir=[],lr=e.columns.filter(hr=>hr.type==="enum"||hr.type==="simple-enum"),dr=[];for(const hr of lr){const fr=await this.hasEnumType(e,hr),_r=this.buildEnumName(e,hr);!fr&&dr.indexOf(_r)===-1&&(dr.push(_r),rr.push(this.createEnumTypeSql(e,hr,_r)),ir.push(this.dropEnumTypeSql(e,hr,_r)))}const mr=e.columns.filter(hr=>hr.generatedType==="STORED"&&hr.asExpression);for(const hr of mr){const fr=(await this.getTableNameWithSchema(e.name)).split("."),_r=fr[1],gr=fr[0],Sr=this.insertTypeormMetadataSql({database:this.driver.database,schema:gr,table:_r,type:MetadataTableType.GENERATED_COLUMN,name:hr.name,value:hr.asExpression}),Ar=this.deleteTypeormMetadataSql({database:this.driver.database,schema:gr,table:_r,type:MetadataTableType.GENERATED_COLUMN,name:hr.name});rr.push(Sr),ir.push(Ar)}rr.push(this.createTableSql(e,B)),ir.push(this.dropTableSql(e)),B&&e.foreignKeys.forEach(hr=>ir.push(this.dropForeignKeySql(e,hr))),tr&&e.indices.forEach(hr=>{hr.name||(hr.name=this.connection.namingStrategy.indexName(e,hr.columnNames,hr.where)),rr.push(this.createIndexSql(e,hr)),ir.push(this.dropIndexSql(e,hr))}),e.comment&&(rr.push(new Query("COMMENT ON TABLE "+this.escapePath(e)+" IS '"+e.comment+"'")),ir.push(new Query("COMMENT ON TABLE "+this.escapePath(e)+" IS NULL"))),await this.executeQueries(rr,ir)}async dropTable(e,I,B=!0,tr=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const rr=B,ir=this.getTablePath(e),lr=await this.getCachedTable(ir),dr=[],mr=[];tr&&lr.indices.forEach(fr=>{dr.push(this.dropIndexSql(lr,fr)),mr.push(this.createIndexSql(lr,fr))}),B&&lr.foreignKeys.forEach(fr=>dr.push(this.dropForeignKeySql(lr,fr))),dr.push(this.dropTableSql(lr)),mr.push(this.createTableSql(lr,rr));const hr=lr.columns.filter(fr=>fr.generatedType&&fr.asExpression);for(const fr of hr){const _r=(await this.getTableNameWithSchema(lr.name)).split("."),gr=_r[1],Sr=_r[0],Ar=this.deleteTypeormMetadataSql({database:this.driver.database,schema:Sr,table:gr,type:MetadataTableType.GENERATED_COLUMN,name:fr.name}),Or=this.insertTypeormMetadataSql({database:this.driver.database,schema:Sr,table:gr,type:MetadataTableType.GENERATED_COLUMN,name:fr.name,value:fr.asExpression});dr.push(Ar),mr.push(Or)}await this.executeQueries(dr,mr)}async createView(e,I=!1){const B=[],tr=[];B.push(this.createViewSql(e)),I&&B.push(await this.insertViewDefinitionSql(e)),tr.push(this.dropViewSql(e)),I&&tr.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(B,tr)}async dropView(e){const I=InstanceChecker.isView(e)?e.name:e,B=await this.getCachedView(I),tr=[],rr=[];tr.push(await this.deleteViewDefinitionSql(B)),tr.push(this.dropViewSql(B)),rr.push(await this.insertViewDefinitionSql(B)),rr.push(this.createViewSql(B)),await this.executeQueries(tr,rr)}async renameTable(e,I){const B=[],tr=[],rr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ir=rr.clone(),{schema:lr,tableName:dr}=this.driver.parseTableName(rr);if(ir.name=lr?`${lr}.${I}`:I,B.push(new Query(`ALTER TABLE ${this.escapePath(rr)} RENAME TO "${I}"`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ir)} RENAME TO "${dr}"`)),ir.primaryColumns.length>0&&!ir.primaryColumns[0].primaryKeyConstraintName){const hr=ir.primaryColumns.map(gr=>gr.name),fr=this.connection.namingStrategy.primaryKeyName(rr,hr),_r=this.connection.namingStrategy.primaryKeyName(ir,hr);B.push(new Query(`ALTER TABLE ${this.escapePath(ir)} RENAME CONSTRAINT "${fr}" TO "${_r}"`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ir)} RENAME CONSTRAINT "${_r}" TO "${fr}"`))}ir.columns.map(hr=>{if(hr.isGenerated&&hr.generationStrategy==="increment"){const fr=this.buildSequencePath(rr,hr.name),_r=this.buildSequenceName(rr,hr.name),gr=this.buildSequencePath(ir,hr.name),Sr=this.buildSequenceName(ir,hr.name),Ar=`ALTER SEQUENCE ${this.escapePath(fr)} RENAME TO "${Sr}"`,Or=`ALTER SEQUENCE ${this.escapePath(gr)} RENAME TO "${_r}"`;B.push(new Query(Ar)),tr.push(new Query(Or))}}),ir.uniques.forEach(hr=>{const fr=this.connection.namingStrategy.uniqueConstraintName(rr,hr.columnNames);if(hr.name!==fr)return;const _r=this.connection.namingStrategy.uniqueConstraintName(ir,hr.columnNames);B.push(new Query(`ALTER TABLE ${this.escapePath(ir)} RENAME CONSTRAINT "${hr.name}" TO "${_r}"`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ir)} RENAME CONSTRAINT "${_r}" TO "${hr.name}"`)),hr.name=_r}),ir.indices.forEach(hr=>{const fr=this.connection.namingStrategy.indexName(rr,hr.columnNames,hr.where);if(hr.name!==fr)return;const{schema:_r}=this.driver.parseTableName(ir),gr=this.connection.namingStrategy.indexName(ir,hr.columnNames,hr.where),Sr=_r?`ALTER INDEX "${_r}"."${hr.name}" RENAME TO "${gr}"`:`ALTER INDEX "${hr.name}" RENAME TO "${gr}"`,Ar=_r?`ALTER INDEX "${_r}"."${gr}" RENAME TO "${hr.name}"`:`ALTER INDEX "${gr}" RENAME TO "${hr.name}"`;B.push(new Query(Sr)),tr.push(new Query(Ar)),hr.name=gr}),ir.foreignKeys.forEach(hr=>{const fr=this.connection.namingStrategy.foreignKeyName(rr,hr.columnNames,this.getTablePath(hr),hr.referencedColumnNames);if(hr.name!==fr)return;const _r=this.connection.namingStrategy.foreignKeyName(ir,hr.columnNames,this.getTablePath(hr),hr.referencedColumnNames);B.push(new Query(`ALTER TABLE ${this.escapePath(ir)} RENAME CONSTRAINT "${hr.name}" TO "${_r}"`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ir)} RENAME CONSTRAINT "${_r}" TO "${hr.name}"`)),hr.name=_r});const mr=ir.columns.filter(hr=>hr.type==="enum"||hr.type==="simple-enum");for(let hr of mr){if(hr.enumName)continue;const fr=await this.getUserDefinedTypeName(rr,hr);B.push(new Query(`ALTER TYPE "${fr.schema}"."${fr.name}" RENAME TO ${this.buildEnumName(ir,hr,!1)}`)),tr.push(new Query(`ALTER TYPE ${this.buildEnumName(ir,hr)} RENAME TO "${fr.name}"`))}await this.executeQueries(B,tr)}async addColumn(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone(),rr=[],ir=[];if((I.type==="enum"||I.type==="simple-enum")&&(await this.hasEnumType(B,I)||(rr.push(this.createEnumTypeSql(B,I)),ir.push(this.dropEnumTypeSql(B,I)))),rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD ${this.buildCreateColumnSql(B,I)}`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP COLUMN "${I.name}"`)),I.isPrimary){const dr=tr.primaryColumns;if(dr.length>0){const fr=dr[0].primaryKeyConstraintName?dr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(tr,dr.map(gr=>gr.name)),_r=dr.map(gr=>`"${gr.name}"`).join(", ");rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP CONSTRAINT "${fr}"`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD CONSTRAINT "${fr}" PRIMARY KEY (${_r})`))}dr.push(I);const mr=dr[0].primaryKeyConstraintName?dr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(tr,dr.map(fr=>fr.name)),hr=dr.map(fr=>`"${fr.name}"`).join(", ");rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD CONSTRAINT "${mr}" PRIMARY KEY (${hr})`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP CONSTRAINT "${mr}"`))}const lr=tr.indices.find(dr=>dr.columnNames.length===1&&dr.columnNames[0]===I.name);if(lr&&(rr.push(this.createIndexSql(B,lr)),ir.push(this.dropIndexSql(B,lr))),I.isUnique){const dr=new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(B,[I.name]),columnNames:[I.name]});tr.uniques.push(dr),rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD CONSTRAINT "${dr.name}" UNIQUE ("${I.name}")`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP CONSTRAINT "${dr.name}"`))}if(I.generatedType==="STORED"&&I.asExpression){const dr=(await this.getTableNameWithSchema(B.name)).split("."),mr=dr[1],hr=dr[0],fr=this.insertTypeormMetadataSql({database:this.driver.database,schema:hr,table:mr,type:MetadataTableType.GENERATED_COLUMN,name:I.name,value:I.asExpression}),_r=this.deleteTypeormMetadataSql({database:this.driver.database,schema:hr,table:mr,type:MetadataTableType.GENERATED_COLUMN,name:I.name});rr.push(fr),ir.push(_r)}I.comment&&(rr.push(new Query(`COMMENT ON COLUMN ${this.escapePath(B)}."${I.name}" IS ${this.escapeComment(I.comment)}`)),ir.push(new Query(`COMMENT ON COLUMN ${this.escapePath(B)}."${I.name}" IS ${this.escapeComment(I.comment)}`))),await this.executeQueries(rr,ir),tr.addColumn(I),this.replaceCachedTable(B,tr)}async addColumns(e,I){for(const B of I)await this.addColumn(e,B)}async renameColumn(e,I,B){const tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),rr=InstanceChecker.isTableColumn(I)?I:tr.columns.find(lr=>lr.name===I);if(!rr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);let ir;return InstanceChecker.isTableColumn(B)?ir=B:(ir=rr.clone(),ir.name=B),this.changeColumn(tr,rr,ir)}async changeColumn(e,I,B){const tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);let rr=tr.clone();const ir=[],lr=[];let dr=!1;const mr=InstanceChecker.isTableColumn(I)?I:tr.columns.find(hr=>hr.name===I);if(!mr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);if(mr.type!==B.type||mr.length!==B.length||B.isArray!==mr.isArray||!mr.generatedType&&B.generatedType==="STORED"||mr.asExpression!==B.asExpression&&B.generatedType==="STORED")await this.dropColumn(tr,mr),await this.addColumn(tr,B),rr=tr.clone();else{if(mr.name!==B.name){if(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME COLUMN "${mr.name}" TO "${B.name}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME COLUMN "${B.name}" TO "${mr.name}"`)),mr.type==="enum"||mr.type==="simple-enum"){const fr=await this.getUserDefinedTypeName(tr,mr);ir.push(new Query(`ALTER TYPE "${fr.schema}"."${fr.name}" RENAME TO ${this.buildEnumName(tr,B,!1)}`)),lr.push(new Query(`ALTER TYPE ${this.buildEnumName(tr,B)} RENAME TO "${fr.name}"`))}if(mr.isPrimary===!0&&!mr.primaryKeyConstraintName){const _r=rr.primaryColumns.map(Ar=>Ar.name),gr=this.connection.namingStrategy.primaryKeyName(rr,_r);_r.splice(_r.indexOf(mr.name),1),_r.push(B.name);const Sr=this.connection.namingStrategy.primaryKeyName(rr,_r);ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${gr}" TO "${Sr}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${Sr}" TO "${gr}"`))}if(mr.isGenerated===!0&&B.generationStrategy==="increment"){const fr=this.buildSequencePath(tr,mr.name),_r=this.buildSequenceName(tr,mr.name),gr=this.buildSequencePath(tr,B.name),Sr=this.buildSequenceName(tr,B.name),Ar=`ALTER SEQUENCE ${this.escapePath(fr)} RENAME TO "${Sr}"`,Or=`ALTER SEQUENCE ${this.escapePath(gr)} RENAME TO "${_r}"`;ir.push(new Query(Ar)),lr.push(new Query(Or))}rr.findColumnUniques(mr).forEach(fr=>{const _r=this.connection.namingStrategy.uniqueConstraintName(rr,fr.columnNames);if(fr.name!==_r)return;fr.columnNames.splice(fr.columnNames.indexOf(mr.name),1),fr.columnNames.push(B.name);const gr=this.connection.namingStrategy.uniqueConstraintName(rr,fr.columnNames);ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${fr.name}" TO "${gr}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${gr}" TO "${fr.name}"`)),fr.name=gr}),rr.findColumnIndices(mr).forEach(fr=>{const _r=this.connection.namingStrategy.indexName(rr,fr.columnNames,fr.where);if(fr.name!==_r)return;fr.columnNames.splice(fr.columnNames.indexOf(mr.name),1),fr.columnNames.push(B.name);const{schema:gr}=this.driver.parseTableName(tr),Sr=this.connection.namingStrategy.indexName(rr,fr.columnNames,fr.where),Ar=gr?`ALTER INDEX "${gr}"."${fr.name}" RENAME TO "${Sr}"`:`ALTER INDEX "${fr.name}" RENAME TO "${Sr}"`,Or=gr?`ALTER INDEX "${gr}"."${Sr}" RENAME TO "${fr.name}"`:`ALTER INDEX "${Sr}" RENAME TO "${fr.name}"`;ir.push(new Query(Ar)),lr.push(new Query(Or)),fr.name=Sr}),rr.findColumnForeignKeys(mr).forEach(fr=>{const _r=this.connection.namingStrategy.foreignKeyName(rr,fr.columnNames,this.getTablePath(fr),fr.referencedColumnNames);if(fr.name!==_r)return;fr.columnNames.splice(fr.columnNames.indexOf(mr.name),1),fr.columnNames.push(B.name);const gr=this.connection.namingStrategy.foreignKeyName(rr,fr.columnNames,this.getTablePath(fr),fr.referencedColumnNames);ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${fr.name}" TO "${gr}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME CONSTRAINT "${gr}" TO "${fr.name}"`)),fr.name=gr});const hr=rr.columns.find(fr=>fr.name===mr.name);rr.columns[rr.columns.indexOf(hr)].name=B.name,mr.name=B.name}if((B.precision!==mr.precision||B.scale!==mr.scale)&&(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${this.driver.createFullType(B)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${this.driver.createFullType(mr)}`))),(B.type==="enum"||B.type==="simple-enum")&&(mr.type==="enum"||mr.type==="simple-enum")&&(!OrmUtils.isArraysEqual(B.enum,mr.enum)||B.enumName!==mr.enumName)){const hr=B.isArray?"[]":"",fr=this.buildEnumName(tr,B),_r=this.buildEnumName(tr,mr),gr=this.buildEnumName(tr,mr,!1),Sr=this.buildEnumName(tr,mr,!0,!1,!0),Ar=this.buildEnumName(tr,mr,!1,!1,!0);ir.push(new Query(`ALTER TYPE ${_r} RENAME TO ${Ar}`)),lr.push(new Query(`ALTER TYPE ${Sr} RENAME TO ${gr}`)),ir.push(this.createEnumTypeSql(tr,B,fr)),lr.push(this.dropEnumTypeSql(tr,B,fr)),mr.default!==null&&mr.default!==void 0&&(dr=!0,ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" DROP DEFAULT`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" SET DEFAULT ${mr.default}`)));const Or=`${fr}${hr} USING "${B.name}"::"text"::${fr}${hr}`,Fr=`${Sr}${hr} USING "${B.name}"::"text"::${Sr}${hr}`;ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${Or}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${Fr}`)),B.default!==null&&B.default!==void 0&&(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT ${B.default}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`))),ir.push(this.dropEnumTypeSql(tr,mr,Sr)),lr.push(this.createEnumTypeSql(tr,mr,Sr))}if(mr.isNullable!==B.isNullable&&(B.isNullable?(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" DROP NOT NULL`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" SET NOT NULL`))):(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" SET NOT NULL`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" DROP NOT NULL`)))),mr.comment!==B.comment&&(ir.push(new Query(`COMMENT ON COLUMN ${this.escapePath(tr)}."${mr.name}" IS ${this.escapeComment(B.comment)}`)),lr.push(new Query(`COMMENT ON COLUMN ${this.escapePath(tr)}."${B.name}" IS ${this.escapeComment(mr.comment)}`))),B.isPrimary!==mr.isPrimary){const hr=rr.primaryColumns;if(hr.length>0){const fr=hr[0].primaryKeyConstraintName?hr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(rr,hr.map(gr=>gr.name)),_r=hr.map(gr=>`"${gr.name}"`).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP CONSTRAINT "${fr}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD CONSTRAINT "${fr}" PRIMARY KEY (${_r})`))}if(B.isPrimary===!0){hr.push(B);const fr=rr.columns.find(Sr=>Sr.name===B.name);fr.isPrimary=!0;const _r=hr[0].primaryKeyConstraintName?hr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(rr,hr.map(Sr=>Sr.name)),gr=hr.map(Sr=>`"${Sr.name}"`).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD CONSTRAINT "${_r}" PRIMARY KEY (${gr})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP CONSTRAINT "${_r}"`))}else{const fr=hr.find(gr=>gr.name===B.name);hr.splice(hr.indexOf(fr),1);const _r=rr.columns.find(gr=>gr.name===B.name);if(_r.isPrimary=!1,hr.length>0){const gr=hr[0].primaryKeyConstraintName?hr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(rr,hr.map(Ar=>Ar.name)),Sr=hr.map(Ar=>`"${Ar.name}"`).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD CONSTRAINT "${gr}" PRIMARY KEY (${Sr})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP CONSTRAINT "${gr}"`))}}}if(B.isUnique!==mr.isUnique)if(B.isUnique===!0){const hr=new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(tr,[B.name]),columnNames:[B.name]});rr.uniques.push(hr),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD CONSTRAINT "${hr.name}" UNIQUE ("${B.name}")`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP CONSTRAINT "${hr.name}"`))}else{const hr=rr.uniques.find(fr=>fr.columnNames.length===1&&!!fr.columnNames.find(_r=>_r===B.name));rr.uniques.splice(rr.uniques.indexOf(hr),1),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP CONSTRAINT "${hr.name}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD CONSTRAINT "${hr.name}" UNIQUE ("${B.name}")`))}if(mr.isGenerated!==B.isGenerated&&(mr.isGenerated&&(mr.generationStrategy==="uuid"?(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" DROP DEFAULT`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${mr.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):mr.generationStrategy==="increment"&&(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(tr,B))}')`)),ir.push(new Query(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(tr,B))}`)),lr.push(new Query(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(tr,B))} OWNED BY ${this.escapePath(tr)}."${B.name}"`)))),B.generationStrategy==="uuid"?B.isGenerated===!0?(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT ${this.driver.uuidGenerator}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`))):(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):B.generationStrategy==="increment"&&(B.isGenerated===!0?(ir.push(new Query(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(tr,B))} OWNED BY ${this.escapePath(tr)}."${B.name}"`)),lr.push(new Query(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(tr,B))}`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(tr,B))}')`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`))):(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(tr,B))}')`)),ir.push(new Query(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(tr,B))}`)),lr.push(new Query(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(tr,B))} OWNED BY ${this.escapePath(tr)}."${B.name}"`))))),B.default!==mr.default&&!dr&&(B.default!==null&&B.default!==void 0?(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT ${B.default}`)),mr.default!==null&&mr.default!==void 0?lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT ${mr.default}`)):lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`))):mr.default!==null&&mr.default!==void 0&&(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" DROP DEFAULT`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" SET DEFAULT ${mr.default}`)))),((B.spatialFeatureType||"").toLowerCase()!==(mr.spatialFeatureType||"").toLowerCase()||B.srid!==mr.srid)&&(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${this.driver.createFullType(B)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${this.driver.createFullType(mr)}`))),B.generatedType!==mr.generatedType&&(!B.generatedType||B.generatedType==="VIRTUAL")){const hr=(await this.getTableNameWithSchema(tr.name)).split("."),fr=hr[1],_r=hr[0];ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} RENAME COLUMN "${mr.name}" TO "TEMP_OLD_${mr.name}"`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD ${this.buildCreateColumnSql(tr,B)}`)),ir.push(new Query(`UPDATE ${this.escapePath(tr)} SET "${B.name}" = "TEMP_OLD_${mr.name}"`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP COLUMN "TEMP_OLD_${mr.name}"`)),ir.push(this.deleteTypeormMetadataSql({database:this.driver.database,schema:_r,table:fr,type:MetadataTableType.GENERATED_COLUMN,name:mr.name})),lr.push(this.insertTypeormMetadataSql({database:this.driver.database,schema:_r,table:fr,type:MetadataTableType.GENERATED_COLUMN,name:mr.name,value:mr.asExpression})),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD ${this.buildCreateColumnSql(tr,mr)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP COLUMN "${B.name}"`))}}await this.executeQueries(ir,lr),this.replaceCachedTable(tr,rr)}async changeColumns(e,I){for(const{oldColumn:B,newColumn:tr}of I)await this.changeColumn(e,B,tr)}async dropColumn(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableColumn(I)?I:B.findColumnByName(I);if(!tr)throw new TypeORMError(`Column "${I}" was not found in table "${B.name}"`);const rr=B.clone(),ir=[],lr=[];if(tr.isPrimary){const fr=tr.primaryKeyConstraintName?tr.primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(rr,rr.primaryColumns.map(Sr=>Sr.name)),_r=rr.primaryColumns.map(Sr=>`"${Sr.name}"`).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(rr)} DROP CONSTRAINT "${fr}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(rr)} ADD CONSTRAINT "${fr}" PRIMARY KEY (${_r})`));const gr=rr.findColumnByName(tr.name);if(gr.isPrimary=!1,rr.primaryColumns.length>0){const Sr=rr.primaryColumns[0].primaryKeyConstraintName?rr.primaryColumns[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(rr,rr.primaryColumns.map(Or=>Or.name)),Ar=rr.primaryColumns.map(Or=>`"${Or.name}"`).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(rr)} ADD CONSTRAINT "${Sr}" PRIMARY KEY (${Ar})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(rr)} DROP CONSTRAINT "${Sr}"`))}}const dr=rr.indices.find(fr=>fr.columnNames.length===1&&fr.columnNames[0]===tr.name);dr&&(rr.indices.splice(rr.indices.indexOf(dr),1),ir.push(this.dropIndexSql(B,dr)),lr.push(this.createIndexSql(B,dr)));const mr=rr.checks.find(fr=>!!fr.columnNames&&fr.columnNames.length===1&&fr.columnNames[0]===tr.name);mr&&(rr.checks.splice(rr.checks.indexOf(mr),1),ir.push(this.dropCheckConstraintSql(B,mr)),lr.push(this.createCheckConstraintSql(B,mr)));const hr=rr.uniques.find(fr=>fr.columnNames.length===1&&fr.columnNames[0]===tr.name);if(hr&&(rr.uniques.splice(rr.uniques.indexOf(hr),1),ir.push(this.dropUniqueConstraintSql(B,hr)),lr.push(this.createUniqueConstraintSql(B,hr))),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP COLUMN "${tr.name}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD ${this.buildCreateColumnSql(B,tr)}`)),(tr.type==="enum"||tr.type==="simple-enum")&&await this.hasEnumType(B,tr)){const _r=await this.getUserDefinedTypeName(B,tr),gr=`"${_r.schema}"."${_r.name}"`;ir.push(this.dropEnumTypeSql(B,tr,gr)),lr.push(this.createEnumTypeSql(B,tr,gr))}if(tr.generatedType==="STORED"){const fr=(await this.getTableNameWithSchema(B.name)).split("."),_r=fr[1],gr=fr[0],Sr=this.deleteTypeormMetadataSql({database:this.driver.database,schema:gr,table:_r,type:MetadataTableType.GENERATED_COLUMN,name:tr.name}),Ar=this.insertTypeormMetadataSql({database:this.driver.database,schema:gr,table:_r,type:MetadataTableType.GENERATED_COLUMN,name:tr.name,value:tr.asExpression});ir.push(Sr),lr.push(Ar)}await this.executeQueries(ir,lr),rr.removeColumn(tr),this.replaceCachedTable(B,rr)}async dropColumns(e,I){for(const B of I)await this.dropColumn(e,B)}async createPrimaryKey(e,I,B){const tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),rr=tr.clone(),ir=this.createPrimaryKeySql(tr,I,B);rr.columns.forEach(dr=>{I.find(mr=>mr===dr.name)&&(dr.isPrimary=!0)});const lr=this.dropPrimaryKeySql(rr);await this.executeQueries(ir,lr),this.replaceCachedTable(tr,rr)}async updatePrimaryKeys(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone(),rr=I.map(fr=>fr.name),ir=[],lr=[],dr=tr.primaryColumns;if(dr.length>0){const fr=dr[0].primaryKeyConstraintName?dr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(tr,dr.map(gr=>gr.name)),_r=dr.map(gr=>`"${gr.name}"`).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP CONSTRAINT "${fr}"`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD CONSTRAINT "${fr}" PRIMARY KEY (${_r})`))}tr.columns.filter(fr=>rr.indexOf(fr.name)!==-1).forEach(fr=>fr.isPrimary=!0);const mr=dr[0]?.primaryKeyConstraintName?dr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(tr,rr),hr=rr.map(fr=>`"${fr}"`).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD CONSTRAINT "${mr}" PRIMARY KEY (${hr})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP CONSTRAINT "${mr}"`)),await this.executeQueries(ir,lr),this.replaceCachedTable(B,tr)}async dropPrimaryKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=this.dropPrimaryKeySql(B),rr=this.createPrimaryKeySql(B,B.primaryColumns.map(ir=>ir.name),I);await this.executeQueries(tr,rr),B.primaryColumns.forEach(ir=>{ir.isPrimary=!1})}async createUniqueConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.uniqueConstraintName(B,I.columnNames));const tr=this.createUniqueConstraintSql(B,I),rr=this.dropUniqueConstraintSql(B,I);await this.executeQueries(tr,rr),B.addUniqueConstraint(I)}async createUniqueConstraints(e,I){for(const B of I)await this.createUniqueConstraint(e,B)}async dropUniqueConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableUnique(I)?I:B.uniques.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied unique constraint was not found in table ${B.name}`);const rr=this.dropUniqueConstraintSql(B,tr),ir=this.createUniqueConstraintSql(B,tr);await this.executeQueries(rr,ir),B.removeUniqueConstraint(tr)}async dropUniqueConstraints(e,I){for(const B of I)await this.dropUniqueConstraint(e,B)}async createCheckConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.checkConstraintName(B,I.expression));const tr=this.createCheckConstraintSql(B,I),rr=this.dropCheckConstraintSql(B,I);await this.executeQueries(tr,rr),B.addCheckConstraint(I)}async createCheckConstraints(e,I){const B=I.map(tr=>this.createCheckConstraint(e,tr));await Promise.all(B)}async dropCheckConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableCheck(I)?I:B.checks.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied check constraint was not found in table ${B.name}`);const rr=this.dropCheckConstraintSql(B,tr),ir=this.createCheckConstraintSql(B,tr);await this.executeQueries(rr,ir),B.removeCheckConstraint(tr)}async dropCheckConstraints(e,I){const B=I.map(tr=>this.dropCheckConstraint(e,tr));await Promise.all(B)}async createExclusionConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.exclusionConstraintName(B,I.expression));const tr=this.createExclusionConstraintSql(B,I),rr=this.dropExclusionConstraintSql(B,I);await this.executeQueries(tr,rr),B.addExclusionConstraint(I)}async createExclusionConstraints(e,I){const B=I.map(tr=>this.createExclusionConstraint(e,tr));await Promise.all(B)}async dropExclusionConstraint(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableExclusion(I)?I:B.exclusions.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied exclusion constraint was not found in table ${B.name}`);const rr=this.dropExclusionConstraintSql(B,tr),ir=this.createExclusionConstraintSql(B,tr);await this.executeQueries(rr,ir),B.removeExclusionConstraint(tr)}async dropExclusionConstraints(e,I){const B=I.map(tr=>this.dropExclusionConstraint(e,tr));await Promise.all(B)}async createForeignKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.foreignKeyName(B,I.columnNames,this.getTablePath(I),I.referencedColumnNames));const tr=this.createForeignKeySql(B,I),rr=this.dropForeignKeySql(B,I);await this.executeQueries(tr,rr),B.addForeignKey(I)}async createForeignKeys(e,I){for(const B of I)await this.createForeignKey(e,B)}async dropForeignKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableForeignKey(I)?I:B.foreignKeys.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied foreign key was not found in table ${B.name}`);tr.name||(tr.name=this.connection.namingStrategy.foreignKeyName(B,tr.columnNames,this.getTablePath(tr),tr.referencedColumnNames));const rr=this.dropForeignKeySql(B,tr),ir=this.createForeignKeySql(B,tr);await this.executeQueries(rr,ir),B.removeForeignKey(tr)}async dropForeignKeys(e,I){for(const B of I)await this.dropForeignKey(e,B)}async createIndex(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(B,I));const tr=this.createIndexSql(B,I),rr=this.dropIndexSql(B,I);await this.executeQueries(tr,rr),B.addIndex(I)}async createViewIndex(e,I){const B=InstanceChecker.isView(e)?e:await this.getCachedView(e);I.name||(I.name=this.generateIndexName(B,I));const tr=this.createViewIndexSql(B,I),rr=this.dropIndexSql(B,I);await this.executeQueries(tr,rr),B.addIndex(I)}async createIndices(e,I){for(const B of I)await this.createIndex(e,B)}async createViewIndices(e,I){for(const B of I)await this.createViewIndex(e,B)}async dropIndex(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableIndex(I)?I:B.indices.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied index ${I} was not found in table ${B.name}`);tr.name||(tr.name=this.generateIndexName(B,tr));const rr=this.dropIndexSql(B,tr),ir=this.createIndexSql(B,tr);await this.executeQueries(rr,ir),B.removeIndex(tr)}async dropViewIndex(e,I){const B=InstanceChecker.isView(e)?e:await this.getCachedView(e),tr=InstanceChecker.isTableIndex(I)?I:B.indices.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied index ${I} was not found in view ${B.name}`);tr.name||(tr.name=this.generateIndexName(B,tr));const rr=this.dropIndexSql(B,tr),ir=this.createViewIndexSql(B,tr);await this.executeQueries(rr,ir),B.removeIndex(tr)}async dropIndices(e,I){for(const B of I)await this.dropIndex(e,B)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(){const e=[];this.connection.entityMetadatas.filter(tr=>tr.schema).forEach(tr=>{!!e.find(ir=>ir===tr.schema)||e.push(tr.schema)}),e.push(this.driver.options.schema||"current_schema()");const I=e.map(tr=>tr==="current_schema()"?tr:"'"+tr+"'").join(", "),B=this.isTransactionActive;B||await this.startTransaction();try{const tr=await this.getVersion(),rr=`SELECT 'DROP VIEW IF EXISTS "' || schemaname || '"."' || viewname || '" CASCADE;' as "query" FROM "pg_views" WHERE "schemaname" IN (${I}) AND "viewname" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')`,ir=await this.query(rr);if(await Promise.all(ir.map(mr=>this.query(mr.query))),VersionUtils.isGreaterOrEqual(tr,"9.3")){const mr=`SELECT 'DROP MATERIALIZED VIEW IF EXISTS "' || schemaname || '"."' || matviewname || '" CASCADE;' as "query" FROM "pg_matviews" WHERE "schemaname" IN (${I})`,hr=await this.query(mr);await Promise.all(hr.map(fr=>this.query(fr.query)))}const lr=`SELECT 'DROP TABLE IF EXISTS "' || schemaname || '"."' || tablename || '" CASCADE;' as "query" FROM "pg_tables" WHERE "schemaname" IN (${I}) AND "tablename" NOT IN ('spatial_ref_sys')`,dr=await this.query(lr);await Promise.all(dr.map(mr=>this.query(mr.query))),await this.dropEnumTypes(I),B||await this.commitTransaction()}catch(tr){try{B||await this.rollbackTransaction()}catch{}throw tr}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const B=await this.getCurrentDatabase(),tr=await this.getCurrentSchema(),rr=e.length===0?"1=1":e.map(fr=>this.driver.parseTableName(fr)).map(({schema:fr,tableName:_r})=>(fr||(fr=this.driver.options.schema||tr),`("t"."schema" = '${fr}' AND "t"."name" = '${_r}')`)).join(" OR "),lr=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN 't' THEN 'TRUE' ELSE'FALSE' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN ('m') AND "cnst"."contype" IS NULL AND (${e.length===0?"1=1":e.map(fr=>this.driver.parseTableName(fr)).map(({schema:fr,tableName:_r})=>(fr||(fr=this.driver.options.schema||tr),`("ns"."nspname" = '${fr}' AND "t"."relname" = '${_r}')`)).join(" OR ")})`,dr=`SELECT "t".* FROM ${this.escapePath(this.getTypeormMetadataTableName())} "t" INNER JOIN "pg_catalog"."pg_class" "c" ON "c"."relname" = "t"."name" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "c"."relnamespace" AND "n"."nspname" = "t"."schema" WHERE "t"."type" IN ('${MetadataTableType.VIEW}', '${MetadataTableType.MATERIALIZED_VIEW}') ${rr?`AND (${rr})`:""}`,mr=await this.query(dr),hr=await this.query(lr);return mr.map(fr=>{const _r=OrmUtils.uniq(hr.filter(Ar=>Ar.table_name===fr.name&&Ar.table_schema===fr.schema),Ar=>Ar.constraint_name),gr=new View,Sr=fr.schema===tr&&!this.driver.options.schema?void 0:fr.schema;return gr.database=B,gr.schema=fr.schema,gr.name=this.driver.buildTableName(fr.name,Sr),gr.expression=fr.value,gr.materialized=fr.type===MetadataTableType.MATERIALIZED_VIEW,gr.indices=_r.map(Ar=>{const Or=hr.filter(Fr=>Fr.table_schema===Ar.table_schema&&Fr.table_name===Ar.table_name&&Fr.constraint_name===Ar.constraint_name);return new TableIndex({view:gr,name:Ar.constraint_name,columnNames:Or.map(Fr=>Fr.column_name),isUnique:Ar.is_unique==="TRUE",where:Ar.condition,isFulltext:!1})}),gr})}async loadTables(e){if(e&&e.length===0)return[];const I=await this.getCurrentSchema(),B=await this.getCurrentDatabase(),tr=[];if(!e)tr.push(...await this.query(`SELECT "table_schema", "table_name", obj_description(('"' || "table_schema" || '"."' || "table_name" || '"')::regclass, 'pg_class') AS table_comment FROM "information_schema"."tables"`));else{const xr=`SELECT "table_schema", "table_name", obj_description(('"' || "table_schema" || '"."' || "table_name" || '"')::regclass, 'pg_class') AS table_comment FROM "information_schema"."tables" WHERE `+e.map(kr=>this.driver.parseTableName(kr)).map(({schema:kr,tableName:Gr})=>`("table_schema" = '${kr||I}' AND "table_name" = '${Gr}')`).join(" OR ");tr.push(...await this.query(xr))}if(tr.length===0)return[];const ir=`SELECT columns.*, pg_catalog.col_description(('"' || table_catalog || '"."' || table_schema || '"."' || table_name || '"')::regclass::oid, ordinal_position) AS description, ('"' || "udt_schema" || '"."' || "udt_name" || '"')::"regtype" AS "regtype", pg_catalog.format_type("col_attr"."atttypid", "col_attr"."atttypmod") AS "format_type" FROM "information_schema"."columns" LEFT JOIN "pg_catalog"."pg_attribute" AS "col_attr" ON "col_attr"."attname" = "columns"."column_name" AND "col_attr"."attrelid" = ( SELECT "cls"."oid" FROM "pg_catalog"."pg_class" AS "cls" LEFT JOIN "pg_catalog"."pg_namespace" AS "ns" ON "ns"."oid" = "cls"."relnamespace" WHERE "cls"."relname" = "columns"."table_name" AND "ns"."nspname" = "columns"."table_schema" ) WHERE `+tr.map(({table_schema:vr,table_name:xr})=>`("table_schema" = '${vr}' AND "table_name" = '${xr}')`).join(" OR "),lr=tr.map(({table_schema:vr,table_name:xr})=>`("ns"."nspname" = '${vr}' AND "t"."relname" = '${xr}')`).join(" OR "),dr=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN 'p' THEN 'PRIMARY' WHEN 'u' THEN 'UNIQUE' WHEN 'c' THEN 'CHECK' WHEN 'x' THEN 'EXCLUDE' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" IN ('r', 'p') AND (${lr})`,mr=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN 't' THEN 'TRUE' ELSE'FALSE' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name", "am"."amname" AS "index_type" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" INNER JOIN "pg_am" "am" ON "i"."relam" = "am"."oid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN ('r', 'p') AND "cnst"."contype" IS NULL AND (${lr})`,hr=tr.map(({table_schema:vr,table_name:xr})=>`("ns"."nspname" = '${vr}' AND "cl"."relname" = '${xr}')`).join(" OR "),_r=await this.hasSupportForPartitionedTables()?` AND "cl"."relispartition" = 'f'`:"",gr=`SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update", "con"."condeferrable" AS "deferrable", "con"."condeferred" AS "deferred" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", "con1"."condeferrable", CASE WHEN "con1"."condeferred" THEN 'INITIALLY DEFERRED' ELSE 'INITIALLY IMMEDIATE' END as condeferred, CASE "con1"."confdeltype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confdeltype", CASE "con1"."confupdtype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = 'f' AND (${hr}) ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" ${_r}INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"`,[Sr,Ar,Or,Fr]=await Promise.all([this.query(ir),this.query(dr),this.query(mr),this.query(gr)]);return Promise.all(tr.map(async vr=>{const xr=new Table,kr=(Ur,Lr)=>Ur[Lr]===I&&(!this.driver.options.schema||this.driver.options.schema===I)?void 0:Ur[Lr],Gr=kr(vr,"table_schema");xr.database=B,xr.schema=vr.table_schema,xr.comment=vr.table_comment,xr.name=this.driver.buildTableName(vr.table_name,Gr),xr.columns=await Promise.all(Sr.filter(Ur=>Ur.table_name===vr.table_name&&Ur.table_schema===vr.table_schema).map(async Ur=>{const Lr=Ar.filter(os=>os.table_name===Ur.table_name&&os.table_schema===Ur.table_schema&&os.column_name===Ur.column_name),ts=new TableColumn;if(ts.name=Ur.column_name,ts.type=Ur.regtype.toLowerCase(),ts.type==="numeric"||ts.type==="numeric[]"||ts.type==="decimal"||ts.type==="float"){let os=Ur.numeric_precision,us=Ur.numeric_scale;if(Ur.data_type==="ARRAY"){const ys=Ur.format_type.match(/^numeric\(([0-9]+),([0-9]+)\)\[\]$/);ys&&(os=+ys[1],us=+ys[2])}os!==null&&!this.isDefaultColumnPrecision(xr,ts,os)?ts.precision=os:us!==null&&!this.isDefaultColumnScale(xr,ts,us)&&(ts.precision=void 0),us!==null&&!this.isDefaultColumnScale(xr,ts,us)?ts.scale=us:os!==null&&!this.isDefaultColumnPrecision(xr,ts,os)&&(ts.scale=void 0)}if((ts.type==="interval"||ts.type==="time without time zone"||ts.type==="time with time zone"||ts.type==="timestamp without time zone"||ts.type==="timestamp with time zone")&&(ts.precision=this.isDefaultColumnPrecision(xr,ts,Ur.datetime_precision)?void 0:Ur.datetime_precision),Ur.data_type==="USER-DEFINED"||Ur.data_type==="ARRAY"){const{name:os}=await this.getUserDefinedTypeName(xr,ts),ys=this.buildEnumName(xr,ts,!1,!0)!==os?os:void 0,bs=`SELECT "e"."enumlabel" AS "value" FROM "pg_enum" "e" INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${vr.table_schema}' AND "t"."typname" = '${ys||os}'`,As=await this.query(bs);if(As.length&&(ts.type="enum",ts.enum=As.map(vs=>vs.value),ts.enumName=ys),Ur.data_type==="ARRAY"){ts.isArray=!0;const vs=ts.type.replace("[]","");ts.type=this.connection.driver.normalizeType({type:vs})}}if(ts.type==="geometry"||ts.type==="geography"){const os=`SELECT * FROM (SELECT "f_table_schema" "table_schema", "f_table_name" "table_name", "f_${ts.type}_column" "column_name", "srid", "type" FROM "${ts.type}_columns") AS _ WHERE "column_name" = '${Ur.column_name}' AND "table_schema" = '${Ur.table_schema}' AND "table_name" = '${Ur.table_name}'`,us=await this.query(os);us.length>0&&(ts.spatialFeatureType=us[0].type,ts.srid=us[0].srid)}if(this.driver.withLengthColumnTypes.indexOf(ts.type)!==-1){let os;if(ts.isArray){const us=/\((\d+)\)/.exec(Ur.format_type);os=us?us[1]:void 0}else Ur.character_maximum_length&&(os=Ur.character_maximum_length.toString());os&&(ts.length=this.isDefaultColumnLength(xr,ts,os)?"":os)}ts.isNullable=Ur.is_nullable==="YES";const rs=Lr.find(os=>os.constraint_type==="PRIMARY");if(rs){ts.isPrimary=!0;const us=Ar.filter(bs=>bs.table_name===Ur.table_name&&bs.table_schema===Ur.table_schema&&bs.column_name!==Ur.column_name&&bs.constraint_type==="PRIMARY").map(bs=>bs.column_name);us.push(Ur.column_name);const ys=this.connection.namingStrategy.primaryKeyName(xr,us);rs.constraint_name!==ys&&(ts.primaryKeyConstraintName=rs.constraint_name)}const ss=Lr.filter(os=>os.constraint_type==="UNIQUE"),ls=ss.every(os=>Ar.some(us=>us.constraint_type==="UNIQUE"&&us.constraint_name===os.constraint_name&&us.column_name!==Ur.column_name));if(ts.isUnique=ss.length>0&&!ls,Ur.is_identity==="YES")ts.isGenerated=!0,ts.generationStrategy="identity",ts.generatedIdentity=Ur.identity_generation;else if(Ur.column_default!==null&&Ur.column_default!==void 0){const os=`nextval('${this.buildSequenceName(xr,Ur.column_name)}'::regclass)`,us=`nextval('${this.buildSequencePath(xr,Ur.column_name)}'::regclass)`,ys=Ur.column_default.replace(/"/g,"");ys===os||ys===us?(ts.isGenerated=!0,ts.generationStrategy="increment"):Ur.column_default==="gen_random_uuid()"||/^uuid_generate_v\d\(\)/.test(Ur.column_default)?ts.type==="uuid"?(ts.isGenerated=!0,ts.generationStrategy="uuid"):ts.default=Ur.column_default:Ur.column_default==="now()"||Ur.column_default.indexOf("'now'::text")!==-1?ts.default=Ur.column_default:(ts.default=Ur.column_default.replace(/::[\w\s.[\]\-"]+/g,""),ts.default=ts.default.replace(/^(-?\d+)$/,"'$1'"))}if(Ur.is_generated==="ALWAYS"&&Ur.generation_expression){ts.generatedType="STORED";const os=this.selectTypeormMetadataSql({database:B,schema:vr.table_schema,table:vr.table_name,type:MetadataTableType.GENERATED_COLUMN,name:ts.name}),us=await this.query(os.query,os.parameters);us[0]&&us[0].value?ts.asExpression=us[0].value:ts.asExpression=""}return ts.comment=Ur.description?Ur.description:void 0,Ur.character_set_name&&(ts.charset=Ur.character_set_name),Ur.collation_name&&(ts.collation=Ur.collation_name),ts}));const is=OrmUtils.uniq(Ar.filter(Ur=>Ur.table_name===vr.table_name&&Ur.table_schema===vr.table_schema&&Ur.constraint_type==="UNIQUE"),Ur=>Ur.constraint_name);xr.uniques=is.map(Ur=>{const Lr=Ar.filter(ts=>ts.constraint_name===Ur.constraint_name);return new TableUnique({name:Ur.constraint_name,columnNames:Lr.map(ts=>ts.column_name),deferrable:Ur.deferrable?Ur.deferred:void 0})});const as=OrmUtils.uniq(Ar.filter(Ur=>Ur.table_name===vr.table_name&&Ur.table_schema===vr.table_schema&&Ur.constraint_type==="CHECK"),Ur=>Ur.constraint_name);xr.checks=as.map(Ur=>{const Lr=Ar.filter(ts=>ts.constraint_name===Ur.constraint_name);return new TableCheck({name:Ur.constraint_name,columnNames:Lr.map(ts=>ts.column_name),expression:Ur.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})});const cs=OrmUtils.uniq(Ar.filter(Ur=>Ur.table_name===vr.table_name&&Ur.table_schema===vr.table_schema&&Ur.constraint_type==="EXCLUDE"),Ur=>Ur.constraint_name);xr.exclusions=cs.map(Ur=>new TableExclusion({name:Ur.constraint_name,expression:Ur.expression.substring(8)}));const es=OrmUtils.uniq(Fr.filter(Ur=>Ur.table_name===vr.table_name&&Ur.table_schema===vr.table_schema),Ur=>Ur.constraint_name);xr.foreignKeys=es.map(Ur=>{const Lr=Fr.filter(ss=>ss.constraint_name===Ur.constraint_name),ts=kr(Ur,"referenced_table_schema"),rs=this.driver.buildTableName(Ur.referenced_table_name,ts);return new TableForeignKey({name:Ur.constraint_name,columnNames:Lr.map(ss=>ss.column_name),referencedSchema:Ur.referenced_table_schema,referencedTableName:rs,referencedColumnNames:Lr.map(ss=>ss.referenced_column_name),onDelete:Ur.on_delete,onUpdate:Ur.on_update,deferrable:Ur.deferrable?Ur.deferred:void 0})});const ps=OrmUtils.uniq(Or.filter(Ur=>Ur.table_name===vr.table_name&&Ur.table_schema===vr.table_schema),Ur=>Ur.constraint_name);return xr.indices=ps.map(Ur=>{const Lr=Or.filter(ts=>ts.table_schema===Ur.table_schema&&ts.table_name===Ur.table_name&&ts.constraint_name===Ur.constraint_name);return new TableIndex({table:xr,name:Ur.constraint_name,columnNames:Lr.map(ts=>ts.column_name),isUnique:Ur.is_unique==="TRUE",where:Ur.condition,isSpatial:Ur.index_type==="gist",isFulltext:!1})}),xr}))}createTableSql(e,I){const B=e.columns.map(ir=>this.buildCreateColumnSql(e,ir)).join(", ");let tr=`CREATE TABLE ${this.escapePath(e)} (${B}`;if(e.columns.filter(ir=>ir.isUnique).forEach(ir=>{e.uniques.some(dr=>dr.columnNames.length===1&&dr.columnNames[0]===ir.name)||e.uniques.push(new TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(e,[ir.name]),columnNames:[ir.name]}))}),e.uniques.length>0){const ir=e.uniques.map(lr=>{const dr=lr.name?lr.name:this.connection.namingStrategy.uniqueConstraintName(e,lr.columnNames),mr=lr.columnNames.map(fr=>`"${fr}"`).join(", ");let hr=`CONSTRAINT "${dr}" UNIQUE (${mr})`;return lr.deferrable&&(hr+=` DEFERRABLE ${lr.deferrable}`),hr}).join(", ");tr+=`, ${ir}`}if(e.checks.length>0){const ir=e.checks.map(lr=>`CONSTRAINT "${lr.name?lr.name:this.connection.namingStrategy.checkConstraintName(e,lr.expression)}" CHECK (${lr.expression})`).join(", ");tr+=`, ${ir}`}if(e.exclusions.length>0){const ir=e.exclusions.map(lr=>`CONSTRAINT "${lr.name?lr.name:this.connection.namingStrategy.exclusionConstraintName(e,lr.expression)}" EXCLUDE ${lr.expression}`).join(", ");tr+=`, ${ir}`}if(e.foreignKeys.length>0&&I){const ir=e.foreignKeys.map(lr=>{const dr=lr.columnNames.map(fr=>`"${fr}"`).join(", ");lr.name||(lr.name=this.connection.namingStrategy.foreignKeyName(e,lr.columnNames,this.getTablePath(lr),lr.referencedColumnNames));const mr=lr.referencedColumnNames.map(fr=>`"${fr}"`).join(", ");let hr=`CONSTRAINT "${lr.name}" FOREIGN KEY (${dr}) REFERENCES ${this.escapePath(this.getTablePath(lr))} (${mr})`;return lr.onDelete&&(hr+=` ON DELETE ${lr.onDelete}`),lr.onUpdate&&(hr+=` ON UPDATE ${lr.onUpdate}`),lr.deferrable&&(hr+=` DEFERRABLE ${lr.deferrable}`),hr}).join(", ");tr+=`, ${ir}`}const rr=e.columns.filter(ir=>ir.isPrimary);if(rr.length>0){const ir=rr[0].primaryKeyConstraintName?rr[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(e,rr.map(dr=>dr.name)),lr=rr.map(dr=>`"${dr.name}"`).join(", ");tr+=`, CONSTRAINT "${ir}" PRIMARY KEY (${lr})`}return tr+=")",e.columns.filter(ir=>ir.comment).forEach(ir=>tr+=`; COMMENT ON COLUMN ${this.escapePath(e)}."${ir.name}" IS ${this.escapeComment(ir.comment)}`),new Query(tr)}async getVersion(){return(await this.query("SELECT version()"))[0].version.replace(/^PostgreSQL ([\d.]+) .*$/,"$1")}dropTableSql(e){return new Query(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const I=e.materialized?"MATERIALIZED ":"",B=this.escapePath(e);return typeof e.expression=="string"?new Query(`CREATE ${I}VIEW ${B} AS ${e.expression}`):new Query(`CREATE ${I}VIEW ${B} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const I=await this.getCurrentSchema();let{schema:B,tableName:tr}=this.driver.parseTableName(e);B||(B=I);const rr=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW,ir=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:rr,schema:B,name:tr,value:ir})}dropViewSql(e){const I=e.materialized?"MATERIALIZED ":"";return new Query(`DROP ${I}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const I=await this.getCurrentSchema();let{schema:B,tableName:tr}=this.driver.parseTableName(e);B||(B=I);const rr=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW;return this.deleteTypeormMetadataSql({type:rr,schema:B,name:tr})}async dropEnumTypes(e){const I=`SELECT 'DROP TYPE IF EXISTS "' || n.nspname || '"."' || t.typname || '" CASCADE;' as "query" FROM "pg_type" "t" INNER JOIN "pg_enum" "e" ON "e"."enumtypid" = "t"."oid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" IN (${e}) GROUP BY "n"."nspname", "t"."typname"`,B=await this.query(I);await Promise.all(B.map(tr=>this.query(tr.query)))}async hasEnumType(e,I){let{schema:B}=this.driver.parseTableName(e);B||(B=await this.getCurrentSchema());const tr=this.buildEnumName(e,I,!1,!0),rr=`SELECT "n"."nspname", "t"."typname" FROM "pg_type" "t" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${B}' AND "t"."typname" = '${tr}'`;return!!(await this.query(rr)).length}createEnumTypeSql(e,I,B){B||(B=this.buildEnumName(e,I));const tr=I.enum.map(rr=>`'${rr.replace("'","''")}'`).join(", ");return new Query(`CREATE TYPE ${B} AS ENUM(${tr})`)}dropEnumTypeSql(e,I,B){return B||(B=this.buildEnumName(e,I)),new Query(`DROP TYPE ${B}`)}createIndexSql(e,I){const B=I.columnNames.map(tr=>`"${tr}"`).join(", ");return new Query(`CREATE ${I.isUnique?"UNIQUE ":""}INDEX${I.isConcurrent?" CONCURRENTLY":""} "${I.name}" ON ${this.escapePath(e)} ${I.isSpatial?"USING GiST ":""}(${B}) ${I.where?"WHERE "+I.where:""}`)}createViewIndexSql(e,I){const B=I.columnNames.map(tr=>`"${tr}"`).join(", ");return new Query(`CREATE ${I.isUnique?"UNIQUE ":""}INDEX "${I.name}" ON ${this.escapePath(e)} (${B}) ${I.where?"WHERE "+I.where:""}`)}dropIndexSql(e,I){const B=InstanceChecker.isTableIndex(I)?I.name:I,tr=InstanceChecker.isTableIndex(I)?I.isConcurrent:!1,{schema:rr}=this.driver.parseTableName(e);return rr?new Query(`DROP INDEX ${tr?"CONCURRENTLY ":""}"${rr}"."${B}"`):new Query(`DROP INDEX ${tr?"CONCURRENTLY ":""}"${B}"`)}createPrimaryKeySql(e,I,B){const tr=B||this.connection.namingStrategy.primaryKeyName(e,I),rr=I.map(ir=>`"${ir}"`).join(", ");return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${tr}" PRIMARY KEY (${rr})`)}dropPrimaryKeySql(e){if(!e.primaryColumns.length)throw new TypeORMError(`Table ${e} has no primary keys.`);const I=e.primaryColumns.map(rr=>rr.name),B=e.primaryColumns[0].primaryKeyConstraintName,tr=B||this.connection.namingStrategy.primaryKeyName(e,I);return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${tr}"`)}createUniqueConstraintSql(e,I){const B=I.columnNames.map(rr=>'"'+rr+'"').join(", ");let tr=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" UNIQUE (${B})`;return I.deferrable&&(tr+=` DEFERRABLE ${I.deferrable}`),new Query(tr)}dropUniqueConstraintSql(e,I){const B=InstanceChecker.isTableUnique(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${B}"`)}createCheckConstraintSql(e,I){return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" CHECK (${I.expression})`)}dropCheckConstraintSql(e,I){const B=InstanceChecker.isTableCheck(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${B}"`)}createExclusionConstraintSql(e,I){return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" EXCLUDE ${I.expression}`)}dropExclusionConstraintSql(e,I){const B=InstanceChecker.isTableExclusion(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${B}"`)}createForeignKeySql(e,I){const B=I.columnNames.map(ir=>'"'+ir+'"').join(", "),tr=I.referencedColumnNames.map(ir=>'"'+ir+'"').join(",");let rr=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${I.name}" FOREIGN KEY (${B}) REFERENCES ${this.escapePath(this.getTablePath(I))}(${tr})`;return I.onDelete&&(rr+=` ON DELETE ${I.onDelete}`),I.onUpdate&&(rr+=` ON UPDATE ${I.onUpdate}`),I.deferrable&&(rr+=` DEFERRABLE ${I.deferrable}`),new Query(rr)}dropForeignKeySql(e,I){const B=InstanceChecker.isTableForeignKey(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${B}"`)}buildSequenceName(e,I){const{tableName:B}=this.driver.parseTableName(e),tr=InstanceChecker.isTableColumn(I)?I.name:I;let rr=`${B}_${tr}_seq`;return rr.length>this.connection.driver.maxAliasLength&&(rr=`${B.substring(0,29)}_${tr.substring(0,Math.max(29,63-e.name.length-5))}_seq`),rr}buildSequencePath(e,I){const{schema:B}=this.driver.parseTableName(e);return B?`${B}.${this.buildSequenceName(e,I)}`:this.buildSequenceName(e,I)}buildEnumName(e,I,B=!0,tr,rr){const{schema:ir,tableName:lr}=this.driver.parseTableName(e);let dr=I.enumName?I.enumName:`${lr}_${I.name.toLowerCase()}_enum`;return ir&&B&&(dr=`${ir}.${dr}`),rr&&(dr=dr+"_old"),dr.split(".").map(mr=>tr?mr:`"${mr}"`).join(".")}async getUserDefinedTypeName(e,I){let{schema:B,tableName:tr}=this.driver.parseTableName(e);B||(B=await this.getCurrentSchema());const rr=await this.query(`SELECT "udt_schema", "udt_name" FROM "information_schema"."columns" WHERE "table_schema" = '${B}' AND "table_name" = '${tr}' AND "column_name"='${I.name}'`);let ir=rr[0].udt_name;return ir.indexOf("_")===0&&(ir=ir.substr(1,ir.length)),{schema:rr[0].udt_schema,name:ir}}escapeComment(e){return!e||e.length===0?"NULL":(e=e.replace(/'/g,"''").replace(/\u0000/g,""),`'${e}'`)}escapePath(e){const{schema:I,tableName:B}=this.driver.parseTableName(e);return I&&I!==this.driver.searchSchema?`"${I}"."${B}"`:`"${B}"`}async getTableNameWithSchema(e){const I=InstanceChecker.isTable(e)?e.name:e;return I.indexOf(".")===-1?`${(await this.query("SELECT current_schema()"))[0].current_schema}.${I}`:`${I.split(".")[0]}.${I.split(".")[1]}`}buildCreateColumnSql(e,I){let B='"'+I.name+'"';if(I.isGenerated===!0&&I.generationStrategy!=="uuid")if(I.generationStrategy==="identity"){const tr=I.generatedIdentity||"BY DEFAULT";B+=` ${I.type} GENERATED ${tr} AS IDENTITY`}else(I.type==="integer"||I.type==="int"||I.type==="int4")&&(B+=" SERIAL"),(I.type==="smallint"||I.type==="int2")&&(B+=" SMALLSERIAL"),(I.type==="bigint"||I.type==="int8")&&(B+=" BIGSERIAL");return I.type==="enum"||I.type==="simple-enum"?(B+=" "+this.buildEnumName(e,I),I.isArray&&(B+=" array")):(!I.isGenerated||I.type==="uuid")&&(B+=" "+this.connection.driver.createFullType(I)),I.generatedType==="STORED"&&I.asExpression&&(B+=` GENERATED ALWAYS AS (${I.asExpression}) STORED`),I.charset&&(B+=' CHARACTER SET "'+I.charset+'"'),I.collation&&(B+=' COLLATE "'+I.collation+'"'),I.isNullable!==!0&&(B+=" NOT NULL"),I.default!==void 0&&I.default!==null&&(B+=" DEFAULT "+I.default),I.isGenerated&&I.generationStrategy==="uuid"&&!I.default&&(B+=` DEFAULT ${this.driver.uuidGenerator}`),B}async hasSupportForPartitionedTables(){return!!(await this.query("SELECT TRUE FROM information_schema.columns WHERE table_name = 'pg_class' and column_name = 'relispartition'")).length}async changeTableComment(e,I){const B=[],tr=[],rr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I=this.escapeComment(I);const ir=this.escapeComment(rr.comment);if(I===ir)return;const lr=rr.clone();B.push(new Query(`COMMENT ON TABLE ${this.escapePath(lr)} IS ${I}`)),tr.push(new Query(`COMMENT ON TABLE ${this.escapePath(rr)} IS ${ir}`)),await this.executeQueries(B,tr),rr.comment=lr.comment,this.replaceCachedTable(rr,lr)}}class PostgresDriver{constructor(e){this.slaves=[],this.connectedQueryRunners=[],this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","int2","int4","int8","smallint","integer","bigint","decimal","numeric","real","float","float4","float8","double precision","money","character varying","varchar","character","char","text","citext","hstore","bytea","bit","varbit","bit varying","timetz","timestamptz","timestamp","timestamp without time zone","timestamp with time zone","date","time","time without time zone","time with time zone","interval","bool","boolean","enum","point","line","lseg","box","path","polygon","circle","cidr","inet","macaddr","tsvector","tsquery","uuid","xml","json","jsonb","int4range","int8range","numrange","tsrange","tstzrange","daterange","int4multirange","int8multirange","nummultirange","tsmultirange","tstzmultirange","datemultirange","geometry","geography","cube","ltree"],this.supportedUpsertTypes=["on-conflict-do-update"],this.spatialTypes=["geometry","geography"],this.withLengthColumnTypes=["character varying","varchar","character","char","bit","varbit","bit varying"],this.withPrecisionColumnTypes=["numeric","decimal","interval","time without time zone","time with time zone","timestamp without time zone","timestamp with time zone"],this.withScaleColumnTypes=["numeric","decimal"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"now()",updateDate:"timestamp",updateDateDefault:"now()",deleteDate:"timestamp",deleteDateNullable:!0,version:"int4",treeLevel:"int4",migrationId:"int4",migrationName:"varchar",migrationTimestamp:"int8",cacheId:"int4",cacheIdentifier:"varchar",cacheTime:"int8",cacheDuration:"int4",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.parametersPrefix="$",this.dataTypeDefaults={character:{length:1},bit:{length:1},interval:{precision:6},"time without time zone":{precision:6},"time with time zone":{precision:6},"timestamp without time zone":{precision:6},"timestamp with time zone":{precision:6}},this.maxAliasLength=63,this.isGeneratedColumnsSupported=!1,this.cteCapabilities={enabled:!0,writable:!0,requiresRecursiveHint:!0,materializedHint:!0},e&&(this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.options.useUTC,this.loadDependencies(),this.database=DriverUtils.buildDriverOptions(this.options.replication?this.options.replication.master:this.options).database,this.schema=DriverUtils.buildDriverOptions(this.options).schema)}async connect(){if(this.options.replication?(this.slaves=await Promise.all(this.options.replication.slaves.map(e=>this.createPool(this.options,e))),this.master=await this.createPool(this.options,this.options.replication.master)):this.master=await this.createPool(this.options,this.options),!this.database||!this.searchSchema){const e=await this.createQueryRunner("master");this.database||(this.database=await e.getCurrentDatabase()),this.searchSchema||(this.searchSchema=await e.getCurrentSchema()),await e.release()}this.schema||(this.schema=this.searchSchema)}async afterConnect(){const e=await this.checkMetadataForExtensions(),[I,B]=await this.obtainMasterConnection();(this.options.installExtensions===void 0||this.options.installExtensions)&&e.hasExtensions&&await this.enableExtensions(e,I);const ir=(await this.executeQuery(I,"SELECT version();")).rows[0].version.replace(/^PostgreSQL ([\d.]+) .*$/,"$1");this.version=ir,this.isGeneratedColumnsSupported=VersionUtils.isGreaterOrEqual(ir,"12.0"),await B()}async enableExtensions(e,I){const{logger:B}=this.connection,{hasUuidColumns:tr,hasCitextColumns:rr,hasHstoreColumns:ir,hasCubeColumns:lr,hasGeometryColumns:dr,hasLtreeColumns:mr,hasExclusionConstraints:hr}=e;if(tr)try{await this.executeQuery(I,`CREATE EXTENSION IF NOT EXISTS "${this.options.uuidExtension||"uuid-ossp"}"`)}catch{B.log("warn",`At least one of the entities has uuid column, but the '${this.options.uuidExtension||"uuid-ossp"}' extension cannot be installed automatically. Please install it manually using superuser rights, or select another uuid extension.`)}if(rr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "citext"')}catch{B.log("warn","At least one of the entities has citext column, but the 'citext' extension cannot be installed automatically. Please install it manually using superuser rights")}if(ir)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "hstore"')}catch{B.log("warn","At least one of the entities has hstore column, but the 'hstore' extension cannot be installed automatically. Please install it manually using superuser rights")}if(dr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "postgis"')}catch{B.log("warn","At least one of the entities has a geometry column, but the 'postgis' extension cannot be installed automatically. Please install it manually using superuser rights")}if(lr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "cube"')}catch{B.log("warn","At least one of the entities has a cube column, but the 'cube' extension cannot be installed automatically. Please install it manually using superuser rights")}if(mr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "ltree"')}catch{B.log("warn","At least one of the entities has a ltree column, but the 'ltree' extension cannot be installed automatically. Please install it manually using superuser rights")}if(hr)try{await this.executeQuery(I,'CREATE EXTENSION IF NOT EXISTS "btree_gist"')}catch{B.log("warn","At least one of the entities has an exclusion constraint, but the 'btree_gist' extension cannot be installed automatically. Please install it manually using superuser rights")}}async checkMetadataForExtensions(){const e=this.connection.entityMetadatas.some(dr=>dr.generatedColumns.filter(mr=>mr.generationStrategy==="uuid").length>0),I=this.connection.entityMetadatas.some(dr=>dr.columns.filter(mr=>mr.type==="citext").length>0),B=this.connection.entityMetadatas.some(dr=>dr.columns.filter(mr=>mr.type==="hstore").length>0),tr=this.connection.entityMetadatas.some(dr=>dr.columns.filter(mr=>mr.type==="cube").length>0),rr=this.connection.entityMetadatas.some(dr=>dr.columns.filter(mr=>this.spatialTypes.indexOf(mr.type)>=0).length>0),ir=this.connection.entityMetadatas.some(dr=>dr.columns.filter(mr=>mr.type==="ltree").length>0),lr=this.connection.entityMetadatas.some(dr=>dr.exclusions.length>0);return{hasUuidColumns:e,hasCitextColumns:I,hasHstoreColumns:B,hasCubeColumns:tr,hasGeometryColumns:rr,hasLtreeColumns:ir,hasExclusionConstraints:lr,hasExtensions:e||I||B||rr||tr||ir||lr}}async disconnect(){if(!this.master)return Promise.reject(new ConnectionIsNotSetError("postgres"));await this.closePool(this.master),await Promise.all(this.slaves.map(e=>this.closePool(e))),this.master=void 0,this.slaves=[]}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}createQueryRunner(e){return new PostgresQueryRunner(this,e)}preparePersistentValue(e,I){if(I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null)return e;if(I.type===Boolean)return e===!0?1:0;if(I.type==="date")return DateUtils.mixedDateToDateString(e);if(I.type==="time")return DateUtils.mixedDateToTimeString(e);if(I.type==="datetime"||I.type===Date||I.type==="timestamp"||I.type==="timestamp with time zone"||I.type==="timestamp without time zone")return DateUtils.mixedDateToDate(e);if(["json","jsonb",...this.spatialTypes].indexOf(I.type)>=0)return JSON.stringify(e);if(I.type==="hstore"){if(typeof e=="string")return e;{const B=tr=>tr===null||typeof tr>"u"?"NULL":`"${`${tr}`.replace(/(?=["\\])/g,"\\")}"`;return Object.keys(e).map(tr=>B(tr)+"=>"+B(e[tr])).join(",")}}else{if(I.type==="simple-array")return DateUtils.simpleArrayToString(e);if(I.type==="simple-json")return DateUtils.simpleJsonToString(e);if(I.type==="cube")return I.isArray?`{${e.map(B=>`"(${B.join(",")})"`).join(",")}}`:`(${e.join(",")})`;if(I.type==="ltree")return e.split(".").filter(Boolean).join(".").replace(/[\s]+/g,"_");if((I.type==="enum"||I.type==="simple-enum")&&!I.isArray)return""+e}return e}prepareHydratedValue(e,I){if(e==null)return I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e;if(I.type===Boolean)e=!!e;else if(I.type==="datetime"||I.type===Date||I.type==="timestamp"||I.type==="timestamp with time zone"||I.type==="timestamp without time zone")e=DateUtils.normalizeHydratedDate(e);else if(I.type==="date")e=DateUtils.mixedDateToDateString(e);else if(I.type==="time")e=DateUtils.mixedTimeToString(e);else if(I.type==="hstore"){if(I.hstoreType==="object"){const B=ir=>ir.replace(/\\./g,lr=>lr[1]),tr=/"([^"\\]*(?:\\.[^"\\]*)*)"=>(?:(NULL)|"([^"\\]*(?:\\.[^"\\]*)*)")(?:,|$)/g,rr={};`${e}`.replace(tr,(ir,lr,dr,mr)=>(rr[B(lr)]=dr?null:B(mr),"")),e=rr}}else if(I.type==="simple-array")e=DateUtils.stringToSimpleArray(e);else if(I.type==="simple-json")e=DateUtils.stringToSimpleJson(e);else if(I.type==="cube")if(e=e.replace(/[()\s]+/g,""),I.isArray){const B=/(?:"((?:[\d\s.,])*)")|(?:(NULL))/g,tr=e;e=[];let rr=null;for(;(rr=B.exec(tr))!==null;)rr[1]!==void 0?e.push(rr[1].split(",").filter(Boolean).map(Number)):e.push(void 0)}else e=e.split(",").filter(Boolean).map(Number);else if(I.type==="enum"||I.type==="simple-enum")if(I.isArray){if(e==="{}")return[];e=e.substr(1,e.length-2).split(",").map(B=>(B.startsWith('"')&&B.endsWith('"')&&(B=B.slice(1,-1)),B=B.replace(/(\\\\)/g,"\\"),B.replace(/(\\")/g,'"'))),e=e.map(B=>!isNaN(+B)&&I.enum.indexOf(parseInt(B))>=0?parseInt(B):B)}else e=!isNaN(+e)&&I.enum.indexOf(parseInt(e))>=0?parseInt(e):e;else I.type===Number&&(e=isNaN(+e)?e:parseInt(e));return I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e}escapeQueryWithParameters(e,I,B){const tr=Object.keys(B).map(ir=>B[ir]);if(!I||!Object.keys(I).length)return[e,tr];const rr=new Map;return e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(ir,lr,dr)=>{if(!I.hasOwnProperty(dr))return ir;if(rr.has(dr))return this.parametersPrefix+rr.get(dr);let mr=I[dr];return lr?mr.map(hr=>(tr.push(hr),this.createParameter(dr,tr.length-1))).join(", "):typeof mr=="function"?mr():(tr.push(mr),rr.set(dr,tr.length),this.createParameter(dr,tr.length-1))}),[e,tr]}escape(e){return'"'+e+'"'}buildTableName(e,I){let B=[e];return I&&B.unshift(I),B.join(".")}parseTableName(e){const I=this.database,B=this.schema;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const rr=this.parseTableName(e.name);return{database:e.database||rr.database||I,schema:e.schema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isTableForeignKey(e)){const rr=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||rr.database||I,schema:e.referencedSchema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||B,tableName:e.tableName};const tr=e.split(".");return{database:I,schema:(tr.length>1?tr[0]:void 0)||B,tableName:tr.length>1?tr[1]:tr[0]}}normalizeType(e){return e.type===Number||e.type==="int"||e.type==="int4"?"integer":e.type===String||e.type==="varchar"?"character varying":e.type===Date||e.type==="timestamp"?"timestamp without time zone":e.type==="timestamptz"?"timestamp with time zone":e.type==="time"?"time without time zone":e.type==="timetz"?"time with time zone":e.type===Boolean||e.type==="bool"?"boolean":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"enum":e.type==="int2"?"smallint":e.type==="int8"?"bigint":e.type==="decimal"?"numeric":e.type==="float8"||e.type==="float"?"double precision":e.type==="float4"?"real":e.type==="char"?"character":e.type==="varbit"?"bit varying":e.type||""}normalizeDefault(e){const I=e.default;if(I!=null){if(e.isArray&&Array.isArray(I))return`'{${I.map(B=>`${B}`).join(",")}}'`;if((e.type==="enum"||e.type==="simple-enum"||typeof I=="number"||typeof I=="string")&&I!==void 0)return`'${I}'`;if(typeof I=="boolean")return I?"true":"false";if(typeof I=="function"){const B=I();return this.normalizeDatetimeFunction(B)}return typeof I=="object"?`'${JSON.stringify(I)}'`:`${I}`}}defaultEqual(e,I){if(["json","jsonb"].includes(e.type)&&!["function","undefined"].includes(typeof e.default)){const tr=typeof I.default=="string"?JSON.parse(I.default.substring(1,I.default.length-1)):I.default;return OrmUtils.deepCompare(e.default,tr)}return this.lowerDefaultValueIfNecessary(this.normalizeDefault(e))===I.default}normalizeIsUnique(e){return e.entityMetadata.uniques.some(I=>I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let I=e.type;return e.length?I+="("+e.length+")":e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+="("+e.precision+","+e.scale+")":e.precision!==null&&e.precision!==void 0&&(I+="("+e.precision+")"),e.type==="time without time zone"?I="TIME"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":""):e.type==="time with time zone"?I="TIME"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":"")+" WITH TIME ZONE":e.type==="timestamp without time zone"?I="TIMESTAMP"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":""):e.type==="timestamp with time zone"?I="TIMESTAMP"+(e.precision!==null&&e.precision!==void 0?"("+e.precision+")":"")+" WITH TIME ZONE":this.spatialTypes.indexOf(e.type)>=0&&(e.spatialFeatureType!=null&&e.srid!=null?I=`${e.type}(${e.spatialFeatureType},${e.srid})`:e.spatialFeatureType!=null?I=`${e.type}(${e.spatialFeatureType})`:I=e.type),e.isArray&&(I+=" array"),I}async obtainMasterConnection(){if(!this.master)throw new TypeORMError("Driver not Connected");return new Promise((e,I)=>{this.master.connect((B,tr,rr)=>{B?I(B):e([tr,rr])})})}async obtainSlaveConnection(){if(!this.slaves.length)return this.obtainMasterConnection();const e=Math.floor(Math.random()*this.slaves.length);return new Promise((I,B)=>{this.slaves[e].connect((tr,rr,ir)=>{tr?B(tr):I([rr,ir])})})}createGeneratedMap(e,I){if(I)return Object.keys(I).reduce((B,tr)=>{const rr=e.findColumnWithDatabaseName(tr);return rr&&OrmUtils.mergeDeep(B,rr.createValueMap(I[tr])),B},{})}findChangedColumns(e,I){return I.filter(B=>{const tr=e.find(ir=>ir.name===B.databaseName);return tr?tr.name!==B.databaseName||tr.type!==this.normalizeType(B)||tr.length!==B.length||tr.isArray!==B.isArray||tr.precision!==B.precision||B.scale!==void 0&&tr.scale!==B.scale||tr.comment!==this.escapeComment(B.comment)||!tr.isGenerated&&!this.defaultEqual(B,tr)||tr.isPrimary!==B.isPrimary||tr.isNullable!==B.isNullable||tr.isUnique!==this.normalizeIsUnique(B)||tr.enumName!==B.enumName||tr.enum&&B.enum&&!OrmUtils.isArraysEqual(tr.enum,B.enum.map(ir=>ir+""))||tr.isGenerated!==B.isGenerated||(tr.spatialFeatureType||"").toLowerCase()!==(B.spatialFeatureType||"").toLowerCase()||tr.srid!==B.srid||tr.generatedType!==B.generatedType||(tr.asExpression||"").trim()!==(B.asExpression||"").trim():!1})}lowerDefaultValueIfNecessary(e){return e&&e.split("'").map((I,B)=>B%2===1?I:I.toLowerCase()).join("'")}isReturningSqlSupported(){return!0}isUUIDGenerationSupported(){return!0}isFullTextColumnTypeSupported(){return!1}get uuidGenerator(){return this.options.uuidExtension==="pgcrypto"?"gen_random_uuid()":"uuid_generate_v4()"}createParameter(e,I){return this.parametersPrefix+(I+1)}loadStreamDependency(){try{return PlatformTools.load("pg-query-stream")}catch{throw new TypeORMError("To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.")}}loadDependencies(){try{const e=this.options.driver||PlatformTools.load("pg");this.postgres=e;try{(this.options.nativeDriver||PlatformTools.load("pg-native"))&&this.postgres.native&&(this.postgres=this.postgres.native)}catch{}}catch{throw new DriverPackageNotInstalledError("Postgres","pg")}}async createPool(e,I){const{logger:B}=this.connection;I=Object.assign({},I);const tr=Object.assign({},{connectionString:I.url,host:I.host,user:I.username,password:I.password,database:I.database,port:I.port,ssl:I.ssl,connectionTimeoutMillis:e.connectTimeoutMS,application_name:e.applicationName??I.applicationName,max:e.poolSize},e.extra||{});e.parseInt8!==void 0&&(this.postgres.defaults&&Object.getOwnPropertyDescriptor(this.postgres.defaults,"parseInt8")?.set?this.postgres.defaults.parseInt8=e.parseInt8:B.log("warn","Attempted to set parseInt8 option, but the postgres driver does not support setting defaults.parseInt8. This option will be ignored."));const rr=new this.postgres.Pool(tr),ir=e.poolErrorHandler||(lr=>B.log("warn",`Postgres pool raised an error. ${lr}`));return rr.on("error",ir),new Promise((lr,dr)=>{rr.connect((mr,hr,fr)=>{if(mr)return dr(mr);e.logNotifications&&(hr.on("notice",_r=>{_r&&this.connection.logger.log("info",_r.message)}),hr.on("notification",_r=>{_r&&this.connection.logger.log("info",`Received NOTIFY on channel ${_r.channel}: ${_r.payload}.`)})),fr(),lr(rr)})})}async closePool(e){for(;this.connectedQueryRunners.length;)await this.connectedQueryRunners[0].release();return new Promise((I,B)=>{e.end(tr=>tr?B(tr):I())})}executeQuery(e,I){return this.connection.logger.logQuery(I),new Promise((B,tr)=>{e.query(I,(rr,ir)=>rr?tr(rr):B(ir))})}normalizeDatetimeFunction(e){const I=e.toUpperCase();if(I.indexOf("CURRENT_TIMESTAMP")!==-1||I.indexOf("CURRENT_DATE")!==-1||I.indexOf("CURRENT_TIME")!==-1||I.indexOf("LOCALTIMESTAMP")!==-1||I.indexOf("LOCALTIME")!==-1){const tr=e.match(/\(\d+\)/);if(I.indexOf("CURRENT_TIMESTAMP")!==-1)return tr?`('now'::text)::timestamp${tr[0]} with time zone`:"now()";if(I==="CURRENT_DATE")return"('now'::text)::date";if(I.indexOf("CURRENT_TIME")!==-1)return tr?`('now'::text)::time${tr[0]} with time zone`:"('now'::text)::time with time zone";if(I.indexOf("LOCALTIMESTAMP")!==-1)return tr?`('now'::text)::timestamp${tr[0]} without time zone`:"('now'::text)::timestamp without time zone";if(I.indexOf("LOCALTIME")!==-1)return tr?`('now'::text)::time${tr[0]} without time zone`:"('now'::text)::time without time zone"}return e}escapeComment(e){return e&&(e=e.replace(/\u0000/g,""),e)}}class ExpoQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async startTransaction(){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive&&typeof this.transaction>"u")throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive&&typeof this.transaction>"u")throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async beforeMigration(){const e=await this.connect();return new Promise((I,B)=>{e.exec([{sql:"PRAGMA foreign_keys = OFF",args:[]}],!1,tr=>tr?B(tr):I())})}async afterMigration(){const e=await this.connect();return new Promise((I,B)=>{e.exec([{sql:"PRAGMA foreign_keys = ON",args:[]}],!1,tr=>tr?B(tr):I())})}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return new Promise(async(tr,rr)=>{const ir=await this.connect(),lr=new BroadcasterResult;this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(lr,e,I);const dr=+new Date;ir.transaction(async mr=>{typeof this.transaction>"u"&&(await this.startTransaction(),this.transaction=mr),this.transaction.executeSql(e,I,async(hr,fr)=>{const _r=this.driver.options.maxQueryExecutionTime,Sr=+new Date-dr;this.broadcaster.broadcastAfterQueryEvent(lr,e,I,!0,Sr,fr,void 0),await lr.wait(),_r&&Sr>_r&&this.driver.connection.logger.logQuerySlow(Sr,e,I,this);const Ar=new QueryResult;if(fr?.hasOwnProperty("rowsAffected")&&(Ar.affected=fr.rowsAffected),fr?.hasOwnProperty("rows")){let Or=[];for(let Fr=0;Fr<fr.rows.length;Fr++)Or.push(fr.rows.item(Fr));Ar.raw=Or,Ar.records=Or}e.startsWith("INSERT INTO")&&(Ar.raw=fr.insertId),tr(B?Ar:Ar.raw)},async(hr,fr)=>{this.driver.connection.logger.logQueryError(fr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(lr,e,I,!1,void 0,void 0,fr),await lr.wait(),rr(new QueryFailedError(e,I,fr))})},async mr=>{await this.rollbackTransaction(),rr(mr)},()=>{this.isTransactionActive=!1,this.transaction=void 0})})}}class ExpoDriver extends AbstractSqliteDriver{constructor(e){super(e),this.database=this.options.database,this.sqlite=this.options.driver}async disconnect(){return new Promise((e,I)=>{try{this.queryRunner=void 0,this.databaseConnection._db.close(),this.databaseConnection=void 0,e()}catch(B){I(B)}})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new ExpoQueryRunner(this)),this.queryRunner}createDatabaseConnection(){return new Promise((e,I)=>{try{const B=this.sqlite.openDatabase(this.options.database);B.transaction(tr=>{tr.executeSql("PRAGMA foreign_keys = ON",[],(rr,ir)=>{e(B)},(rr,ir)=>{I({transaction:rr,error:ir})})},tr=>{I(tr)})}catch(B){I(B)}})}}class AuroraMysqlQueryRunner extends BaseQueryRunner{constructor(e,I){super(),this.driver=e,this.connection=e.connection,this.client=I,this.broadcaster=new Broadcaster(this)}async connect(){return{}}release(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,await this.client.startTransaction()):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth-1}`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.commitTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.rollbackTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=await this.client.query(e,I),rr=new QueryResult;return rr.raw=tr,tr?.hasOwnProperty("records")&&Array.isArray(tr.records)&&(rr.records=tr.records),tr?.hasOwnProperty("numberOfRecordsUpdated")&&(rr.affected=tr.numberOfRecordsUpdated),B?rr:rr.raw}stream(e,I,B,tr){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return new Promise(async(rr,ir)=>{try{const dr=(await this.connect()).query(e,I);B&&dr.on("end",B),tr&&dr.on("error",tr),rr(dr)}catch(lr){ir(lr)}})}async getDatabases(){return Promise.resolve([])}async getSchemas(e){throw new TypeORMError("MySql driver does not support table schemas")}async hasDatabase(e){return!!(await this.query(`SELECT * FROM \`INFORMATION_SCHEMA\`.\`SCHEMATA\` WHERE \`SCHEMA_NAME\` = '${e}'`)).length}async getCurrentDatabase(){return(await this.query("SELECT DATABASE() AS `db_name`"))[0].db_name}async hasSchema(e){throw new TypeORMError("MySql driver does not support table schemas")}async getCurrentSchema(){return(await this.query("SELECT SCHEMA() AS `schema_name`"))[0].schema_name}async hasTable(e){const I=this.driver.parseTableName(e),B=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${I.database}' AND \`TABLE_NAME\` = '${I.tableName}'`;return!!(await this.query(B)).length}async hasColumn(e,I){const B=this.driver.parseTableName(e),tr=InstanceChecker.isTableColumn(I)?I.name:I,rr=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${B.database}' AND \`TABLE_NAME\` = '${B.tableName}' AND \`COLUMN_NAME\` = '${tr}'`;return!!(await this.query(rr)).length}async createDatabase(e,I){const B=I?`CREATE DATABASE IF NOT EXISTS \`${e}\``:`CREATE DATABASE \`${e}\``,tr=`DROP DATABASE \`${e}\``;await this.executeQueries(new Query(B),new Query(tr))}async dropDatabase(e,I){const B=I?`DROP DATABASE IF EXISTS \`${e}\``:`DROP DATABASE \`${e}\``,tr=`CREATE DATABASE \`${e}\``;await this.executeQueries(new Query(B),new Query(tr))}async createSchema(e,I){throw new TypeORMError("Schema create queries are not supported by MySql driver.")}async dropSchema(e,I){throw new TypeORMError("Schema drop queries are not supported by MySql driver.")}async createTable(e,I=!1,B=!0){if(I&&await this.hasTable(e))return Promise.resolve();const tr=[],rr=[];return tr.push(this.createTableSql(e,B)),rr.push(this.dropTableSql(e)),e.indices.forEach(ir=>rr.push(this.dropIndexSql(e,ir))),B&&e.foreignKeys.forEach(ir=>rr.push(this.dropForeignKeySql(e,ir))),this.executeQueries(tr,rr)}async dropTable(e,I,B=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const tr=B,rr=this.getTablePath(e),ir=await this.getCachedTable(rr),lr=[],dr=[];B&&ir.foreignKeys.forEach(mr=>lr.push(this.dropForeignKeySql(ir,mr))),ir.indices.forEach(mr=>lr.push(this.dropIndexSql(ir,mr))),lr.push(this.dropTableSql(ir)),dr.push(this.createTableSql(ir,tr)),await this.executeQueries(lr,dr)}async createView(e,I=!1){const B=[],tr=[];B.push(this.createViewSql(e)),I&&B.push(await this.insertViewDefinitionSql(e)),tr.push(this.dropViewSql(e)),I&&tr.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(B,tr)}async dropView(e){const I=InstanceChecker.isView(e)?e.name:e,B=await this.getCachedView(I),tr=[],rr=[];tr.push(await this.deleteViewDefinitionSql(B)),tr.push(this.dropViewSql(B)),rr.push(await this.insertViewDefinitionSql(B)),rr.push(this.createViewSql(B)),await this.executeQueries(tr,rr)}async renameTable(e,I){const B=[],tr=[],rr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),ir=rr.clone(),{database:lr}=this.driver.parseTableName(rr);ir.name=lr?`${lr}.${I}`:I,B.push(new Query(`RENAME TABLE ${this.escapePath(rr)} TO ${this.escapePath(ir)}`)),tr.push(new Query(`RENAME TABLE ${this.escapePath(ir)} TO ${this.escapePath(rr)}`)),ir.indices.forEach(dr=>{const mr=dr.columnNames.map(_r=>`\`${_r}\``).join(", "),hr=this.connection.namingStrategy.indexName(ir,dr.columnNames,dr.where);let fr="";dr.isUnique&&(fr+="UNIQUE "),dr.isSpatial&&(fr+="SPATIAL "),dr.isFulltext&&(fr+="FULLTEXT "),B.push(new Query(`ALTER TABLE ${this.escapePath(ir)} DROP INDEX \`${dr.name}\`, ADD ${fr}INDEX \`${hr}\` (${mr})`)),tr.push(new Query(`ALTER TABLE ${this.escapePath(ir)} DROP INDEX \`${hr}\`, ADD ${fr}INDEX \`${dr.name}\` (${mr})`)),dr.name=hr}),ir.foreignKeys.forEach(dr=>{const mr=dr.columnNames.map(Sr=>`\`${Sr}\``).join(", "),hr=dr.referencedColumnNames.map(Sr=>`\`${Sr}\``).join(","),fr=this.connection.namingStrategy.foreignKeyName(ir,dr.columnNames);let _r=`ALTER TABLE ${this.escapePath(ir)} DROP FOREIGN KEY \`${dr.name}\`, ADD CONSTRAINT \`${fr}\` FOREIGN KEY (${mr}) REFERENCES ${this.escapePath(this.getTablePath(dr))}(${hr})`;dr.onDelete&&(_r+=` ON DELETE ${dr.onDelete}`),dr.onUpdate&&(_r+=` ON UPDATE ${dr.onUpdate}`);let gr=`ALTER TABLE ${this.escapePath(ir)} DROP FOREIGN KEY \`${fr}\`, ADD CONSTRAINT \`${dr.name}\` FOREIGN KEY (${mr}) REFERENCES ${this.escapePath(this.getTablePath(dr))}(${hr})`;dr.onDelete&&(gr+=` ON DELETE ${dr.onDelete}`),dr.onUpdate&&(gr+=` ON UPDATE ${dr.onUpdate}`),B.push(new Query(_r)),tr.push(new Query(gr)),dr.name=fr}),await this.executeQueries(B,tr),rr.name=ir.name,this.replaceCachedTable(rr,ir)}async addColumn(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone(),rr=[],ir=[],lr=tr.primaryColumns.length>0;if(rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD ${this.buildCreateColumnSql(I,lr,!1)}`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP COLUMN \`${I.name}\``)),I.isPrimary&&lr){const mr=tr.columns.find(_r=>_r.isGenerated&&_r.generationStrategy==="increment");if(mr){const _r=mr.clone();_r.isGenerated=!1,_r.generationStrategy=void 0,rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${I.name}\` ${this.buildCreateColumnSql(_r,!0)}`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${_r.name}\` ${this.buildCreateColumnSql(I,!0)}`))}const hr=tr.primaryColumns;let fr=hr.map(_r=>`\`${_r.name}\``).join(", ");if(rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP PRIMARY KEY`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD PRIMARY KEY (${fr})`)),hr.push(I),fr=hr.map(_r=>`\`${_r.name}\``).join(", "),rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD PRIMARY KEY (${fr})`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP PRIMARY KEY`)),mr){const _r=mr.clone();_r.isGenerated=!1,_r.generationStrategy=void 0,rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${_r.name}\` ${this.buildCreateColumnSql(I,!0)}`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${I.name}\` ${this.buildCreateColumnSql(_r,!0)}`))}}const dr=tr.indices.find(mr=>mr.columnNames.length===1&&mr.columnNames[0]===I.name);if(dr)rr.push(this.createIndexSql(B,dr)),ir.push(this.dropIndexSql(B,dr));else if(I.isUnique){const mr=new TableIndex({name:this.connection.namingStrategy.indexName(B,[I.name]),columnNames:[I.name],isUnique:!0});tr.indices.push(mr),tr.uniques.push(new TableUnique({name:mr.name,columnNames:mr.columnNames})),rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD UNIQUE INDEX \`${mr.name}\` (\`${I.name}\`)`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP INDEX \`${mr.name}\``))}await this.executeQueries(rr,ir),tr.addColumn(I),this.replaceCachedTable(B,tr)}async addColumns(e,I){for(const B of I)await this.addColumn(e,B)}async renameColumn(e,I,B){const tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),rr=InstanceChecker.isTableColumn(I)?I:tr.columns.find(lr=>lr.name===I);if(!rr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);let ir;InstanceChecker.isTableColumn(B)?ir=B:(ir=rr.clone(),ir.name=B),await this.changeColumn(tr,rr,ir)}async changeColumn(e,I,B){const tr=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);let rr=tr.clone();const ir=[],lr=[],dr=InstanceChecker.isTableColumn(I)?I:tr.columns.find(mr=>mr.name===I);if(!dr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);if(B.isGenerated!==dr.isGenerated&&B.generationStrategy!=="uuid"||dr.type!==B.type||dr.length!==B.length||dr.generatedType!==B.generatedType)await this.dropColumn(tr,dr),await this.addColumn(tr,B),rr=tr.clone();else{if(B.name!==dr.name){ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${dr.name}\` \`${B.name}\` ${this.buildCreateColumnSql(dr,!0,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${B.name}\` \`${dr.name}\` ${this.buildCreateColumnSql(dr,!0,!0)}`)),rr.findColumnIndices(dr).forEach(hr=>{hr.columnNames.splice(hr.columnNames.indexOf(dr.name),1),hr.columnNames.push(B.name);const fr=hr.columnNames.map(Sr=>`\`${Sr}\``).join(", "),_r=this.connection.namingStrategy.indexName(rr,hr.columnNames,hr.where);let gr="";hr.isUnique&&(gr+="UNIQUE "),hr.isSpatial&&(gr+="SPATIAL "),hr.isFulltext&&(gr+="FULLTEXT "),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP INDEX \`${hr.name}\`, ADD ${gr}INDEX \`${_r}\` (${fr})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP INDEX \`${_r}\`, ADD ${gr}INDEX \`${hr.name}\` (${fr})`)),hr.name=_r}),rr.findColumnForeignKeys(dr).forEach(hr=>{hr.columnNames.splice(hr.columnNames.indexOf(dr.name),1),hr.columnNames.push(B.name);const fr=hr.columnNames.map(Or=>`\`${Or}\``).join(", "),_r=hr.referencedColumnNames.map(Or=>`\`${Or}\``).join(","),gr=this.connection.namingStrategy.foreignKeyName(rr,hr.columnNames);let Sr=`ALTER TABLE ${this.escapePath(tr)} DROP FOREIGN KEY \`${hr.name}\`, ADD CONSTRAINT \`${gr}\` FOREIGN KEY (${fr}) REFERENCES ${this.escapePath(this.getTablePath(hr))}(${_r})`;hr.onDelete&&(Sr+=` ON DELETE ${hr.onDelete}`),hr.onUpdate&&(Sr+=` ON UPDATE ${hr.onUpdate}`);let Ar=`ALTER TABLE ${this.escapePath(tr)} DROP FOREIGN KEY \`${gr}\`, ADD CONSTRAINT \`${hr.name}\` FOREIGN KEY (${fr}) REFERENCES ${this.escapePath(this.getTablePath(hr))}(${_r})`;hr.onDelete&&(Ar+=` ON DELETE ${hr.onDelete}`),hr.onUpdate&&(Ar+=` ON UPDATE ${hr.onUpdate}`),ir.push(new Query(Sr)),lr.push(new Query(Ar)),hr.name=gr});const mr=rr.columns.find(hr=>hr.name===dr.name);rr.columns[rr.columns.indexOf(mr)].name=B.name,dr.name=B.name}if(this.isColumnChanged(dr,B,!0)&&(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${dr.name}\` ${this.buildCreateColumnSql(B,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${B.name}\` ${this.buildCreateColumnSql(dr,!0)}`))),B.isPrimary!==dr.isPrimary){const mr=rr.columns.find(fr=>fr.isGenerated&&fr.generationStrategy==="increment");if(mr){const fr=mr.clone();fr.isGenerated=!1,fr.generationStrategy=void 0,ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${mr.name}\` ${this.buildCreateColumnSql(fr,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${fr.name}\` ${this.buildCreateColumnSql(mr,!0)}`))}const hr=rr.primaryColumns;if(hr.length>0){const fr=hr.map(_r=>`\`${_r.name}\``).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP PRIMARY KEY`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD PRIMARY KEY (${fr})`))}if(B.isPrimary===!0){hr.push(B);const fr=rr.columns.find(gr=>gr.name===B.name);fr.isPrimary=!0;const _r=hr.map(gr=>`\`${gr.name}\``).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD PRIMARY KEY (${_r})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP PRIMARY KEY`))}else{const fr=hr.find(gr=>gr.name===B.name);hr.splice(hr.indexOf(fr),1);const _r=rr.columns.find(gr=>gr.name===B.name);if(_r.isPrimary=!1,hr.length>0){const gr=hr.map(Sr=>`\`${Sr.name}\``).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD PRIMARY KEY (${gr})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP PRIMARY KEY`))}}if(mr){const fr=mr.clone();fr.isGenerated=!1,fr.generationStrategy=void 0,ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${fr.name}\` ${this.buildCreateColumnSql(mr,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} CHANGE \`${mr.name}\` ${this.buildCreateColumnSql(fr,!0)}`))}}if(B.isUnique!==dr.isUnique)if(B.isUnique===!0){const mr=new TableIndex({name:this.connection.namingStrategy.indexName(tr,[B.name]),columnNames:[B.name],isUnique:!0});rr.indices.push(mr),rr.uniques.push(new TableUnique({name:mr.name,columnNames:mr.columnNames})),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD UNIQUE INDEX \`${mr.name}\` (\`${B.name}\`)`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP INDEX \`${mr.name}\``))}else{const mr=rr.indices.find(fr=>fr.columnNames.length===1&&fr.isUnique===!0&&!!fr.columnNames.find(_r=>_r===B.name));rr.indices.splice(rr.indices.indexOf(mr),1);const hr=rr.uniques.find(fr=>fr.name===mr.name);rr.uniques.splice(rr.uniques.indexOf(hr),1),ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} DROP INDEX \`${mr.name}\``)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ADD UNIQUE INDEX \`${mr.name}\` (\`${B.name}\`)`))}}await this.executeQueries(ir,lr),this.replaceCachedTable(tr,rr)}async changeColumns(e,I){for(const{oldColumn:B,newColumn:tr}of I)await this.changeColumn(e,B,tr)}async dropColumn(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableColumn(I)?I:B.findColumnByName(I);if(!tr)throw new TypeORMError(`Column "${I}" was not found in table "${B.name}"`);const rr=B.clone(),ir=[],lr=[];if(tr.isPrimary){const mr=rr.columns.find(_r=>_r.isGenerated&&_r.generationStrategy==="increment");if(mr){const _r=mr.clone();_r.isGenerated=!1,_r.generationStrategy=void 0,ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${mr.name}\` ${this.buildCreateColumnSql(_r,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${_r.name}\` ${this.buildCreateColumnSql(mr,!0)}`))}const hr=rr.primaryColumns.map(_r=>`\`${_r.name}\``).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(rr)} DROP PRIMARY KEY`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(rr)} ADD PRIMARY KEY (${hr})`));const fr=rr.findColumnByName(tr.name);if(fr.isPrimary=!1,rr.primaryColumns.length>0){const _r=rr.primaryColumns.map(gr=>`\`${gr.name}\``).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(rr)} ADD PRIMARY KEY (${_r})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(rr)} DROP PRIMARY KEY`))}if(mr&&mr.name!==tr.name){const _r=mr.clone();_r.isGenerated=!1,_r.generationStrategy=void 0,ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${_r.name}\` ${this.buildCreateColumnSql(mr,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${mr.name}\` ${this.buildCreateColumnSql(_r,!0)}`))}}const dr=rr.indices.find(mr=>mr.columnNames.length===1&&mr.columnNames[0]===tr.name);if(dr)rr.indices.splice(rr.indices.indexOf(dr),1),ir.push(this.dropIndexSql(B,dr)),lr.push(this.createIndexSql(B,dr));else if(tr.isUnique){const mr=this.connection.namingStrategy.uniqueConstraintName(B,[tr.name]),hr=rr.uniques.find(gr=>gr.name===mr);hr&&rr.uniques.splice(rr.uniques.indexOf(hr),1);const fr=this.connection.namingStrategy.indexName(B,[tr.name]),_r=rr.indices.find(gr=>gr.name===fr);_r&&rr.indices.splice(rr.indices.indexOf(_r),1),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP INDEX \`${fr}\``)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD UNIQUE INDEX \`${fr}\` (\`${tr.name}\`)`))}ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP COLUMN \`${tr.name}\``)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD ${this.buildCreateColumnSql(tr,!0)}`)),await this.executeQueries(ir,lr),rr.removeColumn(tr),this.replaceCachedTable(B,rr)}async dropColumns(e,I){for(const B of I)await this.dropColumn(e,B)}async createPrimaryKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone(),rr=this.createPrimaryKeySql(B,I),ir=this.dropPrimaryKeySql(B);await this.executeQueries(rr,ir),tr.columns.forEach(lr=>{I.find(dr=>dr===lr.name)&&(lr.isPrimary=!0)}),this.replaceCachedTable(B,tr)}async updatePrimaryKeys(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=B.clone(),rr=I.map(_r=>_r.name),ir=[],lr=[],dr=tr.columns.find(_r=>_r.isGenerated&&_r.generationStrategy==="increment");if(dr){const _r=dr.clone();_r.isGenerated=!1,_r.generationStrategy=void 0,ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${dr.name}\` ${this.buildCreateColumnSql(_r,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${_r.name}\` ${this.buildCreateColumnSql(dr,!0)}`))}const mr=tr.primaryColumns;if(mr.length>0){const _r=mr.map(gr=>`\`${gr.name}\``).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP PRIMARY KEY`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD PRIMARY KEY (${_r})`))}tr.columns.filter(_r=>rr.indexOf(_r.name)!==-1).forEach(_r=>_r.isPrimary=!0);const hr=rr.map(_r=>`\`${_r}\``).join(", ");ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD PRIMARY KEY (${hr})`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP PRIMARY KEY`));const fr=dr||I.find(_r=>_r.isGenerated&&_r.generationStrategy==="increment");if(fr){const _r=fr.clone();_r.isGenerated=!1,_r.generationStrategy=void 0,ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${_r.name}\` ${this.buildCreateColumnSql(fr,!0)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} CHANGE \`${fr.name}\` ${this.buildCreateColumnSql(_r,!0)}`));const gr=tr.columns.find(Sr=>Sr.name===fr.name);gr.isGenerated=!0,gr.generationStrategy="increment"}await this.executeQueries(ir,lr),this.replaceCachedTable(B,tr)}async dropPrimaryKey(e){const I=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),B=this.dropPrimaryKeySql(I),tr=this.createPrimaryKeySql(I,I.primaryColumns.map(rr=>rr.name));await this.executeQueries(B,tr),I.primaryColumns.forEach(rr=>{rr.isPrimary=!1})}async createUniqueConstraint(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,I){throw new TypeORMError("MySql does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,I){throw new TypeORMError("MySql does not support check constraints.")}async createCheckConstraints(e,I){throw new TypeORMError("MySql does not support check constraints.")}async dropCheckConstraint(e,I){throw new TypeORMError("MySql does not support check constraints.")}async dropCheckConstraints(e,I){throw new TypeORMError("MySql does not support check constraints.")}async createExclusionConstraint(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async createExclusionConstraints(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async dropExclusionConstraint(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async dropExclusionConstraints(e,I){throw new TypeORMError("MySql does not support exclusion constraints.")}async createForeignKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.foreignKeyName(B,I.columnNames));const tr=this.createForeignKeySql(B,I),rr=this.dropForeignKeySql(B,I);await this.executeQueries(tr,rr),B.addForeignKey(I)}async createForeignKeys(e,I){const B=I.map(tr=>this.createForeignKey(e,tr));await Promise.all(B)}async dropForeignKey(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableForeignKey(I)?I:B.foreignKeys.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied foreign key was not found in table ${B.name}`);const rr=this.dropForeignKeySql(B,tr),ir=this.createForeignKeySql(B,tr);await this.executeQueries(rr,ir),B.removeForeignKey(tr)}async dropForeignKeys(e,I){const B=I.map(tr=>this.dropForeignKey(e,tr));await Promise.all(B)}async createIndex(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(B,I));const tr=this.createIndexSql(B,I),rr=this.dropIndexSql(B,I);await this.executeQueries(tr,rr),B.addIndex(I,!0)}async createIndices(e,I){const B=I.map(tr=>this.createIndex(e,tr));await Promise.all(B)}async dropIndex(e,I){const B=InstanceChecker.isTable(e)?e:await this.getCachedTable(e),tr=InstanceChecker.isTableIndex(I)?I:B.indices.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied index ${I} was not found in table ${B.name}`);tr.name||(tr.name=this.generateIndexName(B,tr));const rr=this.dropIndexSql(B,tr),ir=this.createIndexSql(B,tr);await this.executeQueries(rr,ir),B.removeIndex(tr,!0)}async dropIndices(e,I){const B=I.map(tr=>this.dropIndex(e,tr));await Promise.all(B)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(e){const I=e||this.driver.database;if(I){if(!await this.hasDatabase(I))return Promise.resolve()}else throw new TypeORMError("Can not clear database. No database is specified");const B=this.isTransactionActive;B||await this.startTransaction();try{const tr=`SELECT concat('DROP VIEW IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`VIEWS\` WHERE \`TABLE_SCHEMA\` = '${I}'`,rr=await this.query(tr);await Promise.all(rr.map(hr=>this.query(hr.query)));const ir="SET FOREIGN_KEY_CHECKS = 0;",lr=`SELECT concat('DROP TABLE IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_SCHEMA\` = '${I}'`,dr="SET FOREIGN_KEY_CHECKS = 1;";await this.query(ir);const mr=await this.query(lr);await Promise.all(mr.map(hr=>this.query(hr.query))),await this.query(dr),B||await this.commitTransaction()}catch(tr){try{B||await this.rollbackTransaction()}catch{}throw tr}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const B=await this.getCurrentDatabase(),tr=e.map(lr=>{let{database:dr,tableName:mr}=this.driver.parseTableName(lr);return dr||(dr=B),`(\`t\`.\`schema\` = '${dr}' AND \`t\`.\`name\` = '${mr}')`}).join(" OR "),rr=`SELECT \`t\`.*, \`v\`.\`check_option\` FROM ${this.escapePath(this.getTypeormMetadataTableName())} \`t\` INNER JOIN \`information_schema\`.\`views\` \`v\` ON \`v\`.\`table_schema\` = \`t\`.\`schema\` AND \`v\`.\`table_name\` = \`t\`.\`name\` WHERE \`t\`.\`type\` = '${MetadataTableType.VIEW}' ${tr?`AND (${tr})`:""}`;return(await this.query(rr)).map(lr=>{const dr=new View,mr=lr.schema===B?void 0:lr.schema;return dr.database=lr.schema,dr.name=this.driver.buildTableName(lr.name,void 0,mr),dr.expression=lr.value,dr})}async loadTables(e){if(e&&e.length===0)return[];const I=[],B=await this.getCurrentDatabase();if(!e)I.push(...await this.query("SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES`"));else{const vr="SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES` WHERE "+e.map(xr=>{let[kr,Gr]=xr.split(".");return Gr||(Gr=kr,kr=this.driver.database||B),`(\`TABLE_SCHEMA\` = '${kr}' AND \`TABLE_NAME\` = '${Gr}')`}).join(" OR ");I.push(...await this.query(vr))}if(I.length===0)return[];const tr=I.map(({TABLE_NAME:Fr,TABLE_SCHEMA:vr})=>`(\`TABLE_SCHEMA\` = '${vr}' AND \`TABLE_NAME\` = '${Fr}')`).join(" OR "),rr="SELECT * FROM `INFORMATION_SCHEMA`.`COLUMNS` WHERE "+tr,ir=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` WHERE \`CONSTRAINT_NAME\` = 'PRIMARY' AND (${tr})`,lr="SELECT `SCHEMA_NAME`, `DEFAULT_CHARACTER_SET_NAME` as `CHARSET`, `DEFAULT_COLLATION_NAME` AS `COLLATION` FROM `INFORMATION_SCHEMA`.`SCHEMATA`",mr=`SELECT \`s\`.* FROM \`INFORMATION_SCHEMA\`.\`STATISTICS\` \`s\` LEFT JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`rc\` ON \`s\`.\`INDEX_NAME\` = \`rc\`.\`CONSTRAINT_NAME\` WHERE (${I.map(({TABLE_NAME:Fr,TABLE_SCHEMA:vr})=>`(\`s\`.\`TABLE_SCHEMA\` = '${vr}' AND \`s\`.\`TABLE_NAME\` = '${Fr}')`).join(" OR ")}) AND \`s\`.\`INDEX_NAME\` != 'PRIMARY' AND \`rc\`.\`CONSTRAINT_NAME\` IS NULL`,fr="SELECT `kcu`.`TABLE_SCHEMA`, `kcu`.`TABLE_NAME`, `kcu`.`CONSTRAINT_NAME`, `kcu`.`COLUMN_NAME`, `kcu`.`REFERENCED_TABLE_SCHEMA`, `kcu`.`REFERENCED_TABLE_NAME`, `kcu`.`REFERENCED_COLUMN_NAME`, `rc`.`DELETE_RULE` `ON_DELETE`, `rc`.`UPDATE_RULE` `ON_UPDATE` FROM `INFORMATION_SCHEMA`.`KEY_COLUMN_USAGE` `kcu` INNER JOIN `INFORMATION_SCHEMA`.`REFERENTIAL_CONSTRAINTS` `rc` ON `rc`.`constraint_name` = `kcu`.`constraint_name` WHERE "+I.map(({TABLE_NAME:Fr,TABLE_SCHEMA:vr})=>`(\`kcu\`.\`TABLE_SCHEMA\` = '${vr}' AND \`kcu\`.\`TABLE_NAME\` = '${Fr}')`).join(" OR "),[_r,gr,Sr,Ar,Or]=await Promise.all([this.query(rr),this.query(ir),this.query(lr),this.query(mr),this.query(fr)]);return Promise.all(I.map(async Fr=>{const vr=new Table,xr=Sr.find(es=>es.SCHEMA_NAME===Fr.TABLE_SCHEMA),kr=xr.COLLATION,Gr=xr.CHARSET,is=Fr.TABLE_SCHEMA===B?void 0:Fr.TABLE_SCHEMA;vr.database=Fr.TABLE_SCHEMA,vr.name=this.driver.buildTableName(Fr.TABLE_NAME,void 0,is),vr.columns=_r.filter(es=>es.TABLE_NAME===Fr.TABLE_NAME&&es.TABLE_SCHEMA===Fr.TABLE_SCHEMA).map(es=>{const ps=Ar.filter(ss=>ss.TABLE_NAME===Fr.TABLE_NAME&&ss.TABLE_SCHEMA===Fr.TABLE_SCHEMA&&ss.COLUMN_NAME===es.COLUMN_NAME&&parseInt(ss.NON_UNIQUE,10)===0),Ur=this.connection.entityMetadatas.find(ss=>this.getTablePath(vr)===this.getTablePath(ss)),Lr=ps.length>0&&Ur&&Ur.indices.some(ss=>ps.some(ls=>ss.name===ls.INDEX_NAME&&ss.synchronize===!1)),ts=ps.every(ss=>Ar.some(ls=>ls.INDEX_NAME===ss.INDEX_NAME&&ls.COLUMN_NAME!==es.COLUMN_NAME)),rs=new TableColumn;if(rs.name=es.COLUMN_NAME,rs.type=es.DATA_TYPE.toLowerCase(),rs.unsigned=rs.zerofill?!0:es.COLUMN_TYPE.indexOf("unsigned")!==-1,this.driver.withWidthColumnTypes.indexOf(rs.type)!==-1){const ss=es.COLUMN_TYPE.substring(es.COLUMN_TYPE.indexOf("(")+1,es.COLUMN_TYPE.indexOf(")"));rs.width=ss&&!this.isDefaultColumnWidth(vr,rs,parseInt(ss))?parseInt(ss):void 0}if(es.COLUMN_DEFAULT===null||es.COLUMN_DEFAULT===void 0?rs.default=void 0:rs.default=es.COLUMN_DEFAULT==="CURRENT_TIMESTAMP"?es.COLUMN_DEFAULT:`'${es.COLUMN_DEFAULT}'`,es.EXTRA.indexOf("on update")!==-1&&(rs.onUpdate=es.EXTRA.substring(es.EXTRA.indexOf("on update")+10)),es.GENERATION_EXPRESSION&&(rs.asExpression=es.GENERATION_EXPRESSION,rs.generatedType=es.EXTRA.indexOf("VIRTUAL")!==-1?"VIRTUAL":"STORED"),rs.isUnique=ps.length>0&&!Lr&&!ts,rs.isNullable=es.IS_NULLABLE==="YES",rs.isPrimary=gr.some(ss=>ss.TABLE_NAME===es.TABLE_NAME&&ss.TABLE_SCHEMA===es.TABLE_SCHEMA&&ss.COLUMN_NAME===es.COLUMN_NAME),rs.zerofill=es.COLUMN_TYPE.indexOf("zerofill")!==-1,rs.isGenerated=es.EXTRA.indexOf("auto_increment")!==-1,rs.isGenerated&&(rs.generationStrategy="increment"),rs.comment=typeof es.COLUMN_COMMENT=="string"&&es.COLUMN_COMMENT.length===0?void 0:es.COLUMN_COMMENT,es.CHARACTER_SET_NAME&&(rs.charset=es.CHARACTER_SET_NAME===Gr?void 0:es.CHARACTER_SET_NAME),es.COLLATION_NAME&&(rs.collation=es.COLLATION_NAME===kr?void 0:es.COLLATION_NAME),this.driver.withLengthColumnTypes.indexOf(rs.type)!==-1&&es.CHARACTER_MAXIMUM_LENGTH){const ss=es.CHARACTER_MAXIMUM_LENGTH.toString();rs.length=this.isDefaultColumnLength(vr,rs,ss)?"":ss}if((rs.type==="decimal"||rs.type==="double"||rs.type==="float")&&(es.NUMERIC_PRECISION!==null&&!this.isDefaultColumnPrecision(vr,rs,es.NUMERIC_PRECISION)&&(rs.precision=parseInt(es.NUMERIC_PRECISION)),es.NUMERIC_SCALE!==null&&!this.isDefaultColumnScale(vr,rs,es.NUMERIC_SCALE)&&(rs.scale=parseInt(es.NUMERIC_SCALE))),rs.type==="enum"||rs.type==="simple-enum"||rs.type==="set"){const ss=es.COLUMN_TYPE,ls=ss.substring(ss.indexOf("(")+1,ss.lastIndexOf(")")).split(",");rs.enum=ls.map(os=>os.substring(1,os.length-1)),rs.length=""}return(rs.type==="datetime"||rs.type==="time"||rs.type==="timestamp")&&es.DATETIME_PRECISION!==null&&es.DATETIME_PRECISION!==void 0&&!this.isDefaultColumnPrecision(vr,rs,parseInt(es.DATETIME_PRECISION))&&(rs.precision=parseInt(es.DATETIME_PRECISION)),rs});const as=OrmUtils.uniq(Or.filter(es=>es.TABLE_NAME===Fr.TABLE_NAME&&es.TABLE_SCHEMA===Fr.TABLE_SCHEMA),es=>es.CONSTRAINT_NAME);vr.foreignKeys=as.map(es=>{const ps=Or.filter(ts=>ts.CONSTRAINT_NAME===es.CONSTRAINT_NAME),Ur=es.REFERENCED_TABLE_SCHEMA===B?void 0:es.REFERENCED_TABLE_SCHEMA,Lr=this.driver.buildTableName(es.REFERENCED_TABLE_NAME,void 0,Ur);return new TableForeignKey({name:es.CONSTRAINT_NAME,columnNames:ps.map(ts=>ts.COLUMN_NAME),referencedDatabase:es.REFERENCED_TABLE_SCHEMA,referencedTableName:Lr,referencedColumnNames:ps.map(ts=>ts.REFERENCED_COLUMN_NAME),onDelete:es.ON_DELETE,onUpdate:es.ON_UPDATE})});const cs=OrmUtils.uniq(Ar.filter(es=>es.TABLE_NAME===Fr.TABLE_NAME&&es.TABLE_SCHEMA===Fr.TABLE_SCHEMA),es=>es.INDEX_NAME);return vr.indices=cs.map(es=>{const ps=Ar.filter(Lr=>Lr.TABLE_SCHEMA===es.TABLE_SCHEMA&&Lr.TABLE_NAME===es.TABLE_NAME&&Lr.INDEX_NAME===es.INDEX_NAME),Ur=parseInt(es.NON_UNIQUE,10);return new TableIndex({table:vr,name:es.INDEX_NAME,columnNames:ps.map(Lr=>Lr.COLUMN_NAME),isUnique:Ur===0,isSpatial:es.INDEX_TYPE==="SPATIAL",isFulltext:es.INDEX_TYPE==="FULLTEXT"})}),vr}))}createTableSql(e,I){const B=e.columns.map(rr=>this.buildCreateColumnSql(rr,!0)).join(", ");let tr=`CREATE TABLE ${this.escapePath(e)} (${B}`;if(e.columns.filter(rr=>rr.isUnique).forEach(rr=>{const ir=e.indices.some(dr=>dr.columnNames.length===1&&!!dr.isUnique&&dr.columnNames.indexOf(rr.name)!==-1),lr=e.uniques.some(dr=>dr.columnNames.length===1&&dr.columnNames.indexOf(rr.name)!==-1);!ir&&!lr&&e.indices.push(new TableIndex({name:this.connection.namingStrategy.uniqueConstraintName(e,[rr.name]),columnNames:[rr.name],isUnique:!0}))}),e.uniques.length>0&&e.uniques.forEach(rr=>{e.indices.some(lr=>lr.name===rr.name)||e.indices.push(new TableIndex({name:rr.name,columnNames:rr.columnNames,isUnique:!0}))}),e.indices.length>0){const rr=e.indices.map(ir=>{const lr=ir.columnNames.map(mr=>`\`${mr}\``).join(", ");ir.name||(ir.name=this.connection.namingStrategy.indexName(e,ir.columnNames,ir.where));let dr="";return ir.isUnique&&(dr+="UNIQUE "),ir.isSpatial&&(dr+="SPATIAL "),ir.isFulltext&&(dr+="FULLTEXT "),`${dr}INDEX \`${ir.name}\` (${lr})`}).join(", ");tr+=`, ${rr}`}if(e.foreignKeys.length>0&&I){const rr=e.foreignKeys.map(ir=>{const lr=ir.columnNames.map(hr=>`\`${hr}\``).join(", ");ir.name||(ir.name=this.connection.namingStrategy.foreignKeyName(e,ir.columnNames));const dr=ir.referencedColumnNames.map(hr=>`\`${hr}\``).join(", ");let mr=`CONSTRAINT \`${ir.name}\` FOREIGN KEY (${lr}) REFERENCES ${this.escapePath(this.getTablePath(ir))} (${dr})`;return ir.onDelete&&(mr+=` ON DELETE ${ir.onDelete}`),ir.onUpdate&&(mr+=` ON UPDATE ${ir.onUpdate}`),mr}).join(", ");tr+=`, ${rr}`}if(e.primaryColumns.length>0){const rr=e.primaryColumns.map(ir=>`\`${ir.name}\``).join(", ");tr+=`, PRIMARY KEY (${rr})`}return tr+=`) ENGINE=${e.engine||"InnoDB"}`,new Query(tr)}dropTableSql(e){return new Query(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){return typeof e.expression=="string"?new Query(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression}`):new Query(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const I=await this.getCurrentDatabase(),B=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:MetadataTableType.VIEW,schema:I,name:e.name,value:B})}dropViewSql(e){return new Query(`DROP VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const I=await this.getCurrentDatabase(),B=InstanceChecker.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:MetadataTableType.VIEW,schema:I,name:B})}createIndexSql(e,I){const B=I.columnNames.map(rr=>`\`${rr}\``).join(", ");let tr="";return I.isUnique&&(tr+="UNIQUE "),I.isSpatial&&(tr+="SPATIAL "),I.isFulltext&&(tr+="FULLTEXT "),new Query(`CREATE ${tr}INDEX \`${I.name}\` ON ${this.escapePath(e)} (${B})`)}dropIndexSql(e,I){let B=InstanceChecker.isTableIndex(I)?I.name:I;return new Query(`DROP INDEX \`${B}\` ON ${this.escapePath(e)}`)}createPrimaryKeySql(e,I){const B=I.map(tr=>`\`${tr}\``).join(", ");return new Query(`ALTER TABLE ${this.escapePath(e)} ADD PRIMARY KEY (${B})`)}dropPrimaryKeySql(e){return new Query(`ALTER TABLE ${this.escapePath(e)} DROP PRIMARY KEY`)}createForeignKeySql(e,I){const B=I.columnNames.map(ir=>`\`${ir}\``).join(", "),tr=I.referencedColumnNames.map(ir=>`\`${ir}\``).join(",");let rr=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${I.name}\` FOREIGN KEY (${B}) REFERENCES ${this.escapePath(this.getTablePath(I))}(${tr})`;return I.onDelete&&(rr+=` ON DELETE ${I.onDelete}`),I.onUpdate&&(rr+=` ON UPDATE ${I.onUpdate}`),new Query(rr)}dropForeignKeySql(e,I){const B=InstanceChecker.isTableForeignKey(I)?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP FOREIGN KEY \`${B}\``)}escapeComment(e){return!e||e.length===0?"''":(e=e.replace(/\\/g,"\\\\").replace(/'/g,"''").replace(/\u0000/g,""),`'${e}'`)}escapePath(e){const{database:I,tableName:B}=this.driver.parseTableName(e);return I&&I!==this.driver.database?`\`${I}\`.\`${B}\``:`\`${B}\``}buildCreateColumnSql(e,I,B=!1){let tr="";return B?tr=this.connection.driver.createFullType(e):tr=`\`${e.name}\` ${this.connection.driver.createFullType(e)}`,e.asExpression&&(tr+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`),e.zerofill?tr+=" ZEROFILL":e.unsigned&&(tr+=" UNSIGNED"),e.enum&&(tr+=` (${e.enum.map(rr=>"'"+rr+"'").join(", ")})`),e.charset&&(tr+=` CHARACTER SET "${e.charset}"`),e.collation&&(tr+=` COLLATE "${e.collation}"`),e.isNullable||(tr+=" NOT NULL"),e.isNullable&&(tr+=" NULL"),e.isPrimary&&!I&&(tr+=" PRIMARY KEY"),e.isGenerated&&e.generationStrategy==="increment"&&(tr+=" AUTO_INCREMENT"),e.comment&&(tr+=` COMMENT ${this.escapeComment(e.comment)}`),e.default!==void 0&&e.default!==null&&(tr+=` DEFAULT ${e.default}`),e.onUpdate&&(tr+=` ON UPDATE ${e.onUpdate}`),tr}isDefaultColumnWidth(e,I,B){if(this.connection.hasMetadata(e.name)){const ir=this.connection.getMetadata(e.name).findColumnWithDatabaseName(I.name);if(ir&&ir.width)return!1}const tr=this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[I.type]&&this.connection.driver.dataTypeDefaults[I.type].width;if(tr){const ir=["int","tinyint","smallint","mediumint"].indexOf(I.type)!==-1;return I.unsigned&&ir?tr-1===B:tr===B}return!1}changeTableComment(e,I){throw new TypeORMError("aurora-mysql driver does not support change table comment.")}}class AuroraMysqlDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["bit","int","integer","tinyint","smallint","mediumint","bigint","float","double","double precision","real","decimal","dec","numeric","fixed","bool","boolean","date","datetime","timestamp","time","year","char","nchar","national char","varchar","nvarchar","national varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","set","binary","varbinary","json","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.supportedUpsertTypes=["on-duplicate-key-update"],this.spatialTypes=["geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.withLengthColumnTypes=["char","varchar","nvarchar","binary","varbinary"],this.withWidthColumnTypes=["bit","tinyint","smallint","mediumint","int","integer","bigint"],this.withPrecisionColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real","time","datetime","timestamp"],this.withScaleColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real"],this.unsignedAndZerofillTypes=["int","integer","smallint","tinyint","mediumint","bigint","decimal","dec","numeric","fixed","float","double","double precision","real"],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:"CURRENT_TIMESTAMP(6)",updateDate:"datetime",updateDatePrecision:6,updateDateDefault:"CURRENT_TIMESTAMP(6)",deleteDate:"datetime",deleteDatePrecision:6,deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255},"national varchar":{length:255},char:{length:1},binary:{length:1},varbinary:{length:255},decimal:{precision:10,scale:0},dec:{precision:10,scale:0},numeric:{precision:10,scale:0},fixed:{precision:10,scale:0},float:{precision:12},double:{precision:22},time:{precision:0},datetime:{precision:0},timestamp:{precision:0},bit:{width:1},int:{width:11},integer:{width:11},tinyint:{width:4},smallint:{width:6},mediumint:{width:9},bigint:{width:20}},this.maxAliasLength=63,this.cteCapabilities={enabled:!1},this.connection=e,this.options=e.options,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,B)=>this.connection.logger.logQuery(I,B),this.options.serviceConfigOptions,this.options.formatOptions),this.database=DriverUtils.buildDriverOptions(this.options).database}async connect(){if(!this.database){const e=await this.createQueryRunner("master");this.database=await e.getCurrentDatabase(),await e.release()}}afterConnect(){return Promise.resolve()}async disconnect(){}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}createQueryRunner(e){return new AuroraMysqlQueryRunner(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,B)=>this.connection.logger.logQuery(I,B),this.options.serviceConfigOptions,this.options.formatOptions))}escapeQueryWithParameters(e,I,B){const tr=Object.keys(B).map(rr=>B[rr]);return!I||!Object.keys(I).length?[e,tr]:(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(rr,ir,lr)=>{if(!I.hasOwnProperty(lr))return rr;let dr=I[lr];return ir?dr.map(mr=>(tr.push(mr),this.createParameter(lr,tr.length-1))).join(", "):typeof dr=="function"?dr():(tr.push(dr),this.createParameter(lr,tr.length-1))}),[e,tr])}escape(e){return"`"+e+"`"}buildTableName(e,I,B){let tr=[e];return B&&tr.unshift(B),tr.join(".")}parseTableName(e){const I=this.database,B=void 0;if(InstanceChecker.isTable(e)||InstanceChecker.isView(e)){const rr=this.parseTableName(e.name);return{database:e.database||rr.database||I,schema:e.schema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isTableForeignKey(e)){const rr=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||rr.database||I,schema:e.referencedSchema||rr.schema||B,tableName:rr.tableName}}if(InstanceChecker.isEntityMetadata(e))return{database:e.database||I,schema:e.schema||B,tableName:e.tableName};const tr=e.split(".");return{database:(tr.length>1?tr[0]:void 0)||I,schema:B,tableName:tr.length>1?tr[1]:tr[0]}}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),!this.options.formatOptions||this.options.formatOptions.castParameters!==!1?this.client.preparePersistentValue(e,I):e==null?e:I.type===Boolean?e===!0?1:0:I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="time"?DateUtils.mixedDateToTimeString(e):I.type==="json"?JSON.stringify(e):I.type==="timestamp"||I.type==="datetime"||I.type===Date?DateUtils.mixedDateToDate(e):I.type==="simple-array"||I.type==="set"?DateUtils.simpleArrayToString(e):I.type==="simple-json"?DateUtils.simpleJsonToString(e):I.type==="enum"||I.type==="simple-enum"?""+e:e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:!this.options.formatOptions||this.options.formatOptions.castParameters!==!1?this.client.prepareHydratedValue(e,I):(I.type===Boolean||I.type==="bool"||I.type==="boolean"?e=!!e:I.type==="datetime"||I.type===Date?e=DateUtils.normalizeHydratedDate(e):I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="json"?e=typeof e=="string"?JSON.parse(e):e:I.type==="time"?e=DateUtils.mixedTimeToString(e):I.type==="simple-array"||I.type==="set"?e=DateUtils.stringToSimpleArray(e):I.type==="simple-json"?e=DateUtils.stringToSimpleJson(e):(I.type==="enum"||I.type==="simple-enum")&&I.enum&&!isNaN(e)&&I.enum.indexOf(parseInt(e))>=0?e=parseInt(e):I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}normalizeType(e){return e.type===Number||e.type==="integer"?"int":e.type===String?"varchar":e.type===Date?"datetime":e.type===Buffer?"blob":e.type===Boolean?"tinyint":e.type==="uuid"?"varchar":e.type==="simple-array"||e.type==="simple-json"?"text":e.type==="simple-enum"?"enum":e.type==="double precision"||e.type==="real"?"double":e.type==="dec"||e.type==="numeric"||e.type==="fixed"?"decimal":e.type==="bool"||e.type==="boolean"?"tinyint":e.type==="nvarchar"||e.type==="national varchar"?"varchar":e.type==="nchar"||e.type==="national char"?"char":e.type||""}normalizeDefault(e){const I=e.default;if(I!==null){if((e.type==="enum"||e.type==="simple-enum")&&I!==void 0)return`'${I}'`;if(e.type==="set"&&I!==void 0)return`'${DateUtils.simpleArrayToString(I)}'`;if(typeof I=="number")return`${I}`;if(typeof I=="boolean")return I?"1":"0";if(typeof I=="function")return I();if(typeof I=="string")return`'${I}'`;if(I!==void 0)return`${I}`}}normalizeIsUnique(e){return e.entityMetadata.indices.some(I=>I.isUnique&&I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){if(e.length)return e.length.toString();if(e.generationStrategy==="uuid")return"36";switch(e.type){case String:case"varchar":case"nvarchar":case"national varchar":return"255";case"varbinary":return"255";default:return""}}createFullType(e){let I=e.type;return this.getColumnLength(e)?I+=`(${this.getColumnLength(e)})`:e.width?I+=`(${e.width})`:e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+=`(${e.precision},${e.scale})`:e.precision!==null&&e.precision!==void 0&&(I+=`(${e.precision})`),e.isArray&&(I+=" array"),I}obtainMasterConnection(){return new Promise((e,I)=>{this.poolCluster?this.poolCluster.getConnection("MASTER",(B,tr)=>{B?I(B):e(this.prepareDbConnection(tr))}):this.pool?this.pool.getConnection((B,tr)=>{B?I(B):e(this.prepareDbConnection(tr))}):I(new TypeORMError("Connection is not established with mysql database"))})}obtainSlaveConnection(){return this.poolCluster?new Promise((e,I)=>{this.poolCluster.getConnection("SLAVE*",(B,tr)=>{B?I(B):e(this.prepareDbConnection(tr))})}):this.obtainMasterConnection()}createGeneratedMap(e,I,B){const tr=e.generatedColumns.reduce((rr,ir)=>{let lr;return ir.generationStrategy==="increment"&&I.insertId&&(lr=I.insertId+B),OrmUtils.mergeDeep(rr,ir.createValueMap(lr))},{});return Object.keys(tr).length>0?tr:void 0}findChangedColumns(e,I){return I.filter(B=>{const tr=e.find(ir=>ir.name===B.databaseName);if(!tr)return!1;let rr=B.length;return!rr&&B.generationStrategy==="uuid"&&(rr=this.getColumnLength(B)),tr.name!==B.databaseName||tr.type!==this.normalizeType(B)||tr.length!==rr||tr.width!==B.width||tr.precision!==B.precision||tr.scale!==B.scale||tr.zerofill!==B.zerofill||tr.unsigned!==B.unsigned||tr.asExpression!==B.asExpression||tr.generatedType!==B.generatedType||tr.comment!==this.escapeComment(B.comment)||!this.compareDefaultValues(this.normalizeDefault(B),tr.default)||tr.enum&&B.enum&&!OrmUtils.isArraysEqual(tr.enum,B.enum.map(ir=>ir+""))||tr.onUpdate!==B.onUpdate||tr.isPrimary!==B.isPrimary||tr.isNullable!==B.isNullable||tr.isUnique!==this.normalizeIsUnique(B)||B.generationStrategy!=="uuid"&&tr.isGenerated!==B.isGenerated})}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!0}createParameter(e,I){return"?"}loadDependencies(){const e=this.options.driver||PlatformTools.load("typeorm-aurora-data-api-driver");this.DataApiDriver=e,this.DataApiDriver=this.DataApiDriver.default||this.DataApiDriver}createConnectionOptions(e,I){return I=Object.assign({},I,DriverUtils.buildDriverOptions(I)),Object.assign({},{resourceArn:e.resourceArn,secretArn:e.secretArn,database:e.database,region:e.region,type:e.type},{host:I.host,user:I.username,password:I.password,database:I.database,port:I.port,ssl:e.ssl},e.extra||{})}async createPool(e){return{}}prepareDbConnection(e){const{logger:I}=this.connection;return e.listeners("error").length===0&&e.on("error",B=>I.log("warn",`MySQL connection raised an error. ${B}`)),e}compareDefaultValues(e,I){return typeof e=="string"&&typeof I=="string"&&(e=e.replace(/^'+|'+$/g,""),I=I.replace(/^'+|'+$/g,"")),e===I}escapeComment(e){return e&&(e=e.replace(/\u0000/g,""),e)}}class PostgresQueryRunnerWrapper extends PostgresQueryRunner{constructor(e,I){super(e,I)}}class AuroraPostgresQueryRunner extends PostgresQueryRunnerWrapper{constructor(e,I,B){super(e,B),this.client=I}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.mode==="slave"&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(([e,I])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=I,this.databaseConnection)):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(([e,I])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=I,this.databaseConnection)),this.databaseConnectionPromise)}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}this.transactionDepth===0?(this.transactionDepth+=1,await this.client.startTransaction()):(this.transactionDepth+=1,await this.query(`SAVEPOINT typeorm_${this.transactionDepth} - 1`)),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`RELEASE SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.commitTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?(this.transactionDepth-=1,await this.query(`ROLLBACK TO SAVEPOINT typeorm_${this.transactionDepth}`)):(this.transactionDepth-=1,await this.client.rollbackTransaction(),this.isTransactionActive=!1),await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=await this.client.query(e,I),rr=new QueryResult;return rr.raw=tr,tr?.hasOwnProperty("records")&&Array.isArray(tr.records)&&(rr.records=tr.records),tr?.hasOwnProperty("numberOfRecordsUpdated")&&(rr.affected=tr.numberOfRecordsUpdated),B?rr:rr.raw}changeTableComment(e,I){throw new TypeORMError("aurora-postgres driver does not support change comment.")}}class PostgresWrapper extends PostgresDriver{}class AuroraPostgresDriver extends PostgresWrapper{constructor(e){super(),this.transactionSupport="nested",this.connection=e,this.options=e.options,this.isReplicated=!1,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,B)=>this.connection.logger.logQuery(I,B),this.options.serviceConfigOptions,this.options.formatOptions),this.database=DriverUtils.buildDriverOptions(this.options).database}async connect(){}async disconnect(){}createQueryRunner(e){return new AuroraPostgresQueryRunner(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(I,B)=>this.connection.logger.logQuery(I,B),this.options.serviceConfigOptions,this.options.formatOptions),e)}preparePersistentValue(e,I){return this.options.formatOptions&&this.options.formatOptions.castParameters===!1?super.preparePersistentValue(e,I):(I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),this.client.preparePersistentValue(e,I))}prepareHydratedValue(e,I){return this.options.formatOptions&&this.options.formatOptions.castParameters===!1?super.prepareHydratedValue(e,I):(I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),this.client.prepareHydratedValue(e,I))}loadDependencies(){const e=this.options.driver||PlatformTools.load("typeorm-aurora-data-api-driver"),{pg:I}=e;this.DataApiDriver=I}executeQuery(e,I){return this.connection.query(I)}async afterConnect(){const e=await this.checkMetadataForExtensions();return e.hasExtensions&&await this.enableExtensions(e,this.connection),Promise.resolve()}}class CapacitorQueryRunner extends AbstractSqliteQueryRunner{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new Broadcaster(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async executeSet(e){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;return(await this.connect()).executeSet(e,!1)}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=await this.connect();this.driver.connection.logger.logQuery(e,I,this);const rr=e.substring(0,e.indexOf(" ")!==-1?e.indexOf(" "):void 0);try{let ir;["BEGIN","ROLLBACK","COMMIT","CREATE","ALTER","DROP"].indexOf(rr)!==-1?ir=await tr.execute(e,!1):["INSERT","UPDATE","DELETE","PRAGMA"].indexOf(rr)!==-1?ir=await tr.run(e,I,!1):ir=await tr.query(e,I||[]);const lr=new QueryResult;return ir?.hasOwnProperty("values")&&(lr.raw=ir.values,lr.records=ir.values),ir?.hasOwnProperty("changes")&&(lr.affected=ir.changes.changes,lr.raw=ir.changes.lastId||ir.changes.changes),B?lr:lr.raw}catch(ir){throw this.driver.connection.logger.logQueryError(ir,e,I,this),new QueryFailedError(e,I,ir)}}parametrize(e){return Object.keys(e).map(I=>`"${I}"=?`)}}class CapacitorDriver extends AbstractSqliteDriver{constructor(e){super(e),this.database=this.options.database,this.driver=this.options.driver,this.sqlite=this.options.driver}async connect(){this.databaseConnection=this.createDatabaseConnection(),await this.databaseConnection}async disconnect(){return this.queryRunner=void 0,(await this.databaseConnection).close().then(()=>{this.databaseConnection=void 0})}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new CapacitorQueryRunner(this)),this.queryRunner}async createDatabaseConnection(){const e=this.options.mode||"no-encryption",I=e!=="no-encryption",B=typeof this.options.version>"u"?1:this.options.version,tr=await this.sqlite.createConnection(this.options.database,I,e,B);return await tr.open(),await tr.run("PRAGMA foreign_keys = ON"),this.options.journalMode&&["DELETE","TRUNCATE","PERSIST","MEMORY","WAL","OFF"].indexOf(this.options.journalMode)!==-1&&await tr.run(`PRAGMA journal_mode = ${this.options.journalMode}`),tr}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new DriverPackageNotInstalledError("Capacitor","@capacitor-community/sqlite")}}class SpannerQueryRunner extends BaseQueryRunner{constructor(e,I){super(),this.driver=e,this.connection=e.connection,this.mode=I,this.broadcaster=new Broadcaster(this)}async connect(){if(this.session)return Promise.resolve(this.session);const[e]=await this.driver.instanceDatabase.createSession({});return this.session=e,this.sessionTransaction=await e.transaction(),this.session}async release(){return this.isReleased=!0,this.session&&await this.session.delete(),this.session=void 0,Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(I){throw this.isTransactionActive=!1,I}await this.connect(),await this.sessionTransaction.begin(),this.connection.logger.logQuery("START TRANSACTION"),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionCommit"),await this.sessionTransaction.commit(),this.connection.logger.logQuery("COMMIT"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new TransactionNotStartedError;await this.broadcaster.broadcast("BeforeTransactionRollback"),await this.sessionTransaction.rollback(),this.connection.logger.logQuery("ROLLBACK"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,I,B=!1){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;const tr=new BroadcasterResult;try{const rr=+new Date;await this.connect();let ir;const lr=e.startsWith("SELECT"),dr=lr&&!this.isTransactionActive?this.driver.instanceDatabase:this.sessionTransaction;!this.isTransactionActive&&!lr&&await this.sessionTransaction.begin();try{this.driver.connection.logger.logQuery(e,I,this),this.broadcaster.broadcastBeforeQueryEvent(tr,e,I),ir=await dr.run({sql:e,params:I?I.reduce((gr,Sr,Ar)=>(gr["param"+Ar]=Sr,gr),{}):void 0,json:!0}),!this.isTransactionActive&&!lr&&await this.sessionTransaction.commit()}catch(gr){try{!this.isTransactionActive&&!lr&&await this.sessionTransaction.rollback()}catch{}throw gr}const mr=this.driver.options.maxQueryExecutionTime,fr=+new Date-rr;this.broadcaster.broadcastAfterQueryEvent(tr,e,I,!0,fr,ir,void 0),mr&&fr>mr&&this.driver.connection.logger.logQuerySlow(fr,e,I,this);const _r=new QueryResult;return _r.raw=ir,_r.records=ir?ir[0]:[],ir&&ir[1]&&ir[1].rowCountExact&&(_r.affected=parseInt(ir[1].rowCountExact)),B?_r:_r.records}catch(rr){throw this.driver.connection.logger.logQueryError(rr,e,I,this),this.broadcaster.broadcastAfterQueryEvent(tr,e,I,!1,void 0,void 0,rr),new QueryFailedError(e,I,rr)}finally{await tr.wait()}}async updateDDL(e,I){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;this.driver.connection.logger.logQuery(e,I,this);try{const B=+new Date,[tr]=await this.driver.instanceDatabase.updateSchema(e);await tr.promise();const rr=this.driver.options.maxQueryExecutionTime,lr=+new Date-B;rr&&lr>rr&&this.driver.connection.logger.logQuerySlow(lr,e,I,this)}catch(B){throw this.driver.connection.logger.logQueryError(B,e,I,this),new QueryFailedError(e,I,B)}}async stream(e,I,B,tr){if(this.isReleased)throw new QueryRunnerAlreadyReleasedError;try{this.driver.connection.logger.logQuery(e,I,this);const rr={sql:e,params:I?I.reduce((lr,dr,mr)=>(lr["param"+mr]=dr,lr),{}):void 0,json:!0},ir=this.driver.instanceDatabase.runStream(rr);return B&&ir.on("end",B),tr&&ir.on("error",tr),ir}catch(rr){throw this.driver.connection.logger.logQueryError(rr,e,I,this),new QueryFailedError(e,I,rr)}}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){throw new TypeORMError("Check database queries are not supported by Spanner driver.")}async getCurrentDatabase(){throw new TypeORMError("Check database queries are not supported by Spanner driver.")}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){throw new TypeORMError("Check schema queries are not supported by Spanner driver.")}async hasTable(e){const B=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` = '${e instanceof Table?e.name:e}'`;return!!(await this.query(B)).length}async hasColumn(e,I){const tr=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` = '${e instanceof Table?e.name:e}' AND \`COLUMN_NAME\` = '${I}'`;return!!(await this.query(tr)).length}async createDatabase(e,I){if(I&&await this.hasDatabase(e))return Promise.resolve();const B=`CREATE DATABASE "${e}"`,tr=`DROP DATABASE "${e}"`;await this.executeQueries(new Query(B),new Query(tr))}async dropDatabase(e,I){const B=I?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,tr=`CREATE DATABASE "${e}"`;await this.executeQueries(new Query(B),new Query(tr))}async createSchema(e,I){return Promise.resolve()}async dropSchema(e,I,B){return Promise.resolve()}async createTable(e,I=!1,B=!0,tr=!0){if(I&&await this.hasTable(e))return Promise.resolve();const rr=[],ir=[];rr.push(this.createTableSql(e,B)),ir.push(this.dropTableSql(e)),B&&e.foreignKeys.forEach(dr=>ir.push(this.dropForeignKeySql(e,dr))),tr&&e.indices.forEach(dr=>{dr.name||(dr.name=this.connection.namingStrategy.indexName(e,dr.columnNames,dr.where)),rr.push(this.createIndexSql(e,dr)),ir.push(this.dropIndexSql(e,dr))});const lr=e.columns.filter(dr=>dr.generatedType&&dr.asExpression);for(const dr of lr){const mr=this.insertTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name,value:dr.asExpression}),hr=this.deleteTypeormMetadataSql({table:e.name,type:MetadataTableType.GENERATED_COLUMN,name:dr.name});rr.push(mr),ir.push(hr)}await this.executeQueries(rr,ir)}async dropTable(e,I,B=!0,tr=!0){if(I&&!await this.hasTable(e))return Promise.resolve();const rr=B,ir=this.getTablePath(e),lr=await this.getCachedTable(ir),dr=[],mr=[];tr&&lr.indices.forEach(fr=>{dr.push(this.dropIndexSql(lr,fr)),mr.push(this.createIndexSql(lr,fr))}),B&&lr.foreignKeys.forEach(fr=>dr.push(this.dropForeignKeySql(lr,fr))),dr.push(this.dropTableSql(lr)),mr.push(this.createTableSql(lr,rr));const hr=lr.columns.filter(fr=>fr.generatedType&&fr.asExpression);for(const fr of hr){const _r=this.deleteTypeormMetadataSql({table:lr.name,type:MetadataTableType.GENERATED_COLUMN,name:fr.name}),gr=this.insertTypeormMetadataSql({table:lr.name,type:MetadataTableType.GENERATED_COLUMN,name:fr.name,value:fr.asExpression});dr.push(_r),mr.push(gr)}await this.executeQueries(dr,mr)}async createView(e){const I=[],B=[];I.push(this.createViewSql(e)),I.push(await this.insertViewDefinitionSql(e)),B.push(this.dropViewSql(e)),B.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(I,B)}async dropView(e){const I=e instanceof View?e.name:e,B=await this.getCachedView(I),tr=[],rr=[];tr.push(await this.deleteViewDefinitionSql(B)),tr.push(this.dropViewSql(B)),rr.push(await this.insertViewDefinitionSql(B)),rr.push(this.createViewSql(B)),await this.executeQueries(tr,rr)}async renameTable(e,I){throw new TypeORMError("Rename table queries are not supported by Spanner driver.")}async addColumn(e,I){const B=e instanceof Table?e:await this.getCachedTable(e),tr=B.clone(),rr=[],ir=[];rr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD ${this.buildCreateColumnSql(I)}`)),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP COLUMN ${this.driver.escape(I.name)}`));const lr=tr.indices.find(dr=>dr.columnNames.length===1&&dr.columnNames[0]===I.name);if(lr)rr.push(this.createIndexSql(B,lr)),ir.push(this.dropIndexSql(B,lr));else if(I.isUnique){const dr=new TableIndex({name:this.connection.namingStrategy.indexName(B,[I.name]),columnNames:[I.name],isUnique:!0});tr.indices.push(dr),tr.uniques.push(new TableUnique({name:dr.name,columnNames:dr.columnNames})),rr.push(this.createIndexSql(B,dr)),ir.push(this.dropIndexSql(B,dr))}if(I.generatedType&&I.asExpression){const dr=this.insertTypeormMetadataSql({table:B.name,type:MetadataTableType.GENERATED_COLUMN,name:I.name,value:I.asExpression}),mr=this.deleteTypeormMetadataSql({table:B.name,type:MetadataTableType.GENERATED_COLUMN,name:I.name});rr.push(dr),ir.push(mr)}await this.executeQueries(rr,ir),tr.addColumn(I),this.replaceCachedTable(B,tr)}async addColumns(e,I){for(const B of I)await this.addColumn(e,B)}async renameColumn(e,I,B){const tr=e instanceof Table?e:await this.getCachedTable(e),rr=I instanceof TableColumn?I:tr.columns.find(lr=>lr.name===I);if(!rr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);let ir;return B instanceof TableColumn?ir=B:(ir=rr.clone(),ir.name=B),this.changeColumn(tr,rr,ir)}async changeColumn(e,I,B){const tr=e instanceof Table?e:await this.getCachedTable(e);let rr=tr.clone();const ir=[],lr=[],dr=I instanceof TableColumn?I:tr.columns.find(mr=>mr.name===I);if(!dr)throw new TypeORMError(`Column "${I}" was not found in the "${tr.name}" table.`);if(dr.name!==B.name||dr.type!==B.type||dr.length!==B.length||dr.isArray!==B.isArray||dr.generatedType!==B.generatedType||dr.asExpression!==B.asExpression)await this.dropColumn(tr,dr),await this.addColumn(tr,B),rr=tr.clone();else if((B.precision!==dr.precision||B.scale!==dr.scale)&&(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${this.driver.createFullType(B)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${B.name}" TYPE ${this.driver.createFullType(dr)}`))),dr.isNullable!==B.isNullable&&(B.isNullable?(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${dr.name}" DROP NOT NULL`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${dr.name}" SET NOT NULL`))):(ir.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${dr.name}" SET NOT NULL`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(tr)} ALTER COLUMN "${dr.name}" DROP NOT NULL`)))),B.isUnique!==dr.isUnique)if(B.isUnique===!0){const mr=new TableIndex({name:this.connection.namingStrategy.indexName(tr,[B.name]),columnNames:[B.name],isUnique:!0});rr.indices.push(mr),rr.uniques.push(new TableUnique({name:mr.name,columnNames:mr.columnNames})),ir.push(this.createIndexSql(tr,mr)),lr.push(this.dropIndexSql(tr,mr))}else{const mr=rr.indices.find(fr=>fr.columnNames.length===1&&fr.isUnique===!0&&!!fr.columnNames.find(_r=>_r===B.name));rr.indices.splice(rr.indices.indexOf(mr),1);const hr=rr.uniques.find(fr=>fr.name===mr.name);rr.uniques.splice(rr.uniques.indexOf(hr),1),ir.push(this.dropIndexSql(tr,mr)),lr.push(this.createIndexSql(tr,mr))}await this.executeQueries(ir,lr),this.replaceCachedTable(tr,rr)}async changeColumns(e,I){for(const{oldColumn:B,newColumn:tr}of I)await this.changeColumn(e,B,tr)}async dropColumn(e,I){const B=e instanceof Table?e:await this.getCachedTable(e),tr=I instanceof TableColumn?I:B.findColumnByName(I);if(!tr)throw new TypeORMError(`Column "${I}" was not found in table "${B.name}"`);const rr=B.clone(),ir=[],lr=[],dr=rr.indices.find(hr=>hr.columnNames.length===1&&hr.columnNames[0]===tr.name);dr&&(rr.indices.splice(rr.indices.indexOf(dr),1),ir.push(this.dropIndexSql(B,dr)),lr.push(this.createIndexSql(B,dr)));const mr=rr.checks.find(hr=>!!hr.columnNames&&hr.columnNames.length===1&&hr.columnNames[0]===tr.name);if(mr&&(rr.checks.splice(rr.checks.indexOf(mr),1),ir.push(this.dropCheckConstraintSql(B,mr)),lr.push(this.createCheckConstraintSql(B,mr))),ir.push(new Query(`ALTER TABLE ${this.escapePath(B)} DROP COLUMN ${this.driver.escape(tr.name)}`)),lr.push(new Query(`ALTER TABLE ${this.escapePath(B)} ADD ${this.buildCreateColumnSql(tr)}`)),tr.generatedType&&tr.asExpression){const hr=this.deleteTypeormMetadataSql({table:B.name,type:MetadataTableType.GENERATED_COLUMN,name:tr.name}),fr=this.insertTypeormMetadataSql({table:B.name,type:MetadataTableType.GENERATED_COLUMN,name:tr.name,value:tr.asExpression});ir.push(hr),lr.push(fr)}await this.executeQueries(ir,lr),rr.removeColumn(tr),this.replaceCachedTable(B,rr)}async dropColumns(e,I){for(const B of I)await this.dropColumn(e,B)}async createPrimaryKey(e,I){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async updatePrimaryKeys(e,I){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async dropPrimaryKey(e){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async createUniqueConstraint(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,I){throw new TypeORMError("Spanner does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,I){const B=e instanceof Table?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.checkConstraintName(B,I.expression));const tr=this.createCheckConstraintSql(B,I),rr=this.dropCheckConstraintSql(B,I);await this.executeQueries(tr,rr),B.addCheckConstraint(I)}async createCheckConstraints(e,I){const B=I.map(tr=>this.createCheckConstraint(e,tr));await Promise.all(B)}async dropCheckConstraint(e,I){const B=e instanceof Table?e:await this.getCachedTable(e),tr=I instanceof TableCheck?I:B.checks.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied check constraint was not found in table ${B.name}`);const rr=this.dropCheckConstraintSql(B,tr),ir=this.createCheckConstraintSql(B,tr);await this.executeQueries(rr,ir),B.removeCheckConstraint(tr)}async dropCheckConstraints(e,I){const B=I.map(tr=>this.dropCheckConstraint(e,tr));await Promise.all(B)}async createExclusionConstraint(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async createExclusionConstraints(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async dropExclusionConstraint(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async dropExclusionConstraints(e,I){throw new TypeORMError("Spanner does not support exclusion constraints.")}async createForeignKey(e,I){const B=e instanceof Table?e:await this.getCachedTable(e);I.name||(I.name=this.connection.namingStrategy.foreignKeyName(B,I.columnNames,this.getTablePath(I),I.referencedColumnNames));const tr=this.createForeignKeySql(B,I),rr=this.dropForeignKeySql(B,I);await this.executeQueries(tr,rr),B.addForeignKey(I)}async createForeignKeys(e,I){for(const B of I)await this.createForeignKey(e,B)}async dropForeignKey(e,I){const B=e instanceof Table?e:await this.getCachedTable(e),tr=I instanceof TableForeignKey?I:B.foreignKeys.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied foreign key was not found in table ${B.name}`);const rr=this.dropForeignKeySql(B,tr),ir=this.createForeignKeySql(B,tr);await this.executeQueries(rr,ir),B.removeForeignKey(tr)}async dropForeignKeys(e,I){for(const B of I)await this.dropForeignKey(e,B)}async createIndex(e,I){const B=e instanceof Table?e:await this.getCachedTable(e);I.name||(I.name=this.generateIndexName(B,I));const tr=this.createIndexSql(B,I),rr=this.dropIndexSql(B,I);await this.executeQueries(tr,rr),B.addIndex(I)}async createIndices(e,I){for(const B of I)await this.createIndex(e,B)}async dropIndex(e,I){const B=e instanceof Table?e:await this.getCachedTable(e),tr=I instanceof TableIndex?I:B.indices.find(lr=>lr.name===I);if(!tr)throw new TypeORMError(`Supplied index ${I} was not found in table ${B.name}`);tr.name||(tr.name=this.generateIndexName(B,tr));const rr=this.dropIndexSql(B,tr),ir=this.createIndexSql(B,tr);await this.executeQueries(rr,ir),B.removeIndex(tr)}async dropIndices(e,I){for(const B of I)await this.dropIndex(e,B)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)} WHERE true`)}async clearDatabase(){const I=await this.query("SELECT concat('DROP INDEX `', INDEX_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`INDEXES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `INDEX_TYPE` = 'INDEX' AND `SPANNER_IS_MANAGED` = false"),tr=await this.query("SELECT concat('ALTER TABLE `', TABLE_NAME, '`', ' DROP CONSTRAINT `', CONSTRAINT_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLE_CONSTRAINTS` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `CONSTRAINT_TYPE` = 'FOREIGN KEY'"),ir=await this.query("SELECT concat('DROP TABLE `', TABLE_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'");if(!I.length&&!tr.length&&!ir.length)return;const lr=this.isTransactionActive;lr||await this.startTransaction();try{for(let dr of I)await this.updateDDL(dr.query);for(let dr of tr)await this.updateDDL(dr.query);for(let dr of ir)await this.updateDDL(dr.query);await this.commitTransaction()}catch(dr){try{lr||await this.rollbackTransaction()}catch{}throw dr}}async executeMemoryUpSql(){for(const{query:e,parameters:I}of this.sqlInMemory.upQueries)this.isDMLQuery(e)?await this.query(e,I):await this.updateDDL(e,I)}async executeMemoryDownSql(){for(const{query:e,parameters:I}of this.sqlInMemory.downQueries.reverse())this.isDMLQuery(e)?await this.query(e,I):await this.updateDDL(e,I)}async loadViews(e){return Promise.resolve([])}async loadTables(e){if(e&&e.length===0)return[];const I=[];if(!e||!e.length)I.push(...await this.query("SELECT `TABLE_NAME` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'"));else{const Sr=`SELECT \`TABLE_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` IN (${e.map(Ar=>`'${Ar}'`).join(", ")})`;I.push(...await this.query(Sr))}if(!I.length)return[];const B=I.map(Sr=>`'${Sr.TABLE_NAME}'`).join(", "),tr=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` IN (${B})`,rr=`SELECT \`KCU\`.\`TABLE_NAME\`, \`KCU\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'PRIMARY KEY' AND \`TC\`.\`TABLE_NAME\` IN (${B})`,ir=`SELECT \`I\`.\`TABLE_NAME\`, \`I\`.\`INDEX_NAME\`, \`I\`.\`IS_UNIQUE\`, \`I\`.\`IS_NULL_FILTERED\`, \`IC\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`INDEXES\` \`I\` INNER JOIN \`INFORMATION_SCHEMA\`.\`INDEX_COLUMNS\` \`IC\` ON \`IC\`.\`INDEX_NAME\` = \`I\`.\`INDEX_NAME\` AND \`IC\`.\`TABLE_NAME\` = \`I\`.\`TABLE_NAME\` WHERE \`I\`.\`TABLE_CATALOG\` = '' AND \`I\`.\`TABLE_SCHEMA\` = '' AND \`I\`.\`TABLE_NAME\` IN (${B}) AND \`I\`.\`INDEX_TYPE\` = 'INDEX' AND \`I\`.\`SPANNER_IS_MANAGED\` = false`,lr=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`CC\`.\`CHECK_CLAUSE\`, \`CCU\`.\`COLUMN_NAME\`FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CHECK_CONSTRAINTS\` \`CC\` ON \`CC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'CHECK' AND \`TC\`.\`TABLE_NAME\` IN (${B}) AND \`TC\`.\`CONSTRAINT_NAME\` NOT LIKE 'CK_IS_NOT_NULL%'`,dr=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`KCU\`.\`COLUMN_NAME\`, \`CTU\`.\`TABLE_NAME\` AS \`REFERENCED_TABLE_NAME\`, \`CCU\`.\`COLUMN_NAME\` AS \`REFERENCED_COLUMN_NAME\`, \`RC\`.\`UPDATE_RULE\`, \`RC\`.\`DELETE_RULE\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_TABLE_USAGE\` \`CTU\` ON \`CTU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`RC\` ON \`RC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'FOREIGN KEY' AND \`TC\`.\`TABLE_NAME\` IN (${B})`,[mr,hr,fr,_r,gr]=await Promise.all([this.query(tr),this.query(rr),this.query(ir),this.query(lr),this.query(dr)]);return Promise.all(I.map(async Sr=>{const Ar=new Table;Ar.name=this.driver.buildTableName(Sr.TABLE_NAME),Ar.columns=await Promise.all(mr.filter(xr=>xr.TABLE_NAME===Sr.TABLE_NAME).map(async xr=>{const kr=fr.filter(ps=>ps.TABLE_NAME===Sr.TABLE_NAME&&ps.COLUMN_NAME===xr.COLUMN_NAME&&ps.IS_UNIQUE===!0),Gr=this.connection.entityMetadatas.find(ps=>this.getTablePath(Ar)===this.getTablePath(ps)),is=kr.length>0&&Gr&&Gr.indices.some(ps=>kr.some(Ur=>ps.name===Ur.INDEX_NAME&&ps.synchronize===!1)),as=kr.every(ps=>fr.some(Ur=>Ur.INDEX_NAME===ps.INDEX_NAME&&Ur.COLUMN_NAME!==xr.COLUMN_NAME)),cs=new TableColumn;cs.name=xr.COLUMN_NAME;let es=xr.SPANNER_TYPE.toLowerCase();if(es.indexOf("array")!==-1&&(cs.isArray=!0,es=es.substring(es.indexOf("<")+1,es.indexOf(">"))),es.indexOf("(")!==-1?cs.type=es.substring(0,es.indexOf("(")):cs.type=es,this.driver.withLengthColumnTypes.indexOf(cs.type)!==-1&&(cs.length=es.substring(es.indexOf("(")+1,es.indexOf(")"))),xr.IS_GENERATED==="ALWAYS"){cs.asExpression=xr.GENERATION_EXPRESSION,cs.generatedType="STORED";const ps=this.selectTypeormMetadataSql({table:Sr.TABLE_NAME,type:MetadataTableType.GENERATED_COLUMN,name:cs.name}),Ur=await this.query(ps.query,ps.parameters);Ur[0]&&Ur[0].value?cs.asExpression=Ur[0].value:cs.asExpression=""}return cs.isUnique=kr.length>0&&!is&&!as,cs.isNullable=xr.IS_NULLABLE==="YES",cs.isPrimary=hr.some(ps=>ps.TABLE_NAME===xr.TABLE_NAME&&ps.COLUMN_NAME===xr.COLUMN_NAME),cs}));const Or=gr.filter(xr=>xr.TABLE_NAME===Sr.TABLE_NAME);Ar.foreignKeys=OrmUtils.uniq(Or,xr=>xr.CONSTRAINT_NAME).map(xr=>{const kr=Or.filter(Gr=>Gr.CONSTRAINT_NAME===xr.CONSTRAINT_NAME);return new TableForeignKey({name:xr.CONSTRAINT_NAME,columnNames:OrmUtils.uniq(kr.map(Gr=>Gr.COLUMN_NAME)),referencedDatabase:xr.REFERENCED_TABLE_SCHEMA,referencedTableName:xr.REFERENCED_TABLE_NAME,referencedColumnNames:OrmUtils.uniq(kr.map(Gr=>Gr.REFERENCED_COLUMN_NAME)),onDelete:xr.DELETE_RULE,onUpdate:xr.UPDATE_RULE})});const Fr=fr.filter(xr=>xr.TABLE_NAME===Sr.TABLE_NAME);Ar.indices=OrmUtils.uniq(Fr,xr=>xr.INDEX_NAME).map(xr=>{const kr=Fr.filter(Gr=>Gr.INDEX_NAME===xr.INDEX_NAME);return new TableIndex({table:Ar,name:xr.INDEX_NAME,columnNames:kr.map(Gr=>Gr.COLUMN_NAME),isUnique:xr.IS_UNIQUE,isNullFiltered:xr.IS_NULL_FILTERED})});const vr=_r.filter(xr=>xr.TABLE_NAME===Sr.TABLE_NAME);return Ar.checks=OrmUtils.uniq(vr,xr=>xr.CONSTRAINT_NAME).map(xr=>{const kr=vr.filter(Gr=>Gr.CONSTRAINT_NAME===xr.CONSTRAINT_NAME);return new TableCheck({name:xr.CONSTRAINT_NAME,columnNames:kr.map(Gr=>Gr.COLUMN_NAME),expression:xr.CHECK_CLAUSE})}),Ar}))}createTableSql(e,I){const B=e.columns.map(ir=>this.buildCreateColumnSql(ir)).join(", ");let tr=`CREATE TABLE ${this.escapePath(e)} (${B}`;if(e.columns.filter(ir=>ir.isUnique).forEach(ir=>{const lr=e.indices.some(mr=>mr.columnNames.length===1&&!!mr.isUnique&&mr.columnNames.indexOf(ir.name)!==-1),dr=e.uniques.some(mr=>mr.columnNames.length===1&&mr.columnNames.indexOf(ir.name)!==-1);!lr&&!dr&&e.indices.push(new TableIndex({name:this.connection.namingStrategy.uniqueConstraintName(e,[ir.name]),columnNames:[ir.name],isUnique:!0}))}),e.uniques.length>0&&e.uniques.forEach(ir=>{e.indices.some(dr=>dr.name===ir.name)||e.indices.push(new TableIndex({name:ir.name,columnNames:ir.columnNames,isUnique:!0}))}),e.checks.length>0){const ir=e.checks.map(lr=>`CONSTRAINT \`${lr.name?lr.name:this.connection.namingStrategy.checkConstraintName(e,lr.expression)}\` CHECK (${lr.expression})`).join(", ");tr+=`, ${ir}`}if(e.foreignKeys.length>0&&I){const ir=e.foreignKeys.map(lr=>{const dr=lr.columnNames.map(hr=>`\`${hr}\``).join(", ");lr.name||(lr.name=this.connection.namingStrategy.foreignKeyName(e,lr.columnNames,this.getTablePath(lr),lr.referencedColumnNames));const mr=lr.referencedColumnNames.map(hr=>`\`${hr}\``).join(", ");return`CONSTRAINT \`${lr.name}\` FOREIGN KEY (${dr}) REFERENCES ${this.escapePath(this.getTablePath(lr))} (${mr})`}).join(", ");tr+=`, ${ir}`}tr+=")";const rr=e.columns.filter(ir=>ir.isPrimary);if(rr.length>0){const ir=rr.map(lr=>this.driver.escape(lr.name)).join(", ");tr+=` PRIMARY KEY (${ir})`}return new Query(tr)}dropTableSql(e){return new Query(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const I=e.materialized?"MATERIALIZED ":"",B=this.escapePath(e),tr=typeof e.expression=="string"?e.expression:e.expression(this.connection).getQuery();return new Query(`CREATE ${I}VIEW ${B} SQL SECURITY INVOKER AS ${tr}`)}async insertViewDefinitionSql(e){let{schema:I,tableName:B}=this.driver.parseTableName(e);const tr=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW,rr=typeof e.expression=="string"?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:tr,schema:I,name:B,value:rr})}dropViewSql(e){const I=e.materialized?"MATERIALIZED ":"";return new Query(`DROP ${I}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){let{schema:I,tableName:B}=this.driver.parseTableName(e);const tr=e.materialized?MetadataTableType.MATERIALIZED_VIEW:MetadataTableType.VIEW;return this.deleteTypeormMetadataSql({type:tr,schema:I,name:B})}createIndexSql(e,I){const B=I.columnNames.map(rr=>this.driver.escape(rr)).join(", ");let tr="";return I.isUnique&&(tr+="UNIQUE "),I.isNullFiltered&&(tr+="NULL_FILTERED "),new Query(`CREATE ${tr}INDEX \`${I.name}\` ON ${this.escapePath(e)} (${B})`)}dropIndexSql(e,I){let B=I instanceof TableIndex?I.name:I;return new Query(`DROP INDEX \`${B}\``)}createCheckConstraintSql(e,I){return new Query(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${I.name}\` CHECK (${I.expression})`)}dropCheckConstraintSql(e,I){const B=I instanceof TableCheck?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${B}\``)}createForeignKeySql(e,I){const B=I.columnNames.map(ir=>this.driver.escape(ir)).join(", "),tr=I.referencedColumnNames.map(ir=>this.driver.escape(ir)).join(",");let rr=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${I.name}\` FOREIGN KEY (${B}) REFERENCES ${this.escapePath(this.getTablePath(I))} (${tr})`;return new Query(rr)}dropForeignKeySql(e,I){const B=I instanceof TableForeignKey?I.name:I;return new Query(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${B}\``)}escapePath(e){const{tableName:I}=this.driver.parseTableName(e);return`\`${I}\``}buildCreateColumnSql(e){let I=`${this.driver.escape(e.name)} ${this.connection.driver.createFullType(e)}`;return e.generatedType==="STORED"&&e.asExpression?I+=` AS (${e.asExpression}) STORED`:e.isNullable||(I+=" NOT NULL"),I}async executeQueries(e,I){if(e instanceof Query&&(e=[e]),I instanceof Query&&(I=[I]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...I),this.sqlMemoryMode===!0)return Promise.resolve();for(const{query:B,parameters:tr}of e)this.isDMLQuery(B)?await this.query(B,tr):await this.updateDDL(B,tr)}isDMLQuery(e){return e.startsWith("INSERT")||e.startsWith("UPDATE")||e.startsWith("DELETE")}changeTableComment(e,I){throw new TypeORMError("spanner driver does not support change table comment.")}}class SpannerDriver{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="none",this.supportedDataTypes=["bool","int64","float64","numeric","string","json","bytes","date","timestamp","array"],this.supportedUpsertTypes=[],this.spatialTypes=[],this.withLengthColumnTypes=["string","bytes"],this.withWidthColumnTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"",updateDate:"timestamp",updateDateDefault:"",deleteDate:"timestamp",deleteDateNullable:!0,version:"int64",treeLevel:"int64",migrationId:"int64",migrationName:"string",migrationTimestamp:"int64",cacheId:"string",cacheIdentifier:"string",cacheTime:"int64",cacheDuration:"int64",cacheQuery:"string",cacheResult:"string",metadataType:"string",metadataDatabase:"string",metadataSchema:"string",metadataTable:"string",metadataName:"string",metadataValue:"string"},this.parametersPrefix="@param",this.dataTypeDefaults={},this.maxAliasLength=63,this.cteCapabilities={enabled:!0},this._isReturningSqlSupported={delete:!1,insert:!1,update:!1},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}async connect(){this.instance=this.spanner.instance(this.options.instanceId),this.instanceDatabase=this.instance.database(this.options.databaseId)}afterConnect(){return Promise.resolve()}async disconnect(){this.instanceDatabase.close()}createSchemaBuilder(){return new RdbmsSchemaBuilder(this.connection)}createQueryRunner(e){return new SpannerQueryRunner(this,e)}escapeQueryWithParameters(e,I,B){const tr=Object.keys(B).map(ir=>B[ir]);if(!I||!Object.keys(I).length)return[e,tr];const rr=new Map;return e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(ir,lr,dr)=>{if(!I.hasOwnProperty(dr))return ir;if(rr.has(dr))return this.parametersPrefix+rr.get(dr);let mr=I[dr];return mr===null?ir:lr?mr.map(hr=>(tr.push(hr),this.createParameter(dr,tr.length-1))).join(", "):mr instanceof Function?mr():(tr.push(mr),rr.set(dr,tr.length-1),this.createParameter(dr,tr.length-1))}),e=e.replace(/([ ]+)?=([ ]+)?:(\.\.\.)?([A-Za-z0-9_.]+)/g,(ir,lr,dr,mr,hr)=>I.hasOwnProperty(hr)&&I[hr]===null?" IS NULL":ir),[e,tr]}escape(e){return`\`${e}\``}buildTableName(e,I,B){let tr=[e];return B&&tr.unshift(B),tr.join(".")}parseTableName(e){const I=this.database,B=void 0;if(e instanceof Table||e instanceof View){const rr=this.parseTableName(e.name);return{database:e.database||rr.database||I,schema:e.schema||rr.schema||B,tableName:rr.tableName}}if(e instanceof TableForeignKey){const rr=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||rr.database||I,schema:e.referencedSchema||rr.schema||B,tableName:rr.tableName}}if(e instanceof EntityMetadata)return{database:e.database||I,schema:e.schema||B,tableName:e.tableName};const tr=e.split(".");return{database:(tr.length>1?tr[0]:void 0)||I,schema:B,tableName:tr.length>1?tr[1]:tr[0]}}preparePersistentValue(e,I){return I.transformer&&(e=ApplyValueTransformers.transformTo(I.transformer,e)),e==null?e:I.type==="numeric"?(this.options.driver||PlatformTools.load("spanner")).Spanner.numeric(e):I.type==="date"?DateUtils.mixedDateToDateString(e):I.type==="json"?e:I.type==="timestamp"||I.type===Date?DateUtils.mixedDateToDate(e):e}prepareHydratedValue(e,I){return e==null?I.transformer?ApplyValueTransformers.transformFrom(I.transformer,e):e:(I.type===Boolean||I.type==="bool"?e=!!e:I.type==="timestamp"||I.type===Date?e=new Date(e):I.type==="numeric"?e=e.value:I.type==="date"?e=DateUtils.mixedDateToDateString(e):I.type==="json"?e=typeof e=="string"?JSON.parse(e):e:I.type===Number&&(e=isNaN(+e)?e:parseInt(e)),I.transformer&&(e=ApplyValueTransformers.transformFrom(I.transformer,e)),e)}normalizeType(e){return e.type===Number?"int64":e.type===String||e.type==="uuid"?"string":e.type===Date?"timestamp":e.type===Buffer?"bytes":e.type===Boolean?"bool":e.type||""}normalizeDefault(e){return e.default===""?`"${e.default}"`:`${e.default}`}normalizeIsUnique(e){return e.entityMetadata.indices.some(I=>I.isUnique&&I.columns.length===1&&I.columns[0]===e)}getColumnLength(e){if(e.length)return e.length.toString();if(e.generationStrategy==="uuid")return"36";switch(e.type){case String:case"string":case"bytes":return"max";default:return""}}createFullType(e){let I=e.type;return this.getColumnLength(e)?I+=`(${this.getColumnLength(e)})`:e.width?I+=`(${e.width})`:e.precision!==null&&e.precision!==void 0&&e.scale!==null&&e.scale!==void 0?I+=`(${e.precision},${e.scale})`:e.precision!==null&&e.precision!==void 0&&(I+=`(${e.precision})`),e.isArray&&(I=`array<${I}>`),I}obtainMasterConnection(){return this.instanceDatabase}obtainSlaveConnection(){return this.instanceDatabase}createGeneratedMap(e,I,B){if(!I)return;if(I.insertId===void 0)return Object.keys(I).reduce((rr,ir)=>{const lr=e.findColumnWithDatabaseName(ir);return lr&&OrmUtils.mergeDeep(rr,lr.createValueMap(I[ir])),rr},{});const tr=e.generatedColumns.reduce((rr,ir)=>{let lr;return ir.generationStrategy==="increment"&&I.insertId&&(lr=I.insertId+B),OrmUtils.mergeDeep(rr,ir.createValueMap(lr))},{});return Object.keys(tr).length>0?tr:void 0}findChangedColumns(e,I){return I.filter(B=>{const tr=e.find(ir=>ir.name===B.databaseName);return tr?tr.name!==B.databaseName||tr.type!==this.normalizeType(B)||tr.length!==this.getColumnLength(B)||tr.asExpression!==B.asExpression||tr.generatedType!==B.generatedType||tr.isPrimary!==B.isPrimary||!this.compareNullableValues(B,tr)||tr.isUnique!==this.normalizeIsUnique(B):!1})}isReturningSqlSupported(e){return this._isReturningSqlSupported[e]}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,I){return this.parametersPrefix+I}loadDependencies(){try{const e=this.options.driver||PlatformTools.load("spanner");this.spanner=new e.Spanner({projectId:this.options.projectId})}catch(e){throw console.error(e),new DriverPackageNotInstalledError("Spanner","@google-cloud/spanner")}}compareNullableValues(e,I){return e.generatedType?!0:e.isNullable===I.isNullable}compareDefaultValues(e,I){return typeof e=="string"&&typeof I=="string"&&(e=e.replace(/^'+|'+$/g,""),I=I.replace(/^'+|'+$/g,"")),e===I}normalizeDatetimeFunction(e){if(!e)return e;if(e.toUpperCase().indexOf("CURRENT_TIMESTAMP")!==-1||e.toUpperCase().indexOf("NOW")!==-1){const B=e.match(/\(\d+\)/);return B?`CURRENT_TIMESTAMP${B[0]}`:"CURRENT_TIMESTAMP"}else return e}escapeComment(e){return e&&(e=e.replace(/\u0000/g,""),e)}}class DriverFactory{create(e){const{type:I}=e.options;switch(I){case"mysql":return new MysqlDriver(e);case"postgres":return new PostgresDriver(e);case"cockroachdb":return new CockroachDriver(e);case"sap":return new SapDriver(e);case"mariadb":return new MysqlDriver(e);case"sqlite":return new SqliteDriver(e);case"better-sqlite3":return new BetterSqlite3Driver(e);case"cordova":return new CordovaDriver(e);case"nativescript":return new NativescriptDriver(e);case"react-native":return new ReactNativeDriver(e);case"sqljs":return new SqljsDriver(e);case"oracle":return new OracleDriver(e);case"mssql":return new SqlServerDriver(e);case"mongodb":return new MongoDriver(e);case"expo":return new ExpoDriver(e);case"aurora-mysql":return new AuroraMysqlDriver(e);case"aurora-postgres":return new AuroraPostgresDriver(e);case"capacitor":return new CapacitorDriver(e);case"spanner":return new SpannerDriver(e);default:throw new MissingDriverError(I,["aurora-mysql","aurora-postgres","better-sqlite3","capacitor","cockroachdb","cordova","expo","mariadb","mongodb","mssql","mysql","nativescript","oracle","postgres","react-native","sap","sqlite","sqljs","spanner"])}}}function importClassesFromDirectories(k,e,I=[".js",".cjs",".ts"]){return[]}const defaultContainer=new class{constructor(){this.instances=[]}get(k){let e=this.instances.find(I=>I.type===k);return e||(e={type:k,object:new k},this.instances.push(e)),e.object}};function getFromContainer(k){return defaultContainer.get(k)}class ColumnMetadata{constructor(e){this["@instanceof"]=Symbol.for("ColumnMetadata"),this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isVirtualProperty=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),e.args.options.default===null&&(this.isNullable=!0),e.args.options.nullable!==void 0&&(this.isNullable=e.args.options.nullable),e.args.options.select!==void 0&&(this.isSelect=e.args.options.select),e.args.options.insert!==void 0&&(this.isInsert=e.args.options.insert),e.args.options.update!==void 0&&(this.isUpdate=e.args.options.update),e.args.options.readonly!==void 0&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),e.args.options.default!==void 0&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),e.args.options.generatedIdentity&&(this.generatedIdentity=e.args.options.generatedIdentity),e.args.options.scale!==null&&e.args.options.scale!==void 0&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),e.args.options.precision!==null&&(this.precision=e.args.options.precision),e.args.options.enum&&(ObjectUtils.isObject(e.args.options.enum)&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter(I=>isNaN(+I)&&typeof e.args.options.enum[I]!="function").map(I=>e.args.options.enum[I]):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.primaryKeyConstraintName&&(this.primaryKeyConstraintName=e.args.options.primaryKeyConstraintName),e.args.options.foreignKeyConstraintName&&(this.foreignKeyConstraintName=e.args.options.foreignKeyConstraintName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtualProperty=e.args.mode==="virtual-property",this.isVirtual=e.args.mode==="virtual",this.isTreeLevel=e.args.mode==="treeLevel",this.isCreateDate=e.args.mode==="createDate",this.isUpdateDate=e.args.mode==="updateDate",this.isDeleteDate=e.args.mode==="deleteDate",this.isVersion=e.args.mode==="version",this.isObjectId=e.args.mode==="objectId"),this.isVirtualProperty&&(this.isInsert=!1,this.isUpdate=!1),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),e.args.options.srid!==void 0&&(this.srid=e.args.options.srid),e.args.options.query&&(this.query=e.args.options.query),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.createDateDefault),this.precision===void 0&&e.args.options.precision===void 0&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.updateDateDefault),this.onUpdate||(this.onUpdate=e.connection.driver.mappedDataTypes.updateDateDefault),this.precision===void 0&&e.args.options.precision===void 0&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),this.precision===void 0&&e.args.options.precision===void 0&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}createValueMap(e,I=!1){if(this.embeddedMetadata){const B=[...this.embeddedMetadata.parentPropertyNames],tr=(rr,ir)=>{const lr=rr.shift();return lr?(ir[lr]={},tr(rr,ir[lr]),ir):((this.generationStrategy==="increment"||this.generationStrategy==="rowid")&&this.type==="bigint"&&e!==null&&(e=String(e)),ir[I?this.databaseName:this.propertyName]=e,ir)};return tr(B,{})}else return(this.generationStrategy==="increment"||this.generationStrategy==="rowid")&&this.type==="bigint"&&e!==null&&(e=String(e)),{[I?this.databaseName:this.propertyName]:e}}getEntityValueMap(e,I){if(this.embeddedMetadata){const tr=[...this.embeddedMetadata.parentPropertyNames],rr=this.embeddedMetadata.isArray,ir=(dr,mr)=>{if(mr===void 0)return{};const hr=dr.shift();if(hr){const fr=ir(dr,mr[hr]);return Object.keys(fr).length>0?{[hr]:fr}:{}}return rr&&Array.isArray(mr)?mr.map(fr=>({[this.propertyName]:fr[this.propertyName]})):mr[this.propertyName]!==void 0?{[this.propertyName]:mr[this.propertyName]}:{}},lr=ir(tr,e);return Object.keys(lr).length>0?lr:void 0}else if(this.relationMetadata&&!Object.getOwnPropertyDescriptor(e,this.relationMetadata.propertyName)?.get&&e[this.relationMetadata.propertyName]&&ObjectUtils.isObject(e[this.relationMetadata.propertyName])){const tr=this.relationMetadata.joinColumns.reduce((rr,ir)=>{const lr=ir.referencedColumn.getEntityValueMap(e[this.relationMetadata.propertyName]);return lr===void 0?rr:OrmUtils.mergeDeep(rr,lr)},{});return Object.keys(tr).length>0?{[this.propertyName]:tr}:void 0}else return e[this.propertyName]!==void 0?{[this.propertyName]:e[this.propertyName]}:void 0}getEntityValue(e,I=!1){if(e==null)return;let B;if(this.embeddedMetadata){const tr=[...this.embeddedMetadata.parentPropertyNames],rr=this.embeddedMetadata.isArray,ir=(dr,mr)=>{const hr=dr.shift();return hr&&mr?ir(dr,mr[hr]):mr},lr=ir(tr,e);if(lr)if(this.relationMetadata&&this.referencedColumn){const dr=this.relationMetadata.getEntityValue(lr);dr&&ObjectUtils.isObject(dr)&&!InstanceChecker.isFindOperator(dr)&&!Buffer.isBuffer(dr)?B=this.referencedColumn.getEntityValue(dr):lr[this.propertyName]&&ObjectUtils.isObject(lr[this.propertyName])&&!InstanceChecker.isFindOperator(lr[this.propertyName])&&!Buffer.isBuffer(lr[this.propertyName])&&!(lr[this.propertyName]instanceof Date)?B=this.referencedColumn.getEntityValue(lr[this.propertyName]):B=lr[this.propertyName]}else this.referencedColumn?B=this.referencedColumn.getEntityValue(lr[this.propertyName]):rr&&Array.isArray(lr)?B=lr.map(dr=>dr[this.propertyName]):B=lr[this.propertyName]}else if(this.relationMetadata&&this.referencedColumn){const tr=this.relationMetadata.getEntityValue(e);tr&&ObjectUtils.isObject(tr)&&!InstanceChecker.isFindOperator(tr)&&typeof tr!="function"&&!Buffer.isBuffer(tr)?B=this.referencedColumn.getEntityValue(tr):e[this.propertyName]&&ObjectUtils.isObject(e[this.propertyName])&&!InstanceChecker.isFindOperator(e[this.propertyName])&&typeof e[this.propertyName]!="function"&&!Buffer.isBuffer(e[this.propertyName])&&!(e[this.propertyName]instanceof Date)?B=this.referencedColumn.getEntityValue(e[this.propertyName]):B=e[this.propertyName]}else this.referencedColumn?B=this.referencedColumn.getEntityValue(e[this.propertyName]):B=e[this.propertyName];return I&&this.transformer&&(B=ApplyValueTransformers.transformTo(this.transformer,B)),B}setEntityValue(e,I){if(this.embeddedMetadata){const B=(tr,rr)=>{const ir=tr.shift();return ir?(rr[ir.propertyName]||(rr[ir.propertyName]=ir.create()),B(tr,rr[ir.propertyName]),rr):(rr[this.propertyName]=I,rr)};return B([...this.embeddedMetadata.embeddedMetadataTree],e)}else!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in e||(e[this.propertyName]={}),e[this.propertyName][this.referencedColumn.propertyName]=I):e[this.propertyName]=I}compareEntityValue(e,I){const B=this.getEntityValue(e);return ObjectUtils.isObject(B)?B.equals(I):B===I}build(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this}buildPropertyPath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e}buildDatabasePath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e}buildDatabaseName(e){let I=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver.options.type==="mongodb"&&(I=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,I)}}class IndexMetadata{constructor(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.isNullFiltered=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,e.args.synchronize!==null&&e.args.synchronize!==void 0&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.isNullFiltered=!!e.args.nullFiltered,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.isConcurrent=e.args.concurrent,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}build(e){if(this.synchronize===!1)return this.name=this.givenName,this;const I={};if(this.givenColumnNames){let B=[];if(Array.isArray(this.givenColumnNames))B=this.givenColumnNames.map(tr=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+tr:tr.trim()),B.forEach(tr=>I[tr]=1);else{const tr=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(tr)?(B=tr.map(rr=>String(rr)),B.forEach(rr=>I[rr]=1)):(B=Object.keys(tr).map(rr=>String(rr)),Object.keys(tr).forEach(rr=>I[rr]=tr[rr]))}this.columns=B.map(tr=>{const rr=this.entityMetadata.columns.find(mr=>mr.propertyPath===tr);if(rr)return[rr];const ir=this.entityMetadata.relations.find(mr=>mr.isWithJoinColumn&&mr.propertyName===tr);if(ir)return ir.joinColumns;const lr=this.givenName?'"'+this.givenName+'" ':"",dr=this.entityMetadata.targetName;throw new TypeORMError(`Index ${lr}contains column that is missing in the entity (${dr}): `+tr)}).reduce((tr,rr)=>tr.concat(rr))}return this.columnNamesWithOrderingMap=Object.keys(I).reduce((B,tr)=>{const rr=this.entityMetadata.columns.find(ir=>ir.propertyPath===tr);return rr&&(B[rr.databasePath]=I[tr]),B},{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tableName,this.columns.map(B=>B.databaseName),this.where),this}}class RelationMetadata{constructor(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.createForeignKeyConstraints=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;const I=e.args;this.target=I.target,this.propertyName=I.propertyName,this.relationType=I.relationType,I.inverseSideProperty&&(this.givenInverseSidePropertyFactory=I.inverseSideProperty),this.isLazy=I.isLazy||!1,this.isCascadeInsert=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("insert")!==-1,this.isCascadeUpdate=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("update")!==-1,this.isCascadeRemove=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("remove")!==-1,this.isCascadeSoftRemove=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("soft-remove")!==-1,this.isCascadeRecover=I.options.cascade===!0||Array.isArray(I.options.cascade)&&I.options.cascade.indexOf("recover")!==-1,this.isNullable=!(I.options.nullable===!1||this.isPrimary),this.onDelete=I.options.onDelete,this.onUpdate=I.options.onUpdate,this.deferrable=I.options.deferrable,this.createForeignKeyConstraints=I.options.createForeignKeyConstraints!==!1,this.isEager=I.options.eager||!1,this.persistenceEnabled=I.options.persistence!==!1,this.orphanedRowAction=I.options.orphanedRowAction||"nullify",this.isTreeParent=I.isTreeParent||!1,this.isTreeChildren=I.isTreeChildren||!1,typeof I.type=="function"?this.type=typeof I.type=="function"?I.type():I.type:InstanceChecker.isEntitySchema(I.type)?this.type=I.type.options.name:ObjectUtils.isObject(I.type)&&typeof I.type.name=="string"?this.type=I.type.name:this.type=I.type,this.isOneToOne=this.relationType==="one-to-one",this.isOneToMany=this.relationType==="one-to-many",this.isManyToOne=this.relationType==="many-to-one",this.isManyToMany=this.relationType==="many-to-many",this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}getRelationIdMap(e){const B=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(tr=>tr.referencedColumn);return EntityMetadata.getValueMap(e,B)}ensureRelationIdMap(e){if(ObjectUtils.isObject(e))return e;const B=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(tr=>tr.referencedColumn);if(B.length>1)throw new TypeORMError("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return B[0].createValueMap(e)}getEntityValue(e,I=!1){if(e!=null)if(this.embeddedMetadata){const B=[...this.embeddedMetadata.parentPropertyNames],tr=(ir,lr)=>{const dr=ir.shift();return dr?lr[dr]?tr(ir,lr[dr]):void 0:lr},rr=tr(B,e);return this.isLazy?rr["__"+this.propertyName+"__"]!==void 0?rr["__"+this.propertyName+"__"]:I===!0?rr[this.propertyName]:void 0:rr?rr[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}else return this.isLazy?e["__"+this.propertyName+"__"]!==void 0?e["__"+this.propertyName+"__"]:I===!0?e[this.propertyName]:void 0:e[this.propertyName]}setEntityValue(e,I){const B=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){const tr=(rr,ir)=>{const lr=rr.shift();return lr?(ir[lr.propertyName]||(ir[lr.propertyName]=lr.create()),tr(rr,ir[lr.propertyName]),ir):(ir[B]=I,ir)};return tr([...this.embeddedMetadata.embeddedMetadataTree],e)}else e[B]=I}createValueMap(e){if(this.embeddedMetadata){const I=[...this.embeddedMetadata.parentPropertyNames],B=(tr,rr)=>{const ir=tr.shift();return ir?(rr[ir]={},B(tr,rr[ir]),rr):(rr[this.propertyName]=e,rr)};return B(I,{})}else return{[this.propertyName]:e}}build(){this.propertyPath=this.buildPropertyPath()}registerForeignKeys(...e){this.foreignKeys.push(...e)}registerJoinColumns(e=[],I=[]){this.joinColumns=e,this.inverseJoinColumns=I,this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner}registerJunctionEntityMetadata(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)}buildInverseSidePropertyPath(){if(this.givenInverseSidePropertyFactory){const e=this.inverseEntityMetadata.propertiesMap;if(typeof this.givenInverseSidePropertyFactory=="function")return this.givenInverseSidePropertyFactory(e);if(typeof this.givenInverseSidePropertyFactory=="string")return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""}buildPropertyPath(){return!this.embeddedMetadata||!this.embeddedMetadata.parentPropertyNames.length?this.propertyName:this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName}}class EmbeddedMetadata{constructor(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isAlwaysUsingConstructor=!0,this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}create(e){return typeof this.type!="function"?{}:e?.fromDeserializer||!this.isAlwaysUsingConstructor?Object.create(this.type.prototype):new this.type}build(e){return this.embeddeds.forEach(I=>I.build(e)),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),e.options.entitySkipConstructor&&(this.isAlwaysUsingConstructor=!e.options.entitySkipConstructor),this}buildPartialPrefix(){if(this.customPrefix===void 0||this.customPrefix===!0)return[this.propertyName];if(this.customPrefix===""||this.customPrefix===!1)return[];if(typeof this.customPrefix=="string")return[this.customPrefix];throw new TypeORMError(`Invalid prefix option given for ${this.entityMetadata.targetName}#${this.propertyName}`)}buildPrefix(e){if(e.driver.options.type==="mongodb")return this.propertyName;let I=[];return this.parentEmbeddedMetadata&&I.push(this.parentEmbeddedMetadata.buildPrefix(e)),I.push(...this.buildPartialPrefix()),I.join("_")}buildParentPropertyNames(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]}buildParentPrefixes(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()}buildEmbeddedMetadataTree(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]}buildColumnsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildColumnsFromTree()),this.columns)}buildRelationsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildRelationsFromTree()),this.relations)}buildListenersFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildListenersFromTree()),this.listeners)}buildIndicesFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildIndicesFromTree()),this.indices)}buildUniquesFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildUniquesFromTree()),this.uniques)}buildRelationIdsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildRelationIdsFromTree()),this.relationIds)}buildRelationCountsFromTree(){return this.embeddeds.reduce((e,I)=>e.concat(I.buildRelationCountsFromTree()),this.relationCounts)}}class RelationIdMetadata{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}setValue(e){const I=this.relation.getEntityValue(e);if(Array.isArray(I))e[this.propertyName]=I.map(B=>this.relation.inverseEntityMetadata.getEntityIdMixedMap(B)).filter(B=>B!=null);else{const B=this.relation.inverseEntityMetadata.getEntityIdMixedMap(I);B!==void 0&&(e[this.propertyName]=B)}}build(){const e=typeof this.relationNameOrFactory=="function"?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,I=this.entityMetadata.findRelationWithPropertyPath(e);if(!I)throw new TypeORMError(`Cannot find relation ${e}. Wrong relation specified for @RelationId decorator.`);this.relation=I}}class RelationCountMetadata{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}build(){const e=typeof this.relationNameOrFactory=="function"?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,I=this.entityMetadata.findRelationWithPropertyPath(e);if(!I)throw new TypeORMError(`Cannot find relation ${e}. Wrong relation specified for @RelationCount decorator.`);this.relation=I}}class EventListenerTypes{}EventListenerTypes.AFTER_LOAD="after-load";EventListenerTypes.BEFORE_INSERT="before-insert";EventListenerTypes.AFTER_INSERT="after-insert";EventListenerTypes.BEFORE_UPDATE="before-update";EventListenerTypes.AFTER_UPDATE="after-update";EventListenerTypes.BEFORE_REMOVE="before-remove";EventListenerTypes.AFTER_REMOVE="after-remove";EventListenerTypes.BEFORE_SOFT_REMOVE="before-soft-remove";EventListenerTypes.AFTER_SOFT_REMOVE="after-soft-remove";EventListenerTypes.BEFORE_RECOVER="before-recover";EventListenerTypes.AFTER_RECOVER="after-recover";class ForeignKeyMetadata{constructor(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,this.givenName=e.name,e.namingStrategy&&this.build(e.namingStrategy)}build(e){this.columnNames=this.columns.map(I=>I.databaseName),this.referencedColumnNames=this.referencedColumns.map(I=>I.databaseName),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=this.givenName?this.givenName:e.foreignKeyName(this.entityMetadata.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)}}class JunctionEntityMetadataBuilder{constructor(e){this.connection=e}build(e,I){const B=this.collectReferencedColumns(e,I),tr=this.collectInverseReferencedColumns(e,I),rr=I.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),ir=new EntityMetadata({connection:this.connection,args:{target:"",name:rr,type:"junction",database:I.database||e.entityMetadata.database,schema:I.schema||e.entityMetadata.schema,synchronize:I.synchronize}});ir.build();const lr=B.map(mr=>{const hr=I.joinColumns?I.joinColumns.find(_r=>(!_r.referencedColumnName||_r.referencedColumnName===mr.propertyName)&&!!_r.name):void 0,fr=hr&&hr.name?hr.name:this.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,mr.propertyName,mr.databaseName);return new ColumnMetadata({connection:this.connection,entityMetadata:ir,referencedColumn:mr,args:{target:"",mode:"virtual",propertyName:fr,options:{name:fr,length:!mr.length&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.normalizeType(mr)!=="uuid"&&(mr.generationStrategy==="uuid"||mr.type==="uuid")?"36":mr.length,width:mr.width,type:mr.type,precision:mr.precision,scale:mr.scale,charset:mr.charset,collation:mr.collation,zerofill:mr.zerofill,unsigned:mr.zerofill?!0:mr.unsigned,enum:mr.enum,enumName:mr.enumName,foreignKeyConstraintName:hr?.foreignKeyConstraintName,nullable:!1,primary:!0}}})}),dr=tr.map(mr=>{const hr=I.inverseJoinColumns?I.inverseJoinColumns.find(_r=>(!_r.referencedColumnName||_r.referencedColumnName===mr.propertyName)&&!!_r.name):void 0,fr=hr&&hr.name?hr.name:this.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,mr.propertyName,mr.databaseName);return new ColumnMetadata({connection:this.connection,entityMetadata:ir,referencedColumn:mr,args:{target:"",mode:"virtual",propertyName:fr,options:{length:!mr.length&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.normalizeType(mr)!=="uuid"&&(mr.generationStrategy==="uuid"||mr.type==="uuid")?"36":mr.length,width:mr.width,type:mr.type,precision:mr.precision,scale:mr.scale,charset:mr.charset,collation:mr.collation,zerofill:mr.zerofill,unsigned:mr.zerofill?!0:mr.unsigned,enum:mr.enum,enumName:mr.enumName,foreignKeyConstraintName:hr?.foreignKeyConstraintName,name:fr,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(lr,dr),ir.ownerColumns=lr,ir.inverseColumns=dr,ir.ownColumns=[...lr,...dr],ir.ownColumns.forEach(mr=>mr.relationMetadata=e),ir.foreignKeys=e.createForeignKeyConstraints?[new ForeignKeyMetadata({entityMetadata:ir,referencedEntityMetadata:e.entityMetadata,columns:lr,referencedColumns:B,name:lr[0]?.foreignKeyConstraintName,onDelete:this.connection.driver.options.type==="spanner"?"NO ACTION":e.onDelete||"CASCADE",onUpdate:this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="spanner"?"NO ACTION":e.onUpdate||"CASCADE"}),new ForeignKeyMetadata({entityMetadata:ir,referencedEntityMetadata:e.inverseEntityMetadata,columns:dr,referencedColumns:tr,name:dr[0]?.foreignKeyConstraintName,onDelete:this.connection.driver.options.type==="spanner"?"NO ACTION":e.inverseRelation?e.inverseRelation.onDelete:"CASCADE",onUpdate:this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="spanner"?"NO ACTION":e.inverseRelation?e.inverseRelation.onUpdate:"CASCADE"})]:[],ir.ownIndices=[new IndexMetadata({entityMetadata:ir,columns:lr,args:{target:ir.target,synchronize:!0}}),new IndexMetadata({entityMetadata:ir,columns:dr,args:{target:ir.target,synchronize:!0}})],ir}collectReferencedColumns(e,I){const B=I.joinColumns?I.joinColumns.find(tr=>!!tr.referencedColumnName):!1;return!I.joinColumns||I.joinColumns&&!B?e.entityMetadata.columns.filter(tr=>tr.isPrimary):I.joinColumns.map(tr=>{const rr=e.entityMetadata.columns.find(ir=>ir.propertyName===tr.referencedColumnName);if(!rr)throw new TypeORMError(`Referenced column ${tr.referencedColumnName} was not found in entity ${e.entityMetadata.name}`);return rr})}collectInverseReferencedColumns(e,I){const B=!!I.inverseJoinColumns,tr=B?I.inverseJoinColumns.find(rr=>!!rr.referencedColumnName):!1;return!B||B&&!tr?e.inverseEntityMetadata.primaryColumns:I.inverseJoinColumns.map(rr=>{const ir=e.inverseEntityMetadata.ownColumns.find(lr=>lr.propertyName===rr.referencedColumnName);if(!ir)throw new TypeORMError(`Referenced column ${rr.referencedColumnName} was not found in entity ${e.inverseEntityMetadata.name}`);return ir})}changeDuplicatedColumnNames(e,I){e.forEach(B=>{I.forEach(tr=>{if(B.givenDatabaseName===tr.givenDatabaseName){const rr=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(B.propertyName,1);B.propertyName=rr,B.givenDatabaseName=rr;const ir=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(tr.propertyName,2);tr.propertyName=ir,tr.givenDatabaseName=ir}})})}}class ClosureJunctionEntityMetadataBuilder{constructor(e){this.connection=e}build(e){const I=new EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.treeOptions&&e.treeOptions.closureTableName?e.treeOptions.closureTableName:e.tableNameWithoutPrefix,type:"closure-junction"}});return I.build(),e.primaryColumns.forEach(B=>{I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,closureType:"ancestor",referencedColumn:B,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.ancestorColumnName?e.treeOptions.ancestorColumnName(B):B.propertyName+"_ancestor",options:{primary:!0,length:B.length,type:B.type}}})),I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,closureType:"descendant",referencedColumn:B,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.descendantColumnName?e.treeOptions.descendantColumnName(B):B.propertyName+"_descendant",options:{primary:!0,length:B.length,type:B.type}}}))}),I.ownIndices=[new IndexMetadata({entityMetadata:I,columns:[I.ownColumns[0]],args:{target:I.target,synchronize:!0}}),new IndexMetadata({entityMetadata:I,columns:[I.ownColumns[1]],args:{target:I.target,synchronize:!0}})],e.treeLevelColumn&&I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),I.foreignKeys=[new ForeignKeyMetadata({entityMetadata:I,referencedEntityMetadata:e,columns:[I.ownColumns[0]],referencedColumns:e.primaryColumns,onDelete:this.connection.driver.options.type==="mssql"?"NO ACTION":"CASCADE"}),new ForeignKeyMetadata({entityMetadata:I,referencedEntityMetadata:e,columns:[I.ownColumns[1]],referencedColumns:e.primaryColumns,onDelete:this.connection.driver.options.type==="mssql"?"NO ACTION":"CASCADE"})],I}}class UniqueMetadata{constructor(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns,this.deferrable=e.args.deferrable)}build(e){const I={};if(this.givenColumnNames){let B=[];if(Array.isArray(this.givenColumnNames))B=this.givenColumnNames.map(tr=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+tr:tr.trim()),B.forEach(tr=>I[tr]=1);else{const tr=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(tr)?(B=tr.map(rr=>String(rr)),B.forEach(rr=>I[rr]=1)):(B=Object.keys(tr).map(rr=>String(rr)),Object.keys(tr).forEach(rr=>I[rr]=tr[rr]))}this.columns=B.map(tr=>{const rr=this.entityMetadata.columns.find(mr=>mr.propertyPath===tr);if(rr)return[rr];const ir=this.entityMetadata.relations.find(mr=>mr.isWithJoinColumn&&mr.propertyName===tr);if(ir)return ir.joinColumns;const lr=this.givenName?'"'+this.givenName+'" ':"",dr=this.entityMetadata.targetName;throw new TypeORMError(`Unique constraint ${lr}contains column that is missing in the entity (${dr}): `+tr)}).reduce((tr,rr)=>tr.concat(rr))}return this.columnNamesWithOrderingMap=Object.keys(I).reduce((B,tr)=>{const rr=this.entityMetadata.columns.find(ir=>ir.propertyPath===tr);return rr&&(B[rr.databasePath]=I[tr]),B},{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tableName,this.columns.map(B=>B.databaseName)),this}}class RelationJoinColumnBuilder{constructor(e){this.connection=e}build(e,I){const B=this.collectReferencedColumns(e,I),tr=this.collectColumns(e,I,B);if(!B.length||!I.createForeignKeyConstraints)return{foreignKey:void 0,columns:tr,uniqueConstraint:void 0};const rr=new ForeignKeyMetadata({name:e[0]?.foreignKeyConstraintName,entityMetadata:I.entityMetadata,referencedEntityMetadata:I.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:tr,referencedColumns:B,onDelete:I.onDelete,onUpdate:I.onUpdate,deferrable:I.deferrable});if(tr.every(lr=>lr.isPrimary)||!I.isOneToOne)return{foreignKey:rr,columns:tr,uniqueConstraint:void 0};const ir=new UniqueMetadata({entityMetadata:I.entityMetadata,columns:rr.columns,args:{name:this.connection.namingStrategy.relationConstraintName(I.entityMetadata.tableName,rr.columns.map(lr=>lr.databaseName)),target:I.entityMetadata.target}});return ir.build(this.connection.namingStrategy),{foreignKey:rr,columns:tr,uniqueConstraint:ir}}collectReferencedColumns(e,I){const B=e.find(ir=>!!ir.referencedColumnName),tr=e.length===0&&I.isManyToOne,rr=e.length>0&&!B;return tr||rr?I.inverseEntityMetadata.primaryColumns:e.map(ir=>{const lr=I.inverseEntityMetadata.ownColumns.find(dr=>dr.propertyName===ir.referencedColumnName);if(!lr)throw new TypeORMError(`Referenced column ${ir.referencedColumnName} was not found in entity ${I.inverseEntityMetadata.name}`);return lr})}collectColumns(e,I,B){return B.map(tr=>{const rr=e.find(mr=>(!mr.referencedColumnName||mr.referencedColumnName===tr.propertyName)&&!!mr.name),ir=rr?rr.name:this.connection.namingStrategy.joinColumnName(I.propertyName,tr.propertyName);let dr=(I.embeddedMetadata?I.embeddedMetadata.columns:I.entityMetadata.ownColumns).find(mr=>mr.databaseNameWithoutPrefixes===ir);return dr||(dr=new ColumnMetadata({connection:this.connection,entityMetadata:I.entityMetadata,embeddedMetadata:I.embeddedMetadata,args:{target:"",mode:"virtual",propertyName:I.propertyName,options:{name:ir,type:tr.type,length:!tr.length&&(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.normalizeType(tr)!=="uuid"&&(tr.generationStrategy==="uuid"||tr.type==="uuid")?"36":tr.length,width:tr.width,charset:tr.charset,collation:tr.collation,precision:tr.precision,scale:tr.scale,zerofill:tr.zerofill,unsigned:tr.unsigned,comment:tr.comment,enum:tr.enum,enumName:tr.enumName,primary:I.isPrimary,nullable:I.isNullable}}}),I.entityMetadata.registerColumn(dr)),dr.referencedColumn=tr,dr.type=tr.type,dr.relationMetadata=I,dr.build(this.connection),dr})}}class EntityListenerMetadata{constructor(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}isAllowed(e){return this.entityMetadata.target===e.constructor||typeof this.entityMetadata.target=="function"&&e.constructor.prototype instanceof this.entityMetadata.target}execute(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))}callEntityEmbeddedMethod(e,I){const B=I.shift();!B||!e[B]||(I.length===0?Array.isArray(e[B])?e[B].map(tr=>tr[this.propertyName]()):e[B][this.propertyName]():e[B]&&this.callEntityEmbeddedMethod(e[B],I))}}class CheckMetadata{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tableName,this.expression),this}}class ExclusionMetadata{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tableName,this.expression),this}}class EntityMetadataBuilder{constructor(e,I){this.connection=e,this.metadataArgsStorage=I,this.junctionEntityMetadataBuilder=new JunctionEntityMetadataBuilder(e),this.closureJunctionEntityMetadataBuilder=new ClosureJunctionEntityMetadataBuilder(e),this.relationJoinColumnBuilder=new RelationJoinColumnBuilder(e)}build(e){const tr=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(rr=>rr.type==="regular"||rr.type==="closure"||rr.type==="entity-child"||rr.type==="view").map(rr=>this.createEntityMetadata(rr));return tr.forEach(rr=>this.computeParentEntityMetadata(tr,rr)),tr.forEach(rr=>{rr.childEntityMetadatas=tr.filter(ir=>typeof rr.target=="function"&&typeof ir.target=="function"&&MetadataUtils.isInherited(ir.target,rr.target))}),tr.filter(rr=>rr.tableType!=="entity-child").forEach(rr=>rr.build()),tr.filter(rr=>rr.tableType==="entity-child").forEach(rr=>rr.build()),tr.filter(rr=>rr.tableType!=="entity-child").forEach(rr=>this.computeEntityMetadataStep1(tr,rr)),tr.filter(rr=>rr.tableType==="entity-child").forEach(rr=>this.computeEntityMetadataStep1(tr,rr)),tr.forEach(rr=>this.computeEntityMetadataStep2(rr)),tr.forEach(rr=>this.computeInverseProperties(rr,tr)),tr.filter(rr=>rr.tableType!=="entity-child").forEach(rr=>{rr.relations.filter(ir=>ir.isOneToOne||ir.isManyToOne).forEach(ir=>{const lr=this.metadataArgsStorage.filterJoinColumns(ir.target,ir.propertyName),{foreignKey:dr,columns:mr,uniqueConstraint:hr}=this.relationJoinColumnBuilder.build(lr,ir);if(dr&&(ir.registerForeignKeys(dr),rr.foreignKeys.push(dr)),mr&&ir.registerJoinColumns(mr),hr)if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="mssql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){const fr=new IndexMetadata({entityMetadata:hr.entityMetadata,columns:hr.columns,args:{target:hr.target,name:hr.name,unique:!0,synchronize:!0}});this.connection.driver.options.type==="mssql"&&(fr.where=fr.columns.map(_r=>`${this.connection.driver.escape(_r.databaseName)} IS NOT NULL`).join(" AND ")),this.connection.driver.options.type==="spanner"&&(fr.isNullFiltered=!0),ir.embeddedMetadata?ir.embeddedMetadata.indices.push(fr):ir.entityMetadata.ownIndices.push(fr),this.computeEntityMetadataStep2(rr)}else ir.embeddedMetadata?ir.embeddedMetadata.uniques.push(hr):ir.entityMetadata.ownUniques.push(hr),this.computeEntityMetadataStep2(rr);if(dr&&this.connection.driver.options.type==="cockroachdb"){const fr=new IndexMetadata({entityMetadata:ir.entityMetadata,columns:dr.columns,args:{target:ir.entityMetadata.target,synchronize:!0}});ir.embeddedMetadata?ir.embeddedMetadata.indices.push(fr):ir.entityMetadata.ownIndices.push(fr),this.computeEntityMetadataStep2(rr)}}),rr.relations.filter(ir=>ir.isManyToMany).forEach(ir=>{const lr=this.metadataArgsStorage.findJoinTable(ir.target,ir.propertyName);if(!lr)return;const dr=this.junctionEntityMetadataBuilder.build(ir,lr);ir.registerForeignKeys(...dr.foreignKeys),ir.registerJoinColumns(dr.ownIndices[0].columns,dr.ownIndices[1].columns),ir.registerJunctionEntityMetadata(dr),this.computeEntityMetadataStep2(dr),this.computeInverseProperties(dr,tr),tr.push(dr)})}),tr.forEach(rr=>{rr.relationsWithJoinColumns=rr.relations.filter(ir=>ir.isWithJoinColumn),rr.hasNonNullableRelations=rr.relationsWithJoinColumns.some(ir=>!ir.isNullable||ir.isPrimary)}),tr.filter(rr=>rr.treeType==="closure-table").forEach(rr=>{const ir=this.closureJunctionEntityMetadataBuilder.build(rr);rr.closureJunctionTable=ir,this.computeEntityMetadataStep2(ir),this.computeInverseProperties(ir,tr),tr.push(ir)}),tr.filter(rr=>rr.inheritancePattern==="STI"&&rr.discriminatorColumn).forEach(rr=>this.createKeysForTableInheritance(rr)),tr.forEach(rr=>{rr.indices.forEach(ir=>ir.build(this.connection.namingStrategy))}),tr.forEach(rr=>{rr.uniques.forEach(ir=>ir.build(this.connection.namingStrategy))}),tr.forEach(rr=>{rr.checks.forEach(ir=>ir.build(this.connection.namingStrategy))}),tr.forEach(rr=>{rr.exclusions.forEach(ir=>ir.build(this.connection.namingStrategy))}),tr.filter(rr=>typeof rr.target=="function").forEach(rr=>{rr.relations.filter(ir=>ir.isLazy).forEach(ir=>{this.connection.relationLoader.enableLazyLoad(ir,rr.target.prototype)})}),tr.forEach(rr=>{rr.columns.forEach(ir=>{const lr=this.metadataArgsStorage.findGenerated(ir.target,ir.propertyName);lr&&(ir.isGenerated=!0,ir.generationStrategy=lr.strategy,lr.strategy==="uuid"?ir.type="uuid":lr.strategy==="rowid"?ir.type="int":ir.type=ir.type||Number,ir.build(this.connection),this.computeEntityMetadataStep2(rr))})}),tr}createEntityMetadata(e){const I=typeof e.target=="function"?MetadataUtils.getInheritanceTree(e.target):[e.target],B=this.metadataArgsStorage.findInheritanceType(e.target),tr=this.metadataArgsStorage.findTree(e.target);let rr;return(B&&B.pattern==="STI"||e.type==="entity-child")&&(rr=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(ir=>ir.target).filter(ir=>typeof ir=="function"),I.push(...rr)),new EntityMetadata({connection:this.connection,args:e,inheritanceTree:I,tableTree:tr,inheritancePattern:B?B.pattern:void 0})}computeParentEntityMetadata(e,I){I.tableType==="entity-child"&&(I.parentEntityMetadata=e.find(B=>B.inheritanceTree.indexOf(I.target)!==-1&&B.inheritancePattern==="STI"))}computeEntityMetadataStep1(e,I){const B=this.metadataArgsStorage.findInheritanceType(I.target),tr=this.metadataArgsStorage.findDiscriminatorValue(I.target);if(typeof tr<"u"?I.discriminatorValue=tr.value:I.discriminatorValue=I.target.name,I.embeddeds=this.createEmbeddedsRecursively(I,this.metadataArgsStorage.filterEmbeddeds(I.inheritanceTree)).map(ir=>(I.inheritancePattern==="STI"&&(ir.columns=ir.columns.map(lr=>(lr.isNullable=!0,lr))),ir)),I.ownColumns=this.metadataArgsStorage.filterColumns(I.inheritanceTree).map(ir=>{if(I.tableType==="entity-child")return I.parentEntityMetadata.ownColumns.find(mr=>mr.propertyName===ir.propertyName);if(I.tableType==="regular"&&ir.target!==I.target){const mr=this.metadataArgsStorage.columns.find(hr=>hr.propertyName===ir.propertyName&&hr.target===I.target);mr&&mr.options.default&&(ir.options.default=mr.options.default)}const lr=new ColumnMetadata({connection:this.connection,entityMetadata:I,args:ir});return e.find(mr=>mr.tableType==="entity-child"&&mr.target===ir.target)&&(lr.isNullable=!0),lr}),B&&B.column){const ir=B.column&&B.column.name?B.column.name:"type";let lr=I.ownColumns.find(dr=>dr.propertyName===ir);lr?lr.isDiscriminator=!0:(lr=new ColumnMetadata({connection:this.connection,entityMetadata:I,args:{target:I.target,mode:"virtual",propertyName:ir,options:B.column||{name:ir,type:"varchar",nullable:!1}}}),lr.isVirtual=!0,lr.isDiscriminator=!0,I.ownColumns.push(lr))}if(I.tableType==="entity-child"){const ir=I.parentEntityMetadata.ownColumns.find(lr=>lr.isDiscriminator);ir&&!I.ownColumns.find(lr=>lr===ir)&&I.ownColumns.push(ir),I.inheritancePattern=I.parentEntityMetadata.inheritancePattern,!I.treeType&&I.parentEntityMetadata.treeType&&(I.treeType=I.parentEntityMetadata.treeType,I.treeOptions=I.parentEntityMetadata.treeOptions,I.treeParentRelation=I.parentEntityMetadata.treeParentRelation,I.treeLevelColumn=I.parentEntityMetadata.treeLevelColumn)}const{namingStrategy:rr}=this.connection;if(I.treeType==="materialized-path")I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,materializedPath:!0,args:{target:I.target,mode:"virtual",propertyName:"mpath",options:{name:rr.materializedPathColumnName,type:String,nullable:!0,default:""}}}));else if(I.treeType==="nested-set"){const{left:ir,right:lr}=rr.nestedSetColumnNames;I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,nestedSetLeft:!0,args:{target:I.target,mode:"virtual",propertyName:ir,options:{name:ir,type:Number,nullable:!1,default:1}}})),I.ownColumns.push(new ColumnMetadata({connection:this.connection,entityMetadata:I,nestedSetRight:!0,args:{target:I.target,mode:"virtual",propertyName:lr,options:{name:lr,type:Number,nullable:!1,default:2}}}))}if(I.ownRelations=this.metadataArgsStorage.filterRelations(I.inheritanceTree).map(ir=>{if(I.tableType==="entity-child"){const lr=I.parentEntityMetadata.ownRelations.find(mr=>mr.propertyName===ir.propertyName),dr=typeof ir.type=="function"?ir.type():ir.type;if(lr.type!==dr){const mr=Object.create(lr);return mr.type=dr,mr}return lr}return new RelationMetadata({entityMetadata:I,args:ir})}),I.relationIds=this.metadataArgsStorage.filterRelationIds(I.inheritanceTree).map(ir=>I.tableType==="entity-child"?I.parentEntityMetadata.relationIds.find(lr=>lr.propertyName===ir.propertyName):new RelationIdMetadata({entityMetadata:I,args:ir})),I.relationCounts=this.metadataArgsStorage.filterRelationCounts(I.inheritanceTree).map(ir=>I.tableType==="entity-child"?I.parentEntityMetadata.relationCounts.find(lr=>lr.propertyName===ir.propertyName):new RelationCountMetadata({entityMetadata:I,args:ir})),I.ownListeners=this.metadataArgsStorage.filterListeners(I.inheritanceTree).map(ir=>new EntityListenerMetadata({entityMetadata:I,args:ir})),I.checks=this.metadataArgsStorage.filterChecks(I.inheritanceTree).map(ir=>new CheckMetadata({entityMetadata:I,args:ir})),this.connection.driver.options.type==="postgres"&&(I.exclusions=this.metadataArgsStorage.filterExclusions(I.inheritanceTree).map(ir=>new ExclusionMetadata({entityMetadata:I,args:ir}))),this.connection.driver.options.type==="cockroachdb"){I.ownIndices=this.metadataArgsStorage.filterIndices(I.inheritanceTree).filter(lr=>!lr.unique).map(lr=>new IndexMetadata({entityMetadata:I,args:lr}));const ir=this.metadataArgsStorage.filterIndices(I.inheritanceTree).filter(lr=>lr.unique).map(lr=>new UniqueMetadata({entityMetadata:I,args:{target:lr.target,name:lr.name,columns:lr.columns}}));I.ownUniques.push(...ir)}else I.ownIndices=this.metadataArgsStorage.filterIndices(I.inheritanceTree).map(ir=>new IndexMetadata({entityMetadata:I,args:ir}));if(DriverUtils.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){const ir=this.metadataArgsStorage.filterUniques(I.inheritanceTree).map(lr=>new IndexMetadata({entityMetadata:I,args:{target:lr.target,name:lr.name,columns:lr.columns,unique:!0,synchronize:!0}}));I.ownIndices.push(...ir)}else{const ir=this.metadataArgsStorage.filterUniques(I.inheritanceTree).map(lr=>new UniqueMetadata({entityMetadata:I,args:lr}));I.ownUniques.push(...ir)}}createEmbeddedsRecursively(e,I){return I.map(B=>{const tr=new EmbeddedMetadata({entityMetadata:e,args:B}),rr=typeof tr.type=="function"?MetadataUtils.getInheritanceTree(tr.type):[tr.type];return tr.columns=this.metadataArgsStorage.filterColumns(rr).map(ir=>new ColumnMetadata({connection:this.connection,entityMetadata:e,embeddedMetadata:tr,args:ir})),tr.relations=this.metadataArgsStorage.filterRelations(rr).map(ir=>new RelationMetadata({entityMetadata:e,embeddedMetadata:tr,args:ir})),tr.listeners=this.metadataArgsStorage.filterListeners(rr).map(ir=>new EntityListenerMetadata({entityMetadata:e,embeddedMetadata:tr,args:ir})),tr.indices=this.metadataArgsStorage.filterIndices(rr).map(ir=>new IndexMetadata({entityMetadata:e,embeddedMetadata:tr,args:ir})),tr.uniques=this.metadataArgsStorage.filterUniques(rr).map(ir=>new UniqueMetadata({entityMetadata:e,embeddedMetadata:tr,args:ir})),tr.relationIds=this.metadataArgsStorage.filterRelationIds(rr).map(ir=>new RelationIdMetadata({entityMetadata:e,args:ir})),tr.relationCounts=this.metadataArgsStorage.filterRelationCounts(rr).map(ir=>new RelationCountMetadata({entityMetadata:e,args:ir})),tr.embeddeds=this.createEmbeddedsRecursively(e,this.metadataArgsStorage.filterEmbeddeds(rr)),tr.embeddeds.forEach(ir=>ir.parentEmbeddedMetadata=tr),e.allEmbeddeds.push(tr),tr})}computeEntityMetadataStep2(e){e.embeddeds.forEach(I=>I.build(this.connection)),e.embeddeds.forEach(I=>{I.columnsFromTree.forEach(B=>B.build(this.connection)),I.relationsFromTree.forEach(B=>B.build())}),e.ownColumns.forEach(I=>I.build(this.connection)),e.ownRelations.forEach(I=>I.build()),e.relations=e.embeddeds.reduce((I,B)=>I.concat(B.relationsFromTree),e.ownRelations),e.eagerRelations=e.relations.filter(I=>I.isEager),e.lazyRelations=e.relations.filter(I=>I.isLazy),e.oneToOneRelations=e.relations.filter(I=>I.isOneToOne),e.oneToManyRelations=e.relations.filter(I=>I.isOneToMany),e.manyToOneRelations=e.relations.filter(I=>I.isManyToOne),e.manyToManyRelations=e.relations.filter(I=>I.isManyToMany),e.ownerOneToOneRelations=e.relations.filter(I=>I.isOneToOneOwner),e.ownerManyToManyRelations=e.relations.filter(I=>I.isManyToManyOwner),e.treeParentRelation=e.relations.find(I=>I.isTreeParent),e.treeChildrenRelation=e.relations.find(I=>I.isTreeChildren),e.columns=e.embeddeds.reduce((I,B)=>I.concat(B.columnsFromTree),e.ownColumns),e.listeners=e.embeddeds.reduce((I,B)=>I.concat(B.listenersFromTree),e.ownListeners),e.afterLoadListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_LOAD),e.afterInsertListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_INSERT),e.afterUpdateListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_UPDATE),e.afterRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_REMOVE),e.afterSoftRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_SOFT_REMOVE),e.afterRecoverListeners=e.listeners.filter(I=>I.type===EventListenerTypes.AFTER_RECOVER),e.beforeInsertListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_INSERT),e.beforeUpdateListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_UPDATE),e.beforeRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_REMOVE),e.beforeSoftRemoveListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_SOFT_REMOVE),e.beforeRecoverListeners=e.listeners.filter(I=>I.type===EventListenerTypes.BEFORE_RECOVER),e.indices=e.embeddeds.reduce((I,B)=>I.concat(B.indicesFromTree),e.ownIndices),e.uniques=e.embeddeds.reduce((I,B)=>I.concat(B.uniquesFromTree),e.ownUniques),e.primaryColumns=e.columns.filter(I=>I.isPrimary),e.nonVirtualColumns=e.columns.filter(I=>!I.isVirtual),e.ancestorColumns=e.columns.filter(I=>I.closureType==="ancestor"),e.descendantColumns=e.columns.filter(I=>I.closureType==="descendant"),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter(I=>I.isGenerated||I.isObjectId),e.hasUUIDGeneratedColumns=e.columns.filter(I=>I.isGenerated||I.generationStrategy==="uuid").length>0,e.createDateColumn=e.columns.find(I=>I.isCreateDate),e.updateDateColumn=e.columns.find(I=>I.isUpdateDate),e.deleteDateColumn=e.columns.find(I=>I.isDeleteDate),e.versionColumn=e.columns.find(I=>I.isVersion),e.discriminatorColumn=e.columns.find(I=>I.isDiscriminator),e.treeLevelColumn=e.columns.find(I=>I.isTreeLevel),e.nestedSetLeftColumn=e.columns.find(I=>I.isNestedSetLeft),e.nestedSetRightColumn=e.columns.find(I=>I.isNestedSetRight),e.materializedPathColumn=e.columns.find(I=>I.isMaterializedPath),e.objectIdColumn=e.columns.find(I=>I.isObjectId),e.foreignKeys.forEach(I=>I.build(this.connection.namingStrategy)),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(I=>I.build()),e.relationCounts.forEach(I=>I.build()),e.embeddeds.forEach(I=>{I.relationIdsFromTree.forEach(B=>B.build()),I.relationCountsFromTree.forEach(B=>B.build())})}computeInverseProperties(e,I){e.relations.forEach(B=>{const tr=I.find(rr=>rr.target===B.type||typeof B.type=="string"&&(rr.targetName===B.type||rr.givenTableName===B.type));if(!tr)throw new TypeORMError("Entity metadata for "+e.name+"#"+B.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");B.inverseEntityMetadata=tr,B.inverseSidePropertyPath=B.buildInverseSidePropertyPath(),B.inverseRelation=tr.relations.find(rr=>rr.propertyPath===B.inverseSidePropertyPath)})}createKeysForTableInheritance(e){e.indices.some(({givenColumnNames:B})=>!!B&&Array.isArray(B)&&B.length===1&&B[0]===e.discriminatorColumn?.databaseName)||e.indices.push(new IndexMetadata({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))}}class EntitySchemaEmbeddedError extends TypeORMError{static createEntitySchemaIsRequiredException(e){return new EntitySchemaEmbeddedError(`EntitySchema is required for ${e} embedded field`)}static createTargetIsRequired(e){return new EntitySchemaEmbeddedError(`Target field is required for ${e} embedded EntitySchema`)}constructor(e){super(e)}}class EntitySchemaTransformer{transform(e){const I=new MetadataArgsStorage;return e.forEach(B=>{const tr=B.options,rr={target:tr.target||tr.name,name:tr.tableName,database:tr.database,schema:tr.schema,type:tr.type||"regular",orderBy:tr.orderBy,synchronize:tr.synchronize,withoutRowid:!!tr.withoutRowid,expression:tr.expression};I.tables.push(rr);const{inheritance:ir}=tr;ir&&I.inheritances.push({target:tr.target,pattern:ir.pattern??"STI",column:ir.column?typeof ir.column=="string"?{name:ir.column}:ir.column:void 0});const{discriminatorValue:lr}=tr;lr&&I.discriminatorValues.push({target:tr.target||tr.name,value:lr}),this.transformColumnsRecursive(tr,I)}),I}transformColumnsRecursive(e,I){Object.keys(e.columns).forEach(B=>{const rr=e.columns[B];let ir="regular";rr.createDate&&(ir="createDate"),rr.updateDate&&(ir="updateDate"),rr.deleteDate&&(ir="deleteDate"),rr.version&&(ir="version"),rr.treeChildrenCount&&(ir="treeChildrenCount"),rr.treeLevel&&(ir="treeLevel"),rr.objectId&&(ir="objectId");const lr={target:e.target||e.name,mode:ir,propertyName:B,options:{type:rr.type,name:rr.objectId?"_id":rr.name,primaryKeyConstraintName:rr.primaryKeyConstraintName,length:rr.length,width:rr.width,nullable:rr.nullable,readonly:rr.readonly,update:rr.update,select:rr.select,insert:rr.insert,primary:rr.primary,unique:rr.unique,comment:rr.comment,default:rr.default,onUpdate:rr.onUpdate,precision:rr.precision,scale:rr.scale,zerofill:rr.zerofill,unsigned:rr.unsigned,charset:rr.charset,collation:rr.collation,enum:rr.enum,enumName:rr.enumName,asExpression:rr.asExpression,generatedType:rr.generatedType,hstoreType:rr.hstoreType,array:rr.array,transformer:rr.transformer,spatialFeatureType:rr.spatialFeatureType,srid:rr.srid}};if(I.columns.push(lr),rr.generated){const dr={target:e.target||e.name,propertyName:B,strategy:typeof rr.generated=="string"?rr.generated:"increment"};I.generations.push(dr)}rr.unique&&I.uniques.push({target:e.target||e.name,columns:[B]})}),e.relations&&Object.keys(e.relations).forEach(B=>{const tr=e.relations[B],rr={target:e.target||e.name,propertyName:B,relationType:tr.type,isLazy:tr.lazy||!1,type:tr.target,inverseSideProperty:tr.inverseSide,isTreeParent:tr.treeParent,isTreeChildren:tr.treeChildren,options:{eager:tr.eager||!1,cascade:tr.cascade,nullable:tr.nullable,onDelete:tr.onDelete,onUpdate:tr.onUpdate,deferrable:tr.deferrable,createForeignKeyConstraints:tr.createForeignKeyConstraints,persistence:tr.persistence,orphanedRowAction:tr.orphanedRowAction}};if(I.relations.push(rr),tr.joinColumn)if(typeof tr.joinColumn=="boolean"){const ir={target:e.target||e.name,propertyName:B};I.joinColumns.push(ir)}else{const ir=Array.isArray(tr.joinColumn)?tr.joinColumn:[tr.joinColumn];for(const lr of ir){const dr={target:e.target||e.name,propertyName:B,name:lr.name,referencedColumnName:lr.referencedColumnName,foreignKeyConstraintName:lr.foreignKeyConstraintName};I.joinColumns.push(dr)}}if(tr.joinTable)if(typeof tr.joinTable=="boolean"){const ir={target:e.target||e.name,propertyName:B};I.joinTables.push(ir)}else{const ir={target:e.target||e.name,propertyName:B,name:tr.joinTable.name,database:tr.joinTable.database,schema:tr.joinTable.schema,joinColumns:tr.joinTable.joinColumn?[tr.joinTable.joinColumn]:tr.joinTable.joinColumns,inverseJoinColumns:tr.joinTable.inverseJoinColumn?[tr.joinTable.inverseJoinColumn]:tr.joinTable.inverseJoinColumns};I.joinTables.push(ir)}}),e.relationIds&&Object.keys(e.relationIds).forEach(B=>{const tr=e.relationIds[B],rr={propertyName:B,relation:tr.relationName,target:e.target||e.name,alias:tr.alias,queryBuilderFactory:tr.queryBuilderFactory};I.relationIds.push(rr)}),e.indices&&e.indices.forEach(B=>{const tr={target:e.target||e.name,name:B.name,unique:B.unique===!0,spatial:B.spatial===!0,fulltext:B.fulltext===!0,nullFiltered:B.nullFiltered===!0,parser:B.parser,synchronize:B.synchronize!==!1,where:B.where,sparse:B.sparse,columns:B.columns};I.indices.push(tr)}),e.uniques&&e.uniques.forEach(B=>{const tr={target:e.target||e.name,name:B.name,columns:B.columns,deferrable:B.deferrable};I.uniques.push(tr)}),e.checks&&e.checks.forEach(B=>{const tr={target:e.target||e.name,name:B.name,expression:B.expression};I.checks.push(tr)}),e.exclusions&&e.exclusions.forEach(B=>{const tr={target:e.target||e.name,name:B.name,expression:B.expression};I.exclusions.push(tr)}),e.embeddeds&&Object.keys(e.embeddeds).forEach(B=>{const tr=e.embeddeds[B];if(!tr.schema)throw EntitySchemaEmbeddedError.createEntitySchemaIsRequiredException(B);const rr=tr.schema.options;I.embeddeds.push({target:e.target||e.name,propertyName:B,isArray:tr.array===!0,prefix:tr.prefix!==void 0?tr.prefix:void 0,type:()=>rr?.target||rr.name}),this.transformColumnsRecursive(rr,I)})}}class ConnectionMetadataBuilder{constructor(e){this.connection=e}async buildMigrations(e){const[I,B]=OrmUtils.splitClassesAndStrings(e);return[...I,...await importClassesFromDirectories(this.connection.logger)].map(rr=>getFromContainer(rr))}async buildSubscribers(e){const[I,B]=OrmUtils.splitClassesAndStrings(e||[]),tr=[...I,...await importClassesFromDirectories(this.connection.logger)];return getMetadataArgsStorage().filterSubscribers(tr).map(rr=>getFromContainer(rr.target))}async buildEntityMetadatas(e){const[I,B]=OrmUtils.splitClassesAndStrings(e||[]),tr=I.filter(hr=>!InstanceChecker.isEntitySchema(hr)),rr=I.filter(hr=>InstanceChecker.isEntitySchema(hr)),ir=[...tr,...await importClassesFromDirectories(this.connection.logger)];ir.forEach(hr=>{InstanceChecker.isEntitySchema(hr)&&rr.push(hr)});const lr=new EntityMetadataBuilder(this.connection,getMetadataArgsStorage()).build(ir),dr=new EntitySchemaTransformer().transform(rr),mr=new EntityMetadataBuilder(this.connection,dr).build();return[...lr,...mr]}}class AbstractLogger{constructor(e){this.options=e}logQuery(e,I,B){this.isLogEnabledFor("query")&&this.writeLog("query",{type:"query",prefix:"query",message:e,format:"sql",parameters:I},B)}logQueryError(e,I,B,tr){this.isLogEnabledFor("query-error")&&this.writeLog("warn",[{type:"query-error",prefix:"query failed",message:I,format:"sql",parameters:B},{type:"query-error",prefix:"error",message:e}],tr)}logQuerySlow(e,I,B,tr){this.isLogEnabledFor("query-slow")&&this.writeLog("warn",[{type:"query-slow",prefix:"query is slow",message:I,format:"sql",parameters:B,additionalInfo:{time:e}},{type:"query-slow",prefix:"execution time",message:e}],tr)}logSchemaBuild(e,I){this.isLogEnabledFor("schema-build")&&this.writeLog("schema",{type:"schema-build",message:e},I)}logMigration(e,I){this.isLogEnabledFor("migration")&&this.writeLog("log",{type:"migration",message:e},I)}log(e,I,B){switch(e){case"log":if(!this.isLogEnabledFor("log"))return;this.writeLog("log",{type:"log",message:I},B);break;case"info":if(!this.isLogEnabledFor("info"))return;this.writeLog("info",{type:"info",prefix:"info",message:I},B);break;case"warn":if(!this.isLogEnabledFor("warn"))return;this.writeLog("warn",{type:"warn",message:I},B);break}}isLogEnabledFor(e){switch(e){case"query":return this.options==="all"||this.options===!0||Array.isArray(this.options)&&this.options.indexOf("query")!==-1;case"error":case"query-error":return this.options==="all"||this.options===!0||Array.isArray(this.options)&&this.options.indexOf("error")!==-1;case"query-slow":return!0;case"schema":case"schema-build":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("schema")!==-1;case"migration":return!0;case"log":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("log")!==-1;case"info":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("info")!==-1;case"warn":return this.options==="all"||Array.isArray(this.options)&&this.options.indexOf("warn")!==-1;default:return!1}}prepareLogMessages(e,I){I={addColonToPrefix:!0,appendParameterAsComment:!0,highlightSql:!0,...I};const B=Array.isArray(e)?e:[e];for(let tr of B){if(typeof tr!="object"&&(tr={message:tr}),tr.format==="sql"){let rr=String(tr.message);I.appendParameterAsComment&&tr.parameters&&tr.parameters.length&&(rr+=` -- PARAMETERS: ${this.stringifyParams(tr.parameters)}`),I.highlightSql&&(rr=PlatformTools.highlightSql(rr)),tr.message=rr}I.addColonToPrefix&&tr.prefix&&(tr.prefix+=":")}return B}stringifyParams(e){try{return JSON.stringify(e)}catch{return e}}}class SimpleConsoleLogger extends AbstractLogger{writeLog(e,I,B){const tr=this.prepareLogMessages(I,{highlightSql:!1});for(let rr of tr)switch(rr.type??e){case"log":case"schema-build":case"migration":console.log(rr.message);break;case"info":case"query":rr.prefix?console.info(rr.prefix,rr.message):console.info(rr.message);break;case"warn":case"query-slow":rr.prefix?console.warn(rr.prefix,rr.message):console.warn(rr.message);break;case"error":case"query-error":rr.prefix?console.error(rr.prefix,rr.message):console.error(rr.message);break}}}class AdvancedConsoleLogger extends AbstractLogger{writeLog(e,I,B){const tr=this.prepareLogMessages(I);for(let rr of tr)switch(rr.type??e){case"log":case"schema-build":case"migration":PlatformTools.log(String(rr.message));break;case"info":case"query":rr.prefix?PlatformTools.logInfo(rr.prefix,rr.message):PlatformTools.log(String(rr.message));break;case"warn":case"query-slow":rr.prefix?PlatformTools.logWarn(rr.prefix,rr.message):console.warn(PlatformTools.warn(String(rr.message)));break;case"error":case"query-error":rr.prefix?PlatformTools.logError(rr.prefix,String(rr.message)):console.error(PlatformTools.error(String(rr.message)));break}}}class DummyLogger{logQuery(){throw new Error("This logger is not applicable in a browser context")}logQueryError(){throw new Error("This logger is not applicable in a browser context")}logQuerySlow(){throw new Error("This logger is not applicable in a browser context")}logSchemaBuild(){throw new Error("This logger is not applicable in a browser context")}logMigration(){throw new Error("This logger is not applicable in a browser context")}log(){throw new Error("This logger is not applicable in a browser context")}}class FileLogger extends DummyLogger{}function getDefaultExportFromCjs(k){return k&&k.__esModule&&Object.prototype.hasOwnProperty.call(k,"default")?k.default:k}var browser$1={exports:{}},process=browser$1.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(k){if(cachedSetTimeout===setTimeout)return setTimeout(k,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(k,0);try{return cachedSetTimeout(k,0)}catch{try{return cachedSetTimeout.call(null,k,0)}catch{return cachedSetTimeout.call(this,k,0)}}}function runClearTimeout(k){if(cachedClearTimeout===clearTimeout)return clearTimeout(k);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(k);try{return cachedClearTimeout(k)}catch{try{return cachedClearTimeout.call(null,k)}catch{return cachedClearTimeout.call(this,k)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var k=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(k)}}process.nextTick=function(k){var e=new Array(arguments.length-1);if(arguments.length>1)for(var I=1;I<arguments.length;I++)e[I-1]=arguments[I];queue.push(new Item(k,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(k,e){this.fun=k,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(k){return[]};process.binding=function(k){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(k){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports$1=browser$1.exports;const process$1=getDefaultExportFromCjs(browserExports$1);var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var k=1e3,e=k*60,I=e*60,B=I*24,tr=B*7,rr=B*365.25;ms=function(hr,fr){fr=fr||{};var _r=typeof hr;if(_r==="string"&&hr.length>0)return ir(hr);if(_r==="number"&&isFinite(hr))return fr.long?dr(hr):lr(hr);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(hr))};function ir(hr){if(hr=String(hr),!(hr.length>100)){var fr=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(hr);if(fr){var _r=parseFloat(fr[1]),gr=(fr[2]||"ms").toLowerCase();switch(gr){case"years":case"year":case"yrs":case"yr":case"y":return _r*rr;case"weeks":case"week":case"w":return _r*tr;case"days":case"day":case"d":return _r*B;case"hours":case"hour":case"hrs":case"hr":case"h":return _r*I;case"minutes":case"minute":case"mins":case"min":case"m":return _r*e;case"seconds":case"second":case"secs":case"sec":case"s":return _r*k;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return _r;default:return}}}}function lr(hr){var fr=Math.abs(hr);return fr>=B?Math.round(hr/B)+"d":fr>=I?Math.round(hr/I)+"h":fr>=e?Math.round(hr/e)+"m":fr>=k?Math.round(hr/k)+"s":hr+"ms"}function dr(hr){var fr=Math.abs(hr);return fr>=B?mr(hr,fr,B,"day"):fr>=I?mr(hr,fr,I,"hour"):fr>=e?mr(hr,fr,e,"minute"):fr>=k?mr(hr,fr,k,"second"):hr+" ms"}function mr(hr,fr,_r,gr){var Sr=fr>=_r*1.5;return Math.round(hr/_r)+" "+gr+(Sr?"s":"")}return ms}var common,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;function k(e){B.debug=B,B.default=B,B.coerce=mr,B.disable=ir,B.enable=rr,B.enabled=lr,B.humanize=requireMs(),B.destroy=hr,Object.keys(e).forEach(fr=>{B[fr]=e[fr]}),B.names=[],B.skips=[],B.formatters={};function I(fr){let _r=0;for(let gr=0;gr<fr.length;gr++)_r=(_r<<5)-_r+fr.charCodeAt(gr),_r|=0;return B.colors[Math.abs(_r)%B.colors.length]}B.selectColor=I;function B(fr){let _r,gr=null,Sr,Ar;function Or(...Fr){if(!Or.enabled)return;const vr=Or,xr=Number(new Date),kr=xr-(_r||xr);vr.diff=kr,vr.prev=_r,vr.curr=xr,_r=xr,Fr[0]=B.coerce(Fr[0]),typeof Fr[0]!="string"&&Fr.unshift("%O");let Gr=0;Fr[0]=Fr[0].replace(/%([a-zA-Z%])/g,(as,cs)=>{if(as==="%%")return"%";Gr++;const es=B.formatters[cs];if(typeof es=="function"){const ps=Fr[Gr];as=es.call(vr,ps),Fr.splice(Gr,1),Gr--}return as}),B.formatArgs.call(vr,Fr),(vr.log||B.log).apply(vr,Fr)}return Or.namespace=fr,Or.useColors=B.useColors(),Or.color=B.selectColor(fr),Or.extend=tr,Or.destroy=B.destroy,Object.defineProperty(Or,"enabled",{enumerable:!0,configurable:!1,get:()=>gr!==null?gr:(Sr!==B.namespaces&&(Sr=B.namespaces,Ar=B.enabled(fr)),Ar),set:Fr=>{gr=Fr}}),typeof B.init=="function"&&B.init(Or),Or}function tr(fr,_r){const gr=B(this.namespace+(typeof _r>"u"?":":_r)+fr);return gr.log=this.log,gr}function rr(fr){B.save(fr),B.namespaces=fr,B.names=[],B.skips=[];let _r;const gr=(typeof fr=="string"?fr:"").split(/[\s,]+/),Sr=gr.length;for(_r=0;_r<Sr;_r++)gr[_r]&&(fr=gr[_r].replace(/\*/g,".*?"),fr[0]==="-"?B.skips.push(new RegExp("^"+fr.slice(1)+"$")):B.names.push(new RegExp("^"+fr+"$")))}function ir(){const fr=[...B.names.map(dr),...B.skips.map(dr).map(_r=>"-"+_r)].join(",");return B.enable(""),fr}function lr(fr){if(fr[fr.length-1]==="*")return!0;let _r,gr;for(_r=0,gr=B.skips.length;_r<gr;_r++)if(B.skips[_r].test(fr))return!1;for(_r=0,gr=B.names.length;_r<gr;_r++)if(B.names[_r].test(fr))return!0;return!1}function dr(fr){return fr.toString().substring(2,fr.toString().length-2).replace(/\.\*\?$/,"*")}function mr(fr){return fr instanceof Error?fr.stack||fr.message:fr}function hr(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return B.enable(B.load()),B}return common=k,common}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,function(k,e){var I={};e.formatArgs=tr,e.save=rr,e.load=ir,e.useColors=B,e.storage=lr(),e.destroy=(()=>{let mr=!1;return()=>{mr||(mr=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function B(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let mr;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(mr=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(mr[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function tr(mr){if(mr[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+mr[0]+(this.useColors?"%c ":" ")+"+"+k.exports.humanize(this.diff),!this.useColors)return;const hr="color: "+this.color;mr.splice(1,0,hr,"color: inherit");let fr=0,_r=0;mr[0].replace(/%[a-zA-Z%]/g,gr=>{gr!=="%%"&&(fr++,gr==="%c"&&(_r=fr))}),mr.splice(_r,0,hr)}e.log=console.debug||console.log||(()=>{});function rr(mr){try{mr?e.storage.setItem("debug",mr):e.storage.removeItem("debug")}catch{}}function ir(){let mr;try{mr=e.storage.getItem("debug")}catch{}return!mr&&typeof process$1<"u"&&"env"in process$1&&(mr=I.DEBUG),mr}function lr(){try{return localStorage}catch{}}k.exports=requireCommon()(e);const{formatters:dr}=k.exports;dr.j=function(mr){try{return JSON.stringify(mr)}catch(hr){return"[UnexpectedJSONParseError]: "+hr.message}}}(browser,browser.exports)),browser.exports}var browserExports=requireBrowser();class DebugLogger extends AbstractLogger{constructor(){super(...arguments),this.logger={log:browserExports.debug("typeorm:log"),info:browserExports.debug("typeorm:info"),warn:browserExports.debug("typeorm:warn"),error:browserExports.debug("typeorm:error"),query:browserExports.debug("typeorm:query:log"),"query-error":browserExports.debug("typeorm:query:error"),"query-slow":browserExports.debug("typeorm:query:slow"),"schema-build":browserExports.debug("typeorm:schema"),migration:browserExports.debug("typeorm:migration")}}isLogEnabledFor(e){switch(e){case"query":return this.logger.query.enabled;case"query-error":return this.logger["query-error"].enabled;case"query-slow":return!0;case"schema":case"schema-build":return this.logger["schema-build"].enabled;case"migration":return this.logger.migration.enabled;case"log":return this.logger.log.enabled;case"info":return this.logger.info.enabled;case"warn":return this.logger.warn.enabled;default:return!1}}writeLog(e,I,B){const tr=this.prepareLogMessages(I,{appendParameterAsComment:!1});for(let rr of tr){const ir=rr.type??e;ir in this.logger&&(rr.prefix?this.logger[ir](rr.prefix,rr.message):this.logger[ir](rr.message),rr.parameters&&rr.parameters.length&&this.logger[ir]("parameters:",rr.parameters))}}}class LoggerFactory{create(e,I){if(ObjectUtils.isObject(e))return e;if(e)switch(e){case"simple-console":return new SimpleConsoleLogger(I);case"file":return new FileLogger(I);case"advanced-console":return new AdvancedConsoleLogger(I);case"debug":return new DebugLogger}return new AdvancedConsoleLogger(I)}}class RedisQueryResultCache{constructor(e,I){this.connection=e,this.clientType=I,this.redis=this.loadRedis()}async connect(){const e=this.connection.options.cache;if(this.clientType==="redis")this.client=this.redis.createClient({...e?.options,legacyMode:!0}),typeof this.connection.options.cache=="object"&&this.connection.options.cache.ignoreErrors&&this.client.on("error",I=>{this.connection.logger.log("warn",I)}),"connect"in this.client&&await this.client.connect();else if(this.clientType==="ioredis")e&&e.port?e.options?this.client=new this.redis(e.port,e.options):this.client=new this.redis(e.port):e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if(this.clientType==="ioredis/cluster")if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else if(e&&e.options&&e.options.startupNodes)this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options);else throw new TypeORMError(`options.startupNodes required for ${this.clientType}.`)}async disconnect(){return new Promise((e,I)=>{this.client.quit((B,tr)=>{if(B)return I(B);e(),this.client=void 0})})}async synchronize(e){}getFromCache(e,I){return new Promise((B,tr)=>{e.identifier?this.client.get(e.identifier,(rr,ir)=>{if(rr)return tr(rr);B(JSON.parse(ir))}):e.query?this.client.get(e.query,(rr,ir)=>{if(rr)return tr(rr);B(JSON.parse(ir))}):B(void 0)})}isExpired(e){return e.time+e.duration<new Date().getTime()}async storeInCache(e,I,B){return new Promise((tr,rr)=>{e.identifier?this.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,(ir,lr)=>{if(ir)return rr(ir);tr()}):e.query&&this.client.set(e.query,JSON.stringify(e),"PX",e.duration,(ir,lr)=>{if(ir)return rr(ir);tr()})})}async clear(e){return new Promise((I,B)=>{this.client.flushdb((tr,rr)=>{if(tr)return B(tr);I()})})}async remove(e,I){await Promise.all(e.map(B=>this.deleteKey(B)))}deleteKey(e){return new Promise((I,B)=>{this.client.del(e,(tr,rr)=>{if(tr)return B(tr);I()})})}loadRedis(){try{return this.clientType==="ioredis/cluster"?PlatformTools.load("ioredis"):PlatformTools.load(this.clientType)}catch{throw new TypeORMError(`Cannot use cache because ${this.clientType} is not installed. Please run "npm i ${this.clientType} --save".`)}}}class DbQueryResultCache{constructor(e){this.connection=e;const{schema:I}=this.connection.driver.options,B=this.connection.driver.database,rr=(typeof this.connection.options.cache=="object"?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheDatabase=B,this.queryResultCacheSchema=I,this.queryResultCacheTable=this.connection.driver.buildTableName(rr,I,B)}async connect(){}async disconnect(){}async synchronize(e){e=this.getQueryRunner(e);const I=this.connection.driver;await e.hasTable(this.queryResultCacheTable)||await e.createTable(new Table({database:this.queryResultCacheDatabase,schema:this.queryResultCacheSchema,name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:I.normalizeType({type:I.mappedDataTypes.cacheId}),generationStrategy:I.options.type==="spanner"?"uuid":"increment",isGenerated:!0},{name:"identifier",type:I.normalizeType({type:I.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:I.normalizeType({type:I.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:I.normalizeType({type:I.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:I.normalizeType({type:I.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:I.normalizeType({type:I.mappedDataTypes.cacheResult}),isNullable:!1}]}))}getFromCache(e,I){I=this.getQueryRunner(I);const B=this.connection.createQueryBuilder(I).select().from(this.queryResultCacheTable,"cache");return e.identifier?B.where(`${B.escape("cache")}.${B.escape("identifier")} = :identifier`).setParameters({identifier:this.connection.driver.options.type==="mssql"?new MssqlParameter(e.identifier,"nvarchar"):e.identifier}).cache(!1).getRawOne():e.query?this.connection.driver.options.type==="oracle"?B.where(`dbms_lob.compare(${B.escape("cache")}.${B.escape("query")}, :query) = 0`,{query:e.query}).cache(!1).getRawOne():B.where(`${B.escape("cache")}.${B.escape("query")} = :query`).setParameters({query:this.connection.driver.options.type==="mssql"?new MssqlParameter(e.query,"nvarchar"):e.query}).cache(!1).getRawOne():Promise.resolve(void 0)}isExpired(e){const I=typeof e.duration=="string"?parseInt(e.duration):e.duration;return(typeof e.time=="string"?parseInt(e.time):e.time)+I<new Date().getTime()}async storeInCache(e,I,B){const tr=B===void 0||B?.getReplicationMode()==="slave";(B===void 0||tr)&&(B=this.connection.createQueryRunner("master"));let rr=e;if(this.connection.driver.options.type==="mssql"&&(rr={identifier:new MssqlParameter(e.identifier,"nvarchar"),time:new MssqlParameter(e.time,"bigint"),duration:new MssqlParameter(e.duration,"int"),query:new MssqlParameter(e.query,"nvarchar"),result:new MssqlParameter(e.result,"nvarchar")}),I&&I.identifier){const ir=B.manager.createQueryBuilder().update(this.queryResultCacheTable).set(rr);ir.where(`${ir.escape("identifier")} = :condition`,{condition:rr.identifier}),await ir.execute()}else if(I&&I.query){const ir=B.manager.createQueryBuilder().update(this.queryResultCacheTable).set(rr);this.connection.driver.options.type==="oracle"?ir.where('dbms_lob.compare("query", :condition) = 0',{condition:rr.query}):ir.where(`${ir.escape("query")} = :condition`,{condition:rr.query}),await ir.execute()}else this.connection.driver.options.type==="spanner"&&!rr.id&&(rr.id=v4()),await B.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(rr).execute();tr&&await B.release()}async clear(e){return this.getQueryRunner(e).clearTable(this.queryResultCacheTable)}async remove(e,I){let B=I||this.getQueryRunner();await Promise.all(e.map(tr=>{const rr=B.manager.createQueryBuilder();return rr.delete().from(this.queryResultCacheTable).where(`${rr.escape("identifier")} = :identifier`,{identifier:tr}).execute()})),I||await B.release()}getQueryRunner(e){return e||this.connection.createQueryRunner()}}class QueryResultCacheFactory{constructor(e){this.connection=e}create(){if(!this.connection.options.cache)throw new TypeORMError("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");const e=this.connection.options.cache;return e.provider&&typeof e.provider=="function"?e.provider(this.connection):e.type==="redis"||e.type==="ioredis"||e.type==="ioredis/cluster"?new RedisQueryResultCache(this.connection,e.type):new DbQueryResultCache(this.connection)}}class RelationLoader{constructor(e){this.connection=e}load(e,I,B,tr){return B&&B.isReleased&&(B=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,I,B,tr):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,I,B,tr):e.isManyToManyOwner?this.loadManyToManyOwner(e,I,B,tr):this.loadManyToManyNotOwner(e,I,B,tr)}loadManyToOneOrOneToOneOwner(e,I,B,tr){const rr=Array.isArray(I)?I:[I],ir=e.entityMetadata.name,lr=tr||this.connection.createQueryBuilder(B).select(e.propertyName).from(e.type,e.propertyName),dr=lr.expressionMap.mainAlias.name,mr=e.entityMetadata.primaryColumns,fr=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map(_r=>`${e.entityMetadata.name}.${_r.propertyName} = ${dr}.${_r.referencedColumn.propertyName}`).join(" AND ");if(lr.innerJoin(e.entityMetadata.target,ir,fr),mr.length===1)lr.where(`${ir}.${mr[0].propertyPath} IN (:...${ir+"_"+mr[0].propertyName})`),lr.setParameter(ir+"_"+mr[0].propertyName,rr.map(_r=>mr[0].getEntityValue(_r,!0)));else{const _r=rr.map((gr,Sr)=>mr.map((Ar,Or)=>{const Fr=ir+"_entity_"+Sr+"_"+Or;return lr.setParameter(Fr,Ar.getEntityValue(gr,!0)),ir+"."+Ar.propertyPath+" = :"+Fr}).join(" AND ")).map(gr=>"("+gr+")").join(" OR ");lr.where(_r)}return FindOptionsUtils.joinEagerRelations(lr,lr.alias,lr.expressionMap.mainAlias.metadata),lr.getMany()}loadOneToManyOrOneToOneNotOwner(e,I,B,tr){const rr=Array.isArray(I)?I:[I],ir=e.inverseRelation.joinColumns,lr=tr||this.connection.createQueryBuilder(B).select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName),dr=lr.expressionMap.mainAlias.name;if(ir.length===1)lr.where(`${dr}.${ir[0].propertyPath} IN (:...${dr+"_"+ir[0].propertyName})`),lr.setParameter(dr+"_"+ir[0].propertyName,rr.map(mr=>ir[0].referencedColumn.getEntityValue(mr,!0)));else{const mr=rr.map((hr,fr)=>ir.map((_r,gr)=>{const Sr=dr+"_entity_"+fr+"_"+gr;return lr.setParameter(Sr,_r.referencedColumn.getEntityValue(hr,!0)),dr+"."+_r.propertyPath+" = :"+Sr}).join(" AND ")).map(hr=>"("+hr+")").join(" OR ");lr.where(mr)}return FindOptionsUtils.joinEagerRelations(lr,lr.alias,lr.expressionMap.mainAlias.metadata),lr.getMany()}loadManyToManyOwner(e,I,B,tr){const rr=Array.isArray(I)?I:[I],ir=e.joinColumns.reduce((_r,gr)=>(_r[gr.propertyName]=rr.map(Sr=>gr.referencedColumn.getEntityValue(Sr,!0)),_r),{}),lr=tr||this.connection.createQueryBuilder(B).select(e.propertyName).from(e.type,e.propertyName),dr=lr.expressionMap.mainAlias.name,mr=e.junctionEntityMetadata.tableName,hr=e.joinColumns.map(_r=>`${mr}.${_r.propertyName} IN (:...${_r.propertyName})`),fr=e.inverseJoinColumns.map(_r=>`${mr}.${_r.propertyName}=${dr}.${_r.referencedColumn.propertyName}`);return lr.innerJoin(mr,mr,[...hr,...fr].join(" AND ")).setParameters(ir),FindOptionsUtils.joinEagerRelations(lr,lr.alias,lr.expressionMap.mainAlias.metadata),lr.getMany()}loadManyToManyNotOwner(e,I,B,tr){const rr=Array.isArray(I)?I:[I],ir=tr||this.connection.createQueryBuilder(B).select(e.propertyName).from(e.type,e.propertyName),lr=ir.expressionMap.mainAlias.name,dr=e.junctionEntityMetadata.tableName,mr=e.inverseRelation.joinColumns.map(_r=>`${dr}.${_r.propertyName} = ${lr}.${_r.referencedColumn.propertyName}`),hr=e.inverseRelation.inverseJoinColumns.map(_r=>`${dr}.${_r.propertyName} IN (:...${_r.propertyName})`),fr=e.inverseRelation.inverseJoinColumns.reduce((_r,gr)=>(_r[gr.propertyName]=rr.map(Sr=>gr.referencedColumn.getEntityValue(Sr,!0)),_r),{});return ir.innerJoin(dr,dr,[...mr,...hr].join(" AND ")).setParameters(fr),FindOptionsUtils.joinEagerRelations(ir,ir.alias,ir.expressionMap.mainAlias.metadata),ir.getMany()}enableLazyLoad(e,I,B){const tr=this,rr="__"+e.propertyName+"__",ir="__promise_"+e.propertyName+"__",lr="__has_"+e.propertyName+"__",dr=(hr,fr)=>(hr[rr]=fr,hr[lr]=!0,delete hr[ir],fr),mr=(hr,fr)=>(delete hr[lr],delete hr[rr],hr[ir]=fr,fr.then(_r=>hr[ir]===fr?dr(hr,_r):_r),fr);Object.defineProperty(I,e.propertyName,{get:function(){if(this[lr]===!0||this[rr]!==void 0)return Promise.resolve(this[rr]);if(this[ir])return this[ir];const hr=tr.load(e,this,B).then(fr=>e.isOneToOne||e.isManyToOne?fr.length===0?null:fr[0]:fr);return mr(this,hr)},set:function(hr){hr instanceof Promise?mr(this,hr):dr(this,hr)},configurable:!0,enumerable:!1})}}registerQueryBuilders();class DataSource{constructor(e){this["@instanceof"]=Symbol.for("DataSource"),this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.entityMetadatasMap=new Map,registerQueryBuilders(),this.name=e.name||"default",this.options=e,this.logger=new LoggerFactory().create(this.options.logger,this.options.logging),this.driver=new DriverFactory().create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new DefaultNamingStrategy,this.metadataTableName=e.metadataTableName||"typeorm_metadata",this.queryResultCache=e.cache?new QueryResultCacheFactory(this).create():void 0,this.relationLoader=new RelationLoader(this),this.relationIdLoader=new RelationIdLoader(this),this.isInitialized=!1}get isConnected(){return this.isInitialized}get mongoManager(){if(!InstanceChecker.isMongoEntityManager(this.manager))throw new TypeORMError("MongoEntityManager is only available for MongoDB databases.");return this.manager}get sqljsManager(){if(!InstanceChecker.isSqljsEntityManager(this.manager))throw new TypeORMError("SqljsEntityManager is only available for Sqljs databases.");return this.manager}setOptions(e){return Object.assign(this.options,e),(e.logger||e.logging)&&(this.logger=new LoggerFactory().create(e.logger||this.options.logger,e.logging||this.options.logging)),e.namingStrategy&&(this.namingStrategy=e.namingStrategy),e.cache&&(this.queryResultCache=new QueryResultCacheFactory(this).create()),e.database&&(this.driver.database=DriverUtils.buildDriverOptions(this.options).database),this}async initialize(){if(this.isInitialized)throw new CannotConnectAlreadyConnectedError(this.name);await this.driver.connect(),this.queryResultCache&&await this.queryResultCache.connect(),ObjectUtils.assign(this,{isInitialized:!0});try{await this.buildMetadatas(),await this.driver.afterConnect(),this.options.dropSchema&&await this.dropDatabase(),this.options.migrationsRun&&await this.runMigrations({transaction:this.options.migrationsTransactionMode}),this.options.synchronize&&await this.synchronize()}catch(e){throw await this.destroy(),e}return this}async connect(){return this.initialize()}async destroy(){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);await this.driver.disconnect(),this.queryResultCache&&await this.queryResultCache.disconnect(),ObjectUtils.assign(this,{isInitialized:!1})}async close(){return this.destroy()}async synchronize(e=!1){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);e&&await this.dropDatabase(),await this.driver.createSchemaBuilder().build()}async dropDatabase(){const e=this.createQueryRunner();try{if(this.driver.options.type==="mssql"||DriverUtils.isMySQLFamily(this.driver)||this.driver.options.type==="aurora-mysql"||DriverUtils.isSQLiteFamily(this.driver)){const I=[];if(this.entityMetadatas.forEach(B=>{B.database&&I.indexOf(B.database)===-1&&I.push(B.database)}),I.length===0&&this.driver.database&&I.push(this.driver.database),I.length===0)await e.clearDatabase();else for(const B of I)await e.clearDatabase(B)}else await e.clearDatabase()}finally{await e.release()}}async runMigrations(e){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);const I=new MigrationExecutor(this);return I.transaction=e?.transaction||this.options?.migrationsTransactionMode||"all",I.fake=e&&e.fake||!1,await I.executePendingMigrations()}async undoLastMigration(e){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);const I=new MigrationExecutor(this);I.transaction=e&&e.transaction||"all",I.fake=e&&e.fake||!1,await I.undoLastMigration()}async showMigrations(){if(!this.isInitialized)throw new CannotExecuteNotConnectedError(this.name);return await new MigrationExecutor(this).showMigrations()}hasMetadata(e){return!!this.findMetadata(e)}getMetadata(e){const I=this.findMetadata(e);if(!I)throw new EntityMetadataNotFoundError(e);return I}getRepository(e){return this.manager.getRepository(e)}getTreeRepository(e){return this.manager.getTreeRepository(e)}getMongoRepository(e){if(this.driver.options.type!=="mongodb")throw new TypeORMError("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)}getCustomRepository(e){return this.manager.getCustomRepository(e)}async transaction(e,I){return this.manager.transaction(e,I)}async query(e,I,B){if(InstanceChecker.isMongoEntityManager(this.manager))throw new TypeORMError("Queries aren't supported by MongoDB.");if(B&&B.isReleased)throw new QueryRunnerProviderAlreadyReleasedError;const tr=B||this.createQueryRunner();try{return await tr.query(e,I)}finally{B||await tr.release()}}createQueryBuilder(e,I,B){if(InstanceChecker.isMongoEntityManager(this.manager))throw new TypeORMError("Query Builder is not supported by MongoDB.");if(I){I=DriverUtils.buildAlias(this.driver,void 0,I);const tr=this.getMetadata(e);return new SelectQueryBuilder(this,B).select(I).from(tr.target,I)}else return new SelectQueryBuilder(this,e)}createQueryRunner(e="master"){const I=this.driver.createQueryRunner(e),B=this.createEntityManager(I);return Object.assign(I,{manager:B}),I}getManyToManyMetadata(e,I){const B=this.getMetadata(e).findRelationWithPropertyPath(I);if(!B)throw new TypeORMError(`Relation "${I}" was not found in ${e} entity.`);if(!B.isManyToMany)throw new TypeORMError(`Relation "${e}#${I}" does not have a many-to-many relationship.You can use this method only on many-to-many relations.`);return B.junctionEntityMetadata}createEntityManager(e){return new EntityManagerFactory().create(this,e)}findMetadata(e){const I=this.entityMetadatasMap.get(e);if(I)return I;for(let[B,tr]of this.entityMetadatasMap){if(InstanceChecker.isEntitySchema(e)&&tr.name===e.options.name)return tr;if(typeof e=="string"){if(e.indexOf(".")!==-1){if(tr.tablePath===e)return tr}else if(tr.name===e||tr.tableName===e)return tr}if(ObjectUtils.isObjectWithName(e)&&typeof e.name=="string"){if(e.name.indexOf(".")!==-1){if(tr.tablePath===e.name)return tr}else if(tr.name===e.name||tr.tableName===e.name)return tr}}}async buildMetadatas(){const e=new ConnectionMetadataBuilder(this),I=new EntityMetadataValidator,B=ObjectUtils.mixedListToArray(this.options.subscribers||[]),tr=await e.buildSubscribers(B);ObjectUtils.assign(this,{subscribers:tr});const rr=ObjectUtils.mixedListToArray(this.options.entities||[]),ir=await e.buildEntityMetadatas(rr);ObjectUtils.assign(this,{entityMetadatas:ir,entityMetadatasMap:new Map(ir.map(mr=>[mr.target,mr]))});const lr=ObjectUtils.mixedListToArray(this.options.migrations||[]),dr=await e.buildMigrations(lr);ObjectUtils.assign(this,{migrations:dr}),I.validateMany(this.entityMetadatas.filter(mr=>mr.tableType!=="view"),this.driver);for(let mr of ir)InstanceChecker.isBaseEntityConstructor(mr.target)&&mr.target.useDataSource(this)}defaultReplicationModeForReads(){if("replication"in this.driver.options){const e=this.driver.options.replication.defaultMode;if(e)return e}return"slave"}}function getMetadataArgsStorage(){const k=PlatformTools.getGlobalVariable();return k.typeormMetadataArgsStorage||(k.typeormMetadataArgsStorage=new MetadataArgsStorage),k.typeormMetadataArgsStorage}function Column(k,e){return function(I,B){let tr;typeof k=="string"||typeof k=="function"?tr=k:k&&(e=k,tr=k.type),e||(e={});const rr=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",I,B):void 0;if(!tr&&rr&&(tr=rr),!e.type&&tr&&(e.type=tr),e.type==="hstore"&&!e.hstoreType&&(e.hstoreType=rr===Object?"object":"string"),typeof k=="function")getMetadataArgsStorage().embeddeds.push({target:I.constructor,propertyName:B,isArray:rr===Array||e.array===!0,prefix:e.prefix!==void 0?e.prefix:void 0,type:k});else{if(!e.type)throw new ColumnTypeUndefinedError(I,B);e.unique===!0&&getMetadataArgsStorage().uniques.push({target:I.constructor,columns:[B]}),getMetadataArgsStorage().columns.push({target:I.constructor,propertyName:B,mode:"regular",options:e}),e.generated&&getMetadataArgsStorage().generations.push({target:I.constructor,propertyName:B,strategy:typeof e.generated=="string"?e.generated:"increment"})}}}function CreateDateColumn(k){return function(e,I){getMetadataArgsStorage().columns.push({target:e.constructor,propertyName:I,mode:"createDate",options:{}})}}function PrimaryGeneratedColumn(k,e){const I={};let B;return B=k,ObjectUtils.isObject(k)&&(B="increment",Object.assign(I,k)),ObjectUtils.isObject(e)&&Object.assign(I,e),function(tr,rr){I.type||(B==="increment"||B==="identity"?I.type=Number:B==="uuid"?I.type="uuid":B==="rowid"&&(I.type="int")),I.primary=!0,getMetadataArgsStorage().columns.push({target:tr.constructor,propertyName:rr,mode:"regular",options:I}),getMetadataArgsStorage().generations.push({target:tr.constructor,propertyName:rr,strategy:B})}}function UpdateDateColumn(k){return function(e,I){getMetadataArgsStorage().columns.push({target:e.constructor,propertyName:I,mode:"updateDate",options:{}})}}function JoinColumn(k){return function(e,I){(Array.isArray(k)?k:[k||{}]).forEach(tr=>{getMetadataArgsStorage().joinColumns.push({target:e.constructor,propertyName:I,name:tr.name,referencedColumnName:tr.referencedColumnName,foreignKeyConstraintName:tr.foreignKeyConstraintName})})}}function ManyToOne(k,e,I){let B;return ObjectUtils.isObject(e)?I=e:B=e,function(tr,rr){I||(I={});let ir=I&&I.lazy===!0;if(!ir&&Reflect&&Reflect.getMetadata){const lr=Reflect.getMetadata("design:type",tr,rr);lr&&typeof lr.name=="string"&&lr.name.toLowerCase()==="promise"&&(ir=!0)}getMetadataArgsStorage().relations.push({target:tr.constructor,propertyName:rr,relationType:"many-to-one",isLazy:ir,type:k,inverseSideProperty:B,options:I})}}function OneToMany(k,e,I){return function(B,tr){I||(I={});let rr=I&&I.lazy===!0;if(!rr&&Reflect&&Reflect.getMetadata){const ir=Reflect.getMetadata("design:type",B,tr);ir&&typeof ir.name=="string"&&ir.name.toLowerCase()==="promise"&&(rr=!0)}getMetadataArgsStorage().relations.push({target:B.constructor,propertyName:tr,isLazy:rr,relationType:"one-to-many",type:k,inverseSideProperty:e,options:I})}}function OneToOne(k,e,I){let B;return ObjectUtils.isObject(e)?I=e:B=e,function(tr,rr){I||(I={});let ir=!!(I&&I.lazy===!0);if(!ir&&Reflect&&Reflect.getMetadata){const lr=Reflect.getMetadata("design:type",tr,rr);lr&&typeof lr.name=="string"&&lr.name.toLowerCase()==="promise"&&(ir=!0)}getMetadataArgsStorage().relations.push({target:tr.constructor,propertyName:rr,isLazy:ir,relationType:"one-to-one",type:k,inverseSideProperty:B,options:I})}}function Entity(k,e){const I=(ObjectUtils.isObject(k)?k:e)||{},B=typeof k=="string"?k:I.name;return function(tr){getMetadataArgsStorage().tables.push({target:tr,name:B,type:"regular",orderBy:I.orderBy?I.orderBy:void 0,engine:I.engine?I.engine:void 0,database:I.database?I.database:void 0,schema:I.schema?I.schema:void 0,synchronize:I.synchronize,withoutRowid:I.withoutRowid,comment:I.comment?I.comment:void 0})}}function Any(k){return new FindOperator("any",k)}function ArrayContainedBy(k){return new FindOperator("arrayContainedBy",k)}function ArrayContains(k){return new FindOperator("arrayContains",k)}function ArrayOverlap(k){return new FindOperator("arrayOverlap",k)}function Between(k,e){return new FindOperator("between",[k,e],!0,!0)}class EqualOperator extends FindOperator{constructor(e){super("equal",e),this["@instanceof"]=Symbol.for("EqualOperator")}}function Equal(k){return new EqualOperator(k)}function IsNull(){return new FindOperator("isNull",void 0,!1)}function LessThan(k){return new FindOperator("lessThan",k)}function LessThanOrEqual(k){return new FindOperator("lessThanOrEqual",k)}function Like(k){return new FindOperator("like",k)}function MoreThan(k){return new FindOperator("moreThan",k)}function MoreThanOrEqual(k){return new FindOperator("moreThanOrEqual",k)}function Not(k){return new FindOperator("not",k)}function Raw(k,e){return typeof k!="function"?new FindOperator("raw",k,!1):new FindOperator("raw",[],!0,!0,k,e)}var p=Object.create,i=Object.defineProperty,c=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,l$2=Object.getPrototypeOf,s$1=Object.prototype.hasOwnProperty,a=k=>{throw TypeError(k)},_$1=(k,e,I)=>e in k?i(k,e,{enumerable:!0,configurable:!0,writable:!0,value:I}):k[e]=I,d=(k,e)=>()=>(k&&(e=k(k=0)),e),D$1=(k,e)=>()=>(e||k((e={exports:{}}).exports,e),e.exports),F$1=(k,e)=>{for(var I in e)i(k,I,{get:e[I],enumerable:!0})},g$3=(k,e,I,B)=>{if(e&&typeof e=="object"||typeof e=="function")for(let tr of f(e))!s$1.call(k,tr)&&tr!==I&&i(k,tr,{get:()=>e[tr],enumerable:!(B=c(e,tr))||B.enumerable});return k},L$2=(k,e,I)=>(I=k!=null?p(l$2(k)):{},g$3(i(I,"default",{value:k,enumerable:!0}),k)),P$1=(k,e,I)=>_$1(k,typeof e!="symbol"?e+"":e,I),n=(k,e,I)=>e.has(k)||a("Cannot "+I),h$1=(k,e,I)=>(n(k,e,"read from private field"),I?I.call(k):e.get(k)),R$2=(k,e,I)=>e.has(k)?a("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(k):e.set(k,I),x$2=(k,e,I,B)=>(n(k,e,"write to private field"),e.set(k,I),I),T$1=(k,e,I)=>(n(k,e,"access private method"),I),U$1=(k,e,I,B)=>({set _(tr){x$2(k,e,tr)},get _(){return h$1(k,e,B)}}),u$1=d(()=>{});u$1();var t=async(k,e)=>({bundlePath:new URL("/NoLLMChat/assets/uuid-ossp.tar-kvt3Wpbu.gz",import.meta.url)}),o$2={name:"uuid-ossp",setup:t};const __vite_import_meta_env__={BASE_URL:"/NoLLMChat/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_URL:"/NoLLMChat/",VITE_ROUTE_MODE:"hash"},isDev=(typeof __vite_import_meta_env__<"u",typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage.getItem("__DEBUG__")==="true":!1),DATABASE_LOG_CONFIG=isDev?{logging:["query","error","warn","error","migration","info"],logger:"advanced-console"}:{logging:["error","migration"],logger:"debug"},ANSI_BACKGROUND_OFFSET=10,wrapAnsi16=(k=0)=>e=>`\x1B[${e+k}m`,wrapAnsi256=(k=0)=>e=>`\x1B[${38+k};5;${e}m`,wrapAnsi16m=(k=0)=>(e,I,B)=>`\x1B[${38+k};2;${e};${I};${B}m`,styles$1={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(styles$1.modifier);const foregroundColorNames=Object.keys(styles$1.color),backgroundColorNames=Object.keys(styles$1.bgColor);[...foregroundColorNames,...backgroundColorNames];function assembleStyles(){const k=new Map;for(const[e,I]of Object.entries(styles$1)){for(const[B,tr]of Object.entries(I))styles$1[B]={open:`\x1B[${tr[0]}m`,close:`\x1B[${tr[1]}m`},I[B]=styles$1[B],k.set(tr[0],tr[1]);Object.defineProperty(styles$1,e,{value:I,enumerable:!1})}return Object.defineProperty(styles$1,"codes",{value:k,enumerable:!1}),styles$1.color.close="\x1B[39m",styles$1.bgColor.close="\x1B[49m",styles$1.color.ansi=wrapAnsi16(),styles$1.color.ansi256=wrapAnsi256(),styles$1.color.ansi16m=wrapAnsi16m(),styles$1.bgColor.ansi=wrapAnsi16(ANSI_BACKGROUND_OFFSET),styles$1.bgColor.ansi256=wrapAnsi256(ANSI_BACKGROUND_OFFSET),styles$1.bgColor.ansi16m=wrapAnsi16m(ANSI_BACKGROUND_OFFSET),Object.defineProperties(styles$1,{rgbToAnsi256:{value(e,I,B){return e===I&&I===B?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(I/255*5)+Math.round(B/255*5)},enumerable:!1},hexToRgb:{value(e){const I=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!I)return[0,0,0];let[B]=I;B.length===3&&(B=[...B].map(rr=>rr+rr).join(""));const tr=Number.parseInt(B,16);return[tr>>16&255,tr>>8&255,tr&255]},enumerable:!1},hexToAnsi256:{value:e=>styles$1.rgbToAnsi256(...styles$1.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return 90+(e-8);let I,B,tr;if(e>=232)I=((e-232)*10+8)/255,B=I,tr=I;else{e-=16;const lr=e%36;I=Math.floor(e/36)/5,B=Math.floor(lr/6)/5,tr=lr%6/5}const rr=Math.max(I,B,tr)*2;if(rr===0)return 30;let ir=30+(Math.round(tr)<<2|Math.round(B)<<1|Math.round(I));return rr===2&&(ir+=60),ir},enumerable:!1},rgbToAnsi:{value:(e,I,B)=>styles$1.ansi256ToAnsi(styles$1.rgbToAnsi256(e,I,B)),enumerable:!1},hexToAnsi:{value:e=>styles$1.ansi256ToAnsi(styles$1.hexToAnsi256(e)),enumerable:!1}}),styles$1}const ansiStyles=assembleStyles(),level=(()=>{if(navigator.userAgentData){const k=navigator.userAgentData.brands.find(({brand:e})=>e==="Chromium");if(k&&k.version>93)return 3}return/\b(Chrome|Chromium)\//.test(navigator.userAgent)?1:0})(),colorSupport=level!==0&&{level,hasBasic:!0,has256:level>=2,has16m:level>=3},supportsColor={stdout:colorSupport,stderr:colorSupport};function stringReplaceAll(k,e,I){let B=k.indexOf(e);if(B===-1)return k;const tr=e.length;let rr=0,ir="";do ir+=k.slice(rr,B)+e+I,rr=B+tr,B=k.indexOf(e,rr);while(B!==-1);return ir+=k.slice(rr),ir}function stringEncaseCRLFWithFirstIndex(k,e,I,B){let tr=0,rr="";do{const ir=k[B-1]==="\r";rr+=k.slice(tr,ir?B-1:B)+e+(ir?`\r
`:`
`)+I,tr=B+1,B=k.indexOf(`
`,tr)}while(B!==-1);return rr+=k.slice(tr),rr}const{stdout:stdoutColor,stderr:stderrColor}=supportsColor,GENERATOR=Symbol("GENERATOR"),STYLER=Symbol("STYLER"),IS_EMPTY=Symbol("IS_EMPTY"),levelMapping=["ansi","ansi","ansi256","ansi16m"],styles=Object.create(null),applyOptions=(k,e={})=>{if(e.level&&!(Number.isInteger(e.level)&&e.level>=0&&e.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const I=stdoutColor?stdoutColor.level:0;k.level=e.level===void 0?I:e.level},chalkFactory=k=>{const e=(...I)=>I.join(" ");return applyOptions(e,k),Object.setPrototypeOf(e,createChalk.prototype),e};function createChalk(k){return chalkFactory(k)}Object.setPrototypeOf(createChalk.prototype,Function.prototype);for(const[k,e]of Object.entries(ansiStyles))styles[k]={get(){const I=createBuilder(this,createStyler(e.open,e.close,this[STYLER]),this[IS_EMPTY]);return Object.defineProperty(this,k,{value:I}),I}};styles.visible={get(){const k=createBuilder(this,this[STYLER],!0);return Object.defineProperty(this,"visible",{value:k}),k}};const getModelAnsi=(k,e,I,...B)=>k==="rgb"?e==="ansi16m"?ansiStyles[I].ansi16m(...B):e==="ansi256"?ansiStyles[I].ansi256(ansiStyles.rgbToAnsi256(...B)):ansiStyles[I].ansi(ansiStyles.rgbToAnsi(...B)):k==="hex"?getModelAnsi("rgb",e,I,...ansiStyles.hexToRgb(...B)):ansiStyles[I][k](...B),usedModels=["rgb","hex","ansi256"];for(const k of usedModels){styles[k]={get(){const{level:I}=this;return function(...B){const tr=createStyler(getModelAnsi(k,levelMapping[I],"color",...B),ansiStyles.color.close,this[STYLER]);return createBuilder(this,tr,this[IS_EMPTY])}}};const e="bg"+k[0].toUpperCase()+k.slice(1);styles[e]={get(){const{level:I}=this;return function(...B){const tr=createStyler(getModelAnsi(k,levelMapping[I],"bgColor",...B),ansiStyles.bgColor.close,this[STYLER]);return createBuilder(this,tr,this[IS_EMPTY])}}}}const proto=Object.defineProperties(()=>{},{...styles,level:{enumerable:!0,get(){return this[GENERATOR].level},set(k){this[GENERATOR].level=k}}}),createStyler=(k,e,I)=>{let B,tr;return I===void 0?(B=k,tr=e):(B=I.openAll+k,tr=e+I.closeAll),{open:k,close:e,openAll:B,closeAll:tr,parent:I}},createBuilder=(k,e,I)=>{const B=(...tr)=>applyStyle(B,tr.length===1?""+tr[0]:tr.join(" "));return Object.setPrototypeOf(B,proto),B[GENERATOR]=k,B[STYLER]=e,B[IS_EMPTY]=I,B},applyStyle=(k,e)=>{if(k.level<=0||!e)return k[IS_EMPTY]?"":e;let I=k[STYLER];if(I===void 0)return e;const{openAll:B,closeAll:tr}=I;if(e.includes("\x1B"))for(;I!==void 0;)e=stringReplaceAll(e,I.close,I.open),I=I.parent;const rr=e.indexOf(`
`);return rr!==-1&&(e=stringEncaseCRLFWithFirstIndex(e,tr,B,rr)),B+e+tr};Object.defineProperties(createChalk.prototype,styles);const chalk=createChalk();createChalk({level:stderrColor?stderrColor.level:0});const log=isDev?console.log:void 0,debug=isDev?console.debug:void 0,warn=console.warn,error=console.error,group=console.group,groupEnd=console.groupEnd,logBase=(k,e,I,...B)=>{const[tr,...rr]=B,ir=typeof tr=="string";group(e(`${k} ${ir?tr:""}[${dayjs().format("DD-MM-YYYY HH:mm:ss")}]`)),I?.(...ir?rr:B),groupEnd()},logInfo=(...k)=>{logBase("🔵 INFO:",chalk.blueBright,log,...k)},logError=(...k)=>{logBase("🔴 ERROR:",chalk.redBright,error,...k)},logWarn=(...k)=>{logBase("🔶 WARN:",chalk.yellowBright,warn,...k)},logDebug=(...k)=>{logBase("⚪ DEBUG:",chalk.greenBright,debug,...k)};var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,function(k){var e=Object.prototype.hasOwnProperty,I="~";function B(){}Object.create&&(B.prototype=Object.create(null),new B().__proto__||(I=!1));function tr(dr,mr,hr){this.fn=dr,this.context=mr,this.once=hr||!1}function rr(dr,mr,hr,fr,_r){if(typeof hr!="function")throw new TypeError("The listener must be a function");var gr=new tr(hr,fr||dr,_r),Sr=I?I+mr:mr;return dr._events[Sr]?dr._events[Sr].fn?dr._events[Sr]=[dr._events[Sr],gr]:dr._events[Sr].push(gr):(dr._events[Sr]=gr,dr._eventsCount++),dr}function ir(dr,mr){--dr._eventsCount===0?dr._events=new B:delete dr._events[mr]}function lr(){this._events=new B,this._eventsCount=0}lr.prototype.eventNames=function(){var mr=[],hr,fr;if(this._eventsCount===0)return mr;for(fr in hr=this._events)e.call(hr,fr)&&mr.push(I?fr.slice(1):fr);return Object.getOwnPropertySymbols?mr.concat(Object.getOwnPropertySymbols(hr)):mr},lr.prototype.listeners=function(mr){var hr=I?I+mr:mr,fr=this._events[hr];if(!fr)return[];if(fr.fn)return[fr.fn];for(var _r=0,gr=fr.length,Sr=new Array(gr);_r<gr;_r++)Sr[_r]=fr[_r].fn;return Sr},lr.prototype.listenerCount=function(mr){var hr=I?I+mr:mr,fr=this._events[hr];return fr?fr.fn?1:fr.length:0},lr.prototype.emit=function(mr,hr,fr,_r,gr,Sr){var Ar=I?I+mr:mr;if(!this._events[Ar])return!1;var Or=this._events[Ar],Fr=arguments.length,vr,xr;if(Or.fn){switch(Or.once&&this.removeListener(mr,Or.fn,void 0,!0),Fr){case 1:return Or.fn.call(Or.context),!0;case 2:return Or.fn.call(Or.context,hr),!0;case 3:return Or.fn.call(Or.context,hr,fr),!0;case 4:return Or.fn.call(Or.context,hr,fr,_r),!0;case 5:return Or.fn.call(Or.context,hr,fr,_r,gr),!0;case 6:return Or.fn.call(Or.context,hr,fr,_r,gr,Sr),!0}for(xr=1,vr=new Array(Fr-1);xr<Fr;xr++)vr[xr-1]=arguments[xr];Or.fn.apply(Or.context,vr)}else{var kr=Or.length,Gr;for(xr=0;xr<kr;xr++)switch(Or[xr].once&&this.removeListener(mr,Or[xr].fn,void 0,!0),Fr){case 1:Or[xr].fn.call(Or[xr].context);break;case 2:Or[xr].fn.call(Or[xr].context,hr);break;case 3:Or[xr].fn.call(Or[xr].context,hr,fr);break;case 4:Or[xr].fn.call(Or[xr].context,hr,fr,_r);break;default:if(!vr)for(Gr=1,vr=new Array(Fr-1);Gr<Fr;Gr++)vr[Gr-1]=arguments[Gr];Or[xr].fn.apply(Or[xr].context,vr)}}return!0},lr.prototype.on=function(mr,hr,fr){return rr(this,mr,hr,fr,!1)},lr.prototype.once=function(mr,hr,fr){return rr(this,mr,hr,fr,!0)},lr.prototype.removeListener=function(mr,hr,fr,_r){var gr=I?I+mr:mr;if(!this._events[gr])return this;if(!hr)return ir(this,gr),this;var Sr=this._events[gr];if(Sr.fn)Sr.fn===hr&&(!_r||Sr.once)&&(!fr||Sr.context===fr)&&ir(this,gr);else{for(var Ar=0,Or=[],Fr=Sr.length;Ar<Fr;Ar++)(Sr[Ar].fn!==hr||_r&&!Sr[Ar].once||fr&&Sr[Ar].context!==fr)&&Or.push(Sr[Ar]);Or.length?this._events[gr]=Or.length===1?Or[0]:Or:ir(this,gr)}return this},lr.prototype.removeAllListeners=function(mr){var hr;return mr?(hr=I?I+mr:mr,this._events[hr]&&ir(this,hr)):(this._events=new B,this._eventsCount=0),this},lr.prototype.off=lr.prototype.removeListener,lr.prototype.addListener=lr.prototype.on,lr.prefixed=I,lr.EventEmitter=lr,k.exports=lr}(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3(),EventEmitter=getDefaultExportFromCjs$1(eventemitter3Exports),hn={};F$1(hn,{ABSTIME:()=>Et,ACLITEM:()=>Vt,BIT:()=>jt,BOOL:()=>be,BPCHAR:()=>_e,BYTEA:()=>ge,CHAR:()=>gt,CID:()=>St,CIDR:()=>Tt,CIRCLE:()=>Ut,DATE:()=>He,FLOAT4:()=>Qe$1,FLOAT8:()=>We,GTSVECTOR:()=>rn,INET:()=>kt,INT2:()=>ve,INT4:()=>Ge,INT8:()=>we,INTERVAL:()=>vt,JSON:()=>Ae$1,JSONB:()=>Ye$1,MACADDR:()=>Ot,MACADDR8:()=>Nt,MONEY:()=>Lt,NUMERIC:()=>Wt,OID:()=>je,PATH:()=>Mt,PG_DEPENDENCIES:()=>en,PG_LSN:()=>Xt,PG_NDISTINCT:()=>Zt,PG_NODE_TREE:()=>Bt,POLYGON:()=>Rt,REFCURSOR:()=>_t,REGCLASS:()=>Yt,REGCONFIG:()=>sn,REGDICTIONARY:()=>an,REGNAMESPACE:()=>on,REGOPER:()=>Ht,REGOPERATOR:()=>qt,REGPROC:()=>wt,REGPROCEDURE:()=>zt,REGROLE:()=>un,REGTYPE:()=>$t,RELTIME:()=>Ct,SMGR:()=>It,TEXT:()=>V$1,TID:()=>At,TIME:()=>Ft,TIMESTAMP:()=>qe$1,TIMESTAMPTZ:()=>xe$1,TIMETZ:()=>Gt,TINTERVAL:()=>Pt,TSQUERY:()=>nn,TSVECTOR:()=>tn,TXID_SNAPSHOT:()=>Jt,UUID:()=>Kt,VARBIT:()=>Qt,VARCHAR:()=>ze$1,XID:()=>xt,XML:()=>Dt,arrayParser:()=>yn,arraySerializer:()=>Ke$1,parseType:()=>ue$1,parsers:()=>ln,serializers:()=>cn,types:()=>$e$1});u$1();var ht=globalThis.JSON.parse,bt=globalThis.JSON.stringify,be=16,ge=17,gt=18,we=20,ve=21,Ge=23,wt=24,V$1=25,je=26,At=27,xt=28,St=29,Ae$1=114,Dt=142,Bt=194,It=210,Mt=602,Rt=604,Tt=650,Qe$1=700,We=701,Et=702,Ct=703,Pt=704,Ut=718,Nt=774,Lt=790,Ot=829,kt=869,Vt=1033,_e=1042,ze$1=1043,He=1082,Ft=1083,qe$1=1114,xe$1=1184,vt=1186,Gt=1266,jt=1560,Qt=1562,Wt=1700,_t=1790,zt=2202,Ht=2203,qt=2204,Yt=2205,$t=2206,Kt=2950,Jt=2970,Xt=3220,Zt=3361,en=3402,tn=3614,nn=3615,rn=3642,sn=3734,an=3769,Ye$1=3802,on=4089,un=4096,$e$1={string:{to:V$1,from:[V$1,ze$1,_e],serialize:k=>{if(typeof k=="string")return k;if(typeof k=="number")return k.toString();throw new Error("Invalid input for string type")},parse:k=>k},number:{to:0,from:[ve,Ge,je,Qe$1,We],serialize:k=>k.toString(),parse:k=>+k},bigint:{to:we,from:[we],serialize:k=>k.toString(),parse:k=>{let e=BigInt(k);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:Ae$1,from:[Ae$1,Ye$1],serialize:k=>typeof k=="string"?k:bt(k),parse:k=>ht(k)},boolean:{to:be,from:[be],serialize:k=>{if(typeof k!="boolean")throw new Error("Invalid input for boolean type");return k?"t":"f"},parse:k=>k==="t"},date:{to:xe$1,from:[He,qe$1,xe$1],serialize:k=>{if(typeof k=="string")return k;if(typeof k=="number")return new Date(k).toISOString();if(k instanceof Date)return k.toISOString();throw new Error("Invalid input for date type")},parse:k=>new Date(k)},bytea:{to:ge,from:[ge],serialize:k=>{if(!(k instanceof Uint8Array))throw new Error("Invalid input for bytea type");return"\\x"+Array.from(k).map(e=>e.toString(16).padStart(2,"0")).join("")},parse:k=>{let e=k.slice(2);return Uint8Array.from({length:e.length/2},(I,B)=>parseInt(e.substring(B*2,(B+1)*2),16))}}},Se=pn($e$1),ln=Se.parsers,cn=Se.serializers;function ue$1(k,e,I){if(k===null)return null;let B=I?.[e]??Se.parsers[e];return B?B(k,e):k}function pn(k){return Object.keys(k).reduce(({parsers:e,serializers:I},B)=>{let{to:tr,from:rr,serialize:ir,parse:lr}=k[B];return I[tr]=ir,I[B]=ir,e[B]=lr,Array.isArray(rr)?rr.forEach(dr=>{e[dr]=lr,I[dr]=ir}):(e[rr]=lr,I[rr]=ir),{parsers:e,serializers:I}},{parsers:{},serializers:{}})}var dn=/\\/g,fn=/"/g;function mn(k){return k.replace(dn,"\\\\").replace(fn,'\\"')}function Ke$1(k,e,I){if(Array.isArray(k)===!1)return k;if(!k.length)return"{}";let B=k[0],tr=I===1020?";":",";return Array.isArray(B)?`{${k.map(rr=>Ke$1(rr,e,I)).join(tr)}}`:`{${k.map(rr=>(rr===void 0&&(rr=null),rr===null?"null":'"'+mn(e?e(rr):rr.toString())+'"')).join(tr)}}`}var he={i:0,char:null,str:"",quoted:!1,last:0,p:null};function yn(k,e,I){return he.i=he.last=0,Je$1(he,k,e,I)[0]}function Je$1(k,e,I,B){let tr=[],rr=B===1020?";":",";for(;k.i<e.length;k.i++){if(k.char=e[k.i],k.quoted)k.char==="\\"?k.str+=e[++k.i]:k.char==='"'?(tr.push(I?I(k.str):k.str),k.str="",k.quoted=e[k.i+1]==='"',k.last=k.i+2):k.str+=k.char;else if(k.char==='"')k.quoted=!0;else if(k.char==="{")k.last=++k.i,tr.push(Je$1(k,e,I,B));else if(k.char==="}"){k.quoted=!1,k.last<k.i&&tr.push(I?I(e.slice(k.last,k.i)):e.slice(k.last,k.i)),k.last=k.i+1;break}else k.char===rr&&k.p!=="}"&&k.p!=='"'&&(tr.push(I?I(e.slice(k.last,k.i)):e.slice(k.last,k.i)),k.last=k.i+1);k.p=k.char}return k.last<k.i&&tr.push(I?I(e.slice(k.last,k.i+1)):e.slice(k.last,k.i+1)),tr}var wn={};F$1(wn,{parseDescribeStatementResults:()=>De$1,parseResults:()=>bn});u$1();function bn(k,e,I,B){let tr=[],rr={rows:[],fields:[]},ir=0,lr={...e,...I?.parsers};return k.forEach(dr=>{switch(dr.name){case"rowDescription":{let mr=dr;rr.fields=mr.fields.map(hr=>({name:hr.name,dataTypeID:hr.dataTypeID}));break}case"dataRow":{if(!rr)break;let mr=dr;I?.rowMode==="array"?rr.rows.push(mr.fields.map((hr,fr)=>ue$1(hr,rr.fields[fr].dataTypeID,lr))):rr.rows.push(Object.fromEntries(mr.fields.map((hr,fr)=>[rr.fields[fr].name,ue$1(hr,rr.fields[fr].dataTypeID,lr)])));break}case"commandComplete":{ir+=gn(dr),tr.push({...rr,affectedRows:ir,...B?{blob:B}:{}}),rr={rows:[],fields:[]};break}}}),tr.length===0&&tr.push({affectedRows:0,rows:[],fields:[]}),tr}function gn(k){let e=k.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":case"COPY":return parseInt(e[1],10);default:return 0}}function De$1(k){let e=k.find(I=>I.name==="parameterDescription");return e?e.dataTypeIDs:[]}var Ue$1={};F$1(Ue$1,{AuthenticationCleartextPassword:()=>v,AuthenticationMD5Password:()=>G,AuthenticationOk:()=>F,AuthenticationSASL:()=>j$1,AuthenticationSASLContinue:()=>Q$1,AuthenticationSASLFinal:()=>W,BackendKeyDataMessage:()=>K$1,CommandCompleteMessage:()=>Z$1,CopyDataMessage:()=>_,CopyResponse:()=>z$1,DataRowMessage:()=>ee$1,DatabaseError:()=>E,Field:()=>H$2,NoticeMessage:()=>te$1,NotificationResponseMessage:()=>J$1,ParameterDescriptionMessage:()=>Y$1,ParameterStatusMessage:()=>$$1,ReadyForQueryMessage:()=>X$1,RowDescriptionMessage:()=>q,bindComplete:()=>Ie,closeComplete:()=>Me,copyDone:()=>Pe$1,emptyQuery:()=>Ce,noData:()=>Re$1,parseComplete:()=>Be,portalSuspended:()=>Te$1,replicationStart:()=>Ee});u$1();var Be={name:"parseComplete",length:5},Ie={name:"bindComplete",length:5},Me={name:"closeComplete",length:5},Re$1={name:"noData",length:5},Te$1={name:"portalSuspended",length:5},Ee={name:"replicationStart",length:4},Ce={name:"emptyQuery",length:4},Pe$1={name:"copyDone",length:4},F=class{constructor(k){this.length=k,this.name="authenticationOk"}},v=class{constructor(k){this.length=k,this.name="authenticationCleartextPassword"}},G=class{constructor(k,e){this.length=k,this.salt=e,this.name="authenticationMD5Password"}},j$1=class{constructor(e,I){this.length=e,this.mechanisms=I,this.name="authenticationSASL"}},Q$1=class{constructor(e,I){this.length=e,this.data=I,this.name="authenticationSASLContinue"}},W=class{constructor(k,e){this.length=k,this.data=e,this.name="authenticationSASLFinal"}},E=class extends Error{constructor(k,e,I){super(k),this.length=e,this.name=I}},_=class{constructor(k,e){this.length=k,this.chunk=e,this.name="copyData"}},z$1=class{constructor(e,I,B,tr){this.length=e,this.name=I,this.binary=B,this.columnTypes=new Array(tr)}},H$2=class{constructor(e,I,B,tr,rr,ir,lr){this.name=e,this.tableID=I,this.columnID=B,this.dataTypeID=tr,this.dataTypeSize=rr,this.dataTypeModifier=ir,this.format=lr}},q=class{constructor(k,e){this.length=k,this.fieldCount=e,this.name="rowDescription",this.fields=new Array(this.fieldCount)}},Y$1=class{constructor(e,I){this.length=e,this.parameterCount=I,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}},$$1=class{constructor(e,I,B){this.length=e,this.parameterName=I,this.parameterValue=B,this.name="parameterStatus"}},K$1=class{constructor(e,I,B){this.length=e,this.processID=I,this.secretKey=B,this.name="backendKeyData"}},J$1=class{constructor(e,I,B,tr){this.length=e,this.processId=I,this.channel=B,this.payload=tr,this.name="notification"}},X$1=class{constructor(e,I){this.length=e,this.status=I,this.name="readyForQuery"}},Z$1=class{constructor(e,I){this.length=e,this.text=I,this.name="commandComplete"}},ee$1=class{constructor(e,I){this.length=e,this.fields=I,this.name="dataRow",this.fieldCount=I.length}},te$1=class{constructor(e,I){this.length=e,this.message=I,this.name="notice"}},zn={};F$1(zn,{Parser:()=>ye,messages:()=>Ue$1,serialize:()=>O});u$1();u$1();u$1();u$1();function C$1(k){let e=k.length;for(let I=k.length-1;I>=0;I--){let B=k.charCodeAt(I);B>127&&B<=2047?e++:B>2047&&B<=65535&&(e+=2),B>=56320&&B<=57343&&I--}return e}var b$1,g$2,U,ce$1,N,x$1,le$1,P,Xe,R$1=class{constructor(e=256){this.size=e,R$2(this,x$1),R$2(this,b$1),R$2(this,g$2,5),R$2(this,U,!1),R$2(this,ce$1,new TextEncoder),R$2(this,N,0),x$2(this,b$1,T$1(this,x$1,le$1).call(this,e))}addInt32(e){return T$1(this,x$1,P).call(this,4),h$1(this,b$1).setInt32(h$1(this,g$2),e,h$1(this,U)),x$2(this,g$2,h$1(this,g$2)+4),this}addInt16(e){return T$1(this,x$1,P).call(this,2),h$1(this,b$1).setInt16(h$1(this,g$2),e,h$1(this,U)),x$2(this,g$2,h$1(this,g$2)+2),this}addCString(e){return e&&this.addString(e),T$1(this,x$1,P).call(this,1),h$1(this,b$1).setUint8(h$1(this,g$2),0),U$1(this,g$2)._++,this}addString(e=""){let I=C$1(e);return T$1(this,x$1,P).call(this,I),h$1(this,ce$1).encodeInto(e,new Uint8Array(h$1(this,b$1).buffer,h$1(this,g$2))),x$2(this,g$2,h$1(this,g$2)+I),this}add(e){return T$1(this,x$1,P).call(this,e.byteLength),new Uint8Array(h$1(this,b$1).buffer).set(new Uint8Array(e),h$1(this,g$2)),x$2(this,g$2,h$1(this,g$2)+e.byteLength),this}flush(e){let I=T$1(this,x$1,Xe).call(this,e);return x$2(this,g$2,5),x$2(this,b$1,T$1(this,x$1,le$1).call(this,this.size)),new Uint8Array(I)}};b$1=new WeakMap,g$2=new WeakMap,U=new WeakMap,ce$1=new WeakMap,N=new WeakMap,x$1=new WeakSet,le$1=function(k){return new DataView(new ArrayBuffer(k))},P=function(k){if(h$1(this,b$1).byteLength-h$1(this,g$2)<k){let e=h$1(this,b$1).buffer,I=e.byteLength+(e.byteLength>>1)+k;x$2(this,b$1,T$1(this,x$1,le$1).call(this,I)),new Uint8Array(h$1(this,b$1).buffer).set(new Uint8Array(e))}},Xe=function(k){if(k){h$1(this,b$1).setUint8(h$1(this,N),k);let e=h$1(this,g$2)-(h$1(this,N)+1);h$1(this,b$1).setInt32(h$1(this,N)+1,e,h$1(this,U))}return h$1(this,b$1).buffer.slice(k?0:5,h$1(this,g$2))};var m=new R$1,An=k=>{m.addInt16(3).addInt16(0);for(let B of Object.keys(k))m.addCString(B).addCString(k[B]);m.addCString("client_encoding").addCString("UTF8");let e=m.addCString("").flush(),I=e.byteLength+4;return new R$1().addInt32(I).add(e).flush()},xn=()=>{let k=new DataView(new ArrayBuffer(8));return k.setInt32(0,8,!1),k.setInt32(4,80877103,!1),new Uint8Array(k.buffer)},Sn=k=>m.addCString(k).flush(112),Dn=(k,e)=>(m.addCString(k).addInt32(C$1(e)).addString(e),m.flush(112)),Bn=k=>m.addString(k).flush(112),In=k=>m.addCString(k).flush(81),Mn=[],Rn=k=>{let e=k.name??"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let I=m.addCString(e).addCString(k.text).addInt16(k.types?.length??0);return k.types?.forEach(B=>I.addInt32(B)),m.flush(80)},L$1=new R$1,Tn=(k,e)=>{for(let I=0;I<k.length;I++){let B=e?e(k[I],I):k[I];if(B===null)m.addInt16(0),L$1.addInt32(-1);else if(B instanceof ArrayBuffer||ArrayBuffer.isView(B)){let tr=ArrayBuffer.isView(B)?B.buffer.slice(B.byteOffset,B.byteOffset+B.byteLength):B;m.addInt16(1),L$1.addInt32(tr.byteLength),L$1.add(tr)}else m.addInt16(0),L$1.addInt32(C$1(B)),L$1.addString(B)}},En=(k={})=>{let e=k.portal??"",I=k.statement??"",B=k.binary??!1,tr=k.values??Mn,rr=tr.length;return m.addCString(e).addCString(I),m.addInt16(rr),Tn(tr,k.valueMapper),m.addInt16(rr),m.add(L$1.flush()),m.addInt16(B?1:0),m.flush(66)},Cn=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),Pn=k=>{if(!k||!k.portal&&!k.rows)return Cn;let e=k.portal??"",I=k.rows??0,B=C$1(e),tr=4+B+1+4,rr=new DataView(new ArrayBuffer(1+tr));return rr.setUint8(0,69),rr.setInt32(1,tr,!1),new TextEncoder().encodeInto(e,new Uint8Array(rr.buffer,5)),rr.setUint8(B+5,0),rr.setUint32(rr.byteLength-4,I,!1),new Uint8Array(rr.buffer)},Un=(k,e)=>{let I=new DataView(new ArrayBuffer(16));return I.setInt32(0,16,!1),I.setInt16(4,1234,!1),I.setInt16(6,5678,!1),I.setInt32(8,k,!1),I.setInt32(12,e,!1),new Uint8Array(I.buffer)},Ne$1=(k,e)=>{let I=new R$1;return I.addCString(e),I.flush(k)},Nn=m.addCString("P").flush(68),Ln=m.addCString("S").flush(68),On=k=>k.name?Ne$1(68,`${k.type}${k.name??""}`):k.type==="P"?Nn:Ln,kn=k=>{let e=`${k.type}${k.name??""}`;return Ne$1(67,e)},Vn=k=>m.add(k).flush(100),Fn=k=>Ne$1(102,k),pe$1=k=>new Uint8Array([k,0,0,0,4]),vn=pe$1(72),Gn=pe$1(83),jn=pe$1(88),Qn=pe$1(99),O={startup:An,password:Sn,requestSsl:xn,sendSASLInitialResponseMessage:Dn,sendSCRAMClientFinalMessage:Bn,query:In,parse:Rn,bind:En,execute:Pn,describe:On,close:kn,flush:()=>vn,sync:()=>Gn,end:()=>jn,copyData:Vn,copyDone:()=>Qn,copyFail:Fn,cancel:Un};u$1();u$1();var Le={text:0,binary:1};u$1();var Wn=new ArrayBuffer(0),M,w$2,fe$1,me$1,ne,de$1=class{constructor(e=0){R$2(this,M,new DataView(Wn)),R$2(this,w$2),R$2(this,fe$1,"utf-8"),R$2(this,me$1,new TextDecoder(h$1(this,fe$1))),R$2(this,ne,!1),x$2(this,w$2,e)}setBuffer(e,I){x$2(this,w$2,e),x$2(this,M,new DataView(I))}int16(){let e=h$1(this,M).getInt16(h$1(this,w$2),h$1(this,ne));return x$2(this,w$2,h$1(this,w$2)+2),e}byte(){let e=h$1(this,M).getUint8(h$1(this,w$2));return U$1(this,w$2)._++,e}int32(){let e=h$1(this,M).getInt32(h$1(this,w$2),h$1(this,ne));return x$2(this,w$2,h$1(this,w$2)+4),e}string(e){return h$1(this,me$1).decode(this.bytes(e))}cstring(){let e=h$1(this,w$2),I=e;for(;h$1(this,M).getUint8(I++)!==0;);let B=this.string(I-e-1);return x$2(this,w$2,I),B}bytes(e){let I=h$1(this,M).buffer.slice(h$1(this,w$2),h$1(this,w$2)+e);return x$2(this,w$2,h$1(this,w$2)+e),new Uint8Array(I)}};M=new WeakMap,w$2=new WeakMap,fe$1=new WeakMap,me$1=new WeakMap,ne=new WeakMap;var Oe=1,_n=4,Ze$1=Oe+_n,et=new ArrayBuffer(0),A$1,S,D,o$1,l$1,tt,nt,rt,st,it,at,ot,ke$1,ut,lt,ct,pt,dt,ft,mt,yt,Ve,ye=class{constructor(){R$2(this,l$1),R$2(this,A$1,new DataView(et)),R$2(this,S,0),R$2(this,D,0),R$2(this,o$1,new de$1)}parse(k,e){T$1(this,l$1,tt).call(this,ArrayBuffer.isView(k)?k.buffer.slice(k.byteOffset,k.byteOffset+k.byteLength):k);let I=h$1(this,D)+h$1(this,S),B=h$1(this,D);for(;B+Ze$1<=I;){let tr=h$1(this,A$1).getUint8(B),rr=h$1(this,A$1).getUint32(B+Oe,!1),ir=Oe+rr;if(ir+B<=I){let lr=T$1(this,l$1,nt).call(this,B+Ze$1,tr,rr,h$1(this,A$1).buffer);e(lr),B+=ir}else break}B===I?(x$2(this,A$1,new DataView(et)),x$2(this,S,0),x$2(this,D,0)):(x$2(this,S,I-B),x$2(this,D,B))}};A$1=new WeakMap,S=new WeakMap,D=new WeakMap,o$1=new WeakMap,l$1=new WeakSet,tt=function(k){if(h$1(this,S)>0){let e=h$1(this,S)+k.byteLength;if(e+h$1(this,D)>h$1(this,A$1).byteLength){let I;if(e<=h$1(this,A$1).byteLength&&h$1(this,D)>=h$1(this,S))I=h$1(this,A$1).buffer;else{let B=h$1(this,A$1).byteLength*2;for(;e>=B;)B*=2;I=new ArrayBuffer(B)}new Uint8Array(I).set(new Uint8Array(h$1(this,A$1).buffer,h$1(this,D),h$1(this,S))),x$2(this,A$1,new DataView(I)),x$2(this,D,0)}new Uint8Array(h$1(this,A$1).buffer).set(new Uint8Array(k),h$1(this,D)+h$1(this,S)),x$2(this,S,e)}else x$2(this,A$1,new DataView(k)),x$2(this,D,0),x$2(this,S,k.byteLength)},nt=function(k,e,I,B){switch(e){case 50:return Ie;case 49:return Be;case 51:return Me;case 110:return Re$1;case 115:return Te$1;case 99:return Pe$1;case 87:return Ee;case 73:return Ce;case 68:return T$1(this,l$1,dt).call(this,k,I,B);case 67:return T$1(this,l$1,st).call(this,k,I,B);case 90:return T$1(this,l$1,rt).call(this,k,I,B);case 65:return T$1(this,l$1,ut).call(this,k,I,B);case 82:return T$1(this,l$1,yt).call(this,k,I,B);case 83:return T$1(this,l$1,ft).call(this,k,I,B);case 75:return T$1(this,l$1,mt).call(this,k,I,B);case 69:return T$1(this,l$1,Ve).call(this,k,I,B,"error");case 78:return T$1(this,l$1,Ve).call(this,k,I,B,"notice");case 84:return T$1(this,l$1,lt).call(this,k,I,B);case 116:return T$1(this,l$1,pt).call(this,k,I,B);case 71:return T$1(this,l$1,at).call(this,k,I,B);case 72:return T$1(this,l$1,ot).call(this,k,I,B);case 100:return T$1(this,l$1,it).call(this,k,I,B);default:return new E("received invalid response: "+e.toString(16),I,"error")}},rt=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).string(1);return new X$1(e,B)},st=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).cstring();return new Z$1(e,B)},it=function(k,e,I){let B=I.slice(k,k+(e-4));return new _(e,new Uint8Array(B))},at=function(k,e,I){return T$1(this,l$1,ke$1).call(this,k,e,I,"copyInResponse")},ot=function(k,e,I){return T$1(this,l$1,ke$1).call(this,k,e,I,"copyOutResponse")},ke$1=function(k,e,I,B){h$1(this,o$1).setBuffer(k,I);let tr=h$1(this,o$1).byte()!==0,rr=h$1(this,o$1).int16(),ir=new z$1(e,B,tr,rr);for(let lr=0;lr<rr;lr++)ir.columnTypes[lr]=h$1(this,o$1).int16();return ir},ut=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).int32(),tr=h$1(this,o$1).cstring(),rr=h$1(this,o$1).cstring();return new J$1(e,B,tr,rr)},lt=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).int16(),tr=new q(e,B);for(let rr=0;rr<B;rr++)tr.fields[rr]=T$1(this,l$1,ct).call(this);return tr},ct=function(){let k=h$1(this,o$1).cstring(),e=h$1(this,o$1).int32(),I=h$1(this,o$1).int16(),B=h$1(this,o$1).int32(),tr=h$1(this,o$1).int16(),rr=h$1(this,o$1).int32(),ir=h$1(this,o$1).int16()===0?Le.text:Le.binary;return new H$2(k,e,I,B,tr,rr,ir)},pt=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).int16(),tr=new Y$1(e,B);for(let rr=0;rr<B;rr++)tr.dataTypeIDs[rr]=h$1(this,o$1).int32();return tr},dt=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).int16(),tr=new Array(B);for(let rr=0;rr<B;rr++){let ir=h$1(this,o$1).int32();tr[rr]=ir===-1?null:h$1(this,o$1).string(ir)}return new ee$1(e,tr)},ft=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).cstring(),tr=h$1(this,o$1).cstring();return new $$1(e,B,tr)},mt=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).int32(),tr=h$1(this,o$1).int32();return new K$1(e,B,tr)},yt=function(k,e,I){h$1(this,o$1).setBuffer(k,I);let B=h$1(this,o$1).int32();switch(B){case 0:return new F(e);case 3:return new v(e);case 5:return new G(e,h$1(this,o$1).bytes(4));case 10:{let tr=[];for(;;){let rr=h$1(this,o$1).cstring();if(rr.length===0)return new j$1(e,tr);tr.push(rr)}}case 11:return new Q$1(e,h$1(this,o$1).string(e-8));case 12:return new W(e,h$1(this,o$1).string(e-8));default:throw new Error("Unknown authenticationOk message type "+B)}},Ve=function(k,e,I,B){h$1(this,o$1).setBuffer(k,I);let tr={},rr=h$1(this,o$1).string(1);for(;rr!=="\0";)tr[rr]=h$1(this,o$1).cstring(),rr=h$1(this,o$1).string(1);let ir=tr.M,lr=B==="notice"?new te$1(e,ir):new E(ir,e,B);return lr.severity=tr.S,lr.code=tr.C,lr.detail=tr.D,lr.hint=tr.H,lr.position=tr.P,lr.internalPosition=tr.p,lr.internalQuery=tr.q,lr.where=tr.W,lr.schema=tr.s,lr.table=tr.t,lr.column=tr.c,lr.dataType=tr.d,lr.constraint=tr.n,lr.file=tr.F,lr.line=tr.L,lr.routine=tr.R,lr};u$1();var Fe=typeof process$1=="object"&&typeof process$1.versions=="object"&&typeof process$1.versions.node=="string",se$1;async function Rr(){if(Fe||se$1)return;let k=new URL("/NoLLMChat/assets/pglite-DlIz6flT.wasm",import.meta.url);se$1=fetch(k)}var re$1;async function Tr(k,e){if(e||re$1)return{instance:await WebAssembly.instantiate(e||re$1,k),module:e||re$1};let I=new URL("/NoLLMChat/assets/pglite-DlIz6flT.wasm",import.meta.url);if(Fe){let B=await(await import("./__vite-browser-external-9wXp6ZBx.js")).readFile(I),{module:tr,instance:rr}=await WebAssembly.instantiate(B,k);return re$1=tr,{instance:rr,module:tr}}else{se$1||(se$1=fetch(I));let B=await se$1,{module:tr,instance:rr}=await WebAssembly.instantiateStreaming(B,k);return re$1=tr,{instance:rr,module:tr}}}async function Er(){let k=new URL("/NoLLMChat/assets/pglite-D9yzvjch.data",import.meta.url);return Fe?(await(await import("./__vite-browser-external-9wXp6ZBx.js")).readFile(k)).buffer:(await fetch(k)).arrayBuffer()}function Nr(k){let e;return k.startsWith('"')&&k.endsWith('"')?e=k.substring(1,k.length-1):e=k.toLowerCase(),e}u$1();var o={part:"part",container:"container"};function s(k,e,...I){let B=k.length-1,tr=I.length-1;if(tr!==-1){if(tr===0){k[B]=k[B]+I[0]+e;return}k[B]=k[B]+I[0],k.push(...I.slice(1,tr)),k.push(I[tr]+e)}}function y(k,...e){let I=[k[0]];I.raw=[k.raw[0]];let B=[];for(let tr=0;tr<e.length;tr++){let rr=e[tr],ir=tr+1;if(rr?._templateType===o.part){s(I,k[ir],rr.str),s(I.raw,k.raw[ir],rr.str);continue}if(rr?._templateType===o.container){s(I,k[ir],...rr.strings),s(I.raw,k.raw[ir],...rr.strings.raw),B.push(...rr.values);continue}I.push(k[ir]),I.raw.push(k.raw[ir]),B.push(rr)}return{_templateType:"container",strings:I,values:B}}function g$1(k,...e){let{strings:I,values:B}=y(k,...e);return{query:[I[0],...B.flatMap((tr,rr)=>[`$${rr+1}`,I[rr+1]])].join(""),params:B}}u$1();var b,u,r,l,w$1,h,R,z=class{constructor(){R$2(this,r),this.serializers={...cn},this.parsers={...ln},R$2(this,b,!1),R$2(this,u,!1)}async _initArrayTypes({force:k=!1}={}){if(h$1(this,b)&&!k)return;x$2(this,b,!0);let e=await this.query(`
      SELECT b.oid, b.typarray
      FROM pg_catalog.pg_type a
      LEFT JOIN pg_catalog.pg_type b ON b.oid = a.typelem
      WHERE a.typcategory = 'A'
      GROUP BY b.oid, b.typarray
      ORDER BY b.oid
    `);for(let I of e.rows)this.serializers[I.typarray]=B=>Ke$1(B,this.serializers[I.oid],I.typarray),this.parsers[I.typarray]=B=>yn(B,this.parsers[I.oid],I.typarray)}async refreshArrayTypes(){await this._initArrayTypes({force:!0})}async query(k,e,I){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await T$1(this,r,w$1).call(this,k,e,I))}async sql(k,...e){let{query:I,params:B}=g$1(k,...e);return await this.query(I,B)}async exec(k,e){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await T$1(this,r,h).call(this,k,e))}async describeQuery(k,e){try{await T$1(this,r,l).call(this,O.parse({text:k,types:e?.paramTypes}),e);let I=await T$1(this,r,l).call(this,O.describe({type:"S"}),e),B=I.messages.find(lr=>lr.name==="parameterDescription"),tr=I.messages.find(lr=>lr.name==="rowDescription"),rr=B?.dataTypeIDs.map(lr=>({dataTypeID:lr,serializer:this.serializers[lr]}))??[],ir=tr?.fields.map(lr=>({name:lr.name,dataTypeID:lr.dataTypeID,parser:this.parsers[lr.dataTypeID]}))??[];return{queryParams:rr,resultFields:ir}}finally{await T$1(this,r,l).call(this,O.sync(),e)}}async transaction(k){return await this._checkReady(),await this._runExclusiveTransaction(async()=>{await T$1(this,r,h).call(this,"BEGIN"),x$2(this,u,!0);let e=!1,I=()=>{if(e)throw new Error("Transaction is closed")},B={query:async(tr,rr,ir)=>(I(),await T$1(this,r,w$1).call(this,tr,rr,ir)),sql:async(tr,...rr)=>{let{query:ir,params:lr}=g$1(tr,...rr);return await T$1(this,r,w$1).call(this,ir,lr)},exec:async(tr,rr)=>(I(),await T$1(this,r,h).call(this,tr,rr)),rollback:async()=>{I(),await T$1(this,r,h).call(this,"ROLLBACK"),e=!0},listen:async(tr,rr)=>(I(),await this.listen(tr,rr,B)),get closed(){return e}};try{let tr=await k(B);return e||(e=!0,await T$1(this,r,h).call(this,"COMMIT")),x$2(this,u,!1),tr}catch(tr){throw e||await T$1(this,r,h).call(this,"ROLLBACK"),x$2(this,u,!1),tr}})}async runExclusive(k){return await this._runExclusiveQuery(k)}};b=new WeakMap,u=new WeakMap,r=new WeakSet,l=async function(k,e={}){return await this.execProtocol(k,{...e,syncToFs:!1})},w$1=async function(k,e=[],I){return await this._runExclusiveQuery(async()=>{T$1(this,r,R).call(this,"runQuery",k,e,I),await this._handleBlob(I?.blob);let B;try{let{messages:rr}=await T$1(this,r,l).call(this,O.parse({text:k,types:I?.paramTypes}),I),ir=De$1((await T$1(this,r,l).call(this,O.describe({type:"S"}),I)).messages),lr=e.map((dr,mr)=>{let hr=ir[mr];if(dr==null)return null;let fr=I?.serializers?.[hr]??this.serializers[hr];return fr?fr(dr):dr.toString()});B=[...rr,...(await T$1(this,r,l).call(this,O.bind({values:lr}),I)).messages,...(await T$1(this,r,l).call(this,O.describe({type:"P"}),I)).messages,...(await T$1(this,r,l).call(this,O.execute({}),I)).messages]}finally{await T$1(this,r,l).call(this,O.sync(),I)}await this._cleanupBlob(),h$1(this,u)||await this.syncToFs();let tr=await this._getWrittenBlob();return bn(B,this.parsers,I,tr)[0]})},h=async function(k,e){return await this._runExclusiveQuery(async()=>{T$1(this,r,R).call(this,"runExec",k,e),await this._handleBlob(e?.blob);let I;try{I=(await T$1(this,r,l).call(this,O.query(k),e)).messages}finally{await T$1(this,r,l).call(this,O.sync(),e)}this._cleanupBlob(),h$1(this,u)||await this.syncToFs();let B=await this._getWrittenBlob();return bn(I,this.parsers,e,B)})},R=function(...k){this.debug>0&&console.log(...k)};var w=D$1((k,e)=>{u$1();var I=9007199254740991,B=function(Fr){return Fr}();function tr(Fr){return Fr===B}function rr(Fr){return typeof Fr=="string"||Object.prototype.toString.call(Fr)=="[object String]"}function ir(Fr){return Object.prototype.toString.call(Fr)=="[object Date]"}function lr(Fr){return Fr!==null&&typeof Fr=="object"}function dr(Fr){return typeof Fr=="function"}function mr(Fr){return typeof Fr=="number"&&Fr>-1&&Fr%1==0&&Fr<=I}function hr(Fr){return Object.prototype.toString.call(Fr)=="[object Array]"}function fr(Fr){return lr(Fr)&&!dr(Fr)&&mr(Fr.length)}function _r(Fr){return Object.prototype.toString.call(Fr)=="[object ArrayBuffer]"}function gr(Fr,vr){return Array.prototype.map.call(Fr,vr)}function Sr(Fr,vr){var xr=B;return dr(vr)&&Array.prototype.every.call(Fr,function(kr,Gr,is){var as=vr(kr,Gr,is);return as&&(xr=kr),!as}),xr}function Ar(Fr){return Object.assign.apply(null,arguments)}function Or(Fr){var vr,xr,kr;if(rr(Fr)){for(xr=Fr.length,kr=new Uint8Array(xr),vr=0;vr<xr;vr++)kr[vr]=Fr.charCodeAt(vr)&255;return kr}return _r(Fr)?new Uint8Array(Fr):lr(Fr)&&_r(Fr.buffer)?new Uint8Array(Fr.buffer):fr(Fr)?new Uint8Array(Fr):lr(Fr)&&dr(Fr.toString)?Or(Fr.toString()):new Uint8Array}e.exports.MAX_SAFE_INTEGER=I,e.exports.isUndefined=tr,e.exports.isString=rr,e.exports.isObject=lr,e.exports.isDateTime=ir,e.exports.isFunction=dr,e.exports.isArray=hr,e.exports.isArrayLike=fr,e.exports.isArrayBuffer=_r,e.exports.map=gr,e.exports.find=Sr,e.exports.extend=Ar,e.exports.toUint8Array=Or}),x=D$1((k,e)=>{u$1();var I="\0";e.exports={NULL_CHAR:I,TMAGIC:"ustar"+I+"00",OLDGNU_MAGIC:"ustar  "+I,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}}),L=D$1((k,e)=>{u$1();var I=w(),B=x(),tr=512,rr=B.TPERMALL,ir=0,lr=0,dr=[["name",100,0,function(vr,xr){return fr(vr[xr[0]],xr[1])},function(vr,xr,kr){return Sr(vr.slice(xr,xr+kr[1]))}],["mode",8,100,function(vr,xr){var kr=vr[xr[0]]||rr;return kr=kr&B.TPERMMASK,_r(kr,xr[1],rr)},function(vr,xr,kr){var Gr=Ar(vr.slice(xr,xr+kr[1]));return Gr&=B.TPERMMASK,Gr}],["uid",8,108,function(vr,xr){return _r(vr[xr[0]],xr[1],ir)},function(vr,xr,kr){return Ar(vr.slice(xr,xr+kr[1]))}],["gid",8,116,function(vr,xr){return _r(vr[xr[0]],xr[1],lr)},function(vr,xr,kr){return Ar(vr.slice(xr,xr+kr[1]))}],["size",12,124,function(vr,xr){return _r(vr.data.length,xr[1])},function(vr,xr,kr){return Ar(vr.slice(xr,xr+kr[1]))}],["modifyTime",12,136,function(vr,xr){return gr(vr[xr[0]],xr[1])},function(vr,xr,kr){return Or(vr.slice(xr,xr+kr[1]))}],["checksum",8,148,function(vr,xr){return"        "},function(vr,xr,kr){return Ar(vr.slice(xr,xr+kr[1]))}],["type",1,156,function(vr,xr){return""+(parseInt(vr[xr[0]],10)||0)%8},function(vr,xr,kr){return(parseInt(String.fromCharCode(vr[xr]),10)||0)%8}],["linkName",100,157,function(vr,xr){return""},function(vr,xr,kr){return Sr(vr.slice(xr,xr+kr[1]))}],["ustar",8,257,function(vr,xr){return B.TMAGIC},function(vr,xr,kr){return hr(Sr(vr.slice(xr,xr+kr[1]),!0))},function(vr,xr){return vr[xr[0]]==B.TMAGIC||vr[xr[0]]==B.OLDGNU_MAGIC}],["owner",32,265,function(vr,xr){return fr(vr[xr[0]],xr[1])},function(vr,xr,kr){return Sr(vr.slice(xr,xr+kr[1]))}],["group",32,297,function(vr,xr){return fr(vr[xr[0]],xr[1])},function(vr,xr,kr){return Sr(vr.slice(xr,xr+kr[1]))}],["majorNumber",8,329,function(vr,xr){return""},function(vr,xr,kr){return Ar(vr.slice(xr,xr+kr[1]))}],["minorNumber",8,337,function(vr,xr){return""},function(vr,xr,kr){return Ar(vr.slice(xr,xr+kr[1]))}],["prefix",131,345,function(vr,xr){return fr(vr[xr[0]],xr[1])},function(vr,xr,kr){return Sr(vr.slice(xr,xr+kr[1]))}],["accessTime",12,476,function(vr,xr){return gr(vr[xr[0]],xr[1])},function(vr,xr,kr){return Or(vr.slice(xr,xr+kr[1]))}],["createTime",12,488,function(vr,xr){return gr(vr[xr[0]],xr[1])},function(vr,xr,kr){return Or(vr.slice(xr,xr+kr[1]))}]],mr=function(vr){var xr=vr[vr.length-1];return xr[2]+xr[1]}(dr);function hr(vr){if(vr.length==8){var xr=vr.split("");if(xr[5]==B.NULL_CHAR)return(xr[6]==" "||xr[6]==B.NULL_CHAR)&&(xr[6]="0"),(xr[7]==" "||xr[7]==B.NULL_CHAR)&&(xr[7]="0"),xr=xr.join(""),xr==B.TMAGIC?xr:vr;if(xr[7]==B.NULL_CHAR)return xr[5]==B.NULL_CHAR&&(xr[5]=" "),xr[6]==B.NULL_CHAR&&(xr[6]=" "),xr==B.OLDGNU_MAGIC?xr:vr}return vr}function fr(vr,xr){return xr-=1,I.isUndefined(vr)&&(vr=""),vr=(""+vr).substr(0,xr),vr+B.NULL_CHAR}function _r(vr,xr,kr){for(kr=parseInt(kr)||0,xr-=1,vr=(parseInt(vr)||kr).toString(8).substr(-xr,xr);vr.length<xr;)vr="0"+vr;return vr+B.NULL_CHAR}function gr(vr,xr){if(I.isDateTime(vr))vr=Math.floor(1*vr/1e3);else if(vr=parseInt(vr,10),isFinite(vr)){if(vr<=0)return""}else vr=Math.floor(1*new Date/1e3);return _r(vr,xr,0)}function Sr(vr,xr){var kr=String.fromCharCode.apply(null,vr);if(xr)return kr;var Gr=kr.indexOf(B.NULL_CHAR);return Gr>=0?kr.substr(0,Gr):kr}function Ar(vr){var xr=String.fromCharCode.apply(null,vr);return parseInt(xr.replace(/^0+$/g,""),8)||0}function Or(vr){return vr.length==0||vr[0]==0?null:new Date(1e3*Ar(vr))}function Fr(vr,xr,kr){var Gr=parseInt(xr,10)||0,is=Math.min(Gr+mr,vr.length),as=0,cs=0,es=0;kr&&dr.every(function(ts){return ts[0]=="checksum"?(cs=Gr+ts[2],es=cs+ts[1],!1):!0});for(var ps=32,Ur=Gr;Ur<is;Ur++){var Lr=Ur>=cs&&Ur<es?ps:vr[Ur];as=(as+Lr)%262144}return as}e.exports.recordSize=tr,e.exports.defaultFileMode=rr,e.exports.defaultUid=ir,e.exports.defaultGid=lr,e.exports.posixHeader=dr,e.exports.effectiveHeaderSize=mr,e.exports.calculateChecksum=Fr,e.exports.formatTarString=fr,e.exports.formatTarNumber=_r,e.exports.formatTarDateTime=gr,e.exports.parseTarString=Sr,e.exports.parseTarNumber=Ar,e.exports.parseTarDateTime=Or}),er=D$1((k,e)=>{u$1();var I=x(),B=w(),tr=L();function rr(fr){return tr.recordSize}function ir(fr){return Math.ceil(fr.data.length/tr.recordSize)*tr.recordSize}function lr(fr){var _r=0;return fr.forEach(function(gr){_r+=rr()+ir(gr)}),_r+=tr.recordSize*2,new Uint8Array(_r)}function dr(fr,_r,gr){gr=parseInt(gr)||0;var Sr=gr;tr.posixHeader.forEach(function(xr){for(var kr=xr[3](_r,xr),Gr=kr.length,is=0;is<Gr;is+=1)fr[Sr+is]=kr.charCodeAt(is)&255;Sr+=xr[1]});var Ar=B.find(tr.posixHeader,function(xr){return xr[0]=="checksum"});if(Ar){var Or=tr.calculateChecksum(fr,gr,!0),Fr=tr.formatTarNumber(Or,Ar[1]-2)+I.NULL_CHAR+" ";Sr=gr+Ar[2];for(var vr=0;vr<Fr.length;vr+=1)fr[Sr]=Fr.charCodeAt(vr)&255,Sr++}return gr+rr()}function mr(fr,_r,gr){return gr=parseInt(gr,10)||0,fr.set(_r.data,gr),gr+ir(_r)}function hr(fr){fr=B.map(fr,function(Sr){return B.extend({},Sr,{data:B.toUint8Array(Sr.data)})});var _r=lr(fr),gr=0;return fr.forEach(function(Sr){gr=dr(_r,Sr,gr),gr=mr(_r,Sr,gr)}),_r}e.exports.tar=hr}),nr=D$1((k,e)=>{u$1();var I=x(),B=w(),tr=L(),rr={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},ir={size:!0,checksum:!0,ustar:!0},lr={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function dr(Ar){return tr.recordSize}function mr(Ar){return Math.ceil(Ar/tr.recordSize)*tr.recordSize}function hr(Ar,Or){for(var Fr=Or,vr=Math.min(Ar.length,Or+tr.recordSize*2),xr=Fr;xr<vr;xr++)if(Ar[xr]!=0)return!1;return!0}function fr(Ar,Or,Fr){if(Ar.length-Or<tr.recordSize){if(Fr.checkFileSize)throw new Error(lr.unexpectedEndOfFile);return null}Or=parseInt(Or)||0;var vr={},xr=Or;if(tr.posixHeader.forEach(function(is){vr[is[0]]=is[4](Ar,xr,is),xr+=is[1]}),vr.type!=0&&(vr.size=0),Fr.checkHeader&&tr.posixHeader.forEach(function(is){if(B.isFunction(is[5])&&!is[5](vr,is)){var as=new Error(lr.fileCorrupted);throw as.data={offset:Or+is[2],field:is[0]},as}}),Fr.checkChecksum){var kr=tr.calculateChecksum(Ar,Or,!0);if(kr!=vr.checksum){var Gr=new Error(lr.checksumCheckFailed);throw Gr.data={offset:Or,header:vr,checksum:kr},Gr}}return vr}function _r(Ar,Or,Fr,vr){return vr.extractData?Fr.size<=0?new Uint8Array:Ar.slice(Or,Or+Fr.size):null}function gr(Ar,Or){var Fr={};return tr.posixHeader.forEach(function(vr){var xr=vr[0];ir[xr]||(Fr[xr]=Ar[xr])}),Fr.isOldGNUFormat=Ar.ustar==I.OLDGNU_MAGIC,Or&&(Fr.data=Or),Fr}function Sr(Ar,Or){Or=B.extend({},rr,Or);for(var Fr=[],vr=0,xr=Ar.length;xr-vr>=tr.recordSize;){Ar=B.toUint8Array(Ar);var kr=fr(Ar,vr,Or);if(!kr)break;vr+=dr();var Gr=_r(Ar,vr,kr,Or);if(Fr.push(gr(kr,Gr)),vr+=mr(kr.size),hr(Ar,vr))break}return Fr}e.exports.untar=Sr}),or=D$1((k,e)=>{u$1();var I=w(),B=x(),tr=er(),rr=nr();I.extend(e.exports,tr,rr,B)});u$1();u$1();var g=L$2(or());async function H$1(k,e,I="pgdata",B="auto"){let tr=Br(k,e),[rr,ir]=await qr(tr,B),lr=I+(ir?".tar.gz":".tar"),dr=ir?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([rr],lr,{type:dr}):new Blob([rr],{type:dr})}var Hr=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"];async function ce(k,e,I){let B=new Uint8Array(await e.arrayBuffer()),tr=typeof File<"u"&&e instanceof File?e.name:void 0;(Hr.includes(e.type)||tr?.endsWith(".tgz")||tr?.endsWith(".tar.gz"))&&(B=await ar(B));let rr;try{rr=(0,g.untar)(B)}catch(ir){if(ir instanceof Error&&ir.message.includes("File is corrupted"))B=await ar(B),rr=(0,g.untar)(B);else throw ir}for(let ir of rr){let lr=I+ir.name,dr=lr.split("/").slice(0,-1);for(let mr=1;mr<=dr.length;mr++){let hr=dr.slice(0,mr).join("/");k.analyzePath(hr).exists||k.mkdir(hr)}ir.type===g.REGTYPE?(k.writeFile(lr,ir.data),k.utime(lr,sr(ir.modifyTime),sr(ir.modifyTime))):ir.type===g.DIRTYPE&&k.mkdir(lr)}}function jr(k,e){let I=[],B=tr=>{k.readdir(tr).forEach(rr=>{if(rr==="."||rr==="..")return;let ir=tr+"/"+rr,lr=k.stat(ir),dr=k.isFile(lr.mode)?k.readFile(ir,{encoding:"binary"}):new Uint8Array(0);I.push({name:ir.substring(e.length),mode:lr.mode,size:lr.size,type:k.isFile(lr.mode)?g.REGTYPE:g.DIRTYPE,modifyTime:lr.mtime,data:dr}),k.isDir(lr.mode)&&B(ir)})};return B(e),I}function Br(k,e){let I=jr(k,e);return(0,g.tar)(I)}async function qr(k,e="auto"){if(e==="none")return[k,!1];if(typeof CompressionStream<"u")return[await Yr(k),!0];if(typeof process$1<"u"&&process$1.versions&&process$1.versions.node)return[await Wr(k),!0];if(e==="auto")return[k,!1];throw new Error("Compression not supported in this environment")}async function Yr(k){let e=new CompressionStream("gzip"),I=e.writable.getWriter(),B=e.readable.getReader();I.write(k),I.close();let tr=[];for(;;){let{value:lr,done:dr}=await B.read();if(dr)break;lr&&tr.push(lr)}let rr=new Uint8Array(tr.reduce((lr,dr)=>lr+dr.length,0)),ir=0;return tr.forEach(lr=>{rr.set(lr,ir),ir+=lr.length}),rr}async function Wr(k){let{promisify:e}=await import("./__vite-browser-external-9wXp6ZBx.js"),{gzip:I}=await import("./__vite-browser-external-9wXp6ZBx.js");return await e(I)(k)}async function ar(k){if(typeof CompressionStream<"u")return await Xr(k);if(typeof process$1<"u"&&process$1.versions&&process$1.versions.node)return await Kr(k);throw new Error("Unsupported environment for decompression")}async function Xr(k){let e=new DecompressionStream("gzip"),I=e.writable.getWriter(),B=e.readable.getReader();I.write(k),I.close();let tr=[];for(;;){let{value:lr,done:dr}=await B.read();if(dr)break;lr&&tr.push(lr)}let rr=new Uint8Array(tr.reduce((lr,dr)=>lr+dr.length,0)),ir=0;return tr.forEach(lr=>{rr.set(lr,ir),ir+=lr.length}),rr}async function Kr(k){let{promisify:e}=await import("./__vite-browser-external-9wXp6ZBx.js"),{gunzip:I}=await import("./__vite-browser-external-9wXp6ZBx.js");return await e(I)(k)}function sr(k){return k?typeof k=="number"?k:Math.floor(k.getTime()/1e3):Math.floor(Date.now()/1e3)}var Vr="/tmp/pglite",C=Vr+"/base",ur=class{constructor(k){this.dataDir=k}async init(k,e){return this.pg=k,{emscriptenOpts:e}}async syncToFs(k){}async initialSyncFs(){}async closeFs(){}async dumpTar(k,e){return H$1(this.pg.Module.FS,C,k,e)}},cr=class{constructor(k,{debug:e=!1}={}){this.dataDir=k,this.debug=e}async syncToFs(k){}async initialSyncFs(){}async closeFs(){}async dumpTar(k,e){return H$1(this.pg.Module.FS,C,k,e)}async init(k,e){return this.pg=k,{emscriptenOpts:{...e,preRun:[...e.preRun||[],I=>{let B=Zr(I,this);I.FS.mkdir(C),I.FS.mount(B,{},C)}]}}}},pr={EBADF:8,EBADFD:127,EEXIST:20,EINVAL:28,EISDIR:31,ENODEV:43,ENOENT:44,ENOTDIR:54,ENOTEMPTY:55},Zr=(k,e)=>{let I=k.FS,B=e.debug?console.log:null,tr={tryFSOperation(rr){try{return rr()}catch(ir){throw ir.code?ir.code==="UNKNOWN"?new I.ErrnoError(pr.EINVAL):new I.ErrnoError(ir.code):ir}},mount(rr){return tr.createNode(null,"/",16895,0)},syncfs(rr,ir,lr){},createNode(rr,ir,lr,dr){if(!I.isDir(lr)&&!I.isFile(lr))throw new I.ErrnoError(28);let mr=I.createNode(rr,ir,lr);return mr.node_ops=tr.node_ops,mr.stream_ops=tr.stream_ops,mr},getMode:function(rr){return B?.("getMode",rr),tr.tryFSOperation(()=>e.lstat(rr).mode)},realPath:function(rr){let ir=[];for(;rr.parent!==rr;)ir.push(rr.name),rr=rr.parent;return ir.push(rr.mount.opts.root),ir.reverse(),ir.join("/")},node_ops:{getattr(rr){B?.("getattr",tr.realPath(rr));let ir=tr.realPath(rr);return tr.tryFSOperation(()=>{let lr=e.lstat(ir);return{...lr,dev:0,ino:rr.id,nlink:1,rdev:rr.rdev,atime:new Date(lr.atime),mtime:new Date(lr.mtime),ctime:new Date(lr.ctime)}})},setattr(rr,ir){B?.("setattr",tr.realPath(rr),ir);let lr=tr.realPath(rr);tr.tryFSOperation(()=>{ir.mode!==void 0&&e.chmod(lr,ir.mode),ir.size!==void 0&&e.truncate(lr,ir.size),ir.timestamp!==void 0&&e.utimes(lr,ir.timestamp,ir.timestamp),ir.size!==void 0&&e.truncate(lr,ir.size)})},lookup(rr,ir){B?.("lookup",tr.realPath(rr),ir);let lr=[tr.realPath(rr),ir].join("/"),dr=tr.getMode(lr);return tr.createNode(rr,ir,dr)},mknod(rr,ir,lr,dr){B?.("mknod",tr.realPath(rr),ir,lr,dr);let mr=tr.createNode(rr,ir,lr,dr),hr=tr.realPath(mr);return tr.tryFSOperation(()=>(I.isDir(mr.mode)?e.mkdir(hr,{mode:lr}):e.writeFile(hr,"",{mode:lr}),mr))},rename(rr,ir,lr){B?.("rename",tr.realPath(rr),tr.realPath(ir),lr);let dr=tr.realPath(rr),mr=[tr.realPath(ir),lr].join("/");tr.tryFSOperation(()=>{e.rename(dr,mr)}),rr.name=lr},unlink(rr,ir){B?.("unlink",tr.realPath(rr),ir);let lr=[tr.realPath(rr),ir].join("/");try{e.unlink(lr)}catch{}},rmdir(rr,ir){B?.("rmdir",tr.realPath(rr),ir);let lr=[tr.realPath(rr),ir].join("/");return tr.tryFSOperation(()=>{e.rmdir(lr)})},readdir(rr){B?.("readdir",tr.realPath(rr));let ir=tr.realPath(rr);return tr.tryFSOperation(()=>e.readdir(ir))},symlink(rr,ir,lr){throw B?.("symlink",tr.realPath(rr),ir,lr),new I.ErrnoError(63)},readlink(rr){throw B?.("readlink",tr.realPath(rr)),new I.ErrnoError(63)}},stream_ops:{open(rr){B?.("open stream",tr.realPath(rr.node));let ir=tr.realPath(rr.node);return tr.tryFSOperation(()=>{I.isFile(rr.node.mode)&&(rr.shared.refcount=1,rr.nfd=e.open(ir))})},close(rr){return B?.("close stream",tr.realPath(rr.node)),tr.tryFSOperation(()=>{I.isFile(rr.node.mode)&&rr.nfd&&--rr.shared.refcount===0&&e.close(rr.nfd)})},dup(rr){B?.("dup stream",tr.realPath(rr.node)),rr.shared.refcount++},read(rr,ir,lr,dr,mr){return B?.("read stream",tr.realPath(rr.node),lr,dr,mr),dr===0?0:tr.tryFSOperation(()=>e.read(rr.nfd,ir,lr,dr,mr))},write(rr,ir,lr,dr,mr){return B?.("write stream",tr.realPath(rr.node),lr,dr,mr),tr.tryFSOperation(()=>e.write(rr.nfd,ir.buffer,lr,dr,mr))},llseek(rr,ir,lr){B?.("llseek stream",tr.realPath(rr.node),ir,lr);let dr=ir;if(lr===1?dr+=rr.position:lr===2&&I.isFile(rr.node.mode)&&tr.tryFSOperation(()=>{let mr=e.fstat(rr.nfd);dr+=mr.size}),dr<0)throw new I.ErrnoError(28);return dr},mmap(rr,ir,lr,dr,mr){if(B?.("mmap stream",tr.realPath(rr.node),ir,lr,dr,mr),!I.isFile(rr.node.mode))throw new I.ErrnoError(pr.ENODEV);let hr=k.mmapAlloc(ir);return tr.stream_ops.read(rr,k.HEAP8,hr,ir,lr),{ptr:hr,allocated:!0}},msync(rr,ir,lr,dr,mr){return B?.("msync stream",tr.realPath(rr.node),lr,dr,mr),tr.stream_ops.write(rr,ir,0,dr,lr),0}}};return tr};u$1();u$1();u$1();var Ke=new Error("request for lock canceled"),Ye=function(k,e,I,B){function tr(rr){return rr instanceof I?rr:new I(function(ir){ir(rr)})}return new(I||(I=Promise))(function(rr,ir){function lr(hr){try{mr(B.next(hr))}catch(fr){ir(fr)}}function dr(hr){try{mr(B.throw(hr))}catch(fr){ir(fr)}}function mr(hr){hr.done?rr(hr.value):tr(hr.value).then(lr,dr)}mr((B=B.apply(k,[])).next())})},fe=class{constructor(k,e=Ke){this._value=k,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(k=1){if(k<=0)throw new Error(`invalid weight ${k}: must be positive`);return new Promise((e,I)=>{this._weightedQueues[k-1]||(this._weightedQueues[k-1]=[]),this._weightedQueues[k-1].push({resolve:e,reject:I}),this._dispatch()})}runExclusive(k,e=1){return Ye(this,void 0,void 0,function*(){let[I,B]=yield this.acquire(e);try{return yield k(I)}finally{B()}})}waitForUnlock(k=1){if(k<=0)throw new Error(`invalid weight ${k}: must be positive`);return new Promise(e=>{this._weightedWaiters[k-1]||(this._weightedWaiters[k-1]=[]),this._weightedWaiters[k-1].push(e),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(k){this._value=k,this._dispatch()}release(k=1){if(k<=0)throw new Error(`invalid weight ${k}: must be positive`);this._value+=k,this._dispatch()}cancel(){this._weightedQueues.forEach(k=>k.forEach(e=>e.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var k;for(let e=this._value;e>0;e--){let I=(k=this._weightedQueues[e-1])===null||k===void 0?void 0:k.shift();if(!I)continue;let B=this._value,tr=e;this._value-=e,e=this._value+1,I.resolve([B,this._newReleaser(tr)])}this._drainUnlockWaiters()}_newReleaser(k){let e=!1;return()=>{e||(e=!0,this.release(k))}}_drainUnlockWaiters(){for(let k=this._value;k>0;k--)this._weightedWaiters[k-1]&&(this._weightedWaiters[k-1].forEach(e=>e()),this._weightedWaiters[k-1]=[])}},Je=function(k,e,I,B){function tr(rr){return rr instanceof I?rr:new I(function(ir){ir(rr)})}return new(I||(I=Promise))(function(rr,ir){function lr(hr){try{mr(B.next(hr))}catch(fr){ir(fr)}}function dr(hr){try{mr(B.throw(hr))}catch(fr){ir(fr)}}function mr(hr){hr.done?rr(hr.value):tr(hr.value).then(lr,dr)}mr((B=B.apply(k,[])).next())})},X=class{constructor(k){this._semaphore=new fe(1,k)}acquire(){return Je(this,void 0,void 0,function*(){let[,k]=yield this._semaphore.acquire();return k})}runExclusive(k){return this._semaphore.runExclusive(()=>k())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};u$1();var Pe=L$2(or());async function xe(k){if(Fe){let e=await import("./__vite-browser-external-9wXp6ZBx.js"),I=await import("./__vite-browser-external-9wXp6ZBx.js"),{Writable:B}=await import("./__vite-browser-external-9wXp6ZBx.js"),{pipeline:tr}=await import("./__vite-browser-external-9wXp6ZBx.js");if(!e.existsSync(k))throw new Error(`Extension bundle not found: ${k}`);let rr=I.createGunzip(),ir=[];return await tr(e.createReadStream(k),rr,new B({write(lr,dr,mr){ir.push(lr),mr()}})),new Blob(ir)}else{let e=await fetch(k.toString());if(!e.ok||!e.body)return null;if(e.headers.get("Content-Encoding")==="gzip")return e.blob();{let I=new DecompressionStream("gzip");return new Response(e.body.pipeThrough(I)).blob()}}}async function ke(k,e){for(let I in k.pg_extensions){let B;try{B=await k.pg_extensions[I]}catch(tr){console.error("Failed to fetch extension:",I,tr);continue}if(B){let tr=new Uint8Array(await B.arrayBuffer());Qe(k,I,tr,e)}else console.error("Could not get binary data for extension:",I)}}function Qe(k,e,I,B){Pe.default.untar(I).forEach(tr=>{if(!tr.name.startsWith(".")){let rr=k.WASM_PREFIX+"/"+tr.name;if(tr.name.endsWith(".so")){let ir=(...dr)=>{B("pgfs:ext OK",rr,dr)},lr=(...dr)=>{B("pgfs:ext FAIL",rr,dr)};k.FS.createPreloadedFile($e(rr),tr.name.split("/").pop().slice(0,-3),tr.data,!0,!0,ir,lr,!1)}else k.FS.writeFile(rr,tr.data)}})}function $e(k){let e=k.lastIndexOf("/");return e>0?k.slice(0,e):k}u$1();u$1();var ee=class extends ur{async init(k,e){return this.pg=k,{emscriptenOpts:{...e,preRun:[...e.preRun||[],I=>{let B=I.FS.filesystems.IDBFS;I.FS.mkdir("/pglite"),I.FS.mkdir(`/pglite/${this.dataDir}`),I.FS.mount(B,{},`/pglite/${this.dataDir}`),I.FS.symlink(`/pglite/${this.dataDir}`,C)}]}}}initialSyncFs(){return new Promise((k,e)=>{this.pg.Module.FS.syncfs(!0,I=>{I?e(I):k()})})}syncToFs(k){return new Promise((e,I)=>{this.pg.Module.FS.syncfs(!1,B=>{B?I(B):e()})})}async closeFs(){let k=this.pg.Module.FS.filesystems.IDBFS.dbs[this.dataDir];k&&k.close(),this.pg.Module.FS.quit()}};u$1();var te=class extends ur{async closeFs(){this.pg.Module.FS.quit()}};function Ae(k){let e;if(k?.startsWith("file://")){if(k=k.slice(7),!k)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else k?.startsWith("idb://")?(k=k.slice(6),e="idbfs"):k?.startsWith("opfs-ahp://")?(k=k.slice(11),e="opfs-ahp"):!k||k?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:k,fsType:e}}async function Te(k,e){let I;if(k&&e==="nodefs"){let{NodeFS:B}=await import("./nodefs-BCmYJ7Zw.js");I=new B(k)}else if(k&&e==="idbfs")I=new ee(k);else if(k&&e==="opfs-ahp"){let{OpfsAhpFS:B}=await import("./opfs-ahp-DEtIm5m-.js");I=new B(k)}else I=new te;return I}u$1();u$1();var Ze=(()=>{var _scriptName=import.meta.url;return async function(moduleArg={}){var moduleRtn,Module=moduleArg,readyPromiseResolve,readyPromiseReject,readyPromise=new Promise((k,e)=>{readyPromiseResolve=k,readyPromiseReject=e}),ENVIRONMENT_IS_WEB=typeof window=="object",ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope<"u",ENVIRONMENT_IS_NODE=typeof process$1=="object"&&typeof process$1.versions=="object"&&typeof process$1.versions.node=="string"&&process$1.type!="renderer";if(ENVIRONMENT_IS_NODE){let{createRequire:k}=await import("./__vite-browser-external-9wXp6ZBx.js"),e=import.meta.url;e.startsWith("data:")&&(e="/");var require=k(e)}Module.expectedDataFileDownloads??(Module.expectedDataFileDownloads=0),Module.expectedDataFileDownloads++,(()=>{var k=typeof ENVIRONMENT_IS_PTHREAD<"u"&&ENVIRONMENT_IS_PTHREAD,e=typeof ENVIRONMENT_IS_WASM_WORKER<"u"&&ENVIRONMENT_IS_WASM_WORKER;if(k||e)return;var I=typeof process$1=="object"&&typeof process$1.versions=="object"&&typeof process$1.versions.node=="string";function B(tr){typeof window=="object"?window.encodeURIComponent(window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))+"/"):typeof process$1>"u"&&typeof location<"u"&&encodeURIComponent(location.pathname.substring(0,location.pathname.lastIndexOf("/"))+"/");var rr="/tmp/sdk/dist/pglite-web/pglite.data",ir="pglite.data",lr=Module.locateFile?Module.locateFile(ir,""):ir,dr=tr.remote_package_size;function mr(Sr,Ar,Or,Fr){if(I){require("fs").readFile(Sr,(vr,xr)=>{vr?Fr(vr):Or(xr.buffer)});return}Module.dataFileDownloads??(Module.dataFileDownloads={}),fetch(Sr).catch(vr=>Promise.reject(new Error(`Network Error: ${Sr}`,{cause:vr}))).then(vr=>{if(!vr.ok)return Promise.reject(new Error(`${vr.status}: ${vr.url}`));if(!vr.body&&vr.arrayBuffer)return vr.arrayBuffer().then(Or);let xr=vr.body.getReader(),kr=()=>xr.read().then(es).catch(ps=>Promise.reject(new Error(`Unexpected error while handling : ${vr.url} ${ps}`,{cause:ps}))),Gr=[],is=vr.headers,as=Number(is.get("Content-Length")??Ar),cs=0,es=({done:ps,value:Ur})=>{if(ps){let Lr=new Uint8Array(Gr.map(rs=>rs.length).reduce((rs,ss)=>rs+ss,0)),ts=0;for(let rs of Gr)Lr.set(rs,ts),ts+=rs.length;Or(Lr.buffer)}else{Gr.push(Ur),cs+=Ur.length,Module.dataFileDownloads[Sr]={loaded:cs,total:as};let Lr=0,ts=0;for(let rs of Object.values(Module.dataFileDownloads))Lr+=rs.loaded,ts+=rs.total;return Module.setStatus?.(`Downloading data... (${Lr}/${ts})`),kr()}};return Module.setStatus?.("Downloading data..."),kr()})}function hr(Sr){console.error("package error:",Sr)}var fr=null,_r=Module.getPreloadedPackage?Module.getPreloadedPackage(lr,dr):null;_r||mr(lr,dr,Sr=>{fr?(fr(Sr),fr=null):_r=Sr},hr);function gr(Sr){function Ar(kr,Gr){if(!kr)throw Gr+new Error().stack}Sr.FS_createPath("/","home",!0,!0),Sr.FS_createPath("/home","web_user",!0,!0),Sr.FS_createPath("/","tmp",!0,!0),Sr.FS_createPath("/tmp","pglite",!0,!0),Sr.FS_createPath("/tmp/pglite","bin",!0,!0),Sr.FS_createPath("/tmp/pglite","lib",!0,!0),Sr.FS_createPath("/tmp/pglite/lib","postgresql",!0,!0),Sr.FS_createPath("/tmp/pglite/lib/postgresql","pgxs",!0,!0),Sr.FS_createPath("/tmp/pglite/lib/postgresql/pgxs","config",!0,!0),Sr.FS_createPath("/tmp/pglite/lib/postgresql/pgxs","src",!0,!0),Sr.FS_createPath("/tmp/pglite/lib/postgresql/pgxs/src","makefiles",!0,!0),Sr.FS_createPath("/tmp/pglite","share",!0,!0),Sr.FS_createPath("/tmp/pglite/share","postgresql",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql","extension",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql","timezone",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Africa",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","America",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","Argentina",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","Indiana",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","Kentucky",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone/America","North_Dakota",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Antarctica",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Arctic",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Asia",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Atlantic",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Australia",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Brazil",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Canada",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Chile",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Etc",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Europe",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Indian",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Mexico",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","Pacific",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql/timezone","US",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql","timezonesets",!0,!0),Sr.FS_createPath("/tmp/pglite/share/postgresql","tsearch_data",!0,!0);function Or(kr,Gr,is){this.start=kr,this.end=Gr,this.audio=is}Or.prototype={requests:{},open:function(kr,Gr){this.name=Gr,this.requests[Gr]=this,Sr.addRunDependency(`fp ${this.name}`)},send:function(){},onload:function(){var kr=this.byteArray.subarray(this.start,this.end);this.finish(kr)},finish:function(kr){var Gr=this;Sr.FS_createDataFile(this.name,null,kr,!0,!0,!0),Sr.removeRunDependency(`fp ${Gr.name}`),this.requests[this.name]=null}};for(var Fr=tr.files,vr=0;vr<Fr.length;++vr)new Or(Fr[vr].start,Fr[vr].end,Fr[vr].audio||0).open("GET",Fr[vr].filename);function xr(kr){Ar(kr,"Loading data file failed."),Ar(kr.constructor.name===ArrayBuffer.name,"bad input to processPackageData");var Gr=new Uint8Array(kr);Or.prototype.byteArray=Gr;for(var is=tr.files,as=0;as<is.length;++as)Or.prototype.requests[is[as].filename].onload();Sr.removeRunDependency("datafile_/tmp/sdk/dist/pglite-web/pglite.data")}Sr.addRunDependency("datafile_/tmp/sdk/dist/pglite-web/pglite.data"),Sr.preloadResults??(Sr.preloadResults={}),Sr.preloadResults[rr]={fromCache:!1},_r?(xr(_r),_r=null):fr=xr}Module.calledRun?gr(Module):(Module.preRun??(Module.preRun=[])).push(gr)}B({files:[{filename:"/home/web_user/.pgpass",start:0,end:204},{filename:"/tmp/pglite/bin/initdb",start:204,end:204},{filename:"/tmp/pglite/bin/postgres",start:204,end:204},{filename:"/tmp/pglite/lib/postgresql/cyrillic_and_mic.so",start:204,end:4699},{filename:"/tmp/pglite/lib/postgresql/dict_snowball.so",start:4699,end:576732},{filename:"/tmp/pglite/lib/postgresql/euc2004_sjis2004.so",start:576732,end:578729},{filename:"/tmp/pglite/lib/postgresql/euc_cn_and_mic.so",start:578729,end:579667},{filename:"/tmp/pglite/lib/postgresql/euc_jp_and_sjis.so",start:579667,end:586924},{filename:"/tmp/pglite/lib/postgresql/euc_kr_and_mic.so",start:586924,end:587876},{filename:"/tmp/pglite/lib/postgresql/euc_tw_and_big5.so",start:587876,end:592450},{filename:"/tmp/pglite/lib/postgresql/latin2_and_win1250.so",start:592450,end:593857},{filename:"/tmp/pglite/lib/postgresql/latin_and_mic.so",start:593857,end:594879},{filename:"/tmp/pglite/lib/postgresql/libpqwalreceiver.so",start:594879,end:715269},{filename:"/tmp/pglite/lib/postgresql/pgoutput.so",start:715269,end:728610},{filename:"/tmp/pglite/lib/postgresql/pgxs/config/install-sh",start:728610,end:742607},{filename:"/tmp/pglite/lib/postgresql/pgxs/config/missing",start:742607,end:743955},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/Makefile.global",start:743955,end:780212},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/Makefile.port",start:780212,end:780764},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/Makefile.shlib",start:780764,end:796066},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/makefiles/pgxs.mk",start:796066,end:810977},{filename:"/tmp/pglite/lib/postgresql/pgxs/src/nls-global.mk",start:810977,end:817845},{filename:"/tmp/pglite/lib/postgresql/plpgsql.so",start:817845,end:967676},{filename:"/tmp/pglite/lib/postgresql/utf8_and_big5.so",start:967676,end:1082425},{filename:"/tmp/pglite/lib/postgresql/utf8_and_cyrillic.so",start:1082425,end:1088400},{filename:"/tmp/pglite/lib/postgresql/utf8_and_euc2004.so",start:1088400,end:1293333},{filename:"/tmp/pglite/lib/postgresql/utf8_and_euc_cn.so",start:1293333,end:1368514},{filename:"/tmp/pglite/lib/postgresql/utf8_and_euc_jp.so",start:1368514,end:1519743},{filename:"/tmp/pglite/lib/postgresql/utf8_and_euc_kr.so",start:1519743,end:1622600},{filename:"/tmp/pglite/lib/postgresql/utf8_and_euc_tw.so",start:1622600,end:1822157},{filename:"/tmp/pglite/lib/postgresql/utf8_and_gb18030.so",start:1822157,end:2084535},{filename:"/tmp/pglite/lib/postgresql/utf8_and_gbk.so",start:2084535,end:2231068},{filename:"/tmp/pglite/lib/postgresql/utf8_and_iso8859.so",start:2231068,end:2254653},{filename:"/tmp/pglite/lib/postgresql/utf8_and_iso8859_1.so",start:2254653,end:2255623},{filename:"/tmp/pglite/lib/postgresql/utf8_and_johab.so",start:2255623,end:2417328},{filename:"/tmp/pglite/lib/postgresql/utf8_and_sjis.so",start:2417328,end:2498989},{filename:"/tmp/pglite/lib/postgresql/utf8_and_sjis2004.so",start:2498989,end:2625622},{filename:"/tmp/pglite/lib/postgresql/utf8_and_uhc.so",start:2625622,end:2792895},{filename:"/tmp/pglite/lib/postgresql/utf8_and_win.so",start:2792895,end:2819439},{filename:"/tmp/pglite/password",start:2819439,end:2819448},{filename:"/tmp/pglite/share/postgresql/errcodes.txt",start:2819448,end:2852840},{filename:"/tmp/pglite/share/postgresql/extension/plpgsql--1.0.sql",start:2852840,end:2853498},{filename:"/tmp/pglite/share/postgresql/extension/plpgsql.control",start:2853498,end:2853691},{filename:"/tmp/pglite/share/postgresql/information_schema.sql",start:2853691,end:2969214},{filename:"/tmp/pglite/share/postgresql/pg_hba.conf.sample",start:2969214,end:2974839},{filename:"/tmp/pglite/share/postgresql/pg_ident.conf.sample",start:2974839,end:2977479},{filename:"/tmp/pglite/share/postgresql/pg_service.conf.sample",start:2977479,end:2978083},{filename:"/tmp/pglite/share/postgresql/postgres.bki",start:2978083,end:3931351},{filename:"/tmp/pglite/share/postgresql/postgresql.conf.sample",start:3931351,end:3962013},{filename:"/tmp/pglite/share/postgresql/psqlrc.sample",start:3962013,end:3962291},{filename:"/tmp/pglite/share/postgresql/snowball_create.sql",start:3962291,end:4006467},{filename:"/tmp/pglite/share/postgresql/sql_features.txt",start:4006467,end:4042200},{filename:"/tmp/pglite/share/postgresql/system_constraints.sql",start:4042200,end:4051095},{filename:"/tmp/pglite/share/postgresql/system_functions.sql",start:4051095,end:4075398},{filename:"/tmp/pglite/share/postgresql/system_views.sql",start:4075398,end:4127092},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Abidjan",start:4127092,end:4127240},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Accra",start:4127240,end:4127388},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Addis_Ababa",start:4127388,end:4127653},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Algiers",start:4127653,end:4128388},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Asmara",start:4128388,end:4128653},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Asmera",start:4128653,end:4128918},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bamako",start:4128918,end:4129066},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bangui",start:4129066,end:4129301},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Banjul",start:4129301,end:4129449},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bissau",start:4129449,end:4129643},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Blantyre",start:4129643,end:4129792},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Brazzaville",start:4129792,end:4130027},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Bujumbura",start:4130027,end:4130176},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Cairo",start:4130176,end:4132575},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Casablanca",start:4132575,end:4135004},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Ceuta",start:4135004,end:4137056},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Conakry",start:4137056,end:4137204},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Dakar",start:4137204,end:4137352},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Dar_es_Salaam",start:4137352,end:4137617},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Djibouti",start:4137617,end:4137882},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Douala",start:4137882,end:4138117},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/El_Aaiun",start:4138117,end:4140412},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Freetown",start:4140412,end:4140560},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Gaborone",start:4140560,end:4140709},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Harare",start:4140709,end:4140858},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Johannesburg",start:4140858,end:4141104},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Juba",start:4141104,end:4141783},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Kampala",start:4141783,end:4142048},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Khartoum",start:4142048,end:4142727},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Kigali",start:4142727,end:4142876},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Kinshasa",start:4142876,end:4143111},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lagos",start:4143111,end:4143346},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Libreville",start:4143346,end:4143581},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lome",start:4143581,end:4143729},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Luanda",start:4143729,end:4143964},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lubumbashi",start:4143964,end:4144113},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Lusaka",start:4144113,end:4144262},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Malabo",start:4144262,end:4144497},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Maputo",start:4144497,end:4144646},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Maseru",start:4144646,end:4144892},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Mbabane",start:4144892,end:4145138},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Mogadishu",start:4145138,end:4145403},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Monrovia",start:4145403,end:4145611},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Nairobi",start:4145611,end:4145876},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Ndjamena",start:4145876,end:4146075},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Niamey",start:4146075,end:4146310},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Nouakchott",start:4146310,end:4146458},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Ouagadougou",start:4146458,end:4146606},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Porto-Novo",start:4146606,end:4146841},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Sao_Tome",start:4146841,end:4147095},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Timbuktu",start:4147095,end:4147243},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Tripoli",start:4147243,end:4147868},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Tunis",start:4147868,end:4148557},{filename:"/tmp/pglite/share/postgresql/timezone/Africa/Windhoek",start:4148557,end:4149512},{filename:"/tmp/pglite/share/postgresql/timezone/America/Adak",start:4149512,end:4151868},{filename:"/tmp/pglite/share/postgresql/timezone/America/Anchorage",start:4151868,end:4154239},{filename:"/tmp/pglite/share/postgresql/timezone/America/Anguilla",start:4154239,end:4154485},{filename:"/tmp/pglite/share/postgresql/timezone/America/Antigua",start:4154485,end:4154731},{filename:"/tmp/pglite/share/postgresql/timezone/America/Araguaina",start:4154731,end:4155615},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Buenos_Aires",start:4155615,end:4156691},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Catamarca",start:4156691,end:4157767},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/ComodRivadavia",start:4157767,end:4158843},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Cordoba",start:4158843,end:4159919},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Jujuy",start:4159919,end:4160967},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/La_Rioja",start:4160967,end:4162057},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Mendoza",start:4162057,end:4163133},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Rio_Gallegos",start:4163133,end:4164209},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Salta",start:4164209,end:4165257},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/San_Juan",start:4165257,end:4166347},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/San_Luis",start:4166347,end:4167449},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Tucuman",start:4167449,end:4168553},{filename:"/tmp/pglite/share/postgresql/timezone/America/Argentina/Ushuaia",start:4168553,end:4169629},{filename:"/tmp/pglite/share/postgresql/timezone/America/Aruba",start:4169629,end:4169875},{filename:"/tmp/pglite/share/postgresql/timezone/America/Asuncion",start:4169875,end:4171533},{filename:"/tmp/pglite/share/postgresql/timezone/America/Atikokan",start:4171533,end:4171715},{filename:"/tmp/pglite/share/postgresql/timezone/America/Atka",start:4171715,end:4174071},{filename:"/tmp/pglite/share/postgresql/timezone/America/Bahia",start:4174071,end:4175095},{filename:"/tmp/pglite/share/postgresql/timezone/America/Bahia_Banderas",start:4175095,end:4176195},{filename:"/tmp/pglite/share/postgresql/timezone/America/Barbados",start:4176195,end:4176631},{filename:"/tmp/pglite/share/postgresql/timezone/America/Belem",start:4176631,end:4177207},{filename:"/tmp/pglite/share/postgresql/timezone/America/Belize",start:4177207,end:4178821},{filename:"/tmp/pglite/share/postgresql/timezone/America/Blanc-Sablon",start:4178821,end:4179067},{filename:"/tmp/pglite/share/postgresql/timezone/America/Boa_Vista",start:4179067,end:4179699},{filename:"/tmp/pglite/share/postgresql/timezone/America/Bogota",start:4179699,end:4179945},{filename:"/tmp/pglite/share/postgresql/timezone/America/Boise",start:4179945,end:4182355},{filename:"/tmp/pglite/share/postgresql/timezone/America/Buenos_Aires",start:4182355,end:4183431},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cambridge_Bay",start:4183431,end:4185685},{filename:"/tmp/pglite/share/postgresql/timezone/America/Campo_Grande",start:4185685,end:4187129},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cancun",start:4187129,end:4187993},{filename:"/tmp/pglite/share/postgresql/timezone/America/Caracas",start:4187993,end:4188257},{filename:"/tmp/pglite/share/postgresql/timezone/America/Catamarca",start:4188257,end:4189333},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cayenne",start:4189333,end:4189531},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cayman",start:4189531,end:4189713},{filename:"/tmp/pglite/share/postgresql/timezone/America/Chicago",start:4189713,end:4193305},{filename:"/tmp/pglite/share/postgresql/timezone/America/Chihuahua",start:4193305,end:4194407},{filename:"/tmp/pglite/share/postgresql/timezone/America/Ciudad_Juarez",start:4194407,end:4195945},{filename:"/tmp/pglite/share/postgresql/timezone/America/Coral_Harbour",start:4195945,end:4196127},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cordoba",start:4196127,end:4197203},{filename:"/tmp/pglite/share/postgresql/timezone/America/Costa_Rica",start:4197203,end:4197519},{filename:"/tmp/pglite/share/postgresql/timezone/America/Creston",start:4197519,end:4197879},{filename:"/tmp/pglite/share/postgresql/timezone/America/Cuiaba",start:4197879,end:4199295},{filename:"/tmp/pglite/share/postgresql/timezone/America/Curacao",start:4199295,end:4199541},{filename:"/tmp/pglite/share/postgresql/timezone/America/Danmarkshavn",start:4199541,end:4200239},{filename:"/tmp/pglite/share/postgresql/timezone/America/Dawson",start:4200239,end:4201853},{filename:"/tmp/pglite/share/postgresql/timezone/America/Dawson_Creek",start:4201853,end:4202903},{filename:"/tmp/pglite/share/postgresql/timezone/America/Denver",start:4202903,end:4205363},{filename:"/tmp/pglite/share/postgresql/timezone/America/Detroit",start:4205363,end:4207593},{filename:"/tmp/pglite/share/postgresql/timezone/America/Dominica",start:4207593,end:4207839},{filename:"/tmp/pglite/share/postgresql/timezone/America/Edmonton",start:4207839,end:4210171},{filename:"/tmp/pglite/share/postgresql/timezone/America/Eirunepe",start:4210171,end:4210827},{filename:"/tmp/pglite/share/postgresql/timezone/America/El_Salvador",start:4210827,end:4211051},{filename:"/tmp/pglite/share/postgresql/timezone/America/Ensenada",start:4211051,end:4213509},{filename:"/tmp/pglite/share/postgresql/timezone/America/Fort_Nelson",start:4213509,end:4215749},{filename:"/tmp/pglite/share/postgresql/timezone/America/Fort_Wayne",start:4215749,end:4217431},{filename:"/tmp/pglite/share/postgresql/timezone/America/Fortaleza",start:4217431,end:4218147},{filename:"/tmp/pglite/share/postgresql/timezone/America/Glace_Bay",start:4218147,end:4220339},{filename:"/tmp/pglite/share/postgresql/timezone/America/Godthab",start:4220339,end:4222242},{filename:"/tmp/pglite/share/postgresql/timezone/America/Goose_Bay",start:4222242,end:4225452},{filename:"/tmp/pglite/share/postgresql/timezone/America/Grand_Turk",start:4225452,end:4227286},{filename:"/tmp/pglite/share/postgresql/timezone/America/Grenada",start:4227286,end:4227532},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guadeloupe",start:4227532,end:4227778},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guatemala",start:4227778,end:4228058},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guayaquil",start:4228058,end:4228304},{filename:"/tmp/pglite/share/postgresql/timezone/America/Guyana",start:4228304,end:4228566},{filename:"/tmp/pglite/share/postgresql/timezone/America/Halifax",start:4228566,end:4231990},{filename:"/tmp/pglite/share/postgresql/timezone/America/Havana",start:4231990,end:4234406},{filename:"/tmp/pglite/share/postgresql/timezone/America/Hermosillo",start:4234406,end:4234794},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Indianapolis",start:4234794,end:4236476},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Knox",start:4236476,end:4238920},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Marengo",start:4238920,end:4240658},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Petersburg",start:4240658,end:4242578},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Tell_City",start:4242578,end:4244278},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Vevay",start:4244278,end:4245708},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Vincennes",start:4245708,end:4247418},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indiana/Winamac",start:4247418,end:4249212},{filename:"/tmp/pglite/share/postgresql/timezone/America/Indianapolis",start:4249212,end:4250894},{filename:"/tmp/pglite/share/postgresql/timezone/America/Inuvik",start:4250894,end:4252968},{filename:"/tmp/pglite/share/postgresql/timezone/America/Iqaluit",start:4252968,end:4255170},{filename:"/tmp/pglite/share/postgresql/timezone/America/Jamaica",start:4255170,end:4255652},{filename:"/tmp/pglite/share/postgresql/timezone/America/Jujuy",start:4255652,end:4256700},{filename:"/tmp/pglite/share/postgresql/timezone/America/Juneau",start:4256700,end:4259053},{filename:"/tmp/pglite/share/postgresql/timezone/America/Kentucky/Louisville",start:4259053,end:4261841},{filename:"/tmp/pglite/share/postgresql/timezone/America/Kentucky/Monticello",start:4261841,end:4264209},{filename:"/tmp/pglite/share/postgresql/timezone/America/Knox_IN",start:4264209,end:4266653},{filename:"/tmp/pglite/share/postgresql/timezone/America/Kralendijk",start:4266653,end:4266899},{filename:"/tmp/pglite/share/postgresql/timezone/America/La_Paz",start:4266899,end:4267131},{filename:"/tmp/pglite/share/postgresql/timezone/America/Lima",start:4267131,end:4267537},{filename:"/tmp/pglite/share/postgresql/timezone/America/Los_Angeles",start:4267537,end:4270389},{filename:"/tmp/pglite/share/postgresql/timezone/America/Louisville",start:4270389,end:4273177},{filename:"/tmp/pglite/share/postgresql/timezone/America/Lower_Princes",start:4273177,end:4273423},{filename:"/tmp/pglite/share/postgresql/timezone/America/Maceio",start:4273423,end:4274167},{filename:"/tmp/pglite/share/postgresql/timezone/America/Managua",start:4274167,end:4274597},{filename:"/tmp/pglite/share/postgresql/timezone/America/Manaus",start:4274597,end:4275201},{filename:"/tmp/pglite/share/postgresql/timezone/America/Marigot",start:4275201,end:4275447},{filename:"/tmp/pglite/share/postgresql/timezone/America/Martinique",start:4275447,end:4275679},{filename:"/tmp/pglite/share/postgresql/timezone/America/Matamoros",start:4275679,end:4277097},{filename:"/tmp/pglite/share/postgresql/timezone/America/Mazatlan",start:4277097,end:4278157},{filename:"/tmp/pglite/share/postgresql/timezone/America/Mendoza",start:4278157,end:4279233},{filename:"/tmp/pglite/share/postgresql/timezone/America/Menominee",start:4279233,end:4281507},{filename:"/tmp/pglite/share/postgresql/timezone/America/Merida",start:4281507,end:4282511},{filename:"/tmp/pglite/share/postgresql/timezone/America/Metlakatla",start:4282511,end:4283934},{filename:"/tmp/pglite/share/postgresql/timezone/America/Mexico_City",start:4283934,end:4285156},{filename:"/tmp/pglite/share/postgresql/timezone/America/Miquelon",start:4285156,end:4286822},{filename:"/tmp/pglite/share/postgresql/timezone/America/Moncton",start:4286822,end:4289976},{filename:"/tmp/pglite/share/postgresql/timezone/America/Monterrey",start:4289976,end:4291090},{filename:"/tmp/pglite/share/postgresql/timezone/America/Montevideo",start:4291090,end:4292600},{filename:"/tmp/pglite/share/postgresql/timezone/America/Montreal",start:4292600,end:4296094},{filename:"/tmp/pglite/share/postgresql/timezone/America/Montserrat",start:4296094,end:4296340},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nassau",start:4296340,end:4299834},{filename:"/tmp/pglite/share/postgresql/timezone/America/New_York",start:4299834,end:4303386},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nipigon",start:4303386,end:4306880},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nome",start:4306880,end:4309247},{filename:"/tmp/pglite/share/postgresql/timezone/America/Noronha",start:4309247,end:4309963},{filename:"/tmp/pglite/share/postgresql/timezone/America/North_Dakota/Beulah",start:4309963,end:4312359},{filename:"/tmp/pglite/share/postgresql/timezone/America/North_Dakota/Center",start:4312359,end:4314755},{filename:"/tmp/pglite/share/postgresql/timezone/America/North_Dakota/New_Salem",start:4314755,end:4317151},{filename:"/tmp/pglite/share/postgresql/timezone/America/Nuuk",start:4317151,end:4319054},{filename:"/tmp/pglite/share/postgresql/timezone/America/Ojinaga",start:4319054,end:4320578},{filename:"/tmp/pglite/share/postgresql/timezone/America/Panama",start:4320578,end:4320760},{filename:"/tmp/pglite/share/postgresql/timezone/America/Pangnirtung",start:4320760,end:4322962},{filename:"/tmp/pglite/share/postgresql/timezone/America/Paramaribo",start:4322962,end:4323224},{filename:"/tmp/pglite/share/postgresql/timezone/America/Phoenix",start:4323224,end:4323584},{filename:"/tmp/pglite/share/postgresql/timezone/America/Port-au-Prince",start:4323584,end:4325018},{filename:"/tmp/pglite/share/postgresql/timezone/America/Port_of_Spain",start:4325018,end:4325264},{filename:"/tmp/pglite/share/postgresql/timezone/America/Porto_Acre",start:4325264,end:4325892},{filename:"/tmp/pglite/share/postgresql/timezone/America/Porto_Velho",start:4325892,end:4326468},{filename:"/tmp/pglite/share/postgresql/timezone/America/Puerto_Rico",start:4326468,end:4326714},{filename:"/tmp/pglite/share/postgresql/timezone/America/Punta_Arenas",start:4326714,end:4328630},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rainy_River",start:4328630,end:4331498},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rankin_Inlet",start:4331498,end:4333564},{filename:"/tmp/pglite/share/postgresql/timezone/America/Recife",start:4333564,end:4334280},{filename:"/tmp/pglite/share/postgresql/timezone/America/Regina",start:4334280,end:4335260},{filename:"/tmp/pglite/share/postgresql/timezone/America/Resolute",start:4335260,end:4337326},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rio_Branco",start:4337326,end:4337954},{filename:"/tmp/pglite/share/postgresql/timezone/America/Rosario",start:4337954,end:4339030},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santa_Isabel",start:4339030,end:4341488},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santarem",start:4341488,end:4342090},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santiago",start:4342090,end:4344619},{filename:"/tmp/pglite/share/postgresql/timezone/America/Santo_Domingo",start:4344619,end:4345077},{filename:"/tmp/pglite/share/postgresql/timezone/America/Sao_Paulo",start:4345077,end:4346521},{filename:"/tmp/pglite/share/postgresql/timezone/America/Scoresbysund",start:4346521,end:4348470},{filename:"/tmp/pglite/share/postgresql/timezone/America/Shiprock",start:4348470,end:4350930},{filename:"/tmp/pglite/share/postgresql/timezone/America/Sitka",start:4350930,end:4353259},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Barthelemy",start:4353259,end:4353505},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Johns",start:4353505,end:4357160},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Kitts",start:4357160,end:4357406},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Lucia",start:4357406,end:4357652},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Thomas",start:4357652,end:4357898},{filename:"/tmp/pglite/share/postgresql/timezone/America/St_Vincent",start:4357898,end:4358144},{filename:"/tmp/pglite/share/postgresql/timezone/America/Swift_Current",start:4358144,end:4358704},{filename:"/tmp/pglite/share/postgresql/timezone/America/Tegucigalpa",start:4358704,end:4358956},{filename:"/tmp/pglite/share/postgresql/timezone/America/Thule",start:4358956,end:4360458},{filename:"/tmp/pglite/share/postgresql/timezone/America/Thunder_Bay",start:4360458,end:4363952},{filename:"/tmp/pglite/share/postgresql/timezone/America/Tijuana",start:4363952,end:4366410},{filename:"/tmp/pglite/share/postgresql/timezone/America/Toronto",start:4366410,end:4369904},{filename:"/tmp/pglite/share/postgresql/timezone/America/Tortola",start:4369904,end:4370150},{filename:"/tmp/pglite/share/postgresql/timezone/America/Vancouver",start:4370150,end:4373042},{filename:"/tmp/pglite/share/postgresql/timezone/America/Virgin",start:4373042,end:4373288},{filename:"/tmp/pglite/share/postgresql/timezone/America/Whitehorse",start:4373288,end:4374902},{filename:"/tmp/pglite/share/postgresql/timezone/America/Winnipeg",start:4374902,end:4377770},{filename:"/tmp/pglite/share/postgresql/timezone/America/Yakutat",start:4377770,end:4380075},{filename:"/tmp/pglite/share/postgresql/timezone/America/Yellowknife",start:4380075,end:4382407},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Casey",start:4382407,end:4382844},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Davis",start:4382844,end:4383141},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/DumontDUrville",start:4383141,end:4383327},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Macquarie",start:4383327,end:4385587},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Mawson",start:4385587,end:4385786},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/McMurdo",start:4385786,end:4388223},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Palmer",start:4388223,end:4389641},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Rothera",start:4389641,end:4389805},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/South_Pole",start:4389805,end:4392242},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Syowa",start:4392242,end:4392407},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Troll",start:4392407,end:4393569},{filename:"/tmp/pglite/share/postgresql/timezone/Antarctica/Vostok",start:4393569,end:4393796},{filename:"/tmp/pglite/share/postgresql/timezone/Arctic/Longyearbyen",start:4393796,end:4396094},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Aden",start:4396094,end:4396259},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Almaty",start:4396259,end:4397256},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Amman",start:4397256,end:4398703},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Anadyr",start:4398703,end:4399891},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Aqtau",start:4399891,end:4400874},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Aqtobe",start:4400874,end:4401885},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ashgabat",start:4401885,end:4402504},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ashkhabad",start:4402504,end:4403123},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Atyrau",start:4403123,end:4404114},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Baghdad",start:4404114,end:4405097},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Bahrain",start:4405097,end:4405296},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Baku",start:4405296,end:4406523},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Bangkok",start:4406523,end:4406722},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Barnaul",start:4406722,end:4407943},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Beirut",start:4407943,end:4410097},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Bishkek",start:4410097,end:4411080},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Brunei",start:4411080,end:4411563},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Calcutta",start:4411563,end:4411848},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Chita",start:4411848,end:4413069},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Choibalsan",start:4413069,end:4413960},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Chongqing",start:4413960,end:4414521},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Chungking",start:4414521,end:4415082},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Colombo",start:4415082,end:4415454},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dacca",start:4415454,end:4415791},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Damascus",start:4415791,end:4417678},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dhaka",start:4417678,end:4418015},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dili",start:4418015,end:4418286},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dubai",start:4418286,end:4418451},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Dushanbe",start:4418451,end:4419042},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Famagusta",start:4419042,end:4421070},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Gaza",start:4421070,end:4424914},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Harbin",start:4424914,end:4425475},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Hebron",start:4425475,end:4429347},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ho_Chi_Minh",start:4429347,end:4429698},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Hong_Kong",start:4429698,end:4430931},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Hovd",start:4430931,end:4431822},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Irkutsk",start:4431822,end:4433065},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Istanbul",start:4433065,end:4435012},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Jakarta",start:4435012,end:4435395},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Jayapura",start:4435395,end:4435616},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Jerusalem",start:4435616,end:4438004},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kabul",start:4438004,end:4438212},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kamchatka",start:4438212,end:4439378},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Karachi",start:4439378,end:4439757},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kashgar",start:4439757,end:4439922},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kathmandu",start:4439922,end:4440134},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Katmandu",start:4440134,end:4440346},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Khandyga",start:4440346,end:4441617},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kolkata",start:4441617,end:4441902},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Krasnoyarsk",start:4441902,end:4443109},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kuala_Lumpur",start:4443109,end:4443524},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kuching",start:4443524,end:4444007},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Kuwait",start:4444007,end:4444172},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Macao",start:4444172,end:4445399},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Macau",start:4445399,end:4446626},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Magadan",start:4446626,end:4447848},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Makassar",start:4447848,end:4448102},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Manila",start:4448102,end:4448524},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Muscat",start:4448524,end:4448689},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Nicosia",start:4448689,end:4450691},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Novokuznetsk",start:4450691,end:4451856},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Novosibirsk",start:4451856,end:4453077},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Omsk",start:4453077,end:4454284},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Oral",start:4454284,end:4455289},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Phnom_Penh",start:4455289,end:4455488},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Pontianak",start:4455488,end:4455841},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Pyongyang",start:4455841,end:4456078},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Qatar",start:4456078,end:4456277},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Qostanay",start:4456277,end:4457316},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Qyzylorda",start:4457316,end:4458341},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Rangoon",start:4458341,end:4458609},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Riyadh",start:4458609,end:4458774},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Saigon",start:4458774,end:4459125},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Sakhalin",start:4459125,end:4460327},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Samarkand",start:4460327,end:4460904},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Seoul",start:4460904,end:4461521},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Shanghai",start:4461521,end:4462082},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Singapore",start:4462082,end:4462497},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Srednekolymsk",start:4462497,end:4463705},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Taipei",start:4463705,end:4464466},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tashkent",start:4464466,end:4465057},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tbilisi",start:4465057,end:4466092},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tehran",start:4466092,end:4467354},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tel_Aviv",start:4467354,end:4469742},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Thimbu",start:4469742,end:4469945},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Thimphu",start:4469945,end:4470148},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tokyo",start:4470148,end:4470457},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Tomsk",start:4470457,end:4471678},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ujung_Pandang",start:4471678,end:4471932},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ulaanbaatar",start:4471932,end:4472823},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ulan_Bator",start:4472823,end:4473714},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Urumqi",start:4473714,end:4473879},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Ust-Nera",start:4473879,end:4475131},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Vientiane",start:4475131,end:4475330},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Vladivostok",start:4475330,end:4476538},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yakutsk",start:4476538,end:4477745},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yangon",start:4477745,end:4478013},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yekaterinburg",start:4478013,end:4479256},{filename:"/tmp/pglite/share/postgresql/timezone/Asia/Yerevan",start:4479256,end:4480407},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Azores",start:4480407,end:4483863},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Bermuda",start:4483863,end:4486259},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Canary",start:4486259,end:4488156},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Cape_Verde",start:4488156,end:4488426},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Faeroe",start:4488426,end:4490241},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Faroe",start:4490241,end:4492056},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Jan_Mayen",start:4492056,end:4494354},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Madeira",start:4494354,end:4497731},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Reykjavik",start:4497731,end:4497879},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/South_Georgia",start:4497879,end:4498043},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/St_Helena",start:4498043,end:4498191},{filename:"/tmp/pglite/share/postgresql/timezone/Atlantic/Stanley",start:4498191,end:4499405},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/ACT",start:4499405,end:4501595},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Adelaide",start:4501595,end:4503803},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Brisbane",start:4503803,end:4504222},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Broken_Hill",start:4504222,end:4506451},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Canberra",start:4506451,end:4508641},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Currie",start:4508641,end:4510999},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Darwin",start:4510999,end:4511324},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Eucla",start:4511324,end:4511794},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Hobart",start:4511794,end:4514152},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/LHI",start:4514152,end:4516012},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Lindeman",start:4516012,end:4516487},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Lord_Howe",start:4516487,end:4518347},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Melbourne",start:4518347,end:4520537},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/NSW",start:4520537,end:4522727},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/North",start:4522727,end:4523052},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Perth",start:4523052,end:4523498},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Queensland",start:4523498,end:4523917},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/South",start:4523917,end:4526125},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Sydney",start:4526125,end:4528315},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Tasmania",start:4528315,end:4530673},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Victoria",start:4530673,end:4532863},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/West",start:4532863,end:4533309},{filename:"/tmp/pglite/share/postgresql/timezone/Australia/Yancowinna",start:4533309,end:4535538},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/Acre",start:4535538,end:4536166},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/DeNoronha",start:4536166,end:4536882},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/East",start:4536882,end:4538326},{filename:"/tmp/pglite/share/postgresql/timezone/Brazil/West",start:4538326,end:4538930},{filename:"/tmp/pglite/share/postgresql/timezone/CET",start:4538930,end:4541863},{filename:"/tmp/pglite/share/postgresql/timezone/CST6CDT",start:4541863,end:4545455},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Atlantic",start:4545455,end:4548879},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Central",start:4548879,end:4551747},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Eastern",start:4551747,end:4555241},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Mountain",start:4555241,end:4557573},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Newfoundland",start:4557573,end:4561228},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Pacific",start:4561228,end:4564120},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Saskatchewan",start:4564120,end:4565100},{filename:"/tmp/pglite/share/postgresql/timezone/Canada/Yukon",start:4565100,end:4566714},{filename:"/tmp/pglite/share/postgresql/timezone/Chile/Continental",start:4566714,end:4569243},{filename:"/tmp/pglite/share/postgresql/timezone/Chile/EasterIsland",start:4569243,end:4571476},{filename:"/tmp/pglite/share/postgresql/timezone/Cuba",start:4571476,end:4573892},{filename:"/tmp/pglite/share/postgresql/timezone/EET",start:4573892,end:4576154},{filename:"/tmp/pglite/share/postgresql/timezone/EST",start:4576154,end:4576336},{filename:"/tmp/pglite/share/postgresql/timezone/EST5EDT",start:4576336,end:4579888},{filename:"/tmp/pglite/share/postgresql/timezone/Egypt",start:4579888,end:4582287},{filename:"/tmp/pglite/share/postgresql/timezone/Eire",start:4582287,end:4585779},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT",start:4585779,end:4585893},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+0",start:4585893,end:4586007},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+1",start:4586007,end:4586123},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+10",start:4586123,end:4586240},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+11",start:4586240,end:4586357},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+12",start:4586357,end:4586474},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+2",start:4586474,end:4586590},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+3",start:4586590,end:4586706},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+4",start:4586706,end:4586822},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+5",start:4586822,end:4586938},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+6",start:4586938,end:4587054},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+7",start:4587054,end:4587170},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+8",start:4587170,end:4587286},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT+9",start:4587286,end:4587402},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-0",start:4587402,end:4587516},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-1",start:4587516,end:4587633},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-10",start:4587633,end:4587751},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-11",start:4587751,end:4587869},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-12",start:4587869,end:4587987},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-13",start:4587987,end:4588105},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-14",start:4588105,end:4588223},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-2",start:4588223,end:4588340},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-3",start:4588340,end:4588457},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-4",start:4588457,end:4588574},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-5",start:4588574,end:4588691},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-6",start:4588691,end:4588808},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-7",start:4588808,end:4588925},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-8",start:4588925,end:4589042},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT-9",start:4589042,end:4589159},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/GMT0",start:4589159,end:4589273},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/Greenwich",start:4589273,end:4589387},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/UCT",start:4589387,end:4589501},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/UTC",start:4589501,end:4589615},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/Universal",start:4589615,end:4589729},{filename:"/tmp/pglite/share/postgresql/timezone/Etc/Zulu",start:4589729,end:4589843},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Amsterdam",start:4589843,end:4592776},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Andorra",start:4592776,end:4594518},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Astrakhan",start:4594518,end:4595683},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Athens",start:4595683,end:4597945},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Belfast",start:4597945,end:4601609},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Belgrade",start:4601609,end:4603529},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Berlin",start:4603529,end:4605827},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Bratislava",start:4605827,end:4608128},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Brussels",start:4608128,end:4611061},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Bucharest",start:4611061,end:4613245},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Budapest",start:4613245,end:4615613},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Busingen",start:4615613,end:4617522},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Chisinau",start:4617522,end:4619912},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Copenhagen",start:4619912,end:4622210},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Dublin",start:4622210,end:4625702},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Gibraltar",start:4625702,end:4628770},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Guernsey",start:4628770,end:4632434},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Helsinki",start:4632434,end:4634334},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Isle_of_Man",start:4634334,end:4637998},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Istanbul",start:4637998,end:4639945},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Jersey",start:4639945,end:4643609},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kaliningrad",start:4643609,end:4645102},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kiev",start:4645102,end:4647222},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kirov",start:4647222,end:4648407},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Kyiv",start:4648407,end:4650527},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Lisbon",start:4650527,end:4654054},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Ljubljana",start:4654054,end:4655974},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/London",start:4655974,end:4659638},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Luxembourg",start:4659638,end:4662571},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Madrid",start:4662571,end:4665185},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Malta",start:4665185,end:4667805},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Mariehamn",start:4667805,end:4669705},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Minsk",start:4669705,end:4671026},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Monaco",start:4671026,end:4673988},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Moscow",start:4673988,end:4675523},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Nicosia",start:4675523,end:4677525},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Oslo",start:4677525,end:4679823},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Paris",start:4679823,end:4682785},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Podgorica",start:4682785,end:4684705},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Prague",start:4684705,end:4687006},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Riga",start:4687006,end:4689204},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Rome",start:4689204,end:4691845},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Samara",start:4691845,end:4693060},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/San_Marino",start:4693060,end:4695701},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Sarajevo",start:4695701,end:4697621},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Saratov",start:4697621,end:4698804},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Simferopol",start:4698804,end:4700273},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Skopje",start:4700273,end:4702193},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Sofia",start:4702193,end:4704270},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Stockholm",start:4704270,end:4706568},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Tallinn",start:4706568,end:4708716},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Tirane",start:4708716,end:4710800},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Tiraspol",start:4710800,end:4713190},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Ulyanovsk",start:4713190,end:4714457},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Uzhgorod",start:4714457,end:4716577},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vaduz",start:4716577,end:4718486},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vatican",start:4718486,end:4721127},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vienna",start:4721127,end:4723327},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Vilnius",start:4723327,end:4725489},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Volgograd",start:4725489,end:4726682},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Warsaw",start:4726682,end:4729336},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Zagreb",start:4729336,end:4731256},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Zaporozhye",start:4731256,end:4733376},{filename:"/tmp/pglite/share/postgresql/timezone/Europe/Zurich",start:4733376,end:4735285},{filename:"/tmp/pglite/share/postgresql/timezone/Factory",start:4735285,end:4735401},{filename:"/tmp/pglite/share/postgresql/timezone/GB",start:4735401,end:4739065},{filename:"/tmp/pglite/share/postgresql/timezone/GB-Eire",start:4739065,end:4742729},{filename:"/tmp/pglite/share/postgresql/timezone/GMT",start:4742729,end:4742843},{filename:"/tmp/pglite/share/postgresql/timezone/GMT+0",start:4742843,end:4742957},{filename:"/tmp/pglite/share/postgresql/timezone/GMT-0",start:4742957,end:4743071},{filename:"/tmp/pglite/share/postgresql/timezone/GMT0",start:4743071,end:4743185},{filename:"/tmp/pglite/share/postgresql/timezone/Greenwich",start:4743185,end:4743299},{filename:"/tmp/pglite/share/postgresql/timezone/HST",start:4743299,end:4743628},{filename:"/tmp/pglite/share/postgresql/timezone/Hongkong",start:4743628,end:4744861},{filename:"/tmp/pglite/share/postgresql/timezone/Iceland",start:4744861,end:4745009},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Antananarivo",start:4745009,end:4745274},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Chagos",start:4745274,end:4745473},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Christmas",start:4745473,end:4745672},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Cocos",start:4745672,end:4745940},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Comoro",start:4745940,end:4746205},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Kerguelen",start:4746205,end:4746404},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Mahe",start:4746404,end:4746569},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Maldives",start:4746569,end:4746768},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Mauritius",start:4746768,end:4747009},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Mayotte",start:4747009,end:4747274},{filename:"/tmp/pglite/share/postgresql/timezone/Indian/Reunion",start:4747274,end:4747439},{filename:"/tmp/pglite/share/postgresql/timezone/Iran",start:4747439,end:4748701},{filename:"/tmp/pglite/share/postgresql/timezone/Israel",start:4748701,end:4751089},{filename:"/tmp/pglite/share/postgresql/timezone/Jamaica",start:4751089,end:4751571},{filename:"/tmp/pglite/share/postgresql/timezone/Japan",start:4751571,end:4751880},{filename:"/tmp/pglite/share/postgresql/timezone/Kwajalein",start:4751880,end:4752196},{filename:"/tmp/pglite/share/postgresql/timezone/Libya",start:4752196,end:4752821},{filename:"/tmp/pglite/share/postgresql/timezone/MET",start:4752821,end:4755754},{filename:"/tmp/pglite/share/postgresql/timezone/MST",start:4755754,end:4756114},{filename:"/tmp/pglite/share/postgresql/timezone/MST7MDT",start:4756114,end:4758574},{filename:"/tmp/pglite/share/postgresql/timezone/Mexico/BajaNorte",start:4758574,end:4761032},{filename:"/tmp/pglite/share/postgresql/timezone/Mexico/BajaSur",start:4761032,end:4762092},{filename:"/tmp/pglite/share/postgresql/timezone/Mexico/General",start:4762092,end:4763314},{filename:"/tmp/pglite/share/postgresql/timezone/NZ",start:4763314,end:4765751},{filename:"/tmp/pglite/share/postgresql/timezone/NZ-CHAT",start:4765751,end:4767819},{filename:"/tmp/pglite/share/postgresql/timezone/Navajo",start:4767819,end:4770279},{filename:"/tmp/pglite/share/postgresql/timezone/PRC",start:4770279,end:4770840},{filename:"/tmp/pglite/share/postgresql/timezone/PST8PDT",start:4770840,end:4773692},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Apia",start:4773692,end:4774304},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Auckland",start:4774304,end:4776741},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Bougainville",start:4776741,end:4777009},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Chatham",start:4777009,end:4779077},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Chuuk",start:4779077,end:4779263},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Easter",start:4779263,end:4781496},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Efate",start:4781496,end:4782034},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Enderbury",start:4782034,end:4782268},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Fakaofo",start:4782268,end:4782468},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Fiji",start:4782468,end:4783046},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Funafuti",start:4783046,end:4783212},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Galapagos",start:4783212,end:4783450},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Gambier",start:4783450,end:4783614},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Guadalcanal",start:4783614,end:4783780},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Guam",start:4783780,end:4784274},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Honolulu",start:4784274,end:4784603},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Johnston",start:4784603,end:4784932},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kanton",start:4784932,end:4785166},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kiritimati",start:4785166,end:4785404},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kosrae",start:4785404,end:4785755},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Kwajalein",start:4785755,end:4786071},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Majuro",start:4786071,end:4786237},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Marquesas",start:4786237,end:4786410},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Midway",start:4786410,end:4786585},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Nauru",start:4786585,end:4786837},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Niue",start:4786837,end:4787040},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Norfolk",start:4787040,end:4787920},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Noumea",start:4787920,end:4788224},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Pago_Pago",start:4788224,end:4788399},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Palau",start:4788399,end:4788579},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Pitcairn",start:4788579,end:4788781},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Pohnpei",start:4788781,end:4788947},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Ponape",start:4788947,end:4789113},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Port_Moresby",start:4789113,end:4789299},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Rarotonga",start:4789299,end:4789902},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Saipan",start:4789902,end:4790396},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Samoa",start:4790396,end:4790571},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Tahiti",start:4790571,end:4790736},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Tarawa",start:4790736,end:4790902},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Tongatapu",start:4790902,end:4791274},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Truk",start:4791274,end:4791460},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Wake",start:4791460,end:4791626},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Wallis",start:4791626,end:4791792},{filename:"/tmp/pglite/share/postgresql/timezone/Pacific/Yap",start:4791792,end:4791978},{filename:"/tmp/pglite/share/postgresql/timezone/Poland",start:4791978,end:4794632},{filename:"/tmp/pglite/share/postgresql/timezone/Portugal",start:4794632,end:4798159},{filename:"/tmp/pglite/share/postgresql/timezone/ROC",start:4798159,end:4798920},{filename:"/tmp/pglite/share/postgresql/timezone/ROK",start:4798920,end:4799537},{filename:"/tmp/pglite/share/postgresql/timezone/Singapore",start:4799537,end:4799952},{filename:"/tmp/pglite/share/postgresql/timezone/Turkey",start:4799952,end:4801899},{filename:"/tmp/pglite/share/postgresql/timezone/UCT",start:4801899,end:4802013},{filename:"/tmp/pglite/share/postgresql/timezone/US/Alaska",start:4802013,end:4804384},{filename:"/tmp/pglite/share/postgresql/timezone/US/Aleutian",start:4804384,end:4806740},{filename:"/tmp/pglite/share/postgresql/timezone/US/Arizona",start:4806740,end:4807100},{filename:"/tmp/pglite/share/postgresql/timezone/US/Central",start:4807100,end:4810692},{filename:"/tmp/pglite/share/postgresql/timezone/US/East-Indiana",start:4810692,end:4812374},{filename:"/tmp/pglite/share/postgresql/timezone/US/Eastern",start:4812374,end:4815926},{filename:"/tmp/pglite/share/postgresql/timezone/US/Hawaii",start:4815926,end:4816255},{filename:"/tmp/pglite/share/postgresql/timezone/US/Indiana-Starke",start:4816255,end:4818699},{filename:"/tmp/pglite/share/postgresql/timezone/US/Michigan",start:4818699,end:4820929},{filename:"/tmp/pglite/share/postgresql/timezone/US/Mountain",start:4820929,end:4823389},{filename:"/tmp/pglite/share/postgresql/timezone/US/Pacific",start:4823389,end:4826241},{filename:"/tmp/pglite/share/postgresql/timezone/US/Samoa",start:4826241,end:4826416},{filename:"/tmp/pglite/share/postgresql/timezone/UTC",start:4826416,end:4826530},{filename:"/tmp/pglite/share/postgresql/timezone/Universal",start:4826530,end:4826644},{filename:"/tmp/pglite/share/postgresql/timezone/W-SU",start:4826644,end:4828179},{filename:"/tmp/pglite/share/postgresql/timezone/WET",start:4828179,end:4831706},{filename:"/tmp/pglite/share/postgresql/timezone/Zulu",start:4831706,end:4831820},{filename:"/tmp/pglite/share/postgresql/timezonesets/Africa.txt",start:4831820,end:4838793},{filename:"/tmp/pglite/share/postgresql/timezonesets/America.txt",start:4838793,end:4849800},{filename:"/tmp/pglite/share/postgresql/timezonesets/Antarctica.txt",start:4849800,end:4850934},{filename:"/tmp/pglite/share/postgresql/timezonesets/Asia.txt",start:4850934,end:4859245},{filename:"/tmp/pglite/share/postgresql/timezonesets/Atlantic.txt",start:4859245,end:4862778},{filename:"/tmp/pglite/share/postgresql/timezonesets/Australia",start:4862778,end:4863913},{filename:"/tmp/pglite/share/postgresql/timezonesets/Australia.txt",start:4863913,end:4867297},{filename:"/tmp/pglite/share/postgresql/timezonesets/Default",start:4867297,end:4894511},{filename:"/tmp/pglite/share/postgresql/timezonesets/Etc.txt",start:4894511,end:4895761},{filename:"/tmp/pglite/share/postgresql/timezonesets/Europe.txt",start:4895761,end:4904507},{filename:"/tmp/pglite/share/postgresql/timezonesets/India",start:4904507,end:4905100},{filename:"/tmp/pglite/share/postgresql/timezonesets/Indian.txt",start:4905100,end:4906361},{filename:"/tmp/pglite/share/postgresql/timezonesets/Pacific.txt",start:4906361,end:4910129},{filename:"/tmp/pglite/share/postgresql/tsearch_data/danish.stop",start:4910129,end:4910553},{filename:"/tmp/pglite/share/postgresql/tsearch_data/dutch.stop",start:4910553,end:4911006},{filename:"/tmp/pglite/share/postgresql/tsearch_data/english.stop",start:4911006,end:4911628},{filename:"/tmp/pglite/share/postgresql/tsearch_data/finnish.stop",start:4911628,end:4913207},{filename:"/tmp/pglite/share/postgresql/tsearch_data/french.stop",start:4913207,end:4914012},{filename:"/tmp/pglite/share/postgresql/tsearch_data/german.stop",start:4914012,end:4915361},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hungarian.stop",start:4915361,end:4916588},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample.affix",start:4916588,end:4916831},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_long.affix",start:4916831,end:4917464},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_long.dict",start:4917464,end:4917562},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_num.affix",start:4917562,end:4918024},{filename:"/tmp/pglite/share/postgresql/tsearch_data/hunspell_sample_num.dict",start:4918024,end:4918153},{filename:"/tmp/pglite/share/postgresql/tsearch_data/ispell_sample.affix",start:4918153,end:4918618},{filename:"/tmp/pglite/share/postgresql/tsearch_data/ispell_sample.dict",start:4918618,end:4918699},{filename:"/tmp/pglite/share/postgresql/tsearch_data/italian.stop",start:4918699,end:4920353},{filename:"/tmp/pglite/share/postgresql/tsearch_data/nepali.stop",start:4920353,end:4924614},{filename:"/tmp/pglite/share/postgresql/tsearch_data/norwegian.stop",start:4924614,end:4925465},{filename:"/tmp/pglite/share/postgresql/tsearch_data/portuguese.stop",start:4925465,end:4926732},{filename:"/tmp/pglite/share/postgresql/tsearch_data/russian.stop",start:4926732,end:4927967},{filename:"/tmp/pglite/share/postgresql/tsearch_data/spanish.stop",start:4927967,end:4930145},{filename:"/tmp/pglite/share/postgresql/tsearch_data/swedish.stop",start:4930145,end:4930704},{filename:"/tmp/pglite/share/postgresql/tsearch_data/synonym_sample.syn",start:4930704,end:4930777},{filename:"/tmp/pglite/share/postgresql/tsearch_data/thesaurus_sample.ths",start:4930777,end:4931250},{filename:"/tmp/pglite/share/postgresql/tsearch_data/turkish.stop",start:4931250,end:4931510},{filename:"/tmp/pglite/share/postgresql/tsearch_data/unaccent.rules",start:4931510,end:4941513},{filename:"/tmp/pglite/share/postgresql/tsearch_data/xsyn_sample.rules",start:4941513,end:4941652}],remote_package_size:4941652})})();var moduleOverrides=Object.assign({},Module),arguments_=[],thisProgram="./this.program",quit_=(k,e)=>{throw e},scriptDirectory="";function locateFile(k){return Module.locateFile?Module.locateFile(k,scriptDirectory):scriptDirectory+k}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs"),nodePath=require("path");import.meta.url.startsWith("data:")||(scriptDirectory=nodePath.dirname(require("url").fileURLToPath(import.meta.url))+"/"),readBinary=k=>{k=isFileURI(k)?new URL(k):k;var e=fs.readFileSync(k);return e},readAsync=async(k,e=!0)=>{k=isFileURI(k)?new URL(k):k;var I=fs.readFileSync(k,e?void 0:"utf8");return I},!Module.thisProgram&&process$1.argv.length>1&&(thisProgram=process$1.argv[1].replace(/\\/g,"/")),arguments_=process$1.argv.slice(2),quit_=(k,e)=>{throw process$1.exitCode=k,e}}else(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:typeof document<"u"&&document.currentScript&&(scriptDirectory=document.currentScript.src),_scriptName&&(scriptDirectory=_scriptName),scriptDirectory.startsWith("blob:")?scriptDirectory="":scriptDirectory=scriptDirectory.substr(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1),readAsync=async k=>{var e=await fetch(k,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw new Error(e.status+" : "+e.url)});var out=Module.print||console.log.bind(console),err=Module.printErr||console.error.bind(console);Object.assign(Module,moduleOverrides),moduleOverrides=null,Module.arguments&&(arguments_=Module.arguments),Module.thisProgram&&(thisProgram=Module.thisProgram);var dynamicLibraries=Module.dynamicLibraries||[],wasmBinary=Module.wasmBinary,wasmMemory,ABORT=!1,EXITSTATUS;function assert(k,e){k||abort(e)}var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPF64;function updateMemoryViews(){var k=wasmMemory.buffer;Module.HEAP8=HEAP8=new Int8Array(k),Module.HEAP16=HEAP16=new Int16Array(k),Module.HEAPU8=HEAPU8=new Uint8Array(k),Module.HEAPU16=HEAPU16=new Uint16Array(k),Module.HEAP32=HEAP32=new Int32Array(k),Module.HEAPU32=HEAPU32=new Uint32Array(k),Module.HEAPF32=HEAPF32=new Float32Array(k),Module.HEAPF64=HEAPF64=new Float64Array(k),Module.HEAP64=HEAP64=new BigInt64Array(k),Module.HEAPU64=new BigUint64Array(k)}if(Module.wasmMemory)wasmMemory=Module.wasmMemory;else{var INITIAL_MEMORY=Module.INITIAL_MEMORY||16777216;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:32768})}updateMemoryViews();var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATPOSTRUN__=[],__RELOC_FUNCS__=[],runtimeInitialized=!1;function preRun(){if(Module.preRun)for(typeof Module.preRun=="function"&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=!0,callRuntimeCallbacks(__RELOC_FUNCS__),!Module.noFSInit&&!FS.initialized&&FS.init(),FS.ignorePermissions=!1,SOCKFS.root=FS.mount(SOCKFS,{},null),PIPEFS.root=FS.mount(PIPEFS,{},null),callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function postRun(){if(Module.postRun)for(typeof Module.postRun=="function"&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(k){__ATPRERUN__.unshift(k)}function addOnInit(k){__ATINIT__.unshift(k)}function addOnPostRun(k){__ATPOSTRUN__.unshift(k)}var runDependencies=0,dependenciesFulfilled=null;function addRunDependency(k){runDependencies++,Module.monitorRunDependencies?.(runDependencies)}function removeRunDependency(k){if(runDependencies--,Module.monitorRunDependencies?.(runDependencies),runDependencies==0&&dependenciesFulfilled){var e=dependenciesFulfilled;dependenciesFulfilled=null,e()}}function abort(k){Module.onAbort?.(k),k="Aborted("+k+")",err(k),ABORT=!0,k+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(k);throw readyPromiseReject(e),e}var dataURIPrefix="data:application/octet-stream;base64,",isDataURI=k=>k.startsWith(dataURIPrefix),isFileURI=k=>k.startsWith("file://");function findWasmBinary(){if(Module.locateFile){var k="pglite.wasm";return isDataURI(k)?k:locateFile(k)}return new URL("/NoLLMChat/assets/pglite-DlIz6flT.wasm",import.meta.url).href}var wasmBinaryFile;function getBinarySync(k){if(k==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(k);throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(k){if(!wasmBinary)try{var e=await readAsync(k);return new Uint8Array(e)}catch{}return getBinarySync(k)}async function instantiateArrayBuffer(k,e){try{var I=await getWasmBinary(k),B=await WebAssembly.instantiate(I,e);return B}catch(tr){err(`failed to asynchronously prepare wasm: ${tr}`),abort(tr)}}async function instantiateAsync(k,e,I){if(!k&&typeof WebAssembly.instantiateStreaming=="function"&&!isDataURI(e)&&!ENVIRONMENT_IS_NODE&&typeof fetch=="function")try{var B=fetch(e,{credentials:"same-origin"}),tr=await WebAssembly.instantiateStreaming(B,I);return tr}catch(rr){err(`wasm streaming compile failed: ${rr}`),err("falling back to ArrayBuffer instantiation")}return instantiateArrayBuffer(e,I)}function getWasmImports(){return{env:wasmImports,wasi_snapshot_preview1:wasmImports,"GOT.mem":new Proxy(wasmImports,GOTHandler),"GOT.func":new Proxy(wasmImports,GOTHandler)}}async function createWasm(){function k(tr,rr){wasmExports=tr.exports,wasmExports=relocateExports(wasmExports,12582912);var ir=getDylinkMetadata(rr);return ir.neededDynlibs&&(dynamicLibraries=ir.neededDynlibs.concat(dynamicLibraries)),mergeLibSymbols(wasmExports),LDSO.init(),loadDylibs(),addOnInit(wasmExports.__wasm_call_ctors),__RELOC_FUNCS__.push(wasmExports.__wasm_apply_data_relocs),removeRunDependency(),wasmExports}addRunDependency();function e(tr){k(tr.instance,tr.module)}var I=getWasmImports();if(Module.instantiateWasm)try{return Module.instantiateWasm(I,k)}catch(tr){err(`Module.instantiateWasm callback failed with error: ${tr}`),readyPromiseReject(tr)}wasmBinaryFile??(wasmBinaryFile=findWasmBinary());try{var B=await instantiateAsync(wasmBinary,wasmBinaryFile,I);return e(B),B}catch(tr){readyPromiseReject(tr);return}}var ASM_CONSTS={15161036:k=>{Module.is_worker=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Module.FD_BUFFER_MAX=k,Module.emscripten_copy_to=console.warn},15161208:()=>{Module.postMessage=function(k){console.log("# pg_main_emsdk.c:544: onCustomMessage:",k)}},15161337:()=>{if(Module.is_worker){let k=function(e){console.log("onCustomMessage:",e)};Module.onCustomMessage=k}else Module.postMessage=function(k){switch(k.type){case"raw":break;case"stdin":{stringToUTF8(k.data,1,Module.FD_BUFFER_MAX);break}case"rcon":break;default:console.warn("custom_postMessage?",k)}}}};class ExitStatus{constructor(e){P$1(this,"name","ExitStatus"),this.message=`Program terminated with exit(${e})`,this.status=e}}var GOT={},currentModuleWeakSymbols=new Set([]),GOTHandler={get(k,e){var I=GOT[e];return I||(I=GOT[e]=new WebAssembly.Global({value:"i32",mutable:!0})),currentModuleWeakSymbols.has(e)||(I.required=!0),I}},callRuntimeCallbacks=k=>{for(;k.length>0;)k.shift()(Module)},UTF8Decoder=typeof TextDecoder<"u"?new TextDecoder:void 0,UTF8ArrayToString=(k,e=0,I=NaN)=>{for(var B=e+I,tr=e;k[tr]&&!(tr>=B);)++tr;if(tr-e>16&&k.buffer&&UTF8Decoder)return UTF8Decoder.decode(k.subarray(e,tr));for(var rr="";e<tr;){var ir=k[e++];if(!(ir&128)){rr+=String.fromCharCode(ir);continue}var lr=k[e++]&63;if((ir&224)==192){rr+=String.fromCharCode((ir&31)<<6|lr);continue}var dr=k[e++]&63;if((ir&240)==224?ir=(ir&15)<<12|lr<<6|dr:ir=(ir&7)<<18|lr<<12|dr<<6|k[e++]&63,ir<65536)rr+=String.fromCharCode(ir);else{var mr=ir-65536;rr+=String.fromCharCode(55296|mr>>10,56320|mr&1023)}}return rr},getDylinkMetadata=k=>{var e=0,I=0;function B(){return k[e++]}function tr(){for(var Lr=0,ts=1;;){var rs=k[e++];if(Lr+=(rs&127)*ts,ts*=128,!(rs&128))break}return Lr}function rr(){var Lr=tr();return e+=Lr,UTF8ArrayToString(k,e-Lr,Lr)}function ir(Lr,ts){if(Lr)throw new Error(ts)}var lr="dylink.0";if(k instanceof WebAssembly.Module){var dr=WebAssembly.Module.customSections(k,lr);dr.length===0&&(lr="dylink",dr=WebAssembly.Module.customSections(k,lr)),ir(dr.length===0,"need dylink section"),k=new Uint8Array(dr[0]),I=k.length}else{var mr=new Uint32Array(new Uint8Array(k.subarray(0,24)).buffer),hr=mr[0]==1836278016;ir(!hr,"need to see wasm magic number"),ir(k[8]!==0,"need the dylink section to be first"),e=9;var fr=tr();I=e+fr,lr=rr()}var _r={neededDynlibs:[],tlsExports:new Set,weakImports:new Set};if(lr=="dylink"){_r.memorySize=tr(),_r.memoryAlign=tr(),_r.tableSize=tr(),_r.tableAlign=tr();for(var gr=tr(),Sr=0;Sr<gr;++Sr){var Ar=rr();_r.neededDynlibs.push(Ar)}}else{ir(lr!=="dylink.0");for(var Or=1,Fr=2,vr=3,xr=4,kr=256,Gr=3,is=1;e<I;){var as=B(),cs=tr();if(as===Or)_r.memorySize=tr(),_r.memoryAlign=tr(),_r.tableSize=tr(),_r.tableAlign=tr();else if(as===Fr)for(var gr=tr(),Sr=0;Sr<gr;++Sr)Ar=rr(),_r.neededDynlibs.push(Ar);else if(as===vr)for(var es=tr();es--;){var ps=rr(),Ur=tr();Ur&kr&&_r.tlsExports.add(ps)}else if(as===xr)for(var es=tr();es--;){rr();var ps=rr(),Ur=tr();(Ur&Gr)==is&&_r.weakImports.add(ps)}else e+=cs}}return _r};function getValue(k,e="i8"){switch(e.endsWith("*")&&(e="*"),e){case"i1":return HEAP8[k];case"i8":return HEAP8[k];case"i16":return HEAP16[k>>1];case"i32":return HEAP32[k>>2];case"i64":return HEAP64[k>>3];case"float":return HEAPF32[k>>2];case"double":return HEAPF64[k>>3];case"*":return HEAPU32[k>>2];default:abort(`invalid type for getValue: ${e}`)}}var newDSO=(k,e,I)=>{var B={refcount:1/0,name:k,exports:I,global:!0};return LDSO.loadedLibsByName[k]=B,e!=null&&(LDSO.loadedLibsByHandle[e]=B),B},LDSO={loadedLibsByName:{},loadedLibsByHandle:{},init(){newDSO("__main__",0,wasmImports)}},___heap_base=15394512,alignMemory=(k,e)=>Math.ceil(k/e)*e,getMemory=k=>{if(runtimeInitialized)return _calloc(k,1);var e=___heap_base,I=e+alignMemory(k,16);return ___heap_base=I,GOT.__heap_base.value=I,e},isInternalSym=k=>["__cpp_exception","__c_longjmp","__wasm_apply_data_relocs","__dso_handle","__tls_size","__tls_align","__set_stack_limits","_emscripten_tls_init","__wasm_init_tls","__wasm_call_ctors","__start_em_asm","__stop_em_asm","__start_em_js","__stop_em_js"].includes(k)||k.startsWith("__em_js__"),uleb128Encode=(k,e)=>{k<128?e.push(k):e.push(k%128|128,k>>7)},sigToWasmTypes=k=>{for(var e={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},I={parameters:[],results:k[0]=="v"?[]:[e[k[0]]]},B=1;B<k.length;++B)I.parameters.push(e[k[B]]);return I},generateFuncType=(k,e)=>{var I=k.slice(0,1),B=k.slice(1),tr={i:127,p:127,j:126,f:125,d:124,e:111};e.push(96),uleb128Encode(B.length,e);for(var rr=0;rr<B.length;++rr)e.push(tr[B[rr]]);I=="v"?e.push(0):e.push(1,tr[I])},convertJsFunctionToWasm=(k,e)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(sigToWasmTypes(e),k);var I=[1];generateFuncType(e,I);var B=[0,97,115,109,1,0,0,0,1];uleb128Encode(I.length,B),B.push(...I),B.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var tr=new WebAssembly.Module(new Uint8Array(B)),rr=new WebAssembly.Instance(tr,{e:{f:k}}),ir=rr.exports.f;return ir},wasmTable=new WebAssembly.Table({initial:5919,element:"anyfunc"}),getWasmTableEntry=k=>wasmTable.get(k),updateTableMap=(k,e)=>{if(functionsInTableMap)for(var I=k;I<k+e;I++){var B=getWasmTableEntry(I);B&&functionsInTableMap.set(B,I)}},functionsInTableMap,getFunctionAddress=k=>(functionsInTableMap||(functionsInTableMap=new WeakMap,updateTableMap(0,wasmTable.length)),functionsInTableMap.get(k)||0),freeTableIndexes=[],getEmptyTableSlot=()=>{if(freeTableIndexes.length)return freeTableIndexes.pop();try{wasmTable.grow(1)}catch(k){throw k instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":k}return wasmTable.length-1},setWasmTableEntry=(k,e)=>wasmTable.set(k,e),addFunction=(k,e)=>{var I=getFunctionAddress(k);if(I)return I;var B=getEmptyTableSlot();try{setWasmTableEntry(B,k)}catch(rr){if(!(rr instanceof TypeError))throw rr;var tr=convertJsFunctionToWasm(k,e);setWasmTableEntry(B,tr)}return functionsInTableMap.set(k,B),B},updateGOT=(k,e)=>{for(var I in k)if(!isInternalSym(I)){var B=k[I];GOT[I]||(GOT[I]=new WebAssembly.Global({value:"i32",mutable:!0})),GOT[I].value==0&&(typeof B=="function"?GOT[I].value=addFunction(B):typeof B=="number"?GOT[I].value=B:err(`unhandled export type for '${I}': ${typeof B}`))}},relocateExports=(k,e,I)=>{var B={};for(var tr in k){var rr=k[tr];typeof rr=="object"&&(rr=rr.value),typeof rr=="number"&&(rr+=e),B[tr]=rr}return updateGOT(B),B},isSymbolDefined=k=>{var e=wasmImports[k];return!(!e||e.stub)},dynCall=(k,e,I=[])=>{var B=getWasmTableEntry(e)(...I);return B},stackSave=()=>_emscripten_stack_get_current(),stackRestore=k=>__emscripten_stack_restore(k),createInvokeFunction=k=>(e,...I)=>{var B=stackSave();try{return dynCall(k,e,I)}catch(tr){if(stackRestore(B),tr!==tr+0)throw tr;if(_setThrew(1,0),k[0]=="j")return 0n}},resolveGlobalSymbol=(k,e=!1)=>{var I;return isSymbolDefined(k)?I=wasmImports[k]:k.startsWith("invoke_")&&(I=wasmImports[k]=createInvokeFunction(k.split("_")[1])),{sym:I,name:k}},UTF8ToString=(k,e)=>k?UTF8ArrayToString(HEAPU8,k,e):"",loadWebAssemblyModule=(binary,flags,libName,localScope,handle)=>{var metadata=getDylinkMetadata(binary);currentModuleWeakSymbols=metadata.weakImports;function loadModule(){var firstLoad=!handle||!HEAP8[handle+8];if(firstLoad){var memAlign=Math.pow(2,metadata.memoryAlign),memoryBase=metadata.memorySize?alignMemory(getMemory(metadata.memorySize+memAlign),memAlign):0,tableBase=metadata.tableSize?wasmTable.length:0;handle&&(HEAP8[handle+8]=1,HEAPU32[handle+12>>2]=memoryBase,HEAP32[handle+16>>2]=metadata.memorySize,HEAPU32[handle+20>>2]=tableBase,HEAP32[handle+24>>2]=metadata.tableSize)}else memoryBase=HEAPU32[handle+12>>2],tableBase=HEAPU32[handle+20>>2];var tableGrowthNeeded=tableBase+metadata.tableSize-wasmTable.length;tableGrowthNeeded>0&&wasmTable.grow(tableGrowthNeeded);var moduleExports;function resolveSymbol(k){var e=resolveGlobalSymbol(k).sym;return!e&&localScope&&(e=localScope[k]),e||(e=moduleExports[k]),e}var proxyHandler={get(k,e){switch(e){case"__memory_base":return memoryBase;case"__table_base":return tableBase}if(e in wasmImports&&!wasmImports[e].stub)return wasmImports[e];if(!(e in k)){var I;k[e]=(...B)=>{if(I||(I=resolveSymbol(e)),!I){if(e==="getTempRet0")return __emscripten_tempret_get(...B);throw new Error(`Dynamic linking error: cannot resolve symbol ${e}`)}return I(...B)}}return k[e]}},proxy=new Proxy({},proxyHandler),info={"GOT.mem":new Proxy({},GOTHandler),"GOT.func":new Proxy({},GOTHandler),env:proxy,wasi_snapshot_preview1:proxy};function postInstantiation(module,instance){updateTableMap(tableBase,metadata.tableSize),moduleExports=relocateExports(instance.exports,memoryBase),flags.allowUndefined||reportUndefinedSymbols();function addEmAsm(addr,body){for(var args=[],arity=0;arity<16&&body.indexOf("$"+arity)!=-1;arity++)args.push("$"+arity);args=args.join(",");var func=`(${args}) => { ${body} };`;ASM_CONSTS[start]=eval(func)}if("__start_em_asm"in moduleExports)for(var start=moduleExports.__start_em_asm,stop=moduleExports.__stop_em_asm;start<stop;){var jsString=UTF8ToString(start);addEmAsm(start,jsString),start=HEAPU8.indexOf(0,start)+1}function addEmJs(name,cSig,body){var jsArgs=[];if(cSig=cSig.slice(1,-1),cSig!="void"){cSig=cSig.split(",");for(var i in cSig){var jsArg=cSig[i].split(" ").pop();jsArgs.push(jsArg.replaceAll("*",""))}}var func=`(${jsArgs}) => ${body};`;moduleExports[name]=eval(func)}for(var name in moduleExports)if(name.startsWith("__em_js__")){var start=moduleExports[name],jsString=UTF8ToString(start),parts=jsString.split("<::>");addEmJs(name.replace("__em_js__",""),parts[0],parts[1]),delete moduleExports[name]}var applyRelocs=moduleExports.__wasm_apply_data_relocs;applyRelocs&&(runtimeInitialized?applyRelocs():__RELOC_FUNCS__.push(applyRelocs));var init=moduleExports.__wasm_call_ctors;return init&&(runtimeInitialized?init():__ATINIT__.push(init)),moduleExports}if(flags.loadAsync){if(binary instanceof WebAssembly.Module){var instance=new WebAssembly.Instance(binary,info);return Promise.resolve(postInstantiation(binary,instance))}return WebAssembly.instantiate(binary,info).then(k=>postInstantiation(k.module,k.instance))}var module=binary instanceof WebAssembly.Module?binary:new WebAssembly.Module(binary),instance=new WebAssembly.Instance(module,info);return postInstantiation(module,instance)}return flags.loadAsync?metadata.neededDynlibs.reduce((k,e)=>k.then(()=>loadDynamicLibrary(e,flags,localScope)),Promise.resolve()).then(loadModule):(metadata.neededDynlibs.forEach(k=>loadDynamicLibrary(k,flags,localScope)),loadModule())},mergeLibSymbols=(k,e)=>{for(var[I,B]of Object.entries(k)){let tr=ir=>{isSymbolDefined(ir)||(wasmImports[ir]=B)};tr(I);let rr="__main_argc_argv";I=="main"&&tr(rr),I==rr&&tr("main")}},asyncLoad=async k=>{var e=await readAsync(k);return new Uint8Array(e)},preloadPlugins=Module.preloadPlugins||[],registerWasmPlugin=()=>{var k={promiseChainEnd:Promise.resolve(),canHandle:e=>!Module.noWasmDecoding&&e.endsWith(".so"),handle:(e,I,B,tr)=>{k.promiseChainEnd=k.promiseChainEnd.then(()=>loadWebAssemblyModule(e,{loadAsync:!0,nodelete:!0},I,{})).then(rr=>{preloadedWasm[I]=rr,B(e)},rr=>{err(`failed to instantiate wasm: ${I}: ${rr}`),tr()})}};preloadPlugins.push(k)},preloadedWasm={};function loadDynamicLibrary(k,e={global:!0,nodelete:!0},I,B){var tr=LDSO.loadedLibsByName[k];if(tr)return e.global?tr.global||(tr.global=!0,mergeLibSymbols(tr.exports)):I&&Object.assign(I,tr.exports),e.nodelete&&tr.refcount!==1/0&&(tr.refcount=1/0),tr.refcount++,B&&(LDSO.loadedLibsByHandle[B]=tr),e.loadAsync?Promise.resolve(!0):!0;tr=newDSO(k,B,"loading"),tr.refcount=e.nodelete?1/0:1,tr.global=e.global;function rr(){if(B){var dr=HEAPU32[B+28>>2],mr=HEAPU32[B+32>>2];if(dr&&mr){var hr=HEAP8.slice(dr,dr+mr);return e.loadAsync?Promise.resolve(hr):hr}}var fr=locateFile(k);if(e.loadAsync)return asyncLoad(fr);if(!readBinary)throw new Error(`${fr}: file not found, and synchronous loading of external files is not available`);return readBinary(fr)}function ir(){var dr=preloadedWasm[k];return dr?e.loadAsync?Promise.resolve(dr):dr:e.loadAsync?rr().then(mr=>loadWebAssemblyModule(mr,e,k,I,B)):loadWebAssemblyModule(rr(),e,k,I,B)}function lr(dr){tr.global?mergeLibSymbols(dr):I&&Object.assign(I,dr),tr.exports=dr}return e.loadAsync?ir().then(dr=>(lr(dr),!0)):(lr(ir()),!0)}var reportUndefinedSymbols=()=>{for(var[k,e]of Object.entries(GOT))if(e.value==0){var I=resolveGlobalSymbol(k,!0).sym;if(!I&&!e.required)continue;if(typeof I=="function")e.value=addFunction(I,I.sig);else if(typeof I=="number")e.value=I;else throw new Error(`bad export type for '${k}': ${typeof I}`)}},loadDylibs=()=>{if(!dynamicLibraries.length){reportUndefinedSymbols();return}addRunDependency(),dynamicLibraries.reduce((k,e)=>k.then(()=>loadDynamicLibrary(e,{loadAsync:!0,global:!0,nodelete:!0,allowUndefined:!0})),Promise.resolve()).then(()=>{reportUndefinedSymbols(),removeRunDependency()})},noExitRuntime=Module.noExitRuntime||!0;function setValue(k,e,I="i8"){switch(I.endsWith("*")&&(I="*"),I){case"i1":HEAP8[k]=e;break;case"i8":HEAP8[k]=e;break;case"i16":HEAP16[k>>1]=e;break;case"i32":HEAP32[k>>2]=e;break;case"i64":HEAP64[k>>3]=BigInt(e);break;case"float":HEAPF32[k>>2]=e;break;case"double":HEAPF64[k>>3]=e;break;case"*":HEAPU32[k>>2]=e;break;default:abort(`invalid type for setValue: ${I}`)}}var ___assert_fail=(k,e,I,B)=>abort(`Assertion failed: ${UTF8ToString(k)}, at: `+[e?UTF8ToString(e):"unknown filename",I,B?UTF8ToString(B):"unknown function"]);___assert_fail.sig="vppip";var ___call_sighandler=(k,e)=>getWasmTableEntry(k)(e);___call_sighandler.sig="vpi";var ___memory_base=new WebAssembly.Global({value:"i32",mutable:!1},12582912),___stack_pointer=new WebAssembly.Global({value:"i32",mutable:!0},15394512),PATH={isAbs:k=>k.charAt(0)==="/",splitPath:k=>{var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return e.exec(k).slice(1)},normalizeArray:(k,e)=>{for(var I=0,B=k.length-1;B>=0;B--){var tr=k[B];tr==="."?k.splice(B,1):tr===".."?(k.splice(B,1),I++):I&&(k.splice(B,1),I--)}if(e)for(;I;I--)k.unshift("..");return k},normalize:k=>{var e=PATH.isAbs(k),I=k.substr(-1)==="/";return k=PATH.normalizeArray(k.split("/").filter(B=>!!B),!e).join("/"),!k&&!e&&(k="."),k&&I&&(k+="/"),(e?"/":"")+k},dirname:k=>{var e=PATH.splitPath(k),I=e[0],B=e[1];return!I&&!B?".":(B&&(B=B.substr(0,B.length-1)),I+B)},basename:k=>{if(k==="/")return"/";k=PATH.normalize(k),k=k.replace(/\/$/,"");var e=k.lastIndexOf("/");return e===-1?k:k.substr(e+1)},join:(...k)=>PATH.normalize(k.join("/")),join2:(k,e)=>PATH.normalize(k+"/"+e)},initRandomFill=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return B=>crypto.getRandomValues(B);if(ENVIRONMENT_IS_NODE)try{var k=require("crypto"),e=k.randomFillSync;if(e)return B=>k.randomFillSync(B);var I=k.randomBytes;return B=>(B.set(I(B.byteLength)),B)}catch{}abort("initRandomDevice")},randomFill=k=>(randomFill=initRandomFill())(k),PATH_FS={resolve:(...k)=>{for(var e="",I=!1,B=k.length-1;B>=-1&&!I;B--){var tr=B>=0?k[B]:FS.cwd();if(typeof tr!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!tr)return"";e=tr+"/"+e,I=PATH.isAbs(tr)}return e=PATH.normalizeArray(e.split("/").filter(rr=>!!rr),!I).join("/"),(I?"/":"")+e||"."},relative:(k,e)=>{k=PATH_FS.resolve(k).substr(1),e=PATH_FS.resolve(e).substr(1);function I(mr){for(var hr=0;hr<mr.length&&mr[hr]==="";hr++);for(var fr=mr.length-1;fr>=0&&mr[fr]==="";fr--);return hr>fr?[]:mr.slice(hr,fr-hr+1)}for(var B=I(k.split("/")),tr=I(e.split("/")),rr=Math.min(B.length,tr.length),ir=rr,lr=0;lr<rr;lr++)if(B[lr]!==tr[lr]){ir=lr;break}for(var dr=[],lr=ir;lr<B.length;lr++)dr.push("..");return dr=dr.concat(tr.slice(ir)),dr.join("/")}},FS_stdin_getChar_buffer=[],lengthBytesUTF8=k=>{for(var e=0,I=0;I<k.length;++I){var B=k.charCodeAt(I);B<=127?e++:B<=2047?e+=2:B>=55296&&B<=57343?(e+=4,++I):e+=3}return e},stringToUTF8Array=(k,e,I,B)=>{if(!(B>0))return 0;for(var tr=I,rr=I+B-1,ir=0;ir<k.length;++ir){var lr=k.charCodeAt(ir);if(lr>=55296&&lr<=57343){var dr=k.charCodeAt(++ir);lr=65536+((lr&1023)<<10)|dr&1023}if(lr<=127){if(I>=rr)break;e[I++]=lr}else if(lr<=2047){if(I+1>=rr)break;e[I++]=192|lr>>6,e[I++]=128|lr&63}else if(lr<=65535){if(I+2>=rr)break;e[I++]=224|lr>>12,e[I++]=128|lr>>6&63,e[I++]=128|lr&63}else{if(I+3>=rr)break;e[I++]=240|lr>>18,e[I++]=128|lr>>12&63,e[I++]=128|lr>>6&63,e[I++]=128|lr&63}}return e[I]=0,I-tr};function intArrayFromString(k,e,I){var B=lengthBytesUTF8(k)+1,tr=new Array(B),rr=stringToUTF8Array(k,tr,0,tr.length);return tr.length=rr,tr}var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var k=null;if(ENVIRONMENT_IS_NODE){var e=256,I=Buffer.alloc(e),B=0,tr=process$1.stdin.fd;try{B=fs.readSync(tr,I,0,e)}catch(rr){if(rr.toString().includes("EOF"))B=0;else throw rr}B>0&&(k=I.slice(0,B).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(k=window.prompt("Input: "),k!==null&&(k+=`
`));if(!k)return null;FS_stdin_getChar_buffer=intArrayFromString(k)}return FS_stdin_getChar_buffer.shift()},TTY={ttys:[],init(){},shutdown(){},register(k,e){TTY.ttys[k]={input:[],output:[],ops:e},FS.registerDevice(k,TTY.stream_ops)},stream_ops:{open(k){var e=TTY.ttys[k.node.rdev];if(!e)throw new FS.ErrnoError(43);k.tty=e,k.seekable=!1},close(k){k.tty.ops.fsync(k.tty)},fsync(k){k.tty.ops.fsync(k.tty)},read(k,e,I,B,tr){if(!k.tty||!k.tty.ops.get_char)throw new FS.ErrnoError(60);for(var rr=0,ir=0;ir<B;ir++){var lr;try{lr=k.tty.ops.get_char(k.tty)}catch{throw new FS.ErrnoError(29)}if(lr===void 0&&rr===0)throw new FS.ErrnoError(6);if(lr==null)break;rr++,e[I+ir]=lr}return rr&&(k.node.atime=Date.now()),rr},write(k,e,I,B,tr){if(!k.tty||!k.tty.ops.put_char)throw new FS.ErrnoError(60);try{for(var rr=0;rr<B;rr++)k.tty.ops.put_char(k.tty,e[I+rr])}catch{throw new FS.ErrnoError(29)}return B&&(k.node.mtime=k.node.ctime=Date.now()),rr}},default_tty_ops:{get_char(k){return FS_stdin_getChar()},put_char(k,e){e===null||e===10?(out(UTF8ArrayToString(k.output)),k.output=[]):e!=0&&k.output.push(e)},fsync(k){k.output&&k.output.length>0&&(out(UTF8ArrayToString(k.output)),k.output=[])},ioctl_tcgets(k){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(k,e,I){return 0},ioctl_tiocgwinsz(k){return[24,80]}},default_tty1_ops:{put_char(k,e){e===null||e===10?(err(UTF8ArrayToString(k.output)),k.output=[]):e!=0&&k.output.push(e)},fsync(k){k.output&&k.output.length>0&&(err(UTF8ArrayToString(k.output)),k.output=[])}}},zeroMemory=(k,e)=>{HEAPU8.fill(0,k,k+e)},mmapAlloc=k=>{k=alignMemory(k,65536);var e=_emscripten_builtin_memalign(65536,k);return e&&zeroMemory(e,k),e},MEMFS={ops_table:null,mount(k){return MEMFS.createNode(null,"/",16895,0)},createNode(k,e,I,B){if(FS.isBlkdev(I)||FS.isFIFO(I))throw new FS.ErrnoError(63);MEMFS.ops_table||(MEMFS.ops_table={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}});var tr=FS.createNode(k,e,I,B);return FS.isDir(tr.mode)?(tr.node_ops=MEMFS.ops_table.dir.node,tr.stream_ops=MEMFS.ops_table.dir.stream,tr.contents={}):FS.isFile(tr.mode)?(tr.node_ops=MEMFS.ops_table.file.node,tr.stream_ops=MEMFS.ops_table.file.stream,tr.usedBytes=0,tr.contents=null):FS.isLink(tr.mode)?(tr.node_ops=MEMFS.ops_table.link.node,tr.stream_ops=MEMFS.ops_table.link.stream):FS.isChrdev(tr.mode)&&(tr.node_ops=MEMFS.ops_table.chrdev.node,tr.stream_ops=MEMFS.ops_table.chrdev.stream),tr.atime=tr.mtime=tr.ctime=Date.now(),k&&(k.contents[e]=tr,k.atime=k.mtime=k.ctime=tr.atime),tr},getFileDataAsTypedArray(k){return k.contents?k.contents.subarray?k.contents.subarray(0,k.usedBytes):new Uint8Array(k.contents):new Uint8Array(0)},expandFileStorage(k,e){var I=k.contents?k.contents.length:0;if(!(I>=e)){var B=1048576;e=Math.max(e,I*(I<B?2:1.125)>>>0),I!=0&&(e=Math.max(e,256));var tr=k.contents;k.contents=new Uint8Array(e),k.usedBytes>0&&k.contents.set(tr.subarray(0,k.usedBytes),0)}},resizeFileStorage(k,e){if(k.usedBytes!=e)if(e==0)k.contents=null,k.usedBytes=0;else{var I=k.contents;k.contents=new Uint8Array(e),I&&k.contents.set(I.subarray(0,Math.min(e,k.usedBytes))),k.usedBytes=e}},node_ops:{getattr(k){var e={};return e.dev=FS.isChrdev(k.mode)?k.id:1,e.ino=k.id,e.mode=k.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=k.rdev,FS.isDir(k.mode)?e.size=4096:FS.isFile(k.mode)?e.size=k.usedBytes:FS.isLink(k.mode)?e.size=k.link.length:e.size=0,e.atime=new Date(k.atime),e.mtime=new Date(k.mtime),e.ctime=new Date(k.ctime),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr(k,e){for(let I of["mode","atime","mtime","ctime"])e[I]&&(k[I]=e[I]);e.size!==void 0&&MEMFS.resizeFileStorage(k,e.size)},lookup(k,e){throw MEMFS.doesNotExistError},mknod(k,e,I,B){return MEMFS.createNode(k,e,I,B)},rename(k,e,I){var B;try{B=FS.lookupNode(e,I)}catch{}if(B){if(FS.isDir(k.mode))for(var tr in B.contents)throw new FS.ErrnoError(55);FS.hashRemoveNode(B)}delete k.parent.contents[k.name],e.contents[I]=k,k.name=I,e.ctime=e.mtime=k.parent.ctime=k.parent.mtime=Date.now()},unlink(k,e){delete k.contents[e],k.ctime=k.mtime=Date.now()},rmdir(k,e){var I=FS.lookupNode(k,e);for(var B in I.contents)throw new FS.ErrnoError(55);delete k.contents[e],k.ctime=k.mtime=Date.now()},readdir(k){return[".","..",...Object.keys(k.contents)]},symlink(k,e,I){var B=MEMFS.createNode(k,e,41471,0);return B.link=I,B},readlink(k){if(!FS.isLink(k.mode))throw new FS.ErrnoError(28);return k.link}},stream_ops:{read(k,e,I,B,tr){var rr=k.node.contents;if(tr>=k.node.usedBytes)return 0;var ir=Math.min(k.node.usedBytes-tr,B);if(ir>8&&rr.subarray)e.set(rr.subarray(tr,tr+ir),I);else for(var lr=0;lr<ir;lr++)e[I+lr]=rr[tr+lr];return ir},write(k,e,I,B,tr,rr){if(e.buffer===HEAP8.buffer&&(rr=!1),!B)return 0;var ir=k.node;if(ir.mtime=ir.ctime=Date.now(),e.subarray&&(!ir.contents||ir.contents.subarray)){if(rr)return ir.contents=e.subarray(I,I+B),ir.usedBytes=B,B;if(ir.usedBytes===0&&tr===0)return ir.contents=e.slice(I,I+B),ir.usedBytes=B,B;if(tr+B<=ir.usedBytes)return ir.contents.set(e.subarray(I,I+B),tr),B}if(MEMFS.expandFileStorage(ir,tr+B),ir.contents.subarray&&e.subarray)ir.contents.set(e.subarray(I,I+B),tr);else for(var lr=0;lr<B;lr++)ir.contents[tr+lr]=e[I+lr];return ir.usedBytes=Math.max(ir.usedBytes,tr+B),B},llseek(k,e,I){var B=e;if(I===1?B+=k.position:I===2&&FS.isFile(k.node.mode)&&(B+=k.node.usedBytes),B<0)throw new FS.ErrnoError(28);return B},allocate(k,e,I){MEMFS.expandFileStorage(k.node,e+I),k.node.usedBytes=Math.max(k.node.usedBytes,e+I)},mmap(k,e,I,B,tr){if(!FS.isFile(k.node.mode))throw new FS.ErrnoError(43);var rr,ir,lr=k.node.contents;if(!(tr&2)&&lr&&lr.buffer===HEAP8.buffer)ir=!1,rr=lr.byteOffset;else{if(ir=!0,rr=mmapAlloc(e),!rr)throw new FS.ErrnoError(48);lr&&((I>0||I+e<lr.length)&&(lr.subarray?lr=lr.subarray(I,I+e):lr=Array.prototype.slice.call(lr,I,I+e)),HEAP8.set(lr,rr))}return{ptr:rr,allocated:ir}},msync(k,e,I,B,tr){return MEMFS.stream_ops.write(k,e,0,B,I,!1),0}}},FS_createDataFile=(k,e,I,B,tr,rr)=>{FS.createDataFile(k,e,I,B,tr,rr)},FS_handledByPreloadPlugin=(k,e,I,B)=>{typeof Browser<"u"&&Browser.init();var tr=!1;return preloadPlugins.forEach(rr=>{tr||rr.canHandle(e)&&(rr.handle(k,e,I,B),tr=!0)}),tr},FS_createPreloadedFile=(k,e,I,B,tr,rr,ir,lr,dr,mr)=>{var hr=e?PATH_FS.resolve(PATH.join2(k,e)):k;function fr(_r){function gr(Sr){mr?.(),lr||FS_createDataFile(k,e,Sr,B,tr,dr),rr?.(),removeRunDependency()}FS_handledByPreloadPlugin(_r,hr,gr,()=>{ir?.(),removeRunDependency()})||gr(_r)}addRunDependency(),typeof I=="string"?asyncLoad(I).then(fr,ir):fr(I)},FS_modeStringToFlags=k=>{var e={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},I=e[k];if(typeof I>"u")throw new Error(`Unknown file open mode: ${k}`);return I},FS_getMode=(k,e)=>{var I=0;return k&&(I|=365),e&&(I|=146),I},IDBFS={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var k=null;return typeof window=="object"&&(k=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),k},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",queuePersist:k=>{function e(){k.idbPersistState==="again"?I():k.idbPersistState=0}function I(){k.idbPersistState="idb",IDBFS.syncfs(k,!1,e)}k.idbPersistState?k.idbPersistState==="idb"&&(k.idbPersistState="again"):k.idbPersistState=setTimeout(I,0)},mount:k=>{var e=MEMFS.mount(k);if(k?.opts?.autoPersist){e.idbPersistState=0;var I=e.node_ops;e.node_ops=Object.assign({},e.node_ops),e.node_ops.mknod=(B,tr,rr,ir)=>{var lr=I.mknod(B,tr,rr,ir);return lr.node_ops=e.node_ops,lr.idbfs_mount=e.mount,lr.memfs_stream_ops=lr.stream_ops,lr.stream_ops=Object.assign({},lr.stream_ops),lr.stream_ops.write=(dr,mr,hr,fr,_r,gr)=>(dr.node.isModified=!0,lr.memfs_stream_ops.write(dr,mr,hr,fr,_r,gr)),lr.stream_ops.close=dr=>{var mr=dr.node;if(mr.isModified&&(IDBFS.queuePersist(mr.idbfs_mount),mr.isModified=!1),mr.memfs_stream_ops.close)return mr.memfs_stream_ops.close(dr)},lr},e.node_ops.mkdir=(...B)=>(IDBFS.queuePersist(e.mount),I.mkdir(...B)),e.node_ops.rmdir=(...B)=>(IDBFS.queuePersist(e.mount),I.rmdir(...B)),e.node_ops.symlink=(...B)=>(IDBFS.queuePersist(e.mount),I.symlink(...B)),e.node_ops.unlink=(...B)=>(IDBFS.queuePersist(e.mount),I.unlink(...B)),e.node_ops.rename=(...B)=>(IDBFS.queuePersist(e.mount),I.rename(...B))}return e},syncfs:(k,e,I)=>{IDBFS.getLocalSet(k,(B,tr)=>{if(B)return I(B);IDBFS.getRemoteSet(k,(rr,ir)=>{if(rr)return I(rr);var lr=e?ir:tr,dr=e?tr:ir;IDBFS.reconcile(lr,dr,I)})})},quit:()=>{Object.values(IDBFS.dbs).forEach(k=>k.close()),IDBFS.dbs={}},getDB:(k,e)=>{var I=IDBFS.dbs[k];if(I)return e(null,I);var B;try{B=IDBFS.indexedDB().open(k,IDBFS.DB_VERSION)}catch(tr){return e(tr)}if(!B)return e("Unable to connect to IndexedDB");B.onupgradeneeded=tr=>{var rr=tr.target.result,ir=tr.target.transaction,lr;rr.objectStoreNames.contains(IDBFS.DB_STORE_NAME)?lr=ir.objectStore(IDBFS.DB_STORE_NAME):lr=rr.createObjectStore(IDBFS.DB_STORE_NAME),lr.indexNames.contains("timestamp")||lr.createIndex("timestamp","timestamp",{unique:!1})},B.onsuccess=()=>{I=B.result,IDBFS.dbs[k]=I,e(null,I)},B.onerror=tr=>{e(tr.target.error),tr.preventDefault()}},getLocalSet:(k,e)=>{var I={};function B(dr){return dr!=="."&&dr!==".."}function tr(dr){return mr=>PATH.join2(dr,mr)}for(var rr=FS.readdir(k.mountpoint).filter(B).map(tr(k.mountpoint));rr.length;){var ir=rr.pop(),lr;try{lr=FS.stat(ir)}catch(dr){return e(dr)}FS.isDir(lr.mode)&&rr.push(...FS.readdir(ir).filter(B).map(tr(ir))),I[ir]={timestamp:lr.mtime}}return e(null,{type:"local",entries:I})},getRemoteSet:(k,e)=>{var I={};IDBFS.getDB(k.mountpoint,(B,tr)=>{if(B)return e(B);try{var rr=tr.transaction([IDBFS.DB_STORE_NAME],"readonly");rr.onerror=dr=>{e(dr.target.error),dr.preventDefault()};var ir=rr.objectStore(IDBFS.DB_STORE_NAME),lr=ir.index("timestamp");lr.openKeyCursor().onsuccess=dr=>{var mr=dr.target.result;if(!mr)return e(null,{type:"remote",db:tr,entries:I});I[mr.primaryKey]={timestamp:mr.key},mr.continue()}}catch(dr){return e(dr)}})},loadLocalEntry:(k,e)=>{var I,B;try{var tr=FS.lookupPath(k);B=tr.node,I=FS.stat(k)}catch(rr){return e(rr)}return FS.isDir(I.mode)?e(null,{timestamp:I.mtime,mode:I.mode}):FS.isFile(I.mode)?(B.contents=MEMFS.getFileDataAsTypedArray(B),e(null,{timestamp:I.mtime,mode:I.mode,contents:B.contents})):e(new Error("node type not supported"))},storeLocalEntry:(k,e,I)=>{try{if(FS.isDir(e.mode))FS.mkdirTree(k,e.mode);else if(FS.isFile(e.mode))FS.writeFile(k,e.contents,{canOwn:!0});else return I(new Error("node type not supported"));FS.chmod(k,e.mode),FS.utime(k,e.timestamp,e.timestamp)}catch(B){return I(B)}I(null)},removeLocalEntry:(k,e)=>{try{var I=FS.stat(k);FS.isDir(I.mode)?FS.rmdir(k):FS.isFile(I.mode)&&FS.unlink(k)}catch(B){return e(B)}e(null)},loadRemoteEntry:(k,e,I)=>{var B=k.get(e);B.onsuccess=tr=>I(null,tr.target.result),B.onerror=tr=>{I(tr.target.error),tr.preventDefault()}},storeRemoteEntry:(k,e,I,B)=>{try{var tr=k.put(I,e)}catch(rr){B(rr);return}tr.onsuccess=rr=>B(),tr.onerror=rr=>{B(rr.target.error),rr.preventDefault()}},removeRemoteEntry:(k,e,I)=>{var B=k.delete(e);B.onsuccess=tr=>I(),B.onerror=tr=>{I(tr.target.error),tr.preventDefault()}},reconcile:(k,e,I)=>{var B=0,tr=[];Object.keys(k.entries).forEach(fr=>{var _r=k.entries[fr],gr=e.entries[fr];(!gr||_r.timestamp.getTime()!=gr.timestamp.getTime())&&(tr.push(fr),B++)});var rr=[];if(Object.keys(e.entries).forEach(fr=>{k.entries[fr]||(rr.push(fr),B++)}),!B)return I(null);var ir=!1,lr=k.type==="remote"?k.db:e.db,dr=lr.transaction([IDBFS.DB_STORE_NAME],"readwrite"),mr=dr.objectStore(IDBFS.DB_STORE_NAME);function hr(fr){if(fr&&!ir)return ir=!0,I(fr)}dr.onerror=dr.onabort=fr=>{hr(fr.target.error),fr.preventDefault()},dr.oncomplete=fr=>{ir||I(null)},tr.sort().forEach(fr=>{e.type==="local"?IDBFS.loadRemoteEntry(mr,fr,(_r,gr)=>{if(_r)return hr(_r);IDBFS.storeLocalEntry(fr,gr,hr)}):IDBFS.loadLocalEntry(fr,(_r,gr)=>{if(_r)return hr(_r);IDBFS.storeRemoteEntry(mr,fr,gr,hr)})}),rr.sort().reverse().forEach(fr=>{e.type==="local"?IDBFS.removeLocalEntry(fr,hr):IDBFS.removeRemoteEntry(mr,fr,hr)})}},ERRNO_CODES={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},NODEFS={isWindows:!1,staticInit(){NODEFS.isWindows=!!process$1.platform.match(/^win/);var k=process$1.binding("constants");k.fs&&(k=k.fs),NODEFS.flagsForNodeMap={1024:k.O_APPEND,64:k.O_CREAT,128:k.O_EXCL,256:k.O_NOCTTY,0:k.O_RDONLY,2:k.O_RDWR,4096:k.O_SYNC,512:k.O_TRUNC,1:k.O_WRONLY,131072:k.O_NOFOLLOW}},convertNodeCode(k){var e=k.code;return ERRNO_CODES[e]},tryFSOperation(k){try{return k()}catch(e){throw e.code?e.code==="UNKNOWN"?new FS.ErrnoError(28):new FS.ErrnoError(NODEFS.convertNodeCode(e)):e}},mount(k){return NODEFS.createNode(null,"/",NODEFS.getMode(k.opts.root),0)},createNode(k,e,I,B){if(!FS.isDir(I)&&!FS.isFile(I)&&!FS.isLink(I))throw new FS.ErrnoError(28);var tr=FS.createNode(k,e,I);return tr.node_ops=NODEFS.node_ops,tr.stream_ops=NODEFS.stream_ops,tr},getMode(k){return NODEFS.tryFSOperation(()=>{var e=fs.lstatSync(k).mode;return NODEFS.isWindows&&(e|=(e&292)>>2),e})},realPath(k){for(var e=[];k.parent!==k;)e.push(k.name),k=k.parent;return e.push(k.mount.opts.root),e.reverse(),PATH.join(...e)},flagsForNode(k){k&=-2097153,k&=-2049,k&=-32769,k&=-524289,k&=-65537;var e=0;for(var I in NODEFS.flagsForNodeMap)k&I&&(e|=NODEFS.flagsForNodeMap[I],k^=I);if(k)throw new FS.ErrnoError(28);return e},node_ops:{getattr(k){var e=NODEFS.realPath(k),I;return NODEFS.tryFSOperation(()=>I=fs.lstatSync(e)),NODEFS.isWindows&&(I.blksize||(I.blksize=4096),I.blocks||(I.blocks=(I.size+I.blksize-1)/I.blksize|0),I.mode|=(I.mode&292)>>2),{dev:I.dev,ino:I.ino,mode:I.mode,nlink:I.nlink,uid:I.uid,gid:I.gid,rdev:I.rdev,size:I.size,atime:I.atime,mtime:I.mtime,ctime:I.ctime,blksize:I.blksize,blocks:I.blocks}},setattr(k,e){var I=NODEFS.realPath(k);NODEFS.tryFSOperation(()=>{if(e.mode!==void 0){var B=e.mode;NODEFS.isWindows&&(B&=384),fs.chmodSync(I,B),k.mode=e.mode}if(e.atime||e.mtime){var tr=e.atime&&new Date(e.atime),rr=e.mtime&&new Date(e.mtime);fs.utimesSync(I,tr,rr)}e.size!==void 0&&fs.truncateSync(I,e.size)})},lookup(k,e){var I=PATH.join2(NODEFS.realPath(k),e),B=NODEFS.getMode(I);return NODEFS.createNode(k,e,B)},mknod(k,e,I,B){var tr=NODEFS.createNode(k,e,I,B),rr=NODEFS.realPath(tr);return NODEFS.tryFSOperation(()=>{FS.isDir(tr.mode)?fs.mkdirSync(rr,tr.mode):fs.writeFileSync(rr,"",{mode:tr.mode})}),tr},rename(k,e,I){var B=NODEFS.realPath(k),tr=PATH.join2(NODEFS.realPath(e),I);try{FS.unlink(tr)}catch{}NODEFS.tryFSOperation(()=>fs.renameSync(B,tr)),k.name=I},unlink(k,e){var I=PATH.join2(NODEFS.realPath(k),e);NODEFS.tryFSOperation(()=>fs.unlinkSync(I))},rmdir(k,e){var I=PATH.join2(NODEFS.realPath(k),e);NODEFS.tryFSOperation(()=>fs.rmdirSync(I))},readdir(k){var e=NODEFS.realPath(k);return NODEFS.tryFSOperation(()=>fs.readdirSync(e))},symlink(k,e,I){var B=PATH.join2(NODEFS.realPath(k),e);NODEFS.tryFSOperation(()=>fs.symlinkSync(I,B))},readlink(k){var e=NODEFS.realPath(k);return NODEFS.tryFSOperation(()=>fs.readlinkSync(e))},statfs(k){var e=NODEFS.tryFSOperation(()=>fs.statfsSync(k));return e.frsize=e.bsize,e}},stream_ops:{open(k){var e=NODEFS.realPath(k.node);NODEFS.tryFSOperation(()=>{FS.isFile(k.node.mode)&&(k.shared.refcount=1,k.nfd=fs.openSync(e,NODEFS.flagsForNode(k.flags)))})},close(k){NODEFS.tryFSOperation(()=>{FS.isFile(k.node.mode)&&k.nfd&&--k.shared.refcount===0&&fs.closeSync(k.nfd)})},dup(k){k.shared.refcount++},read(k,e,I,B,tr){return B===0?0:NODEFS.tryFSOperation(()=>fs.readSync(k.nfd,new Int8Array(e.buffer,I,B),0,B,tr))},write(k,e,I,B,tr){return NODEFS.tryFSOperation(()=>fs.writeSync(k.nfd,new Int8Array(e.buffer,I,B),0,B,tr))},llseek(k,e,I){var B=e;if(I===1?B+=k.position:I===2&&FS.isFile(k.node.mode)&&NODEFS.tryFSOperation(()=>{var tr=fs.fstatSync(k.nfd);B+=tr.size}),B<0)throw new FS.ErrnoError(28);return B},mmap(k,e,I,B,tr){if(!FS.isFile(k.node.mode))throw new FS.ErrnoError(43);var rr=mmapAlloc(e);return NODEFS.stream_ops.read(k,HEAP8,rr,e,I),{ptr:rr,allocated:!0}},msync(k,e,I,B,tr){return NODEFS.stream_ops.write(k,e,0,B,I,!1),0}}},FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(k){P$1(this,"name","ErrnoError"),this.errno=k}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){P$1(this,"shared",{})}get object(){return this.node}set object(k){this.node=k}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(k){this.shared.flags=k}get position(){return this.shared.position}set position(k){this.shared.position=k}},FSNode:class{constructor(k,e,I,B){P$1(this,"node_ops",{}),P$1(this,"stream_ops",{}),P$1(this,"readMode",365),P$1(this,"writeMode",146),P$1(this,"mounted",null),k||(k=this),this.parent=k,this.mount=k.mount,this.id=FS.nextInode++,this.name=e,this.mode=I,this.rdev=B,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(k){k?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(k){k?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(k,e={}){if(!k)return{path:"",node:null};e.follow_mount??(e.follow_mount=!0),PATH.isAbs(k)||(k=FS.cwd()+"/"+k);e:for(var I=0;I<40;I++){for(var B=k.split("/").filter(mr=>!!mr&&mr!=="."),tr=FS.root,rr="/",ir=0;ir<B.length;ir++){var lr=ir===B.length-1;if(lr&&e.parent)break;if(B[ir]===".."){rr=PATH.dirname(rr),tr=tr.parent;continue}rr=PATH.join2(rr,B[ir]);try{tr=FS.lookupNode(tr,B[ir])}catch(mr){if(mr?.errno===44&&lr&&e.noent_okay)return{path:rr};throw mr}if(FS.isMountpoint(tr)&&(!lr||e.follow_mount)&&(tr=tr.mounted.root),FS.isLink(tr.mode)&&(!lr||e.follow)){if(!tr.node_ops.readlink)throw new FS.ErrnoError(52);var dr=tr.node_ops.readlink(tr);PATH.isAbs(dr)||(dr=PATH.dirname(rr)+"/"+dr),k=dr+"/"+B.slice(ir+1).join("/");continue e}}return{path:rr,node:tr}}throw new FS.ErrnoError(32)},getPath(k){for(var e;;){if(FS.isRoot(k)){var I=k.mount.mountpoint;return e?I[I.length-1]!=="/"?`${I}/${e}`:I+e:I}e=e?`${k.name}/${e}`:k.name,k=k.parent}},hashName(k,e){for(var I=0,B=0;B<e.length;B++)I=(I<<5)-I+e.charCodeAt(B)|0;return(k+I>>>0)%FS.nameTable.length},hashAddNode(k){var e=FS.hashName(k.parent.id,k.name);k.name_next=FS.nameTable[e],FS.nameTable[e]=k},hashRemoveNode(k){var e=FS.hashName(k.parent.id,k.name);if(FS.nameTable[e]===k)FS.nameTable[e]=k.name_next;else for(var I=FS.nameTable[e];I;){if(I.name_next===k){I.name_next=k.name_next;break}I=I.name_next}},lookupNode(k,e){var I=FS.mayLookup(k);if(I)throw new FS.ErrnoError(I);for(var B=FS.hashName(k.id,e),tr=FS.nameTable[B];tr;tr=tr.name_next){var rr=tr.name;if(tr.parent.id===k.id&&rr===e)return tr}return FS.lookup(k,e)},createNode(k,e,I,B){var tr=new FS.FSNode(k,e,I,B);return FS.hashAddNode(tr),tr},destroyNode(k){FS.hashRemoveNode(k)},isRoot(k){return k===k.parent},isMountpoint(k){return!!k.mounted},isFile(k){return(k&61440)===32768},isDir(k){return(k&61440)===16384},isLink(k){return(k&61440)===40960},isChrdev(k){return(k&61440)===8192},isBlkdev(k){return(k&61440)===24576},isFIFO(k){return(k&61440)===4096},isSocket(k){return(k&49152)===49152},flagsToPermissionString(k){var e=["r","w","rw"][k&3];return k&512&&(e+="w"),e},nodePermissions(k,e){return FS.ignorePermissions?0:e.includes("r")&&!(k.mode&292)||e.includes("w")&&!(k.mode&146)||e.includes("x")&&!(k.mode&73)?2:0},mayLookup(k){if(!FS.isDir(k.mode))return 54;var e=FS.nodePermissions(k,"x");return e||(k.node_ops.lookup?0:2)},mayCreate(k,e){if(!FS.isDir(k.mode))return 54;try{var I=FS.lookupNode(k,e);return 20}catch{}return FS.nodePermissions(k,"wx")},mayDelete(k,e,I){var B;try{B=FS.lookupNode(k,e)}catch(rr){return rr.errno}var tr=FS.nodePermissions(k,"wx");if(tr)return tr;if(I){if(!FS.isDir(B.mode))return 54;if(FS.isRoot(B)||FS.getPath(B)===FS.cwd())return 10}else if(FS.isDir(B.mode))return 31;return 0},mayOpen(k,e){return k?FS.isLink(k.mode)?32:FS.isDir(k.mode)&&(FS.flagsToPermissionString(e)!=="r"||e&512)?31:FS.nodePermissions(k,FS.flagsToPermissionString(e)):44},MAX_OPEN_FDS:4096,nextfd(){for(var k=0;k<=FS.MAX_OPEN_FDS;k++)if(!FS.streams[k])return k;throw new FS.ErrnoError(33)},getStreamChecked(k){var e=FS.getStream(k);if(!e)throw new FS.ErrnoError(8);return e},getStream:k=>FS.streams[k],createStream(k,e=-1){return k=Object.assign(new FS.FSStream,k),e==-1&&(e=FS.nextfd()),k.fd=e,FS.streams[e]=k,k},closeStream(k){FS.streams[k]=null},dupStream(k,e=-1){var I=FS.createStream(k,e);return I.stream_ops?.dup?.(I),I},chrdev_stream_ops:{open(k){var e=FS.getDevice(k.node.rdev);k.stream_ops=e.stream_ops,k.stream_ops.open?.(k)},llseek(){throw new FS.ErrnoError(70)}},major:k=>k>>8,minor:k=>k&255,makedev:(k,e)=>k<<8|e,registerDevice(k,e){FS.devices[k]={stream_ops:e}},getDevice:k=>FS.devices[k],getMounts(k){for(var e=[],I=[k];I.length;){var B=I.pop();e.push(B),I.push(...B.mounts)}return e},syncfs(k,e){typeof k=="function"&&(e=k,k=!1),FS.syncFSRequests++,FS.syncFSRequests>1&&err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var I=FS.getMounts(FS.root.mount),B=0;function tr(ir){return FS.syncFSRequests--,e(ir)}function rr(ir){if(ir)return rr.errored?void 0:(rr.errored=!0,tr(ir));++B>=I.length&&tr(null)}I.forEach(ir=>{if(!ir.type.syncfs)return rr(null);ir.type.syncfs(ir,k,rr)})},mount(k,e,I){var B=I==="/",tr=!I,rr;if(B&&FS.root)throw new FS.ErrnoError(10);if(!B&&!tr){var ir=FS.lookupPath(I,{follow_mount:!1});if(I=ir.path,rr=ir.node,FS.isMountpoint(rr))throw new FS.ErrnoError(10);if(!FS.isDir(rr.mode))throw new FS.ErrnoError(54)}var lr={type:k,opts:e,mountpoint:I,mounts:[]},dr=k.mount(lr);return dr.mount=lr,lr.root=dr,B?FS.root=dr:rr&&(rr.mounted=lr,rr.mount&&rr.mount.mounts.push(lr)),dr},unmount(k){var e=FS.lookupPath(k,{follow_mount:!1});if(!FS.isMountpoint(e.node))throw new FS.ErrnoError(28);var I=e.node,B=I.mounted,tr=FS.getMounts(B);Object.keys(FS.nameTable).forEach(ir=>{for(var lr=FS.nameTable[ir];lr;){var dr=lr.name_next;tr.includes(lr.mount)&&FS.destroyNode(lr),lr=dr}}),I.mounted=null;var rr=I.mount.mounts.indexOf(B);I.mount.mounts.splice(rr,1)},lookup(k,e){return k.node_ops.lookup(k,e)},mknod(k,e,I){var B=FS.lookupPath(k,{parent:!0}),tr=B.node,rr=PATH.basename(k);if(!rr||rr==="."||rr==="..")throw new FS.ErrnoError(28);var ir=FS.mayCreate(tr,rr);if(ir)throw new FS.ErrnoError(ir);if(!tr.node_ops.mknod)throw new FS.ErrnoError(63);return tr.node_ops.mknod(tr,rr,e,I)},statfs(k){var e={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255},I=FS.lookupPath(k,{follow:!0}).node;return I?.node_ops.statfs&&Object.assign(e,I.node_ops.statfs(I.mount.opts.root)),e},create(k,e=438){return e&=4095,e|=32768,FS.mknod(k,e,0)},mkdir(k,e=511){return e&=1023,e|=16384,FS.mknod(k,e,0)},mkdirTree(k,e){for(var I=k.split("/"),B="",tr=0;tr<I.length;++tr)if(I[tr]){B+="/"+I[tr];try{FS.mkdir(B,e)}catch(rr){if(rr.errno!=20)throw rr}}},mkdev(k,e,I){return typeof I>"u"&&(I=e,e=438),e|=8192,FS.mknod(k,e,I)},symlink(k,e){if(!PATH_FS.resolve(k))throw new FS.ErrnoError(44);var I=FS.lookupPath(e,{parent:!0}),B=I.node;if(!B)throw new FS.ErrnoError(44);var tr=PATH.basename(e),rr=FS.mayCreate(B,tr);if(rr)throw new FS.ErrnoError(rr);if(!B.node_ops.symlink)throw new FS.ErrnoError(63);return B.node_ops.symlink(B,tr,k)},rename(k,e){var I=PATH.dirname(k),B=PATH.dirname(e),tr=PATH.basename(k),rr=PATH.basename(e),ir,lr,dr;if(ir=FS.lookupPath(k,{parent:!0}),lr=ir.node,ir=FS.lookupPath(e,{parent:!0}),dr=ir.node,!lr||!dr)throw new FS.ErrnoError(44);if(lr.mount!==dr.mount)throw new FS.ErrnoError(75);var mr=FS.lookupNode(lr,tr),hr=PATH_FS.relative(k,B);if(hr.charAt(0)!==".")throw new FS.ErrnoError(28);if(hr=PATH_FS.relative(e,I),hr.charAt(0)!==".")throw new FS.ErrnoError(55);var fr;try{fr=FS.lookupNode(dr,rr)}catch{}if(mr!==fr){var _r=FS.isDir(mr.mode),gr=FS.mayDelete(lr,tr,_r);if(gr)throw new FS.ErrnoError(gr);if(gr=fr?FS.mayDelete(dr,rr,_r):FS.mayCreate(dr,rr),gr)throw new FS.ErrnoError(gr);if(!lr.node_ops.rename)throw new FS.ErrnoError(63);if(FS.isMountpoint(mr)||fr&&FS.isMountpoint(fr))throw new FS.ErrnoError(10);if(dr!==lr&&(gr=FS.nodePermissions(lr,"w"),gr))throw new FS.ErrnoError(gr);FS.hashRemoveNode(mr);try{lr.node_ops.rename(mr,dr,rr),mr.parent=dr}catch(Sr){throw Sr}finally{FS.hashAddNode(mr)}}},rmdir(k){var e=FS.lookupPath(k,{parent:!0}),I=e.node,B=PATH.basename(k),tr=FS.lookupNode(I,B),rr=FS.mayDelete(I,B,!0);if(rr)throw new FS.ErrnoError(rr);if(!I.node_ops.rmdir)throw new FS.ErrnoError(63);if(FS.isMountpoint(tr))throw new FS.ErrnoError(10);I.node_ops.rmdir(I,B),FS.destroyNode(tr)},readdir(k){var e=FS.lookupPath(k,{follow:!0}),I=e.node;if(!I.node_ops.readdir)throw new FS.ErrnoError(54);return I.node_ops.readdir(I)},unlink(k){var e=FS.lookupPath(k,{parent:!0}),I=e.node;if(!I)throw new FS.ErrnoError(44);var B=PATH.basename(k),tr=FS.lookupNode(I,B),rr=FS.mayDelete(I,B,!1);if(rr)throw new FS.ErrnoError(rr);if(!I.node_ops.unlink)throw new FS.ErrnoError(63);if(FS.isMountpoint(tr))throw new FS.ErrnoError(10);I.node_ops.unlink(I,B),FS.destroyNode(tr)},readlink(k){var e=FS.lookupPath(k),I=e.node;if(!I)throw new FS.ErrnoError(44);if(!I.node_ops.readlink)throw new FS.ErrnoError(28);return I.node_ops.readlink(I)},stat(k,e){var I=FS.lookupPath(k,{follow:!e}),B=I.node;if(!B)throw new FS.ErrnoError(44);if(!B.node_ops.getattr)throw new FS.ErrnoError(63);return B.node_ops.getattr(B)},lstat(k){return FS.stat(k,!0)},chmod(k,e,I){var B;if(typeof k=="string"){var tr=FS.lookupPath(k,{follow:!I});B=tr.node}else B=k;if(!B.node_ops.setattr)throw new FS.ErrnoError(63);B.node_ops.setattr(B,{mode:e&4095|B.mode&-4096,ctime:Date.now()})},lchmod(k,e){FS.chmod(k,e,!0)},fchmod(k,e){var I=FS.getStreamChecked(k);FS.chmod(I.node,e)},chown(k,e,I,B){var tr;if(typeof k=="string"){var rr=FS.lookupPath(k,{follow:!B});tr=rr.node}else tr=k;if(!tr.node_ops.setattr)throw new FS.ErrnoError(63);tr.node_ops.setattr(tr,{timestamp:Date.now()})},lchown(k,e,I){FS.chown(k,e,I,!0)},fchown(k,e,I){var B=FS.getStreamChecked(k);FS.chown(B.node,e,I)},truncate(k,e){if(e<0)throw new FS.ErrnoError(28);var I;if(typeof k=="string"){var B=FS.lookupPath(k,{follow:!0});I=B.node}else I=k;if(!I.node_ops.setattr)throw new FS.ErrnoError(63);if(FS.isDir(I.mode))throw new FS.ErrnoError(31);if(!FS.isFile(I.mode))throw new FS.ErrnoError(28);var tr=FS.nodePermissions(I,"w");if(tr)throw new FS.ErrnoError(tr);I.node_ops.setattr(I,{size:e,timestamp:Date.now()})},ftruncate(k,e){var I=FS.getStreamChecked(k);if(!(I.flags&2097155))throw new FS.ErrnoError(28);FS.truncate(I.node,e)},utime(k,e,I){var B=FS.lookupPath(k,{follow:!0}),tr=B.node;tr.node_ops.setattr(tr,{atime:e,mtime:I})},open(k,e,I=438){if(k==="")throw new FS.ErrnoError(44);e=typeof e=="string"?FS_modeStringToFlags(e):e,e&64?I=I&4095|32768:I=0;var B;if(typeof k=="object")B=k;else{var tr=FS.lookupPath(k,{follow:!(e&131072),noent_okay:!0});B=tr.node,k=tr.path}var rr=!1;if(e&64)if(B){if(e&128)throw new FS.ErrnoError(20)}else B=FS.mknod(k,I,0),rr=!0;if(!B)throw new FS.ErrnoError(44);if(FS.isChrdev(B.mode)&&(e&=-513),e&65536&&!FS.isDir(B.mode))throw new FS.ErrnoError(54);if(!rr){var ir=FS.mayOpen(B,e);if(ir)throw new FS.ErrnoError(ir)}e&512&&!rr&&FS.truncate(B,0),e&=-131713;var lr=FS.createStream({node:B,path:FS.getPath(B),flags:e,seekable:!0,position:0,stream_ops:B.stream_ops,ungotten:[],error:!1});return lr.stream_ops.open&&lr.stream_ops.open(lr),Module.logReadFiles&&!(e&1)&&(k in FS.readFiles||(FS.readFiles[k]=1)),lr},close(k){if(FS.isClosed(k))throw new FS.ErrnoError(8);k.getdents&&(k.getdents=null);try{k.stream_ops.close&&k.stream_ops.close(k)}catch(e){throw e}finally{FS.closeStream(k.fd)}k.fd=null},isClosed(k){return k.fd===null},llseek(k,e,I){if(FS.isClosed(k))throw new FS.ErrnoError(8);if(!k.seekable||!k.stream_ops.llseek)throw new FS.ErrnoError(70);if(I!=0&&I!=1&&I!=2)throw new FS.ErrnoError(28);return k.position=k.stream_ops.llseek(k,e,I),k.ungotten=[],k.position},read(k,e,I,B,tr){if(B<0||tr<0)throw new FS.ErrnoError(28);if(FS.isClosed(k))throw new FS.ErrnoError(8);if((k.flags&2097155)===1)throw new FS.ErrnoError(8);if(FS.isDir(k.node.mode))throw new FS.ErrnoError(31);if(!k.stream_ops.read)throw new FS.ErrnoError(28);var rr=typeof tr<"u";if(!rr)tr=k.position;else if(!k.seekable)throw new FS.ErrnoError(70);var ir=k.stream_ops.read(k,e,I,B,tr);return rr||(k.position+=ir),ir},write(k,e,I,B,tr,rr){if(B<0||tr<0)throw new FS.ErrnoError(28);if(FS.isClosed(k))throw new FS.ErrnoError(8);if(!(k.flags&2097155))throw new FS.ErrnoError(8);if(FS.isDir(k.node.mode))throw new FS.ErrnoError(31);if(!k.stream_ops.write)throw new FS.ErrnoError(28);k.seekable&&k.flags&1024&&FS.llseek(k,0,2);var ir=typeof tr<"u";if(!ir)tr=k.position;else if(!k.seekable)throw new FS.ErrnoError(70);var lr=k.stream_ops.write(k,e,I,B,tr,rr);return ir||(k.position+=lr),lr},allocate(k,e,I){if(FS.isClosed(k))throw new FS.ErrnoError(8);if(e<0||I<=0)throw new FS.ErrnoError(28);if(!(k.flags&2097155))throw new FS.ErrnoError(8);if(!FS.isFile(k.node.mode)&&!FS.isDir(k.node.mode))throw new FS.ErrnoError(43);if(!k.stream_ops.allocate)throw new FS.ErrnoError(138);k.stream_ops.allocate(k,e,I)},mmap(k,e,I,B,tr){if(B&2&&!(tr&2)&&(k.flags&2097155)!==2)throw new FS.ErrnoError(2);if((k.flags&2097155)===1)throw new FS.ErrnoError(2);if(!k.stream_ops.mmap)throw new FS.ErrnoError(43);if(!e)throw new FS.ErrnoError(28);return k.stream_ops.mmap(k,e,I,B,tr)},msync(k,e,I,B,tr){return k.stream_ops.msync?k.stream_ops.msync(k,e,I,B,tr):0},ioctl(k,e,I){if(!k.stream_ops.ioctl)throw new FS.ErrnoError(59);return k.stream_ops.ioctl(k,e,I)},readFile(k,e={}){if(e.flags=e.flags||0,e.encoding=e.encoding||"binary",e.encoding!=="utf8"&&e.encoding!=="binary")throw new Error(`Invalid encoding type "${e.encoding}"`);var I,B=FS.open(k,e.flags),tr=FS.stat(k),rr=tr.size,ir=new Uint8Array(rr);return FS.read(B,ir,0,rr,0),e.encoding==="utf8"?I=UTF8ArrayToString(ir):e.encoding==="binary"&&(I=ir),FS.close(B),I},writeFile(k,e,I={}){I.flags=I.flags||577;var B=FS.open(k,I.flags,I.mode);if(typeof e=="string"){var tr=new Uint8Array(lengthBytesUTF8(e)+1),rr=stringToUTF8Array(e,tr,0,tr.length);FS.write(B,tr,0,rr,void 0,I.canOwn)}else if(ArrayBuffer.isView(e))FS.write(B,e,0,e.byteLength,void 0,I.canOwn);else throw new Error("Unsupported data type");FS.close(B)},cwd:()=>FS.currentPath,chdir(k){var e=FS.lookupPath(k,{follow:!0});if(e.node===null)throw new FS.ErrnoError(44);if(!FS.isDir(e.node.mode))throw new FS.ErrnoError(54);var I=FS.nodePermissions(e.node,"x");if(I)throw new FS.ErrnoError(I);FS.currentPath=e.path},createDefaultDirectories(){FS.mkdir("/tmp"),FS.mkdir("/home"),FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev"),FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(B,tr,rr,ir,lr)=>ir,llseek:()=>0}),FS.mkdev("/dev/null",FS.makedev(1,3)),TTY.register(FS.makedev(5,0),TTY.default_tty_ops),TTY.register(FS.makedev(6,0),TTY.default_tty1_ops),FS.mkdev("/dev/tty",FS.makedev(5,0)),FS.mkdev("/dev/tty1",FS.makedev(6,0));var k=new Uint8Array(1024),e=0,I=()=>(e===0&&(e=randomFill(k).byteLength),k[--e]);FS.createDevice("/dev","random",I),FS.createDevice("/dev","urandom",I),FS.mkdir("/dev/shm"),FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var k=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd"),FS.mount({mount(){var e=FS.createNode(k,"fd",16895,73);return e.stream_ops={llseek:MEMFS.stream_ops.llseek},e.node_ops={lookup(I,B){var tr=+B,rr=FS.getStreamChecked(tr),ir={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>rr.path},id:tr+1};return ir.parent=ir,ir},readdir(){return Array.from(FS.streams.entries()).filter(([I,B])=>B).map(([I,B])=>I.toString())}},e}},{},"/proc/self/fd")},createStandardStreams(k,e,I){k?FS.createDevice("/dev","stdin",k):FS.symlink("/dev/tty","/dev/stdin"),e?FS.createDevice("/dev","stdout",null,e):FS.symlink("/dev/tty","/dev/stdout"),I?FS.createDevice("/dev","stderr",null,I):FS.symlink("/dev/tty1","/dev/stderr"),FS.open("/dev/stdin",0),FS.open("/dev/stdout",1),FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096),FS.mount(MEMFS,{},"/"),FS.createDefaultDirectories(),FS.createDefaultDevices(),FS.createSpecialDirectories(),FS.filesystems={MEMFS,IDBFS,NODEFS}},init(k,e,I){FS.initialized=!0,k??(k=Module.stdin),e??(e=Module.stdout),I??(I=Module.stderr),FS.createStandardStreams(k,e,I)},quit(){FS.initialized=!1,_fflush(0);for(var k=0;k<FS.streams.length;k++){var e=FS.streams[k];e&&FS.close(e)}},findObject(k,e){var I=FS.analyzePath(k,e);return I.exists?I.object:null},analyzePath(k,e){try{var I=FS.lookupPath(k,{follow:!e});k=I.path}catch{}var B={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var I=FS.lookupPath(k,{parent:!0});B.parentExists=!0,B.parentPath=I.path,B.parentObject=I.node,B.name=PATH.basename(k),I=FS.lookupPath(k,{follow:!e}),B.exists=!0,B.path=I.path,B.object=I.node,B.name=I.node.name,B.isRoot=I.path==="/"}catch(tr){B.error=tr.errno}return B},createPath(k,e,I,B){k=typeof k=="string"?k:FS.getPath(k);for(var tr=e.split("/").reverse();tr.length;){var rr=tr.pop();if(rr){var ir=PATH.join2(k,rr);try{FS.mkdir(ir)}catch{}k=ir}}return ir},createFile(k,e,I,B,tr){var rr=PATH.join2(typeof k=="string"?k:FS.getPath(k),e),ir=FS_getMode(B,tr);return FS.create(rr,ir)},createDataFile(k,e,I,B,tr,rr){var ir=e;k&&(k=typeof k=="string"?k:FS.getPath(k),ir=e?PATH.join2(k,e):k);var lr=FS_getMode(B,tr),dr=FS.create(ir,lr);if(I){if(typeof I=="string"){for(var mr=new Array(I.length),hr=0,fr=I.length;hr<fr;++hr)mr[hr]=I.charCodeAt(hr);I=mr}FS.chmod(dr,lr|146);var _r=FS.open(dr,577);FS.write(_r,I,0,I.length,0,rr),FS.close(_r),FS.chmod(dr,lr)}},createDevice(k,e,I,B){var tr,rr=PATH.join2(typeof k=="string"?k:FS.getPath(k),e),ir=FS_getMode(!!I,!!B);(tr=FS.createDevice).major??(tr.major=64);var lr=FS.makedev(FS.createDevice.major++,0);return FS.registerDevice(lr,{open(dr){dr.seekable=!1},close(dr){B?.buffer?.length&&B(10)},read(dr,mr,hr,fr,_r){for(var gr=0,Sr=0;Sr<fr;Sr++){var Ar;try{Ar=I()}catch{throw new FS.ErrnoError(29)}if(Ar===void 0&&gr===0)throw new FS.ErrnoError(6);if(Ar==null)break;gr++,mr[hr+Sr]=Ar}return gr&&(dr.node.atime=Date.now()),gr},write(dr,mr,hr,fr,_r){for(var gr=0;gr<fr;gr++)try{B(mr[hr+gr])}catch{throw new FS.ErrnoError(29)}return fr&&(dr.node.mtime=dr.node.ctime=Date.now()),gr}}),FS.mkdev(rr,ir,lr)},forceLoadFile(k){if(k.isDevice||k.isFolder||k.link||k.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{k.contents=readBinary(k.url),k.usedBytes=k.contents.length}catch{throw new FS.ErrnoError(29)}},createLazyFile(k,e,I,B,tr){class rr{constructor(){P$1(this,"lengthKnown",!1),P$1(this,"chunks",[])}get(gr){if(!(gr>this.length-1||gr<0)){var Sr=gr%this.chunkSize,Ar=gr/this.chunkSize|0;return this.getter(Ar)[Sr]}}setDataGetter(gr){this.getter=gr}cacheLength(){var gr=new XMLHttpRequest;if(gr.open("HEAD",I,!1),gr.send(null),!(gr.status>=200&&gr.status<300||gr.status===304))throw new Error("Couldn't load "+I+". Status: "+gr.status);var Sr=Number(gr.getResponseHeader("Content-length")),Ar,Or=(Ar=gr.getResponseHeader("Accept-Ranges"))&&Ar==="bytes",Fr=(Ar=gr.getResponseHeader("Content-Encoding"))&&Ar==="gzip",vr=1024*1024;Or||(vr=Sr);var xr=(Gr,is)=>{if(Gr>is)throw new Error("invalid range ("+Gr+", "+is+") or no bytes requested!");if(is>Sr-1)throw new Error("only "+Sr+" bytes available! programmer error!");var as=new XMLHttpRequest;if(as.open("GET",I,!1),Sr!==vr&&as.setRequestHeader("Range","bytes="+Gr+"-"+is),as.responseType="arraybuffer",as.overrideMimeType&&as.overrideMimeType("text/plain; charset=x-user-defined"),as.send(null),!(as.status>=200&&as.status<300||as.status===304))throw new Error("Couldn't load "+I+". Status: "+as.status);return as.response!==void 0?new Uint8Array(as.response||[]):intArrayFromString(as.responseText||"")},kr=this;kr.setDataGetter(Gr=>{var is=Gr*vr,as=(Gr+1)*vr-1;if(as=Math.min(as,Sr-1),typeof kr.chunks[Gr]>"u"&&(kr.chunks[Gr]=xr(is,as)),typeof kr.chunks[Gr]>"u")throw new Error("doXHR failed!");return kr.chunks[Gr]}),(Fr||!Sr)&&(vr=Sr=1,Sr=this.getter(0).length,vr=Sr,out("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Sr,this._chunkSize=vr,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var ir=new rr,lr={isDevice:!1,contents:ir}}else var lr={isDevice:!1,url:I};var dr=FS.createFile(k,e,lr,B,tr);lr.contents?dr.contents=lr.contents:lr.url&&(dr.contents=null,dr.url=lr.url),Object.defineProperties(dr,{usedBytes:{get:function(){return this.contents.length}}});var mr={},hr=Object.keys(dr.stream_ops);hr.forEach(_r=>{var gr=dr.stream_ops[_r];mr[_r]=(...Sr)=>(FS.forceLoadFile(dr),gr(...Sr))});function fr(_r,gr,Sr,Ar,Or){var Fr=_r.node.contents;if(Or>=Fr.length)return 0;var vr=Math.min(Fr.length-Or,Ar);if(Fr.slice)for(var xr=0;xr<vr;xr++)gr[Sr+xr]=Fr[Or+xr];else for(var xr=0;xr<vr;xr++)gr[Sr+xr]=Fr.get(Or+xr);return vr}return mr.read=(_r,gr,Sr,Ar,Or)=>(FS.forceLoadFile(dr),fr(_r,gr,Sr,Ar,Or)),mr.mmap=(_r,gr,Sr,Ar,Or)=>{FS.forceLoadFile(dr);var Fr=mmapAlloc(gr);if(!Fr)throw new FS.ErrnoError(48);return fr(_r,HEAP8,Fr,gr,Sr),{ptr:Fr,allocated:!0}},dr.stream_ops=mr,dr}},SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(k,e,I){if(PATH.isAbs(e))return e;var B;if(k===-100)B=FS.cwd();else{var tr=SYSCALLS.getStreamFromFD(k);B=tr.path}if(e.length==0){if(!I)throw new FS.ErrnoError(44);return B}return B+"/"+e},doStat(k,e,I){var B=k(e);HEAP32[I>>2]=B.dev,HEAP32[I+4>>2]=B.mode,HEAPU32[I+8>>2]=B.nlink,HEAP32[I+12>>2]=B.uid,HEAP32[I+16>>2]=B.gid,HEAP32[I+20>>2]=B.rdev,HEAP64[I+24>>3]=BigInt(B.size),HEAP32[I+32>>2]=4096,HEAP32[I+36>>2]=B.blocks;var tr=B.atime.getTime(),rr=B.mtime.getTime(),ir=B.ctime.getTime();return HEAP64[I+40>>3]=BigInt(Math.floor(tr/1e3)),HEAPU32[I+48>>2]=tr%1e3*1e3*1e3,HEAP64[I+56>>3]=BigInt(Math.floor(rr/1e3)),HEAPU32[I+64>>2]=rr%1e3*1e3*1e3,HEAP64[I+72>>3]=BigInt(Math.floor(ir/1e3)),HEAPU32[I+80>>2]=ir%1e3*1e3*1e3,HEAP64[I+88>>3]=BigInt(B.ino),0},doMsync(k,e,I,B,tr){if(!FS.isFile(e.node.mode))throw new FS.ErrnoError(43);if(B&2)return 0;var rr=HEAPU8.slice(k,k+I);FS.msync(e,rr,tr,I,B)},getStreamFromFD(k){var e=FS.getStreamChecked(k);return e},varargs:void 0,getStr(k){var e=UTF8ToString(k);return e}},___syscall__newselect=function(k,e,I,B,tr){try{for(var rr=0,ir=e?HEAP32[e>>2]:0,lr=e?HEAP32[e+4>>2]:0,dr=I?HEAP32[I>>2]:0,mr=I?HEAP32[I+4>>2]:0,hr=B?HEAP32[B>>2]:0,fr=B?HEAP32[B+4>>2]:0,_r=0,gr=0,Sr=0,Ar=0,Or=0,Fr=0,vr=(e?HEAP32[e>>2]:0)|(I?HEAP32[I>>2]:0)|(B?HEAP32[B>>2]:0),xr=(e?HEAP32[e+4>>2]:0)|(I?HEAP32[I+4>>2]:0)|(B?HEAP32[B+4>>2]:0),kr=(Lr,ts,rs,ss)=>Lr<32?ts&ss:rs&ss,Gr=0;Gr<k;Gr++){var is=1<<Gr%32;if(kr(Gr,vr,xr,is)){var as=SYSCALLS.getStreamFromFD(Gr),cs=SYSCALLS.DEFAULT_POLLMASK;if(as.stream_ops.poll){var es=-1;if(tr){var ps=e?HEAP32[tr>>2]:0,Ur=e?HEAP32[tr+4>>2]:0;es=(ps+Ur/1e6)*1e3}cs=as.stream_ops.poll(as,es)}cs&1&&kr(Gr,ir,lr,is)&&(Gr<32?_r=_r|is:gr=gr|is,rr++),cs&4&&kr(Gr,dr,mr,is)&&(Gr<32?Sr=Sr|is:Ar=Ar|is,rr++),cs&2&&kr(Gr,hr,fr,is)&&(Gr<32?Or=Or|is:Fr=Fr|is,rr++)}}return e&&(HEAP32[e>>2]=_r,HEAP32[e+4>>2]=gr),I&&(HEAP32[I>>2]=Sr,HEAP32[I+4>>2]=Ar),B&&(HEAP32[B>>2]=Or,HEAP32[B+4>>2]=Fr),rr}catch(Lr){if(typeof FS>"u"||Lr.name!=="ErrnoError")throw Lr;return-Lr.errno}};___syscall__newselect.sig="iipppp";var SOCKFS={websocketArgs:{},callbacks:{},on(k,e){SOCKFS.callbacks[k]=e},emit(k,e){SOCKFS.callbacks[k]?.(e)},mount(k){return SOCKFS.websocketArgs=Module.websocket||{},(Module.websocket??(Module.websocket={})).on=SOCKFS.on,FS.createNode(null,"/",16895,0)},createSocket(k,e,I){e&=-526337;var B=e==1;if(B&&I&&I!=6)throw new FS.ErrnoError(66);var tr={family:k,type:e,protocol:I,server:null,error:null,peers:{},pending:[],recv_queue:[],sock_ops:SOCKFS.websocket_sock_ops},rr=SOCKFS.nextname(),ir=FS.createNode(SOCKFS.root,rr,49152,0);ir.sock=tr;var lr=FS.createStream({path:rr,node:ir,flags:2,seekable:!1,stream_ops:SOCKFS.stream_ops});return tr.stream=lr,tr},getSocket(k){var e=FS.getStream(k);return!e||!FS.isSocket(e.node.mode)?null:e.node.sock},stream_ops:{poll(k){var e=k.node.sock;return e.sock_ops.poll(e)},ioctl(k,e,I){var B=k.node.sock;return B.sock_ops.ioctl(B,e,I)},read(k,e,I,B,tr){var rr=k.node.sock,ir=rr.sock_ops.recvmsg(rr,B);return ir?(e.set(ir.buffer,I),ir.buffer.length):0},write(k,e,I,B,tr){var rr=k.node.sock;return rr.sock_ops.sendmsg(rr,e,I,B)},close(k){var e=k.node.sock;e.sock_ops.close(e)}},nextname(){return SOCKFS.nextname.current||(SOCKFS.nextname.current=0),`socket[${SOCKFS.nextname.current++}]`},websocket_sock_ops:{createPeer(k,e,I){var B;if(typeof e=="object"&&(B=e,e=null,I=null),B)if(B._socket)e=B._socket.remoteAddress,I=B._socket.remotePort;else{var tr=/ws[s]?:\/\/([^:]+):(\d+)/.exec(B.url);if(!tr)throw new Error("WebSocket URL must be in the format ws(s)://address:port");e=tr[1],I=parseInt(tr[2],10)}else try{var rr="ws:#".replace("#","//"),ir="binary",lr=void 0;if(SOCKFS.websocketArgs.url&&(rr=SOCKFS.websocketArgs.url),SOCKFS.websocketArgs.subprotocol?ir=SOCKFS.websocketArgs.subprotocol:SOCKFS.websocketArgs.subprotocol===null&&(ir="null"),rr==="ws://"||rr==="wss://"){var dr=e.split("/");rr=rr+dr[0]+":"+I+"/"+dr.slice(1).join("/")}ir!=="null"&&(ir=ir.replace(/^ +| +$/g,"").split(/ *, */),lr=ir);var mr;ENVIRONMENT_IS_NODE?mr=require("ws"):mr=WebSocket,B=new mr(rr,lr),B.binaryType="arraybuffer"}catch{throw new FS.ErrnoError(23)}var hr={addr:e,port:I,socket:B,msg_send_queue:[]};return SOCKFS.websocket_sock_ops.addPeer(k,hr),SOCKFS.websocket_sock_ops.handlePeerEvents(k,hr),k.type===2&&typeof k.sport<"u"&&hr.msg_send_queue.push(new Uint8Array([255,255,255,255,112,111,114,116,(k.sport&65280)>>8,k.sport&255])),hr},getPeer(k,e,I){return k.peers[e+":"+I]},addPeer(k,e){k.peers[e.addr+":"+e.port]=e},removePeer(k,e){delete k.peers[e.addr+":"+e.port]},handlePeerEvents(k,e){var I=!0,B=function(){k.connecting=!1,SOCKFS.emit("open",k.stream.fd);try{for(var rr=e.msg_send_queue.shift();rr;)e.socket.send(rr),rr=e.msg_send_queue.shift()}catch{e.socket.close()}};function tr(rr){if(typeof rr=="string"){var ir=new TextEncoder;rr=ir.encode(rr)}else{if(assert(rr.byteLength!==void 0),rr.byteLength==0)return;rr=new Uint8Array(rr)}var lr=I;if(I=!1,lr&&rr.length===10&&rr[0]===255&&rr[1]===255&&rr[2]===255&&rr[3]===255&&rr[4]===112&&rr[5]===111&&rr[6]===114&&rr[7]===116){var dr=rr[8]<<8|rr[9];SOCKFS.websocket_sock_ops.removePeer(k,e),e.port=dr,SOCKFS.websocket_sock_ops.addPeer(k,e);return}k.recv_queue.push({addr:e.addr,port:e.port,data:rr}),SOCKFS.emit("message",k.stream.fd)}ENVIRONMENT_IS_NODE?(e.socket.on("open",B),e.socket.on("message",function(rr,ir){ir&&tr(new Uint8Array(rr).buffer)}),e.socket.on("close",function(){SOCKFS.emit("close",k.stream.fd)}),e.socket.on("error",function(rr){k.error=14,SOCKFS.emit("error",[k.stream.fd,k.error,"ECONNREFUSED: Connection refused"])})):(e.socket.onopen=B,e.socket.onclose=function(){SOCKFS.emit("close",k.stream.fd)},e.socket.onmessage=function(rr){tr(rr.data)},e.socket.onerror=function(rr){k.error=14,SOCKFS.emit("error",[k.stream.fd,k.error,"ECONNREFUSED: Connection refused"])})},poll(k){if(k.type===1&&k.server)return k.pending.length?65:0;var e=0,I=k.type===1?SOCKFS.websocket_sock_ops.getPeer(k,k.daddr,k.dport):null;return(k.recv_queue.length||!I||I&&I.socket.readyState===I.socket.CLOSING||I&&I.socket.readyState===I.socket.CLOSED)&&(e|=65),(!I||I&&I.socket.readyState===I.socket.OPEN)&&(e|=4),(I&&I.socket.readyState===I.socket.CLOSING||I&&I.socket.readyState===I.socket.CLOSED)&&(k.connecting?e|=4:e|=16),e},ioctl(k,e,I){switch(e){case 21531:var B=0;return k.recv_queue.length&&(B=k.recv_queue[0].data.length),HEAP32[I>>2]=B,0;default:return 28}},close(k){if(k.server){try{k.server.close()}catch{}k.server=null}for(var e=Object.keys(k.peers),I=0;I<e.length;I++){var B=k.peers[e[I]];try{B.socket.close()}catch{}SOCKFS.websocket_sock_ops.removePeer(k,B)}return 0},bind(k,e,I){if(typeof k.saddr<"u"||typeof k.sport<"u")throw new FS.ErrnoError(28);if(k.saddr=e,k.sport=I,k.type===2){k.server&&(k.server.close(),k.server=null);try{k.sock_ops.listen(k,0)}catch(B){if(B.name!=="ErrnoError"||B.errno!==138)throw B}}},connect(k,e,I){if(k.server)throw new FS.ErrnoError(138);if(typeof k.daddr<"u"&&typeof k.dport<"u"){var B=SOCKFS.websocket_sock_ops.getPeer(k,k.daddr,k.dport);if(B)throw B.socket.readyState===B.socket.CONNECTING?new FS.ErrnoError(7):new FS.ErrnoError(30)}var tr=SOCKFS.websocket_sock_ops.createPeer(k,e,I);k.daddr=tr.addr,k.dport=tr.port,k.connecting=!0},listen(k,e){if(!ENVIRONMENT_IS_NODE)throw new FS.ErrnoError(138);if(k.server)throw new FS.ErrnoError(28);var I=require("ws").Server,B=k.saddr;k.server=new I({host:B,port:k.sport}),SOCKFS.emit("listen",k.stream.fd),k.server.on("connection",function(tr){if(k.type===1){var rr=SOCKFS.createSocket(k.family,k.type,k.protocol),ir=SOCKFS.websocket_sock_ops.createPeer(rr,tr);rr.daddr=ir.addr,rr.dport=ir.port,k.pending.push(rr),SOCKFS.emit("connection",rr.stream.fd)}else SOCKFS.websocket_sock_ops.createPeer(k,tr),SOCKFS.emit("connection",k.stream.fd)}),k.server.on("close",function(){SOCKFS.emit("close",k.stream.fd),k.server=null}),k.server.on("error",function(tr){k.error=23,SOCKFS.emit("error",[k.stream.fd,k.error,"EHOSTUNREACH: Host is unreachable"])})},accept(k){if(!k.server||!k.pending.length)throw new FS.ErrnoError(28);var e=k.pending.shift();return e.stream.flags=k.stream.flags,e},getname(k,e){var I,B;if(e){if(k.daddr===void 0||k.dport===void 0)throw new FS.ErrnoError(53);I=k.daddr,B=k.dport}else I=k.saddr||0,B=k.sport||0;return{addr:I,port:B}},sendmsg(k,e,I,B,tr,rr){if(k.type===2){if((tr===void 0||rr===void 0)&&(tr=k.daddr,rr=k.dport),tr===void 0||rr===void 0)throw new FS.ErrnoError(17)}else tr=k.daddr,rr=k.dport;var ir=SOCKFS.websocket_sock_ops.getPeer(k,tr,rr);if(k.type===1&&(!ir||ir.socket.readyState===ir.socket.CLOSING||ir.socket.readyState===ir.socket.CLOSED))throw new FS.ErrnoError(53);ArrayBuffer.isView(e)&&(I+=e.byteOffset,e=e.buffer);var lr=e.slice(I,I+B);if(!ir||ir.socket.readyState!==ir.socket.OPEN)return k.type===2&&(!ir||ir.socket.readyState===ir.socket.CLOSING||ir.socket.readyState===ir.socket.CLOSED)&&(ir=SOCKFS.websocket_sock_ops.createPeer(k,tr,rr)),ir.msg_send_queue.push(lr),B;try{return ir.socket.send(lr),B}catch{throw new FS.ErrnoError(28)}},recvmsg(k,e){if(k.type===1&&k.server)throw new FS.ErrnoError(53);var I=k.recv_queue.shift();if(!I){if(k.type===1){var B=SOCKFS.websocket_sock_ops.getPeer(k,k.daddr,k.dport);if(!B)throw new FS.ErrnoError(53);if(B.socket.readyState===B.socket.CLOSING||B.socket.readyState===B.socket.CLOSED)return null;throw new FS.ErrnoError(6)}throw new FS.ErrnoError(6)}var tr=I.data.byteLength||I.data.length,rr=I.data.byteOffset||0,ir=I.data.buffer||I.data,lr=Math.min(e,tr),dr={buffer:new Uint8Array(ir,rr,lr),addr:I.addr,port:I.port};if(k.type===1&&lr<tr){var mr=tr-lr;I.data=new Uint8Array(ir,rr+lr,mr),k.recv_queue.unshift(I)}return dr}}},getSocketFromFD=k=>{var e=SOCKFS.getSocket(k);if(!e)throw new FS.ErrnoError(8);return e},inetNtop4=k=>(k&255)+"."+(k>>8&255)+"."+(k>>16&255)+"."+(k>>24&255),inetNtop6=k=>{var e="",I=0,B=0,tr=0,rr=0,ir=0,lr=0,dr=[k[0]&65535,k[0]>>16,k[1]&65535,k[1]>>16,k[2]&65535,k[2]>>16,k[3]&65535,k[3]>>16],mr=!0,hr="";for(lr=0;lr<5;lr++)if(dr[lr]!==0){mr=!1;break}if(mr){if(hr=inetNtop4(dr[6]|dr[7]<<16),dr[5]===-1)return e="::ffff:",e+=hr,e;if(dr[5]===0)return e="::",hr==="0.0.0.0"&&(hr=""),hr==="0.0.0.1"&&(hr="1"),e+=hr,e}for(I=0;I<8;I++)dr[I]===0&&(I-tr>1&&(ir=0),tr=I,ir++),ir>B&&(B=ir,rr=I-B+1);for(I=0;I<8;I++){if(B>1&&dr[I]===0&&I>=rr&&I<rr+B){I===rr&&(e+=":",rr===0&&(e+=":"));continue}e+=Number(_ntohs(dr[I]&65535)).toString(16),e+=I<7?":":""}return e},readSockaddr=(k,e)=>{var I=HEAP16[k>>1],B=_ntohs(HEAPU16[k+2>>1]),tr;switch(I){case 2:if(e!==16)return{errno:28};tr=HEAP32[k+4>>2],tr=inetNtop4(tr);break;case 10:if(e!==28)return{errno:28};tr=[HEAP32[k+8>>2],HEAP32[k+12>>2],HEAP32[k+16>>2],HEAP32[k+20>>2]],tr=inetNtop6(tr);break;default:return{errno:5}}return{family:I,addr:tr,port:B}},inetPton4=k=>{for(var e=k.split("."),I=0;I<4;I++){var B=Number(e[I]);if(isNaN(B))return null;e[I]=B}return(e[0]|e[1]<<8|e[2]<<16|e[3]<<24)>>>0},jstoi_q=k=>parseInt(k),inetPton6=k=>{var e,I,B,tr,rr=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,ir=[];if(!rr.test(k))return null;if(k==="::")return[0,0,0,0,0,0,0,0];for(k.startsWith("::")?k=k.replace("::","Z:"):k=k.replace("::",":Z:"),k.indexOf(".")>0?(k=k.replace(new RegExp("[.]","g"),":"),e=k.split(":"),e[e.length-4]=jstoi_q(e[e.length-4])+jstoi_q(e[e.length-3])*256,e[e.length-3]=jstoi_q(e[e.length-2])+jstoi_q(e[e.length-1])*256,e=e.slice(0,e.length-2)):e=k.split(":"),B=0,tr=0,I=0;I<e.length;I++)if(typeof e[I]=="string")if(e[I]==="Z"){for(tr=0;tr<8-e.length+1;tr++)ir[I+tr]=0;B=tr-1}else ir[I+B]=_htons(parseInt(e[I],16));else ir[I+B]=e[I];return[ir[1]<<16|ir[0],ir[3]<<16|ir[2],ir[5]<<16|ir[4],ir[7]<<16|ir[6]]},DNS={address_map:{id:1,addrs:{},names:{}},lookup_name(k){var e=inetPton4(k);if(e!==null||(e=inetPton6(k),e!==null))return k;var I;if(DNS.address_map.addrs[k])I=DNS.address_map.addrs[k];else{var B=DNS.address_map.id++;assert(B<65535,"exceeded max address mappings of 65535"),I="172.29."+(B&255)+"."+(B&65280),DNS.address_map.names[I]=k,DNS.address_map.addrs[k]=I}return I},lookup_addr(k){return DNS.address_map.names[k]?DNS.address_map.names[k]:null}},getSocketAddress=(k,e)=>{var I=readSockaddr(k,e);if(I.errno)throw new FS.ErrnoError(I.errno);return I.addr=DNS.lookup_addr(I.addr)||I.addr,I};function ___syscall_bind(k,e,I,B,tr,rr){try{var ir=getSocketFromFD(k),lr=getSocketAddress(e,I);return ir.sock_ops.bind(ir,lr.addr,lr.port),0}catch(dr){if(typeof FS>"u"||dr.name!=="ErrnoError")throw dr;return-dr.errno}}___syscall_bind.sig="iippiii";function ___syscall_chdir(k){try{return k=SYSCALLS.getStr(k),FS.chdir(k),0}catch(e){if(typeof FS>"u"||e.name!=="ErrnoError")throw e;return-e.errno}}___syscall_chdir.sig="ip";function ___syscall_chmod(k,e){try{return k=SYSCALLS.getStr(k),FS.chmod(k,e),0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_chmod.sig="ipi";function ___syscall_connect(k,e,I,B,tr,rr){try{var ir=getSocketFromFD(k),lr=getSocketAddress(e,I);return ir.sock_ops.connect(ir,lr.addr,lr.port),0}catch(dr){if(typeof FS>"u"||dr.name!=="ErrnoError")throw dr;return-dr.errno}}___syscall_connect.sig="iippiii";function ___syscall_dup(k){try{var e=SYSCALLS.getStreamFromFD(k);return FS.dupStream(e).fd}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_dup.sig="ii";function ___syscall_dup3(k,e,I){try{var B=SYSCALLS.getStreamFromFD(k);if(B.fd===e)return-28;if(e<0||e>=FS.MAX_OPEN_FDS)return-8;var tr=FS.getStream(e);return tr&&FS.close(tr),FS.dupStream(B,e).fd}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}___syscall_dup3.sig="iiii";function ___syscall_faccessat(k,e,I,B){try{if(e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(k,e),I&-8)return-28;var tr=FS.lookupPath(e,{follow:!0}),rr=tr.node;if(!rr)return-44;var ir="";return I&4&&(ir+="r"),I&2&&(ir+="w"),I&1&&(ir+="x"),ir&&FS.nodePermissions(rr,ir)?-2:0}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return-lr.errno}}___syscall_faccessat.sig="iipii";var ___syscall_fadvise64=(k,e,I,B)=>0;___syscall_fadvise64.sig="iijji";var INT53_MAX=9007199254740992,INT53_MIN=-9007199254740992,bigintToI53Checked=k=>k<INT53_MIN||k>INT53_MAX?NaN:Number(k);function ___syscall_fallocate(k,e,I,B){I=bigintToI53Checked(I),B=bigintToI53Checked(B);try{if(isNaN(I))return 61;var tr=SYSCALLS.getStreamFromFD(k);return FS.allocate(tr,I,B),0}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}___syscall_fallocate.sig="iiijj";var syscallGetVarargI=()=>{var k=HEAP32[+SYSCALLS.varargs>>2];return SYSCALLS.varargs+=4,k},syscallGetVarargP=syscallGetVarargI;function ___syscall_fcntl64(k,e,I){SYSCALLS.varargs=I;try{var B=SYSCALLS.getStreamFromFD(k);switch(e){case 0:{var tr=syscallGetVarargI();if(tr<0)return-28;for(;FS.streams[tr];)tr++;var rr;return rr=FS.dupStream(B,tr),rr.fd}case 1:case 2:return 0;case 3:return B.flags;case 4:{var tr=syscallGetVarargI();return B.flags|=tr,0}case 12:{var tr=syscallGetVarargP(),ir=0;return HEAP16[tr+ir>>1]=2,0}case 13:case 14:return 0}return-28}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return-lr.errno}}___syscall_fcntl64.sig="iiip";function ___syscall_fdatasync(k){try{var e=SYSCALLS.getStreamFromFD(k);return 0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_fdatasync.sig="ii";function ___syscall_fstat64(k,e){try{var I=SYSCALLS.getStreamFromFD(k);return SYSCALLS.doStat(FS.stat,I.path,e)}catch(B){if(typeof FS>"u"||B.name!=="ErrnoError")throw B;return-B.errno}}___syscall_fstat64.sig="iip";function ___syscall_ftruncate64(k,e){e=bigintToI53Checked(e);try{return isNaN(e)?61:(FS.ftruncate(k,e),0)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_ftruncate64.sig="iij";var stringToUTF8=(k,e,I)=>stringToUTF8Array(k,HEAPU8,e,I);function ___syscall_getcwd(k,e){try{if(e===0)return-28;var I=FS.cwd(),B=lengthBytesUTF8(I)+1;return e<B?-68:(stringToUTF8(I,k,e),B)}catch(tr){if(typeof FS>"u"||tr.name!=="ErrnoError")throw tr;return-tr.errno}}___syscall_getcwd.sig="ipp";function ___syscall_getdents64(k,e,I){try{var B=SYSCALLS.getStreamFromFD(k);B.getdents||(B.getdents=FS.readdir(B.path));for(var tr=280,rr=0,ir=FS.llseek(B,0,1),lr=Math.floor(ir/tr),dr=Math.min(B.getdents.length,lr+Math.floor(I/tr)),mr=lr;mr<dr;mr++){var hr,fr,_r=B.getdents[mr];if(_r===".")hr=B.node.id,fr=4;else if(_r===".."){var gr=FS.lookupPath(B.path,{parent:!0});hr=gr.node.id,fr=4}else{var Sr;try{Sr=FS.lookupNode(B.node,_r)}catch(Ar){if(Ar?.errno===28)continue;throw Ar}hr=Sr.id,fr=FS.isChrdev(Sr.mode)?2:FS.isDir(Sr.mode)?4:FS.isLink(Sr.mode)?10:8}HEAP64[e+rr>>3]=BigInt(hr),HEAP64[e+rr+8>>3]=BigInt((mr+1)*tr),HEAP16[e+rr+16>>1]=280,HEAP8[e+rr+18]=fr,stringToUTF8(_r,e+rr+19,256),rr+=tr}return FS.llseek(B,mr*tr,0),rr}catch(Ar){if(typeof FS>"u"||Ar.name!=="ErrnoError")throw Ar;return-Ar.errno}}___syscall_getdents64.sig="iipp";var writeSockaddr=(k,e,I,B,tr)=>{switch(e){case 2:I=inetPton4(I),zeroMemory(k,16),tr&&(HEAP32[tr>>2]=16),HEAP16[k>>1]=e,HEAP32[k+4>>2]=I,HEAP16[k+2>>1]=_htons(B);break;case 10:I=inetPton6(I),zeroMemory(k,28),tr&&(HEAP32[tr>>2]=28),HEAP32[k>>2]=e,HEAP32[k+8>>2]=I[0],HEAP32[k+12>>2]=I[1],HEAP32[k+16>>2]=I[2],HEAP32[k+20>>2]=I[3],HEAP16[k+2>>1]=_htons(B);break;default:return 5}return 0};function ___syscall_getsockname(k,e,I,B,tr,rr){try{var ir=getSocketFromFD(k),lr=writeSockaddr(e,ir.family,DNS.lookup_name(ir.saddr||"0.0.0.0"),ir.sport,I);return 0}catch(dr){if(typeof FS>"u"||dr.name!=="ErrnoError")throw dr;return-dr.errno}}___syscall_getsockname.sig="iippiii";function ___syscall_getsockopt(k,e,I,B,tr,rr){try{var ir=getSocketFromFD(k);return e===1&&I===4?(HEAP32[B>>2]=ir.error,HEAP32[tr>>2]=4,ir.error=null,0):-50}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return-lr.errno}}___syscall_getsockopt.sig="iiiippi";function ___syscall_ioctl(k,e,I){SYSCALLS.varargs=I;try{var B=SYSCALLS.getStreamFromFD(k);switch(e){case 21509:return B.tty?0:-59;case 21505:{if(!B.tty)return-59;if(B.tty.ops.ioctl_tcgets){var tr=B.tty.ops.ioctl_tcgets(B),rr=syscallGetVarargP();HEAP32[rr>>2]=tr.c_iflag||0,HEAP32[rr+4>>2]=tr.c_oflag||0,HEAP32[rr+8>>2]=tr.c_cflag||0,HEAP32[rr+12>>2]=tr.c_lflag||0;for(var ir=0;ir<32;ir++)HEAP8[rr+ir+17]=tr.c_cc[ir]||0;return 0}return 0}case 21510:case 21511:case 21512:return B.tty?0:-59;case 21506:case 21507:case 21508:{if(!B.tty)return-59;if(B.tty.ops.ioctl_tcsets){for(var rr=syscallGetVarargP(),lr=HEAP32[rr>>2],dr=HEAP32[rr+4>>2],mr=HEAP32[rr+8>>2],hr=HEAP32[rr+12>>2],fr=[],ir=0;ir<32;ir++)fr.push(HEAP8[rr+ir+17]);return B.tty.ops.ioctl_tcsets(B.tty,e,{c_iflag:lr,c_oflag:dr,c_cflag:mr,c_lflag:hr,c_cc:fr})}return 0}case 21519:{if(!B.tty)return-59;var rr=syscallGetVarargP();return HEAP32[rr>>2]=0,0}case 21520:return B.tty?-28:-59;case 21531:{var rr=syscallGetVarargP();return FS.ioctl(B,e,rr)}case 21523:{if(!B.tty)return-59;if(B.tty.ops&&B.tty.ops.ioctl_tiocgwinsz){var _r=B.tty.ops.ioctl_tiocgwinsz(B.tty),rr=syscallGetVarargP();HEAP16[rr>>1]=_r[0],HEAP16[rr+2>>1]=_r[1]}return 0}case 21524:return B.tty?0:-59;case 21515:return B.tty?0:-59;default:return-28}}catch(gr){if(typeof FS>"u"||gr.name!=="ErrnoError")throw gr;return-gr.errno}}___syscall_ioctl.sig="iiip";function ___syscall_lstat64(k,e){try{return k=SYSCALLS.getStr(k),SYSCALLS.doStat(FS.lstat,k,e)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_lstat64.sig="ipp";function ___syscall_mkdirat(k,e,I){try{return e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(k,e),FS.mkdir(e,I,0),0}catch(B){if(typeof FS>"u"||B.name!=="ErrnoError")throw B;return-B.errno}}___syscall_mkdirat.sig="iipi";function ___syscall_newfstatat(k,e,I,B){try{e=SYSCALLS.getStr(e);var tr=B&256,rr=B&4096;return B=B&-6401,e=SYSCALLS.calculateAt(k,e,rr),SYSCALLS.doStat(tr?FS.lstat:FS.stat,e,I)}catch(ir){if(typeof FS>"u"||ir.name!=="ErrnoError")throw ir;return-ir.errno}}___syscall_newfstatat.sig="iippi";function ___syscall_openat(k,e,I,B){SYSCALLS.varargs=B;try{e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(k,e);var tr=B?syscallGetVarargI():0;return FS.open(e,I,tr).fd}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return-rr.errno}}___syscall_openat.sig="iipip";var PIPEFS={BUCKET_BUFFER_SIZE:8192,mount(k){return FS.createNode(null,"/",16895,0)},createPipe(){var k={buckets:[],refcnt:2};k.buckets.push({buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:0,roffset:0});var e=PIPEFS.nextname(),I=PIPEFS.nextname(),B=FS.createNode(PIPEFS.root,e,4096,0),tr=FS.createNode(PIPEFS.root,I,4096,0);B.pipe=k,tr.pipe=k;var rr=FS.createStream({path:e,node:B,flags:0,seekable:!1,stream_ops:PIPEFS.stream_ops});B.stream=rr;var ir=FS.createStream({path:I,node:tr,flags:1,seekable:!1,stream_ops:PIPEFS.stream_ops});return tr.stream=ir,{readable_fd:rr.fd,writable_fd:ir.fd}},stream_ops:{poll(k){var e=k.node.pipe;if((k.flags&2097155)===1)return 260;if(e.buckets.length>0)for(var I=0;I<e.buckets.length;I++){var B=e.buckets[I];if(B.offset-B.roffset>0)return 65}return 0},ioctl(k,e,I){return 28},fsync(k){return 28},read(k,e,I,B,tr){for(var rr=k.node.pipe,ir=0,lr=0;lr<rr.buckets.length;lr++){var dr=rr.buckets[lr];ir+=dr.offset-dr.roffset}var mr=e.subarray(I,I+B);if(B<=0)return 0;if(ir==0)throw new FS.ErrnoError(6);for(var hr=Math.min(ir,B),fr=hr,_r=0,lr=0;lr<rr.buckets.length;lr++){var gr=rr.buckets[lr],Sr=gr.offset-gr.roffset;if(hr<=Sr){var Ar=gr.buffer.subarray(gr.roffset,gr.offset);hr<Sr?(Ar=Ar.subarray(0,hr),gr.roffset+=hr):_r++,mr.set(Ar);break}else{var Ar=gr.buffer.subarray(gr.roffset,gr.offset);mr.set(Ar),mr=mr.subarray(Ar.byteLength),hr-=Ar.byteLength,_r++}}return _r&&_r==rr.buckets.length&&(_r--,rr.buckets[_r].offset=0,rr.buckets[_r].roffset=0),rr.buckets.splice(0,_r),fr},write(k,e,I,B,tr){var rr=k.node.pipe,ir=e.subarray(I,I+B),lr=ir.byteLength;if(lr<=0)return 0;var dr=null;rr.buckets.length==0?(dr={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:0,roffset:0},rr.buckets.push(dr)):dr=rr.buckets[rr.buckets.length-1],assert(dr.offset<=PIPEFS.BUCKET_BUFFER_SIZE);var mr=PIPEFS.BUCKET_BUFFER_SIZE-dr.offset;if(mr>=lr)return dr.buffer.set(ir,dr.offset),dr.offset+=lr,lr;mr>0&&(dr.buffer.set(ir.subarray(0,mr),dr.offset),dr.offset+=mr,ir=ir.subarray(mr,ir.byteLength));for(var hr=ir.byteLength/PIPEFS.BUCKET_BUFFER_SIZE|0,fr=ir.byteLength%PIPEFS.BUCKET_BUFFER_SIZE,_r=0;_r<hr;_r++){var gr={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:PIPEFS.BUCKET_BUFFER_SIZE,roffset:0};rr.buckets.push(gr),gr.buffer.set(ir.subarray(0,PIPEFS.BUCKET_BUFFER_SIZE)),ir=ir.subarray(PIPEFS.BUCKET_BUFFER_SIZE,ir.byteLength)}if(fr>0){var gr={buffer:new Uint8Array(PIPEFS.BUCKET_BUFFER_SIZE),offset:ir.byteLength,roffset:0};rr.buckets.push(gr),gr.buffer.set(ir)}return lr},close(k){var e=k.node.pipe;e.refcnt--,e.refcnt===0&&(e.buckets=null)}},nextname(){return PIPEFS.nextname.current||(PIPEFS.nextname.current=0),"pipe["+PIPEFS.nextname.current+++"]"}};function ___syscall_pipe(k){try{if(k==0)throw new FS.ErrnoError(21);var e=PIPEFS.createPipe();return HEAP32[k>>2]=e.readable_fd,HEAP32[k+4>>2]=e.writable_fd,0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_pipe.sig="ip";function ___syscall_poll(k,e,I){try{for(var B=0,tr=0;tr<e;tr++){var rr=k+8*tr,ir=HEAP32[rr>>2],lr=HEAP16[rr+4>>1],dr=32,mr=FS.getStream(ir);mr&&(dr=SYSCALLS.DEFAULT_POLLMASK,mr.stream_ops.poll&&(dr=mr.stream_ops.poll(mr,-1))),dr&=lr|8|16,dr&&B++,HEAP16[rr+6>>1]=dr}return B}catch(hr){if(typeof FS>"u"||hr.name!=="ErrnoError")throw hr;return-hr.errno}}___syscall_poll.sig="ipii";function ___syscall_readlinkat(k,e,I,B){try{if(e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(k,e),B<=0)return-28;var tr=FS.readlink(e),rr=Math.min(B,lengthBytesUTF8(tr)),ir=HEAP8[I+rr];return stringToUTF8(tr,I,B+1),HEAP8[I+rr]=ir,rr}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return-lr.errno}}___syscall_readlinkat.sig="iippp";function ___syscall_recvfrom(k,e,I,B,tr,rr){try{var ir=getSocketFromFD(k),lr=ir.sock_ops.recvmsg(ir,I);if(!lr)return 0;if(tr)var dr=writeSockaddr(tr,ir.family,DNS.lookup_name(lr.addr),lr.port,rr);return HEAPU8.set(lr.buffer,e),lr.buffer.byteLength}catch(mr){if(typeof FS>"u"||mr.name!=="ErrnoError")throw mr;return-mr.errno}}___syscall_recvfrom.sig="iippipp";function ___syscall_renameat(k,e,I,B){try{return e=SYSCALLS.getStr(e),B=SYSCALLS.getStr(B),e=SYSCALLS.calculateAt(k,e),B=SYSCALLS.calculateAt(I,B),FS.rename(e,B),0}catch(tr){if(typeof FS>"u"||tr.name!=="ErrnoError")throw tr;return-tr.errno}}___syscall_renameat.sig="iipip";function ___syscall_rmdir(k){try{return k=SYSCALLS.getStr(k),FS.rmdir(k),0}catch(e){if(typeof FS>"u"||e.name!=="ErrnoError")throw e;return-e.errno}}___syscall_rmdir.sig="ip";function ___syscall_sendto(k,e,I,B,tr,rr){try{var ir=getSocketFromFD(k);if(!tr)return FS.write(ir.stream,HEAP8,e,I);var lr=getSocketAddress(tr,rr);return ir.sock_ops.sendmsg(ir,HEAP8,e,I,lr.addr,lr.port)}catch(dr){if(typeof FS>"u"||dr.name!=="ErrnoError")throw dr;return-dr.errno}}___syscall_sendto.sig="iippipp";function ___syscall_socket(k,e,I){try{var B=SOCKFS.createSocket(k,e,I);return B.stream.fd}catch(tr){if(typeof FS>"u"||tr.name!=="ErrnoError")throw tr;return-tr.errno}}___syscall_socket.sig="iiiiiii";function ___syscall_stat64(k,e){try{return k=SYSCALLS.getStr(k),SYSCALLS.doStat(FS.stat,k,e)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_stat64.sig="ipp";function ___syscall_symlinkat(k,e,I){try{return k=SYSCALLS.getStr(k),I=SYSCALLS.getStr(I),I=SYSCALLS.calculateAt(e,I),FS.symlink(k,I),0}catch(B){if(typeof FS>"u"||B.name!=="ErrnoError")throw B;return-B.errno}}___syscall_symlinkat.sig="ipip";function ___syscall_truncate64(k,e){e=bigintToI53Checked(e);try{return isNaN(e)?61:(k=SYSCALLS.getStr(k),FS.truncate(k,e),0)}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}___syscall_truncate64.sig="ipj";function ___syscall_unlinkat(k,e,I){try{return e=SYSCALLS.getStr(e),e=SYSCALLS.calculateAt(k,e),I===0?FS.unlink(e):I===512?FS.rmdir(e):abort("Invalid flags passed to unlinkat"),0}catch(B){if(typeof FS>"u"||B.name!=="ErrnoError")throw B;return-B.errno}}___syscall_unlinkat.sig="iipi";var ___table_base=new WebAssembly.Global({value:"i32",mutable:!1},1),__abort_js=()=>abort("");__abort_js.sig="v";var ENV={},stackAlloc=k=>__emscripten_stack_alloc(k),stringToUTF8OnStack=k=>{var e=lengthBytesUTF8(k)+1,I=stackAlloc(e);return stringToUTF8(k,I,e),I},dlSetError=k=>{var e=stackSave(),I=stringToUTF8OnStack(k);___dl_seterr(I,0),stackRestore(e)},dlopenInternal=(k,e)=>{var I=UTF8ToString(k+36),B=HEAP32[k+4>>2];I=PATH.normalize(I);var tr=!!(B&256),rr=tr?null:{},ir={global:tr,nodelete:!!(B&4096),loadAsync:e.loadAsync};if(e.loadAsync)return loadDynamicLibrary(I,ir,rr,k);try{return loadDynamicLibrary(I,ir,rr,k)}catch(lr){return dlSetError(`Could not load dynamic lib: ${I}
${lr}`),0}},__dlopen_js=k=>dlopenInternal(k,{loadAsync:!1});__dlopen_js.sig="pp";var __dlsym_js=(k,e,I)=>{e=UTF8ToString(e);var B,tr,rr=LDSO.loadedLibsByHandle[k];if(!rr.exports.hasOwnProperty(e)||rr.exports[e].stub)return dlSetError(`Tried to lookup unknown symbol "${e}" in dynamic lib: ${rr.name}`),0;if(tr=Object.keys(rr.exports).indexOf(e),B=rr.exports[e],typeof B=="function"){var ir=getFunctionAddress(B);ir?B=ir:(B=addFunction(B,B.sig),HEAPU32[I>>2]=tr)}return B};__dlsym_js.sig="pppp";var getExecutableName=()=>thisProgram||"./this.program",__emscripten_get_progname=(k,e)=>stringToUTF8(getExecutableName(),k,e);__emscripten_get_progname.sig="vpi";var __emscripten_memcpy_js=(k,e,I)=>HEAPU8.copyWithin(k,e,e+I);__emscripten_memcpy_js.sig="vppp";var runtimeKeepaliveCounter=0,__emscripten_runtime_keepalive_clear=()=>{noExitRuntime=!1,runtimeKeepaliveCounter=0};__emscripten_runtime_keepalive_clear.sig="v";var __emscripten_system=k=>{if(ENVIRONMENT_IS_NODE){if(!k)return 1;var e=UTF8ToString(k);if(!e.length)return 0;var I=require("child_process"),B=I.spawnSync(e,[],{shell:!0,stdio:"inherit"}),tr=(ir,lr)=>ir<<8|lr;if(B.status===null){var rr=ir=>{switch(ir){case"SIGHUP":return 1;case"SIGQUIT":return 3;case"SIGFPE":return 8;case"SIGKILL":return 9;case"SIGALRM":return 14;case"SIGTERM":return 15;default:return 2}};return tr(0,rr(B.signal))}return tr(B.status,0)}return k?-52:0};__emscripten_system.sig="ip";var __emscripten_throw_longjmp=()=>{throw 1/0};__emscripten_throw_longjmp.sig="v";function __gmtime_js(k,e){k=bigintToI53Checked(k);var I=new Date(k*1e3);HEAP32[e>>2]=I.getUTCSeconds(),HEAP32[e+4>>2]=I.getUTCMinutes(),HEAP32[e+8>>2]=I.getUTCHours(),HEAP32[e+12>>2]=I.getUTCDate(),HEAP32[e+16>>2]=I.getUTCMonth(),HEAP32[e+20>>2]=I.getUTCFullYear()-1900,HEAP32[e+24>>2]=I.getUTCDay();var B=Date.UTC(I.getUTCFullYear(),0,1,0,0,0,0),tr=(I.getTime()-B)/(1e3*60*60*24)|0;HEAP32[e+28>>2]=tr}__gmtime_js.sig="vjp";var isLeapYear=k=>k%4===0&&(k%100!==0||k%400===0),MONTH_DAYS_LEAP_CUMULATIVE=[0,31,60,91,121,152,182,213,244,274,305,335],MONTH_DAYS_REGULAR_CUMULATIVE=[0,31,59,90,120,151,181,212,243,273,304,334],ydayFromDate=k=>{var e=isLeapYear(k.getFullYear()),I=e?MONTH_DAYS_LEAP_CUMULATIVE:MONTH_DAYS_REGULAR_CUMULATIVE,B=I[k.getMonth()]+k.getDate()-1;return B};function __localtime_js(k,e){k=bigintToI53Checked(k);var I=new Date(k*1e3);HEAP32[e>>2]=I.getSeconds(),HEAP32[e+4>>2]=I.getMinutes(),HEAP32[e+8>>2]=I.getHours(),HEAP32[e+12>>2]=I.getDate(),HEAP32[e+16>>2]=I.getMonth(),HEAP32[e+20>>2]=I.getFullYear()-1900,HEAP32[e+24>>2]=I.getDay();var B=ydayFromDate(I)|0;HEAP32[e+28>>2]=B,HEAP32[e+36>>2]=-(I.getTimezoneOffset()*60);var tr=new Date(I.getFullYear(),0,1),rr=new Date(I.getFullYear(),6,1).getTimezoneOffset(),ir=tr.getTimezoneOffset(),lr=(rr!=ir&&I.getTimezoneOffset()==Math.min(ir,rr))|0;HEAP32[e+32>>2]=lr}__localtime_js.sig="vjp";function __mmap_js(k,e,I,B,tr,rr,ir){tr=bigintToI53Checked(tr);try{if(isNaN(tr))return 61;var lr=SYSCALLS.getStreamFromFD(B),dr=FS.mmap(lr,k,tr,e,I),mr=dr.ptr;return HEAP32[rr>>2]=dr.allocated,HEAPU32[ir>>2]=mr,0}catch(hr){if(typeof FS>"u"||hr.name!=="ErrnoError")throw hr;return-hr.errno}}__mmap_js.sig="ipiiijpp";function __munmap_js(k,e,I,B,tr,rr){rr=bigintToI53Checked(rr);try{var ir=SYSCALLS.getStreamFromFD(tr);I&2&&SYSCALLS.doMsync(k,ir,e,B,rr)}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return-lr.errno}}__munmap_js.sig="ippiiij";var timers={},handleException=k=>{if(k instanceof ExitStatus||k=="unwind")return EXITSTATUS;quit_(1,k)},keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0,_proc_exit=k=>{EXITSTATUS=k,keepRuntimeAlive()||(Module.onExit?.(k),ABORT=!0),quit_(k,new ExitStatus(k))};_proc_exit.sig="vi";var exitJS=(k,e)=>{EXITSTATUS=k,_proc_exit(k)},_exit=exitJS;_exit.sig="vi";var maybeExit=()=>{if(!keepRuntimeAlive())try{_exit(EXITSTATUS)}catch(k){handleException(k)}},callUserCallback=k=>{if(!ABORT)try{k(),maybeExit()}catch(e){handleException(e)}},_emscripten_get_now=()=>performance.now();_emscripten_get_now.sig="d";var __setitimer_js=(k,e)=>{if(timers[k]&&(clearTimeout(timers[k].id),delete timers[k]),!e)return 0;var I=setTimeout(()=>{delete timers[k],callUserCallback(()=>__emscripten_timeout(k,_emscripten_get_now()))},e);return timers[k]={id:I,timeout_ms:e},0};__setitimer_js.sig="iid";var __tzset_js=(k,e,I,B)=>{var tr=new Date().getFullYear(),rr=new Date(tr,0,1),ir=new Date(tr,6,1),lr=rr.getTimezoneOffset(),dr=ir.getTimezoneOffset(),mr=Math.max(lr,dr);HEAPU32[k>>2]=mr*60,HEAP32[e>>2]=+(lr!=dr);var hr=gr=>{var Sr=gr>=0?"-":"+",Ar=Math.abs(gr),Or=String(Math.floor(Ar/60)).padStart(2,"0"),Fr=String(Ar%60).padStart(2,"0");return`UTC${Sr}${Or}${Fr}`},fr=hr(lr),_r=hr(dr);dr<lr?(stringToUTF8(fr,I,17),stringToUTF8(_r,B,17)):(stringToUTF8(fr,B,17),stringToUTF8(_r,I,17))};__tzset_js.sig="vpppp";var _emscripten_date_now=()=>Date.now();_emscripten_date_now.sig="d";var checkWasiClock=k=>k>=0&&k<=3;function _clock_time_get(k,e,I){if(!checkWasiClock(k))return 28;var B;k===0?B=_emscripten_date_now():B=_emscripten_get_now();var tr=Math.round(B*1e3*1e3);return HEAP64[I>>3]=BigInt(tr),0}_clock_time_get.sig="iijp";var readEmAsmArgsArray=[],readEmAsmArgs=(k,e)=>{readEmAsmArgsArray.length=0;for(var I;I=HEAPU8[k++];){var B=I!=105;B&=I!=112,e+=B&&e%8?4:0,readEmAsmArgsArray.push(I==112?HEAPU32[e>>2]:I==106?HEAP64[e>>3]:I==105?HEAP32[e>>2]:HEAPF64[e>>3]),e+=B?8:4}return readEmAsmArgsArray},runEmAsmFunction=(k,e,I)=>{var B=readEmAsmArgs(e,I);return ASM_CONSTS[k](...B)},_emscripten_asm_const_int=(k,e,I)=>runEmAsmFunction(k,e,I);_emscripten_asm_const_int.sig="ippp";var _emscripten_force_exit=k=>{__emscripten_runtime_keepalive_clear(),_exit(k)};_emscripten_force_exit.sig="vi";var getHeapMax=()=>2147483648,growMemory=k=>{var e=wasmMemory.buffer,I=(k-e.byteLength+65535)/65536|0;try{return wasmMemory.grow(I),updateMemoryViews(),1}catch{}},_emscripten_resize_heap=k=>{var e=HEAPU8.length;k>>>=0;var I=getHeapMax();if(k>I)return!1;for(var B=1;B<=4;B*=2){var tr=e*(1+.2/B);tr=Math.min(tr,k+100663296);var rr=Math.min(I,alignMemory(Math.max(k,tr),65536)),ir=growMemory(rr);if(ir)return!0}return!1};_emscripten_resize_heap.sig="ip";var getEnvStrings=()=>{if(!getEnvStrings.strings){var k=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:k,_:getExecutableName()};for(var I in ENV)ENV[I]===void 0?delete e[I]:e[I]=ENV[I];var B=[];for(var I in e)B.push(`${I}=${e[I]}`);getEnvStrings.strings=B}return getEnvStrings.strings},stringToAscii=(k,e)=>{for(var I=0;I<k.length;++I)HEAP8[e++]=k.charCodeAt(I);HEAP8[e]=0},_environ_get=(k,e)=>{var I=0;return getEnvStrings().forEach((B,tr)=>{var rr=e+I;HEAPU32[k+tr*4>>2]=rr,stringToAscii(B,rr),I+=B.length+1}),0};_environ_get.sig="ipp";var _environ_sizes_get=(k,e)=>{var I=getEnvStrings();HEAPU32[k>>2]=I.length;var B=0;return I.forEach(tr=>B+=tr.length+1),HEAPU32[e>>2]=B,0};_environ_sizes_get.sig="ipp";function _fd_close(k){try{var e=SYSCALLS.getStreamFromFD(k);return FS.close(e),0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return I.errno}}_fd_close.sig="ii";function _fd_fdstat_get(k,e){try{var I=0,B=0,tr=0,rr=SYSCALLS.getStreamFromFD(k),ir=rr.tty?2:FS.isDir(rr.mode)?3:FS.isLink(rr.mode)?7:4;return HEAP8[e]=ir,HEAP16[e+2>>1]=tr,HEAP64[e+8>>3]=BigInt(I),HEAP64[e+16>>3]=BigInt(B),0}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return lr.errno}}_fd_fdstat_get.sig="iip";var doReadv=(k,e,I,B)=>{for(var tr=0,rr=0;rr<I;rr++){var ir=HEAPU32[e>>2],lr=HEAPU32[e+4>>2];e+=8;var dr=FS.read(k,HEAP8,ir,lr,B);if(dr<0)return-1;if(tr+=dr,dr<lr)break;typeof B<"u"&&(B+=dr)}return tr};function _fd_pread(k,e,I,B,tr){B=bigintToI53Checked(B);try{if(isNaN(B))return 61;var rr=SYSCALLS.getStreamFromFD(k),ir=doReadv(rr,e,I,B);return HEAPU32[tr>>2]=ir,0}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return lr.errno}}_fd_pread.sig="iippjp";var doWritev=(k,e,I,B)=>{for(var tr=0,rr=0;rr<I;rr++){var ir=HEAPU32[e>>2],lr=HEAPU32[e+4>>2];e+=8;var dr=FS.write(k,HEAP8,ir,lr,B);if(dr<0)return-1;if(tr+=dr,dr<lr)break;typeof B<"u"&&(B+=dr)}return tr};function _fd_pwrite(k,e,I,B,tr){B=bigintToI53Checked(B);try{if(isNaN(B))return 61;var rr=SYSCALLS.getStreamFromFD(k),ir=doWritev(rr,e,I,B);return HEAPU32[tr>>2]=ir,0}catch(lr){if(typeof FS>"u"||lr.name!=="ErrnoError")throw lr;return lr.errno}}_fd_pwrite.sig="iippjp";function _fd_read(k,e,I,B){try{var tr=SYSCALLS.getStreamFromFD(k),rr=doReadv(tr,e,I);return HEAPU32[B>>2]=rr,0}catch(ir){if(typeof FS>"u"||ir.name!=="ErrnoError")throw ir;return ir.errno}}_fd_read.sig="iippp";function _fd_seek(k,e,I,B){e=bigintToI53Checked(e);try{if(isNaN(e))return 61;var tr=SYSCALLS.getStreamFromFD(k);return FS.llseek(tr,e,I),HEAP64[B>>3]=BigInt(tr.position),tr.getdents&&e===0&&I===0&&(tr.getdents=null),0}catch(rr){if(typeof FS>"u"||rr.name!=="ErrnoError")throw rr;return rr.errno}}_fd_seek.sig="iijip";function _fd_sync(k){try{var e=SYSCALLS.getStreamFromFD(k);return e.stream_ops?.fsync?e.stream_ops.fsync(e):0}catch(I){if(typeof FS>"u"||I.name!=="ErrnoError")throw I;return I.errno}}_fd_sync.sig="ii";function _fd_write(k,e,I,B){try{var tr=SYSCALLS.getStreamFromFD(k),rr=doWritev(tr,e,I);return HEAPU32[B>>2]=rr,0}catch(ir){if(typeof FS>"u"||ir.name!=="ErrnoError")throw ir;return ir.errno}}_fd_write.sig="iippp";var _getaddrinfo=(k,e,I,B)=>{var tr=0,rr=0,ir=0,lr=0,dr=0,mr=0,hr;function fr(_r,gr,Sr,Ar,Or,Fr){var vr,xr,kr,Gr;return xr=_r===10?28:16,Or=_r===10?inetNtop6(Or):inetNtop4(Or),vr=_malloc(xr),Gr=writeSockaddr(vr,_r,Or,Fr),assert(!Gr),kr=_malloc(32),HEAP32[kr+4>>2]=_r,HEAP32[kr+8>>2]=gr,HEAP32[kr+12>>2]=Sr,HEAPU32[kr+24>>2]=Ar,HEAPU32[kr+20>>2]=vr,_r===10?HEAP32[kr+16>>2]=28:HEAP32[kr+16>>2]=16,HEAP32[kr+28>>2]=0,kr}if(I&&(ir=HEAP32[I>>2],lr=HEAP32[I+4>>2],dr=HEAP32[I+8>>2],mr=HEAP32[I+12>>2]),dr&&!mr&&(mr=dr===2?17:6),!dr&&mr&&(dr=mr===17?2:1),mr===0&&(mr=6),dr===0&&(dr=1),!k&&!e)return-2;if(ir&-1088||I!==0&&HEAP32[I>>2]&2&&!k)return-1;if(ir&32)return-2;if(dr!==0&&dr!==1&&dr!==2)return-7;if(lr!==0&&lr!==2&&lr!==10)return-6;if(e&&(e=UTF8ToString(e),rr=parseInt(e,10),isNaN(rr)))return ir&1024?-2:-8;if(!k)return lr===0&&(lr=2),ir&1||(lr===2?tr=_htonl(2130706433):tr=[0,0,0,_htonl(1)]),hr=fr(lr,dr,mr,null,tr,rr),HEAPU32[B>>2]=hr,0;if(k=UTF8ToString(k),tr=inetPton4(k),tr!==null)if(lr===0||lr===2)lr=2;else if(lr===10&&ir&8)tr=[0,0,_htonl(65535),tr],lr=10;else return-2;else if(tr=inetPton6(k),tr!==null)if(lr===0||lr===10)lr=10;else return-2;return tr!=null?(hr=fr(lr,dr,mr,k,tr,rr),HEAPU32[B>>2]=hr,0):ir&4?-2:(k=DNS.lookup_name(k),tr=inetPton4(k),lr===0?lr=2:lr===10&&(tr=[0,0,_htonl(65535),tr]),hr=fr(lr,dr,mr,null,tr,rr),HEAPU32[B>>2]=hr,0)};_getaddrinfo.sig="ipppp";var _getnameinfo=(k,e,I,B,tr,rr,ir)=>{var lr=readSockaddr(k,e);if(lr.errno)return-6;var dr=lr.port,mr=lr.addr,hr=!1;if(I&&B){var fr;if(ir&1||!(fr=DNS.lookup_addr(mr))){if(ir&8)return-2}else mr=fr;var _r=stringToUTF8(mr,I,B);_r+1>=B&&(hr=!0)}if(tr&&rr){dr=""+dr;var _r=stringToUTF8(dr,tr,rr);_r+1>=rr&&(hr=!0)}return hr?-12:0};_getnameinfo.sig="ipipipii";var stringToNewUTF8=k=>{var e=lengthBytesUTF8(k)+1,I=_malloc(e);return I&&stringToUTF8(k,I,e),I},FS_createPath=FS.createPath,FS_unlink=k=>FS.unlink(k),FS_createLazyFile=FS.createLazyFile,FS_createDevice=FS.createDevice,getTempRet0=k=>__emscripten_tempret_get();Module.getTempRet0=getTempRet0;var setTempRet0=k=>__emscripten_tempret_set(k),_setTempRet0=setTempRet0;Module._setTempRet0=_setTempRet0;var _getTempRet0=getTempRet0;Module._getTempRet0=_getTempRet0;class ExceptionInfo{constructor(e){this.excPtr=e,this.ptr=e-24}set_type(e){HEAPU32[this.ptr+4>>2]=e}get_type(){return HEAPU32[this.ptr+4>>2]}set_destructor(e){HEAPU32[this.ptr+8>>2]=e}get_destructor(){return HEAPU32[this.ptr+8>>2]}set_caught(e){e=e?1:0,HEAP8[this.ptr+12]=e}get_caught(){return HEAP8[this.ptr+12]!=0}set_rethrown(e){e=e?1:0,HEAP8[this.ptr+13]=e}get_rethrown(){return HEAP8[this.ptr+13]!=0}init(e,I){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(I)}set_adjusted_ptr(e){HEAPU32[this.ptr+16>>2]=e}get_adjusted_ptr(){return HEAPU32[this.ptr+16>>2]}}var exceptionLast=0,___cxa_throw=(k,e,I)=>{var B=new ExceptionInfo(k);throw B.init(e,I),exceptionLast=k,exceptionLast};Module.___cxa_throw=___cxa_throw,___cxa_throw.sig="vppp",registerWasmPlugin(),FS.createPreloadedFile=FS_createPreloadedFile,FS.staticInit(),Module.FS_createPath=FS.createPath,Module.FS_createDataFile=FS.createDataFile,Module.FS_createPreloadedFile=FS.createPreloadedFile,Module.FS_unlink=FS.unlink,Module.FS_createLazyFile=FS.createLazyFile,Module.FS_createDevice=FS.createDevice,MEMFS.doesNotExistError=new FS.ErrnoError(44),MEMFS.doesNotExistError.stack="<generic error, no stack>",ENVIRONMENT_IS_NODE&&NODEFS.staticInit();var wasmImports={__assert_fail:___assert_fail,__call_sighandler:___call_sighandler,__heap_base:___heap_base,__indirect_function_table:wasmTable,__memory_base:___memory_base,__stack_pointer:___stack_pointer,__syscall__newselect:___syscall__newselect,__syscall_bind:___syscall_bind,__syscall_chdir:___syscall_chdir,__syscall_chmod:___syscall_chmod,__syscall_connect:___syscall_connect,__syscall_dup:___syscall_dup,__syscall_dup3:___syscall_dup3,__syscall_faccessat:___syscall_faccessat,__syscall_fadvise64:___syscall_fadvise64,__syscall_fallocate:___syscall_fallocate,__syscall_fcntl64:___syscall_fcntl64,__syscall_fdatasync:___syscall_fdatasync,__syscall_fstat64:___syscall_fstat64,__syscall_ftruncate64:___syscall_ftruncate64,__syscall_getcwd:___syscall_getcwd,__syscall_getdents64:___syscall_getdents64,__syscall_getsockname:___syscall_getsockname,__syscall_getsockopt:___syscall_getsockopt,__syscall_ioctl:___syscall_ioctl,__syscall_lstat64:___syscall_lstat64,__syscall_mkdirat:___syscall_mkdirat,__syscall_newfstatat:___syscall_newfstatat,__syscall_openat:___syscall_openat,__syscall_pipe:___syscall_pipe,__syscall_poll:___syscall_poll,__syscall_readlinkat:___syscall_readlinkat,__syscall_recvfrom:___syscall_recvfrom,__syscall_renameat:___syscall_renameat,__syscall_rmdir:___syscall_rmdir,__syscall_sendto:___syscall_sendto,__syscall_socket:___syscall_socket,__syscall_stat64:___syscall_stat64,__syscall_symlinkat:___syscall_symlinkat,__syscall_truncate64:___syscall_truncate64,__syscall_unlinkat:___syscall_unlinkat,__table_base:___table_base,_abort_js:__abort_js,_dlopen_js:__dlopen_js,_dlsym_js:__dlsym_js,_emscripten_get_progname:__emscripten_get_progname,_emscripten_memcpy_js:__emscripten_memcpy_js,_emscripten_runtime_keepalive_clear:__emscripten_runtime_keepalive_clear,_emscripten_system:__emscripten_system,_emscripten_throw_longjmp:__emscripten_throw_longjmp,_gmtime_js:__gmtime_js,_localtime_js:__localtime_js,_mmap_js:__mmap_js,_munmap_js:__munmap_js,_setitimer_js:__setitimer_js,_tzset_js:__tzset_js,clock_time_get:_clock_time_get,emscripten_asm_const_int:_emscripten_asm_const_int,emscripten_date_now:_emscripten_date_now,emscripten_force_exit:_emscripten_force_exit,emscripten_get_now:_emscripten_get_now,emscripten_resize_heap:_emscripten_resize_heap,environ_get:_environ_get,environ_sizes_get:_environ_sizes_get,exit:_exit,fd_close:_fd_close,fd_fdstat_get:_fd_fdstat_get,fd_pread:_fd_pread,fd_pwrite:_fd_pwrite,fd_read:_fd_read,fd_seek:_fd_seek,fd_sync:_fd_sync,fd_write:_fd_write,getaddrinfo:_getaddrinfo,getnameinfo:_getnameinfo,invoke_di,invoke_i,invoke_id,invoke_ii,invoke_iii,invoke_iiii,invoke_iiiii,invoke_iiiiii,invoke_iiiiiii,invoke_iiiiiiii,invoke_iiiiiiiii,invoke_iiiiiiiiii,invoke_iiiiiiiiiii,invoke_iiiiiiiiiiiiii,invoke_iiiiiiiiiiiiiiiiii,invoke_iiiiiji,invoke_iiiij,invoke_iiiijii,invoke_iiij,invoke_iiji,invoke_ij,invoke_ijiiiii,invoke_ijiiiiii,invoke_j,invoke_ji,invoke_jii,invoke_jiiii,invoke_jiiiiii,invoke_jiiiiiiiii,invoke_v,invoke_vi,invoke_vid,invoke_vii,invoke_viii,invoke_viiii,invoke_viiiii,invoke_viiiiii,invoke_viiiiiii,invoke_viiiiiiii,invoke_viiiiiiiii,invoke_viiiiiiiiiiii,invoke_viiiji,invoke_viij,invoke_viiji,invoke_viijii,invoke_viijiiii,invoke_vij,invoke_viji,invoke_vijiji,invoke_vj,invoke_vji,memory:wasmMemory,proc_exit:_proc_exit},wasmExports;createWasm(),Module._fiprintf=(k,e,I)=>(Module._fiprintf=wasmExports.fiprintf)(k,e,I),Module._fopen=(k,e)=>(Module._fopen=wasmExports.fopen)(k,e);var _fflush=Module._fflush=k=>(_fflush=Module._fflush=wasmExports.fflush)(k);Module._fclose=k=>(Module._fclose=wasmExports.fclose)(k),Module._free=k=>(Module._free=wasmExports.free)(k),Module.___errno_location=()=>(Module.___errno_location=wasmExports.__errno_location)(),Module._ProcessInterrupts=()=>(Module._ProcessInterrupts=wasmExports.ProcessInterrupts)(),Module._errstart_cold=(k,e)=>(Module._errstart_cold=wasmExports.errstart_cold)(k,e),Module._errcode=k=>(Module._errcode=wasmExports.errcode)(k),Module._errmsg=(k,e)=>(Module._errmsg=wasmExports.errmsg)(k,e),Module._errfinish=(k,e,I)=>(Module._errfinish=wasmExports.errfinish)(k,e,I),Module._puts=k=>(Module._puts=wasmExports.puts)(k),Module._errstart=(k,e)=>(Module._errstart=wasmExports.errstart)(k,e),Module._errmsg_internal=(k,e)=>(Module._errmsg_internal=wasmExports.errmsg_internal)(k,e),Module._errdetail=(k,e)=>(Module._errdetail=wasmExports.errdetail)(k,e),Module._errhint=(k,e)=>(Module._errhint=wasmExports.errhint)(k,e),Module._pg_parse_query=k=>(Module._pg_parse_query=wasmExports.pg_parse_query)(k),Module._gettimeofday=(k,e)=>(Module._gettimeofday=wasmExports.gettimeofday)(k,e),Module._raw_parser=(k,e)=>(Module._raw_parser=wasmExports.raw_parser)(k,e),Module._initStringInfo=k=>(Module._initStringInfo=wasmExports.initStringInfo)(k),Module._appendStringInfoString=(k,e)=>(Module._appendStringInfoString=wasmExports.appendStringInfoString)(k,e),Module._appendStringInfo=(k,e,I)=>(Module._appendStringInfo=wasmExports.appendStringInfo)(k,e,I),Module._errdetail_internal=(k,e)=>(Module._errdetail_internal=wasmExports.errdetail_internal)(k,e),Module._pfree=k=>(Module._pfree=wasmExports.pfree)(k),Module._list_make1_impl=(k,e)=>(Module._list_make1_impl=wasmExports.list_make1_impl)(k,e),Module._QueryRewrite=k=>(Module._QueryRewrite=wasmExports.QueryRewrite)(k),Module._pg_plan_query=(k,e,I,B)=>(Module._pg_plan_query=wasmExports.pg_plan_query)(k,e,I,B),Module._palloc0=k=>(Module._palloc0=wasmExports.palloc0)(k),Module._lappend=(k,e)=>(Module._lappend=wasmExports.lappend)(k,e),Module._GetCurrentTimestamp=()=>(Module._GetCurrentTimestamp=wasmExports.GetCurrentTimestamp)(),Module._pg_prng_double=k=>(Module._pg_prng_double=wasmExports.pg_prng_double)(k),Module._pg_snprintf=(k,e,I,B)=>(Module._pg_snprintf=wasmExports.pg_snprintf)(k,e,I,B),Module._sigaddset=(k,e)=>(Module._sigaddset=wasmExports.sigaddset)(k,e),Module._die=k=>(Module._die=wasmExports.die)(k),Module._check_stack_depth=()=>(Module._check_stack_depth=wasmExports.check_stack_depth)(),Module._pre_format_elog_string=(k,e)=>(Module._pre_format_elog_string=wasmExports.pre_format_elog_string)(k,e),Module._format_elog_string=(k,e)=>(Module._format_elog_string=wasmExports.format_elog_string)(k,e),Module._pstrdup=k=>(Module._pstrdup=wasmExports.pstrdup)(k),Module._SplitIdentifierString=(k,e,I)=>(Module._SplitIdentifierString=wasmExports.SplitIdentifierString)(k,e,I),Module._list_free=k=>(Module._list_free=wasmExports.list_free)(k),Module._pg_strcasecmp=(k,e)=>(Module._pg_strcasecmp=wasmExports.pg_strcasecmp)(k,e),Module._guc_malloc=(k,e)=>(Module._guc_malloc=wasmExports.guc_malloc)(k,e),Module._SetConfigOption=(k,e,I,B)=>(Module._SetConfigOption=wasmExports.SetConfigOption)(k,e,I,B),Module._pg_sprintf=(k,e,I)=>(Module._pg_sprintf=wasmExports.pg_sprintf)(k,e,I),Module._strcmp=(k,e)=>(Module._strcmp=wasmExports.strcmp)(k,e),Module._strdup=k=>(Module._strdup=wasmExports.strdup)(k),Module._atoi=k=>(Module._atoi=wasmExports.atoi)(k),Module._strlcpy=(k,e,I)=>(Module._strlcpy=wasmExports.strlcpy)(k,e,I),Module._pgl_shutdown=()=>(Module._pgl_shutdown=wasmExports.pgl_shutdown)(),Module._pgl_closed=()=>(Module._pgl_closed=wasmExports.pgl_closed)(),Module._resetStringInfo=k=>(Module._resetStringInfo=wasmExports.resetStringInfo)(k),Module._getc=k=>(Module._getc=wasmExports.getc)(k),Module._appendStringInfoChar=(k,e)=>(Module._appendStringInfoChar=wasmExports.appendStringInfoChar)(k,e),Module._strlen=k=>(Module._strlen=wasmExports.strlen)(k),Module._strncmp=(k,e,I)=>(Module._strncmp=wasmExports.strncmp)(k,e,I),Module._pg_fprintf=(k,e,I)=>(Module._pg_fprintf=wasmExports.pg_fprintf)(k,e,I),Module._pgstat_report_activity=(k,e)=>(Module._pgstat_report_activity=wasmExports.pgstat_report_activity)(k,e),Module._errhidestmt=k=>(Module._errhidestmt=wasmExports.errhidestmt)(k),Module._GetTransactionSnapshot=()=>(Module._GetTransactionSnapshot=wasmExports.GetTransactionSnapshot)(),Module._PushActiveSnapshot=k=>(Module._PushActiveSnapshot=wasmExports.PushActiveSnapshot)(k),Module._AllocSetContextCreateInternal=(k,e,I,B,tr)=>(Module._AllocSetContextCreateInternal=wasmExports.AllocSetContextCreateInternal)(k,e,I,B,tr),Module._PopActiveSnapshot=()=>(Module._PopActiveSnapshot=wasmExports.PopActiveSnapshot)(),Module._CreateDestReceiver=k=>(Module._CreateDestReceiver=wasmExports.CreateDestReceiver)(k),Module._CommitTransactionCommand=()=>(Module._CommitTransactionCommand=wasmExports.CommitTransactionCommand)(),Module._CommandCounterIncrement=()=>(Module._CommandCounterIncrement=wasmExports.CommandCounterIncrement)(),Module._MemoryContextDelete=k=>(Module._MemoryContextDelete=wasmExports.MemoryContextDelete)(k),Module._StartTransactionCommand=()=>(Module._StartTransactionCommand=wasmExports.StartTransactionCommand)(),Module.___wasm_setjmp_test=(k,e)=>(Module.___wasm_setjmp_test=wasmExports.__wasm_setjmp_test)(k,e),Module._pg_printf=(k,e)=>(Module._pg_printf=wasmExports.pg_printf)(k,e),Module.___wasm_setjmp=(k,e,I)=>(Module.___wasm_setjmp=wasmExports.__wasm_setjmp)(k,e,I),Module._FlushErrorState=()=>(Module._FlushErrorState=wasmExports.FlushErrorState)(),Module._emscripten_longjmp=(k,e)=>(Module._emscripten_longjmp=wasmExports.emscripten_longjmp)(k,e),Module._enlargeStringInfo=(k,e)=>(Module._enlargeStringInfo=wasmExports.enlargeStringInfo)(k,e);var _malloc=Module._malloc=k=>(_malloc=Module._malloc=wasmExports.malloc)(k);Module._realloc=(k,e)=>(Module._realloc=wasmExports.realloc)(k,e),Module._getenv=k=>(Module._getenv=wasmExports.getenv)(k),Module._strspn=(k,e)=>(Module._strspn=wasmExports.strspn)(k,e),Module._strnlen=(k,e)=>(Module._strnlen=wasmExports.strnlen)(k,e),Module._setenv=(k,e,I)=>(Module._setenv=wasmExports.setenv)(k,e,I),Module._fileno=k=>(Module._fileno=wasmExports.fileno)(k),Module._isatty=k=>(Module._isatty=wasmExports.isatty)(k),Module._strchr=(k,e)=>(Module._strchr=wasmExports.strchr)(k,e),Module._pg_vsnprintf=(k,e,I,B)=>(Module._pg_vsnprintf=wasmExports.pg_vsnprintf)(k,e,I,B),Module._strcpy=(k,e)=>(Module._strcpy=wasmExports.strcpy)(k,e),Module._pg_get_encoding_from_locale=(k,e)=>(Module._pg_get_encoding_from_locale=wasmExports.pg_get_encoding_from_locale)(k,e),Module._pg_encoding_to_char_private=k=>(Module._pg_encoding_to_char_private=wasmExports.pg_encoding_to_char_private)(k),Module._psprintf=(k,e)=>(Module._psprintf=wasmExports.psprintf)(k,e),Module._stat=(k,e)=>(Module._stat=wasmExports.stat)(k,e),Module._pqsignal=(k,e)=>(Module._pqsignal=wasmExports.pqsignal)(k,e),Module._fwrite=(k,e,I,B)=>(Module._fwrite=wasmExports.fwrite)(k,e,I,B),Module._strftime=(k,e,I,B)=>(Module._strftime=wasmExports.strftime)(k,e,I,B),Module._strstr=(k,e)=>(Module._strstr=wasmExports.strstr)(k,e),Module._fputs=(k,e)=>(Module._fputs=wasmExports.fputs)(k,e),Module._strtol=(k,e,I)=>(Module._strtol=wasmExports.strtol)(k,e,I),Module._ferror=k=>(Module._ferror=wasmExports.ferror)(k),Module._pg_strip_crlf=k=>(Module._pg_strip_crlf=wasmExports.pg_strip_crlf)(k),Module._get_buffer_size=k=>(Module._get_buffer_size=wasmExports.get_buffer_size)(k),Module._get_buffer_addr=k=>(Module._get_buffer_addr=wasmExports.get_buffer_addr)(k),Module._get_channel=()=>(Module._get_channel=wasmExports.get_channel)(),Module._interactive_read=()=>(Module._interactive_read=wasmExports.interactive_read)(),Module._interactive_write=k=>(Module._interactive_write=wasmExports.interactive_write)(k),Module._use_wire=k=>(Module._use_wire=wasmExports.use_wire)(k),Module._clear_error=()=>(Module._clear_error=wasmExports.clear_error)(),Module._interactive_one=()=>(Module._interactive_one=wasmExports.interactive_one)(),Module._abort=()=>(Module._abort=wasmExports.abort)(),Module._pq_recvbuf_fill=(k,e)=>(Module._pq_recvbuf_fill=wasmExports.pq_recvbuf_fill)(k,e),Module._pq_getmsgint=(k,e)=>(Module._pq_getmsgint=wasmExports.pq_getmsgint)(k,e),Module._palloc=k=>(Module._palloc=wasmExports.palloc)(k),Module._makeParamList=k=>(Module._makeParamList=wasmExports.makeParamList)(k),Module._getTypeInputInfo=(k,e,I)=>(Module._getTypeInputInfo=wasmExports.getTypeInputInfo)(k,e,I),Module._pnstrdup=(k,e)=>(Module._pnstrdup=wasmExports.pnstrdup)(k,e),Module._MemoryContextSetParent=(k,e)=>(Module._MemoryContextSetParent=wasmExports.MemoryContextSetParent)(k,e),Module._unlink=k=>(Module._unlink=wasmExports.unlink)(k),Module._pgl_backend=()=>(Module._pgl_backend=wasmExports.pgl_backend)(),Module._pgl_initdb=()=>(Module._pgl_initdb=wasmExports.pgl_initdb)(),Module._dup=k=>(Module._dup=wasmExports.dup)(k),Module._main=(k,e)=>(Module._main=wasmExports.__main_argc_argv)(k,e),Module._appendStringInfoStringQuoted=(k,e,I)=>(Module._appendStringInfoStringQuoted=wasmExports.appendStringInfoStringQuoted)(k,e,I),Module._set_errcontext_domain=k=>(Module._set_errcontext_domain=wasmExports.set_errcontext_domain)(k),Module._errcontext_msg=(k,e)=>(Module._errcontext_msg=wasmExports.errcontext_msg)(k,e),Module._pg_is_ascii=k=>(Module._pg_is_ascii=wasmExports.pg_is_ascii)(k),Module._memchr=(k,e,I)=>(Module._memchr=wasmExports.memchr)(k,e,I),Module._strrchr=(k,e)=>(Module._strrchr=wasmExports.strrchr)(k,e),Module._replace_percent_placeholders=(k,e,I,B)=>(Module._replace_percent_placeholders=wasmExports.replace_percent_placeholders)(k,e,I,B),Module._pg_b64_encode=(k,e,I,B)=>(Module._pg_b64_encode=wasmExports.pg_b64_encode)(k,e,I,B),Module._pg_b64_decode=(k,e,I,B)=>(Module._pg_b64_decode=wasmExports.pg_b64_decode)(k,e,I,B),Module._pg_b64_enc_len=k=>(Module._pg_b64_enc_len=wasmExports.pg_b64_enc_len)(k),Module._pg_b64_dec_len=k=>(Module._pg_b64_dec_len=wasmExports.pg_b64_dec_len)(k),Module._MemoryContextAllocZero=(k,e)=>(Module._MemoryContextAllocZero=wasmExports.MemoryContextAllocZero)(k,e),Module._MemoryContextAllocExtended=(k,e,I)=>(Module._MemoryContextAllocExtended=wasmExports.MemoryContextAllocExtended)(k,e,I),Module._hash_bytes=(k,e)=>(Module._hash_bytes=wasmExports.hash_bytes)(k,e),Module._memcmp=(k,e,I)=>(Module._memcmp=wasmExports.memcmp)(k,e,I),Module._repalloc=(k,e)=>(Module._repalloc=wasmExports.repalloc)(k,e),Module._pg_qsort=(k,e,I,B)=>(Module._pg_qsort=wasmExports.pg_qsort)(k,e,I,B),Module._strlcat=(k,e,I)=>(Module._strlcat=wasmExports.strlcat)(k,e,I),Module._OpenTransientFile=(k,e)=>(Module._OpenTransientFile=wasmExports.OpenTransientFile)(k,e),Module._errcode_for_file_access=()=>(Module._errcode_for_file_access=wasmExports.errcode_for_file_access)(),Module._read=(k,e,I)=>(Module._read=wasmExports.read)(k,e,I),Module._CloseTransientFile=k=>(Module._CloseTransientFile=wasmExports.CloseTransientFile)(k),Module._time=k=>(Module._time=wasmExports.time)(k),Module._write=(k,e,I)=>(Module._write=wasmExports.write)(k,e,I),Module._close=k=>(Module._close=wasmExports.close)(k),Module.___multi3=(k,e,I,B,tr)=>(Module.___multi3=wasmExports.__multi3)(k,e,I,B,tr),Module._pg_char_to_encoding_private=k=>(Module._pg_char_to_encoding_private=wasmExports.pg_char_to_encoding_private)(k),Module._isalnum=k=>(Module._isalnum=wasmExports.isalnum)(k),Module._popen=(k,e)=>(Module._popen=wasmExports.popen)(k,e),Module._pclose=k=>(Module._pclose=wasmExports.pclose)(k),Module._wait_result_to_str=k=>(Module._wait_result_to_str=wasmExports.wait_result_to_str)(k),Module._float_to_shortest_decimal_bufn=(k,e)=>(Module._float_to_shortest_decimal_bufn=wasmExports.float_to_shortest_decimal_bufn)(k,e),Module._float_to_shortest_decimal_buf=(k,e)=>(Module._float_to_shortest_decimal_buf=wasmExports.float_to_shortest_decimal_buf)(k,e),Module._pwrite=(k,e,I,B)=>(Module._pwrite=wasmExports.pwrite)(k,e,I,B),Module._hash_bytes_extended=(k,e,I)=>(Module._hash_bytes_extended=wasmExports.hash_bytes_extended)(k,e,I),Module._pg_getaddrinfo_all=(k,e,I,B)=>(Module._pg_getaddrinfo_all=wasmExports.pg_getaddrinfo_all)(k,e,I,B);var _calloc=Module._calloc=(k,e)=>(_calloc=Module._calloc=wasmExports.calloc)(k,e);Module._pg_freeaddrinfo_all=(k,e)=>(Module._pg_freeaddrinfo_all=wasmExports.pg_freeaddrinfo_all)(k,e),Module._pg_getnameinfo_all=(k,e,I,B,tr,rr,ir)=>(Module._pg_getnameinfo_all=wasmExports.pg_getnameinfo_all)(k,e,I,B,tr,rr,ir),Module._IsValidJsonNumber=(k,e)=>(Module._IsValidJsonNumber=wasmExports.IsValidJsonNumber)(k,e),Module._appendBinaryStringInfo=(k,e,I)=>(Module._appendBinaryStringInfo=wasmExports.appendBinaryStringInfo)(k,e,I),Module._makeStringInfo=()=>(Module._makeStringInfo=wasmExports.makeStringInfo)(),Module._pg_encoding_mblen=(k,e)=>(Module._pg_encoding_mblen=wasmExports.pg_encoding_mblen)(k,e),Module._GetDatabaseEncodingName=()=>(Module._GetDatabaseEncodingName=wasmExports.GetDatabaseEncodingName)(),Module._ScanKeywordLookup=(k,e)=>(Module._ScanKeywordLookup=wasmExports.ScanKeywordLookup)(k,e),Module._pg_md5_encrypt=(k,e,I,B,tr)=>(Module._pg_md5_encrypt=wasmExports.pg_md5_encrypt)(k,e,I,B,tr),Module._strtoul=(k,e,I)=>(Module._strtoul=wasmExports.strtoul)(k,e,I),Module._sscanf=(k,e,I)=>(Module._sscanf=wasmExports.sscanf)(k,e,I),Module._fgets=(k,e,I)=>(Module._fgets=wasmExports.fgets)(k,e,I),Module._pg_prng_seed=(k,e)=>(Module._pg_prng_seed=wasmExports.pg_prng_seed)(k,e),Module._pg_prng_seed_check=k=>(Module._pg_prng_seed_check=wasmExports.pg_prng_seed_check)(k),Module._pg_prng_uint64=k=>(Module._pg_prng_uint64=wasmExports.pg_prng_uint64)(k),Module._pg_prng_uint64_range=(k,e,I)=>(Module._pg_prng_uint64_range=wasmExports.pg_prng_uint64_range)(k,e,I),Module._pg_prng_uint32=k=>(Module._pg_prng_uint32=wasmExports.pg_prng_uint32)(k),Module._log=k=>(Module._log=wasmExports.log)(k),Module._sin=k=>(Module._sin=wasmExports.sin)(k),Module._forkname_to_number=k=>(Module._forkname_to_number=wasmExports.forkname_to_number)(k),Module._pg_saslprep=(k,e)=>(Module._pg_saslprep=wasmExports.pg_saslprep)(k,e),Module._pg_utf_mblen_private=k=>(Module._pg_utf_mblen_private=wasmExports.pg_utf_mblen_private)(k),Module._pg_utf8_islegal=(k,e)=>(Module._pg_utf8_islegal=wasmExports.pg_utf8_islegal)(k,e),Module._bsearch=(k,e,I,B,tr)=>(Module._bsearch=wasmExports.bsearch)(k,e,I,B,tr),Module._scram_SaltedPassword=(k,e,I,B,tr,rr,ir,lr)=>(Module._scram_SaltedPassword=wasmExports.scram_SaltedPassword)(k,e,I,B,tr,rr,ir,lr),Module._pg_hmac_create=k=>(Module._pg_hmac_create=wasmExports.pg_hmac_create)(k),Module._pg_hmac_error=k=>(Module._pg_hmac_error=wasmExports.pg_hmac_error)(k),Module._pg_hmac_init=(k,e,I)=>(Module._pg_hmac_init=wasmExports.pg_hmac_init)(k,e,I),Module._pg_hmac_update=(k,e,I)=>(Module._pg_hmac_update=wasmExports.pg_hmac_update)(k,e,I),Module._pg_hmac_final=(k,e,I)=>(Module._pg_hmac_final=wasmExports.pg_hmac_final)(k,e,I),Module._pg_hmac_free=k=>(Module._pg_hmac_free=wasmExports.pg_hmac_free)(k),Module._scram_H=(k,e,I,B,tr)=>(Module._scram_H=wasmExports.scram_H)(k,e,I,B,tr),Module._scram_ClientKey=(k,e,I,B,tr)=>(Module._scram_ClientKey=wasmExports.scram_ClientKey)(k,e,I,B,tr),Module._scram_ServerKey=(k,e,I,B,tr)=>(Module._scram_ServerKey=wasmExports.scram_ServerKey)(k,e,I,B,tr),Module._scram_build_secret=(k,e,I,B,tr,rr,ir)=>(Module._scram_build_secret=wasmExports.scram_build_secret)(k,e,I,B,tr,rr,ir),Module._palloc_extended=(k,e)=>(Module._palloc_extended=wasmExports.palloc_extended)(k,e),Module._appendStringInfoSpaces=(k,e)=>(Module._appendStringInfoSpaces=wasmExports.appendStringInfoSpaces)(k,e),Module._geteuid=()=>(Module._geteuid=wasmExports.geteuid)(),Module._pg_encoding_set_invalid=(k,e)=>(Module._pg_encoding_set_invalid=wasmExports.pg_encoding_set_invalid)(k,e),Module._pg_encoding_dsplen=(k,e)=>(Module._pg_encoding_dsplen=wasmExports.pg_encoding_dsplen)(k,e),Module._pg_encoding_verifymbchar=(k,e,I)=>(Module._pg_encoding_verifymbchar=wasmExports.pg_encoding_verifymbchar)(k,e,I),Module._pg_encoding_verifymbstr=(k,e,I)=>(Module._pg_encoding_verifymbstr=wasmExports.pg_encoding_verifymbstr)(k,e,I),Module._pg_encoding_max_length=k=>(Module._pg_encoding_max_length=wasmExports.pg_encoding_max_length)(k),Module._explicit_bzero=(k,e)=>(Module._explicit_bzero=wasmExports.explicit_bzero)(k,e),Module._getpeereid=(k,e,I)=>(Module._getpeereid=wasmExports.getpeereid)(k,e,I),Module._getsockopt=(k,e,I,B,tr)=>(Module._getsockopt=wasmExports.getsockopt)(k,e,I,B,tr),Module._pg_inet_net_ntop=(k,e,I,B,tr)=>(Module._pg_inet_net_ntop=wasmExports.pg_inet_net_ntop)(k,e,I,B,tr),Module._fcntl=(k,e,I)=>(Module._fcntl=wasmExports.fcntl)(k,e,I),Module._getcwd=(k,e)=>(Module._getcwd=wasmExports.getcwd)(k,e),Module._pg_get_user_home_dir=(k,e,I)=>(Module._pg_get_user_home_dir=wasmExports.pg_get_user_home_dir)(k,e,I),Module._pg_popcount_optimized=(k,e)=>(Module._pg_popcount_optimized=wasmExports.pg_popcount_optimized)(k,e),Module._pg_strong_random=(k,e)=>(Module._pg_strong_random=wasmExports.pg_strong_random)(k,e),Module._open=(k,e,I)=>(Module._open=wasmExports.open)(k,e,I),Module._pg_usleep=k=>(Module._pg_usleep=wasmExports.pg_usleep)(k),Module._nanosleep=(k,e)=>(Module._nanosleep=wasmExports.nanosleep)(k,e),Module._pg_tolower=k=>(Module._pg_tolower=wasmExports.pg_tolower)(k),Module._sigemptyset=k=>(Module._sigemptyset=wasmExports.sigemptyset)(k),Module._getpid=()=>(Module._getpid=wasmExports.getpid)(),Module._qsort_arg=(k,e,I,B,tr)=>(Module._qsort_arg=wasmExports.qsort_arg)(k,e,I,B,tr),Module._snprintf=(k,e,I,B)=>(Module._snprintf=wasmExports.snprintf)(k,e,I,B),Module._pg_strerror_r=(k,e,I)=>(Module._pg_strerror_r=wasmExports.pg_strerror_r)(k,e,I),Module._RelationGetNumberOfBlocksInFork=(k,e)=>(Module._RelationGetNumberOfBlocksInFork=wasmExports.RelationGetNumberOfBlocksInFork)(k,e),Module._ExtendBufferedRel=(k,e,I,B)=>(Module._ExtendBufferedRel=wasmExports.ExtendBufferedRel)(k,e,I,B),Module._MarkBufferDirty=k=>(Module._MarkBufferDirty=wasmExports.MarkBufferDirty)(k),Module._XLogBeginInsert=()=>(Module._XLogBeginInsert=wasmExports.XLogBeginInsert)(),Module._XLogRegisterData=(k,e)=>(Module._XLogRegisterData=wasmExports.XLogRegisterData)(k,e),Module._XLogInsert=(k,e)=>(Module._XLogInsert=wasmExports.XLogInsert)(k,e),Module._UnlockReleaseBuffer=k=>(Module._UnlockReleaseBuffer=wasmExports.UnlockReleaseBuffer)(k),Module._brin_build_desc=k=>(Module._brin_build_desc=wasmExports.brin_build_desc)(k),Module._EnterParallelMode=()=>(Module._EnterParallelMode=wasmExports.EnterParallelMode)(),Module._CreateParallelContext=(k,e,I)=>(Module._CreateParallelContext=wasmExports.CreateParallelContext)(k,e,I),Module._RegisterSnapshot=k=>(Module._RegisterSnapshot=wasmExports.RegisterSnapshot)(k),Module._table_parallelscan_estimate=(k,e)=>(Module._table_parallelscan_estimate=wasmExports.table_parallelscan_estimate)(k,e),Module._add_size=(k,e)=>(Module._add_size=wasmExports.add_size)(k,e),Module._tuplesort_estimate_shared=k=>(Module._tuplesort_estimate_shared=wasmExports.tuplesort_estimate_shared)(k),Module._InitializeParallelDSM=k=>(Module._InitializeParallelDSM=wasmExports.InitializeParallelDSM)(k),Module._UnregisterSnapshot=k=>(Module._UnregisterSnapshot=wasmExports.UnregisterSnapshot)(k),Module._DestroyParallelContext=k=>(Module._DestroyParallelContext=wasmExports.DestroyParallelContext)(k),Module._ExitParallelMode=()=>(Module._ExitParallelMode=wasmExports.ExitParallelMode)(),Module._shm_toc_allocate=(k,e)=>(Module._shm_toc_allocate=wasmExports.shm_toc_allocate)(k,e),Module._ConditionVariableInit=k=>(Module._ConditionVariableInit=wasmExports.ConditionVariableInit)(k),Module._s_init_lock_sema=(k,e)=>(Module._s_init_lock_sema=wasmExports.s_init_lock_sema)(k,e),Module._table_parallelscan_initialize=(k,e,I)=>(Module._table_parallelscan_initialize=wasmExports.table_parallelscan_initialize)(k,e,I),Module._tuplesort_initialize_shared=(k,e,I)=>(Module._tuplesort_initialize_shared=wasmExports.tuplesort_initialize_shared)(k,e,I),Module._shm_toc_insert=(k,e,I)=>(Module._shm_toc_insert=wasmExports.shm_toc_insert)(k,e,I),Module._LaunchParallelWorkers=k=>(Module._LaunchParallelWorkers=wasmExports.LaunchParallelWorkers)(k),Module._WaitForParallelWorkersToAttach=k=>(Module._WaitForParallelWorkersToAttach=wasmExports.WaitForParallelWorkersToAttach)(k),Module._tas_sema=k=>(Module._tas_sema=wasmExports.tas_sema)(k),Module._s_lock=(k,e,I,B)=>(Module._s_lock=wasmExports.s_lock)(k,e,I,B),Module._s_unlock_sema=k=>(Module._s_unlock_sema=wasmExports.s_unlock_sema)(k),Module._ConditionVariableSleep=(k,e)=>(Module._ConditionVariableSleep=wasmExports.ConditionVariableSleep)(k,e),Module._ConditionVariableCancelSleep=()=>(Module._ConditionVariableCancelSleep=wasmExports.ConditionVariableCancelSleep)(),Module._tuplesort_performsort=k=>(Module._tuplesort_performsort=wasmExports.tuplesort_performsort)(k),Module._tuplesort_end=k=>(Module._tuplesort_end=wasmExports.tuplesort_end)(k),Module._MemoryContextReset=k=>(Module._MemoryContextReset=wasmExports.MemoryContextReset)(k),Module._brin_deform_tuple=(k,e,I)=>(Module._brin_deform_tuple=wasmExports.brin_deform_tuple)(k,e,I),Module._log_newpage_buffer=(k,e)=>(Module._log_newpage_buffer=wasmExports.log_newpage_buffer)(k,e),Module._LockBuffer=(k,e)=>(Module._LockBuffer=wasmExports.LockBuffer)(k,e),Module._ReleaseBuffer=k=>(Module._ReleaseBuffer=wasmExports.ReleaseBuffer)(k),Module._IndexGetRelation=(k,e)=>(Module._IndexGetRelation=wasmExports.IndexGetRelation)(k,e),Module._table_open=(k,e)=>(Module._table_open=wasmExports.table_open)(k,e),Module._ReadBufferExtended=(k,e,I,B,tr)=>(Module._ReadBufferExtended=wasmExports.ReadBufferExtended)(k,e,I,B,tr),Module._table_close=(k,e)=>(Module._table_close=wasmExports.table_close)(k,e),Module._build_reloptions=(k,e,I,B,tr,rr)=>(Module._build_reloptions=wasmExports.build_reloptions)(k,e,I,B,tr,rr),Module._RelationGetIndexScan=(k,e,I)=>(Module._RelationGetIndexScan=wasmExports.RelationGetIndexScan)(k,e,I),Module._pgstat_assoc_relation=k=>(Module._pgstat_assoc_relation=wasmExports.pgstat_assoc_relation)(k),Module._index_getprocinfo=(k,e,I)=>(Module._index_getprocinfo=wasmExports.index_getprocinfo)(k,e,I),Module._fmgr_info_copy=(k,e,I)=>(Module._fmgr_info_copy=wasmExports.fmgr_info_copy)(k,e,I),Module._FunctionCall4Coll=(k,e,I,B,tr,rr)=>(Module._FunctionCall4Coll=wasmExports.FunctionCall4Coll)(k,e,I,B,tr,rr),Module._FunctionCall1Coll=(k,e,I)=>(Module._FunctionCall1Coll=wasmExports.FunctionCall1Coll)(k,e,I),Module._brin_free_desc=k=>(Module._brin_free_desc=wasmExports.brin_free_desc)(k),Module._WaitForParallelWorkersToFinish=k=>(Module._WaitForParallelWorkersToFinish=wasmExports.WaitForParallelWorkersToFinish)(k),Module._PageGetFreeSpace=k=>(Module._PageGetFreeSpace=wasmExports.PageGetFreeSpace)(k),Module._BufferGetBlockNumber=k=>(Module._BufferGetBlockNumber=wasmExports.BufferGetBlockNumber)(k),Module._BuildIndexInfo=k=>(Module._BuildIndexInfo=wasmExports.BuildIndexInfo)(k),Module._Int64GetDatum=k=>(Module._Int64GetDatum=wasmExports.Int64GetDatum)(k),Module._DirectFunctionCall2Coll=(k,e,I,B)=>(Module._DirectFunctionCall2Coll=wasmExports.DirectFunctionCall2Coll)(k,e,I,B),Module._RecoveryInProgress=()=>(Module._RecoveryInProgress=wasmExports.RecoveryInProgress)(),Module._GetUserIdAndSecContext=(k,e)=>(Module._GetUserIdAndSecContext=wasmExports.GetUserIdAndSecContext)(k,e),Module._SetUserIdAndSecContext=(k,e)=>(Module._SetUserIdAndSecContext=wasmExports.SetUserIdAndSecContext)(k,e),Module._NewGUCNestLevel=()=>(Module._NewGUCNestLevel=wasmExports.NewGUCNestLevel)(),Module._RestrictSearchPath=()=>(Module._RestrictSearchPath=wasmExports.RestrictSearchPath)(),Module._index_open=(k,e)=>(Module._index_open=wasmExports.index_open)(k,e),Module._object_ownercheck=(k,e,I)=>(Module._object_ownercheck=wasmExports.object_ownercheck)(k,e,I),Module._aclcheck_error=(k,e,I)=>(Module._aclcheck_error=wasmExports.aclcheck_error)(k,e,I),Module._AtEOXact_GUC=(k,e)=>(Module._AtEOXact_GUC=wasmExports.AtEOXact_GUC)(k,e),Module._relation_close=(k,e)=>(Module._relation_close=wasmExports.relation_close)(k,e),Module._GetUserId=()=>(Module._GetUserId=wasmExports.GetUserId)(),Module._ReadBuffer=(k,e)=>(Module._ReadBuffer=wasmExports.ReadBuffer)(k,e),Module._shm_toc_lookup=(k,e,I)=>(Module._shm_toc_lookup=wasmExports.shm_toc_lookup)(k,e,I),Module._tuplesort_attach_shared=(k,e)=>(Module._tuplesort_attach_shared=wasmExports.tuplesort_attach_shared)(k,e),Module._index_close=(k,e)=>(Module._index_close=wasmExports.index_close)(k,e),Module._table_beginscan_parallel=(k,e)=>(Module._table_beginscan_parallel=wasmExports.table_beginscan_parallel)(k,e),Module._ConditionVariableSignal=k=>(Module._ConditionVariableSignal=wasmExports.ConditionVariableSignal)(k),Module._datumCopy=(k,e,I)=>(Module._datumCopy=wasmExports.datumCopy)(k,e,I),Module._lookup_type_cache=(k,e)=>(Module._lookup_type_cache=wasmExports.lookup_type_cache)(k,e),Module._get_fn_opclass_options=k=>(Module._get_fn_opclass_options=wasmExports.get_fn_opclass_options)(k),Module._pg_detoast_datum=k=>(Module._pg_detoast_datum=wasmExports.pg_detoast_datum)(k),Module._index_getprocid=(k,e,I)=>(Module._index_getprocid=wasmExports.index_getprocid)(k,e,I),Module._init_local_reloptions=(k,e)=>(Module._init_local_reloptions=wasmExports.init_local_reloptions)(k,e),Module._FunctionCall2Coll=(k,e,I,B)=>(Module._FunctionCall2Coll=wasmExports.FunctionCall2Coll)(k,e,I,B),Module._SysCacheGetAttrNotNull=(k,e,I)=>(Module._SysCacheGetAttrNotNull=wasmExports.SysCacheGetAttrNotNull)(k,e,I),Module._ReleaseSysCache=k=>(Module._ReleaseSysCache=wasmExports.ReleaseSysCache)(k),Module._fmgr_info_cxt=(k,e,I)=>(Module._fmgr_info_cxt=wasmExports.fmgr_info_cxt)(k,e,I),Module._Float8GetDatum=k=>(Module._Float8GetDatum=wasmExports.Float8GetDatum)(k),Module._numeric_sub=k=>(Module._numeric_sub=wasmExports.numeric_sub)(k),Module._DirectFunctionCall1Coll=(k,e,I)=>(Module._DirectFunctionCall1Coll=wasmExports.DirectFunctionCall1Coll)(k,e,I),Module._pg_detoast_datum_packed=k=>(Module._pg_detoast_datum_packed=wasmExports.pg_detoast_datum_packed)(k),Module._add_local_int_reloption=(k,e,I,B,tr,rr,ir)=>(Module._add_local_int_reloption=wasmExports.add_local_int_reloption)(k,e,I,B,tr,rr,ir),Module._getTypeOutputInfo=(k,e,I)=>(Module._getTypeOutputInfo=wasmExports.getTypeOutputInfo)(k,e,I),Module._fmgr_info=(k,e)=>(Module._fmgr_info=wasmExports.fmgr_info)(k,e),Module._OutputFunctionCall=(k,e)=>(Module._OutputFunctionCall=wasmExports.OutputFunctionCall)(k,e),Module._cstring_to_text_with_len=(k,e)=>(Module._cstring_to_text_with_len=wasmExports.cstring_to_text_with_len)(k,e),Module._accumArrayResult=(k,e,I,B,tr)=>(Module._accumArrayResult=wasmExports.accumArrayResult)(k,e,I,B,tr),Module._makeArrayResult=(k,e)=>(Module._makeArrayResult=wasmExports.makeArrayResult)(k,e),Module._OidOutputFunctionCall=(k,e)=>(Module._OidOutputFunctionCall=wasmExports.OidOutputFunctionCall)(k,e),Module._cstring_to_text=k=>(Module._cstring_to_text=wasmExports.cstring_to_text)(k),Module._PageGetExactFreeSpace=k=>(Module._PageGetExactFreeSpace=wasmExports.PageGetExactFreeSpace)(k),Module._PageIndexTupleOverwrite=(k,e,I,B)=>(Module._PageIndexTupleOverwrite=wasmExports.PageIndexTupleOverwrite)(k,e,I,B),Module._PageInit=(k,e,I)=>(Module._PageInit=wasmExports.PageInit)(k,e,I),Module._PageAddItemExtended=(k,e,I,B,tr)=>(Module._PageAddItemExtended=wasmExports.PageAddItemExtended)(k,e,I,B,tr),Module._LockRelationForExtension=(k,e)=>(Module._LockRelationForExtension=wasmExports.LockRelationForExtension)(k,e),Module._UnlockRelationForExtension=(k,e)=>(Module._UnlockRelationForExtension=wasmExports.UnlockRelationForExtension)(k,e),Module._smgropen=(k,e)=>(Module._smgropen=wasmExports.smgropen)(k,e),Module._smgrpin=k=>(Module._smgrpin=wasmExports.smgrpin)(k),Module._ItemPointerEquals=(k,e)=>(Module._ItemPointerEquals=wasmExports.ItemPointerEquals)(k,e),Module._detoast_external_attr=k=>(Module._detoast_external_attr=wasmExports.detoast_external_attr)(k),Module._CreateTemplateTupleDesc=k=>(Module._CreateTemplateTupleDesc=wasmExports.CreateTemplateTupleDesc)(k),Module._TupleDescInitEntry=(k,e,I,B,tr,rr)=>(Module._TupleDescInitEntry=wasmExports.TupleDescInitEntry)(k,e,I,B,tr,rr),Module._SearchSysCache1=(k,e)=>(Module._SearchSysCache1=wasmExports.SearchSysCache1)(k,e),Module._SearchSysCacheList=(k,e,I,B,tr)=>(Module._SearchSysCacheList=wasmExports.SearchSysCacheList)(k,e,I,B,tr),Module._check_amproc_signature=(k,e,I,B,tr,rr)=>(Module._check_amproc_signature=wasmExports.check_amproc_signature)(k,e,I,B,tr,rr),Module._check_amoptsproc_signature=k=>(Module._check_amoptsproc_signature=wasmExports.check_amoptsproc_signature)(k),Module._format_procedure=k=>(Module._format_procedure=wasmExports.format_procedure)(k),Module._format_operator=k=>(Module._format_operator=wasmExports.format_operator)(k),Module._check_amop_signature=(k,e,I,B)=>(Module._check_amop_signature=wasmExports.check_amop_signature)(k,e,I,B),Module._identify_opfamily_groups=(k,e)=>(Module._identify_opfamily_groups=wasmExports.identify_opfamily_groups)(k,e),Module._format_type_be=k=>(Module._format_type_be=wasmExports.format_type_be)(k),Module._ReleaseCatCacheList=k=>(Module._ReleaseCatCacheList=wasmExports.ReleaseCatCacheList)(k),Module._free_attrmap=k=>(Module._free_attrmap=wasmExports.free_attrmap)(k),Module._format_type_with_typemod=(k,e)=>(Module._format_type_with_typemod=wasmExports.format_type_with_typemod)(k,e),Module._build_attrmap_by_name_if_req=(k,e,I)=>(Module._build_attrmap_by_name_if_req=wasmExports.build_attrmap_by_name_if_req)(k,e,I),Module._DatumGetEOHP=k=>(Module._DatumGetEOHP=wasmExports.DatumGetEOHP)(k),Module._EOH_get_flat_size=k=>(Module._EOH_get_flat_size=wasmExports.EOH_get_flat_size)(k),Module._EOH_flatten_into=(k,e,I)=>(Module._EOH_flatten_into=wasmExports.EOH_flatten_into)(k,e,I),Module._getmissingattr=(k,e,I)=>(Module._getmissingattr=wasmExports.getmissingattr)(k,e,I),Module._hash_create=(k,e,I,B)=>(Module._hash_create=wasmExports.hash_create)(k,e,I,B),Module._hash_search=(k,e,I,B)=>(Module._hash_search=wasmExports.hash_search)(k,e,I,B),Module._nocachegetattr=(k,e,I)=>(Module._nocachegetattr=wasmExports.nocachegetattr)(k,e,I),Module._heap_form_tuple=(k,e,I)=>(Module._heap_form_tuple=wasmExports.heap_form_tuple)(k,e,I),Module._heap_modify_tuple=(k,e,I,B,tr)=>(Module._heap_modify_tuple=wasmExports.heap_modify_tuple)(k,e,I,B,tr),Module._heap_deform_tuple=(k,e,I,B)=>(Module._heap_deform_tuple=wasmExports.heap_deform_tuple)(k,e,I,B),Module._heap_modify_tuple_by_cols=(k,e,I,B,tr,rr)=>(Module._heap_modify_tuple_by_cols=wasmExports.heap_modify_tuple_by_cols)(k,e,I,B,tr,rr),Module._heap_freetuple=k=>(Module._heap_freetuple=wasmExports.heap_freetuple)(k),Module._index_form_tuple=(k,e,I)=>(Module._index_form_tuple=wasmExports.index_form_tuple)(k,e,I),Module._nocache_index_getattr=(k,e,I)=>(Module._nocache_index_getattr=wasmExports.nocache_index_getattr)(k,e,I),Module._index_deform_tuple=(k,e,I,B)=>(Module._index_deform_tuple=wasmExports.index_deform_tuple)(k,e,I,B),Module._slot_getsomeattrs_int=(k,e)=>(Module._slot_getsomeattrs_int=wasmExports.slot_getsomeattrs_int)(k,e),Module._pg_ltoa=(k,e)=>(Module._pg_ltoa=wasmExports.pg_ltoa)(k,e),Module._relation_open=(k,e)=>(Module._relation_open=wasmExports.relation_open)(k,e),Module._LockRelationOid=(k,e)=>(Module._LockRelationOid=wasmExports.LockRelationOid)(k,e),Module._RelationIdGetRelation=k=>(Module._RelationIdGetRelation=wasmExports.RelationIdGetRelation)(k),Module._try_relation_open=(k,e)=>(Module._try_relation_open=wasmExports.try_relation_open)(k,e),Module._SearchSysCacheExists=(k,e,I,B,tr)=>(Module._SearchSysCacheExists=wasmExports.SearchSysCacheExists)(k,e,I,B,tr),Module._relation_openrv=(k,e)=>(Module._relation_openrv=wasmExports.relation_openrv)(k,e),Module._RangeVarGetRelidExtended=(k,e,I,B,tr)=>(Module._RangeVarGetRelidExtended=wasmExports.RangeVarGetRelidExtended)(k,e,I,B,tr),Module._RelationClose=k=>(Module._RelationClose=wasmExports.RelationClose)(k),Module._add_reloption_kind=()=>(Module._add_reloption_kind=wasmExports.add_reloption_kind)(),Module._register_reloptions_validator=(k,e)=>(Module._register_reloptions_validator=wasmExports.register_reloptions_validator)(k,e),Module._add_int_reloption=(k,e,I,B,tr,rr,ir)=>(Module._add_int_reloption=wasmExports.add_int_reloption)(k,e,I,B,tr,rr,ir),Module._MemoryContextStrdup=(k,e)=>(Module._MemoryContextStrdup=wasmExports.MemoryContextStrdup)(k,e),Module._transformRelOptions=(k,e,I,B,tr,rr)=>(Module._transformRelOptions=wasmExports.transformRelOptions)(k,e,I,B,tr,rr),Module._deconstruct_array_builtin=(k,e,I,B,tr)=>(Module._deconstruct_array_builtin=wasmExports.deconstruct_array_builtin)(k,e,I,B,tr),Module._defGetString=k=>(Module._defGetString=wasmExports.defGetString)(k),Module._defGetBoolean=k=>(Module._defGetBoolean=wasmExports.defGetBoolean)(k),Module._untransformRelOptions=k=>(Module._untransformRelOptions=wasmExports.untransformRelOptions)(k),Module._text_to_cstring=k=>(Module._text_to_cstring=wasmExports.text_to_cstring)(k),Module._makeString=k=>(Module._makeString=wasmExports.makeString)(k),Module._makeDefElem=(k,e,I)=>(Module._makeDefElem=wasmExports.makeDefElem)(k,e,I),Module._heap_reloptions=(k,e,I)=>(Module._heap_reloptions=wasmExports.heap_reloptions)(k,e,I),Module._MemoryContextAlloc=(k,e)=>(Module._MemoryContextAlloc=wasmExports.MemoryContextAlloc)(k,e),Module._parse_bool=(k,e)=>(Module._parse_bool=wasmExports.parse_bool)(k,e),Module._parse_int=(k,e,I,B)=>(Module._parse_int=wasmExports.parse_int)(k,e,I,B),Module._parse_real=(k,e,I,B)=>(Module._parse_real=wasmExports.parse_real)(k,e,I,B),Module._ScanKeyInit=(k,e,I,B,tr)=>(Module._ScanKeyInit=wasmExports.ScanKeyInit)(k,e,I,B,tr),Module._dsm_segment_handle=k=>(Module._dsm_segment_handle=wasmExports.dsm_segment_handle)(k),Module._dsm_create=(k,e)=>(Module._dsm_create=wasmExports.dsm_create)(k,e),Module._dsm_segment_address=k=>(Module._dsm_segment_address=wasmExports.dsm_segment_address)(k),Module._dsm_attach=k=>(Module._dsm_attach=wasmExports.dsm_attach)(k),Module._dsm_detach=k=>(Module._dsm_detach=wasmExports.dsm_detach)(k),Module._ShmemInitStruct=(k,e,I)=>(Module._ShmemInitStruct=wasmExports.ShmemInitStruct)(k,e,I),Module._LWLockAcquire=(k,e)=>(Module._LWLockAcquire=wasmExports.LWLockAcquire)(k,e),Module._LWLockRelease=k=>(Module._LWLockRelease=wasmExports.LWLockRelease)(k),Module._LWLockInitialize=(k,e)=>(Module._LWLockInitialize=wasmExports.LWLockInitialize)(k,e),Module._MemoryContextMemAllocated=(k,e)=>(Module._MemoryContextMemAllocated=wasmExports.MemoryContextMemAllocated)(k,e),Module._GetCurrentCommandId=k=>(Module._GetCurrentCommandId=wasmExports.GetCurrentCommandId)(k),Module._toast_open_indexes=(k,e,I,B)=>(Module._toast_open_indexes=wasmExports.toast_open_indexes)(k,e,I,B),Module._RelationGetIndexList=k=>(Module._RelationGetIndexList=wasmExports.RelationGetIndexList)(k),Module._systable_beginscan=(k,e,I,B,tr,rr)=>(Module._systable_beginscan=wasmExports.systable_beginscan)(k,e,I,B,tr,rr),Module._systable_getnext=k=>(Module._systable_getnext=wasmExports.systable_getnext)(k),Module._systable_endscan=k=>(Module._systable_endscan=wasmExports.systable_endscan)(k),Module._toast_close_indexes=(k,e,I)=>(Module._toast_close_indexes=wasmExports.toast_close_indexes)(k,e,I),Module._systable_beginscan_ordered=(k,e,I,B,tr)=>(Module._systable_beginscan_ordered=wasmExports.systable_beginscan_ordered)(k,e,I,B,tr),Module._systable_getnext_ordered=(k,e)=>(Module._systable_getnext_ordered=wasmExports.systable_getnext_ordered)(k,e),Module._systable_endscan_ordered=k=>(Module._systable_endscan_ordered=wasmExports.systable_endscan_ordered)(k),Module._init_toast_snapshot=k=>(Module._init_toast_snapshot=wasmExports.init_toast_snapshot)(k),Module._convert_tuples_by_position=(k,e,I)=>(Module._convert_tuples_by_position=wasmExports.convert_tuples_by_position)(k,e,I),Module._execute_attr_map_tuple=(k,e)=>(Module._execute_attr_map_tuple=wasmExports.execute_attr_map_tuple)(k,e),Module._execute_attr_map_slot=(k,e,I)=>(Module._execute_attr_map_slot=wasmExports.execute_attr_map_slot)(k,e,I),Module._ExecStoreVirtualTuple=k=>(Module._ExecStoreVirtualTuple=wasmExports.ExecStoreVirtualTuple)(k),Module._bms_is_member=(k,e)=>(Module._bms_is_member=wasmExports.bms_is_member)(k,e),Module._bms_add_member=(k,e)=>(Module._bms_add_member=wasmExports.bms_add_member)(k,e),Module._CreateTupleDescCopy=k=>(Module._CreateTupleDescCopy=wasmExports.CreateTupleDescCopy)(k),Module._CreateTupleDescCopyConstr=k=>(Module._CreateTupleDescCopyConstr=wasmExports.CreateTupleDescCopyConstr)(k),Module._FreeTupleDesc=k=>(Module._FreeTupleDesc=wasmExports.FreeTupleDesc)(k),Module._ResourceOwnerEnlarge=k=>(Module._ResourceOwnerEnlarge=wasmExports.ResourceOwnerEnlarge)(k),Module._ResourceOwnerRemember=(k,e,I)=>(Module._ResourceOwnerRemember=wasmExports.ResourceOwnerRemember)(k,e,I),Module._DecrTupleDescRefCount=k=>(Module._DecrTupleDescRefCount=wasmExports.DecrTupleDescRefCount)(k),Module._ResourceOwnerForget=(k,e,I)=>(Module._ResourceOwnerForget=wasmExports.ResourceOwnerForget)(k,e,I),Module._datumIsEqual=(k,e,I,B)=>(Module._datumIsEqual=wasmExports.datumIsEqual)(k,e,I,B),Module._TupleDescInitEntryCollation=(k,e,I)=>(Module._TupleDescInitEntryCollation=wasmExports.TupleDescInitEntryCollation)(k,e,I),Module._stringToNode=k=>(Module._stringToNode=wasmExports.stringToNode)(k),Module._pg_detoast_datum_copy=k=>(Module._pg_detoast_datum_copy=wasmExports.pg_detoast_datum_copy)(k),Module._get_typlenbyvalalign=(k,e,I,B)=>(Module._get_typlenbyvalalign=wasmExports.get_typlenbyvalalign)(k,e,I,B),Module._deconstruct_array=(k,e,I,B,tr,rr,ir,lr)=>(Module._deconstruct_array=wasmExports.deconstruct_array)(k,e,I,B,tr,rr,ir,lr),Module._tbm_add_tuples=(k,e,I,B)=>(Module._tbm_add_tuples=wasmExports.tbm_add_tuples)(k,e,I,B),Module._ginPostingListDecode=(k,e)=>(Module._ginPostingListDecode=wasmExports.ginPostingListDecode)(k,e),Module._ItemPointerCompare=(k,e)=>(Module._ItemPointerCompare=wasmExports.ItemPointerCompare)(k,e),Module._LockPage=(k,e,I)=>(Module._LockPage=wasmExports.LockPage)(k,e,I),Module._UnlockPage=(k,e,I)=>(Module._UnlockPage=wasmExports.UnlockPage)(k,e,I),Module._vacuum_delay_point=()=>(Module._vacuum_delay_point=wasmExports.vacuum_delay_point)(),Module._RecordFreeIndexPage=(k,e)=>(Module._RecordFreeIndexPage=wasmExports.RecordFreeIndexPage)(k,e),Module._IndexFreeSpaceMapVacuum=k=>(Module._IndexFreeSpaceMapVacuum=wasmExports.IndexFreeSpaceMapVacuum)(k),Module._log_newpage_range=(k,e,I,B,tr)=>(Module._log_newpage_range=wasmExports.log_newpage_range)(k,e,I,B,tr),Module._GetFreeIndexPage=k=>(Module._GetFreeIndexPage=wasmExports.GetFreeIndexPage)(k),Module._ConditionalLockBuffer=k=>(Module._ConditionalLockBuffer=wasmExports.ConditionalLockBuffer)(k),Module._LockBufferForCleanup=k=>(Module._LockBufferForCleanup=wasmExports.LockBufferForCleanup)(k),Module._gistcheckpage=(k,e)=>(Module._gistcheckpage=wasmExports.gistcheckpage)(k,e),Module._PageIndexMultiDelete=(k,e,I)=>(Module._PageIndexMultiDelete=wasmExports.PageIndexMultiDelete)(k,e,I),Module._pow=(k,e)=>(Module._pow=wasmExports.pow)(k,e),Module._smgrnblocks=(k,e)=>(Module._smgrnblocks=wasmExports.smgrnblocks)(k,e),Module._list_free_deep=k=>(Module._list_free_deep=wasmExports.list_free_deep)(k),Module._pairingheap_remove_first=k=>(Module._pairingheap_remove_first=wasmExports.pairingheap_remove_first)(k),Module._pairingheap_add=(k,e)=>(Module._pairingheap_add=wasmExports.pairingheap_add)(k,e),Module._float_overflow_error=()=>(Module._float_overflow_error=wasmExports.float_overflow_error)(),Module._float_underflow_error=()=>(Module._float_underflow_error=wasmExports.float_underflow_error)(),Module._DirectFunctionCall5Coll=(k,e,I,B,tr,rr,ir)=>(Module._DirectFunctionCall5Coll=wasmExports.DirectFunctionCall5Coll)(k,e,I,B,tr,rr,ir),Module._pairingheap_allocate=(k,e)=>(Module._pairingheap_allocate=wasmExports.pairingheap_allocate)(k,e),Module._GenerationContextCreate=(k,e,I,B,tr)=>(Module._GenerationContextCreate=wasmExports.GenerationContextCreate)(k,e,I,B,tr),Module._pgstat_progress_update_param=(k,e)=>(Module._pgstat_progress_update_param=wasmExports.pgstat_progress_update_param)(k,e),Module.__hash_getbuf=(k,e,I,B)=>(Module.__hash_getbuf=wasmExports._hash_getbuf)(k,e,I,B),Module.__hash_relbuf=(k,e)=>(Module.__hash_relbuf=wasmExports._hash_relbuf)(k,e),Module.__hash_get_indextuple_hashkey=k=>(Module.__hash_get_indextuple_hashkey=wasmExports._hash_get_indextuple_hashkey)(k),Module.__hash_getbuf_with_strategy=(k,e,I,B,tr)=>(Module.__hash_getbuf_with_strategy=wasmExports._hash_getbuf_with_strategy)(k,e,I,B,tr),Module.__hash_ovflblkno_to_bitno=(k,e)=>(Module.__hash_ovflblkno_to_bitno=wasmExports._hash_ovflblkno_to_bitno)(k,e),Module._hash_destroy=k=>(Module._hash_destroy=wasmExports.hash_destroy)(k),Module._list_member_oid=(k,e)=>(Module._list_member_oid=wasmExports.list_member_oid)(k,e),Module._HeapTupleSatisfiesVisibility=(k,e,I)=>(Module._HeapTupleSatisfiesVisibility=wasmExports.HeapTupleSatisfiesVisibility)(k,e,I),Module._read_stream_begin_relation=(k,e,I,B,tr,rr,ir)=>(Module._read_stream_begin_relation=wasmExports.read_stream_begin_relation)(k,e,I,B,tr,rr,ir),Module._GetAccessStrategy=k=>(Module._GetAccessStrategy=wasmExports.GetAccessStrategy)(k),Module._FreeAccessStrategy=k=>(Module._FreeAccessStrategy=wasmExports.FreeAccessStrategy)(k),Module._read_stream_end=k=>(Module._read_stream_end=wasmExports.read_stream_end)(k),Module._heap_getnext=(k,e)=>(Module._heap_getnext=wasmExports.heap_getnext)(k,e),Module._HeapTupleSatisfiesVacuum=(k,e,I)=>(Module._HeapTupleSatisfiesVacuum=wasmExports.HeapTupleSatisfiesVacuum)(k,e,I),Module._GetMultiXactIdMembers=(k,e,I,B)=>(Module._GetMultiXactIdMembers=wasmExports.GetMultiXactIdMembers)(k,e,I,B),Module._TransactionIdPrecedes=(k,e)=>(Module._TransactionIdPrecedes=wasmExports.TransactionIdPrecedes)(k,e),Module._HeapTupleGetUpdateXid=k=>(Module._HeapTupleGetUpdateXid=wasmExports.HeapTupleGetUpdateXid)(k),Module._visibilitymap_clear=(k,e,I,B)=>(Module._visibilitymap_clear=wasmExports.visibilitymap_clear)(k,e,I,B),Module._pgstat_count_heap_insert=(k,e)=>(Module._pgstat_count_heap_insert=wasmExports.pgstat_count_heap_insert)(k,e),Module._ExecFetchSlotHeapTuple=(k,e,I)=>(Module._ExecFetchSlotHeapTuple=wasmExports.ExecFetchSlotHeapTuple)(k,e,I),Module._PageGetHeapFreeSpace=k=>(Module._PageGetHeapFreeSpace=wasmExports.PageGetHeapFreeSpace)(k),Module._visibilitymap_pin=(k,e,I)=>(Module._visibilitymap_pin=wasmExports.visibilitymap_pin)(k,e,I),Module._HeapTupleSatisfiesUpdate=(k,e,I)=>(Module._HeapTupleSatisfiesUpdate=wasmExports.HeapTupleSatisfiesUpdate)(k,e,I),Module._TransactionIdIsCurrentTransactionId=k=>(Module._TransactionIdIsCurrentTransactionId=wasmExports.TransactionIdIsCurrentTransactionId)(k),Module._TransactionIdDidCommit=k=>(Module._TransactionIdDidCommit=wasmExports.TransactionIdDidCommit)(k),Module._TransactionIdIsInProgress=k=>(Module._TransactionIdIsInProgress=wasmExports.TransactionIdIsInProgress)(k),Module._bms_free=k=>(Module._bms_free=wasmExports.bms_free)(k),Module._bms_add_members=(k,e)=>(Module._bms_add_members=wasmExports.bms_add_members)(k,e),Module._bms_next_member=(k,e)=>(Module._bms_next_member=wasmExports.bms_next_member)(k,e),Module._bms_overlap=(k,e)=>(Module._bms_overlap=wasmExports.bms_overlap)(k,e),Module._MultiXactIdPrecedes=(k,e)=>(Module._MultiXactIdPrecedes=wasmExports.MultiXactIdPrecedes)(k,e),Module._heap_tuple_needs_eventual_freeze=k=>(Module._heap_tuple_needs_eventual_freeze=wasmExports.heap_tuple_needs_eventual_freeze)(k),Module._PrefetchBuffer=(k,e,I,B)=>(Module._PrefetchBuffer=wasmExports.PrefetchBuffer)(k,e,I,B),Module._XLogRecGetBlockTagExtended=(k,e,I,B,tr,rr)=>(Module._XLogRecGetBlockTagExtended=wasmExports.XLogRecGetBlockTagExtended)(k,e,I,B,tr,rr),Module._read_stream_next_buffer=(k,e)=>(Module._read_stream_next_buffer=wasmExports.read_stream_next_buffer)(k,e),Module._smgrexists=(k,e)=>(Module._smgrexists=wasmExports.smgrexists)(k,e),Module._table_slot_create=(k,e)=>(Module._table_slot_create=wasmExports.table_slot_create)(k,e),Module._ExecDropSingleTupleTableSlot=k=>(Module._ExecDropSingleTupleTableSlot=wasmExports.ExecDropSingleTupleTableSlot)(k),Module._CreateExecutorState=()=>(Module._CreateExecutorState=wasmExports.CreateExecutorState)(),Module._MakePerTupleExprContext=k=>(Module._MakePerTupleExprContext=wasmExports.MakePerTupleExprContext)(k),Module._GetOldestNonRemovableTransactionId=k=>(Module._GetOldestNonRemovableTransactionId=wasmExports.GetOldestNonRemovableTransactionId)(k),Module._FreeExecutorState=k=>(Module._FreeExecutorState=wasmExports.FreeExecutorState)(k),Module._MakeSingleTupleTableSlot=(k,e)=>(Module._MakeSingleTupleTableSlot=wasmExports.MakeSingleTupleTableSlot)(k,e),Module._ExecStoreHeapTuple=(k,e,I)=>(Module._ExecStoreHeapTuple=wasmExports.ExecStoreHeapTuple)(k,e,I),Module._visibilitymap_get_status=(k,e,I)=>(Module._visibilitymap_get_status=wasmExports.visibilitymap_get_status)(k,e,I),Module._ExecStoreAllNullTuple=k=>(Module._ExecStoreAllNullTuple=wasmExports.ExecStoreAllNullTuple)(k),Module._XidInMVCCSnapshot=(k,e)=>(Module._XidInMVCCSnapshot=wasmExports.XidInMVCCSnapshot)(k,e),Module._hash_seq_init=(k,e)=>(Module._hash_seq_init=wasmExports.hash_seq_init)(k,e),Module._hash_seq_search=k=>(Module._hash_seq_search=wasmExports.hash_seq_search)(k),Module._ftruncate=(k,e)=>(Module._ftruncate=wasmExports.ftruncate)(k,e),Module._fd_fsync_fname=(k,e)=>(Module._fd_fsync_fname=wasmExports.fd_fsync_fname)(k,e),Module._get_namespace_name=k=>(Module._get_namespace_name=wasmExports.get_namespace_name)(k),Module._GetRecordedFreeSpace=(k,e)=>(Module._GetRecordedFreeSpace=wasmExports.GetRecordedFreeSpace)(k,e),Module._vac_estimate_reltuples=(k,e,I,B)=>(Module._vac_estimate_reltuples=wasmExports.vac_estimate_reltuples)(k,e,I,B),Module._WaitLatch=(k,e,I,B)=>(Module._WaitLatch=wasmExports.WaitLatch)(k,e,I,B),Module._ResetLatch=k=>(Module._ResetLatch=wasmExports.ResetLatch)(k),Module._clock_gettime=(k,e)=>(Module._clock_gettime=wasmExports.clock_gettime)(k,e),Module._WalUsageAccumDiff=(k,e,I)=>(Module._WalUsageAccumDiff=wasmExports.WalUsageAccumDiff)(k,e,I),Module._BufferUsageAccumDiff=(k,e,I)=>(Module._BufferUsageAccumDiff=wasmExports.BufferUsageAccumDiff)(k,e,I),Module._visibilitymap_prepare_truncate=(k,e)=>(Module._visibilitymap_prepare_truncate=wasmExports.visibilitymap_prepare_truncate)(k,e),Module._pg_class_aclcheck=(k,e,I)=>(Module._pg_class_aclcheck=wasmExports.pg_class_aclcheck)(k,e,I),Module._btboolcmp=k=>(Module._btboolcmp=wasmExports.btboolcmp)(k),Module._btint2cmp=k=>(Module._btint2cmp=wasmExports.btint2cmp)(k),Module._btint4cmp=k=>(Module._btint4cmp=wasmExports.btint4cmp)(k),Module._btint8cmp=k=>(Module._btint8cmp=wasmExports.btint8cmp)(k),Module._btoidcmp=k=>(Module._btoidcmp=wasmExports.btoidcmp)(k),Module._btcharcmp=k=>(Module._btcharcmp=wasmExports.btcharcmp)(k),Module.__bt_form_posting=(k,e,I)=>(Module.__bt_form_posting=wasmExports._bt_form_posting)(k,e,I),Module.__bt_mkscankey=(k,e)=>(Module.__bt_mkscankey=wasmExports._bt_mkscankey)(k,e),Module.__bt_checkpage=(k,e)=>(Module.__bt_checkpage=wasmExports._bt_checkpage)(k,e),Module.__bt_compare=(k,e,I,B)=>(Module.__bt_compare=wasmExports._bt_compare)(k,e,I,B),Module.__bt_relbuf=(k,e)=>(Module.__bt_relbuf=wasmExports._bt_relbuf)(k,e),Module.__bt_search=(k,e,I,B,tr)=>(Module.__bt_search=wasmExports._bt_search)(k,e,I,B,tr),Module.__bt_binsrch_insert=(k,e)=>(Module.__bt_binsrch_insert=wasmExports._bt_binsrch_insert)(k,e),Module.__bt_freestack=k=>(Module.__bt_freestack=wasmExports._bt_freestack)(k),Module.__bt_metaversion=(k,e,I)=>(Module.__bt_metaversion=wasmExports._bt_metaversion)(k,e,I),Module.__bt_allequalimage=(k,e)=>(Module.__bt_allequalimage=wasmExports._bt_allequalimage)(k,e),Module._before_shmem_exit=(k,e)=>(Module._before_shmem_exit=wasmExports.before_shmem_exit)(k,e),Module._cancel_before_shmem_exit=(k,e)=>(Module._cancel_before_shmem_exit=wasmExports.cancel_before_shmem_exit)(k,e),Module._pg_re_throw=()=>(Module._pg_re_throw=wasmExports.pg_re_throw)(),Module._get_opfamily_member=(k,e,I,B)=>(Module._get_opfamily_member=wasmExports.get_opfamily_member)(k,e,I,B),Module.__bt_check_natts=(k,e,I,B)=>(Module.__bt_check_natts=wasmExports._bt_check_natts)(k,e,I,B),Module._strncpy=(k,e,I)=>(Module._strncpy=wasmExports.strncpy)(k,e,I),Module._timestamptz_to_str=k=>(Module._timestamptz_to_str=wasmExports.timestamptz_to_str)(k),Module._XLogRecGetBlockRefInfo=(k,e,I,B,tr)=>(Module._XLogRecGetBlockRefInfo=wasmExports.XLogRecGetBlockRefInfo)(k,e,I,B,tr),Module._varstr_cmp=(k,e,I,B,tr)=>(Module._varstr_cmp=wasmExports.varstr_cmp)(k,e,I,B,tr),Module._exprType=k=>(Module._exprType=wasmExports.exprType)(k),Module._GetActiveSnapshot=()=>(Module._GetActiveSnapshot=wasmExports.GetActiveSnapshot)(),Module._errdetail_relkind_not_supported=k=>(Module._errdetail_relkind_not_supported=wasmExports.errdetail_relkind_not_supported)(k),Module._table_openrv=(k,e)=>(Module._table_openrv=wasmExports.table_openrv)(k,e),Module._table_slot_callbacks=k=>(Module._table_slot_callbacks=wasmExports.table_slot_callbacks)(k),Module._estimate_expression_value=(k,e)=>(Module._estimate_expression_value=wasmExports.estimate_expression_value)(k,e),Module._clamp_row_est=k=>(Module._clamp_row_est=wasmExports.clamp_row_est)(k),Module._XLogFlush=k=>(Module._XLogFlush=wasmExports.XLogFlush)(k),Module._get_call_result_type=(k,e,I)=>(Module._get_call_result_type=wasmExports.get_call_result_type)(k,e,I),Module._HeapTupleHeaderGetDatum=k=>(Module._HeapTupleHeaderGetDatum=wasmExports.HeapTupleHeaderGetDatum)(k),Module._GenericXLogStart=k=>(Module._GenericXLogStart=wasmExports.GenericXLogStart)(k),Module._GenericXLogRegisterBuffer=(k,e,I)=>(Module._GenericXLogRegisterBuffer=wasmExports.GenericXLogRegisterBuffer)(k,e,I),Module._GenericXLogFinish=k=>(Module._GenericXLogFinish=wasmExports.GenericXLogFinish)(k),Module._GenericXLogAbort=k=>(Module._GenericXLogAbort=wasmExports.GenericXLogAbort)(k),Module._errmsg_plural=(k,e,I,B)=>(Module._errmsg_plural=wasmExports.errmsg_plural)(k,e,I,B),Module._ReadNextMultiXactId=()=>(Module._ReadNextMultiXactId=wasmExports.ReadNextMultiXactId)(),Module._ReadMultiXactIdRange=(k,e)=>(Module._ReadMultiXactIdRange=wasmExports.ReadMultiXactIdRange)(k,e),Module._MultiXactIdPrecedesOrEquals=(k,e)=>(Module._MultiXactIdPrecedesOrEquals=wasmExports.MultiXactIdPrecedesOrEquals)(k,e),Module._init_MultiFuncCall=k=>(Module._init_MultiFuncCall=wasmExports.init_MultiFuncCall)(k),Module._TupleDescGetAttInMetadata=k=>(Module._TupleDescGetAttInMetadata=wasmExports.TupleDescGetAttInMetadata)(k),Module._per_MultiFuncCall=k=>(Module._per_MultiFuncCall=wasmExports.per_MultiFuncCall)(k),Module._BuildTupleFromCStrings=(k,e)=>(Module._BuildTupleFromCStrings=wasmExports.BuildTupleFromCStrings)(k,e),Module._end_MultiFuncCall=(k,e)=>(Module._end_MultiFuncCall=wasmExports.end_MultiFuncCall)(k,e),Module._GetCurrentSubTransactionId=()=>(Module._GetCurrentSubTransactionId=wasmExports.GetCurrentSubTransactionId)(),Module._WaitForBackgroundWorkerShutdown=k=>(Module._WaitForBackgroundWorkerShutdown=wasmExports.WaitForBackgroundWorkerShutdown)(k),Module._RegisterDynamicBackgroundWorker=(k,e)=>(Module._RegisterDynamicBackgroundWorker=wasmExports.RegisterDynamicBackgroundWorker)(k,e),Module._BackgroundWorkerUnblockSignals=()=>(Module._BackgroundWorkerUnblockSignals=wasmExports.BackgroundWorkerUnblockSignals)(),Module._BackgroundWorkerInitializeConnectionByOid=(k,e,I)=>(Module._BackgroundWorkerInitializeConnectionByOid=wasmExports.BackgroundWorkerInitializeConnectionByOid)(k,e,I),Module._GetDatabaseEncoding=()=>(Module._GetDatabaseEncoding=wasmExports.GetDatabaseEncoding)(),Module._RmgrNotFound=k=>(Module._RmgrNotFound=wasmExports.RmgrNotFound)(k),Module._InitMaterializedSRF=(k,e)=>(Module._InitMaterializedSRF=wasmExports.InitMaterializedSRF)(k,e),Module._tuplestore_putvalues=(k,e,I,B)=>(Module._tuplestore_putvalues=wasmExports.tuplestore_putvalues)(k,e,I,B),Module._lseek=(k,e,I)=>(Module._lseek=wasmExports.lseek)(k,e,I),Module._AllocateFile=(k,e)=>(Module._AllocateFile=wasmExports.AllocateFile)(k,e),Module._FreeFile=k=>(Module._FreeFile=wasmExports.FreeFile)(k),Module._fd_durable_rename=(k,e,I)=>(Module._fd_durable_rename=wasmExports.fd_durable_rename)(k,e,I),Module._BlessTupleDesc=k=>(Module._BlessTupleDesc=wasmExports.BlessTupleDesc)(k),Module._fstat=(k,e)=>(Module._fstat=wasmExports.fstat)(k,e),Module._superuser_arg=k=>(Module._superuser_arg=wasmExports.superuser_arg)(k),Module._wal_segment_close=k=>(Module._wal_segment_close=wasmExports.wal_segment_close)(k),Module._wal_segment_open=(k,e,I)=>(Module._wal_segment_open=wasmExports.wal_segment_open)(k,e,I),Module._XLogReaderAllocate=(k,e,I,B)=>(Module._XLogReaderAllocate=wasmExports.XLogReaderAllocate)(k,e,I,B),Module._XLogReadRecord=(k,e)=>(Module._XLogReadRecord=wasmExports.XLogReadRecord)(k,e),Module._XLogReaderFree=k=>(Module._XLogReaderFree=wasmExports.XLogReaderFree)(k),Module._GetTopFullTransactionId=()=>(Module._GetTopFullTransactionId=wasmExports.GetTopFullTransactionId)(),Module._GetCurrentTransactionNestLevel=()=>(Module._GetCurrentTransactionNestLevel=wasmExports.GetCurrentTransactionNestLevel)(),Module._ResourceOwnerCreate=(k,e)=>(Module._ResourceOwnerCreate=wasmExports.ResourceOwnerCreate)(k,e),Module._RegisterXactCallback=(k,e)=>(Module._RegisterXactCallback=wasmExports.RegisterXactCallback)(k,e),Module._RegisterSubXactCallback=(k,e)=>(Module._RegisterSubXactCallback=wasmExports.RegisterSubXactCallback)(k,e),Module._BeginInternalSubTransaction=k=>(Module._BeginInternalSubTransaction=wasmExports.BeginInternalSubTransaction)(k),Module._ReleaseCurrentSubTransaction=()=>(Module._ReleaseCurrentSubTransaction=wasmExports.ReleaseCurrentSubTransaction)(),Module._ResourceOwnerDelete=k=>(Module._ResourceOwnerDelete=wasmExports.ResourceOwnerDelete)(k),Module._RollbackAndReleaseCurrentSubTransaction=()=>(Module._RollbackAndReleaseCurrentSubTransaction=wasmExports.RollbackAndReleaseCurrentSubTransaction)(),Module._ReleaseExternalFD=()=>(Module._ReleaseExternalFD=wasmExports.ReleaseExternalFD)(),Module._GetFlushRecPtr=k=>(Module._GetFlushRecPtr=wasmExports.GetFlushRecPtr)(k),Module._GetXLogReplayRecPtr=k=>(Module._GetXLogReplayRecPtr=wasmExports.GetXLogReplayRecPtr)(k),Module._TimestampDifferenceMilliseconds=(k,e)=>(Module._TimestampDifferenceMilliseconds=wasmExports.TimestampDifferenceMilliseconds)(k,e),Module._numeric_in=k=>(Module._numeric_in=wasmExports.numeric_in)(k),Module._DirectFunctionCall3Coll=(k,e,I,B,tr)=>(Module._DirectFunctionCall3Coll=wasmExports.DirectFunctionCall3Coll)(k,e,I,B,tr),Module._XLogFindNextRecord=(k,e)=>(Module._XLogFindNextRecord=wasmExports.XLogFindNextRecord)(k,e),Module._RestoreBlockImage=(k,e,I)=>(Module._RestoreBlockImage=wasmExports.RestoreBlockImage)(k,e,I),Module._timestamptz_in=k=>(Module._timestamptz_in=wasmExports.timestamptz_in)(k),Module._fscanf=(k,e,I)=>(Module._fscanf=wasmExports.fscanf)(k,e,I),Module._XLogRecStoreStats=(k,e)=>(Module._XLogRecStoreStats=wasmExports.XLogRecStoreStats)(k,e),Module._hash_get_num_entries=k=>(Module._hash_get_num_entries=wasmExports.hash_get_num_entries)(k),Module._read_local_xlog_page_no_wait=(k,e,I,B,tr)=>(Module._read_local_xlog_page_no_wait=wasmExports.read_local_xlog_page_no_wait)(k,e,I,B,tr),Module._escape_json=(k,e)=>(Module._escape_json=wasmExports.escape_json)(k,e),Module._list_sort=(k,e)=>(Module._list_sort=wasmExports.list_sort)(k,e),Module._pg_checksum_page=(k,e)=>(Module._pg_checksum_page=wasmExports.pg_checksum_page)(k,e),Module._bbsink_forward_end_archive=k=>(Module._bbsink_forward_end_archive=wasmExports.bbsink_forward_end_archive)(k),Module._bbsink_forward_begin_manifest=k=>(Module._bbsink_forward_begin_manifest=wasmExports.bbsink_forward_begin_manifest)(k),Module._bbsink_forward_end_manifest=k=>(Module._bbsink_forward_end_manifest=wasmExports.bbsink_forward_end_manifest)(k),Module._bbsink_forward_end_backup=(k,e,I)=>(Module._bbsink_forward_end_backup=wasmExports.bbsink_forward_end_backup)(k,e,I),Module._bbsink_forward_cleanup=k=>(Module._bbsink_forward_cleanup=wasmExports.bbsink_forward_cleanup)(k),Module._list_concat=(k,e)=>(Module._list_concat=wasmExports.list_concat)(k,e),Module._bbsink_forward_begin_backup=k=>(Module._bbsink_forward_begin_backup=wasmExports.bbsink_forward_begin_backup)(k),Module._bbsink_forward_archive_contents=(k,e)=>(Module._bbsink_forward_archive_contents=wasmExports.bbsink_forward_archive_contents)(k,e),Module._bbsink_forward_begin_archive=(k,e)=>(Module._bbsink_forward_begin_archive=wasmExports.bbsink_forward_begin_archive)(k,e),Module._bbsink_forward_manifest_contents=(k,e)=>(Module._bbsink_forward_manifest_contents=wasmExports.bbsink_forward_manifest_contents)(k,e),Module._has_privs_of_role=(k,e)=>(Module._has_privs_of_role=wasmExports.has_privs_of_role)(k,e),Module._BaseBackupAddTarget=(k,e,I)=>(Module._BaseBackupAddTarget=wasmExports.BaseBackupAddTarget)(k,e,I),Module._list_copy=k=>(Module._list_copy=wasmExports.list_copy)(k),Module._tuplestore_puttuple=(k,e)=>(Module._tuplestore_puttuple=wasmExports.tuplestore_puttuple)(k,e),Module._makeRangeVar=(k,e,I)=>(Module._makeRangeVar=wasmExports.makeRangeVar)(k,e,I),Module._DefineIndex=(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr)=>(Module._DefineIndex=wasmExports.DefineIndex)(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr),Module._fread=(k,e,I,B)=>(Module._fread=wasmExports.fread)(k,e,I,B),Module._clearerr=k=>(Module._clearerr=wasmExports.clearerr)(k),Module._copyObjectImpl=k=>(Module._copyObjectImpl=wasmExports.copyObjectImpl)(k),Module._lappend_oid=(k,e)=>(Module._lappend_oid=wasmExports.lappend_oid)(k,e),Module._makeTypeNameFromNameList=k=>(Module._makeTypeNameFromNameList=wasmExports.makeTypeNameFromNameList)(k),Module._SearchSysCache2=(k,e,I)=>(Module._SearchSysCache2=wasmExports.SearchSysCache2)(k,e,I),Module._SysCacheGetAttr=(k,e,I,B)=>(Module._SysCacheGetAttr=wasmExports.SysCacheGetAttr)(k,e,I,B),Module._CatalogTupleUpdate=(k,e,I)=>(Module._CatalogTupleUpdate=wasmExports.CatalogTupleUpdate)(k,e,I),Module._get_rel_name=k=>(Module._get_rel_name=wasmExports.get_rel_name)(k),Module._CatalogTupleDelete=(k,e)=>(Module._CatalogTupleDelete=wasmExports.CatalogTupleDelete)(k,e),Module._CatalogTupleInsert=(k,e)=>(Module._CatalogTupleInsert=wasmExports.CatalogTupleInsert)(k,e),Module._recordDependencyOn=(k,e,I)=>(Module._recordDependencyOn=wasmExports.recordDependencyOn)(k,e,I),Module._get_element_type=k=>(Module._get_element_type=wasmExports.get_element_type)(k),Module._object_aclcheck=(k,e,I,B)=>(Module._object_aclcheck=wasmExports.object_aclcheck)(k,e,I,B),Module._superuser=()=>(Module._superuser=wasmExports.superuser)(),Module._SearchSysCacheAttName=(k,e)=>(Module._SearchSysCacheAttName=wasmExports.SearchSysCacheAttName)(k,e),Module._new_object_addresses=()=>(Module._new_object_addresses=wasmExports.new_object_addresses)(),Module._free_object_addresses=k=>(Module._free_object_addresses=wasmExports.free_object_addresses)(k),Module._performMultipleDeletions=(k,e,I)=>(Module._performMultipleDeletions=wasmExports.performMultipleDeletions)(k,e,I),Module._recordDependencyOnExpr=(k,e,I,B)=>(Module._recordDependencyOnExpr=wasmExports.recordDependencyOnExpr)(k,e,I,B),Module._query_tree_walker_impl=(k,e,I,B)=>(Module._query_tree_walker_impl=wasmExports.query_tree_walker_impl)(k,e,I,B),Module._expression_tree_walker_impl=(k,e,I)=>(Module._expression_tree_walker_impl=wasmExports.expression_tree_walker_impl)(k,e,I),Module._add_exact_object_address=(k,e)=>(Module._add_exact_object_address=wasmExports.add_exact_object_address)(k,e),Module._get_rel_relkind=k=>(Module._get_rel_relkind=wasmExports.get_rel_relkind)(k),Module._get_typtype=k=>(Module._get_typtype=wasmExports.get_typtype)(k),Module._list_delete_last=k=>(Module._list_delete_last=wasmExports.list_delete_last)(k),Module._type_is_collatable=k=>(Module._type_is_collatable=wasmExports.type_is_collatable)(k),Module._GetSysCacheOid=(k,e,I,B,tr,rr)=>(Module._GetSysCacheOid=wasmExports.GetSysCacheOid)(k,e,I,B,tr,rr),Module._CheckTableNotInUse=(k,e)=>(Module._CheckTableNotInUse=wasmExports.CheckTableNotInUse)(k,e),Module._make_parsestate=k=>(Module._make_parsestate=wasmExports.make_parsestate)(k),Module._transformExpr=(k,e,I)=>(Module._transformExpr=wasmExports.transformExpr)(k,e,I),Module._equal=(k,e)=>(Module._equal=wasmExports.equal)(k,e),Module._pull_var_clause=(k,e)=>(Module._pull_var_clause=wasmExports.pull_var_clause)(k,e),Module._get_attname=(k,e,I)=>(Module._get_attname=wasmExports.get_attname)(k,e,I),Module._coerce_to_target_type=(k,e,I,B,tr,rr,ir,lr)=>(Module._coerce_to_target_type=wasmExports.coerce_to_target_type)(k,e,I,B,tr,rr,ir,lr),Module._nodeToString=k=>(Module._nodeToString=wasmExports.nodeToString)(k),Module._parser_errposition=(k,e)=>(Module._parser_errposition=wasmExports.parser_errposition)(k,e),Module._exprTypmod=k=>(Module._exprTypmod=wasmExports.exprTypmod)(k),Module._get_base_element_type=k=>(Module._get_base_element_type=wasmExports.get_base_element_type)(k),Module._SystemFuncName=k=>(Module._SystemFuncName=wasmExports.SystemFuncName)(k),Module._CreateTrigger=(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr)=>(Module._CreateTrigger=wasmExports.CreateTrigger)(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr),Module._plan_create_index_workers=(k,e)=>(Module._plan_create_index_workers=wasmExports.plan_create_index_workers)(k,e),Module._get_rel_relispartition=k=>(Module._get_rel_relispartition=wasmExports.get_rel_relispartition)(k),Module._get_partition_ancestors=k=>(Module._get_partition_ancestors=wasmExports.get_partition_ancestors)(k),Module._get_rel_namespace=k=>(Module._get_rel_namespace=wasmExports.get_rel_namespace)(k),Module._ConditionalLockRelationOid=(k,e)=>(Module._ConditionalLockRelationOid=wasmExports.ConditionalLockRelationOid)(k,e),Module._RelnameGetRelid=k=>(Module._RelnameGetRelid=wasmExports.RelnameGetRelid)(k),Module._get_relkind_objtype=k=>(Module._get_relkind_objtype=wasmExports.get_relkind_objtype)(k),Module._RelationIsVisible=k=>(Module._RelationIsVisible=wasmExports.RelationIsVisible)(k),Module._get_func_arg_info=(k,e,I,B)=>(Module._get_func_arg_info=wasmExports.get_func_arg_info)(k,e,I,B),Module._NameListToString=k=>(Module._NameListToString=wasmExports.NameListToString)(k),Module._OpernameGetOprid=(k,e,I)=>(Module._OpernameGetOprid=wasmExports.OpernameGetOprid)(k,e,I),Module._makeRangeVarFromNameList=k=>(Module._makeRangeVarFromNameList=wasmExports.makeRangeVarFromNameList)(k),Module._quote_identifier=k=>(Module._quote_identifier=wasmExports.quote_identifier)(k),Module._GetSearchPathMatcher=k=>(Module._GetSearchPathMatcher=wasmExports.GetSearchPathMatcher)(k),Module._SearchPathMatchesCurrentEnvironment=k=>(Module._SearchPathMatchesCurrentEnvironment=wasmExports.SearchPathMatchesCurrentEnvironment)(k),Module._get_collation_oid=(k,e)=>(Module._get_collation_oid=wasmExports.get_collation_oid)(k,e),Module._CacheRegisterSyscacheCallback=(k,e,I)=>(Module._CacheRegisterSyscacheCallback=wasmExports.CacheRegisterSyscacheCallback)(k,e,I),Module._get_extension_oid=(k,e)=>(Module._get_extension_oid=wasmExports.get_extension_oid)(k,e),Module._get_role_oid=(k,e)=>(Module._get_role_oid=wasmExports.get_role_oid)(k,e),Module._GetForeignServerByName=(k,e)=>(Module._GetForeignServerByName=wasmExports.GetForeignServerByName)(k,e),Module._GetPublicationByName=(k,e)=>(Module._GetPublicationByName=wasmExports.GetPublicationByName)(k,e),Module._typeStringToTypeName=(k,e)=>(Module._typeStringToTypeName=wasmExports.typeStringToTypeName)(k,e),Module._list_make2_impl=(k,e,I)=>(Module._list_make2_impl=wasmExports.list_make2_impl)(k,e,I),Module._GetUserNameFromId=(k,e)=>(Module._GetUserNameFromId=wasmExports.GetUserNameFromId)(k,e),Module._format_type_extended=(k,e,I)=>(Module._format_type_extended=wasmExports.format_type_extended)(k,e,I),Module._quote_qualified_identifier=(k,e)=>(Module._quote_qualified_identifier=wasmExports.quote_qualified_identifier)(k,e),Module._get_tablespace_name=k=>(Module._get_tablespace_name=wasmExports.get_tablespace_name)(k),Module._GetForeignServerExtended=(k,e)=>(Module._GetForeignServerExtended=wasmExports.GetForeignServerExtended)(k,e),Module._GetForeignServer=k=>(Module._GetForeignServer=wasmExports.GetForeignServer)(k),Module._construct_empty_array=k=>(Module._construct_empty_array=wasmExports.construct_empty_array)(k),Module._format_type_be_qualified=k=>(Module._format_type_be_qualified=wasmExports.format_type_be_qualified)(k),Module._get_namespace_name_or_temp=k=>(Module._get_namespace_name_or_temp=wasmExports.get_namespace_name_or_temp)(k),Module._list_make3_impl=(k,e,I,B)=>(Module._list_make3_impl=wasmExports.list_make3_impl)(k,e,I,B),Module._construct_md_array=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._construct_md_array=wasmExports.construct_md_array)(k,e,I,B,tr,rr,ir,lr,dr),Module._pull_varattnos=(k,e,I)=>(Module._pull_varattnos=wasmExports.pull_varattnos)(k,e,I),Module._get_func_name=k=>(Module._get_func_name=wasmExports.get_func_name)(k),Module._ExecPrepareExpr=(k,e)=>(Module._ExecPrepareExpr=wasmExports.ExecPrepareExpr)(k,e),Module._construct_array=(k,e,I,B,tr,rr)=>(Module._construct_array=wasmExports.construct_array)(k,e,I,B,tr,rr),Module._construct_array_builtin=(k,e,I)=>(Module._construct_array_builtin=wasmExports.construct_array_builtin)(k,e,I),Module._makeObjectName=(k,e,I)=>(Module._makeObjectName=wasmExports.makeObjectName)(k,e,I),Module._get_primary_key_attnos=(k,e,I)=>(Module._get_primary_key_attnos=wasmExports.get_primary_key_attnos)(k,e,I),Module._bms_is_subset=(k,e)=>(Module._bms_is_subset=wasmExports.bms_is_subset)(k,e),Module._getExtensionOfObject=(k,e)=>(Module._getExtensionOfObject=wasmExports.getExtensionOfObject)(k,e),Module._find_inheritance_children=(k,e)=>(Module._find_inheritance_children=wasmExports.find_inheritance_children)(k,e),Module._lappend_int=(k,e)=>(Module._lappend_int=wasmExports.lappend_int)(k,e),Module._has_superclass=k=>(Module._has_superclass=wasmExports.has_superclass)(k),Module._CheckFunctionValidatorAccess=(k,e)=>(Module._CheckFunctionValidatorAccess=wasmExports.CheckFunctionValidatorAccess)(k,e),Module._AcquireRewriteLocks=(k,e,I)=>(Module._AcquireRewriteLocks=wasmExports.AcquireRewriteLocks)(k,e,I),Module._function_parse_error_transpose=k=>(Module._function_parse_error_transpose=wasmExports.function_parse_error_transpose)(k),Module._geterrposition=()=>(Module._geterrposition=wasmExports.geterrposition)(),Module._getinternalerrposition=()=>(Module._getinternalerrposition=wasmExports.getinternalerrposition)(),Module._pg_mblen=k=>(Module._pg_mblen=wasmExports.pg_mblen)(k),Module._pg_mbstrlen_with_len=(k,e)=>(Module._pg_mbstrlen_with_len=wasmExports.pg_mbstrlen_with_len)(k,e),Module._errposition=k=>(Module._errposition=wasmExports.errposition)(k),Module._internalerrposition=k=>(Module._internalerrposition=wasmExports.internalerrposition)(k),Module._internalerrquery=k=>(Module._internalerrquery=wasmExports.internalerrquery)(k),Module._is_publishable_relation=k=>(Module._is_publishable_relation=wasmExports.is_publishable_relation)(k),Module._GetTopMostAncestorInPublication=(k,e,I)=>(Module._GetTopMostAncestorInPublication=wasmExports.GetTopMostAncestorInPublication)(k,e,I),Module._GetRelationPublications=k=>(Module._GetRelationPublications=wasmExports.GetRelationPublications)(k),Module._GetSchemaPublications=k=>(Module._GetSchemaPublications=wasmExports.GetSchemaPublications)(k),Module._pub_collist_to_bitmapset=(k,e,I)=>(Module._pub_collist_to_bitmapset=wasmExports.pub_collist_to_bitmapset)(k,e,I),Module._list_delete_nth_cell=(k,e)=>(Module._list_delete_nth_cell=wasmExports.list_delete_nth_cell)(k,e),Module._get_array_type=k=>(Module._get_array_type=wasmExports.get_array_type)(k),Module._smgrtruncate2=(k,e,I,B,tr)=>(Module._smgrtruncate2=wasmExports.smgrtruncate2)(k,e,I,B,tr),Module._smgrreadv=(k,e,I,B,tr)=>(Module._smgrreadv=wasmExports.smgrreadv)(k,e,I,B,tr),Module._NewRelationCreateToastTable=(k,e)=>(Module._NewRelationCreateToastTable=wasmExports.NewRelationCreateToastTable)(k,e),Module._transformStmt=(k,e)=>(Module._transformStmt=wasmExports.transformStmt)(k,e),Module._exprLocation=k=>(Module._exprLocation=wasmExports.exprLocation)(k),Module._ParseFuncOrColumn=(k,e,I,B,tr,rr,ir)=>(Module._ParseFuncOrColumn=wasmExports.ParseFuncOrColumn)(k,e,I,B,tr,rr,ir),Module._exprCollation=k=>(Module._exprCollation=wasmExports.exprCollation)(k),Module._transformDistinctClause=(k,e,I,B)=>(Module._transformDistinctClause=wasmExports.transformDistinctClause)(k,e,I,B),Module._makeTargetEntry=(k,e,I,B)=>(Module._makeTargetEntry=wasmExports.makeTargetEntry)(k,e,I,B),Module._makeAlias=(k,e)=>(Module._makeAlias=wasmExports.makeAlias)(k,e),Module._addRangeTableEntryForSubquery=(k,e,I,B,tr)=>(Module._addRangeTableEntryForSubquery=wasmExports.addRangeTableEntryForSubquery)(k,e,I,B,tr),Module._makeVar=(k,e,I,B,tr,rr)=>(Module._makeVar=wasmExports.makeVar)(k,e,I,B,tr,rr),Module._makeBoolean=k=>(Module._makeBoolean=wasmExports.makeBoolean)(k),Module._makeInteger=k=>(Module._makeInteger=wasmExports.makeInteger)(k),Module._makeTypeName=k=>(Module._makeTypeName=wasmExports.makeTypeName)(k),Module._makeFuncCall=(k,e,I,B)=>(Module._makeFuncCall=wasmExports.makeFuncCall)(k,e,I,B),Module._list_make4_impl=(k,e,I,B,tr)=>(Module._list_make4_impl=wasmExports.list_make4_impl)(k,e,I,B,tr),Module._get_sortgroupclause_tle=(k,e)=>(Module._get_sortgroupclause_tle=wasmExports.get_sortgroupclause_tle)(k,e),Module._flatten_join_alias_vars=(k,e,I)=>(Module._flatten_join_alias_vars=wasmExports.flatten_join_alias_vars)(k,e,I),Module._list_member_int=(k,e)=>(Module._list_member_int=wasmExports.list_member_int)(k,e),Module._addRangeTableEntryForENR=(k,e,I)=>(Module._addRangeTableEntryForENR=wasmExports.addRangeTableEntryForENR)(k,e,I),Module._typenameTypeIdAndMod=(k,e,I,B)=>(Module._typenameTypeIdAndMod=wasmExports.typenameTypeIdAndMod)(k,e,I,B),Module._get_typcollation=k=>(Module._get_typcollation=wasmExports.get_typcollation)(k),Module._strip_implicit_coercions=k=>(Module._strip_implicit_coercions=wasmExports.strip_implicit_coercions)(k),Module._get_sortgroupref_tle=(k,e)=>(Module._get_sortgroupref_tle=wasmExports.get_sortgroupref_tle)(k,e),Module._contain_aggs_of_level=(k,e)=>(Module._contain_aggs_of_level=wasmExports.contain_aggs_of_level)(k,e),Module._typeidType=k=>(Module._typeidType=wasmExports.typeidType)(k),Module._typeTypeCollation=k=>(Module._typeTypeCollation=wasmExports.typeTypeCollation)(k),Module._typeLen=k=>(Module._typeLen=wasmExports.typeLen)(k),Module._typeByVal=k=>(Module._typeByVal=wasmExports.typeByVal)(k),Module._makeConst=(k,e,I,B,tr,rr,ir)=>(Module._makeConst=wasmExports.makeConst)(k,e,I,B,tr,rr,ir),Module._lookup_rowtype_tupdesc=(k,e)=>(Module._lookup_rowtype_tupdesc=wasmExports.lookup_rowtype_tupdesc)(k,e),Module._bms_del_member=(k,e)=>(Module._bms_del_member=wasmExports.bms_del_member)(k,e),Module._list_member=(k,e)=>(Module._list_member=wasmExports.list_member)(k,e),Module._type_is_rowtype=k=>(Module._type_is_rowtype=wasmExports.type_is_rowtype)(k),Module._bit_in=k=>(Module._bit_in=wasmExports.bit_in)(k),Module._bms_union=(k,e)=>(Module._bms_union=wasmExports.bms_union)(k,e),Module._varstr_levenshtein_less_equal=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._varstr_levenshtein_less_equal=wasmExports.varstr_levenshtein_less_equal)(k,e,I,B,tr,rr,ir,lr,dr),Module._addRTEPermissionInfo=(k,e)=>(Module._addRTEPermissionInfo=wasmExports.addRTEPermissionInfo)(k,e),Module._errsave_start=(k,e)=>(Module._errsave_start=wasmExports.errsave_start)(k,e),Module._errsave_finish=(k,e,I,B)=>(Module._errsave_finish=wasmExports.errsave_finish)(k,e,I,B),Module._makeColumnDef=(k,e,I,B)=>(Module._makeColumnDef=wasmExports.makeColumnDef)(k,e,I,B),Module._GetDefaultOpClass=(k,e)=>(Module._GetDefaultOpClass=wasmExports.GetDefaultOpClass)(k,e),Module._scanner_init=(k,e,I,B)=>(Module._scanner_init=wasmExports.scanner_init)(k,e,I,B),Module._scanner_finish=k=>(Module._scanner_finish=wasmExports.scanner_finish)(k),Module._core_yylex=(k,e,I)=>(Module._core_yylex=wasmExports.core_yylex)(k,e,I),Module._isxdigit=k=>(Module._isxdigit=wasmExports.isxdigit)(k),Module._scanner_isspace=k=>(Module._scanner_isspace=wasmExports.scanner_isspace)(k),Module._truncate_identifier=(k,e,I)=>(Module._truncate_identifier=wasmExports.truncate_identifier)(k,e,I),Module._downcase_truncate_identifier=(k,e,I)=>(Module._downcase_truncate_identifier=wasmExports.downcase_truncate_identifier)(k,e,I),Module._pg_database_encoding_max_length=()=>(Module._pg_database_encoding_max_length=wasmExports.pg_database_encoding_max_length)(),Module._namein=k=>(Module._namein=wasmExports.namein)(k),Module._BlockSampler_Init=(k,e,I,B)=>(Module._BlockSampler_Init=wasmExports.BlockSampler_Init)(k,e,I,B),Module._reservoir_init_selection_state=(k,e)=>(Module._reservoir_init_selection_state=wasmExports.reservoir_init_selection_state)(k,e),Module._reservoir_get_next_S=(k,e,I)=>(Module._reservoir_get_next_S=wasmExports.reservoir_get_next_S)(k,e,I),Module._sampler_random_fract=k=>(Module._sampler_random_fract=wasmExports.sampler_random_fract)(k),Module._BlockSampler_HasMore=k=>(Module._BlockSampler_HasMore=wasmExports.BlockSampler_HasMore)(k),Module._BlockSampler_Next=k=>(Module._BlockSampler_Next=wasmExports.BlockSampler_Next)(k),Module._Async_Notify=(k,e)=>(Module._Async_Notify=wasmExports.Async_Notify)(k,e),Module._RangeVarCallbackMaintainsTable=(k,e,I,B)=>(Module._RangeVarCallbackMaintainsTable=wasmExports.RangeVarCallbackMaintainsTable)(k,e,I,B),Module._make_new_heap=(k,e,I,B,tr)=>(Module._make_new_heap=wasmExports.make_new_heap)(k,e,I,B,tr),Module._finish_heap_swap=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._finish_heap_swap=wasmExports.finish_heap_swap)(k,e,I,B,tr,rr,ir,lr,dr),Module._wasm_OpenPipeStream=(k,e)=>(Module._wasm_OpenPipeStream=wasmExports.wasm_OpenPipeStream)(k,e),Module._ClosePipeStream=k=>(Module._ClosePipeStream=wasmExports.ClosePipeStream)(k),Module._BeginCopyFrom=(k,e,I,B,tr,rr,ir,lr)=>(Module._BeginCopyFrom=wasmExports.BeginCopyFrom)(k,e,I,B,tr,rr,ir,lr),Module._EndCopyFrom=k=>(Module._EndCopyFrom=wasmExports.EndCopyFrom)(k),Module._ProcessCopyOptions=(k,e,I,B)=>(Module._ProcessCopyOptions=wasmExports.ProcessCopyOptions)(k,e,I,B),Module._CopyFromErrorCallback=k=>(Module._CopyFromErrorCallback=wasmExports.CopyFromErrorCallback)(k),Module._ExecInitRangeTable=(k,e,I)=>(Module._ExecInitRangeTable=wasmExports.ExecInitRangeTable)(k,e,I),Module._NextCopyFrom=(k,e,I,B)=>(Module._NextCopyFrom=wasmExports.NextCopyFrom)(k,e,I,B),Module._ExecInitExpr=(k,e)=>(Module._ExecInitExpr=wasmExports.ExecInitExpr)(k,e),Module._report_invalid_encoding=(k,e,I)=>(Module._report_invalid_encoding=wasmExports.report_invalid_encoding)(k,e,I),Module._tolower=k=>(Module._tolower=wasmExports.tolower)(k),Module._PushCopiedSnapshot=k=>(Module._PushCopiedSnapshot=wasmExports.PushCopiedSnapshot)(k),Module._UpdateActiveSnapshotCommandId=()=>(Module._UpdateActiveSnapshotCommandId=wasmExports.UpdateActiveSnapshotCommandId)(),Module._CreateQueryDesc=(k,e,I,B,tr,rr,ir,lr)=>(Module._CreateQueryDesc=wasmExports.CreateQueryDesc)(k,e,I,B,tr,rr,ir,lr),Module._ExecutorStart=(k,e)=>(Module._ExecutorStart=wasmExports.ExecutorStart)(k,e),Module._ExecutorFinish=k=>(Module._ExecutorFinish=wasmExports.ExecutorFinish)(k),Module._ExecutorEnd=k=>(Module._ExecutorEnd=wasmExports.ExecutorEnd)(k),Module._FreeQueryDesc=k=>(Module._FreeQueryDesc=wasmExports.FreeQueryDesc)(k),Module._pg_server_to_any=(k,e,I)=>(Module._pg_server_to_any=wasmExports.pg_server_to_any)(k,e,I),Module._ExecutorRun=(k,e,I,B)=>(Module._ExecutorRun=wasmExports.ExecutorRun)(k,e,I,B),Module._CreateTableAsRelExists=k=>(Module._CreateTableAsRelExists=wasmExports.CreateTableAsRelExists)(k),Module._DefineRelation=(k,e,I,B,tr,rr)=>(Module._DefineRelation=wasmExports.DefineRelation)(k,e,I,B,tr,rr),Module._oidin=k=>(Module._oidin=wasmExports.oidin)(k),Module._GetCommandTagName=k=>(Module._GetCommandTagName=wasmExports.GetCommandTagName)(k),Module._ExplainBeginOutput=k=>(Module._ExplainBeginOutput=wasmExports.ExplainBeginOutput)(k),Module._NewExplainState=()=>(Module._NewExplainState=wasmExports.NewExplainState)(),Module._ExplainEndOutput=k=>(Module._ExplainEndOutput=wasmExports.ExplainEndOutput)(k),Module._ExplainPrintPlan=(k,e)=>(Module._ExplainPrintPlan=wasmExports.ExplainPrintPlan)(k,e),Module._ExplainPrintTriggers=(k,e)=>(Module._ExplainPrintTriggers=wasmExports.ExplainPrintTriggers)(k,e),Module._ExplainPrintJITSummary=(k,e)=>(Module._ExplainPrintJITSummary=wasmExports.ExplainPrintJITSummary)(k,e),Module._InstrEndLoop=k=>(Module._InstrEndLoop=wasmExports.InstrEndLoop)(k),Module._ExplainPropertyInteger=(k,e,I,B)=>(Module._ExplainPropertyInteger=wasmExports.ExplainPropertyInteger)(k,e,I,B),Module._make_orclause=k=>(Module._make_orclause=wasmExports.make_orclause)(k),Module._ExplainQueryText=(k,e)=>(Module._ExplainQueryText=wasmExports.ExplainQueryText)(k,e),Module._ExplainPropertyText=(k,e,I)=>(Module._ExplainPropertyText=wasmExports.ExplainPropertyText)(k,e,I),Module._ExplainQueryParameters=(k,e,I)=>(Module._ExplainQueryParameters=wasmExports.ExplainQueryParameters)(k,e,I),Module._get_func_namespace=k=>(Module._get_func_namespace=wasmExports.get_func_namespace)(k),Module._get_rel_type_id=k=>(Module._get_rel_type_id=wasmExports.get_rel_type_id)(k),Module._set_config_option=(k,e,I,B,tr,rr,ir,lr)=>(Module._set_config_option=wasmExports.set_config_option)(k,e,I,B,tr,rr,ir,lr),Module._pg_any_to_server=(k,e,I)=>(Module._pg_any_to_server=wasmExports.pg_any_to_server)(k,e,I),Module._DirectFunctionCall4Coll=(k,e,I,B,tr,rr)=>(Module._DirectFunctionCall4Coll=wasmExports.DirectFunctionCall4Coll)(k,e,I,B,tr,rr),Module._list_delete_cell=(k,e)=>(Module._list_delete_cell=wasmExports.list_delete_cell)(k,e),Module._GetForeignDataWrapper=k=>(Module._GetForeignDataWrapper=wasmExports.GetForeignDataWrapper)(k),Module._CreateExprContext=k=>(Module._CreateExprContext=wasmExports.CreateExprContext)(k),Module._EnsurePortalSnapshotExists=()=>(Module._EnsurePortalSnapshotExists=wasmExports.EnsurePortalSnapshotExists)(),Module._CheckIndexCompatible=(k,e,I,B)=>(Module._CheckIndexCompatible=wasmExports.CheckIndexCompatible)(k,e,I,B),Module._pgstat_count_truncate=k=>(Module._pgstat_count_truncate=wasmExports.pgstat_count_truncate)(k),Module._SPI_connect=()=>(Module._SPI_connect=wasmExports.SPI_connect)(),Module._SPI_exec=(k,e)=>(Module._SPI_exec=wasmExports.SPI_exec)(k,e),Module._SPI_execute=(k,e,I)=>(Module._SPI_execute=wasmExports.SPI_execute)(k,e,I),Module._SPI_getvalue=(k,e,I)=>(Module._SPI_getvalue=wasmExports.SPI_getvalue)(k,e,I),Module._generate_operator_clause=(k,e,I,B,tr,rr)=>(Module._generate_operator_clause=wasmExports.generate_operator_clause)(k,e,I,B,tr,rr),Module._SPI_finish=()=>(Module._SPI_finish=wasmExports.SPI_finish)(),Module._CreateTransientRelDestReceiver=k=>(Module._CreateTransientRelDestReceiver=wasmExports.CreateTransientRelDestReceiver)(k),Module._MemoryContextSetIdentifier=(k,e)=>(Module._MemoryContextSetIdentifier=wasmExports.MemoryContextSetIdentifier)(k,e),Module._checkExprHasSubLink=k=>(Module._checkExprHasSubLink=wasmExports.checkExprHasSubLink)(k),Module._SetTuplestoreDestReceiverParams=(k,e,I,B,tr,rr)=>(Module._SetTuplestoreDestReceiverParams=wasmExports.SetTuplestoreDestReceiverParams)(k,e,I,B,tr,rr),Module._tuplestore_rescan=k=>(Module._tuplestore_rescan=wasmExports.tuplestore_rescan)(k),Module._MemoryContextDeleteChildren=k=>(Module._MemoryContextDeleteChildren=wasmExports.MemoryContextDeleteChildren)(k),Module._ReleaseCachedPlan=(k,e)=>(Module._ReleaseCachedPlan=wasmExports.ReleaseCachedPlan)(k,e),Module._bms_equal=(k,e)=>(Module._bms_equal=wasmExports.bms_equal)(k,e),Module._nextval=k=>(Module._nextval=wasmExports.nextval)(k),Module._textToQualifiedNameList=k=>(Module._textToQualifiedNameList=wasmExports.textToQualifiedNameList)(k),Module._defGetStreamingMode=k=>(Module._defGetStreamingMode=wasmExports.defGetStreamingMode)(k),Module._pg_lsn_in=k=>(Module._pg_lsn_in=wasmExports.pg_lsn_in)(k),Module._tuplestore_gettupleslot=(k,e,I,B)=>(Module._tuplestore_gettupleslot=wasmExports.tuplestore_gettupleslot)(k,e,I,B),Module._list_delete=(k,e)=>(Module._list_delete=wasmExports.list_delete)(k,e),Module._tuplestore_end=k=>(Module._tuplestore_end=wasmExports.tuplestore_end)(k),Module._quote_literal_cstr=k=>(Module._quote_literal_cstr=wasmExports.quote_literal_cstr)(k),Module._contain_mutable_functions=k=>(Module._contain_mutable_functions=wasmExports.contain_mutable_functions)(k),Module._ExecuteTruncateGuts=(k,e,I,B,tr,rr)=>(Module._ExecuteTruncateGuts=wasmExports.ExecuteTruncateGuts)(k,e,I,B,tr,rr),Module._bms_make_singleton=k=>(Module._bms_make_singleton=wasmExports.bms_make_singleton)(k),Module._tuplestore_puttupleslot=(k,e)=>(Module._tuplestore_puttupleslot=wasmExports.tuplestore_puttupleslot)(k,e),Module._tuplestore_begin_heap=(k,e,I)=>(Module._tuplestore_begin_heap=wasmExports.tuplestore_begin_heap)(k,e,I),Module._ExecForceStoreHeapTuple=(k,e,I)=>(Module._ExecForceStoreHeapTuple=wasmExports.ExecForceStoreHeapTuple)(k,e,I),Module._strtod=(k,e)=>(Module._strtod=wasmExports.strtod)(k,e),Module._plain_crypt_verify=(k,e,I,B)=>(Module._plain_crypt_verify=wasmExports.plain_crypt_verify)(k,e,I,B),Module._ProcessConfigFile=k=>(Module._ProcessConfigFile=wasmExports.ProcessConfigFile)(k),Module._ExecReScan=k=>(Module._ExecReScan=wasmExports.ExecReScan)(k),Module._ExecAsyncResponse=k=>(Module._ExecAsyncResponse=wasmExports.ExecAsyncResponse)(k),Module._ExecAsyncRequestDone=(k,e)=>(Module._ExecAsyncRequestDone=wasmExports.ExecAsyncRequestDone)(k,e),Module._ExecAsyncRequestPending=k=>(Module._ExecAsyncRequestPending=wasmExports.ExecAsyncRequestPending)(k),Module._ExprEvalPushStep=(k,e)=>(Module._ExprEvalPushStep=wasmExports.ExprEvalPushStep)(k,e),Module._ExecInitExprWithParams=(k,e)=>(Module._ExecInitExprWithParams=wasmExports.ExecInitExprWithParams)(k,e),Module._ExecInitExprList=(k,e)=>(Module._ExecInitExprList=wasmExports.ExecInitExprList)(k,e),Module._MakeExpandedObjectReadOnlyInternal=k=>(Module._MakeExpandedObjectReadOnlyInternal=wasmExports.MakeExpandedObjectReadOnlyInternal)(k),Module._tuplesort_puttupleslot=(k,e)=>(Module._tuplesort_puttupleslot=wasmExports.tuplesort_puttupleslot)(k,e),Module._ArrayGetNItems=(k,e)=>(Module._ArrayGetNItems=wasmExports.ArrayGetNItems)(k,e),Module._expanded_record_fetch_tupdesc=k=>(Module._expanded_record_fetch_tupdesc=wasmExports.expanded_record_fetch_tupdesc)(k),Module._expanded_record_fetch_field=(k,e,I)=>(Module._expanded_record_fetch_field=wasmExports.expanded_record_fetch_field)(k,e,I),Module._JsonbValueToJsonb=k=>(Module._JsonbValueToJsonb=wasmExports.JsonbValueToJsonb)(k),Module._boolout=k=>(Module._boolout=wasmExports.boolout)(k),Module._lookup_rowtype_tupdesc_domain=(k,e,I)=>(Module._lookup_rowtype_tupdesc_domain=wasmExports.lookup_rowtype_tupdesc_domain)(k,e,I),Module._MemoryContextGetParent=k=>(Module._MemoryContextGetParent=wasmExports.MemoryContextGetParent)(k),Module._DeleteExpandedObject=k=>(Module._DeleteExpandedObject=wasmExports.DeleteExpandedObject)(k),Module._ExecFindJunkAttributeInTlist=(k,e)=>(Module._ExecFindJunkAttributeInTlist=wasmExports.ExecFindJunkAttributeInTlist)(k,e),Module._standard_ExecutorStart=(k,e)=>(Module._standard_ExecutorStart=wasmExports.standard_ExecutorStart)(k,e),Module._standard_ExecutorRun=(k,e,I,B)=>(Module._standard_ExecutorRun=wasmExports.standard_ExecutorRun)(k,e,I,B),Module._standard_ExecutorFinish=k=>(Module._standard_ExecutorFinish=wasmExports.standard_ExecutorFinish)(k),Module._standard_ExecutorEnd=k=>(Module._standard_ExecutorEnd=wasmExports.standard_ExecutorEnd)(k),Module._InstrAlloc=(k,e,I)=>(Module._InstrAlloc=wasmExports.InstrAlloc)(k,e,I),Module._MakeTupleTableSlot=(k,e)=>(Module._MakeTupleTableSlot=wasmExports.MakeTupleTableSlot)(k,e),Module._get_typlenbyval=(k,e,I)=>(Module._get_typlenbyval=wasmExports.get_typlenbyval)(k,e,I),Module._bms_num_members=k=>(Module._bms_num_members=wasmExports.bms_num_members)(k),Module._InputFunctionCall=(k,e,I,B)=>(Module._InputFunctionCall=wasmExports.InputFunctionCall)(k,e,I,B),Module._FreeExprContext=(k,e)=>(Module._FreeExprContext=wasmExports.FreeExprContext)(k,e),Module._ExecOpenScanRelation=(k,e,I)=>(Module._ExecOpenScanRelation=wasmExports.ExecOpenScanRelation)(k,e,I),Module._bms_intersect=(k,e)=>(Module._bms_intersect=wasmExports.bms_intersect)(k,e),Module._ExecGetReturningSlot=(k,e)=>(Module._ExecGetReturningSlot=wasmExports.ExecGetReturningSlot)(k,e),Module._ExecGetResultRelCheckAsUser=(k,e)=>(Module._ExecGetResultRelCheckAsUser=wasmExports.ExecGetResultRelCheckAsUser)(k,e),Module._get_call_expr_argtype=(k,e)=>(Module._get_call_expr_argtype=wasmExports.get_call_expr_argtype)(k,e),Module._tuplestore_clear=k=>(Module._tuplestore_clear=wasmExports.tuplestore_clear)(k),Module._InstrUpdateTupleCount=(k,e)=>(Module._InstrUpdateTupleCount=wasmExports.InstrUpdateTupleCount)(k,e),Module._tuplesort_begin_heap=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._tuplesort_begin_heap=wasmExports.tuplesort_begin_heap)(k,e,I,B,tr,rr,ir,lr,dr),Module._tuplesort_gettupleslot=(k,e,I,B,tr)=>(Module._tuplesort_gettupleslot=wasmExports.tuplesort_gettupleslot)(k,e,I,B,tr),Module._AddWaitEventToSet=(k,e,I,B,tr)=>(Module._AddWaitEventToSet=wasmExports.AddWaitEventToSet)(k,e,I,B,tr),Module._GetNumRegisteredWaitEvents=k=>(Module._GetNumRegisteredWaitEvents=wasmExports.GetNumRegisteredWaitEvents)(k),Module._get_attstatsslot=(k,e,I,B,tr)=>(Module._get_attstatsslot=wasmExports.get_attstatsslot)(k,e,I,B,tr),Module._free_attstatsslot=k=>(Module._free_attstatsslot=wasmExports.free_attstatsslot)(k),Module._tuplesort_reset=k=>(Module._tuplesort_reset=wasmExports.tuplesort_reset)(k),Module._pairingheap_first=k=>(Module._pairingheap_first=wasmExports.pairingheap_first)(k),Module._bms_nonempty_difference=(k,e)=>(Module._bms_nonempty_difference=wasmExports.bms_nonempty_difference)(k,e),Module._SPI_connect_ext=k=>(Module._SPI_connect_ext=wasmExports.SPI_connect_ext)(k),Module._SPI_commit=()=>(Module._SPI_commit=wasmExports.SPI_commit)(),Module._CopyErrorData=()=>(Module._CopyErrorData=wasmExports.CopyErrorData)(),Module._ReThrowError=k=>(Module._ReThrowError=wasmExports.ReThrowError)(k),Module._SPI_commit_and_chain=()=>(Module._SPI_commit_and_chain=wasmExports.SPI_commit_and_chain)(),Module._SPI_rollback=()=>(Module._SPI_rollback=wasmExports.SPI_rollback)(),Module._SPI_rollback_and_chain=()=>(Module._SPI_rollback_and_chain=wasmExports.SPI_rollback_and_chain)(),Module._SPI_freetuptable=k=>(Module._SPI_freetuptable=wasmExports.SPI_freetuptable)(k),Module._SPI_execute_extended=(k,e)=>(Module._SPI_execute_extended=wasmExports.SPI_execute_extended)(k,e),Module._SPI_execute_plan=(k,e,I,B,tr)=>(Module._SPI_execute_plan=wasmExports.SPI_execute_plan)(k,e,I,B,tr),Module._SPI_execp=(k,e,I,B)=>(Module._SPI_execp=wasmExports.SPI_execp)(k,e,I,B),Module._SPI_execute_plan_extended=(k,e)=>(Module._SPI_execute_plan_extended=wasmExports.SPI_execute_plan_extended)(k,e),Module._SPI_execute_plan_with_paramlist=(k,e,I,B)=>(Module._SPI_execute_plan_with_paramlist=wasmExports.SPI_execute_plan_with_paramlist)(k,e,I,B),Module._SPI_prepare=(k,e,I)=>(Module._SPI_prepare=wasmExports.SPI_prepare)(k,e,I),Module._SPI_prepare_extended=(k,e)=>(Module._SPI_prepare_extended=wasmExports.SPI_prepare_extended)(k,e),Module._SPI_keepplan=k=>(Module._SPI_keepplan=wasmExports.SPI_keepplan)(k),Module._SPI_freeplan=k=>(Module._SPI_freeplan=wasmExports.SPI_freeplan)(k),Module._SPI_copytuple=k=>(Module._SPI_copytuple=wasmExports.SPI_copytuple)(k),Module._SPI_returntuple=(k,e)=>(Module._SPI_returntuple=wasmExports.SPI_returntuple)(k,e),Module._SPI_fnumber=(k,e)=>(Module._SPI_fnumber=wasmExports.SPI_fnumber)(k,e),Module._SPI_fname=(k,e)=>(Module._SPI_fname=wasmExports.SPI_fname)(k,e),Module._SPI_getbinval=(k,e,I,B)=>(Module._SPI_getbinval=wasmExports.SPI_getbinval)(k,e,I,B),Module._SPI_gettype=(k,e)=>(Module._SPI_gettype=wasmExports.SPI_gettype)(k,e),Module._SPI_gettypeid=(k,e)=>(Module._SPI_gettypeid=wasmExports.SPI_gettypeid)(k,e),Module._SPI_getrelname=k=>(Module._SPI_getrelname=wasmExports.SPI_getrelname)(k),Module._SPI_palloc=k=>(Module._SPI_palloc=wasmExports.SPI_palloc)(k),Module._SPI_datumTransfer=(k,e,I)=>(Module._SPI_datumTransfer=wasmExports.SPI_datumTransfer)(k,e,I),Module._datumTransfer=(k,e,I)=>(Module._datumTransfer=wasmExports.datumTransfer)(k,e,I),Module._SPI_cursor_open_with_paramlist=(k,e,I,B)=>(Module._SPI_cursor_open_with_paramlist=wasmExports.SPI_cursor_open_with_paramlist)(k,e,I,B),Module._SPI_cursor_parse_open=(k,e,I)=>(Module._SPI_cursor_parse_open=wasmExports.SPI_cursor_parse_open)(k,e,I),Module._SPI_cursor_find=k=>(Module._SPI_cursor_find=wasmExports.SPI_cursor_find)(k),Module._SPI_cursor_fetch=(k,e,I)=>(Module._SPI_cursor_fetch=wasmExports.SPI_cursor_fetch)(k,e,I),Module._SPI_scroll_cursor_fetch=(k,e,I)=>(Module._SPI_scroll_cursor_fetch=wasmExports.SPI_scroll_cursor_fetch)(k,e,I),Module._SPI_scroll_cursor_move=(k,e,I)=>(Module._SPI_scroll_cursor_move=wasmExports.SPI_scroll_cursor_move)(k,e,I),Module._SPI_cursor_close=k=>(Module._SPI_cursor_close=wasmExports.SPI_cursor_close)(k),Module._SPI_plan_is_valid=k=>(Module._SPI_plan_is_valid=wasmExports.SPI_plan_is_valid)(k),Module._SPI_result_code_string=k=>(Module._SPI_result_code_string=wasmExports.SPI_result_code_string)(k),Module._SPI_plan_get_plan_sources=k=>(Module._SPI_plan_get_plan_sources=wasmExports.SPI_plan_get_plan_sources)(k),Module._SPI_plan_get_cached_plan=k=>(Module._SPI_plan_get_cached_plan=wasmExports.SPI_plan_get_cached_plan)(k),Module._SPI_register_relation=k=>(Module._SPI_register_relation=wasmExports.SPI_register_relation)(k),Module._create_queryEnv=()=>(Module._create_queryEnv=wasmExports.create_queryEnv)(),Module._register_ENR=(k,e)=>(Module._register_ENR=wasmExports.register_ENR)(k,e),Module._SPI_register_trigger_data=k=>(Module._SPI_register_trigger_data=wasmExports.SPI_register_trigger_data)(k),Module._tuplestore_tuple_count=k=>(Module._tuplestore_tuple_count=wasmExports.tuplestore_tuple_count)(k),Module._GetUserMapping=(k,e)=>(Module._GetUserMapping=wasmExports.GetUserMapping)(k,e),Module._GetForeignTable=k=>(Module._GetForeignTable=wasmExports.GetForeignTable)(k),Module._GetForeignColumnOptions=(k,e)=>(Module._GetForeignColumnOptions=wasmExports.GetForeignColumnOptions)(k,e),Module._initClosestMatch=(k,e,I)=>(Module._initClosestMatch=wasmExports.initClosestMatch)(k,e,I),Module._updateClosestMatch=(k,e)=>(Module._updateClosestMatch=wasmExports.updateClosestMatch)(k,e),Module._getClosestMatch=k=>(Module._getClosestMatch=wasmExports.getClosestMatch)(k),Module._GetExistingLocalJoinPath=k=>(Module._GetExistingLocalJoinPath=wasmExports.GetExistingLocalJoinPath)(k),Module._bloom_create=(k,e,I)=>(Module._bloom_create=wasmExports.bloom_create)(k,e,I),Module._bloom_free=k=>(Module._bloom_free=wasmExports.bloom_free)(k),Module._bloom_add_element=(k,e,I)=>(Module._bloom_add_element=wasmExports.bloom_add_element)(k,e,I),Module._bloom_lacks_element=(k,e,I)=>(Module._bloom_lacks_element=wasmExports.bloom_lacks_element)(k,e,I),Module._bloom_prop_bits_set=k=>(Module._bloom_prop_bits_set=wasmExports.bloom_prop_bits_set)(k),Module._gai_strerror=k=>(Module._gai_strerror=wasmExports.gai_strerror)(k),Module._socket=(k,e,I)=>(Module._socket=wasmExports.socket)(k,e,I),Module._connect=(k,e,I)=>(Module._connect=wasmExports.connect)(k,e,I),Module._send=(k,e,I,B)=>(Module._send=wasmExports.send)(k,e,I,B),Module._recv=(k,e,I,B)=>(Module._recv=wasmExports.recv)(k,e,I,B),Module._be_lo_unlink=k=>(Module._be_lo_unlink=wasmExports.be_lo_unlink)(k),Module._text_to_cstring_buffer=(k,e,I)=>(Module._text_to_cstring_buffer=wasmExports.text_to_cstring_buffer)(k,e,I),Module._feof=k=>(Module._feof=wasmExports.feof)(k),Module._pg_mb2wchar_with_len=(k,e,I)=>(Module._pg_mb2wchar_with_len=wasmExports.pg_mb2wchar_with_len)(k,e,I),Module._pg_regcomp=(k,e,I,B,tr)=>(Module._pg_regcomp=wasmExports.pg_regcomp)(k,e,I,B,tr),Module._pg_regerror=(k,e,I,B)=>(Module._pg_regerror=wasmExports.pg_regerror)(k,e,I,B),Module._strcat=(k,e)=>(Module._strcat=wasmExports.strcat)(k,e),Module._setsockopt=(k,e,I,B,tr)=>(Module._setsockopt=wasmExports.setsockopt)(k,e,I,B,tr),Module._pq_sendtext=(k,e,I)=>(Module._pq_sendtext=wasmExports.pq_sendtext)(k,e,I),Module._pq_sendfloat4=(k,e)=>(Module._pq_sendfloat4=wasmExports.pq_sendfloat4)(k,e),Module._pq_sendfloat8=(k,e)=>(Module._pq_sendfloat8=wasmExports.pq_sendfloat8)(k,e),Module._pq_begintypsend=k=>(Module._pq_begintypsend=wasmExports.pq_begintypsend)(k),Module._pq_endtypsend=k=>(Module._pq_endtypsend=wasmExports.pq_endtypsend)(k),Module._pq_getmsgfloat4=k=>(Module._pq_getmsgfloat4=wasmExports.pq_getmsgfloat4)(k),Module._pq_getmsgfloat8=k=>(Module._pq_getmsgfloat8=wasmExports.pq_getmsgfloat8)(k),Module._pq_getmsgtext=(k,e,I)=>(Module._pq_getmsgtext=wasmExports.pq_getmsgtext)(k,e,I),Module._pg_strtoint32=k=>(Module._pg_strtoint32=wasmExports.pg_strtoint32)(k),Module._bms_membership=k=>(Module._bms_membership=wasmExports.bms_membership)(k),Module._list_make5_impl=(k,e,I,B,tr,rr)=>(Module._list_make5_impl=wasmExports.list_make5_impl)(k,e,I,B,tr,rr),Module._lappend_xid=(k,e)=>(Module._lappend_xid=wasmExports.lappend_xid)(k,e),Module._list_insert_nth=(k,e,I)=>(Module._list_insert_nth=wasmExports.list_insert_nth)(k,e,I),Module._list_member_ptr=(k,e)=>(Module._list_member_ptr=wasmExports.list_member_ptr)(k,e),Module._list_member_xid=(k,e)=>(Module._list_member_xid=wasmExports.list_member_xid)(k,e),Module._list_append_unique_ptr=(k,e)=>(Module._list_append_unique_ptr=wasmExports.list_append_unique_ptr)(k,e),Module._make_opclause=(k,e,I,B,tr,rr,ir)=>(Module._make_opclause=wasmExports.make_opclause)(k,e,I,B,tr,rr,ir),Module._exprIsLengthCoercion=(k,e)=>(Module._exprIsLengthCoercion=wasmExports.exprIsLengthCoercion)(k,e),Module._fix_opfuncids=k=>(Module._fix_opfuncids=wasmExports.fix_opfuncids)(k),Module._CleanQuerytext=(k,e,I)=>(Module._CleanQuerytext=wasmExports.CleanQuerytext)(k,e,I),Module._EnableQueryId=()=>(Module._EnableQueryId=wasmExports.EnableQueryId)(),Module._find_base_rel=(k,e)=>(Module._find_base_rel=wasmExports.find_base_rel)(k,e),Module._add_path=(k,e)=>(Module._add_path=wasmExports.add_path)(k,e),Module._pathkeys_contained_in=(k,e)=>(Module._pathkeys_contained_in=wasmExports.pathkeys_contained_in)(k,e),Module._create_sort_path=(k,e,I,B,tr)=>(Module._create_sort_path=wasmExports.create_sort_path)(k,e,I,B,tr),Module._set_baserel_size_estimates=(k,e)=>(Module._set_baserel_size_estimates=wasmExports.set_baserel_size_estimates)(k,e),Module._clauselist_selectivity=(k,e,I,B,tr)=>(Module._clauselist_selectivity=wasmExports.clauselist_selectivity)(k,e,I,B,tr),Module._get_tablespace_page_costs=(k,e,I)=>(Module._get_tablespace_page_costs=wasmExports.get_tablespace_page_costs)(k,e,I),Module._cost_qual_eval=(k,e,I)=>(Module._cost_qual_eval=wasmExports.cost_qual_eval)(k,e,I),Module._estimate_num_groups=(k,e,I,B,tr)=>(Module._estimate_num_groups=wasmExports.estimate_num_groups)(k,e,I,B,tr),Module._cost_sort=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._cost_sort=wasmExports.cost_sort)(k,e,I,B,tr,rr,ir,lr,dr),Module._get_sortgrouplist_exprs=(k,e)=>(Module._get_sortgrouplist_exprs=wasmExports.get_sortgrouplist_exprs)(k,e),Module._make_restrictinfo=(k,e,I,B,tr,rr,ir,lr,dr,mr)=>(Module._make_restrictinfo=wasmExports.make_restrictinfo)(k,e,I,B,tr,rr,ir,lr,dr,mr),Module._generate_implied_equalities_for_column=(k,e,I,B,tr)=>(Module._generate_implied_equalities_for_column=wasmExports.generate_implied_equalities_for_column)(k,e,I,B,tr),Module._eclass_useful_for_merging=(k,e,I)=>(Module._eclass_useful_for_merging=wasmExports.eclass_useful_for_merging)(k,e,I),Module._join_clause_is_movable_to=(k,e)=>(Module._join_clause_is_movable_to=wasmExports.join_clause_is_movable_to)(k,e),Module._get_plan_rowmark=(k,e)=>(Module._get_plan_rowmark=wasmExports.get_plan_rowmark)(k,e),Module._update_mergeclause_eclasses=(k,e)=>(Module._update_mergeclause_eclasses=wasmExports.update_mergeclause_eclasses)(k,e),Module._find_join_rel=(k,e)=>(Module._find_join_rel=wasmExports.find_join_rel)(k,e),Module._make_canonical_pathkey=(k,e,I,B,tr)=>(Module._make_canonical_pathkey=wasmExports.make_canonical_pathkey)(k,e,I,B,tr),Module._get_sortgroupref_clause_noerr=(k,e)=>(Module._get_sortgroupref_clause_noerr=wasmExports.get_sortgroupref_clause_noerr)(k,e),Module._extract_actual_clauses=(k,e)=>(Module._extract_actual_clauses=wasmExports.extract_actual_clauses)(k,e),Module._change_plan_targetlist=(k,e,I)=>(Module._change_plan_targetlist=wasmExports.change_plan_targetlist)(k,e,I),Module._make_foreignscan=(k,e,I,B,tr,rr,ir,lr)=>(Module._make_foreignscan=wasmExports.make_foreignscan)(k,e,I,B,tr,rr,ir,lr),Module._tlist_member=(k,e)=>(Module._tlist_member=wasmExports.tlist_member)(k,e),Module._pull_vars_of_level=(k,e)=>(Module._pull_vars_of_level=wasmExports.pull_vars_of_level)(k,e),Module._IncrementVarSublevelsUp=(k,e,I)=>(Module._IncrementVarSublevelsUp=wasmExports.IncrementVarSublevelsUp)(k,e,I),Module._standard_planner=(k,e,I,B)=>(Module._standard_planner=wasmExports.standard_planner)(k,e,I,B),Module._get_relids_in_jointree=(k,e,I)=>(Module._get_relids_in_jointree=wasmExports.get_relids_in_jointree)(k,e,I),Module._add_new_columns_to_pathtarget=(k,e)=>(Module._add_new_columns_to_pathtarget=wasmExports.add_new_columns_to_pathtarget)(k,e),Module._get_agg_clause_costs=(k,e,I)=>(Module._get_agg_clause_costs=wasmExports.get_agg_clause_costs)(k,e,I),Module._grouping_is_sortable=k=>(Module._grouping_is_sortable=wasmExports.grouping_is_sortable)(k),Module._copy_pathtarget=k=>(Module._copy_pathtarget=wasmExports.copy_pathtarget)(k),Module._create_projection_path=(k,e,I,B)=>(Module._create_projection_path=wasmExports.create_projection_path)(k,e,I,B),Module._GetSysCacheHashValue=(k,e,I,B,tr)=>(Module._GetSysCacheHashValue=wasmExports.GetSysCacheHashValue)(k,e,I,B,tr),Module._get_translated_update_targetlist=(k,e,I,B)=>(Module._get_translated_update_targetlist=wasmExports.get_translated_update_targetlist)(k,e,I,B),Module._add_row_identity_var=(k,e,I,B)=>(Module._add_row_identity_var=wasmExports.add_row_identity_var)(k,e,I,B),Module._get_rel_all_updated_cols=(k,e)=>(Module._get_rel_all_updated_cols=wasmExports.get_rel_all_updated_cols)(k,e),Module._get_baserel_parampathinfo=(k,e,I)=>(Module._get_baserel_parampathinfo=wasmExports.get_baserel_parampathinfo)(k,e,I),Module._create_foreignscan_path=(k,e,I,B,tr,rr,ir,lr,dr,mr,hr)=>(Module._create_foreignscan_path=wasmExports.create_foreignscan_path)(k,e,I,B,tr,rr,ir,lr,dr,mr,hr),Module._create_foreign_join_path=(k,e,I,B,tr,rr,ir,lr,dr,mr,hr)=>(Module._create_foreign_join_path=wasmExports.create_foreign_join_path)(k,e,I,B,tr,rr,ir,lr,dr,mr,hr),Module._create_foreign_upper_path=(k,e,I,B,tr,rr,ir,lr,dr,mr)=>(Module._create_foreign_upper_path=wasmExports.create_foreign_upper_path)(k,e,I,B,tr,rr,ir,lr,dr,mr),Module._adjust_limit_rows_costs=(k,e,I,B,tr)=>(Module._adjust_limit_rows_costs=wasmExports.adjust_limit_rows_costs)(k,e,I,B,tr),Module._add_to_flat_tlist=(k,e)=>(Module._add_to_flat_tlist=wasmExports.add_to_flat_tlist)(k,e),Module._get_fn_expr_argtype=(k,e)=>(Module._get_fn_expr_argtype=wasmExports.get_fn_expr_argtype)(k,e),Module._on_shmem_exit=(k,e)=>(Module._on_shmem_exit=wasmExports.on_shmem_exit)(k,e),Module._SignalHandlerForConfigReload=k=>(Module._SignalHandlerForConfigReload=wasmExports.SignalHandlerForConfigReload)(k),Module._SignalHandlerForShutdownRequest=k=>(Module._SignalHandlerForShutdownRequest=wasmExports.SignalHandlerForShutdownRequest)(k),Module._procsignal_sigusr1_handler=k=>(Module._procsignal_sigusr1_handler=wasmExports.procsignal_sigusr1_handler)(k),Module._RegisterBackgroundWorker=k=>(Module._RegisterBackgroundWorker=wasmExports.RegisterBackgroundWorker)(k),Module._WaitForBackgroundWorkerStartup=(k,e)=>(Module._WaitForBackgroundWorkerStartup=wasmExports.WaitForBackgroundWorkerStartup)(k,e),Module._GetConfigOption=(k,e,I)=>(Module._GetConfigOption=wasmExports.GetConfigOption)(k,e,I),Module._fputc=(k,e)=>(Module._fputc=wasmExports.fputc)(k,e),Module._toupper=k=>(Module._toupper=wasmExports.toupper)(k),Module._pg_reg_getinitialstate=k=>(Module._pg_reg_getinitialstate=wasmExports.pg_reg_getinitialstate)(k),Module._pg_reg_getfinalstate=k=>(Module._pg_reg_getfinalstate=wasmExports.pg_reg_getfinalstate)(k),Module._pg_reg_getnumoutarcs=(k,e)=>(Module._pg_reg_getnumoutarcs=wasmExports.pg_reg_getnumoutarcs)(k,e),Module._pg_reg_getoutarcs=(k,e,I,B)=>(Module._pg_reg_getoutarcs=wasmExports.pg_reg_getoutarcs)(k,e,I,B),Module._pg_reg_getnumcolors=k=>(Module._pg_reg_getnumcolors=wasmExports.pg_reg_getnumcolors)(k),Module._pg_reg_colorisbegin=(k,e)=>(Module._pg_reg_colorisbegin=wasmExports.pg_reg_colorisbegin)(k,e),Module._pg_reg_colorisend=(k,e)=>(Module._pg_reg_colorisend=wasmExports.pg_reg_colorisend)(k,e),Module._pg_reg_getnumcharacters=(k,e)=>(Module._pg_reg_getnumcharacters=wasmExports.pg_reg_getnumcharacters)(k,e),Module._pg_reg_getcharacters=(k,e,I,B)=>(Module._pg_reg_getcharacters=wasmExports.pg_reg_getcharacters)(k,e,I,B),Module._OutputPluginPrepareWrite=(k,e)=>(Module._OutputPluginPrepareWrite=wasmExports.OutputPluginPrepareWrite)(k,e),Module._OutputPluginWrite=(k,e)=>(Module._OutputPluginWrite=wasmExports.OutputPluginWrite)(k,e),Module._OutputPluginUpdateProgress=(k,e)=>(Module._OutputPluginUpdateProgress=wasmExports.OutputPluginUpdateProgress)(k,e),Module._array_contains_nulls=k=>(Module._array_contains_nulls=wasmExports.array_contains_nulls)(k),Module._replorigin_by_oid=(k,e,I)=>(Module._replorigin_by_oid=wasmExports.replorigin_by_oid)(k,e,I),Module._logicalrep_write_begin=(k,e)=>(Module._logicalrep_write_begin=wasmExports.logicalrep_write_begin)(k,e),Module._logicalrep_write_commit=(k,e,I)=>(Module._logicalrep_write_commit=wasmExports.logicalrep_write_commit)(k,e,I),Module._logicalrep_write_begin_prepare=(k,e)=>(Module._logicalrep_write_begin_prepare=wasmExports.logicalrep_write_begin_prepare)(k,e),Module._logicalrep_write_prepare=(k,e,I)=>(Module._logicalrep_write_prepare=wasmExports.logicalrep_write_prepare)(k,e,I),Module._logicalrep_write_commit_prepared=(k,e,I)=>(Module._logicalrep_write_commit_prepared=wasmExports.logicalrep_write_commit_prepared)(k,e,I),Module._logicalrep_write_rollback_prepared=(k,e,I,B)=>(Module._logicalrep_write_rollback_prepared=wasmExports.logicalrep_write_rollback_prepared)(k,e,I,B),Module._logicalrep_write_stream_prepare=(k,e,I)=>(Module._logicalrep_write_stream_prepare=wasmExports.logicalrep_write_stream_prepare)(k,e,I),Module._logicalrep_write_origin=(k,e,I)=>(Module._logicalrep_write_origin=wasmExports.logicalrep_write_origin)(k,e,I),Module._logicalrep_write_insert=(k,e,I,B,tr,rr)=>(Module._logicalrep_write_insert=wasmExports.logicalrep_write_insert)(k,e,I,B,tr,rr),Module._logicalrep_write_update=(k,e,I,B,tr,rr,ir)=>(Module._logicalrep_write_update=wasmExports.logicalrep_write_update)(k,e,I,B,tr,rr,ir),Module._logicalrep_write_delete=(k,e,I,B,tr,rr)=>(Module._logicalrep_write_delete=wasmExports.logicalrep_write_delete)(k,e,I,B,tr,rr),Module._logicalrep_write_truncate=(k,e,I,B,tr,rr)=>(Module._logicalrep_write_truncate=wasmExports.logicalrep_write_truncate)(k,e,I,B,tr,rr),Module._logicalrep_write_message=(k,e,I,B,tr,rr,ir)=>(Module._logicalrep_write_message=wasmExports.logicalrep_write_message)(k,e,I,B,tr,rr,ir),Module._logicalrep_write_rel=(k,e,I,B)=>(Module._logicalrep_write_rel=wasmExports.logicalrep_write_rel)(k,e,I,B),Module._logicalrep_write_typ=(k,e,I)=>(Module._logicalrep_write_typ=wasmExports.logicalrep_write_typ)(k,e,I),Module._logicalrep_write_stream_start=(k,e,I)=>(Module._logicalrep_write_stream_start=wasmExports.logicalrep_write_stream_start)(k,e,I),Module._logicalrep_write_stream_stop=k=>(Module._logicalrep_write_stream_stop=wasmExports.logicalrep_write_stream_stop)(k),Module._logicalrep_write_stream_commit=(k,e,I)=>(Module._logicalrep_write_stream_commit=wasmExports.logicalrep_write_stream_commit)(k,e,I),Module._logicalrep_write_stream_abort=(k,e,I,B,tr,rr)=>(Module._logicalrep_write_stream_abort=wasmExports.logicalrep_write_stream_abort)(k,e,I,B,tr,rr),Module._CacheRegisterRelcacheCallback=(k,e)=>(Module._CacheRegisterRelcacheCallback=wasmExports.CacheRegisterRelcacheCallback)(k,e),Module._hash_seq_term=k=>(Module._hash_seq_term=wasmExports.hash_seq_term)(k),Module._FreeErrorData=k=>(Module._FreeErrorData=wasmExports.FreeErrorData)(k),Module._RelidByRelfilenumber=(k,e)=>(Module._RelidByRelfilenumber=wasmExports.RelidByRelfilenumber)(k,e),Module._WaitLatchOrSocket=(k,e,I,B,tr)=>(Module._WaitLatchOrSocket=wasmExports.WaitLatchOrSocket)(k,e,I,B,tr),Module._ProcessWalRcvInterrupts=()=>(Module._ProcessWalRcvInterrupts=wasmExports.ProcessWalRcvInterrupts)(),Module._get_row_security_policies=(k,e,I,B,tr,rr,ir)=>(Module._get_row_security_policies=wasmExports.get_row_security_policies)(k,e,I,B,tr,rr,ir),Module._hash_estimate_size=(k,e)=>(Module._hash_estimate_size=wasmExports.hash_estimate_size)(k,e),Module._ShmemInitHash=(k,e,I,B,tr)=>(Module._ShmemInitHash=wasmExports.ShmemInitHash)(k,e,I,B,tr),Module._LockBufHdr=k=>(Module._LockBufHdr=wasmExports.LockBufHdr)(k),Module._EvictUnpinnedBuffer=k=>(Module._EvictUnpinnedBuffer=wasmExports.EvictUnpinnedBuffer)(k),Module._have_free_buffer=()=>(Module._have_free_buffer=wasmExports.have_free_buffer)(),Module._copy_file=(k,e)=>(Module._copy_file=wasmExports.copy_file)(k,e),Module._AcquireExternalFD=()=>(Module._AcquireExternalFD=wasmExports.AcquireExternalFD)(),Module._GetNamedDSMSegment=(k,e,I,B)=>(Module._GetNamedDSMSegment=wasmExports.GetNamedDSMSegment)(k,e,I,B),Module._RequestAddinShmemSpace=k=>(Module._RequestAddinShmemSpace=wasmExports.RequestAddinShmemSpace)(k),Module._poll=(k,e,I)=>(Module._poll=wasmExports.poll)(k,e,I),Module._GetRunningTransactionData=()=>(Module._GetRunningTransactionData=wasmExports.GetRunningTransactionData)(),Module._BackendXidGetPid=k=>(Module._BackendXidGetPid=wasmExports.BackendXidGetPid)(k),Module._LWLockRegisterTranche=(k,e)=>(Module._LWLockRegisterTranche=wasmExports.LWLockRegisterTranche)(k,e),Module._GetNamedLWLockTranche=k=>(Module._GetNamedLWLockTranche=wasmExports.GetNamedLWLockTranche)(k),Module._LWLockNewTrancheId=()=>(Module._LWLockNewTrancheId=wasmExports.LWLockNewTrancheId)(),Module._RequestNamedLWLockTranche=(k,e)=>(Module._RequestNamedLWLockTranche=wasmExports.RequestNamedLWLockTranche)(k,e),Module._standard_ProcessUtility=(k,e,I,B,tr,rr,ir,lr)=>(Module._standard_ProcessUtility=wasmExports.standard_ProcessUtility)(k,e,I,B,tr,rr,ir,lr),Module._lookup_ts_dictionary_cache=k=>(Module._lookup_ts_dictionary_cache=wasmExports.lookup_ts_dictionary_cache)(k),Module._get_tsearch_config_filename=(k,e)=>(Module._get_tsearch_config_filename=wasmExports.get_tsearch_config_filename)(k,e),Module._lowerstr=k=>(Module._lowerstr=wasmExports.lowerstr)(k),Module._readstoplist=(k,e,I)=>(Module._readstoplist=wasmExports.readstoplist)(k,e,I),Module._lowerstr_with_len=(k,e)=>(Module._lowerstr_with_len=wasmExports.lowerstr_with_len)(k,e),Module._searchstoplist=(k,e)=>(Module._searchstoplist=wasmExports.searchstoplist)(k,e),Module._tsearch_readline_begin=(k,e)=>(Module._tsearch_readline_begin=wasmExports.tsearch_readline_begin)(k,e),Module._tsearch_readline=k=>(Module._tsearch_readline=wasmExports.tsearch_readline)(k),Module._t_isspace=k=>(Module._t_isspace=wasmExports.t_isspace)(k),Module._tsearch_readline_end=k=>(Module._tsearch_readline_end=wasmExports.tsearch_readline_end)(k),Module._stringToQualifiedNameList=(k,e)=>(Module._stringToQualifiedNameList=wasmExports.stringToQualifiedNameList)(k,e),Module._t_isdigit=k=>(Module._t_isdigit=wasmExports.t_isdigit)(k),Module._t_isalnum=k=>(Module._t_isalnum=wasmExports.t_isalnum)(k),Module._get_restriction_variable=(k,e,I,B,tr,rr)=>(Module._get_restriction_variable=wasmExports.get_restriction_variable)(k,e,I,B,tr,rr),Module._MemoryContextAllocHuge=(k,e)=>(Module._MemoryContextAllocHuge=wasmExports.MemoryContextAllocHuge)(k,e),Module._WaitEventExtensionNew=k=>(Module._WaitEventExtensionNew=wasmExports.WaitEventExtensionNew)(k),Module._expand_array=(k,e,I)=>(Module._expand_array=wasmExports.expand_array)(k,e,I),Module._arraycontsel=k=>(Module._arraycontsel=wasmExports.arraycontsel)(k),Module._arraycontjoinsel=k=>(Module._arraycontjoinsel=wasmExports.arraycontjoinsel)(k),Module._initArrayResult=(k,e,I)=>(Module._initArrayResult=wasmExports.initArrayResult)(k,e,I),Module._array_create_iterator=(k,e,I)=>(Module._array_create_iterator=wasmExports.array_create_iterator)(k,e,I),Module._array_iterate=(k,e,I)=>(Module._array_iterate=wasmExports.array_iterate)(k,e,I),Module._ArrayGetIntegerTypmods=(k,e)=>(Module._ArrayGetIntegerTypmods=wasmExports.ArrayGetIntegerTypmods)(k,e),Module._boolin=k=>(Module._boolin=wasmExports.boolin)(k),Module._cash_cmp=k=>(Module._cash_cmp=wasmExports.cash_cmp)(k),Module._int64_to_numeric=k=>(Module._int64_to_numeric=wasmExports.int64_to_numeric)(k),Module._numeric_div=k=>(Module._numeric_div=wasmExports.numeric_div)(k),Module._date_eq=k=>(Module._date_eq=wasmExports.date_eq)(k),Module._date_lt=k=>(Module._date_lt=wasmExports.date_lt)(k),Module._date_le=k=>(Module._date_le=wasmExports.date_le)(k),Module._date_gt=k=>(Module._date_gt=wasmExports.date_gt)(k),Module._date_ge=k=>(Module._date_ge=wasmExports.date_ge)(k),Module._date_cmp=k=>(Module._date_cmp=wasmExports.date_cmp)(k),Module._date_mi=k=>(Module._date_mi=wasmExports.date_mi)(k),Module._time_eq=k=>(Module._time_eq=wasmExports.time_eq)(k),Module._time_lt=k=>(Module._time_lt=wasmExports.time_lt)(k),Module._time_le=k=>(Module._time_le=wasmExports.time_le)(k),Module._time_gt=k=>(Module._time_gt=wasmExports.time_gt)(k),Module._time_ge=k=>(Module._time_ge=wasmExports.time_ge)(k),Module._time_cmp=k=>(Module._time_cmp=wasmExports.time_cmp)(k),Module._time_mi_time=k=>(Module._time_mi_time=wasmExports.time_mi_time)(k),Module._timetz_cmp=k=>(Module._timetz_cmp=wasmExports.timetz_cmp)(k),Module._TransferExpandedObject=(k,e)=>(Module._TransferExpandedObject=wasmExports.TransferExpandedObject)(k,e),Module._numeric_lt=k=>(Module._numeric_lt=wasmExports.numeric_lt)(k),Module._numeric_ge=k=>(Module._numeric_ge=wasmExports.numeric_ge)(k),Module._err_generic_string=(k,e)=>(Module._err_generic_string=wasmExports.err_generic_string)(k,e),Module._domain_check=(k,e,I,B,tr)=>(Module._domain_check=wasmExports.domain_check)(k,e,I,B,tr),Module._enum_lt=k=>(Module._enum_lt=wasmExports.enum_lt)(k),Module._enum_le=k=>(Module._enum_le=wasmExports.enum_le)(k),Module._enum_ge=k=>(Module._enum_ge=wasmExports.enum_ge)(k),Module._enum_gt=k=>(Module._enum_gt=wasmExports.enum_gt)(k),Module._enum_cmp=k=>(Module._enum_cmp=wasmExports.enum_cmp)(k),Module._make_expanded_record_from_typeid=(k,e,I)=>(Module._make_expanded_record_from_typeid=wasmExports.make_expanded_record_from_typeid)(k,e,I),Module._MemoryContextRegisterResetCallback=(k,e)=>(Module._MemoryContextRegisterResetCallback=wasmExports.MemoryContextRegisterResetCallback)(k,e),Module._make_expanded_record_from_tupdesc=(k,e)=>(Module._make_expanded_record_from_tupdesc=wasmExports.make_expanded_record_from_tupdesc)(k,e),Module._make_expanded_record_from_exprecord=(k,e)=>(Module._make_expanded_record_from_exprecord=wasmExports.make_expanded_record_from_exprecord)(k,e),Module._expanded_record_set_tuple=(k,e,I,B)=>(Module._expanded_record_set_tuple=wasmExports.expanded_record_set_tuple)(k,e,I,B),Module._expanded_record_get_tuple=k=>(Module._expanded_record_get_tuple=wasmExports.expanded_record_get_tuple)(k),Module._deconstruct_expanded_record=k=>(Module._deconstruct_expanded_record=wasmExports.deconstruct_expanded_record)(k),Module._expanded_record_lookup_field=(k,e,I)=>(Module._expanded_record_lookup_field=wasmExports.expanded_record_lookup_field)(k,e,I),Module._expanded_record_set_field_internal=(k,e,I,B,tr,rr)=>(Module._expanded_record_set_field_internal=wasmExports.expanded_record_set_field_internal)(k,e,I,B,tr,rr),Module._expanded_record_set_fields=(k,e,I,B)=>(Module._expanded_record_set_fields=wasmExports.expanded_record_set_fields)(k,e,I,B),Module._float4in_internal=(k,e,I,B,tr)=>(Module._float4in_internal=wasmExports.float4in_internal)(k,e,I,B,tr),Module._strtof=(k,e)=>(Module._strtof=wasmExports.strtof)(k,e),Module._float8in_internal=(k,e,I,B,tr)=>(Module._float8in_internal=wasmExports.float8in_internal)(k,e,I,B,tr),Module._float8out_internal=k=>(Module._float8out_internal=wasmExports.float8out_internal)(k),Module._btfloat4cmp=k=>(Module._btfloat4cmp=wasmExports.btfloat4cmp)(k),Module._btfloat8cmp=k=>(Module._btfloat8cmp=wasmExports.btfloat8cmp)(k),Module._log10=k=>(Module._log10=wasmExports.log10)(k),Module._acos=k=>(Module._acos=wasmExports.acos)(k),Module._asin=k=>(Module._asin=wasmExports.asin)(k),Module._cos=k=>(Module._cos=wasmExports.cos)(k),Module._fmod=(k,e)=>(Module._fmod=wasmExports.fmod)(k,e),Module._str_tolower=(k,e,I)=>(Module._str_tolower=wasmExports.str_tolower)(k,e,I),Module._pushJsonbValue=(k,e,I)=>(Module._pushJsonbValue=wasmExports.pushJsonbValue)(k,e,I),Module._numeric_float4=k=>(Module._numeric_float4=wasmExports.numeric_float4)(k),Module._numeric_cmp=k=>(Module._numeric_cmp=wasmExports.numeric_cmp)(k),Module._numeric_eq=k=>(Module._numeric_eq=wasmExports.numeric_eq)(k),Module._numeric_is_nan=k=>(Module._numeric_is_nan=wasmExports.numeric_is_nan)(k),Module._timestamp_cmp=k=>(Module._timestamp_cmp=wasmExports.timestamp_cmp)(k),Module._macaddr_cmp=k=>(Module._macaddr_cmp=wasmExports.macaddr_cmp)(k),Module._macaddr_lt=k=>(Module._macaddr_lt=wasmExports.macaddr_lt)(k),Module._macaddr_le=k=>(Module._macaddr_le=wasmExports.macaddr_le)(k),Module._macaddr_eq=k=>(Module._macaddr_eq=wasmExports.macaddr_eq)(k),Module._macaddr_ge=k=>(Module._macaddr_ge=wasmExports.macaddr_ge)(k),Module._macaddr_gt=k=>(Module._macaddr_gt=wasmExports.macaddr_gt)(k),Module._macaddr8_cmp=k=>(Module._macaddr8_cmp=wasmExports.macaddr8_cmp)(k),Module._macaddr8_lt=k=>(Module._macaddr8_lt=wasmExports.macaddr8_lt)(k),Module._macaddr8_le=k=>(Module._macaddr8_le=wasmExports.macaddr8_le)(k),Module._macaddr8_eq=k=>(Module._macaddr8_eq=wasmExports.macaddr8_eq)(k),Module._macaddr8_ge=k=>(Module._macaddr8_ge=wasmExports.macaddr8_ge)(k),Module._macaddr8_gt=k=>(Module._macaddr8_gt=wasmExports.macaddr8_gt)(k),Module._current_query=k=>(Module._current_query=wasmExports.current_query)(k),Module._unpack_sql_state=k=>(Module._unpack_sql_state=wasmExports.unpack_sql_state)(k),Module._get_fn_expr_rettype=k=>(Module._get_fn_expr_rettype=wasmExports.get_fn_expr_rettype)(k),Module._btnamecmp=k=>(Module._btnamecmp=wasmExports.btnamecmp)(k),Module._inet_in=k=>(Module._inet_in=wasmExports.inet_in)(k),Module._network_cmp=k=>(Module._network_cmp=wasmExports.network_cmp)(k),Module._convert_network_to_scalar=(k,e,I)=>(Module._convert_network_to_scalar=wasmExports.convert_network_to_scalar)(k,e,I),Module._numeric_gt=k=>(Module._numeric_gt=wasmExports.numeric_gt)(k),Module._numeric_le=k=>(Module._numeric_le=wasmExports.numeric_le)(k),Module._numeric_float8_no_overflow=k=>(Module._numeric_float8_no_overflow=wasmExports.numeric_float8_no_overflow)(k),Module._oidout=k=>(Module._oidout=wasmExports.oidout)(k),Module._interval_mi=k=>(Module._interval_mi=wasmExports.interval_mi)(k),Module._localtime=k=>(Module._localtime=wasmExports.localtime)(k),Module._quote_ident=k=>(Module._quote_ident=wasmExports.quote_ident)(k),Module._pg_wchar2mb_with_len=(k,e,I)=>(Module._pg_wchar2mb_with_len=wasmExports.pg_wchar2mb_with_len)(k,e,I),Module._pg_get_indexdef_columns_extended=(k,e)=>(Module._pg_get_indexdef_columns_extended=wasmExports.pg_get_indexdef_columns_extended)(k,e),Module._pg_get_querydef=(k,e)=>(Module._pg_get_querydef=wasmExports.pg_get_querydef)(k,e),Module._strcspn=(k,e)=>(Module._strcspn=wasmExports.strcspn)(k,e),Module._generic_restriction_selectivity=(k,e,I,B,tr,rr)=>(Module._generic_restriction_selectivity=wasmExports.generic_restriction_selectivity)(k,e,I,B,tr,rr),Module._genericcostestimate=(k,e,I,B)=>(Module._genericcostestimate=wasmExports.genericcostestimate)(k,e,I,B),Module._tidin=k=>(Module._tidin=wasmExports.tidin)(k),Module._tidout=k=>(Module._tidout=wasmExports.tidout)(k),Module._timestamp_in=k=>(Module._timestamp_in=wasmExports.timestamp_in)(k),Module._timestamp_eq=k=>(Module._timestamp_eq=wasmExports.timestamp_eq)(k),Module._timestamp_lt=k=>(Module._timestamp_lt=wasmExports.timestamp_lt)(k),Module._timestamp_gt=k=>(Module._timestamp_gt=wasmExports.timestamp_gt)(k),Module._timestamp_le=k=>(Module._timestamp_le=wasmExports.timestamp_le)(k),Module._timestamp_ge=k=>(Module._timestamp_ge=wasmExports.timestamp_ge)(k),Module._interval_eq=k=>(Module._interval_eq=wasmExports.interval_eq)(k),Module._interval_lt=k=>(Module._interval_lt=wasmExports.interval_lt)(k),Module._interval_gt=k=>(Module._interval_gt=wasmExports.interval_gt)(k),Module._interval_le=k=>(Module._interval_le=wasmExports.interval_le)(k),Module._interval_ge=k=>(Module._interval_ge=wasmExports.interval_ge)(k),Module._interval_cmp=k=>(Module._interval_cmp=wasmExports.interval_cmp)(k),Module._timestamp_mi=k=>(Module._timestamp_mi=wasmExports.timestamp_mi)(k),Module._interval_um=k=>(Module._interval_um=wasmExports.interval_um)(k),Module._has_fn_opclass_options=k=>(Module._has_fn_opclass_options=wasmExports.has_fn_opclass_options)(k),Module._uuid_in=k=>(Module._uuid_in=wasmExports.uuid_in)(k),Module._uuid_out=k=>(Module._uuid_out=wasmExports.uuid_out)(k),Module._uuid_cmp=k=>(Module._uuid_cmp=wasmExports.uuid_cmp)(k),Module._gen_random_uuid=k=>(Module._gen_random_uuid=wasmExports.gen_random_uuid)(k),Module._varbit_in=k=>(Module._varbit_in=wasmExports.varbit_in)(k),Module._biteq=k=>(Module._biteq=wasmExports.biteq)(k),Module._bitlt=k=>(Module._bitlt=wasmExports.bitlt)(k),Module._bitle=k=>(Module._bitle=wasmExports.bitle)(k),Module._bitgt=k=>(Module._bitgt=wasmExports.bitgt)(k),Module._bitge=k=>(Module._bitge=wasmExports.bitge)(k),Module._bitcmp=k=>(Module._bitcmp=wasmExports.bitcmp)(k),Module._bpchareq=k=>(Module._bpchareq=wasmExports.bpchareq)(k),Module._bpcharlt=k=>(Module._bpcharlt=wasmExports.bpcharlt)(k),Module._bpcharle=k=>(Module._bpcharle=wasmExports.bpcharle)(k),Module._bpchargt=k=>(Module._bpchargt=wasmExports.bpchargt)(k),Module._bpcharge=k=>(Module._bpcharge=wasmExports.bpcharge)(k),Module._bpcharcmp=k=>(Module._bpcharcmp=wasmExports.bpcharcmp)(k),Module._texteq=k=>(Module._texteq=wasmExports.texteq)(k),Module._text_lt=k=>(Module._text_lt=wasmExports.text_lt)(k),Module._text_le=k=>(Module._text_le=wasmExports.text_le)(k),Module._text_gt=k=>(Module._text_gt=wasmExports.text_gt)(k),Module._text_ge=k=>(Module._text_ge=wasmExports.text_ge)(k),Module._bttextcmp=k=>(Module._bttextcmp=wasmExports.bttextcmp)(k),Module._byteaeq=k=>(Module._byteaeq=wasmExports.byteaeq)(k),Module._bytealt=k=>(Module._bytealt=wasmExports.bytealt)(k),Module._byteale=k=>(Module._byteale=wasmExports.byteale)(k),Module._byteagt=k=>(Module._byteagt=wasmExports.byteagt)(k),Module._byteage=k=>(Module._byteage=wasmExports.byteage)(k),Module._byteacmp=k=>(Module._byteacmp=wasmExports.byteacmp)(k),Module._to_hex32=k=>(Module._to_hex32=wasmExports.to_hex32)(k),Module._varstr_levenshtein=(k,e,I,B,tr,rr,ir,lr)=>(Module._varstr_levenshtein=wasmExports.varstr_levenshtein)(k,e,I,B,tr,rr,ir,lr),Module._pg_xml_init=k=>(Module._pg_xml_init=wasmExports.pg_xml_init)(k),Module._xmlInitParser=()=>(Module._xmlInitParser=wasmExports.xmlInitParser)(),Module._xml_ereport=(k,e,I,B)=>(Module._xml_ereport=wasmExports.xml_ereport)(k,e,I,B),Module._pg_xml_done=(k,e)=>(Module._pg_xml_done=wasmExports.pg_xml_done)(k,e),Module._xmlXPathNewContext=k=>(Module._xmlXPathNewContext=wasmExports.xmlXPathNewContext)(k),Module._xmlXPathFreeContext=k=>(Module._xmlXPathFreeContext=wasmExports.xmlXPathFreeContext)(k),Module._xmlFreeDoc=k=>(Module._xmlFreeDoc=wasmExports.xmlFreeDoc)(k),Module._xmlXPathCtxtCompile=(k,e)=>(Module._xmlXPathCtxtCompile=wasmExports.xmlXPathCtxtCompile)(k,e),Module._xmlXPathCompiledEval=(k,e)=>(Module._xmlXPathCompiledEval=wasmExports.xmlXPathCompiledEval)(k,e),Module._xmlXPathFreeCompExpr=k=>(Module._xmlXPathFreeCompExpr=wasmExports.xmlXPathFreeCompExpr)(k),Module._pg_do_encoding_conversion=(k,e,I,B)=>(Module._pg_do_encoding_conversion=wasmExports.pg_do_encoding_conversion)(k,e,I,B),Module._xmlStrdup=k=>(Module._xmlStrdup=wasmExports.xmlStrdup)(k),Module._xmlXPathCastNodeToString=k=>(Module._xmlXPathCastNodeToString=wasmExports.xmlXPathCastNodeToString)(k),Module._get_typsubscript=(k,e)=>(Module._get_typsubscript=wasmExports.get_typsubscript)(k,e),Module._CachedPlanAllowsSimpleValidityCheck=(k,e,I)=>(Module._CachedPlanAllowsSimpleValidityCheck=wasmExports.CachedPlanAllowsSimpleValidityCheck)(k,e,I),Module._CachedPlanIsSimplyValid=(k,e,I)=>(Module._CachedPlanIsSimplyValid=wasmExports.CachedPlanIsSimplyValid)(k,e,I),Module._GetCachedExpression=k=>(Module._GetCachedExpression=wasmExports.GetCachedExpression)(k),Module._FreeCachedExpression=k=>(Module._FreeCachedExpression=wasmExports.FreeCachedExpression)(k),Module._ReleaseAllPlanCacheRefsInOwner=k=>(Module._ReleaseAllPlanCacheRefsInOwner=wasmExports.ReleaseAllPlanCacheRefsInOwner)(k),Module._in_error_recursion_trouble=()=>(Module._in_error_recursion_trouble=wasmExports.in_error_recursion_trouble)(),Module._GetErrorContextStack=()=>(Module._GetErrorContextStack=wasmExports.GetErrorContextStack)(),Module._dlsym=(k,e)=>(Module._dlsym=wasmExports.dlsym)(k,e),Module._dlopen=(k,e)=>(Module._dlopen=wasmExports.dlopen)(k,e),Module._dlerror=()=>(Module._dlerror=wasmExports.dlerror)(),Module._dlclose=k=>(Module._dlclose=wasmExports.dlclose)(k),Module._find_rendezvous_variable=k=>(Module._find_rendezvous_variable=wasmExports.find_rendezvous_variable)(k),Module._CallerFInfoFunctionCall2=(k,e,I,B,tr)=>(Module._CallerFInfoFunctionCall2=wasmExports.CallerFInfoFunctionCall2)(k,e,I,B,tr),Module._FunctionCall0Coll=(k,e)=>(Module._FunctionCall0Coll=wasmExports.FunctionCall0Coll)(k,e),Module._resolve_polymorphic_argtypes=(k,e,I,B)=>(Module._resolve_polymorphic_argtypes=wasmExports.resolve_polymorphic_argtypes)(k,e,I,B),Module._memcpy=(k,e,I)=>(Module._memcpy=wasmExports.memcpy)(k,e,I),Module._pg_bindtextdomain=k=>(Module._pg_bindtextdomain=wasmExports.pg_bindtextdomain)(k),Module._local2local=(k,e,I,B,tr,rr,ir)=>(Module._local2local=wasmExports.local2local)(k,e,I,B,tr,rr,ir),Module._report_untranslatable_char=(k,e,I,B)=>(Module._report_untranslatable_char=wasmExports.report_untranslatable_char)(k,e,I,B),Module._latin2mic=(k,e,I,B,tr,rr)=>(Module._latin2mic=wasmExports.latin2mic)(k,e,I,B,tr,rr),Module._mic2latin=(k,e,I,B,tr,rr)=>(Module._mic2latin=wasmExports.mic2latin)(k,e,I,B,tr,rr),Module._latin2mic_with_table=(k,e,I,B,tr,rr,ir)=>(Module._latin2mic_with_table=wasmExports.latin2mic_with_table)(k,e,I,B,tr,rr,ir),Module._mic2latin_with_table=(k,e,I,B,tr,rr,ir)=>(Module._mic2latin_with_table=wasmExports.mic2latin_with_table)(k,e,I,B,tr,rr,ir),Module._UtfToLocal=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._UtfToLocal=wasmExports.UtfToLocal)(k,e,I,B,tr,rr,ir,lr,dr),Module._LocalToUtf=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._LocalToUtf=wasmExports.LocalToUtf)(k,e,I,B,tr,rr,ir,lr,dr),Module._check_encoding_conversion_args=(k,e,I,B,tr)=>(Module._check_encoding_conversion_args=wasmExports.check_encoding_conversion_args)(k,e,I,B,tr),Module._DefineCustomBoolVariable=(k,e,I,B,tr,rr,ir,lr,dr,mr)=>(Module._DefineCustomBoolVariable=wasmExports.DefineCustomBoolVariable)(k,e,I,B,tr,rr,ir,lr,dr,mr),Module._DefineCustomIntVariable=(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr)=>(Module._DefineCustomIntVariable=wasmExports.DefineCustomIntVariable)(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr),Module._DefineCustomRealVariable=(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr)=>(Module._DefineCustomRealVariable=wasmExports.DefineCustomRealVariable)(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr),Module._DefineCustomStringVariable=(k,e,I,B,tr,rr,ir,lr,dr,mr)=>(Module._DefineCustomStringVariable=wasmExports.DefineCustomStringVariable)(k,e,I,B,tr,rr,ir,lr,dr,mr),Module._DefineCustomEnumVariable=(k,e,I,B,tr,rr,ir,lr,dr,mr,hr)=>(Module._DefineCustomEnumVariable=wasmExports.DefineCustomEnumVariable)(k,e,I,B,tr,rr,ir,lr,dr,mr,hr),Module._MarkGUCPrefixReserved=k=>(Module._MarkGUCPrefixReserved=wasmExports.MarkGUCPrefixReserved)(k),Module._sampler_random_init_state=(k,e)=>(Module._sampler_random_init_state=wasmExports.sampler_random_init_state)(k,e),Module._pchomp=k=>(Module._pchomp=wasmExports.pchomp)(k),Module._PinPortal=k=>(Module._PinPortal=wasmExports.PinPortal)(k),Module._UnpinPortal=k=>(Module._UnpinPortal=wasmExports.UnpinPortal)(k),Module._isolat1ToUTF8=(k,e,I,B)=>(Module._isolat1ToUTF8=wasmExports.isolat1ToUTF8)(k,e,I,B),Module._UTF8Toisolat1=(k,e,I,B)=>(Module._UTF8Toisolat1=wasmExports.UTF8Toisolat1)(k,e,I,B),Module._vfprintf=(k,e,I)=>(Module._vfprintf=wasmExports.vfprintf)(k,e,I),Module._vsnprintf=(k,e,I,B)=>(Module._vsnprintf=wasmExports.vsnprintf)(k,e,I,B),Module._xmlParserValidityWarning=(k,e,I)=>(Module._xmlParserValidityWarning=wasmExports.xmlParserValidityWarning)(k,e,I),Module._xmlParserValidityError=(k,e,I)=>(Module._xmlParserValidityError=wasmExports.xmlParserValidityError)(k,e,I),Module._xmlParserError=(k,e,I)=>(Module._xmlParserError=wasmExports.xmlParserError)(k,e,I),Module._xmlParserWarning=(k,e,I)=>(Module._xmlParserWarning=wasmExports.xmlParserWarning)(k,e,I),Module._fprintf=(k,e,I)=>(Module._fprintf=wasmExports.fprintf)(k,e,I),Module.___xmlParserInputBufferCreateFilename=(k,e)=>(Module.___xmlParserInputBufferCreateFilename=wasmExports.__xmlParserInputBufferCreateFilename)(k,e),Module.___xmlOutputBufferCreateFilename=(k,e,I)=>(Module.___xmlOutputBufferCreateFilename=wasmExports.__xmlOutputBufferCreateFilename)(k,e,I),Module._xmlSAX2InternalSubset=(k,e,I,B)=>(Module._xmlSAX2InternalSubset=wasmExports.xmlSAX2InternalSubset)(k,e,I,B),Module._xmlSAX2IsStandalone=k=>(Module._xmlSAX2IsStandalone=wasmExports.xmlSAX2IsStandalone)(k),Module._xmlSAX2HasInternalSubset=k=>(Module._xmlSAX2HasInternalSubset=wasmExports.xmlSAX2HasInternalSubset)(k),Module._xmlSAX2HasExternalSubset=k=>(Module._xmlSAX2HasExternalSubset=wasmExports.xmlSAX2HasExternalSubset)(k),Module._xmlSAX2ResolveEntity=(k,e,I)=>(Module._xmlSAX2ResolveEntity=wasmExports.xmlSAX2ResolveEntity)(k,e,I),Module._xmlSAX2GetEntity=(k,e)=>(Module._xmlSAX2GetEntity=wasmExports.xmlSAX2GetEntity)(k,e),Module._xmlSAX2EntityDecl=(k,e,I,B,tr,rr)=>(Module._xmlSAX2EntityDecl=wasmExports.xmlSAX2EntityDecl)(k,e,I,B,tr,rr),Module._xmlSAX2NotationDecl=(k,e,I,B)=>(Module._xmlSAX2NotationDecl=wasmExports.xmlSAX2NotationDecl)(k,e,I,B),Module._xmlSAX2AttributeDecl=(k,e,I,B,tr,rr,ir)=>(Module._xmlSAX2AttributeDecl=wasmExports.xmlSAX2AttributeDecl)(k,e,I,B,tr,rr,ir),Module._xmlSAX2ElementDecl=(k,e,I,B)=>(Module._xmlSAX2ElementDecl=wasmExports.xmlSAX2ElementDecl)(k,e,I,B),Module._xmlSAX2UnparsedEntityDecl=(k,e,I,B,tr)=>(Module._xmlSAX2UnparsedEntityDecl=wasmExports.xmlSAX2UnparsedEntityDecl)(k,e,I,B,tr),Module._xmlSAX2SetDocumentLocator=(k,e)=>(Module._xmlSAX2SetDocumentLocator=wasmExports.xmlSAX2SetDocumentLocator)(k,e),Module._xmlSAX2StartDocument=k=>(Module._xmlSAX2StartDocument=wasmExports.xmlSAX2StartDocument)(k),Module._xmlSAX2EndDocument=k=>(Module._xmlSAX2EndDocument=wasmExports.xmlSAX2EndDocument)(k),Module._xmlSAX2StartElement=(k,e,I)=>(Module._xmlSAX2StartElement=wasmExports.xmlSAX2StartElement)(k,e,I),Module._xmlSAX2EndElement=(k,e)=>(Module._xmlSAX2EndElement=wasmExports.xmlSAX2EndElement)(k,e),Module._xmlSAX2Reference=(k,e)=>(Module._xmlSAX2Reference=wasmExports.xmlSAX2Reference)(k,e),Module._xmlSAX2Characters=(k,e,I)=>(Module._xmlSAX2Characters=wasmExports.xmlSAX2Characters)(k,e,I),Module._xmlSAX2ProcessingInstruction=(k,e,I)=>(Module._xmlSAX2ProcessingInstruction=wasmExports.xmlSAX2ProcessingInstruction)(k,e,I),Module._xmlSAX2Comment=(k,e)=>(Module._xmlSAX2Comment=wasmExports.xmlSAX2Comment)(k,e),Module._xmlSAX2GetParameterEntity=(k,e)=>(Module._xmlSAX2GetParameterEntity=wasmExports.xmlSAX2GetParameterEntity)(k,e),Module._xmlSAX2CDataBlock=(k,e,I)=>(Module._xmlSAX2CDataBlock=wasmExports.xmlSAX2CDataBlock)(k,e,I),Module._xmlSAX2ExternalSubset=(k,e,I,B)=>(Module._xmlSAX2ExternalSubset=wasmExports.xmlSAX2ExternalSubset)(k,e,I,B),Module._xmlSAX2GetPublicId=k=>(Module._xmlSAX2GetPublicId=wasmExports.xmlSAX2GetPublicId)(k),Module._xmlSAX2GetSystemId=k=>(Module._xmlSAX2GetSystemId=wasmExports.xmlSAX2GetSystemId)(k),Module._xmlSAX2GetLineNumber=k=>(Module._xmlSAX2GetLineNumber=wasmExports.xmlSAX2GetLineNumber)(k),Module._xmlSAX2GetColumnNumber=k=>(Module._xmlSAX2GetColumnNumber=wasmExports.xmlSAX2GetColumnNumber)(k),Module._xmlSAX2IgnorableWhitespace=(k,e,I)=>(Module._xmlSAX2IgnorableWhitespace=wasmExports.xmlSAX2IgnorableWhitespace)(k,e,I),Module._xmlHashDefaultDeallocator=(k,e)=>(Module._xmlHashDefaultDeallocator=wasmExports.xmlHashDefaultDeallocator)(k,e),Module._iconv_open=(k,e)=>(Module._iconv_open=wasmExports.iconv_open)(k,e),Module._iconv_close=k=>(Module._iconv_close=wasmExports.iconv_close)(k),Module._iconv=(k,e,I,B,tr)=>(Module._iconv=wasmExports.iconv)(k,e,I,B,tr),Module._UTF8ToHtml=(k,e,I,B)=>(Module._UTF8ToHtml=wasmExports.UTF8ToHtml)(k,e,I,B),Module._xmlReadMemory=(k,e,I,B,tr)=>(Module._xmlReadMemory=wasmExports.xmlReadMemory)(k,e,I,B,tr),Module._xmlSAX2StartElementNs=(k,e,I,B,tr,rr,ir,lr,dr)=>(Module._xmlSAX2StartElementNs=wasmExports.xmlSAX2StartElementNs)(k,e,I,B,tr,rr,ir,lr,dr),Module._xmlSAX2EndElementNs=(k,e,I,B)=>(Module._xmlSAX2EndElementNs=wasmExports.xmlSAX2EndElementNs)(k,e,I,B),Module.___cxa_atexit=(k,e,I)=>(Module.___cxa_atexit=wasmExports.__cxa_atexit)(k,e,I),Module._xmlDocGetRootElement=k=>(Module._xmlDocGetRootElement=wasmExports.xmlDocGetRootElement)(k),Module._xmlFileMatch=k=>(Module._xmlFileMatch=wasmExports.xmlFileMatch)(k),Module._xmlFileOpen=k=>(Module._xmlFileOpen=wasmExports.xmlFileOpen)(k),Module._xmlFileRead=(k,e,I)=>(Module._xmlFileRead=wasmExports.xmlFileRead)(k,e,I),Module._xmlFileClose=k=>(Module._xmlFileClose=wasmExports.xmlFileClose)(k),Module._gzread=(k,e,I)=>(Module._gzread=wasmExports.gzread)(k,e,I),Module._gzclose=k=>(Module._gzclose=wasmExports.gzclose)(k),Module._gzdirect=k=>(Module._gzdirect=wasmExports.gzdirect)(k),Module._gzdopen=(k,e)=>(Module._gzdopen=wasmExports.gzdopen)(k,e),Module._gzopen=(k,e)=>(Module._gzopen=wasmExports.gzopen)(k,e),Module._gzwrite=(k,e,I)=>(Module._gzwrite=wasmExports.gzwrite)(k,e,I),Module._xmlUCSIsCatNd=k=>(Module._xmlUCSIsCatNd=wasmExports.xmlUCSIsCatNd)(k),Module._xmlUCSIsCatP=k=>(Module._xmlUCSIsCatP=wasmExports.xmlUCSIsCatP)(k),Module._xmlUCSIsCatZ=k=>(Module._xmlUCSIsCatZ=wasmExports.xmlUCSIsCatZ)(k),Module._xmlUCSIsCatC=k=>(Module._xmlUCSIsCatC=wasmExports.xmlUCSIsCatC)(k),Module._xmlUCSIsCatL=k=>(Module._xmlUCSIsCatL=wasmExports.xmlUCSIsCatL)(k),Module._xmlUCSIsCatLu=k=>(Module._xmlUCSIsCatLu=wasmExports.xmlUCSIsCatLu)(k),Module._xmlUCSIsCatLl=k=>(Module._xmlUCSIsCatLl=wasmExports.xmlUCSIsCatLl)(k),Module._xmlUCSIsCatLt=k=>(Module._xmlUCSIsCatLt=wasmExports.xmlUCSIsCatLt)(k),Module._xmlUCSIsCatLm=k=>(Module._xmlUCSIsCatLm=wasmExports.xmlUCSIsCatLm)(k),Module._xmlUCSIsCatLo=k=>(Module._xmlUCSIsCatLo=wasmExports.xmlUCSIsCatLo)(k),Module._xmlUCSIsCatM=k=>(Module._xmlUCSIsCatM=wasmExports.xmlUCSIsCatM)(k),Module._xmlUCSIsCatMn=k=>(Module._xmlUCSIsCatMn=wasmExports.xmlUCSIsCatMn)(k),Module._xmlUCSIsCatMc=k=>(Module._xmlUCSIsCatMc=wasmExports.xmlUCSIsCatMc)(k),Module._xmlUCSIsCatMe=k=>(Module._xmlUCSIsCatMe=wasmExports.xmlUCSIsCatMe)(k),Module._xmlUCSIsCatN=k=>(Module._xmlUCSIsCatN=wasmExports.xmlUCSIsCatN)(k),Module._xmlUCSIsCatNl=k=>(Module._xmlUCSIsCatNl=wasmExports.xmlUCSIsCatNl)(k),Module._xmlUCSIsCatNo=k=>(Module._xmlUCSIsCatNo=wasmExports.xmlUCSIsCatNo)(k),Module._xmlUCSIsCatPc=k=>(Module._xmlUCSIsCatPc=wasmExports.xmlUCSIsCatPc)(k),Module._xmlUCSIsCatPd=k=>(Module._xmlUCSIsCatPd=wasmExports.xmlUCSIsCatPd)(k),Module._xmlUCSIsCatPs=k=>(Module._xmlUCSIsCatPs=wasmExports.xmlUCSIsCatPs)(k),Module._xmlUCSIsCatPe=k=>(Module._xmlUCSIsCatPe=wasmExports.xmlUCSIsCatPe)(k),Module._xmlUCSIsCatPi=k=>(Module._xmlUCSIsCatPi=wasmExports.xmlUCSIsCatPi)(k),Module._xmlUCSIsCatPf=k=>(Module._xmlUCSIsCatPf=wasmExports.xmlUCSIsCatPf)(k),Module._xmlUCSIsCatPo=k=>(Module._xmlUCSIsCatPo=wasmExports.xmlUCSIsCatPo)(k),Module._xmlUCSIsCatZs=k=>(Module._xmlUCSIsCatZs=wasmExports.xmlUCSIsCatZs)(k),Module._xmlUCSIsCatZl=k=>(Module._xmlUCSIsCatZl=wasmExports.xmlUCSIsCatZl)(k),Module._xmlUCSIsCatZp=k=>(Module._xmlUCSIsCatZp=wasmExports.xmlUCSIsCatZp)(k),Module._xmlUCSIsCatS=k=>(Module._xmlUCSIsCatS=wasmExports.xmlUCSIsCatS)(k),Module._xmlUCSIsCatSm=k=>(Module._xmlUCSIsCatSm=wasmExports.xmlUCSIsCatSm)(k),Module._xmlUCSIsCatSc=k=>(Module._xmlUCSIsCatSc=wasmExports.xmlUCSIsCatSc)(k),Module._xmlUCSIsCatSk=k=>(Module._xmlUCSIsCatSk=wasmExports.xmlUCSIsCatSk)(k),Module._xmlUCSIsCatSo=k=>(Module._xmlUCSIsCatSo=wasmExports.xmlUCSIsCatSo)(k),Module._xmlUCSIsCatCc=k=>(Module._xmlUCSIsCatCc=wasmExports.xmlUCSIsCatCc)(k),Module._xmlUCSIsCatCf=k=>(Module._xmlUCSIsCatCf=wasmExports.xmlUCSIsCatCf)(k),Module._xmlUCSIsCatCo=k=>(Module._xmlUCSIsCatCo=wasmExports.xmlUCSIsCatCo)(k),Module._xmlUCSIsAegeanNumbers=k=>(Module._xmlUCSIsAegeanNumbers=wasmExports.xmlUCSIsAegeanNumbers)(k),Module._xmlUCSIsAlphabeticPresentationForms=k=>(Module._xmlUCSIsAlphabeticPresentationForms=wasmExports.xmlUCSIsAlphabeticPresentationForms)(k),Module._xmlUCSIsArabic=k=>(Module._xmlUCSIsArabic=wasmExports.xmlUCSIsArabic)(k),Module._xmlUCSIsArabicPresentationFormsA=k=>(Module._xmlUCSIsArabicPresentationFormsA=wasmExports.xmlUCSIsArabicPresentationFormsA)(k),Module._xmlUCSIsArabicPresentationFormsB=k=>(Module._xmlUCSIsArabicPresentationFormsB=wasmExports.xmlUCSIsArabicPresentationFormsB)(k),Module._xmlUCSIsArmenian=k=>(Module._xmlUCSIsArmenian=wasmExports.xmlUCSIsArmenian)(k),Module._xmlUCSIsArrows=k=>(Module._xmlUCSIsArrows=wasmExports.xmlUCSIsArrows)(k),Module._xmlUCSIsBasicLatin=k=>(Module._xmlUCSIsBasicLatin=wasmExports.xmlUCSIsBasicLatin)(k),Module._xmlUCSIsBengali=k=>(Module._xmlUCSIsBengali=wasmExports.xmlUCSIsBengali)(k),Module._xmlUCSIsBlockElements=k=>(Module._xmlUCSIsBlockElements=wasmExports.xmlUCSIsBlockElements)(k),Module._xmlUCSIsBopomofo=k=>(Module._xmlUCSIsBopomofo=wasmExports.xmlUCSIsBopomofo)(k),Module._xmlUCSIsBopomofoExtended=k=>(Module._xmlUCSIsBopomofoExtended=wasmExports.xmlUCSIsBopomofoExtended)(k),Module._xmlUCSIsBoxDrawing=k=>(Module._xmlUCSIsBoxDrawing=wasmExports.xmlUCSIsBoxDrawing)(k),Module._xmlUCSIsBraillePatterns=k=>(Module._xmlUCSIsBraillePatterns=wasmExports.xmlUCSIsBraillePatterns)(k),Module._xmlUCSIsBuhid=k=>(Module._xmlUCSIsBuhid=wasmExports.xmlUCSIsBuhid)(k),Module._xmlUCSIsByzantineMusicalSymbols=k=>(Module._xmlUCSIsByzantineMusicalSymbols=wasmExports.xmlUCSIsByzantineMusicalSymbols)(k),Module._xmlUCSIsCJKCompatibility=k=>(Module._xmlUCSIsCJKCompatibility=wasmExports.xmlUCSIsCJKCompatibility)(k),Module._xmlUCSIsCJKCompatibilityForms=k=>(Module._xmlUCSIsCJKCompatibilityForms=wasmExports.xmlUCSIsCJKCompatibilityForms)(k),Module._xmlUCSIsCJKCompatibilityIdeographs=k=>(Module._xmlUCSIsCJKCompatibilityIdeographs=wasmExports.xmlUCSIsCJKCompatibilityIdeographs)(k),Module._xmlUCSIsCJKCompatibilityIdeographsSupplement=k=>(Module._xmlUCSIsCJKCompatibilityIdeographsSupplement=wasmExports.xmlUCSIsCJKCompatibilityIdeographsSupplement)(k),Module._xmlUCSIsCJKRadicalsSupplement=k=>(Module._xmlUCSIsCJKRadicalsSupplement=wasmExports.xmlUCSIsCJKRadicalsSupplement)(k),Module._xmlUCSIsCJKSymbolsandPunctuation=k=>(Module._xmlUCSIsCJKSymbolsandPunctuation=wasmExports.xmlUCSIsCJKSymbolsandPunctuation)(k),Module._xmlUCSIsCJKUnifiedIdeographs=k=>(Module._xmlUCSIsCJKUnifiedIdeographs=wasmExports.xmlUCSIsCJKUnifiedIdeographs)(k),Module._xmlUCSIsCJKUnifiedIdeographsExtensionA=k=>(Module._xmlUCSIsCJKUnifiedIdeographsExtensionA=wasmExports.xmlUCSIsCJKUnifiedIdeographsExtensionA)(k),Module._xmlUCSIsCJKUnifiedIdeographsExtensionB=k=>(Module._xmlUCSIsCJKUnifiedIdeographsExtensionB=wasmExports.xmlUCSIsCJKUnifiedIdeographsExtensionB)(k),Module._xmlUCSIsCherokee=k=>(Module._xmlUCSIsCherokee=wasmExports.xmlUCSIsCherokee)(k),Module._xmlUCSIsCombiningDiacriticalMarks=k=>(Module._xmlUCSIsCombiningDiacriticalMarks=wasmExports.xmlUCSIsCombiningDiacriticalMarks)(k),Module._xmlUCSIsCombiningDiacriticalMarksforSymbols=k=>(Module._xmlUCSIsCombiningDiacriticalMarksforSymbols=wasmExports.xmlUCSIsCombiningDiacriticalMarksforSymbols)(k),Module._xmlUCSIsCombiningHalfMarks=k=>(Module._xmlUCSIsCombiningHalfMarks=wasmExports.xmlUCSIsCombiningHalfMarks)(k),Module._xmlUCSIsCombiningMarksforSymbols=k=>(Module._xmlUCSIsCombiningMarksforSymbols=wasmExports.xmlUCSIsCombiningMarksforSymbols)(k),Module._xmlUCSIsControlPictures=k=>(Module._xmlUCSIsControlPictures=wasmExports.xmlUCSIsControlPictures)(k),Module._xmlUCSIsCurrencySymbols=k=>(Module._xmlUCSIsCurrencySymbols=wasmExports.xmlUCSIsCurrencySymbols)(k),Module._xmlUCSIsCypriotSyllabary=k=>(Module._xmlUCSIsCypriotSyllabary=wasmExports.xmlUCSIsCypriotSyllabary)(k),Module._xmlUCSIsCyrillic=k=>(Module._xmlUCSIsCyrillic=wasmExports.xmlUCSIsCyrillic)(k),Module._xmlUCSIsCyrillicSupplement=k=>(Module._xmlUCSIsCyrillicSupplement=wasmExports.xmlUCSIsCyrillicSupplement)(k),Module._xmlUCSIsDeseret=k=>(Module._xmlUCSIsDeseret=wasmExports.xmlUCSIsDeseret)(k),Module._xmlUCSIsDevanagari=k=>(Module._xmlUCSIsDevanagari=wasmExports.xmlUCSIsDevanagari)(k),Module._xmlUCSIsDingbats=k=>(Module._xmlUCSIsDingbats=wasmExports.xmlUCSIsDingbats)(k),Module._xmlUCSIsEnclosedAlphanumerics=k=>(Module._xmlUCSIsEnclosedAlphanumerics=wasmExports.xmlUCSIsEnclosedAlphanumerics)(k),Module._xmlUCSIsEnclosedCJKLettersandMonths=k=>(Module._xmlUCSIsEnclosedCJKLettersandMonths=wasmExports.xmlUCSIsEnclosedCJKLettersandMonths)(k),Module._xmlUCSIsEthiopic=k=>(Module._xmlUCSIsEthiopic=wasmExports.xmlUCSIsEthiopic)(k),Module._xmlUCSIsGeneralPunctuation=k=>(Module._xmlUCSIsGeneralPunctuation=wasmExports.xmlUCSIsGeneralPunctuation)(k),Module._xmlUCSIsGeometricShapes=k=>(Module._xmlUCSIsGeometricShapes=wasmExports.xmlUCSIsGeometricShapes)(k),Module._xmlUCSIsGeorgian=k=>(Module._xmlUCSIsGeorgian=wasmExports.xmlUCSIsGeorgian)(k),Module._xmlUCSIsGothic=k=>(Module._xmlUCSIsGothic=wasmExports.xmlUCSIsGothic)(k),Module._xmlUCSIsGreek=k=>(Module._xmlUCSIsGreek=wasmExports.xmlUCSIsGreek)(k),Module._xmlUCSIsGreekExtended=k=>(Module._xmlUCSIsGreekExtended=wasmExports.xmlUCSIsGreekExtended)(k),Module._xmlUCSIsGreekandCoptic=k=>(Module._xmlUCSIsGreekandCoptic=wasmExports.xmlUCSIsGreekandCoptic)(k),Module._xmlUCSIsGujarati=k=>(Module._xmlUCSIsGujarati=wasmExports.xmlUCSIsGujarati)(k),Module._xmlUCSIsGurmukhi=k=>(Module._xmlUCSIsGurmukhi=wasmExports.xmlUCSIsGurmukhi)(k),Module._xmlUCSIsHalfwidthandFullwidthForms=k=>(Module._xmlUCSIsHalfwidthandFullwidthForms=wasmExports.xmlUCSIsHalfwidthandFullwidthForms)(k),Module._xmlUCSIsHangulCompatibilityJamo=k=>(Module._xmlUCSIsHangulCompatibilityJamo=wasmExports.xmlUCSIsHangulCompatibilityJamo)(k),Module._xmlUCSIsHangulJamo=k=>(Module._xmlUCSIsHangulJamo=wasmExports.xmlUCSIsHangulJamo)(k),Module._xmlUCSIsHangulSyllables=k=>(Module._xmlUCSIsHangulSyllables=wasmExports.xmlUCSIsHangulSyllables)(k),Module._xmlUCSIsHanunoo=k=>(Module._xmlUCSIsHanunoo=wasmExports.xmlUCSIsHanunoo)(k),Module._xmlUCSIsHebrew=k=>(Module._xmlUCSIsHebrew=wasmExports.xmlUCSIsHebrew)(k),Module._xmlUCSIsHighPrivateUseSurrogates=k=>(Module._xmlUCSIsHighPrivateUseSurrogates=wasmExports.xmlUCSIsHighPrivateUseSurrogates)(k),Module._xmlUCSIsHighSurrogates=k=>(Module._xmlUCSIsHighSurrogates=wasmExports.xmlUCSIsHighSurrogates)(k),Module._xmlUCSIsHiragana=k=>(Module._xmlUCSIsHiragana=wasmExports.xmlUCSIsHiragana)(k),Module._xmlUCSIsIPAExtensions=k=>(Module._xmlUCSIsIPAExtensions=wasmExports.xmlUCSIsIPAExtensions)(k),Module._xmlUCSIsIdeographicDescriptionCharacters=k=>(Module._xmlUCSIsIdeographicDescriptionCharacters=wasmExports.xmlUCSIsIdeographicDescriptionCharacters)(k),Module._xmlUCSIsKanbun=k=>(Module._xmlUCSIsKanbun=wasmExports.xmlUCSIsKanbun)(k),Module._xmlUCSIsKangxiRadicals=k=>(Module._xmlUCSIsKangxiRadicals=wasmExports.xmlUCSIsKangxiRadicals)(k),Module._xmlUCSIsKannada=k=>(Module._xmlUCSIsKannada=wasmExports.xmlUCSIsKannada)(k),Module._xmlUCSIsKatakana=k=>(Module._xmlUCSIsKatakana=wasmExports.xmlUCSIsKatakana)(k),Module._xmlUCSIsKatakanaPhoneticExtensions=k=>(Module._xmlUCSIsKatakanaPhoneticExtensions=wasmExports.xmlUCSIsKatakanaPhoneticExtensions)(k),Module._xmlUCSIsKhmer=k=>(Module._xmlUCSIsKhmer=wasmExports.xmlUCSIsKhmer)(k),Module._xmlUCSIsKhmerSymbols=k=>(Module._xmlUCSIsKhmerSymbols=wasmExports.xmlUCSIsKhmerSymbols)(k),Module._xmlUCSIsLao=k=>(Module._xmlUCSIsLao=wasmExports.xmlUCSIsLao)(k),Module._xmlUCSIsLatin1Supplement=k=>(Module._xmlUCSIsLatin1Supplement=wasmExports.xmlUCSIsLatin1Supplement)(k),Module._xmlUCSIsLatinExtendedA=k=>(Module._xmlUCSIsLatinExtendedA=wasmExports.xmlUCSIsLatinExtendedA)(k),Module._xmlUCSIsLatinExtendedB=k=>(Module._xmlUCSIsLatinExtendedB=wasmExports.xmlUCSIsLatinExtendedB)(k),Module._xmlUCSIsLatinExtendedAdditional=k=>(Module._xmlUCSIsLatinExtendedAdditional=wasmExports.xmlUCSIsLatinExtendedAdditional)(k),Module._xmlUCSIsLetterlikeSymbols=k=>(Module._xmlUCSIsLetterlikeSymbols=wasmExports.xmlUCSIsLetterlikeSymbols)(k),Module._xmlUCSIsLimbu=k=>(Module._xmlUCSIsLimbu=wasmExports.xmlUCSIsLimbu)(k),Module._xmlUCSIsLinearBIdeograms=k=>(Module._xmlUCSIsLinearBIdeograms=wasmExports.xmlUCSIsLinearBIdeograms)(k),Module._xmlUCSIsLinearBSyllabary=k=>(Module._xmlUCSIsLinearBSyllabary=wasmExports.xmlUCSIsLinearBSyllabary)(k),Module._xmlUCSIsLowSurrogates=k=>(Module._xmlUCSIsLowSurrogates=wasmExports.xmlUCSIsLowSurrogates)(k),Module._xmlUCSIsMalayalam=k=>(Module._xmlUCSIsMalayalam=wasmExports.xmlUCSIsMalayalam)(k),Module._xmlUCSIsMathematicalAlphanumericSymbols=k=>(Module._xmlUCSIsMathematicalAlphanumericSymbols=wasmExports.xmlUCSIsMathematicalAlphanumericSymbols)(k),Module._xmlUCSIsMathematicalOperators=k=>(Module._xmlUCSIsMathematicalOperators=wasmExports.xmlUCSIsMathematicalOperators)(k),Module._xmlUCSIsMiscellaneousMathematicalSymbolsA=k=>(Module._xmlUCSIsMiscellaneousMathematicalSymbolsA=wasmExports.xmlUCSIsMiscellaneousMathematicalSymbolsA)(k),Module._xmlUCSIsMiscellaneousMathematicalSymbolsB=k=>(Module._xmlUCSIsMiscellaneousMathematicalSymbolsB=wasmExports.xmlUCSIsMiscellaneousMathematicalSymbolsB)(k),Module._xmlUCSIsMiscellaneousSymbols=k=>(Module._xmlUCSIsMiscellaneousSymbols=wasmExports.xmlUCSIsMiscellaneousSymbols)(k),Module._xmlUCSIsMiscellaneousSymbolsandArrows=k=>(Module._xmlUCSIsMiscellaneousSymbolsandArrows=wasmExports.xmlUCSIsMiscellaneousSymbolsandArrows)(k),Module._xmlUCSIsMiscellaneousTechnical=k=>(Module._xmlUCSIsMiscellaneousTechnical=wasmExports.xmlUCSIsMiscellaneousTechnical)(k),Module._xmlUCSIsMongolian=k=>(Module._xmlUCSIsMongolian=wasmExports.xmlUCSIsMongolian)(k),Module._xmlUCSIsMusicalSymbols=k=>(Module._xmlUCSIsMusicalSymbols=wasmExports.xmlUCSIsMusicalSymbols)(k),Module._xmlUCSIsMyanmar=k=>(Module._xmlUCSIsMyanmar=wasmExports.xmlUCSIsMyanmar)(k),Module._xmlUCSIsNumberForms=k=>(Module._xmlUCSIsNumberForms=wasmExports.xmlUCSIsNumberForms)(k),Module._xmlUCSIsOgham=k=>(Module._xmlUCSIsOgham=wasmExports.xmlUCSIsOgham)(k),Module._xmlUCSIsOldItalic=k=>(Module._xmlUCSIsOldItalic=wasmExports.xmlUCSIsOldItalic)(k),Module._xmlUCSIsOpticalCharacterRecognition=k=>(Module._xmlUCSIsOpticalCharacterRecognition=wasmExports.xmlUCSIsOpticalCharacterRecognition)(k),Module._xmlUCSIsOriya=k=>(Module._xmlUCSIsOriya=wasmExports.xmlUCSIsOriya)(k),Module._xmlUCSIsOsmanya=k=>(Module._xmlUCSIsOsmanya=wasmExports.xmlUCSIsOsmanya)(k),Module._xmlUCSIsPhoneticExtensions=k=>(Module._xmlUCSIsPhoneticExtensions=wasmExports.xmlUCSIsPhoneticExtensions)(k),Module._xmlUCSIsPrivateUse=k=>(Module._xmlUCSIsPrivateUse=wasmExports.xmlUCSIsPrivateUse)(k),Module._xmlUCSIsPrivateUseArea=k=>(Module._xmlUCSIsPrivateUseArea=wasmExports.xmlUCSIsPrivateUseArea)(k),Module._xmlUCSIsRunic=k=>(Module._xmlUCSIsRunic=wasmExports.xmlUCSIsRunic)(k),Module._xmlUCSIsShavian=k=>(Module._xmlUCSIsShavian=wasmExports.xmlUCSIsShavian)(k),Module._xmlUCSIsSinhala=k=>(Module._xmlUCSIsSinhala=wasmExports.xmlUCSIsSinhala)(k),Module._xmlUCSIsSmallFormVariants=k=>(Module._xmlUCSIsSmallFormVariants=wasmExports.xmlUCSIsSmallFormVariants)(k),Module._xmlUCSIsSpacingModifierLetters=k=>(Module._xmlUCSIsSpacingModifierLetters=wasmExports.xmlUCSIsSpacingModifierLetters)(k),Module._xmlUCSIsSpecials=k=>(Module._xmlUCSIsSpecials=wasmExports.xmlUCSIsSpecials)(k),Module._xmlUCSIsSuperscriptsandSubscripts=k=>(Module._xmlUCSIsSuperscriptsandSubscripts=wasmExports.xmlUCSIsSuperscriptsandSubscripts)(k),Module._xmlUCSIsSupplementalArrowsA=k=>(Module._xmlUCSIsSupplementalArrowsA=wasmExports.xmlUCSIsSupplementalArrowsA)(k),Module._xmlUCSIsSupplementalArrowsB=k=>(Module._xmlUCSIsSupplementalArrowsB=wasmExports.xmlUCSIsSupplementalArrowsB)(k),Module._xmlUCSIsSupplementalMathematicalOperators=k=>(Module._xmlUCSIsSupplementalMathematicalOperators=wasmExports.xmlUCSIsSupplementalMathematicalOperators)(k),Module._xmlUCSIsSupplementaryPrivateUseAreaA=k=>(Module._xmlUCSIsSupplementaryPrivateUseAreaA=wasmExports.xmlUCSIsSupplementaryPrivateUseAreaA)(k),Module._xmlUCSIsSupplementaryPrivateUseAreaB=k=>(Module._xmlUCSIsSupplementaryPrivateUseAreaB=wasmExports.xmlUCSIsSupplementaryPrivateUseAreaB)(k),Module._xmlUCSIsSyriac=k=>(Module._xmlUCSIsSyriac=wasmExports.xmlUCSIsSyriac)(k),Module._xmlUCSIsTagalog=k=>(Module._xmlUCSIsTagalog=wasmExports.xmlUCSIsTagalog)(k),Module._xmlUCSIsTagbanwa=k=>(Module._xmlUCSIsTagbanwa=wasmExports.xmlUCSIsTagbanwa)(k),Module._xmlUCSIsTags=k=>(Module._xmlUCSIsTags=wasmExports.xmlUCSIsTags)(k),Module._xmlUCSIsTaiLe=k=>(Module._xmlUCSIsTaiLe=wasmExports.xmlUCSIsTaiLe)(k),Module._xmlUCSIsTaiXuanJingSymbols=k=>(Module._xmlUCSIsTaiXuanJingSymbols=wasmExports.xmlUCSIsTaiXuanJingSymbols)(k),Module._xmlUCSIsTamil=k=>(Module._xmlUCSIsTamil=wasmExports.xmlUCSIsTamil)(k),Module._xmlUCSIsTelugu=k=>(Module._xmlUCSIsTelugu=wasmExports.xmlUCSIsTelugu)(k),Module._xmlUCSIsThaana=k=>(Module._xmlUCSIsThaana=wasmExports.xmlUCSIsThaana)(k),Module._xmlUCSIsThai=k=>(Module._xmlUCSIsThai=wasmExports.xmlUCSIsThai)(k),Module._xmlUCSIsTibetan=k=>(Module._xmlUCSIsTibetan=wasmExports.xmlUCSIsTibetan)(k),Module._xmlUCSIsUgaritic=k=>(Module._xmlUCSIsUgaritic=wasmExports.xmlUCSIsUgaritic)(k),Module._xmlUCSIsUnifiedCanadianAboriginalSyllabics=k=>(Module._xmlUCSIsUnifiedCanadianAboriginalSyllabics=wasmExports.xmlUCSIsUnifiedCanadianAboriginalSyllabics)(k),Module._xmlUCSIsVariationSelectors=k=>(Module._xmlUCSIsVariationSelectors=wasmExports.xmlUCSIsVariationSelectors)(k),Module._xmlUCSIsVariationSelectorsSupplement=k=>(Module._xmlUCSIsVariationSelectorsSupplement=wasmExports.xmlUCSIsVariationSelectorsSupplement)(k),Module._xmlUCSIsYiRadicals=k=>(Module._xmlUCSIsYiRadicals=wasmExports.xmlUCSIsYiRadicals)(k),Module._xmlUCSIsYiSyllables=k=>(Module._xmlUCSIsYiSyllables=wasmExports.xmlUCSIsYiSyllables)(k),Module._xmlUCSIsYijingHexagramSymbols=k=>(Module._xmlUCSIsYijingHexagramSymbols=wasmExports.xmlUCSIsYijingHexagramSymbols)(k),Module._xmlUCSIsCatCs=k=>(Module._xmlUCSIsCatCs=wasmExports.xmlUCSIsCatCs)(k),Module.___small_fprintf=(k,e,I)=>(Module.___small_fprintf=wasmExports.__small_fprintf)(k,e,I),Module._xmlXPathBooleanFunction=(k,e)=>(Module._xmlXPathBooleanFunction=wasmExports.xmlXPathBooleanFunction)(k,e),Module._xmlXPathCeilingFunction=(k,e)=>(Module._xmlXPathCeilingFunction=wasmExports.xmlXPathCeilingFunction)(k,e),Module._xmlXPathCountFunction=(k,e)=>(Module._xmlXPathCountFunction=wasmExports.xmlXPathCountFunction)(k,e),Module._xmlXPathConcatFunction=(k,e)=>(Module._xmlXPathConcatFunction=wasmExports.xmlXPathConcatFunction)(k,e),Module._xmlXPathContainsFunction=(k,e)=>(Module._xmlXPathContainsFunction=wasmExports.xmlXPathContainsFunction)(k,e),Module._xmlXPathIdFunction=(k,e)=>(Module._xmlXPathIdFunction=wasmExports.xmlXPathIdFunction)(k,e),Module._xmlXPathFalseFunction=(k,e)=>(Module._xmlXPathFalseFunction=wasmExports.xmlXPathFalseFunction)(k,e),Module._xmlXPathFloorFunction=(k,e)=>(Module._xmlXPathFloorFunction=wasmExports.xmlXPathFloorFunction)(k,e),Module._xmlXPathLastFunction=(k,e)=>(Module._xmlXPathLastFunction=wasmExports.xmlXPathLastFunction)(k,e),Module._xmlXPathLangFunction=(k,e)=>(Module._xmlXPathLangFunction=wasmExports.xmlXPathLangFunction)(k,e),Module._xmlXPathLocalNameFunction=(k,e)=>(Module._xmlXPathLocalNameFunction=wasmExports.xmlXPathLocalNameFunction)(k,e),Module._xmlXPathNotFunction=(k,e)=>(Module._xmlXPathNotFunction=wasmExports.xmlXPathNotFunction)(k,e),Module._xmlXPathNamespaceURIFunction=(k,e)=>(Module._xmlXPathNamespaceURIFunction=wasmExports.xmlXPathNamespaceURIFunction)(k,e),Module._xmlXPathNormalizeFunction=(k,e)=>(Module._xmlXPathNormalizeFunction=wasmExports.xmlXPathNormalizeFunction)(k,e),Module._xmlXPathNumberFunction=(k,e)=>(Module._xmlXPathNumberFunction=wasmExports.xmlXPathNumberFunction)(k,e),Module._xmlXPathPositionFunction=(k,e)=>(Module._xmlXPathPositionFunction=wasmExports.xmlXPathPositionFunction)(k,e),Module._xmlXPathRoundFunction=(k,e)=>(Module._xmlXPathRoundFunction=wasmExports.xmlXPathRoundFunction)(k,e),Module._xmlXPathStringFunction=(k,e)=>(Module._xmlXPathStringFunction=wasmExports.xmlXPathStringFunction)(k,e),Module._xmlXPathStringLengthFunction=(k,e)=>(Module._xmlXPathStringLengthFunction=wasmExports.xmlXPathStringLengthFunction)(k,e),Module._xmlXPathStartsWithFunction=(k,e)=>(Module._xmlXPathStartsWithFunction=wasmExports.xmlXPathStartsWithFunction)(k,e),Module._xmlXPathSubstringFunction=(k,e)=>(Module._xmlXPathSubstringFunction=wasmExports.xmlXPathSubstringFunction)(k,e),Module._xmlXPathSubstringBeforeFunction=(k,e)=>(Module._xmlXPathSubstringBeforeFunction=wasmExports.xmlXPathSubstringBeforeFunction)(k,e),Module._xmlXPathSubstringAfterFunction=(k,e)=>(Module._xmlXPathSubstringAfterFunction=wasmExports.xmlXPathSubstringAfterFunction)(k,e),Module._xmlXPathSumFunction=(k,e)=>(Module._xmlXPathSumFunction=wasmExports.xmlXPathSumFunction)(k,e),Module._xmlXPathTrueFunction=(k,e)=>(Module._xmlXPathTrueFunction=wasmExports.xmlXPathTrueFunction)(k,e),Module._xmlXPathTranslateFunction=(k,e)=>(Module._xmlXPathTranslateFunction=wasmExports.xmlXPathTranslateFunction)(k,e),Module._xmlXPathNextSelf=(k,e)=>(Module._xmlXPathNextSelf=wasmExports.xmlXPathNextSelf)(k,e),Module._xmlXPathNextChild=(k,e)=>(Module._xmlXPathNextChild=wasmExports.xmlXPathNextChild)(k,e),Module._xmlXPathNextDescendant=(k,e)=>(Module._xmlXPathNextDescendant=wasmExports.xmlXPathNextDescendant)(k,e),Module._xmlXPathNextDescendantOrSelf=(k,e)=>(Module._xmlXPathNextDescendantOrSelf=wasmExports.xmlXPathNextDescendantOrSelf)(k,e),Module._xmlXPathNextParent=(k,e)=>(Module._xmlXPathNextParent=wasmExports.xmlXPathNextParent)(k,e),Module._xmlXPathNextAncestor=(k,e)=>(Module._xmlXPathNextAncestor=wasmExports.xmlXPathNextAncestor)(k,e),Module._xmlXPathNextAncestorOrSelf=(k,e)=>(Module._xmlXPathNextAncestorOrSelf=wasmExports.xmlXPathNextAncestorOrSelf)(k,e),Module._xmlXPathNextFollowingSibling=(k,e)=>(Module._xmlXPathNextFollowingSibling=wasmExports.xmlXPathNextFollowingSibling)(k,e),Module._xmlXPathNextPrecedingSibling=(k,e)=>(Module._xmlXPathNextPrecedingSibling=wasmExports.xmlXPathNextPrecedingSibling)(k,e),Module._xmlXPathNextFollowing=(k,e)=>(Module._xmlXPathNextFollowing=wasmExports.xmlXPathNextFollowing)(k,e),Module._xmlXPathNextNamespace=(k,e)=>(Module._xmlXPathNextNamespace=wasmExports.xmlXPathNextNamespace)(k,e),Module._xmlXPathNextAttribute=(k,e)=>(Module._xmlXPathNextAttribute=wasmExports.xmlXPathNextAttribute)(k,e),Module._zcalloc=(k,e,I)=>(Module._zcalloc=wasmExports.zcalloc)(k,e,I),Module._zcfree=(k,e)=>(Module._zcfree=wasmExports.zcfree)(k,e),Module._memset=(k,e,I)=>(Module._memset=wasmExports.memset)(k,e,I),Module._strerror=k=>(Module._strerror=wasmExports.strerror)(k),Module._memmove=(k,e,I)=>(Module._memmove=wasmExports.memmove)(k,e,I),Module.___multf3=(k,e,I,B,tr)=>(Module.___multf3=wasmExports.__multf3)(k,e,I,B,tr),Module.___subtf3=(k,e,I,B,tr)=>(Module.___subtf3=wasmExports.__subtf3)(k,e,I,B,tr),Module.___lttf2=(k,e,I,B)=>(Module.___lttf2=wasmExports.__lttf2)(k,e,I,B),Module.___fixtfsi=(k,e)=>(Module.___fixtfsi=wasmExports.__fixtfsi)(k,e),Module.___floatsitf=(k,e)=>(Module.___floatsitf=wasmExports.__floatsitf)(k,e),Module.___extenddftf2=(k,e)=>(Module.___extenddftf2=wasmExports.__extenddftf2)(k,e),Module.___getf2=(k,e,I,B)=>(Module.___getf2=wasmExports.__getf2)(k,e,I,B),Module._pthread_mutex_lock=k=>(Module._pthread_mutex_lock=wasmExports.pthread_mutex_lock)(k),Module._pthread_mutex_unlock=k=>(Module._pthread_mutex_unlock=wasmExports.pthread_mutex_unlock)(k);var ___dl_seterr=(k,e)=>(___dl_seterr=wasmExports.__dl_seterr)(k,e),_emscripten_builtin_memalign=(k,e)=>(_emscripten_builtin_memalign=wasmExports.emscripten_builtin_memalign)(k,e),_emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports.emscripten_stack_get_current)();Module._putc=(k,e)=>(Module._putc=wasmExports.putc)(k,e),Module.___letf2=(k,e,I,B)=>(Module.___letf2=wasmExports.__letf2)(k,e,I,B),Module._pthread_sigmask=(k,e,I)=>(Module._pthread_sigmask=wasmExports.pthread_sigmask)(k,e,I);var _htons=k=>(_htons=wasmExports.htons)(k),_ntohs=k=>(_ntohs=wasmExports.ntohs)(k);Module._gmtime=k=>(Module._gmtime=wasmExports.gmtime)(k);var _htonl=k=>(_htonl=wasmExports.htonl)(k);Module._ioctl=(k,e,I)=>(Module._ioctl=wasmExports.ioctl)(k,e,I),Module._sigismember=(k,e)=>(Module._sigismember=wasmExports.sigismember)(k,e),Module._sigpending=k=>(Module._sigpending=wasmExports.sigpending)(k),Module._srand=k=>(Module._srand=wasmExports.srand)(k),Module._rand=()=>(Module._rand=wasmExports.rand)();var __emscripten_timeout=(k,e)=>(__emscripten_timeout=wasmExports._emscripten_timeout)(k,e);Module._sigwait=(k,e)=>(Module._sigwait=wasmExports.sigwait)(k,e),Module._strncat=(k,e,I)=>(Module._strncat=wasmExports.strncat)(k,e,I);var _setThrew=(k,e)=>(_setThrew=wasmExports.setThrew)(k,e),__emscripten_tempret_set=k=>(__emscripten_tempret_set=wasmExports._emscripten_tempret_set)(k),__emscripten_tempret_get=()=>(__emscripten_tempret_get=wasmExports._emscripten_tempret_get)(),__emscripten_stack_restore=k=>(__emscripten_stack_restore=wasmExports._emscripten_stack_restore)(k),__emscripten_stack_alloc=k=>(__emscripten_stack_alloc=wasmExports._emscripten_stack_alloc)(k);Module._getsockname=(k,e,I)=>(Module._getsockname=wasmExports.getsockname)(k,e,I),Module._stderr=15157024,Module._InterruptPending=15301456,Module._MyLatch=15301644,Module._CritSectionCount=15301508,Module._MyProc=15271260,Module._pg_global_prng_state=15247840,Module._error_context_stack=15299752,Module._GUC_check_errdetail_string=15305404,Module._IsUnderPostmaster=15301537,Module._CurrentMemoryContext=15306832,Module._stdout=15157328,Module._debug_query_string=15162268,Module._MyProcPort=15301632,Module.___THREW__=15325956,Module.___threwValue=15325960,Module._MyDatabaseId=15301516,Module._TopMemoryContext=15306836,Module._PG_exception_stack=15299756,Module._MyProcPid=15301608,Module._stdin=15157176,Module._ScanKeywords=14989880,Module._pg_number_of_ones=13556160,Module._LocalBufferBlockPointers=15267836,Module._BufferBlocks=15262572,Module._wal_level=15003760,Module._SnapshotAnyData=15089936,Module._maintenance_work_mem=15037416,Module._ParallelWorkerNumber=14995320,Module._MainLWLockArray=15269444,Module._CurrentResourceOwner=15306880,Module._work_mem=15037400,Module._NBuffers=15037424,Module._bsysscan=15249076,Module._CheckXidAlive=15249072,Module._RecentXmin=15090028,Module._TTSOpsHeapTuple=15007500,Module._XactIsoLevel=15003624,Module._pgWalUsage=15252544,Module._pgBufferUsage=15252416,Module._TTSOpsVirtual=15007448,Module._TransamVariables=15249064,Module._TopTransactionContext=15306856,Module._RmgrTable=14995344,Module._process_shared_preload_libraries_in_progress=15304800,Module._wal_segment_size=15003780,Module._TopTransactionResourceOwner=15306888,Module._arch_module_check_errdetail_string=15261956,Module._object_access_hook=15251184,Module._InvalidObjectAddress=14151628,Module._check_function_bodies=15037590,Module._post_parse_analyze_hook=15251224,Module._ScanKeywordTokens=14182928,Module._SPI_processed=15252568,Module._SPI_tuptable=15252576,Module._CacheMemoryContext=15306848,Module._WalReceiverFunctions=15262348,Module._TTSOpsMinimalTuple=15007552,Module._check_password_hook=15251492,Module._ConfigReloadPending=15261944,Module._max_parallel_maintenance_workers=15037420,Module._DateStyle=15037388,Module._ExecutorStart_hook=15252392,Module._ExecutorRun_hook=15252396,Module._ExecutorFinish_hook=15252400,Module._ExecutorEnd_hook=15252404,Module._SPI_result=15252580,Module._ClientAuthentication_hook=15252752,Module._cpu_tuple_cost=15008008,Module._cpu_operator_cost=15008024,Module._seq_page_cost=15007992,Module._planner_hook=15261640,Module._ShutdownRequestPending=15261948,Module._MyStartTime=15301616,Module._cluster_name=15037640,Module._application_name=15305628,Module._BufferDescriptors=15262568,Module._shmem_startup_hook=15268516,Module._ProcessUtility_hook=15271348,Module._IntervalStyle=15301540,Module._extra_float_digits=15027816,Module._pg_crc32_table=14743360,Module._xmlFree=15139240,Module._xmlStructuredError=15308404,Module._xmlStructuredErrorContext=15308412,Module._xmlGenericErrorContext=15308408,Module._xmlGenericError=15139276,Module._xmlIsBaseCharGroup=15138640,Module._xmlIsDigitGroup=15138672,Module._xmlIsCombiningGroup=15138656,Module._xmlIsExtenderGroup=15138688,Module._ErrorContext=15306840,Module._shmem_request_hook=15304804,Module._xmlIsPubidChar_tab=14784656,Module._xmlMalloc=15139244,Module._xmlRealloc=15139252,Module._xmlGetWarningsDefaultValue=15139268,Module._xmlLastError=15308424,Module._xmlMallocAtomic=15139248,Module._xmlMemStrdup=15139256,Module._xmlBufferAllocScheme=15139260,Module._xmlDefaultBufferSize=15139264,Module._xmlParserDebugEntities=15308364,Module._xmlDoValidityCheckingDefaultValue=15308368,Module._xmlLoadExtDtdDefaultValue=15308372,Module._xmlPedanticParserDefaultValue=15308376,Module._xmlLineNumbersDefaultValue=15308380,Module._xmlKeepBlanksDefaultValue=15139272,Module._xmlSubstituteEntitiesDefaultValue=15308384,Module._xmlRegisterNodeDefaultValue=15308388,Module._xmlDeregisterNodeDefaultValue=15308392,Module._xmlParserInputBufferCreateFilenameValue=15308396,Module._xmlOutputBufferCreateFilenameValue=15308400,Module._xmlIndentTreeOutput=15139280,Module._xmlTreeIndentString=15139284,Module._xmlSaveNoEmptyTags=15308416,Module._xmlDefaultSAXHandler=15139288,Module._xmlDefaultSAXLocator=15139400,Module._xmlParserMaxDepth=15139668,Module._xmlStringText=14786464,Module._xmlStringComment=14786479,Module._xmlStringTextNoenc=14786469,Module._xmlXPathNAN=15309080,Module._xmlXPathNINF=15309096,Module._xmlXPathPINF=15309088,Module._z_errmsg=15156224,Module.__length_code=14806128,Module.__dist_code=14805616;function invoke_iii(k,e,I){var B=stackSave();try{return getWasmTableEntry(k)(e,I)}catch(tr){if(stackRestore(B),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_viiii(k,e,I,B,tr){var rr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_vi(k,e){var I=stackSave();try{getWasmTableEntry(k)(e)}catch(B){if(stackRestore(I),B!==B+0)throw B;_setThrew(1,0)}}function invoke_v(k){var e=stackSave();try{getWasmTableEntry(k)()}catch(I){if(stackRestore(e),I!==I+0)throw I;_setThrew(1,0)}}function invoke_j(k){var e=stackSave();try{return getWasmTableEntry(k)()}catch(I){if(stackRestore(e),I!==I+0)throw I;return _setThrew(1,0),0n}}function invoke_viiiiii(k,e,I,B,tr,rr,ir){var lr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;_setThrew(1,0)}}function invoke_vii(k,e,I){var B=stackSave();try{getWasmTableEntry(k)(e,I)}catch(tr){if(stackRestore(B),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_iiiiii(k,e,I,B,tr,rr){var ir=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_i(k){var e=stackSave();try{return getWasmTableEntry(k)()}catch(I){if(stackRestore(e),I!==I+0)throw I;_setThrew(1,0)}}function invoke_ii(k,e){var I=stackSave();try{return getWasmTableEntry(k)(e)}catch(B){if(stackRestore(I),B!==B+0)throw B;_setThrew(1,0)}}function invoke_viii(k,e,I,B){var tr=stackSave();try{getWasmTableEntry(k)(e,I,B)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_iiii(k,e,I,B){var tr=stackSave();try{return getWasmTableEntry(k)(e,I,B)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_vji(k,e,I){var B=stackSave();try{getWasmTableEntry(k)(e,I)}catch(tr){if(stackRestore(B),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_iiiii(k,e,I,B,tr){var rr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_iiiiiiii(k,e,I,B,tr,rr,ir,lr){var dr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr)}catch(mr){if(stackRestore(dr),mr!==mr+0)throw mr;_setThrew(1,0)}}function invoke_viiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr,mr){var hr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr,mr)}catch(fr){if(stackRestore(hr),fr!==fr+0)throw fr;_setThrew(1,0)}}function invoke_viiiii(k,e,I,B,tr,rr){var ir=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_jii(k,e,I){var B=stackSave();try{return getWasmTableEntry(k)(e,I)}catch(tr){if(stackRestore(B),tr!==tr+0)throw tr;return _setThrew(1,0),0n}}function invoke_ji(k,e){var I=stackSave();try{return getWasmTableEntry(k)(e)}catch(B){if(stackRestore(I),B!==B+0)throw B;return _setThrew(1,0),0n}}function invoke_jiiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr,mr){var hr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr,mr)}catch(fr){if(stackRestore(hr),fr!==fr+0)throw fr;return _setThrew(1,0),0n}}function invoke_jiiiiii(k,e,I,B,tr,rr,ir){var lr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;return _setThrew(1,0),0n}}function invoke_iiiiiiiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr,_r,gr){var Sr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr,mr,hr,fr,_r,gr)}catch(Ar){if(stackRestore(Sr),Ar!==Ar+0)throw Ar;_setThrew(1,0)}}function invoke_iiiijii(k,e,I,B,tr,rr,ir){var lr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;_setThrew(1,0)}}function invoke_vijiji(k,e,I,B,tr,rr){var ir=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_viji(k,e,I,B){var tr=stackSave();try{getWasmTableEntry(k)(e,I,B)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_iiji(k,e,I,B){var tr=stackSave();try{return getWasmTableEntry(k)(e,I,B)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_iiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr){var mr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr)}catch(hr){if(stackRestore(mr),hr!==hr+0)throw hr;_setThrew(1,0)}}function invoke_iiiiiiiiiiiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr,_r,gr,Sr,Ar,Or,Fr){var vr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr,mr,hr,fr,_r,gr,Sr,Ar,Or,Fr)}catch(xr){if(stackRestore(vr),xr!==xr+0)throw xr;_setThrew(1,0)}}function invoke_iiiij(k,e,I,B,tr){var rr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_iiiiiii(k,e,I,B,tr,rr,ir){var lr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;_setThrew(1,0)}}function invoke_vj(k,e){var I=stackSave();try{getWasmTableEntry(k)(e)}catch(B){if(stackRestore(I),B!==B+0)throw B;_setThrew(1,0)}}function invoke_iiiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr,mr){var hr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr,mr)}catch(fr){if(stackRestore(hr),fr!==fr+0)throw fr;_setThrew(1,0)}}function invoke_viiji(k,e,I,B,tr){var rr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;_setThrew(1,0)}}function invoke_viiiiiiii(k,e,I,B,tr,rr,ir,lr,dr){var mr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr)}catch(hr){if(stackRestore(mr),hr!==hr+0)throw hr;_setThrew(1,0)}}function invoke_vij(k,e,I){var B=stackSave();try{getWasmTableEntry(k)(e,I)}catch(tr){if(stackRestore(B),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_ij(k,e){var I=stackSave();try{return getWasmTableEntry(k)(e)}catch(B){if(stackRestore(I),B!==B+0)throw B;_setThrew(1,0)}}function invoke_viiiiiii(k,e,I,B,tr,rr,ir,lr){var dr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr)}catch(mr){if(stackRestore(dr),mr!==mr+0)throw mr;_setThrew(1,0)}}function invoke_viiiji(k,e,I,B,tr,rr){var ir=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_iiij(k,e,I,B){var tr=stackSave();try{return getWasmTableEntry(k)(e,I,B)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_vid(k,e,I){var B=stackSave();try{getWasmTableEntry(k)(e,I)}catch(tr){if(stackRestore(B),tr!==tr+0)throw tr;_setThrew(1,0)}}function invoke_ijiiiiii(k,e,I,B,tr,rr,ir,lr){var dr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr)}catch(mr){if(stackRestore(dr),mr!==mr+0)throw mr;_setThrew(1,0)}}function invoke_viijii(k,e,I,B,tr,rr){var ir=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr)}catch(lr){if(stackRestore(ir),lr!==lr+0)throw lr;_setThrew(1,0)}}function invoke_iiiiiji(k,e,I,B,tr,rr,ir){var lr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;_setThrew(1,0)}}function invoke_viijiiii(k,e,I,B,tr,rr,ir,lr){var dr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr)}catch(mr){if(stackRestore(dr),mr!==mr+0)throw mr;_setThrew(1,0)}}function invoke_viij(k,e,I,B){var tr=stackSave();try{getWasmTableEntry(k)(e,I,B)}catch(rr){if(stackRestore(tr),rr!==rr+0)throw rr;_setThrew(1,0)}}function invoke_jiiii(k,e,I,B,tr){var rr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr)}catch(ir){if(stackRestore(rr),ir!==ir+0)throw ir;return _setThrew(1,0),0n}}function invoke_viiiiiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr,mr,hr,fr,_r){var gr=stackSave();try{getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr,mr,hr,fr,_r)}catch(Sr){if(stackRestore(gr),Sr!==Sr+0)throw Sr;_setThrew(1,0)}}function invoke_di(k,e){var I=stackSave();try{return getWasmTableEntry(k)(e)}catch(B){if(stackRestore(I),B!==B+0)throw B;_setThrew(1,0)}}function invoke_id(k,e){var I=stackSave();try{return getWasmTableEntry(k)(e)}catch(B){if(stackRestore(I),B!==B+0)throw B;_setThrew(1,0)}}function invoke_ijiiiii(k,e,I,B,tr,rr,ir){var lr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir)}catch(dr){if(stackRestore(lr),dr!==dr+0)throw dr;_setThrew(1,0)}}function invoke_iiiiiiiiiii(k,e,I,B,tr,rr,ir,lr,dr,mr,hr){var fr=stackSave();try{return getWasmTableEntry(k)(e,I,B,tr,rr,ir,lr,dr,mr,hr)}catch(_r){if(stackRestore(fr),_r!==_r+0)throw _r;_setThrew(1,0)}}Module.addRunDependency=addRunDependency,Module.removeRunDependency=removeRunDependency,Module.setValue=setValue,Module.getValue=getValue,Module.UTF8ToString=UTF8ToString,Module.stringToNewUTF8=stringToNewUTF8,Module.stringToUTF8OnStack=stringToUTF8OnStack,Module.FS_createPreloadedFile=FS_createPreloadedFile,Module.FS_unlink=FS_unlink,Module.FS_createPath=FS_createPath,Module.FS_createDevice=FS_createDevice,Module.FS=FS,Module.FS_createDataFile=FS_createDataFile,Module.FS_createLazyFile=FS_createLazyFile,Module.MEMFS=MEMFS,Module.IDBFS=IDBFS;var calledRun;dependenciesFulfilled=function k(){calledRun||run(),calledRun||(dependenciesFulfilled=k)};function callMain(k=[]){var e=resolveGlobalSymbol("main").sym;if(e){k.unshift(thisProgram);var I=k.length,B=stackAlloc((I+1)*4),tr=B;k.forEach(ir=>{HEAPU32[tr>>2]=stringToUTF8OnStack(ir),tr+=4}),HEAPU32[tr>>2]=0;try{var rr=e(I,B);return exitJS(rr,!0),rr}catch(ir){return handleException(ir)}}}function run(k=arguments_){if(runDependencies>0||(preRun(),runDependencies>0))return;function e(){calledRun||(calledRun=!0,Module.calledRun=!0,!ABORT&&(initRuntime(),preMain(),readyPromiseResolve(Module),Module.onRuntimeInitialized?.(),shouldRunNow&&callMain(k),postRun()))}Module.setStatus?(Module.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>Module.setStatus(""),1),e()},1)):e()}if(Module.preInit)for(typeof Module.preInit=="function"&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;return Module.noInitialRun&&(shouldRunNow=!1),run(),moduleRtn=readyPromise,moduleRtn}})(),Ue=Ze,Re=Ue,J,j,V,Q,$,ie,me,pe,de,Z,ae,oe,se,le,K,H,A,Y,T,De,re,ze,Ne,ue=class la extends z{constructor(e={},I={}){super(),R$2(this,T),R$2(this,J,!1),R$2(this,j,!1),R$2(this,V,!1),R$2(this,Q,!1),R$2(this,$,!1),R$2(this,ie,new X),R$2(this,me,new X),R$2(this,pe,new X),R$2(this,de,new X),R$2(this,Z,!1),R$2(this,ae,"cma"),this.debug=0,R$2(this,oe),R$2(this,se,[]),R$2(this,le,new ye),R$2(this,K),R$2(this,H),R$2(this,A,new Map),R$2(this,Y,new Set),typeof e=="string"?I={dataDir:e,...I}:I=e,this.dataDir=I.dataDir,I.parsers!==void 0&&(this.parsers={...this.parsers,...I.parsers}),I.serializers!==void 0&&(this.serializers={...this.serializers,...I.serializers}),I?.debug!==void 0&&(this.debug=I.debug),I?.relaxedDurability!==void 0&&x$2(this,$,I.relaxedDurability),I?.defaultDataTransferContainer!==void 0&&x$2(this,ae,I.defaultDataTransferContainer),x$2(this,oe,I.extensions??{}),this.waitReady=T$1(this,T,De).call(this,I??{})}static async create(e,I){let B=typeof e=="string"?{dataDir:e,...I??{}}:e??{},tr=new la(B);return await tr.waitReady,tr}get Module(){return this.mod}get ready(){return h$1(this,J)&&!h$1(this,j)&&!h$1(this,V)}get closed(){return h$1(this,V)}async close(){await this._checkReady(),x$2(this,j,!0);for(let e of h$1(this,se))await e();try{await this.execProtocol(O.end()),this.mod._pgl_shutdown()}catch(e){let I=e;if(!(I.name==="ExitStatus"&&I.status===0))throw e}await this.fs.closeFs(),x$2(this,V,!0),x$2(this,j,!1)}async[Symbol.asyncDispose](){await this.close()}async _handleBlob(e){x$2(this,K,e?await e.arrayBuffer():void 0)}async _cleanupBlob(){x$2(this,K,void 0)}async _getWrittenBlob(){if(!h$1(this,H))return;let e=new Blob(h$1(this,H));return x$2(this,H,void 0),e}async _checkReady(){if(h$1(this,j))throw new Error("PGlite is closing");if(h$1(this,V))throw new Error("PGlite is closed");h$1(this,J)||await this.waitReady}execProtocolRawSync(e,I={}){let B,tr=this.mod;tr._use_wire(1);let rr=e.length,ir=I.dataTransferContainer??h$1(this,ae);switch(e.length>=tr.FD_BUFFER_MAX&&(ir="file"),ir){case"cma":{tr._interactive_write(e.length),tr.HEAPU8.set(e,1);break}case"file":{let dr="/tmp/pglite/base/.s.PGSQL.5432.lck.in";tr._interactive_write(0),tr.FS.writeFile(dr,e),tr.FS.rename(dr,"/tmp/pglite/base/.s.PGSQL.5432.in");break}default:throw new Error(`Unknown data transfer container: ${ir}`)}tr._interactive_one();let lr=tr._get_channel();switch(lr<0&&(ir="file"),lr>0&&(ir="cma"),ir){case"cma":{let dr=rr+2,mr=dr+tr._interactive_read();B=tr.HEAPU8.subarray(dr,mr);break}case"file":{let dr="/tmp/pglite/base/.s.PGSQL.5432.out";try{let mr=tr.FS.stat(dr),hr=tr.FS.open(dr,"r");B=new Uint8Array(mr.size),tr.FS.read(hr,B,0,mr.size,0),tr.FS.unlink(dr)}catch{B=new Uint8Array(0)}break}default:throw new Error(`Unknown data transfer container: ${ir}`)}return B}async execProtocolRaw(e,{syncToFs:I=!0,dataTransferContainer:B}={}){let tr=this.execProtocolRawSync(e,{dataTransferContainer:B});return I&&await this.syncToFs(),tr}async execProtocol(e,{syncToFs:I=!0,throwOnError:B=!0,onNotice:tr}={}){let rr=await this.execProtocolRaw(e,{syncToFs:I}),ir=[];return h$1(this,le).parse(rr,lr=>{if(lr instanceof E){if(x$2(this,le,new ye),B)throw lr}else if(lr instanceof te$1)this.debug>0&&console.warn(lr),tr&&tr(lr);else if(lr instanceof Z$1)switch(lr.text){case"BEGIN":x$2(this,Q,!0);break;case"COMMIT":case"ROLLBACK":x$2(this,Q,!1);break}else if(lr instanceof J$1){let dr=h$1(this,A).get(lr.channel);dr&&dr.forEach(mr=>{queueMicrotask(()=>mr(lr.payload))}),h$1(this,Y).forEach(mr=>{queueMicrotask(()=>mr(lr.channel,lr.payload))})}ir.push(lr)}),{messages:ir,data:rr}}isInTransaction(){return h$1(this,Q)}async syncToFs(){if(h$1(this,Z))return;x$2(this,Z,!0);let e=async()=>{await h$1(this,de).runExclusive(async()=>{x$2(this,Z,!1),await this.fs.syncToFs(h$1(this,$))})};h$1(this,$)?e():await e()}async listen(e,I,B){return this._runExclusiveListen(()=>T$1(this,T,ze).call(this,e,I,B))}async unlisten(e,I,B){return this._runExclusiveListen(()=>T$1(this,T,Ne).call(this,e,I,B))}onNotification(e){return h$1(this,Y).add(e),()=>{h$1(this,Y).delete(e)}}offNotification(e){h$1(this,Y).delete(e)}async dumpDataDir(e){await this._checkReady();let I=this.dataDir?.split("/").pop()??"pgdata";return this.fs.dumpTar(I,e)}_runExclusiveQuery(e){return h$1(this,ie).runExclusive(e)}_runExclusiveTransaction(e){return h$1(this,me).runExclusive(e)}async clone(){let e=await this.dumpDataDir("none");return la.create({loadDataDir:e})}_runExclusiveListen(e){return h$1(this,pe).runExclusive(e)}};J=new WeakMap,j=new WeakMap,V=new WeakMap,Q=new WeakMap,$=new WeakMap,ie=new WeakMap,me=new WeakMap,pe=new WeakMap,de=new WeakMap,Z=new WeakMap,ae=new WeakMap,oe=new WeakMap,se=new WeakMap,le=new WeakMap,K=new WeakMap,H=new WeakMap,A=new WeakMap,Y=new WeakMap,T=new WeakSet,De=async function(k){if(k.fs)this.fs=k.fs;else{let{dataDir:mr,fsType:hr}=Ae(k.dataDir);this.fs=await Te(mr,hr)}let e={},I=[],B=[`PGDATA=${C}`,`PREFIX=${Vr}`,`PGUSER=${k.username??"postgres"}`,`PGDATABASE=${k.database??"template1"}`,"MODE=REACT","REPL=N",...this.debug?["-d",this.debug.toString()]:[]];k.wasmModule||Rr();let tr=k.fsBundle?k.fsBundle.arrayBuffer():Er(),rr;tr.then(mr=>{rr=mr});let ir={WASM_PREFIX:Vr,arguments:B,INITIAL_MEMORY:k.initialMemory,noExitRuntime:!0,...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},instantiateWasm:(mr,hr)=>(Tr(mr,k.wasmModule).then(({instance:fr,module:_r})=>{hr(fr,_r)}),{}),getPreloadedPackage:(mr,hr)=>{if(mr==="pglite.data"){if(rr.byteLength!==hr)throw new Error(`Invalid FS bundle size: ${rr.byteLength} !== ${hr}`);return rr}throw new Error(`Unknown package: ${mr}`)},preRun:[mr=>{let hr=mr.FS.makedev(64,0),fr={open:_r=>{},close:_r=>{},read:(_r,gr,Sr,Ar,Or)=>{let Fr=h$1(this,K);if(!Fr)throw new Error("No /dev/blob File or Blob provided to read from");let vr=new Uint8Array(Fr);if(Or>=vr.length)return 0;let xr=Math.min(vr.length-Or,Ar);for(let kr=0;kr<xr;kr++)gr[Sr+kr]=vr[Or+kr];return xr},write:(_r,gr,Sr,Ar,Or)=>(h$1(this,H)??x$2(this,H,[]),h$1(this,H).push(gr.slice(Sr,Sr+Ar)),Ar),llseek:(_r,gr,Sr)=>{let Ar=h$1(this,K);if(!Ar)throw new Error("No /dev/blob File or Blob provided to llseek");let Or=gr;if(Sr===1?Or+=_r.position:Sr===2&&(Or=new Uint8Array(Ar).length),Or<0)throw new mr.FS.ErrnoError(28);return Or}};mr.FS.registerDevice(hr,fr),mr.FS.mkdev("/dev/blob",hr)}]},{emscriptenOpts:lr}=await this.fs.init(this,ir);ir=lr;for(let[mr,hr]of Object.entries(h$1(this,oe)))if(hr instanceof URL)e[mr]=xe(hr);else{let fr=await hr.setup(this,ir);if(fr.emscriptenOpts&&(ir=fr.emscriptenOpts),fr.namespaceObj){let _r=this;_r[mr]=fr.namespaceObj}fr.bundlePath&&(e[mr]=xe(fr.bundlePath)),fr.init&&I.push(fr.init),fr.close&&h$1(this,se).push(fr.close)}if(ir.pg_extensions=e,await tr,this.mod=await Re(ir),await this.fs.initialSyncFs(),k.loadDataDir){if(this.mod.FS.analyzePath(C+"/PG_VERSION").exists)throw new Error("Database already exists, cannot load from tarball");T$1(this,T,re).call(this,"pglite: loading data from tarball"),await ce(this.mod.FS,k.loadDataDir,C)}this.mod.FS.analyzePath(C+"/PG_VERSION").exists?T$1(this,T,re).call(this,"pglite: found DB, resuming"):T$1(this,T,re).call(this,"pglite: no db"),await ke(this.mod,(...mr)=>T$1(this,T,re).call(this,...mr));let dr=this.mod._pgl_initdb();if(!dr)throw new Error("INITDB failed to return value");if(dr&1)throw new Error("INITDB: failed to execute");if(dr&2){let mr=k.username??"postgres",hr=k.database??"template1";if(dr&4){if(!(dr&12))throw new Error(`INITDB: Invalid db ${hr}/user ${mr} combination`)}else if(hr!=="template1"&&mr!=="postgres")throw new Error(`INITDB: created a new datadir ${C}, but an alternative db ${hr}/user ${mr} was requested`)}this.mod._pgl_backend(),await this.syncToFs(),x$2(this,J,!0),await this.exec("SET search_path TO public;"),await this._initArrayTypes();for(let mr of I)await mr()},re=function(...k){this.debug>0&&console.log(...k)},ze=async function(k,e,I){let B=Nr(k),tr=I??this;h$1(this,A).has(B)||h$1(this,A).set(B,new Set),h$1(this,A).get(B).add(e);try{await tr.exec(`LISTEN ${k}`)}catch(rr){throw h$1(this,A).get(B).delete(e),h$1(this,A).get(B)?.size===0&&h$1(this,A).delete(B),rr}return async rr=>{await this.unlisten(B,e,rr)}},Ne=async function(k,e,I){let B=Nr(k),tr=I??this,rr=async()=>{await tr.exec(`UNLISTEN ${k}`),h$1(this,A).get(B)?.size===0&&h$1(this,A).delete(B)};e?(h$1(this,A).get(B)?.delete(e),h$1(this,A).get(B)?.size===0&&await rr()):await rr()};var qe=ue;u$1();class PGliteInstance{static instance=null;static options={};static async getInstance(){return PGliteInstance.instance||(PGliteInstance.options||logWarn("PGlite constructor options are not provided. Creating instance with default options."),PGliteInstance.instance=await qe.create(PGliteInstance.options)),PGliteInstance.instance}static setOptions(e){PGliteInstance.options=e}static async close(){PGliteInstance.instance&&(await PGliteInstance.instance.close(),PGliteInstance.instance=null)}}class PGlitePool extends EventEmitter{constructor(){super()}doneCallback(){}async connect(e){try{await PGliteInstance.getInstance(),e(null,this,this.doneCallback)}catch(I){e(I,null,this.doneCallback)}}async query(e,I,B){const tr=await PGliteInstance.getInstance();let rr=B,ir=I;return typeof I=="function"&&(rr=I,ir=void 0),tr.query(e,ir).then(lr=>(rr&&rr(null,lr),lr)).catch(lr=>{throw rr&&rr(lr,null),lr})}end(e){PGliteInstance.close().then(()=>e(null)).catch(I=>e(I))}}class PGliteDriver{constructor(e){e&&PGliteInstance.setOptions(e)}get driver(){return class{static Pool=PGlitePool;static pool=PGlitePool}}}const processes=new Map,WOKER_INIT_MESSAGE_ID="_WORKER_INIT_";function sendToMainThread(k,e,I){if(!processes.get(k)&&k!==WOKER_INIT_MESSAGE_ID){logWarn("[No process found for message]",k);return}self.postMessage({messageId:k,type:e,payload:I}),logDebug("[Send Worker to Main Thread]",{id:k,type:e,payload:I})}function handlePayloadFunc(k){return async e=>{try{const I=await k(e);sendToMainThread(e.messageId,"complete",I)}catch(I){logError("Handle Worker Message",I,{payload:e}),sendToMainThread(e.messageId,"error",{error:I instanceof Error?I.message:"An error occurred",error_code:"UNKNOWN_ERROR"})}finally{processes.delete(e.messageId)}}}function listenForMessages(k,e){self.addEventListener("message",async I=>{processes.set(I.data.messageId,Promise.race([handlePayloadFunc(k)(I.data),new Promise(B=>setTimeout(()=>B(!0),12e4)).then(()=>{processes.has(I.data.messageId)&&(sendToMainThread(I.data.messageId,"error",{error:"Operation timed out",error_code:"TIMEOUT_ERROR"}),processes.delete(I.data.messageId))})])),sendToMainThread(I.data.messageId,"started","Started processing")})}async function init(k){typeof k=="function"&&await k(),sendToMainThread(WOKER_INIT_MESSAGE_ID,"complete","Worker initialized")}var FlowNodeTypeEnum=(k=>(k.Toolbox="TOOLBOX",k.LLM="LLM",k.NewMessage="NEW_MESSAGE",k.Thread="THREAD",k.Message="MESSAGE",k.Prompt="PROMPT",k.SessionInfo="SESSION_INFO",k.Schema="SCHEMA",k.ToolDefinition="TOOL_DEFINITION",k.ToolHandler="TOOL_HANDLER",k.FewShotExample="FEW_SHOT_EXAMPLE",k.CSVData="CSV_DATA",k.DefaultEmbeddingModel="DEFAULT_EMBEDDING_MODEL",k.VectorDatabase="VECTOR_DATABASE",k.JSONLData="JSONL_DATA",k.ApplicationBar="APPLICATION_BAR",k.Shape="SHAPE",k.CircleShape="CIRCLE_SHAPE",k.TriangleShape="TRIANGLE_SHAPE",k.EditorApp="EDITOR_APP",k.PlaceHolder="PLACEHOLDER",k.VSLiteApp="VSLITE_APP",k.JSONData="JSON_DATA",k.MCP="MCP",k))(FlowNodeTypeEnum||{}),SessionTypeEnum=(k=>(k.Whiteboard="Whiteboard",k.StandaloneApp="StandaloneApp",k))(SessionTypeEnum||{});const TABLE_NAMES={Thread:"threads",Message:"messages",LLM:"llms",FlowNode:"flow_nodes",FlowEdge:"flow_edges",Prompt:"prompts",PromptVariable:"prompt_variables",Session:"sessions",Schema:"schemas",SchemaItem:"schema_items",JSONData:"json_data",CSVData:"csv_data",ToolDefinition:"tool_definitions",VectorDatabase:"vector_databases",JSONLData:"jsonl_data",FlowNodeData:"flow_node_data",FlowNodePlaceholder:"flow_node_placeholders",MCP:"mcps"};FlowNodeTypeEnum.Toolbox+"",FlowNodeTypeEnum.SessionInfo+"",FlowNodeTypeEnum.DefaultEmbeddingModel+"",FlowNodeTypeEnum.ApplicationBar+"",FlowNodeTypeEnum.Shape+"",FlowNodeTypeEnum.CircleShape+"",FlowNodeTypeEnum.TriangleShape+"",FlowNodeTypeEnum.EditorApp+"",FlowNodeTypeEnum.VSLiteApp+"",FlowNodeTypeEnum.NewMessage+"",FlowNodeTypeEnum.ToolHandler+"",FlowNodeTypeEnum.FewShotExample+"",FlowNodeTypeEnum.JSONData+"",FlowNodeTypeEnum.LLM+"",FlowNodeTypeEnum.Thread+"",FlowNodeTypeEnum.Message+"",FlowNodeTypeEnum.Prompt+"",FlowNodeTypeEnum.Schema+"",FlowNodeTypeEnum.CSVData+"",FlowNodeTypeEnum.ToolDefinition+"",FlowNodeTypeEnum.VectorDatabase+"",FlowNodeTypeEnum.JSONLData+"",FlowNodeTypeEnum.PlaceHolder+"",FlowNodeTypeEnum.MCP+"";var __defProp$h=Object.defineProperty,__getOwnPropDesc$h=Object.getOwnPropertyDescriptor,__decorateClass$h=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$h(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$h(e,I,tr),tr};let Thread=class{id;title;status;userId;created_at;updated_at;messages;initial_llm_id;llm;session_id;session};__decorateClass$h([PrimaryGeneratedColumn("uuid")],Thread.prototype,"id",2);__decorateClass$h([Column({type:"text"})],Thread.prototype,"title",2);__decorateClass$h([Column({type:"text"})],Thread.prototype,"status",2);__decorateClass$h([Column({type:"text",nullable:!0})],Thread.prototype,"userId",2);__decorateClass$h([CreateDateColumn()],Thread.prototype,"created_at",2);__decorateClass$h([UpdateDateColumn()],Thread.prototype,"updated_at",2);__decorateClass$h([OneToMany(()=>Message,k=>k.thread,{onDelete:"CASCADE"})],Thread.prototype,"messages",2);__decorateClass$h([Column("uuid")],Thread.prototype,"initial_llm_id",2);__decorateClass$h([ManyToOne(()=>LLM,k=>k.threads,{createForeignKeyConstraints:!1}),JoinColumn({name:"initial_llm_id"})],Thread.prototype,"llm",2);__decorateClass$h([Column("uuid")],Thread.prototype,"session_id",2);__decorateClass$h([ManyToOne(()=>Session,k=>k.threads,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Thread.prototype,"session",2);Thread=__decorateClass$h([Entity({name:TABLE_NAMES.Thread})],Thread);var __defProp$g=Object.defineProperty,__getOwnPropDesc$g=Object.getOwnPropertyDescriptor,__decorateClass$g=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$g(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$g(e,I,tr),tr};let Message=class{id;content;role;status;metadata;output;hidden;created_at;updated_at;parent_message_id;message;thread_id;thread;llm_id;llm;prompt_id;prompt;session_id;session};__decorateClass$g([PrimaryGeneratedColumn("uuid")],Message.prototype,"id",2);__decorateClass$g([Column({type:"text"})],Message.prototype,"content",2);__decorateClass$g([Column({type:"text"})],Message.prototype,"role",2);__decorateClass$g([Column({type:"text"})],Message.prototype,"status",2);__decorateClass$g([Column({type:"text",nullable:!0})],Message.prototype,"metadata",2);__decorateClass$g([Column({type:"text",nullable:!0})],Message.prototype,"output",2);__decorateClass$g([Column({type:"boolean",nullable:!0})],Message.prototype,"hidden",2);__decorateClass$g([CreateDateColumn()],Message.prototype,"created_at",2);__decorateClass$g([UpdateDateColumn()],Message.prototype,"updated_at",2);__decorateClass$g([Column("uuid",{nullable:!0})],Message.prototype,"parent_message_id",2);__decorateClass$g([OneToOne(()=>Message,k=>k.message,{createForeignKeyConstraints:!1}),JoinColumn({name:"parent_message_id"})],Message.prototype,"message",2);__decorateClass$g([Column("uuid")],Message.prototype,"thread_id",2);__decorateClass$g([ManyToOne(()=>Thread,k=>k.messages,{createForeignKeyConstraints:!1}),JoinColumn({name:"thread_id"})],Message.prototype,"thread",2);__decorateClass$g([Column("uuid")],Message.prototype,"llm_id",2);__decorateClass$g([ManyToOne(()=>LLM,k=>k.messages,{createForeignKeyConstraints:!1}),JoinColumn({name:"llm_id"})],Message.prototype,"llm",2);__decorateClass$g([Column("uuid",{nullable:!0})],Message.prototype,"prompt_id",2);__decorateClass$g([ManyToOne(()=>Prompt,k=>k.messages,{createForeignKeyConstraints:!1}),JoinColumn({name:"prompt_id"})],Message.prototype,"prompt",2);__decorateClass$g([Column("uuid")],Message.prototype,"session_id",2);__decorateClass$g([ManyToOne(()=>Session,k=>k.messages,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Message.prototype,"session",2);Message=__decorateClass$g([Entity({name:TABLE_NAMES.Message})],Message);var __defProp$f=Object.defineProperty,__getOwnPropDesc$f=Object.getOwnPropertyDescriptor,__decorateClass$f=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$f(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$f(e,I,tr),tr};let LLM=class{id;name;status;provider;model_type;function_calling;metadata;connection_info;parameters;options;encrypted;created_at;updated_at;messages;threads;session_id;session};__decorateClass$f([PrimaryGeneratedColumn("uuid")],LLM.prototype,"id",2);__decorateClass$f([Column({type:"text"})],LLM.prototype,"name",2);__decorateClass$f([Column({type:"text"})],LLM.prototype,"status",2);__decorateClass$f([Column({type:"text"})],LLM.prototype,"provider",2);__decorateClass$f([Column({type:"text"})],LLM.prototype,"model_type",2);__decorateClass$f([Column({type:"boolean",nullable:!0})],LLM.prototype,"function_calling",2);__decorateClass$f([Column({type:"text",nullable:!0})],LLM.prototype,"metadata",2);__decorateClass$f([Column({type:"text",nullable:!0})],LLM.prototype,"connection_info",2);__decorateClass$f([Column({type:"json",nullable:!0})],LLM.prototype,"parameters",2);__decorateClass$f([Column({type:"json",nullable:!0})],LLM.prototype,"options",2);__decorateClass$f([Column({type:"json",nullable:!0})],LLM.prototype,"encrypted",2);__decorateClass$f([CreateDateColumn()],LLM.prototype,"created_at",2);__decorateClass$f([UpdateDateColumn()],LLM.prototype,"updated_at",2);__decorateClass$f([OneToMany(()=>Message,k=>k.thread)],LLM.prototype,"messages",2);__decorateClass$f([OneToMany(()=>Thread,k=>k.llm)],LLM.prototype,"threads",2);__decorateClass$f([Column("uuid")],LLM.prototype,"session_id",2);__decorateClass$f([ManyToOne(()=>Session,k=>k.llms,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],LLM.prototype,"session",2);LLM=__decorateClass$f([Entity({name:TABLE_NAMES.LLM})],LLM);var __defProp$e=Object.defineProperty,__getOwnPropDesc$e=Object.getOwnPropertyDescriptor,__decorateClass$e=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$e(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$e(e,I,tr),tr};let FlowNode=class{id;node_type;source_id;source_type;x;y;width;height;data;metadata;raw;created_at;updated_at;session_id;session};__decorateClass$e([PrimaryGeneratedColumn("uuid")],FlowNode.prototype,"id",2);__decorateClass$e([Column({type:"text"})],FlowNode.prototype,"node_type",2);__decorateClass$e([Column({type:"text",nullable:!0})],FlowNode.prototype,"source_id",2);__decorateClass$e([Column({type:"text",nullable:!0})],FlowNode.prototype,"source_type",2);__decorateClass$e([Column({type:"float"})],FlowNode.prototype,"x",2);__decorateClass$e([Column({type:"float"})],FlowNode.prototype,"y",2);__decorateClass$e([Column({type:"float",nullable:!0})],FlowNode.prototype,"width",2);__decorateClass$e([Column({type:"float",nullable:!0})],FlowNode.prototype,"height",2);__decorateClass$e([Column({type:"json",nullable:!0})],FlowNode.prototype,"data",2);__decorateClass$e([Column({type:"json",nullable:!0})],FlowNode.prototype,"metadata",2);__decorateClass$e([Column({type:"text",nullable:!0})],FlowNode.prototype,"raw",2);__decorateClass$e([CreateDateColumn()],FlowNode.prototype,"created_at",2);__decorateClass$e([UpdateDateColumn()],FlowNode.prototype,"updated_at",2);__decorateClass$e([Column("uuid")],FlowNode.prototype,"session_id",2);__decorateClass$e([ManyToOne(()=>Session,k=>k.flow_nodes,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],FlowNode.prototype,"session",2);FlowNode=__decorateClass$e([Entity({name:TABLE_NAMES.FlowNode})],FlowNode);var __defProp$d=Object.defineProperty,__getOwnPropDesc$d=Object.getOwnPropertyDescriptor,__decorateClass$d=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$d(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$d(e,I,tr),tr};let FlowEdge=class{id;type;source;target;sourceHandle;targetHandle;animated;hidden;deletable;selectable;created_at;updated_at;session_id;session};__decorateClass$d([PrimaryGeneratedColumn("uuid")],FlowEdge.prototype,"id",2);__decorateClass$d([Column({nullable:!0,type:"text"})],FlowEdge.prototype,"type",2);__decorateClass$d([Column({type:"text"})],FlowEdge.prototype,"source",2);__decorateClass$d([Column({type:"text"})],FlowEdge.prototype,"target",2);__decorateClass$d([Column({nullable:!0,type:"text"})],FlowEdge.prototype,"sourceHandle",2);__decorateClass$d([Column({nullable:!0,type:"text"})],FlowEdge.prototype,"targetHandle",2);__decorateClass$d([Column({default:!1,type:"boolean"})],FlowEdge.prototype,"animated",2);__decorateClass$d([Column({default:!1,type:"boolean"})],FlowEdge.prototype,"hidden",2);__decorateClass$d([Column({default:!0,type:"boolean"})],FlowEdge.prototype,"deletable",2);__decorateClass$d([Column({default:!0,type:"boolean"})],FlowEdge.prototype,"selectable",2);__decorateClass$d([CreateDateColumn()],FlowEdge.prototype,"created_at",2);__decorateClass$d([UpdateDateColumn()],FlowEdge.prototype,"updated_at",2);__decorateClass$d([Column("uuid")],FlowEdge.prototype,"session_id",2);__decorateClass$d([ManyToOne(()=>Session,k=>k.flow_edges,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],FlowEdge.prototype,"session",2);FlowEdge=__decorateClass$d([Entity({name:TABLE_NAMES.FlowEdge})],FlowEdge);var __defProp$c=Object.defineProperty,__getOwnPropDesc$c=Object.getOwnPropertyDescriptor,__decorateClass$c=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$c(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$c(e,I,tr),tr};let Prompt=class{id;prefix;content;suffix;type;role;status;metadata;created_at;updated_at;messages;variables;session_id;session};__decorateClass$c([PrimaryGeneratedColumn("uuid")],Prompt.prototype,"id",2);__decorateClass$c([Column({type:"text",nullable:!0})],Prompt.prototype,"prefix",2);__decorateClass$c([Column({type:"text"})],Prompt.prototype,"content",2);__decorateClass$c([Column({type:"text",nullable:!0})],Prompt.prototype,"suffix",2);__decorateClass$c([Column({type:"text"})],Prompt.prototype,"type",2);__decorateClass$c([Column({type:"text"})],Prompt.prototype,"role",2);__decorateClass$c([Column({type:"text"})],Prompt.prototype,"status",2);__decorateClass$c([Column({type:"text",nullable:!0})],Prompt.prototype,"metadata",2);__decorateClass$c([CreateDateColumn()],Prompt.prototype,"created_at",2);__decorateClass$c([UpdateDateColumn()],Prompt.prototype,"updated_at",2);__decorateClass$c([OneToMany(()=>Message,k=>k.prompt)],Prompt.prototype,"messages",2);__decorateClass$c([OneToMany(()=>PromptVariable,k=>k.prompt,{onDelete:"CASCADE"})],Prompt.prototype,"variables",2);__decorateClass$c([Column("uuid")],Prompt.prototype,"session_id",2);__decorateClass$c([ManyToOne(()=>Session,k=>k.prompts,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Prompt.prototype,"session",2);Prompt=__decorateClass$c([Entity({name:TABLE_NAMES.Prompt})],Prompt);var __defProp$b=Object.defineProperty,__getOwnPropDesc$b=Object.getOwnPropertyDescriptor,__decorateClass$b=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$b(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$b(e,I,tr),tr};let PromptVariable=class{id;name;type;value;map_field;map_key;map_id;map_type;metadata;created_at;updated_at;messages;prompt_id;prompt;session_id;session};__decorateClass$b([PrimaryGeneratedColumn("uuid")],PromptVariable.prototype,"id",2);__decorateClass$b([Column({type:"text"})],PromptVariable.prototype,"name",2);__decorateClass$b([Column({type:"text"})],PromptVariable.prototype,"type",2);__decorateClass$b([Column({type:"text",nullable:!0})],PromptVariable.prototype,"value",2);__decorateClass$b([Column({type:"text"})],PromptVariable.prototype,"map_field",2);__decorateClass$b([Column({type:"text",nullable:!0})],PromptVariable.prototype,"map_key",2);__decorateClass$b([Column({type:"text"})],PromptVariable.prototype,"map_id",2);__decorateClass$b([Column({type:"text"})],PromptVariable.prototype,"map_type",2);__decorateClass$b([Column({type:"text",nullable:!0})],PromptVariable.prototype,"metadata",2);__decorateClass$b([CreateDateColumn()],PromptVariable.prototype,"created_at",2);__decorateClass$b([UpdateDateColumn()],PromptVariable.prototype,"updated_at",2);__decorateClass$b([OneToMany(()=>Message,k=>k.prompt)],PromptVariable.prototype,"messages",2);__decorateClass$b([Column("uuid",{nullable:!0})],PromptVariable.prototype,"prompt_id",2);__decorateClass$b([ManyToOne(()=>Prompt,k=>k.variables,{createForeignKeyConstraints:!1}),JoinColumn({name:"prompt_id"})],PromptVariable.prototype,"prompt",2);__decorateClass$b([Column("uuid")],PromptVariable.prototype,"session_id",2);__decorateClass$b([ManyToOne(()=>Session,k=>k.prompt_variables,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],PromptVariable.prototype,"session",2);PromptVariable=__decorateClass$b([Entity({name:TABLE_NAMES.PromptVariable})],PromptVariable);var __defProp$a=Object.defineProperty,__getOwnPropDesc$a=Object.getOwnPropertyDescriptor,__decorateClass$a=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$a(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$a(e,I,tr),tr};let Session=class{id;name;status;type;metadata;main_source_id;main_source_type;passphrase;created_at;updated_at;main_node_id;main_node;prompts;prompt_variables;threads;messages;llms;flow_nodes;flow_edges;schemas;schema_items;csv_datas;vector_databases;json_datas;jsonl_datas;tool_definitions;mcps};__decorateClass$a([PrimaryGeneratedColumn("uuid")],Session.prototype,"id",2);__decorateClass$a([Column({type:"text"})],Session.prototype,"name",2);__decorateClass$a([Column({type:"text"})],Session.prototype,"status",2);__decorateClass$a([Column({type:"text",default:SessionTypeEnum.Whiteboard})],Session.prototype,"type",2);__decorateClass$a([Column({type:"text",nullable:!0})],Session.prototype,"metadata",2);__decorateClass$a([Column({type:"text",nullable:!0})],Session.prototype,"main_source_id",2);__decorateClass$a([Column({type:"text",nullable:!0})],Session.prototype,"main_source_type",2);__decorateClass$a([Column({type:"text",nullable:!0})],Session.prototype,"passphrase",2);__decorateClass$a([CreateDateColumn()],Session.prototype,"created_at",2);__decorateClass$a([UpdateDateColumn()],Session.prototype,"updated_at",2);__decorateClass$a([Column({type:"uuid",nullable:!0})],Session.prototype,"main_node_id",2);__decorateClass$a([OneToOne(()=>FlowNode,{createForeignKeyConstraints:!1}),JoinColumn({name:"main_node_id"})],Session.prototype,"main_node",2);__decorateClass$a([OneToMany(()=>Prompt,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"prompts",2);__decorateClass$a([OneToMany(()=>PromptVariable,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"prompt_variables",2);__decorateClass$a([OneToMany(()=>Thread,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"threads",2);__decorateClass$a([OneToMany(()=>Message,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"messages",2);__decorateClass$a([OneToMany(()=>LLM,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"llms",2);__decorateClass$a([OneToMany(()=>FlowNode,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"flow_nodes",2);__decorateClass$a([OneToMany(()=>FlowEdge,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"flow_edges",2);__decorateClass$a([OneToMany(()=>Schema,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"schemas",2);__decorateClass$a([OneToMany(()=>SchemaItem,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"schema_items",2);__decorateClass$a([OneToMany(()=>CSVData,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"csv_datas",2);__decorateClass$a([OneToMany(()=>VectorDatabase,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"vector_databases",2);__decorateClass$a([OneToMany(()=>JSONData,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"json_datas",2);__decorateClass$a([OneToMany(()=>JSONLData,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"jsonl_datas",2);__decorateClass$a([OneToMany(()=>ToolDefinition,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"tool_definitions",2);__decorateClass$a([OneToMany(()=>Mcp,k=>k.session,{onDelete:"CASCADE"})],Session.prototype,"mcps",2);Session=__decorateClass$a([Entity({name:TABLE_NAMES.Session})],Session);var __defProp$9=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$9(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$9(e,I,tr),tr};let Schema=class{id;name;created_at;updated_at;schema_items;session_id;session};__decorateClass$9([PrimaryGeneratedColumn("uuid")],Schema.prototype,"id",2);__decorateClass$9([Column({type:"text"})],Schema.prototype,"name",2);__decorateClass$9([CreateDateColumn()],Schema.prototype,"created_at",2);__decorateClass$9([UpdateDateColumn()],Schema.prototype,"updated_at",2);__decorateClass$9([OneToMany(()=>SchemaItem,k=>k.schema,{onDelete:"CASCADE"})],Schema.prototype,"schema_items",2);__decorateClass$9([Column("uuid")],Schema.prototype,"session_id",2);__decorateClass$9([ManyToOne(()=>Session,k=>k.schemas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Schema.prototype,"session",2);Schema=__decorateClass$9([Entity({name:TABLE_NAMES.Schema})],Schema);var __defProp$8=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$8(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$8(e,I,tr),tr};let SchemaItem=class{id;name;description;required;type;metadata;enum;created_at;updated_at;schemas;parent_id;parent;schema_id;schema;session_id;session};__decorateClass$8([PrimaryGeneratedColumn("uuid")],SchemaItem.prototype,"id",2);__decorateClass$8([Column({type:"text"})],SchemaItem.prototype,"name",2);__decorateClass$8([Column({type:"text",nullable:!0})],SchemaItem.prototype,"description",2);__decorateClass$8([Column({type:"boolean"})],SchemaItem.prototype,"required",2);__decorateClass$8([Column({type:"text"})],SchemaItem.prototype,"type",2);__decorateClass$8([Column({type:"text",nullable:!0})],SchemaItem.prototype,"metadata",2);__decorateClass$8([Column({type:"text",nullable:!0})],SchemaItem.prototype,"enum",2);__decorateClass$8([CreateDateColumn()],SchemaItem.prototype,"created_at",2);__decorateClass$8([UpdateDateColumn()],SchemaItem.prototype,"updated_at",2);__decorateClass$8([OneToMany(()=>SchemaItem,k=>k.parent)],SchemaItem.prototype,"schemas",2);__decorateClass$8([Column("uuid",{nullable:!0})],SchemaItem.prototype,"parent_id",2);__decorateClass$8([ManyToOne(()=>SchemaItem,k=>k.schemas,{createForeignKeyConstraints:!1}),JoinColumn({name:"parent_id"})],SchemaItem.prototype,"parent",2);__decorateClass$8([Column("uuid")],SchemaItem.prototype,"schema_id",2);__decorateClass$8([ManyToOne(()=>Schema,k=>k.schema_items,{createForeignKeyConstraints:!1}),JoinColumn({name:"schema_id"})],SchemaItem.prototype,"schema",2);__decorateClass$8([Column("uuid")],SchemaItem.prototype,"session_id",2);__decorateClass$8([ManyToOne(()=>Session,k=>k.schema_items,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],SchemaItem.prototype,"session",2);SchemaItem=__decorateClass$8([Entity({name:TABLE_NAMES.SchemaItem})],SchemaItem);var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$7(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$7(e,I,tr),tr};let JSONData=class{id;headers;json;data;metadata;created_at;updated_at;session_id;session};__decorateClass$7([PrimaryGeneratedColumn("uuid")],JSONData.prototype,"id",2);__decorateClass$7([Column({type:"text"})],JSONData.prototype,"headers",2);__decorateClass$7([Column({type:"text"})],JSONData.prototype,"json",2);__decorateClass$7([Column({type:"json",nullable:!0})],JSONData.prototype,"data",2);__decorateClass$7([Column({type:"text",nullable:!0})],JSONData.prototype,"metadata",2);__decorateClass$7([CreateDateColumn()],JSONData.prototype,"created_at",2);__decorateClass$7([UpdateDateColumn()],JSONData.prototype,"updated_at",2);__decorateClass$7([Column("uuid")],JSONData.prototype,"session_id",2);__decorateClass$7([ManyToOne(()=>Session,k=>k.json_datas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],JSONData.prototype,"session",2);JSONData=__decorateClass$7([Entity({name:TABLE_NAMES.JSONData})],JSONData);var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$6(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$6(e,I,tr),tr};let CSVData=class{id;headers;csv;metadata;created_at;updated_at;session_id;session};__decorateClass$6([PrimaryGeneratedColumn("uuid")],CSVData.prototype,"id",2);__decorateClass$6([Column({type:"text"})],CSVData.prototype,"headers",2);__decorateClass$6([Column({type:"text"})],CSVData.prototype,"csv",2);__decorateClass$6([Column({type:"text",nullable:!0})],CSVData.prototype,"metadata",2);__decorateClass$6([CreateDateColumn()],CSVData.prototype,"created_at",2);__decorateClass$6([UpdateDateColumn()],CSVData.prototype,"updated_at",2);__decorateClass$6([Column("uuid")],CSVData.prototype,"session_id",2);__decorateClass$6([ManyToOne(()=>Session,k=>k.csv_datas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],CSVData.prototype,"session",2);CSVData=__decorateClass$6([Entity({name:TABLE_NAMES.CSVData})],CSVData);var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$5(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$5(e,I,tr),tr};let ToolDefinition=class{id;name;description;type;metadata;created_at;updated_at;session_id;session};__decorateClass$5([PrimaryGeneratedColumn("uuid")],ToolDefinition.prototype,"id",2);__decorateClass$5([Column({type:"text"})],ToolDefinition.prototype,"name",2);__decorateClass$5([Column({type:"text"})],ToolDefinition.prototype,"description",2);__decorateClass$5([Column({type:"text",nullable:!0})],ToolDefinition.prototype,"type",2);__decorateClass$5([Column({type:"text",nullable:!0})],ToolDefinition.prototype,"metadata",2);__decorateClass$5([CreateDateColumn()],ToolDefinition.prototype,"created_at",2);__decorateClass$5([UpdateDateColumn()],ToolDefinition.prototype,"updated_at",2);__decorateClass$5([Column("uuid")],ToolDefinition.prototype,"session_id",2);__decorateClass$5([ManyToOne(()=>Session,k=>k.tool_definitions,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],ToolDefinition.prototype,"session",2);ToolDefinition=__decorateClass$5([Entity({name:TABLE_NAMES.ToolDefinition})],ToolDefinition);var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$4(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$4(e,I,tr),tr};let VectorDatabase=class{id;name;type;provider;storage;metadata;raw;data;created_at;updated_at;session_id;session};__decorateClass$4([PrimaryGeneratedColumn("uuid")],VectorDatabase.prototype,"id",2);__decorateClass$4([Column({type:"text"})],VectorDatabase.prototype,"name",2);__decorateClass$4([Column({type:"text"})],VectorDatabase.prototype,"type",2);__decorateClass$4([Column({type:"text",nullable:!0})],VectorDatabase.prototype,"provider",2);__decorateClass$4([Column({type:"text",nullable:!0})],VectorDatabase.prototype,"storage",2);__decorateClass$4([Column({type:"text",nullable:!0})],VectorDatabase.prototype,"metadata",2);__decorateClass$4([Column({type:"text",nullable:!0})],VectorDatabase.prototype,"raw",2);__decorateClass$4([Column({type:"json",nullable:!0})],VectorDatabase.prototype,"data",2);__decorateClass$4([CreateDateColumn()],VectorDatabase.prototype,"created_at",2);__decorateClass$4([UpdateDateColumn()],VectorDatabase.prototype,"updated_at",2);__decorateClass$4([Column("uuid")],VectorDatabase.prototype,"session_id",2);__decorateClass$4([ManyToOne(()=>Session,k=>k.vector_databases,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],VectorDatabase.prototype,"session",2);VectorDatabase=__decorateClass$4([Entity({name:TABLE_NAMES.VectorDatabase})],VectorDatabase);var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$3(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$3(e,I,tr),tr};let JSONLData=class{id;headers;jsonl;data;metadata;created_at;updated_at;session_id;session};__decorateClass$3([PrimaryGeneratedColumn("uuid")],JSONLData.prototype,"id",2);__decorateClass$3([Column({type:"text"})],JSONLData.prototype,"headers",2);__decorateClass$3([Column({type:"text"})],JSONLData.prototype,"jsonl",2);__decorateClass$3([Column({type:"json",nullable:!0})],JSONLData.prototype,"data",2);__decorateClass$3([Column({type:"text",nullable:!0})],JSONLData.prototype,"metadata",2);__decorateClass$3([CreateDateColumn()],JSONLData.prototype,"created_at",2);__decorateClass$3([UpdateDateColumn()],JSONLData.prototype,"updated_at",2);__decorateClass$3([Column("uuid")],JSONLData.prototype,"session_id",2);__decorateClass$3([ManyToOne(()=>Session,k=>k.jsonl_datas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],JSONLData.prototype,"session",2);JSONLData=__decorateClass$3([Entity({name:TABLE_NAMES.JSONLData})],JSONLData);var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$2(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$2(e,I,tr),tr};let FlowNodeData=class{id;data;metadata;properties;created_at;updated_at;session_id;session};__decorateClass$2([PrimaryGeneratedColumn("uuid")],FlowNodeData.prototype,"id",2);__decorateClass$2([Column({type:"json",nullable:!0})],FlowNodeData.prototype,"data",2);__decorateClass$2([Column({type:"json",nullable:!0})],FlowNodeData.prototype,"metadata",2);__decorateClass$2([Column({type:"json",nullable:!0})],FlowNodeData.prototype,"properties",2);__decorateClass$2([CreateDateColumn()],FlowNodeData.prototype,"created_at",2);__decorateClass$2([UpdateDateColumn()],FlowNodeData.prototype,"updated_at",2);__decorateClass$2([Column("uuid")],FlowNodeData.prototype,"session_id",2);__decorateClass$2([ManyToOne(()=>Session,k=>k.flow_nodes,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],FlowNodeData.prototype,"session",2);FlowNodeData=__decorateClass$2([Entity({name:TABLE_NAMES.FlowNodeData})],FlowNodeData);var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc$1(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp$1(e,I,tr),tr};let FlowNodePlaceholder=class{id;placeholder;placeholder_type;data;metadata;encrypted;created_at;updated_at;session_id;session};__decorateClass$1([PrimaryGeneratedColumn("uuid")],FlowNodePlaceholder.prototype,"id",2);__decorateClass$1([Column({type:"text",nullable:!0})],FlowNodePlaceholder.prototype,"placeholder",2);__decorateClass$1([Column({type:"text",nullable:!0})],FlowNodePlaceholder.prototype,"placeholder_type",2);__decorateClass$1([Column({type:"json",nullable:!0})],FlowNodePlaceholder.prototype,"data",2);__decorateClass$1([Column({type:"json",nullable:!0})],FlowNodePlaceholder.prototype,"metadata",2);__decorateClass$1([Column({type:"json",nullable:!0})],FlowNodePlaceholder.prototype,"encrypted",2);__decorateClass$1([CreateDateColumn()],FlowNodePlaceholder.prototype,"created_at",2);__decorateClass$1([UpdateDateColumn()],FlowNodePlaceholder.prototype,"updated_at",2);__decorateClass$1([Column("uuid")],FlowNodePlaceholder.prototype,"session_id",2);__decorateClass$1([ManyToOne(()=>Session,k=>k.flow_nodes,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],FlowNodePlaceholder.prototype,"session",2);FlowNodePlaceholder=__decorateClass$1([Entity({name:TABLE_NAMES.FlowNodePlaceholder})],FlowNodePlaceholder);var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(k,e,I,B)=>{for(var tr=B>1?void 0:B?__getOwnPropDesc(e,I):e,rr=k.length-1,ir;rr>=0;rr--)(ir=k[rr])&&(tr=(B?ir(e,I,tr):ir(tr))||tr);return B&&tr&&__defProp(e,I,tr),tr};let Mcp=class{id;key;url;metadata;session_id;session;created_at;updated_at};__decorateClass([PrimaryGeneratedColumn("uuid")],Mcp.prototype,"id",2);__decorateClass([Column({type:"text"})],Mcp.prototype,"key",2);__decorateClass([Column({type:"text"})],Mcp.prototype,"url",2);__decorateClass([Column({type:"jsonb",nullable:!0})],Mcp.prototype,"metadata",2);__decorateClass([Column("uuid")],Mcp.prototype,"session_id",2);__decorateClass([ManyToOne(()=>Session,k=>k.schemas,{createForeignKeyConstraints:!1}),JoinColumn({name:"session_id"})],Mcp.prototype,"session",2);__decorateClass([CreateDateColumn()],Mcp.prototype,"created_at",2);__decorateClass([UpdateDateColumn()],Mcp.prototype,"updated_at",2);Mcp=__decorateClass([Entity({name:TABLE_NAMES.MCP})],Mcp);const entitiesMap={LLM,Thread,Message,FlowNode,FlowEdge,Prompt,PromptVariable,Session,Schema,SchemaItem,JSONData,CSVData,ToolDefinition,VectorDatabase,JSONLData,FlowNodeData,FlowNodePlaceholder,Mcp},isPlainObject=k=>!!k&&typeof k=="object"&&!Array.isArray(k),isFindOperator=k=>!!k&&typeof k=="object"&&"type"in k&&"@instanceof"in k,reconstructFindOperator=k=>{if(isPlainObject(k)&&isFindOperator(k))switch(k.type){case"moreThan":return MoreThan(k.value);case"lessThan":return LessThan(k.value);case"equal":return Equal(k.value);case"like":return Like(k.value);case"in":return In$1(k.value);case"not":return Not(k.value);case"isNull":return IsNull();case"between":return Between(k.value[0],k.value[1]);case"lessThanOrEqual":return LessThanOrEqual(k.value);case"moreThanOrEqual":return MoreThanOrEqual(k.value);case"any":return Any(k.value);case"arrayContainedBy":return ArrayContainedBy(k.value);case"arrayContains":return ArrayContains(k.value);case"arrayOverlap":return ArrayOverlap(k.value);case"raw":return Raw(`${k.value}`);default:throw new Error(`Unsupported FindOperator type: ${k.type}`)}return k},transformBridgeJSONObjectToQuery=k=>{if(k==null||typeof k=="string"||typeof k=="number")return k;if(typeof k=="object"){if(Array.isArray(k))return k.map(I=>transformBridgeJSONObjectToQuery(I));const e={};return Object.keys(k).forEach(I=>{const B=k[I];isFindOperator(B)?e[I]=reconstructFindOperator(B):B&&typeof B=="object"&&B!==null?e[I]=transformBridgeJSONObjectToQuery(B):e[I]=B}),e}return k};var WorkerExecutionType=(k=>(k.INIT="init",k.REPOSITORY_EXECUTE="repository-execute",k.RAW_QUERY_EXECUTE="raw-query-execute",k))(WorkerExecutionType||{});let appDataSource,initProcess;const initDatabase=async()=>{if(appDataSource=new DataSource({type:"postgres",driver:new PGliteDriver({dataDir:"idb://local-db",extensions:{uuid_ossp:o$2}}).driver,entities:Object.values(entitiesMap),logging:[...DATABASE_LOG_CONFIG.logging],synchronize:!0,logger:DATABASE_LOG_CONFIG.logger,entitySkipConstructor:!0}),!appDataSource)throw new Error("Database not initialized");await appDataSource.initialize(),initProcess=void 0,logDebug("Database initialized with log config:",DATABASE_LOG_CONFIG)},getRepositoryAction=async(k,e,I)=>{if(!appDataSource)throw new Error("Database not initialized");if(!entitiesMap[k])throw new Error(`Entity not found: ${k}`);switch(e){case"find":return appDataSource.getRepository(entitiesMap[k]).find(transformBridgeJSONObjectToQuery(I));case"findOne":return appDataSource.getRepository(entitiesMap[k]).findOne(transformBridgeJSONObjectToQuery(I));case"count":return appDataSource.getRepository(entitiesMap[k]).count(transformBridgeJSONObjectToQuery(I));case"save":return appDataSource.getRepository(entitiesMap[k]).save(I);case"update":if(typeof I!="object"||!("id"in I)||!("update"in I))throw new Error("Invalid data for update");return appDataSource.getRepository(entitiesMap[k]).update(I.id,I.update);case"delete":if(typeof I!="string"&&typeof I!="number")throw new Error("Invalid data for delete");return appDataSource.getRepository(entitiesMap[k]).delete(I);default:throw new Error(`Unknown action: ${e}`)}};async function handlePayload(k){if(!(!k.messageId||!Object.keys(k).length))switch(logDebug("[Database worker received message]",k,k.type),k.type){case WorkerExecutionType.INIT:return appDataSource||initProcess?"Database already initialized":(initProcess=init(),await initProcess,initProcess=void 0,"Database initialized");case WorkerExecutionType.REPOSITORY_EXECUTE:{if(initProcess&&await initProcess,!appDataSource)throw new Error("Database not initialized");const[I,B,tr]=k.payload;return getRepositoryAction(I,B,tr)}case WorkerExecutionType.RAW_QUERY_EXECUTE:{if(initProcess&&await initProcess,!appDataSource)throw new Error("Database not initialized");return appDataSource.query(...k.payload)}default:throw new Error("Invalid operation")}}listenForMessages(handlePayload);logInfo("Database worker initialized");init(async()=>{initProcess=initDatabase()});export{C,R$2 as R,T$1 as T,U$1 as U,ur as a,cr as c,h$1 as h,pr as p,u$1 as u,x$2 as x};
//# sourceMappingURL=database.worker-Dzf_vQEW.js.map
