import{__tla as Sa}from"./routes-u3SNg5Jg.js";import{B as $t,g as Yt,C as xa,r as T,R as et,__tla as Aa}from"./index-8-pJaDMF.js";let Wt,Ra=Promise.all([(()=>{try{return Sa}catch{}})(),(()=>{try{return Aa}catch{}})()]).then(async()=>{var rt="vercel.ai.error",Kt=Symbol.for(rt),at,Gt=class qt extends Error{constructor({name:t,message:r,cause:a}){super(r),this[at]=!0,this.name=t,this.cause=a}static isInstance(t){return qt.hasMarker(t,rt)}static hasMarker(t,r){const a=Symbol.for(r);return t!=null&&typeof t=="object"&&a in t&&typeof t[a]=="boolean"&&t[a]===!0}};at=Kt;var ie=Gt;function nt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ot="AI_InvalidArgumentError",st=`vercel.ai.error.${ot}`,zt=Symbol.for(st),it,Ht=class extends ie{constructor({message:e,cause:t,argument:r}){super({name:ot,message:e,cause:t}),this[it]=!0,this.argument=r}static isInstance(e){return ie.hasMarker(e,st)}};it=zt;var lt="AI_JSONParseError",ct=`vercel.ai.error.${lt}`,Xt=Symbol.for(ct),ut,pt=class extends ie{constructor({text:e,cause:t}){super({name:lt,message:`JSON parsing failed: Text: ${e}.
Error message: ${nt(t)}`,cause:t}),this[ut]=!0,this.text=e}static isInstance(e){return ie.hasMarker(e,ct)}};ut=Xt;var dt="AI_TypeValidationError",ft=`vercel.ai.error.${dt}`,Zt=Symbol.for(ft),gt,Qt=class tt extends ie{constructor({value:t,cause:r}){super({name:dt,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${nt(r)}`,cause:r}),this[gt]=!0,this.value=t}static isInstance(t){return ie.hasMarker(t,ft)}static wrap({value:t,cause:r}){return tt.isInstance(r)&&r.value===t?r:new tt({value:t,cause:r})}};gt=Zt;var ht=Qt;let er=(e,t=21)=>(r=t)=>{let a="",n=r|0;for(;n--;)a+=e[Math.random()*e.length|0];return a};var ne={exports:{}},mt;function tr(){if(mt)return ne.exports;mt=1;const e=typeof $t<"u",t=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,r=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function a(i,o,s){s==null&&o!==null&&typeof o=="object"&&(s=o,o=void 0),e&&$t.isBuffer(i)&&(i=i.toString()),i&&i.charCodeAt(0)===65279&&(i=i.slice(1));const f=JSON.parse(i,o);if(f===null||typeof f!="object")return f;const c=s&&s.protoAction||"error",m=s&&s.constructorAction||"error";if(c==="ignore"&&m==="ignore")return f;if(c!=="ignore"&&m!=="ignore"){if(t.test(i)===!1&&r.test(i)===!1)return f}else if(c!=="ignore"&&m==="ignore"){if(t.test(i)===!1)return f}else if(r.test(i)===!1)return f;return n(f,{protoAction:c,constructorAction:m,safe:s&&s.safe})}function n(i,{protoAction:o="error",constructorAction:s="error",safe:f}={}){let c=[i];for(;c.length;){const m=c;c=[];for(const g of m){if(o!=="ignore"&&Object.prototype.hasOwnProperty.call(g,"__proto__")){if(f===!0)return null;if(o==="error")throw new SyntaxError("Object contains forbidden prototype property");delete g.__proto__}if(s!=="ignore"&&Object.prototype.hasOwnProperty.call(g,"constructor")&&Object.prototype.hasOwnProperty.call(g.constructor,"prototype")){if(f===!0)return null;if(s==="error")throw new SyntaxError("Object contains forbidden prototype property");delete g.constructor}for(const S in g){const y=g[S];y&&typeof y=="object"&&c.push(y)}}}return i}function u(i,o,s){const f=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return a(i,o,s)}finally{Error.stackTraceLimit=f}}function l(i,o){const s=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return a(i,o,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=s}}return ne.exports=u,ne.exports.default=u,ne.exports.parse=u,ne.exports.safeParse=l,ne.exports.scan=n,ne.exports}var rr=tr();const ar=Yt(rr);var nr=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const n=er(r,t);if(e==null)return n;if(r.includes(a))throw new Ht({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return u=>`${e}${a}${n(u)}`},Re=nr(),Ce=Symbol.for("vercel.ai.validator");function or(e){return{[Ce]:!0,validate:e}}function sr(e){return typeof e=="object"&&e!==null&&Ce in e&&e[Ce]===!0&&"validate"in e}function ir(e){return sr(e)?e:lr(e)}function lr(e){return or(t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function cr({value:e,schema:t}){const r=ir(t);try{if(r.validate==null)return{success:!0,value:e};const a=r.validate(e);return a.success?a:{success:!1,error:ht.wrap({value:e,cause:a.error})}}catch(a){return{success:!1,error:ht.wrap({value:e,cause:a})}}}function yt({text:e,schema:t}){try{const r=ar.parse(e);if(t==null)return{success:!0,value:r,rawValue:r};const a=cr({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(r){return{success:!1,error:pt.isInstance(r)?r:new pt({text:e,cause:r})}}}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var me={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},ye={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},_e={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},Ee={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},be={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},ur=[me,ye,_e,Ee,be];me.code+"",ye.code+"",_e.code+"",Ee.code+"",be.code+"",me.name+"",me.code,ye.name+"",ye.code,_e.name+"",_e.code,Ee.name+"",Ee.code,be.name+"",be.code,ur.map(e=>e.code);function pr({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function dr(e){const t=["ROOT"];let r=-1,a=null;function n(o,s,f){switch(o){case'"':{r=s,t.pop(),t.push(f),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=s,a=s,t.pop(),t.push(f),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(f),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=s,t.pop(),t.push(f),t.push("INSIDE_NUMBER");break}case"{":{r=s,t.pop(),t.push(f),t.push("INSIDE_OBJECT_START");break}case"[":{r=s,t.pop(),t.push(f),t.push("INSIDE_ARRAY_START");break}}}function u(o,s){switch(o){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=s,t.pop();break}}}function l(o,s){switch(o){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=s,t.pop();break}}}for(let o=0;o<e.length;o++){const s=e[o];switch(t[t.length-1]){case"ROOT":n(s,o,"FINISH");break;case"INSIDE_OBJECT_START":{switch(s){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{r=o,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(s){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(s){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(s){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{n(s,o,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{u(s,o);break}case"INSIDE_STRING":{switch(s){case'"':{t.pop(),r=o;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=o}break}case"INSIDE_ARRAY_START":{switch(s){case"]":{r=o,t.pop();break}default:{r=o,n(s,o,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(s){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=o,t.pop();break}default:{r=o;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{n(s,o,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),r=o;break}case"INSIDE_NUMBER":{switch(s){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=o;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&l(s,o),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&u(s,o);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&u(s,o);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&l(s,o);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const f=e.substring(a,o+1);!"false".startsWith(f)&&!"true".startsWith(f)&&!"null".startsWith(f)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?u(s,o):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&l(s,o)):r=o;break}}}let i=e.slice(0,r+1);for(let o=t.length-1;o>=0;o--)switch(t[o]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const s=e.substring(a,e.length);"true".startsWith(s)?i+="true".slice(s.length):"false".startsWith(s)?i+="false".slice(s.length):"null".startsWith(s)&&(i+="null".slice(s.length))}}return i}function fr(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=yt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=yt({text:dr(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var gr={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},hr={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},mr={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},yr={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},_r={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Er={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},br={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},Ir={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},vr={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},wr={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},Tr={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},kr={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},Sr={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},xr={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},Ar={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},Rr={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},Ne=[gr,hr,mr,yr,_r,Er,br,Ir,vr,wr,Tr,kr,Sr,xr,Ar,Rr],Cr=Object.fromEntries(Ne.map(e=>[e.code,e]));Object.fromEntries(Ne.map(e=>[e.name,e.code]));var Nr=Ne.map(e=>e.code),Or=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const r=e.slice(0,t);if(!Nr.includes(r))throw new Error(`Failed to parse stream string. Invalid code ${r}.`);const a=r,n=e.slice(t+1),u=JSON.parse(n);return Cr[a].parse(u)},Dr=10;function jr(e,t){const r=new Uint8Array(t);let a=0;for(const n of e)r.set(n,a),a+=n.length;return e.length=0,r}async function Fr({stream:e,onTextPart:t,onReasoningPart:r,onReasoningSignaturePart:a,onRedactedReasoningPart:n,onSourcePart:u,onFilePart:l,onDataPart:i,onErrorPart:o,onToolCallStreamingStartPart:s,onToolCallDeltaPart:f,onToolCallPart:c,onToolResultPart:m,onMessageAnnotationsPart:g,onFinishMessagePart:S,onFinishStepPart:y,onStartStepPart:F}){const h=e.getReader(),O=new TextDecoder,N=[];let C=0;for(;;){const{value:E}=await h.read();if(E&&(N.push(E),C+=E.length,E[E.length-1]!==Dr))continue;if(N.length===0)break;const p=jr(N,C);C=0;const I=O.decode(p,{stream:!0}).split(`
`).filter(_=>_!=="").map(Or);for(const{type:_,value:v}of I)switch(_){case"text":await(t==null?void 0:t(v));break;case"reasoning":await(r==null?void 0:r(v));break;case"reasoning_signature":await(a==null?void 0:a(v));break;case"redacted_reasoning":await(n==null?void 0:n(v));break;case"file":await(l==null?void 0:l(v));break;case"source":await(u==null?void 0:u(v));break;case"data":await(i==null?void 0:i(v));break;case"error":await(o==null?void 0:o(v));break;case"message_annotations":await(g==null?void 0:g(v));break;case"tool_call_streaming_start":await(s==null?void 0:s(v));break;case"tool_call_delta":await(f==null?void 0:f(v));break;case"tool_call":await(c==null?void 0:c(v));break;case"tool_result":await(m==null?void 0:m(v));break;case"finish_message":await(S==null?void 0:S(v));break;case"finish_step":await(y==null?void 0:y(v));break;case"start_step":await(F==null?void 0:F(v));break;default:{const R=_;throw new Error(`Unknown stream part type: ${R}`)}}}}async function Lr({stream:e,update:t,onToolCall:r,onFinish:a,generateId:n=Re,getCurrentDate:u=()=>new Date,lastMessage:l}){var i,o;const s=(l==null?void 0:l.role)==="assistant";let f=s?1+((o=(i=l.toolInvocations)==null?void 0:i.reduce((p,I)=>{var _;return Math.max(p,(_=I.step)!=null?_:0)},0))!=null?o:0):0;const c=s?structuredClone(l):{id:n(),createdAt:u(),role:"assistant",content:"",parts:[]};let m,g,S;function y(p,I){const _=c.parts.find(v=>v.type==="tool-invocation"&&v.toolInvocation.toolCallId===p);_!=null?_.toolInvocation=I:c.parts.push({type:"tool-invocation",toolInvocation:I})}const F=[];let h=s?l==null?void 0:l.annotations:void 0;const O={};let N={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},C="unknown";function E(){const p=[...F];h!=null&&h.length&&(c.annotations=h);const I={...structuredClone(c),revisionId:n()};t({message:I,data:p,replaceLastMessage:s})}await Fr({stream:e,onTextPart(p){m==null?(m={type:"text",text:p},c.parts.push(m)):m.text+=p,c.content+=p,E()},onReasoningPart(p){var I;S==null?(S={type:"text",text:p},g==null||g.details.push(S)):S.text+=p,g==null?(g={type:"reasoning",reasoning:p,details:[S]},c.parts.push(g)):g.reasoning+=p,c.reasoning=((I=c.reasoning)!=null?I:"")+p,E()},onReasoningSignaturePart(p){S!=null&&(S.signature=p.signature)},onRedactedReasoningPart(p){g==null&&(g={type:"reasoning",reasoning:"",details:[]},c.parts.push(g)),g.details.push({type:"redacted",data:p.data}),S=void 0,E()},onFilePart(p){c.parts.push({type:"file",mimeType:p.mimeType,data:p.data}),E()},onSourcePart(p){c.parts.push({type:"source",source:p}),E()},onToolCallStreamingStartPart(p){c.toolInvocations==null&&(c.toolInvocations=[]),O[p.toolCallId]={text:"",step:f,toolName:p.toolName,index:c.toolInvocations.length};const I={state:"partial-call",step:f,toolCallId:p.toolCallId,toolName:p.toolName,args:void 0};c.toolInvocations.push(I),y(p.toolCallId,I),E()},onToolCallDeltaPart(p){const I=O[p.toolCallId];I.text+=p.argsTextDelta;const{value:_}=fr(I.text),v={state:"partial-call",step:I.step,toolCallId:p.toolCallId,toolName:I.toolName,args:_};c.toolInvocations[I.index]=v,y(p.toolCallId,v),E()},async onToolCallPart(p){const I={state:"call",step:f,...p};if(O[p.toolCallId]!=null?c.toolInvocations[O[p.toolCallId].index]=I:(c.toolInvocations==null&&(c.toolInvocations=[]),c.toolInvocations.push(I)),y(p.toolCallId,I),E(),r){const _=await r({toolCall:p});if(_!=null){const v={state:"result",step:f,...p,result:_};c.toolInvocations[c.toolInvocations.length-1]=v,y(p.toolCallId,v),E()}}},onToolResultPart(p){const I=c.toolInvocations;if(I==null)throw new Error("tool_result must be preceded by a tool_call");const _=I.findIndex(R=>R.toolCallId===p.toolCallId);if(_===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");const v={...I[_],state:"result",...p};I[_]=v,y(p.toolCallId,v),E()},onDataPart(p){F.push(...p),E()},onMessageAnnotationsPart(p){h==null?h=[...p]:h.push(...p),E()},onFinishStepPart(p){f+=1,m=p.isContinued?m:void 0,g=void 0,S=void 0},onStartStepPart(p){s||(c.id=p.messageId),c.parts.push({type:"step-start"}),E()},onFinishMessagePart(p){C=p.finishReason,p.usage!=null&&(N=pr(p.usage))},onErrorPart(p){throw new Error(p)}}),a==null||a({message:c,finishReason:C,usage:N})}async function Pr({stream:e,onTextPart:t}){const r=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:a,value:n}=await r.read();if(a)break;await t(n)}}async function Mr({stream:e,update:t,onFinish:r,getCurrentDate:a=()=>new Date,generateId:n=Re}){const u={type:"text",text:""},l={id:n(),createdAt:a(),role:"assistant",content:"",parts:[u]};await Pr({stream:e,onTextPart:i=>{l.content+=i,u.text+=i,t({message:{...l},data:[],replaceLastMessage:!1})}}),r==null||r(l,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}var Vr=()=>fetch;async function Br({api:e,body:t,streamProtocol:r="data",credentials:a,headers:n,abortController:u,restoreMessagesOnFailure:l,onResponse:i,onUpdate:o,onFinish:s,onToolCall:f,generateId:c,fetch:m=Vr(),lastMessage:g,requestType:S="generate"}){var y,F,h;const O=await(S==="resume"?m(`${e}?chatId=${t.id}`,{method:"GET",headers:{"Content-Type":"application/json",...n},signal:(y=u==null?void 0:u())==null?void 0:y.signal,credentials:a}):m(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...n},signal:(F=u==null?void 0:u())==null?void 0:F.signal,credentials:a})).catch(N=>{throw l(),N});if(i)try{await i(O)}catch(N){throw N}if(!O.ok)throw l(),new Error((h=await O.text())!=null?h:"Failed to fetch the chat response.");if(!O.body)throw new Error("The response body is empty.");switch(r){case"text":{await Mr({stream:O.body,update:o,onFinish:s,generateId:c});return}case"data":{await Lr({stream:O.body,update:o,lastMessage:g,onToolCall:f,onFinish({message:N,finishReason:C,usage:E}){s&&N!=null&&s(N,{usage:E,finishReason:C})},generateId:c});return}default:{const N=r;throw new Error(`Unknown stream protocol: ${N}`)}}}function Oe(e){return e==null?void 0:e.reduce((t,r)=>{var a;return Math.max(t,(a=r.step)!=null?a:0)},0)}function _t(e){var t;return(t=e.parts)!=null?t:[...e.toolInvocations?e.toolInvocations.map(r=>({type:"tool-invocation",toolInvocation:r})):[],...e.reasoning?[{type:"reasoning",reasoning:e.reasoning,details:[{type:"text",text:e.reasoning}]}]:[],...e.content?[{type:"text",text:e.content}]:[]]}function De(e){return e.map(t=>({...t,parts:_t(t)}))}function je(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!je(e[n],t[n]))return!1;return!0}const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const n of r)if(!a.includes(n)||!je(e[n],t[n]))return!1;return!0}async function Et(e){if(!e)return[];if(globalThis.FileList&&e instanceof globalThis.FileList)return Promise.all(Array.from(e).map(async t=>{const{name:r,type:a}=t,n=await new Promise((u,l)=>{const i=new FileReader;i.onload=o=>{var s;u((s=o.target)==null?void 0:s.result)},i.onerror=o=>l(o),i.readAsDataURL(t)});return{name:r,contentType:a,url:n}}));if(Array.isArray(e))return e;throw new Error("Invalid attachments type")}function Jr({originalMaxToolInvocationStep:e,originalMessageCount:t,maxSteps:r,messages:a}){var n;const u=a[a.length-1];return r>1&&u!=null&&(a.length>t||Oe(u.toolInvocations)!==e)&&bt(u)&&((n=Oe(u.toolInvocations))!=null?n:0)<r}function bt(e){if(e.role!=="assistant")return!1;const t=e.parts.reduce((a,n,u)=>n.type==="step-start"?u:a,-1),r=e.parts.slice(t+1).filter(a=>a.type==="tool-invocation");return r.length>0&&r.every(a=>"result"in a.toolInvocation)}function Ur({messages:e,toolCallId:t,toolResult:r}){var a;const n=e[e.length-1],u=n.parts.find(i=>i.type==="tool-invocation"&&i.toolInvocation.toolCallId===t);if(u==null)return;const l={...u.toolInvocation,state:"result",result:r};u.toolInvocation=l,n.toolInvocations=(a=n.toolInvocations)==null?void 0:a.map(i=>i.toolCallId===t?l:i)}var It={exports:{}},Fe={},vt;function $r(){if(vt)return Fe;vt=1;var e=xa();function t(c,m){return c===m&&(c!==0||1/c===1/m)||c!==c&&m!==m}var r=typeof Object.is=="function"?Object.is:t,a=e.useState,n=e.useEffect,u=e.useLayoutEffect,l=e.useDebugValue;function i(c,m){var g=m(),S=a({inst:{value:g,getSnapshot:m}}),y=S[0].inst,F=S[1];return u(function(){y.value=g,y.getSnapshot=m,o(y)&&F({inst:y})},[c,g,m]),n(function(){return o(y)&&F({inst:y}),c(function(){o(y)&&F({inst:y})})},[c]),l(g),g}function o(c){var m=c.getSnapshot;c=c.value;try{var g=m();return!r(c,g)}catch{return!0}}function s(c,m){return m()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?s:i;return Fe.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:f,Fe}var wt;function Yr(){return wt||(wt=1,It.exports=$r()),It.exports}var Wr=Yr();const Tt=0,kt=1,St=2,xt=3;var At=Object.prototype.hasOwnProperty;function Le(e,t){var r,a;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((a=e.length)===t.length)for(;a--&&Le(e[a],t[a]););return a===-1}if(!r||typeof e=="object"){a=0;for(r in e)if(At.call(e,r)&&++a&&!At.call(t,r)||!(r in t)||!Le(e[r],t[r]))return!1;return Object.keys(t).length===a}}return e!==e&&t!==t}const z=new WeakMap,Z=()=>{},M=Z(),Pe=Object,x=e=>e===M,K=e=>typeof e=="function",Q=(e,t)=>({...e,...t}),Rt=e=>K(e.then),Me={},Ie={},Ve="undefined",de=typeof window!=Ve,Be=typeof document!=Ve,qr=de&&"Deno"in window,Kr=()=>de&&typeof window.requestAnimationFrame!=Ve,Ct=(e,t)=>{const r=z.get(e);return[()=>!x(t)&&e.get(t)||Me,a=>{if(!x(t)){const n=e.get(t);t in Ie||(Ie[t]=n),r[5](t,Q(n,a),n||Me)}},r[6],()=>!x(t)&&t in Ie?Ie[t]:!x(t)&&e.get(t)||Me]};let Je=!0;const Gr=()=>Je,[Ue,$e]=de&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Z,Z],zr=()=>{const e=Be&&document.visibilityState;return x(e)||e!=="hidden"},Hr=e=>(Be&&document.addEventListener("visibilitychange",e),Ue("focus",e),()=>{Be&&document.removeEventListener("visibilitychange",e),$e("focus",e)}),Xr=e=>{const t=()=>{Je=!0,e()},r=()=>{Je=!1};return Ue("online",t),Ue("offline",r),()=>{$e("online",t),$e("offline",r)}},Zr={isOnline:Gr,isVisible:zr},Qr={initFocus:Hr,initReconnect:Xr},Nt=!et.useId,fe=!de||qr,ea=e=>Kr()?window.requestAnimationFrame(e):setTimeout(e,1),Ye=fe?T.useEffect:T.useLayoutEffect,We=typeof navigator<"u"&&navigator.connection,Ot=!fe&&We&&(["slow-2g","2g"].includes(We.effectiveType)||We.saveData),ve=new WeakMap,ta=e=>Pe.prototype.toString.call(e),qe=(e,t)=>e===`[object ${t}]`;let ra=0;const Ke=e=>{const t=typeof e,r=ta(e),a=qe(r,"Date"),n=qe(r,"RegExp"),u=qe(r,"Object");let l,i;if(Pe(e)===e&&!a&&!n){if(l=ve.get(e),l)return l;if(l=++ra+"~",ve.set(e,l),Array.isArray(e)){for(l="@",i=0;i<e.length;i++)l+=Ke(e[i])+",";ve.set(e,l)}if(u){l="#";const o=Pe.keys(e).sort();for(;!x(i=o.pop());)x(e[i])||(l+=i+":"+Ke(e[i])+",");ve.set(e,l)}}else l=a?e.toJSON():t=="symbol"?e.toString():t=="string"?JSON.stringify(e):""+e;return l},Ge=e=>{if(K(e))try{e=e()}catch{e=""}const t=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?Ke(e):"",[e,t]};let aa=0;const ze=()=>++aa;async function Dt(...e){const[t,r,a,n]=e,u=Q({populateCache:!0,throwOnError:!0},typeof n=="boolean"?{revalidate:n}:n||{});let l=u.populateCache;const i=u.rollbackOnError;let o=u.optimisticData;const s=m=>typeof i=="function"?i(m):i!==!1,f=u.throwOnError;if(K(r)){const m=r,g=[],S=t.keys();for(const y of S)!/^\$(inf|sub)\$/.test(y)&&m(t.get(y)._k)&&g.push(y);return Promise.all(g.map(c))}return c(r);async function c(m){const[g]=Ge(m);if(!g)return;const[S,y]=Ct(t,g),[F,h,O,N]=z.get(t),C=()=>{const D=F[g];return(K(u.revalidate)?u.revalidate(S().data,m):u.revalidate!==!1)&&(delete O[g],delete N[g],D&&D[0])?D[0](St).then(()=>S().data):S().data};if(e.length<3)return C();let E=a,p,I=!1;const _=ze();h[g]=[_,0];const v=!x(o),R=S(),Y=R.data,H=R._c,U=x(H)?Y:H;if(v&&(o=K(o)?o(U,Y):o,y({data:o,_c:U})),K(E))try{E=E(U)}catch(D){p=D,I=!0}if(E&&Rt(E))if(E=await E.catch(D=>{p=D,I=!0}),_!==h[g][0]){if(I)throw p;return E}else I&&v&&s(p)&&(l=!0,y({data:U,_c:M}));if(l&&!I)if(K(l)){const D=l(E,U);y({data:D,error:M,_c:M})}else y({data:E,error:M,_c:M});if(h[g][1]=ze(),Promise.resolve(C()).then(()=>{y({_c:M})}),I){if(f)throw p;return}return E}}const jt=(e,t)=>{for(const r in e)e[r][0]&&e[r][0](t)},na=(e,t)=>{if(!z.has(e)){const r=Q(Qr,t),a=Object.create(null),n=Dt.bind(M,e);let u=Z;const l=Object.create(null),i=(f,c)=>{const m=l[f]||[];return l[f]=m,m.push(c),()=>m.splice(m.indexOf(c),1)},o=(f,c,m)=>{e.set(f,c);const g=l[f];if(g)for(const S of g)S(c,m)},s=()=>{if(!z.has(e)&&(z.set(e,[a,Object.create(null),Object.create(null),Object.create(null),n,o,i]),!fe)){const f=r.initFocus(setTimeout.bind(M,jt.bind(M,a,Tt))),c=r.initReconnect(setTimeout.bind(M,jt.bind(M,a,kt)));u=()=>{f&&f(),c&&c(),z.delete(e)}}};return s(),[e,n,s,u]}return[e,z.get(e)[4]]},oa=(e,t,r,a,n)=>{const u=r.errorRetryCount,l=n.retryCount,i=~~((Math.random()+.5)*(1<<(l<8?l:8)))*r.errorRetryInterval;!x(u)&&l>u||setTimeout(a,i,n)},sa=Le,[Ft,ia]=na(new Map),la=Q({onLoadingSlow:Z,onSuccess:Z,onError:Z,onErrorRetry:oa,onDiscarded:Z,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Ot?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Ot?5e3:3e3,compare:sa,isPaused:()=>!1,cache:Ft,mutate:ia,fallback:{}},Zr),ca=(e,t)=>{const r=Q(e,t);if(t){const{use:a,fallback:n}=e,{use:u,fallback:l}=t;a&&u&&(r.use=a.concat(u)),n&&l&&(r.fallback=Q(n,l))}return r},ua=T.createContext({}),pa="$inf$",Lt=de&&window.__SWR_DEVTOOLS_USE__,da=Lt?window.__SWR_DEVTOOLS_USE__:[],fa=()=>{Lt&&(window.__SWR_DEVTOOLS_REACT__=et)},ga=e=>K(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(e[1]===null?e[2]:e[1])||{}],ha=()=>Q(la,T.useContext(ua)),ma=e=>(t,r,a)=>e(t,r&&((...n)=>{const[u]=Ge(t),[,,,l]=z.get(Ft);if(u.startsWith(pa))return r(...n);const i=l[u];return x(i)?r(...n):(delete l[u],i)}),a),ya=da.concat(ma),_a=e=>function(...t){const r=ha(),[a,n,u]=ga(t),l=ca(r,u);let i=e;const{use:o}=l,s=(o||[]).concat(ya);for(let f=s.length;f--;)i=s[f](i);return i(a,n||l.fetcher||null,l)},Ea=(e,t,r)=>{const a=t[e]||(t[e]=[]);return a.push(r),()=>{const n=a.indexOf(r);n>=0&&(a[n]=a[a.length-1],a.pop())}};fa();const He=et.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}}),Xe={dedupe:!0},ba=(e,t,r)=>{const{cache:a,compare:n,suspense:u,fallbackData:l,revalidateOnMount:i,revalidateIfStale:o,refreshInterval:s,refreshWhenHidden:f,refreshWhenOffline:c,keepPreviousData:m}=r,[g,S,y,F]=z.get(a),[h,O]=Ge(e),N=T.useRef(!1),C=T.useRef(!1),E=T.useRef(h),p=T.useRef(t),I=T.useRef(r),_=()=>I.current,v=()=>_().isVisible()&&_().isOnline(),[R,Y,H,U]=Ct(a,h),D=T.useRef({}).current,W=x(l)?x(r.fallback)?M:r.fallback[h]:l,Te=(d,b)=>{for(const k in D){const w=k;if(w==="data"){if(!n(d[w],b[w])&&(!x(d[w])||!n(ue,b[w])))return!1}else if(b[w]!==d[w])return!1}return!0},le=T.useMemo(()=>{const d=!h||!t?!1:x(i)?_().isPaused()||u?!1:o!==!1:i,b=j=>{const P=Q(j);return delete P._k,d?{isValidating:!0,isLoading:!0,...P}:P},k=R(),w=U(),A=b(k),B=k===w?A:b(w);let L=A;return[()=>{const j=b(R());return Te(j,L)?(L.data=j.data,L.isLoading=j.isLoading,L.isValidating=j.isValidating,L.error=j.error,L):(L=j,j)},()=>B]},[a,h]),V=Wr.useSyncExternalStore(T.useCallback(d=>H(h,(b,k)=>{Te(k,b)||d()}),[a,h]),le[0],le[1]),G=!N.current,$=g[h]&&g[h].length>0,ee=V.data,X=x(ee)?W&&Rt(W)?He(W):W:ee,ce=V.error,ge=T.useRef(X),ue=m?x(ee)?x(ge.current)?X:ge.current:ee:X,ke=$&&!x(ce)?!1:G&&!x(i)?i:_().isPaused()?!1:u?x(X)?!1:o:x(X)||o,te=!!(h&&t&&G&&ke),he=x(V.isValidating)?te:V.isValidating,Qe=x(V.isLoading)?te:V.isLoading,oe=T.useCallback(async d=>{const b=p.current;if(!h||!b||C.current||_().isPaused())return!1;let k,w,A=!0;const B=d||{},L=!y[h]||!B.dedupe,j=()=>Nt?!C.current&&h===E.current&&N.current:h===E.current,P={isValidating:!1,isLoading:!1},pe=()=>{Y(P)},xe=()=>{const J=y[h];J&&J[1]===w&&delete y[h]},Ae={isValidating:!0};x(R().data)&&(Ae.isLoading=!0);try{if(L&&(Y(Ae),r.loadingTimeout&&x(R().data)&&setTimeout(()=>{A&&j()&&_().onLoadingSlow(h,r)},r.loadingTimeout),y[h]=[b(O),ze()]),[k,w]=y[h],k=await k,L&&setTimeout(xe,r.dedupingInterval),!y[h]||y[h][1]!==w)return L&&j()&&_().onDiscarded(h),!1;P.error=M;const J=S[h];if(!x(J)&&(w<=J[0]||w<=J[1]||J[1]===0))return pe(),L&&j()&&_().onDiscarded(h),!1;const q=R().data;P.data=n(q,k)?q:k,L&&j()&&_().onSuccess(k,h,r)}catch(J){xe();const q=_(),{shouldRetryOnError:se}=q;q.isPaused()||(P.error=J,L&&j()&&(q.onError(J,h,q),(se===!0||K(se)&&se(J))&&(!_().revalidateOnFocus||!_().revalidateOnReconnect||v())&&q.onErrorRetry(J,h,q,re=>{const ae=g[h];ae&&ae[0]&&ae[0](xt,re)},{retryCount:(B.retryCount||0)+1,dedupe:!0})))}return A=!1,pe(),!0},[h,a]),Se=T.useCallback((...d)=>Dt(a,E.current,...d),[]);if(Ye(()=>{p.current=t,I.current=r,x(ee)||(ge.current=ee)}),Ye(()=>{if(!h)return;const d=oe.bind(M,Xe);let b=0;_().revalidateOnFocus&&(b=Date.now()+_().focusThrottleInterval);const k=Ea(h,g,(w,A={})=>{if(w==Tt){const B=Date.now();_().revalidateOnFocus&&B>b&&v()&&(b=B+_().focusThrottleInterval,d())}else if(w==kt)_().revalidateOnReconnect&&v()&&d();else{if(w==St)return oe();if(w==xt)return oe(A)}});return C.current=!1,E.current=h,N.current=!0,Y({_k:O}),ke&&(y[h]||(x(X)||fe?d():ea(d))),()=>{C.current=!0,k()}},[h]),Ye(()=>{let d;function b(){const w=K(s)?s(R().data):s;w&&d!==-1&&(d=setTimeout(k,w))}function k(){!R().error&&(f||_().isVisible())&&(c||_().isOnline())?oe(Xe).then(b):b()}return b(),()=>{d&&(clearTimeout(d),d=-1)}},[s,f,c,h]),T.useDebugValue(ue),u&&x(X)&&h){if(!Nt&&fe)throw new Error("Fallback data is required when using Suspense in SSR.");p.current=t,I.current=r,C.current=!1;const d=F[h];if(!x(d)){const b=Se(d);He(b)}if(x(ce)){const b=oe(Xe);x(ue)||(b.status="fulfilled",b.value=!0),He(b)}else throw ce}return{mutate:Se,get data(){return D.data=!0,ue},get error(){return D.error=!0,ce},get isValidating(){return D.isValidating=!0,he},get isLoading(){return D.isLoading=!0,Qe}}},we=_a(ba);var Ze,Pt;function Ia(){if(Pt)return Ze;Pt=1;function e(t,r){if(typeof t!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof t}\`.`);let a,n=0;return function(...u){clearTimeout(a);const l=Date.now(),i=l-n,o=r-i;o<=0?(n=l,t.apply(this,u)):a=setTimeout(()=>{n=Date.now(),t.apply(this,u)},o)}}return Ze=e,Ze}var va=Ia();const wa=Yt(va);function Mt(e,t){return t!=null?wa(e,t):e}function Ta(e){const[t,r]=T.useState(e);return T.useEffect(()=>{je(e,t)||r(e)},[e,t]),t}function ka({api:e="/api/chat",id:t,initialMessages:r,initialInput:a="",sendExtraMessageFields:n,onToolCall:u,experimental_prepareRequestBody:l,maxSteps:i=1,streamProtocol:o="data",onResponse:s,onFinish:f,onError:c,credentials:m,headers:g,body:S,generateId:y=Re,fetch:F,keepLastMessageOnError:h=!0,experimental_throttle:O}={}){const[N]=T.useState(y),C=t??N,E=typeof e=="string"?[e,C]:C,p=Ta(r??[]),I=T.useMemo(()=>De(p),[p]),{data:_,mutate:v}=we([E,"messages"],null,{fallbackData:I}),R=T.useRef(_||[]);T.useEffect(()=>{R.current=_||[]},[_]);const{data:Y,mutate:H}=we([E,"streamData"],null),U=T.useRef(Y);T.useEffect(()=>{U.current=Y},[Y]);const{data:D="ready",mutate:W}=we([E,"status"],null),{data:Te=void 0,mutate:le}=we([E,"error"],null),V=T.useRef(null),G=T.useRef({credentials:m,headers:g,body:S});T.useEffect(()=>{G.current={credentials:m,headers:g,body:S}},[m,g,S]);const $=T.useCallback(async(d,b="generate")=>{var k,w;W("submitted"),le(void 0);const A=De(d.messages),B=A.length,L=Oe((k=A[A.length-1])==null?void 0:k.toolInvocations);try{const P=new AbortController;V.current=P;const pe=Mt(v,O),xe=Mt(H,O),Ae=R.current;pe(A,!1);const J=n?A:A.map(({role:se,content:re,experimental_attachments:ae,data:Vt,annotations:Bt,toolInvocations:Jt,parts:Ut})=>({role:se,content:re,...ae!==void 0&&{experimental_attachments:ae},...Vt!==void 0&&{data:Vt},...Bt!==void 0&&{annotations:Bt},...Jt!==void 0&&{toolInvocations:Jt},...Ut!==void 0&&{parts:Ut}})),q=U.current;await Br({api:e,body:(w=l==null?void 0:l({id:C,messages:A,requestData:d.data,requestBody:d.body}))!=null?w:{id:C,messages:J,data:d.data,...G.current.body,...d.body},streamProtocol:o,credentials:G.current.credentials,headers:{...G.current.headers,...d.headers},abortController:()=>V.current,restoreMessagesOnFailure(){h||pe(Ae,!1)},onResponse:s,onUpdate({message:se,data:re,replaceLastMessage:ae}){W("streaming"),pe([...ae?A.slice(0,A.length-1):A,se],!1),re!=null&&re.length&&xe([...q??[],...re],!1)},onToolCall:u,onFinish:f,generateId:y,fetch:F,lastMessage:A[A.length-1],requestType:b}),V.current=null,W("ready")}catch(P){if(P.name==="AbortError")return V.current=null,W("ready"),null;c&&P instanceof Error&&c(P),le(P),W("error")}const j=R.current;Jr({originalMaxToolInvocationStep:L,originalMessageCount:B,maxSteps:i,messages:j})&&await $({messages:j})},[v,W,e,G,s,f,c,le,H,U,o,n,l,u,i,R,V,y,F,h,O,C]),ee=T.useCallback(async(d,{data:b,headers:k,body:w,experimental_attachments:A=d.experimental_attachments}={})=>{var B,L;const j=await Et(A),P=R.current.concat({...d,id:(B=d.id)!=null?B:y(),createdAt:(L=d.createdAt)!=null?L:new Date,experimental_attachments:j.length>0?j:void 0,parts:_t(d)});return $({messages:P,headers:k,body:w,data:b})},[$,y]),X=T.useCallback(async({data:d,headers:b,body:k}={})=>{const w=R.current;if(w.length===0)return null;const A=w[w.length-1];return $({messages:A.role==="assistant"?w.slice(0,-1):w,headers:b,body:k,data:d})},[$]),ce=T.useCallback(()=>{V.current&&(V.current.abort(),V.current=null)},[]),ge=T.useCallback(async()=>{const d=R.current;$({messages:d},"resume")},[$]),ue=T.useCallback(d=>{typeof d=="function"&&(d=d(R.current));const b=De(d);v(b,!1),R.current=b},[v]),ke=T.useCallback(d=>{typeof d=="function"&&(d=d(U.current)),H(d,!1),U.current=d},[H]),[te,he]=T.useState(a),Qe=T.useCallback(async(d,b={},k)=>{var w;if((w=d==null?void 0:d.preventDefault)==null||w.call(d),!te&&!b.allowEmptySubmit)return;k&&(G.current={...G.current,...k});const A=await Et(b.experimental_attachments),B={messages:R.current.concat({id:y(),createdAt:new Date,role:"user",content:te,experimental_attachments:A.length>0?A:void 0,parts:[{type:"text",text:te}]}),headers:b.headers,body:b.body,data:b.data};$(B),he("")},[te,y,$]),oe=d=>{he(d.target.value)},Se=T.useCallback(({toolCallId:d,result:b})=>{const k=R.current;if(Ur({messages:k,toolCallId:d,toolResult:b}),v([...k.slice(0,k.length-1),{...k[k.length-1]}],!1),D==="submitted"||D==="streaming")return;const w=k[k.length-1];bt(w)&&$({messages:k})},[v,D,$]);return{messages:_??[],id:C,setMessages:ue,data:Y,setData:ke,error:Te,append:ee,reload:X,stop:ce,experimental_resume:ge,input:te,setInput:he,handleInputChange:oe,handleSubmit:Qe,isLoading:D==="submitted"||D==="streaming",status:D,addToolResult:Se}}Wt=ka});export{Ra as __tla,Wt as u};
