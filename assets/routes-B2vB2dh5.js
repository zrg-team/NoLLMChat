const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/few_shot-D6me8AwE.js","assets/index-C1llXbqp.js","assets/index-BHmW4Jet.css","assets/dot-Cs4glAhh.js","assets/createLucideIcon-BeZHKxR2.js","assets/index-C-LrYoBr.js","assets/objectWithoutPropertiesLoose-BjXSgPXB.js","assets/index-B4I71OLa.js","assets/index-Cr8Tc6mT.css","assets/index-C7uio77f.js","assets/pdf-BaTjA2JX.js","assets/pdf.min-uhRye5Eo.js","assets/pdf.worker.min-CTxugM4J.js","assets/index-DYCql1Sf.js","assets/use-prevent-pitch-zoom-w7xdBMTe.js","assets/index-uSeLYiiE.js","assets/link-DVEKoDY_.js","assets/trash-2-zYkwvBIo.js","assets/text-DirtScJa.js","assets/external-link-cel5M2V8.js","assets/unlink-9sKmeLZh.js","assets/index-Ct34UvMq.js","assets/list-C2KucLVA.js","assets/list-ordered-CYnrBf7E.js","assets/list-todo-FnlNiUuT.js","assets/indent-increase-BMJPPt36.js","assets/pilcrow-Y64q23xA.js","assets/heading-1-BVBfkr_J.js","assets/heading-2-DQ-PH9r9.js","assets/heading-3-DX9kvIt5.js","assets/table-OWHc0q0H.js","assets/file-code-BnZiKXDc.js","assets/quote-4uOYnpiF.js","assets/minus-BNQur_vy.js","assets/square-Cq77JUnh.js","assets/chevron-right-B2keQZiC.js","assets/image-BVI06go2.js","assets/table-of-contents-BhMPfsUd.js","assets/columns-3-BtBen0_J.js","assets/link-2-D6Xu8FRM.js","assets/calendar-DbJb71Fg.js","assets/plus-BhbNSUSX.js","assets/wrap-text-TvH5pslD.js","assets/pen-CemnlqwP.js","assets/eye-39jjfqrB.js","assets/indent-decrease-BzFojOn4.js","assets/pointer-C4Ikp2Gk.js","assets/wand-sparkles-yCcDrYl_.js","assets/bold-CPLhN0Rv.js","assets/italic-CRcbiDoz.js","assets/underline-DAD5paar.js","assets/strikethrough-Cx_lNF-B.js","assets/code-xml-CRZs5Hr8.js","assets/baseline-DgN0wVf7.js","assets/paint-bucket-DjLMJwLm.js","assets/arrow-up-to-line-CoY3CBZx.js","assets/index-BCYu3EnN.css","assets/index-rmRFhhHt.js","assets/check-L96gQJlZ.js","assets/circle-BUigQ4S6.js","assets/index-BOGz6B2Y.js","assets/index-HSnfLTSA.css","assets/CodeContainerApp-D0VlGn_D.js","assets/DocumentViewer-YyJ3Pu3j.js"])))=>i.map(i=>d[i]);
import{r as g,M as $M,j as h,u as jv,P as wDe,a as FM,L as xDe,m as _De,c as jDe,f as AG,i as SDe,b as BM,d as TG,e as EDe,g as ODe,_ as IG,h as RG,k as Yl,l as Sv,n as co,o as ni,p as Ql,q as ln,R as CDe,s as ur,t as Tn,v as Ae,w as ge,x as zr,y as jt,z as Z,A as lo,S as ri,B as dr,D as Ev,C as NDe,E as Ov,F as pe,G as DG,H as MDe,I as ke,J as hf,K as Je,N as uo,O as tn,Q as nn,T as ue,U as Ws,V as mf,W as LG,X as kDe,Y as PDe,Z as $G,$ as Vi,a0 as eu,a1 as jn,a2 as st,a3 as FG,a4 as W,a5 as tu,a6 as ADe,a7 as TDe,a8 as Sn,a9 as ie,aa as BG,ab as qi,ac as Wi,ad as yf,ae as Ht,af as Ur,ag as IDe,ah as RDe,ai as DDe,aj as LDe,ak as gf,al as zG,am as $De,an as FDe,ao as UG,ap as zM,aq as BDe,ar as zDe,as as VG,at as UM,au as UDe,av as Cv,aw as VDe,ax as Hi,ay as qG,az as qDe,aA as WDe,aB as Pa,aC as WG,aD as HDe,aE as Nv,aF as Q,aG as po,aH as nu,aI as Aa,aJ as Mv,aK as HG,aL as VM,aM as KDe,aN as ZDe,aO as KG,aP as GDe,aQ as ZG,aR as kv,aS as XDe,aT as JDe,aU as vf,aV as YDe,aW as Vr,aX as Pv,aY as qM,aZ as ru,a_ as GG,a$ as QDe,b0 as e3e,b1 as t3e,b2 as au,b3 as n3e,b4 as r3e,b5 as XG,b6 as a3e,b7 as o3e,b8 as i3e,b9 as s3e,ba as JG,bb as WM,bc as St,bd as c3e,be as HM,bf as l3e,bg as u3e,bh as d3e,__tla as p3e}from"./index-C1llXbqp.js";import YG,{__tla as f3e}from"./dot-Cs4glAhh.js";let ou,KM,Av,ZM,GM,iu,Tv,su,Ki,bf,wf,Iv,XM,JM,Hs,YM,QM,ek,tk,Rv,nk,rk,ak,ok,ik,sk,Dv,Rt,Lv,$v,cu,Zi,Gi,xf,lu,Ks,Zs,ck,Fv,lk,uk,QG,Bv,dk,zv,pk,fo,eX,ai,uu,du,Uv,Vv,qv,Wv,Hv,Kv,Zv,Gv,fk,hk,_f,Xv,Jv,Yv,Qv,e0,mk,tX,t0,nX,yk,gk,vk,n0,bk,rX,r0,a0,o0,wk,i0,s0,c0,l0,u0,d0,xk,_k,aX,p0,jk,Sk,pu,f0,h0,m0,jf,En,y0,Sf,g0,v0,fu,oX,hu,b0,Ef,Be,Gs,mu,w0,Yn,Ie,qn,In,x0,_0,Ek,Ok,j0,S0,Ye,Ck,E0,O0,Nk,Mk,kk,Xs,oi,Pk,qr,C0,Ak,Tk,Js,Wr,N0,M0,Ik,Ta,Rk,k0,P0,Dk,Lk,$k,A0,Wn,yu,T0,gu,Ys,Fk,h3e=Promise.all([(()=>{try{return p3e}catch{}})(),(()=>{try{return f3e}catch{}})()]).then(async()=>{class cX extends g.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function lX({children:e,isPresent:t}){const n=g.useId(),r=g.useRef(null),a=g.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=g.useContext($M);return g.useInsertionEffect(()=>{const{width:i,height:s,top:c,left:l}=a.current;if(t||!r.current||!i||!s)return;r.current.dataset.motionPopId=n;const u=document.createElement("style");return o&&(u.nonce=o),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${s}px !important;
            top: ${c}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),h.jsx(cX,{isPresent:t,childRef:r,sizeRef:a,children:g.cloneElement(e,{ref:r})})}const uX=({children:e,initial:t,isPresent:n,onExitComplete:r,custom:a,presenceAffectsLayout:o,mode:i})=>{const s=jv(dX),c=g.useId(),l=g.useCallback(d=>{s.set(d,!0);for(const p of s.values())if(!p)return;r&&r()},[s,r]),u=g.useMemo(()=>({id:c,initial:t,isPresent:n,custom:a,onExitComplete:l,register:d=>(s.set(d,!1),()=>s.delete(d))}),o?[Math.random(),l]:[n,l]);return g.useMemo(()=>{s.forEach((d,p)=>s.set(p,!1))},[n]),g.useEffect(()=>{!n&&!s.size&&r&&r()},[n]),i==="popLayout"&&(e=h.jsx(lX,{isPresent:n,children:e})),h.jsx(wDe.Provider,{value:u,children:e})};function dX(){return new Map}const Cf=e=>e.key||"";function Vk(e){const t=[];return g.Children.forEach(e,n=>{g.isValidElement(n)&&t.push(n)}),t}const pX=({children:e,exitBeforeEnter:t,custom:n,initial:r=!0,onExitComplete:a,presenceAffectsLayout:o=!0,mode:i="sync"})=>{const s=g.useMemo(()=>Vk(e),[e]),c=s.map(Cf),l=g.useRef(!0),u=g.useRef(s),d=jv(()=>new Map),[p,f]=g.useState(s),[m,y]=g.useState(s);FM(()=>{l.current=!1,u.current=s;for(let w=0;w<m.length;w++){const j=Cf(m[w]);c.includes(j)?d.delete(j):d.get(j)!==!0&&d.set(j,!1)}},[m,c.length,c.join("-")]);const v=[];if(s!==p){let w=[...s];for(let j=0;j<m.length;j++){const x=m[j],_=Cf(x);c.includes(_)||(w.splice(j,0,x),v.push(x))}i==="wait"&&v.length&&(w=v),y(Vk(w)),f(s);return}const{forceRender:b}=g.useContext(xDe);return h.jsx(h.Fragment,{children:m.map(w=>{const j=Cf(w),x=s===m||c.includes(j),_=()=>{if(d.has(j))d.set(j,!0);else return;let S=!0;d.forEach(E=>{E||(S=!1)}),S&&(b==null||b(),y(u.current),a&&a())};return h.jsx(uX,{isPresent:x,initial:!l.current||r?void 0:!1,custom:x?void 0:n,presenceAffectsLayout:o,mode:i,onExitComplete:x?void 0:_,children:w},j)})})};function I0(e){const t=jv(()=>_De(e)),{isStatic:n}=g.useContext($M);if(n){const[,r]=g.useState(e);g.useEffect(()=>t.on("change",r),[])}return t}function qk(e,t){const n=I0(t()),r=()=>n.set(t());return r(),FM(()=>{const a=()=>AG.preRender(r,!1,!0),o=e.map(i=>i.on("change",a));return()=>{o.forEach(i=>i()),jDe(r)}}),n}const fX=e=>e&&typeof e=="object"&&e.mix,hX=e=>fX(e)?e.mix:void 0;function mX(...e){const t=!Array.isArray(e[0]),n=t?0:-1,r=e[0+n],a=e[1+n],o=e[2+n],i=e[3+n],s=SDe(a,o,{mixer:hX(o[0]),...i});return t?s(r):s}function yX(e){BM.current=[],e();const t=qk(BM.current,e);return BM.current=void 0,t}function Wk(e,t,n,r){if(typeof e=="function")return yX(e);const a=typeof t=="function"?t:mX(t,n,r);return Array.isArray(e)?Hk(e,a):Hk([e],([o])=>a(o))}function Hk(e,t){const n=jv(()=>[]);return qk(e,()=>{n.length=0;const r=e.length;for(let a=0;a<r;a++)n[a]=e[a].get();return t(n)})}function Kk(e){return typeof e=="number"?e:parseFloat(e)}function gX(e,t={}){const{isStatic:n}=g.useContext($M),r=g.useRef(null),a=I0(TG(e)?Kk(e.get()):e),o=g.useRef(a.get()),i=g.useRef(()=>{}),s=()=>{const l=r.current;l&&l.time===0&&l.sample(EDe.delta),c(),r.current=ODe({keyframes:[a.get(),o.current],velocity:a.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...t,onUpdate:i.current})},c=()=>{r.current&&r.current.stop()};return g.useInsertionEffect(()=>a.attach((l,u)=>n?u(l):(o.current=l,i.current=u,AG.update(s),a.get()),c),[JSON.stringify(t)]),FM(()=>{if(TG(e))return e.on("change",l=>a.set(Kk(l)))},[a]),a}var et=(e=>(e.Started="started",e.Downloading="downloading",e.Downloaded="downloaded",e.Loading="loading",e.Loaded="loaded",e))(et||{}),vu=(e=>(e.LLM="LLM",e.embedding="embedding",e.VLM="VLM",e))(vu||{}),We=(e=>(e.WebLLM="WebLLM",e.OpenAI="OpenAI",e.Groq="Groq",e.GoogleGenerativeAI="GoogleGenerativeAI",e))(We||{}),Hr=(e=>(e.Started="started",e.Inprogress="inprogress",e.Success="success",e.Failed="failed",e))(Hr||{}),pr=(e=>(e.Human="human",e.User="user",e.AI="ai",e.System="system",e.Assistant="assistant",e.Tool="tool",e.FewShotExample="few_shot_example",e))(pr||{}),Nf=(e=>(e.Started="started",e.Inprogress="inprogress",e.Done="done",e))(Nf||{}),fr=(e=>(e.Chat="chat",e.FewShotExample="few_shot_example",e))(fr||{}),Xi=(e=>(e.VECTOR_DATABASE_RETREIVER="VECTOR_DATABASE_RETREIVER",e.DEFAULT_EMBEDDING_MODEL="DEFAULT_EMBEDDING_MODEL",e))(Xi||{});function Zk(e,t,n,r,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var o=IG(t),i=IG(e),s=!1,c=i.length-1;c>=0;c--){var l=i[c],u=e[l];if(RG(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var d=t[l];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?Zk(u,d,n,r+"/"+Yl(l),a):u!==d&&(a&&n.push({op:"test",path:r+"/"+Yl(l),value:Sv(u)}),n.push({op:"replace",path:r+"/"+Yl(l),value:Sv(d)}))}else Array.isArray(e)===Array.isArray(t)?(a&&n.push({op:"test",path:r+"/"+Yl(l),value:Sv(u)}),n.push({op:"remove",path:r+"/"+Yl(l)}),s=!0):(a&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!s&&o.length==i.length))for(var c=0;c<o.length;c++){var l=o[c];!RG(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+Yl(l),value:Sv(t[l])})}}}function vX(e,t,n=!1){var r=[];return Zk(e,t,r,"",n),r}let Gk,Xk;Gk=async(e,t)=>{let n="",r="",a;const o=[];await e;for await(const i of e)i&&(Array.isArray(i)?(o.push(...i.map(s=>s.content)),o!=null&&o.length&&(r=o.join(""),t==null||t({chunk:i,content:r}))):(n=typeof i=="object"&&"content"in i?`${i.content}`:`${i}`,t==null||t({chunk:i,content:n})),a=i);return{lastChunk:a,content:n}},Xk=()=>{const e=co(a=>a.toolsCallingStream),t=co(a=>a.structuredStream),n=co(a=>a.stream),r=co(a=>a.getCurrentModelInfo);return{stream:g.useCallback(async(a,o)=>{var f;const{tools:i,schemas:s,onMessageUpdate:c,onMessageFinish:l}=o||{};let u;if(!await r())throw new Error("Model is not found");if(s!=null&&s.length?(s&&(s==null?void 0:s.length)>1&&ni("Multiple schemas are not supported. Only the first schema will be used."),u=t(((f=s==null?void 0:s[0])==null?void 0:f.schema_items)||[],a)):i!=null&&i.length?u=e(i,a):u=n(a),!u)throw new Error("Stream is not supported");const{lastChunk:d,content:p}=await Gk(u,c);return l==null||l({content:p,lastChunk:d}),{lastChunk:d,content:p}},[r,n,t,e])}},Tv=globalThis||void 0||self;var bu={},Jk;function bX(){if(Jk)return bu;Jk=1,Object.defineProperty(bu,"__esModule",{value:!0}),bu.parse=i,bu.serialize=l;const e=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,t=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,o=(()=>{const p=function(){};return p.prototype=Object.create(null),p})();function i(p,f){const m=new o,y=p.length;if(y<2)return m;const v=(f==null?void 0:f.decode)||u;let b=0;do{const w=p.indexOf("=",b);if(w===-1)break;const j=p.indexOf(";",b),x=j===-1?y:j;if(w>x){b=p.lastIndexOf(";",w-1)+1;continue}const _=s(p,b,w),S=c(p,w,_),E=p.slice(_,S);if(m[E]===void 0){let O=s(p,w+1,x),N=c(p,x,O);const M=v(p.slice(O,N));m[E]=M}b=x+1}while(b<y);return m}function s(p,f,m){do{const y=p.charCodeAt(f);if(y!==32&&y!==9)return f}while(++f<m);return m}function c(p,f,m){for(;f>m;){const y=p.charCodeAt(--f);if(y!==32&&y!==9)return f+1}return m}function l(p,f,m){const y=(m==null?void 0:m.encode)||encodeURIComponent;if(!e.test(p))throw new TypeError(`argument name is invalid: ${p}`);const v=y(f);if(!t.test(v))throw new TypeError(`argument val is invalid: ${f}`);let b=p+"="+v;if(!m)return b;if(m.maxAge!==void 0){if(!Number.isInteger(m.maxAge))throw new TypeError(`option maxAge is invalid: ${m.maxAge}`);b+="; Max-Age="+m.maxAge}if(m.domain){if(!n.test(m.domain))throw new TypeError(`option domain is invalid: ${m.domain}`);b+="; Domain="+m.domain}if(m.path){if(!r.test(m.path))throw new TypeError(`option path is invalid: ${m.path}`);b+="; Path="+m.path}if(m.expires){if(!d(m.expires)||!Number.isFinite(m.expires.valueOf()))throw new TypeError(`option expires is invalid: ${m.expires}`);b+="; Expires="+m.expires.toUTCString()}if(m.httpOnly&&(b+="; HttpOnly"),m.secure&&(b+="; Secure"),m.partitioned&&(b+="; Partitioned"),m.priority)switch(typeof m.priority=="string"?m.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${m.priority}`)}if(m.sameSite)switch(typeof m.sameSite=="string"?m.sameSite.toLowerCase():m.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${m.sameSite}`)}return b}function u(p){if(p.indexOf("%")===-1)return p;try{return decodeURIComponent(p)}catch{return p}}function d(p){return a.call(p)==="[object Date]"}return bu}bX();var Yk="popstate";function wX(e={}){function t(r,a){let{pathname:o,search:i,hash:s}=r.location;return Qs("",{pathname:o,search:i,hash:s},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:ho(a)}return eP(t,n,null,e)}function xX(e={}){function t(a,o){let{pathname:i="/",search:s="",hash:c=""}=mo(a.location.hash.substring(1));return!i.startsWith("/")&&!i.startsWith(".")&&(i="/"+i),Qs("",{pathname:i,search:s,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(a,o){let i=a.document.querySelector("base"),s="";if(i&&i.getAttribute("href")){let c=a.location.href,l=c.indexOf("#");s=l===-1?c:c.slice(0,l)}return s+"#"+(typeof o=="string"?o:ho(o))}function r(a,o){un(a.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(o)})`)}return eP(t,n,r,e)}function Qe(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function un(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function _X(){return Math.random().toString(36).substring(2,10)}function Qk(e,t){return{usr:e.state,key:e.key,idx:t}}function Qs(e,t,n=null,r){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?mo(t):t,state:n,key:t&&t.key||r||_X()}}function ho({pathname:e="/",search:t="",hash:n=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function mo(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function eP(e,t,n,r={}){let{window:a=document.defaultView,v5Compat:o=!1}=r,i=a.history,s="POP",c=null,l=u();l==null&&(l=0,i.replaceState({...i.state,idx:l},""));function u(){return(i.state||{idx:null}).idx}function d(){s="POP";let v=u(),b=v==null?null:v-l;l=v,c&&c({action:s,location:y.location,delta:b})}function p(v,b){s="PUSH";let w=Qs(y.location,v,b);n&&n(w,v),l=u()+1;let j=Qk(w,l),x=y.createHref(w);try{i.pushState(j,"",x)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;a.location.assign(x)}o&&c&&c({action:s,location:y.location,delta:1})}function f(v,b){s="REPLACE";let w=Qs(y.location,v,b);n&&n(w,v),l=u();let j=Qk(w,l),x=y.createHref(w);i.replaceState(j,"",x),o&&c&&c({action:s,location:y.location,delta:0})}function m(v){let b=a.location.origin!=="null"?a.location.origin:a.location.href,w=typeof v=="string"?v:ho(v);return w=w.replace(/ $/,"%20"),Qe(b,`No window.location.(origin|href) available to create URL for href: ${w}`),new URL(w,b)}let y={get action(){return s},get location(){return e(a,i)},listen(v){if(c)throw new Error("A history only accepts one active listener");return a.addEventListener(Yk,d),c=v,()=>{a.removeEventListener(Yk,d),c=null}},createHref(v){return t(a,v)},createURL:m,encodeLocation(v){let b=m(v);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:f,go(v){return i.go(v)}};return y}var jX=new Set(["lazy","caseSensitive","path","id","index","children"]);function SX(e){return e.index===!0}function Mf(e,t,n=[],r={}){return e.map((a,o)=>{let i=[...n,String(o)],s=typeof a.id=="string"?a.id:i.join("-");if(Qe(a.index!==!0||!a.children,"Cannot specify children on an index route"),Qe(!r[s],`Found a route id collision on id "${s}".  Route id's must be globally unique within Data Router usages`),SX(a)){let c={...a,...t(a),id:s};return r[s]=c,c}else{let c={...a,...t(a),id:s,children:void 0};return r[s]=c,a.children&&(c.children=Mf(a.children,t,i,r)),c}})}function ii(e,t,n="/"){return kf(e,t,n,!1)}function kf(e,t,n,r){let a=typeof t=="string"?mo(t):t,o=Kr(a.pathname||"/",n);if(o==null)return null;let i=tP(e);OX(i);let s=null;for(let c=0;s==null&&c<i.length;++c){let l=LX(o);s=RX(i[c],l,r)}return s}function EX(e,t){let{route:n,pathname:r,params:a}=e;return{id:n.id,pathname:r,params:a,data:t[n.id],handle:n.handle}}function tP(e,t=[],n=[],r=""){let a=(o,i,s)=>{let c={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};c.relativePath.startsWith("/")&&(Qe(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length));let l=Ia([r,c.relativePath]),u=n.concat(c);o.children&&o.children.length>0&&(Qe(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),tP(o.children,t,u,l)),!(o.path==null&&!o.index)&&t.push({path:l,score:TX(l,o.index),routesMeta:u})};return e.forEach((o,i)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))a(o,i);else for(let c of nP(o.path))a(o,i,c)}),t}function nP(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,a=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return a?[o,""]:[o];let i=nP(r.join("/")),s=[];return s.push(...i.map(c=>c===""?o:[o,c].join("/"))),a&&s.push(...i),s.map(c=>e.startsWith("/")&&c===""?"/":c)}function OX(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:IX(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var CX=/^:[\w-]+$/,NX=3,MX=2,kX=1,PX=10,AX=-2,rP=e=>e==="*";function TX(e,t){let n=e.split("/"),r=n.length;return n.some(rP)&&(r+=AX),t&&(r+=MX),n.filter(a=>!rP(a)).reduce((a,o)=>a+(CX.test(o)?NX:o===""?kX:PX),r)}function IX(e,t){return e.length===t.length&&e.slice(0,-1).every((n,r)=>n===t[r])?e[e.length-1]-t[t.length-1]:0}function RX(e,t,n=!1){let{routesMeta:r}=e,a={},o="/",i=[];for(let s=0;s<r.length;++s){let c=r[s],l=s===r.length-1,u=o==="/"?t:t.slice(o.length)||"/",d=Pf({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},u),p=c.route;if(!d&&l&&n&&!r[r.length-1].route.index&&(d=Pf({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!d)return null;Object.assign(a,d.params),i.push({params:a,pathname:Ia([o,d.pathname]),pathnameBase:BX(Ia([o,d.pathnameBase])),route:p}),d.pathnameBase!=="/"&&(o=Ia([o,d.pathnameBase]))}return i}function Pf(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=DX(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let o=a[0],i=o.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:r.reduce((c,{paramName:l,isOptional:u},d)=>{if(l==="*"){let f=s[d]||"";i=o.slice(0,o.length-f.length).replace(/(.)\/+$/,"$1")}const p=s[d];return u&&!p?c[l]=void 0:c[l]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:o,pathnameBase:i,pattern:e}}function DX(e,t=!1,n=!0){un(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,i,s)=>(r.push({paramName:i,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),r]}function LX(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return un(!1,`The URL path "${e}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function Kr(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function $X(e,t="/"){let{pathname:n,search:r="",hash:a=""}=typeof e=="string"?mo(e):e;return{pathname:n?n.startsWith("/")?n:FX(n,t):t,search:zX(r),hash:UX(a)}}function FX(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function R0(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function aP(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function Af(e){let t=aP(e);return t.map((n,r)=>r===t.length-1?n.pathname:n.pathnameBase)}function Tf(e,t,n,r=!1){let a;typeof e=="string"?a=mo(e):(a={...e},Qe(!a.pathname||!a.pathname.includes("?"),R0("?","pathname","search",a)),Qe(!a.pathname||!a.pathname.includes("#"),R0("#","pathname","hash",a)),Qe(!a.search||!a.search.includes("#"),R0("#","search","hash",a)));let o=e===""||a.pathname==="",i=o?"/":a.pathname,s;if(i==null)s=n;else{let d=t.length-1;if(!r&&i.startsWith("..")){let p=i.split("/");for(;p[0]==="..";)p.shift(),d-=1;a.pathname=p.join("/")}s=d>=0?t[d]:"/"}let c=$X(a,s),l=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(l||u)&&(c.pathname+="/"),c}var Ia=e=>e.join("/").replace(/\/\/+/g,"/"),BX=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),zX=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,UX=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,If=class{constructor(e,t,n,r=!1){this.status=e,this.statusText=t||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function Rf(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var oP=["POST","PUT","PATCH","DELETE"],VX=new Set(oP),qX=["GET",...oP],WX=new Set(qX),HX=new Set([301,302,303,307,308]),KX=new Set([307,308]),D0={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},ZX={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},wu={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},L0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,GX=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),iP="remix-router-transitions",sP=Symbol("ResetLoaderData");function cP(e){const t=e.window?e.window:typeof window<"u"?window:void 0,n=typeof t<"u"&&typeof t.document<"u"&&typeof t.document.createElement<"u";Qe(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let r=e.mapRouteProperties||GX,a={},o=Mf(e.routes,r,void 0,a),i,s=e.basename||"/",c=e.dataStrategy||eJ,l=e.patchRoutesOnNavigation,u={...e.future},d=null,p=new Set,f=null,m=null,y=null,v=e.hydrationData!=null,b=ii(o,e.history.location,s),w=null;if(b==null&&!l){let q=Or(404,{pathname:e.history.location.pathname}),{matches:Y,route:oe}=wP(o);b=Y,w={[oe.id]:q}}b&&!e.hydrationData&&Oe(b,o,e.history.location.pathname).active&&(b=null);let j;if(b)if(b.some(q=>q.route.lazy))j=!1;else if(!b.some(q=>q.route.loader))j=!0;else{let q=e.hydrationData?e.hydrationData.loaderData:null,Y=e.hydrationData?e.hydrationData.errors:null;if(Y){let oe=b.findIndex(fe=>Y[fe.route.id]!==void 0);j=b.slice(0,oe+1).every(fe=>!F0(fe.route,q,Y))}else j=b.every(oe=>!F0(oe.route,q,Y))}else{j=!1,b=[];let q=Oe(null,o,e.history.location.pathname);q.active&&q.matches&&(b=q.matches)}let x,_={historyAction:e.history.action,location:e.history.location,matches:b,initialized:j,navigation:D0,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||w,fetchers:new Map,blockers:new Map},S="POP",E=!1,O,N=!1,M=new Map,k=null,P=!1,A=!1,C=new Set,I=new Map,T=0,R=-1,L=new Map,D=new Set,z=new Map,B=new Map,$=new Set,U=new Map,F,H=null;function re(){if(d=e.history.listen(({action:q,location:Y,delta:oe})=>{if(F){F(),F=void 0;return}un(U.size===0||oe!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let fe=Xt({currentLocation:_.location,nextLocation:Y,historyAction:q});if(fe&&oe!=null){let Ne=new Promise(De=>{F=De});e.history.go(oe*-1),Te(fe,{state:"blocked",location:Y,proceed(){Te(fe,{state:"proceeding",proceed:void 0,reset:void 0,location:Y}),Ne.then(()=>e.history.go(oe))},reset(){let De=new Map(_.blockers);De.set(fe,wu),K({blockers:De})}});return}return le(q,Y)}),n){dJ(t,M);let q=()=>pJ(t,M);t.addEventListener("pagehide",q),k=()=>t.removeEventListener("pagehide",q)}return _.initialized||le("POP",_.location,{initialHydration:!0}),x}function ee(){d&&d(),k&&k(),p.clear(),O&&O.abort(),_.fetchers.forEach((q,Y)=>ir(Y)),_.blockers.forEach((q,Y)=>me(Y))}function G(q){return p.add(q),()=>p.delete(q)}function K(q,Y={}){_={..._,...q};let oe=[],fe=[];_.fetchers.forEach((Ne,De)=>{Ne.state==="idle"&&($.has(De)?oe.push(De):fe.push(De))}),[...p].forEach(Ne=>Ne(_,{deletedFetchers:oe,viewTransitionOpts:Y.viewTransitionOpts,flushSync:Y.flushSync===!0})),oe.forEach(Ne=>ir(Ne)),fe.forEach(Ne=>_.fetchers.delete(Ne))}function X(q,Y,{flushSync:oe}={}){var we,Ue;let fe=_.actionData!=null&&_.navigation.formMethod!=null&&Zr(_.navigation.formMethod)&&_.navigation.state==="loading"&&((we=q.state)==null?void 0:we._isRedirect)!==!0,Ne;Y.actionData?Object.keys(Y.actionData).length>0?Ne=Y.actionData:Ne=null:fe?Ne=_.actionData:Ne=null;let De=Y.loaderData?vP(_.loaderData,Y.loaderData,Y.matches||[],Y.errors):_.loaderData,ze=_.blockers;ze.size>0&&(ze=new Map(ze),ze.forEach((nt,Dt)=>ze.set(Dt,wu)));let Me=E===!0||_.navigation.formMethod!=null&&Zr(_.navigation.formMethod)&&((Ue=q.state)==null?void 0:Ue._isRedirect)!==!0;i&&(o=i,i=void 0),P||S==="POP"||(S==="PUSH"?e.history.push(q,q.state):S==="REPLACE"&&e.history.replace(q,q.state));let Pe;if(S==="POP"){let nt=M.get(_.location.pathname);nt&&nt.has(q.pathname)?Pe={currentLocation:_.location,nextLocation:q}:M.has(q.pathname)&&(Pe={currentLocation:q,nextLocation:_.location})}else if(N){let nt=M.get(_.location.pathname);nt?nt.add(q.pathname):(nt=new Set([q.pathname]),M.set(_.location.pathname,nt)),Pe={currentLocation:_.location,nextLocation:q}}K({...Y,actionData:Ne,loaderData:De,historyAction:S,location:q,initialized:!0,navigation:D0,revalidation:"idle",restoreScrollPosition:Ee(q,Y.matches||_.matches),preventScrollReset:Me,blockers:ze},{viewTransitionOpts:Pe,flushSync:oe===!0}),S="POP",E=!1,N=!1,P=!1,A=!1,H==null||H.resolve(),H=null}async function ne(q,Y){if(typeof q=="number"){e.history.go(q);return}let oe=$0(_.location,_.matches,s,q,Y==null?void 0:Y.fromRouteId,Y==null?void 0:Y.relative),{path:fe,submission:Ne,error:De}=lP(!1,oe,Y),ze=_.location,Me=Qs(_.location,fe,Y&&Y.state);Me={...Me,...e.history.encodeLocation(Me)};let Pe=Y&&Y.replace!=null?Y.replace:void 0,we="PUSH";Pe===!0?we="REPLACE":Pe===!1||Ne!=null&&Zr(Ne.formMethod)&&Ne.formAction===_.location.pathname+_.location.search&&(we="REPLACE");let Ue=Y&&"preventScrollReset"in Y?Y.preventScrollReset===!0:void 0,nt=(Y&&Y.flushSync)===!0,Dt=Xt({currentLocation:ze,nextLocation:Me,historyAction:we});if(Dt){Te(Dt,{state:"blocked",location:Me,proceed(){Te(Dt,{state:"proceeding",proceed:void 0,reset:void 0,location:Me}),ne(q,Y)},reset(){let zt=new Map(_.blockers);zt.set(Dt,wu),K({blockers:zt})}});return}await le(we,Me,{submission:Ne,pendingError:De,preventScrollReset:Ue,replace:Y&&Y.replace,enableViewTransition:Y&&Y.viewTransition,flushSync:nt})}function V(){H||(H=fJ()),lt(),K({revalidation:"loading"});let q=H.promise;return _.navigation.state==="submitting"?q:_.navigation.state==="idle"?(le(_.historyAction,_.location,{startUninterruptedRevalidation:!0}),q):(le(S||_.historyAction,_.navigation.location,{overrideNavigation:_.navigation,enableViewTransition:N===!0}),q)}async function le(q,Y,oe){O&&O.abort(),O=null,S=q,P=(oe&&oe.startUninterruptedRevalidation)===!0,_e(_.location,_.matches),E=(oe&&oe.preventScrollReset)===!0,N=(oe&&oe.enableViewTransition)===!0;let fe=i||o,Ne=oe&&oe.overrideNavigation,De=ii(fe,Y,s),ze=(oe&&oe.flushSync)===!0,Me=Oe(De,fe,Y.pathname);if(Me.active&&Me.matches&&(De=Me.matches),!De){let{error:it,notFoundMatches:cr,route:en}=Bt(Y.pathname);X(Y,{matches:cr,loaderData:{},errors:{[en.id]:it}},{flushSync:ze});return}if(_.initialized&&!A&&iJ(_.location,Y)&&!(oe&&oe.submission&&Zr(oe.submission.formMethod))){X(Y,{matches:De},{flushSync:ze});return}O=new AbortController;let Pe=ec(e.history,Y,O.signal,oe&&oe.submission),we;if(oe&&oe.pendingError)we=[Ji(De).route.id,{type:"error",error:oe.pendingError}];else if(oe&&oe.submission&&Zr(oe.submission.formMethod)){let it=await ae(Pe,Y,oe.submission,De,Me.active,{replace:oe.replace,flushSync:ze});if(it.shortCircuited)return;if(it.pendingActionResult){let[cr,en]=it.pendingActionResult;if(hr(en)&&Rf(en.error)&&en.error.status===404){O=null,X(Y,{matches:it.matches,loaderData:{},errors:{[cr]:en.error}});return}}De=it.matches||De,we=it.pendingActionResult,Ne=U0(Y,oe.submission),ze=!1,Me.active=!1,Pe=ec(e.history,Pe.url,Pe.signal)}let{shortCircuited:Ue,matches:nt,loaderData:Dt,errors:zt}=await de(Pe,Y,De,Me.active,Ne,oe&&oe.submission,oe&&oe.fetcherSubmission,oe&&oe.replace,oe&&oe.initialHydration===!0,ze,we);Ue||(O=null,X(Y,{matches:nt||De,...bP(we),loaderData:Dt,errors:zt}))}async function ae(q,Y,oe,fe,Ne,De={}){lt();let ze=lJ(Y,oe);if(K({navigation:ze},{flushSync:De.flushSync===!0}),Ne){let we=await qe(fe,Y.pathname,q.signal);if(we.type==="aborted")return{shortCircuited:!0};if(we.type==="error"){let Ue=Ji(we.partialMatches).route.id;return{matches:we.partialMatches,pendingActionResult:[Ue,{type:"error",error:we.error}]}}else if(we.matches)fe=we.matches;else{let{notFoundMatches:Ue,error:nt,route:Dt}=Bt(Y.pathname);return{matches:Ue,pendingActionResult:[Dt.id,{type:"error",error:nt}]}}}let Me,Pe=xu(fe,Y);if(!Pe.route.action&&!Pe.route.lazy)Me={type:"error",error:Or(405,{method:q.method,pathname:Y.pathname,routeId:Pe.route.id})};else if(Me=(await Ke("action",_,q,[Pe],fe,null))[Pe.route.id],q.signal.aborted)return{shortCircuited:!0};if(Yi(Me)){let we;return De&&De.replace!=null?we=De.replace:we=mP(Me.response.headers.get("Location"),new URL(q.url),s)===_.location.pathname+_.location.search,await He(q,Me,!0,{submission:oe,replace:we}),{shortCircuited:!0}}if(hr(Me)){let we=Ji(fe,Pe.route.id);return(De&&De.replace)!==!0&&(S="PUSH"),{matches:fe,pendingActionResult:[we.route.id,Me]}}return{matches:fe,pendingActionResult:[Pe.route.id,Me]}}async function de(q,Y,oe,fe,Ne,De,ze,Me,Pe,we,Ue){let nt=Ne||U0(Y,De),Dt=De||ze||SP(nt),zt=!P&&!Pe;if(fe){if(zt){let lr=je(Ue);K({navigation:nt,...lr!==void 0?{actionData:lr}:{}},{flushSync:we})}let ht=await qe(oe,Y.pathname,q.signal);if(ht.type==="aborted")return{shortCircuited:!0};if(ht.type==="error"){let lr=Ji(ht.partialMatches).route.id;return{matches:ht.partialMatches,loaderData:{},errors:{[lr]:ht.error}}}else if(ht.matches)oe=ht.matches;else{let{error:lr,notFoundMatches:qs,route:Wt}=Bt(Y.pathname);return{matches:qs,loaderData:{},errors:{[Wt.id]:lr}}}}let it=i||o,[cr,en]=dP(e.history,_,oe,Dt,Y,Pe===!0,A,C,$,z,D,it,s,Ue);if(R=++T,cr.length===0&&en.length===0){let ht=J();return X(Y,{matches:oe,loaderData:{},errors:Ue&&hr(Ue[1])?{[Ue[0]]:Ue[1].error}:null,...bP(Ue),...ht?{fetchers:new Map(_.fetchers)}:{}},{flushSync:we}),{shortCircuited:!0}}if(zt){let ht={};if(!fe){ht.navigation=nt;let lr=je(Ue);lr!==void 0&&(ht.actionData=lr)}en.length>0&&(ht.fetchers=Le(en)),K(ht,{flushSync:we})}en.forEach(ht=>{sr(ht.key),ht.controller&&I.set(ht.key,ht.controller)});let Vs=()=>en.forEach(ht=>sr(ht.key));O&&O.signal.addEventListener("abort",Vs);let{loaderResults:ka,fetcherResults:Ui}=await It(_,oe,cr,en,q);if(q.signal.aborted)return{shortCircuited:!0};O&&O.signal.removeEventListener("abort",Vs),en.forEach(ht=>I.delete(ht.key));let so=Df(ka);if(so)return await He(q,so.result,!0,{replace:Me}),{shortCircuited:!0};if(so=Df(Ui),so)return D.add(so.key),await He(q,so.result,!0,{replace:Me}),{shortCircuited:!0};let{loaderData:ff,errors:Br}=gP(_,oe,ka,Ue,en,Ui);Pe&&_.errors&&(Br={..._.errors,...Br});let Gl=J(),Xl=te(R),Jl=Gl||Xl||en.length>0;return{matches:oe,loaderData:ff,errors:Br,...Jl?{fetchers:new Map(_.fetchers)}:{}}}function je(q){if(q&&!hr(q[1]))return{[q[0]]:q[1].data};if(_.actionData)return Object.keys(_.actionData).length===0?null:_.actionData}function Le(q){return q.forEach(Y=>{let oe=_.fetchers.get(Y.key),fe=_u(void 0,oe?oe.data:void 0);_.fetchers.set(Y.key,fe)}),new Map(_.fetchers)}async function $e(q,Y,oe,fe){sr(q);let Ne=(fe&&fe.flushSync)===!0,De=i||o,ze=$0(_.location,_.matches,s,oe,Y,fe==null?void 0:fe.relative),Me=ii(De,ze,s),Pe=Oe(Me,De,ze);if(Pe.active&&Pe.matches&&(Me=Pe.matches),!Me){_t(q,Y,Or(404,{pathname:ze}),{flushSync:Ne});return}let{path:we,submission:Ue,error:nt}=lP(!0,ze,fe);if(nt){_t(q,Y,nt,{flushSync:Ne});return}let Dt=xu(Me,we),zt=(fe&&fe.preventScrollReset)===!0;if(Ue&&Zr(Ue.formMethod)){await Se(q,Y,we,Dt,Me,Pe.active,Ne,zt,Ue);return}z.set(q,{routeId:Y,path:we}),await Ve(q,Y,we,Dt,Me,Pe.active,Ne,zt,Ue)}async function Se(q,Y,oe,fe,Ne,De,ze,Me,Pe){lt(),z.delete(q);function we(Wt){if(!Wt.route.action&&!Wt.route.lazy){let ti=Or(405,{method:Pe.formMethod,pathname:oe,routeId:Y});return _t(q,Y,ti,{flushSync:ze}),!0}return!1}if(!De&&we(fe))return;let Ue=_.fetchers.get(q);ot(q,uJ(Pe,Ue),{flushSync:ze});let nt=new AbortController,Dt=ec(e.history,oe,nt.signal,Pe);if(De){let Wt=await qe(Ne,oe,Dt.signal);if(Wt.type==="aborted")return;if(Wt.type==="error"){_t(q,Y,Wt.error,{flushSync:ze});return}else if(Wt.matches){if(Ne=Wt.matches,fe=xu(Ne,oe),we(fe))return}else{_t(q,Y,Or(404,{pathname:oe}),{flushSync:ze});return}}I.set(q,nt);let zt=T,it=(await Ke("action",_,Dt,[fe],Ne,q))[fe.route.id];if(Dt.signal.aborted){I.get(q)===nt&&I.delete(q);return}if($.has(q)){if(Yi(it)||hr(it)){ot(q,si(void 0));return}}else{if(Yi(it))if(I.delete(q),R>zt){ot(q,si(void 0));return}else return D.add(q),ot(q,_u(Pe)),He(Dt,it,!1,{fetcherSubmission:Pe,preventScrollReset:Me});if(hr(it)){_t(q,Y,it.error);return}}let cr=_.navigation.location||_.location,en=ec(e.history,cr,nt.signal),Vs=i||o,ka=_.navigation.state!=="idle"?ii(Vs,_.navigation.location,s):_.matches;Qe(ka,"Didn't find any matches after fetcher action");let Ui=++T;L.set(q,Ui);let so=_u(Pe,it.data);_.fetchers.set(q,so);let[ff,Br]=dP(e.history,_,ka,Pe,cr,!1,A,C,$,z,D,Vs,s,[fe.route.id,it]);Br.filter(Wt=>Wt.key!==q).forEach(Wt=>{let ti=Wt.key,_v=_.fetchers.get(ti),DM=_u(void 0,_v?_v.data:void 0);_.fetchers.set(ti,DM),sr(ti),Wt.controller&&I.set(ti,Wt.controller)}),K({fetchers:new Map(_.fetchers)});let Gl=()=>Br.forEach(Wt=>sr(Wt.key));nt.signal.addEventListener("abort",Gl);let{loaderResults:Xl,fetcherResults:Jl}=await It(_,ka,ff,Br,en);if(nt.signal.aborted)return;nt.signal.removeEventListener("abort",Gl),L.delete(q),I.delete(q),Br.forEach(Wt=>I.delete(Wt.key));let ht=Df(Xl);if(ht)return He(en,ht.result,!1,{preventScrollReset:Me});if(ht=Df(Jl),ht)return D.add(ht.key),He(en,ht.result,!1,{preventScrollReset:Me});let{loaderData:lr,errors:qs}=gP(_,ka,Xl,void 0,Br,Jl);if(_.fetchers.has(q)){let Wt=si(it.data);_.fetchers.set(q,Wt)}te(Ui),_.navigation.state==="loading"&&Ui>R?(Qe(S,"Expected pending action"),O&&O.abort(),X(_.navigation.location,{matches:ka,loaderData:lr,errors:qs,fetchers:new Map(_.fetchers)})):(K({errors:qs,loaderData:vP(_.loaderData,lr,ka,qs),fetchers:new Map(_.fetchers)}),A=!1)}async function Ve(q,Y,oe,fe,Ne,De,ze,Me,Pe){let we=_.fetchers.get(q);ot(q,_u(Pe,we?we.data:void 0),{flushSync:ze});let Ue=new AbortController,nt=ec(e.history,oe,Ue.signal);if(De){let it=await qe(Ne,oe,nt.signal);if(it.type==="aborted")return;if(it.type==="error"){_t(q,Y,it.error,{flushSync:ze});return}else if(it.matches)Ne=it.matches,fe=xu(Ne,oe);else{_t(q,Y,Or(404,{pathname:oe}),{flushSync:ze});return}}I.set(q,Ue);let Dt=T,zt=(await Ke("loader",_,nt,[fe],Ne,q))[fe.route.id];if(I.get(q)===Ue&&I.delete(q),!nt.signal.aborted){if($.has(q)){ot(q,si(void 0));return}if(Yi(zt))if(R>Dt){ot(q,si(void 0));return}else{D.add(q),await He(nt,zt,!1,{preventScrollReset:Me});return}if(hr(zt)){_t(q,Y,zt.error);return}ot(q,si(zt.data))}}async function He(q,Y,oe,{submission:fe,fetcherSubmission:Ne,preventScrollReset:De,replace:ze}={}){Y.response.headers.has("X-Remix-Revalidate")&&(A=!0);let Me=Y.response.headers.get("Location");Qe(Me,"Expected a Location header on the redirect Response"),Me=mP(Me,new URL(q.url),s);let Pe=Qs(_.location,Me,{_isRedirect:!0});if(n){let it=!1;if(Y.response.headers.has("X-Remix-Reload-Document"))it=!0;else if(L0.test(Me)){const cr=e.history.createURL(Me);it=cr.origin!==t.location.origin||Kr(cr.pathname,s)==null}if(it){ze?t.location.replace(Me):t.location.assign(Me);return}}O=null;let we=ze===!0||Y.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:Ue,formAction:nt,formEncType:Dt}=_.navigation;!fe&&!Ne&&Ue&&nt&&Dt&&(fe=SP(_.navigation));let zt=fe||Ne;if(KX.has(Y.response.status)&&zt&&Zr(zt.formMethod))await le(we,Pe,{submission:{...zt,formAction:Me},preventScrollReset:De||E,enableViewTransition:oe?N:void 0});else{let it=U0(Pe,fe);await le(we,Pe,{overrideNavigation:it,fetcherSubmission:Ne,preventScrollReset:De||E,enableViewTransition:oe?N:void 0})}}async function Ke(q,Y,oe,fe,Ne,De){let ze,Me={};try{ze=await tJ(c,q,Y,oe,fe,Ne,De,a,r)}catch(Pe){return fe.forEach(we=>{Me[we.route.id]={type:"error",error:Pe}}),Me}for(let[Pe,we]of Object.entries(ze))if(sJ(we)){let Ue=we.result;Me[Pe]={type:"redirect",response:aJ(Ue,oe,Pe,Ne,s)}}else Me[Pe]=await rJ(we);return Me}async function It(q,Y,oe,fe,Ne){let De=Ke("loader",q,Ne,oe,Y,null),ze=Promise.all(fe.map(async we=>{if(we.matches&&we.match&&we.controller){let Ue=(await Ke("loader",q,ec(e.history,we.path,we.controller.signal),[we.match],we.matches,we.key))[we.match.route.id];return{[we.key]:Ue}}else return Promise.resolve({[we.key]:{type:"error",error:Or(404,{pathname:we.path})}})})),Me=await De,Pe=(await ze).reduce((we,Ue)=>Object.assign(we,Ue),{});return{loaderResults:Me,fetcherResults:Pe}}function lt(){A=!0,z.forEach((q,Y)=>{I.has(Y)&&C.add(Y),sr(Y)})}function ot(q,Y,oe={}){_.fetchers.set(q,Y),K({fetchers:new Map(_.fetchers)},{flushSync:(oe&&oe.flushSync)===!0})}function _t(q,Y,oe,fe={}){let Ne=Ji(_.matches,Y);ir(q),K({errors:{[Ne.route.id]:oe},fetchers:new Map(_.fetchers)},{flushSync:(fe&&fe.flushSync)===!0})}function Qt(q){return B.set(q,(B.get(q)||0)+1),$.has(q)&&$.delete(q),_.fetchers.get(q)||ZX}function ir(q){let Y=_.fetchers.get(q);I.has(q)&&!(Y&&Y.state==="loading"&&L.has(q))&&sr(q),z.delete(q),L.delete(q),D.delete(q),$.delete(q),C.delete(q),_.fetchers.delete(q)}function oo(q){let Y=(B.get(q)||0)-1;Y<=0?(B.delete(q),$.add(q)):B.set(q,Y),K({fetchers:new Map(_.fetchers)})}function sr(q){let Y=I.get(q);Y&&(Y.abort(),I.delete(q))}function io(q){for(let Y of q){let oe=Qt(Y),fe=si(oe.data);_.fetchers.set(Y,fe)}}function J(){let q=[],Y=!1;for(let oe of D){let fe=_.fetchers.get(oe);Qe(fe,`Expected fetcher: ${oe}`),fe.state==="loading"&&(D.delete(oe),q.push(oe),Y=!0)}return io(q),Y}function te(q){let Y=[];for(let[oe,fe]of L)if(fe<q){let Ne=_.fetchers.get(oe);Qe(Ne,`Expected fetcher: ${oe}`),Ne.state==="loading"&&(sr(oe),L.delete(oe),Y.push(oe))}return io(Y),Y.length>0}function ce(q,Y){let oe=_.blockers.get(q)||wu;return U.get(q)!==Y&&U.set(q,Y),oe}function me(q){_.blockers.delete(q),U.delete(q)}function Te(q,Y){let oe=_.blockers.get(q)||wu;Qe(oe.state==="unblocked"&&Y.state==="blocked"||oe.state==="blocked"&&Y.state==="blocked"||oe.state==="blocked"&&Y.state==="proceeding"||oe.state==="blocked"&&Y.state==="unblocked"||oe.state==="proceeding"&&Y.state==="unblocked",`Invalid blocker state transition: ${oe.state} -> ${Y.state}`);let fe=new Map(_.blockers);fe.set(q,Y),K({blockers:fe})}function Xt({currentLocation:q,nextLocation:Y,historyAction:oe}){if(U.size===0)return;U.size>1&&un(!1,"A router only supports one blocker at a time");let fe=Array.from(U.entries()),[Ne,De]=fe[fe.length-1],ze=_.blockers.get(Ne);if(!(ze&&ze.state==="proceeding")&&De({currentLocation:q,nextLocation:Y,historyAction:oe}))return Ne}function Bt(q){let Y=Or(404,{pathname:q}),oe=i||o,{matches:fe,route:Ne}=wP(oe);return{notFoundMatches:fe,route:Ne,error:Y}}function Ge(q,Y,oe){if(f=q,y=Y,m=oe||null,!v&&_.navigation===D0){v=!0;let fe=Ee(_.location,_.matches);fe!=null&&K({restoreScrollPosition:fe})}return()=>{f=null,y=null,m=null}}function be(q,Y){return m&&m(q,Y.map(oe=>EX(oe,_.loaderData)))||q.key}function _e(q,Y){if(f&&y){let oe=be(q,Y);f[oe]=y()}}function Ee(q,Y){if(f){let oe=be(q,Y),fe=f[oe];if(typeof fe=="number")return fe}return null}function Oe(q,Y,oe){if(l)if(q){if(Object.keys(q[0].params).length>0)return{active:!0,matches:kf(Y,oe,s,!0)}}else return{active:!0,matches:kf(Y,oe,s,!0)||[]};return{active:!1,matches:null}}async function qe(q,Y,oe){if(!l)return{type:"success",matches:q};let fe=q;for(;;){let Ne=i==null,De=i||o,ze=a;try{await l({path:Y,matches:fe,patch:(we,Ue)=>{oe.aborted||fP(we,Ue,De,ze,r)}})}catch(we){return{type:"error",error:we,partialMatches:fe}}finally{Ne&&!oe.aborted&&(o=[...o])}if(oe.aborted)return{type:"aborted"};let Me=ii(De,Y,s);if(Me)return{type:"success",matches:Me};let Pe=kf(De,Y,s,!0);if(!Pe||fe.length===Pe.length&&fe.every((we,Ue)=>we.route.id===Pe[Ue].route.id))return{type:"success",matches:null};fe=Pe}}function Mt(q){a={},i=Mf(q,r,void 0,a)}function qt(q,Y){let oe=i==null;fP(q,Y,i||o,a,r),oe&&(o=[...o],K({}))}return x={get basename(){return s},get future(){return u},get state(){return _},get routes(){return o},get window(){return t},initialize:re,subscribe:G,enableScrollRestoration:Ge,navigate:ne,fetch:$e,revalidate:V,createHref:q=>e.history.createHref(q),encodeLocation:q=>e.history.encodeLocation(q),getFetcher:Qt,deleteFetcher:oo,dispose:ee,getBlocker:ce,deleteBlocker:me,patchRoutes:qt,_internalFetchControllers:I,_internalSetRoutes:Mt},x}function XX(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function $0(e,t,n,r,a,o){let i,s;if(a){i=[];for(let l of t)if(i.push(l),l.route.id===a){s=l;break}}else i=t,s=t[t.length-1];let c=Tf(r||".",Af(i),Kr(e.pathname,n)||e.pathname,o==="path");if(r==null&&(c.search=e.search,c.hash=e.hash),(r==null||r===""||r===".")&&s){let l=z0(c.search);if(s.route.index&&!l)c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index";else if(!s.route.index&&l){let u=new URLSearchParams(c.search),d=u.getAll("index");u.delete("index"),d.filter(f=>f).forEach(f=>u.append("index",f));let p=u.toString();c.search=p?`?${p}`:""}}return n!=="/"&&(c.pathname=c.pathname==="/"?n:Ia([n,c.pathname])),ho(c)}function lP(e,t,n){if(!n||!XX(n))return{path:t};if(n.formMethod&&!cJ(n.formMethod))return{path:t,error:Or(405,{method:n.formMethod})};let r=()=>({path:t,error:Or(400,{type:"invalid-body"})}),a=(n.formMethod||"get").toUpperCase(),o=xP(t);if(n.body!==void 0){if(n.formEncType==="text/plain"){if(!Zr(a))return r();let u=typeof n.body=="string"?n.body:n.body instanceof FormData||n.body instanceof URLSearchParams?Array.from(n.body.entries()).reduce((d,[p,f])=>`${d}${p}=${f}
`,""):String(n.body);return{path:t,submission:{formMethod:a,formAction:o,formEncType:n.formEncType,formData:void 0,json:void 0,text:u}}}else if(n.formEncType==="application/json"){if(!Zr(a))return r();try{let u=typeof n.body=="string"?JSON.parse(n.body):n.body;return{path:t,submission:{formMethod:a,formAction:o,formEncType:n.formEncType,formData:void 0,json:u,text:void 0}}}catch{return r()}}}Qe(typeof FormData=="function","FormData is not available in this environment");let i,s;if(n.formData)i=B0(n.formData),s=n.formData;else if(n.body instanceof FormData)i=B0(n.body),s=n.body;else if(n.body instanceof URLSearchParams)i=n.body,s=yP(i);else if(n.body==null)i=new URLSearchParams,s=new FormData;else try{i=new URLSearchParams(n.body),s=yP(i)}catch{return r()}let c={formMethod:a,formAction:o,formEncType:n&&n.formEncType||"application/x-www-form-urlencoded",formData:s,json:void 0,text:void 0};if(Zr(c.formMethod))return{path:t,submission:c};let l=mo(t);return e&&l.search&&z0(l.search)&&i.append("index",""),l.search=`?${i}`,{path:ho(l),submission:c}}function uP(e,t,n=!1){let r=e.findIndex(a=>a.route.id===t);return r>=0?e.slice(0,n?r+1:r):e}function dP(e,t,n,r,a,o,i,s,c,l,u,d,p,f){let m=f?hr(f[1])?f[1].error:f[1].data:void 0,y=e.createURL(t.location),v=e.createURL(a),b=n;o&&t.errors?b=uP(n,Object.keys(t.errors)[0],!0):f&&hr(f[1])&&(b=uP(n,f[0]));let w=f?f[1].statusCode:void 0,j=w&&w>=400,x=b.filter((S,E)=>{let{route:O}=S;if(O.lazy)return!0;if(O.loader==null)return!1;if(o)return F0(O,t.loaderData,t.errors);if(JX(t.loaderData,t.matches[E],S))return!0;let N=t.matches[E],M=S;return pP(S,{currentUrl:y,currentParams:N.params,nextUrl:v,nextParams:M.params,...r,actionResult:m,actionStatus:w,defaultShouldRevalidate:j?!1:i||y.pathname+y.search===v.pathname+v.search||y.search!==v.search||YX(N,M)})}),_=[];return l.forEach((S,E)=>{if(o||!n.some(P=>P.route.id===S.routeId)||c.has(E))return;let O=ii(d,S.path,p);if(!O){_.push({key:E,routeId:S.routeId,path:S.path,matches:null,match:null,controller:null});return}let N=t.fetchers.get(E),M=xu(O,S.path),k=!1;u.has(E)?k=!1:s.has(E)?(s.delete(E),k=!0):N&&N.state!=="idle"&&N.data===void 0?k=i:k=pP(M,{currentUrl:y,currentParams:t.matches[t.matches.length-1].params,nextUrl:v,nextParams:n[n.length-1].params,...r,actionResult:m,actionStatus:w,defaultShouldRevalidate:j?!1:i}),k&&_.push({key:E,routeId:S.routeId,path:S.path,matches:O,match:M,controller:new AbortController})}),[x,_]}function F0(e,t,n){if(e.lazy)return!0;if(!e.loader)return!1;let r=t!=null&&t[e.id]!==void 0,a=n!=null&&n[e.id]!==void 0;return!r&&a?!1:typeof e.loader=="function"&&e.loader.hydrate===!0?!0:!r&&!a}function JX(e,t,n){let r=!t||n.route.id!==t.route.id,a=!e.hasOwnProperty(n.route.id);return r||a}function YX(e,t){let n=e.route.path;return e.pathname!==t.pathname||n!=null&&n.endsWith("*")&&e.params["*"]!==t.params["*"]}function pP(e,t){if(e.route.shouldRevalidate){let n=e.route.shouldRevalidate(t);if(typeof n=="boolean")return n}return t.defaultShouldRevalidate}function fP(e,t,n,r,a){let o;if(e){let c=r[e];Qe(c,`No route found to patch children into: routeId = ${e}`),c.children||(c.children=[]),o=c.children}else o=n;let i=t.filter(c=>!o.some(l=>hP(c,l))),s=Mf(i,a,[e||"_","patch",String((o==null?void 0:o.length)||"0")],r);o.push(...s)}function hP(e,t){return"id"in e&&"id"in t&&e.id===t.id?!0:e.index===t.index&&e.path===t.path&&e.caseSensitive===t.caseSensitive?(!e.children||e.children.length===0)&&(!t.children||t.children.length===0)?!0:e.children.every((n,r)=>{var a;return(a=t.children)==null?void 0:a.some(o=>hP(n,o))}):!1}async function QX(e,t,n){if(!e.lazy)return;let r=await e.lazy();if(!e.lazy)return;let a=n[e.id];Qe(a,"No route found in manifest");let o={};for(let i in r){let s=a[i]!==void 0&&i!=="hasErrorBoundary";un(!s,`Route "${a.id}" has a static property "${i}" defined but its lazy function is also returning a value for this property. The lazy route property "${i}" will be ignored.`),!s&&!jX.has(i)&&(o[i]=r[i])}Object.assign(a,o),Object.assign(a,{...t(a),lazy:void 0})}async function eJ({matches:e}){let t=e.filter(n=>n.shouldLoad);return(await Promise.all(t.map(n=>n.resolve()))).reduce((n,r,a)=>Object.assign(n,{[t[a].route.id]:r}),{})}async function tJ(e,t,n,r,a,o,i,s,c,l){let u=o.map(f=>f.route.lazy?QX(f.route,c,s):void 0),d=o.map((f,m)=>{let y=u[m],v=a.some(b=>b.route.id===f.route.id);return{...f,shouldLoad:v,resolve:async b=>(b&&r.method==="GET"&&(f.route.lazy||f.route.loader)&&(v=!0),v?nJ(t,r,f,y,b,l):Promise.resolve({type:"data",result:void 0}))}}),p=await e({matches:d,request:r,params:o[0].params,fetcherKey:i,context:l});try{await Promise.all(u)}catch{}return p}async function nJ(e,t,n,r,a,o){let i,s,c=l=>{let u,d=new Promise((m,y)=>u=y);s=()=>u(),t.signal.addEventListener("abort",s);let p=m=>typeof l!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${e}" [routeId: ${n.route.id}]`)):l({request:t,params:n.params,context:o},...m!==void 0?[m]:[]),f=(async()=>{try{return{type:"data",result:await(a?a(m=>p(m)):p())}}catch(m){return{type:"error",result:m}}})();return Promise.race([f,d])};try{let l=n.route[e];if(r)if(l){let u,[d]=await Promise.all([c(l).catch(p=>{u=p}),r]);if(u!==void 0)throw u;i=d}else if(await r,l=n.route[e],l)i=await c(l);else if(e==="action"){let u=new URL(t.url),d=u.pathname+u.search;throw Or(405,{method:t.method,pathname:d,routeId:n.route.id})}else return{type:"data",result:void 0};else if(l)i=await c(l);else{let u=new URL(t.url),d=u.pathname+u.search;throw Or(404,{pathname:d})}}catch(l){return{type:"error",result:l}}finally{s&&t.signal.removeEventListener("abort",s)}return i}async function rJ(e){var r,a,o,i;let{result:t,type:n}=e;if(jP(t)){let s;try{let c=t.headers.get("Content-Type");c&&/\bapplication\/json\b/.test(c)?t.body==null?s=null:s=await t.json():s=await t.text()}catch(c){return{type:"error",error:c}}return n==="error"?{type:"error",error:new If(t.status,t.statusText,s),statusCode:t.status,headers:t.headers}:{type:"data",data:s,statusCode:t.status,headers:t.headers}}if(n==="error"){if(_P(t)){if(t.data instanceof Error)return{type:"error",error:t.data,statusCode:(r=t.init)==null?void 0:r.status};t=new If(((a=t.init)==null?void 0:a.status)||500,void 0,t.data)}return{type:"error",error:t,statusCode:Rf(t)?t.status:void 0}}return _P(t)?{type:"data",data:t.data,statusCode:(o=t.init)==null?void 0:o.status,headers:(i=t.init)!=null&&i.headers?new Headers(t.init.headers):void 0}:{type:"data",data:t}}function aJ(e,t,n,r,a){let o=e.headers.get("Location");if(Qe(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!L0.test(o)){let i=r.slice(0,r.findIndex(s=>s.route.id===n)+1);o=$0(new URL(t.url),i,a,o),e.headers.set("Location",o)}return e}function mP(e,t,n){if(L0.test(e)){let r=e,a=r.startsWith("//")?new URL(t.protocol+r):new URL(r),o=Kr(a.pathname,n)!=null;if(a.origin===t.origin&&o)return a.pathname+a.search+a.hash}return e}function ec(e,t,n,r){let a=e.createURL(xP(t)).toString(),o={signal:n};if(r&&Zr(r.formMethod)){let{formMethod:i,formEncType:s}=r;o.method=i.toUpperCase(),s==="application/json"?(o.headers=new Headers({"Content-Type":s}),o.body=JSON.stringify(r.json)):s==="text/plain"?o.body=r.text:s==="application/x-www-form-urlencoded"&&r.formData?o.body=B0(r.formData):o.body=r.formData}return new Request(a,o)}function B0(e){let t=new URLSearchParams;for(let[n,r]of e.entries())t.append(n,typeof r=="string"?r:r.name);return t}function yP(e){let t=new FormData;for(let[n,r]of e.entries())t.append(n,r);return t}function oJ(e,t,n,r=!1,a=!1){let o={},i=null,s,c=!1,l={},u=n&&hr(n[1])?n[1].error:void 0;return e.forEach(d=>{if(!(d.route.id in t))return;let p=d.route.id,f=t[p];if(Qe(!Yi(f),"Cannot handle redirect results in processLoaderData"),hr(f)){let m=f.error;if(u!==void 0&&(m=u,u=void 0),i=i||{},a)i[p]=m;else{let y=Ji(e,p);i[y.route.id]==null&&(i[y.route.id]=m)}r||(o[p]=sP),c||(c=!0,s=Rf(f.error)?f.error.status:500),f.headers&&(l[p]=f.headers)}else o[p]=f.data,f.statusCode&&f.statusCode!==200&&!c&&(s=f.statusCode),f.headers&&(l[p]=f.headers)}),u!==void 0&&n&&(i={[n[0]]:u},o[n[0]]=void 0),{loaderData:o,errors:i,statusCode:s||200,loaderHeaders:l}}function gP(e,t,n,r,a,o){let{loaderData:i,errors:s}=oJ(t,n,r);return a.forEach(c=>{let{key:l,match:u,controller:d}=c,p=o[l];if(Qe(p,"Did not find corresponding fetcher result"),!(d&&d.signal.aborted))if(hr(p)){let f=Ji(e.matches,u==null?void 0:u.route.id);s&&s[f.route.id]||(s={...s,[f.route.id]:p.error}),e.fetchers.delete(l)}else if(Yi(p))Qe(!1,"Unhandled fetcher revalidation redirect");else{let f=si(p.data);e.fetchers.set(l,f)}}),{loaderData:i,errors:s}}function vP(e,t,n,r){let a=Object.entries(t).filter(([,o])=>o!==sP).reduce((o,[i,s])=>(o[i]=s,o),{});for(let o of n){let i=o.route.id;if(!t.hasOwnProperty(i)&&e.hasOwnProperty(i)&&o.route.loader&&(a[i]=e[i]),r&&r.hasOwnProperty(i))break}return a}function bP(e){return e?hr(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function Ji(e,t){return(t?e.slice(0,e.findIndex(n=>n.route.id===t)+1):[...e]).reverse().find(n=>n.route.hasErrorBoundary===!0)||e[0]}function wP(e){let t=e.length===1?e[0]:e.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function Or(e,{pathname:t,routeId:n,method:r,type:a,message:o}={}){let i="Unknown Server Error",s="Unknown @remix-run/router error";return e===400?(i="Bad Request",r&&t&&n?s=`You made a ${r} request to "${t}" but did not provide a \`loader\` for route "${n}", so there is no way to handle the request.`:a==="invalid-body"&&(s="Unable to encode submission body")):e===403?(i="Forbidden",s=`Route "${n}" does not match URL "${t}"`):e===404?(i="Not Found",s=`No route matches URL "${t}"`):e===405&&(i="Method Not Allowed",r&&t&&n?s=`You made a ${r.toUpperCase()} request to "${t}" but did not provide an \`action\` for route "${n}", so there is no way to handle the request.`:r&&(s=`Invalid request method "${r.toUpperCase()}"`)),new If(e||500,i,new Error(s),!0)}function Df(e){let t=Object.entries(e);for(let n=t.length-1;n>=0;n--){let[r,a]=t[n];if(Yi(a))return{key:r,result:a}}}function xP(e){let t=typeof e=="string"?mo(e):e;return ho({...t,hash:""})}function iJ(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function sJ(e){return jP(e.result)&&HX.has(e.result.status)}function hr(e){return e.type==="error"}function Yi(e){return(e&&e.type)==="redirect"}function _P(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function jP(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function cJ(e){return WX.has(e.toUpperCase())}function Zr(e){return VX.has(e.toUpperCase())}function z0(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function xu(e,t){let n=typeof t=="string"?mo(t).search:t.search;if(e[e.length-1].route.index&&z0(n||""))return e[e.length-1];let r=aP(e);return r[r.length-1]}function SP(e){let{formMethod:t,formAction:n,formEncType:r,text:a,formData:o,json:i}=e;if(!(!t||!n||!r)){if(a!=null)return{formMethod:t,formAction:n,formEncType:r,formData:void 0,json:void 0,text:a};if(o!=null)return{formMethod:t,formAction:n,formEncType:r,formData:o,json:void 0,text:void 0};if(i!==void 0)return{formMethod:t,formAction:n,formEncType:r,formData:void 0,json:i,text:void 0}}}function U0(e,t){return t?{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function lJ(e,t){return{state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}function _u(e,t){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function uJ(e,t){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0}}function si(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function dJ(e,t){try{let n=e.sessionStorage.getItem(iP);if(n){let r=JSON.parse(n);for(let[a,o]of Object.entries(r||{}))o&&Array.isArray(o)&&t.set(a,new Set(o||[]))}}catch{}}function pJ(e,t){if(t.size>0){let n={};for(let[r,a]of t)n[r]=[...a];try{e.sessionStorage.setItem(iP,JSON.stringify(n))}catch(r){un(!1,`Failed to save applied view transitions in sessionStorage (${r}).`)}}}function fJ(){let e,t,n=new Promise((r,a)=>{e=async o=>{r(o);try{await n}catch{}},t=async o=>{a(o);try{await n}catch{}}});return{promise:n,resolve:e,reject:t}}var Qi=g.createContext(null);Qi.displayName="DataRouter";var ju=g.createContext(null);ju.displayName="DataRouterState";var V0=g.createContext({isTransitioning:!1});V0.displayName="ViewTransition";var EP=g.createContext(new Map);EP.displayName="Fetchers";var hJ=g.createContext(null);hJ.displayName="Await";var Gr=g.createContext(null);Gr.displayName="Navigation";var Lf=g.createContext(null);Lf.displayName="Location";var Cr=g.createContext({outlet:null,matches:[],isDataRoute:!1});Cr.displayName="Route";var q0=g.createContext(null);q0.displayName="RouteError";function mJ(e,{relative:t}={}){Qe(tc(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=g.useContext(Gr),{hash:a,pathname:o,search:i}=Su(e,{relative:t}),s=o;return n!=="/"&&(s=o==="/"?n:Ia([n,o])),r.createHref({pathname:s,search:i,hash:a})}function tc(){return g.useContext(Lf)!=null}function Ra(){return Qe(tc(),"useLocation() may be used only in the context of a <Router> component."),g.useContext(Lf).location}var OP="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function CP(e){g.useContext(Gr).static||g.useLayoutEffect(e)}function es(){let{isDataRoute:e}=g.useContext(Cr);return e?MJ():yJ()}function yJ(){Qe(tc(),"useNavigate() may be used only in the context of a <Router> component.");let e=g.useContext(Qi),{basename:t,navigator:n}=g.useContext(Gr),{matches:r}=g.useContext(Cr),{pathname:a}=Ra(),o=JSON.stringify(Af(r)),i=g.useRef(!1);return CP(()=>{i.current=!0}),g.useCallback((s,c={})=>{if(un(i.current,OP),!i.current)return;if(typeof s=="number"){n.go(s);return}let l=Tf(s,JSON.parse(o),a,c.relative==="path");e==null&&t!=="/"&&(l.pathname=l.pathname==="/"?t:Ia([t,l.pathname])),(c.replace?n.replace:n.push)(l,c.state,c)},[t,n,o,a,e])}var gJ=g.createContext(null);function vJ(e){let t=g.useContext(Cr).outlet;return t&&g.createElement(gJ.Provider,{value:e},t)}function $f(){let{matches:e}=g.useContext(Cr),t=e[e.length-1];return t?t.params:{}}function Su(e,{relative:t}={}){let{matches:n}=g.useContext(Cr),{pathname:r}=Ra(),a=JSON.stringify(Af(n));return g.useMemo(()=>Tf(e,JSON.parse(a),r,t==="path"),[e,a,r,t])}function bJ(e,t,n,r){Qe(tc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=g.useContext(Gr),{matches:o}=g.useContext(Cr),i=o[o.length-1],s=i?i.params:{},c=i?i.pathname:"/",l=i?i.pathnameBase:"/",u=i&&i.route;{let v=u&&u.path||"";kP(c,!u||v.endsWith("*")||v.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${v}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${v}"> to <Route path="${v==="/"?"*":`${v}/*`}">.`)}let d=Ra(),p;p=d;let f=p.pathname||"/",m=f;if(l!=="/"){let v=l.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(v.length).join("/")}let y=ii(e,{pathname:m});return un(u||y!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),un(y==null||y[y.length-1].route.element!==void 0||y[y.length-1].route.Component!==void 0||y[y.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),SJ(y&&y.map(v=>Object.assign({},v,{params:Object.assign({},s,v.params),pathname:Ia([l,a.encodeLocation?a.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?l:Ia([l,a.encodeLocation?a.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,n,r)}function wJ(){let e=NP(),t=Rf(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},i=null;return console.error("Error handled by React Router default ErrorBoundary:",e),i=g.createElement(g.Fragment,null,g.createElement("p",null,"\u{1F4BF} Hey developer \u{1F44B}"),g.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",g.createElement("code",{style:o},"ErrorBoundary")," or"," ",g.createElement("code",{style:o},"errorElement")," prop on your route.")),g.createElement(g.Fragment,null,g.createElement("h2",null,"Unexpected Application Error!"),g.createElement("h3",{style:{fontStyle:"italic"}},t),n?g.createElement("pre",{style:a},n):null,i)}var xJ=g.createElement(wJ,null),_J=class extends g.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?g.createElement(Cr.Provider,{value:this.props.routeContext},g.createElement(q0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function jJ({routeContext:e,match:t,children:n}){let r=g.useContext(Qi);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),g.createElement(Cr.Provider,{value:e},n)}function SJ(e,t=[],n=null,r=null){if(e==null){if(!n)return null;if(n.errors)e=n.matches;else if(t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let a=e,o=n==null?void 0:n.errors;if(o!=null){let c=a.findIndex(l=>l.route.id&&(o==null?void 0:o[l.route.id])!==void 0);Qe(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),a=a.slice(0,Math.min(a.length,c+1))}let i=!1,s=-1;if(n)for(let c=0;c<a.length;c++){let l=a[c];if((l.route.HydrateFallback||l.route.hydrateFallbackElement)&&(s=c),l.route.id){let{loaderData:u,errors:d}=n,p=l.route.loader&&!u.hasOwnProperty(l.route.id)&&(!d||d[l.route.id]===void 0);if(l.route.lazy||p){i=!0,s>=0?a=a.slice(0,s+1):a=[a[0]];break}}}return a.reduceRight((c,l,u)=>{let d,p=!1,f=null,m=null;n&&(d=o&&l.route.id?o[l.route.id]:void 0,f=l.route.errorElement||xJ,i&&(s<0&&u===0?(kP("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,m=null):s===u&&(p=!0,m=l.route.hydrateFallbackElement||null)));let y=t.concat(a.slice(0,u+1)),v=()=>{let b;return d?b=f:p?b=m:l.route.Component?b=g.createElement(l.route.Component,null):l.route.element?b=l.route.element:b=c,g.createElement(jJ,{match:l,routeContext:{outlet:c,matches:y,isDataRoute:n!=null},children:b})};return n&&(l.route.ErrorBoundary||l.route.errorElement||u===0)?g.createElement(_J,{location:n.location,revalidation:n.revalidation,component:f,error:d,children:v(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):v()},null)}function W0(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function EJ(e){let t=g.useContext(Qi);return Qe(t,W0(e)),t}function OJ(e){let t=g.useContext(ju);return Qe(t,W0(e)),t}function CJ(e){let t=g.useContext(Cr);return Qe(t,W0(e)),t}function H0(e){let t=CJ(e),n=t.matches[t.matches.length-1];return Qe(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function NJ(){return H0("useRouteId")}function NP(){var r;let e=g.useContext(q0),t=OJ("useRouteError"),n=H0("useRouteError");return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function MJ(){let{router:e}=EJ("useNavigate"),t=H0("useNavigate"),n=g.useRef(!1);return CP(()=>{n.current=!0}),g.useCallback(async(r,a={})=>{un(n.current,OP),n.current&&(typeof r=="number"?e.navigate(r):await e.navigate(r,{fromRouteId:t,...a}))},[e,t])}var MP={};function kP(e,t,n){!t&&!MP[e]&&(MP[e]=!0,un(!1,n))}var PP={};function AP(e,t){!e&&!PP[t]&&(PP[t]=!0,console.warn(t))}function TP(e){let t={hasErrorBoundary:e.hasErrorBoundary||e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&(e.element&&un(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(t,{element:g.createElement(e.Component),Component:void 0})),e.HydrateFallback&&(e.hydrateFallbackElement&&un(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(t,{hydrateFallbackElement:g.createElement(e.HydrateFallback),HydrateFallback:void 0})),e.ErrorBoundary&&(e.errorElement&&un(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(t,{errorElement:g.createElement(e.ErrorBoundary),ErrorBoundary:void 0})),t}var kJ=class{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=n=>{this.status==="pending"&&(this.status="resolved",e(n))},this.reject=n=>{this.status==="pending"&&(this.status="rejected",t(n))}})}};function PJ({router:e,flushSync:t}){let[n,r]=g.useState(e.state),[a,o]=g.useState(),[i,s]=g.useState({isTransitioning:!1}),[c,l]=g.useState(),[u,d]=g.useState(),[p,f]=g.useState(),m=g.useRef(new Map),y=g.useCallback((j,{deletedFetchers:x,flushSync:_,viewTransitionOpts:S})=>{x.forEach(O=>m.current.delete(O)),j.fetchers.forEach((O,N)=>{O.data!==void 0&&m.current.set(N,O.data)}),AP(_===!1||t!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let E=e.window!=null&&e.window.document!=null&&typeof e.window.document.startViewTransition=="function";if(AP(S==null||E,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!S||!E){t&&_?t(()=>r(j)):g.startTransition(()=>r(j));return}if(t&&_){t(()=>{u&&(c&&c.resolve(),u.skipTransition()),s({isTransitioning:!0,flushSync:!0,currentLocation:S.currentLocation,nextLocation:S.nextLocation})});let O=e.window.document.startViewTransition(()=>{t(()=>r(j))});O.finished.finally(()=>{t(()=>{l(void 0),d(void 0),o(void 0),s({isTransitioning:!1})})}),t(()=>d(O));return}u?(c&&c.resolve(),u.skipTransition(),f({state:j,currentLocation:S.currentLocation,nextLocation:S.nextLocation})):(o(j),s({isTransitioning:!0,flushSync:!1,currentLocation:S.currentLocation,nextLocation:S.nextLocation}))},[e.window,t,u,c]);g.useLayoutEffect(()=>e.subscribe(y),[e,y]),g.useEffect(()=>{i.isTransitioning&&!i.flushSync&&l(new kJ)},[i]),g.useEffect(()=>{if(c&&a&&e.window){let j=a,x=c.promise,_=e.window.document.startViewTransition(async()=>{g.startTransition(()=>r(j)),await x});_.finished.finally(()=>{l(void 0),d(void 0),o(void 0),s({isTransitioning:!1})}),d(_)}},[a,c,e.window]),g.useEffect(()=>{c&&a&&n.location.key===a.location.key&&c.resolve()},[c,u,n.location,a]),g.useEffect(()=>{!i.isTransitioning&&p&&(o(p.state),s({isTransitioning:!0,flushSync:!1,currentLocation:p.currentLocation,nextLocation:p.nextLocation}),f(void 0))},[i.isTransitioning,p]);let v=g.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:j=>e.navigate(j),push:(j,x,_)=>e.navigate(j,{state:x,preventScrollReset:_==null?void 0:_.preventScrollReset}),replace:(j,x,_)=>e.navigate(j,{replace:!0,state:x,preventScrollReset:_==null?void 0:_.preventScrollReset})}),[e]),b=e.basename||"/",w=g.useMemo(()=>({router:e,navigator:v,static:!1,basename:b}),[e,v,b]);return g.createElement(g.Fragment,null,g.createElement(Qi.Provider,{value:w},g.createElement(ju.Provider,{value:n},g.createElement(EP.Provider,{value:m.current},g.createElement(V0.Provider,{value:i},g.createElement(DJ,{basename:b,location:n.location,navigationType:n.historyAction,navigator:v},g.createElement(AJ,{routes:e.routes,future:e.future,state:n})))))),null)}var AJ=g.memo(TJ);function TJ({routes:e,future:t,state:n}){return bJ(e,void 0,n,t)}function IJ({to:e,replace:t,state:n,relative:r}){Qe(tc(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=g.useContext(Gr);un(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=g.useContext(Cr),{pathname:i}=Ra(),s=es(),c=Tf(e,Af(o),i,r==="path"),l=JSON.stringify(c);return g.useEffect(()=>{s(JSON.parse(l),{replace:t,state:n,relative:r})},[s,l,r,t,n]),null}function RJ(e){return vJ(e.context)}function ci(e){Qe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function DJ({basename:e="/",children:t=null,location:n,navigationType:r="POP",navigator:a,static:o=!1}){Qe(!tc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let i=e.replace(/^\/*/,"/"),s=g.useMemo(()=>({basename:i,navigator:a,static:o,future:{}}),[i,a,o]);typeof n=="string"&&(n=mo(n));let{pathname:c="/",search:l="",hash:u="",state:d=null,key:p="default"}=n,f=g.useMemo(()=>{let m=Kr(c,i);return m==null?null:{location:{pathname:m,search:l,hash:u,state:d,key:p},navigationType:r}},[i,c,l,u,d,p,r]);return un(f!=null,`<Router basename="${i}"> is not able to match the URL "${c}${l}${u}" because it does not start with the basename, so the <Router> won't render anything.`),f==null?null:g.createElement(Gr.Provider,{value:s},g.createElement(Lf.Provider,{children:t,value:f}))}function K0(e,t=[]){let n=[];return g.Children.forEach(e,(r,a)=>{if(!g.isValidElement(r))return;let o=[...t,a];if(r.type===g.Fragment){n.push.apply(n,K0(r.props.children,o));return}Qe(r.type===ci,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Qe(!r.props.index||!r.props.children,"An index route cannot have child routes.");let i={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=K0(r.props.children,o)),n.push(i)}),n}var LJ=K0,Ff="get",Bf="application/x-www-form-urlencoded";function zf(e){return e!=null&&typeof e.tagName=="string"}function $J(e){return zf(e)&&e.tagName.toLowerCase()==="button"}function FJ(e){return zf(e)&&e.tagName.toLowerCase()==="form"}function BJ(e){return zf(e)&&e.tagName.toLowerCase()==="input"}function zJ(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function UJ(e,t){return e.button===0&&(!t||t==="_self")&&!zJ(e)}var Uf=null;function VJ(){if(Uf===null)try{new FormData(document.createElement("form"),0),Uf=!1}catch{Uf=!0}return Uf}var qJ=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Z0(e){return e!=null&&!qJ.has(e)?(un(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Bf}"`),null):e}function WJ(e,t){let n,r,a,o,i;if(FJ(e)){let s=e.getAttribute("action");r=s?Kr(s,t):null,n=e.getAttribute("method")||Ff,a=Z0(e.getAttribute("enctype"))||Bf,o=new FormData(e)}else if($J(e)||BJ(e)&&(e.type==="submit"||e.type==="image")){let s=e.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=e.getAttribute("formaction")||s.getAttribute("action");if(r=c?Kr(c,t):null,n=e.getAttribute("formmethod")||s.getAttribute("method")||Ff,a=Z0(e.getAttribute("formenctype"))||Z0(s.getAttribute("enctype"))||Bf,o=new FormData(s,e),!VJ()){let{name:l,type:u,value:d}=e;if(u==="image"){let p=l?`${l}.`:"";o.append(`${p}x`,"0"),o.append(`${p}y`,"0")}else l&&o.append(l,d)}}else{if(zf(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Ff,r=null,a=Bf,i=e}return o&&a==="text/plain"&&(i=o,o=void 0),{action:r,method:n.toLowerCase(),encType:a,formData:o,body:i}}function G0(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}async function HJ(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module).then(async r=>(await r.__tla,r));return t[e.id]=n,n}catch(n){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function KJ(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function ZJ(e,t,n){let r=await Promise.all(e.map(async a=>{let o=t.routes[a.route.id];if(o){let i=await HJ(o,n);return i.links?i.links():[]}return[]}));return YJ(r.flat(1).filter(KJ).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function IP(e,t,n,r,a,o){let i=(c,l)=>n[l]?c.route.id!==n[l].route.id:!0,s=(c,l)=>{var u;return n[l].pathname!==c.pathname||((u=n[l].route.path)==null?void 0:u.endsWith("*"))&&n[l].params["*"]!==c.params["*"]};return o==="assets"?t.filter((c,l)=>i(c,l)||s(c,l)):o==="data"?t.filter((c,l)=>{var d;let u=r.routes[c.route.id];if(!u||!u.hasLoader)return!1;if(i(c,l)||s(c,l))return!0;if(c.route.shouldRevalidate){let p=c.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((d=n[0])==null?void 0:d.params)||{},nextUrl:new URL(e,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function GJ(e,t){return XJ(e.map(n=>{let r=t.routes[n.route.id];if(!r)return[];let a=[r.module];return r.imports&&(a=a.concat(r.imports)),a}).flat(1))}function XJ(e){return[...new Set(e)]}function JJ(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}function YJ(e,t){let n=new Set;return new Set(t),e.reduce((r,a)=>{let o=JSON.stringify(JJ(a));return n.has(o)||(n.add(o),r.push({key:o,link:a})),r},[])}function QJ(e){let t=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return t.pathname==="/"?t.pathname="_root.data":t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function eY(){let e=g.useContext(Qi);return G0(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function tY(){let e=g.useContext(ju);return G0(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var X0=g.createContext(void 0);X0.displayName="FrameworkContext";function RP(){let e=g.useContext(X0);return G0(e,"You must render this element inside a <HydratedRouter> element"),e}function nY(e,t){let n=g.useContext(X0),[r,a]=g.useState(!1),[o,i]=g.useState(!1),{onFocus:s,onBlur:c,onMouseEnter:l,onMouseLeave:u,onTouchStart:d}=t,p=g.useRef(null);g.useEffect(()=>{if(e==="render"&&i(!0),e==="viewport"){let y=b=>{b.forEach(w=>{i(w.isIntersecting)})},v=new IntersectionObserver(y,{threshold:.5});return p.current&&v.observe(p.current),()=>{v.disconnect()}}},[e]),g.useEffect(()=>{if(r){let y=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(y)}}},[r]);let f=()=>{a(!0)},m=()=>{a(!1),i(!1)};return n?e!=="intent"?[o,p,{}]:[o,p,{onFocus:Eu(s,f),onBlur:Eu(c,m),onMouseEnter:Eu(l,f),onMouseLeave:Eu(u,m),onTouchStart:Eu(d,f)}]:[!1,p,{}]}function Eu(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function rY({page:e,...t}){let{router:n}=eY(),r=g.useMemo(()=>ii(n.routes,e,n.basename),[n.routes,e,n.basename]);return r?g.createElement(oY,{page:e,matches:r,...t}):(console.warn(`Tried to prefetch ${e} but no routes matched.`),null)}function aY(e){let{manifest:t,routeModules:n}=RP(),[r,a]=g.useState([]);return g.useEffect(()=>{let o=!1;return ZJ(e,t,n).then(i=>{o||a(i)}),()=>{o=!0}},[e,t,n]),r}function oY({page:e,matches:t,...n}){let r=Ra(),{manifest:a,routeModules:o}=RP(),{loaderData:i,matches:s}=tY(),c=g.useMemo(()=>IP(e,t,s,a,r,"data"),[e,t,s,a,r]),l=g.useMemo(()=>IP(e,t,s,a,r,"assets"),[e,t,s,a,r]),u=g.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let f=new Set,m=!1;if(t.forEach(v=>{var w;let b=a.routes[v.route.id];!b||!b.hasLoader||(!c.some(j=>j.route.id===v.route.id)&&v.route.id in i&&((w=o[v.route.id])!=null&&w.shouldRevalidate)||b.hasClientLoader?m=!0:f.add(v.route.id))}),f.size===0)return[];let y=QJ(e);return m&&f.size>0&&y.searchParams.set("_routes",t.filter(v=>f.has(v.route.id)).map(v=>v.route.id).join(",")),[y.pathname+y.search]},[i,r,a,c,t,e,o]),d=g.useMemo(()=>GJ(l,a),[l,a]),p=aY(l);return g.createElement(g.Fragment,null,u.map(f=>g.createElement("link",{key:f,rel:"prefetch",as:"fetch",href:f,...n})),d.map(f=>g.createElement("link",{key:f,rel:"modulepreload",href:f,...n})),p.map(({key:f,link:m})=>g.createElement("link",{key:f,...m})))}function iY(...e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}var DP=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{DP&&(window.__reactRouterVersion="7.0.2")}catch{}function LP(e,t){return cP({basename:t==null?void 0:t.basename,future:t==null?void 0:t.future,history:wX({window:t==null?void 0:t.window}),hydrationData:(t==null?void 0:t.hydrationData)||$P(),routes:e,mapRouteProperties:TP,dataStrategy:t==null?void 0:t.dataStrategy,patchRoutesOnNavigation:t==null?void 0:t.patchRoutesOnNavigation,window:t==null?void 0:t.window}).initialize()}function sY(e,t){return cP({basename:t==null?void 0:t.basename,future:t==null?void 0:t.future,history:xX({window:t==null?void 0:t.window}),hydrationData:$P(),routes:e,mapRouteProperties:TP,dataStrategy:t==null?void 0:t.dataStrategy,patchRoutesOnNavigation:t==null?void 0:t.patchRoutesOnNavigation,window:t==null?void 0:t.window}).initialize()}function $P(){let e=window==null?void 0:window.__staticRouterHydrationData;return e&&e.errors&&(e={...e,errors:cY(e.errors)}),e}function cY(e){if(!e)return null;let t=Object.entries(e),n={};for(let[r,a]of t)if(a&&a.__type==="RouteErrorResponse")n[r]=new If(a.status,a.statusText,a.data,a.internal===!0);else if(a&&a.__type==="Error"){if(a.__subType){let o=window[a.__subType];if(typeof o=="function")try{let i=new o(a.message);i.stack="",n[r]=i}catch{}}if(n[r]==null){let o=new Error(a.message);o.stack="",n[r]=o}}else n[r]=a;return n}var FP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,J0=g.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:a,replace:o,state:i,target:s,to:c,preventScrollReset:l,viewTransition:u,...d},p){let{basename:f}=g.useContext(Gr),m=typeof c=="string"&&FP.test(c),y,v=!1;if(typeof c=="string"&&m&&(y=c,DP))try{let O=new URL(window.location.href),N=c.startsWith("//")?new URL(O.protocol+c):new URL(c),M=Kr(N.pathname,f);N.origin===O.origin&&M!=null?c=M+N.search+N.hash:v=!0}catch{un(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let b=mJ(c,{relative:r}),[w,j,x]=nY(n,d),_=pY(c,{replace:o,state:i,target:s,preventScrollReset:l,relative:r,viewTransition:u});function S(O){e&&e(O),O.defaultPrevented||_(O)}let E=g.createElement("a",{...d,...x,href:y||b,onClick:v||a?e:S,ref:iY(p,j),target:s,"data-discover":!m&&t==="render"?"true":void 0});return w&&!m?g.createElement(g.Fragment,null,E,g.createElement(rY,{page:b})):E});J0.displayName="Link";var lY=g.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:a,to:o,viewTransition:i,children:s,...c},l){let u=Su(o,{relative:c.relative}),d=Ra(),p=g.useContext(ju),{navigator:f,basename:m}=g.useContext(Gr),y=p!=null&&gY(u)&&i===!0,v=f.encodeLocation?f.encodeLocation(u).pathname:u.pathname,b=d.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;t||(b=b.toLowerCase(),w=w?w.toLowerCase():null,v=v.toLowerCase()),w&&m&&(w=Kr(w,m)||w);const j=v!=="/"&&v.endsWith("/")?v.length-1:v.length;let x=b===v||!r&&b.startsWith(v)&&b.charAt(j)==="/",_=w!=null&&(w===v||!r&&w.startsWith(v)&&w.charAt(v.length)==="/"),S={isActive:x,isPending:_,isTransitioning:y},E=x?e:void 0,O;typeof n=="function"?O=n(S):O=[n,x?"active":null,_?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let N=typeof a=="function"?a(S):a;return g.createElement(J0,{...c,"aria-current":E,className:O,ref:l,style:N,to:o,viewTransition:i},typeof s=="function"?s(S):s)});lY.displayName="NavLink";var uY=g.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:r,replace:a,state:o,method:i=Ff,action:s,onSubmit:c,relative:l,preventScrollReset:u,viewTransition:d,...p},f)=>{let m=mY(),y=yY(s,{relative:l}),v=i.toLowerCase()==="get"?"get":"post",b=typeof s=="string"&&FP.test(s),w=j=>{if(c&&c(j),j.defaultPrevented)return;j.preventDefault();let x=j.nativeEvent.submitter,_=(x==null?void 0:x.getAttribute("formmethod"))||i;m(x||j.currentTarget,{fetcherKey:t,method:_,navigate:n,replace:a,state:o,relative:l,preventScrollReset:u,viewTransition:d})};return g.createElement("form",{ref:f,method:v,action:y,onSubmit:r?c:w,...p,"data-discover":!b&&e==="render"?"true":void 0})});uY.displayName="Form";function dY(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function BP(e){let t=g.useContext(Qi);return Qe(t,dY(e)),t}function pY(e,{target:t,replace:n,state:r,preventScrollReset:a,relative:o,viewTransition:i}={}){let s=es(),c=Ra(),l=Su(e,{relative:o});return g.useCallback(u=>{if(UJ(u,t)){u.preventDefault();let d=n!==void 0?n:ho(c)===ho(l);s(e,{replace:d,state:r,preventScrollReset:a,relative:o,viewTransition:i})}},[c,s,l,n,r,t,e,a,o,i])}var fY=0,hY=()=>`__${String(++fY)}__`;function mY(){let{router:e}=BP("useSubmit"),{basename:t}=g.useContext(Gr),n=NJ();return g.useCallback(async(r,a={})=>{let{action:o,method:i,encType:s,formData:c,body:l}=WJ(r,t);if(a.navigate===!1){let u=a.fetcherKey||hY();await e.fetch(u,n,a.action||o,{preventScrollReset:a.preventScrollReset,formData:c,body:l,formMethod:a.method||i,formEncType:a.encType||s,flushSync:a.flushSync})}else await e.navigate(a.action||o,{preventScrollReset:a.preventScrollReset,formData:c,body:l,formMethod:a.method||i,formEncType:a.encType||s,replace:a.replace,state:a.state,fromRouteId:n,flushSync:a.flushSync,viewTransition:a.viewTransition})},[e,t,n])}function yY(e,{relative:t}={}){let{basename:n}=g.useContext(Gr),r=g.useContext(Cr);Qe(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),o={...Su(e||".",{relative:t})},i=Ra();if(e==null){o.search=i.search;let s=new URLSearchParams(o.search),c=s.getAll("index");if(c.some(l=>l==="")){s.delete("index"),c.filter(u=>u).forEach(u=>s.append("index",u));let l=s.toString();o.search=l?`?${l}`:""}}return(!e||e===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:Ia([n,o.pathname])),ho(o)}function gY(e,t={}){let n=g.useContext(V0);Qe(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=BP("useViewTransitionState"),a=Su(e,{relative:t.relative});if(!n.isTransitioning)return!1;let o=Kr(n.currentLocation.pathname,r)||n.currentLocation.pathname,i=Kr(n.nextLocation.pathname,r)||n.nextLocation.pathname;return Pf(a.pathname,i)!=null||Pf(a.pathname,o)!=null}new TextEncoder;function vY(e){return g.createElement(PJ,{flushSync:Ql.flushSync,...e})}var bY=CDe.useId||(()=>{}),wY=0;Rt=function(e){const[t,n]=g.useState(bY());return ln(()=>{e||n(r=>r??String(wY++))},[e]),e||(t?`radix-${t}`:"")};var Y0="Collapsible",[xY,zP]=ur(Y0),[_Y,Q0]=xY(Y0),UP=g.forwardRef((e,t)=>{const{__scopeCollapsible:n,open:r,defaultOpen:a,disabled:o,onOpenChange:i,...s}=e,[c=!1,l]=Tn({prop:r,defaultProp:a,onChange:i});return h.jsx(_Y,{scope:n,disabled:o,contentId:Rt(),open:c,onOpenToggle:g.useCallback(()=>l(u=>!u),[l]),children:h.jsx(Ae.div,{"data-state":rb(c),"data-disabled":o?"":void 0,...s,ref:t})})});UP.displayName=Y0;var VP="CollapsibleTrigger",eb=g.forwardRef((e,t)=>{const{__scopeCollapsible:n,...r}=e,a=Q0(VP,n);return h.jsx(Ae.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":rb(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...r,ref:t,onClick:ge(e.onClick,a.onOpenToggle)})});eb.displayName=VP;var tb="CollapsibleContent",nb=g.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=Q0(tb,e.__scopeCollapsible);return h.jsx(zr,{present:n||a.open,children:({present:o})=>h.jsx(jY,{...r,ref:t,present:o})})});nb.displayName=tb;var jY=g.forwardRef((e,t)=>{const{__scopeCollapsible:n,present:r,children:a,...o}=e,i=Q0(tb,n),[s,c]=g.useState(r),l=g.useRef(null),u=jt(t,l),d=g.useRef(0),p=d.current,f=g.useRef(0),m=f.current,y=i.open||s,v=g.useRef(y),b=g.useRef();return g.useEffect(()=>{const w=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(w)},[]),ln(()=>{const w=l.current;if(w){b.current=b.current||{transitionDuration:w.style.transitionDuration,animationName:w.style.animationName},w.style.transitionDuration="0s",w.style.animationName="none";const j=w.getBoundingClientRect();d.current=j.height,f.current=j.width,v.current||(w.style.transitionDuration=b.current.transitionDuration,w.style.animationName=b.current.animationName),c(r)}},[i.open,r]),h.jsx(Ae.div,{"data-state":rb(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!y,...o,ref:u,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":m?`${m}px`:void 0,...e.style},children:y&&a})});function rb(e){return e?"open":"closed"}var qP=UP,SY=eb,EY=nb;const OY=qP,CY=eb,NY=nb,ab=768;function MY(){const[e,t]=g.useState(void 0);return g.useEffect(()=>{const n=window.matchMedia(`(max-width: ${ab-1}px)`),r=()=>{t(window.innerWidth<ab)};return n.addEventListener("change",r),t(window.innerWidth<ab),()=>n.removeEventListener("change",r)},[]),!!e}let Ou;Ou=lo("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ye=g.forwardRef(({className:e,variant:t,size:n,asChild:r=!1,...a},o)=>{const i=r?ri:"button";return h.jsx(i,{className:Z(Ou({variant:t,size:n,className:e})),ref:o,...a})}),Ye.displayName="Button";const Kt=g.forwardRef(({className:e,type:t,...n},r)=>h.jsx("input",{type:t,className:Z("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...n}));Kt.displayName="Input";var kY="Separator",WP="horizontal",PY=["horizontal","vertical"],HP=g.forwardRef((e,t)=>{const{decorative:n,orientation:r=WP,...a}=e,o=AY(r)?r:WP,i=n?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return h.jsx(Ae.div,{"data-orientation":o,...i,...a,ref:t})});HP.displayName=kY;function AY(e){return PY.includes(e)}t0=HP,Gs=g.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...r},a)=>h.jsx(t0,{ref:a,decorative:n,orientation:t,className:Z("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...r})),Gs.displayName=t0.displayName;var ob="focusScope.autoFocusOnMount",ib="focusScope.autoFocusOnUnmount",KP={bubbles:!1,cancelable:!0},TY="FocusScope",Vf=g.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:a,onUnmountAutoFocus:o,...i}=e,[s,c]=g.useState(null),l=dr(a),u=dr(o),d=g.useRef(null),p=jt(t,y=>c(y)),f=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(r){let y=function(j){if(f.paused||!s)return;const x=j.target;s.contains(x)?d.current=x:li(d.current,{select:!0})},v=function(j){if(f.paused||!s)return;const x=j.relatedTarget;x!==null&&(s.contains(x)||li(d.current,{select:!0}))},b=function(j){if(document.activeElement===document.body)for(const x of j)x.removedNodes.length>0&&li(s)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const w=new MutationObserver(b);return s&&w.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),w.disconnect()}}},[r,s,f.paused]),g.useEffect(()=>{if(s){XP.add(f);const y=document.activeElement;if(!s.contains(y)){const v=new CustomEvent(ob,KP);s.addEventListener(ob,l),s.dispatchEvent(v),v.defaultPrevented||(IY(FY(ZP(s)),{select:!0}),document.activeElement===y&&li(s))}return()=>{s.removeEventListener(ob,l),setTimeout(()=>{const v=new CustomEvent(ib,KP);s.addEventListener(ib,u),s.dispatchEvent(v),v.defaultPrevented||li(y??document.body,{select:!0}),s.removeEventListener(ib,u),XP.remove(f)},0)}}},[s,l,u,f]);const m=g.useCallback(y=>{if(!n&&!r||f.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,b=document.activeElement;if(v&&b){const w=y.currentTarget,[j,x]=RY(w);j&&x?!y.shiftKey&&b===x?(y.preventDefault(),n&&li(j,{select:!0})):y.shiftKey&&b===j&&(y.preventDefault(),n&&li(x,{select:!0})):b===w&&y.preventDefault()}},[n,r,f.paused]);return h.jsx(Ae.div,{tabIndex:-1,...i,ref:p,onKeyDown:m})});Vf.displayName=TY;function IY(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(li(r,{select:t}),document.activeElement!==n)return}function RY(e){const t=ZP(e),n=GP(t,e),r=GP(t.reverse(),e);return[n,r]}function ZP(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const a=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||a?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function GP(e,t){for(const n of e)if(!DY(n,{upTo:t}))return n}function DY(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function LY(e){return e instanceof HTMLInputElement&&"select"in e}function li(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&LY(e)&&t&&e.select()}}var XP=$Y();function $Y(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=JP(e,t),e.unshift(t)},remove(t){var n;e=JP(e,t),(n=e[0])==null||n.resume()}}}function JP(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function FY(e){return e.filter(t=>t.tagName!=="A")}var sb=0;hu=function(){g.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??YP()),document.body.insertAdjacentElement("beforeend",e[1]??YP()),sb++,()=>{sb===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),sb--}},[])};function YP(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}En=function(){return En=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},En.apply(this,arguments)},jf=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n},g0=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,o;r<a;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};var qf="right-scroll-bar-position",Wf="width-before-scroll-bar",BY="with-scroll-bars-hidden",zY="--removed-body-scroll-bar-size";function cb(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function UY(e,t){var n=g.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var a=n.value;a!==r&&(n.value=r,n.callback(r,a))}}}})[0];return n.callback=t,n.facade}var VY=typeof window<"u"?g.useLayoutEffect:g.useEffect,QP=new WeakMap;function qY(e,t){var n=UY(null,function(r){return e.forEach(function(a){return cb(a,r)})});return VY(function(){var r=QP.get(n);if(r){var a=new Set(r),o=new Set(e),i=n.current;a.forEach(function(s){o.has(s)||cb(s,null)}),o.forEach(function(s){a.has(s)||cb(s,i)})}QP.set(n,e)},[e]),n}function WY(e){return e}function HY(e,t){t===void 0&&(t=WY);var n=[],r=!1,a={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(o){var i=t(o,r);return n.push(i),function(){n=n.filter(function(s){return s!==i})}},assignSyncMedium:function(o){for(r=!0;n.length;){var i=n;n=[],i.forEach(o)}n={push:function(s){return o(s)},filter:function(){return n}}},assignMedium:function(o){r=!0;var i=[];if(n.length){var s=n;n=[],s.forEach(o),i=n}var c=function(){var u=i;i=[],u.forEach(o)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(u){i.push(u),l()},filter:function(u){return i=i.filter(u),n}}}};return a}m0=function(e){e===void 0&&(e={});var t=HY(null);return t.options=En({async:!0,ssr:!1},e),t};var eA=function(e){var t=e.sideCar,n=jf(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return g.createElement(r,En({},n))};eA.isSideCarExport=!0,v0=function(e,t){return e.useMedium(t),eA};var tA=m0(),lb=function(){},Hf=g.forwardRef(function(e,t){var n=g.useRef(null),r=g.useState({onScrollCapture:lb,onWheelCapture:lb,onTouchMoveCapture:lb}),a=r[0],o=r[1],i=e.forwardProps,s=e.children,c=e.className,l=e.removeScrollBar,u=e.enabled,d=e.shards,p=e.sideCar,f=e.noIsolation,m=e.inert,y=e.allowPinchZoom,v=e.as,b=v===void 0?"div":v,w=e.gapMode,j=jf(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=p,_=qY([n,t]),S=En(En({},j),a);return g.createElement(g.Fragment,null,u&&g.createElement(x,{sideCar:tA,removeScrollBar:l,shards:d,noIsolation:f,inert:m,setCallbacks:o,allowPinchZoom:!!y,lockRef:n,gapMode:w}),i?g.cloneElement(g.Children.only(s),En(En({},S),{ref:_})):g.createElement(b,En({},S,{className:c,ref:_}),s))});Hf.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Hf.classNames={fullWidth:Wf,zeroRight:qf},y0=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function KY(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=y0();return t&&e.setAttribute("nonce",t),e}function ZY(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function GY(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}let nA,rA,aA,Kf,oA,iA,sA,ts,cA,ub,lA,uA,Zf;if(nA=function(){var e=0,t=null;return{add:function(n){e==0&&(t=KY())&&(ZY(t,n),GY(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},rA=function(){var e=nA();return function(t,n){g.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},Sf=function(){var e=rA(),t=function(n){var r=n.styles,a=n.dynamic;return e(r,a),null};return t},aA={left:0,top:0,right:0,gap:0},Kf=function(e){return parseInt(e||"",10)||0},oA=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],a=t[e==="padding"?"paddingRight":"marginRight"];return[Kf(n),Kf(r),Kf(a)]},iA=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return aA;var t=oA(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},sA=Sf(),ts="data-scroll-locked",cA=function(e,t,n,r){var a=e.left,o=e.top,i=e.right,s=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(BY,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(s,"px ").concat(r,`;
  }
  body[`).concat(ts,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(qf,` {
    right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(Wf,` {
    margin-right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(qf," .").concat(qf,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Wf," .").concat(Wf,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(ts,`] {
    `).concat(zY,": ").concat(s,`px;
  }
`)},ub=function(){var e=parseInt(document.body.getAttribute(ts)||"0",10);return isFinite(e)?e:0},lA=function(){g.useEffect(function(){return document.body.setAttribute(ts,(ub()+1).toString()),function(){var e=ub()-1;e<=0?document.body.removeAttribute(ts):document.body.setAttribute(ts,e.toString())}},[])},uA=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,a=r===void 0?"margin":r;lA();var o=g.useMemo(function(){return iA(a)},[a]);return g.createElement(sA,{styles:cA(o,!t,a,n?"":"!important")})},Zf=!1,typeof window<"u")try{var Gf=Object.defineProperty({},"passive",{get:function(){return Zf=!0,!0}});window.addEventListener("test",Gf,Gf),window.removeEventListener("test",Gf,Gf)}catch{Zf=!1}var nc=Zf?{passive:!1}:!1,XY=function(e){return e.tagName==="TEXTAREA"},dA=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!XY(e)&&n[t]==="visible")},JY=function(e){return dA(e,"overflowY")},YY=function(e){return dA(e,"overflowX")},pA=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var a=fA(e,r);if(a){var o=hA(e,r),i=o[1],s=o[2];if(i>s)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},QY=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},eQ=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},fA=function(e,t){return e==="v"?JY(t):YY(t)},hA=function(e,t){return e==="v"?QY(t):eQ(t)},tQ=function(e,t){return e==="h"&&t==="rtl"?-1:1},nQ=function(e,t,n,r,a){var o=tQ(e,window.getComputedStyle(t).direction),i=o*r,s=n.target,c=t.contains(s),l=!1,u=i>0,d=0,p=0;do{var f=hA(e,s),m=f[0],y=f[1],v=f[2],b=y-v-o*m;(m||b)&&fA(e,s)&&(d+=b,p+=m),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!c&&s!==document.body||c&&(t.contains(s)||t===s));return(u&&(Math.abs(d)<1||!a)||!u&&(Math.abs(p)<1||!a))&&(l=!0),l},Xf=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},mA=function(e){return[e.deltaX,e.deltaY]},yA=function(e){return e&&"current"in e?e.current:e},rQ=function(e,t){return e[0]===t[0]&&e[1]===t[1]},aQ=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},oQ=0,rc=[];function iQ(e){var t=g.useRef([]),n=g.useRef([0,0]),r=g.useRef(),a=g.useState(oQ++)[0],o=g.useState(Sf)[0],i=g.useRef(e);g.useEffect(function(){i.current=e},[e]),g.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var y=g0([e.lockRef.current],(e.shards||[]).map(yA),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var s=g.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var b=Xf(y),w=n.current,j="deltaX"in y?y.deltaX:w[0]-b[0],x="deltaY"in y?y.deltaY:w[1]-b[1],_,S=y.target,E=Math.abs(j)>Math.abs(x)?"h":"v";if("touches"in y&&E==="h"&&S.type==="range")return!1;var O=pA(E,S);if(!O)return!0;if(O?_=E:(_=E==="v"?"h":"v",O=pA(E,S)),!O)return!1;if(!r.current&&"changedTouches"in y&&(j||x)&&(r.current=_),!_)return!0;var N=r.current||_;return nQ(N,v,y,N==="h"?j:x,!0)},[]),c=g.useCallback(function(y){var v=y;if(!(!rc.length||rc[rc.length-1]!==o)){var b="deltaY"in v?mA(v):Xf(v),w=t.current.filter(function(_){return _.name===v.type&&(_.target===v.target||v.target===_.shadowParent)&&rQ(_.delta,b)})[0];if(w&&w.should){v.cancelable&&v.preventDefault();return}if(!w){var j=(i.current.shards||[]).map(yA).filter(Boolean).filter(function(_){return _.contains(v.target)}),x=j.length>0?s(v,j[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),l=g.useCallback(function(y,v,b,w){var j={name:y,delta:v,target:b,should:w,shadowParent:sQ(b)};t.current.push(j),setTimeout(function(){t.current=t.current.filter(function(x){return x!==j})},1)},[]),u=g.useCallback(function(y){n.current=Xf(y),r.current=void 0},[]),d=g.useCallback(function(y){l(y.type,mA(y),y.target,s(y,e.lockRef.current))},[]),p=g.useCallback(function(y){l(y.type,Xf(y),y.target,s(y,e.lockRef.current))},[]);g.useEffect(function(){return rc.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:p}),document.addEventListener("wheel",c,nc),document.addEventListener("touchmove",c,nc),document.addEventListener("touchstart",u,nc),function(){rc=rc.filter(function(y){return y!==o}),document.removeEventListener("wheel",c,nc),document.removeEventListener("touchmove",c,nc),document.removeEventListener("touchstart",u,nc)}},[]);var f=e.removeScrollBar,m=e.inert;return g.createElement(g.Fragment,null,m?g.createElement(o,{styles:aQ(a)}):null,f?g.createElement(uA,{gapMode:e.gapMode}):null)}function sQ(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const cQ=v0(tA,iQ);var Jf=g.forwardRef(function(e,t){return g.createElement(Hf,En({},e,{ref:t,sideCar:cQ}))});Jf.classNames=Hf.classNames;let gA,ns,Cu,Nu,Yf,db,vA,bA,Qf,pb,fb,wA,Nr,hb;gA=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},ns=new WeakMap,Cu=new WeakMap,Nu={},Yf=0,db=function(e){return e&&(e.host||db(e.parentNode))},vA=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=db(n);return r&&e.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},bA=function(e,t,n,r){var a=vA(t,Array.isArray(e)?e:[e]);Nu[n]||(Nu[n]=new WeakMap);var o=Nu[n],i=[],s=new Set,c=new Set(a),l=function(d){!d||s.has(d)||(s.add(d),l(d.parentNode))};a.forEach(l);var u=function(d){!d||c.has(d)||Array.prototype.forEach.call(d.children,function(p){if(s.has(p))u(p);else try{var f=p.getAttribute(r),m=f!==null&&f!=="false",y=(ns.get(p)||0)+1,v=(o.get(p)||0)+1;ns.set(p,y),o.set(p,v),i.push(p),y===1&&m&&Cu.set(p,!0),v===1&&p.setAttribute(n,"true"),m||p.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",p,b)}})};return u(t),s.clear(),Yf++,function(){i.forEach(function(d){var p=ns.get(d)-1,f=o.get(d)-1;ns.set(d,p),o.set(d,f),p||(Cu.has(d)||d.removeAttribute(r),Cu.delete(d)),f||d.removeAttribute(n)}),Yf--,Yf||(ns=new WeakMap,ns=new WeakMap,Cu=new WeakMap,Nu={})}},fu=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),a=gA(e);return a?(r.push.apply(r,Array.from(a.querySelectorAll("[aria-live]"))),bA(r,a,n,"aria-hidden")):function(){return null}},Qf="Dialog",[pb,fb]=ur(Qf),[wA,Nr]=pb(Qf),hb=e=>{const{__scopeDialog:t,children:n,open:r,defaultOpen:a,onOpenChange:o,modal:i=!0}=e,s=g.useRef(null),c=g.useRef(null),[l=!1,u]=Tn({prop:r,defaultProp:a,onChange:o});return h.jsx(wA,{scope:t,triggerRef:s,contentRef:c,contentId:Rt(),titleId:Rt(),descriptionId:Rt(),open:l,onOpenChange:u,onOpenToggle:g.useCallback(()=>u(d=>!d),[u]),modal:i,children:n})},hb.displayName=Qf;var xA="DialogTrigger",_A=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=Nr(xA,n),o=jt(t,a.triggerRef);return h.jsx(Ae.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":gb(a.open),...r,ref:o,onClick:ge(e.onClick,a.onOpenToggle)})});_A.displayName=xA;var mb="DialogPortal",[lQ,jA]=pb(mb,{forceMount:void 0}),SA=e=>{const{__scopeDialog:t,forceMount:n,children:r,container:a}=e,o=Nr(mb,t);return h.jsx(lQ,{scope:t,forceMount:n,children:g.Children.map(r,i=>h.jsx(zr,{present:n||o.open,children:h.jsx(Ov,{asChild:!0,container:a,children:i})}))})};SA.displayName=mb;var eh="DialogOverlay",EA=g.forwardRef((e,t)=>{const n=jA(eh,e.__scopeDialog),{forceMount:r=n.forceMount,...a}=e,o=Nr(eh,e.__scopeDialog);return o.modal?h.jsx(zr,{present:r||o.open,children:h.jsx(uQ,{...a,ref:t})}):null});EA.displayName=eh;var uQ=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=Nr(eh,n);return h.jsx(Jf,{as:ri,allowPinchZoom:!0,shards:[a.contentRef],children:h.jsx(Ae.div,{"data-state":gb(a.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),rs="DialogContent",OA=g.forwardRef((e,t)=>{const n=jA(rs,e.__scopeDialog),{forceMount:r=n.forceMount,...a}=e,o=Nr(rs,e.__scopeDialog);return h.jsx(zr,{present:r||o.open,children:o.modal?h.jsx(dQ,{...a,ref:t}):h.jsx(pQ,{...a,ref:t})})});OA.displayName=rs;var dQ=g.forwardRef((e,t)=>{const n=Nr(rs,e.__scopeDialog),r=g.useRef(null),a=jt(t,n.contentRef,r);return g.useEffect(()=>{const o=r.current;if(o)return fu(o)},[]),h.jsx(CA,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(e.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=n.triggerRef.current)==null||i.focus()}),onPointerDownOutside:ge(e.onPointerDownOutside,o=>{const i=o.detail.originalEvent,s=i.button===0&&i.ctrlKey===!0;(i.button===2||s)&&o.preventDefault()}),onFocusOutside:ge(e.onFocusOutside,o=>o.preventDefault())})}),pQ=g.forwardRef((e,t)=>{const n=Nr(rs,e.__scopeDialog),r=g.useRef(!1),a=g.useRef(!1);return h.jsx(CA,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,s;(i=e.onCloseAutoFocus)==null||i.call(e,o),o.defaultPrevented||(r.current||((s=n.triggerRef.current)==null||s.focus()),o.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:o=>{var s,c;(s=e.onInteractOutside)==null||s.call(e,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=o.target;(c=n.triggerRef.current)!=null&&c.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),CA=g.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:o,...i}=e,s=Nr(rs,n),c=g.useRef(null),l=jt(t,c);return hu(),h.jsxs(h.Fragment,{children:[h.jsx(Vf,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:o,children:h.jsx(Ev,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":gb(s.open),...i,ref:l,onDismiss:()=>s.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(IA,{titleId:s.titleId}),h.jsx(DA,{contentRef:c,descriptionId:s.descriptionId})]})]})}),yb="DialogTitle",NA=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=Nr(yb,n);return h.jsx(Ae.h2,{id:a.titleId,...r,ref:t})});NA.displayName=yb;var MA="DialogDescription",kA=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=Nr(MA,n);return h.jsx(Ae.p,{id:a.descriptionId,...r,ref:t})});kA.displayName=MA;var PA="DialogClose",AA=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,a=Nr(PA,n);return h.jsx(Ae.button,{type:"button",...r,ref:t,onClick:ge(e.onClick,()=>a.onOpenChange(!1))})});AA.displayName=PA;function gb(e){return e?"open":"closed"}let vb,TA,bb,IA,RA,DA,LA;vb="DialogTitleWarning",[TA,bb]=NDe(vb,{contentName:rs,titleName:yb,docsSlug:"dialog"}),IA=({titleId:e})=>{const t=bb(vb),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return g.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},RA="DialogDescriptionWarning",DA=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bb(RA).contentName}}.`;return g.useEffect(()=>{var a;const r=(a=e.current)==null?void 0:a.getAttribute("aria-describedby");t&&r&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},ou=hb,LA=_A,cu=SA,Zi=EA,Gi=OA,Ks=NA,Zs=kA,lu=AA;const fQ=ou,hQ=cu,$A=g.forwardRef(({className:e,...t},n)=>h.jsx(Zi,{className:Z("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));$A.displayName=Zi.displayName;const mQ=lo("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),FA=g.forwardRef(({side:e="right",className:t,children:n,...r},a)=>h.jsxs(hQ,{children:[h.jsx($A,{}),h.jsxs(Gi,{ref:a,className:Z(mQ({side:e}),t),...r,children:[n,h.jsxs(lu,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[h.jsx(pe,{name:"x",className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));FA.displayName=Gi.displayName;const yQ=g.forwardRef(({className:e,...t},n)=>h.jsx(Ks,{ref:n,className:Z("text-lg font-semibold text-foreground",e),...t}));yQ.displayName=Ks.displayName;const gQ=g.forwardRef(({className:e,...t},n)=>h.jsx(Zs,{ref:n,className:Z("text-sm text-muted-foreground",e),...t}));gQ.displayName=Zs.displayName;function BA({className:e,...t}){return h.jsx("div",{className:Z("animate-pulse rounded-md bg-muted",e),...t})}const vQ=["top","right","bottom","left"],Da=Math.min,mr=Math.max,th=Math.round,nh=Math.floor,ui=e=>({x:e,y:e}),bQ={left:"right",right:"left",bottom:"top",top:"bottom"},wQ={start:"end",end:"start"};function wb(e,t,n){return mr(e,Da(t,n))}function yo(e,t){return typeof e=="function"?e(t):e}function go(e){return e.split("-")[0]}function ac(e){return e.split("-")[1]}function xb(e){return e==="x"?"y":"x"}function _b(e){return e==="y"?"height":"width"}function di(e){return["top","bottom"].includes(go(e))?"y":"x"}function jb(e){return xb(di(e))}function xQ(e,t,n){n===void 0&&(n=!1);const r=ac(e),a=jb(e),o=_b(a);let i=a==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(i=rh(i)),[i,rh(i)]}function _Q(e){const t=rh(e);return[Sb(e),t,Sb(t)]}function Sb(e){return e.replace(/start|end/g,t=>wQ[t])}function jQ(e,t,n){const r=["left","right"],a=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(e){case"top":case"bottom":return n?t?a:r:t?r:a;case"left":case"right":return t?o:i;default:return[]}}function SQ(e,t,n,r){const a=ac(e);let o=jQ(go(e),n==="start",r);return a&&(o=o.map(i=>i+"-"+a),t&&(o=o.concat(o.map(Sb)))),o}function rh(e){return e.replace(/left|right|bottom|top/g,t=>bQ[t])}function EQ(e){return{top:0,right:0,bottom:0,left:0,...e}}function zA(e){return typeof e!="number"?EQ(e):{top:e,right:e,bottom:e,left:e}}function ah(e){const{x:t,y:n,width:r,height:a}=e;return{width:r,height:a,top:n,left:t,right:t+r,bottom:n+a,x:t,y:n}}function UA(e,t,n){let{reference:r,floating:a}=e;const o=di(t),i=jb(t),s=_b(i),c=go(t),l=o==="y",u=r.x+r.width/2-a.width/2,d=r.y+r.height/2-a.height/2,p=r[s]/2-a[s]/2;let f;switch(c){case"top":f={x:u,y:r.y-a.height};break;case"bottom":f={x:u,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:d};break;case"left":f={x:r.x-a.width,y:d};break;default:f={x:r.x,y:r.y}}switch(ac(t)){case"start":f[i]-=p*(n&&l?-1:1);break;case"end":f[i]+=p*(n&&l?-1:1);break}return f}const OQ=async(e,t,n)=>{const{placement:r="bottom",strategy:a="absolute",middleware:o=[],platform:i}=n,s=o.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(t));let l=await i.getElementRects({reference:e,floating:t,strategy:a}),{x:u,y:d}=UA(l,r,c),p=r,f={},m=0;for(let y=0;y<s.length;y++){const{name:v,fn:b}=s[y],{x:w,y:j,data:x,reset:_}=await b({x:u,y:d,initialPlacement:r,placement:p,strategy:a,middlewareData:f,rects:l,platform:i,elements:{reference:e,floating:t}});u=w??u,d=j??d,f={...f,[v]:{...f[v],...x}},_&&m<=50&&(m++,typeof _=="object"&&(_.placement&&(p=_.placement),_.rects&&(l=_.rects===!0?await i.getElementRects({reference:e,floating:t,strategy:a}):_.rects),{x:u,y:d}=UA(l,p,c)),y=-1)}return{x:u,y:d,placement:p,strategy:a,middlewareData:f}};async function Mu(e,t){var n;t===void 0&&(t={});const{x:r,y:a,platform:o,rects:i,elements:s,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:p=!1,padding:f=0}=yo(t,e),m=zA(f),y=s[p?d==="floating"?"reference":"floating":d],v=ah(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(y)))==null||n?y:y.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(s.floating)),boundary:l,rootBoundary:u,strategy:c})),b=d==="floating"?{x:r,y:a,width:i.floating.width,height:i.floating.height}:i.reference,w=await(o.getOffsetParent==null?void 0:o.getOffsetParent(s.floating)),j=await(o.isElement==null?void 0:o.isElement(w))?await(o.getScale==null?void 0:o.getScale(w))||{x:1,y:1}:{x:1,y:1},x=ah(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:b,offsetParent:w,strategy:c}):b);return{top:(v.top-x.top+m.top)/j.y,bottom:(x.bottom-v.bottom+m.bottom)/j.y,left:(v.left-x.left+m.left)/j.x,right:(x.right-v.right+m.right)/j.x}}const CQ=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:a,rects:o,platform:i,elements:s,middlewareData:c}=t,{element:l,padding:u=0}=yo(e,t)||{};if(l==null)return{};const d=zA(u),p={x:n,y:r},f=jb(a),m=_b(f),y=await i.getDimensions(l),v=f==="y",b=v?"top":"left",w=v?"bottom":"right",j=v?"clientHeight":"clientWidth",x=o.reference[m]+o.reference[f]-p[f]-o.floating[m],_=p[f]-o.reference[f],S=await(i.getOffsetParent==null?void 0:i.getOffsetParent(l));let E=S?S[j]:0;(!E||!await(i.isElement==null?void 0:i.isElement(S)))&&(E=s.floating[j]||o.floating[m]);const O=x/2-_/2,N=E/2-y[m]/2-1,M=Da(d[b],N),k=Da(d[w],N),P=M,A=E-y[m]-k,C=E/2-y[m]/2+O,I=wb(P,C,A),T=!c.arrow&&ac(a)!=null&&C!==I&&o.reference[m]/2-(C<P?M:k)-y[m]/2<0,R=T?C<P?C-P:C-A:0;return{[f]:p[f]+R,data:{[f]:I,centerOffset:C-I-R,...T&&{alignmentOffset:R}},reset:T}}}),NQ=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:a,middlewareData:o,rects:i,initialPlacement:s,platform:c,elements:l}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:y=!0,...v}=yo(e,t);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const b=go(a),w=di(s),j=go(s)===s,x=await(c.isRTL==null?void 0:c.isRTL(l.floating)),_=p||(j||!y?[rh(s)]:_Q(s)),S=m!=="none";!p&&S&&_.push(...SQ(s,y,m,x));const E=[s,..._],O=await Mu(t,v),N=[];let M=((r=o.flip)==null?void 0:r.overflows)||[];if(u&&N.push(O[b]),d){const C=xQ(a,i,x);N.push(O[C[0]],O[C[1]])}if(M=[...M,{placement:a,overflows:N}],!N.every(C=>C<=0)){var k,P;const C=(((k=o.flip)==null?void 0:k.index)||0)+1,I=E[C];if(I)return{data:{index:C,overflows:M},reset:{placement:I}};let T=(P=M.filter(R=>R.overflows[0]<=0).sort((R,L)=>R.overflows[1]-L.overflows[1])[0])==null?void 0:P.placement;if(!T)switch(f){case"bestFit":{var A;const R=(A=M.filter(L=>{if(S){const D=di(L.placement);return D===w||D==="y"}return!0}).map(L=>[L.placement,L.overflows.filter(D=>D>0).reduce((D,z)=>D+z,0)]).sort((L,D)=>L[1]-D[1])[0])==null?void 0:A[0];R&&(T=R);break}case"initialPlacement":T=s;break}if(a!==T)return{reset:{placement:T}}}return{}}}};function VA(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function qA(e){return vQ.some(t=>e[t]>=0)}const MQ=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...a}=yo(e,t);switch(r){case"referenceHidden":{const o=await Mu(t,{...a,elementContext:"reference"}),i=VA(o,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:qA(i)}}}case"escaped":{const o=await Mu(t,{...a,altBoundary:!0}),i=VA(o,n.floating);return{data:{escapedOffsets:i,escaped:qA(i)}}}default:return{}}}}};async function kQ(e,t){const{placement:n,platform:r,elements:a}=e,o=await(r.isRTL==null?void 0:r.isRTL(a.floating)),i=go(n),s=ac(n),c=di(n)==="y",l=["left","top"].includes(i)?-1:1,u=o&&c?-1:1,d=yo(t,e);let{mainAxis:p,crossAxis:f,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return s&&typeof m=="number"&&(f=s==="end"?m*-1:m),c?{x:f*u,y:p*l}:{x:p*l,y:f*u}}const PQ=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:a,y:o,placement:i,middlewareData:s}=t,c=await kQ(t,e);return i===((n=s.offset)==null?void 0:n.placement)&&(r=s.arrow)!=null&&r.alignmentOffset?{}:{x:a+c.x,y:o+c.y,data:{...c,placement:i}}}}},AQ=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:a}=t,{mainAxis:o=!0,crossAxis:i=!1,limiter:s={fn:v=>{let{x:b,y:w}=v;return{x:b,y:w}}},...c}=yo(e,t),l={x:n,y:r},u=await Mu(t,c),d=di(go(a)),p=xb(d);let f=l[p],m=l[d];if(o){const v=p==="y"?"top":"left",b=p==="y"?"bottom":"right",w=f+u[v],j=f-u[b];f=wb(w,f,j)}if(i){const v=d==="y"?"top":"left",b=d==="y"?"bottom":"right",w=m+u[v],j=m-u[b];m=wb(w,m,j)}const y=s.fn({...t,[p]:f,[d]:m});return{...y,data:{x:y.x-n,y:y.y-r}}}}},TQ=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:a,rects:o,middlewareData:i}=t,{offset:s=0,mainAxis:c=!0,crossAxis:l=!0}=yo(e,t),u={x:n,y:r},d=di(a),p=xb(d);let f=u[p],m=u[d];const y=yo(s,t),v=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(c){const j=p==="y"?"height":"width",x=o.reference[p]-o.floating[j]+v.mainAxis,_=o.reference[p]+o.reference[j]-v.mainAxis;f<x?f=x:f>_&&(f=_)}if(l){var b,w;const j=p==="y"?"width":"height",x=["top","left"].includes(go(a)),_=o.reference[d]-o.floating[j]+(x&&((b=i.offset)==null?void 0:b[d])||0)+(x?0:v.crossAxis),S=o.reference[d]+o.reference[j]+(x?0:((w=i.offset)==null?void 0:w[d])||0)-(x?v.crossAxis:0);m<_?m=_:m>S&&(m=S)}return{[p]:f,[d]:m}}}},IQ=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){const{placement:n,rects:r,platform:a,elements:o}=t,{apply:i=()=>{},...s}=yo(e,t),c=await Mu(t,s),l=go(n),u=ac(n),d=di(n)==="y",{width:p,height:f}=r.floating;let m,y;l==="top"||l==="bottom"?(m=l,y=u===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(y=l,m=u==="end"?"top":"bottom");const v=f-c.top-c.bottom,b=p-c.left-c.right,w=Da(f-c[m],v),j=Da(p-c[y],b),x=!t.middlewareData.shift;let _=w,S=j;if(d?S=u||x?Da(j,b):b:_=u||x?Da(w,v):v,x&&!u){const O=mr(c.left,0),N=mr(c.right,0),M=mr(c.top,0),k=mr(c.bottom,0);d?S=p-2*(O!==0||N!==0?O+N:mr(c.left,c.right)):_=f-2*(M!==0||k!==0?M+k:mr(c.top,c.bottom))}await i({...t,availableWidth:S,availableHeight:_});const E=await a.getDimensions(o.floating);return p!==E.width||f!==E.height?{reset:{rects:!0}}:{}}}};function oc(e){return WA(e)?(e.nodeName||"").toLowerCase():"#document"}function yr(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function vo(e){var t;return(t=(WA(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function WA(e){return e instanceof Node||e instanceof yr(e).Node}function Xr(e){return e instanceof Element||e instanceof yr(e).Element}function La(e){return e instanceof HTMLElement||e instanceof yr(e).HTMLElement}function HA(e){return typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof yr(e).ShadowRoot}function ku(e){const{overflow:t,overflowX:n,overflowY:r,display:a}=Jr(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(a)}function RQ(e){return["table","td","th"].includes(oc(e))}function oh(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function Eb(e){const t=Ob(),n=Xr(e)?Jr(e):e;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function DQ(e){let t=pi(e);for(;La(t)&&!ic(t);){if(Eb(t))return t;if(oh(t))return null;t=pi(t)}return null}function Ob(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ic(e){return["html","body","#document"].includes(oc(e))}function Jr(e){return yr(e).getComputedStyle(e)}function ih(e){return Xr(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function pi(e){if(oc(e)==="html")return e;const t=e.assignedSlot||e.parentNode||HA(e)&&e.host||vo(e);return HA(t)?t.host:t}function KA(e){const t=pi(e);return ic(t)?e.ownerDocument?e.ownerDocument.body:e.body:La(t)&&ku(t)?t:KA(t)}function Pu(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);const a=KA(e),o=a===((r=e.ownerDocument)==null?void 0:r.body),i=yr(a);if(o){const s=Cb(i);return t.concat(i,i.visualViewport||[],ku(a)?a:[],s&&n?Pu(s):[])}return t.concat(a,Pu(a,[],n))}function Cb(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function ZA(e){const t=Jr(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const a=La(e),o=a?e.offsetWidth:n,i=a?e.offsetHeight:r,s=th(n)!==o||th(r)!==i;return s&&(n=o,r=i),{width:n,height:r,$:s}}function Nb(e){return Xr(e)?e:e.contextElement}function sc(e){const t=Nb(e);if(!La(t))return ui(1);const n=t.getBoundingClientRect(),{width:r,height:a,$:o}=ZA(t);let i=(o?th(n.width):n.width)/r,s=(o?th(n.height):n.height)/a;return(!i||!Number.isFinite(i))&&(i=1),(!s||!Number.isFinite(s))&&(s=1),{x:i,y:s}}const LQ=ui(0);function GA(e){const t=yr(e);return!Ob()||!t.visualViewport?LQ:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function $Q(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==yr(e)?!1:t}function as(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const a=e.getBoundingClientRect(),o=Nb(e);let i=ui(1);t&&(r?Xr(r)&&(i=sc(r)):i=sc(e));const s=$Q(o,n,r)?GA(o):ui(0);let c=(a.left+s.x)/i.x,l=(a.top+s.y)/i.y,u=a.width/i.x,d=a.height/i.y;if(o){const p=yr(o),f=r&&Xr(r)?yr(r):r;let m=p,y=Cb(m);for(;y&&r&&f!==m;){const v=sc(y),b=y.getBoundingClientRect(),w=Jr(y),j=b.left+(y.clientLeft+parseFloat(w.paddingLeft))*v.x,x=b.top+(y.clientTop+parseFloat(w.paddingTop))*v.y;c*=v.x,l*=v.y,u*=v.x,d*=v.y,c+=j,l+=x,m=yr(y),y=Cb(m)}}return ah({width:u,height:d,x:c,y:l})}function FQ(e){let{elements:t,rect:n,offsetParent:r,strategy:a}=e;const o=a==="fixed",i=vo(r),s=t?oh(t.floating):!1;if(r===i||s&&o)return n;let c={scrollLeft:0,scrollTop:0},l=ui(1);const u=ui(0),d=La(r);if((d||!d&&!o)&&((oc(r)!=="body"||ku(i))&&(c=ih(r)),La(r))){const p=as(r);l=sc(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x,y:n.y*l.y-c.scrollTop*l.y+u.y}}function BQ(e){return Array.from(e.getClientRects())}function XA(e){return as(vo(e)).left+ih(e).scrollLeft}function zQ(e){const t=vo(e),n=ih(e),r=e.ownerDocument.body,a=mr(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=mr(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+XA(e);const s=-n.scrollTop;return Jr(r).direction==="rtl"&&(i+=mr(t.clientWidth,r.clientWidth)-a),{width:a,height:o,x:i,y:s}}function UQ(e,t){const n=yr(e),r=vo(e),a=n.visualViewport;let o=r.clientWidth,i=r.clientHeight,s=0,c=0;if(a){o=a.width,i=a.height;const l=Ob();(!l||l&&t==="fixed")&&(s=a.offsetLeft,c=a.offsetTop)}return{width:o,height:i,x:s,y:c}}function VQ(e,t){const n=as(e,!0,t==="fixed"),r=n.top+e.clientTop,a=n.left+e.clientLeft,o=La(e)?sc(e):ui(1),i=e.clientWidth*o.x,s=e.clientHeight*o.y,c=a*o.x,l=r*o.y;return{width:i,height:s,x:c,y:l}}function JA(e,t,n){let r;if(t==="viewport")r=UQ(e,n);else if(t==="document")r=zQ(vo(e));else if(Xr(t))r=VQ(t,n);else{const a=GA(e);r={...t,x:t.x-a.x,y:t.y-a.y}}return ah(r)}function YA(e,t){const n=pi(e);return n===t||!Xr(n)||ic(n)?!1:Jr(n).position==="fixed"||YA(n,t)}function qQ(e,t){const n=t.get(e);if(n)return n;let r=Pu(e,[],!1).filter(s=>Xr(s)&&oc(s)!=="body"),a=null;const o=Jr(e).position==="fixed";let i=o?pi(e):e;for(;Xr(i)&&!ic(i);){const s=Jr(i),c=Eb(i);!c&&s.position==="fixed"&&(a=null),(o?!c&&!a:!c&&s.position==="static"&&a&&["absolute","fixed"].includes(a.position)||ku(i)&&!c&&YA(e,i))?r=r.filter(l=>l!==i):a=s,i=pi(i)}return t.set(e,r),r}function WQ(e){let{element:t,boundary:n,rootBoundary:r,strategy:a}=e;const o=[...n==="clippingAncestors"?oh(t)?[]:qQ(t,this._c):[].concat(n),r],i=o[0],s=o.reduce((c,l)=>{const u=JA(t,l,a);return c.top=mr(u.top,c.top),c.right=Da(u.right,c.right),c.bottom=Da(u.bottom,c.bottom),c.left=mr(u.left,c.left),c},JA(t,i,a));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function HQ(e){const{width:t,height:n}=ZA(e);return{width:t,height:n}}function KQ(e,t,n){const r=La(t),a=vo(t),o=n==="fixed",i=as(e,!0,o,t);let s={scrollLeft:0,scrollTop:0};const c=ui(0);if(r||!r&&!o)if((oc(t)!=="body"||ku(a))&&(s=ih(t)),r){const d=as(t,!0,o,t);c.x=d.x+t.clientLeft,c.y=d.y+t.clientTop}else a&&(c.x=XA(a));const l=i.left+s.scrollLeft-c.x,u=i.top+s.scrollTop-c.y;return{x:l,y:u,width:i.width,height:i.height}}function Mb(e){return Jr(e).position==="static"}function QA(e,t){return!La(e)||Jr(e).position==="fixed"?null:t?t(e):e.offsetParent}function e2(e,t){const n=yr(e);if(oh(e))return n;if(!La(e)){let a=pi(e);for(;a&&!ic(a);){if(Xr(a)&&!Mb(a))return a;a=pi(a)}return n}let r=QA(e,t);for(;r&&RQ(r)&&Mb(r);)r=QA(r,t);return r&&ic(r)&&Mb(r)&&!Eb(r)?n:r||DQ(e)||n}const ZQ=async function(e){const t=this.getOffsetParent||e2,n=this.getDimensions,r=await n(e.floating);return{reference:KQ(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function GQ(e){return Jr(e).direction==="rtl"}const XQ={convertOffsetParentRelativeRectToViewportRelativeRect:FQ,getDocumentElement:vo,getClippingRect:WQ,getOffsetParent:e2,getElementRects:ZQ,getClientRects:BQ,getDimensions:HQ,getScale:sc,isElement:Xr,isRTL:GQ};function JQ(e,t){let n=null,r;const a=vo(e);function o(){var s;clearTimeout(r),(s=n)==null||s.disconnect(),n=null}function i(s,c){s===void 0&&(s=!1),c===void 0&&(c=1),o();const{left:l,top:u,width:d,height:p}=e.getBoundingClientRect();if(s||t(),!d||!p)return;const f=nh(u),m=nh(a.clientWidth-(l+d)),y=nh(a.clientHeight-(u+p)),v=nh(l),b={rootMargin:-f+"px "+-m+"px "+-y+"px "+-v+"px",threshold:mr(0,Da(1,c))||1};let w=!0;function j(x){const _=x[0].intersectionRatio;if(_!==c){if(!w)return i();_?i(!1,_):r=setTimeout(()=>{i(!1,1e-7)},1e3)}w=!1}try{n=new IntersectionObserver(j,{...b,root:a.ownerDocument})}catch{n=new IntersectionObserver(j,b)}n.observe(e)}return i(!0),o}Dv=function(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:a=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=Nb(e),u=a||o?[...l?Pu(l):[],...Pu(t)]:[];u.forEach(b=>{a&&b.addEventListener("scroll",n,{passive:!0}),o&&b.addEventListener("resize",n)});const d=l&&s?JQ(l,n):null;let p=-1,f=null;i&&(f=new ResizeObserver(b=>{let[w]=b;w&&w.target===l&&f&&(f.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var j;(j=f)==null||j.observe(t)})),n()}),l&&!c&&f.observe(l),f.observe(t));let m,y=c?as(e):null;c&&v();function v(){const b=as(e);y&&(b.x!==y.x||b.y!==y.y||b.width!==y.width||b.height!==y.height)&&n(),y=b,m=requestAnimationFrame(v)}return n(),()=>{var b;u.forEach(w=>{a&&w.removeEventListener("scroll",n),o&&w.removeEventListener("resize",n)}),d==null||d(),(b=f)==null||b.disconnect(),f=null,c&&cancelAnimationFrame(m)}};let t2;ok=PQ,yk=AQ,ik=NQ,vk=IQ,t2=MQ,n0=CQ,gk=TQ,sk=(e,t,n)=>{const r=new Map,a={platform:XQ,...n},o={...a.platform,_c:r};return OQ(e,t,{...a,platform:o})};var sh=typeof document<"u"?g.useLayoutEffect:g.useEffect;function ch(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,a;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!ch(e[r],t[r]))return!1;return!0}if(a=Object.keys(e),n=a.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,a[r]))return!1;for(r=n;r--!==0;){const o=a[r];if(!(o==="_owner"&&e.$$typeof)&&!ch(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function n2(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function r2(e,t){const n=n2(e);return Math.round(t*n)/n}function a2(e){const t=g.useRef(e);return sh(()=>{t.current=e}),t}Xv=function(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:a,elements:{reference:o,floating:i}={},transform:s=!0,whileElementsMounted:c,open:l}=e,[u,d]=g.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[p,f]=g.useState(r);ch(p,r)||f(r);const[m,y]=g.useState(null),[v,b]=g.useState(null),w=g.useCallback(R=>{R!==S.current&&(S.current=R,y(R))},[]),j=g.useCallback(R=>{R!==E.current&&(E.current=R,b(R))},[]),x=o||m,_=i||v,S=g.useRef(null),E=g.useRef(null),O=g.useRef(u),N=c!=null,M=a2(c),k=a2(a),P=g.useCallback(()=>{if(!S.current||!E.current)return;const R={placement:t,strategy:n,middleware:p};k.current&&(R.platform=k.current),sk(S.current,E.current,R).then(L=>{const D={...L,isPositioned:!0};A.current&&!ch(O.current,D)&&(O.current=D,Ql.flushSync(()=>{d(D)}))})},[p,t,n,k]);sh(()=>{l===!1&&O.current.isPositioned&&(O.current.isPositioned=!1,d(R=>({...R,isPositioned:!1})))},[l]);const A=g.useRef(!1);sh(()=>(A.current=!0,()=>{A.current=!1}),[]),sh(()=>{if(x&&(S.current=x),_&&(E.current=_),x&&_){if(M.current)return M.current(x,_,P);P()}},[x,_,P,M,N]);const C=g.useMemo(()=>({reference:S,floating:E,setReference:w,setFloating:j}),[w,j]),I=g.useMemo(()=>({reference:x,floating:_}),[x,_]),T=g.useMemo(()=>{const R={position:n,left:0,top:0};if(!I.floating)return R;const L=r2(I.floating,u.x),D=r2(I.floating,u.y);return s?{...R,transform:"translate("+L+"px, "+D+"px)",...n2(I.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:L,top:D}},[n,s,I.floating,u.x,u.y]);return g.useMemo(()=>({...u,update:P,refs:C,elements:I,floatingStyles:T}),[u,P,C,I,T])};let o2;o2=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:a}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?n0({element:r.current,padding:a}).fn(n):{}:r?n0({element:r,padding:a}).fn(n):{}}}},Jv=(e,t)=>({...ok(e),options:[e,t]}),Yv=(e,t)=>({...yk(e),options:[e,t]}),Qv=(e,t)=>({...gk(e),options:[e,t]}),e0=(e,t)=>({...ik(e),options:[e,t]}),$v=(e,t)=>({...vk(e),options:[e,t]}),h0=(e,t)=>({...t2(e),options:[e,t]}),f0=(e,t)=>({...o2(e),options:[e,t]});var YQ="Arrow",i2=g.forwardRef((e,t)=>{const{children:n,width:r=10,height:a=5,...o}=e;return h.jsx(Ae.svg,{...o,ref:t,width:r,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});i2.displayName=YQ;var QQ=i2;function eee(e,t=[]){let n=[];function r(o,i){const s=g.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:p,children:f,...m}=d,y=(p==null?void 0:p[e][c])||s,v=g.useMemo(()=>m,Object.values(m));return h.jsx(y.Provider,{value:v,children:f})}function u(d,p){const f=(p==null?void 0:p[e][c])||s,m=g.useContext(f);if(m)return m;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return l.displayName=o+"Provider",[l,u]}const a=()=>{const o=n.map(i=>g.createContext(i));return function(i){const s=(i==null?void 0:i[e])||o;return g.useMemo(()=>({[`__scope${e}`]:{...i,[e]:s}}),[i,s])}};return a.scopeName=e,[r,tee(a,...t)]}function tee(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=r.reduce((i,{useScope:s,scopeName:c})=>{const l=s(a)[`__scope${c}`];return{...i,...l}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return n.scopeName=t.scopeName,n}_f=function(e){const[t,n]=g.useState(void 0);return ln(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const o=a[0];let i,s;if("borderBoxSize"in o){const c=o.borderBoxSize,l=Array.isArray(c)?c[0]:c;i=l.inlineSize,s=l.blockSize}else i=e.offsetWidth,s=e.offsetHeight;n({width:i,height:s})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t};var kb="Popper",[s2,cc]=eee(kb),[nee,c2]=s2(kb),l2=e=>{const{__scopePopper:t,children:n}=e,[r,a]=g.useState(null);return h.jsx(nee,{scope:t,anchor:r,onAnchorChange:a,children:n})};l2.displayName=kb;var u2="PopperAnchor",d2=g.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...a}=e,o=c2(u2,n),i=g.useRef(null),s=jt(t,i);return g.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:h.jsx(Ae.div,{...a,ref:s})});d2.displayName=u2;var Pb="PopperContent",[ree,aee]=s2(Pb),p2=g.forwardRef((e,t)=>{var ee,G,K,X,ne,V;const{__scopePopper:n,side:r="bottom",sideOffset:a=0,align:o="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:p=!1,updatePositionStrategy:f="optimized",onPlaced:m,...y}=e,v=c2(Pb,n),[b,w]=g.useState(null),j=jt(t,le=>w(le)),[x,_]=g.useState(null),S=_f(x),E=(S==null?void 0:S.width)??0,O=(S==null?void 0:S.height)??0,N=r+(o!=="center"?"-"+o:""),M=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},k=Array.isArray(l)?l:[l],P=k.length>0,A={padding:M,boundary:k.filter(iee),altBoundary:P},{refs:C,floatingStyles:I,placement:T,isPositioned:R,middlewareData:L}=Xv({strategy:"fixed",placement:N,whileElementsMounted:(...le)=>Dv(...le,{animationFrame:f==="always"}),elements:{reference:v.anchor},middleware:[Jv({mainAxis:a+O,alignmentAxis:i}),c&&Yv({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?Qv():void 0,...A}),c&&e0({...A}),$v({...A,apply:({elements:le,rects:ae,availableWidth:de,availableHeight:je})=>{const{width:Le,height:$e}=ae.reference,Se=le.floating.style;Se.setProperty("--radix-popper-available-width",`${de}px`),Se.setProperty("--radix-popper-available-height",`${je}px`),Se.setProperty("--radix-popper-anchor-width",`${Le}px`),Se.setProperty("--radix-popper-anchor-height",`${$e}px`)}}),x&&f0({element:x,padding:s}),see({arrowWidth:E,arrowHeight:O}),p&&h0({strategy:"referenceHidden",...A})]}),[D,z]=m2(T),B=dr(m);ln(()=>{R&&(B==null||B())},[R,B]);const $=(ee=L.arrow)==null?void 0:ee.x,U=(G=L.arrow)==null?void 0:G.y,F=((K=L.arrow)==null?void 0:K.centerOffset)!==0,[H,re]=g.useState();return ln(()=>{b&&re(window.getComputedStyle(b).zIndex)},[b]),h.jsx("div",{ref:C.setFloating,"data-radix-popper-content-wrapper":"",style:{...I,transform:R?I.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:H,"--radix-popper-transform-origin":[(X=L.transformOrigin)==null?void 0:X.x,(ne=L.transformOrigin)==null?void 0:ne.y].join(" "),...((V=L.hide)==null?void 0:V.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:h.jsx(ree,{scope:n,placedSide:D,onArrowChange:_,arrowX:$,arrowY:U,shouldHideArrow:F,children:h.jsx(Ae.div,{"data-side":D,"data-align":z,...y,ref:j,style:{...y.style,animation:R?void 0:"none"}})})})});p2.displayName=Pb;var f2="PopperArrow",oee={top:"bottom",right:"left",bottom:"top",left:"right"},h2=g.forwardRef(function(e,t){const{__scopePopper:n,...r}=e,a=aee(f2,n),o=oee[a.placedSide];return h.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:h.jsx(QQ,{...r,ref:t,style:{...r.style,display:"block"}})})});h2.displayName=f2;function iee(e){return e!==null}var see=e=>({name:"transformOrigin",options:e,fn(t){var y,v,b;const{placement:n,rects:r,middlewareData:a}=t,o=((y=a.arrow)==null?void 0:y.centerOffset)!==0,i=o?0:e.arrowWidth,s=o?0:e.arrowHeight,[c,l]=m2(n),u={start:"0%",center:"50%",end:"100%"}[l],d=(((v=a.arrow)==null?void 0:v.x)??0)+i/2,p=(((b=a.arrow)==null?void 0:b.y)??0)+s/2;let f="",m="";return c==="bottom"?(f=o?u:`${d}px`,m=`${-s}px`):c==="top"?(f=o?u:`${d}px`,m=`${r.floating.height+s}px`):c==="right"?(f=`${-s}px`,m=o?u:`${p}px`):c==="left"&&(f=`${r.floating.width+s}px`,m=o?u:`${p}px`),{data:{x:f,y:m}}}});function m2(e){const[t,n="center"]=e.split("-");return[t,n]}var lh=l2,Ab=d2,Tb=p2,Ib=h2,[uh,m3e]=ur("Tooltip",[cc]),dh=cc(),y2="TooltipProvider",cee=700,Rb="tooltip.open",[lee,Db]=uh(y2),g2=e=>{const{__scopeTooltip:t,delayDuration:n=cee,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:o}=e,[i,s]=g.useState(!0),c=g.useRef(!1),l=g.useRef(0);return g.useEffect(()=>{const u=l.current;return()=>window.clearTimeout(u)},[]),h.jsx(lee,{scope:t,isOpenDelayed:i,delayDuration:n,onOpen:g.useCallback(()=>{window.clearTimeout(l.current),s(!1)},[]),onClose:g.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>s(!0),r)},[r]),isPointerInTransitRef:c,onPointerInTransitChange:g.useCallback(u=>{c.current=u},[]),disableHoverableContent:a,children:o})};g2.displayName=y2;var ph="Tooltip",[uee,Au]=uh(ph),v2=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:a=!1,onOpenChange:o,disableHoverableContent:i,delayDuration:s}=e,c=Db(ph,e.__scopeTooltip),l=dh(t),[u,d]=g.useState(null),p=Rt(),f=g.useRef(0),m=i??c.disableHoverableContent,y=s??c.delayDuration,v=g.useRef(!1),[b=!1,w]=Tn({prop:r,defaultProp:a,onChange:E=>{E?(c.onOpen(),document.dispatchEvent(new CustomEvent(Rb))):c.onClose(),o==null||o(E)}}),j=g.useMemo(()=>b?v.current?"delayed-open":"instant-open":"closed",[b]),x=g.useCallback(()=>{window.clearTimeout(f.current),f.current=0,v.current=!1,w(!0)},[w]),_=g.useCallback(()=>{window.clearTimeout(f.current),f.current=0,w(!1)},[w]),S=g.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{v.current=!0,w(!0),f.current=0},y)},[y,w]);return g.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),h.jsx(lh,{...l,children:h.jsx(uee,{scope:t,contentId:p,open:b,stateAttribute:j,trigger:u,onTriggerChange:d,onTriggerEnter:g.useCallback(()=>{c.isOpenDelayed?S():x()},[c.isOpenDelayed,S,x]),onTriggerLeave:g.useCallback(()=>{m?_():(window.clearTimeout(f.current),f.current=0)},[_,m]),onOpen:x,onClose:_,disableHoverableContent:m,children:n})})};v2.displayName=ph;var Lb="TooltipTrigger",b2=g.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=Au(Lb,n),o=Db(Lb,n),i=dh(n),s=g.useRef(null),c=jt(t,s,a.onTriggerChange),l=g.useRef(!1),u=g.useRef(!1),d=g.useCallback(()=>l.current=!1,[]);return g.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),h.jsx(Ab,{asChild:!0,...i,children:h.jsx(Ae.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:c,onPointerMove:ge(e.onPointerMove,p=>{p.pointerType!=="touch"&&!u.current&&!o.isPointerInTransitRef.current&&(a.onTriggerEnter(),u.current=!0)}),onPointerLeave:ge(e.onPointerLeave,()=>{a.onTriggerLeave(),u.current=!1}),onPointerDown:ge(e.onPointerDown,()=>{l.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:ge(e.onFocus,()=>{l.current||a.onOpen()}),onBlur:ge(e.onBlur,a.onClose),onClick:ge(e.onClick,a.onClose)})})});b2.displayName=Lb;var $b="TooltipPortal",[dee,pee]=uh($b,{forceMount:void 0}),w2=e=>{const{__scopeTooltip:t,forceMount:n,children:r,container:a}=e,o=Au($b,t);return h.jsx(dee,{scope:t,forceMount:n,children:h.jsx(zr,{present:n||o.open,children:h.jsx(Ov,{asChild:!0,container:a,children:r})})})};w2.displayName=$b;var lc="TooltipContent",x2=g.forwardRef((e,t)=>{const n=pee(lc,e.__scopeTooltip),{forceMount:r=n.forceMount,side:a="top",...o}=e,i=Au(lc,e.__scopeTooltip);return h.jsx(zr,{present:r||i.open,children:i.disableHoverableContent?h.jsx(_2,{side:a,...o,ref:t}):h.jsx(fee,{side:a,...o,ref:t})})}),fee=g.forwardRef((e,t)=>{const n=Au(lc,e.__scopeTooltip),r=Db(lc,e.__scopeTooltip),a=g.useRef(null),o=jt(t,a),[i,s]=g.useState(null),{trigger:c,onClose:l}=n,u=a.current,{onPointerInTransitChange:d}=r,p=g.useCallback(()=>{s(null),d(!1)},[d]),f=g.useCallback((m,y)=>{const v=m.currentTarget,b={x:m.clientX,y:m.clientY},w=gee(b,v.getBoundingClientRect()),j=vee(b,w),x=bee(y.getBoundingClientRect()),_=xee([...j,...x]);s(_),d(!0)},[d]);return g.useEffect(()=>()=>p(),[p]),g.useEffect(()=>{if(c&&u){const m=v=>f(v,u),y=v=>f(v,c);return c.addEventListener("pointerleave",m),u.addEventListener("pointerleave",y),()=>{c.removeEventListener("pointerleave",m),u.removeEventListener("pointerleave",y)}}},[c,u,f,p]),g.useEffect(()=>{if(i){const m=y=>{const v=y.target,b={x:y.clientX,y:y.clientY},w=(c==null?void 0:c.contains(v))||(u==null?void 0:u.contains(v)),j=!wee(b,i);w?p():j&&(p(),l())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[c,u,i,l,p]),h.jsx(_2,{...e,ref:o})}),[hee,mee]=uh(ph,{isInside:!1}),_2=g.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":a,onEscapeKeyDown:o,onPointerDownOutside:i,...s}=e,c=Au(lc,n),l=dh(n),{onClose:u}=c;return g.useEffect(()=>(document.addEventListener(Rb,u),()=>document.removeEventListener(Rb,u)),[u]),g.useEffect(()=>{if(c.trigger){const d=p=>{var f;(f=p.target)!=null&&f.contains(c.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[c.trigger,u]),h.jsx(Ev,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:h.jsxs(Tb,{"data-state":c.stateAttribute,...l,...s,ref:t,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[h.jsx(DG,{children:r}),h.jsx(hee,{scope:n,isInside:!0,children:h.jsx(MDe,{id:c.contentId,role:"tooltip",children:a||r})})]})})});x2.displayName=lc;var j2="TooltipArrow",yee=g.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=dh(n);return mee(j2,n).isInside?null:h.jsx(Ib,{...a,...r,ref:t})});yee.displayName=j2;function gee(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),o=Math.abs(t.left-e.x);switch(Math.min(n,r,a,o)){case o:return"left";case a:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function vee(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function bee(e){const{top:t,right:n,bottom:r,left:a}=e;return[{x:a,y:t},{x:n,y:t},{x:n,y:r},{x:a,y:r}]}function wee(e,t){const{x:n,y:r}=e;let a=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const s=t[o].x,c=t[o].y,l=t[i].x,u=t[i].y;c>r!=u>r&&n<(l-s)*(r-c)/(u-c)+s&&(a=!a)}return a}function xee(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),_ee(t)}function _ee(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const a=e[r];for(;t.length>=2;){const o=t[t.length-1],i=t[t.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))t.pop();else break}t.push(a)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const a=e[r];for(;n.length>=2;){const o=n[n.length-1],i=n[n.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))n.pop();else break}n.push(a)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}jk=g2,Sk=v2,uk=b2,QG=w2,Bv=x2;const Tu=jk,$a=Sk,Fa=uk,Yr=g.forwardRef(({className:e,sideOffset:t=4,...n},r)=>h.jsx(Bv,{ref:r,sideOffset:t,className:Z("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));Yr.displayName=Bv.displayName;const jee="sidebar:state",See=60*60*24*7,Eee="16rem",Oee="18rem",Cee="3rem",Nee="b",S2=g.createContext(null);function Iu(){const e=g.useContext(S2);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const Fb=g.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:n,className:r,style:a,children:o,...i},s)=>{const c=MY(),[l,u]=g.useState(!1),[d,p]=g.useState(e),f=t??d,m=g.useCallback(w=>{const j=typeof w=="function"?w(f):w;n?n(j):p(j),document.cookie=`${jee}=${j}; path=/; max-age=${See}`},[n,f]),y=g.useCallback(()=>c?u(w=>!w):m(w=>!w),[c,m,u]);g.useEffect(()=>{const w=j=>{j.key===Nee&&(j.metaKey||j.ctrlKey)&&(j.preventDefault(),y())};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[y]);const v=f?"expanded":"collapsed",b=g.useMemo(()=>({state:v,open:f,setOpen:m,isMobile:c,openMobile:l,setOpenMobile:u,toggleSidebar:y}),[v,f,m,c,l,u,y]);return h.jsx(S2.Provider,{value:b,children:h.jsx(Tu,{delayDuration:0,children:h.jsx("div",{style:{"--sidebar-width":Eee,"--sidebar-width-icon":Cee,...a},className:Z("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",r),ref:s,...i,children:o})})})});Fb.displayName="SidebarProvider";const Bb=g.forwardRef(({side:e="left",variant:t="sidebar",collapsible:n="offcanvas",className:r,children:a,...o},i)=>{const{isMobile:s,state:c,openMobile:l,setOpenMobile:u}=Iu();return n==="none"?h.jsx("div",{className:Z("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",r),ref:i,...o,children:a}):s?h.jsx(fQ,{open:l,onOpenChange:u,...o,children:h.jsx(FA,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":Oee},side:e,children:h.jsx("div",{className:"flex h-full w-full flex-col",children:a})})}):h.jsxs("div",{ref:i,className:"group peer hidden md:block text-sidebar-foreground","data-state":c,"data-collapsible":c==="collapsed"?n:"","data-variant":t,"data-side":e,children:[h.jsx("div",{className:Z("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),h.jsx("div",{className:Z("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",r),...o,children:h.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:a})})]})});Bb.displayName="Sidebar";const E2=g.forwardRef(({className:e,onClick:t,...n},r)=>{const{toggleSidebar:a}=Iu();return h.jsx(Ye,{ref:r,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:Z("h-7 w-7",e),onClick:o=>{t==null||t(o),a()},...n,children:h.jsx(pe,{size:32,name:"panel-left"})})});E2.displayName="SidebarTrigger";const O2=g.forwardRef(({className:e,...t},n)=>{const{toggleSidebar:r}=Iu();return h.jsx("button",{ref:n,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:r,title:"Toggle Sidebar",className:Z("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});O2.displayName="SidebarRail";const zb=g.forwardRef(({className:e,...t},n)=>h.jsx("main",{ref:n,className:Z("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));zb.displayName="SidebarInset";const Mee=g.forwardRef(({className:e,...t},n)=>h.jsx(Kt,{ref:n,"data-sidebar":"input",className:Z("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));Mee.displayName="SidebarInput";const kee=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,"data-sidebar":"header",className:Z("flex flex-col gap-2 p-2",e),...t}));kee.displayName="SidebarHeader";const C2=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,"data-sidebar":"footer",className:Z("flex flex-col gap-2 p-2",e),...t}));C2.displayName="SidebarFooter";const Pee=g.forwardRef(({className:e,...t},n)=>h.jsx(Gs,{ref:n,"data-sidebar":"separator",className:Z("mx-2 w-auto bg-sidebar-border",e),...t}));Pee.displayName="SidebarSeparator";const Ub=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,"data-sidebar":"content",className:Z("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));Ub.displayName="SidebarContent";const Ru=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,"data-sidebar":"group",className:Z("relative flex w-full min-w-0 flex-col p-2",e),...t}));Ru.displayName="SidebarGroup";const Du=g.forwardRef(({className:e,asChild:t=!1,...n},r)=>{const a=t?ri:"div";return h.jsx(a,{ref:r,"data-sidebar":"group-label",className:Z("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...n})});Du.displayName="SidebarGroupLabel";const Aee=g.forwardRef(({className:e,asChild:t=!1,...n},r)=>{const a=t?ri:"button";return h.jsx(a,{ref:r,"data-sidebar":"group-action",className:Z("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...n})});Aee.displayName="SidebarGroupAction";const Tee=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,"data-sidebar":"group-content",className:Z("w-full text-sm",e),...t}));Tee.displayName="SidebarGroupContent";const uc=g.forwardRef(({className:e,...t},n)=>h.jsx("ul",{ref:n,"data-sidebar":"menu",className:Z("flex w-full min-w-0 flex-col gap-1",e),...t}));uc.displayName="SidebarMenu";const bo=g.forwardRef(({className:e,...t},n)=>h.jsx("li",{ref:n,"data-sidebar":"menu-item",className:Z("group/menu-item relative",e),...t}));bo.displayName="SidebarMenuItem";const Iee=lo("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),wo=g.forwardRef(({onClick:e,asChild:t=!1,isActive:n=!1,variant:r="default",size:a="default",tooltip:o,className:i,...s},c)=>{const l=t?ri:"button",{isMobile:u,state:d,toggleSidebar:p}=Iu(),f=h.jsx(l,{ref:c,"data-sidebar":"menu-button","data-size":a,"data-active":n,className:Z(Iee({variant:r,size:a}),i),onClick:s!=null&&s.autoHide?m=>{e==null||e(m),p()}:e,...s});return o?(typeof o=="string"&&(o={children:o}),h.jsxs($a,{children:[h.jsx(Fa,{asChild:!0,children:f}),h.jsx(Yr,{side:"right",align:"center",hidden:d!=="collapsed"||u,...o})]})):f});wo.displayName="SidebarMenuButton";const Ree=g.forwardRef(({className:e,asChild:t=!1,showOnHover:n=!1,...r},a)=>{const o=t?ri:"button";return h.jsx(o,{ref:a,"data-sidebar":"menu-action",className:Z("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",n&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...r})});Ree.displayName="SidebarMenuAction";const Dee=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,"data-sidebar":"menu-badge",className:Z("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));Dee.displayName="SidebarMenuBadge";const Lee=g.forwardRef(({className:e,showIcon:t=!1,...n},r)=>{const a=g.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return h.jsxs("div",{ref:r,"data-sidebar":"menu-skeleton",className:Z("rounded-md h-8 flex gap-2 px-2 items-center",e),...n,children:[t&&h.jsx(BA,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),h.jsx(BA,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":a}})]})});Lee.displayName="SidebarMenuSkeleton";const N2=g.forwardRef(({className:e,...t},n)=>h.jsx("ul",{ref:n,"data-sidebar":"menu-sub",className:Z("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));N2.displayName="SidebarMenuSub";const M2=g.forwardRef(({...e},t)=>h.jsx("li",{ref:t,...e}));M2.displayName="SidebarMenuSubItem";const k2=g.forwardRef(({asChild:e=!1,size:t="md",isActive:n,className:r,...a},o)=>{const i=e?ri:"a";return h.jsx(i,{ref:o,"data-sidebar":"menu-sub-button","data-size":t,"data-active":n,className:Z("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",r),...a})});k2.displayName="SidebarMenuSubButton";const $ee="hash",fh={application:"/application/:applicationId?",whiteboard:"/whiteboard/:sessionId?",document:"/document/:documentId?"},dn=(e,t)=>{let n=fh[e];return t?n=Object.keys(t||{}).reduce((r,a)=>r.replace(`:${a}`,(t==null?void 0:t[a])||""),n):n=n.replace(/\/:[^/]+/g,""),n!=null&&n.endsWith("?")?n.slice(0,-1):n},Fee=()=>{{const[,e]=window.location.hash.split("?");return new URLSearchParams(`?${e}`)}};function Bee({items:e}){const{t}=ke("documents");return h.jsxs(Ru,{children:[h.jsx(Du,{children:h.jsx("div",{className:"text-sm",children:t("title")})}),h.jsx(uc,{children:e.map(n=>{var r;return h.jsx(OY,{asChild:!0,defaultOpen:n.isActive,className:"group/collapsible",children:h.jsxs(bo,{children:[h.jsx(CY,{asChild:!0,children:h.jsxs(wo,{className:"cursor-pointer",tooltip:t(n.title),children:[n.icon,h.jsx("span",{children:t(n.title)}),h.jsx(pe,{name:"chevron-right",className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),h.jsx(NY,{children:h.jsx(N2,{children:(r=n.items)==null?void 0:r.map(a=>h.jsx(M2,{className:"cursor-pointer",children:h.jsx(k2,{asChild:!0,children:h.jsx(J0,{to:dn("document",{documentId:a.id}),children:h.jsx("span",{children:t(a.title)})})})},t(a.title)))})})]})},n.title)})})]})}const zee=g.memo(({text:e,colors:t={first:"#9E7AFF",second:"#FE8BBB"},className:n,sparklesCount:r=10,...a})=>{const[o,i]=g.useState([]);return g.useEffect(()=>{const s=()=>{const d=`${Math.random()*100}%`,p=`${Math.random()*100}%`,f=Math.random()>.5?t.first:t.second,m=Math.random()*2,y=Math.random()*1+.3,v=Math.random()*10+5;return{id:`${d}-${p}-${Date.now()}`,x:d,y:p,color:f,delay:m,scale:y,lifespan:v}},c=()=>{const d=Array.from({length:r},s);i(d)},l=()=>{i(d=>d.map(p=>p.lifespan<=0?s():{...p,lifespan:p.lifespan-.1}))};c();const u=setInterval(l,100);return()=>clearInterval(u)},[t.first,t.second]),h.jsx("div",{className:Z("text-6xl font-bold",n),...a,style:{"--sparkles-first-color":`${t.first}`,"--sparkles-second-color":`${t.second}`},children:h.jsxs("span",{className:"relative inline-block",children:[o.map(s=>h.jsx(Uee,{...s},s.id)),h.jsx("strong",{children:e})]})})},(e,t)=>e.text===t.text),Uee=({id:e,x:t,y:n,color:r,delay:a,scale:o})=>h.jsx(hf.svg,{className:"pointer-events-none absolute z-20",initial:{opacity:0,left:t,top:n},animate:{opacity:[0,1,0],scale:[0,o,0],rotate:[75,120,150]},transition:{duration:.8,repeat:1/0,delay:a},width:"21",height:"21",viewBox:"0 0 21 21",children:h.jsx("path",{d:"M9.82531 0.843845C10.0553 0.215178 10.9446 0.215178 11.1746 0.843845L11.8618 2.72026C12.4006 4.19229 12.3916 6.39157 13.5 7.5C14.6084 8.60843 16.8077 8.59935 18.2797 9.13822L20.1561 9.82534C20.7858 10.0553 20.7858 10.9447 20.1561 11.1747L18.2797 11.8618C16.8077 12.4007 14.6084 12.3916 13.5 13.5C12.3916 14.6084 12.4006 16.8077 11.8618 18.2798L11.1746 20.1562C10.9446 20.7858 10.0553 20.7858 9.82531 20.1562L9.13819 18.2798C8.59932 16.8077 8.60843 14.6084 7.5 13.5C6.39157 12.3916 4.19225 12.4007 2.72023 11.8618L0.843814 11.1747C0.215148 10.9447 0.215148 10.0553 0.843814 9.82534L2.72023 9.13822C4.19225 8.59935 6.39157 8.60843 7.5 7.5C8.60843 6.39157 8.59932 4.19229 9.13819 2.72026L9.82531 0.843845Z",fill:r})},e);function Vee({className:e,onClick:t}){const{t:n}=ke("sidebar");return h.jsxs(wo,{className:Z(e,"tw-w-full"),onClick:t,children:[h.jsx(pe,{name:"frame"}),h.jsx(zee,{text:n("new_session"),className:"text-sm",sparklesCount:3})]})}const qee=()=>{const[e,t]=g.useState(!1),n=Je(a=>a.createSession),r=g.useCallback(async a=>{try{return t(!0),await n(a)}finally{t(!1)}},[n]);return{loading:e,createSession:r}},fi=ou,Wee=cu,P2=g.forwardRef(({className:e,...t},n)=>h.jsx(Zi,{ref:n,className:Z("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));P2.displayName=Zi.displayName;const xo=g.forwardRef(({className:e,children:t,...n},r)=>h.jsxs(Wee,{children:[h.jsx(P2,{}),h.jsxs(Gi,{ref:r,className:Z("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...n,children:[t,h.jsxs(lu,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[h.jsx(pe,{name:"x",className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));xo.displayName=Gi.displayName;const _o=({className:e,...t})=>h.jsx("div",{className:Z("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});_o.displayName="DialogHeader";const Lu=({className:e,...t})=>h.jsx("div",{className:Z("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Lu.displayName="DialogFooter";const jo=g.forwardRef(({className:e,...t},n)=>h.jsx(Ks,{ref:n,className:Z("text-lg font-semibold leading-none tracking-tight",e),...t}));jo.displayName=Ks.displayName;const $u=g.forwardRef(({className:e,...t},n)=>h.jsx(Zs,{ref:n,className:Z("text-sm text-muted-foreground",e),...t}));$u.displayName=Zs.displayName;var Hee="Label",A2=g.forwardRef((e,t)=>h.jsx(Ae.label,{...e,ref:t,onMouseDown:n=>{var r;n.target.closest("button, input, select, textarea")||((r=e.onMouseDown)==null||r.call(e,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));A2.displayName=Hee;var T2=A2;let I2;I2=lo("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Be=g.forwardRef(({className:e,...t},n)=>h.jsx(T2,{ref:n,className:Z(I2(),e),...t})),Be.displayName=T2.displayName;const Kee=uo(()=>{const e=tn(),{t}=ke("dialogs"),[n,r]=g.useState(""),{toast:a}=nn(),{loading:o,createSession:i}=qee(),s=u=>{r(u.target.value)},c=async()=>{try{const u=await i({name:n});r(""),e.resolve(u.id),e.hide()}catch(u){a({variant:"destructive",description:t("create_session.errors.create_failed")}),e.reject(u)}},l=()=>{r(""),e.resolve(void 0),e.hide()};return h.jsx(fi,{open:e.visible,onOpenChange:l,children:h.jsxs(xo,{className:"sm:max-w-[425px]",children:[h.jsxs(_o,{children:[h.jsx(jo,{children:t("create_session.title")}),h.jsx($u,{children:t("create_session.description")})]}),h.jsx("div",{className:"grid gap-4 py-4",children:h.jsxs("div",{className:"flex flex-col space-y-1.5",children:[h.jsx(Be,{className:"mb-2",htmlFor:"name",children:t("create_session.name")}),h.jsx(Kt,{onChange:s,id:"name",value:n,placeholder:t("create_session.name_placeholder")})]})}),h.jsx(Lu,{children:h.jsx(Ye,{onClick:c,disabled:o||!n,type:"submit",children:t("create_session.create")})})]})})}),Zee=()=>{const[e,t]=g.useState(!1),n=Je(a=>a.deleteSession),r=g.useCallback(async a=>{try{t(!0),await n(a),await Promise.all([ue("FlowEdge").find({select:["id"],where:{session_id:a}}).then(o=>Promise.all(o.map(i=>ue("FlowEdge").delete(i.id)))),ue("FlowNode").find({select:["id"],where:{session_id:a}}).then(o=>Promise.all(o.map(i=>ue("FlowNode").delete(i.id))))])}finally{t(!1)}},[n]);return{loading:e,deleteSession:r}};var R2="AlertDialog",[Gee,y3e]=ur(R2,[fb]),So=fb(),D2=e=>{const{__scopeAlertDialog:t,...n}=e,r=So(t);return h.jsx(ou,{...r,...n,modal:!0})};D2.displayName=R2;var Xee="AlertDialogTrigger",Jee=g.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=So(n);return h.jsx(LA,{...a,...r,ref:t})});Jee.displayName=Xee;var Yee="AlertDialogPortal",L2=e=>{const{__scopeAlertDialog:t,...n}=e,r=So(t);return h.jsx(cu,{...r,...n})};L2.displayName=Yee;var Qee="AlertDialogOverlay",$2=g.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=So(n);return h.jsx(Zi,{...a,...r,ref:t})});$2.displayName=Qee;var dc="AlertDialogContent",[ete,tte]=Gee(dc),F2=g.forwardRef((e,t)=>{const{__scopeAlertDialog:n,children:r,...a}=e,o=So(n),i=g.useRef(null),s=jt(t,i),c=g.useRef(null);return h.jsx(TA,{contentName:dc,titleName:B2,docsSlug:"alert-dialog",children:h.jsx(ete,{scope:n,cancelRef:c,children:h.jsxs(Gi,{role:"alertdialog",...o,...a,ref:s,onOpenAutoFocus:ge(a.onOpenAutoFocus,l=>{var u;l.preventDefault(),(u=c.current)==null||u.focus({preventScroll:!0})}),onPointerDownOutside:l=>l.preventDefault(),onInteractOutside:l=>l.preventDefault(),children:[h.jsx(DG,{children:r}),h.jsx(K2,{contentRef:i})]})})})});F2.displayName=dc;var B2="AlertDialogTitle",z2=g.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=So(n);return h.jsx(Ks,{...a,...r,ref:t})});z2.displayName=B2;var U2="AlertDialogDescription",V2=g.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=So(n);return h.jsx(Zs,{...a,...r,ref:t})});V2.displayName=U2;var nte="AlertDialogAction",q2=g.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=So(n);return h.jsx(lu,{...a,...r,ref:t})});q2.displayName=nte;var W2="AlertDialogCancel",H2=g.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,{cancelRef:a}=tte(W2,n),o=So(n),i=jt(t,a);return h.jsx(lu,{...o,...r,ref:i})});H2.displayName=W2;let K2;K2=({contentRef:e})=>{const t=`\`${dc}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${dc}\` by passing a \`${U2}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${dc}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return g.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},hk=D2,fk=L2,qv=$2,Wv=F2,Zv=q2,Gv=H2,Hv=z2,Kv=V2;const Z2=hk,rte=fk,G2=g.forwardRef(({className:e,...t},n)=>h.jsx(qv,{className:Z("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));G2.displayName=qv.displayName;const Vb=g.forwardRef(({className:e,...t},n)=>h.jsxs(rte,{children:[h.jsx(G2,{}),h.jsx(Wv,{ref:n,className:Z("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Vb.displayName=Wv.displayName;const qb=({className:e,...t})=>h.jsx("div",{className:Z("flex flex-col space-y-2 text-center sm:text-left",e),...t});qb.displayName="AlertDialogHeader";const Wb=({className:e,...t})=>h.jsx("div",{className:Z("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Wb.displayName="AlertDialogFooter";const Hb=g.forwardRef(({className:e,...t},n)=>h.jsx(Hv,{ref:n,className:Z("text-lg font-semibold",e),...t}));Hb.displayName=Hv.displayName;const Kb=g.forwardRef(({className:e,...t},n)=>h.jsx(Kv,{ref:n,className:Z("text-sm text-muted-foreground",e),...t}));Kb.displayName=Kv.displayName;const Zb=g.forwardRef(({className:e,...t},n)=>h.jsx(Zv,{ref:n,className:Z(Ou(),e),...t}));Zb.displayName=Zv.displayName;const Gb=g.forwardRef(({className:e,...t},n)=>h.jsx(Gv,{ref:n,className:Z(Ou({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Gb.displayName=Gv.displayName;const X2=uo(({id:e})=>{const{t}=ke("dialogs"),n=tn(),{toast:r}=nn(),{deleteSession:a,loading:o}=Zee(),i=async()=>{try{await a(e),n.hide()}catch{r({variant:"destructive",description:t("delete_session.errors.delete_failed")})}};return h.jsx(Z2,{open:n.visible,onOpenChange:n.hide,children:h.jsxs(Vb,{children:[h.jsxs(qb,{children:[h.jsx(Hb,{children:t("delete_session.title")}),h.jsx(Kb,{children:t("delete_session.description")})]}),h.jsxs(Wb,{children:[h.jsx(Gb,{onClick:n.hide,children:t("delete_session.cancel")}),h.jsx(Zb,{disabled:o,onClick:i,children:t("delete_session.delete")})]})]})})});function ate({sessions:e,currentSession:t,setCurrentSession:n}){const{t:r}=ke("sidebar"),a=es(),{sessionId:o}=$f(),[i,s]=g.useState(),c=tn(Kee),l=tn(X2),u=g.useCallback(async()=>{try{const f=await c.show({});f&&typeof f=="string"&&a(dn("whiteboard",{sessionId:f}))}catch{}},[c,a]),d=g.useCallback((f,m)=>{f.preventDefault(),f.stopPropagation(),l.show({id:m})},[l]),p=async f=>{try{s(f.id),await n(f),a(dn("whiteboard",{sessionId:f.id}))}catch(m){Ws(m),s(void 0)}};return g.useEffect(()=>{!i||i!==(t==null?void 0:t.id)||s(void 0)},[i,t==null?void 0:t.id]),h.jsxs(Ru,{className:"group-data-[collapsible=icon]:hidden",children:[h.jsx(Du,{children:h.jsx("div",{className:"text-sm",children:r("sessions")})}),h.jsxs(uc,{children:[h.jsx(bo,{children:h.jsx(Vee,{onClick:u,className:"w-full"})}),e.map(f=>h.jsx(bo,{className:"cursor-pointer",children:h.jsx(wo,{autoHide:!0,disabled:!!i,asChild:!0,onClick:()=>p(f),children:h.jsxs("div",{className:"flex flex-row justify-between items-center",children:[h.jsxs("div",{className:"flex gap-2",children:[f.id===i?h.jsx(pe,{size:16,name:"loader",className:"animate-spin"}):o===f.id?h.jsx(pe,{size:16,color:"green",name:"check"}):h.jsx(pe,{size:16,name:"chevron-right"}),h.jsx("span",{children:f.name})]}),h.jsx(pe,{onClick:m=>d(m,f.id),size:16,name:"trash-2",className:"!z-50"})]})})},f.id)),e!=null&&e.length?h.jsx(bo,{children:h.jsxs(wo,{className:"text-sidebar-foreground/70",children:[h.jsx(pe,{name:"ellipsis",className:"text-sidebar-foreground/70"}),h.jsx("span",{children:r("more_session")})]})}):null]})]})}var ote=g.createContext(void 0);ai=function(e){const t=g.useContext(ote);return e||t||"ltr"};function ite(e,t=[]){let n=[];function r(o,i){const s=g.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:p,children:f,...m}=d,y=(p==null?void 0:p[e][c])||s,v=g.useMemo(()=>m,Object.values(m));return h.jsx(y.Provider,{value:v,children:f})}function u(d,p){const f=(p==null?void 0:p[e][c])||s,m=g.useContext(f);if(m)return m;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return l.displayName=o+"Provider",[l,u]}const a=()=>{const o=n.map(i=>g.createContext(i));return function(i){const s=(i==null?void 0:i[e])||o;return g.useMemo(()=>({[`__scope${e}`]:{...i,[e]:s}}),[i,s])}};return a.scopeName=e,[r,ste(a,...t)]}function ste(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=r.reduce((i,{useScope:s,scopeName:c})=>{const l=s(a)[`__scope${c}`];return{...i,...l}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return n.scopeName=t.scopeName,n}let hh,J2,Fu,mh,Xb,Y2,Q2,eT,tT,Jb;hh="rovingFocusGroup.onEntryFocus",J2={bubbles:!1,cancelable:!0},Fu="RovingFocusGroup",[mh,Xb,Y2]=mf(Fu),[Q2,fo]=ite(Fu,[Y2]),[eT,tT]=Q2(Fu),Jb=g.forwardRef((e,t)=>h.jsx(mh.Provider,{scope:e.__scopeRovingFocusGroup,children:h.jsx(mh.Slot,{scope:e.__scopeRovingFocusGroup,children:h.jsx(cte,{...e,ref:t})})})),Jb.displayName=Fu;var cte=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:a=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:u=!1,...d}=e,p=g.useRef(null),f=jt(t,p),m=ai(o),[y=null,v]=Tn({prop:i,defaultProp:s,onChange:c}),[b,w]=g.useState(!1),j=dr(l),x=Xb(n),_=g.useRef(!1),[S,E]=g.useState(0);return g.useEffect(()=>{const O=p.current;if(O)return O.addEventListener(hh,j),()=>O.removeEventListener(hh,j)},[j]),h.jsx(eT,{scope:n,orientation:r,dir:m,loop:a,currentTabStopId:y,onItemFocus:g.useCallback(O=>v(O),[v]),onItemShiftTab:g.useCallback(()=>w(!0),[]),onFocusableItemAdd:g.useCallback(()=>E(O=>O+1),[]),onFocusableItemRemove:g.useCallback(()=>E(O=>O-1),[]),children:h.jsx(Ae.div,{tabIndex:b||S===0?-1:0,"data-orientation":r,...d,ref:f,style:{outline:"none",...e.style},onMouseDown:ge(e.onMouseDown,()=>{_.current=!0}),onFocus:ge(e.onFocus,O=>{const N=!_.current;if(O.target===O.currentTarget&&N&&!b){const M=new CustomEvent(hh,J2);if(O.currentTarget.dispatchEvent(M),!M.defaultPrevented){const k=x().filter(I=>I.focusable),P=k.find(I=>I.active),A=k.find(I=>I.id===y),C=[P,A,...k].filter(Boolean).map(I=>I.ref.current);aT(C,u)}}_.current=!1}),onBlur:ge(e.onBlur,()=>w(!1))})})}),nT="RovingFocusGroupItem",rT=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:a=!1,tabStopId:o,...i}=e,s=Rt(),c=o||s,l=tT(nT,n),u=l.currentTabStopId===c,d=Xb(n),{onFocusableItemAdd:p,onFocusableItemRemove:f}=l;return g.useEffect(()=>{if(r)return p(),()=>f()},[r,p,f]),h.jsx(mh.ItemSlot,{scope:n,id:c,focusable:r,active:a,children:h.jsx(Ae.span,{tabIndex:u?0:-1,"data-orientation":l.orientation,...i,ref:t,onMouseDown:ge(e.onMouseDown,m=>{r?l.onItemFocus(c):m.preventDefault()}),onFocus:ge(e.onFocus,()=>l.onItemFocus(c)),onKeyDown:ge(e.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){l.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const y=dte(m,l.orientation,l.dir);if(y!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let v=d().filter(b=>b.focusable).map(b=>b.ref.current);if(y==="last")v.reverse();else if(y==="prev"||y==="next"){y==="prev"&&v.reverse();const b=v.indexOf(m.currentTarget);v=l.loop?pte(v,b+1):v.slice(b+1)}setTimeout(()=>aT(v))}})})})});rT.displayName=nT;var lte={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ute(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function dte(e,t,n){const r=ute(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return lte[r]}function aT(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function pte(e,t){return e.map((n,r)=>e[(t+r)%e.length])}let yh,oT,Yb,iT,sT,cT,pc,fc,lT,uT,hi,gh,hc,Qb,ew,Eo,dT,mc,tw;uu=Jb,du=rT,yh=["Enter"," "],oT=["ArrowDown","PageUp","Home"],Yb=["ArrowUp","PageDown","End"],iT=[...oT,...Yb],sT={ltr:[...yh,"ArrowRight"],rtl:[...yh,"ArrowLeft"]},cT={ltr:["ArrowLeft"],rtl:["ArrowRight"]},pc="Menu",[fc,lT,uT]=mf(pc),[hi,gh]=ur(pc,[uT,cc,fo]),hc=cc(),Qb=fo(),[ew,Eo]=hi(pc),[dT,mc]=hi(pc),tw=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:a,onOpenChange:o,modal:i=!0}=e,s=hc(t),[c,l]=g.useState(null),u=g.useRef(!1),d=dr(o),p=ai(a);return g.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",m,{capture:!0,once:!0}),document.addEventListener("pointermove",m,{capture:!0,once:!0})},m=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",m,{capture:!0}),document.removeEventListener("pointermove",m,{capture:!0})}},[]),h.jsx(lh,{...s,children:h.jsx(ew,{scope:t,open:n,onOpenChange:d,content:c,onContentChange:l,children:h.jsx(dT,{scope:t,onClose:g.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:p,modal:i,children:r})})})},tw.displayName=pc;var fte="MenuAnchor",nw=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=hc(n);return h.jsx(Ab,{...a,...r,ref:t})});nw.displayName=fte;var rw="MenuPortal",[hte,pT]=hi(rw,{forceMount:void 0}),fT=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:a}=e,o=Eo(rw,t);return h.jsx(hte,{scope:t,forceMount:n,children:h.jsx(zr,{present:n||o.open,children:h.jsx(Ov,{asChild:!0,container:a,children:r})})})};fT.displayName=rw;var Mr="MenuContent",[mte,aw]=hi(Mr),hT=g.forwardRef((e,t)=>{const n=pT(Mr,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,o=Eo(Mr,e.__scopeMenu),i=mc(Mr,e.__scopeMenu);return h.jsx(fc.Provider,{scope:e.__scopeMenu,children:h.jsx(zr,{present:r||o.open,children:h.jsx(fc.Slot,{scope:e.__scopeMenu,children:i.modal?h.jsx(yte,{...a,ref:t}):h.jsx(gte,{...a,ref:t})})})})}),yte=g.forwardRef((e,t)=>{const n=Eo(Mr,e.__scopeMenu),r=g.useRef(null),a=jt(t,r);return g.useEffect(()=>{const o=r.current;if(o)return fu(o)},[]),h.jsx(ow,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:ge(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),gte=g.forwardRef((e,t)=>{const n=Eo(Mr,e.__scopeMenu);return h.jsx(ow,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),ow=g.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:a,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:p,onDismiss:f,disableOutsideScroll:m,...y}=e,v=Eo(Mr,n),b=mc(Mr,n),w=hc(n),j=Qb(n),x=lT(n),[_,S]=g.useState(null),E=g.useRef(null),O=jt(t,E,v.onContentChange),N=g.useRef(0),M=g.useRef(""),k=g.useRef(0),P=g.useRef(null),A=g.useRef("right"),C=g.useRef(0),I=m?Jf:g.Fragment,T=m?{as:ri,allowPinchZoom:!0}:void 0,R=D=>{var ee,G;const z=M.current+D,B=x().filter(K=>!K.disabled),$=document.activeElement,U=(ee=B.find(K=>K.ref.current===$))==null?void 0:ee.textValue,F=B.map(K=>K.textValue),H=Mte(F,z,U),re=(G=B.find(K=>K.textValue===H))==null?void 0:G.ref.current;(function K(X){M.current=X,window.clearTimeout(N.current),X!==""&&(N.current=window.setTimeout(()=>K(""),1e3))})(z),re&&setTimeout(()=>re.focus())};g.useEffect(()=>()=>window.clearTimeout(N.current),[]),hu();const L=g.useCallback(D=>{var z,B;return A.current===((z=P.current)==null?void 0:z.side)&&Pte(D,(B=P.current)==null?void 0:B.area)},[]);return h.jsx(mte,{scope:n,searchRef:M,onItemEnter:g.useCallback(D=>{L(D)&&D.preventDefault()},[L]),onItemLeave:g.useCallback(D=>{var z;L(D)||((z=E.current)==null||z.focus(),S(null))},[L]),onTriggerLeave:g.useCallback(D=>{L(D)&&D.preventDefault()},[L]),pointerGraceTimerRef:k,onPointerGraceIntentChange:g.useCallback(D=>{P.current=D},[]),children:h.jsx(I,{...T,children:h.jsx(Vf,{asChild:!0,trapped:a,onMountAutoFocus:ge(o,D=>{var z;D.preventDefault(),(z=E.current)==null||z.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:h.jsx(Ev,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:p,onDismiss:f,children:h.jsx(uu,{asChild:!0,...j,dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:_,onCurrentTabStopIdChange:S,onEntryFocus:ge(c,D=>{b.isUsingKeyboardRef.current||D.preventDefault()}),preventScrollOnEntryFocus:!0,children:h.jsx(Tb,{role:"menu","aria-orientation":"vertical","data-state":AT(v.open),"data-radix-menu-content":"",dir:b.dir,...w,...y,ref:O,style:{outline:"none",...y.style},onKeyDown:ge(y.onKeyDown,D=>{const z=D.target.closest("[data-radix-menu-content]")===D.currentTarget,B=D.ctrlKey||D.altKey||D.metaKey,$=D.key.length===1;z&&(D.key==="Tab"&&D.preventDefault(),!B&&$&&R(D.key));const U=E.current;if(D.target!==U||!iT.includes(D.key))return;D.preventDefault();const F=x().filter(H=>!H.disabled).map(H=>H.ref.current);Yb.includes(D.key)&&F.reverse(),Cte(F)}),onBlur:ge(e.onBlur,D=>{D.currentTarget.contains(D.target)||(window.clearTimeout(N.current),M.current="")}),onPointerMove:ge(e.onPointerMove,zu(D=>{const z=D.target,B=C.current!==D.clientX;if(D.currentTarget.contains(z)&&B){const $=D.clientX>C.current?"right":"left";A.current=$,C.current=D.clientX}}))})})})})})})});hT.displayName=Mr;var vte="MenuGroup",iw=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return h.jsx(Ae.div,{role:"group",...r,ref:t})});iw.displayName=vte;var bte="MenuLabel",mT=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return h.jsx(Ae.div,{...r,ref:t})});mT.displayName=bte;var vh="MenuItem",yT="menu.itemSelect",bh=g.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...a}=e,o=g.useRef(null),i=mc(vh,e.__scopeMenu),s=aw(vh,e.__scopeMenu),c=jt(t,o),l=g.useRef(!1),u=()=>{const d=o.current;if(!n&&d){const p=new CustomEvent(yT,{bubbles:!0,cancelable:!0});d.addEventListener(yT,f=>r==null?void 0:r(f),{once:!0}),kDe(d,p),p.defaultPrevented?l.current=!1:i.onClose()}};return h.jsx(gT,{...a,ref:c,disabled:n,onClick:ge(e.onClick,u),onPointerDown:d=>{var p;(p=e.onPointerDown)==null||p.call(e,d),l.current=!0},onPointerUp:ge(e.onPointerUp,d=>{var p;l.current||((p=d.currentTarget)==null||p.click())}),onKeyDown:ge(e.onKeyDown,d=>{const p=s.searchRef.current!=="";n||p&&d.key===" "||yh.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});bh.displayName=vh;var gT=g.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:a,...o}=e,i=aw(vh,n),s=Qb(n),c=g.useRef(null),l=jt(t,c),[u,d]=g.useState(!1),[p,f]=g.useState("");return g.useEffect(()=>{const m=c.current;m&&f((m.textContent??"").trim())},[o.children]),h.jsx(fc.ItemSlot,{scope:n,disabled:r,textValue:a??p,children:h.jsx(du,{asChild:!0,...s,focusable:!r,children:h.jsx(Ae.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...o,ref:l,onPointerMove:ge(e.onPointerMove,zu(m=>{r?i.onItemLeave(m):(i.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ge(e.onPointerLeave,zu(m=>i.onItemLeave(m))),onFocus:ge(e.onFocus,()=>d(!0)),onBlur:ge(e.onBlur,()=>d(!1))})})})}),wte="MenuCheckboxItem",vT=g.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...a}=e;return h.jsx(jT,{scope:e.__scopeMenu,checked:n,children:h.jsx(bh,{role:"menuitemcheckbox","aria-checked":wh(n)?"mixed":n,...a,ref:t,"data-state":lw(n),onSelect:ge(a.onSelect,()=>r==null?void 0:r(wh(n)?!0:!n),{checkForDefaultPrevented:!1})})})});vT.displayName=wte;var bT="MenuRadioGroup",[xte,_te]=hi(bT,{value:void 0,onValueChange:()=>{}}),wT=g.forwardRef((e,t)=>{const{value:n,onValueChange:r,...a}=e,o=dr(r);return h.jsx(xte,{scope:e.__scopeMenu,value:n,onValueChange:o,children:h.jsx(iw,{...a,ref:t})})});wT.displayName=bT;var xT="MenuRadioItem",_T=g.forwardRef((e,t)=>{const{value:n,...r}=e,a=_te(xT,e.__scopeMenu),o=n===a.value;return h.jsx(jT,{scope:e.__scopeMenu,checked:o,children:h.jsx(bh,{role:"menuitemradio","aria-checked":o,...r,ref:t,"data-state":lw(o),onSelect:ge(r.onSelect,()=>{var i;return(i=a.onValueChange)==null?void 0:i.call(a,n)},{checkForDefaultPrevented:!1})})})});_T.displayName=xT;var sw="MenuItemIndicator",[jT,jte]=hi(sw,{checked:!1}),ST=g.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...a}=e,o=jte(sw,n);return h.jsx(zr,{present:r||wh(o.checked)||o.checked===!0,children:h.jsx(Ae.span,{...a,ref:t,"data-state":lw(o.checked)})})});ST.displayName=sw;var Ste="MenuSeparator",ET=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return h.jsx(Ae.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});ET.displayName=Ste;var Ete="MenuArrow",OT=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=hc(n);return h.jsx(Ib,{...a,...r,ref:t})});OT.displayName=Ete;var cw="MenuSub",[Ote,CT]=hi(cw),NT=e=>{const{__scopeMenu:t,children:n,open:r=!1,onOpenChange:a}=e,o=Eo(cw,t),i=hc(t),[s,c]=g.useState(null),[l,u]=g.useState(null),d=dr(a);return g.useEffect(()=>(o.open===!1&&d(!1),()=>d(!1)),[o.open,d]),h.jsx(lh,{...i,children:h.jsx(ew,{scope:t,open:r,onOpenChange:d,content:l,onContentChange:u,children:h.jsx(Ote,{scope:t,contentId:Rt(),triggerId:Rt(),trigger:s,onTriggerChange:c,children:n})})})};NT.displayName=cw;var Bu="MenuSubTrigger",MT=g.forwardRef((e,t)=>{const n=Eo(Bu,e.__scopeMenu),r=mc(Bu,e.__scopeMenu),a=CT(Bu,e.__scopeMenu),o=aw(Bu,e.__scopeMenu),i=g.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:c}=o,l={__scopeMenu:e.__scopeMenu},u=g.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return g.useEffect(()=>u,[u]),g.useEffect(()=>{const d=s.current;return()=>{window.clearTimeout(d),c(null)}},[s,c]),h.jsx(nw,{asChild:!0,...l,children:h.jsx(gT,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":AT(n.open),...e,ref:LG(t,a.onTriggerChange),onClick:d=>{var p;(p=e.onClick)==null||p.call(e,d),!(e.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:ge(e.onPointerMove,zu(d=>{o.onItemEnter(d),!d.defaultPrevented&&!e.disabled&&!n.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:ge(e.onPointerLeave,zu(d=>{var f,m;u();const p=(f=n.content)==null?void 0:f.getBoundingClientRect();if(p){const y=(m=n.content)==null?void 0:m.dataset.side,v=y==="right",b=v?-5:5,w=p[v?"left":"right"],j=p[v?"right":"left"];o.onPointerGraceIntentChange({area:[{x:d.clientX+b,y:d.clientY},{x:w,y:p.top},{x:j,y:p.top},{x:j,y:p.bottom},{x:w,y:p.bottom}],side:y}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(d),d.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:ge(e.onKeyDown,d=>{var f;const p=o.searchRef.current!=="";e.disabled||p&&d.key===" "||sT[r.dir].includes(d.key)&&(n.onOpenChange(!0),(f=n.content)==null||f.focus(),d.preventDefault())})})})});MT.displayName=Bu;var kT="MenuSubContent",PT=g.forwardRef((e,t)=>{const n=pT(Mr,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,o=Eo(Mr,e.__scopeMenu),i=mc(Mr,e.__scopeMenu),s=CT(kT,e.__scopeMenu),c=g.useRef(null),l=jt(t,c);return h.jsx(fc.Provider,{scope:e.__scopeMenu,children:h.jsx(zr,{present:r||o.open,children:h.jsx(fc.Slot,{scope:e.__scopeMenu,children:h.jsx(ow,{id:s.contentId,"aria-labelledby":s.triggerId,...a,ref:l,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;i.isUsingKeyboardRef.current&&((d=c.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:ge(e.onFocusOutside,u=>{u.target!==s.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:ge(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:ge(e.onKeyDown,u=>{var f;const d=u.currentTarget.contains(u.target),p=cT[i.dir].includes(u.key);d&&p&&(o.onOpenChange(!1),(f=s.trigger)==null||f.focus(),u.preventDefault())})})})})})});PT.displayName=kT;function AT(e){return e?"open":"closed"}function wh(e){return e==="indeterminate"}function lw(e){return wh(e)?"indeterminate":e?"checked":"unchecked"}function Cte(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function Nte(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function Mte(e,t,n){const r=t.length>1&&Array.from(t).every(s=>s===t[0])?t[0]:t,a=n?e.indexOf(n):-1;let o=Nte(e,Math.max(a,0));r.length===1&&(o=o.filter(s=>s!==n));const i=o.find(s=>s.toLowerCase().startsWith(r.toLowerCase()));return i!==n?i:void 0}function kte(e,t){const{x:n,y:r}=e;let a=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const s=t[o].x,c=t[o].y,l=t[i].x,u=t[i].y;c>r!=u>r&&n<(l-s)*(r-c)/(u-c)+s&&(a=!a)}return a}function Pte(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return kte(n,t)}function zu(e){return t=>t.pointerType==="mouse"?e(t):void 0}var TT=tw,IT=nw,RT=fT,DT=hT,LT=iw,$T=mT,FT=bh,BT=vT,zT=wT,UT=_T,VT=ST,qT=ET,WT=OT,Ate=NT,HT=MT,KT=PT,uw="DropdownMenu",[Tte,g3e]=ur(uw,[gh]),Rn=gh(),[Ite,ZT]=Tte(uw),GT=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:a,defaultOpen:o,onOpenChange:i,modal:s=!0}=e,c=Rn(t),l=g.useRef(null),[u=!1,d]=Tn({prop:a,defaultProp:o,onChange:i});return h.jsx(Ite,{scope:t,triggerId:Rt(),triggerRef:l,contentId:Rt(),open:u,onOpenChange:d,onOpenToggle:g.useCallback(()=>d(p=>!p),[d]),modal:s,children:h.jsx(TT,{...c,open:u,onOpenChange:d,dir:r,modal:s,children:n})})};GT.displayName=uw;var XT="DropdownMenuTrigger",JT=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...a}=e,o=ZT(XT,n),i=Rn(n);return h.jsx(IT,{asChild:!0,...i,children:h.jsx(Ae.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...a,ref:LG(t,o.triggerRef),onPointerDown:ge(e.onPointerDown,s=>{!r&&s.button===0&&s.ctrlKey===!1&&(o.onOpenToggle(),o.open||s.preventDefault())}),onKeyDown:ge(e.onKeyDown,s=>{r||(["Enter"," "].includes(s.key)&&o.onOpenToggle(),s.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});JT.displayName=XT;var Rte="DropdownMenuPortal",YT=e=>{const{__scopeDropdownMenu:t,...n}=e,r=Rn(t);return h.jsx(RT,{...r,...n})};YT.displayName=Rte;var QT="DropdownMenuContent",eI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=ZT(QT,n),o=Rn(n),i=g.useRef(!1);return h.jsx(DT,{id:a.contentId,"aria-labelledby":a.triggerId,...o,...r,ref:t,onCloseAutoFocus:ge(e.onCloseAutoFocus,s=>{var c;i.current||((c=a.triggerRef.current)==null||c.focus()),i.current=!1,s.preventDefault()}),onInteractOutside:ge(e.onInteractOutside,s=>{const c=s.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,u=c.button===2||l;(!a.modal||u)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eI.displayName=QT;var Dte="DropdownMenuGroup",tI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(LT,{...a,...r,ref:t})});tI.displayName=Dte;var Lte="DropdownMenuLabel",nI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx($T,{...a,...r,ref:t})});nI.displayName=Lte;var $te="DropdownMenuItem",rI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(FT,{...a,...r,ref:t})});rI.displayName=$te;var Fte="DropdownMenuCheckboxItem",aI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(BT,{...a,...r,ref:t})});aI.displayName=Fte;var Bte="DropdownMenuRadioGroup",oI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(zT,{...a,...r,ref:t})});oI.displayName=Bte;var zte="DropdownMenuRadioItem",iI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(UT,{...a,...r,ref:t})});iI.displayName=zte;var Ute="DropdownMenuItemIndicator",sI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(VT,{...a,...r,ref:t})});sI.displayName=Ute;var Vte="DropdownMenuSeparator",cI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(qT,{...a,...r,ref:t})});cI.displayName=Vte;var qte="DropdownMenuArrow",Wte=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(WT,{...a,...r,ref:t})});Wte.displayName=qte;var Hte=e=>{const{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:a,defaultOpen:o}=e,i=Rn(t),[s=!1,c]=Tn({prop:r,defaultProp:o,onChange:a});return h.jsx(Ate,{...i,open:s,onOpenChange:c,children:n})},Kte="DropdownMenuSubTrigger",lI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(HT,{...a,...r,ref:t})});lI.displayName=Kte;var Zte="DropdownMenuSubContent",uI=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=Rn(n);return h.jsx(KT,{...a,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});uI.displayName=Zte,xk=GT,_k=JT,wk=YT,r0=eI,bk=tI,u0=nI,i0=rI,s0=aI,rX=oI,l0=iI,c0=sI,d0=cI,aX=Hte,a0=lI,o0=uI;const Gte=xk,Xte=_k,Jte=bk,Yte=g.forwardRef(({className:e,inset:t,children:n,...r},a)=>h.jsxs(a0,{ref:a,className:Z("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...r,children:[n,h.jsx(pe,{name:"chevron-right",className:"ml-auto"})]}));Yte.displayName=a0.displayName;const Qte=g.forwardRef(({className:e,...t},n)=>h.jsx(o0,{ref:n,className:Z("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));Qte.displayName=o0.displayName;const dI=g.forwardRef(({className:e,sideOffset:t=4,...n},r)=>h.jsx(wk,{children:h.jsx(r0,{ref:r,sideOffset:t,className:Z("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));dI.displayName=r0.displayName;const pI=g.forwardRef(({className:e,inset:t,...n},r)=>h.jsx(i0,{ref:r,className:Z("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...n}));pI.displayName=i0.displayName;const ene=g.forwardRef(({className:e,children:t,checked:n,...r},a)=>h.jsxs(s0,{ref:a,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...r,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(c0,{children:h.jsx(pe,{name:"check",className:"h-4 w-4"})})}),t]}));ene.displayName=s0.displayName;const tne=g.forwardRef(({className:e,children:t,...n},r)=>h.jsxs(l0,{ref:r,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(c0,{children:h.jsx(pe,{name:"circle",className:"h-4 w-4"})})}),t]}));tne.displayName=l0.displayName;const nne=g.forwardRef(({className:e,inset:t,...n},r)=>h.jsx(u0,{ref:r,className:Z("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));nne.displayName=u0.displayName;const rne=g.forwardRef(({className:e,...t},n)=>h.jsx(d0,{ref:n,className:Z("-mx-1 my-1 h-px bg-muted",e),...t}));rne.displayName=d0.displayName;function ane(){const{t:e}=ke("sidebar"),{isMobile:t}=Iu();return h.jsx(uc,{children:h.jsx(bo,{children:h.jsxs(Gte,{children:[h.jsx(Xte,{asChild:!0,children:h.jsxs(wo,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[h.jsx("div",{children:h.jsx(pe,{name:"settings",size:28,className:"pr-2"})}),h.jsx(pe,{name:"chevrons-up-down",className:"ml-auto size-4"})]})}),h.jsx(dI,{className:"w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg",side:t?"bottom":"right",align:"end",sideOffset:4,children:h.jsx(Jte,{children:h.jsxs(pI,{children:[h.jsx(pe,{name:"sparkles"}),e("contact")]})})})]})})})}function one({applications:e,currentSession:t,setCurrentSession:n}){const{t:r}=ke("sidebar"),a=es(),{applicationId:o}=$f(),[i,s]=g.useState(),c=tn(X2),l=g.useCallback((p,f)=>{p.preventDefault(),p.stopPropagation(),c.show({id:f})},[c]),u=async p=>{try{s(p.id),n(p),a(dn("application",{applicationId:p.id}))}catch(f){console.error(f),s(void 0)}},d=p=>{switch(p.main_source_type){case"Thread":return h.jsx(pe,{className:"inline-flex items-center ml-2",name:"message-circle-more",size:14});default:return null}};return g.useEffect(()=>{!i||i!==(t==null?void 0:t.id)||s(void 0)},[i,t==null?void 0:t.id]),h.jsxs(Ru,{className:"group-data-[collapsible=icon]:hidden pt-0",children:[h.jsx(Du,{children:h.jsx("div",{className:"text-sm",children:r("applications")})}),h.jsxs(uc,{children:[e==null?void 0:e.map(p=>h.jsx(bo,{className:"cursor-pointer",children:h.jsx(wo,{disabled:!!i,asChild:!0,autoHide:!0,onClick:()=>u(p),children:h.jsxs("div",{className:"flex flex-row justify-between items-center !h-auto",children:[h.jsxs("div",{className:"flex gap-2",children:[p.id===i?h.jsx(pe,{size:16,name:"loader",className:"animate-spin"}):o===p.id?h.jsx(pe,{size:16,color:"green",name:"check"}):h.jsx(pe,{size:16,name:"chevron-right"}),h.jsxs("span",{children:[p.name,d(p)]})]}),h.jsx(pe,{onClick:f=>l(f,p.id),size:16,className:"!z-50",name:"trash-2"})]})})},p.id)),e?h.jsx(bo,{children:h.jsxs(wo,{className:"text-sidebar-foreground/70",children:[h.jsx(pe,{name:"ellipsis",className:"text-sidebar-foreground/70"}),h.jsx("span",{children:r("more_session")})]})}):null]})]})}const ine={navMain:[{title:"playground.title",icon:h.jsx(pe,{name:"square-terminal"}),isActive:!0,items:[{title:"playground.nodes",id:"nodes"},{title:"playground.connections",id:"connections"}]},{title:"model.title",url:"#",icon:h.jsx(pe,{name:"bot"}),items:[{title:"model.llm",id:"llm"},{title:"model.embedding",id:"embedding"}]},{title:"tutorial.title",icon:h.jsx(pe,{name:"book-open"}),items:[{title:"tutorial.get_started",id:"get-started"},{title:"tutorial.simple_workflow",id:"simple-workflow"},{title:"tutorial.ai_structured_output",id:"ai-structured-output"},{title:"tutorial.standalone_chat_application",id:"chat-application"},{title:"tutorial.standalone_editor_application",id:"editor-application"},{title:"tutorial.tool_calling",id:"tool-calling"},{title:"tutorial.vector_database",id:"vector-database"}]},{title:"application.title",icon:h.jsx(pe,{name:"settings-2"}),items:[{title:"application.chat",id:"chat"},{title:"application.editor",id:"editor"},{title:"application.vslite",id:"vslite"}]}]};function sne({sessions:e,applications:t,currentSession:n,setCurrentSession:r,...a}){return h.jsxs(Bb,{collapsible:"offcanvas",...a,children:[h.jsx("div",{className:"h-1"}),h.jsxs(Ub,{children:[h.jsx(ate,{sessions:e||[],currentSession:n,setCurrentSession:r}),h.jsx(one,{applications:t||[],currentSession:n,setCurrentSession:r}),h.jsx(Bee,{items:ine.navMain})]}),h.jsx(C2,{children:h.jsx(ane,{})}),h.jsx(O2,{})]})}Yn=g.memo(e=>{const{loading:t,...n}=e;return h.jsx(Ye,{...n,disabled:e.disabled||t,children:t?h.jsx(pe,{name:"loader-circle",className:"animate-spin"}):e.children})});function cne({className:e,onProcess:t=async()=>(await new Promise(a=>setTimeout(a,2e3)),Math.random()>.5),processDuration:n=2e3,...r}){const[a,o]=g.useState(!1),[i,s]=g.useState(null),[c,l]=g.useState(!1),[,u]=g.useState(0);g.useEffect(()=>{if(a){const p=Date.now(),f=setInterval(()=>{const m=(Date.now()-p)/n*100;m>=100?(clearInterval(f),u(100)):u(m)},10);return()=>clearInterval(f)}},[a,n]);async function d(){if(a)return;o(!0),s(null),u(0),await new Promise(f=>setTimeout(f,n));const p=t?await t():!0;s(p),o(!1),l(!0),setTimeout(()=>{s(null),u(0),l(!1)},2e3)}return h.jsx(Ye,{className:Z("relative group","transition-all duration-300",a&&"cursor-wait",e),variant:"ghost",onClick:d,disabled:a,...r,children:h.jsx("div",{className:Z("w-full flex items-center justify-center gap-2",c&&"animate-[scale_300ms_ease-in-out]"),children:i===null?h.jsx(h.Fragment,{children:h.jsx(pe,{name:"forward",className:Z("w-4 h-4 transition-transform duration-200","group-hover:scale-110",a&&"animate-bounce")})}):i?h.jsx(h.Fragment,{children:h.jsx(pe,{name:"check",className:"w-4 h-4 text-green-500"})}):h.jsx(h.Fragment,{children:h.jsx(pe,{name:"x",className:"w-4 h-4 text-red-500"})})})})}const Ba="NOLLM",lne="0123456789abcdef",une=[8,4,4,4,12];function Uu(){return une.map(e=>PDe(lne,e)()).join("-")}const dne=()=>{const e=Je(t=>t.currentSession);return{exportSession:g.useCallback(async()=>{if(!(e!=null&&e.id))return;const t={},n={},r=Object.keys($G).filter(c=>c!=="Session");await Promise.all(r.map(c=>ue(c).find({where:{session_id:e.id}}).then(l=>{l.map(u=>{n[u.id]=u.id}),t[c]=l}))),Object.keys(n).forEach(c=>{n[c]=`[ID_${Uu()}]`});let a=JSON.stringify({[Ba]:{key:e.id,session:Object.entries(e).reduce((c,[l,u])=>((typeof u!="object"||u===null)&&(c[l]=u),u===void 0&&(c[l]=null),c),{}),ids:Object.keys(n)},...t});Object.keys(n).forEach(c=>{a=a.replace(new RegExp(c,"g"),n[c])}),a=a.replace(new RegExp(e.id,"g"),"[SESSION_ID]");const o=new Blob([a],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=`${e.name}_${new Date}.json`,s.click()},[e])}},pne=()=>{const[e,t]=g.useState(!1),n=es(),r=g.useCallback((o,{idMap:i,newSessionId:s,replaceItem:c})=>{const l=o;return{...Object.keys(l).reduce((u,d)=>(l[d]&&typeof l[d]=="string"&&i[l[d]]?u[d]=i[l[d]]:d==="session_id"&&s?u[d]=s:u[d]=l[d],u),{}),...c||{}}},[]),a=g.useCallback(async o=>{try{t(!0);const i=Object.keys($G).filter(d=>d!==Ba);if(!Object.keys(o[Ba]).length||typeof o[Ba]!="object")throw new Error("Missing Metadata");if(!("session"in o[Ba])||!o[Ba].session)throw new Error("Missing Session Metadata");const s=o[Ba].session;if(!("ids"in o[Ba]))throw new Error("Missing Session ID");const c=o[Ba].ids.reduce((d,p)=>(d[p]=Uu(),d),{}),l=Object.keys(o).filter(d=>d!==Ba);if(!l.every(d=>i.includes(d)))throw new Error("Invalid JSON keys");if(!l.every(d=>Array.isArray(o[d])))throw new Error("Invalid JSON values");l.forEach(d=>{o[d].forEach(p=>{if("session_id"in p&&p.session_id!=="[SESSION_ID]")throw new Error("Invalid JSON values")})});const u=await ue("Session").save(r(s,{idMap:c,newSessionId:"",replaceItem:{id:void 0}}));if(!u)throw new Error("Failed to import session");await Promise.all(i.map(d=>{const p=o[d];if(!p||!p.length)return Promise.resolve();const f=p.map(m=>r(m,{idMap:c,newSessionId:u.id}));return ue(d).save(f)})),u.type===Vi.Whiteboard?n(dn("whiteboard",{sessionId:u.id})):u.type===Vi.StandaloneApp&&n(dn("application",{applicationId:u.id}))}finally{t(!1)}},[n,r]);return{loading:e,importSession:a}};function fne(){const{t:e}=ke("tooltips"),t=Ra(),n=eu(p=>p.setTheme),r=eu(p=>p.theme),{exportSession:a}=dne(),{loading:o,importSession:i}=pne(),s=g.useRef(null),c=g.useCallback(()=>{n(r==="dark"?"light":"dark")},[r,n]),l=g.useCallback(async()=>{try{return await a(),!0}catch(p){return Ws(p),!1}},[a]),u=g.useCallback(async p=>{var f;try{const m=(f=p.target.files)==null?void 0:f[0];if(!m)return;const y=await new Promise((v,b)=>{const w=new FileReader;w.onload=j=>{var x;try{const _=(x=j.target)==null?void 0:x.result;v(JSON.parse(_))}catch(_){b(_)}},w.onerror=j=>{b(j)},w.readAsText(m)});await i(y)}catch(m){return Ws(m),!1}},[i]),d=g.useMemo(()=>{if(t.pathname.includes(dn("whiteboard")))return e("whiteboard");if(t.pathname.includes(dn("application")))return e("apllication")},[t.pathname,e]);return h.jsxs("header",{className:"flex h-14 shrink-0 items-center gap-2 transition-[width,height] ease-linear justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2 px-4",children:[h.jsx(E2,{}),h.jsx(Be,{children:d})]}),h.jsx("div",{className:"flex items-center pl-4 pr-2",children:h.jsxs(Tu,{children:[h.jsxs($a,{children:[h.jsx(Fa,{children:h.jsxs(Yn,{loading:o,variant:"ghost",onClick:()=>{var p;return(p=s.current)==null?void 0:p.click()},children:[h.jsx(pe,{size:18,name:"import"}),h.jsx("input",{ref:s,type:"file",accept:".json",onChange:u,className:"hidden"},`${Date.now()}`)]})}),h.jsx(Yr,{children:h.jsx("p",{children:e("import")})})]}),h.jsxs($a,{children:[h.jsx(Fa,{children:h.jsx(cne,{onProcess:l})}),h.jsx(Yr,{children:h.jsx("p",{children:e("export")})})]}),h.jsxs($a,{children:[h.jsx(Fa,{children:h.jsx(Ye,{disabled:o,onClick:c,variant:"ghost",children:h.jsx(pe,{size:18,name:r==="dark"?"moon":"sun"})})}),h.jsx(Yr,{children:h.jsx("p",{children:e("theme")})})]}),h.jsxs($a,{children:[h.jsx(Fa,{children:h.jsx(Ye,{variant:"link",children:h.jsx("a",{referrerPolicy:"no-referrer",target:"_blank",href:"https://github.com/zrg-team/NoLLMChat",children:h.jsx(pe,{size:18,name:"github"})})})}),h.jsx(Yr,{children:h.jsx("p",{children:"https://github.com/zrg-team/NoLLMChat"})})]})]})})]})}function fI({requiredSession:e}){const t=$f(),n=es(),r=Ra(),a=g.useRef(r),o=Je(u=>u.currentSession),i=Je(u=>u.sessions),s=Je(u=>u.applications),c=Je(u=>u.setCurrentSession),l=Je(u=>u.setToDefaultSession);return a.current=r,g.useEffect(()=>{!(o!=null&&o.id)||!e||(r.pathname.includes(dn("whiteboard"))?t.sessionId?t.sessionId&&t.sessionId!==(o==null?void 0:o.id)&&c(t.sessionId):n(dn("whiteboard",{sessionId:o==null?void 0:o.id})):r.pathname.includes(dn("application"))&&(t.applicationId?t.applicationId&&t.applicationId!==(o==null?void 0:o.id)&&c(t.applicationId):n(dn("application",{applicationId:o==null?void 0:o.id}))))},[o==null?void 0:o.id,r.pathname,n,t.applicationId,t.sessionId,e,c]),g.useEffect(()=>{e&&c(t.sessionId||t.applicationId).then(u=>{if(!u)return l(r.pathname.includes(dn("whiteboard"))?Vi.Whiteboard:Vi.StandaloneApp);Fee().has("flow")&&u.type===Vi.StandaloneApp||(u.type===Vi.StandaloneApp&&a.current.pathname.includes(dn("whiteboard").replace("/",""))?n(dn("application",{applicationId:u.id})):u.type===Vi.Whiteboard&&a.current.pathname.includes(dn("application").replace("/",""))&&n(dn("whiteboard",{sessionId:u.id})))})},[n,t.applicationId,t.sessionId,e,c,l]),h.jsxs(Fb,{defaultOpen:!1,children:[h.jsx(sne,{sessions:i,applications:s,currentSession:o,setCurrentSession:c}),h.jsxs(zb,{className:"max-h-screen overflow-hidden",children:[h.jsx(fne,{}),h.jsx(Gs,{className:"shrink-0"}),h.jsx("div",{className:"flex flex-1 flex-col p-0 m-0 overflow-y-auto",children:h.jsx(RJ,{})})]})]})}const hI=g.forwardRef(({className:e,children:t,...n},r)=>h.jsx("div",{className:Z("flex flex-col w-full h-full p-4 gap-6 overflow-y-auto",e),ref:r,...n,children:t}));hI.displayName="ChatMessageList";var mI="vercel.ai.error",hne=Symbol.for(mI),yI,mne=class iX extends Error{constructor({name:t,message:n,cause:r}){super(n),this[yI]=!0,this.name=t,this.cause=r}static isInstance(t){return iX.hasMarker(t,mI)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};yI=hne;var yc=mne;function gI(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var vI="AI_InvalidArgumentError",bI=`vercel.ai.error.${vI}`,yne=Symbol.for(bI),wI,gne=class extends yc{constructor({message:e,cause:t,argument:n}){super({name:vI,message:e,cause:t}),this[wI]=!0,this.argument=n}static isInstance(e){return yc.hasMarker(e,bI)}};wI=yne;var xI="AI_JSONParseError",_I=`vercel.ai.error.${xI}`,vne=Symbol.for(_I),jI,SI=class extends yc{constructor({text:e,cause:t}){super({name:xI,message:`JSON parsing failed: Text: ${e}.
Error message: ${gI(t)}`,cause:t}),this[jI]=!0,this.text=e}static isInstance(e){return yc.hasMarker(e,_I)}};jI=vne;var EI="AI_TypeValidationError",OI=`vercel.ai.error.${EI}`,bne=Symbol.for(OI),CI,wne=class Bk extends yc{constructor({value:t,cause:n}){super({name:EI,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${gI(n)}`,cause:n}),this[CI]=!0,this.value=t}static isInstance(t){return yc.hasMarker(t,OI)}static wrap({value:t,cause:n}){return Bk.isInstance(n)&&n.value===t?n:new Bk({value:t,cause:n})}};CI=bne;var NI=wne;let xne=(e,t=21)=>(n=t)=>{let r="",a=n;for(;a--;)r+=e[Math.random()*e.length|0];return r};var os={exports:{}},MI;function _ne(){if(MI)return os.exports;MI=1;const e=typeof jn<"u",t=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,n=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function r(s,c,l){l==null&&c!==null&&typeof c=="object"&&(l=c,c=void 0),e&&jn.isBuffer(s)&&(s=s.toString()),s&&s.charCodeAt(0)===65279&&(s=s.slice(1));const u=JSON.parse(s,c);if(u===null||typeof u!="object")return u;const d=l&&l.protoAction||"error",p=l&&l.constructorAction||"error";if(d==="ignore"&&p==="ignore")return u;if(d!=="ignore"&&p!=="ignore"){if(t.test(s)===!1&&n.test(s)===!1)return u}else if(d!=="ignore"&&p==="ignore"){if(t.test(s)===!1)return u}else if(n.test(s)===!1)return u;return a(u,{protoAction:d,constructorAction:p,safe:l&&l.safe})}function a(s,{protoAction:c="error",constructorAction:l="error",safe:u}={}){let d=[s];for(;d.length;){const p=d;d=[];for(const f of p){if(c!=="ignore"&&Object.prototype.hasOwnProperty.call(f,"__proto__")){if(u===!0)return null;if(c==="error")throw new SyntaxError("Object contains forbidden prototype property");delete f.__proto__}if(l!=="ignore"&&Object.prototype.hasOwnProperty.call(f,"constructor")&&Object.prototype.hasOwnProperty.call(f.constructor,"prototype")){if(u===!0)return null;if(l==="error")throw new SyntaxError("Object contains forbidden prototype property");delete f.constructor}for(const m in f){const y=f[m];y&&typeof y=="object"&&d.push(y)}}}return s}function o(s,c,l){const u=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return r(s,c,l)}finally{Error.stackTraceLimit=u}}function i(s,c){const l=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return r(s,c,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=l}}return os.exports=o,os.exports.default=o,os.exports.parse=o,os.exports.safeParse=i,os.exports.scan=a,os.exports}var jne=_ne();const Sne=st(jne);var Ene=({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=xne(n,t);if(e==null)return a;if(n.includes(r))throw new gne({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return o=>`${e}${r}${a(o)}`},kI=Ene(),dw=Symbol.for("vercel.ai.validator");function One(e){return{[dw]:!0,validate:e}}function Cne(e){return typeof e=="object"&&e!==null&&dw in e&&e[dw]===!0&&"validate"in e}function Nne(e){return Cne(e)?e:Mne(e)}function Mne(e){return One(t=>{const n=e.safeParse(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function kne({value:e,schema:t}){const n=Nne(t);try{if(n.validate==null)return{success:!0,value:e};const r=n.validate(e);return r.success?r:{success:!1,error:NI.wrap({value:e,cause:r.error})}}catch(r){return{success:!1,error:NI.wrap({value:e,cause:r})}}}function PI({text:e,schema:t}){try{const n=Sne.parse(e);return t==null?{success:!0,value:n}:kne({value:n,schema:t})}catch(n){return{success:!1,error:SI.isInstance(n)?n:new SI({text:e,cause:n})}}}var xh={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},_h={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},jh={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},Sh={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Eh={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},Pne=[xh,_h,jh,Sh,Eh];xh.code+"",_h.code+"",jh.code+"",Sh.code+"",Eh.code+"",xh.name+"",xh.code,_h.name+"",_h.code,jh.name+"",jh.code,Sh.name+"",Sh.code,Eh.name+"",Eh.code,Pne.map(e=>e.code);function Ane(e){const t=["ROOT"];let n=-1,r=null;function a(c,l,u){switch(c){case'"':{n=l,t.pop(),t.push(u),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=l,r=l,t.pop(),t.push(u),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(u),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=l,t.pop(),t.push(u),t.push("INSIDE_NUMBER");break}case"{":{n=l,t.pop(),t.push(u),t.push("INSIDE_OBJECT_START");break}case"[":{n=l,t.pop(),t.push(u),t.push("INSIDE_ARRAY_START");break}}}function o(c,l){switch(c){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=l,t.pop();break}}}function i(c,l){switch(c){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=l,t.pop();break}}}for(let c=0;c<e.length;c++){const l=e[c];switch(t[t.length-1]){case"ROOT":a(l,c,"FINISH");break;case"INSIDE_OBJECT_START":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{n=c,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(l){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(l,c,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{o(l,c);break}case"INSIDE_STRING":{switch(l){case'"':{t.pop(),n=c;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=c}break}case"INSIDE_ARRAY_START":{switch(l){case"]":{n=c,t.pop();break}default:{n=c,a(l,c,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=c,t.pop();break}default:{n=c;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(l,c,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),n=c;break}case"INSIDE_NUMBER":{switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=c;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,c),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(l,c);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(l,c);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,c);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const u=e.substring(r,c+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?o(l,c):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(l,c)):n=c;break}}}let s=e.slice(0,n+1);for(let c=t.length-1;c>=0;c--)switch(t[c]){case"INSIDE_STRING":{s+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{s+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{s+="]";break}case"INSIDE_LITERAL":{const l=e.substring(r,e.length);"true".startsWith(l)?s+="true".slice(l.length):"false".startsWith(l)?s+="false".slice(l.length):"null".startsWith(l)&&(s+="null".slice(l.length))}}return s}function Tne(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=PI({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=PI({text:Ane(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Vu={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},qu={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},Wu={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Hu={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Ku={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Zu={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},Gu={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},Xu={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},Ju={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},Yu={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},Ine=[Vu,qu,Wu,Hu,Ku,Zu,Gu,Xu,Ju,Yu],Rne={[Vu.code]:Vu,[qu.code]:qu,[Wu.code]:Wu,[Hu.code]:Hu,[Ku.code]:Ku,[Zu.code]:Zu,[Gu.code]:Gu,[Xu.code]:Xu,[Ju.code]:Ju,[Yu.code]:Yu};Vu.name+"",Vu.code,qu.name+"",qu.code,Wu.name+"",Wu.code,Hu.name+"",Hu.code,Ku.name+"",Ku.code,Zu.name+"",Zu.code,Gu.name+"",Gu.code,Xu.name+"",Xu.code,Ju.name+"",Ju.code,Yu.name+"",Yu.code;var Dne=Ine.map(e=>e.code),Lne=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const n=e.slice(0,t);if(!Dne.includes(n))throw new Error(`Failed to parse stream string. Invalid code ${n}.`);const r=n,a=e.slice(t+1),o=JSON.parse(a);return Rne[r].parse(o)},$ne=10;function Fne(e,t){const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return e.length=0,n}async function Bne({stream:e,onTextPart:t,onDataPart:n,onErrorPart:r,onToolCallStreamingStartPart:a,onToolCallDeltaPart:o,onToolCallPart:i,onToolResultPart:s,onMessageAnnotationsPart:c,onFinishMessagePart:l,onFinishStepPart:u}){const d=e.getReader(),p=new TextDecoder,f=[];let m=0;for(;;){const{value:y}=await d.read();if(y&&(f.push(y),m+=y.length,y[y.length-1]!==$ne))continue;if(f.length===0)break;const v=Fne(f,m);m=0;const b=p.decode(v,{stream:!0}).split(`
`).filter(w=>w!=="").map(Lne);for(const{type:w,value:j}of b)switch(w){case"text":await(t==null?void 0:t(j));break;case"data":await(n==null?void 0:n(j));break;case"error":await(r==null?void 0:r(j));break;case"message_annotations":await(c==null?void 0:c(j));break;case"tool_call_streaming_start":await(a==null?void 0:a(j));break;case"tool_call_delta":await(o==null?void 0:o(j));break;case"tool_call":await(i==null?void 0:i(j));break;case"tool_result":await(s==null?void 0:s(j));break;case"finish_message":await(l==null?void 0:l(j));break;case"finish_step":await(u==null?void 0:u(j));break;default:{const x=w;throw new Error(`Unknown stream part type: ${x}`)}}}}function zne({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}async function Une({stream:e,update:t,onToolCall:n,onFinish:r,generateId:a=kI,getCurrentDate:o=()=>new Date}){const i=o();let s,c=!0;const l=[],u=[];let d;const p={};let f={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},m="unknown";function y(){const b=[...u];if(s==null){t(l,b);return}d!=null&&d.length&&(s.annotations=d);const w={...JSON.parse(JSON.stringify(s)),revisionId:a()};t([...l,w],b)}function v(){return(c||s==null)&&(s!=null&&l.push(s),c=!1,s={id:a(),role:"assistant",content:"",createdAt:i}),s}await Bne({stream:e,onTextPart(b){const w=v();s={...w,content:w.content+b},y()},onToolCallStreamingStartPart(b){const w=v();w.toolInvocations==null&&(w.toolInvocations=[]),p[b.toolCallId]={text:"",toolName:b.toolName,index:w.toolInvocations.length},w.toolInvocations.push({state:"partial-call",toolCallId:b.toolCallId,toolName:b.toolName,args:void 0}),y()},onToolCallDeltaPart(b){const w=v(),j=p[b.toolCallId];j.text+=b.argsTextDelta;const{value:x}=Tne(j.text);w.toolInvocations[j.index]={state:"partial-call",toolCallId:b.toolCallId,toolName:j.toolName,args:x},y()},async onToolCallPart(b){const w=v();if(p[b.toolCallId]!=null?w.toolInvocations[p[b.toolCallId].index]={state:"call",...b}:(w.toolInvocations==null&&(w.toolInvocations=[]),w.toolInvocations.push({state:"call",...b})),n){const j=await n({toolCall:b});j!=null&&(w.toolInvocations[w.toolInvocations.length-1]={state:"result",...b,result:j})}y()},onToolResultPart(b){const w=v().toolInvocations;if(w==null)throw new Error("tool_result must be preceded by a tool_call");const j=w.findIndex(x=>x.toolCallId===b.toolCallId);if(j===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");w[j]={...w[j],state:"result",...b},y()},onDataPart(b){u.push(...b),y()},onMessageAnnotationsPart(b){d==null?d=[...b]:d.push(...b),y()},onFinishStepPart(b){c=!b.isContinued},onFinishMessagePart(b){m=b.finishReason,b.usage!=null&&(f=zne(b.usage))},onErrorPart(b){throw new Error(b)}}),r==null||r({message:s,finishReason:m,usage:f})}async function Vne({stream:e,onTextPart:t}){const n=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:r,value:a}=await n.read();if(r)break;await t(a)}}var qne=()=>fetch;async function Wne({api:e,body:t,streamProtocol:n="data",credentials:r,headers:a,abortController:o,restoreMessagesOnFailure:i,onResponse:s,onUpdate:c,onFinish:l,onToolCall:u,generateId:d,fetch:p=qne()}){var f,m;const y=await p(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...a},signal:(f=o==null?void 0:o())==null?void 0:f.signal,credentials:r}).catch(v=>{throw i(),v});if(s)try{await s(y)}catch(v){throw v}if(!y.ok)throw i(),new Error((m=await y.text())!=null?m:"Failed to fetch the chat response.");if(!y.body)throw new Error("The response body is empty.");switch(n){case"text":{const v={id:d(),createdAt:new Date,role:"assistant",content:""};await Vne({stream:y.body,onTextPart:b=>{v.content+=b,c([{...v}],[])}}),l==null||l(v,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"});return}case"data":{await Une({stream:y.body,update:c,onToolCall:u,onFinish({message:v,finishReason:b,usage:w}){l&&v!=null&&l(v,{usage:w,finishReason:b})},generateId:d});return}default:{const v=n;throw new Error(`Unknown stream protocol: ${v}`)}}}var AI={exports:{}},pw={},TI;function Hne(){if(TI)return pw;TI=1;var e=FG();function t(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var n=typeof Object.is=="function"?Object.is:t,r=e.useState,a=e.useEffect,o=e.useLayoutEffect,i=e.useDebugValue;function s(d,p){var f=p(),m=r({inst:{value:f,getSnapshot:p}}),y=m[0].inst,v=m[1];return o(function(){y.value=f,y.getSnapshot=p,c(y)&&v({inst:y})},[d,f,p]),a(function(){return c(y)&&v({inst:y}),d(function(){c(y)&&v({inst:y})})},[d]),i(f),f}function c(d){var p=d.getSnapshot;d=d.value;try{var f=p();return!n(d,f)}catch{return!0}}function l(d,p){return p()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:s;return pw.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u,pw}var II;function RI(){return II||(II=1,AI.exports=Hne()),AI.exports}xf=RI();let Oo,Hn,Oh,ut,Qr,Co,DI,Qu;nX=st(xf),Oo=()=>{},Hn=Oo(),Oh=Object,ut=e=>e===Hn,Qr=e=>typeof e=="function",Co=(e,t)=>({...e,...t}),DI=e=>Qr(e.then),Qu=new WeakMap;let Kne=0;const ed=e=>{const t=typeof e,n=e&&e.constructor,r=n==Date;let a,o;if(Oh(e)===e&&!r&&n!=RegExp){if(a=Qu.get(e),a)return a;if(a=++Kne+"~",Qu.set(e,a),n==Array){for(a="@",o=0;o<e.length;o++)a+=ed(e[o])+",";Qu.set(e,a)}if(n==Oh){a="#";const i=Oh.keys(e).sort();for(;!ut(o=i.pop());)ut(e[o])||(a+=o+":"+ed(e[o])+",");Qu.set(e,a)}}else a=r?e.toJSON():t=="symbol"?e.toString():t=="string"?JSON.stringify(e):""+e;return a},No=new WeakMap,fw={},Ch={},hw="undefined",Nh=typeof window!=hw,mw=typeof document!=hw,Zne=()=>Nh&&typeof window.requestAnimationFrame!=hw,LI=(e,t)=>{const n=No.get(e);return[()=>!ut(t)&&e.get(t)||fw,r=>{if(!ut(t)){const a=e.get(t);t in Ch||(Ch[t]=a),n[5](t,Co(a,r),a||fw)}},n[6],()=>!ut(t)&&t in Ch?Ch[t]:!ut(t)&&e.get(t)||fw]};let yw=!0;const Gne=()=>yw,[gw,vw]=Nh&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Oo,Oo],Xne=()=>{const e=mw&&document.visibilityState;return ut(e)||e!=="hidden"},Jne=e=>(mw&&document.addEventListener("visibilitychange",e),gw("focus",e),()=>{mw&&document.removeEventListener("visibilitychange",e),vw("focus",e)}),Yne=e=>{const t=()=>{yw=!0,e()},n=()=>{yw=!1};return gw("online",t),gw("offline",n),()=>{vw("online",t),vw("offline",n)}},Qne={isOnline:Gne,isVisible:Xne},ere={initFocus:Jne,initReconnect:Yne},$I=!W.useId,td=!Nh||"Deno"in window,tre=e=>Zne()?window.requestAnimationFrame(e):setTimeout(e,1),bw=td?g.useEffect:g.useLayoutEffect,ww=typeof navigator<"u"&&navigator.connection,FI=!td&&ww&&(["slow-2g","2g"].includes(ww.effectiveType)||ww.saveData),xw=e=>{if(Qr(e))try{e=e()}catch{e=""}const t=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?ed(e):"",[e,t]};let nre=0;const _w=()=>++nre,BI=0,zI=1,UI=2;var nd={__proto__:null,ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:BI,MUTATE_EVENT:UI,RECONNECT_EVENT:zI};async function VI(...e){const[t,n,r,a]=e,o=Co({populateCache:!0,throwOnError:!0},typeof a=="boolean"?{revalidate:a}:a||{});let i=o.populateCache;const s=o.rollbackOnError;let c=o.optimisticData;const l=p=>typeof s=="function"?s(p):s!==!1,u=o.throwOnError;if(Qr(n)){const p=n,f=[],m=t.keys();for(const y of m)!/^\$(inf|sub)\$/.test(y)&&p(t.get(y)._k)&&f.push(y);return Promise.all(f.map(d))}return d(n);async function d(p){const[f]=xw(p);if(!f)return;const[m,y]=LI(t,f),[v,b,w,j]=No.get(t),x=()=>{const A=v[f];return(Qr(o.revalidate)?o.revalidate(m().data,p):o.revalidate!==!1)&&(delete w[f],delete j[f],A&&A[0])?A[0](UI).then(()=>m().data):m().data};if(e.length<3)return x();let _=r,S;const E=_w();b[f]=[E,0];const O=!ut(c),N=m(),M=N.data,k=N._c,P=ut(k)?M:k;if(O&&(c=Qr(c)?c(P,M):c,y({data:c,_c:P})),Qr(_))try{_=_(P)}catch(A){S=A}if(_&&DI(_))if(_=await _.catch(A=>{S=A}),E!==b[f][0]){if(S)throw S;return _}else S&&O&&l(S)&&(i=!0,y({data:P,_c:Hn}));if(i&&!S)if(Qr(i)){const A=i(_,P);y({data:A,error:Hn,_c:Hn})}else y({data:_,error:Hn,_c:Hn});if(b[f][1]=_w(),Promise.resolve(x()).then(()=>{y({_c:Hn})}),S){if(u)throw S;return}return _}}const qI=(e,t)=>{for(const n in e)e[n][0]&&e[n][0](t)},rre=(e,t)=>{if(!No.has(e)){const n=Co(ere,t),r={},a=VI.bind(Hn,e);let o=Oo;const i={},s=(u,d)=>{const p=i[u]||[];return i[u]=p,p.push(d),()=>p.splice(p.indexOf(d),1)},c=(u,d,p)=>{e.set(u,d);const f=i[u];if(f)for(const m of f)m(d,p)},l=()=>{if(!No.has(e)&&(No.set(e,[r,{},{},{},a,c,s]),!td)){const u=n.initFocus(setTimeout.bind(Hn,qI.bind(Hn,r,BI))),d=n.initReconnect(setTimeout.bind(Hn,qI.bind(Hn,r,zI)));o=()=>{u&&u(),d&&d(),No.delete(e)}}};return l(),[e,a,l,o]}return[e,No.get(e)[4]]},are=(e,t,n,r,a)=>{const o=n.errorRetryCount,i=a.retryCount,s=~~((Math.random()+.5)*(1<<(i<8?i:8)))*n.errorRetryInterval;!ut(o)&&i>o||setTimeout(r,s,a)},ore=(e,t)=>ed(e)==ed(t),[WI,ire]=rre(new Map),sre=Co({onLoadingSlow:Oo,onSuccess:Oo,onError:Oo,onErrorRetry:are,onDiscarded:Oo,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:FI?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:FI?5e3:3e3,compare:ore,isPaused:()=>!1,cache:WI,mutate:ire,fallback:{}},Qne),cre=(e,t)=>{const n=Co(e,t);if(t){const{use:r,fallback:a}=e,{use:o,fallback:i}=t;r&&o&&(n.use=r.concat(o)),a&&i&&(n.fallback=Co(a,i))}return n},lre=g.createContext({}),ure="$inf$",HI=Nh&&window.__SWR_DEVTOOLS_USE__,dre=HI?window.__SWR_DEVTOOLS_USE__:[],pre=()=>{HI&&(window.__SWR_DEVTOOLS_REACT__=W)},fre=e=>Qr(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(e[1]===null?e[2]:e[1])||{}],hre=()=>Co(sre,g.useContext(lre)),mre=e=>(t,n,r)=>e(t,n&&((...a)=>{const[o]=xw(t),[,,,i]=No.get(WI);if(o.startsWith(ure))return n(...a);const s=i[o];return ut(s)?n(...a):(delete i[o],s)}),r),yre=dre.concat(mre),gre=e=>function(...t){const n=hre(),[r,a,o]=fre(t),i=cre(n,o);let s=e;const{use:c}=i,l=(c||[]).concat(yre);for(let u=l.length;u--;)s=l[u](s);return s(r,a||i.fetcher||null,i)},vre=(e,t,n)=>{const r=t[e]||(t[e]=[]);return r.push(n),()=>{const a=r.indexOf(n);a>=0&&(r[a]=r[r.length-1],r.pop())}};pre();const KI=W.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e)}),jw={dedupe:!0},bre=(e,t,n)=>{const{cache:r,compare:a,suspense:o,fallbackData:i,revalidateOnMount:s,revalidateIfStale:c,refreshInterval:l,refreshWhenHidden:u,refreshWhenOffline:d,keepPreviousData:p}=n,[f,m,y,v]=No.get(r),[b,w]=xw(e),j=g.useRef(!1),x=g.useRef(!1),_=g.useRef(b),S=g.useRef(t),E=g.useRef(n),O=()=>E.current,N=()=>O().isVisible()&&O().isOnline(),[M,k,P,A]=LI(r,b),C=g.useRef({}).current,I=ut(i)?n.fallback[b]:i,T=(V,le)=>{for(const ae in C){const de=ae;if(de==="data"){if(!a(V[de],le[de])&&(!ut(V[de])||!a(H,le[de])))return!1}else if(le[de]!==V[de])return!1}return!0},R=g.useMemo(()=>{const V=!b||!t?!1:ut(s)?O().isPaused()||o?!1:ut(c)?!0:c:s,le=Se=>{const Ve=Co(Se);return delete Ve._k,V?{isValidating:!0,isLoading:!0,...Ve}:Ve},ae=M(),de=A(),je=le(ae),Le=ae===de?je:le(de);let $e=je;return[()=>{const Se=le(M());return T(Se,$e)?($e.data=Se.data,$e.isLoading=Se.isLoading,$e.isValidating=Se.isValidating,$e.error=Se.error,$e):($e=Se,Se)},()=>Le]},[r,b]),L=xf.useSyncExternalStore(g.useCallback(V=>P(b,(le,ae)=>{T(ae,le)||V()}),[r,b]),R[0],R[1]),D=!j.current,z=f[b]&&f[b].length>0,B=L.data,$=ut(B)?I:B,U=L.error,F=g.useRef($),H=p?ut(B)?F.current:B:$,re=z&&!ut(U)?!1:D&&!ut(s)?s:O().isPaused()?!1:o?ut($)?!1:c:ut($)||c,ee=!!(b&&t&&D&&re),G=ut(L.isValidating)?ee:L.isValidating,K=ut(L.isLoading)?ee:L.isLoading,X=g.useCallback(async V=>{const le=S.current;if(!b||!le||x.current||O().isPaused())return!1;let ae,de,je=!0;const Le=V||{},$e=!y[b]||!Le.dedupe,Se=()=>$I?!x.current&&b===_.current&&j.current:b===_.current,Ve={isValidating:!1,isLoading:!1},He=()=>{k(Ve)},Ke=()=>{const lt=y[b];lt&&lt[1]===de&&delete y[b]},It={isValidating:!0};ut(M().data)&&(It.isLoading=!0);try{if($e&&(k(It),n.loadingTimeout&&ut(M().data)&&setTimeout(()=>{je&&Se()&&O().onLoadingSlow(b,n)},n.loadingTimeout),y[b]=[le(w),_w()]),[ae,de]=y[b],ae=await ae,$e&&setTimeout(Ke,n.dedupingInterval),!y[b]||y[b][1]!==de)return $e&&Se()&&O().onDiscarded(b),!1;Ve.error=Hn;const lt=m[b];if(!ut(lt)&&(de<=lt[0]||de<=lt[1]||lt[1]===0))return He(),$e&&Se()&&O().onDiscarded(b),!1;const ot=M().data;Ve.data=a(ot,ae)?ot:ae,$e&&Se()&&O().onSuccess(ae,b,n)}catch(lt){Ke();const ot=O(),{shouldRetryOnError:_t}=ot;ot.isPaused()||(Ve.error=lt,$e&&Se()&&(ot.onError(lt,b,ot),(_t===!0||Qr(_t)&&_t(lt))&&(!O().revalidateOnFocus||!O().revalidateOnReconnect||N())&&ot.onErrorRetry(lt,b,ot,Qt=>{const ir=f[b];ir&&ir[0]&&ir[0](nd.ERROR_REVALIDATE_EVENT,Qt)},{retryCount:(Le.retryCount||0)+1,dedupe:!0})))}return je=!1,He(),!0},[b,r]),ne=g.useCallback((...V)=>VI(r,_.current,...V),[]);if(bw(()=>{S.current=t,E.current=n,ut(B)||(F.current=B)}),bw(()=>{if(!b)return;const V=X.bind(Hn,jw);let le=0;const ae=vre(b,f,(de,je={})=>{if(de==nd.FOCUS_EVENT){const Le=Date.now();O().revalidateOnFocus&&Le>le&&N()&&(le=Le+O().focusThrottleInterval,V())}else if(de==nd.RECONNECT_EVENT)O().revalidateOnReconnect&&N()&&V();else{if(de==nd.MUTATE_EVENT)return X();if(de==nd.ERROR_REVALIDATE_EVENT)return X(je)}});return x.current=!1,_.current=b,j.current=!0,k({_k:w}),re&&(ut($)||td?V():tre(V)),()=>{x.current=!0,ae()}},[b]),bw(()=>{let V;function le(){const de=Qr(l)?l(M().data):l;de&&V!==-1&&(V=setTimeout(ae,de))}function ae(){!M().error&&(u||O().isVisible())&&(d||O().isOnline())?X(jw).then(le):le()}return le(),()=>{V&&(clearTimeout(V),V=-1)}},[l,u,d,b]),g.useDebugValue(H),o&&ut($)&&b){if(!$I&&td)throw new Error("Fallback data is required when using suspense in SSR.");S.current=t,E.current=n,x.current=!1;const V=v[b];if(!ut(V)){const le=ne(V);KI(le)}if(ut(U)){const le=X(jw);ut(H)||(le.status="fulfilled",le.value=!0),KI(le)}else throw U}return{mutate:ne,get data(){return C.data=!0,H},get error(){return C.error=!0,U},get isValidating(){return C.isValidating=!0,G},get isLoading(){return C.isLoading=!0,K}}},Mh=gre(bre);var Sw,ZI;function wre(){if(ZI)return Sw;ZI=1;function e(t,n){if(typeof t!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof t}\`.`);let r,a=0;return function(...o){clearTimeout(r);const i=Date.now(),s=i-a,c=n-s;c<=0?(a=i,t.apply(this,o)):r=setTimeout(()=>{a=Date.now(),t.apply(this,o)},c)}}return Sw=e,Sw}var xre=wre();const _re=st(xre);function GI(e,t){return t!=null?_re(e,t):e}var jre=async(e,t,n,r,a,o,i,s,c,l,u,d,p,f,m,y,v)=>{var b;const w=i.current;n(t.messages,!1);const j=f?t.messages:t.messages.map(({role:_,content:S,experimental_attachments:E,data:O,annotations:N,toolInvocations:M})=>({role:_,content:S,...E!==void 0&&{experimental_attachments:E},...O!==void 0&&{data:O},...N!==void 0&&{annotations:N},...M!==void 0&&{toolInvocations:M}})),x=a.current;return await Wne({api:e,body:(b=m==null?void 0:m({messages:t.messages,requestData:t.data,requestBody:t.body}))!=null?b:{messages:j,data:t.data,...o.current.body,...t.body},streamProtocol:l,credentials:o.current.credentials,headers:{...o.current.headers,...t.headers},abortController:()=>s.current,restoreMessagesOnFailure(){v||n(w,!1)},onResponse:d,onUpdate(_,S){n([...t.messages,..._],!1),S!=null&&S.length&&r([...x??[],...S],!1)},onToolCall:p,onFinish:u,generateId:c,fetch:y})};function Sre({api:e="/api/chat",id:t,initialMessages:n,initialInput:r="",sendExtraMessageFields:a,onToolCall:o,experimental_prepareRequestBody:i,maxSteps:s=1,streamProtocol:c="data",onResponse:l,onFinish:u,onError:d,credentials:p,headers:f,body:m,generateId:y=kI,fetch:v,keepLastMessageOnError:b=!0,experimental_throttle:w}={}){const j=g.useId(),x=t??j,_=typeof e=="string"?[e,x]:x,[S]=g.useState([]),{data:E,mutate:O}=Mh([_,"messages"],null,{fallbackData:n??S}),N=g.useRef(E||[]);g.useEffect(()=>{N.current=E||[]},[E]);const{data:M,mutate:k}=Mh([_,"streamData"],null),P=g.useRef(M);g.useEffect(()=>{P.current=M},[M]);const{data:A=!1,mutate:C}=Mh([_,"loading"],null),{data:I=void 0,mutate:T}=Mh([_,"error"],null),R=g.useRef(null),L=g.useRef({credentials:p,headers:f,body:m});g.useEffect(()=>{L.current={credentials:p,headers:f,body:m}},[p,f,m]);const D=g.useCallback(async G=>{const K=N.current.length;try{C(!0),T(void 0);const V=new AbortController;R.current=V,await jre(e,G,GI(O,w),GI(k,w),P,L,N,R,y,c,u,l,o,a,i,v,b),R.current=null}catch(V){if(V.name==="AbortError")return R.current=null,null;d&&V instanceof Error&&d(V),T(V)}finally{C(!1)}const X=N.current,ne=X[X.length-1];X.length>K&&ne!=null&&s>1&&XI(ne)&&Ere(X)<s&&await D({messages:X})},[O,C,e,L,l,u,d,T,k,P,c,a,i,o,s,N,R,y,v,b,w]),z=g.useCallback(async(G,{data:K,headers:X,body:ne,experimental_attachments:V}={})=>{var le,ae;G.id||(G.id=y());const de=await JI(V),je=N.current.concat({...G,id:(le=G.id)!=null?le:y(),createdAt:(ae=G.createdAt)!=null?ae:new Date,experimental_attachments:de.length>0?de:void 0});return D({messages:je,headers:X,body:ne,data:K})},[D,y]),B=g.useCallback(async({data:G,headers:K,body:X}={})=>{const ne=N.current;if(ne.length===0)return null;const V=ne[ne.length-1];return D({messages:V.role==="assistant"?ne.slice(0,-1):ne,headers:K,body:X,data:G})},[D]),$=g.useCallback(()=>{R.current&&(R.current.abort(),R.current=null)},[]),U=g.useCallback(G=>{typeof G=="function"&&(G=G(N.current)),O(G,!1),N.current=G},[O]),F=g.useCallback(G=>{typeof G=="function"&&(G=G(P.current)),k(G,!1),P.current=G},[k]),[H,re]=g.useState(r),ee=g.useCallback(async(G,K={},X)=>{var ne;if((ne=G==null?void 0:G.preventDefault)==null||ne.call(G),!H&&!K.allowEmptySubmit)return;X&&(L.current={...L.current,...X});const V=await JI(K.experimental_attachments),le={messages:!H&&!V.length&&K.allowEmptySubmit?N.current:N.current.concat({id:y(),createdAt:new Date,role:"user",content:H,experimental_attachments:V.length>0?V:void 0}),headers:K.headers,body:K.body,data:K.data};D(le),re("")},[H,y,D]);return{messages:E||[],setMessages:U,data:M,setData:F,error:I,append:z,reload:B,stop:$,input:H,setInput:re,handleInputChange:G=>{re(G.target.value)},handleSubmit:ee,isLoading:A,addToolResult:({toolCallId:G,result:K})=>{const X=N.current.map((V,le,ae)=>le===ae.length-1&&V.role==="assistant"&&V.toolInvocations?{...V,toolInvocations:V.toolInvocations.map(de=>de.toolCallId===G?{...de,result:K,state:"result"}:de)}:V);O(X,!1);const ne=X[X.length-1];XI(ne)&&D({messages:X})}}}function XI(e){return e.role==="assistant"&&e.toolInvocations&&e.toolInvocations.length>0&&e.toolInvocations.every(t=>"result"in t)}function Ere(e){let t=0;for(let n=e.length-1;n>=0&&e[n].role==="assistant";n--)t++;return t}async function JI(e){if(e==null)return[];if(e instanceof FileList)return Promise.all(Array.from(e).map(async t=>{const{name:n,type:r}=t,a=await new Promise((o,i)=>{const s=new FileReader;s.onload=c=>{var l;o((l=c.target)==null?void 0:l.result)},s.onerror=c=>i(c),s.readAsDataURL(t)});return{name:n,contentType:r,url:a}}));if(Array.isArray(e))return e;throw new Error("Invalid attachments type")}dk=Sre;const Mo=g.forwardRef(({className:e,...t},n)=>h.jsx("textarea",{className:Z("flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));Mo.displayName="Textarea";function Ore({minHeight:e,maxHeight:t}){const n=g.useRef(null),r=g.useCallback(a=>{const o=n.current;if(!o)return;if(a){o.style.height=`${e}px`;return}o.style.height=`${e}px`;const i=Math.max(e,Math.min(o.scrollHeight,t??Number.POSITIVE_INFINITY));o.style.height=`${i}px`},[e,t]);return g.useEffect(()=>{const a=n.current;a&&(a.style.height=`${e}px`)},[e]),g.useEffect(()=>{const a=()=>r();return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[r]),{textareaRef:n,adjustHeight:r}}const Cre=48,YI=164;w0=function({onSubmit:e,disabled:t,enableTool:n,enableFile:r,placeholder:a,minHeight:o,maxHeight:i,className:s,height:c,onChange:l,value:u}){const[d,p]=g.useState(!1),[f,m]=g.useState(""),{textareaRef:y,adjustHeight:v}=Ore({minHeight:o||Cre,maxHeight:i||YI}),[b,w]=g.useState(!0),j=g.useCallback(async _=>{try{p(!0),await e(f,_)&&m("")}finally{p(!1)}},[f,e]),x=g.useMemo(()=>({maxHeight:`${i||YI}px`,...c?{height:`${c}px`}:{}}),[i,c]);return h.jsx("div",{className:Z("w-full py-4 max-w-xl",s),children:h.jsx("div",{className:"relative w-full mx-auto",children:h.jsxs("div",{className:"relative flex flex-col",children:[h.jsx("div",{className:"overflow-y-auto",style:x,children:h.jsx(Mo,{id:"ai-input-04",value:(l?u:f)||"",disabled:t||d,placeholder:a,className:"w-full rounded-xl rounded-b-none px-4 py-3 bg-black/5 dark:bg-white/5 border-none dark:text-white placeholder:text-black/70 dark:placeholder:text-white/70 resize-none focus-visible:ring-0 leading-[1.2]",ref:y,onKeyDown:_=>{_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),j(_))},onChange:_=>{l||m(_.target.value),v(),l==null||l(_)}})}),h.jsxs("div",{className:"h-12 bg-black/5 dark:bg-white/5 rounded-b-xl",children:[h.jsxs("div",{className:"absolute left-3 bottom-3 flex items-center gap-2",children:[r?h.jsxs("label",{className:"cursor-pointer rounded-lg p-2 bg-black/5 dark:bg-white/5",children:[h.jsx("input",{type:"file",className:"hidden"}),h.jsx(pe,{name:"paperclip",className:"w-4 h-4 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors"})]}):void 0,n?h.jsxs("button",{type:"button",onClick:()=>{w(!b)},className:Z("rounded-full transition-all flex items-center gap-2 px-1.5 py-1 border h-8",b?"bg-sky-500/15 border-sky-400 text-sky-500":"bg-black/5 dark:bg-white/5 border-transparent text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:[h.jsx("div",{className:"w-4 h-4 flex items-center justify-center flex-shrink-0",children:h.jsx(hf.div,{animate:{rotate:b?180:0,scale:b?1.1:1},whileHover:{rotate:b?180:15,scale:1.1,transition:{type:"spring",stiffness:300,damping:10}},transition:{type:"spring",stiffness:260,damping:25},children:h.jsx(pe,{name:"globe",className:Z("w-4 h-4",b?"text-sky-500":"text-inherit")})})}),h.jsx(pX,{children:b&&h.jsx(hf.span,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"text-sm overflow-hidden whitespace-nowrap text-sky-500 flex-shrink-0",children:"Search"})})]}):void 0]}),h.jsx("div",{className:"absolute right-3 bottom-3",children:h.jsx("button",{type:"button",disabled:t||d,onClick:_=>{j(_)},className:Z("rounded-lg p-2",l&&u||f?"bg-sky-500/15 text-sky-500":"bg-black/5 dark:bg-white/5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:h.jsx(pe,{name:"send",className:"w-4 h-4"})})})]})]})})})};var Ew,QI;function Nre(){if(QI)return Ew;QI=1;function e(){this.__data__=[],this.size=0}return Ew=e,Ew}var Ow,eR;su=function(){if(eR)return Ow;eR=1;function e(t,n){return t===n||t!==t&&n!==n}return Ow=e,Ow};var Cw,tR;function kh(){if(tR)return Cw;tR=1;var e=su();function t(n,r){for(var a=n.length;a--;)if(e(n[a][0],r))return a;return-1}return Cw=t,Cw}var Nw,nR;function Mre(){if(nR)return Nw;nR=1;var e=kh(),t=Array.prototype,n=t.splice;function r(a){var o=this.__data__,i=e(o,a);if(i<0)return!1;var s=o.length-1;return i==s?o.pop():n.call(o,i,1),--this.size,!0}return Nw=r,Nw}var Mw,rR;function kre(){if(rR)return Mw;rR=1;var e=kh();function t(n){var r=this.__data__,a=e(r,n);return a<0?void 0:r[a][1]}return Mw=t,Mw}var kw,aR;function Pre(){if(aR)return kw;aR=1;var e=kh();function t(n){return e(this.__data__,n)>-1}return kw=t,kw}var Pw,oR;function Are(){if(oR)return Pw;oR=1;var e=kh();function t(n,r){var a=this.__data__,o=e(a,n);return o<0?(++this.size,a.push([n,r])):a[o][1]=r,this}return Pw=t,Pw}var Aw,iR;function Ph(){if(iR)return Aw;iR=1;var e=Nre(),t=Mre(),n=kre(),r=Pre(),a=Are();function o(i){var s=-1,c=i==null?0:i.length;for(this.clear();++s<c;){var l=i[s];this.set(l[0],l[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=n,o.prototype.has=r,o.prototype.set=a,Aw=o,Aw}var Tw,sR;function Tre(){if(sR)return Tw;sR=1;var e=Ph();function t(){this.__data__=new e,this.size=0}return Tw=t,Tw}var Iw,cR;function Ire(){if(cR)return Iw;cR=1;function e(t){var n=this.__data__,r=n.delete(t);return this.size=n.size,r}return Iw=e,Iw}var Rw,lR;function Rre(){if(lR)return Rw;lR=1;function e(t){return this.__data__.get(t)}return Rw=e,Rw}var Dw,uR;function Dre(){if(uR)return Dw;uR=1;function e(t){return this.__data__.has(t)}return Dw=e,Dw}var Lw,dR;function pR(){if(dR)return Lw;dR=1;var e=typeof tu=="object"&&tu&&tu.Object===Object&&tu;return Lw=e,Lw}var $w,fR;qr=function(){if(fR)return $w;fR=1;var e=pR(),t=typeof self=="object"&&self&&self.Object===Object&&self,n=e||t||Function("return this")();return $w=n,$w};var Fw,hR;Js=function(){if(hR)return Fw;hR=1;var e=qr(),t=e.Symbol;return Fw=t,Fw};var Bw,mR;function Lre(){if(mR)return Bw;mR=1;var e=Js(),t=Object.prototype,n=t.hasOwnProperty,r=t.toString,a=e?e.toStringTag:void 0;function o(i){var s=n.call(i,a),c=i[a];try{i[a]=void 0;var l=!0}catch{}var u=r.call(i);return l&&(s?i[a]=c:delete i[a]),u}return Bw=o,Bw}var zw,yR;function $re(){if(yR)return zw;yR=1;var e=Object.prototype,t=e.toString;function n(r){return t.call(r)}return zw=n,zw}var Uw,gR;function ko(){if(gR)return Uw;gR=1;var e=Js(),t=Lre(),n=$re(),r="[object Null]",a="[object Undefined]",o=e?e.toStringTag:void 0;function i(s){return s==null?s===void 0?a:r:o&&o in Object(s)?t(s):n(s)}return Uw=i,Uw}var Vw,vR;Wr=function(){if(vR)return Vw;vR=1;function e(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}return Vw=e,Vw};var qw,bR;wf=function(){if(bR)return qw;bR=1;var e=ko(),t=Wr(),n="[object AsyncFunction]",r="[object Function]",a="[object GeneratorFunction]",o="[object Proxy]";function i(s){if(!t(s))return!1;var c=e(s);return c==r||c==a||c==n||c==o}return qw=i,qw};var Ww,wR;function Fre(){if(wR)return Ww;wR=1;var e=qr(),t=e["__core-js_shared__"];return Ww=t,Ww}var Hw,xR;function Bre(){if(xR)return Hw;xR=1;var e=Fre(),t=function(){var r=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!t&&t in r}return Hw=n,Hw}var Kw,_R;function jR(){if(_R)return Kw;_R=1;var e=Function.prototype,t=e.toString;function n(r){if(r!=null){try{return t.call(r)}catch{}try{return r+""}catch{}}return""}return Kw=n,Kw}var Zw,SR;function zre(){if(SR)return Zw;SR=1;var e=wf(),t=Bre(),n=Wr(),r=jR(),a=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,i=Function.prototype,s=Object.prototype,c=i.toString,l=s.hasOwnProperty,u=RegExp("^"+c.call(l).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function d(p){if(!n(p)||t(p))return!1;var f=e(p)?u:o;return f.test(r(p))}return Zw=d,Zw}var Gw,ER;function Ure(){if(ER)return Gw;ER=1;function e(t,n){return t==null?void 0:t[n]}return Gw=e,Gw}var Xw,OR;function is(){if(OR)return Xw;OR=1;var e=zre(),t=Ure();function n(r,a){var o=t(r,a);return e(o)?o:void 0}return Xw=n,Xw}var Jw,CR;function Yw(){if(CR)return Jw;CR=1;var e=is(),t=qr(),n=e(t,"Map");return Jw=n,Jw}var Qw,NR;function Ah(){if(NR)return Qw;NR=1;var e=is(),t=e(Object,"create");return Qw=t,Qw}var ex,MR;function Vre(){if(MR)return ex;MR=1;var e=Ah();function t(){this.__data__=e?e(null):{},this.size=0}return ex=t,ex}var tx,kR;function qre(){if(kR)return tx;kR=1;function e(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n}return tx=e,tx}var nx,PR;function Wre(){if(PR)return nx;PR=1;var e=Ah(),t="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function a(o){var i=this.__data__;if(e){var s=i[o];return s===t?void 0:s}return r.call(i,o)?i[o]:void 0}return nx=a,nx}var rx,AR;function Hre(){if(AR)return rx;AR=1;var e=Ah(),t=Object.prototype,n=t.hasOwnProperty;function r(a){var o=this.__data__;return e?o[a]!==void 0:n.call(o,a)}return rx=r,rx}var ax,TR;function Kre(){if(TR)return ax;TR=1;var e=Ah(),t="__lodash_hash_undefined__";function n(r,a){var o=this.__data__;return this.size+=this.has(r)?0:1,o[r]=e&&a===void 0?t:a,this}return ax=n,ax}var ox,IR;function Zre(){if(IR)return ox;IR=1;var e=Vre(),t=qre(),n=Wre(),r=Hre(),a=Kre();function o(i){var s=-1,c=i==null?0:i.length;for(this.clear();++s<c;){var l=i[s];this.set(l[0],l[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=n,o.prototype.has=r,o.prototype.set=a,ox=o,ox}var ix,RR;function Gre(){if(RR)return ix;RR=1;var e=Zre(),t=Ph(),n=Yw();function r(){this.size=0,this.__data__={hash:new e,map:new(n||t),string:new e}}return ix=r,ix}var sx,DR;function Xre(){if(DR)return sx;DR=1;function e(t){var n=typeof t;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null}return sx=e,sx}var cx,LR;function Th(){if(LR)return cx;LR=1;var e=Xre();function t(n,r){var a=n.__data__;return e(r)?a[typeof r=="string"?"string":"hash"]:a.map}return cx=t,cx}var lx,$R;function Jre(){if($R)return lx;$R=1;var e=Th();function t(n){var r=e(this,n).delete(n);return this.size-=r?1:0,r}return lx=t,lx}var ux,FR;function Yre(){if(FR)return ux;FR=1;var e=Th();function t(n){return e(this,n).get(n)}return ux=t,ux}var dx,BR;function Qre(){if(BR)return dx;BR=1;var e=Th();function t(n){return e(this,n).has(n)}return dx=t,dx}var px,zR;function eae(){if(zR)return px;zR=1;var e=Th();function t(n,r){var a=e(this,n),o=a.size;return a.set(n,r),this.size+=a.size==o?0:1,this}return px=t,px}var fx,UR;function hx(){if(UR)return fx;UR=1;var e=Gre(),t=Jre(),n=Yre(),r=Qre(),a=eae();function o(i){var s=-1,c=i==null?0:i.length;for(this.clear();++s<c;){var l=i[s];this.set(l[0],l[1])}}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=n,o.prototype.has=r,o.prototype.set=a,fx=o,fx}var mx,VR;function tae(){if(VR)return mx;VR=1;var e=Ph(),t=Yw(),n=hx(),r=200;function a(o,i){var s=this.__data__;if(s instanceof e){var c=s.__data__;if(!t||c.length<r-1)return c.push([o,i]),this.size=++s.size,this;s=this.__data__=new n(c)}return s.set(o,i),this.size=s.size,this}return mx=a,mx}var yx,qR;P0=function(){if(qR)return yx;qR=1;var e=Ph(),t=Tre(),n=Ire(),r=Rre(),a=Dre(),o=tae();function i(s){var c=this.__data__=new e(s);this.size=c.size}return i.prototype.clear=t,i.prototype.delete=n,i.prototype.get=r,i.prototype.has=a,i.prototype.set=o,yx=i,yx};var gx,WR;function nae(){if(WR)return gx;WR=1;var e="__lodash_hash_undefined__";function t(n){return this.__data__.set(n,e),this}return gx=t,gx}var vx,HR;function rae(){if(HR)return vx;HR=1;function e(t){return this.__data__.has(t)}return vx=e,vx}var bx,KR;function ZR(){if(KR)return bx;KR=1;var e=hx(),t=nae(),n=rae();function r(a){var o=-1,i=a==null?0:a.length;for(this.__data__=new e;++o<i;)this.add(a[o])}return r.prototype.add=r.prototype.push=t,r.prototype.has=n,bx=r,bx}var wx,GR;function XR(){if(GR)return wx;GR=1;function e(t,n){for(var r=-1,a=t==null?0:t.length;++r<a;)if(n(t[r],r,t))return!0;return!1}return wx=e,wx}var xx,JR;function YR(){if(JR)return xx;JR=1;function e(t,n){return t.has(n)}return xx=e,xx}var _x,QR;function eD(){if(QR)return _x;QR=1;var e=ZR(),t=XR(),n=YR(),r=1,a=2;function o(i,s,c,l,u,d){var p=c&r,f=i.length,m=s.length;if(f!=m&&!(p&&m>f))return!1;var y=d.get(i),v=d.get(s);if(y&&v)return y==s&&v==i;var b=-1,w=!0,j=c&a?new e:void 0;for(d.set(i,s),d.set(s,i);++b<f;){var x=i[b],_=s[b];if(l)var S=p?l(_,x,b,s,i,d):l(x,_,b,i,s,d);if(S!==void 0){if(S)continue;w=!1;break}if(j){if(!t(s,function(E,O){if(!n(j,O)&&(x===E||u(x,E,c,l,d)))return j.push(O)})){w=!1;break}}else if(!(x===_||u(x,_,c,l,d))){w=!1;break}}return d.delete(i),d.delete(s),w}return _x=o,_x}var jx,tD;Tk=function(){if(tD)return jx;tD=1;var e=qr(),t=e.Uint8Array;return jx=t,jx};var Sx,nD;function aae(){if(nD)return Sx;nD=1;function e(t){var n=-1,r=Array(t.size);return t.forEach(function(a,o){r[++n]=[o,a]}),r}return Sx=e,Sx}var Ex,rD;function Ox(){if(rD)return Ex;rD=1;function e(t){var n=-1,r=Array(t.size);return t.forEach(function(a){r[++n]=a}),r}return Ex=e,Ex}var Cx,aD;function oae(){if(aD)return Cx;aD=1;var e=Js(),t=Tk(),n=su(),r=eD(),a=aae(),o=Ox(),i=1,s=2,c="[object Boolean]",l="[object Date]",u="[object Error]",d="[object Map]",p="[object Number]",f="[object RegExp]",m="[object Set]",y="[object String]",v="[object Symbol]",b="[object ArrayBuffer]",w="[object DataView]",j=e?e.prototype:void 0,x=j?j.valueOf:void 0;function _(S,E,O,N,M,k,P){switch(O){case w:if(S.byteLength!=E.byteLength||S.byteOffset!=E.byteOffset)return!1;S=S.buffer,E=E.buffer;case b:return!(S.byteLength!=E.byteLength||!k(new t(S),new t(E)));case c:case l:case p:return n(+S,+E);case u:return S.name==E.name&&S.message==E.message;case f:case y:return S==E+"";case d:var A=a;case m:var C=N&i;if(A||(A=o),S.size!=E.size&&!C)return!1;var I=P.get(S);if(I)return I==E;N|=s,P.set(S,E);var T=r(A(S),A(E),N,M,k,P);return P.delete(S),T;case v:if(x)return x.call(S)==x.call(E)}return!1}return Cx=_,Cx}var Nx,oD;function Mx(){if(oD)return Nx;oD=1;function e(t,n){for(var r=-1,a=n.length,o=t.length;++r<a;)t[o+r]=n[r];return t}return Nx=e,Nx}var kx,iD;Wn=function(){if(iD)return kx;iD=1;var e=Array.isArray;return kx=e,kx};var Px,sD;function cD(){if(sD)return Px;sD=1;var e=Mx(),t=Wn();function n(r,a,o){var i=a(r);return t(r)?i:e(i,o(r))}return Px=n,Px}var Ax,lD;function iae(){if(lD)return Ax;lD=1;function e(t,n){for(var r=-1,a=t==null?0:t.length,o=0,i=[];++r<a;){var s=t[r];n(s,r,t)&&(i[o++]=s)}return i}return Ax=e,Ax}var Tx,uD;function dD(){if(uD)return Tx;uD=1;function e(){return[]}return Tx=e,Tx}var Ix,pD;C0=function(){if(pD)return Ix;pD=1;var e=iae(),t=dD(),n=Object.prototype,r=n.propertyIsEnumerable,a=Object.getOwnPropertySymbols,o=a?function(i){return i==null?[]:(i=Object(i),e(a(i),function(s){return r.call(i,s)}))}:t;return Ix=o,Ix};var Rx,fD;function sae(){if(fD)return Rx;fD=1;function e(t,n){for(var r=-1,a=Array(t);++r<t;)a[r]=n(r);return a}return Rx=e,Rx}var Dx,hD;Ta=function(){if(hD)return Dx;hD=1;function e(t){return t!=null&&typeof t=="object"}return Dx=e,Dx};var Lx,mD;function cae(){if(mD)return Lx;mD=1;var e=ko(),t=Ta(),n="[object Arguments]";function r(a){return t(a)&&e(a)==n}return Lx=r,Lx}var $x,yD;bf=function(){if(yD)return $x;yD=1;var e=cae(),t=Ta(),n=Object.prototype,r=n.hasOwnProperty,a=n.propertyIsEnumerable,o=e(function(){return arguments}())?e:function(i){return t(i)&&r.call(i,"callee")&&!a.call(i,"callee")};return $x=o,$x};var Ih={exports:{}},Fx,gD;function lae(){if(gD)return Fx;gD=1;function e(){return!1}return Fx=e,Fx}Ih.exports;var vD;A0=function(){return vD||(vD=1,function(e,t){var n=qr(),r=lae(),a=t&&!t.nodeType&&t,o=a&&!0&&e&&!e.nodeType&&e,i=o&&o.exports===a,s=i?n.Buffer:void 0,c=s?s.isBuffer:void 0,l=c||r;e.exports=l}(Ih,Ih.exports)),Ih.exports};var Bx,bD;function Rh(){if(bD)return Bx;bD=1;var e=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function n(r,a){var o=typeof r;return a=a??e,!!a&&(o=="number"||o!="symbol"&&t.test(r))&&r>-1&&r%1==0&&r<a}return Bx=n,Bx}var zx,wD;function Ux(){if(wD)return zx;wD=1;var e=9007199254740991;function t(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=e}return zx=t,zx}var Vx,xD;function uae(){if(xD)return Vx;xD=1;var e=ko(),t=Ux(),n=Ta(),r="[object Arguments]",a="[object Array]",o="[object Boolean]",i="[object Date]",s="[object Error]",c="[object Function]",l="[object Map]",u="[object Number]",d="[object Object]",p="[object RegExp]",f="[object Set]",m="[object String]",y="[object WeakMap]",v="[object ArrayBuffer]",b="[object DataView]",w="[object Float32Array]",j="[object Float64Array]",x="[object Int8Array]",_="[object Int16Array]",S="[object Int32Array]",E="[object Uint8Array]",O="[object Uint8ClampedArray]",N="[object Uint16Array]",M="[object Uint32Array]",k={};k[w]=k[j]=k[x]=k[_]=k[S]=k[E]=k[O]=k[N]=k[M]=!0,k[r]=k[a]=k[v]=k[o]=k[b]=k[i]=k[s]=k[c]=k[l]=k[u]=k[d]=k[p]=k[f]=k[m]=k[y]=!1;function P(A){return n(A)&&t(A.length)&&!!k[e(A)]}return Vx=P,Vx}var qx,_D;k0=function(){if(_D)return qx;_D=1;function e(t){return function(n){return t(n)}}return qx=e,qx};var Dh={exports:{}};Dh.exports;var jD;Rk=function(){return jD||(jD=1,function(e,t){var n=pR(),r=t&&!t.nodeType&&t,a=r&&!0&&e&&!e.nodeType&&e,o=a&&a.exports===r,i=o&&n.process,s=function(){try{var c=a&&a.require&&a.require("util").types;return c||i&&i.binding&&i.binding("util")}catch{}}();e.exports=s}(Dh,Dh.exports)),Dh.exports};var Wx,SD;Iv=function(){if(SD)return Wx;SD=1;var e=uae(),t=k0(),n=Rk(),r=n&&n.isTypedArray,a=r?t(r):e;return Wx=a,Wx};var Hx,ED;function OD(){if(ED)return Hx;ED=1;var e=sae(),t=bf(),n=Wn(),r=A0(),a=Rh(),o=Iv(),i=Object.prototype,s=i.hasOwnProperty;function c(l,u){var d=n(l),p=!d&&t(l),f=!d&&!p&&r(l),m=!d&&!p&&!f&&o(l),y=d||p||f||m,v=y?e(l.length,String):[],b=v.length;for(var w in l)(u||s.call(l,w))&&!(y&&(w=="length"||f&&(w=="offset"||w=="parent")||m&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||a(w,b)))&&v.push(w);return v}return Hx=c,Hx}var Kx,CD;M0=function(){if(CD)return Kx;CD=1;var e=Object.prototype;function t(n){var r=n&&n.constructor,a=typeof r=="function"&&r.prototype||e;return n===a}return Kx=t,Kx};var Zx,ND;function MD(){if(ND)return Zx;ND=1;function e(t,n){return function(r){return t(n(r))}}return Zx=e,Zx}var Gx,kD;function dae(){if(kD)return Gx;kD=1;var e=MD(),t=e(Object.keys,Object);return Gx=t,Gx}var Xx,PD;function pae(){if(PD)return Xx;PD=1;var e=M0(),t=dae(),n=Object.prototype,r=n.hasOwnProperty;function a(o){if(!e(o))return t(o);var i=[];for(var s in Object(o))r.call(o,s)&&s!="constructor"&&i.push(s);return i}return Xx=a,Xx}var Jx,AD;Ki=function(){if(AD)return Jx;AD=1;var e=wf(),t=Ux();function n(r){return r!=null&&t(r.length)&&!e(r)}return Jx=n,Jx};var Yx,TD;pu=function(){if(TD)return Yx;TD=1;var e=OD(),t=pae(),n=Ki();function r(a){return n(a)?e(a):t(a)}return Yx=r,Yx};var Qx,ID;Dk=function(){if(ID)return Qx;ID=1;var e=cD(),t=C0(),n=pu();function r(a){return e(a,n,t)}return Qx=r,Qx};var e1,RD;function fae(){if(RD)return e1;RD=1;var e=Dk(),t=1,n=Object.prototype,r=n.hasOwnProperty;function a(o,i,s,c,l,u){var d=s&t,p=e(o),f=p.length,m=e(i),y=m.length;if(f!=y&&!d)return!1;for(var v=f;v--;){var b=p[v];if(!(d?b in i:r.call(i,b)))return!1}var w=u.get(o),j=u.get(i);if(w&&j)return w==i&&j==o;var x=!0;u.set(o,i),u.set(i,o);for(var _=d;++v<f;){b=p[v];var S=o[b],E=i[b];if(c)var O=d?c(E,S,b,i,o,u):c(S,E,b,o,i,u);if(!(O===void 0?S===E||l(S,E,s,c,u):O)){x=!1;break}_||(_=b=="constructor")}if(x&&!_){var N=o.constructor,M=i.constructor;N!=M&&"constructor"in o&&"constructor"in i&&!(typeof N=="function"&&N instanceof N&&typeof M=="function"&&M instanceof M)&&(x=!1)}return u.delete(o),u.delete(i),x}return e1=a,e1}var t1,DD;function hae(){if(DD)return t1;DD=1;var e=is(),t=qr(),n=e(t,"DataView");return t1=n,t1}var n1,LD;function mae(){if(LD)return n1;LD=1;var e=is(),t=qr(),n=e(t,"Promise");return n1=n,n1}var r1,$D;function FD(){if($D)return r1;$D=1;var e=is(),t=qr(),n=e(t,"Set");return r1=n,r1}var a1,BD;function yae(){if(BD)return a1;BD=1;var e=is(),t=qr(),n=e(t,"WeakMap");return a1=n,a1}var o1,zD;Ik=function(){if(zD)return o1;zD=1;var e=hae(),t=Yw(),n=mae(),r=FD(),a=yae(),o=ko(),i=jR(),s="[object Map]",c="[object Object]",l="[object Promise]",u="[object Set]",d="[object WeakMap]",p="[object DataView]",f=i(e),m=i(t),y=i(n),v=i(r),b=i(a),w=o;return(e&&w(new e(new ArrayBuffer(1)))!=p||t&&w(new t)!=s||n&&w(n.resolve())!=l||r&&w(new r)!=u||a&&w(new a)!=d)&&(w=function(j){var x=o(j),_=x==c?j.constructor:void 0,S=_?i(_):"";if(S)switch(S){case f:return p;case m:return s;case y:return l;case v:return u;case b:return d}return x}),o1=w,o1};var i1,UD;function gae(){if(UD)return i1;UD=1;var e=P0(),t=eD(),n=oae(),r=fae(),a=Ik(),o=Wn(),i=A0(),s=Iv(),c=1,l="[object Arguments]",u="[object Array]",d="[object Object]",p=Object.prototype,f=p.hasOwnProperty;function m(y,v,b,w,j,x){var _=o(y),S=o(v),E=_?u:a(y),O=S?u:a(v);E=E==l?d:E,O=O==l?d:O;var N=E==d,M=O==d,k=E==O;if(k&&i(y)){if(!i(v))return!1;_=!0,N=!1}if(k&&!N)return x||(x=new e),_||s(y)?t(y,v,b,w,j,x):n(y,v,E,b,w,j,x);if(!(b&c)){var P=N&&f.call(y,"__wrapped__"),A=M&&f.call(v,"__wrapped__");if(P||A){var C=P?y.value():y,I=A?v.value():v;return x||(x=new e),j(C,I,b,w,x)}}return k?(x||(x=new e),r(y,v,b,w,j,x)):!1}return i1=m,i1}var s1,VD;function c1(){if(VD)return s1;VD=1;var e=gae(),t=Ta();function n(r,a,o,i,s){return r===a?!0:r==null||a==null||!t(r)&&!t(a)?r!==r&&a!==a:e(r,a,o,i,n,s)}return s1=n,s1}var l1,qD;function vae(){if(qD)return l1;qD=1;var e=P0(),t=c1(),n=1,r=2;function a(o,i,s,c){var l=s.length,u=l,d=!c;if(o==null)return!u;for(o=Object(o);l--;){var p=s[l];if(d&&p[2]?p[1]!==o[p[0]]:!(p[0]in o))return!1}for(;++l<u;){p=s[l];var f=p[0],m=o[f],y=p[1];if(d&&p[2]){if(m===void 0&&!(f in o))return!1}else{var v=new e;if(c)var b=c(m,y,f,o,i,v);if(!(b===void 0?t(y,m,n|r,c,v):b))return!1}}return!0}return l1=a,l1}var u1,WD;function HD(){if(WD)return u1;WD=1;var e=Wr();function t(n){return n===n&&!e(n)}return u1=t,u1}var d1,KD;function bae(){if(KD)return d1;KD=1;var e=HD(),t=pu();function n(r){for(var a=t(r),o=a.length;o--;){var i=a[o],s=r[i];a[o]=[i,s,e(s)]}return a}return d1=n,d1}var p1,ZD;function GD(){if(ZD)return p1;ZD=1;function e(t,n){return function(r){return r==null?!1:r[t]===n&&(n!==void 0||t in Object(r))}}return p1=e,p1}var f1,XD;function wae(){if(XD)return f1;XD=1;var e=vae(),t=bae(),n=GD();function r(a){var o=t(a);return o.length==1&&o[0][2]?n(o[0][0],o[0][1]):function(i){return i===a||e(i,a,o)}}return f1=r,f1}var h1,JD;function gc(){if(JD)return h1;JD=1;var e=ko(),t=Ta(),n="[object Symbol]";function r(a){return typeof a=="symbol"||t(a)&&e(a)==n}return h1=r,h1}var m1,YD;function y1(){if(YD)return m1;YD=1;var e=Wn(),t=gc(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function a(o,i){if(e(o))return!1;var s=typeof o;return s=="number"||s=="symbol"||s=="boolean"||o==null||t(o)?!0:r.test(o)||!n.test(o)||i!=null&&o in Object(i)}return m1=a,m1}var g1,QD;function e3(){if(QD)return g1;QD=1;var e=hx(),t="Expected a function";function n(r,a){if(typeof r!="function"||a!=null&&typeof a!="function")throw new TypeError(t);var o=function(){var i=arguments,s=a?a.apply(this,i):i[0],c=o.cache;if(c.has(s))return c.get(s);var l=r.apply(this,i);return o.cache=c.set(s,l)||c,l};return o.cache=new(n.Cache||e),o}return n.Cache=e,g1=n,g1}var v1,t3;function xae(){if(t3)return v1;t3=1;var e=e3(),t=500;function n(r){var a=e(r,function(i){return o.size===t&&o.clear(),i}),o=a.cache;return a}return v1=n,v1}var b1,n3;function _ae(){if(n3)return b1;n3=1;var e=xae(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=e(function(a){var o=[];return a.charCodeAt(0)===46&&o.push(""),a.replace(t,function(i,s,c,l){o.push(c?l.replace(n,"$1"):s||i)}),o});return b1=r,b1}var w1,r3;iu=function(){if(r3)return w1;r3=1;function e(t,n){for(var r=-1,a=t==null?0:t.length,o=Array(a);++r<a;)o[r]=n(t[r],r,t);return o}return w1=e,w1};var x1,a3;function jae(){if(a3)return x1;a3=1;var e=Js(),t=iu(),n=Wn(),r=gc(),a=1/0,o=e?e.prototype:void 0,i=o?o.toString:void 0;function s(c){if(typeof c=="string")return c;if(n(c))return t(c,s)+"";if(r(c))return i?i.call(c):"";var l=c+"";return l=="0"&&1/c==-a?"-0":l}return x1=s,x1}var _1,o3;function i3(){if(o3)return _1;o3=1;var e=jae();function t(n){return n==null?"":e(n)}return _1=t,_1}var j1,s3;gu=function(){if(s3)return j1;s3=1;var e=Wn(),t=y1(),n=_ae(),r=i3();function a(o,i){return e(o)?o:t(o,i)?[o]:n(r(o))}return j1=a,j1};var S1,c3;Ys=function(){if(c3)return S1;c3=1;var e=gc(),t=1/0;function n(r){if(typeof r=="string"||e(r))return r;var a=r+"";return a=="0"&&1/r==-t?"-0":a}return S1=n,S1};var E1,l3;yu=function(){if(l3)return E1;l3=1;var e=gu(),t=Ys();function n(r,a){a=e(a,r);for(var o=0,i=a.length;r!=null&&o<i;)r=r[t(a[o++])];return o&&o==i?r:void 0}return E1=n,E1};var O1,u3;function d3(){if(u3)return O1;u3=1;var e=yu();function t(n,r,a){var o=n==null?void 0:e(n,r);return o===void 0?a:o}return O1=t,O1}var C1,p3;function Sae(){if(p3)return C1;p3=1;function e(t,n){return t!=null&&n in Object(t)}return C1=e,C1}var N1,f3;function Eae(){if(f3)return N1;f3=1;var e=gu(),t=bf(),n=Wn(),r=Rh(),a=Ux(),o=Ys();function i(s,c,l){c=e(c,s);for(var u=-1,d=c.length,p=!1;++u<d;){var f=o(c[u]);if(!(p=s!=null&&l(s,f)))break;s=s[f]}return p||++u!=d?p:(d=s==null?0:s.length,!!d&&a(d)&&r(f,d)&&(n(s)||t(s)))}return N1=i,N1}var M1,h3;rk=function(){if(h3)return M1;h3=1;var e=Sae(),t=Eae();function n(r,a){return r!=null&&t(r,a,e)}return M1=n,M1};var k1,m3;function Oae(){if(m3)return k1;m3=1;var e=c1(),t=d3(),n=rk(),r=y1(),a=HD(),o=GD(),i=Ys(),s=1,c=2;function l(u,d){return r(u)&&a(d)?o(i(u),d):function(p){var f=t(p,u);return f===void 0&&f===d?n(p,u):e(d,f,s|c)}}return k1=l,k1}var P1,y3;function vc(){if(y3)return P1;y3=1;function e(t){return t}return P1=e,P1}var A1,g3;function Cae(){if(g3)return A1;g3=1;function e(t){return function(n){return n==null?void 0:n[t]}}return A1=e,A1}var T1,v3;function Nae(){if(v3)return T1;v3=1;var e=yu();function t(n){return function(r){return e(r,n)}}return T1=t,T1}var I1,b3;function Mae(){if(b3)return I1;b3=1;var e=Cae(),t=Nae(),n=y1(),r=Ys();function a(o){return n(o)?e(r(o)):t(o)}return I1=a,I1}var R1,w3;function za(){if(w3)return R1;w3=1;var e=wae(),t=Oae(),n=vc(),r=Wn(),a=Mae();function o(i){return typeof i=="function"?i:i==null?n:typeof i=="object"?r(i)?t(i[0],i[1]):e(i):a(i)}return R1=o,R1}var D1,x3;function kae(){if(x3)return D1;x3=1;var e="Expected a function";function t(n){if(typeof n!="function")throw new TypeError(e);return function(){var r=arguments;switch(r.length){case 0:return!n.call(this);case 1:return!n.call(this,r[0]);case 2:return!n.call(this,r[0],r[1]);case 3:return!n.call(this,r[0],r[1],r[2])}return!n.apply(this,r)}}return D1=t,D1}var L1,_3;function j3(){if(_3)return L1;_3=1;var e=is(),t=function(){try{var n=e(Object,"defineProperty");return n({},"",{}),n}catch{}}();return L1=t,L1}var $1,S3;Lv=function(){if(S3)return $1;S3=1;var e=j3();function t(n,r,a){r=="__proto__"&&e?e(n,r,{configurable:!0,enumerable:!0,value:a,writable:!0}):n[r]=a}return $1=t,$1};var F1,E3;Lk=function(){if(E3)return F1;E3=1;var e=Lv(),t=su(),n=Object.prototype,r=n.hasOwnProperty;function a(o,i,s){var c=o[i];(!(r.call(o,i)&&t(c,s))||s===void 0&&!(i in o))&&e(o,i,s)}return F1=a,F1};var B1,O3;function Pae(){if(O3)return B1;O3=1;var e=Lk(),t=gu(),n=Rh(),r=Wr(),a=Ys();function o(i,s,c,l){if(!r(i))return i;s=t(s,i);for(var u=-1,d=s.length,p=d-1,f=i;f!=null&&++u<d;){var m=a(s[u]),y=c;if(m==="__proto__"||m==="constructor"||m==="prototype")return i;if(u!=p){var v=f[m];y=l?l(v,m,f):void 0,y===void 0&&(y=r(v)?v:n(s[u+1])?[]:{})}e(f,m,y),f=f[m]}return i}return B1=o,B1}var z1,C3;nk=function(){if(C3)return z1;C3=1;var e=yu(),t=Pae(),n=gu();function r(a,o,i){for(var s=-1,c=o.length,l={};++s<c;){var u=o[s],d=e(a,u);i(d,u)&&t(l,n(u,a),d)}return l}return z1=r,z1};var U1,N3;N0=function(){if(N3)return U1;N3=1;var e=MD(),t=e(Object.getPrototypeOf,Object);return U1=t,U1};var V1,M3;Ak=function(){if(M3)return V1;M3=1;var e=Mx(),t=N0(),n=C0(),r=dD(),a=Object.getOwnPropertySymbols,o=a?function(i){for(var s=[];i;)e(s,n(i)),i=t(i);return s}:r;return V1=o,V1};var q1,k3;function Aae(){if(k3)return q1;k3=1;function e(t){var n=[];if(t!=null)for(var r in Object(t))n.push(r);return n}return q1=e,q1}var W1,P3;function Tae(){if(P3)return W1;P3=1;var e=Wr(),t=M0(),n=Aae(),r=Object.prototype,a=r.hasOwnProperty;function o(i){if(!e(i))return n(i);var s=t(i),c=[];for(var l in i)l=="constructor"&&(s||!a.call(i,l))||c.push(l);return c}return W1=o,W1}var H1,A3;Pk=function(){if(A3)return H1;A3=1;var e=OD(),t=Tae(),n=Ki();function r(a){return n(a)?e(a,!0):t(a)}return H1=r,H1};var K1,T3;$k=function(){if(T3)return K1;T3=1;var e=cD(),t=Ak(),n=Pk();function r(a){return e(a,n,t)}return K1=r,K1};var Z1,I3;function Iae(){if(I3)return Z1;I3=1;var e=iu(),t=za(),n=nk(),r=$k();function a(o,i){if(o==null)return{};var s=e(r(o),function(c){return[c]});return i=t(i),n(o,s,function(c,l){return i(c,l[0])})}return Z1=a,Z1}var G1,R3;function Rae(){if(R3)return G1;R3=1;var e=za(),t=kae(),n=Iae();function r(a,o){return n(a,t(e(o)))}return G1=r,G1}var Dae=Rae();const rd=st(Dae);var X1,D3;function Lae(){if(D3)return X1;D3=1;function e(t){return t===void 0}return X1=e,X1}var $ae=Lae();const ad=st($ae);function rn(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)(r=rn(e[n]))!==""&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var Fae={value:()=>{}};function Lh(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new $h(n)}function $h(e){this._=e}function Bae(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}$h.prototype=Lh.prototype={constructor:$h,on:function(e,t){var n=this._,r=Bae(e+"",n),a,o=-1,i=r.length;if(arguments.length<2){for(;++o<i;)if((a=(e=r[o]).type)&&(a=zae(n[a],e.name)))return a;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<i;)if(a=(e=r[o]).type)n[a]=L3(n[a],e.name,t);else if(t==null)for(a in n)n[a]=L3(n[a],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new $h(e)},call:function(e,t){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,o;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],r=0,a=o.length;r<a;++r)o[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],a=0,o=r.length;a<o;++a)r[a].value.apply(t,n)}};function zae(e,t){for(var n=0,r=e.length,a;n<r;++n)if((a=e[n]).name===t)return a.value}function L3(e,t,n){for(var r=0,a=e.length;r<a;++r)if(e[r].name===t){e[r]=Fae,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var J1="http://www.w3.org/1999/xhtml";const $3={svg:"http://www.w3.org/2000/svg",xhtml:J1,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Fh(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),$3.hasOwnProperty(t)?{space:$3[t],local:e}:e}function Uae(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===J1&&t.documentElement.namespaceURI===J1?t.createElement(e):t.createElementNS(n,e)}}function Vae(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function F3(e){var t=Fh(e);return(t.local?Vae:Uae)(t)}function qae(){}function Y1(e){return e==null?qae:function(){return this.querySelector(e)}}function Wae(e){typeof e!="function"&&(e=Y1(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var o=t[a],i=o.length,s=r[a]=new Array(i),c,l,u=0;u<i;++u)(c=o[u])&&(l=e.call(c,c.__data__,u,o))&&("__data__"in c&&(l.__data__=c.__data__),s[u]=l);return new gr(r,this._parents)}function Hae(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Kae(){return[]}function B3(e){return e==null?Kae:function(){return this.querySelectorAll(e)}}function Zae(e){return function(){return Hae(e.apply(this,arguments))}}function Gae(e){typeof e=="function"?e=Zae(e):e=B3(e);for(var t=this._groups,n=t.length,r=[],a=[],o=0;o<n;++o)for(var i=t[o],s=i.length,c,l=0;l<s;++l)(c=i[l])&&(r.push(e.call(c,c.__data__,l,i)),a.push(c));return new gr(r,a)}function z3(e){return function(){return this.matches(e)}}function U3(e){return function(t){return t.matches(e)}}var Xae=Array.prototype.find;function Jae(e){return function(){return Xae.call(this.children,e)}}function Yae(){return this.firstElementChild}function Qae(e){return this.select(e==null?Yae:Jae(typeof e=="function"?e:U3(e)))}var eoe=Array.prototype.filter;function toe(){return Array.from(this.children)}function noe(e){return function(){return eoe.call(this.children,e)}}function roe(e){return this.selectAll(e==null?toe:noe(typeof e=="function"?e:U3(e)))}function aoe(e){typeof e!="function"&&(e=z3(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var o=t[a],i=o.length,s=r[a]=[],c,l=0;l<i;++l)(c=o[l])&&e.call(c,c.__data__,l,o)&&s.push(c);return new gr(r,this._parents)}function V3(e){return new Array(e.length)}function ooe(){return new gr(this._enter||this._groups.map(V3),this._parents)}function Bh(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Bh.prototype={constructor:Bh,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function ioe(e){return function(){return e}}function soe(e,t,n,r,a,o){for(var i=0,s,c=t.length,l=o.length;i<l;++i)(s=t[i])?(s.__data__=o[i],r[i]=s):n[i]=new Bh(e,o[i]);for(;i<c;++i)(s=t[i])&&(a[i]=s)}function coe(e,t,n,r,a,o,i){var s,c,l=new Map,u=t.length,d=o.length,p=new Array(u),f;for(s=0;s<u;++s)(c=t[s])&&(p[s]=f=i.call(c,c.__data__,s,t)+"",l.has(f)?a[s]=c:l.set(f,c));for(s=0;s<d;++s)f=i.call(e,o[s],s,o)+"",(c=l.get(f))?(r[s]=c,c.__data__=o[s],l.delete(f)):n[s]=new Bh(e,o[s]);for(s=0;s<u;++s)(c=t[s])&&l.get(p[s])===c&&(a[s]=c)}function loe(e){return e.__data__}function uoe(e,t){if(!arguments.length)return Array.from(this,loe);var n=t?coe:soe,r=this._parents,a=this._groups;typeof e!="function"&&(e=ioe(e));for(var o=a.length,i=new Array(o),s=new Array(o),c=new Array(o),l=0;l<o;++l){var u=r[l],d=a[l],p=d.length,f=doe(e.call(u,u&&u.__data__,l,r)),m=f.length,y=s[l]=new Array(m),v=i[l]=new Array(m),b=c[l]=new Array(p);n(u,d,y,v,b,f,t);for(var w=0,j=0,x,_;w<m;++w)if(x=y[w]){for(w>=j&&(j=w+1);!(_=v[j])&&++j<m;);x._next=_||null}}return i=new gr(i,r),i._enter=s,i._exit=c,i}function doe(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function poe(){return new gr(this._exit||this._groups.map(V3),this._parents)}function foe(e,t,n){var r=this.enter(),a=this,o=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(a=t(a),a&&(a=a.selection())),n==null?o.remove():n(o),r&&a?r.merge(a).order():a}function hoe(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,a=n.length,o=r.length,i=Math.min(a,o),s=new Array(a),c=0;c<i;++c)for(var l=n[c],u=r[c],d=l.length,p=s[c]=new Array(d),f,m=0;m<d;++m)(f=l[m]||u[m])&&(p[m]=f);for(;c<a;++c)s[c]=n[c];return new gr(s,this._parents)}function moe(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],a=r.length-1,o=r[a],i;--a>=0;)(i=r[a])&&(o&&i.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(i,o),o=i);return this}function yoe(e){e||(e=goe);function t(d,p){return d&&p?e(d.__data__,p.__data__):!d-!p}for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o){for(var i=n[o],s=i.length,c=a[o]=new Array(s),l,u=0;u<s;++u)(l=i[u])&&(c[u]=l);c.sort(t)}return new gr(a,this._parents).order()}function goe(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function voe(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function boe(){return Array.from(this)}function woe(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],a=0,o=r.length;a<o;++a){var i=r[a];if(i)return i}return null}function xoe(){let e=0;for(const t of this)++e;return e}function _oe(){return!this.node()}function joe(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var a=t[n],o=0,i=a.length,s;o<i;++o)(s=a[o])&&e.call(s,s.__data__,o,a);return this}function Soe(e){return function(){this.removeAttribute(e)}}function Eoe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ooe(e,t){return function(){this.setAttribute(e,t)}}function Coe(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Noe(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Moe(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function koe(e,t){var n=Fh(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Eoe:Soe:typeof t=="function"?n.local?Moe:Noe:n.local?Coe:Ooe)(n,t))}function q3(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Poe(e){return function(){this.style.removeProperty(e)}}function Aoe(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Toe(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Ioe(e,t,n){return arguments.length>1?this.each((t==null?Poe:typeof t=="function"?Toe:Aoe)(e,t,n??"")):bc(this.node(),e)}function bc(e,t){return e.style.getPropertyValue(t)||q3(e).getComputedStyle(e,null).getPropertyValue(t)}function Roe(e){return function(){delete this[e]}}function Doe(e,t){return function(){this[e]=t}}function Loe(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function $oe(e,t){return arguments.length>1?this.each((t==null?Roe:typeof t=="function"?Loe:Doe)(e,t)):this.node()[e]}function W3(e){return e.trim().split(/^|\s+/)}function Q1(e){return e.classList||new H3(e)}function H3(e){this._node=e,this._names=W3(e.getAttribute("class")||"")}H3.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function K3(e,t){for(var n=Q1(e),r=-1,a=t.length;++r<a;)n.add(t[r])}function Z3(e,t){for(var n=Q1(e),r=-1,a=t.length;++r<a;)n.remove(t[r])}function Foe(e){return function(){K3(this,e)}}function Boe(e){return function(){Z3(this,e)}}function zoe(e,t){return function(){(t.apply(this,arguments)?K3:Z3)(this,e)}}function Uoe(e,t){var n=W3(e+"");if(arguments.length<2){for(var r=Q1(this.node()),a=-1,o=n.length;++a<o;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof t=="function"?zoe:t?Foe:Boe)(n,t))}function Voe(){this.textContent=""}function qoe(e){return function(){this.textContent=e}}function Woe(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Hoe(e){return arguments.length?this.each(e==null?Voe:(typeof e=="function"?Woe:qoe)(e)):this.node().textContent}function Koe(){this.innerHTML=""}function Zoe(e){return function(){this.innerHTML=e}}function Goe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Xoe(e){return arguments.length?this.each(e==null?Koe:(typeof e=="function"?Goe:Zoe)(e)):this.node().innerHTML}function Joe(){this.nextSibling&&this.parentNode.appendChild(this)}function Yoe(){return this.each(Joe)}function Qoe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function eie(){return this.each(Qoe)}function tie(e){var t=typeof e=="function"?e:F3(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function nie(){return null}function rie(e,t){var n=typeof e=="function"?e:F3(e),r=t==null?nie:typeof t=="function"?t:Y1(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function aie(){var e=this.parentNode;e&&e.removeChild(this)}function oie(){return this.each(aie)}function iie(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function sie(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function cie(e){return this.select(e?sie:iie)}function lie(e){return arguments.length?this.property("__data__",e):this.node().__data__}function uie(e){return function(t){e.call(this,t,this.__data__)}}function die(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function pie(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,a=t.length,o;n<a;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++r]=o;++r?t.length=r:delete this.__on}}}function fie(e,t,n){return function(){var r=this.__on,a,o=uie(t);if(r){for(var i=0,s=r.length;i<s;++i)if((a=r[i]).type===e.type&&a.name===e.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=o,a.options=n),a.value=t;return}}this.addEventListener(e.type,o,n),a={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(a):this.__on=[a]}}function hie(e,t,n){var r=die(e+""),a,o=r.length,i;if(arguments.length<2){var s=this.node().__on;if(s){for(var c=0,l=s.length,u;c<l;++c)for(a=0,u=s[c];a<o;++a)if((i=r[a]).type===u.type&&i.name===u.name)return u.value}return}for(s=t?fie:pie,a=0;a<o;++a)this.each(s(r[a],t,n));return this}function G3(e,t,n){var r=q3(e),a=r.CustomEvent;typeof a=="function"?a=new a(t,n):(a=r.document.createEvent("Event"),n?(a.initEvent(t,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function mie(e,t){return function(){return G3(this,e,t)}}function yie(e,t){return function(){return G3(this,e,t.apply(this,arguments))}}function gie(e,t){return this.each((typeof t=="function"?yie:mie)(e,t))}function*vie(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],a=0,o=r.length,i;a<o;++a)(i=r[a])&&(yield i)}var X3=[null];function gr(e,t){this._groups=e,this._parents=t}function od(){return new gr([[document.documentElement]],X3)}function bie(){return this}gr.prototype=od.prototype={constructor:gr,select:Wae,selectAll:Gae,selectChild:Qae,selectChildren:roe,filter:aoe,data:uoe,enter:ooe,exit:poe,join:foe,merge:hoe,selection:bie,order:moe,sort:yoe,call:voe,nodes:boe,node:woe,size:xoe,empty:_oe,each:joe,attr:koe,style:Ioe,property:$oe,classed:Uoe,text:Hoe,html:Xoe,raise:Yoe,lower:eie,append:tie,insert:rie,remove:oie,clone:cie,datum:lie,on:hie,dispatch:gie,[Symbol.iterator]:vie};function vr(e){return typeof e=="string"?new gr([[document.querySelector(e)]],[document.documentElement]):new gr([[e]],X3)}function wie(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ea(e,t){if(e=wie(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]}}return[e.pageX,e.pageY]}const xie={passive:!1},id={capture:!0,passive:!1};function e_(e){e.stopImmediatePropagation()}function wc(e){e.preventDefault(),e.stopImmediatePropagation()}function J3(e){var t=e.document.documentElement,n=vr(e).on("dragstart.drag",wc,id);"onselectstart"in t?n.on("selectstart.drag",wc,id):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Y3(e,t){var n=e.document.documentElement,r=vr(e).on("dragstart.drag",null);t&&(r.on("click.drag",wc,id),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const zh=e=>()=>e;function t_(e,{sourceEvent:t,subject:n,target:r,identifier:a,active:o,x:i,y:s,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}t_.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function _ie(e){return!e.ctrlKey&&!e.button}function jie(){return this.parentNode}function Sie(e,t){return t??{x:e.x,y:e.y}}function Eie(){return navigator.maxTouchPoints||"ontouchstart"in this}function Q3(){var e=_ie,t=jie,n=Sie,r=Eie,a={},o=Lh("start","drag","end"),i=0,s,c,l,u,d=0;function p(x){x.on("mousedown.drag",f).filter(r).on("touchstart.drag",v).on("touchmove.drag",b,xie).on("touchend.drag touchcancel.drag",w).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(x,_){if(!(u||!e.call(this,x,_))){var S=j(this,t.call(this,x,_),x,_,"mouse");S&&(vr(x.view).on("mousemove.drag",m,id).on("mouseup.drag",y,id),J3(x.view),e_(x),l=!1,s=x.clientX,c=x.clientY,S("start",x))}}function m(x){if(wc(x),!l){var _=x.clientX-s,S=x.clientY-c;l=_*_+S*S>d}a.mouse("drag",x)}function y(x){vr(x.view).on("mousemove.drag mouseup.drag",null),Y3(x.view,l),wc(x),a.mouse("end",x)}function v(x,_){if(e.call(this,x,_)){var S=x.changedTouches,E=t.call(this,x,_),O=S.length,N,M;for(N=0;N<O;++N)(M=j(this,E,x,_,S[N].identifier,S[N]))&&(e_(x),M("start",x,S[N]))}}function b(x){var _=x.changedTouches,S=_.length,E,O;for(E=0;E<S;++E)(O=a[_[E].identifier])&&(wc(x),O("drag",x,_[E]))}function w(x){var _=x.changedTouches,S=_.length,E,O;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),E=0;E<S;++E)(O=a[_[E].identifier])&&(e_(x),O("end",x,_[E]))}function j(x,_,S,E,O,N){var M=o.copy(),k=ea(N||S,_),P,A,C;if((C=n.call(x,new t_("beforestart",{sourceEvent:S,target:p,identifier:O,active:i,x:k[0],y:k[1],dx:0,dy:0,dispatch:M}),E))!=null)return P=C.x-k[0]||0,A=C.y-k[1]||0,function I(T,R,L){var D=k,z;switch(T){case"start":a[O]=I,z=i++;break;case"end":delete a[O],--i;case"drag":k=ea(L||R,_),z=i;break}M.call(T,x,new t_(T,{sourceEvent:R,subject:C,target:p,identifier:O,active:z,x:k[0]+P,y:k[1]+A,dx:k[0]-D[0],dy:k[1]-D[1],dispatch:M}),E)}}return p.filter=function(x){return arguments.length?(e=typeof x=="function"?x:zh(!!x),p):e},p.container=function(x){return arguments.length?(t=typeof x=="function"?x:zh(x),p):t},p.subject=function(x){return arguments.length?(n=typeof x=="function"?x:zh(x),p):n},p.touchable=function(x){return arguments.length?(r=typeof x=="function"?x:zh(!!x),p):r},p.on=function(){var x=o.on.apply(o,arguments);return x===o?p:x},p.clickDistance=function(x){return arguments.length?(d=(x=+x)*x,p):Math.sqrt(d)},p}function n_(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function e4(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function sd(){}var cd=.7,Uh=1/cd,xc="\\s*([+-]?\\d+)\\s*",ld="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ua="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Oie=/^#([0-9a-f]{3,8})$/,Cie=new RegExp(`^rgb\\(${xc},${xc},${xc}\\)$`),Nie=new RegExp(`^rgb\\(${Ua},${Ua},${Ua}\\)$`),Mie=new RegExp(`^rgba\\(${xc},${xc},${xc},${ld}\\)$`),kie=new RegExp(`^rgba\\(${Ua},${Ua},${Ua},${ld}\\)$`),Pie=new RegExp(`^hsl\\(${ld},${Ua},${Ua}\\)$`),Aie=new RegExp(`^hsla\\(${ld},${Ua},${Ua},${ld}\\)$`),t4={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};n_(sd,ss,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:n4,formatHex:n4,formatHex8:Tie,formatHsl:Iie,formatRgb:r4,toString:r4});function n4(){return this.rgb().formatHex()}function Tie(){return this.rgb().formatHex8()}function Iie(){return c4(this).formatHsl()}function r4(){return this.rgb().formatRgb()}function ss(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Oie.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?a4(t):n===3?new Qn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Vh(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Vh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Cie.exec(e))?new Qn(t[1],t[2],t[3],1):(t=Nie.exec(e))?new Qn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Mie.exec(e))?Vh(t[1],t[2],t[3],t[4]):(t=kie.exec(e))?Vh(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Pie.exec(e))?s4(t[1],t[2]/100,t[3]/100,1):(t=Aie.exec(e))?s4(t[1],t[2]/100,t[3]/100,t[4]):t4.hasOwnProperty(e)?a4(t4[e]):e==="transparent"?new Qn(NaN,NaN,NaN,0):null}function a4(e){return new Qn(e>>16&255,e>>8&255,e&255,1)}function Vh(e,t,n,r){return r<=0&&(e=t=n=NaN),new Qn(e,t,n,r)}function Rie(e){return e instanceof sd||(e=ss(e)),e?(e=e.rgb(),new Qn(e.r,e.g,e.b,e.opacity)):new Qn}function r_(e,t,n,r){return arguments.length===1?Rie(e):new Qn(e,t,n,r??1)}function Qn(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}n_(Qn,r_,e4(sd,{brighter(e){return e=e==null?Uh:Math.pow(Uh,e),new Qn(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?cd:Math.pow(cd,e),new Qn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Qn(cs(this.r),cs(this.g),cs(this.b),qh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:o4,formatHex:o4,formatHex8:Die,formatRgb:i4,toString:i4}));function o4(){return`#${ls(this.r)}${ls(this.g)}${ls(this.b)}`}function Die(){return`#${ls(this.r)}${ls(this.g)}${ls(this.b)}${ls((isNaN(this.opacity)?1:this.opacity)*255)}`}function i4(){const e=qh(this.opacity);return`${e===1?"rgb(":"rgba("}${cs(this.r)}, ${cs(this.g)}, ${cs(this.b)}${e===1?")":`, ${e})`}`}function qh(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function cs(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ls(e){return e=cs(e),(e<16?"0":"")+e.toString(16)}function s4(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ta(e,t,n,r)}function c4(e){if(e instanceof ta)return new ta(e.h,e.s,e.l,e.opacity);if(e instanceof sd||(e=ss(e)),!e)return new ta;if(e instanceof ta)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,a=Math.min(t,n,r),o=Math.max(t,n,r),i=NaN,s=o-a,c=(o+a)/2;return s?(t===o?i=(n-r)/s+(n<r)*6:n===o?i=(r-t)/s+2:i=(t-n)/s+4,s/=c<.5?o+a:2-o-a,i*=60):s=c>0&&c<1?0:i,new ta(i,s,c,e.opacity)}function Lie(e,t,n,r){return arguments.length===1?c4(e):new ta(e,t,n,r??1)}function ta(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}n_(ta,Lie,e4(sd,{brighter(e){return e=e==null?Uh:Math.pow(Uh,e),new ta(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?cd:Math.pow(cd,e),new ta(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,a=2*n-r;return new Qn(a_(e>=240?e-240:e+120,a,r),a_(e,a,r),a_(e<120?e+240:e-120,a,r),this.opacity)},clamp(){return new ta(l4(this.h),Wh(this.s),Wh(this.l),qh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=qh(this.opacity);return`${e===1?"hsl(":"hsla("}${l4(this.h)}, ${Wh(this.s)*100}%, ${Wh(this.l)*100}%${e===1?")":`, ${e})`}`}}));function l4(e){return e=(e||0)%360,e<0?e+360:e}function Wh(e){return Math.max(0,Math.min(1,e||0))}function a_(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const o_=e=>()=>e;function $ie(e,t){return function(n){return e+n*t}}function Fie(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Bie(e){return(e=+e)==1?u4:function(t,n){return n-t?Fie(t,n,e):o_(isNaN(t)?n:t)}}function u4(e,t){var n=t-e;return n?$ie(e,n):o_(isNaN(e)?t:e)}const Hh=function e(t){var n=Bie(t);function r(a,o){var i=n((a=r_(a)).r,(o=r_(o)).r),s=n(a.g,o.g),c=n(a.b,o.b),l=u4(a.opacity,o.opacity);return function(u){return a.r=i(u),a.g=s(u),a.b=c(u),a.opacity=l(u),a+""}}return r.gamma=e,r}(1);function zie(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),a;return function(o){for(a=0;a<n;++a)r[a]=e[a]*(1-o)+t[a]*o;return r}}function Uie(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Vie(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,a=new Array(r),o=new Array(n),i;for(i=0;i<r;++i)a[i]=_c(e[i],t[i]);for(;i<n;++i)o[i]=t[i];return function(s){for(i=0;i<r;++i)o[i]=a[i](s);return o}}function qie(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function na(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Wie(e,t){var n={},r={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?n[a]=_c(e[a],t[a]):r[a]=t[a];return function(o){for(a in n)r[a]=n[a](o);return r}}var i_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,s_=new RegExp(i_.source,"g");function Hie(e){return function(){return e}}function Kie(e){return function(t){return e(t)+""}}function d4(e,t){var n=i_.lastIndex=s_.lastIndex=0,r,a,o,i=-1,s=[],c=[];for(e=e+"",t=t+"";(r=i_.exec(e))&&(a=s_.exec(t));)(o=a.index)>n&&(o=t.slice(n,o),s[i]?s[i]+=o:s[++i]=o),(r=r[0])===(a=a[0])?s[i]?s[i]+=a:s[++i]=a:(s[++i]=null,c.push({i,x:na(r,a)})),n=s_.lastIndex;return n<t.length&&(o=t.slice(n),s[i]?s[i]+=o:s[++i]=o),s.length<2?c[0]?Kie(c[0].x):Hie(t):(t=c.length,function(l){for(var u=0,d;u<t;++u)s[(d=c[u]).i]=d.x(l);return s.join("")})}function _c(e,t){var n=typeof t,r;return t==null||n==="boolean"?o_(t):(n==="number"?na:n==="string"?(r=ss(t))?(t=r,Hh):d4:t instanceof ss?Hh:t instanceof Date?qie:Uie(t)?zie:Array.isArray(t)?Vie:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Wie:na)(e,t)}function c_(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var p4=180/Math.PI,f4={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function h4(e,t,n,r,a,o){var i,s,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*n+t*r)&&(n-=e*c,r-=t*c),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,c/=s),e*r<t*n&&(e=-e,t=-t,c=-c,i=-i),{translateX:a,translateY:o,rotate:Math.atan2(t,e)*p4,skewX:Math.atan(c)*p4,scaleX:i,scaleY:s}}var Kh;function Zie(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?f4:h4(t.a,t.b,t.c,t.d,t.e,t.f)}function Gie(e){return e==null||(Kh||(Kh=document.createElementNS("http://www.w3.org/2000/svg","g")),Kh.setAttribute("transform",e),!(e=Kh.transform.baseVal.consolidate()))?f4:(e=e.matrix,h4(e.a,e.b,e.c,e.d,e.e,e.f))}function m4(e,t,n,r){function a(l){return l.length?l.pop()+" ":""}function o(l,u,d,p,f,m){if(l!==d||u!==p){var y=f.push("translate(",null,t,null,n);m.push({i:y-4,x:na(l,d)},{i:y-2,x:na(u,p)})}else(d||p)&&f.push("translate("+d+t+p+n)}function i(l,u,d,p){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),p.push({i:d.push(a(d)+"rotate(",null,r)-2,x:na(l,u)})):u&&d.push(a(d)+"rotate("+u+r)}function s(l,u,d,p){l!==u?p.push({i:d.push(a(d)+"skewX(",null,r)-2,x:na(l,u)}):u&&d.push(a(d)+"skewX("+u+r)}function c(l,u,d,p,f,m){if(l!==d||u!==p){var y=f.push(a(f)+"scale(",null,",",null,")");m.push({i:y-4,x:na(l,d)},{i:y-2,x:na(u,p)})}else(d!==1||p!==1)&&f.push(a(f)+"scale("+d+","+p+")")}return function(l,u){var d=[],p=[];return l=e(l),u=e(u),o(l.translateX,l.translateY,u.translateX,u.translateY,d,p),i(l.rotate,u.rotate,d,p),s(l.skewX,u.skewX,d,p),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,d,p),l=u=null,function(f){for(var m=-1,y=p.length,v;++m<y;)d[(v=p[m]).i]=v.x(f);return d.join("")}}}var Xie=m4(Zie,"px, ","px)","deg)"),Jie=m4(Gie,", ",")",")"),Yie=1e-12;function y4(e){return((e=Math.exp(e))+1/e)/2}function Qie(e){return((e=Math.exp(e))-1/e)/2}function ese(e){return((e=Math.exp(2*e))-1)/(e+1)}const tse=function e(t,n,r){function a(o,i){var s=o[0],c=o[1],l=o[2],u=i[0],d=i[1],p=i[2],f=u-s,m=d-c,y=f*f+m*m,v,b;if(y<Yie)b=Math.log(p/l)/t,v=function(E){return[s+E*f,c+E*m,l*Math.exp(t*E*b)]};else{var w=Math.sqrt(y),j=(p*p-l*l+r*y)/(2*l*n*w),x=(p*p-l*l-r*y)/(2*p*n*w),_=Math.log(Math.sqrt(j*j+1)-j),S=Math.log(Math.sqrt(x*x+1)-x);b=(S-_)/t,v=function(E){var O=E*b,N=y4(_),M=l/(n*w)*(N*ese(t*O+_)-Qie(_));return[s+M*f,c+M*m,l*N/y4(t*O+_)]}}return v.duration=b*1e3*t/Math.SQRT2,v}return a.rho=function(o){var i=Math.max(.001,+o),s=i*i,c=s*s;return e(i,s,c)},a}(Math.SQRT2,2,4);function nse(e,t){t===void 0&&(t=e,e=_c);for(var n=0,r=t.length-1,a=t[0],o=new Array(r<0?0:r);n<r;)o[n]=e(a,a=t[++n]);return function(i){var s=Math.max(0,Math.min(r-1,Math.floor(i*=r)));return o[s](i-s)}}var jc=0,ud=0,dd=0,g4=1e3,Zh,pd,Gh=0,us=0,Xh=0,fd=typeof performance=="object"&&performance.now?performance:Date,v4=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function l_(){return us||(v4(rse),us=fd.now()+Xh)}function rse(){us=0}function Jh(){this._call=this._time=this._next=null}Jh.prototype=b4.prototype={constructor:Jh,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?l_():+n)+(t==null?0:+t),!this._next&&pd!==this&&(pd?pd._next=this:Zh=this,pd=this),this._call=e,this._time=n,u_()},stop:function(){this._call&&(this._call=null,this._time=1/0,u_())}};function b4(e,t,n){var r=new Jh;return r.restart(e,t,n),r}function ase(){l_(),++jc;for(var e=Zh,t;e;)(t=us-e._time)>=0&&e._call.call(void 0,t),e=e._next;--jc}function w4(){us=(Gh=fd.now())+Xh,jc=ud=0;try{ase()}finally{jc=0,ise(),us=0}}function ose(){var e=fd.now(),t=e-Gh;t>g4&&(Xh-=t,Gh=e)}function ise(){for(var e,t=Zh,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Zh=n);pd=e,u_(r)}function u_(e){if(!jc){ud&&(ud=clearTimeout(ud));var t=e-us;t>24?(e<1/0&&(ud=setTimeout(w4,e-fd.now()-Xh)),dd&&(dd=clearInterval(dd))):(dd||(Gh=fd.now(),dd=setInterval(ose,g4)),jc=1,v4(w4))}}function x4(e,t,n){var r=new Jh;return t=t==null?0:+t,r.restart(a=>{r.stop(),e(a+t)},t,n),r}var sse=Lh("start","end","cancel","interrupt"),cse=[],_4=0,j4=1,d_=2,Yh=3,S4=4,p_=5,Qh=6;function em(e,t,n,r,a,o){var i=e.__transition;if(!i)e.__transition={};else if(n in i)return;lse(e,n,{name:t,index:r,group:a,on:sse,tween:cse,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:_4})}function f_(e,t){var n=ra(e,t);if(n.state>_4)throw new Error("too late; already scheduled");return n}function Va(e,t){var n=ra(e,t);if(n.state>Yh)throw new Error("too late; already running");return n}function ra(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function lse(e,t,n){var r=e.__transition,a;r[t]=n,n.timer=b4(o,0,n.time);function o(l){n.state=j4,n.timer.restart(i,n.delay,n.time),n.delay<=l&&i(l-n.delay)}function i(l){var u,d,p,f;if(n.state!==j4)return c();for(u in r)if(f=r[u],f.name===n.name){if(f.state===Yh)return x4(i);f.state===S4?(f.state=Qh,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete r[u]):+u<t&&(f.state=Qh,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete r[u])}if(x4(function(){n.state===Yh&&(n.state=S4,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=d_,n.on.call("start",e,e.__data__,n.index,n.group),n.state===d_){for(n.state=Yh,a=new Array(p=n.tween.length),u=0,d=-1;u<p;++u)(f=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(a[++d]=f);a.length=d+1}}function s(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=p_,1),d=-1,p=a.length;++d<p;)a[d].call(e,u);n.state===p_&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Qh,n.timer.stop(),delete r[t];for(var l in r)return;delete e.__transition}}function tm(e,t){var n=e.__transition,r,a,o=!0,i;if(n){t=t==null?null:t+"";for(i in n){if((r=n[i]).name!==t){o=!1;continue}a=r.state>d_&&r.state<p_,r.state=Qh,r.timer.stop(),r.on.call(a?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[i]}o&&delete e.__transition}}function use(e){return this.each(function(){tm(this,e)})}function dse(e,t){var n,r;return function(){var a=Va(this,e),o=a.tween;if(o!==n){r=n=o;for(var i=0,s=r.length;i<s;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}a.tween=r}}function pse(e,t,n){var r,a;if(typeof n!="function")throw new Error;return function(){var o=Va(this,e),i=o.tween;if(i!==r){a=(r=i).slice();for(var s={name:t,value:n},c=0,l=a.length;c<l;++c)if(a[c].name===t){a[c]=s;break}c===l&&a.push(s)}o.tween=a}}function fse(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=ra(this.node(),n).tween,a=0,o=r.length,i;a<o;++a)if((i=r[a]).name===e)return i.value;return null}return this.each((t==null?dse:pse)(n,e,t))}function h_(e,t,n){var r=e._id;return e.each(function(){var a=Va(this,r);(a.value||(a.value={}))[t]=n.apply(this,arguments)}),function(a){return ra(a,r).value[t]}}function E4(e,t){var n;return(typeof t=="number"?na:t instanceof ss?Hh:(n=ss(t))?(t=n,Hh):d4)(e,t)}function hse(e){return function(){this.removeAttribute(e)}}function mse(e){return function(){this.removeAttributeNS(e.space,e.local)}}function yse(e,t,n){var r,a=n+"",o;return function(){var i=this.getAttribute(e);return i===a?null:i===r?o:o=t(r=i,n)}}function gse(e,t,n){var r,a=n+"",o;return function(){var i=this.getAttributeNS(e.space,e.local);return i===a?null:i===r?o:o=t(r=i,n)}}function vse(e,t,n){var r,a,o;return function(){var i,s=n(this),c;return s==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=s+"",i===c?null:i===r&&c===a?o:(a=c,o=t(r=i,s)))}}function bse(e,t,n){var r,a,o;return function(){var i,s=n(this),c;return s==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=s+"",i===c?null:i===r&&c===a?o:(a=c,o=t(r=i,s)))}}function wse(e,t){var n=Fh(e),r=n==="transform"?Jie:E4;return this.attrTween(e,typeof t=="function"?(n.local?bse:vse)(n,r,h_(this,"attr."+e,t)):t==null?(n.local?mse:hse)(n):(n.local?gse:yse)(n,r,t))}function xse(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function _se(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function jse(e,t){var n,r;function a(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&_se(e,o)),n}return a._value=t,a}function Sse(e,t){var n,r;function a(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&xse(e,o)),n}return a._value=t,a}function Ese(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=Fh(e);return this.tween(n,(r.local?jse:Sse)(r,t))}function Ose(e,t){return function(){f_(this,e).delay=+t.apply(this,arguments)}}function Cse(e,t){return t=+t,function(){f_(this,e).delay=t}}function Nse(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ose:Cse)(t,e)):ra(this.node(),t).delay}function Mse(e,t){return function(){Va(this,e).duration=+t.apply(this,arguments)}}function kse(e,t){return t=+t,function(){Va(this,e).duration=t}}function Pse(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Mse:kse)(t,e)):ra(this.node(),t).duration}function Ase(e,t){if(typeof t!="function")throw new Error;return function(){Va(this,e).ease=t}}function Tse(e){var t=this._id;return arguments.length?this.each(Ase(t,e)):ra(this.node(),t).ease}function Ise(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Va(this,e).ease=n}}function Rse(e){if(typeof e!="function")throw new Error;return this.each(Ise(this._id,e))}function Dse(e){typeof e!="function"&&(e=z3(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var o=t[a],i=o.length,s=r[a]=[],c,l=0;l<i;++l)(c=o[l])&&e.call(c,c.__data__,l,o)&&s.push(c);return new Po(r,this._parents,this._name,this._id)}function Lse(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,a=n.length,o=Math.min(r,a),i=new Array(r),s=0;s<o;++s)for(var c=t[s],l=n[s],u=c.length,d=i[s]=new Array(u),p,f=0;f<u;++f)(p=c[f]||l[f])&&(d[f]=p);for(;s<r;++s)i[s]=t[s];return new Po(i,this._parents,this._name,this._id)}function $se(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Fse(e,t,n){var r,a,o=$se(t)?f_:Va;return function(){var i=o(this,e),s=i.on;s!==r&&(a=(r=s).copy()).on(t,n),i.on=a}}function Bse(e,t){var n=this._id;return arguments.length<2?ra(this.node(),n).on.on(e):this.each(Fse(n,e,t))}function zse(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Use(){return this.on("end.remove",zse(this._id))}function Vse(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Y1(e));for(var r=this._groups,a=r.length,o=new Array(a),i=0;i<a;++i)for(var s=r[i],c=s.length,l=o[i]=new Array(c),u,d,p=0;p<c;++p)(u=s[p])&&(d=e.call(u,u.__data__,p,s))&&("__data__"in u&&(d.__data__=u.__data__),l[p]=d,em(l[p],t,n,p,l,ra(u,n)));return new Po(o,this._parents,t,n)}function qse(e){var t=this._name,n=this._id;typeof e!="function"&&(e=B3(e));for(var r=this._groups,a=r.length,o=[],i=[],s=0;s<a;++s)for(var c=r[s],l=c.length,u,d=0;d<l;++d)if(u=c[d]){for(var p=e.call(u,u.__data__,d,c),f,m=ra(u,n),y=0,v=p.length;y<v;++y)(f=p[y])&&em(f,t,n,y,p,m);o.push(p),i.push(u)}return new Po(o,i,t,n)}var Wse=od.prototype.constructor;function Hse(){return new Wse(this._groups,this._parents)}function Kse(e,t){var n,r,a;return function(){var o=bc(this,e),i=(this.style.removeProperty(e),bc(this,e));return o===i?null:o===n&&i===r?a:a=t(n=o,r=i)}}function O4(e){return function(){this.style.removeProperty(e)}}function Zse(e,t,n){var r,a=n+"",o;return function(){var i=bc(this,e);return i===a?null:i===r?o:o=t(r=i,n)}}function Gse(e,t,n){var r,a,o;return function(){var i=bc(this,e),s=n(this),c=s+"";return s==null&&(c=s=(this.style.removeProperty(e),bc(this,e))),i===c?null:i===r&&c===a?o:(a=c,o=t(r=i,s))}}function Xse(e,t){var n,r,a,o="style."+t,i="end."+o,s;return function(){var c=Va(this,e),l=c.on,u=c.value[o]==null?s||(s=O4(t)):void 0;(l!==n||a!==u)&&(r=(n=l).copy()).on(i,a=u),c.on=r}}function Jse(e,t,n){var r=(e+="")=="transform"?Xie:E4;return t==null?this.styleTween(e,Kse(e,r)).on("end.style."+e,O4(e)):typeof t=="function"?this.styleTween(e,Gse(e,r,h_(this,"style."+e,t))).each(Xse(this._id,e)):this.styleTween(e,Zse(e,r,t),n).on("end.style."+e,null)}function Yse(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Qse(e,t,n){var r,a;function o(){var i=t.apply(this,arguments);return i!==a&&(r=(a=i)&&Yse(e,i,n)),r}return o._value=t,o}function ece(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Qse(e,t,n??""))}function tce(e){return function(){this.textContent=e}}function nce(e){return function(){var t=e(this);this.textContent=t??""}}function rce(e){return this.tween("text",typeof e=="function"?nce(h_(this,"text",e)):tce(e==null?"":e+""))}function ace(e){return function(t){this.textContent=e.call(this,t)}}function oce(e){var t,n;function r(){var a=e.apply(this,arguments);return a!==n&&(t=(n=a)&&ace(a)),t}return r._value=e,r}function ice(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,oce(e))}function sce(){for(var e=this._name,t=this._id,n=C4(),r=this._groups,a=r.length,o=0;o<a;++o)for(var i=r[o],s=i.length,c,l=0;l<s;++l)if(c=i[l]){var u=ra(c,t);em(c,e,n,l,i,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Po(r,this._parents,e,n)}function cce(){var e,t,n=this,r=n._id,a=n.size();return new Promise(function(o,i){var s={value:i},c={value:function(){--a===0&&o()}};n.each(function(){var l=Va(this,r),u=l.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(s),t._.interrupt.push(s),t._.end.push(c)),l.on=t}),a===0&&o()})}var lce=0;function Po(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function C4(){return++lce}var Ao=od.prototype;Po.prototype={constructor:Po,select:Vse,selectAll:qse,selectChild:Ao.selectChild,selectChildren:Ao.selectChildren,filter:Dse,merge:Lse,selection:Hse,transition:sce,call:Ao.call,nodes:Ao.nodes,node:Ao.node,size:Ao.size,empty:Ao.empty,each:Ao.each,on:Bse,attr:wse,attrTween:Ese,style:Jse,styleTween:ece,text:rce,textTween:ice,remove:Use,tween:fse,delay:Nse,duration:Pse,ease:Tse,easeVarying:Rse,end:cce,[Symbol.iterator]:Ao[Symbol.iterator]};function uce(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var dce={time:null,delay:0,duration:250,ease:uce};function pce(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function fce(e){var t,n;e instanceof Po?(t=e._id,e=e._name):(t=C4(),(n=dce).time=l_(),e=e==null?null:e+"");for(var r=this._groups,a=r.length,o=0;o<a;++o)for(var i=r[o],s=i.length,c,l=0;l<s;++l)(c=i[l])&&em(c,e,t,l,i,n||pce(c,t));return new Po(r,this._parents,e,t)}od.prototype.interrupt=use,od.prototype.transition=fce;const nm=e=>()=>e;function hce(e,{sourceEvent:t,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function To(e,t,n){this.k=e,this.x=t,this.y=n}To.prototype={constructor:To,scale:function(e){return e===1?this:new To(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new To(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var rm=new To(1,0,0);N4.prototype=To.prototype;function N4(e){for(;!e.__zoom;)if(!(e=e.parentNode))return rm;return e.__zoom}function m_(e){e.stopImmediatePropagation()}function hd(e){e.preventDefault(),e.stopImmediatePropagation()}function mce(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function yce(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function M4(){return this.__zoom||rm}function gce(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function vce(){return navigator.maxTouchPoints||"ontouchstart"in this}function bce(e,t,n){var r=e.invertX(t[0][0])-n[0][0],a=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],i=e.invertY(t[1][1])-n[1][1];return e.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),i>o?(o+i)/2:Math.min(0,o)||Math.max(0,i))}function k4(){var e=mce,t=yce,n=bce,r=gce,a=vce,o=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],s=250,c=tse,l=Lh("start","zoom","end"),u,d,p,f=500,m=150,y=0,v=10;function b(C){C.property("__zoom",M4).on("wheel.zoom",O,{passive:!1}).on("mousedown.zoom",N).on("dblclick.zoom",M).filter(a).on("touchstart.zoom",k).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",A).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}b.transform=function(C,I,T,R){var L=C.selection?C.selection():C;L.property("__zoom",M4),C!==L?_(C,I,T,R):L.interrupt().each(function(){S(this,arguments).event(R).start().zoom(null,typeof I=="function"?I.apply(this,arguments):I).end()})},b.scaleBy=function(C,I,T,R){b.scaleTo(C,function(){var L=this.__zoom.k,D=typeof I=="function"?I.apply(this,arguments):I;return L*D},T,R)},b.scaleTo=function(C,I,T,R){b.transform(C,function(){var L=t.apply(this,arguments),D=this.__zoom,z=T==null?x(L):typeof T=="function"?T.apply(this,arguments):T,B=D.invert(z),$=typeof I=="function"?I.apply(this,arguments):I;return n(j(w(D,$),z,B),L,i)},T,R)},b.translateBy=function(C,I,T,R){b.transform(C,function(){return n(this.__zoom.translate(typeof I=="function"?I.apply(this,arguments):I,typeof T=="function"?T.apply(this,arguments):T),t.apply(this,arguments),i)},null,R)},b.translateTo=function(C,I,T,R,L){b.transform(C,function(){var D=t.apply(this,arguments),z=this.__zoom,B=R==null?x(D):typeof R=="function"?R.apply(this,arguments):R;return n(rm.translate(B[0],B[1]).scale(z.k).translate(typeof I=="function"?-I.apply(this,arguments):-I,typeof T=="function"?-T.apply(this,arguments):-T),D,i)},R,L)};function w(C,I){return I=Math.max(o[0],Math.min(o[1],I)),I===C.k?C:new To(I,C.x,C.y)}function j(C,I,T){var R=I[0]-T[0]*C.k,L=I[1]-T[1]*C.k;return R===C.x&&L===C.y?C:new To(C.k,R,L)}function x(C){return[(+C[0][0]+ +C[1][0])/2,(+C[0][1]+ +C[1][1])/2]}function _(C,I,T,R){C.on("start.zoom",function(){S(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).event(R).end()}).tween("zoom",function(){var L=this,D=arguments,z=S(L,D).event(R),B=t.apply(L,D),$=T==null?x(B):typeof T=="function"?T.apply(L,D):T,U=Math.max(B[1][0]-B[0][0],B[1][1]-B[0][1]),F=L.__zoom,H=typeof I=="function"?I.apply(L,D):I,re=c(F.invert($).concat(U/F.k),H.invert($).concat(U/H.k));return function(ee){if(ee===1)ee=H;else{var G=re(ee),K=U/G[2];ee=new To(K,$[0]-G[0]*K,$[1]-G[1]*K)}z.zoom(null,ee)}})}function S(C,I,T){return!T&&C.__zooming||new E(C,I)}function E(C,I){this.that=C,this.args=I,this.active=0,this.sourceEvent=null,this.extent=t.apply(C,I),this.taps=0}E.prototype={event:function(C){return C&&(this.sourceEvent=C),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(C,I){return this.mouse&&C!=="mouse"&&(this.mouse[1]=I.invert(this.mouse[0])),this.touch0&&C!=="touch"&&(this.touch0[1]=I.invert(this.touch0[0])),this.touch1&&C!=="touch"&&(this.touch1[1]=I.invert(this.touch1[0])),this.that.__zoom=I,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(C){var I=vr(this.that).datum();l.call(C,this.that,new hce(C,{sourceEvent:this.sourceEvent,target:b,type:C,transform:this.that.__zoom,dispatch:l}),I)}};function O(C,...I){if(!e.apply(this,arguments))return;var T=S(this,I).event(C),R=this.__zoom,L=Math.max(o[0],Math.min(o[1],R.k*Math.pow(2,r.apply(this,arguments)))),D=ea(C);if(T.wheel)(T.mouse[0][0]!==D[0]||T.mouse[0][1]!==D[1])&&(T.mouse[1]=R.invert(T.mouse[0]=D)),clearTimeout(T.wheel);else{if(R.k===L)return;T.mouse=[D,R.invert(D)],tm(this),T.start()}hd(C),T.wheel=setTimeout(z,m),T.zoom("mouse",n(j(w(R,L),T.mouse[0],T.mouse[1]),T.extent,i));function z(){T.wheel=null,T.end()}}function N(C,...I){if(p||!e.apply(this,arguments))return;var T=C.currentTarget,R=S(this,I,!0).event(C),L=vr(C.view).on("mousemove.zoom",$,!0).on("mouseup.zoom",U,!0),D=ea(C,T),z=C.clientX,B=C.clientY;J3(C.view),m_(C),R.mouse=[D,this.__zoom.invert(D)],tm(this),R.start();function $(F){if(hd(F),!R.moved){var H=F.clientX-z,re=F.clientY-B;R.moved=H*H+re*re>y}R.event(F).zoom("mouse",n(j(R.that.__zoom,R.mouse[0]=ea(F,T),R.mouse[1]),R.extent,i))}function U(F){L.on("mousemove.zoom mouseup.zoom",null),Y3(F.view,R.moved),hd(F),R.event(F).end()}}function M(C,...I){if(e.apply(this,arguments)){var T=this.__zoom,R=ea(C.changedTouches?C.changedTouches[0]:C,this),L=T.invert(R),D=T.k*(C.shiftKey?.5:2),z=n(j(w(T,D),R,L),t.apply(this,I),i);hd(C),s>0?vr(this).transition().duration(s).call(_,z,R,C):vr(this).call(b.transform,z,R,C)}}function k(C,...I){if(e.apply(this,arguments)){var T=C.touches,R=T.length,L=S(this,I,C.changedTouches.length===R).event(C),D,z,B,$;for(m_(C),z=0;z<R;++z)B=T[z],$=ea(B,this),$=[$,this.__zoom.invert($),B.identifier],L.touch0?!L.touch1&&L.touch0[2]!==$[2]&&(L.touch1=$,L.taps=0):(L.touch0=$,D=!0,L.taps=1+!!u);u&&(u=clearTimeout(u)),D&&(L.taps<2&&(d=$[0],u=setTimeout(function(){u=null},f)),tm(this),L.start())}}function P(C,...I){if(this.__zooming){var T=S(this,I).event(C),R=C.changedTouches,L=R.length,D,z,B,$;for(hd(C),D=0;D<L;++D)z=R[D],B=ea(z,this),T.touch0&&T.touch0[2]===z.identifier?T.touch0[0]=B:T.touch1&&T.touch1[2]===z.identifier&&(T.touch1[0]=B);if(z=T.that.__zoom,T.touch1){var U=T.touch0[0],F=T.touch0[1],H=T.touch1[0],re=T.touch1[1],ee=(ee=H[0]-U[0])*ee+(ee=H[1]-U[1])*ee,G=(G=re[0]-F[0])*G+(G=re[1]-F[1])*G;z=w(z,Math.sqrt(ee/G)),B=[(U[0]+H[0])/2,(U[1]+H[1])/2],$=[(F[0]+re[0])/2,(F[1]+re[1])/2]}else if(T.touch0)B=T.touch0[0],$=T.touch0[1];else return;T.zoom("touch",n(j(z,B,$),T.extent,i))}}function A(C,...I){if(this.__zooming){var T=S(this,I).event(C),R=C.changedTouches,L=R.length,D,z;for(m_(C),p&&clearTimeout(p),p=setTimeout(function(){p=null},f),D=0;D<L;++D)z=R[D],T.touch0&&T.touch0[2]===z.identifier?delete T.touch0:T.touch1&&T.touch1[2]===z.identifier&&delete T.touch1;if(T.touch1&&!T.touch0&&(T.touch0=T.touch1,delete T.touch1),T.touch0)T.touch0[1]=this.__zoom.invert(T.touch0[0]);else if(T.end(),T.taps===2&&(z=ea(z,this),Math.hypot(d[0]-z[0],d[1]-z[1])<v)){var B=vr(this).on("dblclick.zoom");B&&B.apply(this,arguments)}}}return b.wheelDelta=function(C){return arguments.length?(r=typeof C=="function"?C:nm(+C),b):r},b.filter=function(C){return arguments.length?(e=typeof C=="function"?C:nm(!!C),b):e},b.touchable=function(C){return arguments.length?(a=typeof C=="function"?C:nm(!!C),b):a},b.extent=function(C){return arguments.length?(t=typeof C=="function"?C:nm([[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]]),b):t},b.scaleExtent=function(C){return arguments.length?(o[0]=+C[0],o[1]=+C[1],b):[o[0],o[1]]},b.translateExtent=function(C){return arguments.length?(i[0][0]=+C[0][0],i[1][0]=+C[1][0],i[0][1]=+C[0][1],i[1][1]=+C[1][1],b):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},b.constrain=function(C){return arguments.length?(n=C,b):n},b.duration=function(C){return arguments.length?(s=+C,b):s},b.interpolate=function(C){return arguments.length?(c=C,b):c},b.on=function(){var C=l.on.apply(l,arguments);return C===l?b:C},b.clickDistance=function(C){return arguments.length?(y=(C=+C)*C,b):Math.sqrt(y)},b.tapDistance=function(C){return arguments.length?(v=+C,b):v},b}const Io={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:r}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`},md=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],P4=["Enter"," ","Escape"];var Sc;(function(e){e.Strict="strict",e.Loose="loose"})(Sc||(Sc={}));var mi;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(mi||(mi={}));var yd;(function(e){e.Partial="partial",e.Full="full"})(yd||(yd={}));const A4={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var yi;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(yi||(yi={}));var am;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(am||(am={}));var he;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(he||(he={}));const T4={[he.Left]:he.Right,[he.Right]:he.Left,[he.Top]:he.Bottom,[he.Bottom]:he.Top};function wce(e,t){if(!e&&!t)return!0;if(!e||!t||e.size!==t.size)return!1;if(!e.size&&!t.size)return!0;for(const n of e.keys())if(!t.has(n))return!1;return!0}function I4(e,t,n){if(!n)return;const r=[];e.forEach((a,o)=>{t!=null&&t.has(o)||r.push(a)}),r.length&&n(r)}function R4(e){return e===null?null:e?"valid":"invalid"}const D4=e=>"id"in e&&"source"in e&&"target"in e,xce=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),y_=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),gd=(e,t=[0,0])=>{const{width:n,height:r}=Ro(e),a=e.origin??t,o=n*a[0],i=r*a[1];return{x:e.position.x-o,y:e.position.y-i}},_ce=(e,t={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((r,a)=>{const o=typeof a=="string";let i=!t.nodeLookup&&!o?a:void 0;t.nodeLookup&&(i=o?t.nodeLookup.get(a):y_(a)?a:t.nodeLookup.get(a.id));const s=i?sm(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return om(r,s)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return im(n)},vd=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(r=>{if(t.filter===void 0||t.filter(r)){const a=sm(r);n=om(n,a)}}),im(n)},L4=(e,t,[n,r,a]=[0,0,1],o=!1,i=!1)=>{const s={...wd(t,[n,r,a]),width:t.width/a,height:t.height/a},c=[];for(const l of e.values()){const{measured:u,selectable:d=!0,hidden:p=!1}=l;if(i&&!d||p)continue;const f=u.width??l.width??l.initialWidth??null,m=u.height??l.height??l.initialHeight??null,y=bd(s,Oc(l)),v=(f??0)*(m??0),b=o&&y>0;(!l.internals.handleBounds||b||y>=v||l.dragging)&&c.push(l)}return c},jce=(e,t)=>{const n=new Set;return e.forEach(r=>{n.add(r.id)}),t.filter(r=>n.has(r.source)||n.has(r.target))};function g_(e,t){const n=new Map,r=t!=null&&t.nodes?new Set(t.nodes.map(a=>a.id)):null;return e.forEach(a=>{a.measured.width&&a.measured.height&&(t!=null&&t.includeHiddenNodes||!a.hidden)&&(!r||r.has(a.id))&&n.set(a.id,a)}),n}async function v_({nodes:e,width:t,height:n,panZoom:r,minZoom:a,maxZoom:o},i){if(e.size===0)return Promise.resolve(!1);const s=vd(e),c=w_(s,t,n,(i==null?void 0:i.minZoom)??a,(i==null?void 0:i.maxZoom)??o,(i==null?void 0:i.padding)??.1);return await r.setViewport(c,{duration:i==null?void 0:i.duration}),Promise.resolve(!0)}function $4({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:a,onError:o}){const i=n.get(e),s=i.parentId?n.get(i.parentId):void 0,{x:c,y:l}=s?s.internals.positionAbsolute:{x:0,y:0},u=i.origin??r;let d=a;if(i.extent==="parent"&&!i.expandParent)if(!s)o==null||o("005",Io.error005());else{const f=s.measured.width,m=s.measured.height;f&&m&&(d=[[c,l],[c+f,l+m]])}else s&&Cc(i.extent)&&(d=[[i.extent[0][0]+c,i.extent[0][1]+l],[i.extent[1][0]+c,i.extent[1][1]+l]]);const p=Cc(d)?ds(t,d,i.measured):t;return{position:{x:p.x-c+i.measured.width*u[0],y:p.y-l+i.measured.height*u[1]},positionAbsolute:p}}async function Sce({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:r,onBeforeDelete:a}){const o=new Set(e.map(d=>d.id)),i=[];for(const d of n){if(d.deletable===!1)continue;const p=o.has(d.id),f=!p&&d.parentId&&i.find(m=>m.id===d.parentId);(p||f)&&i.push(d)}const s=new Set(t.map(d=>d.id)),c=r.filter(d=>d.deletable!==!1),l=jce(i,c);for(const d of c)s.has(d.id)&&!l.find(p=>p.id===d.id)&&l.push(d);if(!a)return{edges:l,nodes:i};const u=await a({nodes:i,edges:l});return typeof u=="boolean"?u?{edges:l,nodes:i}:{edges:[],nodes:[]}:u}const Ec=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),ds=(e={x:0,y:0},t,n)=>({x:Ec(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Ec(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function F4(e,t,n){const{width:r,height:a}=Ro(n),{x:o,y:i}=n.internals.positionAbsolute;return ds(e,[[o,i],[o+r,i+a]],t)}const B4=(e,t,n)=>e<t?Ec(Math.abs(e-t),1,t)/t:e>n?-Ec(Math.abs(e-n),1,t)/t:0,z4=(e,t,n=15,r=40)=>{const a=B4(e.x,r,t.width-r)*n,o=B4(e.y,r,t.height-r)*n;return[a,o]},om=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),b_=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),im=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),Oc=(e,t=[0,0])=>{var a,o;const{x:n,y:r}=y_(e)?e.internals.positionAbsolute:gd(e,t);return{x:n,y:r,width:((a=e.measured)==null?void 0:a.width)??e.width??e.initialWidth??0,height:((o=e.measured)==null?void 0:o.height)??e.height??e.initialHeight??0}},sm=(e,t=[0,0])=>{var a,o;const{x:n,y:r}=y_(e)?e.internals.positionAbsolute:gd(e,t);return{x:n,y:r,x2:n+(((a=e.measured)==null?void 0:a.width)??e.width??e.initialWidth??0),y2:r+(((o=e.measured)==null?void 0:o.height)??e.height??e.initialHeight??0)}},U4=(e,t)=>im(om(b_(e),b_(t))),bd=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},V4=e=>aa(e.width)&&aa(e.height)&&aa(e.x)&&aa(e.y),aa=e=>!isNaN(e)&&isFinite(e),Ece=(e,t)=>{},cm=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),wd=({x:e,y:t},[n,r,a],o=!1,i=[1,1])=>{const s={x:(e-n)/a,y:(t-r)/a};return o?cm(s,i):s},q4=({x:e,y:t},[n,r,a])=>({x:e*a+n,y:t*a+r}),w_=(e,t,n,r,a,o)=>{const i=t/(e.width*(1+o)),s=n/(e.height*(1+o)),c=Math.min(i,s),l=Ec(c,r,a),u=e.x+e.width/2,d=e.y+e.height/2,p=t/2-u*l,f=n/2-d*l;return{x:p,y:f,zoom:l}},lm=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Cc(e){return e!==void 0&&e!=="parent"}function Ro(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function W4(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function H4(e,t={width:0,height:0},n,r,a){const o={...e},i=r.get(n);if(i){const s=i.origin||a;o.x+=i.internals.positionAbsolute.x-(t.width??0)*s[0],o.y+=i.internals.positionAbsolute.y-(t.height??0)*s[1]}return o}function xd(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:r,containerBounds:a}){const{x:o,y:i}=Do(e),s=wd({x:o-((a==null?void 0:a.left)??0),y:i-((a==null?void 0:a.top)??0)},r),{x:c,y:l}=n?cm(s,t):s;return{xSnapped:c,ySnapped:l,...s}}const um=e=>({width:e.offsetWidth,height:e.offsetHeight}),K4=e=>{var t;return((t=e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},Oce=["INPUT","SELECT","TEXTAREA"];function x_(e){var n,r;const t=((r=(n=e.composedPath)==null?void 0:n.call(e))==null?void 0:r[0])||e.target;return Oce.includes(t==null?void 0:t.nodeName)||(t==null?void 0:t.hasAttribute("contenteditable"))||!!(t!=null&&t.closest(".nokey"))}const Z4=e=>"clientX"in e,Do=(e,t)=>{var o,i;const n=Z4(e),r=n?e.clientX:(o=e.touches)==null?void 0:o[0].clientX,a=n?e.clientY:(i=e.touches)==null?void 0:i[0].clientY;return{x:r-((t==null?void 0:t.left)??0),y:a-((t==null?void 0:t.top)??0)}},G4=(e,t,n,r,a)=>{const o=t.querySelectorAll(`.${e}`);return!o||!o.length?null:Array.from(o).map(i=>{const s=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:a,position:i.getAttribute("data-handlepos"),x:(s.left-n.left)/r,y:(s.top-n.top)/r,...um(i)}})};function X4({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:a,sourceControlY:o,targetControlX:i,targetControlY:s}){const c=e*.125+a*.375+i*.375+n*.125,l=t*.125+o*.375+s*.375+r*.125,u=Math.abs(c-e),d=Math.abs(l-t);return[c,l,u,d]}function dm(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function J4({pos:e,x1:t,y1:n,x2:r,y2:a,c:o}){switch(e){case he.Left:return[t-dm(t-r,o),n];case he.Right:return[t+dm(r-t,o),n];case he.Top:return[t,n-dm(n-a,o)];case he.Bottom:return[t,n+dm(a-n,o)]}}function Y4({sourceX:e,sourceY:t,sourcePosition:n=he.Bottom,targetX:r,targetY:a,targetPosition:o=he.Top,curvature:i=.25}){const[s,c]=J4({pos:n,x1:e,y1:t,x2:r,y2:a,c:i}),[l,u]=J4({pos:o,x1:r,y1:a,x2:e,y2:t,c:i}),[d,p,f,m]=X4({sourceX:e,sourceY:t,targetX:r,targetY:a,sourceControlX:s,sourceControlY:c,targetControlX:l,targetControlY:u});return[`M${e},${t} C${s},${c} ${l},${u} ${r},${a}`,d,p,f,m]}function Q4({sourceX:e,sourceY:t,targetX:n,targetY:r}){const a=Math.abs(n-e)/2,o=n<e?n+a:n-a,i=Math.abs(r-t)/2,s=r<t?r+i:r-i;return[o,s,a,i]}function Cce({sourceNode:e,targetNode:t,selected:n=!1,zIndex:r=0,elevateOnSelect:a=!1}){if(!a)return r;const o=n||t.selected||e.selected,i=Math.max(e.internals.z||0,t.internals.z||0,1e3);return r+(o?i:0)}function Nce({sourceNode:e,targetNode:t,width:n,height:r,transform:a}){const o=om(sm(e),sm(t));o.x===o.x2&&(o.x2+=1),o.y===o.y2&&(o.y2+=1);const i={x:-a[0]/a[2],y:-a[1]/a[2],width:n/a[2],height:r/a[2]};return bd(i,im(o))>0}const Mce=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`xy-edge__${e}${t||""}-${n}${r||""}`,kce=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),e5=(e,t)=>{if(!e.source||!e.target)return t;let n;return D4(e)?n={...e}:n={...e,id:Mce(e)},kce(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function t5({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[a,o,i,s]=Q4({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,a,o,i,s]}const n5={[he.Left]:{x:-1,y:0},[he.Right]:{x:1,y:0},[he.Top]:{x:0,y:-1},[he.Bottom]:{x:0,y:1}},Pce=({source:e,sourcePosition:t=he.Bottom,target:n})=>t===he.Left||t===he.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},r5=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Ace({source:e,sourcePosition:t=he.Bottom,target:n,targetPosition:r=he.Top,center:a,offset:o}){const i=n5[t],s=n5[r],c={x:e.x+i.x*o,y:e.y+i.y*o},l={x:n.x+s.x*o,y:n.y+s.y*o},u=Pce({source:c,sourcePosition:t,target:l}),d=u.x!==0?"x":"y",p=u[d];let f=[],m,y;const v={x:0,y:0},b={x:0,y:0},[w,j,x,_]=Q4({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(i[d]*s[d]===-1){m=a.x??w,y=a.y??j;const S=[{x:m,y:c.y},{x:m,y:l.y}],E=[{x:c.x,y},{x:l.x,y}];i[d]===p?f=d==="x"?S:E:f=d==="x"?E:S}else{const S=[{x:c.x,y:l.y}],E=[{x:l.x,y:c.y}];if(d==="x"?f=i.x===p?E:S:f=i.y===p?S:E,t===r){const P=Math.abs(e[d]-n[d]);if(P<=o){const A=Math.min(o-1,o-P);i[d]===p?v[d]=(c[d]>e[d]?-1:1)*A:b[d]=(l[d]>n[d]?-1:1)*A}}if(t!==r){const P=d==="x"?"y":"x",A=i[d]===s[P],C=c[P]>l[P],I=c[P]<l[P];(i[d]===1&&(!A&&C||A&&I)||i[d]!==1&&(!A&&I||A&&C))&&(f=d==="x"?S:E)}const O={x:c.x+v.x,y:c.y+v.y},N={x:l.x+b.x,y:l.y+b.y},M=Math.max(Math.abs(O.x-f[0].x),Math.abs(N.x-f[0].x)),k=Math.max(Math.abs(O.y-f[0].y),Math.abs(N.y-f[0].y));M>=k?(m=(O.x+N.x)/2,y=f[0].y):(m=f[0].x,y=(O.y+N.y)/2)}return[[e,{x:c.x+v.x,y:c.y+v.y},...f,{x:l.x+b.x,y:l.y+b.y},n],m,y,x,_]}function Tce(e,t,n,r){const a=Math.min(r5(e,t)/2,r5(t,n)/2,r),{x:o,y:i}=t;if(e.x===o&&o===n.x||e.y===i&&i===n.y)return`L${o} ${i}`;if(e.y===i){const l=e.x<n.x?-1:1,u=e.y<n.y?1:-1;return`L ${o+a*l},${i}Q ${o},${i} ${o},${i+a*u}`}const s=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${o},${i+a*c}Q ${o},${i} ${o+a*s},${i}`}function __({sourceX:e,sourceY:t,sourcePosition:n=he.Bottom,targetX:r,targetY:a,targetPosition:o=he.Top,borderRadius:i=5,centerX:s,centerY:c,offset:l=20}){const[u,d,p,f,m]=Ace({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:a},targetPosition:o,center:{x:s,y:c},offset:l});return[u.reduce((y,v,b)=>{let w="";return b>0&&b<u.length-1?w=Tce(u[b-1],v,u[b+1],i):w=`${b===0?"M":"L"}${v.x} ${v.y}`,y+=w,y},""),d,p,f,m]}function a5(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Ice(e){var d;const{sourceNode:t,targetNode:n}=e;if(!a5(t)||!a5(n))return null;const r=t.internals.handleBounds||o5(t.handles),a=n.internals.handleBounds||o5(n.handles),o=i5((r==null?void 0:r.source)??[],e.sourceHandle),i=i5(e.connectionMode===Sc.Strict?(a==null?void 0:a.target)??[]:((a==null?void 0:a.target)??[]).concat((a==null?void 0:a.source)??[]),e.targetHandle);if(!o||!i)return(d=e.onError)==null||d.call(e,"008",Io.error008(o?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const s=(o==null?void 0:o.position)||he.Bottom,c=(i==null?void 0:i.position)||he.Top,l=_d(t,o,s),u=_d(n,i,c);return{sourceX:l.x,sourceY:l.y,targetX:u.x,targetY:u.y,sourcePosition:s,targetPosition:c}}function o5(e){if(!e)return null;const t=[],n=[];for(const r of e)r.width=r.width??1,r.height=r.height??1,r.type==="source"?t.push(r):r.type==="target"&&n.push(r);return{source:t,target:n}}function _d(e,t,n=he.Left,r=!1){const a=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,o=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:i,height:s}=t??Ro(e);if(r)return{x:a+i/2,y:o+s/2};switch((t==null?void 0:t.position)??n){case he.Top:return{x:a+i/2,y:o};case he.Right:return{x:a+i,y:o+s/2};case he.Bottom:return{x:a+i/2,y:o+s};case he.Left:return{x:a,y:o+s/2}}}function i5(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function j_(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(n=>`${n}=${e[n]}`).join("&")}`:""}function Rce(e,{id:t,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:a}){const o=new Set;return e.reduce((i,s)=>([s.markerStart||r,s.markerEnd||a].forEach(c=>{if(c&&typeof c=="object"){const l=j_(c,t);o.has(l)||(i.push({id:l,color:c.color||n,...c}),o.add(l))}}),i),[]).sort((i,s)=>i.id.localeCompare(s.id))}const S_={nodeOrigin:[0,0],nodeExtent:md,elevateNodesOnSelect:!0,defaults:{}},Dce={...S_,checkEquality:!0};function E_(e,t){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}function Lce(e,t,n){const r=E_(S_,n);for(const a of e.values())if(a.parentId)C_(a,e,t,r);else{const o=gd(a,r.nodeOrigin),i=Cc(a.extent)?a.extent:r.nodeExtent,s=ds(o,i,Ro(a));a.internals.positionAbsolute=s}}function O_(e,t,n,r){var s,c;const a=E_(Dce,r),o=new Map(t),i=a!=null&&a.elevateNodesOnSelect?1e3:0;t.clear(),n.clear();for(const l of e){let u=o.get(l.id);if(a.checkEquality&&l===(u==null?void 0:u.internals.userNode))t.set(l.id,u);else{const d=gd(l,a.nodeOrigin),p=Cc(l.extent)?l.extent:a.nodeExtent,f=ds(d,p,Ro(l));u={...a.defaults,...l,measured:{width:(s=l.measured)==null?void 0:s.width,height:(c=l.measured)==null?void 0:c.height},internals:{positionAbsolute:f,handleBounds:l.measured?u==null?void 0:u.internals.handleBounds:void 0,z:s5(l,i),userNode:l}},t.set(l.id,u)}l.parentId&&C_(u,t,n,r)}}function $ce(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function C_(e,t,n,r){const{elevateNodesOnSelect:a,nodeOrigin:o,nodeExtent:i}=E_(S_,r),s=e.parentId,c=t.get(s);if(!c){console.warn(`Parent node ${s} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}$ce(e,n);const l=a?1e3:0,{x:u,y:d,z:p}=Fce(e,c,o,i,l),{positionAbsolute:f}=e.internals,m=u!==f.x||d!==f.y;(m||p!==e.internals.z)&&(e.internals={...e.internals,positionAbsolute:m?{x:u,y:d}:f,z:p})}function s5(e,t){return(aa(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function Fce(e,t,n,r,a){const{x:o,y:i}=t.internals.positionAbsolute,s=Ro(e),c=gd(e,n),l=Cc(e.extent)?ds(c,e.extent,s):c;let u=ds({x:o+l.x,y:i+l.y},r,s);e.extent==="parent"&&(u=F4(u,s,t));const d=s5(e,a),p=t.internals.z??0;return{x:u.x,y:u.y,z:p>d?p:d}}function N_(e,t,n,r=[0,0]){var i;const a=[],o=new Map;for(const s of e){const c=t.get(s.parentId);if(!c)continue;const l=((i=o.get(s.parentId))==null?void 0:i.expandedRect)??Oc(c),u=U4(l,s.rect);o.set(s.parentId,{expandedRect:u,parent:c})}return o.size>0&&o.forEach(({expandedRect:s,parent:c},l)=>{var j;const u=c.internals.positionAbsolute,d=Ro(c),p=c.origin??r,f=s.x<u.x?Math.round(Math.abs(u.x-s.x)):0,m=s.y<u.y?Math.round(Math.abs(u.y-s.y)):0,y=Math.max(d.width,Math.round(s.width)),v=Math.max(d.height,Math.round(s.height)),b=(y-d.width)*p[0],w=(v-d.height)*p[1];(f>0||m>0||b||w)&&(a.push({id:l,type:"position",position:{x:c.position.x-f+b,y:c.position.y-m+w}}),(j=n.get(l))==null||j.forEach(x=>{e.some(_=>_.id===x.id)||a.push({id:x.id,type:"position",position:{x:x.position.x+f,y:x.position.y+m}})})),(d.width<s.width||d.height<s.height||f||m)&&a.push({id:l,type:"dimensions",setAttributes:!0,dimensions:{width:y+(f?p[0]*f-b:0),height:v+(m?p[1]*m-w:0)}})}),a}function Bce(e,t,n,r,a,o){const i=r==null?void 0:r.querySelector(".xyflow__viewport");let s=!1;if(!i)return{changes:[],updatedInternals:s};const c=[],l=window.getComputedStyle(i),{m22:u}=new window.DOMMatrixReadOnly(l.transform),d=[];for(const p of e.values()){const f=t.get(p.id);if(f)if(f.hidden)f.internals={...f.internals,handleBounds:void 0},s=!0;else{const m=um(p.nodeElement),y=f.measured.width!==m.width||f.measured.height!==m.height;if(m.width&&m.height&&(y||!f.internals.handleBounds||p.force)){const v=p.nodeElement.getBoundingClientRect(),b=Cc(f.extent)?f.extent:o;let{positionAbsolute:w}=f.internals;f.parentId&&f.extent==="parent"?w=F4(w,m,t.get(f.parentId)):b&&(w=ds(w,b,m)),f.measured=m,f.internals={...f.internals,positionAbsolute:w,handleBounds:{source:G4("source",p.nodeElement,v,u,f.id),target:G4("target",p.nodeElement,v,u,f.id)}},f.parentId&&C_(f,t,n,{nodeOrigin:a}),s=!0,y&&(c.push({id:f.id,type:"dimensions",dimensions:m}),f.expandParent&&f.parentId&&d.push({id:f.id,parentId:f.parentId,rect:Oc(f,a)}))}}}if(d.length>0){const p=N_(d,t,n,a);c.push(...p)}return{changes:c,updatedInternals:s}}async function zce({delta:e,panZoom:t,transform:n,translateExtent:r,width:a,height:o}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[a,o]],r),s=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(s)}function c5(e,t,n){e.clear(),t.clear();for(const r of n){const{source:a,target:o,sourceHandle:i=null,targetHandle:s=null}=r,c=`${a}-source-${i}`,l=`${o}-target-${s}`,u=e.get(c)||new Map,d=e.get(l)||new Map,p={edgeId:r.id,source:a,target:o,sourceHandle:i,targetHandle:s};t.set(r.id,r),e.set(c,u.set(`${o}-${s}`,p)),e.set(l,d.set(`${a}-${i}`,p))}}function l5(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:l5(n,t):!1}function u5(e,t,n){let r=e;do{if(r!=null&&r.matches(t))return!0;if(r===n)return!1;r=r.parentElement}while(r);return!1}function Uce(e,t,n,r){const a=new Map;for(const[o,i]of e)if((i.selected||i.id===r)&&(!i.parentId||!l5(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const s=e.get(o);s&&a.set(o,{id:o,position:s.position||{x:0,y:0},distance:{x:n.x-s.internals.positionAbsolute.x,y:n.y-s.internals.positionAbsolute.y},extent:s.extent,parentId:s.parentId,origin:s.origin,expandParent:s.expandParent,internals:{positionAbsolute:s.internals.positionAbsolute||{x:0,y:0}},measured:{width:s.measured.width??0,height:s.measured.height??0}})}return a}function M_({nodeId:e,dragItems:t,nodeLookup:n,dragging:r=!0}){var i,s,c;const a=[];for(const[l,u]of t){const d=(i=n.get(l))==null?void 0:i.internals.userNode;d&&a.push({...d,position:u.position,dragging:r})}if(!e)return[a[0],a];const o=(s=n.get(e))==null?void 0:s.internals.userNode;return[o?{...o,position:((c=t.get(e))==null?void 0:c.position)||o.position,dragging:r}:a[0],a]}function Vce({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:r,onDragStop:a}){let o={x:null,y:null},i=0,s=new Map,c=!1,l={x:0,y:0},u=null,d=!1,p=null,f=!1;function m({noDragClassName:v,handleSelector:b,domNode:w,isSelectable:j,nodeId:x,nodeClickDistance:_=0}){p=vr(w);function S({x:M,y:k},P){const{nodeLookup:A,nodeExtent:C,snapGrid:I,snapToGrid:T,nodeOrigin:R,onNodeDrag:L,onSelectionDrag:D,onError:z,updateNodePositions:B}=t();o={x:M,y:k};let $=!1,U={x:0,y:0,x2:0,y2:0};if(s.size>1&&C){const F=vd(s);U=b_(F)}for(const[F,H]of s){if(!A.has(F))continue;let re={x:M-H.distance.x,y:k-H.distance.y};T&&(re=cm(re,I));let ee=[[C[0][0],C[0][1]],[C[1][0],C[1][1]]];if(s.size>1&&C&&!H.extent){const{positionAbsolute:X}=H.internals,ne=X.x-U.x+C[0][0],V=X.x+H.measured.width-U.x2+C[1][0],le=X.y-U.y+C[0][1],ae=X.y+H.measured.height-U.y2+C[1][1];ee=[[ne,le],[V,ae]]}const{position:G,positionAbsolute:K}=$4({nodeId:F,nextPosition:re,nodeLookup:A,nodeExtent:ee,nodeOrigin:R,onError:z});$=$||H.position.x!==G.x||H.position.y!==G.y,H.position=G,H.internals.positionAbsolute=K}if($&&(B(s,!0),P&&(r||L||!x&&D))){const[F,H]=M_({nodeId:x,dragItems:s,nodeLookup:A});r==null||r(P,s,F,H),L==null||L(P,F,H),x||(D==null||D(P,H))}}async function E(){if(!u)return;const{transform:M,panBy:k,autoPanSpeed:P}=t(),[A,C]=z4(l,u,P);(A!==0||C!==0)&&(o.x=(o.x??0)-A/M[2],o.y=(o.y??0)-C/M[2],await k({x:A,y:C})&&S(o,null)),i=requestAnimationFrame(E)}function O(M){var $;const{nodeLookup:k,multiSelectionActive:P,nodesDraggable:A,transform:C,snapGrid:I,snapToGrid:T,selectNodesOnDrag:R,onNodeDragStart:L,onSelectionDragStart:D,unselectNodesAndEdges:z}=t();d=!0,(!R||!j)&&!P&&x&&(($=k.get(x))!=null&&$.selected||z()),j&&R&&x&&(e==null||e(x));const B=xd(M.sourceEvent,{transform:C,snapGrid:I,snapToGrid:T,containerBounds:u});if(o=B,s=Uce(k,A,B,x),s.size>0&&(n||L||!x&&D)){const[U,F]=M_({nodeId:x,dragItems:s,nodeLookup:k});n==null||n(M.sourceEvent,s,U,F),L==null||L(M.sourceEvent,U,F),x||(D==null||D(M.sourceEvent,F))}}const N=Q3().clickDistance(_).on("start",M=>{const{domNode:k,nodeDragThreshold:P,transform:A,snapGrid:C,snapToGrid:I}=t();u=(k==null?void 0:k.getBoundingClientRect())||null,f=!1,P===0&&O(M),o=xd(M.sourceEvent,{transform:A,snapGrid:C,snapToGrid:I,containerBounds:u}),l=Do(M.sourceEvent,u)}).on("drag",M=>{const{autoPanOnNodeDrag:k,transform:P,snapGrid:A,snapToGrid:C,nodeDragThreshold:I,nodeLookup:T}=t(),R=xd(M.sourceEvent,{transform:P,snapGrid:A,snapToGrid:C,containerBounds:u});if((M.sourceEvent.type==="touchmove"&&M.sourceEvent.touches.length>1||x&&!T.has(x))&&(f=!0),!f){if(!c&&k&&d&&(c=!0,E()),!d){const L=R.xSnapped-(o.x??0),D=R.ySnapped-(o.y??0);Math.sqrt(L*L+D*D)>I&&O(M)}(o.x!==R.xSnapped||o.y!==R.ySnapped)&&s&&d&&(l=Do(M.sourceEvent,u),S(R,M.sourceEvent))}}).on("end",M=>{if(!(!d||f)&&(c=!1,d=!1,cancelAnimationFrame(i),s.size>0)){const{nodeLookup:k,updateNodePositions:P,onNodeDragStop:A,onSelectionDragStop:C}=t();if(P(s,!1),a||A||!x&&C){const[I,T]=M_({nodeId:x,dragItems:s,nodeLookup:k,dragging:!1});a==null||a(M.sourceEvent,s,I,T),A==null||A(M.sourceEvent,I,T),x||(C==null||C(M.sourceEvent,T))}}}).filter(M=>{const k=M.target;return!M.button&&(!v||!u5(k,`.${v}`,w))&&(!b||u5(k,b,w))});p.call(N)}function y(){p==null||p.on(".drag",null)}return{update:m,destroy:y}}function qce(e,t,n){const r=[],a={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const o of t.values())bd(a,Oc(o))>0&&r.push(o);return r}const Wce=250;function Hce(e,t,n,r){var s,c;let a=[],o=1/0;const i=qce(e,n,t+Wce);for(const l of i){const u=[...((s=l.internals.handleBounds)==null?void 0:s.source)??[],...((c=l.internals.handleBounds)==null?void 0:c.target)??[]];for(const d of u){if(r.nodeId===d.nodeId&&r.type===d.type&&r.id===d.id)continue;const{x:p,y:f}=_d(l,d,d.position,!0),m=Math.sqrt(Math.pow(p-e.x,2)+Math.pow(f-e.y,2));m>t||(m<o?(a=[{...d,x:p,y:f}],o=m):m===o&&a.push({...d,x:p,y:f}))}}if(!a.length)return null;if(a.length>1){const l=r.type==="source"?"target":"source";return a.find(u=>u.type===l)??a[0]}return a[0]}function d5(e,t,n,r,a,o=!1){var l,u,d;const i=r.get(e);if(!i)return null;const s=a==="strict"?(l=i.internals.handleBounds)==null?void 0:l[t]:[...((u=i.internals.handleBounds)==null?void 0:u.source)??[],...((d=i.internals.handleBounds)==null?void 0:d.target)??[]],c=(n?s==null?void 0:s.find(p=>p.id===n):s==null?void 0:s[0])??null;return c&&o?{...c,..._d(i,c,c.position,!0)}:c}function p5(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Kce(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const f5=()=>!0;function Zce(e,{connectionMode:t,connectionRadius:n,handleId:r,nodeId:a,edgeUpdaterType:o,isTarget:i,domNode:s,nodeLookup:c,lib:l,autoPanOnConnect:u,flowId:d,panBy:p,cancelConnection:f,onConnectStart:m,onConnect:y,onConnectEnd:v,isValidConnection:b=f5,onReconnectEnd:w,updateConnection:j,getTransform:x,getFromHandle:_,autoPanSpeed:S}){const E=K4(e.target);let O=0,N;const{x:M,y:k}=Do(e),P=E==null?void 0:E.elementFromPoint(M,k),A=p5(o,P),C=s==null?void 0:s.getBoundingClientRect();if(!C||!A)return;const I=d5(a,A,r,c,t);if(!I)return;let T=Do(e,C),R=!1,L=null,D=!1,z=null;function B(){if(!u||!C)return;const[G,K]=z4(T,C,S);p({x:G,y:K}),O=requestAnimationFrame(B)}const $={...I,nodeId:a,type:A,position:I.position},U=c.get(a),F={inProgress:!0,isValid:null,from:_d(U,$,he.Left,!0),fromHandle:$,fromPosition:$.position,fromNode:U,to:T,toHandle:null,toPosition:T4[$.position],toNode:null};j(F);let H=F;m==null||m(e,{nodeId:a,handleId:r,handleType:A});function re(G){if(!_()||!$){ee(G);return}const K=x();T=Do(G,C),N=Hce(wd(T,K,!1,[1,1]),n,c,$),R||(B(),R=!0);const X=h5(G,{handle:N,connectionMode:t,fromNodeId:a,fromHandleId:r,fromType:i?"target":"source",isValidConnection:b,doc:E,lib:l,flowId:d,nodeLookup:c});z=X.handleDomNode,L=X.connection,D=Kce(!!N,X.isValid);const ne={...H,isValid:D,to:N&&D?q4({x:N.x,y:N.y},K):T,toHandle:X.toHandle,toPosition:D&&X.toHandle?X.toHandle.position:T4[$.position],toNode:X.toHandle?c.get(X.toHandle.nodeId):null};D&&N&&H.toHandle&&ne.toHandle&&H.toHandle.type===ne.toHandle.type&&H.toHandle.nodeId===ne.toHandle.nodeId&&H.toHandle.id===ne.toHandle.id&&H.to.x===ne.to.x&&H.to.y===ne.to.y||(j(ne),H=ne)}function ee(G){(N||z)&&L&&D&&(y==null||y(L));const{inProgress:K,...X}=H,ne={...X,toPosition:H.toHandle?H.toPosition:null};v==null||v(G,ne),o&&(w==null||w(G,ne)),f(),cancelAnimationFrame(O),R=!1,D=!1,L=null,z=null,E.removeEventListener("mousemove",re),E.removeEventListener("mouseup",ee),E.removeEventListener("touchmove",re),E.removeEventListener("touchend",ee)}E.addEventListener("mousemove",re),E.addEventListener("mouseup",ee),E.addEventListener("touchmove",re),E.addEventListener("touchend",ee)}function h5(e,{handle:t,connectionMode:n,fromNodeId:r,fromHandleId:a,fromType:o,doc:i,lib:s,flowId:c,isValidConnection:l=f5,nodeLookup:u}){const d=o==="target",p=t?i.querySelector(`.${s}-flow__handle[data-id="${c}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:f,y:m}=Do(e),y=i.elementFromPoint(f,m),v=y!=null&&y.classList.contains(`${s}-flow__handle`)?y:p,b={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const w=p5(void 0,v),j=v.getAttribute("data-nodeid"),x=v.getAttribute("data-handleid"),_=v.classList.contains("connectable"),S=v.classList.contains("connectableend");if(!j||!w)return b;const E={source:d?j:r,sourceHandle:d?x:a,target:d?r:j,targetHandle:d?a:x};b.connection=E;const O=_&&S&&(n===Sc.Strict?d&&w==="source"||!d&&w==="target":j!==r||x!==a);b.isValid=O&&l(E),b.toHandle=d5(j,w,x,u,n,!1)}return b}const k_={onPointerDown:Zce,isValid:h5};function Gce({domNode:e,panZoom:t,getTransform:n,getViewScale:r}){const a=vr(e);function o({translateExtent:s,width:c,height:l,zoomStep:u=10,pannable:d=!0,zoomable:p=!0,inversePan:f=!1}){const m=j=>{const x=n();if(j.sourceEvent.type!=="wheel"||!t)return;const _=-j.sourceEvent.deltaY*(j.sourceEvent.deltaMode===1?.05:j.sourceEvent.deltaMode?1:.002)*u,S=x[2]*Math.pow(2,_);t.scaleTo(S)};let y=[0,0];const v=j=>{(j.sourceEvent.type==="mousedown"||j.sourceEvent.type==="touchstart")&&(y=[j.sourceEvent.clientX??j.sourceEvent.touches[0].clientX,j.sourceEvent.clientY??j.sourceEvent.touches[0].clientY])},b=j=>{const x=n();if(j.sourceEvent.type!=="mousemove"&&j.sourceEvent.type!=="touchmove"||!t)return;const _=[j.sourceEvent.clientX??j.sourceEvent.touches[0].clientX,j.sourceEvent.clientY??j.sourceEvent.touches[0].clientY],S=[_[0]-y[0],_[1]-y[1]];y=_;const E=r()*Math.max(x[2],Math.log(x[2]))*(f?-1:1),O={x:x[0]-S[0]*E,y:x[1]-S[1]*E},N=[[0,0],[c,l]];t.setViewportConstrained({x:O.x,y:O.y,zoom:x[2]},N,s)},w=k4().on("start",v).on("zoom",d?b:null).on("zoom.wheel",p?m:null);a.call(w,{})}function i(){a.on("zoom",null)}return{update:o,destroy:i,pointer:ea}}const Xce=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,pm=e=>({x:e.x,y:e.y,zoom:e.k}),P_=({x:e,y:t,zoom:n})=>rm.translate(e,t).scale(n),Nc=(e,t)=>e.target.closest(`.${t}`),m5=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),A_=(e,t=0,n=()=>{})=>{const r=typeof t=="number"&&t>0;return r||n(),r?e.transition().duration(t).on("end",n):e},y5=e=>{const t=e.ctrlKey&&lm()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Jce({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:r,panOnScrollMode:a,panOnScrollSpeed:o,zoomOnPinch:i,onPanZoomStart:s,onPanZoom:c,onPanZoomEnd:l}){return u=>{if(Nc(u,t))return!1;u.preventDefault(),u.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(u.ctrlKey&&i){const v=ea(u),b=y5(u),w=d*Math.pow(2,b);r.scaleTo(n,w,v,u);return}const p=u.deltaMode===1?20:1;let f=a===mi.Vertical?0:u.deltaX*p,m=a===mi.Horizontal?0:u.deltaY*p;!lm()&&u.shiftKey&&a!==mi.Vertical&&(f=u.deltaY*p,m=0),r.translateBy(n,-(f/d)*o,-(m/d)*o,{internal:!0});const y=pm(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,s==null||s(u,y)),e.isPanScrolling&&(c==null||c(u,y),e.panScrollTimeout=setTimeout(()=>{l==null||l(u,y),e.isPanScrolling=!1},150))}}function Yce({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(r,a){if(!t&&r.type==="wheel"&&!r.ctrlKey||Nc(r,e))return null;r.preventDefault(),n.call(this,r,a)}}function Qce({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return r=>{var o,i,s;if((o=r.sourceEvent)!=null&&o.internal)return;const a=pm(r.transform);e.mouseButton=((i=r.sourceEvent)==null?void 0:i.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=a,((s=r.sourceEvent)==null?void 0:s.type)==="mousedown"&&t(!0),n&&(n==null||n(r.sourceEvent,a))}}function ele({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:r,onPanZoom:a}){return o=>{var i,s;e.usedRightMouseButton=!!(n&&m5(t,e.mouseButton??0)),(i=o.sourceEvent)!=null&&i.sync||r([o.transform.x,o.transform.y,o.transform.k]),a&&!((s=o.sourceEvent)!=null&&s.internal)&&(a==null||a(o.sourceEvent,pm(o.transform)))}}function tle({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:a,onPaneContextMenu:o}){return i=>{var s;if(!((s=i.sourceEvent)!=null&&s.internal)&&(e.isZoomingOrPanning=!1,o&&m5(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&o(i.sourceEvent),e.usedRightMouseButton=!1,r(!1),a&&Xce(e.prevViewport,i.transform))){const c=pm(i.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{a==null||a(i.sourceEvent,c)},n?150:0)}}}function nle({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:r,panOnScroll:a,zoomOnDoubleClick:o,userSelectionActive:i,noWheelClassName:s,noPanClassName:c,lib:l}){return u=>{var m;const d=e||t,p=n&&u.ctrlKey;if(u.button===1&&u.type==="mousedown"&&(Nc(u,`${l}-flow__node`)||Nc(u,`${l}-flow__edge`)))return!0;if(!r&&!d&&!a&&!o&&!n||i||Nc(u,s)&&u.type==="wheel"||Nc(u,c)&&(u.type!=="wheel"||a&&u.type==="wheel"&&!e)||!n&&u.ctrlKey&&u.type==="wheel")return!1;if(!n&&u.type==="touchstart"&&((m=u.touches)==null?void 0:m.length)>1)return u.preventDefault(),!1;if(!d&&!a&&!p&&u.type==="wheel"||!r&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(r)&&!r.includes(u.button)&&u.type==="mousedown")return!1;const f=Array.isArray(r)&&r.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||u.type==="wheel")&&f}}function rle({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:r,translateExtent:a,viewport:o,onPanZoom:i,onPanZoomStart:s,onPanZoomEnd:c,onDraggingChange:l}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),p=k4().clickDistance(!aa(r)||r<0?0:r).scaleExtent([t,n]).translateExtent(a),f=vr(e).call(p);j({x:o.x,y:o.y,zoom:Ec(o.zoom,t,n)},[[0,0],[d.width,d.height]],a);const m=f.on("wheel.zoom"),y=f.on("dblclick.zoom");p.wheelDelta(y5);function v(P,A){return f?new Promise(C=>{p==null||p.transform(A_(f,A==null?void 0:A.duration,()=>C(!0)),P)}):Promise.resolve(!1)}function b({noWheelClassName:P,noPanClassName:A,onPaneContextMenu:C,userSelectionActive:I,panOnScroll:T,panOnDrag:R,panOnScrollMode:L,panOnScrollSpeed:D,preventScrolling:z,zoomOnPinch:B,zoomOnScroll:$,zoomOnDoubleClick:U,zoomActivationKeyPressed:F,lib:H,onTransformChange:re}){I&&!u.isZoomingOrPanning&&w();const ee=T&&!F&&!I?Jce({zoomPanValues:u,noWheelClassName:P,d3Selection:f,d3Zoom:p,panOnScrollMode:L,panOnScrollSpeed:D,zoomOnPinch:B,onPanZoomStart:s,onPanZoom:i,onPanZoomEnd:c}):Yce({noWheelClassName:P,preventScrolling:z,d3ZoomHandler:m});if(f.on("wheel.zoom",ee,{passive:!1}),!I){const K=Qce({zoomPanValues:u,onDraggingChange:l,onPanZoomStart:s});p.on("start",K);const X=ele({zoomPanValues:u,panOnDrag:R,onPaneContextMenu:!!C,onPanZoom:i,onTransformChange:re});p.on("zoom",X);const ne=tle({zoomPanValues:u,panOnDrag:R,panOnScroll:T,onPaneContextMenu:C,onPanZoomEnd:c,onDraggingChange:l});p.on("end",ne)}const G=nle({zoomActivationKeyPressed:F,panOnDrag:R,zoomOnScroll:$,panOnScroll:T,zoomOnDoubleClick:U,zoomOnPinch:B,userSelectionActive:I,noPanClassName:A,noWheelClassName:P,lib:H});p.filter(G),U?f.on("dblclick.zoom",y):f.on("dblclick.zoom",null)}function w(){p.on("zoom",null)}async function j(P,A,C){const I=P_(P),T=p==null?void 0:p.constrain()(I,A,C);return T&&await v(T),new Promise(R=>R(T))}async function x(P,A){const C=P_(P);return await v(C,A),new Promise(I=>I(C))}function _(P){if(f){const A=P_(P),C=f.property("__zoom");(C.k!==P.zoom||C.x!==P.x||C.y!==P.y)&&(p==null||p.transform(f,A,null,{sync:!0}))}}function S(){const P=f?N4(f.node()):{x:0,y:0,k:1};return{x:P.x,y:P.y,zoom:P.k}}function E(P,A){return f?new Promise(C=>{p==null||p.scaleTo(A_(f,A==null?void 0:A.duration,()=>C(!0)),P)}):Promise.resolve(!1)}function O(P,A){return f?new Promise(C=>{p==null||p.scaleBy(A_(f,A==null?void 0:A.duration,()=>C(!0)),P)}):Promise.resolve(!1)}function N(P){p==null||p.scaleExtent(P)}function M(P){p==null||p.translateExtent(P)}function k(P){const A=!aa(P)||P<0?0:P;p==null||p.clickDistance(A)}return{update:b,destroy:w,setViewport:x,setViewportConstrained:j,getViewport:S,scaleTo:E,scaleBy:O,setScaleExtent:N,setTranslateExtent:M,syncViewport:_,setClickDistance:k}}var Mc;(function(e){e.Line="line",e.Handle="handle"})(Mc||(Mc={}));const ale=["top-left","top-right","bottom-left","bottom-right"],ole=["top","right","bottom","left"];function ile({width:e,prevWidth:t,height:n,prevHeight:r,affectsX:a,affectsY:o}){const i=e-t,s=n-r,c=[i>0?1:i<0?-1:0,s>0?1:s<0?-1:0];return i&&a&&(c[0]=c[0]*-1),s&&o&&(c[1]=c[1]*-1),c}function sle(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),r=e.includes("left"),a=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:r,affectsY:a}}function gi(e,t){return Math.max(0,t-e)}function vi(e,t){return Math.max(0,e-t)}function fm(e,t,n){return Math.max(0,t-e,e-n)}function g5(e,t){return e?!t:t}function cle(e,t,n,r,a,o,i,s){let{affectsX:c,affectsY:l}=t;const{isHorizontal:u,isVertical:d}=t,p=u&&d,{xSnapped:f,ySnapped:m}=n,{minWidth:y,maxWidth:v,minHeight:b,maxHeight:w}=r,{x:j,y:x,width:_,height:S,aspectRatio:E}=e;let O=Math.floor(u?f-e.pointerX:0),N=Math.floor(d?m-e.pointerY:0);const M=_+(c?-O:O),k=S+(l?-N:N),P=-o[0]*_,A=-o[1]*S;let C=fm(M,y,v),I=fm(k,b,w);if(i){let L=0,D=0;c&&O<0?L=gi(j+O+P,i[0][0]):!c&&O>0&&(L=vi(j+M+P,i[1][0])),l&&N<0?D=gi(x+N+A,i[0][1]):!l&&N>0&&(D=vi(x+k+A,i[1][1])),C=Math.max(C,L),I=Math.max(I,D)}if(s){let L=0,D=0;c&&O>0?L=vi(j+O,s[0][0]):!c&&O<0&&(L=gi(j+M,s[1][0])),l&&N>0?D=vi(x+N,s[0][1]):!l&&N<0&&(D=gi(x+k,s[1][1])),C=Math.max(C,L),I=Math.max(I,D)}if(a){if(u){const L=fm(M/E,b,w)*E;if(C=Math.max(C,L),i){let D=0;!c&&!l||c&&!l&&p?D=vi(x+A+M/E,i[1][1])*E:D=gi(x+A+(c?O:-O)/E,i[0][1])*E,C=Math.max(C,D)}if(s){let D=0;!c&&!l||c&&!l&&p?D=gi(x+M/E,s[1][1])*E:D=vi(x+(c?O:-O)/E,s[0][1])*E,C=Math.max(C,D)}}if(d){const L=fm(k*E,y,v)/E;if(I=Math.max(I,L),i){let D=0;!c&&!l||l&&!c&&p?D=vi(j+k*E+P,i[1][0])/E:D=gi(j+(l?N:-N)*E+P,i[0][0])/E,I=Math.max(I,D)}if(s){let D=0;!c&&!l||l&&!c&&p?D=gi(j+k*E,s[1][0])/E:D=vi(j+(l?N:-N)*E,s[0][0])/E,I=Math.max(I,D)}}}N=N+(N<0?I:-I),O=O+(O<0?C:-C),a&&(p?M>k*E?N=(g5(c,l)?-O:O)/E:O=(g5(c,l)?-N:N)*E:u?(N=O/E,l=c):(O=N*E,c=l));const T=c?j+O:j,R=l?x+N:x;return{width:_+(c?-O:O),height:S+(l?-N:N),x:o[0]*O*(c?-1:1)+T,y:o[1]*N*(l?-1:1)+R}}const v5={width:0,height:0,x:0,y:0},lle={...v5,pointerX:0,pointerY:0,aspectRatio:1};function ule(e){return[[0,0],[e.measured.width,e.measured.height]]}function dle(e,t,n){const r=t.position.x+e.position.x,a=t.position.y+e.position.y,o=e.measured.width??0,i=e.measured.height??0,s=n[0]*o,c=n[1]*i;return[[r-s,a-c],[r+o-s,a+i-c]]}function ple({domNode:e,nodeId:t,getStoreItems:n,onChange:r,onEnd:a}){const o=vr(e);function i({controlPosition:c,boundaries:l,keepAspectRatio:u,onResizeStart:d,onResize:p,onResizeEnd:f,shouldResize:m}){let y={...v5},v={...lle};const b=sle(c);let w,j=null,x=[],_,S,E;const O=Q3().on("start",N=>{const{nodeLookup:M,transform:k,snapGrid:P,snapToGrid:A,nodeOrigin:C,paneDomNode:I}=n();if(w=M.get(t),!w)return;j=(I==null?void 0:I.getBoundingClientRect())??null;const{xSnapped:T,ySnapped:R}=xd(N.sourceEvent,{transform:k,snapGrid:P,snapToGrid:A,containerBounds:j});y={width:w.measured.width??0,height:w.measured.height??0,x:w.position.x??0,y:w.position.y??0},v={...y,pointerX:T,pointerY:R,aspectRatio:y.width/y.height},_=void 0,w.parentId&&(w.extent==="parent"||w.expandParent)&&(_=M.get(w.parentId),S=_&&w.extent==="parent"?ule(_):void 0),x=[],E=void 0;for(const[L,D]of M)if(D.parentId===t&&(x.push({id:L,position:{...D.position},extent:D.extent}),D.extent==="parent"||D.expandParent)){const z=dle(D,w,D.origin??C);E?E=[[Math.min(z[0][0],E[0][0]),Math.min(z[0][1],E[0][1])],[Math.max(z[1][0],E[1][0]),Math.max(z[1][1],E[1][1])]]:E=z}d==null||d(N,{...y})}).on("drag",N=>{const{transform:M,snapGrid:k,snapToGrid:P,nodeOrigin:A}=n(),C=xd(N.sourceEvent,{transform:M,snapGrid:k,snapToGrid:P,containerBounds:j}),I=[];if(!w)return;const{x:T,y:R,width:L,height:D}=y,z={},B=w.origin??A,{width:$,height:U,x:F,y:H}=cle(v,b,C,l,u,B,S,E),re=$!==L,ee=U!==D,G=F!==T&&re,K=H!==R&&ee;if(!G&&!K&&!re&&!ee)return;if((G||K||B[0]===1||B[1]===1)&&(z.x=G?F:y.x,z.y=K?H:y.y,y.x=z.x,y.y=z.y,x.length>0)){const V=F-T,le=H-R;for(const ae of x)ae.position={x:ae.position.x-V+B[0]*($-L),y:ae.position.y-le+B[1]*(U-D)},I.push(ae)}if((re||ee)&&(z.width=re?$:y.width,z.height=ee?U:y.height,y.width=z.width,y.height=z.height),_&&w.expandParent){const V=B[0]*(z.width??0);z.x&&z.x<V&&(y.x=V,v.x=v.x-(z.x-V));const le=B[1]*(z.height??0);z.y&&z.y<le&&(y.y=le,v.y=v.y-(z.y-le))}const X=ile({width:y.width,prevWidth:L,height:y.height,prevHeight:D,affectsX:b.affectsX,affectsY:b.affectsY}),ne={...y,direction:X};(m==null?void 0:m(N,ne))!==!1&&(p==null||p(N,ne),r(z,I))}).on("end",N=>{f==null||f(N,{...y}),a==null||a()});o.call(O)}function s(){o.on(".drag",null)}return{update:i,destroy:s}}var b5={exports:{}},T_={},w5;function fle(){if(w5)return T_;w5=1;var e=FG(),t=RI();function n(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:n,a=t.useSyncExternalStore,o=e.useRef,i=e.useEffect,s=e.useMemo,c=e.useDebugValue;return T_.useSyncExternalStoreWithSelector=function(l,u,d,p,f){var m=o(null);if(m.current===null){var y={hasValue:!1,value:null};m.current=y}else y=m.current;m=s(function(){function b(S){if(!w){if(w=!0,j=S,S=p(S),f!==void 0&&y.hasValue){var E=y.value;if(f(E,S))return x=E}return x=S}if(E=x,r(j,S))return E;var O=p(S);return f!==void 0&&f(E,O)?E:(j=S,x=O)}var w=!1,j,x,_=d===void 0?null:d;return[function(){return b(u())},_===null?void 0:function(){return b(_())}]},[u,d,p,f]);var v=a(l,m[0],m[1]);return i(function(){y.hasValue=!0,y.value=v},[v]),c(v),v},T_}var x5;function hle(){return x5||(x5=1,b5.exports=fle()),b5.exports}var mle=hle();let _5,I_,j5,S5,E5,O5;ek=st(mle),_5={BASE_URL:"/NoLLMChat/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_URL:"/NoLLMChat/",VITE_ROUTE_MODE:"hash"},I_=e=>{let t;const n=new Set,r=(s,c)=>{const l=typeof s=="function"?s(t):s;if(!Object.is(l,t)){const u=t;t=c??(typeof l!="object"||l===null)?l:Object.assign({},t,l),n.forEach(d=>d(t,u))}},a=()=>t,o={setState:r,getState:a,getInitialState:()=>i,subscribe:s=>(n.add(s),()=>n.delete(s)),destroy:()=>{(_5?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},i=t=e(r,a,o);return o},j5=e=>e?I_(e):I_,{useDebugValue:S5}=W,{useSyncExternalStoreWithSelector:E5}=ek,O5=e=>e;function C5(e,t=O5,n){const r=E5(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return S5(r),r}const N5=(e,t)=>{const n=j5(e),r=(a,o=t)=>C5(n,a,o);return Object.assign(r,n),r},yle=(e,t)=>e?N5(e,t):N5;function Ut(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,a]of e)if(!Object.is(a,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}const hm=g.createContext(null),gle=hm.Provider,M5=Io.error001();function tt(e,t){const n=g.useContext(hm);if(n===null)throw new Error(M5);return C5(n,e,t)}function Lt(){const e=g.useContext(hm);if(e===null)throw new Error(M5);return g.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const k5={display:"none"},vle={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},P5="react-flow__node-desc",A5="react-flow__edge-desc",ble="react-flow__aria-live",wle=e=>e.ariaLiveMessage;function xle({rfId:e}){const t=tt(wle);return h.jsx("div",{id:`${ble}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:vle,children:t})}function _le({rfId:e,disableKeyboardA11y:t}){return h.jsxs(h.Fragment,{children:[h.jsxs("div",{id:`${P5}-${e}`,style:k5,children:["Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "]}),h.jsx("div",{id:`${A5}-${e}`,style:k5,children:"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."}),!t&&h.jsx(xle,{rfId:e})]})}const jle=e=>e.userSelectionActive?"none":"all";function kc({position:e="top-left",children:t,className:n,style:r,...a}){const o=tt(jle),i=`${e}`.split("-");return h.jsx("div",{className:rn(["react-flow__panel",n,...i]),style:{...r,pointerEvents:o},...a,children:t})}function Sle({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:h.jsx(kc,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:h.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Ele=e=>{const t=[],n=[];for(const[,r]of e.nodeLookup)r.selected&&t.push(r.internals.userNode);for(const[,r]of e.edgeLookup)r.selected&&n.push(r);return{selectedNodes:t,selectedEdges:n}},mm=e=>e.id;function Ole(e,t){return Ut(e.selectedNodes.map(mm),t.selectedNodes.map(mm))&&Ut(e.selectedEdges.map(mm),t.selectedEdges.map(mm))}function Cle({onSelectionChange:e}){const t=Lt(),{selectedNodes:n,selectedEdges:r}=tt(Ele,Ole);return g.useEffect(()=>{const a={nodes:n,edges:r};e==null||e(a),t.getState().onSelectionChangeHandlers.forEach(o=>o(a))},[n,r,e]),null}const Nle=e=>!!e.onSelectionChangeHandlers;function Mle({onSelectionChange:e}){const t=tt(Nle);return e||t?h.jsx(Cle,{onSelectionChange:e}):null}const T5=[0,0],kle={x:0,y:0,zoom:1},Ple=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance"],I5=[...Ple,"rfId"],Ale=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),R5={translateExtent:md,nodeOrigin:T5,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function Tle(e){const{setNodes:t,setEdges:n,setMinZoom:r,setMaxZoom:a,setTranslateExtent:o,setNodeExtent:i,reset:s,setDefaultNodesAndEdges:c,setPaneClickDistance:l}=tt(Ale,Ut),u=Lt();g.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{d.current=R5,s()}),[]);const d=g.useRef(R5);return g.useEffect(()=>{for(const p of I5){const f=e[p],m=d.current[p];f!==m&&(typeof e[p]>"u"||(p==="nodes"?t(f):p==="edges"?n(f):p==="minZoom"?r(f):p==="maxZoom"?a(f):p==="translateExtent"?o(f):p==="nodeExtent"?i(f):p==="paneClickDistance"?l(f):p==="fitView"?u.setState({fitViewOnInit:f}):p==="fitViewOptions"?u.setState({fitViewOnInitOptions:f}):u.setState({[p]:f})))}d.current=e},I5.map(p=>e[p])),null}function D5(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function Ile(e){var r;const[t,n]=g.useState(e==="system"?null:e);return g.useEffect(()=>{if(e!=="system"){n(e);return}const a=D5(),o=()=>n(a!=null&&a.matches?"dark":"light");return o(),a==null||a.addEventListener("change",o),()=>{a==null||a.removeEventListener("change",o)}},[e]),t!==null?t:(r=D5())!=null&&r.matches?"dark":"light"}const L5=typeof document<"u"?document:null;function jd(e=null,t={target:L5,actInsideInputWithModifier:!0}){const[n,r]=g.useState(!1),a=g.useRef(!1),o=g.useRef(new Set([])),[i,s]=g.useMemo(()=>{if(e!==null){const c=(Array.isArray(e)?e:[e]).filter(u=>typeof u=="string").map(u=>u.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=c.reduce((u,d)=>u.concat(...d),[]);return[c,l]}return[[],[]]},[e]);return g.useEffect(()=>{const c=(t==null?void 0:t.target)||L5;if(e!==null){const l=p=>{if(a.current=p.ctrlKey||p.metaKey||p.shiftKey,(!a.current||a.current&&!t.actInsideInputWithModifier)&&x_(p))return!1;const f=F5(p.code,s);o.current.add(p[f]),$5(i,o.current,!1)&&(p.preventDefault(),r(!0))},u=p=>{if((!a.current||a.current&&!t.actInsideInputWithModifier)&&x_(p))return!1;const f=F5(p.code,s);$5(i,o.current,!0)?(r(!1),o.current.clear()):o.current.delete(p[f]),p.key==="Meta"&&o.current.clear(),a.current=!1},d=()=>{o.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",l),c==null||c.addEventListener("keyup",u),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{c==null||c.removeEventListener("keydown",l),c==null||c.removeEventListener("keyup",u),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,r]),n}function $5(e,t,n){return e.filter(r=>n||r.length===t.size).some(r=>r.every(a=>t.has(a)))}function F5(e,t){return t.includes(e)?"code":"key"}const Rle=()=>{const e=Lt();return g.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:r}=e.getState();return r?r.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[r,a,o],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??r,y:t.y??a,zoom:t.zoom??o},{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,r]=e.getState().transform;return{x:t,y:n,zoom:r}},fitView:t=>{const{nodeLookup:n,minZoom:r,maxZoom:a,panZoom:o,domNode:i}=e.getState();if(!o||!i)return Promise.resolve(!1);const s=g_(n,t),{width:c,height:l}=um(i);return v_({nodes:s,width:c,height:l,minZoom:r,maxZoom:a,panZoom:o},t)},setCenter:async(t,n,r)=>{const{width:a,height:o,maxZoom:i,panZoom:s}=e.getState(),c=typeof(r==null?void 0:r.zoom)<"u"?r.zoom:i,l=a/2-t*c,u=o/2-n*c;return s?(await s.setViewport({x:l,y:u,zoom:c},{duration:r==null?void 0:r.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitBounds:async(t,n)=>{const{width:r,height:a,minZoom:o,maxZoom:i,panZoom:s}=e.getState(),c=w_(t,r,a,o,i,(n==null?void 0:n.padding)??.1);return s?(await s.setViewport(c,{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={snapToGrid:!0})=>{const{transform:r,snapGrid:a,domNode:o}=e.getState();if(!o)return t;const{x:i,y:s}=o.getBoundingClientRect(),c={x:t.x-i,y:t.y-s};return wd(c,r,n.snapToGrid,a)},flowToScreenPosition:t=>{const{transform:n,domNode:r}=e.getState();if(!r)return t;const{x:a,y:o}=r.getBoundingClientRect(),i=q4(t,n);return{x:i.x+a,y:i.y+o}}}),[])};function B5(e,t){const n=[],r=new Map,a=[];for(const o of e)if(o.type==="add"){a.push(o);continue}else if(o.type==="remove"||o.type==="replace")r.set(o.id,[o]);else{const i=r.get(o.id);i?i.push(o):r.set(o.id,[o])}for(const o of t){const i=r.get(o.id);if(!i){n.push(o);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const s={...o};for(const c of i)Dle(c,s);n.push(s)}return a.length&&a.forEach(o=>{o.index!==void 0?n.splice(o.index,0,{...o.item}):n.push({...o.item})}),n}function Dle(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&(t.width=e.dimensions.width,t.height=e.dimensions.height)),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function ps(e,t){return B5(e,t)}function Sd(e,t){return B5(e,t)}function fs(e,t){return{id:e,type:"select",selected:t}}function Pc(e,t=new Set,n=!1){const r=[];for(const[a,o]of e){const i=t.has(a);!(o.selected===void 0&&!i)&&o.selected!==i&&(n&&(o.selected=i),r.push(fs(o.id,i)))}return r}function z5({items:e=[],lookup:t}){var a;const n=[],r=new Map(e.map(o=>[o.id,o]));for(const[o,i]of e.entries()){const s=t.get(i.id),c=((a=s==null?void 0:s.internals)==null?void 0:a.userNode)??s;c!==void 0&&c!==i&&n.push({id:i.id,item:i,type:"replace"}),c===void 0&&n.push({item:i,type:"add",index:o})}for(const[o]of t)r.get(o)===void 0&&n.push({id:o,type:"remove"});return n}function U5(e){return{id:e.id,type:"remove"}}const V5=e=>xce(e),Lle=e=>D4(e);function q5(e){return g.forwardRef(e)}const $le=typeof window<"u"?g.useLayoutEffect:g.useEffect;function W5(e){const[t,n]=g.useState(BigInt(0)),[r]=g.useState(()=>Fle(()=>n(a=>a+BigInt(1))));return $le(()=>{const a=r.get();a.length&&(e(a),r.reset())},[t]),r}function Fle(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const H5=g.createContext(null);function Ble({children:e}){const t=Lt(),n=g.useCallback(s=>{const{nodes:c=[],setNodes:l,hasDefaultNodes:u,onNodesChange:d,nodeLookup:p}=t.getState();let f=c;for(const m of s)f=typeof m=="function"?m(f):m;u?l(f):d&&d(z5({items:f,lookup:p}))},[]),r=W5(n),a=g.useCallback(s=>{const{edges:c=[],setEdges:l,hasDefaultEdges:u,onEdgesChange:d,edgeLookup:p}=t.getState();let f=c;for(const m of s)f=typeof m=="function"?m(f):m;u?l(f):d&&d(z5({items:f,lookup:p}))},[]),o=W5(a),i=g.useMemo(()=>({nodeQueue:r,edgeQueue:o}),[]);return h.jsx(H5.Provider,{value:i,children:e})}function zle(){const e=g.useContext(H5);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Ule=e=>!!e.panZoom;function br(){const e=Rle(),t=Lt(),n=zle(),r=tt(Ule),a=g.useMemo(()=>{const o=d=>t.getState().nodeLookup.get(d),i=d=>{n.nodeQueue.push(d)},s=d=>{n.edgeQueue.push(d)},c=d=>{var b,w;const{nodeLookup:p,nodeOrigin:f}=t.getState(),m=V5(d)?d:p.get(d.id),y=m.parentId?H4(m.position,m.measured,m.parentId,p,f):m.position,v={id:m.id,position:y,width:((b=m.measured)==null?void 0:b.width)??m.width,height:((w=m.measured)==null?void 0:w.height)??m.height,data:m.data};return Oc(v)},l=(d,p,f={replace:!1})=>{i(m=>m.map(y=>{if(y.id===d){const v=typeof p=="function"?p(y):p;return f.replace&&V5(v)?v:{...y,...v}}return y}))},u=(d,p,f={replace:!1})=>{s(m=>m.map(y=>{if(y.id===d){const v=typeof p=="function"?p(y):p;return f.replace&&Lle(v)?v:{...y,...v}}return y}))};return{getNodes:()=>t.getState().nodes.map(d=>({...d})),getNode:d=>{var p;return(p=o(d))==null?void 0:p.internals.userNode},getInternalNode:o,getEdges:()=>{const{edges:d=[]}=t.getState();return d.map(p=>({...p}))},getEdge:d=>t.getState().edgeLookup.get(d),setNodes:i,setEdges:s,addNodes:d=>{const p=Array.isArray(d)?d:[d];n.nodeQueue.push(f=>[...f,...p])},addEdges:d=>{const p=Array.isArray(d)?d:[d];n.edgeQueue.push(f=>[...f,...p])},toObject:()=>{const{nodes:d=[],edges:p=[],transform:f}=t.getState(),[m,y,v]=f;return{nodes:d.map(b=>({...b})),edges:p.map(b=>({...b})),viewport:{x:m,y,zoom:v}}},deleteElements:async({nodes:d=[],edges:p=[]})=>{const{nodes:f,edges:m,onNodesDelete:y,onEdgesDelete:v,triggerNodeChanges:b,triggerEdgeChanges:w,onDelete:j,onBeforeDelete:x}=t.getState(),{nodes:_,edges:S}=await Sce({nodesToRemove:d,edgesToRemove:p,nodes:f,edges:m,onBeforeDelete:x}),E=S.length>0,O=_.length>0;if(E){const N=S.map(U5);v==null||v(S),w(N)}if(O){const N=_.map(U5);y==null||y(_),b(N)}return(O||E)&&(j==null||j({nodes:_,edges:S})),{deletedNodes:_,deletedEdges:S}},getIntersectingNodes:(d,p=!0,f)=>{const m=V4(d),y=m?d:c(d),v=f!==void 0;return y?(f||t.getState().nodes).filter(b=>{const w=t.getState().nodeLookup.get(b.id);if(w&&!m&&(b.id===d.id||!w.internals.positionAbsolute))return!1;const j=Oc(v?b:w),x=bd(j,y);return p&&x>0||x>=y.width*y.height}):[]},isNodeIntersecting:(d,p,f=!0)=>{const m=V4(d)?d:c(d);if(!m)return!1;const y=bd(m,p);return f&&y>0||y>=m.width*m.height},updateNode:l,updateNodeData:(d,p,f={replace:!1})=>{l(d,m=>{const y=typeof p=="function"?p(m):p;return f.replace?{...m,data:y}:{...m,data:{...m.data,...y}}},f)},updateEdge:u,updateEdgeData:(d,p,f={replace:!1})=>{u(d,m=>{const y=typeof p=="function"?p(m):p;return f.replace?{...m,data:y}:{...m,data:{...m.data,...y}}},f)},getNodesBounds:d=>{const{nodeLookup:p,nodeOrigin:f}=t.getState();return _ce(d,{nodeLookup:p,nodeOrigin:f})},getHandleConnections:({type:d,id:p,nodeId:f})=>{var m;return Array.from(((m=t.getState().connectionLookup.get(`${f}-${d}-${p??null}`))==null?void 0:m.values())??[])}}},[]);return g.useMemo(()=>({...a,...e,viewportInitialized:r}),[r])}const K5=e=>e.selected,Vle={actInsideInputWithModifier:!1},qle=typeof window<"u"?window:void 0;function Wle({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=Lt(),{deleteElements:r}=br(),a=jd(e,Vle),o=jd(t,{target:qle});g.useEffect(()=>{if(a){const{edges:i,nodes:s}=n.getState();r({nodes:s.filter(K5),edges:i.filter(K5)}),n.setState({nodesSelectionActive:!1})}},[a]),g.useEffect(()=>{n.setState({multiSelectionActive:o})},[o])}function Hle(e){const t=Lt();g.useEffect(()=>{const n=()=>{var a,o;if(!e.current)return!1;const r=um(e.current);(r.height===0||r.width===0)&&((o=(a=t.getState()).onError)==null||o.call(a,"004",Io.error004())),t.setState({width:r.width||500,height:r.height||500})};if(e.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(e.current),()=>{window.removeEventListener("resize",n),r&&e.current&&r.unobserve(e.current)}}},[])}const ym={position:"absolute",width:"100%",height:"100%",top:0,left:0},Kle=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function Zle({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:a=.5,panOnScrollMode:o=mi.Free,zoomOnDoubleClick:i=!0,panOnDrag:s=!0,defaultViewport:c,translateExtent:l,minZoom:u,maxZoom:d,zoomActivationKeyCode:p,preventScrolling:f=!0,children:m,noWheelClassName:y,noPanClassName:v,onViewportChange:b,isControlledViewport:w,paneClickDistance:j}){const x=Lt(),_=g.useRef(null),{userSelectionActive:S,lib:E}=tt(Kle,Ut),O=jd(p),N=g.useRef();Hle(_);const M=g.useCallback(k=>{b==null||b({x:k[0],y:k[1],zoom:k[2]}),w||x.setState({transform:k})},[b,w]);return g.useEffect(()=>{if(_.current){N.current=rle({domNode:_.current,minZoom:u,maxZoom:d,translateExtent:l,viewport:c,paneClickDistance:j,onDraggingChange:C=>x.setState({paneDragging:C}),onPanZoomStart:(C,I)=>{const{onViewportChangeStart:T,onMoveStart:R}=x.getState();R==null||R(C,I),T==null||T(I)},onPanZoom:(C,I)=>{const{onViewportChange:T,onMove:R}=x.getState();R==null||R(C,I),T==null||T(I)},onPanZoomEnd:(C,I)=>{const{onViewportChangeEnd:T,onMoveEnd:R}=x.getState();R==null||R(C,I),T==null||T(I)}});const{x:k,y:P,zoom:A}=N.current.getViewport();return x.setState({panZoom:N.current,transform:[k,P,A],domNode:_.current.closest(".react-flow")}),()=>{var C;(C=N.current)==null||C.destroy()}}},[]),g.useEffect(()=>{var k;(k=N.current)==null||k.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:a,panOnScrollMode:o,zoomOnDoubleClick:i,panOnDrag:s,zoomActivationKeyPressed:O,preventScrolling:f,noPanClassName:v,userSelectionActive:S,noWheelClassName:y,lib:E,onTransformChange:M})},[e,t,n,r,a,o,i,s,O,f,v,S,y,E,M]),h.jsx("div",{className:"react-flow__renderer",ref:_,style:ym,children:m})}const Gle=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Xle(){const{userSelectionActive:e,userSelectionRect:t}=tt(Gle,Ut);return e&&t?h.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const R_=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},Jle=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging});function Yle({isSelecting:e,selectionKeyPressed:t,selectionMode:n=yd.Full,panOnDrag:r,selectionOnDrag:a,onSelectionStart:o,onSelectionEnd:i,onPaneClick:s,onPaneContextMenu:c,onPaneScroll:l,onPaneMouseEnter:u,onPaneMouseMove:d,onPaneMouseLeave:p,children:f}){const m=g.useRef(null),y=Lt(),v=g.useRef(0),b=g.useRef(0),w=g.useRef(),j=g.useRef(new Map),{userSelectionActive:x,elementsSelectable:_,dragging:S}=tt(Jle,Ut),E=_&&(e||x),O=g.useRef(!1),N=g.useRef(!1),M=()=>{y.setState({userSelectionActive:!1,userSelectionRect:null}),v.current=0,b.current=0},k=L=>{if(O.current){O.current=!1;return}s==null||s(L),y.getState().resetSelectedElements(),y.setState({nodesSelectionActive:!1})},P=L=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){L.preventDefault();return}c==null||c(L)},A=l?L=>l(L):void 0,C=L=>{var F,H,re,ee;const{resetSelectedElements:D,domNode:z,edgeLookup:B}=y.getState();if(w.current=z==null?void 0:z.getBoundingClientRect(),!_||!e||L.button!==0||L.target!==m.current||!w.current)return;(H=(F=L.target)==null?void 0:F.setPointerCapture)==null||H.call(F,L.pointerId),N.current=!0,O.current=!1,j.current=new Map;for(const[G,K]of B)j.current.set(K.source,((re=j.current.get(K.source))==null?void 0:re.add(G))||new Set([G])),j.current.set(K.target,((ee=j.current.get(K.target))==null?void 0:ee.add(G))||new Set([G]));const{x:$,y:U}=Do(L.nativeEvent,w.current);D(),y.setState({userSelectionRect:{width:0,height:0,startX:$,startY:U,x:$,y:U}}),o==null||o(L)},I=L=>{const{userSelectionRect:D,edgeLookup:z,transform:B,nodeLookup:$,triggerNodeChanges:U,triggerEdgeChanges:F}=y.getState();if(!w.current||!D)return;O.current=!0;const{x:H,y:re}=Do(L.nativeEvent,w.current),{startX:ee,startY:G}=D,K={startX:ee,startY:G,x:H<ee?H:ee,y:re<G?re:G,width:Math.abs(H-ee),height:Math.abs(re-G)},X=L4($,K,B,n===yd.Partial,!0),ne=new Set,V=new Set;for(const le of X){V.add(le.id);const ae=j.current.get(le.id);if(ae)for(const de of ae)ne.add(de)}if(v.current!==V.size){v.current=V.size;const le=Pc($,V,!0);U(le)}if(b.current!==ne.size){b.current=ne.size;const le=Pc(z,ne);F(le)}y.setState({userSelectionRect:K,userSelectionActive:!0,nodesSelectionActive:!1})},T=L=>{var z,B;if(L.button!==0||!N.current)return;(B=(z=L.target)==null?void 0:z.releasePointerCapture)==null||B.call(z,L.pointerId);const{userSelectionRect:D}=y.getState();!x&&D&&L.target===m.current&&(k==null||k(L)),v.current>0&&y.setState({nodesSelectionActive:!0}),M(),i==null||i(L),(t||a)&&(O.current=!1),N.current=!1},R=r===!0||Array.isArray(r)&&r.includes(0);return h.jsxs("div",{className:rn(["react-flow__pane",{draggable:R,dragging:S,selection:e}]),onClick:E?void 0:R_(k,m),onContextMenu:R_(P,m),onWheel:R_(A,m),onPointerEnter:E?void 0:u,onPointerDown:E?C:d,onPointerMove:E?I:d,onPointerUp:E?T:void 0,onPointerLeave:p,ref:m,style:ym,children:[f,h.jsx(Xle,{})]})}function D_({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:a,unselectNodesAndEdges:o,multiSelectionActive:i,nodeLookup:s,onError:c}=t.getState(),l=s.get(e);if(!l){c==null||c("012",Io.error012(e));return}t.setState({nodesSelectionActive:!1}),l.selected?(n||l.selected&&i)&&(o({nodes:[l],edges:[]}),requestAnimationFrame(()=>{var u;return(u=r==null?void 0:r.current)==null?void 0:u.blur()})):a([e])}function Z5({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:a,isSelectable:o,nodeClickDistance:i}){const s=Lt(),[c,l]=g.useState(!1),u=g.useRef();return g.useEffect(()=>{u.current=Vce({getStoreItems:()=>s.getState(),onNodeMouseDown:d=>{D_({id:d,store:s,nodeRef:e})},onDragStart:()=>{l(!0)},onDragStop:()=>{l(!1)}})},[]),g.useEffect(()=>{var d,p;if(t)(d=u.current)==null||d.destroy();else if(e.current)return(p=u.current)==null||p.update({noDragClassName:n,handleSelector:r,domNode:e.current,isSelectable:o,nodeId:a,nodeClickDistance:i}),()=>{var f;(f=u.current)==null||f.destroy()}},[n,r,t,o,e,a]),c}const Qle=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function G5(){const e=Lt();return g.useCallback(t=>{const{nodeExtent:n,snapToGrid:r,snapGrid:a,nodesDraggable:o,onError:i,updateNodePositions:s,nodeLookup:c,nodeOrigin:l}=e.getState(),u=new Map,d=Qle(o),p=r?a[0]:5,f=r?a[1]:5,m=t.direction.x*p*t.factor,y=t.direction.y*f*t.factor;for(const[,v]of c){if(!d(v))continue;let b={x:v.internals.positionAbsolute.x+m,y:v.internals.positionAbsolute.y+y};r&&(b=cm(b,a));const{position:w,positionAbsolute:j}=$4({nodeId:v.id,nextPosition:b,nodeLookup:c,nodeExtent:n,nodeOrigin:l,onError:i});v.position=w,v.internals.positionAbsolute=j,u.set(v.id,v)}s(u)},[])}const L_=g.createContext(null),eue=L_.Provider;L_.Consumer;const $_=()=>g.useContext(L_),tue=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),nue=(e,t,n)=>r=>{const{connectionClickStartHandle:a,connectionMode:o,connection:i}=r,{fromHandle:s,toHandle:c,isValid:l}=i,u=(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===n;return{connectingFrom:(s==null?void 0:s.nodeId)===e&&(s==null?void 0:s.id)===t&&(s==null?void 0:s.type)===n,connectingTo:u,clickConnecting:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,isPossibleEndHandle:o===Sc.Strict?(s==null?void 0:s.type)!==n:e!==(s==null?void 0:s.nodeId)||t!==(s==null?void 0:s.id),connectionInProcess:!!s,valid:u&&l}};function rue({type:e="source",position:t=he.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:a=!0,isConnectableEnd:o=!0,id:i,onConnect:s,children:c,className:l,onMouseDown:u,onTouchStart:d,...p},f){var C,I;const m=i||null,y=e==="target",v=Lt(),b=$_(),{connectOnClick:w,noPanClassName:j,rfId:x}=tt(tue,Ut),{connectingFrom:_,connectingTo:S,clickConnecting:E,isPossibleEndHandle:O,connectionInProcess:N,valid:M}=tt(nue(b,m,e),Ut);b||((I=(C=v.getState()).onError)==null||I.call(C,"010",Io.error010()));const k=T=>{const{defaultEdgeOptions:R,onConnect:L,hasDefaultEdges:D}=v.getState(),z={...R,...T};if(D){const{edges:B,setEdges:$}=v.getState();$(e5(z,B))}L==null||L(z),s==null||s(z)},P=T=>{if(!b)return;const R=Z4(T.nativeEvent);if(a&&(R&&T.button===0||!R)){const L=v.getState();k_.onPointerDown(T.nativeEvent,{autoPanOnConnect:L.autoPanOnConnect,connectionMode:L.connectionMode,connectionRadius:L.connectionRadius,domNode:L.domNode,nodeLookup:L.nodeLookup,lib:L.lib,isTarget:y,handleId:m,nodeId:b,flowId:L.rfId,panBy:L.panBy,cancelConnection:L.cancelConnection,onConnectStart:L.onConnectStart,onConnectEnd:L.onConnectEnd,updateConnection:L.updateConnection,onConnect:k,isValidConnection:n||L.isValidConnection,getTransform:()=>v.getState().transform,getFromHandle:()=>v.getState().connection.fromHandle,autoPanSpeed:L.autoPanSpeed})}R?u==null||u(T):d==null||d(T)},A=T=>{const{onClickConnectStart:R,onClickConnectEnd:L,connectionClickStartHandle:D,connectionMode:z,isValidConnection:B,lib:$,rfId:U,nodeLookup:F,connection:H}=v.getState();if(!b||!D&&!a)return;if(!D){R==null||R(T.nativeEvent,{nodeId:b,handleId:m,handleType:e}),v.setState({connectionClickStartHandle:{nodeId:b,type:e,id:m}});return}const re=K4(T.target),ee=n||B,{connection:G,isValid:K}=k_.isValid(T.nativeEvent,{handle:{nodeId:b,id:m,type:e},connectionMode:z,fromNodeId:D.nodeId,fromHandleId:D.id||null,fromType:D.type,isValidConnection:ee,flowId:U,doc:re,lib:$,nodeLookup:F});K&&G&&k(G);const X=structuredClone(H);delete X.inProgress,X.toPosition=X.toHandle?X.toHandle.position:null,L==null||L(T,X),v.setState({connectionClickStartHandle:null})};return h.jsx("div",{"data-handleid":m,"data-nodeid":b,"data-handlepos":t,"data-id":`${x}-${b}-${m}-${e}`,className:rn(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",j,l,{source:!y,target:y,connectable:r,connectablestart:a,connectableend:o,clickconnecting:E,connectingfrom:_,connectingto:S,valid:M,connectionindicator:r&&(!N||O)&&(N?o:a)}]),onMouseDown:P,onTouchStart:P,onClick:w?A:void 0,ref:f,...p,children:c})}const Ed=g.memo(q5(rue));function aue({data:e,isConnectable:t,sourcePosition:n=he.Bottom}){return h.jsxs(h.Fragment,{children:[e==null?void 0:e.label,h.jsx(Ed,{type:"source",position:n,isConnectable:t})]})}function oue({data:e,isConnectable:t,targetPosition:n=he.Top,sourcePosition:r=he.Bottom}){return h.jsxs(h.Fragment,{children:[h.jsx(Ed,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,h.jsx(Ed,{type:"source",position:r,isConnectable:t})]})}function iue(){return null}function sue({data:e,isConnectable:t,targetPosition:n=he.Top}){return h.jsxs(h.Fragment,{children:[h.jsx(Ed,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const gm={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},X5={input:aue,default:oue,output:sue,group:iue};function cue(e){var t,n,r,a;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((r=e.style)==null?void 0:r.width),height:e.height??((a=e.style)==null?void 0:a.height)}}const lue=e=>{const{width:t,height:n,x:r,y:a}=vd(e.nodeLookup,{filter:o=>!!o.selected});return{width:aa(t)?t:null,height:aa(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${r}px,${a}px)`}};function uue({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=Lt(),{width:a,height:o,transformString:i,userSelectionActive:s}=tt(lue,Ut),c=G5(),l=g.useRef(null);if(g.useEffect(()=>{var p;n||((p=l.current)==null||p.focus({preventScroll:!0}))},[n]),Z5({nodeRef:l}),s||!a||!o)return null;const u=e?p=>{const f=r.getState().nodes.filter(m=>m.selected);e(p,f)}:void 0,d=p=>{Object.prototype.hasOwnProperty.call(gm,p.key)&&c({direction:gm[p.key],factor:p.shiftKey?4:1})};return h.jsx("div",{className:rn(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:h.jsx("div",{ref:l,className:"react-flow__nodesselection-rect",onContextMenu:u,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:a,height:o}})})}const J5=typeof window<"u"?window:void 0,due=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Y5({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:a,onPaneContextMenu:o,onPaneScroll:i,paneClickDistance:s,deleteKeyCode:c,selectionKeyCode:l,selectionOnDrag:u,selectionMode:d,onSelectionStart:p,onSelectionEnd:f,multiSelectionKeyCode:m,panActivationKeyCode:y,zoomActivationKeyCode:v,elementsSelectable:b,zoomOnScroll:w,zoomOnPinch:j,panOnScroll:x,panOnScrollSpeed:_,panOnScrollMode:S,zoomOnDoubleClick:E,panOnDrag:O,defaultViewport:N,translateExtent:M,minZoom:k,maxZoom:P,preventScrolling:A,onSelectionContextMenu:C,noWheelClassName:I,noPanClassName:T,disableKeyboardA11y:R,onViewportChange:L,isControlledViewport:D}){const{nodesSelectionActive:z,userSelectionActive:B}=tt(due),$=jd(l,{target:J5}),U=jd(y,{target:J5}),F=U||O,H=U||x,re=u&&F!==!0,ee=$||B||re;return Wle({deleteKeyCode:c,multiSelectionKeyCode:m}),h.jsx(Zle,{onPaneContextMenu:o,elementsSelectable:b,zoomOnScroll:w,zoomOnPinch:j,panOnScroll:H,panOnScrollSpeed:_,panOnScrollMode:S,zoomOnDoubleClick:E,panOnDrag:!$&&F,defaultViewport:N,translateExtent:M,minZoom:k,maxZoom:P,zoomActivationKeyCode:v,preventScrolling:A,noWheelClassName:I,noPanClassName:T,onViewportChange:L,isControlledViewport:D,paneClickDistance:s,children:h.jsxs(Yle,{onSelectionStart:p,onSelectionEnd:f,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:a,onPaneContextMenu:o,onPaneScroll:i,panOnDrag:F,isSelecting:!!ee,selectionMode:d,selectionKeyPressed:$,selectionOnDrag:re,children:[e,z&&h.jsx(uue,{onSelectionContextMenu:C,noPanClassName:T,disableKeyboardA11y:R})]})})}Y5.displayName="FlowRenderer";const pue=g.memo(Y5),fue=e=>t=>e?L4(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function hue(e){return tt(g.useCallback(fue(e),[e]),Ut)}const mue=e=>e.updateNodeInternals;function yue(){const e=tt(mue),[t]=g.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(a=>{const o=a.target.getAttribute("data-id");r.set(o,{id:o,nodeElement:a.target,force:!0})}),e(r)}));return g.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function gue({node:e,nodeType:t,hasDimensions:n,resizeObserver:r}){const a=Lt(),o=g.useRef(null),i=g.useRef(null),s=g.useRef(e.sourcePosition),c=g.useRef(e.targetPosition),l=g.useRef(t),u=n&&!!e.internals.handleBounds;return g.useEffect(()=>{o.current&&!e.hidden&&(!u||i.current!==o.current)&&(i.current&&(r==null||r.unobserve(i.current)),r==null||r.observe(o.current),i.current=o.current)},[u,e.hidden]),g.useEffect(()=>()=>{i.current&&(r==null||r.unobserve(i.current),i.current=null)},[]),g.useEffect(()=>{if(o.current){const d=l.current!==t,p=s.current!==e.sourcePosition,f=c.current!==e.targetPosition;(d||p||f)&&(l.current=t,s.current=e.sourcePosition,c.current=e.targetPosition,a.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:o.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),o}function vue({id:e,onClick:t,onMouseEnter:n,onMouseMove:r,onMouseLeave:a,onContextMenu:o,onDoubleClick:i,nodesDraggable:s,elementsSelectable:c,nodesConnectable:l,nodesFocusable:u,resizeObserver:d,noDragClassName:p,noPanClassName:f,disableKeyboardA11y:m,rfId:y,nodeTypes:v,nodeExtent:b,nodeClickDistance:w,onError:j}){const{node:x,internals:_,isParent:S}=tt(G=>{const K=G.nodeLookup.get(e),X=G.parentLookup.has(e);return{node:K,internals:K.internals,isParent:X}},Ut);let E=x.type||"default",O=(v==null?void 0:v[E])||X5[E];O===void 0&&(j==null||j("003",Io.error003(E)),E="default",O=X5.default);const N=!!(x.draggable||s&&typeof x.draggable>"u"),M=!!(x.selectable||c&&typeof x.selectable>"u"),k=!!(x.connectable||l&&typeof x.connectable>"u"),P=!!(x.focusable||u&&typeof x.focusable>"u"),A=Lt(),C=W4(x),I=gue({node:x,nodeType:E,hasDimensions:C,resizeObserver:d}),T=Z5({nodeRef:I,disabled:x.hidden||!N,noDragClassName:p,handleSelector:x.dragHandle,nodeId:e,isSelectable:M,nodeClickDistance:w}),R=G5();if(x.hidden)return null;const L=Ro(x),D=cue(x),z=M||N||t||n||r||a,B=n?G=>n(G,{..._.userNode}):void 0,$=r?G=>r(G,{..._.userNode}):void 0,U=a?G=>a(G,{..._.userNode}):void 0,F=o?G=>o(G,{..._.userNode}):void 0,H=i?G=>i(G,{..._.userNode}):void 0,re=G=>{const{selectNodesOnDrag:K,nodeDragThreshold:X}=A.getState();M&&(!K||!N||X>0)&&D_({id:e,store:A,nodeRef:I}),t&&t(G,{..._.userNode})},ee=G=>{if(!(x_(G.nativeEvent)||m))if(P4.includes(G.key)&&M){const K=G.key==="Escape";D_({id:e,store:A,unselect:K,nodeRef:I})}else N&&x.selected&&Object.prototype.hasOwnProperty.call(gm,G.key)&&(A.setState({ariaLiveMessage:`Moved selected node ${G.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~_.positionAbsolute.x}, y: ${~~_.positionAbsolute.y}`}),R({direction:gm[G.key],factor:G.shiftKey?4:1}))};return h.jsx("div",{className:rn(["react-flow__node",`react-flow__node-${E}`,{[f]:N},x.className,{selected:x.selected,selectable:M,parent:S,draggable:N,dragging:T}]),ref:I,style:{zIndex:_.z,transform:`translate(${_.positionAbsolute.x}px,${_.positionAbsolute.y}px)`,pointerEvents:z?"all":"none",visibility:C?"visible":"hidden",...x.style,...D},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:B,onMouseMove:$,onMouseLeave:U,onContextMenu:F,onClick:re,onDoubleClick:H,onKeyDown:P?ee:void 0,tabIndex:P?0:void 0,role:P?"button":void 0,"aria-describedby":m?void 0:`${P5}-${y}`,"aria-label":x.ariaLabel,children:h.jsx(eue,{value:e,children:h.jsx(O,{id:e,data:x.data,type:E,positionAbsoluteX:_.positionAbsolute.x,positionAbsoluteY:_.positionAbsolute.y,selected:x.selected,selectable:M,draggable:N,deletable:x.deletable??!0,isConnectable:k,sourcePosition:x.sourcePosition,targetPosition:x.targetPosition,dragging:T,dragHandle:x.dragHandle,zIndex:_.z,parentId:x.parentId,...L})})})}const bue=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Q5(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:a,onError:o}=tt(bue,Ut),i=hue(e.onlyRenderVisibleElements),s=yue();return h.jsx("div",{className:"react-flow__nodes",style:ym,children:i.map(c=>h.jsx(vue,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:s,nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:a,nodeClickDistance:e.nodeClickDistance,onError:o},c))})}Q5.displayName="NodeRenderer";const wue=g.memo(Q5);function xue(e){return tt(g.useCallback(t=>{if(!e)return t.edges.map(r=>r.id);const n=[];if(t.width&&t.height)for(const r of t.edges){const a=t.nodeLookup.get(r.source),o=t.nodeLookup.get(r.target);a&&o&&Nce({sourceNode:a,targetNode:o,width:t.width,height:t.height,transform:t.transform})&&n.push(r.id)}return n},[e]),Ut)}const _ue=({color:e="none",strokeWidth:t=1})=>h.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),jue=({color:e="none",strokeWidth:t=1})=>h.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),eL={[am.Arrow]:_ue,[am.ArrowClosed]:jue};function Sue(e){const t=Lt();return g.useMemo(()=>{var n,r;return Object.prototype.hasOwnProperty.call(eL,e)?eL[e]:((r=(n=t.getState()).onError)==null||r.call(n,"009",Io.error009(e)),null)},[e])}const Eue=({id:e,type:t,color:n,width:r=12.5,height:a=12.5,markerUnits:o="strokeWidth",strokeWidth:i,orient:s="auto-start-reverse"})=>{const c=Sue(t);return c?h.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${a}`,viewBox:"-10 -10 20 20",markerUnits:o,orient:s,refX:"0",refY:"0",children:h.jsx(c,{color:n,strokeWidth:i})}):null},tL=({defaultColor:e,rfId:t})=>{const n=tt(o=>o.edges),r=tt(o=>o.defaultEdgeOptions),a=g.useMemo(()=>Rce(n,{id:t,defaultColor:e,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,t,e]);return a.length?h.jsx("svg",{className:"react-flow__marker",children:h.jsx("defs",{children:a.map(o=>h.jsx(Eue,{id:o.id,type:o.type,color:o.color,width:o.width,height:o.height,markerUnits:o.markerUnits,strokeWidth:o.strokeWidth,orient:o.orient},o.id))})}):null};tL.displayName="MarkerDefinitions";var Oue=g.memo(tL);function nL({x:e,y:t,label:n,labelStyle:r={},labelShowBg:a=!0,labelBgStyle:o={},labelBgPadding:i=[2,4],labelBgBorderRadius:s=2,children:c,className:l,...u}){const[d,p]=g.useState({x:1,y:0,width:0,height:0}),f=rn(["react-flow__edge-textwrapper",l]),m=g.useRef(null);return g.useEffect(()=>{if(m.current){const y=m.current.getBBox();p({x:y.x,y:y.y,width:y.width,height:y.height})}},[n]),typeof n>"u"||!n?null:h.jsxs("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:f,visibility:d.width?"visible":"hidden",...u,children:[a&&h.jsx("rect",{width:d.width+2*i[0],x:-i[0],y:-i[1],height:d.height+2*i[1],className:"react-flow__edge-textbg",style:o,rx:s,ry:s}),h.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:m,style:r,children:n}),c]})}nL.displayName="EdgeText";const Cue=g.memo(nL);function vm({id:e,path:t,labelX:n,labelY:r,label:a,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:c,labelBgBorderRadius:l,style:u,markerEnd:d,markerStart:p,className:f,interactionWidth:m=20}){return h.jsxs(h.Fragment,{children:[h.jsx("path",{id:e,style:u,d:t,fill:"none",className:rn(["react-flow__edge-path",f]),markerEnd:d,markerStart:p}),m&&h.jsx("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:m,className:"react-flow__edge-interaction"}),a&&aa(n)&&aa(r)?h.jsx(Cue,{x:n,y:r,label:a,labelStyle:o,labelShowBg:i,labelBgStyle:s,labelBgPadding:c,labelBgBorderRadius:l}):null]})}function rL({pos:e,x1:t,y1:n,x2:r,y2:a}){return e===he.Left||e===he.Right?[.5*(t+r),n]:[t,.5*(n+a)]}function aL({sourceX:e,sourceY:t,sourcePosition:n=he.Bottom,targetX:r,targetY:a,targetPosition:o=he.Top}){const[i,s]=rL({pos:n,x1:e,y1:t,x2:r,y2:a}),[c,l]=rL({pos:o,x1:r,y1:a,x2:e,y2:t}),[u,d,p,f]=X4({sourceX:e,sourceY:t,targetX:r,targetY:a,sourceControlX:i,sourceControlY:s,targetControlX:c,targetControlY:l});return[`M${e},${t} C${i},${s} ${c},${l} ${r},${a}`,u,d,p,f]}function oL(e){return g.memo(({id:t,sourceX:n,sourceY:r,targetX:a,targetY:o,sourcePosition:i=he.Bottom,targetPosition:s=he.Top,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:v,interactionWidth:b})=>{const[w,j,x]=aL({sourceX:n,sourceY:r,sourcePosition:i,targetX:a,targetY:o,targetPosition:s}),_=e.isInternal?void 0:t;return h.jsx(vm,{id:_,path:w,labelX:j,labelY:x,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:v,interactionWidth:b})})}const Nue=oL({isInternal:!1}),iL=oL({isInternal:!0});Nue.displayName="SimpleBezierEdge",iL.displayName="SimpleBezierEdgeInternal";function sL(e){return g.memo(({id:t,sourceX:n,sourceY:r,targetX:a,targetY:o,label:i,labelStyle:s,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:p,sourcePosition:f=he.Bottom,targetPosition:m=he.Top,markerEnd:y,markerStart:v,pathOptions:b,interactionWidth:w})=>{const[j,x,_]=__({sourceX:n,sourceY:r,sourcePosition:f,targetX:a,targetY:o,targetPosition:m,borderRadius:b==null?void 0:b.borderRadius,offset:b==null?void 0:b.offset}),S=e.isInternal?void 0:t;return h.jsx(vm,{id:S,path:j,labelX:x,labelY:_,label:i,labelStyle:s,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:p,markerEnd:y,markerStart:v,interactionWidth:w})})}const cL=sL({isInternal:!1}),lL=sL({isInternal:!0});cL.displayName="SmoothStepEdge",lL.displayName="SmoothStepEdgeInternal";function uL(e){return g.memo(({id:t,...n})=>{var a;const r=e.isInternal?void 0:t;return h.jsx(cL,{...n,id:r,pathOptions:g.useMemo(()=>{var o;return{borderRadius:0,offset:(o=n.pathOptions)==null?void 0:o.offset}},[(a=n.pathOptions)==null?void 0:a.offset])})})}const Mue=uL({isInternal:!1}),dL=uL({isInternal:!0});Mue.displayName="StepEdge",dL.displayName="StepEdgeInternal";function pL(e){return g.memo(({id:t,sourceX:n,sourceY:r,targetX:a,targetY:o,label:i,labelStyle:s,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:m,interactionWidth:y})=>{const[v,b,w]=t5({sourceX:n,sourceY:r,targetX:a,targetY:o}),j=e.isInternal?void 0:t;return h.jsx(vm,{id:j,path:v,labelX:b,labelY:w,label:i,labelStyle:s,labelShowBg:c,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:m,interactionWidth:y})})}const kue=pL({isInternal:!1}),fL=pL({isInternal:!0});kue.displayName="StraightEdge",fL.displayName="StraightEdgeInternal";function hL(e){return g.memo(({id:t,sourceX:n,sourceY:r,targetX:a,targetY:o,sourcePosition:i=he.Bottom,targetPosition:s=he.Top,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:v,pathOptions:b,interactionWidth:w})=>{const[j,x,_]=Y4({sourceX:n,sourceY:r,sourcePosition:i,targetX:a,targetY:o,targetPosition:s,curvature:b==null?void 0:b.curvature}),S=e.isInternal?void 0:t;return h.jsx(vm,{id:S,path:j,labelX:x,labelY:_,label:c,labelStyle:l,labelShowBg:u,labelBgStyle:d,labelBgPadding:p,labelBgBorderRadius:f,style:m,markerEnd:y,markerStart:v,interactionWidth:w})})}const Pue=hL({isInternal:!1}),mL=hL({isInternal:!0});Pue.displayName="BezierEdge",mL.displayName="BezierEdgeInternal";const yL={default:mL,straight:fL,step:dL,smoothstep:lL,simplebezier:iL},gL={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Aue=(e,t,n)=>n===he.Left?e-t:n===he.Right?e+t:e,Tue=(e,t,n)=>n===he.Top?e-t:n===he.Bottom?e+t:e,vL="react-flow__edgeupdater";function bL({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:a,onMouseEnter:o,onMouseOut:i,type:s}){return h.jsx("circle",{onMouseDown:a,onMouseEnter:o,onMouseOut:i,className:rn([vL,`${vL}-${s}`]),cx:Aue(t,r,e),cy:Tue(n,r,e),r,stroke:"transparent",fill:"transparent"})}function Iue({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:r,sourceY:a,targetX:o,targetY:i,sourcePosition:s,targetPosition:c,onReconnect:l,onReconnectStart:u,onReconnectEnd:d,setReconnecting:p,setUpdateHover:f}){const m=Lt(),y=(x,_)=>{if(x.button!==0)return;const{autoPanOnConnect:S,domNode:E,isValidConnection:O,connectionMode:N,connectionRadius:M,lib:k,onConnectStart:P,onConnectEnd:A,cancelConnection:C,nodeLookup:I,rfId:T,panBy:R,updateConnection:L}=m.getState(),D=_.type==="target";p(!0),u==null||u(x,n,_.type);const z=($,U)=>{p(!1),d==null||d($,n,_.type,U)},B=$=>l==null?void 0:l(n,$);k_.onPointerDown(x.nativeEvent,{autoPanOnConnect:S,connectionMode:N,connectionRadius:M,domNode:E,handleId:_.id,nodeId:_.nodeId,nodeLookup:I,isTarget:D,edgeUpdaterType:_.type,lib:k,flowId:T,cancelConnection:C,panBy:R,isValidConnection:O,onConnect:B,onConnectStart:P,onConnectEnd:A,onReconnectEnd:z,updateConnection:L,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle})},v=x=>y(x,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),b=x=>y(x,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),w=()=>f(!0),j=()=>f(!1);return h.jsxs(h.Fragment,{children:[(e===!0||e==="source")&&h.jsx(bL,{position:s,centerX:r,centerY:a,radius:t,onMouseDown:v,onMouseEnter:w,onMouseOut:j,type:"source"}),(e===!0||e==="target")&&h.jsx(bL,{position:c,centerX:o,centerY:i,radius:t,onMouseDown:b,onMouseEnter:w,onMouseOut:j,type:"target"})]})}function Rue({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:r,onClick:a,onDoubleClick:o,onContextMenu:i,onMouseEnter:s,onMouseMove:c,onMouseLeave:l,reconnectRadius:u,onReconnect:d,onReconnectStart:p,onReconnectEnd:f,rfId:m,edgeTypes:y,noPanClassName:v,onError:b,disableKeyboardA11y:w}){let j=tt(V=>V.edgeLookup.get(e));const x=tt(V=>V.defaultEdgeOptions);j=x?{...x,...j}:j;let _=j.type||"default",S=(y==null?void 0:y[_])||yL[_];S===void 0&&(b==null||b("011",Io.error011(_)),_="default",S=yL.default);const E=!!(j.focusable||t&&typeof j.focusable>"u"),O=typeof d<"u"&&(j.reconnectable||n&&typeof j.reconnectable>"u"),N=!!(j.selectable||r&&typeof j.selectable>"u"),M=g.useRef(null),[k,P]=g.useState(!1),[A,C]=g.useState(!1),I=Lt(),{zIndex:T,sourceX:R,sourceY:L,targetX:D,targetY:z,sourcePosition:B,targetPosition:$}=tt(g.useCallback(V=>{const le=V.nodeLookup.get(j.source),ae=V.nodeLookup.get(j.target);if(!le||!ae)return{zIndex:j.zIndex,...gL};const de=Ice({id:e,sourceNode:le,targetNode:ae,sourceHandle:j.sourceHandle||null,targetHandle:j.targetHandle||null,connectionMode:V.connectionMode,onError:b});return{zIndex:Cce({selected:j.selected,zIndex:j.zIndex,sourceNode:le,targetNode:ae,elevateOnSelect:V.elevateEdgesOnSelect}),...de||gL}},[j.source,j.target,j.sourceHandle,j.targetHandle,j.selected,j.zIndex]),Ut),U=g.useMemo(()=>j.markerStart?`url('#${j_(j.markerStart,m)}')`:void 0,[j.markerStart,m]),F=g.useMemo(()=>j.markerEnd?`url('#${j_(j.markerEnd,m)}')`:void 0,[j.markerEnd,m]);if(j.hidden||R===null||L===null||D===null||z===null)return null;const H=V=>{var je;const{addSelectedEdges:le,unselectNodesAndEdges:ae,multiSelectionActive:de}=I.getState();N&&(I.setState({nodesSelectionActive:!1}),j.selected&&de?(ae({nodes:[],edges:[j]}),(je=M.current)==null||je.blur()):le([e])),a&&a(V,j)},re=o?V=>{o(V,{...j})}:void 0,ee=i?V=>{i(V,{...j})}:void 0,G=s?V=>{s(V,{...j})}:void 0,K=c?V=>{c(V,{...j})}:void 0,X=l?V=>{l(V,{...j})}:void 0,ne=V=>{var le;if(!w&&P4.includes(V.key)&&N){const{unselectNodesAndEdges:ae,addSelectedEdges:de}=I.getState();V.key==="Escape"?((le=M.current)==null||le.blur(),ae({edges:[j]})):de([e])}};return h.jsx("svg",{style:{zIndex:T},children:h.jsxs("g",{className:rn(["react-flow__edge",`react-flow__edge-${_}`,j.className,v,{selected:j.selected,animated:j.animated,inactive:!N&&!a,updating:k,selectable:N}]),onClick:H,onDoubleClick:re,onContextMenu:ee,onMouseEnter:G,onMouseMove:K,onMouseLeave:X,onKeyDown:E?ne:void 0,tabIndex:E?0:void 0,role:E?"button":"img","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":j.ariaLabel===null?void 0:j.ariaLabel||`Edge from ${j.source} to ${j.target}`,"aria-describedby":E?`${A5}-${m}`:void 0,ref:M,children:[!A&&h.jsx(S,{id:e,source:j.source,target:j.target,type:j.type,selected:j.selected,animated:j.animated,selectable:N,deletable:j.deletable??!0,label:j.label,labelStyle:j.labelStyle,labelShowBg:j.labelShowBg,labelBgStyle:j.labelBgStyle,labelBgPadding:j.labelBgPadding,labelBgBorderRadius:j.labelBgBorderRadius,sourceX:R,sourceY:L,targetX:D,targetY:z,sourcePosition:B,targetPosition:$,data:j.data,style:j.style,sourceHandleId:j.sourceHandle,targetHandleId:j.targetHandle,markerStart:U,markerEnd:F,pathOptions:"pathOptions"in j?j.pathOptions:void 0,interactionWidth:j.interactionWidth}),O&&h.jsx(Iue,{edge:j,isReconnectable:O,reconnectRadius:u,onReconnect:d,onReconnectStart:p,onReconnectEnd:f,sourceX:R,sourceY:L,targetX:D,targetY:z,sourcePosition:B,targetPosition:$,setUpdateHover:P,setReconnecting:C})]})})}const Due=e=>({width:e.width,height:e.height,edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function wL({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:r,noPanClassName:a,onReconnect:o,onEdgeContextMenu:i,onEdgeMouseEnter:s,onEdgeMouseMove:c,onEdgeMouseLeave:l,onEdgeClick:u,reconnectRadius:d,onEdgeDoubleClick:p,onReconnectStart:f,onReconnectEnd:m,disableKeyboardA11y:y}){const{edgesFocusable:v,edgesReconnectable:b,elementsSelectable:w,onError:j}=tt(Due,Ut),x=xue(t);return h.jsxs("div",{className:"react-flow__edges",children:[h.jsx(Oue,{defaultColor:e,rfId:n}),x.map(_=>h.jsx(Rue,{id:_,edgesFocusable:v,edgesReconnectable:b,elementsSelectable:w,noPanClassName:a,onReconnect:o,onContextMenu:i,onMouseEnter:s,onMouseMove:c,onMouseLeave:l,onClick:u,reconnectRadius:d,onDoubleClick:p,onReconnectStart:f,onReconnectEnd:m,rfId:n,onError:j,edgeTypes:r,disableKeyboardA11y:y},_))]})}wL.displayName="EdgeRenderer";const Lue=g.memo(wL),$ue=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Fue({children:e}){const t=tt($ue);return h.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Bue(e){const t=br(),n=g.useRef(!1);g.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const zue=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function Uue(e){const t=tt(zue),n=Lt();return g.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Vue(e){return e.connection.inProgress?{...e.connection,to:wd(e.connection.to,e.transform)}:{...e.connection}}function que(e){return Vue}function Wue(e){const t=que();return tt(t,Ut)}const Hue=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Kue({containerStyle:e,style:t,type:n,component:r}){const{nodesConnectable:a,width:o,height:i,isValid:s,inProgress:c}=tt(Hue,Ut);return o&&a&&c?h.jsx("svg",{style:e,width:o,height:i,className:"react-flow__connectionline react-flow__container",children:h.jsx("g",{className:rn(["react-flow__connection",R4(s)]),children:h.jsx(xL,{style:t,type:n,CustomComponent:r,isValid:s})})}):null}const xL=({style:e,type:t=yi.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:a,from:o,fromNode:i,fromHandle:s,fromPosition:c,to:l,toNode:u,toHandle:d,toPosition:p}=Wue();if(!a)return;if(n)return h.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:s,fromX:o.x,fromY:o.y,toX:l.x,toY:l.y,fromPosition:c,toPosition:p,connectionStatus:R4(r),toNode:u,toHandle:d});let f="";const m={sourceX:o.x,sourceY:o.y,sourcePosition:c,targetX:l.x,targetY:l.y,targetPosition:p};switch(t){case yi.Bezier:[f]=Y4(m);break;case yi.SimpleBezier:[f]=aL(m);break;case yi.Step:[f]=__({...m,borderRadius:0});break;case yi.SmoothStep:[f]=__(m);break;default:[f]=t5(m)}return h.jsx("path",{d:f,fill:"none",className:"react-flow__connection-path",style:e})};xL.displayName="ConnectionLine";const Zue={};function _L(e=Zue){g.useRef(e),Lt(),g.useEffect(()=>{},[e])}function Gue(){Lt(),g.useRef(!1),g.useEffect(()=>{},[])}function jL({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:r,onEdgeClick:a,onNodeDoubleClick:o,onEdgeDoubleClick:i,onNodeMouseEnter:s,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:u,onSelectionContextMenu:d,onSelectionStart:p,onSelectionEnd:f,connectionLineType:m,connectionLineStyle:y,connectionLineComponent:v,connectionLineContainerStyle:b,selectionKeyCode:w,selectionOnDrag:j,selectionMode:x,multiSelectionKeyCode:_,panActivationKeyCode:S,zoomActivationKeyCode:E,deleteKeyCode:O,onlyRenderVisibleElements:N,elementsSelectable:M,defaultViewport:k,translateExtent:P,minZoom:A,maxZoom:C,preventScrolling:I,defaultMarkerColor:T,zoomOnScroll:R,zoomOnPinch:L,panOnScroll:D,panOnScrollSpeed:z,panOnScrollMode:B,zoomOnDoubleClick:$,panOnDrag:U,onPaneClick:F,onPaneMouseEnter:H,onPaneMouseMove:re,onPaneMouseLeave:ee,onPaneScroll:G,onPaneContextMenu:K,paneClickDistance:X,nodeClickDistance:ne,onEdgeContextMenu:V,onEdgeMouseEnter:le,onEdgeMouseMove:ae,onEdgeMouseLeave:de,reconnectRadius:je,onReconnect:Le,onReconnectStart:$e,onReconnectEnd:Se,noDragClassName:Ve,noWheelClassName:He,noPanClassName:Ke,disableKeyboardA11y:It,nodeExtent:lt,rfId:ot,viewport:_t,onViewportChange:Qt}){return _L(e),_L(t),Gue(),Bue(n),Uue(_t),h.jsx(pue,{onPaneClick:F,onPaneMouseEnter:H,onPaneMouseMove:re,onPaneMouseLeave:ee,onPaneContextMenu:K,onPaneScroll:G,paneClickDistance:X,deleteKeyCode:O,selectionKeyCode:w,selectionOnDrag:j,selectionMode:x,onSelectionStart:p,onSelectionEnd:f,multiSelectionKeyCode:_,panActivationKeyCode:S,zoomActivationKeyCode:E,elementsSelectable:M,zoomOnScroll:R,zoomOnPinch:L,zoomOnDoubleClick:$,panOnScroll:D,panOnScrollSpeed:z,panOnScrollMode:B,panOnDrag:U,defaultViewport:k,translateExtent:P,minZoom:A,maxZoom:C,onSelectionContextMenu:d,preventScrolling:I,noDragClassName:Ve,noWheelClassName:He,noPanClassName:Ke,disableKeyboardA11y:It,onViewportChange:Qt,isControlledViewport:!!_t,children:h.jsxs(Fue,{children:[h.jsx(Lue,{edgeTypes:t,onEdgeClick:a,onEdgeDoubleClick:i,onReconnect:Le,onReconnectStart:$e,onReconnectEnd:Se,onlyRenderVisibleElements:N,onEdgeContextMenu:V,onEdgeMouseEnter:le,onEdgeMouseMove:ae,onEdgeMouseLeave:de,reconnectRadius:je,defaultMarkerColor:T,noPanClassName:Ke,disableKeyboardA11y:It,rfId:ot}),h.jsx(Kue,{style:y,type:m,component:v,containerStyle:b}),h.jsx("div",{className:"react-flow__edgelabel-renderer"}),h.jsx(wue,{nodeTypes:e,onNodeClick:r,onNodeDoubleClick:o,onNodeMouseEnter:s,onNodeMouseMove:c,onNodeMouseLeave:l,onNodeContextMenu:u,nodeClickDistance:ne,onlyRenderVisibleElements:N,noPanClassName:Ke,noDragClassName:Ve,disableKeyboardA11y:It,nodeExtent:lt,rfId:ot}),h.jsx("div",{className:"react-flow__viewport-portal"})]})})}jL.displayName="GraphView";const Xue=g.memo(jL),SL=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:a,height:o,fitView:i,nodeOrigin:s,nodeExtent:c}={})=>{const l=new Map,u=new Map,d=new Map,p=new Map,f=r??t??[],m=n??e??[],y=s??[0,0],v=c??md;c5(d,p,f),O_(m,l,u,{nodeOrigin:y,nodeExtent:v,elevateNodesOnSelect:!1});let b=[0,0,1];if(i&&a&&o){const w=vd(l,{filter:S=>!!((S.width||S.initialWidth)&&(S.height||S.initialHeight))}),{x:j,y:x,zoom:_}=w_(w,a,o,.5,2,.1);b=[j,x,_]}return{rfId:"1",width:0,height:0,transform:b,nodes:m,nodeLookup:l,parentLookup:u,edges:f,edgeLookup:p,connectionLookup:d,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:.5,maxZoom:2,translateExtent:md,nodeExtent:v,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Sc.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:y,nodeDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,fitViewOnInit:!1,fitViewDone:!1,fitViewOnInitOptions:void 0,selectNodesOnDrag:!0,multiSelectionActive:!1,connection:{...A4},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanSpeed:15,connectionRadius:20,onError:Ece,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1}},Jue=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:a,height:o,fitView:i,nodeOrigin:s,nodeExtent:c})=>yle((l,u)=>({...SL({nodes:e,edges:t,width:a,height:o,fitView:i,nodeOrigin:s,nodeExtent:c,defaultNodes:n,defaultEdges:r}),setNodes:d=>{const{nodeLookup:p,parentLookup:f,nodeOrigin:m,elevateNodesOnSelect:y}=u();O_(d,p,f,{nodeOrigin:m,nodeExtent:c,elevateNodesOnSelect:y,checkEquality:!0}),l({nodes:d})},setEdges:d=>{const{connectionLookup:p,edgeLookup:f}=u();c5(p,f,d),l({edges:d})},setDefaultNodesAndEdges:(d,p)=>{if(d){const{setNodes:f}=u();f(d),l({hasDefaultNodes:!0})}if(p){const{setEdges:f}=u();f(p),l({hasDefaultEdges:!0})}},updateNodeInternals:(d,p={triggerFitView:!0})=>{const{triggerNodeChanges:f,nodeLookup:m,parentLookup:y,fitViewOnInit:v,fitViewDone:b,fitViewOnInitOptions:w,domNode:j,nodeOrigin:x,nodeExtent:_,debug:S,fitViewSync:E}=u(),{changes:O,updatedInternals:N}=Bce(d,m,y,j,x,_);if(N){if(Lce(m,y,{nodeOrigin:x,nodeExtent:_}),p.triggerFitView){let M=b;!b&&v&&(M=E({...w,nodes:w==null?void 0:w.nodes})),l({fitViewDone:M})}else l({});(O==null?void 0:O.length)>0&&(S&&console.log("React Flow: trigger node changes",O),f==null||f(O))}},updateNodePositions:(d,p=!1)=>{const f=[],m=[];for(const[y,v]of d){const b={id:y,type:"position",position:v.position,dragging:p};v!=null&&v.expandParent&&(v!=null&&v.parentId)&&b.position&&(f.push({id:y,parentId:v.parentId,rect:{...v.internals.positionAbsolute,width:v.measured.width,height:v.measured.height}}),b.position.x=Math.max(0,b.position.x),b.position.y=Math.max(0,b.position.y)),m.push(b)}if(f.length>0){const{nodeLookup:y,parentLookup:v,nodeOrigin:b}=u(),w=N_(f,y,v,b);m.push(...w)}u().triggerNodeChanges(m)},triggerNodeChanges:d=>{const{onNodesChange:p,setNodes:f,nodes:m,hasDefaultNodes:y,debug:v}=u();if(d!=null&&d.length){if(y){const b=ps(d,m);f(b)}v&&console.log("React Flow: trigger node changes",d),p==null||p(d)}},triggerEdgeChanges:d=>{const{onEdgesChange:p,setEdges:f,edges:m,hasDefaultEdges:y,debug:v}=u();if(d!=null&&d.length){if(y){const b=Sd(d,m);f(b)}v&&console.log("React Flow: trigger edge changes",d),p==null||p(d)}},addSelectedNodes:d=>{const{multiSelectionActive:p,edgeLookup:f,nodeLookup:m,triggerNodeChanges:y,triggerEdgeChanges:v}=u();if(p){const b=d.map(w=>fs(w,!0));y(b);return}y(Pc(m,new Set([...d]),!0)),v(Pc(f))},addSelectedEdges:d=>{const{multiSelectionActive:p,edgeLookup:f,nodeLookup:m,triggerNodeChanges:y,triggerEdgeChanges:v}=u();if(p){const b=d.map(w=>fs(w,!0));v(b);return}v(Pc(f,new Set([...d]))),y(Pc(m,new Set,!0))},unselectNodesAndEdges:({nodes:d,edges:p}={})=>{const{edges:f,nodes:m,nodeLookup:y,triggerNodeChanges:v,triggerEdgeChanges:b}=u(),w=d||m,j=p||f,x=w.map(S=>{const E=y.get(S.id);return E&&(E.selected=!1),fs(S.id,!1)}),_=j.map(S=>fs(S.id,!1));v(x),b(_)},setMinZoom:d=>{const{panZoom:p,maxZoom:f}=u();p==null||p.setScaleExtent([d,f]),l({minZoom:d})},setMaxZoom:d=>{const{panZoom:p,minZoom:f}=u();p==null||p.setScaleExtent([f,d]),l({maxZoom:d})},setTranslateExtent:d=>{var p;(p=u().panZoom)==null||p.setTranslateExtent(d),l({translateExtent:d})},setPaneClickDistance:d=>{var p;(p=u().panZoom)==null||p.setClickDistance(d)},resetSelectedElements:()=>{const{edges:d,nodes:p,triggerNodeChanges:f,triggerEdgeChanges:m}=u(),y=p.reduce((b,w)=>w.selected?[...b,fs(w.id,!1)]:b,[]),v=d.reduce((b,w)=>w.selected?[...b,fs(w.id,!1)]:b,[]);f(y),m(v)},setNodeExtent:d=>{const{nodes:p,nodeLookup:f,parentLookup:m,nodeOrigin:y,elevateNodesOnSelect:v,nodeExtent:b}=u();d[0][0]===b[0][0]&&d[0][1]===b[0][1]&&d[1][0]===b[1][0]&&d[1][1]===b[1][1]||(O_(p,f,m,{nodeOrigin:y,nodeExtent:d,elevateNodesOnSelect:v,checkEquality:!1}),l({nodeExtent:d}))},panBy:d=>{const{transform:p,width:f,height:m,panZoom:y,translateExtent:v}=u();return zce({delta:d,panZoom:y,transform:p,translateExtent:v,width:f,height:m})},fitView:d=>{const{panZoom:p,width:f,height:m,minZoom:y,maxZoom:v,nodeLookup:b}=u();if(!p)return Promise.resolve(!1);const w=g_(b,d);return v_({nodes:w,width:f,height:m,panZoom:p,minZoom:y,maxZoom:v},d)},fitViewSync:d=>{const{panZoom:p,width:f,height:m,minZoom:y,maxZoom:v,nodeLookup:b}=u();if(!p)return!1;const w=g_(b,d);return v_({nodes:w,width:f,height:m,panZoom:p,minZoom:y,maxZoom:v},d),w.size>0},cancelConnection:()=>{l({connection:{...A4}})},updateConnection:d=>{l({connection:d})},reset:()=>l({...SL()})}),Object.is);function Yue({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:r,initialWidth:a,initialHeight:o,fitView:i,nodeOrigin:s,nodeExtent:c,children:l}){const[u]=g.useState(()=>Jue({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,width:a,height:o,fitView:i,nodeOrigin:s,nodeExtent:c}));return h.jsx(gle,{value:u,children:h.jsx(Ble,{children:l})})}function Que({children:e,nodes:t,edges:n,defaultNodes:r,defaultEdges:a,width:o,height:i,fitView:s,nodeOrigin:c,nodeExtent:l}){return g.useContext(hm)?h.jsx(h.Fragment,{children:e}):h.jsx(Yue,{initialNodes:t,initialEdges:n,defaultNodes:r,defaultEdges:a,initialWidth:o,initialHeight:i,fitView:s,nodeOrigin:c,nodeExtent:l,children:e})}const ede={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function tde({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:a,nodeTypes:o,edgeTypes:i,onNodeClick:s,onEdgeClick:c,onInit:l,onMove:u,onMoveStart:d,onMoveEnd:p,onConnect:f,onConnectStart:m,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:b,onNodeMouseEnter:w,onNodeMouseMove:j,onNodeMouseLeave:x,onNodeContextMenu:_,onNodeDoubleClick:S,onNodeDragStart:E,onNodeDrag:O,onNodeDragStop:N,onNodesDelete:M,onEdgesDelete:k,onDelete:P,onSelectionChange:A,onSelectionDragStart:C,onSelectionDrag:I,onSelectionDragStop:T,onSelectionContextMenu:R,onSelectionStart:L,onSelectionEnd:D,onBeforeDelete:z,connectionMode:B,connectionLineType:$=yi.Bezier,connectionLineStyle:U,connectionLineComponent:F,connectionLineContainerStyle:H,deleteKeyCode:re="Backspace",selectionKeyCode:ee="Shift",selectionOnDrag:G=!1,selectionMode:K=yd.Full,panActivationKeyCode:X="Space",multiSelectionKeyCode:ne=lm()?"Meta":"Control",zoomActivationKeyCode:V=lm()?"Meta":"Control",snapToGrid:le,snapGrid:ae,onlyRenderVisibleElements:de=!1,selectNodesOnDrag:je,nodesDraggable:Le,nodesConnectable:$e,nodesFocusable:Se,nodeOrigin:Ve=T5,edgesFocusable:He,edgesReconnectable:Ke,elementsSelectable:It=!0,defaultViewport:lt=kle,minZoom:ot=.5,maxZoom:_t=2,translateExtent:Qt=md,preventScrolling:ir=!0,nodeExtent:oo,defaultMarkerColor:sr="#b1b1b7",zoomOnScroll:io=!0,zoomOnPinch:J=!0,panOnScroll:te=!1,panOnScrollSpeed:ce=.5,panOnScrollMode:me=mi.Free,zoomOnDoubleClick:Te=!0,panOnDrag:Xt=!0,onPaneClick:Bt,onPaneMouseEnter:Ge,onPaneMouseMove:be,onPaneMouseLeave:_e,onPaneScroll:Ee,onPaneContextMenu:Oe,paneClickDistance:qe=0,nodeClickDistance:Mt=0,children:qt,onReconnect:q,onReconnectStart:Y,onReconnectEnd:oe,onEdgeContextMenu:fe,onEdgeDoubleClick:Ne,onEdgeMouseEnter:De,onEdgeMouseMove:ze,onEdgeMouseLeave:Me,reconnectRadius:Pe=10,onNodesChange:we,onEdgesChange:Ue,noDragClassName:nt="nodrag",noWheelClassName:Dt="nowheel",noPanClassName:zt="nopan",fitView:it,fitViewOptions:cr,connectOnClick:en,attributionPosition:Vs,proOptions:ka,defaultEdgeOptions:Ui,elevateNodesOnSelect:so,elevateEdgesOnSelect:ff,disableKeyboardA11y:Br=!1,autoPanOnConnect:Gl,autoPanOnNodeDrag:Xl,autoPanSpeed:Jl,connectionRadius:ht,isValidConnection:lr,onError:qs,style:Wt,id:ti,nodeDragThreshold:_v,viewport:DM,onViewportChange:pDe,width:fDe,height:hDe,colorMode:mDe="light",debug:yDe,...gDe},vDe){const LM=ti||"1",bDe=Ile(mDe);return h.jsx("div",{...gDe,style:{...Wt,...ede},ref:vDe,className:rn(["react-flow",a,bDe]),"data-testid":"rf__wrapper",id:ti,children:h.jsxs(Que,{nodes:e,edges:t,width:fDe,height:hDe,fitView:it,nodeOrigin:Ve,nodeExtent:oo,children:[h.jsx(Xue,{onInit:l,onNodeClick:s,onEdgeClick:c,onNodeMouseEnter:w,onNodeMouseMove:j,onNodeMouseLeave:x,onNodeContextMenu:_,onNodeDoubleClick:S,nodeTypes:o,edgeTypes:i,connectionLineType:$,connectionLineStyle:U,connectionLineComponent:F,connectionLineContainerStyle:H,selectionKeyCode:ee,selectionOnDrag:G,selectionMode:K,deleteKeyCode:re,multiSelectionKeyCode:ne,panActivationKeyCode:X,zoomActivationKeyCode:V,onlyRenderVisibleElements:de,defaultViewport:lt,translateExtent:Qt,minZoom:ot,maxZoom:_t,preventScrolling:ir,zoomOnScroll:io,zoomOnPinch:J,zoomOnDoubleClick:Te,panOnScroll:te,panOnScrollSpeed:ce,panOnScrollMode:me,panOnDrag:Xt,onPaneClick:Bt,onPaneMouseEnter:Ge,onPaneMouseMove:be,onPaneMouseLeave:_e,onPaneScroll:Ee,onPaneContextMenu:Oe,paneClickDistance:qe,nodeClickDistance:Mt,onSelectionContextMenu:R,onSelectionStart:L,onSelectionEnd:D,onReconnect:q,onReconnectStart:Y,onReconnectEnd:oe,onEdgeContextMenu:fe,onEdgeDoubleClick:Ne,onEdgeMouseEnter:De,onEdgeMouseMove:ze,onEdgeMouseLeave:Me,reconnectRadius:Pe,defaultMarkerColor:sr,noDragClassName:nt,noWheelClassName:Dt,noPanClassName:zt,rfId:LM,disableKeyboardA11y:Br,nodeExtent:oo,viewport:DM,onViewportChange:pDe}),h.jsx(Tle,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:f,onConnectStart:m,onConnectEnd:y,onClickConnectStart:v,onClickConnectEnd:b,nodesDraggable:Le,nodesConnectable:$e,nodesFocusable:Se,edgesFocusable:He,edgesReconnectable:Ke,elementsSelectable:It,elevateNodesOnSelect:so,elevateEdgesOnSelect:ff,minZoom:ot,maxZoom:_t,nodeExtent:oo,onNodesChange:we,onEdgesChange:Ue,snapToGrid:le,snapGrid:ae,connectionMode:B,translateExtent:Qt,connectOnClick:en,defaultEdgeOptions:Ui,fitView:it,fitViewOptions:cr,onNodesDelete:M,onEdgesDelete:k,onDelete:P,onNodeDragStart:E,onNodeDrag:O,onNodeDragStop:N,onSelectionDrag:I,onSelectionDragStart:C,onSelectionDragStop:T,onMove:u,onMoveStart:d,onMoveEnd:p,noPanClassName:zt,nodeOrigin:Ve,rfId:LM,autoPanOnConnect:Gl,autoPanOnNodeDrag:Xl,autoPanSpeed:Jl,onError:qs,connectionRadius:ht,isValidConnection:lr,selectNodesOnDrag:je,nodeDragThreshold:_v,onBeforeDelete:z,paneClickDistance:qe,debug:yDe}),h.jsx(Mle,{onSelectionChange:A}),qt,h.jsx(Sle,{proOptions:ka,position:Vs}),h.jsx(_le,{rfId:LM,disableKeyboardA11y:Br})]})})}var nde=q5(tde);const rde=e=>{var t;return(t=e.domNode)==null?void 0:t.querySelector(".react-flow__viewport-portal")};function ade({children:e}){const t=tt(rde);return t?Ql.createPortal(e,t):null}const ode=e=>e.nodes;function EL(){return tt(ode,Ut)}function bm({type:e,id:t=null,nodeId:n,onConnect:r,onDisconnect:a}){const o=$_(),i=n??o,s=g.useRef(null),c=tt(l=>l.connectionLookup.get(`${i}-${e}-${t}`),wce);return g.useEffect(()=>{if(s.current&&s.current!==c){const l=c??new Map;I4(s.current,l,a),I4(l,s.current,r)}s.current=c??new Map},[c,r,a]),g.useMemo(()=>Array.from((c==null?void 0:c.values())??[]),[c])}In=function(e){return tt(g.useCallback(t=>t.nodeLookup.get(e),[e]),Ut)};function ide({dimensions:e,lineWidth:t,variant:n,className:r}){return h.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:rn(["react-flow__background-pattern",n,r])})}function sde({radius:e,className:t}){return h.jsx("circle",{cx:e,cy:e,r:e,className:rn(["react-flow__background-pattern","dots",t])})}var Lo;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Lo||(Lo={}));const cde={[Lo.Dots]:1,[Lo.Lines]:1,[Lo.Cross]:6},lde=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function OL({id:e,variant:t=Lo.Dots,gap:n=20,size:r,lineWidth:a=1,offset:o=0,color:i,bgColor:s,style:c,className:l,patternClassName:u}){const d=g.useRef(null),{transform:p,patternId:f}=tt(lde,Ut),m=r||cde[t],y=t===Lo.Dots,v=t===Lo.Cross,b=Array.isArray(n)?n:[n,n],w=[b[0]*p[2]||1,b[1]*p[2]||1],j=m*p[2],x=Array.isArray(o)?o:[o,o],_=v?[j,j]:w,S=[x[0]*p[2]||1+_[0]/2,x[1]*p[2]||1+_[1]/2],E=`${f}${e||""}`;return h.jsxs("svg",{className:rn(["react-flow__background",l]),style:{...c,...ym,"--xy-background-color-props":s,"--xy-background-pattern-color-props":i},ref:d,"data-testid":"rf__background",children:[h.jsx("pattern",{id:E,x:p[0]%w[0],y:p[1]%w[1],width:w[0],height:w[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${S[0]},-${S[1]})`,children:y?h.jsx(sde,{radius:j/2,className:u}):h.jsx(ide,{dimensions:_,lineWidth:a,variant:t,className:u})}),h.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${E})`})]})}OL.displayName="Background";const ude=g.memo(OL);function dde(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:h.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function pde(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:h.jsx("path",{d:"M0 0h32v4.2H0z"})})}function fde(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:h.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function hde(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function mde(){return h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:h.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function wm({children:e,className:t,...n}){return h.jsx("button",{type:"button",className:rn(["react-flow__controls-button",t]),...n,children:e})}const yde=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom});function CL({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:a,onZoomIn:o,onZoomOut:i,onFitView:s,onInteractiveChange:c,className:l,children:u,position:d="bottom-left",orientation:p="vertical","aria-label":f="React Flow controls"}){const m=Lt(),{isInteractive:y,minZoomReached:v,maxZoomReached:b}=tt(yde,Ut),{zoomIn:w,zoomOut:j,fitView:x}=br(),_=()=>{w(),o==null||o()},S=()=>{j(),i==null||i()},E=()=>{x(a),s==null||s()},O=()=>{m.setState({nodesDraggable:!y,nodesConnectable:!y,elementsSelectable:!y}),c==null||c(!y)},N=p==="horizontal"?"horizontal":"vertical";return h.jsxs(kc,{className:rn(["react-flow__controls",N,l]),position:d,style:e,"data-testid":"rf__controls","aria-label":f,children:[t&&h.jsxs(h.Fragment,{children:[h.jsx(wm,{onClick:_,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:b,children:h.jsx(dde,{})}),h.jsx(wm,{onClick:S,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:v,children:h.jsx(pde,{})})]}),n&&h.jsx(wm,{className:"react-flow__controls-fitview",onClick:E,title:"fit view","aria-label":"fit view",children:h.jsx(fde,{})}),r&&h.jsx(wm,{className:"react-flow__controls-interactive",onClick:O,title:"toggle interactivity","aria-label":"toggle interactivity",children:y?h.jsx(mde,{}):h.jsx(hde,{})}),u]})}CL.displayName="Controls";const gde=g.memo(CL);function vde({id:e,x:t,y:n,width:r,height:a,style:o,color:i,strokeColor:s,strokeWidth:c,className:l,borderRadius:u,shapeRendering:d,selected:p,onClick:f}){const{background:m,backgroundColor:y}=o||{},v=i||m||y;return h.jsx("rect",{className:rn(["react-flow__minimap-node",{selected:p},l]),x:t,y:n,rx:u,ry:u,width:r,height:a,style:{fill:v,stroke:s,strokeWidth:c},shapeRendering:d,onClick:f?b=>f(b,e):void 0})}const bde=g.memo(vde),wde=e=>e.nodes.map(t=>t.id),F_=e=>e instanceof Function?e:()=>e;function xde({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:a,nodeComponent:o=bde,onClick:i}){const s=tt(wde,Ut),c=F_(t),l=F_(e),u=F_(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return h.jsx(h.Fragment,{children:s.map(p=>h.jsx(jde,{id:p,nodeColorFunc:c,nodeStrokeColorFunc:l,nodeClassNameFunc:u,nodeBorderRadius:r,nodeStrokeWidth:a,NodeComponent:o,onClick:i,shapeRendering:d},p))})}function _de({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:a,nodeStrokeWidth:o,shapeRendering:i,NodeComponent:s,onClick:c}){const{node:l,x:u,y:d,width:p,height:f}=tt(m=>{const y=m.nodeLookup.get(e),{x:v,y:b}=y.internals.positionAbsolute,{width:w,height:j}=Ro(y);return{node:y,x:v,y:b,width:w,height:j}},Ut);return!l||l.hidden||!W4(l)?null:h.jsx(s,{x:u,y:d,width:p,height:f,style:l.style,selected:!!l.selected,className:r(l),color:t(l),borderRadius:a,strokeColor:n(l),strokeWidth:o,shapeRendering:i,onClick:c,id:l.id})}const jde=g.memo(_de);var Sde=g.memo(xde);const Ede=200,Ode=150,Cde=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?U4(vd(e.nodeLookup),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height}},Nde="react-flow__minimap-desc";function NL({style:e,className:t,nodeStrokeColor:n,nodeColor:r,nodeClassName:a="",nodeBorderRadius:o=5,nodeStrokeWidth:i,nodeComponent:s,bgColor:c,maskColor:l,maskStrokeColor:u,maskStrokeWidth:d,position:p="bottom-right",onClick:f,onNodeClick:m,pannable:y=!1,zoomable:v=!1,ariaLabel:b="React Flow mini map",inversePan:w,zoomStep:j=10,offsetScale:x=5}){const _=Lt(),S=g.useRef(null),{boundingRect:E,viewBB:O,rfId:N,panZoom:M,translateExtent:k,flowWidth:P,flowHeight:A}=tt(Cde,Ut),C=(e==null?void 0:e.width)??Ede,I=(e==null?void 0:e.height)??Ode,T=E.width/C,R=E.height/I,L=Math.max(T,R),D=L*C,z=L*I,B=x*L,$=E.x-(D-E.width)/2-B,U=E.y-(z-E.height)/2-B,F=D+B*2,H=z+B*2,re=`${Nde}-${N}`,ee=g.useRef(0),G=g.useRef();ee.current=L,g.useEffect(()=>{if(S.current&&M)return G.current=Gce({domNode:S.current,panZoom:M,getTransform:()=>_.getState().transform,getViewScale:()=>ee.current}),()=>{var ne;(ne=G.current)==null||ne.destroy()}},[M]),g.useEffect(()=>{var ne;(ne=G.current)==null||ne.update({translateExtent:k,width:P,height:A,inversePan:w,pannable:y,zoomStep:j,zoomable:v})},[y,v,w,j,k,P,A]);const K=f?ne=>{var ae;const[V,le]=((ae=G.current)==null?void 0:ae.pointer(ne))||[0,0];f(ne,{x:V,y:le})}:void 0,X=m?g.useCallback((ne,V)=>{const le=_.getState().nodeLookup.get(V);m(ne,le)},[]):void 0;return h.jsx(kc,{position:p,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*L:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="string"?i:void 0},className:rn(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:h.jsxs("svg",{width:C,height:I,viewBox:`${$} ${U} ${F} ${H}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":re,ref:S,onClick:K,children:[b&&h.jsx("title",{id:re,children:b}),h.jsx(Sde,{onClick:X,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:o,nodeClassName:a,nodeStrokeWidth:i,nodeComponent:s}),h.jsx("path",{className:"react-flow__minimap-mask",d:`M${$-B},${U-B}h${F+B*2}v${H+B*2}h${-F-B*2}z
        M${O.x},${O.y}h${O.width}v${O.height}h${-O.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}NL.displayName="MiniMap";const Mde=g.memo(NL);function kde({nodeId:e,position:t,variant:n=Mc.Handle,className:r,style:a={},children:o,color:i,minWidth:s=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:p,onResizeStart:f,onResize:m,onResizeEnd:y}){const v=$_(),b=typeof e=="string"?e:v,w=Lt(),j=g.useRef(null),x=n===Mc.Line?"right":"bottom-right",_=t??x,S=g.useRef(null);g.useEffect(()=>{if(!(!j.current||!b))return S.current||(S.current=ple({domNode:j.current,nodeId:b,getStoreItems:()=>{const{nodeLookup:M,transform:k,snapGrid:P,snapToGrid:A,nodeOrigin:C,domNode:I}=w.getState();return{nodeLookup:M,transform:k,snapGrid:P,snapToGrid:A,nodeOrigin:C,paneDomNode:I}},onChange:(M,k)=>{const{triggerNodeChanges:P,nodeLookup:A,parentLookup:C,nodeOrigin:I}=w.getState(),T=[],R={x:M.x,y:M.y},L=A.get(b);if(L&&L.expandParent&&L.parentId){const D=L.origin??I,z=M.width??L.measured.width,B=M.height??L.measured.height,$={id:L.id,parentId:L.parentId,rect:{width:z,height:B,...H4({x:M.x??L.position.x,y:M.y??L.position.y},{width:z,height:B},L.parentId,A,D)}},U=N_([$],A,C,I);T.push(...U),R.x=M.x?Math.max(D[0]*z,M.x):void 0,R.y=M.y?Math.max(D[1]*B,M.y):void 0}if(R.x!==void 0&&R.y!==void 0){const D={id:b,type:"position",position:{...R}};T.push(D)}if(M.width!==void 0&&M.height!==void 0){const D={id:b,type:"dimensions",resizing:!0,setAttributes:!0,dimensions:{width:M.width,height:M.height}};T.push(D)}for(const D of k){const z={...D,type:"position"};T.push(z)}P(T)},onEnd:()=>{const M={id:b,type:"dimensions",resizing:!1};w.getState().triggerNodeChanges([M])}})),S.current.update({controlPosition:_,boundaries:{minWidth:s,minHeight:c,maxWidth:l,maxHeight:u},keepAspectRatio:d,onResizeStart:f,onResize:m,onResizeEnd:y,shouldResize:p}),()=>{var M;(M=S.current)==null||M.destroy()}},[_,s,c,l,u,d,f,m,y,p]);const E=_.split("-"),O=n===Mc.Line?"borderColor":"backgroundColor",N=i?{...a,[O]:i}:a;return h.jsx("div",{className:rn(["react-flow__resize-control","nodrag",...E,n,r]),ref:j,style:N,children:o})}const ML=g.memo(kde);function Pde({nodeId:e,isVisible:t=!0,handleClassName:n,handleStyle:r,lineClassName:a,lineStyle:o,color:i,minWidth:s=10,minHeight:c=10,maxWidth:l=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:p,onResizeStart:f,onResize:m,onResizeEnd:y}){return t?h.jsxs(h.Fragment,{children:[ole.map(v=>h.jsx(ML,{className:a,style:o,nodeId:e,position:v,variant:Mc.Line,color:i,minWidth:s,minHeight:c,maxWidth:l,maxHeight:u,onResizeStart:f,keepAspectRatio:d,shouldResize:p,onResize:m,onResizeEnd:y},v)),ale.map(v=>h.jsx(ML,{className:n,style:r,nodeId:e,position:v,color:i,minWidth:s,minHeight:c,maxWidth:l,maxHeight:u,onResizeStart:f,keepAspectRatio:d,shouldResize:p,onResize:m,onResizeEnd:y},v))]}):null}var B_,kL;function Ade(){if(kL)return B_;kL=1;var e=function(b){return t(b)&&!n(b)};function t(b){return!!b&&typeof b=="object"}function n(b){var w=Object.prototype.toString.call(b);return w==="[object RegExp]"||w==="[object Date]"||o(b)}var r=typeof Symbol=="function"&&Symbol.for,a=r?Symbol.for("react.element"):60103;function o(b){return b.$$typeof===a}function i(b){return Array.isArray(b)?[]:{}}function s(b,w){return w.clone!==!1&&w.isMergeableObject(b)?y(i(b),b,w):b}function c(b,w,j){return b.concat(w).map(function(x){return s(x,j)})}function l(b,w){if(!w.customMerge)return y;var j=w.customMerge(b);return typeof j=="function"?j:y}function u(b){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(b).filter(function(w){return Object.propertyIsEnumerable.call(b,w)}):[]}function d(b){return Object.keys(b).concat(u(b))}function p(b,w){try{return w in b}catch{return!1}}function f(b,w){return p(b,w)&&!(Object.hasOwnProperty.call(b,w)&&Object.propertyIsEnumerable.call(b,w))}function m(b,w,j){var x={};return j.isMergeableObject(b)&&d(b).forEach(function(_){x[_]=s(b[_],j)}),d(w).forEach(function(_){f(b,_)||(p(b,_)&&j.isMergeableObject(w[_])?x[_]=l(_,j)(b[_],w[_],j):x[_]=s(w[_],j))}),x}function y(b,w,j){j=j||{},j.arrayMerge=j.arrayMerge||c,j.isMergeableObject=j.isMergeableObject||e,j.cloneUnlessOtherwiseSpecified=s;var x=Array.isArray(w),_=Array.isArray(b),S=x===_;return S?x?j.arrayMerge(b,w,j):m(b,w,j):s(w,j)}y.all=function(b,w){if(!Array.isArray(b))throw new Error("first argument should be an array");return b.reduce(function(j,x){return y(j,x,w)},{})};var v=y;return B_=v,B_}var Tde=Ade();const xm=st(Tde);var PL={},AL;function Ide(){if(AL)return PL;AL=1;var e;return function(t){(function(n){var r=typeof globalThis=="object"?globalThis:typeof tu=="object"?tu:typeof self=="object"?self:typeof this=="object"?this:c(),a=o(t);typeof r.Reflect<"u"&&(a=o(r.Reflect,a)),n(a,r),typeof r.Reflect>"u"&&(r.Reflect=t);function o(l,u){return function(d,p){Object.defineProperty(l,d,{configurable:!0,writable:!0,value:p}),u&&u(d,p)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function c(){return i()||s()}})(function(n,r){var a=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",l={__proto__:[]}instanceof Array,u=!c&&!l,d={create:c?function(){return io(Object.create(null))}:l?function(){return io({__proto__:null})}:function(){return io({})},has:u?function(J,te){return a.call(J,te)}:function(J,te){return te in J},get:u?function(J,te){return a.call(J,te)?J[te]:void 0}:function(J,te){return J[te]}},p=Object.getPrototypeOf(Function),f=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ir(),m=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:oo(),y=typeof WeakMap=="function"?WeakMap:sr(),v=o?Symbol.for("@reflect-metadata:registry"):void 0,b=lt(),w=ot(b);function j(J,te,ce,me){if(U(ce)){if(!V(J))throw new TypeError;if(!ae(te))throw new TypeError;return A(J,te)}else{if(!V(J))throw new TypeError;if(!re(te))throw new TypeError;if(!re(me)&&!U(me)&&!F(me))throw new TypeError;return F(me)&&(me=void 0),ce=ne(ce),C(J,te,ce,me)}}n("decorate",j);function x(J,te){function ce(me,Te){if(!re(me))throw new TypeError;if(!U(Te)&&!de(Te))throw new TypeError;D(J,te,me,Te)}return ce}n("metadata",x);function _(J,te,ce,me){if(!re(ce))throw new TypeError;return U(me)||(me=ne(me)),D(J,te,ce,me)}n("defineMetadata",_);function S(J,te,ce){if(!re(te))throw new TypeError;return U(ce)||(ce=ne(ce)),I(J,te,ce)}n("hasMetadata",S);function E(J,te,ce){if(!re(te))throw new TypeError;return U(ce)||(ce=ne(ce)),T(J,te,ce)}n("hasOwnMetadata",E);function O(J,te,ce){if(!re(te))throw new TypeError;return U(ce)||(ce=ne(ce)),R(J,te,ce)}n("getMetadata",O);function N(J,te,ce){if(!re(te))throw new TypeError;return U(ce)||(ce=ne(ce)),L(J,te,ce)}n("getOwnMetadata",N);function M(J,te){if(!re(J))throw new TypeError;return U(te)||(te=ne(te)),z(J,te)}n("getMetadataKeys",M);function k(J,te){if(!re(J))throw new TypeError;return U(te)||(te=ne(te)),B(J,te)}n("getOwnMetadataKeys",k);function P(J,te,ce){if(!re(te))throw new TypeError;if(U(ce)||(ce=ne(ce)),!re(te))throw new TypeError;U(ce)||(ce=ne(ce));var me=Qt(te,ce,!1);return U(me)?!1:me.OrdinaryDeleteMetadata(J,te,ce)}n("deleteMetadata",P);function A(J,te){for(var ce=J.length-1;ce>=0;--ce){var me=J[ce],Te=me(te);if(!U(Te)&&!F(Te)){if(!ae(Te))throw new TypeError;te=Te}}return te}function C(J,te,ce,me){for(var Te=J.length-1;Te>=0;--Te){var Xt=J[Te],Bt=Xt(te,ce,me);if(!U(Bt)&&!F(Bt)){if(!re(Bt))throw new TypeError;me=Bt}}return me}function I(J,te,ce){var me=T(J,te,ce);if(me)return!0;var Te=Ke(te);return F(Te)?!1:I(J,Te,ce)}function T(J,te,ce){var me=Qt(te,ce,!1);return U(me)?!1:K(me.OrdinaryHasOwnMetadata(J,te,ce))}function R(J,te,ce){var me=T(J,te,ce);if(me)return L(J,te,ce);var Te=Ke(te);if(!F(Te))return R(J,Te,ce)}function L(J,te,ce){var me=Qt(te,ce,!1);if(!U(me))return me.OrdinaryGetOwnMetadata(J,te,ce)}function D(J,te,ce,me){var Te=Qt(ce,me,!0);Te.OrdinaryDefineOwnMetadata(J,te,ce,me)}function z(J,te){var ce=B(J,te),me=Ke(J);if(me===null)return ce;var Te=z(me,te);if(Te.length<=0)return ce;if(ce.length<=0)return Te;for(var Xt=new m,Bt=[],Ge=0,be=ce;Ge<be.length;Ge++){var _e=be[Ge],Ee=Xt.has(_e);Ee||(Xt.add(_e),Bt.push(_e))}for(var Oe=0,qe=Te;Oe<qe.length;Oe++){var _e=qe[Oe],Ee=Xt.has(_e);Ee||(Xt.add(_e),Bt.push(_e))}return Bt}function B(J,te){var ce=Qt(J,te,!1);return ce?ce.OrdinaryOwnMetadataKeys(J,te):[]}function $(J){if(J===null)return 1;switch(typeof J){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return J===null?1:6;default:return 6}}function U(J){return J===void 0}function F(J){return J===null}function H(J){return typeof J=="symbol"}function re(J){return typeof J=="object"?J!==null:typeof J=="function"}function ee(J,te){switch($(J)){case 0:return J;case 1:return J;case 2:return J;case 3:return J;case 4:return J;case 5:return J}var ce="string",me=Le(J,i);if(me!==void 0){var Te=me.call(J,ce);if(re(Te))throw new TypeError;return Te}return G(J)}function G(J,te){var ce,me;{var Te=J.toString;if(le(Te)){var me=Te.call(J);if(!re(me))return me}var ce=J.valueOf;if(le(ce)){var me=ce.call(J);if(!re(me))return me}}throw new TypeError}function K(J){return!!J}function X(J){return""+J}function ne(J){var te=ee(J);return H(te)?te:X(te)}function V(J){return Array.isArray?Array.isArray(J):J instanceof Object?J instanceof Array:Object.prototype.toString.call(J)==="[object Array]"}function le(J){return typeof J=="function"}function ae(J){return typeof J=="function"}function de(J){switch($(J)){case 3:return!0;case 4:return!0;default:return!1}}function je(J,te){return J===te||J!==J&&te!==te}function Le(J,te){var ce=J[te];if(ce!=null){if(!le(ce))throw new TypeError;return ce}}function $e(J){var te=Le(J,s);if(!le(te))throw new TypeError;var ce=te.call(J);if(!re(ce))throw new TypeError;return ce}function Se(J){return J.value}function Ve(J){var te=J.next();return te.done?!1:te}function He(J){var te=J.return;te&&te.call(J)}function Ke(J){var te=Object.getPrototypeOf(J);if(typeof J!="function"||J===p||te!==p)return te;var ce=J.prototype,me=ce&&Object.getPrototypeOf(ce);if(me==null||me===Object.prototype)return te;var Te=me.constructor;return typeof Te!="function"||Te===J?te:Te}function It(){var J;!U(v)&&typeof r.Reflect<"u"&&!(v in r.Reflect)&&typeof r.Reflect.defineMetadata=="function"&&(J=_t(r.Reflect));var te,ce,me,Te=new y,Xt={registerProvider:Bt,getProvider:be,setProvider:Ee};return Xt;function Bt(Oe){if(!Object.isExtensible(Xt))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case J===Oe:break;case U(te):te=Oe;break;case te===Oe:break;case U(ce):ce=Oe;break;case ce===Oe:break;default:me===void 0&&(me=new m),me.add(Oe);break}}function Ge(Oe,qe){if(!U(te)){if(te.isProviderFor(Oe,qe))return te;if(!U(ce)){if(ce.isProviderFor(Oe,qe))return te;if(!U(me))for(var Mt=$e(me);;){var qt=Ve(Mt);if(!qt)return;var q=Se(qt);if(q.isProviderFor(Oe,qe))return He(Mt),q}}}if(!U(J)&&J.isProviderFor(Oe,qe))return J}function be(Oe,qe){var Mt=Te.get(Oe),qt;return U(Mt)||(qt=Mt.get(qe)),U(qt)&&(qt=Ge(Oe,qe),U(qt)||(U(Mt)&&(Mt=new f,Te.set(Oe,Mt)),Mt.set(qe,qt))),qt}function _e(Oe){if(U(Oe))throw new TypeError;return te===Oe||ce===Oe||!U(me)&&me.has(Oe)}function Ee(Oe,qe,Mt){if(!_e(Mt))throw new Error("Metadata provider not registered.");var qt=be(Oe,qe);if(qt!==Mt){if(!U(qt))return!1;var q=Te.get(Oe);U(q)&&(q=new f,Te.set(Oe,q)),q.set(qe,Mt)}return!0}}function lt(){var J;return!U(v)&&re(r.Reflect)&&Object.isExtensible(r.Reflect)&&(J=r.Reflect[v]),U(J)&&(J=It()),!U(v)&&re(r.Reflect)&&Object.isExtensible(r.Reflect)&&Object.defineProperty(r.Reflect,v,{enumerable:!1,configurable:!1,writable:!1,value:J}),J}function ot(J){var te=new y,ce={isProviderFor:function(_e,Ee){var Oe=te.get(_e);return U(Oe)?!1:Oe.has(Ee)},OrdinaryDefineOwnMetadata:Bt,OrdinaryHasOwnMetadata:Te,OrdinaryGetOwnMetadata:Xt,OrdinaryOwnMetadataKeys:Ge,OrdinaryDeleteMetadata:be};return b.registerProvider(ce),ce;function me(_e,Ee,Oe){var qe=te.get(_e),Mt=!1;if(U(qe)){if(!Oe)return;qe=new f,te.set(_e,qe),Mt=!0}var qt=qe.get(Ee);if(U(qt)){if(!Oe)return;if(qt=new f,qe.set(Ee,qt),!J.setProvider(_e,Ee,ce))throw qe.delete(Ee),Mt&&te.delete(_e),new Error("Wrong provider for target.")}return qt}function Te(_e,Ee,Oe){var qe=me(Ee,Oe,!1);return U(qe)?!1:K(qe.has(_e))}function Xt(_e,Ee,Oe){var qe=me(Ee,Oe,!1);if(!U(qe))return qe.get(_e)}function Bt(_e,Ee,Oe,qe){var Mt=me(Oe,qe,!0);Mt.set(_e,Ee)}function Ge(_e,Ee){var Oe=[],qe=me(_e,Ee,!1);if(U(qe))return Oe;for(var Mt=qe.keys(),qt=$e(Mt),q=0;;){var Y=Ve(qt);if(!Y)return Oe.length=q,Oe;var oe=Se(Y);try{Oe[q]=oe}catch(fe){try{He(qt)}finally{throw fe}}q++}}function be(_e,Ee,Oe){var qe=me(Ee,Oe,!1);if(U(qe)||!qe.delete(_e))return!1;if(qe.size===0){var Mt=te.get(Ee);U(Mt)||(Mt.delete(Oe),Mt.size===0&&te.delete(Mt))}return!0}}function _t(J){var te=J.defineMetadata,ce=J.hasOwnMetadata,me=J.getOwnMetadata,Te=J.getOwnMetadataKeys,Xt=J.deleteMetadata,Bt=new y,Ge={isProviderFor:function(be,_e){var Ee=Bt.get(be);return!U(Ee)&&Ee.has(_e)?!0:Te(be,_e).length?(U(Ee)&&(Ee=new m,Bt.set(be,Ee)),Ee.add(_e),!0):!1},OrdinaryDefineOwnMetadata:te,OrdinaryHasOwnMetadata:ce,OrdinaryGetOwnMetadata:me,OrdinaryOwnMetadataKeys:Te,OrdinaryDeleteMetadata:Xt};return Ge}function Qt(J,te,ce){var me=b.getProvider(J,te);if(!U(me))return me;if(ce){if(b.setProvider(J,te,w))return w;throw new Error("Illegal state.")}}function ir(){var J={},te=[],ce=function(){function Ge(be,_e,Ee){this._index=0,this._keys=be,this._values=_e,this._selector=Ee}return Ge.prototype["@@iterator"]=function(){return this},Ge.prototype[s]=function(){return this},Ge.prototype.next=function(){var be=this._index;if(be>=0&&be<this._keys.length){var _e=this._selector(this._keys[be],this._values[be]);return be+1>=this._keys.length?(this._index=-1,this._keys=te,this._values=te):this._index++,{value:_e,done:!1}}return{value:void 0,done:!0}},Ge.prototype.throw=function(be){throw this._index>=0&&(this._index=-1,this._keys=te,this._values=te),be},Ge.prototype.return=function(be){return this._index>=0&&(this._index=-1,this._keys=te,this._values=te),{value:be,done:!0}},Ge}(),me=function(){function Ge(){this._keys=[],this._values=[],this._cacheKey=J,this._cacheIndex=-2}return Object.defineProperty(Ge.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ge.prototype.has=function(be){return this._find(be,!1)>=0},Ge.prototype.get=function(be){var _e=this._find(be,!1);return _e>=0?this._values[_e]:void 0},Ge.prototype.set=function(be,_e){var Ee=this._find(be,!0);return this._values[Ee]=_e,this},Ge.prototype.delete=function(be){var _e=this._find(be,!1);if(_e>=0){for(var Ee=this._keys.length,Oe=_e+1;Oe<Ee;Oe++)this._keys[Oe-1]=this._keys[Oe],this._values[Oe-1]=this._values[Oe];return this._keys.length--,this._values.length--,je(be,this._cacheKey)&&(this._cacheKey=J,this._cacheIndex=-2),!0}return!1},Ge.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=J,this._cacheIndex=-2},Ge.prototype.keys=function(){return new ce(this._keys,this._values,Te)},Ge.prototype.values=function(){return new ce(this._keys,this._values,Xt)},Ge.prototype.entries=function(){return new ce(this._keys,this._values,Bt)},Ge.prototype["@@iterator"]=function(){return this.entries()},Ge.prototype[s]=function(){return this.entries()},Ge.prototype._find=function(be,_e){if(!je(this._cacheKey,be)){this._cacheIndex=-1;for(var Ee=0;Ee<this._keys.length;Ee++)if(je(this._keys[Ee],be)){this._cacheIndex=Ee;break}}return this._cacheIndex<0&&_e&&(this._cacheIndex=this._keys.length,this._keys.push(be),this._values.push(void 0)),this._cacheIndex},Ge}();return me;function Te(Ge,be){return Ge}function Xt(Ge,be){return be}function Bt(Ge,be){return[Ge,be]}}function oo(){var J=function(){function te(){this._map=new f}return Object.defineProperty(te.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),te.prototype.has=function(ce){return this._map.has(ce)},te.prototype.add=function(ce){return this._map.set(ce,ce),this},te.prototype.delete=function(ce){return this._map.delete(ce)},te.prototype.clear=function(){this._map.clear()},te.prototype.keys=function(){return this._map.keys()},te.prototype.values=function(){return this._map.keys()},te.prototype.entries=function(){return this._map.entries()},te.prototype["@@iterator"]=function(){return this.keys()},te.prototype[s]=function(){return this.keys()},te}();return J}function sr(){var J=16,te=d.create(),ce=me();return function(){function be(){this._key=me()}return be.prototype.has=function(_e){var Ee=Te(_e,!1);return Ee!==void 0?d.has(Ee,this._key):!1},be.prototype.get=function(_e){var Ee=Te(_e,!1);return Ee!==void 0?d.get(Ee,this._key):void 0},be.prototype.set=function(_e,Ee){var Oe=Te(_e,!0);return Oe[this._key]=Ee,this},be.prototype.delete=function(_e){var Ee=Te(_e,!1);return Ee!==void 0?delete Ee[this._key]:!1},be.prototype.clear=function(){this._key=me()},be}();function me(){var be;do be="@@WeakMap@@"+Ge();while(d.has(te,be));return te[be]=!0,be}function Te(be,_e){if(!a.call(be,ce)){if(!_e)return;Object.defineProperty(be,ce,{value:d.create()})}return be[ce]}function Xt(be,_e){for(var Ee=0;Ee<_e;++Ee)be[Ee]=Math.random()*255|0;return be}function Bt(be){if(typeof Uint8Array=="function"){var _e=new Uint8Array(be);return typeof crypto<"u"?crypto.getRandomValues(_e):typeof msCrypto<"u"?msCrypto.getRandomValues(_e):Xt(_e,be),_e}return Xt(new Array(be),be)}function Ge(){var be=Bt(J);be[6]=be[6]&79|64,be[8]=be[8]&191|128;for(var _e="",Ee=0;Ee<J;++Ee){var Oe=be[Ee];(Ee===4||Ee===6||Ee===8)&&(_e+="-"),Oe<16&&(_e+="0"),_e+=Oe.toString(16).toLowerCase()}return _e}}function io(J){return J.__=void 0,delete J.__,J}})}(e||(e={})),PL}Ide(),typeof window<"u"&&(window.Buffer=ADe),typeof Tv<"u"&&typeof require<"u"&&(Tv.Buffer=require("buffer/").Buffer);class an{static isObject(t){return t!==null&&typeof t=="object"}static isObjectWithName(t){return t!==null&&typeof t=="object"&&t.name!==void 0}static assign(t,...n){for(const r of n)for(const a of Object.getOwnPropertyNames(r))t[a]=r[a]}static mixedListToArray(t){return t!==null&&typeof t=="object"?Object.keys(t).map(n=>t[n]):t}}class xe extends Error{get name(){return this.constructor.name}constructor(t){super(t),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}class Ac extends xe{constructor(){super("Locking not supported on given driver.")}}class z_ extends xe{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}class At{static isMssqlParameter(t){return this.check(t,"MssqlParameter")}static isEntityMetadata(t){return this.check(t,"EntityMetadata")}static isColumnMetadata(t){return this.check(t,"ColumnMetadata")}static isSelectQueryBuilder(t){return this.check(t,"SelectQueryBuilder")}static isInsertQueryBuilder(t){return this.check(t,"InsertQueryBuilder")}static isDeleteQueryBuilder(t){return this.check(t,"DeleteQueryBuilder")}static isUpdateQueryBuilder(t){return this.check(t,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(t){return this.check(t,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(t){return this.check(t,"RelationQueryBuilder")}static isBrackets(t){return this.check(t,"Brackets")||this.check(t,"NotBrackets")}static isNotBrackets(t){return this.check(t,"NotBrackets")}static isSubject(t){return this.check(t,"Subject")}static isRdbmsSchemaBuilder(t){return this.check(t,"RdbmsSchemaBuilder")}static isMongoEntityManager(t){return this.check(t,"MongoEntityManager")}static isSqljsEntityManager(t){return this.check(t,"SqljsEntityManager")}static isEntitySchema(t){return this.check(t,"EntitySchema")}static isBaseEntityConstructor(t){return typeof t=="function"&&typeof t.hasId=="function"&&typeof t.save=="function"&&typeof t.useDataSource=="function"}static isFindOperator(t){return this.check(t,"FindOperator")||this.check(t,"EqualOperator")}static isEqualOperator(t){return this.check(t,"EqualOperator")}static isQuery(t){return this.check(t,"Query")}static isTable(t){return this.check(t,"Table")}static isTableCheck(t){return this.check(t,"TableCheck")}static isTableColumn(t){return this.check(t,"TableColumn")}static isTableExclusion(t){return this.check(t,"TableExclusion")}static isTableForeignKey(t){return this.check(t,"TableForeignKey")}static isTableIndex(t){return this.check(t,"TableIndex")}static isTableUnique(t){return this.check(t,"TableUnique")}static isView(t){return this.check(t,"View")}static isDataSource(t){return this.check(t,"DataSource")}static check(t,n){return typeof t=="object"&&t!==null&&t["@instanceof"]===Symbol.for(n)}}class Rde extends xe{constructor(t,n){super(),this.entityClass=t,this.criteria=n,this.message=`Could not find any entity of type "${this.stringifyTarget(t)}" matching: ${this.stringifyCriteria(n)}`}stringifyTarget(t){return At.isEntitySchema(t)?t.options.name:typeof t=="function"||an.isObject(t)&&"name"in t?t.name:t}stringifyCriteria(t){try{return JSON.stringify(t,null,4)}catch{}return""+t}}class TL extends xe{constructor(t,n,r){super(`The optimistic lock on entity ${t} failed, version ${n} was expected, but is actually ${r}.`)}}class IL extends xe{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}class Dde extends xe{constructor(t){super(`Entity "${t.name}" does not have delete date columns.`)}}class _m extends xe{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}class qa extends xe{constructor(t,n){super(t),Object.setPrototypeOf(this,qa.prototype),this.message=`Property "${t}" was not found in "${n.targetName}". Make sure your query is correct.`}}class Lde extends xe{constructor(t){super(`Entity ${t} does not have version or update date columns.`)}}class $de extends xe{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}class Od extends xe{constructor(){super("The optimistic lock can be used only with getOne() method.")}}class Fde extends xe{constructor(t){super(),t.length===1?this.message=`Relation "${t[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${t.map(n=>`"${n}"`).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}class Bde extends xe{constructor(){super("An open transaction is required for pessimistic lock.")}}class zde extends xe{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}class RL{constructor(t){an.assign(this,t||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(t){this._metadata=t}get metadata(){if(!this._metadata)throw new xe(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}class Wa{static isAliasProperty(t){if(typeof t!="string"||t.indexOf(".")===-1)return!1;const[n,r]=t.split(".");return!(!n||!r||t.indexOf("(")!==-1||t.indexOf(")")!==-1)}}var U_={exports:{}},V_={exports:{}},DL;function Tc(){return DL||(DL=1,typeof Object.create=="function"?V_.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:V_.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}),V_.exports}var q_={exports:{}},LL;function hs(){return LL||(LL=1,function(e,t){var n=TDe(),r=n.Buffer;function a(i,s){for(var c in i)s[c]=i[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=o);function o(i,s,c){return r(i,s,c)}o.prototype=Object.create(r.prototype),a(r,o),o.from=function(i,s,c){if(typeof i=="number")throw new TypeError("Argument must not be a number");return r(i,s,c)},o.alloc=function(i,s,c){if(typeof i!="number")throw new TypeError("Argument must be a number");var l=r(i);return s!==void 0?typeof c=="string"?l.fill(s,c):l.fill(s):l.fill(0),l},o.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return r(i)},o.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(i)}}(q_,q_.exports)),q_.exports}var W_,$L;function Ic(){if($L)return W_;$L=1;var e=hs().Buffer;function t(n,r){this._block=e.alloc(n),this._finalSize=r,this._blockSize=n,this._len=0}return t.prototype.update=function(n,r){typeof n=="string"&&(r=r||"utf8",n=e.from(n,r));for(var a=this._block,o=this._blockSize,i=n.length,s=this._len,c=0;c<i;){for(var l=s%o,u=Math.min(i-c,o-l),d=0;d<u;d++)a[l+d]=n[c+d];s+=u,c+=u,s%o===0&&this._update(a)}return this._len+=i,this},t.prototype.digest=function(n){var r=this._len%this._blockSize;this._block[r]=128,this._block.fill(0,r+1),r>=this._finalSize&&(this._update(this._block),this._block.fill(0));var a=this._len*8;if(a<=4294967295)this._block.writeUInt32BE(a,this._blockSize-4);else{var o=(a&4294967295)>>>0,i=(a-o)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(o,this._blockSize-4)}this._update(this._block);var s=this._hash();return n?s.toString(n):s},t.prototype._update=function(){throw new Error("_update must be implemented by subclass")},W_=t,W_}var H_,FL;function Ude(){if(FL)return H_;FL=1;var e=Tc(),t=Ic(),n=hs().Buffer,r=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function o(){this.init(),this._w=a,t.call(this,64,56)}e(o,t),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function i(l){return l<<5|l>>>27}function s(l){return l<<30|l>>>2}function c(l,u,d,p){return l===0?u&d|~u&p:l===2?u&d|u&p|d&p:u^d^p}return o.prototype._update=function(l){for(var u=this._w,d=this._a|0,p=this._b|0,f=this._c|0,m=this._d|0,y=this._e|0,v=0;v<16;++v)u[v]=l.readInt32BE(v*4);for(;v<80;++v)u[v]=u[v-3]^u[v-8]^u[v-14]^u[v-16];for(var b=0;b<80;++b){var w=~~(b/20),j=i(d)+c(w,p,f,m)+y+u[b]+r[w]|0;y=m,m=f,f=s(p),p=d,d=j}this._a=d+this._a|0,this._b=p+this._b|0,this._c=f+this._c|0,this._d=m+this._d|0,this._e=y+this._e|0},o.prototype._hash=function(){var l=n.allocUnsafe(20);return l.writeInt32BE(this._a|0,0),l.writeInt32BE(this._b|0,4),l.writeInt32BE(this._c|0,8),l.writeInt32BE(this._d|0,12),l.writeInt32BE(this._e|0,16),l},H_=o,H_}var K_,BL;function Vde(){if(BL)return K_;BL=1;var e=Tc(),t=Ic(),n=hs().Buffer,r=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function o(){this.init(),this._w=a,t.call(this,64,56)}e(o,t),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function i(u){return u<<1|u>>>31}function s(u){return u<<5|u>>>27}function c(u){return u<<30|u>>>2}function l(u,d,p,f){return u===0?d&p|~d&f:u===2?d&p|d&f|p&f:d^p^f}return o.prototype._update=function(u){for(var d=this._w,p=this._a|0,f=this._b|0,m=this._c|0,y=this._d|0,v=this._e|0,b=0;b<16;++b)d[b]=u.readInt32BE(b*4);for(;b<80;++b)d[b]=i(d[b-3]^d[b-8]^d[b-14]^d[b-16]);for(var w=0;w<80;++w){var j=~~(w/20),x=s(p)+l(j,f,m,y)+v+d[w]+r[j]|0;v=y,y=m,m=c(f),f=p,p=x}this._a=p+this._a|0,this._b=f+this._b|0,this._c=m+this._c|0,this._d=y+this._d|0,this._e=v+this._e|0},o.prototype._hash=function(){var u=n.allocUnsafe(20);return u.writeInt32BE(this._a|0,0),u.writeInt32BE(this._b|0,4),u.writeInt32BE(this._c|0,8),u.writeInt32BE(this._d|0,12),u.writeInt32BE(this._e|0,16),u},K_=o,K_}var Z_,zL;function UL(){if(zL)return Z_;zL=1;var e=Tc(),t=Ic(),n=hs().Buffer,r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);function o(){this.init(),this._w=a,t.call(this,64,56)}e(o,t),o.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function i(p,f,m){return m^p&(f^m)}function s(p,f,m){return p&f|m&(p|f)}function c(p){return(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10)}function l(p){return(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7)}function u(p){return(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3}function d(p){return(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10}return o.prototype._update=function(p){for(var f=this._w,m=this._a|0,y=this._b|0,v=this._c|0,b=this._d|0,w=this._e|0,j=this._f|0,x=this._g|0,_=this._h|0,S=0;S<16;++S)f[S]=p.readInt32BE(S*4);for(;S<64;++S)f[S]=d(f[S-2])+f[S-7]+u(f[S-15])+f[S-16]|0;for(var E=0;E<64;++E){var O=_+l(w)+i(w,j,x)+r[E]+f[E]|0,N=c(m)+s(m,y,v)|0;_=x,x=j,j=w,w=b+O|0,b=v,v=y,y=m,m=O+N|0}this._a=m+this._a|0,this._b=y+this._b|0,this._c=v+this._c|0,this._d=b+this._d|0,this._e=w+this._e|0,this._f=j+this._f|0,this._g=x+this._g|0,this._h=_+this._h|0},o.prototype._hash=function(){var p=n.allocUnsafe(32);return p.writeInt32BE(this._a,0),p.writeInt32BE(this._b,4),p.writeInt32BE(this._c,8),p.writeInt32BE(this._d,12),p.writeInt32BE(this._e,16),p.writeInt32BE(this._f,20),p.writeInt32BE(this._g,24),p.writeInt32BE(this._h,28),p},Z_=o,Z_}var G_,VL;function qde(){if(VL)return G_;VL=1;var e=Tc(),t=UL(),n=Ic(),r=hs().Buffer,a=new Array(64);function o(){this.init(),this._w=a,n.call(this,64,56)}return e(o,t),o.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},o.prototype._hash=function(){var i=r.allocUnsafe(28);return i.writeInt32BE(this._a,0),i.writeInt32BE(this._b,4),i.writeInt32BE(this._c,8),i.writeInt32BE(this._d,12),i.writeInt32BE(this._e,16),i.writeInt32BE(this._f,20),i.writeInt32BE(this._g,24),i},G_=o,G_}var X_,qL;function WL(){if(qL)return X_;qL=1;var e=Tc(),t=Ic(),n=hs().Buffer,r=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],a=new Array(160);function o(){this.init(),this._w=a,t.call(this,128,112)}e(o,t),o.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function i(y,v,b){return b^y&(v^b)}function s(y,v,b){return y&v|b&(y|v)}function c(y,v){return(y>>>28|v<<4)^(v>>>2|y<<30)^(v>>>7|y<<25)}function l(y,v){return(y>>>14|v<<18)^(y>>>18|v<<14)^(v>>>9|y<<23)}function u(y,v){return(y>>>1|v<<31)^(y>>>8|v<<24)^y>>>7}function d(y,v){return(y>>>1|v<<31)^(y>>>8|v<<24)^(y>>>7|v<<25)}function p(y,v){return(y>>>19|v<<13)^(v>>>29|y<<3)^y>>>6}function f(y,v){return(y>>>19|v<<13)^(v>>>29|y<<3)^(y>>>6|v<<26)}function m(y,v){return y>>>0<v>>>0?1:0}return o.prototype._update=function(y){for(var v=this._w,b=this._ah|0,w=this._bh|0,j=this._ch|0,x=this._dh|0,_=this._eh|0,S=this._fh|0,E=this._gh|0,O=this._hh|0,N=this._al|0,M=this._bl|0,k=this._cl|0,P=this._dl|0,A=this._el|0,C=this._fl|0,I=this._gl|0,T=this._hl|0,R=0;R<32;R+=2)v[R]=y.readInt32BE(R*4),v[R+1]=y.readInt32BE(R*4+4);for(;R<160;R+=2){var L=v[R-30],D=v[R-15*2+1],z=u(L,D),B=d(D,L);L=v[R-2*2],D=v[R-2*2+1];var $=p(L,D),U=f(D,L),F=v[R-7*2],H=v[R-7*2+1],re=v[R-16*2],ee=v[R-16*2+1],G=B+H|0,K=z+F+m(G,B)|0;G=G+U|0,K=K+$+m(G,U)|0,G=G+ee|0,K=K+re+m(G,ee)|0,v[R]=K,v[R+1]=G}for(var X=0;X<160;X+=2){K=v[X],G=v[X+1];var ne=s(b,w,j),V=s(N,M,k),le=c(b,N),ae=c(N,b),de=l(_,A),je=l(A,_),Le=r[X],$e=r[X+1],Se=i(_,S,E),Ve=i(A,C,I),He=T+je|0,Ke=O+de+m(He,T)|0;He=He+Ve|0,Ke=Ke+Se+m(He,Ve)|0,He=He+$e|0,Ke=Ke+Le+m(He,$e)|0,He=He+G|0,Ke=Ke+K+m(He,G)|0;var It=ae+V|0,lt=le+ne+m(It,ae)|0;O=E,T=I,E=S,I=C,S=_,C=A,A=P+He|0,_=x+Ke+m(A,P)|0,x=j,P=k,j=w,k=M,w=b,M=N,N=He+It|0,b=Ke+lt+m(N,He)|0}this._al=this._al+N|0,this._bl=this._bl+M|0,this._cl=this._cl+k|0,this._dl=this._dl+P|0,this._el=this._el+A|0,this._fl=this._fl+C|0,this._gl=this._gl+I|0,this._hl=this._hl+T|0,this._ah=this._ah+b+m(this._al,N)|0,this._bh=this._bh+w+m(this._bl,M)|0,this._ch=this._ch+j+m(this._cl,k)|0,this._dh=this._dh+x+m(this._dl,P)|0,this._eh=this._eh+_+m(this._el,A)|0,this._fh=this._fh+S+m(this._fl,C)|0,this._gh=this._gh+E+m(this._gl,I)|0,this._hh=this._hh+O+m(this._hl,T)|0},o.prototype._hash=function(){var y=n.allocUnsafe(64);function v(b,w,j){y.writeInt32BE(b,j),y.writeInt32BE(w,j+4)}return v(this._ah,this._al,0),v(this._bh,this._bl,8),v(this._ch,this._cl,16),v(this._dh,this._dl,24),v(this._eh,this._el,32),v(this._fh,this._fl,40),v(this._gh,this._gl,48),v(this._hh,this._hl,56),y},X_=o,X_}var J_,HL;function Wde(){if(HL)return J_;HL=1;var e=Tc(),t=WL(),n=Ic(),r=hs().Buffer,a=new Array(160);function o(){this.init(),this._w=a,n.call(this,128,112)}return e(o,t),o.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},o.prototype._hash=function(){var i=r.allocUnsafe(48);function s(c,l,u){i.writeInt32BE(c,u),i.writeInt32BE(l,u+4)}return s(this._ah,this._al,0),s(this._bh,this._bl,8),s(this._ch,this._cl,16),s(this._dh,this._dl,24),s(this._eh,this._el,32),s(this._fh,this._fl,40),i},J_=o,J_}var KL;function Hde(){if(KL)return U_.exports;KL=1;var e=U_.exports=function(t){t=t.toLowerCase();var n=e[t];if(!n)throw new Error(t+" is not supported (we accept pull requests)");return new n};return e.sha=Ude(),e.sha1=Vde(),e.sha224=qde(),e.sha256=UL(),e.sha384=Wde(),e.sha512=WL(),U_.exports}var Kde=Hde();const Zde=st(Kde);function Gde(e,t={}){const{segmentLength:n=4,separator:r="__",termLength:a=2}=t;return e.split(r).reduce((o,i)=>{const s=i.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),c=s.length>1?a:n,l=s.map(u=>u.substr(0,c)).join("");return o.push(l),o},[]).join(r)}function Xde(e,t={}){const n=Zde("sha1");n.update(e,"utf8");const r=n.digest("hex");return t.length?r.slice(0,t.length):r}class Jde{static isGreaterOrEqual(t,n){const r=ZL(t),a=ZL(n);return r[0]>a[0]||r[0]===a[0]&&r[1]>a[1]||r[0]===a[0]&&r[1]===a[1]&&r[2]>=a[2]}}function ZL(e=""){const t=[0,0,0];return e.split(".").forEach((n,r)=>t[r]=parseInt(n,10)),t}class ve{static isSQLiteFamily(t){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(t.options.type)}static isMySQLFamily(t){return["mysql","mariadb"].includes(t.options.type)}static isReleaseVersionOrGreater(t,n){return t.version!=null&&Jde.isGreaterOrEqual(t.version,n)}static isPostgresFamily(t){return["postgres","aurora-postgres","cockroachdb"].includes(t.options.type)}static buildDriverOptions(t,n){if(t.url){const r=this.parseConnectionUrl(t.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const a of Object.keys(r))typeof r[a]>"u"&&delete r[a];return Object.assign({},t,r)}return Object.assign({},t)}static buildMongoDBDriverOptions(t,n){if(t.url){const r=this.parseMongoDBConnectionUrl(t.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const a of Object.keys(r))typeof r[a]>"u"&&delete r[a];return Object.assign({},t,r)}return Object.assign({},t)}static buildAlias({maxAliasLength:t},n,...r){const a=n&&n.joiner?n.joiner:"_";let o=r.length===1?r[0]:r.join(a);if(t&&t>0&&o.length>t){if(n&&n.shorten===!0){const i=Gde(o);if(i.length<t)return i}return Xde(o,{length:t})}return o}static buildColumnAlias({maxAliasLength:t},n,...r){return typeof n=="string"?(r.unshift(n),n={shorten:!1,joiner:"_"}):n=Object.assign({shorten:!1,joiner:"_"},n),this.buildAlias({maxAliasLength:t},n,...r)}static parseConnectionUrl(t){const n=t.split(":")[0],r=t.indexOf("//"),a=t.substr(r+2),o=a.indexOf("/"),i=o!==-1?a.substr(0,o):a;let s=o!==-1?a.substr(o+1):void 0;s&&s.indexOf("?")!==-1&&(s=s.substr(0,s.indexOf("?")));const c=i.lastIndexOf("@"),l=i.substr(0,c),u=i.substr(c+1);let d=l,p="";const f=l.indexOf(":");f!==-1&&(d=l.substr(0,f),p=l.substr(f+1));const[m,y]=u.split(":");return{type:n,host:m,username:decodeURIComponent(d),password:decodeURIComponent(p),port:y?parseInt(y):void 0,database:s||void 0}}static parseMongoDBConnectionUrl(t){const n=t.split(":")[0],r=t.indexOf("//"),a=t.substr(r+2),o=a.indexOf("/"),i=o!==-1?a.substr(0,o):a;let s=o!==-1?a.substr(o+1):void 0,c="",l,u,d,p,f={};if(s&&s.indexOf("?")!==-1){c=s.substr(s.indexOf("?")+1,s.length);const _=c.split("&");let S,E;_.forEach(O=>{S=O.split("=")[0],E=O.split("=")[1],f[S]=E}),p=f.replicaSet,s=s.substr(0,s.indexOf("?"))}const m=i.lastIndexOf("@"),y=i.substr(0,m),v=i.substr(m+1);let b=y,w="";const j=y.indexOf(":");j!==-1&&(b=y.substr(0,j),w=y.substr(j+1)),p?d=v:[l,u]=v.split(":");let x={type:n,host:l,hostReplicaSet:d,username:decodeURIComponent(b),password:decodeURIComponent(w),port:u?parseInt(u):void 0,database:s||void 0};for(const[_,S]of Object.entries(f))x[_]=S;return x}}class GL{constructor(t,n,r){this.connection=t,this.queryExpressionMap=n,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,r&&an.assign(this,r)}get isMany(){return this.isMappingMany!==void 0?this.isMappingMany:this.relation?this.relation.isManyToMany||this.relation.isOneToMany:!1}get isSelected(){if(!this.isSelectedEvaluated){let t=()=>{for(const n of this.queryExpressionMap.selects)if(n.selection===this.alias.name||this.metadata&&this.metadata.columns.find(r=>n.selection===this.alias.name+"."+r.propertyPath))return!0;return!1};this.isSelectedCache=t(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(Wa.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(Wa.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let t=()=>{if(!Wa.isAliasProperty(this.entityOrProperty))return;const n=this.queryExpressionMap.findAliasByName(this.parentAlias);let r=n.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(r||n.metadata.parentEntityMetadata&&(r=n.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),r))return r;throw new xe(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=t.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){if(this.relation)return this.relation.inverseEntityMetadata;if(this.connection.hasMetadata(this.entityOrProperty))return this.connection.getMetadata(this.entityOrProperty);if(this.mapAsEntity&&this.connection.hasMetadata(this.mapAsEntity))return this.connection.getMetadata(this.mapAsEntity)}get junctionAlias(){if(!this.relation)throw new xe("Cannot get junction table for join without relation.");if(typeof this.entityOrProperty!="string")throw new xe("Junction property is not defined.");const t=this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."));return this.relation.isOwning?ve.buildAlias(this.connection.driver,void 0,t,this.alias.name):ve.buildAlias(this.connection.driver,void 0,this.alias.name,t)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}class Y_{constructor(t,n){this.queryExpressionMap=t,this.disableMixedMap=!1,an.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Wa.isAliasProperty(this.relationName))throw new xe("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!Wa.isAliasProperty(this.relationName))throw new xe("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!Wa.isAliasProperty(this.relationName))throw new xe("Given value must be a string representation of alias property");const t=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!t)throw new xe(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return t}get junctionAlias(){const[t,n]=this.relationName.split(".");return t+"_"+n+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}class Q_{constructor(t,n){this.expressionMap=t,an.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!Wa.isAliasProperty(this.relationName))throw new xe("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!Wa.isAliasProperty(this.relationName))throw new xe("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[t,n]=this.relationName.split(".");return t+"_"+n+"_rc"}get relation(){if(!Wa.isAliasProperty(this.relationName))throw new xe("Given value is a string representation of alias property");const[t,n]=this.relationName.split("."),r=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!r)throw new xe(`Relation with property path ${n} in entity was not found.`);return r}get metadata(){if(!Wa.isAliasProperty(this.relationName))throw new xe("Given value is a string representation of alias property");const t=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(t).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}class ej{constructor(t){var n;this.connection=t,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],t.options.relationLoadStrategy&&(this.relationLoadStrategy=t.options.relationLoadStrategy),this.timeTravel=((n=t.options)==null?void 0:n.timeTravelQueries)||!1}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&this.options.indexOf("disable-global-order")===-1){const t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce((n,r)=>(n[this.mainAlias.name+"."+r]=t[r],n),{})}return this.orderBys}setMainAlias(t){return this.mainAlias=t,t}createAlias(t){let n=t.name;!n&&t.tablePath&&(n=t.tablePath),!n&&typeof t.target=="function"&&(n=t.target.name),!n&&typeof t.target=="string"&&(n=t.target);const r=new RL;return r.type=t.type,n&&(r.name=n),t.metadata&&(r.metadata=t.metadata),t.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(t.target)),t.tablePath&&(r.tablePath=t.tablePath),t.subQuery&&(r.subQuery=t.subQuery),this.aliases.push(r),r}findAliasByName(t){const n=this.aliases.find(r=>r.name===t);if(!n)throw new xe(`"${t}" alias was not found. Maybe you forgot to join it?`);return n}findColumnByAliasExpression(t){const[n,r]=t.split(".");return this.findAliasByName(n).metadata.findColumnWithPropertyName(r)}get relationMetadata(){if(!this.mainAlias)throw new xe("Entity to work with is not specified!");const t=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!t)throw new xe(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return t}clone(){const t=new ej(this.connection);return t.queryType=this.queryType,t.selects=this.selects.map(n=>n),t.maxExecutionTime=this.maxExecutionTime,t.selectDistinct=this.selectDistinct,t.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(n=>t.aliases.push(new RL(n))),t.relationLoadStrategy=this.relationLoadStrategy,t.mainAlias=this.mainAlias,t.valuesSet=this.valuesSet,t.returning=this.returning,t.onConflict=this.onConflict,t.onIgnore=this.onIgnore,t.onUpdate=this.onUpdate,t.joinAttributes=this.joinAttributes.map(n=>new GL(this.connection,this,n)),t.relationIdAttributes=this.relationIdAttributes.map(n=>new Y_(this,n)),t.relationCountAttributes=this.relationCountAttributes.map(n=>new Q_(this,n)),t.wheres=this.wheres.map(n=>({...n})),t.havings=this.havings.map(n=>({...n})),t.orderBys=Object.assign({},this.orderBys),t.groupBys=this.groupBys.map(n=>n),t.limit=this.limit,t.offset=this.offset,t.skip=this.skip,t.take=this.take,t.lockMode=this.lockMode,t.onLocked=this.onLocked,t.lockVersion=this.lockVersion,t.lockTables=this.lockTables,t.withDeleted=this.withDeleted,t.parameters=Object.assign({},this.parameters),t.disableEscaping=this.disableEscaping,t.enableRelationIdValues=this.enableRelationIdValues,t.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,t.subQuery=this.subQuery,t.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,t.cache=this.cache,t.cacheId=this.cacheId,t.cacheDuration=this.cacheDuration,t.relationPropertyPath=this.relationPropertyPath,t.of=this.of,t.insertColumns=this.insertColumns,t.whereEntities=this.whereEntities,t.updateEntity=this.updateEntity,t.callListeners=this.callListeners,t.useTransaction=this.useTransaction,t.timeTravel=this.timeTravel,t.nativeParameters=Object.assign({},this.nativeParameters),t.comment=this.comment,t.commonTableExpressions=this.commonTableExpressions.map(n=>({alias:n.alias,queryBuilder:typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.clone(),options:n.options})),t}}class XL{constructor(t){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=t}}class tj{static transformFrom(t,n){return Array.isArray(t)?t.slice().reverse().reduce((r,a)=>a.from(r),n):t.from(n)}static transformTo(t,n){return Array.isArray(t)?t.reduce((r,a)=>a.to(r),n):t.to(n)}}class Cd{constructor(t,n,r=!0,a=!1,o,i){this["@instanceof"]=Symbol.for("FindOperator"),this._type=t,this._value=n,this._useParameter=r,this._multipleParameters=a,this._getSql=o,this._objectLiteralParameters=i}get useParameter(){return At.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return At.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return At.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return At.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(At.isFindOperator(this._value))return this._value}get getSql(){return At.isFindOperator(this._value)?this._value.getSql:this._getSql}transformValue(t){this._value instanceof Cd?this._value.transformValue(t):this._value=Array.isArray(this._value)&&this._multipleParameters?this._value.map(n=>t&&tj.transformTo(t,n)):tj.transformTo(t,this._value)}}function Ha(e){return new Cd("in",e,!0,!0)}const Yde=/[.*+\-?^${}()|[\]\\]/g,Qde=e=>e.replace(Yde,"\\$&");class Jt{constructor(t,n){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,At.isDataSource(t)?(this.connection=t,this.queryRunner=n,this.expressionMap=new ej(this.connection)):(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone())}static registerQueryBuilderClass(t,n){Jt.queryBuilderRegistry[t]=n}get alias(){if(!this.expressionMap.mainAlias)throw new xe("Main alias is not set");return this.expressionMap.mainAlias.name}select(t,n){return this.expressionMap.queryType="select",Array.isArray(t)?this.expressionMap.selects=t.map(r=>({selection:r})):t&&(this.expressionMap.selects=[{selection:t,aliasName:n}]),At.isSelectQueryBuilder(this)?this:Jt.queryBuilderRegistry.SelectQueryBuilder(this)}insert(){return this.expressionMap.queryType="insert",At.isInsertQueryBuilder(this)?this:Jt.queryBuilderRegistry.InsertQueryBuilder(this)}update(t,n){const r=n||t;if(t=At.isEntitySchema(t)?t.options.name:t,typeof t=="function"||typeof t=="string"){const a=this.createFromAlias(t);this.expressionMap.setMainAlias(a)}return this.expressionMap.queryType="update",this.expressionMap.valuesSet=r,At.isUpdateQueryBuilder(this)?this:Jt.queryBuilderRegistry.UpdateQueryBuilder(this)}delete(){return this.expressionMap.queryType="delete",At.isDeleteQueryBuilder(this)?this:Jt.queryBuilderRegistry.DeleteQueryBuilder(this)}softDelete(){return this.expressionMap.queryType="soft-delete",At.isSoftDeleteQueryBuilder(this)?this:Jt.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}restore(){return this.expressionMap.queryType="restore",At.isSoftDeleteQueryBuilder(this)?this:Jt.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}relation(t,n){const r=arguments.length===2?t:void 0,a=arguments.length===2?n:t;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=a,r){const o=this.createFromAlias(r);this.expressionMap.setMainAlias(o)}return At.isRelationQueryBuilder(this)?this:Jt.queryBuilderRegistry.RelationQueryBuilder(this)}hasRelation(t,n){const r=this.connection.getMetadata(t);return(Array.isArray(n)?n:[n]).every(a=>!!r.findRelationWithPropertyPath(a))}hasParameter(t){var n;return((n=this.parentQueryBuilder)==null?void 0:n.hasParameter(t))||t in this.expressionMap.parameters}setParameter(t,n){if(typeof n=="function")throw new xe(`Function parameter isn't supported in the parameters. Please check "${t}" parameter.`);if(!t.match(/^([A-Za-z0-9_.]+)$/))throw new xe("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(t,n),this.expressionMap.parameters[t]=n,this}setParameters(t){for(const[n,r]of Object.entries(t))this.setParameter(n,r);return this}createParameter(t){let n;do n=`orm_param_${this.parameterIndex++}`;while(this.hasParameter(n));return this.setParameter(n,t),`:${n}`}setNativeParameters(t){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(t),Object.keys(t).forEach(n=>{this.expressionMap.nativeParameters[n]=t[n]}),this}getParameters(){const t=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const n=this.expressionMap.mainAlias.metadata;if(n.discriminatorColumn&&n.parentEntityMetadata){const r=n.childEntityMetadatas.filter(a=>a.discriminatorColumn).map(a=>a.discriminatorValue);r.push(n.discriminatorValue),t.discriminatorColumnValues=r}}return t}printSql(){const[t,n]=this.getQueryAndParameters();return this.connection.logger.logQuery(t,n),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const t=this.getQuery(),n=this.getParameters();return this.connection.driver.escapeQueryWithParameters(t,n,this.expressionMap.nativeParameters)}async execute(){const[t,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();try{return await r.query(t,n)}finally{r!==this.queryRunner&&await r.release()}}createQueryBuilder(t){return new this.constructor(this.connection,t??this.queryRunner)}clone(){return new this.constructor(this)}comment(t){return this.expressionMap.comment=t,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(t){return this.expressionMap.disableEscaping?this.connection.driver.escape(t):t}setQueryRunner(t){return this.queryRunner=t,this}callListeners(t){return this.expressionMap.callListeners=t,this}useTransaction(t){return this.expressionMap.useTransaction=t,this}addCommonTableExpression(t,n,r){return this.expressionMap.commonTableExpressions.push({queryBuilder:t,alias:n,options:r||{}}),this}getTableName(t){return t.split(".").map(n=>n===""?n:this.escape(n)).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new xe('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(t,n){if(this.connection.hasMetadata(t)){const r=this.connection.getMetadata(t);return this.expressionMap.createAlias({type:"from",name:n,metadata:this.connection.getMetadata(t),tablePath:r.tablePath})}else{if(typeof t=="string"){const o=t.substr(0,1)==="("&&t.substr(-1)===")";return this.expressionMap.createAlias({type:"from",name:n,tablePath:o?void 0:t,subQuery:o?t:void 0})}const r=t(this.subQuery());this.setParameters(r.getParameters());const a=r.getQuery();return this.expressionMap.createAlias({type:"from",name:n,subQuery:a})}}replacePropertyNames(t){return t}replacePropertyNamesForTheWholeQuery(t){const n={};for(const o of this.expressionMap.aliases){if(!o.hasMetadata)continue;const i=this.expressionMap.aliasNamePrefixingEnabled&&o.name?`${o.name}.`:"";n[i]||(n[i]={});for(const s of o.metadata.relations)s.joinColumns.length>0&&(n[i][s.propertyPath]=s.joinColumns[0].databaseName);for(const s of o.metadata.relations){const c=[...s.joinColumns,...s.inverseJoinColumns];for(const l of c){const u=`${s.propertyPath}.${l.referencedColumn.propertyPath}`;n[i][u]=l.databaseName}}for(const s of o.metadata.columns)n[i][s.databaseName]=s.databaseName;for(const s of o.metadata.columns)n[i][s.propertyName]=s.databaseName;for(const s of o.metadata.columns)n[i][s.propertyPath]=s.databaseName}const r=Object.keys(n),a=r.map(o=>Qde(o)).join("|");return r.length>0&&(t=t.replace(new RegExp(`([ =(]|^.{0})${a?"("+a+")":""}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),(...o)=>{let i,s,c;if(a){if(i=o[0],s=o[1],c=o[3],n[o[2]][c])return`${s}${this.escape(o[2].substring(0,o[2].length-1))}.${this.escape(n[o[2]][c])}`}else if(i=o[0],s=o[1],c=o[2],n[""][c])return`${s}${this.escape(n[""][c])}`;return i})),t}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace(/\*\//g,"")} */ `:""}createTimeTravelQuery(){return this.expressionMap.queryType==="select"&&this.expressionMap.timeTravel?` AS OF SYSTEM TIME ${this.expressionMap.timeTravel}`:""}createWhereExpression(){const t=[],n=this.createWhereClausesExpression(this.expressionMap.wheres);if(n.length>0&&n!=="1=1"&&t.push(this.replacePropertyNames(n)),this.expressionMap.mainAlias.hasMetadata){const a=this.expressionMap.mainAlias.metadata;if(this.expressionMap.queryType==="select"&&!this.expressionMap.withDeleted&&a.deleteDateColumn){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+a.deleteDateColumn.propertyName:a.deleteDateColumn.propertyName,i=`${this.replacePropertyNames(o)} IS NULL`;t.push(i)}if(a.discriminatorColumn&&a.parentEntityMetadata){const o=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+a.discriminatorColumn.databaseName:a.discriminatorColumn.databaseName,i=`${this.replacePropertyNames(o)} IN (:...discriminatorColumnValues)`;t.push(i)}}if(this.expressionMap.extraAppendedAndWhereCondition){const a=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);t.push(a)}let r="";return r+=this.createTimeTravelQuery(),t.length?t.length===1?r+=` WHERE ${t[0]}`:r+=` WHERE ( ${t.join(" ) AND ( ")} )`:r+="",r}createReturningExpression(t){const n=this.getReturningColumns(),r=this.connection.driver;if(typeof this.expressionMap.returning!="string"&&this.expressionMap.extraReturningColumns.length>0&&r.isReturningSqlSupported(t)&&n.push(...this.expressionMap.extraReturningColumns.filter(a=>n.indexOf(a)===-1)),n.length){let a=n.map(o=>{const i=this.escape(o.databaseName);return r.options.type==="mssql"?this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update"||this.expressionMap.queryType==="soft-delete"||this.expressionMap.queryType==="restore"?"INSERTED."+i:this.escape(this.getMainTableName())+"."+i:i}).join(", ");return r.options.type==="oracle"&&(a+=" INTO "+n.map(o=>this.createParameter({type:r.columnTypeToNativeParameter(o.type),dir:r.oracle.BIND_OUT})).join(", ")),r.options.type==="mssql"&&(this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update")&&(a+=" INTO @OutputTable"),a}else if(typeof this.expressionMap.returning=="string")return this.expressionMap.returning;return""}getReturningColumns(){const t=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(n=>{this.expressionMap.mainAlias.hasMetadata&&t.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n))}),t}createWhereClausesExpression(t){return t.map((n,r)=>{const a=this.createWhereConditionExpression(n.condition);switch(n.type){case"and":return(r>0?"AND ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${a}${this.connection.options.isolateWhereStatements?")":""}`;case"or":return(r>0?"OR ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${a}${this.connection.options.isolateWhereStatements?")":""}`}return a}).join(" ").trim()}createWhereConditionExpression(t,n=!1){if(typeof t=="string")return t;if(Array.isArray(t))return t.length===0?"1=1":t.length===1&&!n?this.createWhereClausesExpression(t):"("+this.createWhereClausesExpression(t)+")";const{driver:r}=this.connection;switch(t.operator){case"lessThan":return`${t.parameters[0]} < ${t.parameters[1]}`;case"lessThanOrEqual":return`${t.parameters[0]} <= ${t.parameters[1]}`;case"arrayContains":return`${t.parameters[0]} @> ${t.parameters[1]}`;case"jsonContains":return`${t.parameters[0]} ::jsonb @> ${t.parameters[1]}`;case"arrayContainedBy":return`${t.parameters[0]} <@ ${t.parameters[1]}`;case"arrayOverlap":return`${t.parameters[0]} && ${t.parameters[1]}`;case"moreThan":return`${t.parameters[0]} > ${t.parameters[1]}`;case"moreThanOrEqual":return`${t.parameters[0]} >= ${t.parameters[1]}`;case"notEqual":return`${t.parameters[0]} != ${t.parameters[1]}`;case"equal":return`${t.parameters[0]} = ${t.parameters[1]}`;case"ilike":return r.options.type==="postgres"||r.options.type==="cockroachdb"?`${t.parameters[0]} ILIKE ${t.parameters[1]}`:`UPPER(${t.parameters[0]}) LIKE UPPER(${t.parameters[1]})`;case"like":return`${t.parameters[0]} LIKE ${t.parameters[1]}`;case"between":return`${t.parameters[0]} BETWEEN ${t.parameters[1]} AND ${t.parameters[2]}`;case"in":return t.parameters.length<=1?"0=1":`${t.parameters[0]} IN (${t.parameters.slice(1).join(", ")})`;case"any":return r.options.type==="cockroachdb"?`${t.parameters[0]}::STRING = ANY(${t.parameters[1]}::STRING[])`:`${t.parameters[0]} = ANY(${t.parameters[1]})`;case"isNull":return`${t.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(t.condition)})`;case"brackets":return`${this.createWhereConditionExpression(t.condition,!0)}`;case"and":return"("+t.parameters.join(" AND ")+")";case"or":return"("+t.parameters.join(" OR ")+")"}throw new TypeError(`Unsupported FindOperator ${Cd.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const t=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map(n=>{const r=typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.getQuery();if(typeof n.queryBuilder!="string"){if(n.queryBuilder.hasCommonTableExpressions())throw new xe(`Nested CTEs aren't supported (CTE: ${n.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!At.isSelectQueryBuilder(n.queryBuilder))throw new xe(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${n.alias})`);this.setParameters(n.queryBuilder.getParameters())}let a=this.escape(n.alias);if(n.options.columnNames){const s=n.options.columnNames.map(c=>this.escape(c));if(At.isSelectQueryBuilder(n.queryBuilder)&&n.queryBuilder.expressionMap.selects.length&&n.options.columnNames.length!==n.queryBuilder.expressionMap.selects.length)throw new xe(`cte.options.columnNames length (${n.options.columnNames.length}) doesn't match subquery select list length ${n.queryBuilder.expressionMap.selects.length} (CTE: ${n.alias})`);a+=`(${s.join(", ")})`}const o=n.options.recursive&&t?"RECURSIVE":"";let i="";return this.connection.driver.cteCapabilities.materializedHint&&n.options.materialized!==void 0&&(i=n.options.materialized?"MATERIALIZED":"NOT MATERIALIZED"),[o,a,"AS",i,`(${r})`].filter(Boolean).join(" ")}).join(", ")+" "}getWhereInIdsCondition(t){const n=this.expressionMap.mainAlias.metadata,r=(Array.isArray(t)?t:[t]).map(a=>n.ensureEntityIdMap(a));if(!n.hasMultiplePrimaryKeys){const a=n.primaryColumns[0];if(!a.transformer&&!a.relationMetadata&&!a.embeddedMetadata)return{[a.propertyName]:Ha(r.map(o=>a.getEntityValue(o,!1)))}}return new XL(a=>{for(const o of r)a.orWhere(new XL(i=>i.where(o)))})}getExistsCondition(t){const n=t.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select("1").setOption("disable-global-order");return[`EXISTS (${n.getQuery()})`,n.getParameters()]}findColumnsForPropertyPath(t){let n=this.expressionMap.mainAlias;const r=[],a=t.split(".");for(;a.length>1;){const s=a[0];if(!(n!=null&&n.hasMetadata))break;if(n.metadata.hasEmbeddedWithPropertyPath(s)){a.unshift(`${a.shift()}.${a.shift()}`);continue}if(n.metadata.hasRelationWithPropertyPath(s)){const c=this.expressionMap.joinAttributes.find(l=>l.relationPropertyPath===s);if(!(c!=null&&c.alias)){const l=r.length>0?`${r.join(".")}.${s}`:s;throw new Error(`Cannot find alias for relation at ${l}`)}n=c.alias,r.push(...s.split(".")),a.shift();continue}break}if(!n)throw new Error(`Cannot find alias for property ${t}`);const o=a.join("."),i=n.metadata.findColumnsWithPropertyPath(o);if(!i.length)throw new qa(t,n.metadata);return[n,r,i]}createPropertyPath(t,n,r=""){const a=[];for(const o of Object.keys(n)){const i=r?`${r}.${o}`:o;if(n[o]===null||typeof n[o]!="object"||At.isFindOperator(n[o])){a.push(i);continue}if(t.hasEmbeddedWithPropertyPath(i)){const s=this.createPropertyPath(t,n[o],i);a.push(...s);continue}if(t.hasRelationWithPropertyPath(i)){const s=t.findRelationWithPropertyPath(i);if(s.relationType==="one-to-one"||s.relationType==="many-to-one"){const u=s.joinColumns.map(d=>d.referencedColumn).filter(d=>!!d);if(u.length>0&&u.every(d=>d.getEntityValue(n[o],!1))){a.push(i);continue}}if(s.relationType==="one-to-many"||s.relationType==="many-to-many")throw new Error(`Cannot query across ${s.relationType} for property ${i}`);const c=s.inverseEntityMetadata.primaryColumns;if(c.length>0&&c.every(u=>u.getEntityValue(n[o],!1))){const u=c.map(d=>`${i}.${d.propertyPath}`);a.push(...u);continue}const l=this.createPropertyPath(s.inverseEntityMetadata,n[o]).map(u=>`${i}.${u}`);a.push(...l);continue}a.push(i)}return a}*getPredicates(t){if(this.expressionMap.mainAlias.hasMetadata){const n=this.createPropertyPath(this.expressionMap.mainAlias.metadata,t);for(const r of n){const[a,o,i]=this.findColumnsForPropertyPath(r);for(const s of i){let c=t;for(const d of o){if(!c||!(d in c)){c={};break}c=c[d]}const l=this.expressionMap.aliasNamePrefixingEnabled?`${a.name}.${s.propertyPath}`:s.propertyPath,u=s.getEntityValue(c,!0);yield[l,u]}}}else for(const n of Object.keys(t)){const r=t[n];yield[this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${n}`:n,r]}}getWherePredicateCondition(t,n){if(At.isFindOperator(n)){let r=[];if(n.useParameter)if(n.objectLiteralParameters)this.setParameters(n.objectLiteralParameters);else if(n.multipleParameters)for(const a of n.value)r.push(this.createParameter(a));else r.push(this.createParameter(n.value));if(n.type==="raw")return n.getSql?n.getSql(t):{operator:"equal",parameters:[t,n.value]};if(n.type==="not")return n.child?{operator:n.type,condition:this.getWherePredicateCondition(t,n.child)}:{operator:"notEqual",parameters:[t,...r]};if(n.type==="and"){const a=n.value;return{operator:n.type,parameters:a.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(t,o)))}}else if(n.type==="or"){const a=n.value;return{operator:n.type,parameters:a.map(o=>this.createWhereConditionExpression(this.getWherePredicateCondition(t,o)))}}else return{operator:n.type,parameters:[t,...r]}}else return{operator:"equal",parameters:[t,this.createParameter(n)]}}getWhereCondition(t){if(typeof t=="string")return t;if(At.isBrackets(t)){const a=this.createQueryBuilder();return a.parentQueryBuilder=this,a.expressionMap.mainAlias=this.expressionMap.mainAlias,a.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,a.expressionMap.parameters=this.expressionMap.parameters,a.expressionMap.nativeParameters=this.expressionMap.nativeParameters,a.expressionMap.wheres=[],t.whereFactory(a),{operator:At.isNotBrackets(t)?"not":"brackets",condition:a.expressionMap.wheres}}if(typeof t=="function")return t(this);const n=Array.isArray(t)?t:[t],r=[];for(const a of n){const o=[];for(const[i,s]of this.getPredicates(a))o.push({type:"and",condition:this.getWherePredicateCondition(i,s)});r.push({type:"or",condition:o})}return r.length===1?r[0].condition:r}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}Jt.queryBuilderRegistry={};class epe{static from(t){const n=new this;return n.raw=t.records,n.affected=t.affected,n}}class tpe extends Jt{constructor(t,n){super(t,n),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let t=this.createComment();return t+=this.createCteExpression(),t+=this.createDeleteExpression(),this.replacePropertyNamesForTheWholeQuery(t.trim())}async execute(){const[t,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let a=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),a=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const o=await r.query(t,n,!0),i=epe.from(o);return this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),a&&await r.commitTransaction(),i}catch(o){if(a)try{await r.rollbackTransaction()}catch{}throw o}finally{r!==this.queryRunner&&await r.release()}}from(t,n){t=At.isEntitySchema(t)?t.options.name:t;const r=this.createFromAlias(t,n);return this.expressionMap.setMainAlias(r),this}where(t,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(t);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(t,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}orWhere(t,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}whereInIds(t){return this.where(this.getWhereInIdsCondition(t))}andWhereInIds(t){return this.andWhere(this.getWhereInIdsCondition(t))}orWhereInIds(t){return this.orWhere(this.getWhereInIdsCondition(t))}output(t){return this.returning(t)}returning(t){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new _m;return this.expressionMap.returning=t,this}createDeleteExpression(){const t=this.getTableName(this.getMainTableName()),n=this.createWhereExpression(),r=this.createReturningExpression("delete");return r===""?`DELETE FROM ${t}${n}`:this.connection.driver.options.type==="mssql"?`DELETE FROM ${t} OUTPUT ${r}${n}`:`DELETE FROM ${t}${n} RETURNING ${r}`}}let jm;const npe=new Uint8Array(16);function rpe(){if(!jm&&(jm=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!jm))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jm(npe)}const On=[];for(let e=0;e<256;++e)On.push((e+256).toString(16).slice(1));function ape(e,t=0){return On[e[t+0]]+On[e[t+1]]+On[e[t+2]]+On[e[t+3]]+"-"+On[e[t+4]]+On[e[t+5]]+"-"+On[e[t+6]]+On[e[t+7]]+"-"+On[e[t+8]]+On[e[t+9]]+"-"+On[e[t+10]]+On[e[t+11]]+On[e[t+12]]+On[e[t+13]]+On[e[t+14]]+On[e[t+15]]}const ope=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),JL={randomUUID:ope};function ipe(e,t,n){if(JL.randomUUID&&!t&&!e)return JL.randomUUID();e=e||{};const r=e.random||(e.rng||rpe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ape(r)}class YL{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}class QL{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(t){const n=new this;return n.raw=t.raw,n}}class nj{constructor(t,n){this.queryRunner=t,this.expressionMap=n}async update(t,n){const r=this.expressionMap.mainAlias.metadata;await Promise.all(n.map(async(a,o)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(t.raw)&&this.expressionMap.extraReturningColumns.length>0&&(t.raw=t.raw.reduce((c,l,u)=>(c[this.expressionMap.extraReturningColumns[u].databaseName]=l[0],c),{}));const i=Array.isArray(t.raw)?t.raw[o]:t.raw,s=this.queryRunner.connection.driver.createGeneratedMap(r,i);s&&(this.queryRunner.manager.merge(r.target,a,s),t.generatedMaps.push(s))}else{const i=this.expressionMap.extraReturningColumns;if(i.length>0){const s=this.expressionMap.mainAlias.metadata.getEntityIdMap(a);if(!s)throw new xe("Cannot update entity because entity id is not set in the entity.");const c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(i.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(s).withDeleted().setOption("create-pojo").getOne();c&&(this.queryRunner.manager.merge(r.target,a,c),t.generatedMaps.push(c))}}}))}async insert(t,n){const r=this.expressionMap.mainAlias.metadata;let a=r.getInsertionReturningColumns();const o=this.queryRunner.connection.driver.isReturningSqlSupported("insert");a=a.filter(s=>s.isGenerated?o===!0:!0);const i=n.map((s,c)=>{this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(t.raw)&&this.expressionMap.extraReturningColumns.length>0&&(t.raw=t.raw.reduce((d,p,f)=>(d[this.expressionMap.extraReturningColumns[f].databaseName]=p[0],d),{}));const l=Array.isArray(t.raw)?t.raw[c]:t.raw,u=this.queryRunner.connection.driver.createGeneratedMap(r,l,c,n.length)||{};return c in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(r.target,u,this.expressionMap.locallyGenerated[c]),this.queryRunner.manager.merge(r.target,s,u),u});if(a.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const s=n.map(l=>{const u=r.getEntityIdMap(l);if(!u)throw new xe("Cannot update entity because entity id is not set in the entity.");return u}),c=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(l=>r.targetName+"."+l.propertyPath)).addSelect(a.map(l=>r.targetName+"."+l.propertyPath)).from(r.target,r.targetName).where(s).setOption("create-pojo").getMany();n.forEach((l,u)=>{this.queryRunner.manager.merge(r.target,i[u],c[u]),this.queryRunner.manager.merge(r.target,l,c[u])})}n.forEach((s,c)=>{const l=r.getEntityIdMap(s);t.identifiers.push(l),t.generatedMaps.push(i[c])})}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(t=>t.asExpression!==void 0||t.isUpdateDate||t.isVersion)}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(t=>t.asExpression!==void 0||t.isUpdateDate||t.isVersion||t.isDeleteDate)}}class spe extends Jt{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let t=this.createComment();return t+=this.createCteExpression(),t+=this.createInsertExpression(),this.replacePropertyNamesForTheWholeQuery(t.trim())}async execute(){const t=this.getValueSets();if(t.length===0)return new QL;const n=this.obtainQueryRunner();let r=!1;try{if(this.expressionMap.useTransaction===!0&&n.isTransactionActive===!1&&(await n.startTransaction(),r=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const f=new YL;t.forEach(m=>{n.broadcaster.broadcastBeforeInsertEvent(f,this.expressionMap.mainAlias.metadata,m)}),await f.wait()}let a=null,o=null;const i=new nj(n,this.expressionMap),s=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const f of this.expressionMap.returning)s.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(f));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&(t.length>1&&this.connection.driver.options.type==="oracle"||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),s.push(...this.expressionMap.extraReturningColumns.filter(f=>!s.includes(f)))),s.length>0&&this.connection.driver.options.type==="mssql"&&(a=this.connection.driver.buildTableVariableDeclaration("@OutputTable",s),o="SELECT * FROM @OutputTable");const[c,l]=this.getQueryAndParameters(),u=[a,c,o].filter(f=>f!=null).join(`;

`),d=await n.query(u,l,!0),p=QL.from(d);if(this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&await i.insert(p,t),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const f=new YL;t.forEach(m=>{n.broadcaster.broadcastAfterInsertEvent(f,this.expressionMap.mainAlias.metadata,m)}),await f.wait()}return r&&await n.commitTransaction(),p}catch(a){if(r)try{await n.rollbackTransaction()}catch{}throw a}finally{n!==this.queryRunner&&await n.release()}}into(t,n){t=At.isEntitySchema(t)?t.options.name:t;const r=this.createFromAlias(t);return this.expressionMap.setMainAlias(r),this.expressionMap.insertColumns=n||[],this}values(t){return this.expressionMap.valuesSet=t,this}output(t){return this.returning(t)}returning(t){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new _m;return this.expressionMap.returning=t,this}updateEntity(t){return this.expressionMap.updateEntity=t,this}onConflict(t){return this.expressionMap.onConflict=t,this}orIgnore(t=!0){return this.expressionMap.onIgnore=!!t,this}orUpdate(t,n,r){return Array.isArray(t)?(this.expressionMap.onUpdate={overwrite:t,conflict:n,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,indexPredicate:r==null?void 0:r.indexPredicate,upsertType:r==null?void 0:r.upsertType},this):(this.expressionMap.onUpdate={conflict:t==null?void 0:t.conflict_target,columns:t==null?void 0:t.columns,overwrite:t==null?void 0:t.overwrite,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,upsertType:r==null?void 0:r.upsertType},this)}createInsertExpression(){var i,s;const t=this.getTableName(this.getMainTableName()),n=this.createValuesExpression(),r=this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),a=this.createColumnNamesExpression();let o="INSERT ";if(((i=this.expressionMap.onUpdate)==null?void 0:i.upsertType)==="primary-key"&&(o="UPSERT "),(ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+=`${this.expressionMap.onIgnore?" IGNORE ":""}`),o+=`INTO ${t}`,this.alias!==this.getMainTableName()&&ve.isPostgresFamily(this.connection.driver)&&(o+=` AS "${this.alias}"`),a?o+=`(${a})`:!n&&(ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(o+="()"),r&&this.connection.driver.options.type==="mssql"&&(o+=` OUTPUT ${r}`),n?(this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="sap")&&this.getValueSets().length>1?o+=` ${n}`:o+=` VALUES ${n}`:ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"?o+=" VALUES ()":o+=" DEFAULT VALUES",((s=this.expressionMap.onUpdate)==null?void 0:s.upsertType)!=="primary-key"){if(this.connection.driver.supportedUpsertTypes.includes("on-conflict-do-update")){if(this.expressionMap.onIgnore)o+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)o+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:c,columns:l,conflict:u,skipUpdateIfNoValuesChanged:d,indexPredicate:p}=this.expressionMap.onUpdate;let f="ON CONFLICT";if(Array.isArray(u)){if(f+=` ( ${u.map(y=>this.escape(y)).join(", ")} )`,p&&!ve.isPostgresFamily(this.connection.driver))throw new xe("indexPredicate option is not supported by the current database driver");p&&ve.isPostgresFamily(this.connection.driver)&&(f+=` WHERE ( ${p} )`)}else u&&(f+=` ON CONSTRAINT ${this.escape(u)}`);const m=[];Array.isArray(c)?m.push(...c.map(y=>`${this.escape(y)} = EXCLUDED.${this.escape(y)}`)):l&&m.push(...l.map(y=>`${this.escape(y)} = :${y}`)),m.length>0&&(o+=` ${f} DO UPDATE SET `,m.push(...this.expressionMap.mainAlias.metadata.columns.filter(y=>y.isUpdateDate&&!(c!=null&&c.includes(y.databaseName))&&!(this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1||ve.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")).map(y=>`${this.escape(y.databaseName)} = DEFAULT`)),o+=m.join(", "),o+=" "),Array.isArray(c)&&d&&ve.isPostgresFamily(this.connection.driver)&&(o+=" WHERE (",o+=c.map(y=>`${t}.${this.escape(y)} IS DISTINCT FROM EXCLUDED.${this.escape(y)}`).join(" OR "),o+=") ")}}else if(this.connection.driver.supportedUpsertTypes.includes("on-duplicate-key-update")){if(this.expressionMap.onUpdate){const{overwrite:c,columns:l}=this.expressionMap.onUpdate;Array.isArray(c)?(o+=" ON DUPLICATE KEY UPDATE ",o+=c.map(u=>`${this.escape(u)} = VALUES(${this.escape(u)})`).join(", "),o+=" "):Array.isArray(l)&&(o+=" ON DUPLICATE KEY UPDATE ",o+=l.map(u=>`${this.escape(u)} = :${u}`).join(", "),o+=" ")}}else if(this.expressionMap.onUpdate)throw new xe("onUpdate is not supported by the current database driver")}return r&&(ve.isPostgresFamily(this.connection.driver)||this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="cockroachdb"||ve.isMySQLFamily(this.connection.driver))&&(o+=` RETURNING ${r}`),this.connection.driver.options.type==="mssql"&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(c=>this.expressionMap.insertColumns.length>0?this.expressionMap.insertColumns.indexOf(c.propertyPath)!==-1:c.isInsert).some(c=>this.isOverridingAutoIncrementBehavior(c))&&(o=`SET IDENTITY_INSERT ${t} ON; ${o}; SET IDENTITY_INSERT ${t} OFF`),o}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(t=>this.expressionMap.insertColumns.length?this.expressionMap.insertColumns.indexOf(t.propertyPath)!==-1:!(!t.isInsert||t.isGenerated&&t.generationStrategy==="increment"&&this.connection.driver.options.type!=="spanner"&&this.connection.driver.options.type!=="oracle"&&!ve.isSQLiteFamily(this.connection.driver)&&!ve.isMySQLFamily(this.connection.driver)&&this.connection.driver.options.type!=="aurora-mysql"&&!(this.connection.driver.options.type==="mssql"&&this.isOverridingAutoIncrementBehavior(t)))):[]}createColumnNamesExpression(){const t=this.getInsertedColumns();if(t.length>0)return t.map(n=>this.escape(n.databaseName)).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const n=this.getValueSets();if(n.length===1)return Object.keys(n[0]).map(r=>this.escape(r)).join(", ")}return this.expressionMap.insertColumns.map(n=>this.escape(n)).join(", ")}createValuesExpression(){const t=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){let r="";return t.forEach((a,o)=>{n.forEach((i,s)=>{s===0&&(this.connection.driver.options.type==="oracle"&&t.length>1||this.connection.driver.options.type==="sap"&&t.length>1?r+=" SELECT ":r+="(");let c=i.getEntityValue(a);if(typeof c!="function"&&(c=this.connection.driver.preparePersistentValue(c,i)),i.isVersion&&c===void 0)r+="1";else if(i.isDiscriminator)r+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(i.isGenerated&&i.generationStrategy==="uuid"&&!this.connection.driver.isUUIDGenerationSupported()&&c===void 0)c=ipe(),r+=this.createParameter(c),o in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[o]={}),i.setEntityValue(this.expressionMap.locallyGenerated[o],c);else if(c===void 0)this.connection.driver.options.type==="oracle"&&t.length>1||ve.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?i.default!==void 0&&i.default!==null?r+=this.connection.driver.normalizeDefault(i):r+="NULL":r+="DEFAULT";else if(c===null&&this.connection.driver.options.type==="spanner")r+="NULL";else if(typeof c=="function")r+=c();else{this.connection.driver.options.type==="mssql"&&(c=this.connection.driver.parametrizeValue(i,c));const l=this.createParameter(c);if((ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(i.type)!==-1){const u=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";i.srid!=null?r+=`${u}(${l}, ${i.srid})`:r+=`${u}(${l})`}else ve.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(i.type)!==-1?i.srid!=null?r+=`ST_SetSRID(ST_GeomFromGeoJSON(${l}), ${i.srid})::${i.type}`:r+=`ST_GeomFromGeoJSON(${l})::${i.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(i.type)!==-1?r+=i.type+"::STGeomFromText("+l+", "+(i.srid||"0")+")":r+=l}s===n.length-1?o===t.length-1?this.connection.driver.options.type==="oracle"&&t.length>1?r+=" FROM DUAL ":this.connection.driver.options.type==="sap"&&t.length>1?r+=" FROM dummy ":r+=")":this.connection.driver.options.type==="oracle"&&t.length>1?r+=" FROM DUAL UNION ALL ":this.connection.driver.options.type==="sap"&&t.length>1?r+=" FROM dummy UNION ALL ":r+="), ":r+=", "})}),r==="()"?"":r}else{let r="";return t.forEach((a,o)=>{Object.keys(a).forEach((i,s)=>{s===0&&(r+="(");const c=a[i];typeof c=="function"?r+=c():c===void 0?this.connection.driver.options.type==="oracle"&&t.length>1||ve.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?r+="NULL":r+="DEFAULT":c===null&&this.connection.driver.options.type==="spanner"||(r+=this.createParameter(c)),s===Object.keys(a).length-1?o===t.length-1?r+=")":r+="), ":r+=", "})}),r==="()"?"":r}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(an.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new $de}isOverridingAutoIncrementBehavior(t){return t.isPrimary&&t.isGenerated&&t.generationStrategy==="increment"&&this.getValueSets().some(n=>t.getEntityValue(n)!==void 0&&t.getEntityValue(n)!==null)}}class e6{constructor(t,n){this.queryBuilder=t,this.expressionMap=n}async update(t){const n=this.expressionMap.relationMetadata;if(n.isManyToOne||n.isOneToOneOwner){const r=n.joinColumns.reduce((a,o)=>{const i=an.isObject(t)?o.referencedColumn.getEntityValue(t):t;return o.setEntityValue(a,i),a},{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(n.entityMetadata.target).set(r).whereInIds(this.expressionMap.of).execute()}else if((n.isOneToOneNotOwner||n.isOneToMany)&&t===null){const r={};n.inverseRelation.joinColumns.forEach(c=>{r[c.propertyName]=null});const a=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o={},i=[];a.forEach((c,l)=>{n.inverseRelation.joinColumns.map((u,d)=>{const p="joinColumn_"+l+"_"+d;o[p]=an.isObject(c)?u.referencedColumn.getEntityValue(c):c,i.push(`${u.propertyPath} = :${p}`)})});const s=i.map(c=>"("+c+")").join(" OR ");if(!s)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(r).where(s).setParameters(o).execute()}else if(n.isOneToOneNotOwner||n.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new xe("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const r=this.expressionMap.of,a=n.inverseRelation.joinColumns.reduce((o,i)=>{const s=an.isObject(r)?i.referencedColumn.getEntityValue(r):r;return i.setEntityValue(o,s),o},{});if(!t||Array.isArray(t)&&!t.length)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(a).whereInIds(t).execute()}else{const r=n.junctionEntityMetadata,a=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(t)?t:[t],i=n.isManyToManyOwner?a:o,s=n.isManyToManyOwner?o:a,c=[];if(i.forEach(l=>{s.forEach(u=>{const d={};r.ownerColumns.forEach(p=>{d[p.databaseName]=an.isObject(l)?p.referencedColumn.getEntityValue(l):l}),r.inverseColumns.forEach(p=>{d[p.databaseName]=an.isObject(u)?p.referencedColumn.getEntityValue(u):u}),c.push(d)})}),!c.length)return;this.queryBuilder.connection.driver.options.type==="oracle"||this.queryBuilder.connection.driver.options.type==="sap"?await Promise.all(c.map(l=>this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(l).execute())):await this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(c).execute()}}}class cpe{constructor(t,n){this.queryBuilder=t,this.expressionMap=n}async remove(t){const n=this.expressionMap.relationMetadata;if(n.isOneToMany){const r=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],a=Array.isArray(t)?t:[t],o={};n.inverseRelation.joinColumns.forEach(l=>{o[l.propertyName]=null});const i={},s=[];r.forEach((l,u)=>{s.push(...a.map((d,p)=>[...n.inverseRelation.joinColumns.map((f,m)=>{const y="joinColumn_"+u+"_"+p+"_"+m;return i[y]=an.isObject(l)?f.referencedColumn.getEntityValue(l):l,`${f.propertyPath} = :${y}`}),...n.inverseRelation.entityMetadata.primaryColumns.map((f,m)=>{const y="primaryColumn_"+p+"_"+p+"_"+m;return i[y]=an.isObject(d)?f.getEntityValue(d):d,`${f.propertyPath} = :${y}`})].join(" AND ")))});const c=s.map(l=>"("+l+")").join(" OR ");if(!c)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(o).where(c).setParameters(i).execute()}else{const r=n.junctionEntityMetadata,a=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(t)?t:[t],i=n.isManyToManyOwner?a:o,s=n.isManyToManyOwner?o:a,c={},l=[];i.forEach((d,p)=>{l.push(...s.map((f,m)=>[...r.ownerColumns.map((y,v)=>{const b="firstValue_"+p+"_"+m+"_"+v;return c[b]=an.isObject(d)?y.referencedColumn.getEntityValue(d):d,`${y.databaseName} = :${b}`}),...r.inverseColumns.map((y,v)=>{const b="secondValue_"+p+"_"+m+"_"+v;return c[b]=an.isObject(f)?y.referencedColumn.getEntityValue(f):f,`${y.databaseName} = :${b}`})].join(" AND ")))});const u=l.map(d=>"("+d+")").join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(r.tableName).where(u).setParameters(c).execute()}}}class lpe extends Jt{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(t){return this.expressionMap.of=t,this}async set(t){const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new xe("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToMany||n.isOneToMany)throw new xe(`Set operation is only supported for many-to-one and one-to-one relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .add() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!an.isObject(t)||Object.keys(t).length<n.joinColumns.length))throw new xe('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new e6(this,this.expressionMap).update(t)}async add(t){if(Array.isArray(t)&&t.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new xe("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new xe(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!an.isObject(t)||Object.keys(t).length<n.joinColumns.length))throw new xe('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new e6(this,this.expressionMap).update(t)}async remove(t){if(Array.isArray(t)&&t.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new xe("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new xe(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set(null) method instead.`);return new cpe(this,this.expressionMap).remove(t)}async addAndRemove(t,n){await this.remove(n),await this.add(t)}async loadOne(){return this.loadMany().then(t=>t[0])}async loadMany(){let t=this.expressionMap.of;if(!an.isObject(t)){const n=this.expressionMap.mainAlias.metadata;if(n.hasMultiplePrimaryKeys)throw new xe("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");t=n.primaryColumns[0].createValueMap(t)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,t,this.queryRunner)}}class Cn{static chunk(t,n){return Array.from(Array(Math.ceil(t.length/n)),(r,a)=>t.slice(a*n,a*n+n))}static splitClassesAndStrings(t){return[t.filter(n=>typeof n!="string"),t.filter(n=>typeof n=="string")]}static groupBy(t,n){return t.reduce((r,a)=>{const o=n(a);let i=r.find(s=>s.id===o);return i||(i={id:o,items:[]},r.push(i)),i.items.push(a),r},[])}static uniq(t,n){return t.reduce((r,a)=>{let o=!1;if(typeof n=="function"){const i=n(a);o=!!r.find(s=>n(s)===i)}else typeof n=="string"?o=!!r.find(i=>i[n]===a[n]):o=r.indexOf(a)!==-1;return o||r.push(a),r},[])}static isPlainObject(t){return t==null?!1:!t.constructor||t.constructor===Object}static mergeArrayKey(t,n,r,a){if(a.has(r)){t[n]=a.get(r);return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){t[n]=r;return}t[n]||(t[n]=Array.isArray(r)?[]:{}),a.set(r,t[n]),this.merge(t[n],r,a),a.delete(r)}}static mergeObjectKey(t,n,r,a){if(a.has(r)){Object.assign(t,{[n]:a.get(r)});return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){Object.assign(t,{[n]:r});return}t[n]||Object.assign(t,{[n]:Array.isArray(r)?[]:{}}),a.set(r,t[n]),this.merge(t[n],r,a),a.delete(r)}}static merge(t,n,r=new Map){if(this.isPlainObject(t)&&this.isPlainObject(n))for(const a of Object.keys(n))a!=="__proto__"&&this.mergeObjectKey(t,a,n[a],r);if(Array.isArray(t)&&Array.isArray(n))for(let a=0;a<n.length;a++)this.mergeArrayKey(t,a,n[a],r)}static mergeDeep(t,...n){if(!n.length)return t;for(const r of n)Cn.merge(t,r);return t}static deepCompare(...t){let n,r,a,o;if(arguments.length<1)return!0;for(n=1,r=arguments.length;n<r;n++)if(a=[],o=[],!this.compare2Objects(a,o,arguments[0],arguments[n]))return!1;return!0}static deepValue(t,n){const r=n.split(".");for(let a=0,o=r.length;a<o;a++)t=t[r[a]];return t}static replaceEmptyObjectsWithBooleans(t){for(let n in t)t[n]&&typeof t[n]=="object"&&(Object.keys(t[n]).length===0?t[n]=!0:this.replaceEmptyObjectsWithBooleans(t[n]))}static propertyPathsToTruthyObject(t){let n={};for(let r of t){const a=r.split(".");if(!a.length)continue;(!n[a[0]]||n[a[0]]===!0)&&(n[a[0]]={});let o=n[a[0]];for(let[i,s]of a.entries())i!==0&&(o[s]?o=o[s]:i===a.length-1?(o[s]={},o=null):(o[s]={},o=o[s]))}return this.replaceEmptyObjectsWithBooleans(n),n}static compareIds(t,n){return t==null||n===void 0||n===null?!1:(typeof t.id=="string"&&typeof n.id=="string"||typeof t.id=="number"&&typeof n.id=="number")&&Object.keys(t).length===1&&Object.keys(n).length===1?t.id===n.id:Cn.deepCompare(t,n)}static toBoolean(t){return typeof t=="boolean"?t:typeof t=="string"?t==="true"||t==="1":typeof t=="number"?t>0:!1}static zipObject(t,n){return t.reduce((r,a,o)=>(r[a]=n[o],r),{})}static isArraysEqual(t,n){return t.length!==n.length?!1:t.every(r=>n.indexOf(r)!==-1)}static areMutuallyExclusive(...t){return!t.some(n=>{const r=t.filter(a=>a!==n);return n.some(a=>r.some(o=>o.includes(a)))})}static parseSqlCheckExpression(t,n){const r=t.match(new RegExp(`"${n}" varchar CHECK\\s*\\(\\s*"${n}"\\s+IN\\s*`));if(r&&r.index){const a=t.substring(r.index+r[0].length);let o="",i="";const s=[];for(let c=0;c<a.length;c++){const l=a[c];switch(l){case",":o==""?(s.push(i),i=""):i+=l;break;case"'":o==l?a[c+1]===l?(i+=l,c+=1):o="":o=l;break;case")":if(o=="")return s.push(i),s;i+=l;break;default:o!=""&&(i+=l)}}}}static compare2Objects(t,n,r,a){let o;if(Number.isNaN(r)&&Number.isNaN(a)||r===a)return!0;if(r===null||a===null||r===void 0||a===void 0)return!1;if((typeof r.equals=="function"||typeof r.equals=="function")&&r.equals(a))return!0;if(typeof r=="function"&&typeof a=="function"||r instanceof Date&&a instanceof Date||r instanceof RegExp&&a instanceof RegExp||typeof r=="string"&&typeof a=="string"||typeof r=="number"&&typeof a=="number")return r.toString()===a.toString();if(!(typeof r=="object"&&typeof a=="object")||Object.prototype.isPrototypeOf.call(r,a)||Object.prototype.isPrototypeOf.call(a,r)||r.constructor!==a.constructor||r.prototype!==a.prototype||t.indexOf(r)>-1||n.indexOf(a)>-1)return!1;for(o in a)if(a.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof a[o]!=typeof r[o])return!1;for(o in r){if(a.hasOwnProperty(o)!==r.hasOwnProperty(o)||typeof a[o]!=typeof r[o])return!1;switch(typeof r[o]){case"object":case"function":if(t.push(r),n.push(a),!this.compare2Objects(t,n,r[o],a[o]))return!1;t.pop(),n.pop();break;default:if(r[o]!==a[o])return!1;break}}return!0}}class upe{constructor(t,n,r,a,o){this.expressionMap=t,this.driver=n,this.rawRelationIdResults=r,this.rawRelationCountResults=a,this.queryRunner=o}transform(t,n){const r=this.group(t,n),a=[];return r.forEach(o=>{const i=this.transformRawResultsGroup(o,n);i!==void 0&&!Object.values(i).every(s=>s===null)&&a.push(i)}),a}group(t,n){const r=new Map,a=[];return n.metadata.tableType==="view"?a.push(...n.metadata.columns.map(o=>ve.buildAlias(this.driver,void 0,n.name,o.databaseName))):a.push(...n.metadata.primaryColumns.map(o=>ve.buildAlias(this.driver,void 0,n.name,o.databaseName))),t.forEach(o=>{const i=a.map(c=>{const l=o[c];return jn.isBuffer(l)?l.toString("hex"):an.isObject(l)?JSON.stringify(l):l}).join("_"),s=r.get(i);s?s.push(o):r.set(i,[o])}),r}transformRawResultsGroup(t,n){let r=n.metadata;if(r.discriminatorColumn){const l=t.map(d=>d[ve.buildAlias(this.driver,void 0,n.name,n.metadata.discriminatorColumn.databaseName)]),u=r.childEntityMetadatas.find(d=>typeof l.find(p=>p===d.discriminatorValue)<"u");u&&(r=u)}let a=r.create(this.queryRunner,{fromDeserializer:!0,pojo:this.expressionMap.options.indexOf("create-pojo")!==-1});const o=this.transformColumns(t,n,a,r),i=this.transformJoins(t,a,n,r),s=this.transformRelationIds(t,n,a,r),c=this.transformRelationCounts(t,n,a);if(o||r.primaryColumns.filter(l=>l.isVirtual===!1).length===0&&(i||s||c))return a}transformColumns(t,n,r,a){let o=!1;return a.columns.forEach(i=>{if(a.childEntityMetadatas.length>0&&a.childEntityMetadatas.findIndex(c=>c.target===i.target)!==-1)return;const s=t[0][ve.buildAlias(this.driver,void 0,n.name,i.databaseName)];s===void 0||i.isVirtual||this.expressionMap.selects.find(c=>c.selection===n.name||c.selection===n.name+"."+i.propertyPath)&&(i.setEntityValue(r,this.driver.prepareHydratedValue(s,i)),s!==null&&(o=!0))}),o}transformJoins(t,n,r,a){let o=!1;return this.expressionMap.joinAttributes.forEach(i=>{if(!i.metadata||!i.isSelected||i.relation&&!a.relations.find(c=>c===i.relation))return;if(i.mapToProperty){if(i.mapToPropertyParentAlias!==r.name)return}else if(!i.relation||i.parentAlias!==r.name||i.relationPropertyPath!==i.relation.propertyPath)return;let s=this.transform(t,i.alias);s=i.isMany?s:s[0],s=!i.isMany&&s===void 0?null:s,s!==void 0&&(i.mapToPropertyPropertyName?n[i.mapToPropertyPropertyName]=s:i.relation.setEntityValue(n,s),o=!0)}),o}transformRelationIds(t,n,r,a){let o=!1;return this.rawRelationIdResults.forEach((i,s)=>{if(i.relationIdAttribute.parentAlias!==n.name)return;const c=i.relationIdAttribute.relation,l=this.createValueMapFromJoinColumns(c,i.relationIdAttribute.parentAlias,t);if(l==null)return;this.prepareDataForTransformRelationIds();const u=this.hashEntityIds(c,l),d=this.relationIdMaps[s][u]||[],p=i.relationIdAttribute.mapToPropertyPropertyPath.split("."),f=(m,y,v)=>{const b=m.shift();if(b&&m.length===0)return y[b]=v,y;if(b&&m.length>0)f(m,y[b],v);else return y};c.isOneToOne||c.isManyToOne?d[0]!==void 0&&(f(p,r,d[0]),o=!0):(f(p,r,d),o=o||d.length>0)}),o}transformRelationCounts(t,n,r){let a=!1;return this.rawRelationCountResults.filter(o=>o.relationCountAttribute.parentAlias===n.name).forEach(o=>{const i=o.relationCountAttribute.relation;let s;i.isOneToMany?s=i.inverseRelation.joinColumns[0].referencedColumn.databaseName:s=i.isOwning?i.joinColumns[0].referencedColumn.databaseName:i.inverseRelation.joinColumns[0].referencedColumn.databaseName;const c=t[0][ve.buildAlias(this.driver,void 0,n.name,s)];c!=null&&(r[o.relationCountAttribute.mapToPropertyPropertyName]=0,o.results.filter(l=>l.parentId===c).forEach(l=>{r[o.relationCountAttribute.mapToPropertyPropertyName]=parseInt(l.cnt),a=!0}))}),a}createValueMapFromJoinColumns(t,n,r){let a;return t.isManyToOne||t.isOneToOneOwner?a=t.entityMetadata.primaryColumns.map(o=>o):t.isOneToMany||t.isOneToOneNotOwner?a=t.inverseRelation.joinColumns.map(o=>o):t.isOwning?a=t.joinColumns.map(o=>o):a=t.inverseRelation.inverseJoinColumns.map(o=>o),a.reduce((o,i)=>(r.forEach(s=>{t.isManyToOne||t.isOneToOneOwner?o[i.databaseName]=this.driver.prepareHydratedValue(s[ve.buildAlias(this.driver,void 0,n,i.databaseName)],i):o[i.databaseName]=this.driver.prepareHydratedValue(s[ve.buildAlias(this.driver,void 0,n,i.referencedColumn.databaseName)],i.referencedColumn)}),o),{})}extractEntityPrimaryIds(t,n){let r;return t.isManyToOne||t.isOneToOneOwner?r=t.entityMetadata.primaryColumns.map(a=>a):t.isOneToMany||t.isOneToOneNotOwner?r=t.inverseRelation.joinColumns.map(a=>a):t.isOwning?r=t.joinColumns.map(a=>a):r=t.inverseRelation.inverseJoinColumns.map(a=>a),r.reduce((a,o)=>(a[o.databaseName]=n[o.databaseName],a),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map(t=>{const n=t.relationIdAttribute.relation;let r;return n.isManyToOne||n.isOneToOneOwner?r=n.joinColumns:n.isOneToMany||n.isOneToOneNotOwner?r=n.inverseEntityMetadata.primaryColumns:n.isOwning?r=n.inverseJoinColumns:r=n.inverseRelation.joinColumns,t.results.reduce((a,o)=>{let i=r.reduce((s,c)=>{let l=o[c.databaseName];return n.isOneToMany||n.isOneToOneNotOwner?(c.isVirtual&&c.referencedColumn&&c.referencedColumn.propertyName!==c.propertyName&&(l=c.referencedColumn.createValueMap(l)),Cn.mergeDeep(s,c.createValueMap(l))):(!c.isPrimary&&c.referencedColumn.referencedColumn&&(l=c.referencedColumn.referencedColumn.createValueMap(l)),Cn.mergeDeep(s,c.referencedColumn.createValueMap(l)))},{});if(r.length===1&&!t.relationIdAttribute.disableMixedMap&&(n.isOneToMany||n.isOneToOneNotOwner?i=r[0].getEntityValue(i):i=r[0].referencedColumn.getEntityValue(i)),i!==void 0){const s=this.hashEntityIds(n,o);a[s]?a[s].push(i):a[s]=[i]}return a},{})}))}hashEntityIds(t,n){const r=this.extractEntityPrimaryIds(t,n);return JSON.stringify(r)}}let dpe=class{constructor(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}async load(e){const t=this.relationIdAttributes.map(async n=>{if(n.relation.isManyToOne||n.relation.isOneToOneOwner){if(n.queryBuilderFactory)throw new xe("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const r={},a=e.map(o=>{const i={},s=[];n.relation.joinColumns.forEach(l=>{i[l.databaseName]=this.connection.driver.prepareHydratedValue(o[ve.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l.referencedColumn);const u=`${l.databaseName}:${i[l.databaseName]}`;s.indexOf(u)===-1&&s.push(u)}),n.relation.entityMetadata.primaryColumns.forEach(l=>{i[l.databaseName]=this.connection.driver.prepareHydratedValue(o[ve.buildAlias(this.connection.driver,void 0,n.parentAlias,l.databaseName)],l);const u=`${l.databaseName}:${i[l.databaseName]}`;s.indexOf(u)===-1&&s.push(u)}),s.sort();const c=s.join("::");return r[c]?null:(r[c]=!0,i)}).filter(o=>o);return{relationIdAttribute:n,results:a}}else if(n.relation.isOneToMany||n.relation.isOneToOneNotOwner){const r=n.relation,a=r.isOwning?r.joinColumns:r.inverseRelation.joinColumns,o=r.inverseEntityMetadata.target,i=r.inverseEntityMetadata.tableName,s=n.alias||i,c={},l={},u=e.map((f,m)=>{const y=[],v={},b=a.map(j=>{const x=j.databaseName+m,_=f[ve.buildAlias(this.connection.driver,void 0,n.parentAlias,j.referencedColumn.databaseName)],S=`${s}:${j.propertyPath}:${_}`;return y.indexOf(S)!==-1?"":(y.push(S),v[x]=_,s+"."+j.propertyPath+" = :"+x)}).filter(j=>j).join(" AND ");y.sort();const w=y.join("::");return c[w]?"":(c[w]=!0,Object.assign(l,v),b)}).filter(f=>f).map(f=>"("+f+")").join(" OR ");if(!u)return{relationIdAttribute:n,results:[]};const d=this.connection.createQueryBuilder(this.queryRunner);Cn.uniq([...a,...r.inverseRelation.entityMetadata.primaryColumns],f=>f.propertyPath).forEach(f=>{d.addSelect(s+"."+f.propertyPath,f.databaseName)}),d.from(o,s).where("("+u+")").setParameters(l),n.queryBuilderFactory&&n.queryBuilderFactory(d);const p=await d.getRawMany();return p.forEach(f=>{a.forEach(m=>{f[m.databaseName]=this.connection.driver.prepareHydratedValue(f[m.databaseName],m.referencedColumn)}),r.inverseRelation.entityMetadata.primaryColumns.forEach(m=>{f[m.databaseName]=this.connection.driver.prepareHydratedValue(f[m.databaseName],m)})}),{relationIdAttribute:n,results:p}}else{const r=n.relation,a=r.isOwning?r.joinColumns:r.inverseRelation.inverseJoinColumns,o=r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns,i=n.junctionAlias,s=n.joinInverseSideMetadata.tableName,c=n.alias||s,l=r.isOwning?r.junctionEntityMetadata.tableName:r.inverseRelation.junctionEntityMetadata.tableName,u=e.map(w=>a.reduce((j,x)=>(j[x.propertyPath]=w[ve.buildAlias(this.connection.driver,void 0,n.parentAlias,x.referencedColumn.databaseName)],j),{}));if(u.length===0)return{relationIdAttribute:n,results:[]};const d={},p={},f=u.map((w,j)=>{const x=[],_={},S=Object.keys(w).map(O=>{const N=O+j,M=w[O],k=`${i}:${O}:${M}`;return x.indexOf(k)!==-1?"":(x.push(k),_[N]=M,i+"."+O+" = :"+N)}).filter(O=>O).join(" AND ");x.sort();const E=x.join("::");return p[E]?"":(p[E]=!0,Object.assign(d,_),S)}).filter(w=>w),m=o.map(w=>i+"."+w.propertyPath+" = "+c+"."+w.referencedColumn.propertyPath).join(" AND "),y=f.map(w=>"("+w+" AND "+m+")").join(" OR "),v=this.connection.createQueryBuilder(this.queryRunner);o.forEach(w=>{v.addSelect(i+"."+w.propertyPath,w.databaseName).addOrderBy(i+"."+w.propertyPath)}),a.forEach(w=>{v.addSelect(i+"."+w.propertyPath,w.databaseName).addOrderBy(i+"."+w.propertyPath)}),v.from(s,c).innerJoin(l,i,y).setParameters(d),n.queryBuilderFactory&&n.queryBuilderFactory(v);const b=await v.getRawMany();return b.forEach(w=>{[...a,...o].forEach(j=>{w[j.databaseName]=this.connection.driver.prepareHydratedValue(w[j.databaseName],j.referencedColumn)})}),{relationIdAttribute:n,results:b}}});return Promise.all(t)}};class ppe{constructor(t,n){this.connection=t,this.queryRunner=n}load(t,n,r){const a=Array.isArray(n)?n:[n],o=Array.isArray(r)?r:r?[r]:void 0;return t.isManyToMany?this.loadForManyToMany(t,a,o):t.isManyToOne||t.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(t,a,o):this.loadForOneToManyAndOneToOneNotOwner(t,a,o)}async loadManyToManyRelationIdsAndGroup(t,n,r,a){const o=t.isManyToMany||t.isOneToMany,i=Array.isArray(n)?n:[n];if(!r&&(r=await this.connection.relationLoader.load(t,n,this.queryRunner,a),!r.length))return i.map(d=>({entity:d,related:o?[]:void 0}));const s=await this.load(t,n,r),c=Array.isArray(r)?r:[r];let l=[],u=[];return t.isManyToManyOwner?(l=t.junctionEntityMetadata.inverseColumns.map(d=>d.referencedColumn),u=t.junctionEntityMetadata.ownerColumns.map(d=>d.referencedColumn)):t.isManyToManyNotOwner?(l=t.junctionEntityMetadata.ownerColumns.map(d=>d.referencedColumn),u=t.junctionEntityMetadata.inverseColumns.map(d=>d.referencedColumn)):t.isManyToOne||t.isOneToOneOwner?(l=t.joinColumns.map(d=>d.referencedColumn),u=t.entityMetadata.primaryColumns):(t.isOneToMany||t.isOneToOneNotOwner)&&(l=t.inverseRelation.entityMetadata.primaryColumns,u=t.inverseRelation.joinColumns.map(d=>d.referencedColumn)),i.map(d=>{const p={entity:d,related:o?[]:void 0},f=s.filter(m=>u.every(y=>y.compareEntityValue(d,m[y.entityMetadata.name+"_"+y.propertyAliasName])));return f.length&&c.forEach(m=>{f.forEach(y=>{l.every(v=>v.compareEntityValue(m,y[ve.buildAlias(this.connection.driver,void 0,v.entityMetadata.name+"_"+t.propertyPath.replace(".","_")+"_"+v.propertyPath.replace(".","_"))]))&&(o?p.related.push(m):p.related=m)})}),p})}loadForManyToMany(t,n,r){const a=t.junctionEntityMetadata,o=a.name,i=t.isOwning?a.ownerColumns:a.inverseColumns,s=t.isOwning?a.inverseColumns:a.ownerColumns,c=this.connection.createQueryBuilder(this.queryRunner);i.forEach(p=>{const f=ve.buildAlias(this.connection.driver,void 0,p.referencedColumn.entityMetadata.name+"_"+p.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+p.propertyPath,f)}),s.forEach(p=>{const f=ve.buildAlias(this.connection.driver,void 0,p.referencedColumn.entityMetadata.name+"_"+t.propertyPath.replace(".","_")+"_"+p.referencedColumn.propertyPath.replace(".","_"));c.addSelect(o+"."+p.propertyPath,f)});let l="";if(i.length===1){const p=n.map(f=>i[0].referencedColumn.getEntityValue(f));p.every(f=>typeof f=="number")?l=`${o}.${i[0].propertyPath} IN (${p.join(", ")})`:(c.setParameter("values1",p),l=o+"."+i[0].propertyPath+" IN (:...values1)")}else l="("+n.map((p,f)=>i.map(m=>{const y="entity1_"+f+"_"+m.propertyName;return c.setParameter(y,m.referencedColumn.getEntityValue(p)),o+"."+m.propertyPath+" = :"+y}).join(" AND ")).map(p=>"("+p+")").join(" OR ")+")";let u="";if(r)if(s.length===1){const p=r.map(f=>s[0].referencedColumn.getEntityValue(f));p.every(f=>typeof f=="number")?u=`${o}.${s[0].propertyPath} IN (${p.join(", ")})`:(c.setParameter("values2",p),u=o+"."+s[0].propertyPath+" IN (:...values2)")}else u="("+r.map((p,f)=>s.map(m=>{const y="entity2_"+f+"_"+m.propertyName;return c.setParameter(y,m.referencedColumn.getEntityValue(p)),o+"."+m.propertyPath+" = :"+y}).join(" AND ")).map(p=>"("+p+")").join(" OR ")+")";const d=[l,u].filter(p=>p.length>0).join(" AND ");return c.from(a.target,o).where(d).getRawMany()}loadForManyToOneAndOneToOneOwner(t,n,r){const a=t.entityMetadata.targetName,o=t.joinColumns.every(c=>!!t.entityMetadata.nonVirtualColumns.find(l=>l===c));if(r&&o){let c=[];if(n.forEach(l=>{let u={};t.entityMetadata.primaryColumns.forEach(d=>{const p=d.entityMetadata.name+"_"+d.propertyPath.replace(".","_");u[p]=d.getEntityValue(l)}),r.forEach(d=>{t.joinColumns.forEach(p=>{const f=p.getEntityValue(l),m=p.referencedColumn.getEntityValue(d);if(!(f===void 0||m===void 0)&&f===m){const y=p.referencedColumn.entityMetadata.name+"_"+t.propertyPath.replace(".","_")+"_"+p.referencedColumn.propertyPath.replace(".","_");u[y]=m}})}),Object.keys(u).length===t.entityMetadata.primaryColumns.length+t.joinColumns.length&&c.push(u)}),c.length===n.length)return Promise.resolve(c)}const i=this.connection.createQueryBuilder(this.queryRunner);t.entityMetadata.primaryColumns.forEach(c=>{const l=ve.buildAlias(this.connection.driver,void 0,c.entityMetadata.name+"_"+c.propertyPath.replace(".","_"));i.addSelect(a+"."+c.propertyPath,l)}),t.joinColumns.forEach(c=>{const l=ve.buildAlias(this.connection.driver,void 0,c.referencedColumn.entityMetadata.name+"_"+t.propertyPath.replace(".","_")+"_"+c.referencedColumn.propertyPath.replace(".","_"));i.addSelect(a+"."+c.propertyPath,l)});let s="";if(t.entityMetadata.primaryColumns.length===1){const c=n.map(l=>t.entityMetadata.primaryColumns[0].getEntityValue(l));c.every(l=>typeof l=="number")?s=`${a}.${t.entityMetadata.primaryColumns[0].propertyPath} IN (${c.join(", ")})`:(i.setParameter("values",c),s=a+"."+t.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else s=n.map((c,l)=>t.entityMetadata.primaryColumns.map((u,d)=>{const p="entity"+l+"_"+d;return i.setParameter(p,u.getEntityValue(c)),a+"."+u.propertyPath+" = :"+p}).join(" AND ")).map(c=>"("+c+")").join(" OR ");return i.from(t.entityMetadata.target,a).where(s).getRawMany()}loadForOneToManyAndOneToOneNotOwner(t,n,r){if(t=t.inverseRelation,t.entityMetadata.primaryColumns.length===t.joinColumns.length&&t.entityMetadata.primaryColumns.every(s=>t.joinColumns.indexOf(s)!==-1))return Promise.resolve(n.map(s=>{const c={};return t.joinColumns.forEach(function(l){const u=l.referencedColumn.getEntityValue(s),d=l.referencedColumn.entityMetadata.name+"_"+l.referencedColumn.propertyPath.replace(".","_"),p=l.entityMetadata.name+"_"+t.inverseRelation.propertyPath.replace(".","_")+"_"+l.propertyPath.replace(".","_");c[d]=u,c[p]=u}),c}));const a=t.entityMetadata.targetName,o=this.connection.createQueryBuilder(this.queryRunner);t.entityMetadata.primaryColumns.forEach(s=>{const c=ve.buildAlias(this.connection.driver,void 0,s.entityMetadata.name+"_"+t.inverseRelation.propertyPath.replace(".","_")+"_"+s.propertyPath.replace(".","_"));o.addSelect(a+"."+s.propertyPath,c)}),t.joinColumns.forEach(s=>{const c=ve.buildAlias(this.connection.driver,void 0,s.referencedColumn.entityMetadata.name+"_"+s.referencedColumn.propertyPath.replace(".","_"));o.addSelect(a+"."+s.propertyPath,c)});let i="";if(t.joinColumns.length===1){const s=n.map(c=>t.joinColumns[0].referencedColumn.getEntityValue(c));s.every(c=>typeof c=="number")?i=`${a}.${t.joinColumns[0].propertyPath} IN (${s.join(", ")})`:(o.setParameter("values",s),i=a+"."+t.joinColumns[0].propertyPath+" IN (:...values)")}else i=n.map((s,c)=>t.joinColumns.map((l,u)=>{const d="entity"+c+"_"+u;return o.setParameter(d,l.referencedColumn.getEntityValue(s)),a+"."+l.propertyPath+" = :"+d}).join(" AND ")).map(s=>"("+s+")").join(" OR ");return o.from(t.entityMetadata.target,a).where(i).getRawMany()}}class fpe{constructor(t){this.expressionMap=t}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(t=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,t);this.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(t=>{!t.metadata||t.metadata.isJunction||t.metadata.relationIds.forEach(n=>{const r=this.metadataToAttribute(t.alias.name,n);this.expressionMap.relationIdAttributes.push(r)})})}metadataToAttribute(t,n){return new Y_(this.expressionMap,{relationName:t+"."+n.relation.propertyName,mapToProperty:t+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class hpe{constructor(t,n,r){this.connection=t,this.queryRunner=n,this.relationCountAttributes=r}async load(t){const n=(a,o,i)=>i.indexOf(a)===o,r=this.relationCountAttributes.map(async a=>{if(a.relation.isOneToMany){const o=a.relation,i=o.inverseRelation,s=i.joinColumns[0].referencedColumn.propertyName,c=o.inverseEntityMetadata.target,l=o.inverseEntityMetadata.tableName,u=a.alias||l,d=i.propertyName;let p=t.map(m=>m[a.parentAlias+"_"+s]).filter(m=>!!m);if(p=p.filter(n),p.length===0)return{relationCountAttribute:a,results:[]};const f=this.connection.createQueryBuilder(this.queryRunner);return f.select(u+"."+d,"parentId").addSelect("COUNT(*)","cnt").from(c,u).where(u+"."+d+" IN (:...ids)").addGroupBy(u+"."+d).setParameter("ids",p),a.queryBuilderFactory&&a.queryBuilderFactory(f),{relationCountAttribute:a,results:await f.getRawMany()}}else{let o,i,s,c;a.relation.isOwning?(o=a.relation.joinColumns[0].referencedColumn.databaseName,i=a.relation.inverseJoinColumns[0].referencedColumn.databaseName,s=a.relation.junctionEntityMetadata.columns[0],c=a.relation.junctionEntityMetadata.columns[1]):(o=a.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,i=a.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,s=a.relation.junctionEntityMetadata.columns[1],c=a.relation.junctionEntityMetadata.columns[0]);let l=t.map(v=>v[a.parentAlias+"_"+o]).filter(v=>!!v);if(l=l.filter(n),l.length===0)return{relationCountAttribute:a,results:[]};const u=a.junctionAlias,d=a.joinInverseSideMetadata.tableName,p=a.alias||d,f=a.relation.junctionEntityMetadata.tableName,m=u+"."+s.propertyName+" IN ("+l.map(v=>isNaN(v)?"'"+v+"'":v)+") AND "+u+"."+c.propertyName+" = "+p+"."+i,y=this.connection.createQueryBuilder(this.queryRunner);return y.select(u+"."+s.propertyName,"parentId").addSelect("COUNT("+y.escape(p)+"."+y.escape(i)+")","cnt").from(d,p).innerJoin(f,u,m).addGroupBy(u+"."+s.propertyName),a.queryBuilderFactory&&a.queryBuilderFactory(y),{relationCountAttribute:a,results:await y.getRawMany()}}});return Promise.all(r)}}class mpe{constructor(t){this.expressionMap=t}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(t=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,t);this.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(t=>{!t.metadata||t.metadata.isJunction||t.metadata.relationCounts.forEach(n=>{const r=this.metadataToAttribute(t.alias.name,n);this.expressionMap.relationCountAttributes.push(r)})})}metadataToAttribute(t,n){return new Q_(this.expressionMap,{relationName:t+"."+n.relation.propertyName,mapToProperty:t+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class rj{static isFindOneOptions(t){const n=t;return n&&(Array.isArray(n.select)||Array.isArray(n.relations)||typeof n.select=="object"||typeof n.relations=="object"||typeof n.where=="object"||typeof n.join=="object"||typeof n.order=="object"||typeof n.cache=="object"||typeof n.cache=="boolean"||typeof n.cache=="number"||typeof n.comment=="string"||typeof n.lock=="object"||typeof n.loadRelationIds=="object"||typeof n.loadRelationIds=="boolean"||typeof n.loadEagerRelations=="boolean"||typeof n.withDeleted=="boolean"||typeof n.relationLoadStrategy=="string"||typeof n.transaction=="boolean")}static isFindManyOptions(t){const n=t;return n&&(this.isFindOneOptions(n)||typeof n.skip=="number"||typeof n.take=="number"||typeof n.skip=="string"||typeof n.take=="string")}static extractFindManyOptionsAlias(t){if(this.isFindManyOptions(t)&&t.join)return t.join.alias}static applyOptionsToTreeQueryBuilder(t,n){if(n!=null&&n.relations){const r=[...n.relations];if(rj.applyRelationsRecursively(t,r,t.expressionMap.mainAlias.name,t.expressionMap.mainAlias.metadata,""),r.length>0)throw new Fde(r)}return t}static applyRelationsRecursively(t,n,r,a,o){let i=[];if(o){const s=new RegExp("^"+o.replace(".","\\.")+"\\.");i=n.filter(c=>c.match(s)).map(c=>a.findRelationWithPropertyPath(c.replace(s,""))).filter(c=>c)}else i=n.map(s=>a.findRelationWithPropertyPath(s)).filter(s=>s);i.forEach(s=>{let c=ve.buildAlias(t.connection.driver,{joiner:"__"},r,s.propertyPath);const l=r+"."+s.propertyPath;t.expressionMap.relationLoadStrategy==="query"?t.concatRelationMetadata(s):t.leftJoinAndSelect(l,c),n.splice(n.indexOf(o?o+"."+s.propertyPath:s.propertyPath),1);let u,d;if(t.expressionMap.relationLoadStrategy==="query")u=s.inverseEntityMetadata,d=c;else{const p=t.expressionMap.joinAttributes.find(f=>f.entityOrProperty===l);u=p.metadata,d=p.alias.name}if(!d||!u)throw new qa(s.propertyPath,a);if(this.applyRelationsRecursively(t,n,d,u,o?o+"."+s.propertyPath:s.propertyPath),t.expressionMap.relationLoadStrategy==="join"){const p=a.relations.find(f=>f.propertyName===s.propertyPath);p&&this.joinEagerRelations(t,c,p.inverseEntityMetadata)}})}static joinEagerRelations(t,n,r){r.eagerRelations.forEach(a=>{let o=ve.buildAlias(t.connection.driver,{joiner:"__"},n,a.propertyName),i=!0;for(const l of t.expressionMap.joinAttributes)if(!(l.condition!==void 0||l.mapToProperty!==void 0||l.isMappingMany!==void 0||l.direction!=="LEFT"||l.entityOrProperty!==`${n}.${a.propertyPath}`)){i=!1,o=l.alias.name;break}const s=!!t.expressionMap.joinAttributes.find(l=>l.alias.name===o);i&&!s&&t.leftJoin(n+"."+a.propertyPath,o);let c=!0;for(const l of t.expressionMap.selects)if(!(l.aliasName!==void 0||l.virtual!==void 0||l.selection!==o)){c=!1;break}c&&t.addSelect(o),this.joinEagerRelations(t,o,a.inverseEntityMetadata)})}}class aj extends Jt{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let t=this.createComment();return t+=this.createCteExpression(),t+=this.createSelectExpression(),t+=this.createJoinExpression(),t+=this.createWhereExpression(),t+=this.createGroupByExpression(),t+=this.createHavingExpression(),t+=this.createOrderByExpression(),t+=this.createLimitOffsetExpression(),t+=this.createLockExpression(),t=t.trim(),this.expressionMap.subQuery&&(t="("+t+")"),this.replacePropertyNamesForTheWholeQuery(t)}setFindOptions(t){return this.findOptions=t,this.applyFindOptions(),this}subQuery(){const t=this.createQueryBuilder();return t.expressionMap.subQuery=!0,t.parentQueryBuilder=this,t}select(t,n){if(this.expressionMap.queryType="select",Array.isArray(t))this.expressionMap.selects=t.map(r=>({selection:r}));else if(typeof t=="function"){const r=t(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else t&&(this.expressionMap.selects=[{selection:t,aliasName:n}]);return this}addSelect(t,n){if(!t)return this;if(Array.isArray(t))this.expressionMap.selects=this.expressionMap.selects.concat(t.map(r=>({selection:r})));else if(typeof t=="function"){const r=t(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else t&&this.expressionMap.selects.push({selection:t,aliasName:n});return this}maxExecutionTime(t){return this.expressionMap.maxExecutionTime=t,this}distinct(t=!0){return this.expressionMap.selectDistinct=t,this}distinctOn(t){return this.expressionMap.selectDistinctOn=t,this}fromDummy(){return this.from(this.connection.driver.dummyTableName??"(SELECT 1 AS dummy_column)","dummy_table")}from(t,n){const r=this.createFromAlias(t,n);return this.expressionMap.setMainAlias(r),this}addFrom(t,n){const r=this.createFromAlias(t,n);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(r),this}innerJoin(t,n,r,a){return this.join("INNER",t,n,r,a),this}leftJoin(t,n,r,a){return this.join("LEFT",t,n,r,a),this}innerJoinAndSelect(t,n,r,a){return this.addSelect(n),this.innerJoin(t,n,r,a),this}leftJoinAndSelect(t,n,r,a){return this.addSelect(n),this.leftJoin(t,n,r,a),this}innerJoinAndMapMany(t,n,r,a,o){return this.addSelect(r),this.join("INNER",n,r,a,o,t,!0),this}innerJoinAndMapOne(t,n,r,a,o,i){return this.addSelect(r),this.join("INNER",n,r,a,o,t,!1,i),this}leftJoinAndMapMany(t,n,r,a,o){return this.addSelect(r),this.join("LEFT",n,r,a,o,t,!0),this}leftJoinAndMapOne(t,n,r,a,o,i){return this.addSelect(r),this.join("LEFT",n,r,a,o,t,!1,i),this}loadRelationIdAndMap(t,n,r,a){const o=new Y_(this.expressionMap);return o.mapToProperty=t,o.relationName=n,typeof r=="string"&&(o.alias=r),typeof r=="object"&&r.disableMixedMap&&(o.disableMixedMap=!0),o.queryBuilderFactory=a,this.expressionMap.relationIdAttributes.push(o),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(t,n,r,a){const o=new Q_(this.expressionMap);return o.mapToProperty=t,o.relationName=n,o.alias=r,o.queryBuilderFactory=a,this.expressionMap.relationCountAttributes.push(o),this.expressionMap.createAlias({type:"other",name:o.junctionAlias}),o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata}),this}loadAllRelationIds(t){return this.expressionMap.mainAlias.metadata.relations.forEach(n=>{t!==void 0&&t.relations!==void 0&&t.relations.indexOf(n.propertyPath)===-1||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+n.propertyPath,this.expressionMap.mainAlias.name+"."+n.propertyPath,t)}),this}where(t,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(t);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(t,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}orWhere(t,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}whereExists(t){return this.where(...this.getExistsCondition(t))}andWhereExists(t){return this.andWhere(...this.getExistsCondition(t))}orWhereExists(t){return this.orWhere(...this.getExistsCondition(t))}whereInIds(t){return this.where(this.getWhereInIdsCondition(t))}andWhereInIds(t){return this.andWhere(this.getWhereInIdsCondition(t))}orWhereInIds(t){return this.orWhere(this.getWhereInIdsCondition(t))}having(t,n){return this.expressionMap.havings.push({type:"simple",condition:t}),n&&this.setParameters(n),this}andHaving(t,n){return this.expressionMap.havings.push({type:"and",condition:t}),n&&this.setParameters(n),this}orHaving(t,n){return this.expressionMap.havings.push({type:"or",condition:t}),n&&this.setParameters(n),this}groupBy(t){return t?this.expressionMap.groupBys=[t]:this.expressionMap.groupBys=[],this}addGroupBy(t){return this.expressionMap.groupBys.push(t),this}timeTravelQuery(t){return this.connection.driver.options.type==="cockroachdb"&&(t===void 0?this.expressionMap.timeTravel="follower_read_timestamp()":this.expressionMap.timeTravel=t),this}orderBy(t,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new xe('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new xe('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return t?typeof t=="object"?this.expressionMap.orderBys=t:r?this.expressionMap.orderBys={[t]:{order:n,nulls:r}}:this.expressionMap.orderBys={[t]:n}:this.expressionMap.orderBys={},this}addOrderBy(t,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new xe('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new xe('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return r?this.expressionMap.orderBys[t]={order:n,nulls:r}:this.expressionMap.orderBys[t]=n,this}limit(t){if(this.expressionMap.limit=this.normalizeNumber(t),this.expressionMap.limit!==void 0&&isNaN(this.expressionMap.limit))throw new xe('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(t){if(this.expressionMap.offset=this.normalizeNumber(t),this.expressionMap.offset!==void 0&&isNaN(this.expressionMap.offset))throw new xe('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(t){if(this.expressionMap.take=this.normalizeNumber(t),this.expressionMap.take!==void 0&&isNaN(this.expressionMap.take))throw new xe('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(t){if(this.expressionMap.skip=this.normalizeNumber(t),this.expressionMap.skip!==void 0&&isNaN(this.expressionMap.skip))throw new xe('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(t){return this.expressionMap.useIndex=t,this}setLock(t,n,r){return this.expressionMap.lockMode=t,this.expressionMap.lockVersion=n,this.expressionMap.lockTables=r,this}setOnLocked(t){return this.expressionMap.onLocked=t,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if(this.expressionMap.lockMode==="optimistic")throw new Od;this.expressionMap.queryEntity=!1;const t=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&t.isTransactionActive===!1&&(await t.startTransaction(),n=!0);const r=await this.loadRawResults(t);return n&&await t.commitTransaction(),r}catch(r){if(n)try{await t.rollbackTransaction()}catch{}throw r}finally{t!==this.queryRunner&&await t.release()}}async getRawAndEntities(){const t=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&t.isTransactionActive===!1&&(await t.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(t);return n&&await t.commitTransaction(),r}catch(r){if(n)try{await t.rollbackTransaction()}catch{}throw r}finally{t!==this.queryRunner&&await t.release()}}async getOne(){const t=(await this.getRawAndEntities()).entities[0];if(t&&this.expressionMap.lockMode==="optimistic"&&this.expressionMap.lockVersion){const n=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const r=n.updateDateColumn.getEntityValue(t);if(r.getTime()!==this.expressionMap.lockVersion.getTime())throw new TL(n.name,this.expressionMap.lockVersion,r)}else{const r=n.versionColumn.getEntityValue(t);if(r!==this.expressionMap.lockVersion)throw new TL(n.name,this.expressionMap.lockVersion,r)}}return t===void 0?null:t}async getOneOrFail(){const t=await this.getOne();if(!t)throw new Rde(this.expressionMap.mainAlias.target,this.expressionMap.parameters);return t}async getMany(){if(this.expressionMap.lockMode==="optimistic")throw new Od;return(await this.getRawAndEntities()).entities}async getCount(){if(this.expressionMap.lockMode==="optimistic")throw new Od;const t=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&t.isTransactionActive===!1&&(await t.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeCountQuery(t);return n&&await t.commitTransaction(),r}catch(r){if(n)try{await t.rollbackTransaction()}catch{}throw r}finally{t!==this.queryRunner&&await t.release()}}async getExists(){if(this.expressionMap.lockMode==="optimistic")throw new Od;const t=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&t.isTransactionActive===!1&&(await t.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeExistsQuery(t);return n&&await t.commitTransaction(),r}catch(r){if(n)try{await t.rollbackTransaction()}catch{}throw r}finally{t!==this.queryRunner&&await t.release()}}async getManyAndCount(){if(this.expressionMap.lockMode==="optimistic")throw new Od;const t=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&t.isTransactionActive===!1&&(await t.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(t);this.expressionMap.queryEntity=!1;const a=this.expressionMap.cacheId;this.expressionMap.cacheId=a&&`${a}-count`;const o=await this.executeCountQuery(t),i=[r.entities,o];return n&&await t.commitTransaction(),i}catch(r){if(n)try{await t.rollbackTransaction()}catch{}throw r}finally{t!==this.queryRunner&&await t.release()}}async stream(){this.expressionMap.queryEntity=!1;const[t,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let a=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),a=!0);const o=()=>{if(r!==this.queryRunner)return r.release()},i=r.stream(t,n,o,o);return a&&await r.commitTransaction(),i}catch(o){if(a)try{await r.rollbackTransaction()}catch{}throw o}}cache(t,n){return typeof t=="boolean"?this.expressionMap.cache=t:typeof t=="number"?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=t):(typeof t=="string"||typeof t=="number")&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=t),n&&(this.expressionMap.cacheDuration=n),this}setOption(t){return this.expressionMap.options.push(t),this}join(t,n,r,a,o,i,s,c){o&&this.setParameters(o);const l=new GL(this.connection,this.expressionMap);l.direction=t,l.mapAsEntity=c,l.mapToProperty=i,l.isMappingMany=s,l.entityOrProperty=n,l.condition=a,this.expressionMap.joinAttributes.push(l);const u=l.metadata;if(u){if(u.deleteDateColumn&&!this.expressionMap.withDeleted){const d=`${r}.${u.deleteDateColumn.propertyName} IS NULL`;l.condition=l.condition?` ${l.condition} AND ${d}`:`${d}`}l.alias=this.expressionMap.createAlias({type:"join",name:r,metadata:u}),l.relation&&l.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:l.junctionAlias,metadata:l.relation.junctionEntityMetadata})}else{let d="";if(typeof n=="function"){const f=n(this.subQuery());this.setParameters(f.getParameters()),d=f.getQuery()}else d=n;const p=typeof n=="function"||n.substr(0,1)==="("&&n.substr(-1)===")";l.alias=this.expressionMap.createAlias({type:"join",name:r,tablePath:p===!1?n:void 0,subQuery:p===!0?d:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new xe("Cannot build query because main alias is not set (call qb#from method)");const t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){const s=this.expressionMap.mainAlias.metadata;t.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,s)),n.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,s))}this.expressionMap.joinAttributes.forEach(s=>{if(s.metadata)t.push(...this.buildEscapedEntityColumnSelects(s.alias.name,s.metadata)),n.push(...this.findEntityColumnSelects(s.alias.name,s.metadata));else if(this.expressionMap.selects.some(c=>c.selection===s.alias.name)){t.push({selection:this.escape(s.alias.name)+".*"});const c=this.expressionMap.selects.find(l=>l.selection===s.alias.name);n.push(c)}}),this.expressionMap.selects.filter(s=>n.indexOf(s)===-1).forEach(s=>t.push({selection:this.replacePropertyNames(s.selection),aliasName:s.aliasName})),t.length===0&&t.push({selection:"*"});let r="";this.expressionMap.useIndex&&ve.isMySQLFamily(this.connection.driver)&&(r=` USE INDEX (${this.expressionMap.useIndex})`);const a=this.expressionMap.aliases.filter(s=>s.type==="from"&&(s.tablePath||s.subQuery)).map(s=>s.subQuery?s.subQuery+" "+this.escape(s.name):this.getTableName(s.tablePath)+" "+this.escape(s.name)),o=this.createSelectDistinctExpression(),i=t.map(s=>s.selection+(s.aliasName?" AS "+this.escape(s.aliasName):"")).join(", ");return o+i+" FROM "+a.join(", ")+this.createTableLockExpression()+r}createSelectDistinctExpression(){const{selectDistinct:t,selectDistinctOn:n,maxExecutionTime:r}=this.expressionMap,{driver:a}=this.connection;let o="SELECT ";return r>0&&ve.isMySQLFamily(a)&&(o+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),ve.isPostgresFamily(a)&&n.length>0?o=`SELECT DISTINCT ON (${n.map(i=>this.replacePropertyNames(i)).join(", ")}) `:t&&(o="SELECT DISTINCT "),o}createJoinExpression(){return this.expressionMap.joinAttributes.map(t=>{const n=t.relation,r=t.tablePath,a=t.alias.name;let o=t.condition?" AND ("+t.condition+")":"";const i=t.parentAlias;if(!i||!n){const s=t.alias.subQuery?t.alias.subQuery:this.getTableName(r);return" "+t.direction+" JOIN "+s+" "+this.escape(a)+this.createTableLockExpression()+(t.condition?" ON "+this.replacePropertyNames(t.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){const s=n.joinColumns.map(c=>a+"."+c.referencedColumn.propertyPath+"="+i+"."+n.propertyPath+"."+c.referencedColumn.propertyPath).join(" AND ");return" "+t.direction+" JOIN "+this.getTableName(r)+" "+this.escape(a)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+o)}else if(n.isOneToMany||n.isOneToOneNotOwner){const s=n.inverseRelation.joinColumns.map(c=>(n.inverseEntityMetadata.tableType==="entity-child"&&n.inverseEntityMetadata.discriminatorColumn&&(o+=" AND "+a+"."+n.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+n.inverseEntityMetadata.discriminatorValue+"'"),a+"."+n.inverseRelation.propertyPath+"."+c.referencedColumn.propertyPath+"="+i+"."+c.referencedColumn.propertyPath)).join(" AND ");if(!s)throw new xe(`Relation ${n.entityMetadata.name}.${n.propertyName} does not have join columns.`);return" "+t.direction+" JOIN "+this.getTableName(r)+" "+this.escape(a)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+o)}else{const s=n.junctionEntityMetadata.tablePath,c=t.junctionAlias;let l="",u="";return n.isOwning?(l=n.joinColumns.map(d=>c+"."+d.propertyPath+"="+i+"."+d.referencedColumn.propertyPath).join(" AND "),u=n.inverseJoinColumns.map(d=>a+"."+d.referencedColumn.propertyPath+"="+c+"."+d.propertyPath).join(" AND ")):(l=n.inverseRelation.inverseJoinColumns.map(d=>c+"."+d.propertyPath+"="+i+"."+d.referencedColumn.propertyPath).join(" AND "),u=n.inverseRelation.joinColumns.map(d=>a+"."+d.referencedColumn.propertyPath+"="+c+"."+d.propertyPath).join(" AND "))," "+t.direction+" JOIN "+this.getTableName(s)+" "+this.escape(c)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(l)+" "+t.direction+" JOIN "+this.getTableName(r)+" "+this.escape(a)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(u+o)}}).join(" ")}createGroupByExpression(){return!this.expressionMap.groupBys||!this.expressionMap.groupBys.length?"":" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", "))}createOrderByExpression(){const t=this.expressionMap.allOrderBys;return Object.keys(t).length===0?"":" ORDER BY "+Object.keys(t).map(n=>{const r=typeof t[n]=="string"?t[n]:t[n].order+" "+t[n].nulls,a=this.expressionMap.selects.find(o=>o.selection===n);if(a&&!a.aliasName&&n.indexOf(".")!==-1){const o=n.split("."),i=o[0],s=o.slice(1).join("."),c=this.expressionMap.aliases.find(l=>l.name===i);if(c){const l=c.metadata.findColumnWithPropertyPath(s);if(l){const u=ve.buildAlias(this.connection.driver,void 0,i,l.databaseName);return this.escape(u)+" "+r}}}return this.replacePropertyNames(n)+" "+r}).join(", ")}createLimitOffsetExpression(){let t=this.expressionMap.offset,n=this.expressionMap.limit;if(!t&&!n&&this.expressionMap.joinAttributes.length===0&&(t=this.expressionMap.skip,n=this.expressionMap.take),this.connection.driver.options.type==="mssql"){let r="";if((n||t)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(r=" ORDER BY (SELECT NULL)"),n&&t)return r+" OFFSET "+t+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return r+" OFFSET 0 ROWS FETCH NEXT "+n+" ROWS ONLY";if(t)return r+" OFFSET "+t+" ROWS"}else if(ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){if(n&&t)return" LIMIT "+n+" OFFSET "+t;if(n)return" LIMIT "+n;if(t)throw new zde}else if(ve.isSQLiteFamily(this.connection.driver)){if(n&&t)return" LIMIT "+n+" OFFSET "+t;if(n)return" LIMIT "+n;if(t)return" LIMIT -1 OFFSET "+t}else if(this.connection.driver.options.type==="oracle"){if(n&&t)return" OFFSET "+t+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return" FETCH NEXT "+n+" ROWS ONLY";if(t)return" OFFSET "+t+" ROWS"}else{if(n&&t)return" LIMIT "+n+" OFFSET "+t;if(n)return" LIMIT "+n;if(t)return" OFFSET "+t}return""}createTableLockExpression(){if(this.connection.driver.options.type==="mssql")switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const t=this.connection.driver;let n="";if(this.expressionMap.lockTables){if(!(ve.isPostgresFamily(t)||t.options.type==="cockroachdb"))throw new xe("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new xe("lockTables cannot be an empty array");n=" OF "+this.expressionMap.lockTables.join(", ")}let r="";switch(this.expressionMap.onLocked==="nowait"?r=" NOWAIT":this.expressionMap.onLocked==="skip_locked"&&(r=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if(t.options.type==="mysql"||t.options.type==="aurora-mysql")return ve.isReleaseVersionOrGreater(t,"8.0.0")?" FOR SHARE"+n+r:" LOCK IN SHARE MODE";if(t.options.type==="mariadb")return" LOCK IN SHARE MODE";if(ve.isPostgresFamily(t))return" FOR SHARE"+n+r;if(t.options.type==="oracle")return" FOR UPDATE";if(t.options.type==="mssql")return"";throw new Ac;case"pessimistic_write":if(ve.isMySQLFamily(t)||t.options.type==="aurora-mysql"||t.options.type==="oracle")return" FOR UPDATE"+r;if(ve.isPostgresFamily(t)||t.options.type==="cockroachdb")return" FOR UPDATE"+n+r;if(t.options.type==="mssql")return"";throw new Ac;case"pessimistic_partial_write":if(ve.isPostgresFamily(t))return" FOR UPDATE"+n+" SKIP LOCKED";if(ve.isMySQLFamily(t))return" FOR UPDATE SKIP LOCKED";throw new Ac;case"pessimistic_write_or_fail":if(ve.isPostgresFamily(t)||t.options.type==="cockroachdb")return" FOR UPDATE"+n+" NOWAIT";if(ve.isMySQLFamily(t))return" FOR UPDATE NOWAIT";throw new Ac;case"for_no_key_update":if(ve.isPostgresFamily(t)||t.options.type==="cockroachdb")return" FOR NO KEY UPDATE"+n+r;throw new Ac;case"for_key_share":if(ve.isPostgresFamily(t))return" FOR KEY SHARE"+n+r;throw new Ac;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const t=this.expressionMap.havings.map((n,r)=>{switch(n.type){case"and":return(r>0?"AND ":"")+this.replacePropertyNames(n.condition);case"or":return(r>0?"OR ":"")+this.replacePropertyNames(n.condition);default:return this.replacePropertyNames(n.condition)}}).join(" ");return t.length?" HAVING "+t:""}buildEscapedEntityColumnSelects(t,n){const r=this.expressionMap.selects.some(l=>l.selection===t),a=[];if(r&&a.push(...n.columns.filter(l=>l.isSelect===!0)),a.push(...n.columns.filter(l=>this.expressionMap.selects.some(u=>u.selection===t+"."+l.propertyPath))),a.length===0)return[];const o=this.expressionMap.queryEntity?n.primaryColumns.filter(l=>a.indexOf(l)===-1):[],i=[...a,...o],s=[],c=this.escape(t);return i.forEach(l=>{let u=c+"."+this.escape(l.databaseName);l.isVirtualProperty&&l.query&&(u=`(${l.query(c)})`),this.connection.driver.spatialTypes.indexOf(l.type)!==-1&&((ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(u=`${this.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText"}(${u})`),ve.isPostgresFamily(this.connection.driver)&&(l.precision?u=`ST_AsGeoJSON(${u}, ${l.precision})::json`:u=`ST_AsGeoJSON(${u})::json`),this.connection.driver.options.type==="mssql"&&(u=`${u}.ToString()`));const d=this.expressionMap.selects.filter(p=>p.selection===t+"."+l.propertyPath);if(d.length)d.forEach(p=>{s.push({selection:u,aliasName:p.aliasName?p.aliasName:ve.buildAlias(this.connection.driver,void 0,t,l.databaseName),virtual:p.virtual})});else{if(l.isVirtualProperty)return;s.push({selection:u,aliasName:ve.buildAlias(this.connection.driver,void 0,t,l.databaseName),virtual:r})}}),s}findEntityColumnSelects(t,n){const r=this.expressionMap.selects.find(a=>a.selection===t);return r?[r]:this.expressionMap.selects.filter(a=>n.columns.some(o=>a.selection===t+"."+o.propertyPath))}computeCountExpression(){const t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(t);if(this.expressionMap.joinAttributes.length===0&&this.expressionMap.relationIdAttributes.length===0&&this.expressionMap.relationCountAttributes.length===0)return"COUNT(1)";if(this.connection.driver.options.type==="cockroachdb"||ve.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+n.map(a=>`${r}.${this.escape(a.databaseName)}`).join(", ")+"))";if(ve.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+n.map(a=>`${r}.${this.escape(a.databaseName)}`).join(", ")+")";if(this.connection.driver.options.type==="mssql"){const a=n.map(o=>`${r}.${this.escape(o.databaseName)}`).join(", '|;|', ");return n.length===1?`COUNT(DISTINCT(${a}))`:`COUNT(DISTINCT(CONCAT(${a})))`}return this.connection.driver.options.type==="spanner"?n.length===1?`COUNT(DISTINCT(${r}.${this.escape(n[0].databaseName)}))`:`COUNT(DISTINCT(CONCAT(${n.map(a=>`CAST(${r}.${this.escape(a.databaseName)} AS STRING)`).join(", '|;|', ")})))`:"COUNT(DISTINCT("+n.map(a=>`${r}.${this.escape(a.databaseName)}`).join(" || '|;|' || ")+"))"}async executeCountQuery(t){const n=this.computeCountExpression(),r=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(n,"cnt").setOption("disable-global-order").loadRawResults(t);return!r||!r[0]||!r[0].cnt?0:parseInt(r[0].cnt)}async executeExistsQuery(t){return(await this.connection.createQueryBuilder().fromDummy().select("1","row_exists").whereExists(this).limit(1).loadRawResults(t)).length>0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const t=Array.isArray(this.findOptions.select)?Cn.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(t,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const t=Array.isArray(this.findOptions.relations)?Cn.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(t,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.findOptions.loadEagerRelations!==!1&&this.expressionMap.relationLoadStrategy==="join"&&this.buildEagerRelations(t,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere(this.conditions.substr(0,1)!=="("?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach(t=>{t.select&&!t.selection?t.type==="inner"?this.innerJoinAndSelect(`${t.parentAlias}.${t.relationMetadata.propertyPath}`,t.alias):this.leftJoinAndSelect(`${t.parentAlias}.${t.relationMetadata.propertyPath}`,t.alias):t.type==="inner"?this.innerJoin(`${t.parentAlias}.${t.relationMetadata.propertyPath}`,t.alias):this.leftJoin(`${t.parentAlias}.${t.relationMetadata.propertyPath}`,t.alias)}),this.findOptions.skip!==void 0&&this.skip(this.findOptions.skip),this.findOptions.take!==void 0&&this.take(this.findOptions.take),typeof this.findOptions.cache=="number"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="boolean"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="object"&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach(t=>{this.leftJoin(this.findOptions.join.leftJoin[t],t)}),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach(t=>{this.innerJoin(this.findOptions.join.innerJoin[t],t)}),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach(t=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[t],t)}),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach(t=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[t],t)})),this.findOptions.lock){if(this.findOptions.lock.mode==="optimistic")this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if(this.findOptions.lock.mode==="pessimistic_read"||this.findOptions.lock.mode==="pessimistic_write"||this.findOptions.lock.mode==="dirty_read"||this.findOptions.lock.mode==="pessimistic_partial_write"||this.findOptions.lock.mode==="pessimistic_write_or_fail"||this.findOptions.lock.mode==="for_no_key_update"||this.findOptions.lock.mode==="for_key_share"){const t=this.findOptions.lock.tables?this.findOptions.lock.tables.map(n=>{const r=this.expressionMap.aliases.find(a=>a.metadata.tableNameWithoutPrefix===n);if(!r)throw new xe(`"${n}" is not part of this query`);return this.escape(r.name)}):void 0;this.setLock(this.findOptions.lock.mode,void 0,t),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}}this.findOptions.loadRelationIds===!0?this.loadAllRelationIds():typeof this.findOptions.loadRelationIds=="object"&&this.loadAllRelationIds(this.findOptions.loadRelationIds),this.findOptions.loadEagerRelations!==!1&&rj.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),this.findOptions.transaction===!0&&(this.expressionMap.useTransaction=!0)}}concatRelationMetadata(t){this.relationMetadatas.push(t)}async executeEntitiesAndRawResults(t){if(!this.expressionMap.mainAlias)throw new xe('Alias is not set. Use "from" method to set an alias.');if((this.expressionMap.lockMode==="pessimistic_read"||this.expressionMap.lockMode==="pessimistic_write"||this.expressionMap.lockMode==="pessimistic_partial_write"||this.expressionMap.lockMode==="pessimistic_write_or_fail"||this.expressionMap.lockMode==="for_no_key_update"||this.expressionMap.lockMode==="for_key_share")&&!t.isTransactionActive)throw new Bde;if(this.expressionMap.lockMode==="optimistic"){const i=this.expressionMap.mainAlias.metadata;if(!i.versionColumn&&!i.updateDateColumn)throw new Lde(i.name)}const n=new dpe(this.connection,t,this.expressionMap.relationIdAttributes),r=new hpe(this.connection,t,this.expressionMap.relationCountAttributes);new fpe(this.expressionMap).transform(),new mpe(this.expressionMap).transform();let a=[],o=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[i,s]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),c=this.expressionMap.mainAlias.metadata,l=this.expressionMap.mainAlias.name,u=c.primaryColumns.map(f=>{const m=this.escape("distinctAlias"),y=this.escape(ve.buildAlias(this.connection.driver,void 0,l,f.databaseName));s[y]||(s[y]="ASC");const v=ve.buildAlias(this.connection.driver,void 0,"ids_"+l,f.databaseName);return`${m}.${y} AS ${this.escape(v)}`}),d=this.clone(),p=d.expressionMap.timeTravel;if(a=await new aj(this.connection,t).select(`DISTINCT ${u.join(", ")}`).addSelect(i).from(`(${d.orderBy().timeTravelQuery(!1).getQuery()})`,"distinctAlias").timeTravelQuery(p).offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(s).cache(this.expressionMap.cache&&this.expressionMap.cacheId?`${this.expressionMap.cacheId}-pagination`:this.expressionMap.cache,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),a.length>0){let f="";const m={};if(c.hasMultiplePrimaryKeys)f=a.map((y,v)=>c.primaryColumns.map(b=>{const w=`orm_distinct_ids_${v}_${b.databaseName}`,j=ve.buildAlias(this.connection.driver,void 0,"ids_"+l,b.databaseName);return m[w]=y[j],`${l}.${b.propertyPath}=:${w}`}).join(" AND ")).join(" OR ");else{const y=ve.buildAlias(this.connection.driver,void 0,"ids_"+l,c.primaryColumns[0].databaseName),v=a.map(b=>b[y]);v.every(b=>typeof b=="number")?f=`${l}.${c.primaryColumns[0].propertyPath} IN (${v.join(", ")})`:(m.orm_distinct_ids=v,f=l+"."+c.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}a=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:f}).setParameters(m).loadRawResults(t)}}else a=await this.loadRawResults(t);if(a.length>0){const i=await n.load(a),s=await r.load(a);o=new upe(this.expressionMap,this.connection.driver,i,s,this.queryRunner).transform(a,this.expressionMap.mainAlias),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await t.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,o)}if(this.expressionMap.relationLoadStrategy==="query"){const i=new ppe(this.connection,t);await Promise.all(this.relationMetadatas.map(async s=>{const c=s.inverseEntityMetadata.target,l=s.inverseEntityMetadata.targetName,u=Array.isArray(this.findOptions.select)?Cn.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,d=Array.isArray(this.findOptions.relations)?Cn.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,p=this.createQueryBuilder(t).select(l).from(c,l).setFindOptions({select:u?Cn.deepValue(u,s.propertyPath):void 0,order:this.findOptions.order?Cn.deepValue(this.findOptions.order,s.propertyPath):void 0,relations:d?Cn.deepValue(d,s.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(o.length>0){const f=await i.loadManyToManyRelationIdsAndGroup(s,o,void 0,p);o.forEach(m=>{const y=f.find(v=>v.entity===m);if(y){const v=y.related===void 0?null:y.related;s.setEntityValue(m,v)}})}}))}return{raw:a,entities:o}}createOrderByCombinedWithSelectExpression(t){const n=this.expressionMap.allOrderBys,r=Object.keys(n).map(o=>{if(o.indexOf(".")!==-1){const i=o.split("."),s=i[0],c=i.slice(1).join("."),l=this.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(c);return this.escape(t)+"."+this.escape(ve.buildAlias(this.connection.driver,void 0,s,l.databaseName))}else return this.expressionMap.selects.find(i=>i.selection===o||i.aliasName===o)?this.escape(t)+"."+this.escape(o):""}).join(", "),a={};return Object.keys(n).forEach(o=>{if(o.indexOf(".")!==-1){const i=o.split("."),s=i[0],c=i.slice(1).join("."),l=this.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(c);a[this.escape(t)+"."+this.escape(ve.buildAlias(this.connection.driver,void 0,s,l.databaseName))]=n[o]}else this.expressionMap.selects.find(i=>i.selection===o||i.aliasName===o)?a[this.escape(t)+"."+this.escape(o)]=n[o]:a[o]=n[o]}),[r,a]}async loadRawResults(t){const[n,r]=this.getQueryAndParameters(),a=n+" -- PARAMETERS: "+JSON.stringify(r,(u,d)=>typeof d=="bigint"?d.toString():d),o=typeof this.connection.options.cache=="object"?this.connection.options.cache:{};let i;const s=o.alwaysEnabled&&this.expressionMap.cache!==!1||this.expressionMap.cache===!0;let c=!1;if(this.connection.queryResultCache&&s)try{if(i=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:a,duration:this.expressionMap.cacheDuration||o.duration||1e3},t),i&&!this.connection.queryResultCache.isExpired(i))return JSON.parse(i.result)}catch(u){if(!o.ignoreErrors)throw u;c=!0}const l=await t.query(n,r,!0);if(!c&&this.connection.queryResultCache&&s)try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:a,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(l.records)},i,t)}catch(u){if(!o.ignoreErrors)throw u}return l.records}mergeExpressionMap(t){return an.assign(this.expressionMap,t),this}normalizeNumber(t){return typeof t=="number"||t===void 0||t===null?t:Number(t)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner(this.connection.defaultReplicationModeForReads())}buildSelect(t,n,r,a){for(let o in t){if(t[o]===void 0||t[o]===!1)continue;const i=a?a+"."+o:o,s=n.findColumnWithPropertyPathStrict(i),c=n.findEmbeddedWithPropertyPath(i),l=n.findRelationWithPropertyPath(i);if(!c&&!s&&!l)throw new qa(i,n);s?this.selects.push(r+"."+i):c&&this.buildSelect(t[o],n,r,i)}}buildRelations(t,n,r,a,o){t&&Object.keys(t).forEach(i=>{const s=t[i],c=o?o+"."+i:i,l=r.findEmbeddedWithPropertyPath(c),u=r.findRelationWithPropertyPath(c);if(!l&&!u)throw new qa(c,r);if(l)this.buildRelations(s,typeof n=="object"?Cn.deepValue(n,l.propertyPath):void 0,r,a,c);else if(u){let d=a+"_"+c.replace(".","_");d=ve.buildAlias(this.connection.driver,{joiner:"__"},a,d),(s===!0||typeof s=="object")&&(this.expressionMap.relationLoadStrategy==="query"?this.concatRelationMetadata(u):(this.joins.push({type:"left",select:!0,selection:n&&typeof n[i]=="object"?n[i]:void 0,alias:d,parentAlias:a,relationMetadata:u}),n&&typeof n[i]=="object"&&this.buildSelect(n[i],u.inverseEntityMetadata,d))),typeof s=="object"&&this.expressionMap.relationLoadStrategy==="join"&&this.buildRelations(s,typeof n=="object"?Cn.deepValue(n,u.propertyPath):void 0,u.inverseEntityMetadata,d,void 0)}})}buildEagerRelations(t,n,r,a,o){t&&Object.keys(t).forEach(i=>{const s=t[i],c=o?o+"."+i:i,l=r.findEmbeddedWithPropertyPath(c),u=r.findRelationWithPropertyPath(c);if(!l&&!u)throw new qa(c,r);if(l)this.buildEagerRelations(s,typeof n=="object"?Cn.deepValue(n,l.propertyPath):void 0,r,a,c);else if(u){let d=a+"_"+c.replace(".","_");d=ve.buildAlias(this.connection.driver,{joiner:"__"},a,d),(s===!0||typeof s=="object")&&u.inverseEntityMetadata.eagerRelations.forEach(p=>{let f=d+"_"+p.propertyPath.replace(".","_");f=ve.buildAlias(this.connection.driver,{joiner:"__"},d,f),this.joins.find(m=>m.alias===f)||this.joins.push({type:"left",select:!0,alias:f,parentAlias:d,selection:void 0,relationMetadata:p}),n&&typeof n[i]=="object"&&this.buildSelect(n[i],u.inverseEntityMetadata,d)}),typeof s=="object"&&this.buildEagerRelations(s,typeof n=="object"?Cn.deepValue(n,u.propertyPath):void 0,u.inverseEntityMetadata,d,void 0)}})}buildOrder(t,n,r,a){for(let o in t){if(t[o]===void 0)continue;const i=a?a+"."+o:o,s=n.findColumnWithPropertyPathStrict(i),c=n.findEmbeddedWithPropertyPath(i),l=n.findRelationWithPropertyPath(i);if(!c&&!s&&!l)throw new qa(i,n);if(s){let u=typeof t[o]=="object"?t[o].direction:t[o];u=u==="DESC"||u==="desc"||u===-1?"DESC":"ASC";let d=typeof t[o]=="object"?t[o].nulls:void 0;d=(d==null?void 0:d.toLowerCase())==="first"?"NULLS FIRST":(d==null?void 0:d.toLowerCase())==="last"?"NULLS LAST":void 0;let p=`${r}.${i}`;this.addOrderBy(p,u,d)}else if(c)this.buildOrder(t[o],n,r,i);else if(l){let u=r+"_"+i.replace(".","_");u=ve.buildAlias(this.connection.driver,{joiner:"__"},r,u),this.joins.find(d=>d.alias===u)||this.joins.push({type:"left",select:!1,alias:u,parentAlias:r,selection:void 0,relationMetadata:l}),this.buildOrder(t[o],l.inverseEntityMetadata,u)}}}buildWhere(t,n,r,a){let o="";if(Array.isArray(t))t.length&&(o=t.map(i=>this.buildWhere(i,n,r,a)).filter(i=>!!i).map(i=>"("+i+")").join(" OR "));else{let i=[];for(let s in t){if(t[s]===void 0||t[s]===null)continue;const c=a?a+"."+s:s,l=n.findColumnWithPropertyPathStrict(c),u=n.findEmbeddedWithPropertyPath(c),d=n.findRelationWithPropertyPath(c);if(!u&&!l&&!d)throw new qa(c,n);if(l){let p=`${r}.${c}`;l.isVirtualProperty&&l.query&&(p=`(${l.query(r)})`);let f=t[s];At.isEqualOperator(t[s])&&(f=t[s].value),l.transformer&&(f instanceof Cd?f.transformValue(l.transformer):f=tj.transformTo(l.transformer,f)),i.push(this.createWhereConditionExpression(this.getWherePredicateCondition(p,f)))}else if(u){const p=this.buildWhere(t[s],n,r,c);p&&i.push(p)}else if(d){if(typeof t[s]=="object"&&Object.keys(t[s]).every(p=>t[s][p]===void 0))continue;if(At.isFindOperator(t[s]))if(t[s].type==="moreThan"||t[s].type==="lessThan"||t[s].type==="moreThanOrEqual"||t[s].type==="lessThanOrEqual"){let p="";t[s].type==="moreThan"?p=">":t[s].type==="lessThan"?p="<":t[s].type==="moreThanOrEqual"?p=">=":t[s].type==="lessThanOrEqual"&&(p="<=");const f=this.subQuery();if(d.isManyToManyOwner)f.select("COUNT(*)").from(d.joinTableName,d.joinTableName).where(d.joinColumns.map(m=>`${d.joinTableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else if(d.isManyToManyNotOwner)f.select("COUNT(*)").from(d.inverseRelation.joinTableName,d.inverseRelation.joinTableName).where(d.inverseRelation.inverseJoinColumns.map(m=>`${d.inverseRelation.joinTableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else if(d.isOneToMany)f.select("COUNT(*)").from(d.inverseEntityMetadata.target,d.inverseEntityMetadata.tableName).where(d.inverseRelation.joinColumns.map(m=>`${d.inverseEntityMetadata.tableName}.${m.propertyName} = ${r}.${m.referencedColumn.propertyName}`).join(" AND "));else throw new Error("This relation isn't supported by given find operator");this.andWhere(f.getSql()+" "+p+" "+parseInt(t[s].value))}else if(d.isManyToOne||d.isOneToOne&&d.isOneToOneOwner){const p=`${r}.${c}`;i.push(this.createWhereConditionExpression(this.getWherePredicateCondition(p,t[s])))}else throw new Error("This relation isn't supported by given find operator");else{let p=r+"_"+d.propertyPath.replace(".","_");p=ve.buildAlias(this.connection.driver,{joiner:"__"},r,p),this.joins.find(m=>m.alias===p)||this.joins.push({type:"left",select:!1,selection:void 0,alias:p,parentAlias:r,relationMetadata:d});const f=this.buildWhere(t[s],d.inverseEntityMetadata,p);f&&i.push(f)}}}o=i.length?"("+i.join(") AND (")+")":i.join(" AND ")}return o.length?"("+o+")":o}}class t6{constructor(){this.generatedMaps=[]}static from(t){const n=new this;return n.raw=t.records,n.affected=t.affected,n}}class ype extends Jt{constructor(t,n){super(t,n),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let t=this.createUpdateExpression();return t+=this.createCteExpression(),t+=this.createOrderByExpression(),t+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(t.trim())}async execute(){const t=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&t.isTransactionActive===!1&&(await t.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await t.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await t.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const r=new nj(t,this.expressionMap);this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=r.getSoftDeletionReturningColumns());const[a,o]=this.getQueryAndParameters(),i=await t.query(a,o,!0),s=t6.from(i);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await r.update(s,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await t.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await t.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),n&&await t.commitTransaction(),s}catch(r){if(n)try{await t.rollbackTransaction()}catch{}throw r}finally{t!==this.queryRunner&&await t.release()}}from(t,n){t=At.isEntitySchema(t)?t.options.name:t;const r=this.createFromAlias(t,n);return this.expressionMap.setMainAlias(r),this}where(t,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(t);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(t,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}orWhere(t,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}whereInIds(t){return this.where(this.getWhereInIdsCondition(t))}andWhereInIds(t){return this.andWhere(this.getWhereInIdsCondition(t))}orWhereInIds(t){return this.orWhere(this.getWhereInIdsCondition(t))}output(t){return this.returning(t)}returning(t){if(!this.connection.driver.isReturningSqlSupported("update"))throw new _m;return this.expressionMap.returning=t,this}orderBy(t,n="ASC",r){return t?typeof t=="object"?this.expressionMap.orderBys=t:r?this.expressionMap.orderBys={[t]:{order:n,nulls:r}}:this.expressionMap.orderBys={[t]:n}:this.expressionMap.orderBys={},this}addOrderBy(t,n="ASC",r){return r?this.expressionMap.orderBys[t]={order:n,nulls:r}:this.expressionMap.orderBys[t]=n,this}limit(t){return this.expressionMap.limit=t,this}whereEntity(t){if(!this.expressionMap.mainAlias.hasMetadata)throw new xe(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(t)?t:[t];return n.forEach(r=>{const a=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!a)throw new xe("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(a)}),this.expressionMap.whereEntities=n,this}updateEntity(t){return this.expressionMap.updateEntity=t,this}createUpdateExpression(){const t=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!t)throw new xe(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!t.deleteDateColumn)throw new Dde(t);const n=[];switch(this.expressionMap.queryType){case"soft-delete":n.push(this.escape(t.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":n.push(this.escape(t.deleteDateColumn.databaseName)+" = NULL");break;default:throw new xe('The queryType must be "soft-delete" or "restore"')}if(t.versionColumn&&n.push(this.escape(t.versionColumn.databaseName)+" = "+this.escape(t.versionColumn.databaseName)+" + 1"),t.updateDateColumn&&n.push(this.escape(t.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),n.length<=0)throw new z_;const r=this.createWhereExpression(),a=this.createReturningExpression("update");return a===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")} OUTPUT ${a}${r}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r} RETURNING ${a}`}createOrderByExpression(){const t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(n=>typeof t[n]=="string"?this.replacePropertyNames(n)+" "+t[n]:this.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls).join(", "):""}createLimitExpression(){let t=this.expressionMap.limit;if(t){if(ve.isMySQLFamily(this.connection.driver))return" LIMIT "+t;throw new IL}return""}}class gpe extends Jt{constructor(t,n){super(t,n),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let t=this.createComment();return t+=this.createCteExpression(),t+=this.createUpdateExpression(),t+=this.createOrderByExpression(),t+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(t.trim())}async execute(){const t=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&t.isTransactionActive===!1&&(await t.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await t.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let r=null,a=null;const o=new nj(t,this.expressionMap),i=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const p of this.expressionMap.returning)i.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(p));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=o.getUpdationReturningColumns(),i.push(...this.expressionMap.extraReturningColumns.filter(p=>!i.includes(p)))),i.length>0&&this.connection.driver.options.type==="mssql"&&(r=this.connection.driver.buildTableVariableDeclaration("@OutputTable",i),a="SELECT * FROM @OutputTable");const[s,c]=this.getQueryAndParameters(),l=[r,s,a],u=await t.query(l.filter(p=>p!=null).join(`;

`),c,!0),d=t6.from(u);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await o.update(d,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await t.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),n&&await t.commitTransaction(),d}catch(r){if(n)try{await t.rollbackTransaction()}catch{}throw r}finally{t!==this.queryRunner&&await t.release()}}set(t){return this.expressionMap.valuesSet=t,this}where(t,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(t);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(t,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}orWhere(t,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(t)}),n&&this.setParameters(n),this}whereInIds(t){return this.where(this.getWhereInIdsCondition(t))}andWhereInIds(t){return this.andWhere(this.getWhereInIdsCondition(t))}orWhereInIds(t){return this.orWhere(this.getWhereInIdsCondition(t))}output(t){return this.returning(t)}returning(t){if(!this.connection.driver.isReturningSqlSupported("update"))throw new _m;return this.expressionMap.returning=t,this}orderBy(t,n="ASC",r){return t?typeof t=="object"?this.expressionMap.orderBys=t:r?this.expressionMap.orderBys={[t]:{order:n,nulls:r}}:this.expressionMap.orderBys={[t]:n}:this.expressionMap.orderBys={},this}addOrderBy(t,n="ASC",r){return r?this.expressionMap.orderBys[t]={order:n,nulls:r}:this.expressionMap.orderBys[t]=n,this}limit(t){return this.expressionMap.limit=t,this}whereEntity(t){if(!this.expressionMap.mainAlias.hasMetadata)throw new xe(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(t)?t:[t];return n.forEach(r=>{const a=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!a)throw new xe("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(a)}),this.expressionMap.whereEntities=n,this}updateEntity(t){return this.expressionMap.updateEntity=t,this}createUpdateExpression(){const t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r={};for(let c in t)t[c]!==void 0&&(r[c]=t[c]);const a=[],o=[];if(n?(this.createPropertyPath(n,r).forEach(c=>{const l=n.findColumnsWithPropertyPath(c);if(l.length<=0)throw new qa(c,n);l.forEach(u=>{if(!u.isUpdate||o.includes(u))return;o.push(u);let d=u.getEntityValue(r);if(u.referencedColumn&&typeof d=="object"&&!(d instanceof Date)&&d!==null&&!jn.isBuffer(d)?d=u.referencedColumn.getEntityValue(d):typeof d!="function"&&(d=this.connection.driver.preparePersistentValue(d,u)),typeof d=="function")a.push(this.escape(u.databaseName)+" = "+d());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&d===null)a.push(this.escape(u.databaseName)+" = NULL");else{this.connection.driver.options.type==="mssql"&&(d=this.connection.driver.parametrizeValue(u,d));const p=this.createParameter(d);let f=null;if((ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1){const m=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";u.srid!=null?f=`${m}(${p}, ${u.srid})`:f=`${m}(${p})`}else ve.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1?u.srid!=null?f=`ST_SetSRID(ST_GeomFromGeoJSON(${p}), ${u.srid})::${u.type}`:f=`ST_GeomFromGeoJSON(${p})::${u.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(u.type)!==-1?f=u.type+"::STGeomFromText("+p+", "+(u.srid||"0")+")":f=p;a.push(this.escape(u.databaseName)+" = "+f)}})}),(a.length>0||Object.keys(r).length===0)&&(n.versionColumn&&o.indexOf(n.versionColumn)===-1&&a.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&o.indexOf(n.updateDateColumn)===-1&&a.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(r).map(c=>{let l=r[c];if(typeof l=="function")a.push(this.escape(c)+" = "+l());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&l===null)a.push(this.escape(c)+" = NULL");else{const u=this.createParameter(l);a.push(this.escape(c)+" = "+u)}}),a.length<=0)throw new z_;const i=this.createWhereExpression(),s=this.createReturningExpression("update");return s===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${a.join(", ")}${i}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${a.join(", ")} OUTPUT ${s}${i}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${a.join(", ")}${i} RETURNING ${s}`}createOrderByExpression(){const t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(n=>typeof t[n]=="string"?this.replacePropertyNames(n)+" "+t[n]:this.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls).join(", "):""}createLimitExpression(){let t=this.expressionMap.limit;if(t){if(ve.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")return" LIMIT "+t;throw new IL}return""}getValueSet(){if(typeof this.expressionMap.valuesSet=="object")return this.expressionMap.valuesSet;throw new z_}}function vpe(){Jt.registerQueryBuilderClass("DeleteQueryBuilder",e=>new tpe(e)),Jt.registerQueryBuilderClass("InsertQueryBuilder",e=>new spe(e)),Jt.registerQueryBuilderClass("RelationQueryBuilder",e=>new lpe(e)),Jt.registerQueryBuilderClass("SelectQueryBuilder",e=>new aj(e)),Jt.registerQueryBuilderClass("SoftDeleteQueryBuilder",e=>new ype(e)),Jt.registerQueryBuilderClass("UpdateQueryBuilder",e=>new gpe(e))}var n6;(function(e){e.VIEW="VIEW",e.MATERIALIZED_VIEW="MATERIALIZED_VIEW",e.GENERATED_COLUMN="GENERATED_COLUMN"})(n6||(n6={}));var oj={exports:{}},ij,r6;function bpe(){if(r6)return ij;r6=1;var e=1e3,t=e*60,n=t*60,r=n*24,a=r*7,o=r*365.25;ij=function(u,d){d=d||{};var p=typeof u;if(p==="string"&&u.length>0)return i(u);if(p==="number"&&isFinite(u))return d.long?c(u):s(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function i(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var p=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return p*o;case"weeks":case"week":case"w":return p*a;case"days":case"day":case"d":return p*r;case"hours":case"hour":case"hrs":case"hr":case"h":return p*n;case"minutes":case"minute":case"mins":case"min":case"m":return p*t;case"seconds":case"second":case"secs":case"sec":case"s":return p*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function s(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=n?Math.round(u/n)+"h":d>=t?Math.round(u/t)+"m":d>=e?Math.round(u/e)+"s":u+"ms"}function c(u){var d=Math.abs(u);return d>=r?l(u,d,r,"day"):d>=n?l(u,d,n,"hour"):d>=t?l(u,d,t,"minute"):d>=e?l(u,d,e,"second"):u+" ms"}function l(u,d,p,f){var m=d>=p*1.5;return Math.round(u/p)+" "+f+(m?"s":"")}return ij}var sj,a6;function wpe(){if(a6)return sj;a6=1;function e(t){r.debug=r,r.default=r,r.coerce=l,r.disable=i,r.enable=o,r.enabled=s,r.humanize=bpe(),r.destroy=u,Object.keys(t).forEach(d=>{r[d]=t[d]}),r.names=[],r.skips=[],r.formatters={};function n(d){let p=0;for(let f=0;f<d.length;f++)p=(p<<5)-p+d.charCodeAt(f),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=n;function r(d){let p,f=null,m,y;function v(...b){if(!v.enabled)return;const w=v,j=Number(new Date),x=j-(p||j);w.diff=x,w.prev=p,w.curr=j,p=j,b[0]=r.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let _=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(S,E)=>{if(S==="%%")return"%";_++;const O=r.formatters[E];if(typeof O=="function"){const N=b[_];S=O.call(w,N),b.splice(_,1),_--}return S}),r.formatArgs.call(w,b),(w.log||r.log).apply(w,b)}return v.namespace=d,v.useColors=r.useColors(),v.color=r.selectColor(d),v.extend=a,v.destroy=r.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(m!==r.namespaces&&(m=r.namespaces,y=r.enabled(d)),y),set:b=>{f=b}}),typeof r.init=="function"&&r.init(v),v}function a(d,p){const f=r(this.namespace+(typeof p>"u"?":":p)+d);return f.log=this.log,f}function o(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];let p;const f=(typeof d=="string"?d:"").split(/[\s,]+/),m=f.length;for(p=0;p<m;p++)f[p]&&(d=f[p].replace(/\*/g,".*?"),d[0]==="-"?r.skips.push(new RegExp("^"+d.slice(1)+"$")):r.names.push(new RegExp("^"+d+"$")))}function i(){const d=[...r.names.map(c),...r.skips.map(c).map(p=>"-"+p)].join(",");return r.enable(""),d}function s(d){if(d[d.length-1]==="*")return!0;let p,f;for(p=0,f=r.skips.length;p<f;p++)if(r.skips[p].test(d))return!1;for(p=0,f=r.names.length;p<f;p++)if(r.names[p].test(d))return!0;return!1}function c(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function l(d){return d instanceof Error?d.stack||d.message:d}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return sj=e,sj}var o6;function xpe(){return o6||(o6=1,function(e,t){var n={};t.formatArgs=a,t.save=o,t.load=i,t.useColors=r,t.storage=s(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let d=0,p=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(d++,f==="%c"&&(p=d))}),l.splice(p,0,u)}t.log=console.debug||console.log||(()=>{});function o(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function i(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof Sn<"u"&&"env"in Sn&&(l=n.DEBUG),l}function s(){try{return localStorage}catch{}}e.exports=wpe()(t);const{formatters:c}=e.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}(oj,oj.exports)),oj.exports}xpe(),vpe();const i6=(e,t)=>({id:e.id,type:e.node_type,position:{x:e.x||0,y:e.y||0},width:e.width||void 0,height:e.height||void 0,data:{loading:!1,flowNode:e,...t}}),_pe=e=>({id:e.id,target:e.target,source:e.target,targetHandle:e.targetHandle,sourceHandle:e.sourceHandle}),s6=e=>({id:e.id,source:e.source,target:e.target,targetHandle:e.targetHandle,sourceHandle:e.sourceHandle}),jpe=e=>e.filter(t=>"edgeId"in t?`${t.edgeId}`.startsWith("xy-edge__"):!1),cj=(e,t,n)=>{const r=[];return{changes:e.map(a=>{var c;const o=t.find(l=>a.id===l.id);o||r.push(a.id);const i=(c=n==null?void 0:n[a.source_type])==null?void 0:c.find(l=>(l==null?void 0:l.id)===a.source_id),s=i6(a,{...o==null?void 0:o.data,entity:i});return{type:o?"replace":"add",id:a.id,item:o?xm({...o||{},data:void 0},rd(s,ad)):s}}),newIds:[]}},lj=(e,t)=>{const n=[],r=[],a=e.map(o=>{const i=t.find(s=>o.source===s.source&&o.target===s.target);return!i||i.id!==o.id?(i&&r.push(i.id),{type:"add",item:s6(o)}):(n.push(o.id),{type:"replace",item:s6(o)})});return t.forEach(o=>{n.includes(o.id)||r.push(o.id)}),{changes:a,updatedIds:n,deletedIds:r}},uj={width:440,height:360},Sm={width:380,height:650},bi={[ie.Toolbox]:"toolbox",[ie.SessionInfo]:"session-info",[ie.DefaultEmbeddingModel]:"default-embedding-model",[ie.ApplicationBar]:"application-bar"},Spe={id:bi[ie.Toolbox],type:ie.Toolbox,position:{x:10+Sm.width+20,y:10},measured:uj,data:{}},Epe={id:bi[ie.SessionInfo],type:ie.SessionInfo,position:{x:10,y:10},measured:Sm,data:{}},Ope={id:bi[ie.DefaultEmbeddingModel],type:ie.DefaultEmbeddingModel,position:{x:10+Sm.width+uj.width+40,y:80},data:{model:BG}},Cpe={id:bi[ie.ApplicationBar],type:ie.ApplicationBar,position:{x:10+Sm.width+uj.width+40,y:10},data:{}},Npe=[Spe,Epe,Ope,Cpe],Mpe=[ie.Toolbox,ie.SessionInfo,ie.ApplicationBar,ie.EditorApp,ie.CodeContainerApp],c6={flowNodes:[],flowEdges:[],ready:!0,flowEdgeLoading:!1,flowNodeLoading:!1,syncedNodes:[],syncedEdges:[],syncNodeQueue:[],syncEdgeQueue:[],edges:[],nodes:Npe},Em=async e=>{const t=await ue("FlowNode").find(e),n=t.reduce((a,o)=>{var i;return a[o.source_type]||(a[o.source_type]=[]),(i=a[o.source_type])==null||i.push(o),a},{}),r={};return await Promise.all(Object.entries(n).map(async([a,o])=>{const i=a;r[i]=await ue(i).find({where:{id:Ha(o.map(s=>s.source_id))}})})),{flowNodes:t,entityGroups:n,flowNodeDatas:r}},kpe=(e,t)=>({reset:()=>{e(c6)},setNodes:n=>{if(typeof n=="function"){e({nodes:n(t().nodes)});return}e({nodes:n})},setEdges:n=>{if(typeof n=="function"){e({edges:n(t().edges)});return}e({edges:n})},updateNodes:n=>{const r=t().nodes;e({nodes:ps(n,r)})},updateEdges:n=>{const r=t().edges;e({edges:Sd(n,r)})},addConnectionToEdges:n=>{const r=t().edges;e({edges:e5(n,r)})},flowNodesToNodes:(n,r={})=>{const a=t().nodes,{changes:o}=cj(n,a,r);e({nodes:ps(o,a)})},flowEdgesToEdges:n=>{const r=t().edges,{changes:a,updatedIds:o,deletedIds:i}=lj(n,r);r.forEach(s=>{o.includes(s.id)||i.push(s.id)}),i.forEach(s=>{a.push({type:"remove",id:s})}),e({edges:Sd(a,r)})},getNodes:n=>t().nodes.filter(r=>n.includes(r.id)),removeSyncNodeQueue:n=>{const{syncNodeQueue:r}=t();for(const a of n){const o=r.findIndex(i=>i.timestamp===a);o>-1&&r.splice(o,1)}e({syncNodeQueue:r})},removeSyncEdgeQueue:n=>{const{syncEdgeQueue:r}=t();for(const a of n){const o=r.findIndex(i=>i.timestamp===a);o>-1&&r.splice(o,1)}e({syncEdgeQueue:r})},pushSyncNodeQueue:(n,r)=>{const{syncNodeQueue:a}=t();e({syncNodeQueue:[...a,{query:r,timestamp:Date.now(),syncType:n}]})},pushSyncEdgeQueue:()=>{const{syncEdgeQueue:n}=t();e({syncEdgeQueue:[...n,{timestamp:Date.now()}]})},findFlowNodesWithSource:async(n,r)=>{try{e({flowNodeLoading:!0});const{flowNodes:a,flowNodeDatas:o}=await Em(n);if(r!=null&&r.clean)e({flowNodes:a,nodes:a.map(i=>{var c;const s=(c=o==null?void 0:o[i.source_type])==null?void 0:c.find(l=>l.id===i.source_id);return i6(i,{data:s})})});else{const i=t().flowNodes,s=a.map(u=>u.id),c=t().nodes,{changes:l}=cj(a,c,o);e({flowNodes:[...i.filter(u=>!s.includes(u.id)),...a],nodes:ps(l,c)})}return a}finally{e({flowNodeLoading:!1})}},findFlowEdges:async(n,r)=>{try{e({flowEdgeLoading:!0});const a=await ue("FlowEdge").find(n),o=t().flowEdges,i=a.map(s=>s.id);if(r!=null&&r.clean)e({flowEdges:a,edges:a.map(s=>_pe(s))});else{const s=t().edges,{changes:c}=lj(a,s);e({flowEdges:[...o.filter(l=>!i.includes(l.id)),...a],edges:Sd(c,s)})}return a}finally{e({flowEdgeLoading:!1})}},deleteFlowNode:async n=>{try{if(!n.id&&!n.source_type&&!n.source_id)throw new Error("Missing flow node indentify");const r=await ue("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}});if(r){await ue("FlowNode").delete(r.id);const a=t().flowNodes;r.source_type&&r.source_id&&await ue(r.source_type).delete(r.source_id).catch(i=>{ni("Failed to delete source entity",r.source_type,r.source_id,i)});const o=t().nodes;e({flowNodes:a.filter(i=>i.id!==r.id),nodes:ps([{type:"remove",id:r.id}],o)})}}catch(r){ni("Failed to delete flow node",r)}},deleteFlowEdge:async n=>{try{if(!n.id&&!n.source&&!n.target)throw new Error("Missing flow edge indentify");const r=await ue("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}});if(r){await ue("FlowEdge").delete(r.id);const a=t().flowEdges;e({flowEdges:a.filter(o=>o.id!==r.id)})}}catch(r){ni("Failed to delete flow edge",r)}},updateFlowNode:async(n,r)=>{var a;try{if(!((a=Je.getState().currentSession)!=null&&a.id))throw new Error("Session not found");if(!n.id)throw new Error("Missing flow node indentify");await ue("FlowNode").update(n.id,n);const o=t().flowNodes.map(i=>i.id===n.id?{...i,...n}:i);e({flowNodes:r!=null&&r.silent?o:[...o]})}catch(o){ni("Failed to create or update flow node",o,n)}},createOrUpdateFlowNode:async(n,r)=>{var a;try{const o=Je.getState().currentSession;if(!(o!=null&&o.id))throw new Error("Session not found");if(!n.id&&(!n.source_type||!n.source_id))throw new Error("Missing flow node indentify");let i,s=n!=null&&n.id?t().flowNodes.find(f=>f.id===n.id):void 0;if(!s&&(n.id||n.source_type&&n.source_id)&&(s=await ue("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}})),s)i=xm(s,rd(n,ad)),r!=null&&r.lazy?ue("FlowNode").update(s.id,i):await ue("FlowNode").update(s.id,i);else if(n.source_id&&n.source_type)i={...n,source_id:`${n.source_id}`,source_type:`${n.source_type}`,node_type:n.node_type||"NEW_MESSAGE",session_id:n.session_id||(o==null?void 0:o.id)},r!=null&&r.lazy?(i.id=qi(),ue("FlowNode").save(i)):i=await ue("FlowNode").save(i);else throw new Error("Missing source id and type");let c;const l=t().nodes.find(f=>f.id===i.id);i.source_type&&!l?c=await ue(i.source_type).findOne({where:{id:n.source_id}}):i.source_type&&l&&(c=(a=l==null?void 0:l.data)==null?void 0:a.entity);const u=t().flowNodes,d=t().nodes,{changes:p}=cj([i],d,{[i.source_type]:[c]});return e({flowNodes:[...u.filter(f=>f.id!==i.id),i],nodes:ps(p,d)}),i}catch(o){ni("Failed to create or update flow node",o,n)}},createOrUpdateFlowEdge:async(n,r)=>{try{const a=Je.getState().currentSession;if(!(a!=null&&a.id))throw new Error("Session not found");if(!n.id&&(!n.source||!n.target))throw new Error("Missing flow node indentify");let o,i=n!=null&&n.id?t().flowEdges.find(l=>l.id===n.id):void 0;if(i&&(n.id||n.source&&n.target)&&(i=await ue("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}})),i)o=xm(i,rd(n,ad)),r!=null&&r.lazy?ue("FlowEdge").update(i.id,o):await ue("FlowEdge").update(i.id,o);else if(n.source&&n.target)o={...n,source:`${n.source}`,target:`${n.target}`,session_id:n.session_id||(a==null?void 0:a.id)},r!=null&&r.lazy?(o.id=qi(),ue("FlowEdge").save(o)):o=await ue("FlowEdge").save(o);else throw new Error("Missing source and target");const s=t().flowEdges,c=t().edges;return e({flowEdges:[...s.filter(l=>l.id!==o.id),o],edges:Sd(lj([o],c).changes,c)}),o}catch(a){ni("Failed to create or update flow node",a)}}}),Om=()=>{const e=co(t=>t.loadModel);return{loadModel:g.useCallback(async(t,...n)=>{switch(t){case We.WebLLM:return e(...n);default:return}},[e])}};var Ppe=Object.defineProperty,Ape=Object.defineProperties,Tpe=Object.getOwnPropertyDescriptors,Cm=Object.getOwnPropertySymbols,l6=Object.prototype.hasOwnProperty,u6=Object.prototype.propertyIsEnumerable,d6=(e,t,n)=>t in e?Ppe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ipe=(e,t)=>{for(var n in t||(t={}))l6.call(t,n)&&d6(e,n,t[n]);if(Cm)for(var n of Cm(t))u6.call(t,n)&&d6(e,n,t[n]);return e},Rpe=(e,t)=>Ape(e,Tpe(t)),Dpe=(e,t)=>{var n={};for(var r in e)l6.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Cm)for(var r of Cm(e))t.indexOf(r)<0&&u6.call(e,r)&&(n[r]=e[r]);return n};function Lpe(e){let t=setTimeout(e,0),n=setTimeout(e,10),r=setTimeout(e,50);return[t,n,r]}function $pe(e){let t=g.useRef();return g.useEffect(()=>{t.current=e}),t.current}var Fpe=18,p6=40,Bpe=`${p6}px`,zpe=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function Upe({containerRef:e,inputRef:t,pushPasswordManagerStrategy:n,isFocused:r}){let[a,o]=g.useState(!1),[i,s]=g.useState(!1),[c,l]=g.useState(!1),u=g.useMemo(()=>n==="none"?!1:(n==="increase-width"||n==="experimental-no-flickering")&&a&&i,[a,i,n]),d=g.useCallback(()=>{let p=e.current,f=t.current;if(!p||!f||c||n==="none")return;let m=p,y=m.getBoundingClientRect().left+m.offsetWidth,v=m.getBoundingClientRect().top+m.offsetHeight/2,b=y-Fpe,w=v;document.querySelectorAll(zpe).length===0&&document.elementFromPoint(b,w)===p||(o(!0),l(!0))},[e,t,c,n]);return g.useEffect(()=>{let p=e.current;if(!p||n==="none")return;function f(){let y=window.innerWidth-p.getBoundingClientRect().right;s(y>=p6)}f();let m=setInterval(f,1e3);return()=>{clearInterval(m)}},[e,n]),g.useEffect(()=>{let p=r||document.activeElement===t.current;if(n==="none"||!p)return;let f=setTimeout(d,0),m=setTimeout(d,2e3),y=setTimeout(d,5e3),v=setTimeout(()=>{l(!0)},6e3);return()=>{clearTimeout(f),clearTimeout(m),clearTimeout(y),clearTimeout(v)}},[t,r,n,d]),{hasPWMBadge:a,willPushPWMBadge:u,PWM_BADGE_SPACE_WIDTH:Bpe}}var f6=g.createContext({}),h6=g.forwardRef((e,t)=>{var n=e,{value:r,onChange:a,maxLength:o,textAlign:i="left",pattern:s,placeholder:c,inputMode:l="numeric",onComplete:u,pushPasswordManagerStrategy:d="increase-width",pasteTransformer:p,containerClassName:f,noScriptCSSFallback:m=Vpe,render:y,children:v}=n,b=Dpe(n,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),w,j,x,_,S;let[E,O]=g.useState(typeof b.defaultValue=="string"?b.defaultValue:""),N=r??E,M=$pe(N),k=g.useCallback(ae=>{a==null||a(ae),O(ae)},[a]),P=g.useMemo(()=>s?typeof s=="string"?new RegExp(s):s:null,[s]),A=g.useRef(null),C=g.useRef(null),I=g.useRef({value:N,onChange:k,isIOS:typeof window<"u"&&((j=(w=window==null?void 0:window.CSS)==null?void 0:w.supports)==null?void 0:j.call(w,"-webkit-touch-callout","none"))}),T=g.useRef({prev:[(x=A.current)==null?void 0:x.selectionStart,(_=A.current)==null?void 0:_.selectionEnd,(S=A.current)==null?void 0:S.selectionDirection]});g.useImperativeHandle(t,()=>A.current,[]),g.useEffect(()=>{let ae=A.current,de=C.current;if(!ae||!de)return;I.current.value!==ae.value&&I.current.onChange(ae.value),T.current.prev=[ae.selectionStart,ae.selectionEnd,ae.selectionDirection];function je(){if(document.activeElement!==ae){$(null),F(null);return}let Se=ae.selectionStart,Ve=ae.selectionEnd,He=ae.selectionDirection,Ke=ae.maxLength,It=ae.value,lt=T.current.prev,ot=-1,_t=-1,Qt;if(It.length!==0&&Se!==null&&Ve!==null){let io=Se===Ve,J=Se===It.length&&It.length<Ke;if(io&&!J){let te=Se;if(te===0)ot=0,_t=1,Qt="forward";else if(te===Ke)ot=te-1,_t=te,Qt="backward";else if(Ke>1&&It.length>1){let ce=0;if(lt[0]!==null&&lt[1]!==null){Qt=te<lt[1]?"backward":"forward";let me=lt[0]===lt[1]&&lt[0]<Ke;Qt==="backward"&&!me&&(ce=-1)}ot=ce+te,_t=ce+te+1}}ot!==-1&&_t!==-1&&ot!==_t&&A.current.setSelectionRange(ot,_t,Qt)}let ir=ot!==-1?ot:Se,oo=_t!==-1?_t:Ve,sr=Qt??He;$(ir),F(oo),T.current.prev=[ir,oo,sr]}if(document.addEventListener("selectionchange",je,{capture:!0}),je(),document.activeElement===ae&&z(!0),!document.getElementById("input-otp-style")){let Se=document.createElement("style");if(Se.id="input-otp-style",document.head.appendChild(Se),Se.sheet){let Ve="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";Nd(Se.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),Nd(Se.sheet,`[data-input-otp]:autofill { ${Ve} }`),Nd(Se.sheet,`[data-input-otp]:-webkit-autofill { ${Ve} }`),Nd(Se.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),Nd(Se.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let Le=()=>{de&&de.style.setProperty("--root-height",`${ae.clientHeight}px`)};Le();let $e=new ResizeObserver(Le);return $e.observe(ae),()=>{document.removeEventListener("selectionchange",je,{capture:!0}),$e.disconnect()}},[]);let[R,L]=g.useState(!1),[D,z]=g.useState(!1),[B,$]=g.useState(null),[U,F]=g.useState(null);g.useEffect(()=>{Lpe(()=>{var ae,de,je,Le;(ae=A.current)==null||ae.dispatchEvent(new Event("input"));let $e=(de=A.current)==null?void 0:de.selectionStart,Se=(je=A.current)==null?void 0:je.selectionEnd,Ve=(Le=A.current)==null?void 0:Le.selectionDirection;$e!==null&&Se!==null&&($($e),F(Se),T.current.prev=[$e,Se,Ve])})},[N,D]),g.useEffect(()=>{M!==void 0&&N!==M&&M.length<o&&N.length===o&&(u==null||u(N))},[o,u,M,N]);let H=Upe({containerRef:C,inputRef:A,pushPasswordManagerStrategy:d,isFocused:D}),re=g.useCallback(ae=>{let de=ae.currentTarget.value.slice(0,o);if(de.length>0&&P&&!P.test(de)){ae.preventDefault();return}typeof M=="string"&&de.length<M.length&&document.dispatchEvent(new Event("selectionchange")),k(de)},[o,k,M,P]),ee=g.useCallback(()=>{var ae;if(A.current){let de=Math.min(A.current.value.length,o-1),je=A.current.value.length;(ae=A.current)==null||ae.setSelectionRange(de,je),$(de),F(je)}z(!0)},[o]),G=g.useCallback(ae=>{var de,je;let Le=A.current;if(!p&&(!I.current.isIOS||!ae.clipboardData||!Le))return;let $e=ae.clipboardData.getData("text/plain"),Se=p?p($e):$e;ae.preventDefault();let Ve=(de=A.current)==null?void 0:de.selectionStart,He=(je=A.current)==null?void 0:je.selectionEnd,Ke=(Ve!==He?N.slice(0,Ve)+Se+N.slice(He):N.slice(0,Ve)+Se+N.slice(Ve)).slice(0,o);if(Ke.length>0&&P&&!P.test(Ke))return;Le.value=Ke,k(Ke);let It=Math.min(Ke.length,o-1),lt=Ke.length;Le.setSelectionRange(It,lt),$(It),F(lt)},[o,k,P,N]),K=g.useMemo(()=>({position:"relative",cursor:b.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[b.disabled]),X=g.useMemo(()=>({position:"absolute",inset:0,width:H.willPushPWMBadge?`calc(100% + ${H.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:H.willPushPWMBadge?`inset(0 ${H.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:i,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[H.PWM_BADGE_SPACE_WIDTH,H.willPushPWMBadge,i]),ne=g.useMemo(()=>g.createElement("input",Rpe(Ipe({autoComplete:b.autoComplete||"one-time-code"},b),{"data-input-otp":!0,"data-input-otp-placeholder-shown":N.length===0||void 0,"data-input-otp-mss":B,"data-input-otp-mse":U,inputMode:l,pattern:P==null?void 0:P.source,"aria-placeholder":c,style:X,maxLength:o,value:N,ref:A,onPaste:ae=>{var de;G(ae),(de=b.onPaste)==null||de.call(b,ae)},onChange:re,onMouseOver:ae=>{var de;L(!0),(de=b.onMouseOver)==null||de.call(b,ae)},onMouseLeave:ae=>{var de;L(!1),(de=b.onMouseLeave)==null||de.call(b,ae)},onFocus:ae=>{var de;ee(),(de=b.onFocus)==null||de.call(b,ae)},onBlur:ae=>{var de;z(!1),(de=b.onBlur)==null||de.call(b,ae)}})),[re,ee,G,l,X,o,U,B,b,P==null?void 0:P.source,N]),V=g.useMemo(()=>({slots:Array.from({length:o}).map((ae,de)=>{var je;let Le=D&&B!==null&&U!==null&&(B===U&&de===B||de>=B&&de<U),$e=N[de]!==void 0?N[de]:null,Se=N[0]!==void 0?null:(je=c==null?void 0:c[de])!=null?je:null;return{char:$e,placeholderChar:Se,isActive:Le,hasFakeCaret:Le&&$e===null}}),isFocused:D,isHovering:!b.disabled&&R}),[D,R,o,U,B,b.disabled,N]),le=g.useMemo(()=>y?y(V):g.createElement(f6.Provider,{value:V},v),[v,V,y]);return g.createElement(g.Fragment,null,m!==null&&g.createElement("noscript",null,g.createElement("style",null,m)),g.createElement("div",{ref:C,"data-input-otp-container":!0,style:K,className:f},le,g.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},ne)))});h6.displayName="Input";function Nd(e,t){try{e.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var Vpe=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const dj=g.forwardRef(({className:e,containerClassName:t,...n},r)=>h.jsx(h6,{ref:r,containerClassName:Z("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:Z("disabled:cursor-not-allowed",e),...n}));dj.displayName="InputOTP";const Md=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,className:Z("flex items-center",e),...t}));Md.displayName="InputOTPGroup";const wr=g.forwardRef(({index:e,className:t,hidden:n,...r},a)=>{const o=g.useContext(f6),{char:i,hasFakeCaret:s,isActive:c}=o.slots[e];return h.jsxs("div",{ref:a,className:Z("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",c&&"z-10 ring-2 ring-ring ring-offset-background",t),...r,children:[n&&i?h.jsx(YG,{}):i,s&&h.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:h.jsx("div",{className:"h-4 w-px animate-caret-blink bg-foreground duration-1000"})})]})});wr.displayName="InputOTPSlot";const pj=g.forwardRef(({...e},t)=>h.jsx("div",{ref:t,role:"separator",...e,children:h.jsx(YG,{})}));pj.displayName="InputOTPSeparator";const Nm=uo(({onConfirm:e,onCancel:t})=>{const n=tn(),{t:r}=ke("dialogs"),[a,o]=g.useState(""),i=l=>{o(l)},s=async()=>{(a==null?void 0:a.length)===6&&(await(e==null?void 0:e(a)),o(""),n.resolve(!0),n.hide())},c=async()=>{await(t==null?void 0:t()),o(""),n.resolve(!1),n.hide()};return h.jsx(fi,{open:n.visible,onOpenChange:c,children:h.jsxs(xo,{className:"w-[330px]",children:[h.jsxs(_o,{children:[h.jsx(jo,{children:r("session_passkey.title")}),h.jsx($u,{children:r("session_passkey.description")})]}),h.jsx("div",{className:"py-4",children:h.jsxs(dj,{onChange:i,maxLength:6,children:[h.jsxs(Md,{children:[h.jsx(wr,{index:0,hidden:!0}),h.jsx(wr,{index:1,hidden:!0}),h.jsx(wr,{index:2,hidden:!0})]}),h.jsx(pj,{}),h.jsxs(Md,{children:[h.jsx(wr,{index:3,hidden:!0}),h.jsx(wr,{index:4,hidden:!0}),h.jsx(wr,{index:5,hidden:!0})]})]})}),h.jsx(Lu,{children:h.jsx(Ye,{disabled:(a==null?void 0:a.length)!==6,onClick:s,type:"submit",children:r("session_passkey.confirm")})})]})})}),kd=e=>{const t=e.match(/.{1,2}/g);if(!t)throw new Error("Invalid hexString");return Uint8Array.from(t.map(n=>parseInt(n,16))).buffer},m6=e=>new TextEncoder().encode(e).buffer,qpe=async e=>{const t=m6(e);return await crypto.subtle.digest("SHA-256",t)},fj=e=>[...new Uint8Array(e)].map(t=>t.toString(16).padStart(2,"0")).join(""),Wpe=async()=>{const e=crypto.getRandomValues(new Uint8Array(32));return fj(e)},hj=async e=>{const t=await qpe(e);return fj(t)},y6=async e=>(await hj(e)).substring(0,32),mj=async(e,t)=>{const n=await hj(t),r=await y6(t),a=m6(e),o=await Hpe(a,n,r);return fj(o)},Mm=async(e,t)=>{const n=await hj(t),r=await y6(t),a=kd(e),o=await Kpe(a,n,r);return new TextDecoder().decode(o)},Hpe=async(e,t,n)=>{const r=kd(n),a=kd(t),o=await crypto.subtle.importKey("raw",a,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]);return await crypto.subtle.encrypt({name:"AES-CBC",iv:r},o,e)},Kpe=async(e,t,n)=>{const r=kd(n),a=kd(t),o=await crypto.subtle.importKey("raw",a,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]);return await crypto.subtle.decrypt({name:"AES-CBC",iv:r},o,e)},Zpe=async(e,t)=>{const n={};return await Promise.all(Object.entries(e||{}).map(async([r,a])=>{const o=await mj(a,t);n[r]=o})),n},yj=async(e,t)=>{let n;if(await new Promise((r,a)=>{t.show({onConfirm:async o=>{try{n=await Mm(e,o),await Wi.set("passphrase",n),r(!0)}catch(i){a(i)}finally{t.hide()}},onCancel:()=>{a()}})}),!n)throw new Error("Passphrase is required");return n},Pd=e=>{const t=tn(e),n=g.useRef(t);return n.current=t,{modal:t,modalRef:n}},Gpe=()=>{var E,O;const[e,t]=g.useState(),[n,r]=g.useState(),[a,o]=g.useState(),[i,s]=g.useState([]),[c,l]=g.useState(),u=g.useRef(),d=g.useRef({}),p=Je(N=>N.currentSession),{loadModel:f}=Om(),{modalRef:m}=Pd(Nm),y=g.useCallback(async N=>{var k;if(!p)return;const M=await ue("JSONData").findOne({where:{id:N.source_id,session_id:p==null?void 0:p.id}});M&&((k=u.current)==null||k.call(u,M.data?M.data:[]),l({node:N,enity:M}))},[p]),v=g.useCallback(async N=>{var T;const M=(N==null?void 0:N.sessionId)||(p==null?void 0:p.id),k=(N==null?void 0:N.threadNode)||(n==null?void 0:n.threadNode),P=(N==null?void 0:N.prompts)||(e==null?void 0:e.prompts);if(!M||!(k!=null&&k.id))return;const A=P==null?void 0:P.map(R=>{if(R.type!=="few_shot_example")switch(R.role){case"ai":case"assistant":case"tool":return{id:R.id,content:R.content,role:"assistant"};case"system":return{id:R.id,content:R.content,role:"system"};default:return{id:R.id,content:R.content,role:"user"}}}).filter(Boolean),C=await ue("JSONData").save({headers:"item",session_id:M,json:"",data:A});if(!C)return;const I=await ue("FlowNode").save({session_id:M,source_id:C.id,source_type:"JSONData",node_type:"JSON_DATA",x:0,y:0});if(I)return await ue("FlowEdge").save({session_id:M,source:k.id,target:I.id}),(T=u.current)==null||T.call(u,A),l({node:I,enity:C}),{jsonData:C,jsonDataNode:I}},[e==null?void 0:e.prompts,p==null?void 0:p.id,n==null?void 0:n.threadNode]),b=g.useCallback(async(N,M)=>{if(!p)return;const k=await ue("FlowEdge").findOne({where:{session_id:p.id,source:N.id},order:{id:"DESC"}});if(k){const P=await ue("FlowNode").findOne({where:{id:k.target,session_id:p.id}});if(!P)return;await y(P)}else if(!await v({sessionId:p.id,threadNode:N,prompts:M||[]}))return},[v,p,y]),w=g.useCallback(async N=>{if(N!=null&&N.length&&(p!=null&&p.id)){const M=(await Promise.all(N.map(async k=>ue("FlowEdge").find({where:{target:k.source.id}}).then(P=>Em({where:{session_id:p.id,id:Ha(P.map(A=>A.source))}}).then(A=>({...A,...k})))))).map(k=>{var T,R,L,D;const P=k.flowNodes.find(z=>z.source_type==="Prompt"),A=k.flowNodes.find(z=>z.source_type==="VectorDatabase");if(!A||!P)return;const C=(R=(T=k.flowNodeDatas)==null?void 0:T.Prompt)==null?void 0:R.find(z=>z.id===P.source_id),I=(D=(L=k.flowNodeDatas)==null?void 0:L.VectorDatabase)==null?void 0:D.find(z=>z.id===A.source_id);return{promptNode:P,vectorDatabaseNode:A,placeholderNode:k.source,placeholderEntity:k.entity,promptEntity:C,vectorDatabaseEntity:I}}).filter(Boolean);s(M)}},[p==null?void 0:p.id]),j=g.useCallback(async()=>{try{if(d.current.handling=p==null?void 0:p.id,!(p!=null&&p.id)||!(p!=null&&p.main_source_id)||(p==null?void 0:p.main_source_type)!=="Thread")return;const[N,M]=await Promise.all([ue("Thread").findOne({where:{id:p.main_source_id,session_id:p.id}}),ue("FlowNode").findOne({where:{id:p.main_node_id}})]);if(!N||!M)return;const k=await ue("FlowEdge").find({where:{session_id:p.id,target:M.id}}),{flowNodes:P,flowNodeDatas:A}=await Em({where:{session_id:p.id,id:Ha(k.map(B=>B.source))}}),C=(await ue("FlowEdge").find({where:{session_id:p.id}})).filter(B=>B.target===M.id).map(B=>{var U;const $=P.find(F=>F.id===B.source);return{connection:B,source:$,entity:(U=A==null?void 0:A[$.source_type])==null?void 0:U.find(F=>F.id===$.source_id)}}),I=C.find(B=>B.source.source_type==="LLM"),T=C.filter(B=>B.source.source_type==="Prompt"),R=C.find(B=>B.source.source_type==="Schema"),L=I==null?void 0:I.entity;if(!L)return;p.passphrase&&await yj(p.passphrase,m.current);const D=C.filter(B=>B.source.source_type==="FlowNodePlaceholder");await w(D),await b(M,(T==null?void 0:T.map(B=>B.entity))||[]),o({llm:L,status:L.status||et.Started,progress:""}),r({thread:N,threadNode:M});const z=R==null?void 0:R.entity;if(z){const B=await ue("SchemaItem").find({where:{schema_id:z.id}});z.schema_items=B||[]}t({prompts:(T==null?void 0:T.map(B=>B.entity))||[],schema:z}),d.current.handled=p.id}finally{d.current.handling=void 0}},[p==null?void 0:p.id,p==null?void 0:p.main_node_id,p==null?void 0:p.main_source_id,p==null?void 0:p.main_source_type,p==null?void 0:p.passphrase,w,b,m]),x=g.useCallback(async()=>{var N;if((N=a==null?void 0:a.llm)!=null&&N.name)try{o(M=>M&&{...M,status:et.Loading}),await f(a.llm.provider,a==null?void 0:a.llm.name,M=>{o(k=>k&&{...k,progress:M.text})}),o(M=>M&&{...M,status:et.Loaded,progress:""})}catch{o(M=>M&&{...M,status:et.Started,progress:""})}},[(E=a==null?void 0:a.llm)==null?void 0:E.name,(O=a==null?void 0:a.llm)==null?void 0:O.provider,f]),_=g.useCallback(N=>(u.current=N,()=>{u.current=void 0}),[]),S=g.useCallback(async N=>{!(c!=null&&c.node)||!(c!=null&&c.enity)||await ue("JSONData").save({...c.enity,data:N})},[c==null?void 0:c.enity,c==null?void 0:c.node]);return g.useEffect(()=>{d.current.handling||(d==null?void 0:d.current.handled)===(p==null?void 0:p.id)||j()},[p==null?void 0:p.id,j]),{...e,loadLLM:x,threadInfo:n,mainLLMInfo:a,retriverInfo:i,currentDataNode:c,updateMessagesData:S,addNewDataNode:v,selectDataNode:y,setLLMInfo:o,onThreadMessagesLoaded:_}};class Xpe extends yf{get lc_attributes(){return{partialVariables:void 0}}constructor(t){super(t),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:n}=t;if(n.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,t)}async mergePartialAndUserVariables(t){const n=this.partialVariables??{},r={};for(const[a,o]of Object.entries(n))typeof o=="string"?r[a]=o:r[a]=await o();return{...r,...t}}async invoke(t,n){return this._callWithConfig(r=>this.formatPromptValue(r),t,{...n,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(t){switch(t._type){case"prompt":{const{PromptTemplate:n}=await Ht(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>N6);return{PromptTemplate:r}},[]);return n.deserialize(t)}case void 0:{const{PromptTemplate:n}=await Ht(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>N6);return{PromptTemplate:r}},void 0);return n.deserialize({...t,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:n}=await Ht(async()=>{const{FewShotPromptTemplate:r}=await import("./few_shot-D6me8AwE.js").then(async a=>(await a.__tla,a));return{FewShotPromptTemplate:r}},__vite__mapDeps([0,1,2,3,4]));return n.deserialize(t)}default:throw new Error(`Invalid prompt type in config: ${t._type}`)}}}class g6 extends IDe{}class v6 extends g6{static lc_name(){return"StringPromptValue"}constructor(t){super({value:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=t}toString(){return this.value}toChatMessages(){return[new Ur(this.value)]}}class Jpe extends g6{static lc_name(){return"ChatPromptValue"}constructor(t){Array.isArray(t)&&(t={messages:t}),super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=t.messages}toString(){return RDe(this.messages)}toChatMessages(){return this.messages}}Mk=class extends Xpe{async formatPromptValue(e){const t=await this.format(e);return new v6(t)}};var Ype=Object.prototype.toString,Rc=Array.isArray||function(e){return Ype.call(e)==="[object Array]"};function gj(e){return typeof e=="function"}function Qpe(e){return Rc(e)?"array":typeof e}function vj(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function b6(e,t){return e!=null&&typeof e=="object"&&t in e}function efe(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var tfe=RegExp.prototype.test;function nfe(e,t){return tfe.call(e,t)}var rfe=/\S/;function afe(e){return!nfe(rfe,e)}var ofe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function ife(e){return String(e).replace(/[&<>"'`=\/]/g,function(t){return ofe[t]})}var sfe=/\s*/,cfe=/\s+/,w6=/\s*=/,lfe=/\s*\}/,ufe=/#|\^|\/|>|\{|&|=|!/;function dfe(e,t){if(!e)return[];var n=!1,r=[],a=[],o=[],i=!1,s=!1,c="",l=0;function u(){if(i&&!s)for(;o.length;)delete a[o.pop()];else o=[];i=!1,s=!1}var d,p,f;function m(O){if(typeof O=="string"&&(O=O.split(cfe,2)),!Rc(O)||O.length!==2)throw new Error("Invalid tags: "+O);d=new RegExp(vj(O[0])+"\\s*"),p=new RegExp("\\s*"+vj(O[1])),f=new RegExp("\\s*"+vj("}"+O[1]))}m(t||er.tags);for(var y=new Ad(e),v,b,w,j,x,_;!y.eos();){if(v=y.pos,w=y.scanUntil(d),w)for(var S=0,E=w.length;S<E;++S)j=w.charAt(S),afe(j)?(o.push(a.length),c+=j):(s=!0,n=!0,c+=" "),a.push(["text",j,v,v+1]),v+=1,j===`
`&&(u(),c="",l=0,n=!1);if(!y.scan(d))break;if(i=!0,b=y.scan(ufe)||"name",y.scan(sfe),b==="="?(w=y.scanUntil(w6),y.scan(w6),y.scanUntil(p)):b==="{"?(w=y.scanUntil(f),y.scan(lfe),y.scanUntil(p),b="&"):w=y.scanUntil(p),!y.scan(p))throw new Error("Unclosed tag at "+y.pos);if(b==">"?x=[b,w,v,y.pos,c,l,n]:x=[b,w,v,y.pos],l++,a.push(x),b==="#"||b==="^")r.push(x);else if(b==="/"){if(_=r.pop(),!_)throw new Error('Unopened section "'+w+'" at '+v);if(_[1]!==w)throw new Error('Unclosed section "'+_[1]+'" at '+v)}else b==="name"||b==="{"||b==="&"?s=!0:b==="="&&m(w)}if(u(),_=r.pop(),_)throw new Error('Unclosed section "'+_[1]+'" at '+y.pos);return ffe(pfe(a))}function pfe(e){for(var t=[],n,r,a=0,o=e.length;a<o;++a)n=e[a],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(t.push(n),r=n));return t}function ffe(e){for(var t=[],n=t,r=[],a,o,i=0,s=e.length;i<s;++i)switch(a=e[i],a[0]){case"#":case"^":n.push(a),r.push(a),n=a[4]=[];break;case"/":o=r.pop(),o[5]=a[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(a)}return t}function Ad(e){this.string=e,this.tail=e,this.pos=0}Ad.prototype.eos=function(){return this.tail===""},Ad.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},Ad.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n};function Dc(e,t){this.view=e,this.cache={".":this.view},this.parent=t}Dc.prototype.push=function(e){return new Dc(e,this)},Dc.prototype.lookup=function(e){var t=this.cache,n;if(t.hasOwnProperty(e))n=t[e];else{for(var r=this,a,o,i,s=!1;r;){if(e.indexOf(".")>0)for(a=r.view,o=e.split("."),i=0;a!=null&&i<o.length;)i===o.length-1&&(s=b6(a,o[i])||efe(a,o[i])),a=a[o[i++]];else a=r.view[e],s=b6(r.view,e);if(s){n=a;break}r=r.parent}t[e]=n}return gj(n)&&(n=n.call(this.view)),n};function Kn(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Kn.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},Kn.prototype.parse=function(e,t){var n=this.templateCache,r=e+":"+(t||er.tags).join(":"),a=typeof n<"u",o=a?n.get(r):void 0;return o==null&&(o=dfe(e,t),a&&n.set(r,o)),o},Kn.prototype.render=function(e,t,n,r){var a=this.getConfigTags(r),o=this.parse(e,a),i=t instanceof Dc?t:new Dc(t,void 0);return this.renderTokens(o,i,n,e,r)},Kn.prototype.renderTokens=function(e,t,n,r,a){for(var o="",i,s,c,l=0,u=e.length;l<u;++l)c=void 0,i=e[l],s=i[0],s==="#"?c=this.renderSection(i,t,n,r,a):s==="^"?c=this.renderInverted(i,t,n,r,a):s===">"?c=this.renderPartial(i,t,n,a):s==="&"?c=this.unescapedValue(i,t):s==="name"?c=this.escapedValue(i,t,a):s==="text"&&(c=this.rawValue(i)),c!==void 0&&(o+=c);return o},Kn.prototype.renderSection=function(e,t,n,r,a){var o=this,i="",s=t.lookup(e[1]);function c(d){return o.render(d,t,n,a)}if(s){if(Rc(s))for(var l=0,u=s.length;l<u;++l)i+=this.renderTokens(e[4],t.push(s[l]),n,r,a);else if(typeof s=="object"||typeof s=="string"||typeof s=="number")i+=this.renderTokens(e[4],t.push(s),n,r,a);else if(gj(s)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");s=s.call(t.view,r.slice(e[3],e[5]),c),s!=null&&(i+=s)}else i+=this.renderTokens(e[4],t,n,r,a);return i}},Kn.prototype.renderInverted=function(e,t,n,r,a){var o=t.lookup(e[1]);if(!o||Rc(o)&&o.length===0)return this.renderTokens(e[4],t,n,r,a)},Kn.prototype.indentPartial=function(e,t,n){for(var r=t.replace(/[^ \t]/g,""),a=e.split(`
`),o=0;o<a.length;o++)a[o].length&&(o>0||!n)&&(a[o]=r+a[o]);return a.join(`
`)},Kn.prototype.renderPartial=function(e,t,n,r){if(n){var a=this.getConfigTags(r),o=gj(n)?n(e[1]):n[e[1]];if(o!=null){var i=e[6],s=e[5],c=e[4],l=o;s==0&&c&&(l=this.indentPartial(o,c,i));var u=this.parse(l,a);return this.renderTokens(u,t,n,l,r)}}},Kn.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(n!=null)return n},Kn.prototype.escapedValue=function(e,t,n){var r=this.getConfigEscape(n)||er.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&r===er.escape?String(a):r(a)},Kn.prototype.rawValue=function(e){return e[1]},Kn.prototype.getConfigTags=function(e){return Rc(e)?e:e&&typeof e=="object"?e.tags:void 0},Kn.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Rc(e))return e.escape};var er={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){Td.templateCache=e},get templateCache(){return Td.templateCache}},Td=new Kn;er.clearCache=function(){return Td.clearCache()},er.parse=function(e,t){return Td.parse(e,t)},er.render=function(e,t,n,r){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Qpe(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Td.render(e,t,n,r)},er.escape=ife,er.Scanner=Ad,er.Context=Dc,er.Writer=Kn;function x6(){er.escape=e=>e}let bj,_6,j6,S6,E6,km,O6,C6;bj=e=>{const t=e.split(""),n=[],r=(o,i)=>{for(let s=i;s<t.length;s+=1)if(o.includes(t[s]))return s;return-1};let a=0;for(;a<t.length;)if(t[a]==="{"&&a+1<t.length&&t[a+1]==="{")n.push({type:"literal",text:"{"}),a+=2;else if(t[a]==="}"&&a+1<t.length&&t[a+1]==="}")n.push({type:"literal",text:"}"}),a+=2;else if(t[a]==="{"){const o=r("}",a);if(o<0)throw new Error("Unclosed '{' in template.");n.push({type:"variable",name:t.slice(a+1,o).join("")}),a=o+1}else{if(t[a]==="}")throw new Error("Single '}' in template.");{const o=r("{}",a),i=(o<0?t.slice(a):t.slice(a,o)).join("");n.push({type:"literal",text:i}),a=o<0?t.length:o}}return n},_6=e=>e.map(t=>t[0]==="name"?{type:"variable",name:t[1].includes(".")?t[1].split(".")[0]:t[1]}:["#","&","^",">"].includes(t[0])?{type:"variable",name:t[1]}:{type:"literal",text:t[1]}),j6=e=>{x6();const t=er.parse(e);return _6(t)},S6=(e,t)=>bj(e).reduce((n,r)=>{if(r.type==="variable"){if(r.name in t)return n+t[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return n+r.text},""),E6=(e,t)=>(x6(),er.render(e,t)),km={"f-string":S6,mustache:E6},O6={"f-string":bj,mustache:j6},Xs=(e,t,n)=>km[t](e,n),C6=(e,t)=>O6[t](e),kk=(e,t,n)=>{if(!(t in km)){const r=Object.keys(km);throw new Error(`Invalid template format. Got \`${t}\`;
                         should be one of ${r}`)}try{const r=n.reduce((a,o)=>(a[o]="foo",a),{});Array.isArray(e)?e.forEach(a=>{if(a.type==="text")Xs(a.text,t,r);else if(a.type==="image_url")if(typeof a.image_url=="string")Xs(a.image_url,t,r);else{const o=a.image_url.url;Xs(o,t,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(a,null,2)}`)}):Xs(e,t,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}},oi=class extends Mk{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),kk(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Xs(this.template,this.templateFormat,t)}static fromExamples(e,t,n,r=`

`,a=""){const o=[a,...e,t].join(r);return new oi({inputVariables:n,template:o})}static fromTemplate(e,t){const{templateFormat:n="f-string",...r}=t??{},a=new Set;return C6(e,n).forEach(o=>{o.type==="variable"&&a.add(o.name)}),new oi({inputVariables:[...a],templateFormat:n,template:e,...r})}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new oi(r)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new oi({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}};const N6=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:oi},Symbol.toStringTag,{value:"Module"})),wj="RFC3986",xj={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},hfe="RFC1738",mfe=Array.isArray,Ka=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),_j=1024,yfe=(e,t,n,r,a)=>{if(e.length===0)return e;let o=e;if(typeof e=="symbol"?o=Symbol.prototype.toString.call(e):typeof e!="string"&&(o=String(e)),n==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(s){return"%26%23"+parseInt(s.slice(2),16)+"%3B"});let i="";for(let s=0;s<o.length;s+=_j){const c=o.length>=_j?o.slice(s,s+_j):o,l=[];for(let u=0;u<c.length;++u){let d=c.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||a===hfe&&(d===40||d===41)){l[l.length]=c.charAt(u);continue}if(d<128){l[l.length]=Ka[d];continue}if(d<2048){l[l.length]=Ka[192|d>>6]+Ka[128|d&63];continue}if(d<55296||d>=57344){l[l.length]=Ka[224|d>>12]+Ka[128|d>>6&63]+Ka[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|c.charCodeAt(u)&1023),l[l.length]=Ka[240|d>>18]+Ka[128|d>>12&63]+Ka[128|d>>6&63]+Ka[128|d&63]}i+=l.join("")}return i};function gfe(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function M6(e,t){if(mfe(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const vfe=Object.prototype.hasOwnProperty,k6={brackets(e){return String(e)+"[]"},comma:"comma",indices(e,t){return String(e)+"["+t+"]"},repeat(e){return String(e)}},Za=Array.isArray,bfe=Array.prototype.push,P6=function(e,t){bfe.apply(e,Za(t)?t:[t])},wfe=Date.prototype.toISOString,pn={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:yfe,encodeValuesOnly:!1,format:wj,formatter:xj[wj],indices:!1,serializeDate(e){return wfe.call(e)},skipNulls:!1,strictNullHandling:!1};function xfe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"}const jj={};function A6(e,t,n,r,a,o,i,s,c,l,u,d,p,f,m,y,v,b){let w=e,j=b,x=0,_=!1;for(;(j=j.get(jj))!==void 0&&!_;){const M=j.get(e);if(x+=1,typeof M<"u"){if(M===x)throw new RangeError("Cyclic object value");_=!0}typeof j.get(jj)>"u"&&(x=0)}if(typeof l=="function"?w=l(t,w):w instanceof Date?w=p==null?void 0:p(w):n==="comma"&&Za(w)&&(w=M6(w,function(M){return M instanceof Date?p==null?void 0:p(M):M})),w===null){if(o)return c&&!y?c(t,pn.encoder,v,"key",f):t;w=""}if(xfe(w)||gfe(w)){if(c){const M=y?t:c(t,pn.encoder,v,"key",f);return[(m==null?void 0:m(M))+"="+(m==null?void 0:m(c(w,pn.encoder,v,"value",f)))]}return[(m==null?void 0:m(t))+"="+(m==null?void 0:m(String(w)))]}const S=[];if(typeof w>"u")return S;let E;if(n==="comma"&&Za(w))y&&c&&(w=M6(w,c)),E=[{value:w.length>0?w.join(",")||null:void 0}];else if(Za(l))E=l;else{const M=Object.keys(w);E=u?M.sort(u):M}const O=s?String(t).replace(/\./g,"%2E"):String(t),N=r&&Za(w)&&w.length===1?O+"[]":O;if(a&&Za(w)&&w.length===0)return N+"[]";for(let M=0;M<E.length;++M){const k=E[M],P=typeof k=="object"&&typeof k.value<"u"?k.value:w[k];if(i&&P===null)continue;const A=d&&s?k.replace(/\./g,"%2E"):k,C=Za(w)?typeof n=="function"?n(N,A):N:N+(d?"."+A:"["+A+"]");b.set(e,x);const I=new WeakMap;I.set(jj,b),P6(S,A6(P,C,n,r,a,o,i,s,n==="comma"&&y&&Za(w)?null:c,l,u,d,p,f,m,y,v,I))}return S}function _fe(e=pn){if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=e.charset||pn.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=wj;if(typeof e.format<"u"){if(!vfe.call(xj,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=xj[n];let a=pn.filter;(typeof e.filter=="function"||Za(e.filter))&&(a=e.filter);let o;if(e.arrayFormat&&e.arrayFormat in k6?o=e.arrayFormat:"indices"in e?o=e.indices?"indices":"repeat":o=pn.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof e.allowDots>"u"?e.encodeDotInKeys?!0:pn.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:pn.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:pn.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:pn.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?pn.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:pn.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:pn.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:pn.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:pn.encodeValuesOnly,filter:a,format:n,formatter:r,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:pn.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:pn.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:pn.strictNullHandling}}function jfe(e,t={}){let n=e;const r=_fe(t);let a,o;typeof r.filter=="function"?(o=r.filter,n=o("",n)):Za(r.filter)&&(o=r.filter,a=o);const i=[];if(typeof n!="object"||n===null)return"";const s=k6[r.arrayFormat],c=s==="comma"&&r.commaRoundTrip;a||(a=Object.keys(n)),r.sort&&a.sort(r.sort);const l=new WeakMap;for(let p=0;p<a.length;++p){const f=a[p];r.skipNulls&&n[f]===null||P6(i,A6(n[f],f,s,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const u=i.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const Lc="4.78.1";let T6=!1,Id,I6,R6,Sj,D6,L6,$6,F6,B6;function Sfe(e,t={auto:!1}){if(T6)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(Id)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${Id}'\``);T6=t.auto,Id=e.kind,I6=e.fetch,R6=e.FormData,Sj=e.File,D6=e.ReadableStream,L6=e.getMultipartRequestOptions,$6=e.getDefaultAgent,F6=e.fileFromPath,B6=e.isFsReadStream}let Efe=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Ofe({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,a,o;try{n=fetch,r=Request,a=Response,o=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:a,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(i,s)=>({...s,body:new Efe(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}Id||Sfe(Ofe(),{auto:!0});class rt extends Error{}let tr=class zk extends rt{constructor(t,n,r,a){super(`${zk.makeMessage(t,n,r)}`),this.status=t,this.headers=a,this.request_id=a==null?void 0:a["x-request-id"],this.error=n;const o=n;this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(t,n,r){const a=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,n,r,a){if(!t||!a)return new Pm({message:r,cause:Nj(n)});const o=n==null?void 0:n.error;return t===400?new z6(t,o,r,a):t===401?new U6(t,o,r,a):t===403?new V6(t,o,r,a):t===404?new q6(t,o,r,a):t===409?new W6(t,o,r,a):t===422?new H6(t,o,r,a):t===429?new K6(t,o,r,a):t>=500?new Z6(t,o,r,a):new zk(t,o,r,a)}},kr=class extends tr{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Pm=class extends tr{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Am=class extends Pm{constructor({message:e}={}){super({message:e??"Request timed out."})}},z6=class extends tr{},U6=class extends tr{},V6=class extends tr{},q6=class extends tr{},W6=class extends tr{},H6=class extends tr{},K6=class extends tr{},Z6=class extends tr{};class G6 extends rt{constructor(){super("Could not parse response content as the length limit was reached")}}class X6 extends rt{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let Tm=class Uk{constructor(){this.buffer=[],this.trailingCR=!1}decode(t){let n=this.decodeText(t);if(this.trailingCR&&(n="\r"+n,this.trailingCR=!1),n.endsWith("\r")&&(this.trailingCR=!0,n=n.slice(0,-1)),!n)return[];const r=Uk.NEWLINE_CHARS.has(n[n.length-1]||"");let a=n.split(Uk.NEWLINE_REGEXP);return r&&a.pop(),a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof jn<"u"){if(t instanceof jn)return t.toString();if(t instanceof Uint8Array)return jn.from(t).toString();throw new rt(`Unexpected: received non-Uint8Array (${t.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(t instanceof Uint8Array||t instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(t);throw new rt(`Unexpected: received non-Uint8Array/ArrayBuffer (${t.constructor.name}) in a web platform. Please report this error.`)}throw new rt("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const t=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,t}};Tm.NEWLINE_CHARS=new Set([`
`,"\r"]),Tm.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let Rd=class Of{constructor(t,n){this.iterator=t,this.controller=n}static fromSSEResponse(t,n){let r=!1;async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const i of Cfe(t,n))if(!o){if(i.data.startsWith("[DONE]")){o=!0;continue}if(i.event===null){let s;try{s=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(s&&s.error)throw new tr(void 0,s.error,void 0,void 0);yield s}else{let s;try{s=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new tr(void 0,s.error,s.message,void 0);yield{event:i.event,data:s}}}o=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{o||n.abort()}}return new Of(a,n)}static fromReadableStream(t,n){let r=!1;async function*a(){const i=new Tm,s=J6(t);for await(const c of s)for(const l of i.decode(c))yield l;for(const c of i.flush())yield c}async function*o(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const s of a())i||s&&(yield JSON.parse(s));i=!0}catch(s){if(s instanceof Error&&s.name==="AbortError")return;throw s}finally{i||n.abort()}}return new Of(o,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),a=o=>({next:()=>{if(o.length===0){const i=r.next();t.push(i),n.push(i)}return o.shift()}});return[new Of(()=>a(t),this.controller),new Of(()=>a(n),this.controller)]}toReadableStream(){const t=this;let n;const r=new TextEncoder;return new D6({async start(){n=t[Symbol.asyncIterator]()},async pull(a){try{const{value:o,done:i}=await n.next();if(i)return a.close();const s=r.encode(JSON.stringify(o)+`
`);a.enqueue(s)}catch(o){a.error(o)}},async cancel(){var a;await((a=n.return)==null?void 0:a.call(n))}})}};async function*Cfe(e,t){if(!e.body)throw t.abort(),new rt("Attempted to iterate over a response with no body");const n=new kfe,r=new Tm,a=J6(e.body);for await(const o of Nfe(a))for(const i of r.decode(o)){const s=n.decode(i);s&&(yield s)}for(const o of r.flush()){const i=n.decode(o);i&&(yield i)}}async function*Nfe(e){let t=new Uint8Array;for await(const n of e){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let a=new Uint8Array(t.length+r.length);a.set(t),a.set(r,t.length),t=a;let o;for(;(o=Mfe(t))!==-1;)yield t.slice(0,o),t=t.slice(o)}t.length>0&&(yield t)}function Mfe(e){for(let t=0;t<e.length-2;t++){if(e[t]===10&&e[t+1]===10||e[t]===13&&e[t+1]===13)return t+2;if(e[t]===13&&e[t+1]===10&&t+3<e.length&&e[t+2]===13&&e[t+3]===10)return t+4}return-1}let kfe=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=Pfe(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}};function Pfe(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}function J6(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Y6=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function",Q6=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&Im(e),Im=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",Afe=e=>Q6(e)||Y6(e)||B6(e);async function e$(e,t,n){var a;if(e=await e,Q6(e))return e;if(Y6(e)){const o=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=Im(o)?[await o.arrayBuffer()]:[o];return new Sj(i,t,n)}const r=await Tfe(e);if(t||(t=Rfe(e)??"unknown_file"),!(n!=null&&n.type)){const o=(a=r[0])==null?void 0:a.type;typeof o=="string"&&(n={...n,type:o})}return new Sj(r,t,n)}async function Tfe(e){var n;let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Im(e))t.push(await e.arrayBuffer());else if(Dfe(e))for await(const r of e)t.push(r);else throw new Error(`Unexpected data type: ${typeof e}; constructor: ${(n=e==null?void 0:e.constructor)==null?void 0:n.name}; props: ${Ife(e)}`);return t}function Ife(e){return`[${Object.getOwnPropertyNames(e).map(t=>`"${t}"`).join(", ")}]`}function Rfe(e){var t;return Ej(e.name)||Ej(e.filename)||((t=Ej(e.path))==null?void 0:t.split(/[\\/]/).pop())}const Ej=e=>{if(typeof e=="string")return e;if(typeof jn<"u"&&e instanceof jn)return String(e)},Dfe=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function",t$=e=>e&&typeof e=="object"&&e.body&&e[Symbol.toStringTag]==="MultipartBody",$c=async e=>{const t=await Lfe(e.body);return L6(t,e)},Lfe=async e=>{const t=new R6;return await Promise.all(Object.entries(e||{}).map(([n,r])=>Oj(t,n,r))),t},Oj=async(e,t,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")e.append(t,String(n));else if(Afe(n)){const r=await e$(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>Oj(e,t+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,a])=>Oj(e,`${t}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var Fc={},$fe=function(e,t,n,r,a){if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n},Ffe=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Rm;async function n$(e){const{response:t}=e;if(e.options.stream)return Bc("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Rd.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n!=null&&n.includes("application/json")||n!=null&&n.includes("application/vnd.api+json")){const a=await t.json();return Bc("response",t.status,t.url,t.headers,a),r$(a,t)}const r=await t.text();return Bc("response",t.status,t.url,t.headers,r),r}function r$(e,t){return!e||typeof e!="object"||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}let a$=class sX extends Promise{constructor(t,n=n$){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n}_thenUnwrap(t){return new sX(this.responsePromise,async n=>r$(t(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}},Bfe=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:a}){this.baseURL=e,this.maxRetries=Cj("maxRetries",t),this.timeout=Cj("timeout",n),this.httpAgent=r,this.fetch=a??I6}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Hfe(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Xfe()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async r=>{const a=r&&Im(r==null?void 0:r.body)?new DataView(await r.body.arrayBuffer()):(r==null?void 0:r.body)instanceof DataView?r.body:(r==null?void 0:r.body)instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r==null?void 0:r.body)?new DataView(r.body.buffer):r==null?void 0:r.body;return{method:e,path:t,...r,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof jn<"u")return jn.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var f;const{method:n,path:r,query:a,headers:o={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:t$(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,s=this.calculateContentLength(i),c=this.buildURL(r,a);"timeout"in e&&Cj("timeout",e.timeout);const l=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??$6(c),d=l+1e3;typeof((f=u==null?void 0:u.options)==null?void 0:f.timeout)=="number"&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:o,contentLength:s,retryCount:t});return{req:{method:n,...i&&{body:i},headers:p,...u&&{agent:u},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const a={};n&&(a["content-length"]=n);const o=this.defaultHeaders(e);return d$(a,o),d$(a,t),t$(e.body)&&Id!=="node"&&delete a["content-type"],p$(o,"x-stainless-retry-count")===void 0&&p$(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(r)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,r){return tr.generate(e,t,n,r)}request(e,t=null){return new a$(this.makeRequest(e,t))}async makeRequest(e,t){var u,d;const n=await e,r=n.maxRetries??this.maxRetries;t==null&&(t=r),await this.prepareOptions(n);const{req:a,url:o,timeout:i}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(a,{url:o,options:n}),Bc("request",o,n,a.headers),(u=n.signal)==null?void 0:u.aborted)throw new kr;const s=new AbortController,c=await this.fetchWithTimeout(o,a,i,s).catch(Nj);if(c instanceof Error){if((d=n.signal)!=null&&d.aborted)throw new kr;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new Am:new Pm({cause:c})}const l=Ufe(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const y=`retrying, ${t} attempts remaining`;return Bc(`response (error; ${y})`,c.status,o,l),this.retryRequest(n,t,l)}const p=await c.text().catch(y=>Nj(y).message),f=Kfe(p),m=f?void 0:p;throw Bc(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,l,m),this.makeStatusError(c.status,f,m,l)}return{response:c,options:n,controller:s}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new zfe(this,n,e)}buildURL(e,t){const n=Gfe(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return l$(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new rt(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:a,...o}=t||{};a&&a.addEventListener("abort",()=>r.abort());const i=setTimeout(()=>r.abort(),n),s={signal:r.signal,...o};return s.method&&(s.method=s.method.toUpperCase()),this.fetch.call(void 0,e,s).finally(()=>{clearTimeout(i)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let r;const a=n==null?void 0:n["retry-after-ms"];if(a){const i=parseFloat(a);Number.isNaN(i)||(r=i)}const o=n==null?void 0:n["retry-after"];if(o&&!r){const i=parseFloat(o);Number.isNaN(i)?r=Date.parse(o)-Date.now():r=i*1e3}if(!(r&&0<=r&&r<60*1e3)){const i=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,i)}return await Dd(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e,r=Math.min(.5*Math.pow(2,n),8),a=1-Math.random()*.25;return r*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Lc}`}};class o${constructor(t,n,r,a){Rm.set(this,void 0),$fe(this,Rm,t),this.options=a,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const t=this.nextPageInfo();if(!t)throw new rt("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in t&&typeof n.query=="object")n.query={...n.query,...t.params};else if("url"in t){const r=[...Object.entries(n.query||{}),...t.url.searchParams.entries()];for(const[a,o]of r)t.url.searchParams.set(a,o);n.query=void 0,n.path=t.url.toString()}return await Ffe(this,Rm,"f").requestAPIList(this.constructor,n)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(Rm=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const n of t.getPaginatedItems())yield n}}let zfe=class extends a${constructor(e,t,n){super(t,async r=>new n(e,r.response,await n$(r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const Ufe=e=>new Proxy(Object.fromEntries(e.entries()),{get(t,n){const r=n.toString();return t[r.toLowerCase()]||t[r]}}),Vfe={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},nr=e=>typeof e=="object"&&e!==null&&!l$(e)&&Object.keys(e).every(t=>u$(Vfe,t)),qfe=()=>{var t;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lc,"X-Stainless-OS":s$(Deno.build.os),"X-Stainless-Arch":i$(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":Sn.version};if(Object.prototype.toString.call(typeof Sn<"u"?Sn:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lc,"X-Stainless-OS":s$(Sn.platform),"X-Stainless-Arch":i$(Sn.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":Sn.version};const e=Wfe();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Wfe(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const a=r[1]||0,o=r[2]||0,i=r[3]||0;return{browser:t,version:`${a}.${o}.${i}`}}}return null}const i$=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",s$=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let c$;const Hfe=()=>c$??(c$=qfe()),Kfe=e=>{try{return JSON.parse(e)}catch{return}},Zfe=/^[a-z][a-z0-9+.-]*:/i,Gfe=e=>Zfe.test(e),Dd=e=>new Promise(t=>setTimeout(t,e)),Cj=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new rt(`${e} must be an integer`);if(t<0)throw new rt(`${e} must be a positive integer`);return t},Nj=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},Dm=e=>{var t,n,r,a;if(typeof Sn<"u")return((t=Fc==null?void 0:Fc[e])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(a=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,e))==null?void 0:a.trim()};function l$(e){if(!e)return!0;for(const t in e)return!1;return!0}function u$(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d$(e,t){for(const n in t){if(!u$(t,n))continue;const r=n.toLowerCase();if(!r)continue;const a=t[n];a===null?delete e[r]:a!==void 0&&(e[r]=a)}}function Bc(e,...t){typeof Sn<"u"&&(Fc==null?void 0:Fc.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${e}`,...t)}const Xfe=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),Jfe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Yfe=e=>typeof(e==null?void 0:e.get)=="function",p$=(e,t)=>{var r;const n=t.toLowerCase();if(Yfe(e)){const a=((r=t[0])==null?void 0:r.toUpperCase())+t.substring(1).replace(/([^\w])(\w)/g,(o,i,s)=>i+s.toUpperCase());for(const o of[t,n,t.toUpperCase(),a]){const i=e.get(o);if(i)return i}}for(const[a,o]of Object.entries(e))if(a.toLowerCase()===n)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${t} header, using the first entry.`),o[0]):o};function Mj(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}class Qfe extends o${constructor(t,n,r,a){super(t,n,r,a),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class oa extends o${constructor(t,n,r,a){super(t,n,r,a),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const t=this.nextPageInfo();if(!t)return null;if("params"in t)return t.params;const n=Object.fromEntries(t.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;const t=this.getPaginatedItems();if(!t.length)return null;const n=(r=t[t.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}}let mt=class{constructor(e){this._client=e}},f$=class extends mt{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},kj=class extends mt{constructor(){super(...arguments),this.completions=new f$(this._client)}};kj.Completions=f$;class h$ extends mt{create(t,n){return this._client.post("/audio/speech",{body:t,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}let m$=class extends mt{create(e,t){return this._client.post("/audio/transcriptions",$c({body:e,...t}))}},y$=class extends mt{create(e,t){return this._client.post("/audio/translations",$c({body:e,...t}))}},Ld=class extends mt{constructor(){super(...arguments),this.transcriptions=new m$(this._client),this.translations=new y$(this._client),this.speech=new h$(this._client)}};Ld.Transcriptions=m$,Ld.Translations=y$,Ld.Speech=h$;class Pj extends mt{create(t,n){return this._client.post("/batches",{body:t,...n})}retrieve(t,n){return this._client.get(`/batches/${t}`,n)}list(t={},n){return nr(t)?this.list({},t):this._client.getAPIList("/batches",Aj,{query:t,...n})}cancel(t,n){return this._client.post(`/batches/${t}/cancel`,n)}}class Aj extends oa{}Pj.BatchesPage=Aj;class Tj extends mt{create(t,n){return this._client.post("/assistants",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/assistants/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/assistants/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(t={},n){return nr(t)?this.list({},t):this._client.getAPIList("/assistants",Ij,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,n){return this._client.delete(`/assistants/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Ij extends oa{}Tj.AssistantsPage=Ij;function g$(e){return typeof e.parse=="function"}const zc=e=>(e==null?void 0:e.role)==="assistant",v$=e=>(e==null?void 0:e.role)==="function",b$=e=>(e==null?void 0:e.role)==="tool";var ia=function(e,t,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(e,n):a?a.value=n:t.set(e,n),n},Zt=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Rj,Lm,$m,$d,Fd,Fm,Bd,$o,zd,Bm,zm,Uc,w$;class x${constructor(){Rj.add(this),this.controller=new AbortController,Lm.set(this,void 0),$m.set(this,()=>{}),$d.set(this,()=>{}),Fd.set(this,void 0),Fm.set(this,()=>{}),Bd.set(this,()=>{}),$o.set(this,{}),zd.set(this,!1),Bm.set(this,!1),zm.set(this,!1),Uc.set(this,!1),ia(this,Lm,new Promise((t,n)=>{ia(this,$m,t,"f"),ia(this,$d,n,"f")}),"f"),ia(this,Fd,new Promise((t,n)=>{ia(this,Fm,t,"f"),ia(this,Bd,n,"f")}),"f"),Zt(this,Lm,"f").catch(()=>{}),Zt(this,Fd,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},Zt(this,Rj,"m",w$).bind(this))},0)}_connected(){this.ended||(Zt(this,$m,"f").call(this),this._emit("connect"))}get ended(){return Zt(this,zd,"f")}get errored(){return Zt(this,Bm,"f")}get aborted(){return Zt(this,zm,"f")}abort(){this.controller.abort()}on(t,n){return(Zt(this,$o,"f")[t]||(Zt(this,$o,"f")[t]=[])).push({listener:n}),this}off(t,n){const r=Zt(this,$o,"f")[t];if(!r)return this;const a=r.findIndex(o=>o.listener===n);return a>=0&&r.splice(a,1),this}once(t,n){return(Zt(this,$o,"f")[t]||(Zt(this,$o,"f")[t]=[])).push({listener:n,once:!0}),this}emitted(t){return new Promise((n,r)=>{ia(this,Uc,!0,"f"),t!=="error"&&this.once("error",r),this.once(t,n)})}async done(){ia(this,Uc,!0,"f"),await Zt(this,Fd,"f")}_emit(t,...n){if(Zt(this,zd,"f"))return;t==="end"&&(ia(this,zd,!0,"f"),Zt(this,Fm,"f").call(this));const r=Zt(this,$o,"f")[t];if(r&&(Zt(this,$o,"f")[t]=r.filter(a=>!a.once),r.forEach(({listener:a})=>a(...n))),t==="abort"){const a=n[0];!Zt(this,Uc,"f")&&!(r!=null&&r.length)&&Promise.reject(a),Zt(this,$d,"f").call(this,a),Zt(this,Bd,"f").call(this,a),this._emit("end");return}if(t==="error"){const a=n[0];!Zt(this,Uc,"f")&&!(r!=null&&r.length)&&Promise.reject(a),Zt(this,$d,"f").call(this,a),Zt(this,Bd,"f").call(this,a),this._emit("end")}}_emitFinal(){}}Lm=new WeakMap,$m=new WeakMap,$d=new WeakMap,Fd=new WeakMap,Fm=new WeakMap,Bd=new WeakMap,$o=new WeakMap,zd=new WeakMap,Bm=new WeakMap,zm=new WeakMap,Uc=new WeakMap,Rj=new WeakSet,w$=function(e){if(ia(this,Bm,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new kr),e instanceof kr)return ia(this,zm,!0,"f"),this._emit("abort",e);if(e instanceof rt)return this._emit("error",e);if(e instanceof Error){const t=new rt(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new rt(String(e)))};function ehe(e,t){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),n}function _$(e){return(e==null?void 0:e.$brand)==="auto-parseable-response-format"}function the(e,{parser:t,callback:n}){const r={...e};return Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:t,enumerable:!1},$callback:{value:n,enumerable:!1}}),r}function Ud(e){return(e==null?void 0:e.$brand)==="auto-parseable-tool"}function nhe(e,t){return!t||!j$(t)?{...e,choices:e.choices.map(n=>({...n,message:{...n.message,parsed:null,tool_calls:n.message.tool_calls??[]}}))}:Dj(e,t)}function Dj(e,t){const n=e.choices.map(r=>{var a;if(r.finish_reason==="length")throw new G6;if(r.finish_reason==="content_filter")throw new X6;return{...r,message:{...r.message,tool_calls:((a=r.message.tool_calls)==null?void 0:a.map(o=>ahe(t,o)))??[],parsed:r.message.content&&!r.message.refusal?rhe(t,r.message.content):null}}});return{...e,choices:n}}function rhe(e,t){var n,r;return((n=e.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=e.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function ahe(e,t){var r;const n=(r=e.tools)==null?void 0:r.find(a=>{var o;return((o=a.function)==null?void 0:o.name)===t.function.name});return{...t,function:{...t.function,parsed_arguments:Ud(n)?n.$parseRaw(t.function.arguments):n!=null&&n.function.strict?JSON.parse(t.function.arguments):null}}}function ohe(e,t){var r;if(!e)return!1;const n=(r=e.tools)==null?void 0:r.find(a=>{var o;return((o=a.function)==null?void 0:o.name)===t.function.name});return Ud(n)||(n==null?void 0:n.function.strict)||!1}function j$(e){var t;return _$(e.response_format)?!0:((t=e.tools)==null?void 0:t.some(n=>Ud(n)||n.type==="function"&&n.function.strict===!0))??!1}function ihe(e){for(const t of e??[]){if(t.type!=="function")throw new rt(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new rt(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var rr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Dn,Lj,Um,$j,Fj,Bj,S$,zj;const E$=10;class O$ extends x${constructor(){super(...arguments),Dn.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){var r;this._chatCompletions.push(t),this._emit("chatCompletion",t);const n=(r=t.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),t}_addMessage(t,n=!0){if("content"in t||(t.content=null),this.messages.push(t),n){if(this._emit("message",t),(v$(t)||b$(t))&&t.content)this._emit("functionCallResult",t.content);else if(zc(t)&&t.function_call)this._emit("functionCall",t.function_call);else if(zc(t)&&t.tool_calls)for(const r of t.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new rt("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),rr(this,Dn,"m",Lj).call(this)}async finalMessage(){return await this.done(),rr(this,Dn,"m",Um).call(this)}async finalFunctionCall(){return await this.done(),rr(this,Dn,"m",$j).call(this)}async finalFunctionCallResult(){return await this.done(),rr(this,Dn,"m",Fj).call(this)}async totalUsage(){return await this.done(),rr(this,Dn,"m",Bj).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const n=rr(this,Dn,"m",Um).call(this);n&&this._emit("finalMessage",n);const r=rr(this,Dn,"m",Lj).call(this);r&&this._emit("finalContent",r);const a=rr(this,Dn,"m",$j).call(this);a&&this._emit("finalFunctionCall",a);const o=rr(this,Dn,"m",Fj).call(this);o!=null&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",rr(this,Dn,"m",Bj).call(this))}async _createChatCompletion(t,n,r){const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),rr(this,Dn,"m",S$).call(this,n);const o=await t.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Dj(o,n))}async _runChatCompletion(t,n,r){for(const a of n.messages)this._addMessage(a,!1);return await this._createChatCompletion(t,n,r)}async _runFunctions(t,n,r){var p;const a="function",{function_call:o="auto",stream:i,...s}=n,c=typeof o!="string"&&(o==null?void 0:o.name),{maxChatCompletions:l=E$}=r||{},u={};for(const f of n.functions)u[f.name||f.function.name]=f;const d=n.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of n.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){const m=(p=(await this._createChatCompletion(t,{...s,function_call:o,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:p.message;if(!m)throw new rt("missing message in ChatCompletion response");if(!m.function_call)return;const{name:y,arguments:v}=m.function_call,b=u[y];if(b){if(c&&c!==y){const _=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:a,name:y,content:_});continue}}else{const _=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${d.map(S=>JSON.stringify(S.name)).join(", ")}. Please try again`;this._addMessage({role:a,name:y,content:_});continue}let w;try{w=g$(b)?await b.parse(v):v}catch(_){this._addMessage({role:a,name:y,content:_ instanceof Error?_.message:String(_)});continue}const j=await b.function(w,this),x=rr(this,Dn,"m",zj).call(this,j);if(this._addMessage({role:a,name:y,content:x}),c)return}}async _runTools(t,n,r){var f,m,y;const a="tool",{tool_choice:o="auto",stream:i,...s}=n,c=typeof o!="string"&&((f=o==null?void 0:o.function)==null?void 0:f.name),{maxChatCompletions:l=E$}=r||{},u=n.tools.map(v=>{if(Ud(v)){if(!v.$callback)throw new rt("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),d={};for(const v of u)v.type==="function"&&(d[v.function.name||v.function.function.name]=v.function);const p="tools"in n?u.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of n.messages)this._addMessage(v,!1);for(let v=0;v<l;++v){const b=(m=(await this._createChatCompletion(t,{...s,tool_choice:o,tools:p,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!b)throw new rt("missing message in ChatCompletion response");if(!((y=b.tool_calls)!=null&&y.length))return;for(const w of b.tool_calls){if(w.type!=="function")continue;const j=w.id,{name:x,arguments:_}=w.function,S=d[x];if(S){if(c&&c!==x){const M=`Invalid tool_call: ${JSON.stringify(x)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:a,tool_call_id:j,content:M});continue}}else{const M=`Invalid tool_call: ${JSON.stringify(x)}. Available options are: ${Object.keys(d).map(k=>JSON.stringify(k)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:j,content:M});continue}let E;try{E=g$(S)?await S.parse(_):_}catch(M){const k=M instanceof Error?M.message:String(M);this._addMessage({role:a,tool_call_id:j,content:k});continue}const O=await S.function(E,this),N=rr(this,Dn,"m",zj).call(this,O);if(this._addMessage({role:a,tool_call_id:j,content:N}),c)return}}}}Dn=new WeakSet,Lj=function(){return rr(this,Dn,"m",Um).call(this).content??null},Um=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(zc(t)){const{function_call:n,...r}=t,a={...r,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new rt("stream ended without producing a ChatCompletionMessage with role=assistant")},$j=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(zc(r)&&(r!=null&&r.function_call))return r.function_call;if(zc(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},Fj=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(v$(t)&&t.content!=null||b$(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Bj=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},S$=function(e){if(e.n!=null&&e.n>1)throw new rt("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},zj=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Vd extends O${static runFunctions(t,n,r){const a=new Vd,o={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(t,n,o)),a}static runTools(t,n,r){const a=new Vd,o={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(t,n,o)),a}_addMessage(t,n=!0){super._addMessage(t,n),zc(t)&&t.content&&this._emit("content",t.content)}}const C$=1,N$=2,M$=4,k$=8,P$=16,A$=32,T$=64,I$=128,R$=256,D$=I$|R$,L$=P$|A$|D$|T$,$$=C$|N$|L$,F$=M$|k$,she=$$|F$,gn={STR:C$,NUM:N$,ARR:M$,OBJ:k$,NULL:P$,BOOL:A$,NAN:T$,INFINITY:I$,MINUS_INFINITY:R$,INF:D$,SPECIAL:L$,ATOM:$$,COLLECTION:F$,ALL:she};class che extends Error{}class lhe extends Error{}function uhe(e,t=gn.ALL){if(typeof e!="string")throw new TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw new Error(`${e} is empty`);return dhe(e.trim(),t)}const dhe=(e,t)=>{const n=e.length;let r=0;const a=p=>{throw new che(`${p} at position ${r}`)},o=p=>{throw new lhe(`${p} at position ${r}`)},i=()=>(d(),r>=n&&a("Unexpected end of input"),e[r]==='"'?s():e[r]==="{"?c():e[r]==="["?l():e.substring(r,r+4)==="null"||gn.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)==="true"||gn.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)==="false"||gn.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)==="Infinity"||gn.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)==="-Infinity"||gn.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)==="NaN"||gn.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),s=()=>{const p=r;let f=!1;for(r++;r<n&&(e[r]!=='"'||f&&e[r-1]==="\\");)f=e[r]==="\\"?!f:!1,r++;if(e.charAt(r)=='"')try{return JSON.parse(e.substring(p,++r-Number(f)))}catch(m){o(String(m))}else if(gn.STR&t)try{return JSON.parse(e.substring(p,r-Number(f))+'"')}catch{return JSON.parse(e.substring(p,e.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},c=()=>{r++,d();const p={};try{for(;e[r]!=="}";){if(d(),r>=n&&gn.OBJ&t)return p;const f=s();d(),r++;try{const m=i();Object.defineProperty(p,f,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(gn.OBJ&t)return p;throw m}d(),e[r]===","&&r++}}catch{if(gn.OBJ&t)return p;a("Expected '}' at end of object")}return r++,p},l=()=>{r++;const p=[];try{for(;e[r]!=="]";)p.push(i()),d(),e[r]===","&&r++}catch{if(gn.ARR&t)return p;a("Expected ']' at end of array")}return r++,p},u=()=>{if(r===0){e==="-"&&gn.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(e)}catch(f){if(gn.NUM&t)try{return e[e.length-1]==="."?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch{}o(String(f))}}const p=r;for(e[r]==="-"&&r++;e[r]&&!",]}".includes(e[r]);)r++;r==n&&!(gn.NUM&t)&&a("Unterminated number literal");try{return JSON.parse(e.substring(p,r))}catch{e.substring(p,r)==="-"&&gn.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(e.substring(p,e.lastIndexOf("e")))}catch(f){o(String(f))}}},d=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return i()},B$=e=>uhe(e,gn.ALL^gn.NUM);var Vc=function(e,t,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(e,n):a?a.value=n:t.set(e,n),n},kt=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},fn,Fo,qc,wi,Uj,Vm,Vj,qj,Wj,qm,Hj,z$;class qd extends O${constructor(t){super(),fn.add(this),Fo.set(this,void 0),qc.set(this,void 0),wi.set(this,void 0),Vc(this,Fo,t,"f"),Vc(this,qc,[],"f")}get currentChatCompletionSnapshot(){return kt(this,wi,"f")}static fromReadableStream(t){const n=new qd(null);return n._run(()=>n._fromReadableStream(t)),n}static createChatCompletion(t,n,r){const a=new qd(n);return a._run(()=>a._runChatCompletion(t,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(t,n,r){var i;super._createChatCompletion;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),kt(this,fn,"m",Uj).call(this);const o=await t.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const s of o)kt(this,fn,"m",Vj).call(this,s);if((i=o.controller.signal)!=null&&i.aborted)throw new kr;return this._addChatCompletion(kt(this,fn,"m",qm).call(this))}async _fromReadableStream(t,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),kt(this,fn,"m",Uj).call(this),this._connected();const a=Rd.fromReadableStream(t,this.controller);let o;for await(const s of a)o&&o!==s.id&&this._addChatCompletion(kt(this,fn,"m",qm).call(this)),kt(this,fn,"m",Vj).call(this,s),o=s.id;if((i=a.controller.signal)!=null&&i.aborted)throw new kr;return this._addChatCompletion(kt(this,fn,"m",qm).call(this))}[(Fo=new WeakMap,qc=new WeakMap,wi=new WeakMap,fn=new WeakSet,Uj=function(){this.ended||Vc(this,wi,void 0,"f")},Vm=function(t){let n=kt(this,qc,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},kt(this,qc,"f")[t.index]=n,n)},Vj=function(t){var r,a,o,i,s,c,l,u,d,p,f,m,y,v,b;if(this.ended)return;const n=kt(this,fn,"m",z$).call(this,t);this._emit("chunk",t,n);for(const w of t.choices){const j=n.choices[w.index];w.delta.content!=null&&((r=j.message)==null?void 0:r.role)==="assistant"&&((a=j.message)!=null&&a.content)&&(this._emit("content",w.delta.content,j.message.content),this._emit("content.delta",{delta:w.delta.content,snapshot:j.message.content,parsed:j.message.parsed})),w.delta.refusal!=null&&((o=j.message)==null?void 0:o.role)==="assistant"&&((i=j.message)!=null&&i.refusal)&&this._emit("refusal.delta",{delta:w.delta.refusal,snapshot:j.message.refusal}),((s=w.logprobs)==null?void 0:s.content)!=null&&((c=j.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(l=w.logprobs)==null?void 0:l.content,snapshot:((u=j.logprobs)==null?void 0:u.content)??[]}),((d=w.logprobs)==null?void 0:d.refusal)!=null&&((p=j.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(f=w.logprobs)==null?void 0:f.refusal,snapshot:((m=j.logprobs)==null?void 0:m.refusal)??[]});const x=kt(this,fn,"m",Vm).call(this,j);j.finish_reason&&(kt(this,fn,"m",Wj).call(this,j),x.current_tool_call_index!=null&&kt(this,fn,"m",qj).call(this,j,x.current_tool_call_index));for(const _ of w.delta.tool_calls??[])x.current_tool_call_index!==_.index&&(kt(this,fn,"m",Wj).call(this,j),x.current_tool_call_index!=null&&kt(this,fn,"m",qj).call(this,j,x.current_tool_call_index)),x.current_tool_call_index=_.index;for(const _ of w.delta.tool_calls??[]){const S=(y=j.message.tool_calls)==null?void 0:y[_.index];S!=null&&S.type&&((S==null?void 0:S.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(v=S.function)==null?void 0:v.name,index:_.index,arguments:S.function.arguments,parsed_arguments:S.function.parsed_arguments,arguments_delta:((b=_.function)==null?void 0:b.arguments)??""}):S==null||S.type)}}},qj=function(t,n){var a,o,i;if(kt(this,fn,"m",Vm).call(this,t).done_tool_calls.has(n))return;const r=(a=t.message.tool_calls)==null?void 0:a[n];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const s=(i=(o=kt(this,Fo,"f"))==null?void 0:o.tools)==null?void 0:i.find(c=>c.type==="function"&&c.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:n,arguments:r.function.arguments,parsed_arguments:Ud(s)?s.$parseRaw(r.function.arguments):s!=null&&s.function.strict?JSON.parse(r.function.arguments):null})}else r.type},Wj=function(t){var r,a;const n=kt(this,fn,"m",Vm).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const o=kt(this,fn,"m",Hj).call(this);this._emit("content.done",{content:t.message.content,parsed:o?o.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},qm=function(){if(this.ended)throw new rt("stream has ended, this shouldn't happen");const t=kt(this,wi,"f");if(!t)throw new rt("request ended without sending any chunks");return Vc(this,wi,void 0,"f"),Vc(this,qc,[],"f"),phe(t,kt(this,Fo,"f"))},Hj=function(){var n;const t=(n=kt(this,Fo,"f"))==null?void 0:n.response_format;return _$(t)?t:null},z$=function(t){var n,r,a,o;let i=kt(this,wi,"f");const{choices:s,...c}=t;i?Object.assign(i,c):i=Vc(this,wi,{...c,choices:[]},"f");for(const{delta:l,finish_reason:u,index:d,logprobs:p=null,...f}of t.choices){let m=i.choices[d];if(m||(m=i.choices[d]={finish_reason:u,index:d,message:{},logprobs:p,...f}),p)if(!m.logprobs)m.logprobs=Object.assign({},p);else{const{content:_,refusal:S,...E}=p;Object.assign(m.logprobs,E),_&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(..._)),S&&((r=m.logprobs).refusal??(r.refusal=[]),m.logprobs.refusal.push(...S))}if(u&&(m.finish_reason=u,kt(this,Fo,"f")&&j$(kt(this,Fo,"f")))){if(u==="length")throw new G6;if(u==="content_filter")throw new X6}if(Object.assign(m,f),!l)continue;const{content:y,refusal:v,function_call:b,role:w,tool_calls:j,...x}=l;if(Object.assign(m.message,x),v&&(m.message.refusal=(m.message.refusal||"")+v),w&&(m.message.role=w),b&&(m.message.function_call?(b.name&&(m.message.function_call.name=b.name),b.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=b.arguments)):m.message.function_call=b),y&&(m.message.content=(m.message.content||"")+y,!m.message.refusal&&kt(this,fn,"m",Hj).call(this)&&(m.message.parsed=B$(m.message.content))),j){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:_,id:S,type:E,function:O,...N}of j){const M=(o=m.message.tool_calls)[_]??(o[_]={});Object.assign(M,N),S&&(M.id=S),E&&(M.type=E),O&&(M.function??(M.function={name:O.name??"",arguments:""})),O!=null&&O.name&&(M.function.name=O.name),O!=null&&O.arguments&&(M.function.arguments+=O.arguments,ohe(kt(this,Fo,"f"),M)&&(M.function.parsed_arguments=B$(M.function.arguments)))}}}return i},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("chunk",a=>{const o=n.shift();o?o.resolve(a):t.push(a)}),this.on("end",()=>{r=!0;for(const a of n)a.resolve(void 0);n.length=0}),this.on("abort",a=>{r=!0;for(const o of n)o.reject(a);n.length=0}),this.on("error",a=>{r=!0;for(const o of n)o.reject(a);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,o)=>n.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Rd(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function phe(e,t){const{id:n,choices:r,created:a,model:o,system_fingerprint:i,...s}=e,c={...s,id:n,choices:r.map(({message:l,finish_reason:u,index:d,logprobs:p,...f})=>{if(!u)throw new rt(`missing finish_reason for choice ${d}`);const{content:m=null,function_call:y,tool_calls:v,...b}=l,w=l.role;if(!w)throw new rt(`missing role for choice ${d}`);if(y){const{arguments:j,name:x}=y;if(j==null)throw new rt(`missing function_call.arguments for choice ${d}`);if(!x)throw new rt(`missing function_call.name for choice ${d}`);return{...f,message:{content:m,function_call:{arguments:j,name:x},role:w,refusal:l.refusal??null},finish_reason:u,index:d,logprobs:p}}return v?{...f,index:d,finish_reason:u,logprobs:p,message:{...b,role:w,content:m,refusal:l.refusal??null,tool_calls:v.map((j,x)=>{const{function:_,type:S,id:E,...O}=j,{arguments:N,name:M,...k}=_||{};if(E==null)throw new rt(`missing choices[${d}].tool_calls[${x}].id
${Wm(e)}`);if(S==null)throw new rt(`missing choices[${d}].tool_calls[${x}].type
${Wm(e)}`);if(M==null)throw new rt(`missing choices[${d}].tool_calls[${x}].function.name
${Wm(e)}`);if(N==null)throw new rt(`missing choices[${d}].tool_calls[${x}].function.arguments
${Wm(e)}`);return{...O,id:E,type:S,function:{...k,name:M,arguments:N}}})}}:{...f,message:{...b,content:m,role:w,refusal:l.refusal??null},finish_reason:u,index:d,logprobs:p}}),created:a,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return nhe(c,t)}function Wm(e){return JSON.stringify(e)}class Wc extends qd{static fromReadableStream(t){const n=new Wc(null);return n._run(()=>n._fromReadableStream(t)),n}static runFunctions(t,n,r){const a=new Wc(null),o={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(t,n,o)),a}static runTools(t,n,r){const a=new Wc(n),o={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(t,n,o)),a}}let U$=class extends mt{parse(e,t){return ihe(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Dj(n,e))}runFunctions(e,t){return e.stream?Wc.runFunctions(this._client,e,t):Vd.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Wc.runTools(this._client,e,t):Vd.runTools(this._client,e,t)}stream(e,t){return qd.createChatCompletion(this._client,e,t)}},Kj=class extends mt{constructor(){super(...arguments),this.completions=new U$(this._client)}};(function(e){e.Completions=U$})(Kj||(Kj={}));class V$ extends mt{create(t,n){return this._client.post("/realtime/sessions",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Zj extends mt{constructor(){super(...arguments),this.sessions=new V$(this._client)}}Zj.Sessions=V$;var Re=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},xr=function(e,t,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(e,n):a?a.value=n:t.set(e,n),n},Nn,Gj,Ga,Hm,sa,ms,Hc,ys,Km,_r,Zm,Gm,Wd,Hd,Kd,q$,W$,H$,K$,Z$,G$,X$;class ca extends x${constructor(){super(...arguments),Nn.add(this),Gj.set(this,[]),Ga.set(this,{}),Hm.set(this,{}),sa.set(this,void 0),ms.set(this,void 0),Hc.set(this,void 0),ys.set(this,void 0),Km.set(this,void 0),_r.set(this,void 0),Zm.set(this,void 0),Gm.set(this,void 0),Wd.set(this,void 0)}[(Gj=new WeakMap,Ga=new WeakMap,Hm=new WeakMap,sa=new WeakMap,ms=new WeakMap,Hc=new WeakMap,ys=new WeakMap,Km=new WeakMap,_r=new WeakMap,Zm=new WeakMap,Gm=new WeakMap,Wd=new WeakMap,Nn=new WeakSet,Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",a=>{const o=n.shift();o?o.resolve(a):t.push(a)}),this.on("end",()=>{r=!0;for(const a of n)a.resolve(void 0);n.length=0}),this.on("abort",a=>{r=!0;for(const o of n)o.reject(a);n.length=0}),this.on("error",a=>{r=!0;for(const o of n)o.reject(a);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,o)=>n.push({resolve:a,reject:o})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const n=new ca;return n._run(()=>n._fromReadableStream(t)),n}async _fromReadableStream(t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const a=Rd.fromReadableStream(t,this.controller);for await(const i of a)Re(this,Nn,"m",Hd).call(this,i);if((o=a.controller.signal)!=null&&o.aborted)throw new kr;return this._addRun(Re(this,Nn,"m",Kd).call(this))}toReadableStream(){return new Rd(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,n,r,a,o){const i=new ca;return i._run(()=>i._runToolAssistantStream(t,n,r,a,{...o,headers:{...o==null?void 0:o.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(t,n,r,a,o){var l;const i=o==null?void 0:o.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s={...a,stream:!0},c=await t.submitToolOutputs(n,r,s,{...o,signal:this.controller.signal});this._connected();for await(const u of c)Re(this,Nn,"m",Hd).call(this,u);if((l=c.controller.signal)!=null&&l.aborted)throw new kr;return this._addRun(Re(this,Nn,"m",Kd).call(this))}static createThreadAssistantStream(t,n,r){const a=new ca;return a._run(()=>a._threadAssistantStream(t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(t,n,r,a){const o=new ca;return o._run(()=>o._runAssistantStream(t,n,r,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return Re(this,Zm,"f")}currentRun(){return Re(this,Gm,"f")}currentMessageSnapshot(){return Re(this,sa,"f")}currentRunStepSnapshot(){return Re(this,Wd,"f")}async finalRunSteps(){return await this.done(),Object.values(Re(this,Ga,"f"))}async finalMessages(){return await this.done(),Object.values(Re(this,Hm,"f"))}async finalRun(){if(await this.done(),!Re(this,ms,"f"))throw Error("Final run was not received.");return Re(this,ms,"f")}async _createThreadAssistantStream(t,n,r){var s;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},i=await t.createAndRun(o,{...r,signal:this.controller.signal});this._connected();for await(const c of i)Re(this,Nn,"m",Hd).call(this,c);if((s=i.controller.signal)!=null&&s.aborted)throw new kr;return this._addRun(Re(this,Nn,"m",Kd).call(this))}async _createAssistantStream(t,n,r,a){var c;const o=a==null?void 0:a.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const i={...r,stream:!0},s=await t.create(n,i,{...a,signal:this.controller.signal});this._connected();for await(const l of s)Re(this,Nn,"m",Hd).call(this,l);if((c=s.controller.signal)!=null&&c.aborted)throw new kr;return this._addRun(Re(this,Nn,"m",Kd).call(this))}static accumulateDelta(t,n){for(const[r,a]of Object.entries(n)){if(!t.hasOwnProperty(r)){t[r]=a;continue}let o=t[r];if(o==null){t[r]=a;continue}if(r==="index"||r==="type"){t[r]=a;continue}if(typeof o=="string"&&typeof a=="string")o+=a;else if(typeof o=="number"&&typeof a=="number")o+=a;else if(Mj(o)&&Mj(a))o=this.accumulateDelta(o,a);else if(Array.isArray(o)&&Array.isArray(a)){if(o.every(i=>typeof i=="string"||typeof i=="number")){o.push(...a);continue}for(const i of a){if(!Mj(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const s=i.index;if(s==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof s!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);const c=o[s];c==null?o.push(i):o[s]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${a}, accValue: ${o}`);t[r]=o}return t}_addRun(t){return t}async _threadAssistantStream(t,n,r){return await this._createThreadAssistantStream(n,t,r)}async _runAssistantStream(t,n,r,a){return await this._createAssistantStream(n,t,r,a)}async _runToolAssistantStream(t,n,r,a,o){return await this._createToolAssistantStream(r,t,n,a,o)}}Hd=function(e){if(!this.ended)switch(xr(this,Zm,e,"f"),Re(this,Nn,"m",H$).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Re(this,Nn,"m",X$).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Re(this,Nn,"m",W$).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Re(this,Nn,"m",q$).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Kd=function(){if(this.ended)throw new rt("stream has ended, this shouldn't happen");if(!Re(this,ms,"f"))throw Error("Final run has not been received");return Re(this,ms,"f")},q$=function(e){const[t,n]=Re(this,Nn,"m",Z$).call(this,e,Re(this,sa,"f"));xr(this,sa,t,"f"),Re(this,Hm,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,o=t.content[r.index];if(o&&o.type=="text")this._emit("textDelta",a,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=Re(this,Hc,"f")){if(Re(this,ys,"f"))switch(Re(this,ys,"f").type){case"text":this._emit("textDone",Re(this,ys,"f").text,Re(this,sa,"f"));break;case"image_file":this._emit("imageFileDone",Re(this,ys,"f").image_file,Re(this,sa,"f"));break}xr(this,Hc,r.index,"f")}xr(this,ys,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Re(this,Hc,"f")!==void 0){const r=e.data.content[Re(this,Hc,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,Re(this,sa,"f"));break;case"text":this._emit("textDone",r.text,Re(this,sa,"f"));break}}Re(this,sa,"f")&&this._emit("messageDone",e.data),xr(this,sa,void 0,"f")}},W$=function(e){const t=Re(this,Nn,"m",K$).call(this,e);switch(xr(this,Wd,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const r of n.step_details.tool_calls)r.index==Re(this,Km,"f")?this._emit("toolCallDelta",r,t.step_details.tool_calls[r.index]):(Re(this,_r,"f")&&this._emit("toolCallDone",Re(this,_r,"f")),xr(this,Km,r.index,"f"),xr(this,_r,t.step_details.tool_calls[r.index],"f"),Re(this,_r,"f")&&this._emit("toolCallCreated",Re(this,_r,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":xr(this,Wd,void 0,"f"),e.data.step_details.type=="tool_calls"&&Re(this,_r,"f")&&(this._emit("toolCallDone",Re(this,_r,"f")),xr(this,_r,void 0,"f")),this._emit("runStepDone",e.data,t);break}},H$=function(e){Re(this,Gj,"f").push(e),this._emit("event",e)},K$=function(e){switch(e.event){case"thread.run.step.created":return Re(this,Ga,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Re(this,Ga,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=ca.accumulateDelta(t,n.delta);Re(this,Ga,"f")[e.data.id]=r}return Re(this,Ga,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Re(this,Ga,"f")[e.data.id]=e.data;break}if(Re(this,Ga,"f")[e.data.id])return Re(this,Ga,"f")[e.data.id];throw new Error("No snapshot available")},Z$=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let o=t.content[a.index];t.content[a.index]=Re(this,Nn,"m",G$).call(this,a,o)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},G$=function(e,t){return ca.accumulateDelta(t,e)},X$=function(e){switch(xr(this,Gm,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":xr(this,ms,e.data,"f"),Re(this,_r,"f")&&(this._emit("toolCallDone",Re(this,_r,"f")),xr(this,_r,void 0,"f"));break}};class Xj extends mt{create(t,n,r){return this._client.post(`/threads/${t}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/threads/${t}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,a){return this._client.post(`/threads/${t}/messages/${n}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(t,n={},r){return nr(n)?this.list(t,{},n):this._client.getAPIList(`/threads/${t}/messages`,Jj,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n,r){return this._client.delete(`/threads/${t}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Jj extends oa{}Xj.MessagesPage=Jj;class Yj extends mt{retrieve(t,n,r,a={},o){return nr(a)?this.retrieve(t,n,r,{},a):this._client.get(`/threads/${t}/runs/${n}/steps/${r}`,{query:a,...o,headers:{"OpenAI-Beta":"assistants=v2",...o==null?void 0:o.headers}})}list(t,n,r={},a){return nr(r)?this.list(t,n,{},r):this._client.getAPIList(`/threads/${t}/runs/${n}/steps`,Qj,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}}class Qj extends oa{}Yj.RunStepsPage=Qj;class Zd extends mt{constructor(){super(...arguments),this.steps=new Yj(this._client)}create(t,n,r){const{include:a,...o}=n;return this._client.post(`/threads/${t}/runs`,{query:{include:a},body:o,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}retrieve(t,n,r){return this._client.get(`/threads/${t}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,a){return this._client.post(`/threads/${t}/runs/${n}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(t,n={},r){return nr(n)?this.list(t,{},n):this._client.getAPIList(`/threads/${t}/runs`,eS,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(t,n,r){return this._client.post(`/threads/${t}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const a=await this.create(t,n,r);return await this.poll(t,a.id,r)}createAndStream(t,n,r){return ca.createAssistantStream(t,this._client.beta.threads.runs,n,r)}async poll(t,n,r){const a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for((r==null?void 0:r.pollIntervalMs)&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:o,response:i}=await this.retrieve(t,n,{...r,headers:{...r==null?void 0:r.headers,...a}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let s=5e3;if(r!=null&&r.pollIntervalMs)s=r.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(s=l)}}await Dd(s);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(t,n,r){return ca.createAssistantStream(t,this._client.beta.threads.runs,n,r)}submitToolOutputs(t,n,r,a){return this._client.post(`/threads/${t}/runs/${n}/submit_tool_outputs`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(t,n,r,a){const o=await this.submitToolOutputs(t,n,r,a);return await this.poll(t,o.id,a)}submitToolOutputsStream(t,n,r,a){return ca.createToolAssistantStream(t,n,this._client.beta.threads.runs,r,a)}}class eS extends oa{}Zd.RunsPage=eS,Zd.Steps=Yj,Zd.RunStepsPage=Qj;class Kc extends mt{constructor(){super(...arguments),this.runs=new Zd(this._client),this.messages=new Xj(this._client)}create(t={},n){return nr(t)?this.create({},t):this._client.post("/threads",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/threads/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/threads/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n){return this._client.delete(`/threads/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(t,n){return this._client.post("/threads/runs",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}async createAndRunPoll(t,n){const r=await this.createAndRun(t,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(t,n){return ca.createThreadAssistantStream(t,this._client.beta.threads,n)}}Kc.Runs=Zd,Kc.RunsPage=eS,Kc.Messages=Xj,Kc.MessagesPage=Jj;const fhe=async e=>{const t=await Promise.allSettled(e),n=t.filter(a=>a.status==="rejected");if(n.length){for(const a of n)console.error(a.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const a of t)a.status==="fulfilled"&&r.push(a.value);return r};let tS=class extends mt{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},n){return nr(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Xm,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for((n==null?void 0:n.pollIntervalMs)&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:r}).withResponse(),o=a.data;switch(o.status){case"in_progress":let i=5e3;if(n!=null&&n.pollIntervalMs)i=n.pollIntervalMs;else{const s=a.response.headers.get("openai-poll-after-ms");if(s){const c=parseInt(s);isNaN(c)||(i=c)}}await Dd(i);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}};class Xm extends oa{}tS.VectorStoreFilesPage=Xm;class J$ extends mt{create(t,n,r){return this._client.post(`/vector_stores/${t}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/vector_stores/${t}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(t,n,r){return this._client.post(`/vector_stores/${t}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const a=await this.create(t,n);return await this.poll(t,a.id,r)}listFiles(t,n,r={},a){return nr(r)?this.listFiles(t,n,{},r):this._client.getAPIList(`/vector_stores/${t}/file_batches/${n}/files`,Xm,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}async poll(t,n,r){const a={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for((r==null?void 0:r.pollIntervalMs)&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:o,response:i}=await this.retrieve(t,n,{...r,headers:a}).withResponse();switch(o.status){case"in_progress":let s=5e3;if(r!=null&&r.pollIntervalMs)s=r.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(s=l)}}await Dd(s);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(t,{files:n,fileIds:r=[]},a){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=(a==null?void 0:a.maxConcurrency)??5,i=Math.min(o,n.length),s=this._client,c=n.values(),l=[...r];async function u(p){for(let f of p){const m=await s.files.create({file:f,purpose:"assistants"},a);l.push(m.id)}}const d=Array(i).fill(c).map(u);return await fhe(d),await this.createAndPoll(t,{file_ids:l})}}class Zc extends mt{constructor(){super(...arguments),this.files=new tS(this._client),this.fileBatches=new J$(this._client)}create(t,n){return this._client.post("/vector_stores",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/vector_stores/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/vector_stores/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(t={},n){return nr(t)?this.list({},t):this._client.getAPIList("/vector_stores",nS,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,n){return this._client.delete(`/vector_stores/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class nS extends oa{}Zc.VectorStoresPage=nS,Zc.Files=tS,Zc.VectorStoreFilesPage=Xm,Zc.FileBatches=J$;class xi extends mt{constructor(){super(...arguments),this.realtime=new Zj(this._client),this.vectorStores=new Zc(this._client),this.chat=new Kj(this._client),this.assistants=new Tj(this._client),this.threads=new Kc(this._client)}}xi.Realtime=Zj,xi.VectorStores=Zc,xi.VectorStoresPage=nS,xi.Assistants=Tj,xi.AssistantsPage=Ij,xi.Threads=Kc;let Y$=class extends mt{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}},Q$=class extends mt{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};class rS extends mt{create(t,n){return this._client.post("/files",$c({body:t,...n}))}retrieve(t,n){return this._client.get(`/files/${t}`,n)}list(t={},n){return nr(t)?this.list({},t):this._client.getAPIList("/files",aS,{query:t,...n})}del(t,n){return this._client.delete(`/files/${t}`,n)}content(t,n){return this._client.get(`/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(t,n){return this._client.get(`/files/${t}/content`,n)}async waitForProcessing(t,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const a=new Set(["processed","error","deleted"]),o=Date.now();let i=await this.retrieve(t);for(;!i.status||!a.has(i.status);)if(await Dd(n),i=await this.retrieve(t),Date.now()-o>r)throw new Am({message:`Giving up on waiting for file ${t} to finish processing after ${r} milliseconds.`});return i}}class aS extends oa{}rS.FileObjectsPage=aS;class oS extends mt{list(t,n={},r){return nr(n)?this.list(t,{},n):this._client.getAPIList(`/fine_tuning/jobs/${t}/checkpoints`,iS,{query:n,...r})}}class iS extends oa{}oS.FineTuningJobCheckpointsPage=iS;class Gc extends mt{constructor(){super(...arguments),this.checkpoints=new oS(this._client)}create(t,n){return this._client.post("/fine_tuning/jobs",{body:t,...n})}retrieve(t,n){return this._client.get(`/fine_tuning/jobs/${t}`,n)}list(t={},n){return nr(t)?this.list({},t):this._client.getAPIList("/fine_tuning/jobs",sS,{query:t,...n})}cancel(t,n){return this._client.post(`/fine_tuning/jobs/${t}/cancel`,n)}listEvents(t,n={},r){return nr(n)?this.listEvents(t,{},n):this._client.getAPIList(`/fine_tuning/jobs/${t}/events`,cS,{query:n,...r})}}class sS extends oa{}class cS extends oa{}Gc.FineTuningJobsPage=sS,Gc.FineTuningJobEventsPage=cS,Gc.Checkpoints=oS,Gc.FineTuningJobCheckpointsPage=iS;class Gd extends mt{constructor(){super(...arguments),this.jobs=new Gc(this._client)}}Gd.Jobs=Gc,Gd.FineTuningJobsPage=sS,Gd.FineTuningJobEventsPage=cS;class e8 extends mt{createVariation(t,n){return this._client.post("/images/variations",$c({body:t,...n}))}edit(t,n){return this._client.post("/images/edits",$c({body:t,...n}))}generate(t,n){return this._client.post("/images/generations",{body:t,...n})}}let lS=class extends mt{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",uS,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class uS extends Qfe{}lS.ModelsPage=uS;class t8 extends mt{create(t,n){return this._client.post("/moderations",{body:t,...n})}}class n8 extends mt{create(t,n,r){return this._client.post(`/uploads/${t}/parts`,$c({body:n,...r}))}}class dS extends mt{constructor(){super(...arguments),this.parts=new n8(this._client)}create(t,n){return this._client.post("/uploads",{body:t,...n})}cancel(t,n){return this._client.post(`/uploads/${t}/cancel`,n)}complete(t,n,r){return this._client.post(`/uploads/${t}/complete`,{body:n,...r})}}dS.Parts=n8;var r8;let ct=class extends Bfe{constructor({baseURL:e=Dm("OPENAI_BASE_URL"),apiKey:t=Dm("OPENAI_API_KEY"),organization:n=Dm("OPENAI_ORG_ID")??null,project:r=Dm("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new rt("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:n,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&Jfe())throw new rt(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new Y$(this),this.chat=new kj(this),this.embeddings=new Q$(this),this.files=new rS(this),this.images=new e8(this),this.audio=new Ld(this),this.moderations=new t8(this),this.models=new lS(this),this.fineTuning=new Gd(this),this.beta=new xi(this),this.batches=new Pj(this),this.uploads=new dS(this),this._options=o,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return jfe(e,{arrayFormat:"brackets"})}};r8=ct,ct.OpenAI=r8,ct.DEFAULT_TIMEOUT=6e5,ct.OpenAIError=rt,ct.APIError=tr,ct.APIConnectionError=Pm,ct.APIConnectionTimeoutError=Am,ct.APIUserAbortError=kr,ct.NotFoundError=q6,ct.ConflictError=W6,ct.RateLimitError=K6,ct.BadRequestError=z6,ct.AuthenticationError=U6,ct.InternalServerError=Z6,ct.PermissionDeniedError=V6,ct.UnprocessableEntityError=H6,ct.toFile=e$,ct.fileFromPath=F6,ct.Completions=Y$,ct.Chat=kj,ct.Embeddings=Q$,ct.Files=rS,ct.FileObjectsPage=aS,ct.Images=e8,ct.Audio=Ld,ct.Moderations=t8,ct.Models=lS,ct.ModelsPage=uS,ct.FineTuning=Gd,ct.Beta=xi,ct.Batches=Pj,ct.BatchesPage=Aj,ct.Uploads=dS;var hhe=typeof window=="object"?window:{},Xe="0123456789abcdef".split(""),mhe=[-2147483648,8388608,32768,128],la=[24,16,8,0],vn=[];function ua(e){e?(vn[0]=vn[16]=vn[1]=vn[2]=vn[3]=vn[4]=vn[5]=vn[6]=vn[7]=vn[8]=vn[9]=vn[10]=vn[11]=vn[12]=vn[13]=vn[14]=vn[15]=0,this.blocks=vn):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}ua.prototype.update=function(e){if(!this.finalized){var t=typeof e!="string";t&&e.constructor===hhe.ArrayBuffer&&(e=new Uint8Array(e));for(var n,r=0,a,o=e.length||0,i=this.blocks;r<o;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),t)for(a=this.start;r<o&&a<64;++r)i[a>>2]|=e[r]<<la[a++&3];else for(a=this.start;r<o&&a<64;++r)n=e.charCodeAt(r),n<128?i[a>>2]|=n<<la[a++&3]:n<2048?(i[a>>2]|=(192|n>>6)<<la[a++&3],i[a>>2]|=(128|n&63)<<la[a++&3]):n<55296||n>=57344?(i[a>>2]|=(224|n>>12)<<la[a++&3],i[a>>2]|=(128|n>>6&63)<<la[a++&3],i[a>>2]|=(128|n&63)<<la[a++&3]):(n=65536+((n&1023)<<10|e.charCodeAt(++r)&1023),i[a>>2]|=(240|n>>18)<<la[a++&3],i[a>>2]|=(128|n>>12&63)<<la[a++&3],i[a>>2]|=(128|n>>6&63)<<la[a++&3],i[a>>2]|=(128|n&63)<<la[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=i[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},ua.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=mhe[t&3],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},ua.prototype.hash=function(){var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4,o,i,s,c=this.blocks;for(i=16;i<80;++i)s=c[i-3]^c[i-8]^c[i-14]^c[i-16],c[i]=s<<1|s>>>31;for(i=0;i<20;i+=5)o=t&n|~t&r,s=e<<5|e>>>27,a=s+o+a+1518500249+c[i]<<0,t=t<<30|t>>>2,o=e&t|~e&n,s=a<<5|a>>>27,r=s+o+r+1518500249+c[i+1]<<0,e=e<<30|e>>>2,o=a&e|~a&t,s=r<<5|r>>>27,n=s+o+n+1518500249+c[i+2]<<0,a=a<<30|a>>>2,o=r&a|~r&e,s=n<<5|n>>>27,t=s+o+t+1518500249+c[i+3]<<0,r=r<<30|r>>>2,o=n&r|~n&a,s=t<<5|t>>>27,e=s+o+e+1518500249+c[i+4]<<0,n=n<<30|n>>>2;for(;i<40;i+=5)o=t^n^r,s=e<<5|e>>>27,a=s+o+a+1859775393+c[i]<<0,t=t<<30|t>>>2,o=e^t^n,s=a<<5|a>>>27,r=s+o+r+1859775393+c[i+1]<<0,e=e<<30|e>>>2,o=a^e^t,s=r<<5|r>>>27,n=s+o+n+1859775393+c[i+2]<<0,a=a<<30|a>>>2,o=r^a^e,s=n<<5|n>>>27,t=s+o+t+1859775393+c[i+3]<<0,r=r<<30|r>>>2,o=n^r^a,s=t<<5|t>>>27,e=s+o+e+1859775393+c[i+4]<<0,n=n<<30|n>>>2;for(;i<60;i+=5)o=t&n|t&r|n&r,s=e<<5|e>>>27,a=s+o+a-1894007588+c[i]<<0,t=t<<30|t>>>2,o=e&t|e&n|t&n,s=a<<5|a>>>27,r=s+o+r-1894007588+c[i+1]<<0,e=e<<30|e>>>2,o=a&e|a&t|e&t,s=r<<5|r>>>27,n=s+o+n-1894007588+c[i+2]<<0,a=a<<30|a>>>2,o=r&a|r&e|a&e,s=n<<5|n>>>27,t=s+o+t-1894007588+c[i+3]<<0,r=r<<30|r>>>2,o=n&r|n&a|r&a,s=t<<5|t>>>27,e=s+o+e-1894007588+c[i+4]<<0,n=n<<30|n>>>2;for(;i<80;i+=5)o=t^n^r,s=e<<5|e>>>27,a=s+o+a-899497514+c[i]<<0,t=t<<30|t>>>2,o=e^t^n,s=a<<5|a>>>27,r=s+o+r-899497514+c[i+1]<<0,e=e<<30|e>>>2,o=a^e^t,s=r<<5|r>>>27,n=s+o+n-899497514+c[i+2]<<0,a=a<<30|a>>>2,o=r^a^e,s=n<<5|n>>>27,t=s+o+t-899497514+c[i+3]<<0,r=r<<30|r>>>2,o=n^r^a,s=t<<5|t>>>27,e=s+o+e-899497514+c[i+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+a<<0},ua.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4;return Xe[e>>28&15]+Xe[e>>24&15]+Xe[e>>20&15]+Xe[e>>16&15]+Xe[e>>12&15]+Xe[e>>8&15]+Xe[e>>4&15]+Xe[e&15]+Xe[t>>28&15]+Xe[t>>24&15]+Xe[t>>20&15]+Xe[t>>16&15]+Xe[t>>12&15]+Xe[t>>8&15]+Xe[t>>4&15]+Xe[t&15]+Xe[n>>28&15]+Xe[n>>24&15]+Xe[n>>20&15]+Xe[n>>16&15]+Xe[n>>12&15]+Xe[n>>8&15]+Xe[n>>4&15]+Xe[n&15]+Xe[r>>28&15]+Xe[r>>24&15]+Xe[r>>20&15]+Xe[r>>16&15]+Xe[r>>12&15]+Xe[r>>8&15]+Xe[r>>4&15]+Xe[r&15]+Xe[a>>28&15]+Xe[a>>24&15]+Xe[a>>20&15]+Xe[a>>16&15]+Xe[a>>12&15]+Xe[a>>8&15]+Xe[a>>4&15]+Xe[a&15]},ua.prototype.toString=ua.prototype.hex,ua.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,a=this.h4;return[e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24&255,r>>16&255,r>>8&255,r&255,a>>24&255,a>>16&255,a>>8&255,a&255]},ua.prototype.array=ua.prototype.digest,ua.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};const yhe=e=>new ua(!0).update(e).hex(),a8=(...e)=>yhe(e.join("_"));class ghe{}const vhe=new Map;class pS extends ghe{constructor(t){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=t??new Map}lookup(t,n){return Promise.resolve(this.cache.get(a8(t,n))??null)}async update(t,n,r){this.cache.set(a8(t,n),r)}static global(){return new pS(vhe)}}const bhe=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e;function fS(e){return typeof e!="object"||!e?!1:!!("type"in e&&e.type==="function"&&"function"in e&&typeof e.function=="object"&&e.function&&"name"in e.function&&"parameters"in e.function)}const whe=()=>!1;class xhe extends yf{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(t){super(t),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=t.verbose??whe(),this.callbacks=t.callbacks,this.tags=t.tags??[],this.metadata=t.metadata??{}}}class _he extends xhe{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:t,callbackManager:n,...r}){super({callbacks:t??n,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=pS.global():this.cache=void 0,this.caller=new DDe(r??{})}async getNumTokens(t){if(typeof t!="string")return 0;let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await LDe("modelName"in this?bhe(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(t){return typeof t=="string"?new v6(t):Array.isArray(t)?new Jpe(t.map(gf)):t}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:t,...n}){const r={...this._identifyingParams(),...n,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(t){throw new Error("Use .toJSON() instead")}}class _i extends yf{static lc_name(){return"RunnablePassthrough"}constructor(t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t&&(this.func=t.func)}async invoke(t,n){const r=zG(n);return this.func&&await this.func(t,r),this._callWithConfig(a=>Promise.resolve(a),t,r)}async*transform(t,n){const r=zG(n);let a,o=!0;for await(const i of this._transformStreamWithConfig(t,s=>s,r))if(yield i,o)if(a===void 0)a=i;else try{a=UG(a,i)}catch{a=void 0,o=!1}this.func&&a!==void 0&&await this.func(a,r)}static assign(t){return new $De(new FDe({steps:t}))}}function Xd(e){return typeof(e==null?void 0:e.parse)=="function"}class Xa extends _he{constructor(t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptionsCompat(t){const[n,r]=super._separateRunnableConfigFromCallOptions(t);return r.signal=n.signal,[n,r]}async invoke(t,n){const r=Xa._convertInputToPromptValue(t);return(await this.generatePrompt([r],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(t,n,r){throw new Error("Not implemented.")}async*_streamIterator(t,n){var r;if(this._streamResponseChunks===Xa.prototype._streamResponseChunks)yield this.invoke(t,n);else{const a=Xa._convertInputToPromptValue(t).toChatMessages(),[o,i]=this._separateRunnableConfigFromCallOptionsCompat(n),s={...o.metadata,...this.getLsParams(i)},c=await zM.configure(o.callbacks,this.callbacks,o.tags,this.tags,s,this.metadata,{verbose:this.verbose}),l={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1},u=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[a],o.runId,void 0,l,void 0,void 0,o.runName));let d;try{for await(const p of this._streamResponseChunks(a,i,u==null?void 0:u[0])){if(p.message.id==null){const f=(r=u==null?void 0:u.at(0))==null?void 0:r.runId;f!=null&&p.message._updateId(`run-${f}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,d?d=d.concat(p):d=p}}catch(p){throw await Promise.all((u??[]).map(f=>f==null?void 0:f.handleLLMError(p))),p}await Promise.all((u??[]).map(p=>p==null?void 0:p.handleLLMEnd({generations:[[d]]})))}}getLsParams(t){return{ls_model_type:"chat",ls_stop:t.stop}}async _generateUncached(t,n,r){var p,f;const a=t.map(m=>m.map(gf)),o={...r.metadata,...this.getLsParams(n)},i=await zM.configure(r.callbacks,this.callbacks,r.tags,this.tags,o,this.metadata,{verbose:this.verbose}),s={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1},c=await(i==null?void 0:i.handleChatModelStart(this.toJSON(),a,r.runId,void 0,s,void 0,void 0,r.runName)),l=[],u=[];if(c!=null&&c[0].handlers.find(m=>BDe(m)||zDe(m))&&a.length===1&&this._streamResponseChunks!==Xa.prototype._streamResponseChunks)try{const m=await this._streamResponseChunks(a[0],n,c==null?void 0:c[0]);let y;for await(const v of m){if(v.message.id==null){const b=(p=c==null?void 0:c.at(0))==null?void 0:p.runId;b!=null&&v.message._updateId(`run-${b}`)}y===void 0?y=v:y=UG(y,v)}if(y===void 0)throw new Error("Received empty response from chat model call.");l.push([y]),await(c==null?void 0:c[0].handleLLMEnd({generations:l,llmOutput:{}}))}catch(m){throw await(c==null?void 0:c[0].handleLLMError(m)),m}else{const m=await Promise.allSettled(a.map((y,v)=>this._generate(y,{...n,promptIndex:v},c==null?void 0:c[v])));await Promise.all(m.map(async(y,v)=>{var b,w,j;if(y.status==="fulfilled"){const x=y.value;for(const _ of x.generations){if(_.message.id==null){const S=(b=c==null?void 0:c.at(0))==null?void 0:b.runId;S!=null&&_.message._updateId(`run-${S}`)}_.message.response_metadata={..._.generationInfo,..._.message.response_metadata}}return x.generations.length===1&&(x.generations[0].message.response_metadata={...x.llmOutput,...x.generations[0].message.response_metadata}),l[v]=x.generations,u[v]=x.llmOutput,(w=c==null?void 0:c[v])==null?void 0:w.handleLLMEnd({generations:[x.generations],llmOutput:x.llmOutput})}else return await((j=c==null?void 0:c[v])==null?void 0:j.handleLLMError(y.reason)),Promise.reject(y.reason)}))}const d={generations:l,llmOutput:u.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...u):void 0};return Object.defineProperty(d,VG,{value:c?{runIds:c==null?void 0:c.map(m=>m.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:t,cache:n,llmStringKey:r,parsedOptions:a,handledOptions:o}){const i=t.map(y=>y.map(gf)),s={...o.metadata,...this.getLsParams(a)},c=await zM.configure(o.callbacks,this.callbacks,o.tags,this.tags,s,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1,cached:!0},u=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),i,o.runId,void 0,l,void 0,void 0,o.runName)),d=[],p=(await Promise.allSettled(i.map(async(y,v)=>{const b=Xa._convertInputToPromptValue(y).toString(),w=await n.lookup(b,r);return w==null&&d.push(v),w}))).map((y,v)=>({result:y,runManager:u==null?void 0:u[v]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),f=[];await Promise.all(p.map(async({result:y,runManager:v},b)=>{if(y.status==="fulfilled"){const w=y.value;return f[b]=w,w.length&&await(v==null?void 0:v.handleLLMNewToken(w[0].text)),v==null?void 0:v.handleLLMEnd({generations:[w]})}else return await(v==null?void 0:v.handleLLMError(y.reason)),Promise.reject(y.reason)}));const m={generations:f,missingPromptIndices:d};return Object.defineProperty(m,VG,{value:u?{runIds:u==null?void 0:u.map(y=>y.runId)}:void 0,configurable:!0}),m}async generate(t,n,r){let a;Array.isArray(n)?a={stop:n}:a=n;const o=t.map(f=>f.map(gf)),[i,s]=this._separateRunnableConfigFromCallOptionsCompat(a);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(o,s,i);const{cache:c}=this,l=this._getSerializedCacheKeyParametersForCall(s),{generations:u,missingPromptIndices:d}=await this._generateCached({messages:o,cache:c,llmStringKey:l,parsedOptions:s,handledOptions:i});let p={};if(d.length>0){const f=await this._generateUncached(d.map(m=>o[m]),s,i);await Promise.all(f.generations.map(async(m,y)=>{const v=d[y];u[v]=m;const b=Xa._convertInputToPromptValue(o[v]).toString();return c.update(b,l,m)})),p=f.llmOutput??{}}return{generations:u,llmOutput:p}}invocationParams(t){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(t,n,r){const a=t.map(o=>o.toChatMessages());return this.generate(a,n,r)}async call(t,n,r){return(await this.generate([t.map(gf)],n,r)).generations[0][0].message}async callPrompt(t,n,r){const a=t.toChatMessages();return this.call(a,n,r)}async predictMessages(t,n,r){return this.call(t,n,r)}async predict(t,n,r){const a=new Ur(t),o=await this.call([a],n,r);if(typeof o.content!="string")throw new Error("Cannot use predict when output is not a string.");return o.content}withStructuredOutput(t,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');const r=t,a=n==null?void 0:n.name,o=r.description??"A function available to call.",i=n==null?void 0:n.method,s=n==null?void 0:n.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let c=a??"extract",l;Xd(r)?l=[{type:"function",function:{name:c,description:o,parameters:UM(r)}}]:("name"in r&&(c=r.name),l=[{type:"function",function:{name:c,description:o,parameters:r}}]);const u=this.bindTools(l),d=UDe.from(y=>{if(!y.tool_calls||y.tool_calls.length===0)throw new Error("No tool calls found in the response.");const v=y.tool_calls.find(b=>b.name===c);if(!v)throw new Error(`No tool call found with name ${c}.`);return v.args});if(!s)return u.pipe(d).withConfig({runName:"StructuredOutput"});const p=_i.assign({parsed:(y,v)=>d.invoke(y.raw,v)}),f=_i.assign({parsed:()=>null}),m=p.withFallbacks({fallbacks:[f]});return Cv.from([{raw:u},m]).withConfig({runName:"StructuredOutputRunnable"})}}class o8 extends yf{parseResultWithPrompt(t,n,r){return this.parseResult(t,r)}_baseMessageToString(t){return typeof t.content=="string"?t.content:this._baseMessageContentToString(t.content)}_baseMessageContentToString(t){return JSON.stringify(t)}async invoke(t,n){return typeof t=="string"?this._callWithConfig(async(r,a)=>this.parseResult([{text:r}],a==null?void 0:a.callbacks),t,{...n,runType:"parser"}):this._callWithConfig(async(r,a)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],a==null?void 0:a.callbacks),t,{...n,runType:"parser"})}}class i8 extends o8{parseResult(t,n){return this.parse(t[0].text,n)}async parseWithPrompt(t,n,r){return this.parse(t,r)}_type(){throw new Error("_type not implemented")}}class Jm extends Error{constructor(t,n,r,a=!1){if(super(t),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=n,this.observation=r,this.sendToLLM=a,a&&(r===void 0||n===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}function hS(e,t){const n=typeof e;if(n!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;const r=e.length;if(r!==t.length)return!1;for(let a=0;a<r;a++)if(!hS(e[a],t[a]))return!1;return!0}if(n==="object"){if(!e||!t)return e===t;const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const o of r)if(!hS(e[o],t[o]))return!1;return!0}return e===t}class jhe extends i8{async*_transform(t){for await(const n of t)typeof n=="string"?yield this.parseResult([{text:n}]):yield this.parseResult([{message:n,text:this._baseMessageToString(n)}])}async*transform(t,n){yield*this._transformStreamWithConfig(t,this._transform.bind(this),{...n,runType:"parser"})}}class s8 extends jhe{constructor(t){super(t),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(t==null?void 0:t.diff)??this.diff}async*_transform(t){let n,r;for await(const a of t){if(typeof a!="string"&&typeof a.content!="string")throw new Error("Cannot handle non-string output.");let o;if(VDe(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");o=new Hi({message:a,text:a.content})}else if(qG(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");o=new Hi({message:qDe(a),text:a.content})}else o=new WDe({text:a});r===void 0?r=o:r=r.concat(o);const i=await this.parsePartialResult([r]);i!=null&&!hS(i,n)&&(this.diff?yield this._diff(n,i):yield i,n=i)}}getFormatInstructions(){return""}}class mS extends i8{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(t){super(t),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(t){return new this(t)}static fromNamesAndDescriptions(t){const n=Pa.object(Object.fromEntries(Object.entries(t).map(([r,a])=>[r,Pa.string().describe(a)])));return new this(n)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(UM(this.schema))}
\`\`\`
`}async parse(t){try{const n=(t.includes("```")?t.trim().split(/```(?:json)?/)[1]:t.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(r,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(n))}catch(n){throw new Jm(`Failed to parse. Text: "${t}". Error: ${n}`,t)}}}class yS extends s8{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(t,n){if(n)return t?vX(t,n):[{op:"replace",path:"",value:n}]}async parsePartialResult(t){return WG(t[0].text)}async parse(t){return WG(t,JSON.parse)}getFormatInstructions(){return""}}function gS(e,t){if(e.function===void 0)return;let n;if(t!=null&&t.partial)try{n=HDe(e.function.arguments??"{}")}catch{return}else try{n=JSON.parse(e.function.arguments)}catch(a){throw new Jm([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${a.message}`].join(`
`))}const r={name:e.function.name,args:n,type:"tool_call"};return t!=null&&t.returnId&&(r.id=e.id),r}function c8(e){if(e.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function l8(e,t){var n,r;return{name:(n=e.function)==null?void 0:n.name,args:(r=e.function)==null?void 0:r.arguments,id:e.id,error:t,type:"invalid_tool_call"}}class She extends s8{static lc_name(){return"JsonOutputToolsParser"}constructor(t){super(t),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(t==null?void 0:t.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(t){return await this.parsePartialResult(t,!1)}async parsePartialResult(t,n=!0){var i;const r=t[0].message;let a;if(Nv(r)&&((i=r.tool_calls)!=null&&i.length)?a=r.tool_calls.map(s=>{const{id:c,...l}=s;return this.returnId?{id:c,...l}:l}):r.additional_kwargs.tool_calls!==void 0&&(a=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(s=>gS(s,{returnId:this.returnId,partial:n}))),!a)return[];const o=[];for(const s of a)if(s!==void 0){const c={type:s.name,args:s.args,id:s.id};o.push(c)}return o}}class Ym extends She{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=t.keyName,this.returnSingle=t.returnSingle??this.returnSingle,this.zodSchema=t.zodSchema}async _validateResult(t){if(this.zodSchema===void 0)return t;const n=await this.zodSchema.safeParseAsync(t);if(n.success)return n.data;throw new Jm(`Failed to parse. Text: "${JSON.stringify(t,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(t,null,2))}async parsePartialResult(t){const n=(await super.parsePartialResult(t)).filter(a=>a.type===this.keyName);let r=n;if(n.length)return this.returnId||(r=n.map(a=>a.args)),this.returnSingle?r[0]:r}async parseResult(t){const n=(await super.parsePartialResult(t,!1)).filter(a=>a.type===this.keyName);let r=n;return n.length?(this.returnId||(r=n.map(a=>a.args)),this.returnSingle?this._validateResult(r[0]):await Promise.all(r.map(a=>this._validateResult(a)))):void 0}}const Ehe=Symbol("Let zodToJsonSchema decide on which parser to use"),Ohe={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Che=e=>({...Ohe,...e}),Nhe=e=>{const t=Che(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function u8(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Et(e,t,n,r,a){e[t]=n,u8(e,t,r,a)}function Mhe(){return{}}function khe(e,t){var r,a;const n={type:"array"};return((a=(r=e.type)==null?void 0:r._def)==null?void 0:a.typeName)!==Q.ZodAny&&(n.items=yt(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Et(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Et(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Et(n,"minItems",e.exactLength.value,e.exactLength.message,t),Et(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function Phe(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Et(n,"minimum",r.value,r.message,t):Et(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Et(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Et(n,"maximum",r.value,r.message,t):Et(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Et(n,"maximum",r.value,r.message,t));break;case"multipleOf":Et(n,"multipleOf",r.value,r.message,t);break}return n}function Ahe(){return{type:"boolean"}}function The(e,t){return yt(e.type._def,t)}const Ihe=(e,t)=>yt(e.innerType._def,t);function d8(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,o)=>d8(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Rhe(e,t)}}const Rhe=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Et(n,"minimum",r.value,r.message,t);break;case"max":Et(n,"maximum",r.value,r.message,t);break}return n};function Dhe(e,t){return{...yt(e.innerType._def,t),default:e.defaultValue()}}function Lhe(e,t){return t.effectStrategy==="input"?yt(e.schema._def,t):{}}function $he(e){return{type:"string",enum:e.values}}const Fhe=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Bhe(e,t){const n=[yt(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),yt(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(o=>{if(Fhe(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(r=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:s,...c}=o;i=c}else r=void 0;a.push(i)}}),a.length?{allOf:a,...r}:void 0}function zhe(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let vS;const gs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(vS===void 0&&(vS=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),vS),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function p8(e,t){const n={type:"string"};function r(a){return t.patternStrategy==="escape"?Uhe(a):a}if(e.checks)for(const a of e.checks)switch(a.kind){case"min":Et(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t);break;case"max":Et(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":da(n,"email",a.message,t);break;case"format:idn-email":da(n,"idn-email",a.message,t);break;case"pattern:zod":pa(n,gs.email,a.message,t);break}break;case"url":da(n,"uri",a.message,t);break;case"uuid":da(n,"uuid",a.message,t);break;case"regex":pa(n,a.regex,a.message,t);break;case"cuid":pa(n,gs.cuid,a.message,t);break;case"cuid2":pa(n,gs.cuid2,a.message,t);break;case"startsWith":pa(n,RegExp(`^${r(a.value)}`),a.message,t);break;case"endsWith":pa(n,RegExp(`${r(a.value)}$`),a.message,t);break;case"datetime":da(n,"date-time",a.message,t);break;case"date":da(n,"date",a.message,t);break;case"time":da(n,"time",a.message,t);break;case"duration":da(n,"duration",a.message,t);break;case"length":Et(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t),Et(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"includes":{pa(n,RegExp(r(a.value)),a.message,t);break}case"ip":{a.version!=="v6"&&da(n,"ipv4",a.message,t),a.version!=="v4"&&da(n,"ipv6",a.message,t);break}case"emoji":pa(n,gs.emoji,a.message,t);break;case"ulid":{pa(n,gs.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{da(n,"binary",a.message,t);break}case"contentEncoding:base64":{Et(n,"contentEncoding","base64",a.message,t);break}case"pattern:zod":{pa(n,gs.base64,a.message,t);break}}break}case"nanoid":pa(n,gs.nanoid,a.message,t)}return n}const Uhe=e=>Array.from(e).map(t=>/[a-zA-Z0-9]/.test(t)?t:`\\${t}`).join(""),da=(e,t,n,r)=>{var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Et(e,"format",t,n,r)},pa=(e,t,n,r)=>{var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:f8(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Et(e,"pattern",f8(t,r),n,r)},f8=(e,t)=>{var l;const n=typeof e=="function"?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},a=r.i?n.source.toLowerCase():n.source;let o="",i=!1,s=!1,c=!1;for(let u=0;u<a.length;u++){if(i){o+=a[u],i=!1;continue}if(r.i){if(s){if(a[u].match(/[a-z]/)){c?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),c=!1):a[u+1]==="-"&&((l=a[u+2])!=null&&l.match(/[a-z]/))?(o+=a[u],c=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(r.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&a[u]==="."){o+=s?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?i=!0:s&&a[u]==="]"?s=!1:!s&&a[u]==="["&&(s=!0)}try{const u=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return o};function h8(e,t){var r,a,o,i;if(t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((s,c)=>({...s,[c]:yt(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:yt(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===Q.ZodString&&((o=e.keyType._def.checks)!=null&&o.length)){const s=Object.entries(p8(e.keyType._def,t)).reduce((c,[l,u])=>l==="type"?c:{...c,[l]:u},{});return{...n,propertyNames:s}}else if(((i=e.keyType)==null?void 0:i._def.typeName)===Q.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};return n}function Vhe(e,t){if(t.mapStrategy==="record")return h8(e,t);const n=yt(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},r=yt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function qhe(e){const t=e.values,n=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),r=Array.from(new Set(n.map(a=>typeof a)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:n}}function Whe(){return{not:{}}}function Hhe(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Qm={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Khe(e,t){if(t.target==="openApi3")return m8(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in Qm&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,o)=>{const i=Qm[o._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,o)=>{const i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((o,i,s)=>s.indexOf(o)===i);return{type:a.length>1?a:a[0],enum:n.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(o=>!r.includes(o))],[])};return m8(e,t)}const m8=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>yt(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function Zhe(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Qm[e.innerType._def.typeName],nullable:!0}:{type:[Qm[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=yt(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=yt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function Ghe(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",u8(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Et(n,"minimum",r.value,r.message,t):Et(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Et(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Et(n,"maximum",r.value,r.message,t):Et(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Et(n,"maximum",r.value,r.message,t));break;case"multipleOf":Et(n,"multipleOf",r.value,r.message,t);break}return n}function Xhe(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":yt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":yt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function Jhe(e,t){const n={type:"object",...Object.entries(e.shape()).reduce((r,[a,o])=>{if(o===void 0||o._def===void 0)return r;const i=yt(o._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return i===void 0?r:{properties:{...r.properties,[a]:i},required:o.isOptional()?r.required:[...r.required,a]}},{properties:{},required:[]}),additionalProperties:Xhe(e,t)};return n.required.length||delete n.required,n}const Yhe=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return yt(e.innerType._def,t);const n=yt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},Qhe=(e,t)=>{if(t.pipeStrategy==="input")return yt(e.in._def,t);if(t.pipeStrategy==="output")return yt(e.out._def,t);const n=yt(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=yt(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function eme(e,t){return yt(e.type._def,t)}function tme(e,t){const n={type:"array",uniqueItems:!0,items:yt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Et(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Et(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function nme(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>yt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:yt(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>yt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function rme(){return{not:{}}}function ame(){return{}}const ome=(e,t)=>yt(e.innerType._def,t);function yt(e,t,n=!1){var i;const r=t.seen.get(e);if(t.override){const s=(i=t.override)==null?void 0:i.call(t,e,t,r,n);if(s!==Ehe)return s}if(r&&!n){const s=ime(r,t);if(s!==void 0)return s}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const o=cme(e,e.typeName,t);return o&&lme(e,t,o),a.jsonSchema=o,o}const ime=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:sme(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},sme=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},cme=(e,t,n)=>{switch(t){case Q.ZodString:return p8(e,n);case Q.ZodNumber:return Ghe(e,n);case Q.ZodObject:return Jhe(e,n);case Q.ZodBigInt:return Phe(e,n);case Q.ZodBoolean:return Ahe();case Q.ZodDate:return d8(e,n);case Q.ZodUndefined:return rme();case Q.ZodNull:return Hhe(n);case Q.ZodArray:return khe(e,n);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return Khe(e,n);case Q.ZodIntersection:return Bhe(e,n);case Q.ZodTuple:return nme(e,n);case Q.ZodRecord:return h8(e,n);case Q.ZodLiteral:return zhe(e,n);case Q.ZodEnum:return $he(e);case Q.ZodNativeEnum:return qhe(e);case Q.ZodNullable:return Zhe(e,n);case Q.ZodOptional:return Yhe(e,n);case Q.ZodMap:return Vhe(e,n);case Q.ZodSet:return tme(e,n);case Q.ZodLazy:return yt(e.getter()._def,n);case Q.ZodPromise:return eme(e,n);case Q.ZodNaN:case Q.ZodNever:return Whe();case Q.ZodEffects:return Lhe(e,n);case Q.ZodAny:return Mhe();case Q.ZodUnknown:return ame();case Q.ZodDefault:return Dhe(e,n);case Q.ZodBranded:return The(e,n);case Q.ZodReadonly:return ome(e,n);case Q.ZodCatch:return Ihe(e,n);case Q.ZodPipeline:return Qhe(e,n);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(r=>{})()}},lme=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),ume=(e,t)=>{const n=Nhe(t),r=void 0,a=t==null?void 0:t.name,o=yt(e._def,n,!1)??{},i=a===void 0?r?{...o,[n.definitionPath]:r}:o:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:o}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i},dme=Symbol("Let zodToJsonSchema decide on which parser to use"),y8={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},pme=e=>typeof e=="string"?{...y8,basePath:["#"],definitions:{},name:e}:{...y8,basePath:["#"],definitions:{},...e},bS=e=>"_def"in e?e._def:e;function fme(e){if(!e)return!0;for(const t in e)return!1;return!0}const hme=e=>{const t=pme(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[bS(a),{def:bS(a),path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function g8(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ot(e,t,n,r,a){e[t]=n,g8(e,t,r,a)}function mme(){return{}}function yme(e,t){var r,a;const n={type:"array"};return((a=(r=e.type)==null?void 0:r._def)==null?void 0:a.typeName)!==Q.ZodAny&&(n.items=pt(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ot(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ot(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ot(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ot(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function gme(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Ot(n,"minimum",r.value,r.message,t):Ot(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ot(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ot(n,"maximum",r.value,r.message,t):Ot(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ot(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ot(n,"multipleOf",r.value,r.message,t);break}return n}function vme(){return{type:"boolean"}}function bme(e,t){return pt(e.type._def,t)}const wme=(e,t)=>pt(e.innerType._def,t);function v8(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,o)=>v8(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return xme(e,t)}}const xme=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Ot(n,"minimum",r.value,r.message,t);break;case"max":Ot(n,"maximum",r.value,r.message,t);break}return n};function _me(e,t){return{...pt(e.innerType._def,t),default:e.defaultValue()}}function jme(e,t,n){return t.effectStrategy==="input"?pt(e.schema._def,t,n):{}}function Sme(e){return{type:"string",enum:[...e.values]}}const Eme=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Ome(e,t){const n=[pt(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),pt(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(o=>{if(Eme(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(r=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:s,...c}=o;i=c}else r=void 0;a.push(i)}}),a.length?{allOf:a,...r}:void 0}function Cme(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let wS;const vs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(wS===void 0&&(wS=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),wS),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function b8(e,t){const n={type:"string"};function r(a){return t.patternStrategy==="escape"?Nme(a):a}if(e.checks)for(const a of e.checks)switch(a.kind){case"min":Ot(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t);break;case"max":Ot(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":fa(n,"email",a.message,t);break;case"format:idn-email":fa(n,"idn-email",a.message,t);break;case"pattern:zod":ha(n,vs.email,a.message,t);break}break;case"url":fa(n,"uri",a.message,t);break;case"uuid":fa(n,"uuid",a.message,t);break;case"regex":ha(n,a.regex,a.message,t);break;case"cuid":ha(n,vs.cuid,a.message,t);break;case"cuid2":ha(n,vs.cuid2,a.message,t);break;case"startsWith":ha(n,RegExp(`^${r(a.value)}`),a.message,t);break;case"endsWith":ha(n,RegExp(`${r(a.value)}$`),a.message,t);break;case"datetime":fa(n,"date-time",a.message,t);break;case"date":fa(n,"date",a.message,t);break;case"time":fa(n,"time",a.message,t);break;case"duration":fa(n,"duration",a.message,t);break;case"length":Ot(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t),Ot(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"includes":{ha(n,RegExp(r(a.value)),a.message,t);break}case"ip":{a.version!=="v6"&&fa(n,"ipv4",a.message,t),a.version!=="v4"&&fa(n,"ipv6",a.message,t);break}case"emoji":ha(n,vs.emoji,a.message,t);break;case"ulid":{ha(n,vs.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{fa(n,"binary",a.message,t);break}case"contentEncoding:base64":{Ot(n,"contentEncoding","base64",a.message,t);break}case"pattern:zod":{ha(n,vs.base64,a.message,t);break}}break}case"nanoid":ha(n,vs.nanoid,a.message,t)}return n}const Nme=e=>Array.from(e).map(t=>/[a-zA-Z0-9]/.test(t)?t:`\\${t}`).join(""),fa=(e,t,n,r)=>{var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ot(e,"format",t,n,r)},ha=(e,t,n,r)=>{var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:w8(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ot(e,"pattern",w8(t,r),n,r)},w8=(e,t)=>{var l;const n=typeof e=="function"?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},a=r.i?n.source.toLowerCase():n.source;let o="",i=!1,s=!1,c=!1;for(let u=0;u<a.length;u++){if(i){o+=a[u],i=!1;continue}if(r.i){if(s){if(a[u].match(/[a-z]/)){c?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),c=!1):a[u+1]==="-"&&((l=a[u+2])!=null&&l.match(/[a-z]/))?(o+=a[u],c=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(r.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&a[u]==="."){o+=s?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?i=!0:s&&a[u]==="]"?s=!1:!s&&a[u]==="["&&(s=!0)}try{const u=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return o};function x8(e,t){var r,a,o,i;if(t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((s,c)=>({...s,[c]:pt(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:pt(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===Q.ZodString&&((o=e.keyType._def.checks)!=null&&o.length)){const s=Object.entries(b8(e.keyType._def,t)).reduce((c,[l,u])=>l==="type"?c:{...c,[l]:u},{});return{...n,propertyNames:s}}else if(((i=e.keyType)==null?void 0:i._def.typeName)===Q.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};return n}function Mme(e,t){if(t.mapStrategy==="record")return x8(e,t);const n=pt(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},r=pt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function kme(e){const t=e.values,n=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),r=Array.from(new Set(n.map(a=>typeof a)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:n}}function Pme(){return{not:{}}}function Ame(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const ey={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Tme(e,t){if(t.target==="openApi3")return _8(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in ey&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,o)=>{const i=ey[o._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,o)=>{const i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((o,i,s)=>s.indexOf(o)===i);return{type:a.length>1?a:a[0],enum:n.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(o=>!r.includes(o))],[])};return _8(e,t)}const _8=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>pt(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function Ime(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"||t.nullableStrategy==="property"?{type:ey[e.innerType._def.typeName],nullable:!0}:{type:[ey[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=pt(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=pt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function Rme(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",g8(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Ot(n,"minimum",r.value,r.message,t):Ot(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ot(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ot(n,"maximum",r.value,r.message,t):Ot(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ot(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ot(n,"multipleOf",r.value,r.message,t);break}return n}function Dme(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":pt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":pt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function Lme(e,t){const n={type:"object",...Object.entries(e.shape()).reduce((r,[a,o])=>{if(o===void 0||o._def===void 0)return r;const i=pt(o._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return i===void 0?r:{properties:{...r.properties,[a]:i},required:o.isOptional()&&!t.openaiStrictMode?r.required:[...r.required,a]}},{properties:{},required:[]}),additionalProperties:Dme(e,t)};return n.required.length||delete n.required,n}const $me=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return pt(e.innerType._def,t);const n=pt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},Fme=(e,t)=>{if(t.pipeStrategy==="input")return pt(e.in._def,t);if(t.pipeStrategy==="output")return pt(e.out._def,t);const n=pt(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=pt(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function Bme(e,t){return pt(e.type._def,t)}function zme(e,t){const n={type:"array",uniqueItems:!0,items:pt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ot(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ot(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function Ume(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>pt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:pt(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>pt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function Vme(){return{not:{}}}function qme(){return{}}const Wme=(e,t)=>pt(e.innerType._def,t);function pt(e,t,n=!1){var i;const r=t.seen.get(e);if(t.override){const s=(i=t.override)==null?void 0:i.call(t,e,t,r,n);if(s!==dme)return s}if(r&&!n){const s=Hme(r,t);if(s!==void 0)return"$ref"in s&&t.seenRefs.add(s.$ref),s}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const o=Zme(e,e.typeName,t,n);return o&&Gme(e,t,o),a.jsonSchema=o,o}const Hme=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":const n=e.path.slice(t.basePath.length+1).join("_");return n!==t.name&&t.nameStrategy==="duplicate-ref"&&(t.definitions[n]=e.def),{$ref:[...t.basePath,t.definitionPath,n].join("/")};case"relative":return{$ref:Kme(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,a)=>t.currentPath[a]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},Kme=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},Zme=(e,t,n,r)=>{switch(t){case Q.ZodString:return b8(e,n);case Q.ZodNumber:return Rme(e,n);case Q.ZodObject:return Lme(e,n);case Q.ZodBigInt:return gme(e,n);case Q.ZodBoolean:return vme();case Q.ZodDate:return v8(e,n);case Q.ZodUndefined:return Vme();case Q.ZodNull:return Ame(n);case Q.ZodArray:return yme(e,n);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return Tme(e,n);case Q.ZodIntersection:return Ome(e,n);case Q.ZodTuple:return Ume(e,n);case Q.ZodRecord:return x8(e,n);case Q.ZodLiteral:return Cme(e,n);case Q.ZodEnum:return Sme(e);case Q.ZodNativeEnum:return kme(e);case Q.ZodNullable:return Ime(e,n);case Q.ZodOptional:return $me(e,n);case Q.ZodMap:return Mme(e,n);case Q.ZodSet:return zme(e,n);case Q.ZodLazy:return pt(e.getter()._def,n);case Q.ZodPromise:return Bme(e,n);case Q.ZodNaN:case Q.ZodNever:return Pme();case Q.ZodEffects:return jme(e,n,r);case Q.ZodAny:return mme();case Q.ZodUnknown:return qme();case Q.ZodDefault:return _me(e,n);case Q.ZodBranded:return bme(e,n);case Q.ZodReadonly:return Wme(e,n);case Q.ZodCatch:return wme(e,n);case Q.ZodPipeline:return Fme(e,n);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(a=>{})()}},Gme=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Xme=(e,t)=>{const n=hme(t),r=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,a=pt(e._def,r===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(a.title=o);const i=(()=>{if(fme(n.definitions))return;const c={},l=new Set;for(let u=0;u<500;u++){const d=Object.entries(n.definitions).filter(([p])=>!l.has(p));if(d.length===0)break;for(const[p,f]of d)c[p]=pt(bS(f),{...n,currentPath:[...n.basePath,n.definitionPath,p]},!0)??{},l.add(p)}return c})(),s=r===void 0?i?{...a,[n.definitionPath]:i}:a:n.nameStrategy==="duplicate-ref"?{...a,...i||n.seenRefs.size?{[n.definitionPath]:{...i,...n.seenRefs.size?{[r]:a}:void 0}}:void 0}:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...i,[r]:a}};return n.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),s};function j8(e,t){return Xme(e,{openaiStrictMode:!0,name:t.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Jme(e,t,n){return ehe({type:"json_schema",json_schema:{...n,name:t,strict:!0,schema:j8(e,{name:t})}},r=>e.parse(JSON.parse(r)))}function Yme(e){return the({type:"function",function:{name:e.name,parameters:j8(e.parameters,{name:e.name}),strict:!0,...e.description?{description:e.description}:void 0}},{callback:e.function,parser:t=>e.parameters.parse(JSON.parse(t))})}function Qme(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:o,azureADTokenProvider:i,azureOpenAIEndpoint:s}=e;if((r||i)&&a&&t)return`${a}/${t}`;if((r||i)&&s&&t)return`${s}/openai/deployments/${t}`;if(r||i){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return o}function S8(e,t){const n=typeof t=="number"?void 0:t;return{name:e.name,description:e.description,parameters:UM(e.schema),...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}}function eye(e,t){let n;return ty(e)?n={type:"function",function:S8(e)}:n=e,n}function tye(e){return e!==void 0&&Array.isArray(e.lc_namespace)}function nye(e){return e!==void 0&&yf.isRunnable(e)&&"lc_name"in e.constructor&&typeof e.constructor.lc_name=="function"&&e.constructor.lc_name()==="RunnableToolLike"}function rye(e){return!!e&&typeof e=="object"&&"name"in e&&"schema"in e&&Xd(e.schema)}function ty(e){return rye(e)||nye(e)||tye(e)}function ny(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/
`,e}function E8(e){let t;return e.constructor.name===Am.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===kr.name?(t=new Error(e.message),t.name="AbortError"):e.status===400&&e.message.includes("tool_calls")?t=ny(e,"INVALID_TOOL_RESULTS"):e.status===401?t=ny(e,"MODEL_AUTHENTICATION"):e.status===429?t=ny(e,"MODEL_RATE_LIMIT"):e.status===404?t=ny(e,"MODEL_NOT_FOUND"):t=e,t}function aye(e){if(e)return e==="any"||e==="required"?"required":e==="auto"?"auto":e==="none"?"none":typeof e=="string"?{type:"function",function:{name:e}}:e}function oye(e){return e.anyOf!==void 0&&Array.isArray(e.anyOf)}function iye(e){const t=["namespace functions {",""];for(const n of e)n.description&&t.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(t.push(`type ${n.name} = (_: {`),t.push(O8(n.parameters,0)),t.push("}) => any;")):t.push(`type ${n.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join(`
`)}function O8(e,t){var r;const n=[];for(const[a,o]of Object.entries(e.properties??{}))o.description&&t<2&&n.push(`// ${o.description}`),(r=e.required)!=null&&r.includes(a)?n.push(`${a}: ${ry(o,t)},`):n.push(`${a}?: ${ry(o,t)},`);return n.map(a=>" ".repeat(t)+a).join(`
`)}function ry(e,t){if(oye(e))return e.anyOf.map(n=>ry(n,t)).join(" | ");switch(e.type){case"string":return e.enum?e.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return e.enum?e.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return e.enum?e.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",O8(e,t+2),"}"].join(`
`);case"array":return e.items?`${ry(e.items,t)}[]`:"any[]";default:return""}}function sye(e,t){let n;if(ty(e)){const r=Yme({name:e.name,parameters:e.schema,description:e.description});r.function.parameters?n={type:r.type,function:{name:r.function.name,description:r.function.description,parameters:r.function.parameters,...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}:n={type:"function",function:S8(e,t)}}else n=e;return(t==null?void 0:t.strict)!==void 0&&(n.function.strict=t.strict),n}function cye(e){return e.role!=="system"&&e.role!=="developer"&&e.role!=="assistant"&&e.role!=="user"&&e.role!=="function"&&e.role!=="tool"&&console.warn(`Unknown message role: ${e.role}`),e.role}function C8(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Mv.isInstance(e))throw new Error("Invalid generic chat message");return cye(e)}default:throw new Error(`Unknown message type: ${t}`)}}function lye(e,t,n){const r=e.tool_calls;switch(e.role){case"assistant":{const a=[],o=[];for(const c of r??[])try{a.push(gS(c,{returnId:!0}))}catch(l){o.push(l8(c,l.message))}const i={function_call:e.function_call,tool_calls:r};n!==void 0&&(i.__raw_response=t);const s={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(i.audio=e.audio),new Aa({content:e.content||"",tool_calls:a,invalid_tool_calls:o,additional_kwargs:i,response_metadata:s,id:t.id})}default:return new Mv(e.content||"",e.role??"unknown")}}function uye(e,t,n,r){var c,l;const a=e.role??n,o=e.content??"";let i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},r&&(i.__raw_response=t),e.audio&&(i.audio={...e.audio,index:t.choices[0].index});const s={usage:{...t.usage}};if(a==="user")return new HG({content:o,response_metadata:s});if(a==="assistant"){const u=[];if(Array.isArray(e.tool_calls))for(const d of e.tool_calls)u.push({name:(c=d.function)==null?void 0:c.name,args:(l=d.function)==null?void 0:l.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new nu({content:o,tool_call_chunks:u,additional_kwargs:i,id:t.id,response_metadata:s})}else return a==="system"?new VM({content:o,response_metadata:s}):a==="developer"?new VM({content:o,response_metadata:s,additional_kwargs:{__openai_role__:"developer"}}):a==="function"?new KDe({content:o,additional_kwargs:i,name:e.name,response_metadata:s}):a==="tool"?new ZDe({content:o,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:s}):new KG({content:o,role:a,response_metadata:s})}function N8(e,t){return e.flatMap(n=>{var o;let r=C8(n);r==="system"&&(t!=null&&t.startsWith("o1"))&&(r="developer");const a={role:r,content:n.content};if(n.name!=null&&(a.name=n.name),n.additional_kwargs.function_call!=null&&(a.function_call=n.additional_kwargs.function_call,a.content=null),Nv(n)&&((o=n.tool_calls)!=null&&o.length)?(a.tool_calls=n.tool_calls.map(c8),a.content=null):(n.additional_kwargs.tool_calls!=null&&(a.tool_calls=n.additional_kwargs.tool_calls),n.tool_call_id!=null&&(a.tool_call_id=n.tool_call_id)),n.additional_kwargs.audio&&typeof n.additional_kwargs.audio=="object"&&"id"in n.additional_kwargs.audio){const i={role:"assistant",audio:{id:n.additional_kwargs.audio.id}};return[a,i]}return a})}function M8(e,t){return fS(e)?(t==null?void 0:t.strict)!==void 0?{...e,function:{...e.function,strict:t.strict}}:e:sye(e,t)}class dye extends Xa{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(t,n){var r,a,o,i,s,c,l,u,d;if(super(t??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIEndpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(t==null?void 0:t.apiKey)??(t==null?void 0:t.openAIApiKey)??((r=t==null?void 0:t.configuration)==null?void 0:r.apiKey)??po("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=(t==null?void 0:t.azureOpenAIApiKey)??po("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=(t==null?void 0:t.azureADTokenProvider)??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=(t==null?void 0:t.azureOpenAIApiInstanceName)??po("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(t==null?void 0:t.azureOpenAIApiDeploymentName)??po("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(t==null?void 0:t.azureOpenAIApiVersion)??po("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(t==null?void 0:t.azureOpenAIBasePath)??po("AZURE_OPENAI_BASE_PATH"),this.organization=((a=t==null?void 0:t.configuration)==null?void 0:a.organization)??po("OPENAI_ORGANIZATION"),this.azureOpenAIEndpoint=(t==null?void 0:t.azureOpenAIEndpoint)??po("AZURE_OPENAI_ENDPOINT"),this.modelName=(t==null?void 0:t.model)??(t==null?void 0:t.modelName)??this.model,this.model=this.modelName,this.modelKwargs=(t==null?void 0:t.modelKwargs)??{},this.timeout=t==null?void 0:t.timeout,this.temperature=(t==null?void 0:t.temperature)??this.temperature,this.topP=(t==null?void 0:t.topP)??this.topP,this.frequencyPenalty=(t==null?void 0:t.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(t==null?void 0:t.presencePenalty)??this.presencePenalty,this.maxTokens=t==null?void 0:t.maxTokens,this.logprobs=t==null?void 0:t.logprobs,this.topLogprobs=t==null?void 0:t.topLogprobs,this.n=(t==null?void 0:t.n)??this.n,this.logitBias=t==null?void 0:t.logitBias,this.stop=(t==null?void 0:t.stopSequences)??(t==null?void 0:t.stop),this.stopSequences=this==null?void 0:this.stop,this.user=t==null?void 0:t.user,this.__includeRawResponse=t==null?void 0:t.__includeRawResponse,this.audio=t==null?void 0:t.audio,this.modalities=t==null?void 0:t.modalities,this.reasoningEffort=t==null?void 0:t.reasoningEffort,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath&&!this.azureOpenAIEndpoint)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName&&this.azureOpenAIBasePath){const p=this.azureOpenAIBasePath.split("/openai/deployments/");if(p.length===2){const[,f]=p;this.azureOpenAIApiDeploymentName=f}}if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??"",this.streamUsage=!1}this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(t==null?void 0:t.streaming)??!1,this.streamUsage=(t==null?void 0:t.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:(n==null?void 0:n.basePath)??((o=t==null?void 0:t.configuration)==null?void 0:o.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=n==null?void 0:n.baseOptions)==null?void 0:i.headers)??((c=(s=t==null?void 0:t.configuration)==null?void 0:s.baseOptions)==null?void 0:c.headers),defaultQuery:((l=n==null?void 0:n.baseOptions)==null?void 0:l.params)??((d=(u=t==null?void 0:t.configuration)==null?void 0:u.baseOptions)==null?void 0:d.params),...n,...t==null?void 0:t.configuration},(t==null?void 0:t.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=t.supportsStrictToolCalling)}getLsParams(t){const n=this.invocationParams(t);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??void 0,ls_max_tokens:n.max_tokens??void 0,ls_stop:t.stop}}bindTools(t,n){let r;return(n==null?void 0:n.strict)!==void 0?r=n.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:t.map(a=>M8(a,{strict:r})),...n})}createResponseFormat(t){return t&&t.type==="json_schema"&&t.json_schema.schema&&ay(t.json_schema.schema)?Jme(t.json_schema.schema,t.json_schema.name,{description:t.json_schema.description}):t}invocationParams(t,n){var s;let r;(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let a={};(t==null?void 0:t.stream_options)!==void 0?a={stream_options:t.stream_options}:this.streamUsage&&(this.streaming||n!=null&&n.streaming)&&(a={stream_options:{include_usage:!0}});const o={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(t==null?void 0:t.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:t==null?void 0:t.functions,function_call:t==null?void 0:t.function_call,tools:(s=t==null?void 0:t.tools)!=null&&s.length?t.tools.map(c=>M8(c,{strict:r})):void 0,tool_choice:aye(t==null?void 0:t.tool_choice),response_format:this.createResponseFormat(t==null?void 0:t.response_format),seed:t==null?void 0:t.seed,...a,parallel_tool_calls:t==null?void 0:t.parallel_tool_calls,...this.audio||t!=null&&t.audio?{audio:this.audio||(t==null?void 0:t.audio)}:{},...this.modalities||t!=null&&t.modalities?{modalities:this.modalities||(t==null?void 0:t.modalities)}:{},...this.modelKwargs};(t==null?void 0:t.prediction)!==void 0&&(o.prediction=t.prediction);const i=(t==null?void 0:t.reasoning_effort)??this.reasoningEffort;return i!==void 0&&(o.reasoning_effort=i),o}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(t,n,r){var l,u,d,p,f,m,y,v,b,w;const a=N8(t,this.model),o={...this.invocationParams(n,{streaming:!0}),messages:a,stream:!0};let i;const s=await this.completionWithRetry(o,n);let c;for await(const j of s){const x=(l=j==null?void 0:j.choices)==null?void 0:l[0];if(j.usage&&(c=j.usage),!x)continue;const{delta:_}=x;if(!_)continue;const S=uye(_,j,i,this.__includeRawResponse);i=_.role??i;const E={prompt:n.promptIndex??0,completion:x.index??0};if(typeof S.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const O={...E};x.finish_reason!=null&&(O.finish_reason=x.finish_reason,O.system_fingerprint=j.system_fingerprint,O.model_name=j.model),this.logprobs&&(O.logprobs=x.logprobs);const N=new Hi({message:S,text:S.content,generationInfo:O});yield N,await(r==null?void 0:r.handleLLMNewToken(N.text??"",E,void 0,void 0,void 0,{chunk:N}))}if(c){const j={...((u=c.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(d=c.prompt_tokens_details)==null?void 0:d.audio_tokens},...((p=c.prompt_tokens_details)==null?void 0:p.cached_tokens)!==null&&{cache_read:(f=c.prompt_tokens_details)==null?void 0:f.cached_tokens}},x={...((m=c.completion_tokens_details)==null?void 0:m.audio_tokens)!==null&&{audio:(y=c.completion_tokens_details)==null?void 0:y.audio_tokens},...((v=c.completion_tokens_details)==null?void 0:v.reasoning_tokens)!==null&&{reasoning:(b=c.completion_tokens_details)==null?void 0:b.reasoning_tokens}};yield new Hi({message:new nu({content:"",response_metadata:{usage:{...c}},usage_metadata:{input_tokens:c.prompt_tokens,output_tokens:c.completion_tokens,total_tokens:c.total_tokens,...Object.keys(j).length>0&&{input_token_details:j},...Object.keys(x).length>0&&{output_token_details:x}}}),text:""})}if((w=n.signal)!=null&&w.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(t,n,r){var s,c;const a={},o=this.invocationParams(n),i=N8(t,this.model);if(o.stream){const l=this._streamResponseChunks(t,n,r),u={};for await(const v of l){v.message.response_metadata={...v.generationInfo,...v.message.response_metadata};const b=((s=v.generationInfo)==null?void 0:s.completion)??0;u[b]===void 0?u[b]=v:u[b]=u[b].concat(v)}const d=Object.entries(u).sort(([v],[b])=>parseInt(v,10)-parseInt(b,10)).map(([v,b])=>b),{functions:p,function_call:f}=this.invocationParams(n),m=await this.getEstimatedTokenCountFromPrompt(t,p,f),y=await this.getNumTokensFromGenerations(d);return a.input_tokens=m,a.output_tokens=y,a.total_tokens=m+y,{generations:d,llmOutput:{estimatedTokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}else{let l;n.response_format&&n.response_format.type==="json_schema"?l=await this.betaParsedCompletionWithRetry({...o,stream:!1,messages:i},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options}):l=await this.completionWithRetry({...o,stream:!1,messages:i},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options});const{completion_tokens:u,prompt_tokens:d,total_tokens:p,prompt_tokens_details:f,completion_tokens_details:m}=(l==null?void 0:l.usage)??{};u&&(a.output_tokens=(a.output_tokens??0)+u),d&&(a.input_tokens=(a.input_tokens??0)+d),p&&(a.total_tokens=(a.total_tokens??0)+p),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.cached_tokens)!==null)&&(a.input_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.cached_tokens)!==null&&{cache_read:f==null?void 0:f.cached_tokens}}),((m==null?void 0:m.audio_tokens)!==null||(m==null?void 0:m.reasoning_tokens)!==null)&&(a.output_token_details={...(m==null?void 0:m.audio_tokens)!==null&&{audio:m==null?void 0:m.audio_tokens},...(m==null?void 0:m.reasoning_tokens)!==null&&{reasoning:m==null?void 0:m.reasoning_tokens}});const y=[];for(const v of(l==null?void 0:l.choices)??[]){const b={text:((c=v.message)==null?void 0:c.content)??"",message:lye(v.message??{role:"assistant"},l,this.__includeRawResponse)};b.generationInfo={...v.finish_reason?{finish_reason:v.finish_reason}:{},...v.logprobs?{logprobs:v.logprobs}:{}},Nv(b.message)&&(b.message.usage_metadata=a),b.message=new Aa(Object.fromEntries(Object.entries(b.message).filter(([w])=>!w.startsWith("lc_")))),y.push(b)}return{generations:y,llmOutput:{tokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(t,n,r){let a=(await this.getNumTokensFromMessages(t)).totalCount;if(n&&r!=="auto"){const o=iye(n);a+=await this.getNumTokens(o),a+=9}return n&&t.find(o=>o._getType()==="system")&&(a-=4),r==="none"?a+=1:typeof r=="object"&&(a+=await this.getNumTokens(r.name)+4),a}async getNumTokensFromGenerations(t){return(await Promise.all(t.map(async n=>{var r;return(r=n.message.additional_kwargs)!=null&&r.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,r)=>n+r,0)}async getNumTokensFromMessages(t){let n=0,r=0,a=0;this.model==="gpt-3.5-turbo-0301"?(r=4,a=-1):(r=3,a=1);const o=await Promise.all(t.map(async i=>{var p,f,m,y,v,b;const s=await this.getNumTokens(i.content),c=await this.getNumTokens(C8(i)),l=i.name!==void 0?a+await this.getNumTokens(i.name):0;let u=s+r+c+l;const d=i;if(d._getType()==="function"&&(u-=2),(p=d.additional_kwargs)!=null&&p.function_call&&(u+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(u+=await this.getNumTokens((m=d.additional_kwargs.function_call)==null?void 0:m.name)),(y=d.additional_kwargs.function_call)==null?void 0:y.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse((v=d.additional_kwargs.function_call)==null?void 0:v.arguments)))}catch(w){console.error("Error parsing function arguments",w,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)}return n+=u,u}));return n+=3,{totalCount:n,countPerMessage:o}}async completionWithRetry(t,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(t,r)}catch(a){throw E8(a)}})}async betaParsedCompletionWithRetry(t,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(t,r)}catch(a){throw E8(a)}})}_getClientOptions(t){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL,azureOpenAIEndpoint:this.azureOpenAIEndpoint},a=Qme(r),o={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};o.baseURL||delete o.baseURL,this.client=new ct(o)}const n={...this.clientConfig,...t};return this.azureOpenAIApiKey&&(n.headers={"api-key":this.azureOpenAIApiKey,...n.headers},n.query={"api-version":this.azureOpenAIApiVersion,...n.query}),n}_llmType(){return"openai"}_combineLLMOutput(...t){return t.reduce((n,r)=>(r&&r.tokenUsage&&(n.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,n.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,n.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),n),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(t,n){let r,a,o,i;pye(t)?(r=t.schema,a=t.name,o=t.method,i=t.includeRaw):(r=t,a=n==null?void 0:n.name,o=n==null?void 0:n.method,i=n==null?void 0:n.includeRaw);let s,c;if((n==null?void 0:n.strict)!==void 0&&o==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(o==="jsonMode")s=this.bind({response_format:{type:"json_object"}}),ay(r)?c=mS.fromZodSchema(r):c=new yS;else if(o==="jsonSchema")s=this.bind({response_format:{type:"json_schema",json_schema:{name:a??"extract",description:r.description,schema:r,strict:n==null?void 0:n.strict}}}),ay(r)?c=mS.fromZodSchema(r):c=new yS;else{let p=a??"extract";if(ay(r)){const f=ume(r);s=this.bind({tools:[{type:"function",function:{name:p,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:p}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),c=new Ym({returnSingle:!0,keyName:p,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,p=r.name):(p=r.title??p,f={name:p,description:r.description??"",parameters:r}),s=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:p}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),c=new Ym({returnSingle:!0,keyName:p})}}if(!i)return s.pipe(c);const l=_i.assign({parsed:(p,f)=>c.invoke(p.raw,f)}),u=_i.assign({parsed:()=>null}),d=l.withFallbacks({fallbacks:[u]});return Cv.from([{raw:s},d])}}function ay(e){return typeof(e==null?void 0:e.parse)=="function"}function pye(e){return e!==void 0&&typeof e.schema=="object"}const fye=Symbol("Let zodToJsonSchema decide on which parser to use"),hye={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},mye=e=>({...hye,...e}),yye=e=>{const t=mye(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function k8(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ct(e,t,n,r,a){e[t]=n,k8(e,t,r,a)}function gye(){return{}}function vye(e,t){var r,a;const n={type:"array"};return((a=(r=e.type)==null?void 0:r._def)==null?void 0:a.typeName)!==Q.ZodAny&&(n.items=gt(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ct(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ct(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ct(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ct(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function bye(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Ct(n,"minimum",r.value,r.message,t):Ct(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ct(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ct(n,"maximum",r.value,r.message,t):Ct(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ct(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ct(n,"multipleOf",r.value,r.message,t);break}return n}function wye(){return{type:"boolean"}}function xye(e,t){return gt(e.type._def,t)}const _ye=(e,t)=>gt(e.innerType._def,t);function P8(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,o)=>P8(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return jye(e,t)}}const jye=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Ct(n,"minimum",r.value,r.message,t);break;case"max":Ct(n,"maximum",r.value,r.message,t);break}return n};function Sye(e,t){return{...gt(e.innerType._def,t),default:e.defaultValue()}}function Eye(e,t){return t.effectStrategy==="input"?gt(e.schema._def,t):{}}function Oye(e){return{type:"string",enum:e.values}}const Cye=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Nye(e,t){const n=[gt(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),gt(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(o=>{if(Cye(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(r=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:s,...c}=o;i=c}else r=void 0;a.push(i)}}),a.length?{allOf:a,...r}:void 0}function Mye(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let xS;const bs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(xS===void 0&&(xS=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),xS),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function A8(e,t){const n={type:"string"};function r(a){return t.patternStrategy==="escape"?kye(a):a}if(e.checks)for(const a of e.checks)switch(a.kind){case"min":Ct(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t);break;case"max":Ct(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":ma(n,"email",a.message,t);break;case"format:idn-email":ma(n,"idn-email",a.message,t);break;case"pattern:zod":ya(n,bs.email,a.message,t);break}break;case"url":ma(n,"uri",a.message,t);break;case"uuid":ma(n,"uuid",a.message,t);break;case"regex":ya(n,a.regex,a.message,t);break;case"cuid":ya(n,bs.cuid,a.message,t);break;case"cuid2":ya(n,bs.cuid2,a.message,t);break;case"startsWith":ya(n,RegExp(`^${r(a.value)}`),a.message,t);break;case"endsWith":ya(n,RegExp(`${r(a.value)}$`),a.message,t);break;case"datetime":ma(n,"date-time",a.message,t);break;case"date":ma(n,"date",a.message,t);break;case"time":ma(n,"time",a.message,t);break;case"duration":ma(n,"duration",a.message,t);break;case"length":Ct(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,a.value):a.value,a.message,t),Ct(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,a.value):a.value,a.message,t);break;case"includes":{ya(n,RegExp(r(a.value)),a.message,t);break}case"ip":{a.version!=="v6"&&ma(n,"ipv4",a.message,t),a.version!=="v4"&&ma(n,"ipv6",a.message,t);break}case"emoji":ya(n,bs.emoji,a.message,t);break;case"ulid":{ya(n,bs.ulid,a.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{ma(n,"binary",a.message,t);break}case"contentEncoding:base64":{Ct(n,"contentEncoding","base64",a.message,t);break}case"pattern:zod":{ya(n,bs.base64,a.message,t);break}}break}case"nanoid":ya(n,bs.nanoid,a.message,t)}return n}const kye=e=>Array.from(e).map(t=>/[a-zA-Z0-9]/.test(t)?t:`\\${t}`).join(""),ma=(e,t,n,r)=>{var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ct(e,"format",t,n,r)},ya=(e,t,n,r)=>{var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:T8(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ct(e,"pattern",T8(t,r),n,r)},T8=(e,t)=>{var l;const n=typeof e=="function"?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},a=r.i?n.source.toLowerCase():n.source;let o="",i=!1,s=!1,c=!1;for(let u=0;u<a.length;u++){if(i){o+=a[u],i=!1;continue}if(r.i){if(s){if(a[u].match(/[a-z]/)){c?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),c=!1):a[u+1]==="-"&&((l=a[u+2])!=null&&l.match(/[a-z]/))?(o+=a[u],c=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(r.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(r.s&&a[u]==="."){o+=s?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?i=!0:s&&a[u]==="]"?s=!1:!s&&a[u]==="["&&(s=!0)}try{const u=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return o};function I8(e,t){var r,a,o,i;if(t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((s,c)=>({...s,[c]:gt(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:gt(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===Q.ZodString&&((o=e.keyType._def.checks)!=null&&o.length)){const s=Object.entries(A8(e.keyType._def,t)).reduce((c,[l,u])=>l==="type"?c:{...c,[l]:u},{});return{...n,propertyNames:s}}else if(((i=e.keyType)==null?void 0:i._def.typeName)===Q.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};return n}function Pye(e,t){if(t.mapStrategy==="record")return I8(e,t);const n=gt(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},r=gt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function Aye(e){const t=e.values,n=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),r=Array.from(new Set(n.map(a=>typeof a)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:n}}function Tye(){return{not:{}}}function Iye(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const oy={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Rye(e,t){if(t.target==="openApi3")return R8(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in oy&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,o)=>{const i=oy[o._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,o)=>{const i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((o,i,s)=>s.indexOf(o)===i);return{type:a.length>1?a:a[0],enum:n.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(o=>!r.includes(o))],[])};return R8(e,t)}const R8=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>gt(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function Dye(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:oy[e.innerType._def.typeName],nullable:!0}:{type:[oy[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=gt(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=gt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function Lye(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",k8(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Ct(n,"minimum",r.value,r.message,t):Ct(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ct(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ct(n,"maximum",r.value,r.message,t):Ct(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ct(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ct(n,"multipleOf",r.value,r.message,t);break}return n}function $ye(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":gt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":gt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function Fye(e,t){const n={type:"object",...Object.entries(e.shape()).reduce((r,[a,o])=>{if(o===void 0||o._def===void 0)return r;const i=gt(o._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return i===void 0?r:{properties:{...r.properties,[a]:i},required:o.isOptional()?r.required:[...r.required,a]}},{properties:{},required:[]}),additionalProperties:$ye(e,t)};return n.required.length||delete n.required,n}const Bye=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return gt(e.innerType._def,t);const n=gt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},zye=(e,t)=>{if(t.pipeStrategy==="input")return gt(e.in._def,t);if(t.pipeStrategy==="output")return gt(e.out._def,t);const n=gt(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=gt(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function Uye(e,t){return gt(e.type._def,t)}function Vye(e,t){const n={type:"array",uniqueItems:!0,items:gt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ct(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ct(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function qye(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>gt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:gt(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>gt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function Wye(){return{not:{}}}function Hye(){return{}}const Kye=(e,t)=>gt(e.innerType._def,t);function gt(e,t,n=!1){var i;const r=t.seen.get(e);if(t.override){const s=(i=t.override)==null?void 0:i.call(t,e,t,r,n);if(s!==fye)return s}if(r&&!n){const s=Zye(r,t);if(s!==void 0)return s}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const o=Xye(e,e.typeName,t);return o&&Jye(e,t,o),a.jsonSchema=o,o}const Zye=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Gye(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},Gye=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},Xye=(e,t,n)=>{switch(t){case Q.ZodString:return A8(e,n);case Q.ZodNumber:return Lye(e,n);case Q.ZodObject:return Fye(e,n);case Q.ZodBigInt:return bye(e,n);case Q.ZodBoolean:return wye();case Q.ZodDate:return P8(e,n);case Q.ZodUndefined:return Wye();case Q.ZodNull:return Iye(n);case Q.ZodArray:return vye(e,n);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return Rye(e,n);case Q.ZodIntersection:return Nye(e,n);case Q.ZodTuple:return qye(e,n);case Q.ZodRecord:return I8(e,n);case Q.ZodLiteral:return Mye(e,n);case Q.ZodEnum:return Oye(e);case Q.ZodNativeEnum:return Aye(e);case Q.ZodNullable:return Dye(e,n);case Q.ZodOptional:return Bye(e,n);case Q.ZodMap:return Pye(e,n);case Q.ZodSet:return Vye(e,n);case Q.ZodLazy:return gt(e.getter()._def,n);case Q.ZodPromise:return Uye(e,n);case Q.ZodNaN:case Q.ZodNever:return Tye();case Q.ZodEffects:return Eye(e,n);case Q.ZodAny:return gye();case Q.ZodUnknown:return Hye();case Q.ZodDefault:return Sye(e,n);case Q.ZodBranded:return xye(e,n);case Q.ZodReadonly:return Kye(e,n);case Q.ZodCatch:return _ye(e,n);case Q.ZodPipeline:return zye(e,n);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(r=>{})()}},Jye=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Yye=(e,t)=>{const n=yye(t),r=void 0,a=t==null?void 0:t.name,o=gt(e._def,n,!1)??{},i=a===void 0?r?{...o,[n.definitionPath]:r}:o:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:o}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i},Xc="0.5.0";let D8=!1,Jd,L8,$8,_S,F8,B8,z8,U8,V8;function Qye(e,t={auto:!1}){if(D8)throw new Error(`you must \`import 'groq-sdk/shims/${e.kind}'\` before importing anything else from groq-sdk`);if(Jd)throw new Error(`can't \`import 'groq-sdk/shims/${e.kind}'\` after \`import 'groq-sdk/shims/${Jd}'\``);D8=t.auto,Jd=e.kind,L8=e.fetch,$8=e.FormData,_S=e.File,F8=e.ReadableStream,B8=e.getMultipartRequestOptions,z8=e.getDefaultAgent,U8=e.fileFromPath,V8=e.isFsReadStream}class ege{constructor(t){this.body=t}get[Symbol.toStringTag](){return"MultipartBody"}}function tge({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n";let n,r,a,o;try{n=fetch,r=Request,a=Response,o=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:a,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(i,s)=>({...s,body:new ege(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:i=>!1}}Jd||Qye(tge(),{auto:!0});class ga extends Error{}class Ln extends ga{constructor(t,n,r,a){super(`${Ln.makeMessage(t,n,r)}`),this.status=t,this.headers=a,this.error=n}static makeMessage(t,n,r){const a=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,n,r,a){if(!t)return new iy({cause:NS(n)});const o=n;return t===400?new W8(t,o,r,a):t===401?new H8(t,o,r,a):t===403?new K8(t,o,r,a):t===404?new Z8(t,o,r,a):t===409?new G8(t,o,r,a):t===422?new X8(t,o,r,a):t===429?new J8(t,o,r,a):t>=500?new Y8(t,o,r,a):new Ln(t,o,r,a)}}class jS extends Ln{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0),this.status=void 0}}class iy extends Ln{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),this.status=void 0,n&&(this.cause=n)}}class q8 extends iy{constructor({message:t}={}){super({message:t??"Request timed out."})}}class W8 extends Ln{constructor(){super(...arguments),this.status=400}}class H8 extends Ln{constructor(){super(...arguments),this.status=401}}class K8 extends Ln{constructor(){super(...arguments),this.status=403}}class Z8 extends Ln{constructor(){super(...arguments),this.status=404}}class G8 extends Ln{constructor(){super(...arguments),this.status=409}}class X8 extends Ln{constructor(){super(...arguments),this.status=422}}class J8 extends Ln{constructor(){super(...arguments),this.status=429}}class Y8 extends Ln{}class Jc{constructor(t,n){this.iterator=t,this.controller=n}static fromSSEResponse(t,n){let r=!1;const a=new nge;async function*o(){if(!t.body)throw n.abort(),new ga("Attempted to iterate over a response with no body");const s=new ws,c=Q8(t.body);for await(const l of c)for(const u of s.decode(l)){const d=a.decode(u);d&&(yield d)}for(const l of s.flush()){const u=a.decode(l);u&&(yield u)}}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const c of o())if(!s){if(c.data.startsWith("[DONE]")){s=!0;continue}if(c.event===null){let l;try{l=JSON.parse(c.data)}catch(u){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),u}if(l&&l.error)throw new Ln(void 0,l.error,void 0,void 0);yield l}}s=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{s||n.abort()}}return new Jc(i,n)}static fromReadableStream(t,n){let r=!1;async function*a(){const i=new ws,s=Q8(t);for await(const c of s)for(const l of i.decode(c))yield l;for(const c of i.flush())yield c}async function*o(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const s of a())i||s&&(yield JSON.parse(s));i=!0}catch(s){if(s instanceof Error&&s.name==="AbortError")return;throw s}finally{i||n.abort()}}return new Jc(o,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),a=o=>({next:()=>{if(o.length===0){const i=r.next();t.push(i),n.push(i)}return o.shift()}});return[new Jc(()=>a(t),this.controller),new Jc(()=>a(n),this.controller)]}toReadableStream(){const t=this;let n;const r=new TextEncoder;return new F8({async start(){n=t[Symbol.asyncIterator]()},async pull(a){try{const{value:o,done:i}=await n.next();if(i)return a.close();const s=r.encode(JSON.stringify(o)+`
`);a.enqueue(s)}catch(o){a.error(o)}},async cancel(){var a;await((a=n.return)==null?void 0:a.call(n))}})}}class nge{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,r,a]=rge(t,":");return a.startsWith(" ")&&(a=a.substring(1)),n==="event"?this.event=a:n==="data"&&this.data.push(a),null}}class ws{constructor(){this.buffer=[],this.trailingCR=!1}decode(t){let n=this.decodeText(t);if(this.trailingCR&&(n="\r"+n,this.trailingCR=!1),n.endsWith("\r")&&(this.trailingCR=!0,n=n.slice(0,-1)),!n)return[];const r=ws.NEWLINE_CHARS.has(n[n.length-1]||"");let a=n.split(ws.NEWLINE_REGEXP);return a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof jn<"u"){if(t instanceof jn)return t.toString();if(t instanceof Uint8Array)return jn.from(t).toString();throw new ga(`Unexpected: received non-Uint8Array (${t.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(t instanceof Uint8Array||t instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(t);throw new ga(`Unexpected: received non-Uint8Array/ArrayBuffer (${t.constructor.name}) in a web platform. Please report this error.`)}throw new ga("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const t=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,t}}ws.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]),ws.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function rge(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}function Q8(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const e9=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function",t9=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&SS(e),SS=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",age=e=>t9(e)||e9(e)||V8(e);async function n9(e,t,n){var a;if(e=await e,n??(n=t9(e)?{lastModified:e.lastModified,type:e.type}:{}),e9(e)){const o=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new _S([o],t,n)}const r=await oge(e);if(t||(t=sge(e)??"unknown_file"),!n.type){const o=(a=r[0])==null?void 0:a.type;typeof o=="string"&&(n={...n,type:o})}return new _S(r,t,n)}async function oge(e){var n;let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(SS(e))t.push(await e.arrayBuffer());else if(cge(e))for await(const r of e)t.push(r);else throw new Error(`Unexpected data type: ${typeof e}; constructor: ${(n=e==null?void 0:e.constructor)==null?void 0:n.name}; props: ${ige(e)}`);return t}function ige(e){return`[${Object.getOwnPropertyNames(e).map(t=>`"${t}"`).join(", ")}]`}function sge(e){var t;return ES(e.name)||ES(e.filename)||((t=ES(e.path))==null?void 0:t.split(/[\\/]/).pop())}const ES=e=>{if(typeof e=="string")return e;if(typeof jn<"u"&&e instanceof jn)return String(e)},cge=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function",r9=e=>e&&typeof e=="object"&&e.body&&e[Symbol.toStringTag]==="MultipartBody",a9=async e=>{const t=await lge(e.body);return B8(t,e)},lge=async e=>{const t=new $8;return await Promise.all(Object.entries(e||{}).map(([n,r])=>OS(t,n,r))),t},OS=async(e,t,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")e.append(t,String(n));else if(age(n)){const r=await n9(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>OS(e,t+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,a])=>OS(e,`${t}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var Yc={};async function o9(e){const{response:t}=e;if(e.options.stream)return Qc("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Jc.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n!=null&&n.includes("application/json")||n!=null&&n.includes("application/vnd.api+json")){const a=await t.json();return Qc("response",t.status,t.url,t.headers,a),a}const r=await t.text();return Qc("response",t.status,t.url,t.headers,r),r}class sy extends Promise{constructor(t,n=o9){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n}_thenUnwrap(t){return new sy(this.responsePromise,async n=>t(await this.parseResponse(n)))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}class uge{constructor({baseURL:t,maxRetries:n=2,timeout:r=6e4,httpAgent:a,fetch:o}){this.baseURL=t,this.maxRetries=CS("maxRetries",n),this.timeout=CS("timeout",r),this.httpAgent=a,this.fetch=o??L8}authHeaders(t){return{}}defaultHeaders(t){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...mge(),...this.authHeaders(t)}}validateHeaders(t,n){}defaultIdempotencyKey(){return`stainless-node-retry-${_ge()}`}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,r){return this.request(Promise.resolve(r).then(async a=>{const o=a&&SS(a==null?void 0:a.body)?new DataView(await a.body.arrayBuffer()):(a==null?void 0:a.body)instanceof DataView?a.body:(a==null?void 0:a.body)instanceof ArrayBuffer?new DataView(a.body):a&&ArrayBuffer.isView(a==null?void 0:a.body)?new DataView(a.body.buffer):a==null?void 0:a.body;return{method:t,path:n,...a,body:o}}))}getAPIList(t,n,r){return this.requestAPIList(n,{method:"get",path:t,...r})}calculateContentLength(t){if(typeof t=="string"){if(typeof jn<"u")return jn.byteLength(t,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(t).length.toString()}else if(ArrayBuffer.isView(t))return t.byteLength.toString();return null}buildRequest(t){var f;const{method:n,path:r,query:a,headers:o={}}=t,i=ArrayBuffer.isView(t.body)||t.__binaryRequest&&typeof t.body=="string"?t.body:r9(t.body)?t.body.body:t.body?JSON.stringify(t.body,null,2):null,s=this.calculateContentLength(i),c=this.buildURL(r,a);"timeout"in t&&CS("timeout",t.timeout);const l=t.timeout??this.timeout,u=t.httpAgent??this.httpAgent??z8(c),d=l+1e3;typeof((f=u==null?void 0:u.options)==null?void 0:f.timeout)=="number"&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);const p=this.buildHeaders({options:t,headers:o,contentLength:s});return{req:{method:n,...i&&{body:i},headers:p,...u&&{agent:u},signal:t.signal??null},url:c,timeout:l}}buildHeaders({options:t,headers:n,contentLength:r}){const a={};r&&(a["content-length"]=r);const o=this.defaultHeaders(t);return u9(a,o),u9(a,n),r9(t.body)&&Jd!=="node"&&delete a["content-type"],this.validateHeaders(a,n),a}async prepareOptions(t){}async prepareRequest(t,{url:n,options:r}){}parseHeaders(t){return t?Symbol.iterator in t?Object.fromEntries(Array.from(t).map(n=>[...n])):{...t}:{}}makeStatusError(t,n,r,a){return Ln.generate(t,n,r,a)}request(t,n=null){return new sy(this.makeRequest(t,n))}async makeRequest(t,n){var u,d;const r=await t;n==null&&(n=r.maxRetries??this.maxRetries),await this.prepareOptions(r);const{req:a,url:o,timeout:i}=this.buildRequest(r);if(await this.prepareRequest(a,{url:o,options:r}),Qc("request",o,r,a.headers),(u=r.signal)==null?void 0:u.aborted)throw new jS;const s=new AbortController,c=await this.fetchWithTimeout(o,a,i,s).catch(NS);if(c instanceof Error){if((d=r.signal)!=null&&d.aborted)throw new jS;if(n)return this.retryRequest(r,n);throw c.name==="AbortError"?new q8:new iy({cause:c})}const l=pge(c.headers);if(!c.ok){if(n&&this.shouldRetry(c)){const y=`retrying, ${n} attempts remaining`;return Qc(`response (error; ${y})`,c.status,o,l),this.retryRequest(r,n,l)}const p=await c.text().catch(y=>NS(y).message),f=yge(p),m=f?void 0:p;throw Qc(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,l,m),this.makeStatusError(c.status,f,m,l)}return{response:c,options:r,controller:s}}requestAPIList(t,n){const r=this.makeRequest(n,null);return new dge(this,r,t)}buildURL(t,n){const r=vge(t)?new URL(t):new URL(this.baseURL+(this.baseURL.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),a=this.defaultQuery();return wge(a)||(n={...a,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(t){return Object.entries(t).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new ga(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(t,n,r,a){const{signal:o,...i}=n||{};o&&o.addEventListener("abort",()=>a.abort());const s=setTimeout(()=>a.abort(),r);return this.getRequestClient().fetch.call(void 0,t,{signal:a.signal,...i}).finally(()=>{clearTimeout(s)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,r){let a;const o=r==null?void 0:r["retry-after-ms"];if(o){const s=parseFloat(o);Number.isNaN(s)||(a=s)}const i=r==null?void 0:r["retry-after"];if(i&&!a){const s=parseFloat(i);Number.isNaN(s)?a=Date.parse(i)-Date.now():a=s*1e3}if(!(a&&0<=a&&a<60*1e3)){const s=t.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(n,s)}return await bge(a),this.makeRequest(t,n-1)}calculateDefaultRetryTimeoutMillis(t,n){const r=n-t,a=Math.min(.5*Math.pow(2,r),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Xc}`}}class dge extends sy{constructor(t,n,r){super(n,async a=>new r(t,a.response,await o9(a),a.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const n of t)yield n}}const pge=e=>new Proxy(Object.fromEntries(e.entries()),{get(t,n){const r=n.toString();return t[r.toLowerCase()]||t[r]}}),fge=()=>{var t;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xc,"X-Stainless-OS":s9(Deno.build.os),"X-Stainless-Arch":i9(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":Sn.version};if(Object.prototype.toString.call(typeof Sn<"u"?Sn:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xc,"X-Stainless-OS":s9(Sn.platform),"X-Stainless-Arch":i9(Sn.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":Sn.version};const e=hge();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function hge(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const a=r[1]||0,o=r[2]||0,i=r[3]||0;return{browser:t,version:`${a}.${o}.${i}`}}}return null}const i9=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",s9=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let c9;const mge=()=>c9??(c9=fge()),yge=e=>{try{return JSON.parse(e)}catch{return}},gge=new RegExp("^(?:[a-z]+:)?//","i"),vge=e=>gge.test(e),bge=e=>new Promise(t=>setTimeout(t,e)),CS=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new ga(`${e} must be an integer`);if(t<0)throw new ga(`${e} must be a positive integer`);return t},NS=e=>e instanceof Error?e:new Error(e),l9=e=>{var t,n,r,a;if(typeof Sn<"u")return((t=Yc==null?void 0:Yc[e])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(a=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,e))==null?void 0:a.trim()};function wge(e){if(!e)return!0;for(const t in e)return!1;return!0}function xge(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u9(e,t){for(const n in t){if(!xge(t,n))continue;const r=n.toLowerCase();if(!r)continue;const a=t[n];a===null?delete e[r]:a!==void 0&&(e[r]=a)}}function Qc(e,...t){typeof Sn<"u"&&(Yc==null?void 0:Yc.DEBUG)==="true"&&console.log(`Groq:DEBUG:${e}`,...t)}const _ge=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),jge=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";class ji{constructor(t){this._client=t}}class cy extends ji{create(t,n){return this._client.post("/openai/v1/audio/transcriptions",a9({body:t,...n}))}}cy||(cy={});class ly extends ji{create(t,n){return this._client.post("/openai/v1/audio/translations",a9({body:t,...n}))}}ly||(ly={});class uy extends ji{constructor(){super(...arguments),this.transcriptions=new cy(this._client),this.translations=new ly(this._client)}}(function(e){e.Transcriptions=cy,e.Translations=ly})(uy||(uy={}));let dy=class extends ji{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}};dy||(dy={});class py extends ji{constructor(){super(...arguments),this.completions=new dy(this._client)}}(function(e){e.Completions=dy})(py||(py={}));class fy extends ji{}fy||(fy={});class hy extends ji{create(t,n){return this._client.post("/openai/v1/embeddings",{body:t,...n})}}hy||(hy={});class my extends ji{retrieve(t,n){return this._client.get(`/openai/v1/models/${t}`,n)}list(t){return this._client.get("/openai/v1/models",t)}delete(t,n){return this._client.delete(`/openai/v1/models/${t}`,n)}}my||(my={});var d9;class on extends uge{constructor({baseURL:t=l9("GROQ_BASE_URL"),apiKey:n=l9("GROQ_API_KEY"),...r}={}){if(n===void 0)throw new ga("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");const a={apiKey:n,...r,baseURL:t||"https://api.groq.com"};if(!a.dangerouslyAllowBrowser&&jge())throw new ga(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Groq({ apiKey, dangerouslyAllowBrowser: true })`);super({baseURL:a.baseURL,timeout:a.timeout??6e4,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new fy(this),this.chat=new py(this),this.embeddings=new hy(this),this.audio=new uy(this),this.models=new my(this),this._options=a,this.apiKey=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(t){return{...super.defaultHeaders(t),...this._options.defaultHeaders}}authHeaders(t){return{Authorization:`Bearer ${this.apiKey}`}}}d9=on,on.Groq=d9,on.GroqError=ga,on.APIError=Ln,on.APIConnectionError=iy,on.APIConnectionTimeoutError=q8,on.APIUserAbortError=jS,on.NotFoundError=Z8,on.ConflictError=G8,on.RateLimitError=J8,on.BadRequestError=W8,on.AuthenticationError=H8,on.InternalServerError=Y8,on.PermissionDeniedError=K8,on.UnprocessableEntityError=X8,on.toFile=n9,on.fileFromPath=U8,function(e){e.Completions=fy,e.Chat=py,e.Embeddings=hy,e.Audio=uy,e.Models=my}(on||(on={}));function Sge(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";default:throw new Error(`Unknown message type: ${t}`)}}function p9(e){return e.map(t=>{var r;if(typeof t.content!="string")throw new Error("Non string message content not supported");const n={role:Sge(t),content:t.content,name:t.name,function_call:t.additional_kwargs.function_call,tool_calls:t.additional_kwargs.tool_calls,tool_call_id:t.tool_call_id};return Nv(t)&&((r=t.tool_calls)!=null&&r.length)?n.tool_calls=t.tool_calls.map(c8):(t.additional_kwargs.tool_calls!=null&&(n.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(n.tool_call_id=t.tool_call_id)),n})}function Ege(e,t){const n=e.tool_calls;switch(e.role){case"assistant":{const r=[],a=[];for(const o of n??[])try{r.push(gS(o,{returnId:!0}))}catch(i){a.push(l8(o,i.message))}return new Aa({content:e.content||"",additional_kwargs:{tool_calls:n},tool_calls:r,invalid_tool_calls:a,usage_metadata:t})}default:return new Mv(e.content||"",e.role??"unknown")}}function Oge(e,t){if(e!=null&&e.length)return e.map(n=>{var r,a;return{id:n.id,name:(r=n.function)==null?void 0:r.name,args:(a=n.function)==null?void 0:a.arguments,type:"tool_call_chunk",index:t}})}function Cge(e,t,n){const{role:r}=e,a=e.content??"";let o;e.function_call?o={function_call:e.function_call}:e.tool_calls?o={tool_calls:e.tool_calls}:o={};let i,s;if(n!=null&&n.usage&&(i={input_tokens:n.usage.prompt_tokens,output_tokens:n.usage.completion_tokens,total_tokens:n.usage.total_tokens},s=n.id),r==="user")return{message:new HG({content:a})};if(r==="assistant"){const c=Oge(e.tool_calls,t);return{message:new nu({content:a,additional_kwargs:o,tool_call_chunks:c?c.map(l=>({type:l.type,args:l.args,index:l.index})):void 0,usage_metadata:i,id:s}),toolCallData:c?c.map(l=>({id:l.id??"",name:l.name??"",index:l.index??t,type:"tool_call_chunk"})):void 0}}else return r==="system"?{message:new VM({content:a})}:{message:new KG({content:a,role:r})}}class Nge extends Xa{static lc_name(){return"ChatGroq"}_llmType(){return"groq"}get lc_secrets(){return{apiKey:"GROQ_API_KEY"}}constructor(t){super(t??{}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","groq"]}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0});const n=(t==null?void 0:t.apiKey)||po("GROQ_API_KEY");if(!n)throw new Error('Groq API key not found. Please set the GROQ_API_KEY environment variable or provide the key into "apiKey"');const r={"User-Agent":"langchainjs",...(t==null?void 0:t.defaultHeaders)??{}};this.client=new on({apiKey:n,dangerouslyAllowBrowser:!0,baseURL:t==null?void 0:t.baseUrl,timeout:t==null?void 0:t.timeout,httpAgent:t==null?void 0:t.httpAgent,fetch:t==null?void 0:t.fetch,maxRetries:0,defaultHeaders:r,defaultQuery:t==null?void 0:t.defaultQuery}),this.apiKey=n,this.temperature=(t==null?void 0:t.temperature)??this.temperature,this.modelName=(t==null?void 0:t.model)??(t==null?void 0:t.modelName)??this.model,this.model=this.modelName,this.streaming=(t==null?void 0:t.streaming)??this.streaming,this.stop=(t==null?void 0:t.stopSequences)??(typeof(t==null?void 0:t.stop)=="string"?[t.stop]:t==null?void 0:t.stop)??[],this.stopSequences=this.stop,this.maxTokens=t==null?void 0:t.maxTokens}getLsParams(t){const n=this.invocationParams(t);return{ls_provider:"groq",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??this.temperature,ls_max_tokens:n.max_tokens??this.maxTokens,ls_stop:t.stop}}async completionWithRetry(t,n){return this.caller.call(async()=>this.client.chat.completions.create(t,n))}invocationParams(t){const n=super.invocationParams(t);return t.tool_choice!==void 0&&(n.tool_choice=t.tool_choice),t.tools!==void 0&&(n.tools=t.tools),t.response_format!==void 0&&(n.response_format=t.response_format),{...n,stop:t.stop??this.stopSequences,model:this.model,temperature:this.temperature,max_tokens:this.maxTokens}}bindTools(t,n){return this.bind({tools:t.map(r=>eye(r)),...n})}async*_streamResponseChunks(t,n,r){var u,d;const a=this.invocationParams(n),o=p9(t),i=await this.completionWithRetry({...a,messages:o,stream:!0},{signal:n==null?void 0:n.signal,headers:n==null?void 0:n.headers});let s="";const c=[];let l;for await(const p of i){l=p;const f=p==null?void 0:p.choices[0];if(!f)continue;(u=f.delta)!=null&&u.role&&(s=f.delta.role);const{message:m,toolCallData:y}=Cge({...f.delta,role:s},f.index,p.x_groq);if(y){const b=y.filter(w=>c.every(j=>j.id!==w.id));c.push(...b),yield new Hi({message:new nu({content:"",tool_call_chunks:b}),text:""})}const v=new Hi({message:m,text:f.delta.content??"",generationInfo:{finishReason:f.finish_reason}});yield v,r==null||r.handleLLMNewToken(v.text??"")}if(l&&("choices"in l&&delete l.choices,yield new Hi({message:new nu({content:"",response_metadata:l}),text:""})),(d=n.signal)==null?void 0:d.aborted)throw new Error("AbortError")}async _generate(t,n,r){var a;if(this.streaming){const o={},i=this._streamResponseChunks(t,n,r),s={};for await(const c of i){const l=((a=c.generationInfo)==null?void 0:a.completion)??0;s[l]===void 0?s[l]=c:s[l]=s[l].concat(c)}return{generations:Object.entries(s).sort(([c],[l])=>parseInt(c,10)-parseInt(l,10)).map(([c,l])=>l),llmOutput:{estimatedTokenUsage:o}}}else return this._generateNonStreaming(t,n,r)}async _generateNonStreaming(t,n,r){var l;const a={},o=this.invocationParams(n),i=p9(t),s=await this.completionWithRetry({...o,stream:!1,messages:i},{signal:n==null?void 0:n.signal,headers:n==null?void 0:n.headers});if("usage"in s&&s.usage){const{completion_tokens:u,prompt_tokens:d,total_tokens:p}=s.usage;u&&(a.completionTokens=(a.completionTokens??0)+u),d&&(a.promptTokens=(a.promptTokens??0)+d),p&&(a.totalTokens=(a.totalTokens??0)+p)}const c=[];if("choices"in s&&s.choices)for(const u of s.choices){const d=((l=u.message)==null?void 0:l.content)??"";let p;a.totalTokens!==void 0&&(p={input_tokens:a.promptTokens??0,output_tokens:a.completionTokens??0,total_tokens:a.totalTokens});const f={text:d,message:Ege(u.message??{role:"assistant"},p)};f.generationInfo={...u.finish_reason?{finish_reason:u.finish_reason}:{},...u.logprobs?{logprobs:u.logprobs}:{}},c.push(f)}return{generations:c,llmOutput:{tokenUsage:a}}}withStructuredOutput(t,n){const r=t,a=n==null?void 0:n.name,o=n==null?void 0:n.method,i=n==null?void 0:n.includeRaw;let s=a??"extract",c,l;if(o==="jsonMode")l=this.bind({response_format:{type:"json_object"}}),Xd(r)?c=mS.fromZodSchema(r):c=new yS;else if(Xd(r)){const f=Yye(r);l=this.bind({tools:[{type:"function",function:{name:s,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:s}}}),c=new Ym({returnSingle:!0,keyName:s,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,s=r.name):(s=r.title??s,f={name:s,description:r.description??"",parameters:r}),l=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:s}}}),c=new Ym({returnSingle:!0,keyName:s})}if(!i)return l.pipe(c).withConfig({runName:"ChatGroqStructuredOutput"});const u=_i.assign({parsed:(f,m)=>c.invoke(f.raw,m)}),d=_i.assign({parsed:()=>null}),p=u.withFallbacks({fallbacks:[d]});return Cv.from([{raw:l},p]).withConfig({runName:"ChatGroqStructuredOutput"})}}var f9;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(f9||(f9={}));var h9;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(h9||(h9={}));var m9;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(m9||(m9={}));const y9=["user","model","function","system"];var g9;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(g9||(g9={}));var v9;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(v9||(v9={}));var b9;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(b9||(b9={}));var w9;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(w9||(w9={}));var Yd;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER"})(Yd||(Yd={}));var x9;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(x9||(x9={}));var el;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(el||(el={}));var _9;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(_9||(_9={}));class ar extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class tl extends ar{constructor(t,n){super(t),this.response=n}}class j9 extends ar{constructor(t,n,r,a){super(t),this.status=n,this.statusText=r,this.errorDetails=a}}class Si extends ar{}const Mge="https://generativelanguage.googleapis.com",kge="v1beta",Pge="0.21.0",Age="genai-js";var xs;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(xs||(xs={}));class Tge{constructor(t,n,r,a,o){this.model=t,this.task=n,this.apiKey=r,this.stream=a,this.requestOptions=o}toString(){var t,n;const r=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||kge;let a=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Mge}/${r}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function Ige(e){const t=[];return e!=null&&e.apiClient&&t.push(e.apiClient),t.push(`${Age}/${Pge}`),t.join(" ")}async function Rge(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",Ige(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let r=(t=e.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(a){throw new Si(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${a.message}`)}for(const[a,o]of r.entries()){if(a==="x-goog-api-key")throw new Si(`Cannot set reserved header name ${a}`);if(a==="x-goog-api-client")throw new Si(`Header name ${a} can only be set using the apiClient field`);n.append(a,o)}}return n}async function Dge(e,t,n,r,a,o){const i=new Tge(e,t,n,r,o);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},Bge(o)),{method:"POST",headers:await Rge(i),body:a})}}async function Qd(e,t,n,r,a,o={},i=fetch){const{url:s,fetchOptions:c}=await Dge(e,t,n,r,a,o);return Lge(s,c,i)}async function Lge(e,t,n=fetch){let r;try{r=await n(e,t)}catch(a){$ge(a,e)}return r.ok||await Fge(r,e),r}function $ge(e,t){let n=e;throw e instanceof j9||e instanceof Si||(n=new ar(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack),n}async function Fge(e,t){let n="",r;try{const a=await e.json();n=a.error.message,a.error.details&&(n+=` ${JSON.stringify(a.error.details)}`,r=a.error.details)}catch{}throw new j9(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,r)}function Bge(e){const t={};if((e==null?void 0:e.signal)!==void 0||(e==null?void 0:e.timeout)>=0){const n=new AbortController;(e==null?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),e!=null&&e.signal&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}function MS(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),yy(e.candidates[0]))throw new tl(`${Ei(e)}`,e);return zge(e)}else if(e.promptFeedback)throw new tl(`Text not available. ${Ei(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),yy(e.candidates[0]))throw new tl(`${Ei(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),S9(e)[0]}else if(e.promptFeedback)throw new tl(`Function call not available. ${Ei(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),yy(e.candidates[0]))throw new tl(`${Ei(e)}`,e);return S9(e)}else if(e.promptFeedback)throw new tl(`Function call not available. ${Ei(e)}`,e)},e}function zge(e){var t,n,r,a;const o=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const i of(a=(r=e.candidates)===null||r===void 0?void 0:r[0].content)===null||a===void 0?void 0:a.parts)i.text&&o.push(i.text),i.executableCode&&o.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&o.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function S9(e){var t,n,r,a;const o=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const i of(a=(r=e.candidates)===null||r===void 0?void 0:r[0].content)===null||a===void 0?void 0:a.parts)i.functionCall&&o.push(i.functionCall);if(o.length>0)return o}const Uge=[Yd.RECITATION,Yd.SAFETY,Yd.LANGUAGE];function yy(e){return!!e.finishReason&&Uge.includes(e.finishReason)}function Ei(e){var t,n,r;let a="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)a+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(a+=` due to ${e.promptFeedback.blockReason}`),!((n=e.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(a+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((r=e.candidates)===null||r===void 0)&&r[0]){const o=e.candidates[0];yy(o)&&(a+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(a+=`: ${o.finishMessage}`))}return a}function ep(e){return this instanceof ep?(this.v=e,this):new ep(e)}function Vge(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),a,o=[];return a={},i("next"),i("throw"),i("return"),a[Symbol.asyncIterator]=function(){return this},a;function i(p){r[p]&&(a[p]=function(f){return new Promise(function(m,y){o.push([p,f,m,y])>1||s(p,f)})})}function s(p,f){try{c(r[p](f))}catch(m){d(o[0][3],m)}}function c(p){p.value instanceof ep?Promise.resolve(p.value.v).then(l,u):d(o[0][2],p)}function l(p){s("next",p)}function u(p){s("throw",p)}function d(p,f){p(f),o.shift(),o.length&&s(o[0][0],o[0][1])}}const E9=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function qge(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=Kge(t),[r,a]=n.tee();return{stream:Hge(r),response:Wge(a)}}async function Wge(e){const t=[],n=e.getReader();for(;;){const{done:r,value:a}=await n.read();if(r)return MS(Zge(t));t.push(a)}}function Hge(e){return Vge(this,arguments,function*(){const t=e.getReader();for(;;){const{value:n,done:r}=yield ep(t.read());if(r)break;yield yield ep(MS(n))}})}function Kge(e){const t=e.getReader();return new ReadableStream({start(n){let r="";return a();function a(){return t.read().then(({value:o,done:i})=>{if(i){if(r.trim()){n.error(new ar("Failed to parse stream"));return}n.close();return}r+=o;let s=r.match(E9),c;for(;s;){try{c=JSON.parse(s[1])}catch{n.error(new ar(`Error parsing JSON response: "${s[1]}"`));return}n.enqueue(c),r=r.substring(s[0].length),s=r.match(E9)}return a()})}}})}function Zge(e){const t=e[e.length-1],n={promptFeedback:t==null?void 0:t.promptFeedback};for(const r of e){if(r.candidates)for(const a of r.candidates){const o=a.index;if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:a.index}),n.candidates[o].citationMetadata=a.citationMetadata,n.candidates[o].groundingMetadata=a.groundingMetadata,n.candidates[o].finishReason=a.finishReason,n.candidates[o].finishMessage=a.finishMessage,n.candidates[o].safetyRatings=a.safetyRatings,a.content&&a.content.parts){n.candidates[o].content||(n.candidates[o].content={role:a.content.role||"user",parts:[]});const i={};for(const s of a.content.parts)s.text&&(i.text=s.text),s.functionCall&&(i.functionCall=s.functionCall),s.executableCode&&(i.executableCode=s.executableCode),s.codeExecutionResult&&(i.codeExecutionResult=s.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),n.candidates[o].content.parts.push(i)}}r.usageMetadata&&(n.usageMetadata=r.usageMetadata)}return n}async function O9(e,t,n,r){const a=await Qd(t,xs.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),r);return qge(a)}async function C9(e,t,n,r){const a=await(await Qd(t,xs.GENERATE_CONTENT,e,!1,JSON.stringify(n),r)).json();return{response:MS(a)}}function N9(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function tp(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const n of e)typeof n=="string"?t.push({text:n}):t.push(n);return Gge(t)}function Gge(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let r=!1,a=!1;for(const o of e)"functionResponse"in o?(n.parts.push(o),a=!0):(t.parts.push(o),r=!0);if(r&&a)throw new ar("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!a)throw new ar("No content is provided for sending chat message.");return r?t:n}function Xge(e,t){var n;let r={model:t==null?void 0:t.model,generationConfig:t==null?void 0:t.generationConfig,safetySettings:t==null?void 0:t.safetySettings,tools:t==null?void 0:t.tools,toolConfig:t==null?void 0:t.toolConfig,systemInstruction:t==null?void 0:t.systemInstruction,cachedContent:(n=t==null?void 0:t.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const a=e.generateContentRequest!=null;if(e.contents){if(a)throw new Si("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=e.contents}else if(a)r=Object.assign(Object.assign({},r),e.generateContentRequest);else{const o=tp(e);r.contents=[o]}return{generateContentRequest:r}}function M9(e){let t;return e.contents?t=e:t={contents:[tp(e)]},e.systemInstruction&&(t.systemInstruction=N9(e.systemInstruction)),t}function Jge(e){return typeof e=="string"||Array.isArray(e)?{content:tp(e)}:e}const k9=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Yge={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Qge(e){let t=!1;for(const n of e){const{role:r,parts:a}=n;if(!t&&r!=="user")throw new ar(`First content should be with role 'user', got ${r}`);if(!y9.includes(r))throw new ar(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(y9)}`);if(!Array.isArray(a))throw new ar("Content should have 'parts' property with an array of Parts");if(a.length===0)throw new ar("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const s of a)for(const c of k9)c in s&&(o[c]+=1);const i=Yge[r];for(const s of k9)if(!i.includes(s)&&o[s]>0)throw new ar(`Content with role '${r}' can't contain '${s}' part`);t=!0}}const P9="SILENT_ERROR";class eve{constructor(t,n,r,a={}){this.model=n,this.params=r,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,r!=null&&r.history&&(Qge(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,n={}){var r,a,o,i,s,c;await this._sendPromise;const l=tp(t),u={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(s=this.params)===null||s===void 0?void 0:s.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),n);let p;return this._sendPromise=this._sendPromise.then(()=>C9(this._apiKey,this.model,u,d)).then(f=>{var m;if(f.response.candidates&&f.response.candidates.length>0){this._history.push(l);const y=Object.assign({parts:[],role:"model"},(m=f.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(y)}else{const y=Ei(f.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}p=f}),await this._sendPromise,p}async sendMessageStream(t,n={}){var r,a,o,i,s,c;await this._sendPromise;const l=tp(t),u={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(s=this.params)===null||s===void 0?void 0:s.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),n),p=O9(this._apiKey,this.model,u,d);return this._sendPromise=this._sendPromise.then(()=>p).catch(f=>{throw new Error(P9)}).then(f=>f.response).then(f=>{if(f.candidates&&f.candidates.length>0){this._history.push(l);const m=Object.assign({},f.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=Ei(f);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(f=>{f.message!==P9&&console.error(f)}),p}}async function tve(e,t,n,r){return(await Qd(t,xs.COUNT_TOKENS,e,!1,JSON.stringify(n),r)).json()}async function nve(e,t,n,r){return(await Qd(t,xs.EMBED_CONTENT,e,!1,JSON.stringify(n),r)).json()}async function rve(e,t,n,r){const a=n.requests.map(o=>Object.assign(Object.assign({},o),{model:t}));return(await Qd(t,xs.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:a}),r)).json()}class A9{constructor(t,n,r={}){this.apiKey=t,this._requestOptions=r,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=N9(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(t,n={}){var r;const a=M9(t),o=Object.assign(Object.assign({},this._requestOptions),n);return C9(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},a),o)}async generateContentStream(t,n={}){var r;const a=M9(t),o=Object.assign(Object.assign({},this._requestOptions),n);return O9(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},a),o)}startChat(t){var n;return new eve(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},t),this._requestOptions)}async countTokens(t,n={}){const r=Xge(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),n);return tve(this.apiKey,this.model,r,a)}async embedContent(t,n={}){const r=Jge(t),a=Object.assign(Object.assign({},this._requestOptions),n);return nve(this.apiKey,this.model,r,a)}async batchEmbedContents(t,n={}){const r=Object.assign(Object.assign({},this._requestOptions),n);return rve(this.apiKey,this.model,t,r)}}class T9{constructor(t){this.apiKey=t}getGenerativeModel(t,n){if(!t.model)throw new ar("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new A9(this.apiKey,t,n)}getGenerativeModelFromCachedContent(t,n,r){if(!t.name)throw new Si("Cached content must contain a `name` field.");if(!t.model)throw new Si("Cached content must contain a `model` field.");const a=["model","systemInstruction"];for(const i of a)if(n!=null&&n[i]&&t[i]&&(n==null?void 0:n[i])!==t[i]){if(i==="model"){const s=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,c=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(s===c)continue}throw new Si(`Different value for "${i}" specified in modelParams (${n[i]}) and cachedContent (${t[i]})`)}const o=Object.assign(Object.assign({},n),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new A9(this.apiKey,o,r)}}const ave=Symbol("Let zodToJsonSchema decide on which parser to use"),ove={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},ive=e=>({...ove,...e}),sve=e=>{const t=ive(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function I9(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Nt(e,t,n,r,a){e[t]=n,I9(e,t,r,a)}function cve(){return{}}function lve(e,t){var r,a,o;const n={type:"array"};return(r=e.type)!=null&&r._def&&((o=(a=e.type)==null?void 0:a._def)==null?void 0:o.typeName)!==Q.ZodAny&&(n.items=vt(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Nt(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Nt(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Nt(n,"minItems",e.exactLength.value,e.exactLength.message,t),Nt(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function uve(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Nt(n,"minimum",r.value,r.message,t):Nt(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Nt(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Nt(n,"maximum",r.value,r.message,t):Nt(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Nt(n,"maximum",r.value,r.message,t));break;case"multipleOf":Nt(n,"multipleOf",r.value,r.message,t);break}return n}function dve(){return{type:"boolean"}}function R9(e,t){return vt(e.type._def,t)}const pve=(e,t)=>vt(e.innerType._def,t);function D9(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,o)=>D9(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return fve(e,t)}}const fve=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Nt(n,"minimum",r.value,r.message,t);break;case"max":Nt(n,"maximum",r.value,r.message,t);break}return n};function hve(e,t){return{...vt(e.innerType._def,t),default:e.defaultValue()}}function mve(e,t){return t.effectStrategy==="input"?vt(e.schema._def,t):{}}function yve(e){return{type:"string",enum:Array.from(e.values)}}const gve=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function vve(e,t){const n=[vt(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),vt(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(o=>{if(gve(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(r=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:s,...c}=o;i=c}else r=void 0;a.push(i)}}),a.length?{allOf:a,...r}:void 0}function bve(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let kS;const va={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(kS===void 0&&(kS=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),kS),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function L9(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":Nt(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":Nt(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":ba(n,"email",r.message,t);break;case"format:idn-email":ba(n,"idn-email",r.message,t);break;case"pattern:zod":Zn(n,va.email,r.message,t);break}break;case"url":ba(n,"uri",r.message,t);break;case"uuid":ba(n,"uuid",r.message,t);break;case"regex":Zn(n,r.regex,r.message,t);break;case"cuid":Zn(n,va.cuid,r.message,t);break;case"cuid2":Zn(n,va.cuid2,r.message,t);break;case"startsWith":Zn(n,RegExp(`^${PS(r.value,t)}`),r.message,t);break;case"endsWith":Zn(n,RegExp(`${PS(r.value,t)}$`),r.message,t);break;case"datetime":ba(n,"date-time",r.message,t);break;case"date":ba(n,"date",r.message,t);break;case"time":ba(n,"time",r.message,t);break;case"duration":ba(n,"duration",r.message,t);break;case"length":Nt(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),Nt(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":{Zn(n,RegExp(PS(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&ba(n,"ipv4",r.message,t),r.version!=="v4"&&ba(n,"ipv6",r.message,t);break}case"base64url":Zn(n,va.base64url,r.message,t);break;case"jwt":Zn(n,va.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&Zn(n,va.ipv4Cidr,r.message,t),r.version!=="v4"&&Zn(n,va.ipv6Cidr,r.message,t);break}case"emoji":Zn(n,va.emoji(),r.message,t);break;case"ulid":{Zn(n,va.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{ba(n,"binary",r.message,t);break}case"contentEncoding:base64":{Nt(n,"contentEncoding","base64",r.message,t);break}case"pattern:zod":{Zn(n,va.base64,r.message,t);break}}break}case"nanoid":Zn(n,va.nanoid,r.message,t)}return n}function PS(e,t){return t.patternStrategy==="escape"?xve(e):e}const wve=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function xve(e){let t="";for(let n=0;n<e.length;n++)wve.has(e[n])||(t+="\\"),t+=e[n];return t}function ba(e,t,n,r){var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Nt(e,"format",t,n,r)}function Zn(e,t,n,r){var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:$9(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Nt(e,"pattern",$9(t,r),n,r)}function $9(e,t){var c;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let a="",o=!1,i=!1,s=!1;for(let l=0;l<r.length;l++){if(o){a+=r[l],o=!1;continue}if(n.i){if(i){if(r[l].match(/[a-z]/)){s?(a+=r[l],a+=`${r[l-2]}-${r[l]}`.toUpperCase(),s=!1):r[l+1]==="-"&&((c=r[l+2])!=null&&c.match(/[a-z]/))?(a+=r[l],s=!0):a+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){a+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(n.m){if(r[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[l]==="."){a+=i?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}a+=r[l],r[l]==="\\"?o=!0:i&&r[l]==="]"?i=!1:!i&&r[l]==="["&&(i=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function F9(e,t){var r,a,o,i,s,c;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((l,u)=>({...l,[u]:vt(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:vt(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===Q.ZodString&&((o=e.keyType._def.checks)!=null&&o.length)){const{type:l,...u}=L9(e.keyType._def,t);return{...n,propertyNames:u}}else{if(((i=e.keyType)==null?void 0:i._def.typeName)===Q.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(((s=e.keyType)==null?void 0:s._def.typeName)===Q.ZodBranded&&e.keyType._def.type._def.typeName===Q.ZodString&&((c=e.keyType._def.type._def.checks)!=null&&c.length)){const{type:l,...u}=R9(e.keyType._def,t);return{...n,propertyNames:u}}}return n}function _ve(e,t){if(t.mapStrategy==="record")return F9(e,t);const n=vt(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},r=vt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function jve(e){const t=e.values,n=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),r=Array.from(new Set(n.map(a=>typeof a)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:n}}function Sve(){return{not:{}}}function Eve(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const gy={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Ove(e,t){if(t.target==="openApi3")return B9(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in gy&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,o)=>{const i=gy[o._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,o)=>{const i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((o,i,s)=>s.indexOf(o)===i);return{type:a.length>1?a:a[0],enum:n.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(o=>!r.includes(o))],[])};return B9(e,t)}const B9=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>vt(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function Cve(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:gy[e.innerType._def.typeName],nullable:!0}:{type:[gy[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=vt(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=vt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function Nve(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",I9(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Nt(n,"minimum",r.value,r.message,t):Nt(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Nt(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Nt(n,"maximum",r.value,r.message,t):Nt(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Nt(n,"maximum",r.value,r.message,t));break;case"multipleOf":Nt(n,"multipleOf",r.value,r.message,t);break}return n}function Mve(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":vt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":vt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function kve(e,t){const n=t.target==="openAi",r={type:"object",...Object.entries(e.shape()).reduce((a,[o,i])=>{if(i===void 0||i._def===void 0)return a;let s=i.isOptional();s&&n&&(i instanceof GDe&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),s=!1);const c=vt(i._def,{...t,currentPath:[...t.currentPath,"properties",o],propertyPath:[...t.currentPath,"properties",o]});return c===void 0?a:{properties:{...a.properties,[o]:c},required:s?a.required:[...a.required,o]}},{properties:{},required:[]}),additionalProperties:Mve(e,t)};return r.required.length||delete r.required,r}const Pve=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return vt(e.innerType._def,t);const n=vt(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},Ave=(e,t)=>{if(t.pipeStrategy==="input")return vt(e.in._def,t);if(t.pipeStrategy==="output")return vt(e.out._def,t);const n=vt(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=vt(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function Tve(e,t){return vt(e.type._def,t)}function Ive(e,t){const n={type:"array",uniqueItems:!0,items:vt(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Nt(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Nt(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function Rve(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>vt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:vt(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>vt(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function Dve(){return{not:{}}}function Lve(){return{}}const $ve=(e,t)=>vt(e.innerType._def,t);function vt(e,t,n=!1){var i;const r=t.seen.get(e);if(t.override){const s=(i=t.override)==null?void 0:i.call(t,e,t,r,n);if(s!==ave)return s}if(r&&!n){const s=Fve(r,t);if(s!==void 0)return s}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const o=zve(e,e.typeName,t);return o&&Uve(e,t,o),a.jsonSchema=o,o}const Fve=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Bve(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},Bve=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},zve=(e,t,n)=>{switch(t){case Q.ZodString:return L9(e,n);case Q.ZodNumber:return Nve(e,n);case Q.ZodObject:return kve(e,n);case Q.ZodBigInt:return uve(e,n);case Q.ZodBoolean:return dve();case Q.ZodDate:return D9(e,n);case Q.ZodUndefined:return Dve();case Q.ZodNull:return Eve(n);case Q.ZodArray:return lve(e,n);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return Ove(e,n);case Q.ZodIntersection:return vve(e,n);case Q.ZodTuple:return Rve(e,n);case Q.ZodRecord:return F9(e,n);case Q.ZodLiteral:return bve(e,n);case Q.ZodEnum:return yve(e);case Q.ZodNativeEnum:return jve(e);case Q.ZodNullable:return Cve(e,n);case Q.ZodOptional:return Pve(e,n);case Q.ZodMap:return _ve(e,n);case Q.ZodSet:return Ive(e,n);case Q.ZodLazy:return vt(e.getter()._def,n);case Q.ZodPromise:return Tve(e,n);case Q.ZodNaN:case Q.ZodNever:return Sve();case Q.ZodEffects:return mve(e,n);case Q.ZodAny:return cve();case Q.ZodUnknown:return Lve();case Q.ZodDefault:return hve(e,n);case Q.ZodBranded:return R9(e,n);case Q.ZodReadonly:return $ve(e,n);case Q.ZodCatch:return pve(e,n);case Q.ZodPipeline:return Ave(e,n);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(r=>{})()}},Uve=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Vve=(e,t)=>{const n=sve(t),r=void 0,a=t==null?void 0:t.name,o=vt(e._def,n,!1)??{},i=a===void 0?r?{...o,[n.definitionPath]:r}:o:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:o}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function np(e){if(typeof e=="object"&&e!==null){const t={...e};"additionalProperties"in t&&delete t.additionalProperties,"$schema"in t&&delete t.$schema;for(const n in t)n in t&&(Array.isArray(t[n])?t[n]=t[n].map(np):typeof t[n]=="object"&&t[n]!==null&&(t[n]=np(t[n])));return t}return e}function z9(e){const t=np(Vve(e)),{$schema:n,...r}=t;return r}function qve(e){const t=np(e),{$schema:n,...r}=t;return r}function Wve(e){const t=e._getType();return Mv.isInstance(e)?e.role:t==="tool"?t:e.name??t}function Hve(e){switch(e){case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw new Error(`Unknown / unsupported author: ${e}`)}}function Kve(e){if("mimeType"in e&&"data"in e)return{inlineData:{mimeType:e.mimeType,data:e.data}};if("mimeType"in e&&"fileUri"in e)return{fileData:{mimeType:e.mimeType,fileUri:e.fileUri}};throw new Error("Invalid media content")}function Zve(e,t){if(typeof e.content=="string"&&e.content!=="")return[{text:e.content}];let n=[],r=[],a=[];return"tool_calls"in e&&Array.isArray(e.tool_calls)&&e.tool_calls.length>0?n=e.tool_calls.map(o=>({functionCall:{name:o.name,args:o.args}})):e.getType()==="tool"&&e.name&&e.content?r=[{functionResponse:{name:e.name,response:e.content}}]:Array.isArray(e.content)&&(a=e.content.map(o=>{var i;if(o.type==="text")return{text:o.text};if(o.type==="executableCode")return{executableCode:o.executableCode};if(o.type==="codeExecutionResult")return{codeExecutionResult:o.codeExecutionResult};if(o.type==="image_url"){if(!t)throw new Error("This model does not support images");let s;if(typeof o.image_url=="string")s=o.image_url;else if(typeof o.image_url=="object"&&"url"in o.image_url)s=o.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");const[c,l]=s.split(",");if(!c.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[u,d]=c.replace(/^data:/,"").split(";");if(d!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:l,mimeType:u}}}else{if(o.type==="media")return Kve(o);if(o.type==="tool_use")return{functionCall:{name:o.name,args:o.input}};if((i=o.type)!=null&&i.includes("/")&&o.type.split("/").length===2&&"data"in o&&typeof o.data=="string")return{inlineData:{mimeType:o.type,data:o.data}}}throw new Error(`Unknown content type ${o.type}`)})),[...a,...n,...r]}function U9(e,t,n=!1){return e.reduce((r,a,o)=>{if(!qG(a))throw new Error("Unsupported message input");const i=Wve(a);if(i==="system"&&o!==0)throw new Error("System message should be the first one");const s=Hve(i),c=r.content[r.content.length];if(!r.mergeWithPreviousContent&&c&&c.role===s)throw new Error("Google Generative AI requires alternate messages between authors");const l=Zve(a,t);if(r.mergeWithPreviousContent){const p=r.content[r.content.length-1];if(!p)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return p.parts.push(...l),{mergeWithPreviousContent:!1,content:r.content}}let u=s;(u==="function"||u==="system"&&!n)&&(u="user");const d={role:u,parts:l};return{mergeWithPreviousContent:i==="system"&&!n,content:[...r.content,d]}},{content:[],mergeWithPreviousContent:!1}).content}function Gve(e,t){if(!e.candidates||e.candidates.length===0||!e.candidates[0])return{generations:[],llmOutput:{filters:e.promptFeedback}};const n=e.functionCalls(),[r]=e.candidates,{content:a,...o}=r;let i;(a==null?void 0:a.parts.length)===1&&a.parts[0].text?i=a.parts[0].text:i=a.parts.map(c=>"text"in c?{type:"text",text:c.text}:"executableCode"in c?{type:"executableCode",executableCode:c.executableCode}:"codeExecutionResult"in c?{type:"codeExecutionResult",codeExecutionResult:c.codeExecutionResult}:c);let s="";return typeof i=="string"?s=i:"text"in i[0]&&(s=i[0].text),{generations:[{text:s,message:new Aa({content:i,tool_calls:n==null?void 0:n.map(c=>({...c,type:"tool_call"})),additional_kwargs:{...o},usage_metadata:t==null?void 0:t.usageMetadata}),generationInfo:o}]}}function Xve(e,t){if(!e.candidates||e.candidates.length===0)return null;const n=e.functionCalls(),[r]=e.candidates,{content:a,...o}=r;let i;a!=null&&a.parts&&a.parts.every(l=>"text"in l)?i=a.parts.map(l=>l.text).join(""):a.parts&&(i=a.parts.map(l=>"text"in l?{type:"text",text:l.text}:"executableCode"in l?{type:"executableCode",executableCode:l.executableCode}:"codeExecutionResult"in l?{type:"codeExecutionResult",codeExecutionResult:l.codeExecutionResult}:l));let s="";i&&typeof i=="string"?s=i:i&&typeof i=="object"&&"text"in i[0]&&(s=i[0].text);const c=[];return n&&c.push(...n.map(l=>({...l,args:JSON.stringify(l.args),index:t.index,type:"tool_call_chunk"}))),new Hi({text:s,message:new nu({content:i||"",name:a?a.role:void 0,tool_call_chunks:c,additional_kwargs:{},usage_metadata:t.usageMetadata}),generationInfo:o})}function Jve(e){return e.every(t=>"functionDeclarations"in t&&Array.isArray(t.functionDeclarations))?e:[{functionDeclarations:e.map(t=>{if(ty(t)){const n=z9(t.schema);return{name:t.name,description:t.description,parameters:n}}return fS(t)?{name:t.function.name,description:t.function.description??"A function available to call.",parameters:qve(t.function.parameters)}:t})}]}class V9 extends o8{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=t.keyName,this.returnSingle=t.returnSingle??this.returnSingle,this.zodSchema=t.zodSchema}async _validateResult(t){if(this.zodSchema===void 0)return t;const n=await this.zodSchema.safeParseAsync(t);if(n.success)return n.data;throw new Jm(`Failed to parse. Text: "${JSON.stringify(t,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(t,null,2))}async parseResult(t){const n=t.flatMap(a=>{const{message:o}=a;return!("tool_calls"in o)||!Array.isArray(o.tool_calls)?[]:o.tool_calls});if(n[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");const[r]=n;return await this._validateResult(r.args)}}function q9(e,t){const n=Yve(e),r=e0e(n,t);return{tools:n,toolConfig:r}}function Yve(e){let t=[];const n=[];return e.forEach(r=>{if(ty(r)){const[a]=Jve([r]);a.functionDeclarations&&t.push(...a.functionDeclarations)}else if(fS(r)){const{functionDeclarations:a}=Qve(r);if(a)t.push(...a);else throw new Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else n.push(r)}),n.find(r=>"functionDeclarations"in r)?n.map(r=>{if((t==null?void 0:t.length)>0&&"functionDeclarations"in r){const a={functionDeclarations:[...r.functionDeclarations||[],...t]};return t=[],a}return r}):[...n,...t.length>0?[{functionDeclarations:t}]:[]]}function Qve(e){return{functionDeclarations:[{name:e.function.name,description:e.function.description,parameters:np(e.function.parameters)}]}}function e0e(e,t){if(!e.length||!t)return;const{toolChoice:n,allowedFunctionNames:r}=t,a={any:el.ANY,auto:el.AUTO,none:el.NONE};if(n&&["any","auto","none"].includes(n))return{functionCallingConfig:{mode:a[n]??"MODE_UNSPECIFIED",allowedFunctionNames:r}};if(typeof n=="string"||r)return{functionCallingConfig:{mode:el.ANY,allowedFunctionNames:[...r??[],...n&&typeof n=="string"?[n]:[]]}}}class t0e extends Xa{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(t){var n,r;if(super(t??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=((n=t==null?void 0:t.model)==null?void 0:n.replace(/^models\//,""))??((r=t==null?void 0:t.modelName)==null?void 0:r.replace(/^models\//,""))??this.model,this.model=this.modelName,this.maxOutputTokens=(t==null?void 0:t.maxOutputTokens)??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=(t==null?void 0:t.temperature)??this.temperature,this.temperature&&(this.temperature<0||this.temperature>1))throw new Error("`temperature` must be in the range of [0.0,1.0]");if(this.topP=(t==null?void 0:t.topP)??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=(t==null?void 0:t.topK)??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=(t==null?void 0:t.stopSequences)??this.stopSequences,this.apiKey=(t==null?void 0:t.apiKey)??po("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=(t==null?void 0:t.safetySettings)??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(a=>a.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=(t==null?void 0:t.streaming)??this.streaming,this.client=new T9(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...t!=null&&t.json?{responseMimeType:"application/json"}:{}}},{apiVersion:t==null?void 0:t.apiVersion,baseUrl:t==null?void 0:t.baseUrl}),this.streamUsage=(t==null?void 0:t.streamUsage)??this.streamUsage}useCachedContent(t,n,r){this.apiKey&&(this.client=new T9(this.apiKey).getGenerativeModelFromCachedContent(t,n,r))}get useSystemInstruction(){return typeof this.convertSystemMessageToHumanContent=="boolean"?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return this.modelName==="gemini-1.0-pro-001"||this.modelName.startsWith("gemini-pro-vision")||this.modelName.startsWith("gemini-1.0-pro-vision")?!1:this.modelName!=="gemini-pro"}getLsParams(t){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:t.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(t,n){var r;return this.bind({tools:(r=q9(t))==null?void 0:r.tools,...n})}invocationParams(t){var r;const n=(r=t==null?void 0:t.tools)!=null&&r.length?q9(t.tools,{toolChoice:t.tool_choice,allowedFunctionNames:t.allowedFunctionNames}):void 0;return{...n!=null&&n.tools?{tools:n.tools}:{},...n!=null&&n.toolConfig?{toolConfig:n.toolConfig}:{}}}async _generate(t,n,r){var u;const a=U9(t,this._isMultimodalModel,this.useSystemInstruction);let o=a;if(a[0].role==="system"){const[d]=a;this.client.systemInstruction=d,o=a.slice(1)}const i=this.invocationParams(n);if(this.streaming){const d={},p=this._streamResponseChunks(t,n,r),f={};for await(const m of p){const y=((u=m.generationInfo)==null?void 0:u.completion)??0;f[y]===void 0?f[y]=m:f[y]=f[y].concat(m)}return{generations:Object.entries(f).sort(([m],[y])=>parseInt(m,10)-parseInt(y,10)).map(([m,y])=>y),llmOutput:{estimatedTokenUsage:d}}}const s=await this.completionWithRetry({...i,contents:o});let c;if("usageMetadata"in s.response){const d=s.response.usageMetadata;c={input_tokens:d.promptTokenCount??0,output_tokens:d.candidatesTokenCount??0,total_tokens:d.totalTokenCount??0}}const l=Gve(s.response,{usageMetadata:c});return await(r==null?void 0:r.handleLLMNewToken(l.generations[0].text??"")),l}async*_streamResponseChunks(t,n,r){const a=U9(t,this._isMultimodalModel,this.useSystemInstruction);let o=a;if(a[0].role==="system"){const[u]=a;this.client.systemInstruction=u,o=a.slice(1)}const i={...this.invocationParams(n),contents:o},s=await this.caller.callWithOptions({signal:n==null?void 0:n.signal},async()=>{const{stream:u}=await this.client.generateContentStream(i);return u});let c,l=0;for await(const u of s){if("usageMetadata"in u&&this.streamUsage!==!1&&n.streamUsage!==!1){const p=u.usageMetadata;if(!c)c={input_tokens:p.promptTokenCount,output_tokens:p.candidatesTokenCount,total_tokens:p.totalTokenCount};else{const f=p.candidatesTokenCount-c.output_tokens;c={input_tokens:0,output_tokens:f,total_tokens:f}}}const d=Xve(u,{usageMetadata:c,index:l});l+=1,d&&(yield d,await(r==null?void 0:r.handleLLMNewToken(d.text??"")))}}async completionWithRetry(t,n){return this.caller.callWithOptions({signal:n==null?void 0:n.signal},async()=>{var r;try{return await this.client.generateContent(t)}catch(a){throw(r=a.message)!=null&&r.includes("400 Bad Request")&&(a.status=400),a}})}withStructuredOutput(t,n){const r=t,a=n==null?void 0:n.name,o=n==null?void 0:n.method,i=n==null?void 0:n.includeRaw;if(o==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "functionCalling" as a method.');let s=a??"extract",c,l;if(Xd(r)){const m=z9(r);l=[{functionDeclarations:[{name:s,description:m.description??"A function available to call.",parameters:m}]}],c=new V9({returnSingle:!0,keyName:s,zodSchema:r})}else{let m;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(m=r,s=r.name):m={name:s,description:r.description??"",parameters:r},l=[{functionDeclarations:[m]}],c=new V9({returnSingle:!0,keyName:s})}const u=this.bind({tools:l,tool_choice:s});if(!i)return u.pipe(c).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});const d=_i.assign({parsed:(m,y)=>c.invoke(m.raw,y)}),p=_i.assign({parsed:()=>null}),f=d.withFallbacks({fallbacks:[p]});return Cv.from([{raw:u},f]).withConfig({runName:"StructuredOutputRunnable"})}}const n0e=e=>{const t=(n,r=null)=>{let a=`{
`;return n.filter(o=>o.parent_id===r).forEach(o=>{if(o.type==="object"){const i=e.filter(c=>c.parent_id===o.id),s=t(i,o.id);a+=`  ${o.name}${o.required?"":"?"}: ${s}
`}else a+=`  // ${o.description||""}
  ${o.name}${o.required?"":"?"}: ${o.type};
`}),a+="}",a};return t(e)},W9=e=>{const t=(r,a=null)=>{let o="";return r.filter(i=>i.parent_id===a).forEach(i=>{if(i.type==="object"){const s=t(r,i.id);o+=`    ${i.name}: z.object({
${s}    })${i.required?"":".optional()"}.describe('${i.description||""}'),
`}else o+=`    ${i.name}: z.${i.type}()${i.required?"":".optional()"}.describe('${i.description||""}'),
`}),o};let n=`const schema = z.object({
`;return n+=t(e),n+="});",n},r0e=e=>{const t={},n={string:Pa.string,number:Pa.number,boolean:Pa.boolean,enum:()=>Pa.enum([""])};return e.forEach(r=>{if(!r.parent_id)if(r.type==="object"){const a=e.filter(i=>i.parent_id===r.id),o={};a.forEach(i=>{i.type==="object"||i.type==="array"||(o[i.name]=n[i.type](),i.required||(o[i.name]=o[i.name].optional()))}),t[r.name]=Pa.object(o),r.required||(t[r.name]=t[r.name].optional())}else r.type==="array"?(t[r.name]=Pa.array(Pa.string()),r.required||(t[r.name]=t[r.name].optional())):r.type==="enum"?(t[r.name]=Pa.enum((r.enum||"").split(",")),r.required||(t[r.name]=t[r.name].optional())):(t[r.name]=n[r.type](),r.required||(t[r.name]=t[r.name].optional()))}),Pa.object(t)},AS=()=>{const{toast:e}=nn(),{t}=ke("errors"),n=Je(a=>a.currentSession),{modalRef:r}=Pd(Nm);return{confirmPassphrase:g.useCallback(async()=>{if(!(n!=null&&n.passphrase))throw new Error("Session is not found");await Wi.exists("passphrase")||await new Promise((a,o)=>{r.current.show({onConfirm:async i=>{try{const s=await Mm(n.passphrase,i);await Wi.set("passphrase",s),a()}catch(s){e({content:t("invalid_passphrase"),variant:"destructive"}),o(s)}finally{r.current.hide()}},onCancel:()=>{o()}})})},[n==null?void 0:n.passphrase,r,t,e])}},TS=async(e,t,{schemas:n,onMessageUpdate:r})=>{let a="",o;if(n!=null&&n.length){const i=n.filter(c=>{var l;return(l=c.schema_items)==null?void 0:l.length}).flatMap(c=>c.schema_items),s=await e.withStructuredOutput(r0e(i)).stream(t);for await(const c of s)a=JSON.stringify(c),r==null||r({content:a})}else{const i=await e.stream(t);for await(const s of i)a+=`${s.content}`,o=s,r==null||r({content:a,chunk:s})}return{lastChunk:o,content:a}},a0e=()=>{const{confirmPassphrase:e}=AS();return{stream:g.useCallback(async(t,n)=>{var p,f,m,y,v;const{schemas:r,onMessageUpdate:a,onMessageFinish:o}=n||{};await e();const i=(p=n==null?void 0:n.llm)==null?void 0:p.encrypted,s=((f=n==null?void 0:n.llm)==null?void 0:f.options)||{};if(!(i!=null&&i.key)||typeof i.key!="string")throw new Error("API Key is not found");const c=await Wi.get("passphrase");if(!c)throw new Error("Passphrase is not found");const l=await Mm(i.key,c);if(!l)throw new Error("API Key is not found");let u="",d;switch(n==null?void 0:n.provider){case We.GoogleGenerativeAI:{const b=new t0e({apiKey:l,model:(m=n==null?void 0:n.llm)==null?void 0:m.name,temperature:s!=null&&s.temperature?+s.temperature:void 0,topK:s!=null&&s.topK?+s.topK:void 0,topP:s!=null&&s.topP?+s.topP:void 0,stopSequences:s!=null&&s.stop?s.stop:void 0,maxOutputTokens:s!=null&&s.maxTokens?+s.maxTokens:void 0});if(i!=null&&i.enabled_google_search_retrieval){const j={googleSearchRetrieval:{dynamicRetrievalConfig:{mode:"MODE_DYNAMIC",dynamicThreshold:.7}}};b.bindTools([j])}const w=await TS(b,t,{schemas:r,onMessageUpdate:a});u=w.content,d=w.lastChunk}break;case We.Groq:{const b=new Nge({apiKey:l,model:(y=n==null?void 0:n.llm)==null?void 0:y.name,temperature:s!=null&&s.temperature?+s.temperature:void 0,stopSequences:s!=null&&s.stop?s.stop:void 0,maxTokens:s!=null&&s.maxTokens?+s.maxTokens:void 0}),w=await TS(b,t,{schemas:r,onMessageUpdate:a});u=w.content,d=w.lastChunk}break;case We.OpenAI:{const b=new dye({apiKey:l,model:(v=n==null?void 0:n.llm)==null?void 0:v.name,temperature:s!=null&&s.temperature?+s.temperature:void 0,topP:s!=null&&s.topP?+s.topP:void 0,stopSequences:s!=null&&s.stop?s.stop:void 0,maxTokens:s!=null&&s.maxTokens?+s.maxTokens:void 0}),w=await TS(b,t,{schemas:r,onMessageUpdate:a});u=w.content,d=w.lastChunk}break;default:throw new Error("Provider is not supported")}return o==null||o({content:u,lastChunk:d}),{lastChunk:d,content:u}},[e])}},nl=()=>{const e=Xk(),t=a0e();return{stream:g.useCallback((n,r,a)=>{switch(n){case We.WebLLM:return e.stream(r,a);case We.GoogleGenerativeAI:case We.Groq:case We.OpenAI:return t.stream(r,{...a,provider:n});default:throw new Error("Provider is not supported")}},[t,e])}},rp=()=>{const[e,t]=g.useState(!1),n=ZG(i=>i.index),r=ZG(i=>i.similaritySearchWithScore),a=g.useCallback(async(i,...s)=>{try{if(t(!0),!i){const[c,l]=s;return r(c,l)}}finally{t(!1)}},[r]),o=g.useCallback(async(i,...s)=>{try{if(t(!0),!i){const[c,l]=s;return n(c,l)}}finally{t(!1)}},[n]);return{loading:e,index:o,similaritySearchWithScore:a}},o0e=e=>{const[t]=g.useState(!1),{similaritySearchWithScore:n}=rp(),{stream:r}=nl(),a=g.useCallback(async(i,s)=>{if(!(s!=null&&s.length))return[];const c=[];return await Promise.all(s.map(async l=>{var d,p,f,m;const u=l.placeholderEntity;if(u)switch(u.placeholder_type){case Xi.VECTOR_DATABASE_RETREIVER:{if(!l.promptNode||!l.promptEntity||!l.vectorDatabaseNode||!l.vectorDatabaseEntity)return;const y=(d=u.metadata)!=null&&d.k?+((p=u.metadata)==null?void 0:p.k):1;let v=(f=u.metadata)!=null&&f.minimalScore?+((m=u.metadata)==null?void 0:m.minimalScore):void 0;v&&v>1&&(v=v/100);const b=await n(void 0,{database:{databaseId:l.vectorDatabaseEntity.id}},i,y);if(!b)return[];const w=new oi({template:l.promptEntity.content,inputVariables:["context"]});c.push(new Aa(await w.format({context:v?b.filter(([,j])=>j>=v).map(([j])=>j.pageContent).join(`
`):b.map(([j])=>j.pageContent).join(`
`)})))}}})),c},[n]),o=g.useCallback(async(i,s,{retriverInfo:c},{schema:l,onMessageUpdate:u,onResponseMessageCreate:d,onInjectedMessages:p})=>{var v,b;if(!((v=e.mainLLMInfo)!=null&&v.llm)||((b=e.mainLLMInfo)==null?void 0:b.status)!==et.Loaded)throw new Error("LLM not found");const f=[];c!=null&&c.length&&(f.push(...await a(i,c)),p==null||p(f));const m=s.map(w=>w.role==="system"?new kv(w.content):w.role==="user"?new Ur(w.content):new Aa(w.content));d==null||d();const{content:y}=await r(e.mainLLMInfo.llm.provider,m,{schemas:l?[l]:void 0,onMessageUpdate:({content:w})=>{u==null||u({nodeData:{loading:!0,content:w}})},llm:e.mainLLMInfo.llm});return u==null||u({nodeData:{content:y}}),y},[a,r,e.mainLLMInfo]);return{loading:t,sendMessage:o}},i0e=uo(({onDelete:e})=>{const{t}=ke("dialogs"),[n,r]=g.useState(!1),a=tn(),{toast:o}=nn(),i=async()=>{try{r(!0),await e(),a.hide()}catch{o({variant:"destructive",description:t("delete_chat_data_node.errors.delete_failed")})}finally{r(!1)}};return h.jsx(Z2,{open:a.visible,onOpenChange:a.hide,children:h.jsxs(Vb,{children:[h.jsxs(qb,{children:[h.jsx(Hb,{children:t("delete_chat_data_node.title")}),h.jsx(Kb,{children:t("delete_chat_data_node.description")})]}),h.jsxs(Wb,{children:[h.jsx(Gb,{onClick:a.hide,children:t("delete_chat_data_node.cancel")}),h.jsx(Zb,{disabled:n,onClick:i,children:t("delete_chat_data_node.delete")})]})]})})});function vy(){return h.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[h.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor",children:h.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),h.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",children:h.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),h.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor",children:h.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const s0e=g.lazy(()=>Ht(()=>import("./index-C-LrYoBr.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([5,6,1,2,7,8]))),IS=g.memo(({source:e,className:t,...n})=>{const r=eu(o=>o.theme),a=g.useMemo(()=>({pre:({children:o,className:i,...s})=>h.jsx("pre",{...s,className:Z(i,"nowheel"),children:o}),think:({children:o})=>h.jsxs(h.Fragment,{children:[h.jsx("code",{className:"!rounded-none",children:"Think: "}),h.jsx("blockquote",{className:"think",children:o})]})}),[]);return h.jsx(g.Suspense,{children:h.jsx(s0e,{className:Z("!text-sm [&_p]:leading-relaxed !max-w-full !bg-transparent !font-sans",t),source:e,wrapperElement:{"data-color-mode":r==="dark"?"dark":"light"},components:a,...n})})},(e,t)=>e.source===t.source),Gt=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,className:Z("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Gt.displayName="Card";const Mn=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,className:Z("flex flex-col space-y-1.5 p-6",e),...t}));Mn.displayName="CardHeader";const $n=g.forwardRef(({className:e,...t},n)=>h.jsx("h3",{ref:n,className:Z("text-2xl font-semibold leading-none tracking-tight",e),...t}));$n.displayName="CardTitle";const H9=g.forwardRef(({className:e,...t},n)=>h.jsx("p",{ref:n,className:Z("text-sm text-muted-foreground",e),...t}));H9.displayName="CardDescription";const kn=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,className:Z("p-6 pt-0",e),...t}));kn.displayName="CardContent";const Ja=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,className:Z("flex items-center p-6 pt-0",e),...t}));Ja.displayName="CardFooter";function Oi(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e==null||e(r),n===!1||!r.defaultPrevented)return t==null?void 0:t(r)}}function K9(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Z9(...e){return t=>{let n=!1;const r=e.map(a=>{const o=K9(a,t);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let a=0;a<r.length;a++){const o=r[a];typeof o=="function"?o():K9(e[a],null)}}}}function Ci(...e){return g.useCallback(Z9(...e),e)}var RS=g.forwardRef((e,t)=>{const{children:n,...r}=e,a=g.Children.toArray(n),o=a.find(l0e);if(o){const i=o.props.children,s=a.map(c=>c===o?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:c);return h.jsx(DS,{...r,ref:t,children:g.isValidElement(i)?g.cloneElement(i,void 0,s):null})}return h.jsx(DS,{...r,ref:t,children:n})});RS.displayName="Slot";var DS=g.forwardRef((e,t)=>{const{children:n,...r}=e;if(g.isValidElement(n)){const a=d0e(n);return g.cloneElement(n,{...u0e(r,n.props),ref:t?Z9(t,a):a})}return g.Children.count(n)>1?g.Children.only(null):null});DS.displayName="SlotClone";var c0e=({children:e})=>h.jsx(h.Fragment,{children:e});function l0e(e){return g.isValidElement(e)&&e.type===c0e}function u0e(e,t){const n={...t};for(const r in t){const a=e[r],o=t[r];/^on[A-Z]/.test(r)?a&&o?n[r]=(...i)=>{o(...i),a(...i)}:a&&(n[r]=a):r==="style"?n[r]={...a,...o}:r==="className"&&(n[r]=[a,o].filter(Boolean).join(" "))}return{...e,...n}}function d0e(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var p0e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Bo=p0e.reduce((e,t)=>{const n=g.forwardRef((r,a)=>{const{asChild:o,...i}=r,s=o?RS:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(s,{...i,ref:a})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function f0e(e,t){e&&Ql.flushSync(()=>e.dispatchEvent(t))}var h0e="DismissableLayer",LS="dismissableLayer.update",m0e="dismissableLayer.pointerDownOutside",y0e="dismissableLayer.focusOutside",G9,X9=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),J9=g.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:a,onFocusOutside:o,onInteractOutside:i,onDismiss:s,...c}=e,l=g.useContext(X9),[u,d]=g.useState(null),p=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=g.useState({}),m=Ci(t,E=>d(E)),y=Array.from(l.layers),[v]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),b=y.indexOf(v),w=u?y.indexOf(u):-1,j=l.layersWithOutsidePointerEventsDisabled.size>0,x=w>=b,_=b0e(E=>{const O=E.target,N=[...l.branches].some(M=>M.contains(O));!x||N||(a==null||a(E),i==null||i(E),E.defaultPrevented||(s==null||s()))},p),S=w0e(E=>{const O=E.target;[...l.branches].some(N=>N.contains(O))||(o==null||o(E),i==null||i(E),E.defaultPrevented||(s==null||s()))},p);return XDe(E=>{w===l.layers.size-1&&(r==null||r(E),!E.defaultPrevented&&s&&(E.preventDefault(),s()))},p),g.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(G9=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),Y9(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=G9)}},[u,p,n,l]),g.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),Y9())},[u,l]),g.useEffect(()=>{const E=()=>f({});return document.addEventListener(LS,E),()=>document.removeEventListener(LS,E)},[]),h.jsx(Bo.div,{...c,ref:m,style:{pointerEvents:j?x?"auto":"none":void 0,...e.style},onFocusCapture:Oi(e.onFocusCapture,S.onFocusCapture),onBlurCapture:Oi(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:Oi(e.onPointerDownCapture,_.onPointerDownCapture)})});J9.displayName=h0e;var g0e="DismissableLayerBranch",v0e=g.forwardRef((e,t)=>{const n=g.useContext(X9),r=g.useRef(null),a=Ci(t,r);return g.useEffect(()=>{const o=r.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),h.jsx(Bo.div,{...e,ref:a})});v0e.displayName=g0e;function b0e(e,t=globalThis==null?void 0:globalThis.document){const n=dr(e),r=g.useRef(!1),a=g.useRef(()=>{});return g.useEffect(()=>{const o=s=>{if(s.target&&!r.current){let c=function(){Q9(m0e,n,l,{discrete:!0})};const l={originalEvent:s};s.pointerType==="touch"?(t.removeEventListener("click",a.current),a.current=c,t.addEventListener("click",a.current,{once:!0})):c()}else t.removeEventListener("click",a.current);r.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",o),t.removeEventListener("click",a.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function w0e(e,t=globalThis==null?void 0:globalThis.document){const n=dr(e),r=g.useRef(!1);return g.useEffect(()=>{const a=o=>{o.target&&!r.current&&Q9(y0e,n,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",a),()=>t.removeEventListener("focusin",a)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Y9(){const e=new CustomEvent(LS);document.dispatchEvent(e)}function Q9(e,t,n,{discrete:r}){const a=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&a.addEventListener(e,t,{once:!0}),r?f0e(a,o):a.dispatchEvent(o)}var $S="focusScope.autoFocusOnMount",FS="focusScope.autoFocusOnUnmount",eF={bubbles:!1,cancelable:!0},x0e="FocusScope",tF=g.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:a,onUnmountAutoFocus:o,...i}=e,[s,c]=g.useState(null),l=dr(a),u=dr(o),d=g.useRef(null),p=Ci(t,y=>c(y)),f=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(r){let y=function(j){if(f.paused||!s)return;const x=j.target;s.contains(x)?d.current=x:Ni(d.current,{select:!0})},v=function(j){if(f.paused||!s)return;const x=j.relatedTarget;x!==null&&(s.contains(x)||Ni(d.current,{select:!0}))},b=function(j){if(document.activeElement===document.body)for(const x of j)x.removedNodes.length>0&&Ni(s)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const w=new MutationObserver(b);return s&&w.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),w.disconnect()}}},[r,s,f.paused]),g.useEffect(()=>{if(s){aF.add(f);const y=document.activeElement;if(!s.contains(y)){const v=new CustomEvent($S,eF);s.addEventListener($S,l),s.dispatchEvent(v),v.defaultPrevented||(_0e(C0e(nF(s)),{select:!0}),document.activeElement===y&&Ni(s))}return()=>{s.removeEventListener($S,l),setTimeout(()=>{const v=new CustomEvent(FS,eF);s.addEventListener(FS,u),s.dispatchEvent(v),v.defaultPrevented||Ni(y??document.body,{select:!0}),s.removeEventListener(FS,u),aF.remove(f)},0)}}},[s,l,u,f]);const m=g.useCallback(y=>{if(!n&&!r||f.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,b=document.activeElement;if(v&&b){const w=y.currentTarget,[j,x]=j0e(w);j&&x?!y.shiftKey&&b===x?(y.preventDefault(),n&&Ni(j,{select:!0})):y.shiftKey&&b===j&&(y.preventDefault(),n&&Ni(x,{select:!0})):b===w&&y.preventDefault()}},[n,r,f.paused]);return h.jsx(Bo.div,{tabIndex:-1,...i,ref:p,onKeyDown:m})});tF.displayName=x0e;function _0e(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Ni(r,{select:t}),document.activeElement!==n)return}function j0e(e){const t=nF(e),n=rF(t,e),r=rF(t.reverse(),e);return[n,r]}function nF(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const a=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||a?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function rF(e,t){for(const n of e)if(!S0e(n,{upTo:t}))return n}function S0e(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function E0e(e){return e instanceof HTMLInputElement&&"select"in e}function Ni(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&E0e(e)&&t&&e.select()}}var aF=O0e();function O0e(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=oF(e,t),e.unshift(t)},remove(t){var n;e=oF(e,t),(n=e[0])==null||n.resume()}}}function oF(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function C0e(e){return e.filter(t=>t.tagName!=="A")}var N0e="Arrow",iF=g.forwardRef((e,t)=>{const{children:n,width:r=10,height:a=5,...o}=e;return h.jsx(Bo.svg,{...o,ref:t,width:r,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});iF.displayName=N0e;var M0e=iF,BS="Popper",[sF,cF]=ur(BS),[k0e,lF]=sF(BS),uF=e=>{const{__scopePopper:t,children:n}=e,[r,a]=g.useState(null);return h.jsx(k0e,{scope:t,anchor:r,onAnchorChange:a,children:n})};uF.displayName=BS;var dF="PopperAnchor",pF=g.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...a}=e,o=lF(dF,n),i=g.useRef(null),s=Ci(t,i);return g.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:h.jsx(Bo.div,{...a,ref:s})});pF.displayName=dF;var zS="PopperContent",[P0e,A0e]=sF(zS),fF=g.forwardRef((e,t)=>{var ee,G,K,X,ne,V;const{__scopePopper:n,side:r="bottom",sideOffset:a=0,align:o="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:p=!1,updatePositionStrategy:f="optimized",onPlaced:m,...y}=e,v=lF(zS,n),[b,w]=g.useState(null),j=Ci(t,le=>w(le)),[x,_]=g.useState(null),S=_f(x),E=(S==null?void 0:S.width)??0,O=(S==null?void 0:S.height)??0,N=r+(o!=="center"?"-"+o:""),M=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},k=Array.isArray(l)?l:[l],P=k.length>0,A={padding:M,boundary:k.filter(I0e),altBoundary:P},{refs:C,floatingStyles:I,placement:T,isPositioned:R,middlewareData:L}=Xv({strategy:"fixed",placement:N,whileElementsMounted:(...le)=>Dv(...le,{animationFrame:f==="always"}),elements:{reference:v.anchor},middleware:[Jv({mainAxis:a+O,alignmentAxis:i}),c&&Yv({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?Qv():void 0,...A}),c&&e0({...A}),$v({...A,apply:({elements:le,rects:ae,availableWidth:de,availableHeight:je})=>{const{width:Le,height:$e}=ae.reference,Se=le.floating.style;Se.setProperty("--radix-popper-available-width",`${de}px`),Se.setProperty("--radix-popper-available-height",`${je}px`),Se.setProperty("--radix-popper-anchor-width",`${Le}px`),Se.setProperty("--radix-popper-anchor-height",`${$e}px`)}}),x&&f0({element:x,padding:s}),R0e({arrowWidth:E,arrowHeight:O}),p&&h0({strategy:"referenceHidden",...A})]}),[D,z]=yF(T),B=dr(m);ln(()=>{R&&(B==null||B())},[R,B]);const $=(ee=L.arrow)==null?void 0:ee.x,U=(G=L.arrow)==null?void 0:G.y,F=((K=L.arrow)==null?void 0:K.centerOffset)!==0,[H,re]=g.useState();return ln(()=>{b&&re(window.getComputedStyle(b).zIndex)},[b]),h.jsx("div",{ref:C.setFloating,"data-radix-popper-content-wrapper":"",style:{...I,transform:R?I.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:H,"--radix-popper-transform-origin":[(X=L.transformOrigin)==null?void 0:X.x,(ne=L.transformOrigin)==null?void 0:ne.y].join(" "),...((V=L.hide)==null?void 0:V.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:h.jsx(P0e,{scope:n,placedSide:D,onArrowChange:_,arrowX:$,arrowY:U,shouldHideArrow:F,children:h.jsx(Bo.div,{"data-side":D,"data-align":z,...y,ref:j,style:{...y.style,animation:R?void 0:"none"}})})})});fF.displayName=zS;var hF="PopperArrow",T0e={top:"bottom",right:"left",bottom:"top",left:"right"},mF=g.forwardRef(function(e,t){const{__scopePopper:n,...r}=e,a=A0e(hF,n),o=T0e[a.placedSide];return h.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:h.jsx(M0e,{...r,ref:t,style:{...r.style,display:"block"}})})});mF.displayName=hF;function I0e(e){return e!==null}var R0e=e=>({name:"transformOrigin",options:e,fn(t){var y,v,b;const{placement:n,rects:r,middlewareData:a}=t,o=((y=a.arrow)==null?void 0:y.centerOffset)!==0,i=o?0:e.arrowWidth,s=o?0:e.arrowHeight,[c,l]=yF(n),u={start:"0%",center:"50%",end:"100%"}[l],d=(((v=a.arrow)==null?void 0:v.x)??0)+i/2,p=(((b=a.arrow)==null?void 0:b.y)??0)+s/2;let f="",m="";return c==="bottom"?(f=o?u:`${d}px`,m=`${-s}px`):c==="top"?(f=o?u:`${d}px`,m=`${r.floating.height+s}px`):c==="right"?(f=`${-s}px`,m=o?u:`${p}px`):c==="left"&&(f=`${r.floating.width+s}px`,m=o?u:`${p}px`),{data:{x:f,y:m}}}});function yF(e){const[t,n="center"]=e.split("-");return[t,n]}var D0e=uF,gF=pF,L0e=fF,$0e=mF,F0e="Portal",vF=g.forwardRef((e,t)=>{var s;const{container:n,...r}=e,[a,o]=g.useState(!1);ln(()=>o(!0),[]);const i=n||a&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return i?JDe.createPortal(h.jsx(Bo.div,{...r,ref:t}),i):null});vF.displayName=F0e;function B0e(e,t){return g.useReducer((n,r)=>t[n][r]??n,e)}var US=e=>{const{present:t,children:n}=e,r=z0e(t),a=typeof n=="function"?n({present:r.isPresent}):g.Children.only(n),o=Ci(r.ref,U0e(a));return typeof n=="function"||r.isPresent?g.cloneElement(a,{ref:o}):null};US.displayName="Presence";function z0e(e){const[t,n]=g.useState(),r=g.useRef({}),a=g.useRef(e),o=g.useRef("none"),i=e?"mounted":"unmounted",[s,c]=B0e(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const l=by(r.current);o.current=s==="mounted"?l:"none"},[s]),ln(()=>{const l=r.current,u=a.current;if(u!==e){const d=o.current,p=by(l);e?c("MOUNT"):p==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&d!==p?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,c]),ln(()=>{if(t){let l;const u=t.ownerDocument.defaultView??window,d=f=>{const m=by(r.current).includes(f.animationName);if(f.target===t&&m&&(c("ANIMATION_END"),!a.current)){const y=t.style.animationFillMode;t.style.animationFillMode="forwards",l=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=y)})}},p=f=>{f.target===t&&(o.current=by(r.current))};return t.addEventListener("animationstart",p),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{u.clearTimeout(l),t.removeEventListener("animationstart",p),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:g.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function by(e){return(e==null?void 0:e.animationName)||"none"}function U0e(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var wy="right-scroll-bar-position",xy="width-before-scroll-bar",V0e="with-scroll-bars-hidden",q0e="--removed-body-scroll-bar-size";function VS(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function W0e(e,t){var n=g.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var a=n.value;a!==r&&(n.value=r,n.callback(r,a))}}}})[0];return n.callback=t,n.facade}var H0e=typeof window<"u"?g.useLayoutEffect:g.useEffect,bF=new WeakMap;function K0e(e,t){var n=W0e(null,function(r){return e.forEach(function(a){return VS(a,r)})});return H0e(function(){var r=bF.get(n);if(r){var a=new Set(r),o=new Set(e),i=n.current;a.forEach(function(s){o.has(s)||VS(s,null)}),o.forEach(function(s){a.has(s)||VS(s,i)})}bF.set(n,e)},[e]),n}var wF=m0(),qS=function(){},_y=g.forwardRef(function(e,t){var n=g.useRef(null),r=g.useState({onScrollCapture:qS,onWheelCapture:qS,onTouchMoveCapture:qS}),a=r[0],o=r[1],i=e.forwardProps,s=e.children,c=e.className,l=e.removeScrollBar,u=e.enabled,d=e.shards,p=e.sideCar,f=e.noIsolation,m=e.inert,y=e.allowPinchZoom,v=e.as,b=v===void 0?"div":v,w=e.gapMode,j=jf(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),x=p,_=K0e([n,t]),S=En(En({},j),a);return g.createElement(g.Fragment,null,u&&g.createElement(x,{sideCar:wF,removeScrollBar:l,shards:d,noIsolation:f,inert:m,setCallbacks:o,allowPinchZoom:!!y,lockRef:n,gapMode:w}),i?g.cloneElement(g.Children.only(s),En(En({},S),{ref:_})):g.createElement(b,En({},S,{className:c,ref:_}),s))});_y.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},_y.classNames={fullWidth:xy,zeroRight:wy};function Z0e(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=y0();return t&&e.setAttribute("nonce",t),e}function G0e(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function X0e(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var J0e=function(){var e=0,t=null;return{add:function(n){e==0&&(t=Z0e())&&(G0e(t,n),X0e(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Y0e=function(){var e=J0e();return function(t,n){g.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},Q0e=function(){var e=Y0e(),t=function(n){var r=n.styles,a=n.dynamic;return e(r,a),null};return t},ebe={left:0,top:0,right:0,gap:0},WS=function(e){return parseInt(e||"",10)||0},tbe=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],a=t[e==="padding"?"paddingRight":"marginRight"];return[WS(n),WS(r),WS(a)]},nbe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return ebe;var t=tbe(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},rbe=Q0e(),rl="data-scroll-locked",abe=function(e,t,n,r){var a=e.left,o=e.top,i=e.right,s=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(V0e,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(s,"px ").concat(r,`;
  }
  body[`).concat(rl,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(wy,` {
    right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(xy,` {
    margin-right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(wy," .").concat(wy,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(xy," .").concat(xy,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(rl,`] {
    `).concat(q0e,": ").concat(s,`px;
  }
`)},xF=function(){var e=parseInt(document.body.getAttribute(rl)||"0",10);return isFinite(e)?e:0},obe=function(){g.useEffect(function(){return document.body.setAttribute(rl,(xF()+1).toString()),function(){var e=xF()-1;e<=0?document.body.removeAttribute(rl):document.body.setAttribute(rl,e.toString())}},[])},ibe=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,a=r===void 0?"margin":r;obe();var o=g.useMemo(function(){return nbe(a)},[a]);return g.createElement(rbe,{styles:abe(o,!t,a,n?"":"!important")})},HS=!1;if(typeof window<"u")try{var jy=Object.defineProperty({},"passive",{get:function(){return HS=!0,!0}});window.addEventListener("test",jy,jy),window.removeEventListener("test",jy,jy)}catch{HS=!1}var al=HS?{passive:!1}:!1,sbe=function(e){return e.tagName==="TEXTAREA"},_F=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!sbe(e)&&n[t]==="visible")},cbe=function(e){return _F(e,"overflowY")},lbe=function(e){return _F(e,"overflowX")},jF=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var a=SF(e,r);if(a){var o=EF(e,r),i=o[1],s=o[2];if(i>s)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},ube=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},dbe=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},SF=function(e,t){return e==="v"?cbe(t):lbe(t)},EF=function(e,t){return e==="v"?ube(t):dbe(t)},pbe=function(e,t){return e==="h"&&t==="rtl"?-1:1},fbe=function(e,t,n,r,a){var o=pbe(e,window.getComputedStyle(t).direction),i=o*r,s=n.target,c=t.contains(s),l=!1,u=i>0,d=0,p=0;do{var f=EF(e,s),m=f[0],y=f[1],v=f[2],b=y-v-o*m;(m||b)&&SF(e,s)&&(d+=b,p+=m),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!c&&s!==document.body||c&&(t.contains(s)||t===s));return(u&&(Math.abs(d)<1||!a)||!u&&(Math.abs(p)<1||!a))&&(l=!0),l},Sy=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},OF=function(e){return[e.deltaX,e.deltaY]},CF=function(e){return e&&"current"in e?e.current:e},hbe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},mbe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},ybe=0,ol=[];function gbe(e){var t=g.useRef([]),n=g.useRef([0,0]),r=g.useRef(),a=g.useState(ybe++)[0],o=g.useState(Sf)[0],i=g.useRef(e);g.useEffect(function(){i.current=e},[e]),g.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var y=g0([e.lockRef.current],(e.shards||[]).map(CF),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var s=g.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var b=Sy(y),w=n.current,j="deltaX"in y?y.deltaX:w[0]-b[0],x="deltaY"in y?y.deltaY:w[1]-b[1],_,S=y.target,E=Math.abs(j)>Math.abs(x)?"h":"v";if("touches"in y&&E==="h"&&S.type==="range")return!1;var O=jF(E,S);if(!O)return!0;if(O?_=E:(_=E==="v"?"h":"v",O=jF(E,S)),!O)return!1;if(!r.current&&"changedTouches"in y&&(j||x)&&(r.current=_),!_)return!0;var N=r.current||_;return fbe(N,v,y,N==="h"?j:x,!0)},[]),c=g.useCallback(function(y){var v=y;if(!(!ol.length||ol[ol.length-1]!==o)){var b="deltaY"in v?OF(v):Sy(v),w=t.current.filter(function(_){return _.name===v.type&&(_.target===v.target||v.target===_.shadowParent)&&hbe(_.delta,b)})[0];if(w&&w.should){v.cancelable&&v.preventDefault();return}if(!w){var j=(i.current.shards||[]).map(CF).filter(Boolean).filter(function(_){return _.contains(v.target)}),x=j.length>0?s(v,j[0]):!i.current.noIsolation;x&&v.cancelable&&v.preventDefault()}}},[]),l=g.useCallback(function(y,v,b,w){var j={name:y,delta:v,target:b,should:w,shadowParent:vbe(b)};t.current.push(j),setTimeout(function(){t.current=t.current.filter(function(x){return x!==j})},1)},[]),u=g.useCallback(function(y){n.current=Sy(y),r.current=void 0},[]),d=g.useCallback(function(y){l(y.type,OF(y),y.target,s(y,e.lockRef.current))},[]),p=g.useCallback(function(y){l(y.type,Sy(y),y.target,s(y,e.lockRef.current))},[]);g.useEffect(function(){return ol.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:p}),document.addEventListener("wheel",c,al),document.addEventListener("touchmove",c,al),document.addEventListener("touchstart",u,al),function(){ol=ol.filter(function(y){return y!==o}),document.removeEventListener("wheel",c,al),document.removeEventListener("touchmove",c,al),document.removeEventListener("touchstart",u,al)}},[]);var f=e.removeScrollBar,m=e.inert;return g.createElement(g.Fragment,null,m?g.createElement(o,{styles:mbe(a)}):null,f?g.createElement(ibe,{gapMode:e.gapMode}):null)}function vbe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const bbe=v0(wF,gbe);var NF=g.forwardRef(function(e,t){return g.createElement(_y,En({},e,{ref:t,sideCar:bbe}))});NF.classNames=_y.classNames;var KS="Popover",[MF,b3e]=ur(KS,[cF]),ap=cF(),[wbe,Mi]=MF(KS),kF=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:a,onOpenChange:o,modal:i=!1}=e,s=ap(t),c=g.useRef(null),[l,u]=g.useState(!1),[d=!1,p]=Tn({prop:r,defaultProp:a,onChange:o});return h.jsx(D0e,{...s,children:h.jsx(wbe,{scope:t,contentId:Rt(),triggerRef:c,open:d,onOpenChange:p,onOpenToggle:g.useCallback(()=>p(f=>!f),[p]),hasCustomAnchor:l,onCustomAnchorAdd:g.useCallback(()=>u(!0),[]),onCustomAnchorRemove:g.useCallback(()=>u(!1),[]),modal:i,children:n})})};kF.displayName=KS;let ZS;ZS="PopoverAnchor",p0=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=Mi(ZS,n),o=ap(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:s}=a;return g.useEffect(()=>(i(),()=>s()),[i,s]),h.jsx(gF,{...o,...r,ref:t})}),p0.displayName=ZS;var PF="PopoverTrigger",GS=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=Mi(PF,n),o=ap(n),i=Ci(t,a.triggerRef),s=h.jsx(Bo.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":DF(a.open),...r,ref:i,onClick:Oi(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?s:h.jsx(gF,{asChild:!0,...o,children:s})});GS.displayName=PF;var XS="PopoverPortal",[xbe,_be]=MF(XS,{forceMount:void 0}),AF=e=>{const{__scopePopover:t,forceMount:n,children:r,container:a}=e,o=Mi(XS,t);return h.jsx(xbe,{scope:t,forceMount:n,children:h.jsx(US,{present:n||o.open,children:h.jsx(vF,{asChild:!0,container:a,children:r})})})};AF.displayName=XS;var il="PopoverContent",TF=g.forwardRef((e,t)=>{const n=_be(il,e.__scopePopover),{forceMount:r=n.forceMount,...a}=e,o=Mi(il,e.__scopePopover);return h.jsx(US,{present:r||o.open,children:o.modal?h.jsx(jbe,{...a,ref:t}):h.jsx(Sbe,{...a,ref:t})})});TF.displayName=il;var jbe=g.forwardRef((e,t)=>{const n=Mi(il,e.__scopePopover),r=g.useRef(null),a=Ci(t,r),o=g.useRef(!1);return g.useEffect(()=>{const i=r.current;if(i)return fu(i)},[]),h.jsx(NF,{as:RS,allowPinchZoom:!0,children:h.jsx(IF,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Oi(e.onCloseAutoFocus,i=>{var s;i.preventDefault(),o.current||((s=n.triggerRef.current)==null||s.focus())}),onPointerDownOutside:Oi(e.onPointerDownOutside,i=>{const s=i.detail.originalEvent,c=s.button===0&&s.ctrlKey===!0,l=s.button===2||c;o.current=l},{checkForDefaultPrevented:!1}),onFocusOutside:Oi(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),Sbe=g.forwardRef((e,t)=>{const n=Mi(il,e.__scopePopover),r=g.useRef(!1),a=g.useRef(!1);return h.jsx(IF,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,s;(i=e.onCloseAutoFocus)==null||i.call(e,o),o.defaultPrevented||(r.current||((s=n.triggerRef.current)==null||s.focus()),o.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:o=>{var s,c;(s=e.onInteractOutside)==null||s.call(e,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=o.target;(c=n.triggerRef.current)!=null&&c.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),IF=g.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:u,...d}=e,p=Mi(il,n),f=ap(n);return hu(),h.jsx(tF,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:o,children:h.jsx(J9,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>p.onOpenChange(!1),children:h.jsx(L0e,{"data-state":DF(p.open),role:"dialog",id:p.contentId,...f,...d,ref:t,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),RF="PopoverClose",Ebe=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=Mi(RF,n);return h.jsx(Bo.button,{type:"button",...r,ref:t,onClick:Oi(e.onClick,()=>a.onOpenChange(!1))})});Ebe.displayName=RF;var Obe="PopoverArrow",Cbe=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=ap(n);return h.jsx($0e,{...a,...r,ref:t})});Cbe.displayName=Obe;function DF(e){return e?"open":"closed"}lk=kF,tX=p0,mk=GS,ck=AF,Fv=TF,Ef=lk,b0=mk,mu=g.forwardRef(({className:e,align:t="center",sideOffset:n=4,...r},a)=>h.jsx(ck,{children:h.jsx(Fv,{ref:a,align:t,sideOffset:n,className:Z("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})})),mu.displayName=Fv.displayName;const LF=g.memo(e=>{const[t,n]=g.useState(!1),[r,a]=g.useState(e.options||{}),{t:o}=ke("atoms"),i=()=>{t||a(e.options||{}),n(!t)},s=()=>{var c;(c=e.onChangeOptions)==null||c.call(e,r||{}),n(!1)};return h.jsx("div",{className:e.className,children:h.jsxs(Ef,{open:t,onOpenChange:n,children:[h.jsx(b0,{asChild:!0,children:h.jsx("div",{className:"flex justify-end gap-2",children:h.jsxs(Ye,{onClick:i,variant:"link",className:"flex items-center px-0",children:[h.jsx(pe,{name:"settings"}),h.jsx(Be,{children:o("llm_setting.title")})]})})}),h.jsx(mu,{className:"w-full p-0",children:t?h.jsxs(Gt,{className:"!border-none",children:[h.jsx(Mn,{children:h.jsx($n,{children:o("llm_setting.title")})}),h.jsxs(kn,{children:[h.jsxs("div",{children:[h.jsxs(Be,{children:[o("llm_setting.temperature"),":"]}),h.jsx(Kt,{type:"number",value:r.temperature?`${r.temperature}`:"",onChange:c=>a(l=>({...l,temperature:c.target.value}))})]}),h.jsxs("div",{children:[h.jsxs(Be,{children:[o("llm_setting.top_p"),":"]}),h.jsx(Kt,{type:"number",value:r.topP?`${r.topP}`:"",onChange:c=>a(l=>({...l,topP:c.target.value}))})]}),h.jsxs("div",{children:[h.jsxs(Be,{children:[o("llm_setting.top_k"),":"]}),h.jsx(Kt,{type:"number",value:r.topK?`${r.topK}`:"",onChange:c=>a(l=>({...l,topK:c.target.value}))})]}),h.jsxs("div",{children:[h.jsxs(Be,{children:[o("llm_setting.max_tokens"),":"]}),h.jsx(Kt,{type:"number",value:r.max_tokens?`${r.max_tokens}`:"",onChange:c=>a(l=>({...l,maxTokens:c.target.value}))})]}),h.jsxs("div",{children:[h.jsxs(Be,{children:[o("llm_setting.stop_sequences"),":"]}),h.jsx(Kt,{placeholder:o("llm_setting.stop_sequences_placeholder"),value:r.stop?`${r.stop}`:"",onChange:c=>a(l=>({...l,stop:c.target.value}))})]})]}),h.jsx(Ja,{className:"flex justify-end",children:h.jsx(Ye,{variant:"secondary",onClick:s,children:o("llm_setting.save")})})]}):void 0})]})})}),Nbe=e=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"none",height:192,viewBox:"0 0 150 150",width:192,...e},g.createElement("clipPath",{id:"a"},g.createElement("path",{d:"m0 0h150v150h-150z"})),g.createElement("g",{clipPath:"url(#a)"},g.createElement("path",{d:"m150 0h-150v150h150z",fill:"#29b5e8"}),g.createElement("path",{clipRule:"evenodd",d:"m130.375 67.2532-14.096 8.1221 14.096 8.0536c.843.4872 1.581 1.1357 2.174 1.9084.592.7727 1.026 1.6545 1.278 2.5951.251.9406.315 1.9215.188 2.8867-.128.9652-.444 1.8959-.931 2.7388-.488.843-1.136 1.5817-1.909 2.174s-1.654 1.0267-2.595 1.2782-1.921.3154-2.887.1878c-.965-.1275-1.896-.444-2.739-.9312l-25.2559-14.5496c-1.1575-.6696-2.1128-1.6394-2.765-2.8068-.6523-1.1674-.9773-2.4893-.9408-3.826.0198-.5792.1089-1.1538.2653-1.7117.517-1.8711 1.7458-3.4654 3.4234-4.4419l25.256-14.4983c.847-.4892 1.782-.8067 2.751-.9343.97-.1275 1.955-.0627 2.899.1909.945.2536 1.83.6909 2.605 1.287.775.596 1.425 1.3391 1.913 2.1866.49.8402.808 1.7693.935 2.7334.128.964.063 1.9439-.191 2.8826-.254.9388-.692 1.8177-1.288 2.5859-.597.7681-1.34 1.4101-2.186 1.8887zm-13.343 39.3698-25.2478-14.5243c-1.1296-.6483-2.4091-.9896-3.7115-.9902s-2.5823.3397-3.7124.987c-1.1301.6472-2.0712 1.579-2.7297 2.7026-.6585 1.1237-1.0115 2.4001-1.0239 3.7024v29.0135c.0654 1.928.8772 3.755 2.264 5.095 1.3869 1.341 3.2403 2.09 5.1691 2.09 1.9289 0 3.7823-.749 5.1691-2.09 1.3868-1.34 2.1986-3.167 2.264-5.095v-16.261l14.1301 8.122c.843.488 1.774.805 2.739.933.966.128 1.947.064 2.888-.187s1.823-.685 2.596-1.277c.774-.592 1.423-1.331 1.91-2.174.488-.843.805-1.773.933-2.739.128-.965.065-1.946-.186-2.887s-.685-1.824-1.277-2.597-1.331-1.422-2.174-1.91zm-29.0992-28.3806-10.527 10.3986c-.3601.3349-.8269.5319-1.318.5563h-3.0897c-.49-.0294-.9551-.2257-1.318-.5563l-10.4671-10.4329c-.3274-.3573-.521-.817-.5478-1.3009v-3.081c.0283-.4861.2215-.9481.5478-1.3095l10.4671-10.4329c.3637-.3281.829-.5214 1.318-.5477h3.0897c.4899.0228.9562.2166 1.318.5477l10.4928 10.4329c.3237.3623.514.8243.5392 1.3095v3.081c-.0237.483-.2143.9428-.5392 1.3009zm-8.3874-2.8928c-.0404-.499-.2485-.9696-.5905-1.3352l-3.0383-3.004c-.3641-.3275-.8291-.5207-1.318-.5478h-.1113c-.4867.0255-.9495.2191-1.3094.5478l-3.0383 3.004c-.3262.3676-.5165.8358-.5392 1.3266v.1113c.0215.4834.2124.9439.5392 1.3009l3.0554 2.9955c.3607.3274.823.5208 1.3094.5477h.1113c.4889-.027.9539-.2203 1.318-.5477l3.0383-3.0212c.3282-.3576.5244-.8166.5563-1.3009zm-47.4914-31.2217 25.2563 14.4811c1.1308.648 2.4115.989 3.7149.9889 1.3033 0 2.584-.3409 3.7148-.989 1.1309-.648 2.0725-1.5806 2.7314-2.7051.659-1.1245 1.0123-2.4018 1.0249-3.7051v-28.9879c-.0654-1.9277-.8772-3.7546-2.264-5.0952s-3.2402-2.0899-5.1691-2.0899c-1.9288 0-3.7822.7493-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v16.2613l-14.1473-8.1307c-.8429-.4877-1.7737-.8047-2.7392-.9328-.9654-.1281-1.9466-.0647-2.8876.1864s-1.8232.6852-2.5965 1.2773c-.7732.5921-1.4222 1.3307-1.91 2.1736-.4878.843-.8048 1.7738-.9329 2.7392-.128.9655-.0647 1.9467.1864 2.8876.2512.941.6852 1.8233 1.2773 2.5965.5921.7733 1.3307 1.4223 2.1737 1.9101zm55.4252 15.4739c1.4914.118 2.9836-.2193 4.2793-.9671l25.2475-14.5496c.843-.4877 1.582-1.1368 2.174-1.91s1.026-1.6555 1.277-2.5965.315-1.9222.187-2.8876c-.128-.9655-.445-1.8962-.933-2.7392-.488-.8429-1.137-1.5816-1.91-2.1737-.774-.5921-1.656-1.0261-2.597-1.2772-1.9-.5072-3.924-.2387-5.627.7464l-14.1298 8.1991v-16.2613c-.0654-1.9277-.8772-3.7546-2.264-5.0952-1.3868-1.3405-3.2402-2.0899-5.1691-2.0899-1.9288 0-3.7822.7494-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v29.0136c-.0023 1.8784.7086 3.6876 1.9892 5.0619 1.2805 1.3743 3.0351 2.2111 4.909 2.3412zm-25.8554 31.5298c-1.4916-.1213-2.9847.2162-4.2793.9671l-25.2905 14.4893c-1.7024.985-2.9438 2.607-3.451 4.507s-.2387 3.924.7465 5.627c.9851 1.702 2.6061 2.943 4.5065 3.451 1.9004.507 3.9244.238 5.6268-.747l14.1473-8.122v16.261c.0654 1.928.8772 3.755 2.2641 5.096 1.3868 1.34 3.2402 2.09 5.169 2.09 1.9289 0 3.7823-.75 5.1691-2.09 1.3868-1.341 2.1986-3.168 2.264-5.096v-29.0645c-.0038-1.869-.7144-3.6673-1.9891-5.0341s-3.0192-2.2009-4.8834-2.3348zm-6.8468-13.5825c.4875-1.6032.414-3.3247-.2083-4.8806-.6224-1.5559-1.7564-2.8532-3.2152-3.6779l-25.2306-14.541c-1.704-.976-3.7248-1.2385-5.6216-.7303-1.8968.5083-3.5155 1.7461-4.5032 3.4433-.4889.84-.8065 1.7686-.9343 2.732-.1278.9635-.0632 1.9428.1899 2.8811.2531.9384.6897 1.8173 1.2846 2.5858.595.7686 1.3364 1.4115 2.1814 1.8917l14.096 8.1221-14.096 8.0536c-.8429.4861-1.5819 1.1334-2.1746 1.9051-.5928.7717-1.0277 1.6526-1.2801 2.5923-.2523.9398-.317 1.9201-.1905 2.8849s.4418 1.8952.9279 2.7382c.4861.8429 1.1335 1.5819 1.9051 2.1746.7717.5928 1.6526 1.0277 2.5924 1.2801.9397.2523 1.92.317 2.8848.1905s1.8952-.4418 2.7382-.9279l25.2306-14.5496c1.6248-.9071 2.8451-2.3965 3.4149-4.168z",fill:"#fff",fillRule:"evenodd"}))),Mbe=e=>g.createElement("svg",{className:"mr-2 w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:48,height:48,...e},g.createElement("path",{fill:"#fbc02d",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20 s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),g.createElement("path",{fill:"#e53935",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039 l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),g.createElement("path",{fill:"#4caf50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),g.createElement("path",{fill:"#1565c0",d:"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571 c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})),kbe=e=>g.createElement("svg",{className:"mr-2 w-5 h-5",width:1024,height:1024,viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},g.createElement("path",{d:"M44.522 44.5217H489.739V489.739H44.522V44.5217Z",fill:"#F35325"}),g.createElement("path",{d:"M534.261 44.5217H979.478V489.739H534.261V44.5217Z",fill:"#81BC06"}),g.createElement("path",{d:"M44.522 534.261H489.739V979.478H44.522V534.261Z",fill:"#05A6F0"}),g.createElement("path",{d:"M534.261 534.261H979.478V979.478H534.261V534.261Z",fill:"#FFBA08"})),Pbe=e=>g.createElement("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 287.56 191",...e},g.createElement("defs",null,g.createElement("style",null,".cls-1{fill:#0081fb;}.cls-2{fill:url(#linear-gradient);}.cls-3{fill:url(#linear-gradient-2);}"),g.createElement("linearGradient",{id:"linear-gradient",x1:62.34,y1:101.45,x2:260.34,y2:91.45,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},g.createElement("stop",{offset:0,stopColor:"#0064e1"}),g.createElement("stop",{offset:.4,stopColor:"#0064e1"}),g.createElement("stop",{offset:.83,stopColor:"#0073ee"}),g.createElement("stop",{offset:1,stopColor:"#0082fb"})),g.createElement("linearGradient",{id:"linear-gradient-2",x1:41.42,y1:53,x2:41.42,y2:126,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},g.createElement("stop",{offset:0,stopColor:"#0082fb"}),g.createElement("stop",{offset:1,stopColor:"#0064e0"}))),g.createElement("title",null,"facebook-meta"),g.createElement("path",{className:"cls-1",d:"M31.06,126c0,11,2.41,19.41,5.56,24.51A19,19,0,0,0,53.19,160c8.1,0,15.51-2,29.79-21.76,11.44-15.83,24.92-38,34-52l15.36-23.6c10.67-16.39,23-34.61,37.18-47C181.07,5.6,193.54,0,206.09,0c21.07,0,41.14,12.21,56.5,35.11,16.81,25.08,25,56.67,25,89.27,0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191V160c17.63,0,22-16.2,22-34.74,0-26.42-6.16-55.74-19.73-76.69-9.63-14.86-22.11-23.94-35.84-23.94-14.85,0-26.8,11.2-40.23,31.17-7.14,10.61-14.47,23.54-22.7,38.13l-9.06,16c-18.2,32.27-22.81,39.62-31.91,51.75C84.74,183,71.12,191,53.19,191c-21.27,0-34.72-9.21-43-23.09C3.34,156.6,0,141.76,0,124.85Z"}),g.createElement("path",{className:"cls-2",d:"M24.49,37.3C38.73,15.35,59.28,0,82.85,0c13.65,0,27.22,4,41.39,15.61,15.5,12.65,32,33.48,52.63,67.81l7.39,12.32c17.84,29.72,28,45,33.93,52.22,7.64,9.26,13,12,19.94,12,17.63,0,22-16.2,22-34.74l27.4-.86c0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191c-12.8,0-24.14-2.78-36.68-14.61-9.64-9.08-20.91-25.21-29.58-39.71L146.08,93.6c-12.94-21.62-24.81-37.74-31.68-45C107,40.71,97.51,31.23,82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78Z"}),g.createElement("path",{className:"cls-3",d:"M82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78C38.61,71.62,31.06,99.34,31.06,126c0,11,2.41,19.41,5.56,24.51L10.14,167.91C3.34,156.6,0,141.76,0,124.85,0,94.1,8.44,62.05,24.49,37.3,38.73,15.35,59.28,0,82.85,0Z"})),Abe=e=>g.createElement("svg",{className:"mr-2 w-5 h-5",width:256,height:233,viewBox:"0 0 256 233",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},g.createElement("path",{d:"M186.182 0h46.545v46.545h-46.545z"}),g.createElement("path",{fill:"#f7d046",d:"M209.455 0H256v46.545h-46.545z"}),g.createElement("path",{d:"M0 0h46.545v46.545H0zm0 46.545h46.545V93.09H0zm0 46.546h46.545v46.545H0zm0 46.545h46.545v46.545H0zm0 46.546h46.545v46.545H0z"}),g.createElement("path",{fill:"#f7d046",d:"M23.273 0h46.545v46.545H23.273z"}),g.createElement("path",{fill:"#f2a73b",d:"M209.455 46.545H256V93.09h-46.545zm-186.182 0h46.545V93.09H23.273z"}),g.createElement("path",{d:"M139.636 46.545h46.545V93.09h-46.545z"}),g.createElement("path",{fill:"#f2a73b",d:"M162.909 46.545h46.545V93.09h-46.545zm-93.091 0h46.545V93.09H69.818z"}),g.createElement("path",{fill:"#ee792f",d:"M116.364 93.091h46.545v46.545h-46.545zm46.545 0h46.545v46.545h-46.545zm-93.091 0h46.545v46.545H69.818z"}),g.createElement("path",{d:"M93.091 139.636h46.545v46.545H93.091z"}),g.createElement("path",{fill:"#eb5829",d:"M116.364 139.636h46.545v46.545h-46.545z"}),g.createElement("path",{fill:"#ee792f",d:"M209.455 93.091H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"}),g.createElement("path",{d:"M186.182 139.636h46.545v46.545h-46.545z"}),g.createElement("path",{fill:"#eb5829",d:"M209.455 139.636H256v46.545h-46.545z"}),g.createElement("path",{d:"M186.182 186.182h46.545v46.545h-46.545z"}),g.createElement("path",{fill:"#eb5829",d:"M23.273 139.636h46.545v46.545H23.273z"}),g.createElement("path",{fill:"#ea3326",d:"M209.455 186.182H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"})),Tbe="/NoLLMChat/assets/qwen-B-gSh3_v.webp",Ibe="/NoLLMChat/assets/smollm-CikBjd4F.png",Rbe="/NoLLMChat/assets/stablelm-BquePdQ7.png",Dbe="/NoLLMChat/assets/nomic-BjJqoFji.webp",Lbe="/NoLLMChat/assets/joshua-ByaReJuI.webp",$be="/NoLLMChat/assets/deepseek-CRqFMahi.png",Fbe="/NoLLMChat/assets/redpajama-CmUGqSQW.png",Bbe=e=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:256,height:260,preserveAspectRatio:"xMidYMid",viewBox:"0 0 256 260",...e},g.createElement("path",{fill:"#fff",d:"M239.184 106.203a64.716 64.716 0 0 0-5.576-53.103C219.452 28.459 191 15.784 163.213 21.74A65.586 65.586 0 0 0 52.096 45.22a64.716 64.716 0 0 0-43.23 31.36c-14.31 24.602-11.061 55.634 8.033 76.74a64.665 64.665 0 0 0 5.525 53.102c14.174 24.65 42.644 37.324 70.446 31.36a64.72 64.72 0 0 0 48.754 21.744c28.481.025 53.714-18.361 62.414-45.481a64.767 64.767 0 0 0 43.229-31.36c14.137-24.558 10.875-55.423-8.083-76.483Zm-97.56 136.338a48.397 48.397 0 0 1-31.105-11.255l1.535-.87 51.67-29.825a8.595 8.595 0 0 0 4.247-7.367v-72.85l21.845 12.636c.218.111.37.32.409.563v60.367c-.056 26.818-21.783 48.545-48.601 48.601Zm-104.466-44.61a48.345 48.345 0 0 1-5.781-32.589l1.534.921 51.722 29.826a8.339 8.339 0 0 0 8.441 0l63.181-36.425v25.221a.87.87 0 0 1-.358.665l-52.335 30.184c-23.257 13.398-52.97 5.431-66.404-17.803ZM23.549 85.38a48.499 48.499 0 0 1 25.58-21.333v61.39a8.288 8.288 0 0 0 4.195 7.316l62.874 36.272-21.845 12.636a.819.819 0 0 1-.767 0L41.353 151.53c-23.211-13.454-31.171-43.144-17.804-66.405v.256Zm179.466 41.695-63.08-36.63L161.73 77.86a.819.819 0 0 1 .768 0l52.233 30.184a48.6 48.6 0 0 1-7.316 87.635v-61.391a8.544 8.544 0 0 0-4.4-7.213Zm21.742-32.69-1.535-.922-51.619-30.081a8.39 8.39 0 0 0-8.492 0L99.98 99.808V74.587a.716.716 0 0 1 .307-.665l52.233-30.133a48.652 48.652 0 0 1 72.236 50.391v.205ZM88.061 139.097l-21.845-12.585a.87.87 0 0 1-.41-.614V65.685a48.652 48.652 0 0 1 79.757-37.346l-1.535.87-51.67 29.825a8.595 8.595 0 0 0-4.246 7.367l-.051 72.697Zm11.868-25.58 28.138-16.217 28.188 16.218v32.434l-28.086 16.218-28.188-16.218-.052-32.434Z"})),zbe=e=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:256,height:260,preserveAspectRatio:"xMidYMid",viewBox:"0 0 256 260",...e},g.createElement("path",{d:"M239.184 106.203a64.716 64.716 0 0 0-5.576-53.103C219.452 28.459 191 15.784 163.213 21.74A65.586 65.586 0 0 0 52.096 45.22a64.716 64.716 0 0 0-43.23 31.36c-14.31 24.602-11.061 55.634 8.033 76.74a64.665 64.665 0 0 0 5.525 53.102c14.174 24.65 42.644 37.324 70.446 31.36a64.72 64.72 0 0 0 48.754 21.744c28.481.025 53.714-18.361 62.414-45.481a64.767 64.767 0 0 0 43.229-31.36c14.137-24.558 10.875-55.423-8.083-76.483Zm-97.56 136.338a48.397 48.397 0 0 1-31.105-11.255l1.535-.87 51.67-29.825a8.595 8.595 0 0 0 4.247-7.367v-72.85l21.845 12.636c.218.111.37.32.409.563v60.367c-.056 26.818-21.783 48.545-48.601 48.601Zm-104.466-44.61a48.345 48.345 0 0 1-5.781-32.589l1.534.921 51.722 29.826a8.339 8.339 0 0 0 8.441 0l63.181-36.425v25.221a.87.87 0 0 1-.358.665l-52.335 30.184c-23.257 13.398-52.97 5.431-66.404-17.803ZM23.549 85.38a48.499 48.499 0 0 1 25.58-21.333v61.39a8.288 8.288 0 0 0 4.195 7.316l62.874 36.272-21.845 12.636a.819.819 0 0 1-.767 0L41.353 151.53c-23.211-13.454-31.171-43.144-17.804-66.405v.256Zm179.466 41.695-63.08-36.63L161.73 77.86a.819.819 0 0 1 .768 0l52.233 30.184a48.6 48.6 0 0 1-7.316 87.635v-61.391a8.544 8.544 0 0 0-4.4-7.213Zm21.742-32.69-1.535-.922-51.619-30.081a8.39 8.39 0 0 0-8.492 0L99.98 99.808V74.587a.716.716 0 0 1 .307-.665l52.233-30.133a48.652 48.652 0 0 1 72.236 50.391v.205ZM88.061 139.097l-21.845-12.585a.87.87 0 0 1-.41-.614V65.685a48.652 48.652 0 0 1 79.757-37.346l-1.535.87-51.67 29.825a8.595 8.595 0 0 0-4.246 7.367l-.051 72.697Zm11.868-25.58 28.138-16.217 28.188 16.218v32.434l-28.086 16.218-28.188-16.218-.052-32.434Z"})),Pr=g.memo(({name:e,className:t,...n})=>{const r=eu(a=>a.theme);return e=e.toLowerCase(),e.includes("gpt")?r==="dark"?h.jsx(Bbe,{className:Z("w-5 h-5",t),...n}):h.jsx(zbe,{className:Z("w-5 h-5",t),...n}):e!=null&&e.includes("deepseek")?h.jsx("img",{className:Z("w-5 h-5 rounded-full",t),src:$be,alt:"deepseek",...n}):e!=null&&e.includes("redpajama")?h.jsx("img",{className:Z("w-5 h-5 rounded-full",t),src:Fbe,alt:"deepseek",...n}):e.includes("gemma")||e.includes("gemini")?h.jsx(Mbe,{className:Z("w-5 h-5",t),...n}):e!=null&&e.includes("qwen")?h.jsx("img",{className:Z("w-5 h-5",t),src:Tbe,alt:"qwen",...n}):e!=null&&e.includes("phi")?h.jsx(kbe,{className:Z("w-5 h-5",t),...n}):e!=null&&e.includes("llama")?h.jsx(Pbe,{className:Z("w-5 h-5",t),...n}):e!=null&&e.includes("smollm")?h.jsx("img",{className:Z("w-5 h-5",t),src:Ibe,alt:"smollm",...n}):e!=null&&e.includes("mistral")?h.jsx(Abe,{className:Z("w-5 h-5",t),...n}):e!=null&&e.includes("snowflake")?h.jsx(Nbe,{className:Z("w-5 h-5 rounded-full",t),...n}):e!=null&&e.includes("stablelm")?h.jsx("img",{className:Z("w-5 h-5 rounded-full",t),src:Rbe,alt:"stablelm",...n}):e!=null&&e.includes("nomic")?h.jsx("img",{className:Z("w-5 h-5 rounded-full",t),src:Dbe,alt:"nomic",...n}):e!=null&&e.includes("Xenova")||e!=null&&e.includes("janus")?h.jsx("img",{className:Z("w-5 h-5 rounded-full",t),src:Lbe,alt:"Xenova",...n}):h.jsx(pe,{className:Z("w-5 h-5",t),name:"brain"})}),JS=["Qwen2.5-1.5B-Instruct-q4f32_1-MLC","Qwen2.5-Coder-1.5B-Instruct-q4f16_1-MLC","stablelm-2-zephyr-1_6b-q4f16_1-MLC-1k","Phi-3.5-mini-instruct-q4f16_1-MLC-1k","Llama-3.2-3B-Instruct-q4f32_1-MLC","DeepSeek-R1-Distill-Qwen-7B-q4f16_1-MLC"],Ube=lo("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function bn({className:e,variant:t,...n}){return h.jsx("div",{className:Z(Ube({variant:t}),e),...n})}const op=g.memo(e=>{var l;const{cloud:t,name:n,model:r,isCached:a,isFunctionCalling:o}=e,{t:i}=ke("atoms"),s=g.useCallback(u=>u===1?"llm_info.model_types.embedding":u===2?"llm_info.model_types.vlm":"llm_info.model_types.llm",[]),c=g.useMemo(()=>{if(r)switch(r.model_type){case 0:case 1:return h.jsx(bn,{className:"",children:i(s(r.model_type))});case 2:return h.jsxs(h.Fragment,{children:[h.jsx(bn,{className:"",children:i(s(0))}),h.jsx(bn,{className:"",children:i(s(r.model_type))})]})}},[r,s,i]);if(r)return h.jsxs(h.Fragment,{children:[c,JS.some(u=>n&&u.includes(n))?h.jsx(bn,{className:"",variant:"outline",children:i("llm_info.recommended")}):null,a?h.jsx(bn,{className:"",variant:"outline",children:i("llm_info.cached")}):null,t?h.jsx(bn,{className:"",variant:"outline",children:i("llm_info.cloud")}):null,o?h.jsx(bn,{className:"",variant:"outline",children:i("llm_info.function_calling")}):null,r!=null&&r.low_resource_required?h.jsx(bn,{className:"",variant:"outline",children:i("llm_info.low_resource_required")}):null,(l=r==null?void 0:r.overrides)!=null&&l.context_window_size?h.jsxs(bn,{className:"",variant:"outline",children:[r.overrides.context_window_size.toLocaleString("en-US")," Tokens"]}):null,r!=null&&r.vram_required_MB?h.jsxs(bn,{className:"",variant:"outline",children:["VRAM: ",r.vram_required_MB.toLocaleString("en-US")," MB"]}):null]})}),Vbe=g.memo(({llm:e,status:t,loadLLM:n,progress:r})=>{const{t:a}=ke("flows"),[o,i]=g.useState();g.useEffect(()=>{if(!(o||!(e!=null&&e.name))){if((e==null?void 0:e.provider)!=="WebLLM"){i({hasCache:!1,cloud:!0,isFunctionCalling:!0,info:{model_id:e==null?void 0:e.name,model:e==null?void 0:e.name,model_lib:e==null?void 0:e.provider,model_type:2}});return}Ht(()=>import("./index-C7uio77f.js").then(async l=>(await l.__tla,l)),__vite__mapDeps([9,1,2,3,4])).then(async({hasModelInCache:l,functionCallingModelIds:u,prebuiltAppConfig:d})=>{const p=await l(e==null?void 0:e.name);i({hasCache:p,isFunctionCalling:u.includes(e==null?void 0:e.name),info:d.model_list.find(f=>f.model_id===(e==null?void 0:e.name))})})}},[e==null?void 0:e.name,o]);const s=g.useCallback(async()=>{await(n==null?void 0:n())},[n]),c=g.useMemo(()=>{switch(t){case et.Downloading:return h.jsx(pe,{className:"animate-spin w-7 h-7",name:"arrow-big-down-dash"});case et.Loaded:return h.jsx(Pr,{name:(e==null?void 0:e.name)||"brain",className:"w-7 h-7"});default:return h.jsx(Pr,{name:(e==null?void 0:e.name)||"brain",className:"w-7 h-7"})}},[e==null?void 0:e.name,t]);return h.jsx(Gt,{className:"flex justify-center !bg-inherit !p-2 max-w-full overflow-y-hidden !mb-2 m-2 !mt-0",children:h.jsxs("div",{className:"ml-2 pt-1 max-w-full",children:[h.jsxs("p",{className:"flex gap-2 items-center pr-6 !text-sm font-semibold",children:[c,`${(e==null?void 0:e.name)||""}`]}),h.jsxs("div",{className:"max-w-full mt-2 flex-wrap flex gap-1",children:[h.jsx(op,{model:o==null?void 0:o.info,isFunctionCalling:(o==null?void 0:o.isFunctionCalling)||!1,name:e==null?void 0:e.name,isCached:(o==null?void 0:o.hasCache)||!1,cloud:(o==null?void 0:o.cloud)||!1}),t!==et.Loaded?r?h.jsx("div",{className:"text-sm break-words flex-wrap",children:r}):h.jsx(Ye,{disabled:t===et.Loading,onClick:s,className:"mt-4 w-full",children:a(o!=null&&o.hasCache?"llm_node.load_model_button":"llm_node.download_model_button")}):void 0]})]})})});class qbe{async loadAndSplit(t){if(t===void 0)throw new Error("You must pass a text splitter to use this method.");const n=await this.load();return t.invoke(n)}}class $F extends qbe{constructor(t,{splitPages:n=!0,pdfjs:r=Wbe,parsedItemSeparator:a=""}={}){super(),Object.defineProperty(this,"blob",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"splitPages",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"pdfjs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parsedItemSeparator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.blob=t,this.splitPages=n??this.splitPages,this.pdfjs=r,this.parsedItemSeparator=a}async load(){const{getDocument:t,version:n}=await this.pdfjs(),r=await t({data:new Uint8Array(await this.blob.arrayBuffer()),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,a=await r.getMetadata().catch(()=>null),o=[];for(let i=1;i<=r.numPages;i+=1){const s=await(await r.getPage(i)).getTextContent();if(s.items.length===0)continue;let c;const l=[];for(const d of s.items)"str"in d&&(c===d.transform[5]||!c?l.push(d.str):l.push(`
${d.str}`),c=d.transform[5]);const u=l.join(this.parsedItemSeparator);o.push(new vf({pageContent:u,metadata:{pdf:{version:n,info:a==null?void 0:a.info,metadata:a==null?void 0:a.metadata,totalPages:r.numPages},loc:{pageNumber:i}}}))}return this.splitPages?o:o.length===0?[]:[new vf({pageContent:o.map(i=>i.pageContent).join(`

`),metadata:{pdf:{version:n,info:a==null?void 0:a.info,metadata:a==null?void 0:a.metadata,totalPages:r.numPages}}})]}}async function Wbe(){try{const{default:e}=await Ht(async()=>{const{default:r}=await import("./pdf-BaTjA2JX.js").then(async a=>(await a.__tla,a)).then(a=>a.p);return{default:r}},__vite__mapDeps([10,1,2])),{getDocument:t,version:n}=e;return{getDocument:t,version:n}}catch(e){throw console.error(e),new Error("Failed to load pdf-parse. Please install it with eg. `npm install pdf-parse`.")}}var YS="Tabs",[Hbe,w3e]=ur(YS,[fo]),FF=fo(),[Kbe,QS]=Hbe(YS),BF=g.forwardRef((e,t)=>{const{__scopeTabs:n,value:r,onValueChange:a,defaultValue:o,orientation:i="horizontal",dir:s,activationMode:c="automatic",...l}=e,u=ai(s),[d,p]=Tn({prop:r,onChange:a,defaultProp:o});return h.jsx(Kbe,{scope:n,baseId:Rt(),value:d,onValueChange:p,orientation:i,dir:u,activationMode:c,children:h.jsx(Ae.div,{dir:u,"data-orientation":i,...l,ref:t})})});BF.displayName=YS;var zF="TabsList",UF=g.forwardRef((e,t)=>{const{__scopeTabs:n,loop:r=!0,...a}=e,o=QS(zF,n),i=FF(n);return h.jsx(uu,{asChild:!0,...i,orientation:o.orientation,dir:o.dir,loop:r,children:h.jsx(Ae.div,{role:"tablist","aria-orientation":o.orientation,...a,ref:t})})});UF.displayName=zF;var VF="TabsTrigger",qF=g.forwardRef((e,t)=>{const{__scopeTabs:n,value:r,disabled:a=!1,...o}=e,i=QS(VF,n),s=FF(n),c=KF(i.baseId,r),l=ZF(i.baseId,r),u=r===i.value;return h.jsx(du,{asChild:!0,...s,focusable:!a,active:u,children:h.jsx(Ae.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":l,"data-state":u?"active":"inactive","data-disabled":a?"":void 0,disabled:a,id:c,...o,ref:t,onMouseDown:ge(e.onMouseDown,d=>{!a&&d.button===0&&d.ctrlKey===!1?i.onValueChange(r):d.preventDefault()}),onKeyDown:ge(e.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&i.onValueChange(r)}),onFocus:ge(e.onFocus,()=>{const d=i.activationMode!=="manual";!u&&!a&&d&&i.onValueChange(r)})})})});qF.displayName=VF;var WF="TabsContent",HF=g.forwardRef((e,t)=>{const{__scopeTabs:n,value:r,forceMount:a,children:o,...i}=e,s=QS(WF,n),c=KF(s.baseId,r),l=ZF(s.baseId,r),u=r===s.value,d=g.useRef(u);return g.useEffect(()=>{const p=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(p)},[]),h.jsx(zr,{present:a||u,children:({present:p})=>h.jsx(Ae.div,{"data-state":u?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":c,hidden:!p,id:l,tabIndex:0,...i,ref:t,style:{...e.style,animationDuration:d.current?"0s":void 0},children:p&&o})})});HF.displayName=WF;function KF(e,t){return`${e}-trigger-${t}`}function ZF(e,t){return`${e}-content-${t}`}var Zbe=BF,GF=UF,XF=qF,JF=HF;const eE=Zbe,Ey=g.forwardRef(({className:e,...t},n)=>h.jsx(GF,{ref:n,className:Z("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));Ey.displayName=GF.displayName;const wa=g.forwardRef(({className:e,...t},n)=>h.jsx(XF,{ref:n,className:Z("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));wa.displayName=XF.displayName;const xa=g.forwardRef(({className:e,...t},n)=>h.jsx(JF,{ref:n,className:Z("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));xa.displayName=JF.displayName,_0=function(e,[t,n]){return Math.min(n,Math.max(t,e))};function YF(e){const t=g.useRef({value:e,previous:e});return g.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Gbe=[" ","Enter","ArrowUp","ArrowDown"],Xbe=[" ","Enter"],ip="Select",[Oy,Cy,Jbe]=mf(ip),[sl,x3e]=ur(ip,[Jbe,cc]),Ny=cc(),[Ybe,ki]=sl(ip),[Qbe,ewe]=sl(ip),QF=e=>{const{__scopeSelect:t,children:n,open:r,defaultOpen:a,onOpenChange:o,value:i,defaultValue:s,onValueChange:c,dir:l,name:u,autoComplete:d,disabled:p,required:f,form:m}=e,y=Ny(t),[v,b]=g.useState(null),[w,j]=g.useState(null),[x,_]=g.useState(!1),S=ai(l),[E=!1,O]=Tn({prop:r,defaultProp:a,onChange:o}),[N,M]=Tn({prop:i,defaultProp:s,onChange:c}),k=g.useRef(null),P=v?m||!!v.closest("form"):!0,[A,C]=g.useState(new Set),I=Array.from(A).map(T=>T.props.value).join(";");return h.jsx(lh,{...y,children:h.jsxs(Ybe,{required:f,scope:t,trigger:v,onTriggerChange:b,valueNode:w,onValueNodeChange:j,valueNodeHasChildren:x,onValueNodeHasChildrenChange:_,contentId:Rt(),value:N,onValueChange:M,open:E,onOpenChange:O,dir:S,triggerPointerDownPosRef:k,disabled:p,children:[h.jsx(Oy.Provider,{scope:t,children:h.jsx(Qbe,{scope:e.__scopeSelect,onNativeOptionAdd:g.useCallback(T=>{C(R=>new Set(R).add(T))},[]),onNativeOptionRemove:g.useCallback(T=>{C(R=>{const L=new Set(R);return L.delete(T),L})},[]),children:n})}),P?h.jsxs(SB,{"aria-hidden":!0,required:f,tabIndex:-1,name:u,autoComplete:d,value:N,onChange:T=>M(T.target.value),disabled:p,form:m,children:[N===void 0?h.jsx("option",{value:""}):null,Array.from(A)]},I):null]})})};QF.displayName=ip;var eB="SelectTrigger",tB=g.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:r=!1,...a}=e,o=Ny(n),i=ki(eB,n),s=i.disabled||r,c=jt(t,i.onTriggerChange),l=Cy(n),u=g.useRef("touch"),[d,p,f]=EB(y=>{const v=l().filter(j=>!j.disabled),b=v.find(j=>j.value===i.value),w=OB(v,y,b);w!==void 0&&i.onValueChange(w.value)}),m=y=>{s||(i.onOpenChange(!0),f()),y&&(i.triggerPointerDownPosRef.current={x:Math.round(y.pageX),y:Math.round(y.pageY)})};return h.jsx(Ab,{asChild:!0,...o,children:h.jsx(Ae.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":jB(i.value)?"":void 0,...a,ref:c,onClick:ge(a.onClick,y=>{y.currentTarget.focus(),u.current!=="mouse"&&m(y)}),onPointerDown:ge(a.onPointerDown,y=>{u.current=y.pointerType;const v=y.target;v.hasPointerCapture(y.pointerId)&&v.releasePointerCapture(y.pointerId),y.button===0&&y.ctrlKey===!1&&y.pointerType==="mouse"&&(m(y),y.preventDefault())}),onKeyDown:ge(a.onKeyDown,y=>{const v=d.current!=="";!(y.ctrlKey||y.altKey||y.metaKey)&&y.key.length===1&&p(y.key),!(v&&y.key===" ")&&Gbe.includes(y.key)&&(m(),y.preventDefault())})})})});tB.displayName=eB;var nB="SelectValue",rB=g.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,children:o,placeholder:i="",...s}=e,c=ki(nB,n),{onValueNodeHasChildrenChange:l}=c,u=o!==void 0,d=jt(t,c.onValueNodeChange);return ln(()=>{l(u)},[l,u]),h.jsx(Ae.span,{...s,ref:d,style:{pointerEvents:"none"},children:jB(c.value)?h.jsx(h.Fragment,{children:i}):o})});rB.displayName=nB;var twe="SelectIcon",aB=g.forwardRef((e,t)=>{const{__scopeSelect:n,children:r,...a}=e;return h.jsx(Ae.span,{"aria-hidden":!0,...a,ref:t,children:r||"\u25BC"})});aB.displayName=twe;var nwe="SelectPortal",oB=e=>h.jsx(Ov,{asChild:!0,...e});oB.displayName=nwe;var _s="SelectContent",iB=g.forwardRef((e,t)=>{const n=ki(_s,e.__scopeSelect),[r,a]=g.useState();if(ln(()=>{a(new DocumentFragment)},[]),!n.open){const o=r;return o?Ql.createPortal(h.jsx(sB,{scope:e.__scopeSelect,children:h.jsx(Oy.Slot,{scope:e.__scopeSelect,children:h.jsx("div",{children:e.children})})}),o):null}return h.jsx(cB,{...e,ref:t})});iB.displayName=_s;var _a=10,[sB,Pi]=sl(_s),rwe="SelectContentImpl",cB=g.forwardRef((e,t)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:o,onPointerDownOutside:i,side:s,sideOffset:c,align:l,alignOffset:u,arrowPadding:d,collisionBoundary:p,collisionPadding:f,sticky:m,hideWhenDetached:y,avoidCollisions:v,...b}=e,w=ki(_s,n),[j,x]=g.useState(null),[_,S]=g.useState(null),E=jt(t,ee=>x(ee)),[O,N]=g.useState(null),[M,k]=g.useState(null),P=Cy(n),[A,C]=g.useState(!1),I=g.useRef(!1);g.useEffect(()=>{if(j)return fu(j)},[j]),hu();const T=g.useCallback(ee=>{const[G,...K]=P().map(V=>V.ref.current),[X]=K.slice(-1),ne=document.activeElement;for(const V of ee)if(V===ne||(V==null||V.scrollIntoView({block:"nearest"}),V===G&&_&&(_.scrollTop=0),V===X&&_&&(_.scrollTop=_.scrollHeight),V==null||V.focus(),document.activeElement!==ne))return},[P,_]),R=g.useCallback(()=>T([O,j]),[T,O,j]);g.useEffect(()=>{A&&R()},[A,R]);const{onOpenChange:L,triggerPointerDownPosRef:D}=w;g.useEffect(()=>{if(j){let ee={x:0,y:0};const G=X=>{var ne,V;ee={x:Math.abs(Math.round(X.pageX)-(((ne=D.current)==null?void 0:ne.x)??0)),y:Math.abs(Math.round(X.pageY)-(((V=D.current)==null?void 0:V.y)??0))}},K=X=>{ee.x<=10&&ee.y<=10?X.preventDefault():j.contains(X.target)||L(!1),document.removeEventListener("pointermove",G),D.current=null};return D.current!==null&&(document.addEventListener("pointermove",G),document.addEventListener("pointerup",K,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",G),document.removeEventListener("pointerup",K,{capture:!0})}}},[j,L,D]),g.useEffect(()=>{const ee=()=>L(!1);return window.addEventListener("blur",ee),window.addEventListener("resize",ee),()=>{window.removeEventListener("blur",ee),window.removeEventListener("resize",ee)}},[L]);const[z,B]=EB(ee=>{const G=P().filter(ne=>!ne.disabled),K=G.find(ne=>ne.ref.current===document.activeElement),X=OB(G,ee,K);X&&setTimeout(()=>X.ref.current.focus())}),$=g.useCallback((ee,G,K)=>{const X=!I.current&&!K;(w.value!==void 0&&w.value===G||X)&&(N(ee),X&&(I.current=!0))},[w.value]),U=g.useCallback(()=>j==null?void 0:j.focus(),[j]),F=g.useCallback((ee,G,K)=>{const X=!I.current&&!K;(w.value!==void 0&&w.value===G||X)&&k(ee)},[w.value]),H=r==="popper"?tE:lB,re=H===tE?{side:s,sideOffset:c,align:l,alignOffset:u,arrowPadding:d,collisionBoundary:p,collisionPadding:f,sticky:m,hideWhenDetached:y,avoidCollisions:v}:{};return h.jsx(sB,{scope:n,content:j,viewport:_,onViewportChange:S,itemRefCallback:$,selectedItem:O,onItemLeave:U,itemTextRefCallback:F,focusSelectedItem:R,selectedItemText:M,position:r,isPositioned:A,searchRef:z,children:h.jsx(Jf,{as:ri,allowPinchZoom:!0,children:h.jsx(Vf,{asChild:!0,trapped:w.open,onMountAutoFocus:ee=>{ee.preventDefault()},onUnmountAutoFocus:ge(a,ee=>{var G;(G=w.trigger)==null||G.focus({preventScroll:!0}),ee.preventDefault()}),children:h.jsx(Ev,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:ee=>ee.preventDefault(),onDismiss:()=>w.onOpenChange(!1),children:h.jsx(H,{role:"listbox",id:w.contentId,"data-state":w.open?"open":"closed",dir:w.dir,onContextMenu:ee=>ee.preventDefault(),...b,...re,onPlaced:()=>C(!0),ref:E,style:{display:"flex",flexDirection:"column",outline:"none",...b.style},onKeyDown:ge(b.onKeyDown,ee=>{const G=ee.ctrlKey||ee.altKey||ee.metaKey;if(ee.key==="Tab"&&ee.preventDefault(),!G&&ee.key.length===1&&B(ee.key),["ArrowUp","ArrowDown","Home","End"].includes(ee.key)){let K=P().filter(X=>!X.disabled).map(X=>X.ref.current);if(["ArrowUp","End"].includes(ee.key)&&(K=K.slice().reverse()),["ArrowUp","ArrowDown"].includes(ee.key)){const X=ee.target,ne=K.indexOf(X);K=K.slice(ne+1)}setTimeout(()=>T(K)),ee.preventDefault()}})})})})})})});cB.displayName=rwe;var awe="SelectItemAlignedPosition",lB=g.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:r,...a}=e,o=ki(_s,n),i=Pi(_s,n),[s,c]=g.useState(null),[l,u]=g.useState(null),d=jt(t,E=>u(E)),p=Cy(n),f=g.useRef(!1),m=g.useRef(!0),{viewport:y,selectedItem:v,selectedItemText:b,focusSelectedItem:w}=i,j=g.useCallback(()=>{if(o.trigger&&o.valueNode&&s&&l&&y&&v&&b){const E=o.trigger.getBoundingClientRect(),O=l.getBoundingClientRect(),N=o.valueNode.getBoundingClientRect(),M=b.getBoundingClientRect();if(o.dir!=="rtl"){const X=M.left-O.left,ne=N.left-X,V=E.left-ne,le=E.width+V,ae=Math.max(le,O.width),de=window.innerWidth-_a,je=_0(ne,[_a,Math.max(_a,de-ae)]);s.style.minWidth=le+"px",s.style.left=je+"px"}else{const X=O.right-M.right,ne=window.innerWidth-N.right-X,V=window.innerWidth-E.right-ne,le=E.width+V,ae=Math.max(le,O.width),de=window.innerWidth-_a,je=_0(ne,[_a,Math.max(_a,de-ae)]);s.style.minWidth=le+"px",s.style.right=je+"px"}const k=p(),P=window.innerHeight-_a*2,A=y.scrollHeight,C=window.getComputedStyle(l),I=parseInt(C.borderTopWidth,10),T=parseInt(C.paddingTop,10),R=parseInt(C.borderBottomWidth,10),L=parseInt(C.paddingBottom,10),D=I+T+A+L+R,z=Math.min(v.offsetHeight*5,D),B=window.getComputedStyle(y),$=parseInt(B.paddingTop,10),U=parseInt(B.paddingBottom,10),F=E.top+E.height/2-_a,H=P-F,re=v.offsetHeight/2,ee=v.offsetTop+re,G=I+T+ee,K=D-G;if(G<=F){const X=k.length>0&&v===k[k.length-1].ref.current;s.style.bottom="0px";const ne=l.clientHeight-y.offsetTop-y.offsetHeight,V=Math.max(H,re+(X?U:0)+ne+R),le=G+V;s.style.height=le+"px"}else{const X=k.length>0&&v===k[0].ref.current;s.style.top="0px";const ne=Math.max(F,I+y.offsetTop+(X?$:0)+re)+K;s.style.height=ne+"px",y.scrollTop=G-F+y.offsetTop}s.style.margin=`${_a}px 0`,s.style.minHeight=z+"px",s.style.maxHeight=P+"px",r==null||r(),requestAnimationFrame(()=>f.current=!0)}},[p,o.trigger,o.valueNode,s,l,y,v,b,o.dir,r]);ln(()=>j(),[j]);const[x,_]=g.useState();ln(()=>{l&&_(window.getComputedStyle(l).zIndex)},[l]);const S=g.useCallback(E=>{E&&m.current===!0&&(j(),w==null||w(),m.current=!1)},[j,w]);return h.jsx(iwe,{scope:n,contentWrapper:s,shouldExpandOnScrollRef:f,onScrollButtonChange:S,children:h.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:x},children:h.jsx(Ae.div,{...a,ref:d,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});lB.displayName=awe;var owe="SelectPopperPosition",tE=g.forwardRef((e,t)=>{const{__scopeSelect:n,align:r="start",collisionPadding:a=_a,...o}=e,i=Ny(n);return h.jsx(Tb,{...i,...o,ref:t,align:r,collisionPadding:a,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});tE.displayName=owe;var[iwe,nE]=sl(_s,{}),rE="SelectViewport",uB=g.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:r,...a}=e,o=Pi(rE,n),i=nE(rE,n),s=jt(t,o.onViewportChange),c=g.useRef(0);return h.jsxs(h.Fragment,{children:[h.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),h.jsx(Oy.Slot,{scope:n,children:h.jsx(Ae.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:ge(a.onScroll,l=>{const u=l.currentTarget,{contentWrapper:d,shouldExpandOnScrollRef:p}=i;if(p!=null&&p.current&&d){const f=Math.abs(c.current-u.scrollTop);if(f>0){const m=window.innerHeight-_a*2,y=parseFloat(d.style.minHeight),v=parseFloat(d.style.height),b=Math.max(y,v);if(b<m){const w=b+f,j=Math.min(m,w),x=w-j;d.style.height=j+"px",d.style.bottom==="0px"&&(u.scrollTop=x>0?x:0,d.style.justifyContent="flex-end")}}}c.current=u.scrollTop})})})]})});uB.displayName=rE;var dB="SelectGroup",[swe,cwe]=sl(dB),lwe=g.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=Rt();return h.jsx(swe,{scope:n,id:a,children:h.jsx(Ae.div,{role:"group","aria-labelledby":a,...r,ref:t})})});lwe.displayName=dB;var pB="SelectLabel",fB=g.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=cwe(pB,n);return h.jsx(Ae.div,{id:a.id,...r,ref:t})});fB.displayName=pB;var My="SelectItem",[uwe,hB]=sl(My),mB=g.forwardRef((e,t)=>{const{__scopeSelect:n,value:r,disabled:a=!1,textValue:o,...i}=e,s=ki(My,n),c=Pi(My,n),l=s.value===r,[u,d]=g.useState(o??""),[p,f]=g.useState(!1),m=jt(t,w=>{var j;return(j=c.itemRefCallback)==null?void 0:j.call(c,w,r,a)}),y=Rt(),v=g.useRef("touch"),b=()=>{a||(s.onValueChange(r),s.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return h.jsx(uwe,{scope:n,value:r,disabled:a,textId:y,isSelected:l,onItemTextChange:g.useCallback(w=>{d(j=>j||((w==null?void 0:w.textContent)??"").trim())},[]),children:h.jsx(Oy.ItemSlot,{scope:n,value:r,disabled:a,textValue:u,children:h.jsx(Ae.div,{role:"option","aria-labelledby":y,"data-highlighted":p?"":void 0,"aria-selected":l&&p,"data-state":l?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...i,ref:m,onFocus:ge(i.onFocus,()=>f(!0)),onBlur:ge(i.onBlur,()=>f(!1)),onClick:ge(i.onClick,()=>{v.current!=="mouse"&&b()}),onPointerUp:ge(i.onPointerUp,()=>{v.current==="mouse"&&b()}),onPointerDown:ge(i.onPointerDown,w=>{v.current=w.pointerType}),onPointerMove:ge(i.onPointerMove,w=>{var j;v.current=w.pointerType,a?(j=c.onItemLeave)==null||j.call(c):v.current==="mouse"&&w.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ge(i.onPointerLeave,w=>{var j;w.currentTarget===document.activeElement&&((j=c.onItemLeave)==null||j.call(c))}),onKeyDown:ge(i.onKeyDown,w=>{var j;((j=c.searchRef)==null?void 0:j.current)!==""&&w.key===" "||(Xbe.includes(w.key)&&b(),w.key===" "&&w.preventDefault())})})})})});mB.displayName=My;var sp="SelectItemText",yB=g.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,...o}=e,i=ki(sp,n),s=Pi(sp,n),c=hB(sp,n),l=ewe(sp,n),[u,d]=g.useState(null),p=jt(t,b=>d(b),c.onItemTextChange,b=>{var w;return(w=s.itemTextRefCallback)==null?void 0:w.call(s,b,c.value,c.disabled)}),f=u==null?void 0:u.textContent,m=g.useMemo(()=>h.jsx("option",{value:c.value,disabled:c.disabled,children:f},c.value),[c.disabled,c.value,f]),{onNativeOptionAdd:y,onNativeOptionRemove:v}=l;return ln(()=>(y(m),()=>v(m)),[y,v,m]),h.jsxs(h.Fragment,{children:[h.jsx(Ae.span,{id:c.textId,...o,ref:p}),c.isSelected&&i.valueNode&&!i.valueNodeHasChildren?Ql.createPortal(o.children,i.valueNode):null]})});yB.displayName=sp;var gB="SelectItemIndicator",vB=g.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return hB(gB,n).isSelected?h.jsx(Ae.span,{"aria-hidden":!0,...r,ref:t}):null});vB.displayName=gB;var aE="SelectScrollUpButton",bB=g.forwardRef((e,t)=>{const n=Pi(aE,e.__scopeSelect),r=nE(aE,e.__scopeSelect),[a,o]=g.useState(!1),i=jt(t,r.onScrollButtonChange);return ln(()=>{if(n.viewport&&n.isPositioned){let s=function(){const l=c.scrollTop>0;o(l)};const c=n.viewport;return s(),c.addEventListener("scroll",s),()=>c.removeEventListener("scroll",s)}},[n.viewport,n.isPositioned]),a?h.jsx(xB,{...e,ref:i,onAutoScroll:()=>{const{viewport:s,selectedItem:c}=n;s&&c&&(s.scrollTop=s.scrollTop-c.offsetHeight)}}):null});bB.displayName=aE;var oE="SelectScrollDownButton",wB=g.forwardRef((e,t)=>{const n=Pi(oE,e.__scopeSelect),r=nE(oE,e.__scopeSelect),[a,o]=g.useState(!1),i=jt(t,r.onScrollButtonChange);return ln(()=>{if(n.viewport&&n.isPositioned){let s=function(){const l=c.scrollHeight-c.clientHeight,u=Math.ceil(c.scrollTop)<l;o(u)};const c=n.viewport;return s(),c.addEventListener("scroll",s),()=>c.removeEventListener("scroll",s)}},[n.viewport,n.isPositioned]),a?h.jsx(xB,{...e,ref:i,onAutoScroll:()=>{const{viewport:s,selectedItem:c}=n;s&&c&&(s.scrollTop=s.scrollTop+c.offsetHeight)}}):null});wB.displayName=oE;var xB=g.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:r,...a}=e,o=Pi("SelectScrollButton",n),i=g.useRef(null),s=Cy(n),c=g.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return g.useEffect(()=>()=>c(),[c]),ln(()=>{var l,u;(u=(l=s().find(d=>d.ref.current===document.activeElement))==null?void 0:l.ref.current)==null||u.scrollIntoView({block:"nearest"})},[s]),h.jsx(Ae.div,{"aria-hidden":!0,...a,ref:t,style:{flexShrink:0,...a.style},onPointerDown:ge(a.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(r,50))}),onPointerMove:ge(a.onPointerMove,()=>{var l;(l=o.onItemLeave)==null||l.call(o),i.current===null&&(i.current=window.setInterval(r,50))}),onPointerLeave:ge(a.onPointerLeave,()=>{c()})})}),dwe="SelectSeparator",_B=g.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return h.jsx(Ae.div,{"aria-hidden":!0,...r,ref:t})});_B.displayName=dwe;var iE="SelectArrow",pwe=g.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=Ny(n),o=ki(iE,n),i=Pi(iE,n);return o.open&&i.position==="popper"?h.jsx(Ib,{...a,...r,ref:t}):null});pwe.displayName=iE;function jB(e){return e===""||e===void 0}var SB=g.forwardRef((e,t)=>{const{value:n,...r}=e,a=g.useRef(null),o=jt(t,a),i=YF(n);return g.useEffect(()=>{const s=a.current,c=window.HTMLSelectElement.prototype,l=Object.getOwnPropertyDescriptor(c,"value").set;if(i!==n&&l){const u=new Event("change",{bubbles:!0});l.call(s,n),s.dispatchEvent(u)}},[i,n]),h.jsx(YDe,{asChild:!0,children:h.jsx("select",{...r,ref:o,defaultValue:n})})});SB.displayName="BubbleSelect";function EB(e){const t=dr(e),n=g.useRef(""),r=g.useRef(0),a=g.useCallback(i=>{const s=n.current+i;t(s),function c(l){n.current=l,window.clearTimeout(r.current),l!==""&&(r.current=window.setTimeout(()=>c(""),1e3))}(s)},[t]),o=g.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return g.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,a,o]}function OB(e,t,n){const r=t.length>1&&Array.from(t).every(s=>s===t[0])?t[0]:t,a=n?e.indexOf(n):-1;let o=fwe(e,Math.max(a,0));r.length===1&&(o=o.filter(s=>s!==n));const i=o.find(s=>s.textValue.toLowerCase().startsWith(r.toLowerCase()));return i!==n?i:void 0}function fwe(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var hwe=QF,CB=tB,mwe=rB,ywe=aB,gwe=oB,NB=iB,vwe=uB,MB=fB,kB=mB,bwe=yB,wwe=vB,PB=bB,AB=wB,TB=_B;const Ya=hwe,Qa=mwe,ja=g.forwardRef(({className:e,children:t,...n},r)=>h.jsxs(CB,{ref:r,className:Z("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,h.jsx(ywe,{asChild:!0,children:h.jsx(pe,{name:"chevron-down",className:"h-4 w-4 opacity-50"})})]}));ja.displayName=CB.displayName;const IB=g.forwardRef(({className:e,...t},n)=>h.jsx(PB,{ref:n,className:Z("flex cursor-default items-center justify-center py-1",e),...t,children:h.jsx(pe,{name:"chevron-up",className:"h-4 w-4"})}));IB.displayName=PB.displayName;const RB=g.forwardRef(({className:e,...t},n)=>h.jsx(AB,{ref:n,className:Z("flex cursor-default items-center justify-center py-1",e),...t,children:h.jsx(pe,{name:"chevron-down",className:"h-4 w-4"})}));RB.displayName=AB.displayName;const Sa=g.forwardRef(({className:e,children:t,position:n="popper",...r},a)=>h.jsx(gwe,{children:h.jsxs(NB,{ref:a,className:Z("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...r,children:[h.jsx(IB,{}),h.jsx(vwe,{className:Z("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),h.jsx(RB,{})]})}));Sa.displayName=NB.displayName;const xwe=g.forwardRef(({className:e,...t},n)=>h.jsx(MB,{ref:n,className:Z("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));xwe.displayName=MB.displayName;const Fn=g.forwardRef(({className:e,children:t,...n},r)=>h.jsxs(kB,{ref:r,className:Z("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(wwe,{children:h.jsx(pe,{name:"check",className:"h-4 w-4"})})}),h.jsx(bwe,{children:t})]}));Fn.displayName=kB.displayName;const _we=g.forwardRef(({className:e,...t},n)=>h.jsx(TB,{ref:n,className:Z("-mx-1 my-1 h-px bg-muted",e),...t}));_we.displayName=TB.displayName;var zo="Accordion",jwe=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[sE,Swe,Ewe]=mf(zo),[ky,_3e]=ur(zo,[Ewe,zP]),cE=zP(),DB=W.forwardRef((e,t)=>{const{type:n,...r}=e,a=r,o=r;return h.jsx(sE.Provider,{scope:e.__scopeAccordion,children:n==="multiple"?h.jsx(Mwe,{...o,ref:t}):h.jsx(Nwe,{...a,ref:t})})});DB.displayName=zo;var[LB,Owe]=ky(zo),[$B,Cwe]=ky(zo,{collapsible:!1}),Nwe=W.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},collapsible:o=!1,...i}=e,[s,c]=Tn({prop:n,defaultProp:r,onChange:a});return h.jsx(LB,{scope:e.__scopeAccordion,value:s?[s]:[],onItemOpen:c,onItemClose:W.useCallback(()=>o&&c(""),[o,c]),children:h.jsx($B,{scope:e.__scopeAccordion,collapsible:o,children:h.jsx(FB,{...i,ref:t})})})}),Mwe=W.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...o}=e,[i=[],s]=Tn({prop:n,defaultProp:r,onChange:a}),c=W.useCallback(u=>s((d=[])=>[...d,u]),[s]),l=W.useCallback(u=>s((d=[])=>d.filter(p=>p!==u)),[s]);return h.jsx(LB,{scope:e.__scopeAccordion,value:i,onItemOpen:c,onItemClose:l,children:h.jsx($B,{scope:e.__scopeAccordion,collapsible:!0,children:h.jsx(FB,{...o,ref:t})})})}),[kwe,Py]=ky(zo),FB=W.forwardRef((e,t)=>{const{__scopeAccordion:n,disabled:r,dir:a,orientation:o="vertical",...i}=e,s=W.useRef(null),c=jt(s,t),l=Swe(n),u=ai(a)==="ltr",d=ge(e.onKeyDown,p=>{var E;if(!jwe.includes(p.key))return;const f=p.target,m=l().filter(O=>{var N;return!((N=O.ref.current)!=null&&N.disabled)}),y=m.findIndex(O=>O.ref.current===f),v=m.length;if(y===-1)return;p.preventDefault();let b=y;const w=0,j=v-1,x=()=>{b=y+1,b>j&&(b=w)},_=()=>{b=y-1,b<w&&(b=j)};switch(p.key){case"Home":b=w;break;case"End":b=j;break;case"ArrowRight":o==="horizontal"&&(u?x():_());break;case"ArrowDown":o==="vertical"&&x();break;case"ArrowLeft":o==="horizontal"&&(u?_():x());break;case"ArrowUp":o==="vertical"&&_();break}const S=b%v;(E=m[S].ref.current)==null||E.focus()});return h.jsx(kwe,{scope:n,disabled:r,direction:a,orientation:o,children:h.jsx(sE.Slot,{scope:n,children:h.jsx(Ae.div,{...i,"data-orientation":o,ref:c,onKeyDown:r?void 0:d})})})}),Ay="AccordionItem",[Pwe,lE]=ky(Ay),BB=W.forwardRef((e,t)=>{const{__scopeAccordion:n,value:r,...a}=e,o=Py(Ay,n),i=Owe(Ay,n),s=cE(n),c=Rt(),l=r&&i.value.includes(r)||!1,u=o.disabled||e.disabled;return h.jsx(Pwe,{scope:n,open:l,disabled:u,triggerId:c,children:h.jsx(qP,{"data-orientation":o.orientation,"data-state":HB(l),...s,...a,ref:t,disabled:u,open:l,onOpenChange:d=>{d?i.onItemOpen(r):i.onItemClose(r)}})})});BB.displayName=Ay;var zB="AccordionHeader",UB=W.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=Py(zo,n),o=lE(zB,n);return h.jsx(Ae.h3,{"data-orientation":a.orientation,"data-state":HB(o.open),"data-disabled":o.disabled?"":void 0,...r,ref:t})});UB.displayName=zB;var uE="AccordionTrigger",VB=W.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=Py(zo,n),o=lE(uE,n),i=Cwe(uE,n),s=cE(n);return h.jsx(sE.ItemSlot,{scope:n,children:h.jsx(SY,{"aria-disabled":o.open&&!i.collapsible||void 0,"data-orientation":a.orientation,id:o.triggerId,...s,...r,ref:t})})});VB.displayName=uE;var qB="AccordionContent",WB=W.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=Py(zo,n),o=lE(qB,n),i=cE(n);return h.jsx(EY,{role:"region","aria-labelledby":o.triggerId,"data-orientation":a.orientation,...i,...r,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});WB.displayName=qB;function HB(e){return e?"open":"closed"}let KB;Ek=DB,Ok=BB,KB=UB,j0=VB,S0=WB;const ZB=Ek,dE=g.forwardRef(({className:e,...t},n)=>h.jsx(Ok,{ref:n,className:Z("border-b",e),...t}));dE.displayName="AccordionItem";const pE=g.forwardRef(({className:e,children:t,...n},r)=>h.jsx(KB,{className:"flex",children:h.jsxs(j0,{ref:r,className:Z("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...n,children:[t,h.jsx(pe,{name:"chevron-down",className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));pE.displayName=j0.displayName;const fE=g.forwardRef(({className:e,children:t,...n},r)=>h.jsx(S0,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:h.jsx("div",{className:Z("pb-4 pt-0",e),children:t})}));fE.displayName=S0.displayName;const Awe=[1,2,3,4,5,6,7,8,9,10],GB=g.memo(e=>{const{t}=ke("flows"),[n,r]=g.useState(""),[a,o]=g.useState([]),[i,s]=g.useState("1"),{loading:c,onSimilaritySearch:l,onCreatePrompt:u,onCreateRetriever:d}=e,p=async()=>{o(await l(n,+i)),r("")},f=async m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),p())};return h.jsxs("div",{className:"mt-4 max-w-full",children:[h.jsx("div",{className:"bg-black/5 dark:bg-white/5 rounded-xl relative",children:h.jsxs("div",{className:"relative px-2 py-1 pb-2",children:[h.jsxs(Ya,{value:`${i}`,onValueChange:m=>s(m),children:[h.jsx(ja,{className:"absolute left-0 !w-14 top-[2px] rounded-xl bg-transparent border-none focus:outline-none focus:ring-0 focus:border-opacity-0 focus:ring-transparent",children:h.jsx(Qa,{placeholder:t("vector_database_node.k_select_placeholder")})}),h.jsx(Sa,{children:Awe.map(m=>h.jsx(Fn,{value:`${m}`,children:m},`${m}`))})]}),h.jsx(Mo,{value:n,disabled:c,placeholder:t("vector_database_node.similarity_search_placeholder"),className:Z("w-full rounded-xl px-2 pl-11 border-none resize-none bg-transparent","min-h-8 max-h-8"),onKeyDown:f,onChange:m=>{r(m.target.value)}}),h.jsx("button",{type:"button",disabled:c,onClick:p,className:"absolute right-3 top-5 -translate-y-1/2 rounded-xl bg-black/5 dark:bg-white/5 p-1",children:h.jsx(pe,{name:c?"loader-circle":"arrow-right",className:Z("w-4 h-4 dark:text-white",n?"opacity-100":"opacity-30",c?"animate-spin":"")})})]})}),h.jsx(ZB,{type:"single",collapsible:!0,children:a==null?void 0:a.map(([m,y],v)=>h.jsxs(dE,{value:`${v}`,children:[h.jsxs(pE,{children:[`[${y.toFixed(2)}] ${m.pageContent}`.substring(0,32),"..."]}),h.jsx(fE,{children:m.pageContent})]},`${v}`))}),h.jsxs("div",{className:"w-full mt-4 flex flex-col gap-1",children:[d?h.jsx(Ye,{disabled:c,onClick:d,className:"w-full",children:t("vector_database_node.to_retriever")}):void 0,a!=null&&a.length&&u?h.jsx(Ye,{disabled:c,onClick:()=>u(a),className:"w-full",children:t("vector_database_node.create_prompt")}):void 0]})]})}),XB=g.memo(({loading:e,onCreateData:t})=>{const{t:n}=ke("flows"),[r,a]=g.useState(""),[o,i]=g.useState(""),s=async()=>{o&&(await t({id:r,content:o}),a(""),i(""))};return h.jsxs("div",{className:"min-w-80",children:[h.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[h.jsx(Be,{htmlFor:"name",children:n("vector_database_node.add_text.id")}),h.jsx(Kt,{value:r,disabled:e,onChange:c=>a(c.target.value||""),placeholder:n("vector_database_node.add_text.id_placeholder"),className:"mb-4"}),h.jsxs(Be,{htmlFor:"name",children:[n("vector_database_node.add_text.content")," ",h.jsx("span",{className:"text-red-600",children:"*"})]}),h.jsx(Mo,{value:o,disabled:e,onChange:c=>i(c.target.value||""),placeholder:n("vector_database_node.add_text.content_placeholder")})]}),h.jsx("div",{className:"flex justify-between mt-6",children:h.jsx(Yn,{loading:e,disabled:!(o!=null&&o.length),onClick:s,className:"w-full",children:n("vector_database_node.add_text.add")})})]})}),hE=({className:e,size:t=200,duration:n=15,anchor:r=90,borderWidth:a=1.5,colorFrom:o="#ffaa40",colorTo:i="#9c40ff",delay:s=0})=>h.jsx("div",{style:{"--size":t,"--duration":n,"--anchor":r,"--border-width":a,"--color-from":o,"--color-to":i,"--delay":`-${s}s`},className:Z("pointer-events-none absolute inset-0 rounded-[inherit] [border:calc(var(--border-width)*1px)_solid_transparent]","![mask-clip:padding-box,border-box] ![mask-composite:intersect] [mask:linear-gradient(transparent,transparent),linear-gradient(white,white)]","after:absolute after:aspect-square after:w-[calc(var(--size)*1px)] after:animate-border-beam after:[animation-delay:var(--delay)] after:[background:linear-gradient(to_left,var(--color-from),var(--color-to),transparent)] after:[offset-anchor:calc(var(--anchor)*1%)_50%] after:[offset-path:rect(0_auto_auto_0_round_calc(var(--size)*1px))]",e)});function Twe({accept:e,maxSize:t}){const{t:n}=ke("atoms"),[r,a]=g.useState(""),[o,i]=g.useState(""),s=g.useRef(null),[c,l]=g.useState(0),u=p=>{var m;const f=(m=p.target.files)==null?void 0:m[0];d(f)},d=p=>{if(i(""),p){if(t&&p.size>t*1024*1024){i(n("file_upload_input.errors.max_size",{maxSize:t,fileSize:(p.size/1024/1024).toFixed(2)}));return}const f=e==null?void 0:e.split(",").map(m=>m.replace(".","").trim());if(e&&!p.type.match(e.replace("/*",""))&&!(f!=null&&f.some(m=>p.type.includes(m)))){i(n("file_upload_input.errors.accept",{accept:e}));return}return l(p.size),a(p.name),p}};return{fileName:r,error:o,fileInputRef:s,handleFileSelect:u,validateAndSetFile:d,clearFile:()=>{a(""),i(""),l(0),s.current&&(s.current.value="")},fileSize:c}}function Iwe({file:e,setFile:t,loading:n,progress:r,fileOptions:a}){const{toast:o}=nn(),{t:i}=ke("atoms"),[s,c]=g.useState(!1),{fileName:l,fileInputRef:u,clearFile:d,error:p,validateAndSetFile:f,fileSize:m}=Twe({accept:(a==null?void 0:a.accept)||"image/*",maxSize:(a==null?void 0:a.maxSize)||3});g.useEffect(()=>{e||d()},[d,e]),g.useEffect(()=>{p&&o({title:p,variant:"destructive"})},[p,o]);function y(x){const _=f(x);_&&t(_)}function v(x){x.preventDefault(),c(!1);const _=x.dataTransfer.files[0];_&&y(_)}function b(x){var S;const _=(S=x.target.files)==null?void 0:S[0];_&&y(_)}function w(){d(),t(void 0)}const j=g.useMemo(()=>{if(!e)return h.jsx("div",{className:"w-16 h-16 rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center",children:h.jsx(pe,{name:"file-text",className:"w-8 h-8 text-zinc-400"})});const x=e.type.startsWith("image/");return h.jsx("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden",children:x?h.jsx("img",{src:URL.createObjectURL(e),alt:"Preview",className:"w-full h-full object-cover"}):h.jsx(pe,{className:"w-14 h-14",name:"file-text"})})},[e]);return h.jsx(h.Fragment,{children:h.jsxs("div",{className:Z("relative group cursor-pointer","rounded-lg border-2 border-dashed","transition-colors duration-200",s?"border-indigo-500 bg-indigo-50/50 dark:bg-indigo-500/10":"border-zinc-200 dark:border-zinc-800"),onDragOver:x=>{x.preventDefault(),c(!0)},onDragLeave:()=>c(!1),onDrop:v,onClick:()=>{var x;return(x=u.current)==null?void 0:x.click()},onKeyDown:x=>{var _;(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),(_=u.current)==null||_.click())},"aria-label":"Upload file",children:[h.jsx("input",{ref:u,type:"file",disabled:n||!!(r&&r<1),accept:(a==null?void 0:a.accept)||"image/*",onChange:b,className:"hidden"}),h.jsx("div",{className:"p-8 space-y-4",children:l?h.jsxs("div",{className:"flex items-center gap-4",children:[j,h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs("p",{className:"text-sm font-medium truncate",children:[l||"No file selected"," ",h.jsx("span",{className:"text-xs text-zinc-500 leading-5",children:m?`(${(m/1024/1024).toFixed(2)} MB)`:""})]}),r&&r<1?h.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[h.jsxs("p",{children:[(r*100).toFixed(2)," %"]}),h.jsx("div",{className:"h-1 flex-1 bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden items-center flex",children:h.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-200",style:{width:`${r*100}%`}})})]}):void 0]}),h.jsx("button",{type:"button",disabled:n||!!(r&&r<1),onClick:x=>{x.stopPropagation(),w()},className:"p-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded",children:h.jsx(pe,{name:"x",className:"w-5 h-5 text-zinc-400"})}),r&&r<1?h.jsx(hE,{className:"rounded-lg"}):void 0]}):h.jsxs("div",{className:"flex flex-col items-center gap-2",children:[h.jsx(pe,{name:"upload",className:"w-8 h-8 text-zinc-400 dark:text-zinc-500"}),h.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:i("file_upload_input.drop_file")})]})})]})})}function JB({onFileSubmit:e,fileOptions:t,progress:n,loading:r}){const{t:a}=ke("flows"),[o,i]=g.useState(),s=async()=>{o&&(await e(o),i(void 0))};return h.jsxs("div",{className:"w-full max-w-full space-y-2 mt-4",children:[h.jsx("div",{className:"mb-6",children:h.jsx(Iwe,{progress:n,loading:r,fileOptions:t,setFile:i,file:o})}),h.jsx(Yn,{loading:r,disabled:!o,onClick:s,className:"w-full mt-4",children:a("vector_database_node.add_file.index")})]})}const Ty=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{className:"relative w-full overflow-auto",children:h.jsx("table",{ref:n,className:Z("w-full caption-bottom text-sm",e),...t})}));Ty.displayName="Table";const Iy=g.forwardRef(({className:e,...t},n)=>h.jsx("thead",{ref:n,className:Z("[&_tr]:border-b",e),...t}));Iy.displayName="TableHeader";const Ry=g.forwardRef(({className:e,...t},n)=>h.jsx("tbody",{ref:n,className:Z("[&_tr:last-child]:border-0",e),...t}));Ry.displayName="TableBody";const Rwe=g.forwardRef(({className:e,...t},n)=>h.jsx("tfoot",{ref:n,className:Z("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));Rwe.displayName="TableFooter";const js=g.forwardRef(({className:e,...t},n)=>h.jsx("tr",{ref:n,className:Z("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));js.displayName="TableRow";const cl=g.forwardRef(({className:e,...t},n)=>h.jsx("th",{ref:n,className:Z("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));cl.displayName="TableHead";const ll=g.forwardRef(({className:e,...t},n)=>h.jsx("td",{ref:n,className:Z("align-middle [&:has([role=checkbox])]:pr-0",e),...t}));ll.displayName="TableCell";const Dwe=g.forwardRef(({className:e,...t},n)=>h.jsx("caption",{ref:n,className:Z("mt-4 text-sm text-muted-foreground",e),...t}));Dwe.displayName="TableCaption";const YB=({className:e,...t})=>h.jsx("nav",{role:"navigation","aria-label":"pagination",className:Z("mx-auto flex w-full justify-center",e),...t});YB.displayName="Pagination";const QB=g.forwardRef(({className:e,...t},n)=>h.jsx("ul",{ref:n,className:Z("flex flex-row items-center gap-1",e),...t}));QB.displayName="PaginationContent";const ul=g.forwardRef(({className:e,...t},n)=>h.jsx("li",{ref:n,className:Z("",e),...t}));ul.displayName="PaginationItem";const Dy=({className:e,isActive:t,size:n="icon",...r})=>h.jsx("a",{"aria-current":t?"page":void 0,className:Z(Ou({variant:t?"outline":"ghost",size:n}),e),...r});Dy.displayName="PaginationLink";const ez=({className:e,...t})=>{const{t:n}=ke("atoms");return h.jsxs(Dy,{"aria-label":"Go to previous page",size:"default",className:Z("gap-1 pl-2.5",e),...t,children:[h.jsx(pe,{name:"chevron-left",className:"h-4 w-4"}),h.jsx("span",{children:n("pagination.previous")})]})};ez.displayName="PaginationPrevious";const tz=({className:e,...t})=>{const{t:n}=ke("atoms");return h.jsxs(Dy,{"aria-label":"Go to next page",size:"default",className:Z("gap-1 pr-2.5",e),...t,children:[h.jsx("span",{children:n("pagination.next")}),h.jsx(pe,{name:"chevron-right",className:"h-4 w-4"})]})};tz.displayName="PaginationNext";const mE=({className:e,...t})=>{const{t:n}=ke("atoms");return h.jsxs("span",{"aria-hidden":!0,className:Z("flex h-9 w-9 items-center justify-center",e),...t,children:[h.jsx(pe,{name:"ellipsis",className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:n("pagination.more_pages")})]})};mE.displayName="PaginationEllipsis";const nz=uo(({title:e,content:t})=>{const n=tn();return h.jsx(fi,{open:n.visible,onOpenChange:n.hide,children:h.jsxs(xo,{className:"sm:max-w-2xl",children:[h.jsx(_o,{children:h.jsxs("div",{className:"flex",children:[h.jsx(pe,{name:"file",className:"mr-2 h-4 w-4"}),h.jsx(jo,{children:e})]})}),h.jsx("div",{className:"mx-auto w-full min-h-96 max-h-96 overflow-hidden",children:h.jsx("div",{className:"relative w-full h-full overflow-hidden rounded-xl p-1 border border-border",children:h.jsx("pre",{className:"break-all h-full overflow-y-auto bg-background font-mono text-xs w-full",children:t})})})]})})}),Ly=g.memo(e=>{const{data:t,headers:n,limitLengthByColumns:r,showPerPage:a=7,paginationShowLimit:o=1,contentLengthLimit:i=64}=e,[s,c]=g.useState({page:1,maxPage:1}),l=tn(nz);g.useEffect(()=>{c(f=>({...f,maxPage:Math.ceil(t.length/a)}))},[t.length,a]);const u=g.useMemo(()=>t.slice((s.page-1)*a,s.page*a),[t,s.page,a]),d=g.useMemo(()=>{let f=!1,m=!1;return h.jsx(YB,{className:"mt-4 mb-4 ml-4 mr-4 w-full",children:h.jsxs(QB,{children:[s.page>1?h.jsx(ul,{onClick:()=>c(y=>({...y,page:y.page-1})),children:h.jsx(ez,{})}):null,Array.from({length:s.maxPage},(y,v)=>{const b=v+1,w=v===0||v===s.maxPage-1;return!w&&b>s.page+o&&m?null:!w&&b>s.page+o?(m=!0,h.jsx(ul,{children:h.jsx(mE,{})},v)):!w&&b<s.page-o&&f?null:!w&&b<s.page-o?(f=!0,h.jsx(ul,{children:h.jsx(mE,{})},v)):h.jsx(ul,{onClick:()=>c(j=>({...j,page:b})),children:h.jsx(Dy,{isActive:v+1===s.page,children:v+1})},v)}),s.page<s.maxPage?h.jsx(ul,{onClick:()=>c(y=>({...y,page:y.page+1})),children:h.jsx(tz,{})}):null]})})},[s.maxPage,s.page,o]),p=(f,m)=>{if(!f)return;const y=Array.isArray(f)?f:n.map(v=>f[v]);return h.jsxs(js,{children:[h.jsx(ll,{children:h.jsx("div",{className:"font-bold",children:m+1})}),y.map((v,b)=>{const w=typeof v=="string"?v:JSON.stringify(v),j=n[b],x=(r==null?void 0:r[j])||i,_=w.length>x;return h.jsx(ll,{className:"p-4",children:h.jsxs("div",{onClick:_?()=>l.show({title:j,content:w}):void 0,className:"flex gap-4",children:[_?`${w.substring(0,x)}...`:w,_?h.jsx(pe,{className:"w-6 mt-[-2px]",name:"chevron-right"}):null]})},`${b}`)})]},`${m}`)};return h.jsxs(h.Fragment,{children:[h.jsxs(Ty,{className:"w-full",children:[h.jsx(Iy,{children:h.jsxs(js,{children:[h.jsx(cl,{},"index"),n?n.map(f=>h.jsx(cl,{children:h.jsx("div",{className:"font-bold",children:f})},f)):void 0]})}),h.jsx(Ry,{children:u!=null&&u.length?u==null?void 0:u.map(p):void 0})]}),d]})});var yE,rz;T0=function(){if(rz)return yE;rz=1;function e(t,n,r){var a=-1,o=t.length;n<0&&(n=-n>o?0:o+n),r=r>o?o:r,r<0&&(r+=o),o=n>r?0:r-n>>>0,n>>>=0;for(var i=Array(o);++a<o;)i[a]=t[a+n];return i}return yE=e,yE};var gE,az;Hs=function(){if(az)return gE;az=1;var e=su(),t=Ki(),n=Rh(),r=Wr();function a(o,i,s){if(!r(s))return!1;var c=typeof i;return(c=="number"?t(s)&&n(i,s.length):c=="string"&&i in s)?e(s[i],o):!1}return gE=a,gE};var vE,oz;function Lwe(){if(oz)return vE;oz=1;var e=/\s/;function t(n){for(var r=n.length;r--&&e.test(n.charAt(r)););return r}return vE=t,vE}var bE,iz;function $we(){if(iz)return bE;iz=1;var e=Lwe(),t=/^\s+/;function n(r){return r&&r.slice(0,e(r)+1).replace(t,"")}return bE=n,bE}var wE,sz;function cz(){if(sz)return wE;sz=1;var e=$we(),t=Wr(),n=gc(),r=NaN,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,s=parseInt;function c(l){if(typeof l=="number")return l;if(n(l))return r;if(t(l)){var u=typeof l.valueOf=="function"?l.valueOf():l;l=t(u)?u+"":u}if(typeof l!="string")return l===0?l:+l;l=e(l);var d=o.test(l);return d||i.test(l)?s(l.slice(2),d?2:8):a.test(l)?r:+l}return wE=c,wE}var xE,lz;function uz(){if(lz)return xE;lz=1;var e=cz(),t=1/0,n=17976931348623157e292;function r(a){if(!a)return a===0?a:0;if(a=e(a),a===t||a===-t){var o=a<0?-1:1;return o*n}return a===a?a:0}return xE=r,xE}var _E,dz;function pz(){if(dz)return _E;dz=1;var e=uz();function t(n){var r=e(n),a=r%1;return r===r?a?r-a:r:0}return _E=t,_E}var jE,fz;function Fwe(){if(fz)return jE;fz=1;var e=T0(),t=Hs(),n=pz(),r=Math.ceil,a=Math.max;function o(i,s,c){(c?t(i,s,c):s===void 0)?s=1:s=a(n(s),0);var l=i==null?0:i.length;if(!l||s<1)return[];for(var u=0,d=0,p=Array(r(l/s));u<l;)p[d++]=e(i,u,u+=s);return p}return jE=o,jE}var Bwe=Fwe();const SE=st(Bwe),zwe=()=>{const[e,t]=g.useState(!1),{t:n}=ke("flows"),{toast:r}=nn(),{index:a,similaritySearchWithScore:o}=rp(),i=g.useCallback(async(c,l)=>{try{if(!(l!=null&&l.vectorDatabase)){r({variant:"destructive",title:n("vector_database_node.errors.vector_database_not_found")});return}if((l==null?void 0:l.vectorDatabase.storage)===Vr.DataNode)throw new Error("DataNode storage is not supported for similarity search");return t(!0),await o(void 0,{database:{databaseId:l.vectorDatabase.id}},c,l==null?void 0:l.k)}catch{r({variant:"destructive",title:n("vector_database_node.errors.similarity_search_failed")})}finally{t(!1)}},[o,r,n]),s=g.useCallback(async(c,l)=>{var u;try{t(!0);const d=c.content?[new vf({pageContent:c.content,id:c.id,metadata:{id:c.id}})]:c.documents;if(!(d!=null&&d.length)){r({variant:"destructive",title:n("vector_database_node.errors.content_not_found")});return}if(!(l!=null&&l.vectorDatabase)){r({variant:"destructive",title:n("vector_database_node.errors.vector_database_not_found")});return}if((l==null?void 0:l.vectorDatabase.storage)===Vr.DataNode)throw new Error("DataNode storage is not supported for indexing");{const p=SE(d,10);let f=0;for(const m of p)(u=l==null?void 0:l.onProgressReport)==null||u.call(l,{handling:m.length,handled:f,total:d.length}),await a(void 0,{database:{databaseId:l.vectorDatabase.id}},m),f+=m.length}}catch{r({variant:"destructive",title:n("vector_database_node.errors.similarity_search_failed")})}finally{t(!1)}},[a,r,n]);return{loading:e,indexData:s,similaritySearchWithScore:i}},Uwe=uo(({retriverInfo:e})=>{var y,v,b;const{t}=ke("applications"),{loading:n,similaritySearchWithScore:r,indexData:a}=zwe(),[o,i]=g.useState("search"),[s,c]=g.useState(0),l=tn(),u=g.useMemo(()=>{var x,_;if(!((x=e==null?void 0:e.vectorDatabaseEntity)!=null&&x.raw))return{headers:[],rows:[]};const w=["content","embedding","metadata"],j=Pv((_=e==null?void 0:e.vectorDatabaseEntity)==null?void 0:_.raw);return{headers:w,rows:j.map(S=>{try{return JSON.parse(S)}catch{return[]}})}},[(y=e==null?void 0:e.vectorDatabaseEntity)==null?void 0:y.raw]),d=g.useCallback(async(...w)=>{const[j,x]=w;await a(j,{...x,vectorDatabase:e.vectorDatabaseEntity})},[a,e.vectorDatabaseEntity]),p=g.useCallback(async(w,j)=>{const x=w.trim(),_=await r(x,{k:j,vectorDatabase:e.vectorDatabaseEntity});if(_!=null&&_.length)return _},[e.vectorDatabaseEntity,r]),f=g.useCallback(async w=>{if(w.type.includes("text")||w.type.includes("txt")){const j=new FileReader;j.onload=async x=>{var S;const _=(S=x.target)==null?void 0:S.result;await d({content:_},{vectorDatabase:e.vectorDatabaseEntity})},j.readAsText(w)}else if(w.type.endsWith("pdf")){const j=new Blob([w],{type:"application/pdf"}),x=await new $F(j,{pdfjs:async()=>{const _=await Ht(()=>import("./pdf.min-uhRye5Eo.js").then(async S=>(await S.__tla,S)),__vite__mapDeps([11,1,2,3,4]));return await Ht(()=>import("./pdf.worker.min-CTxugM4J.js").then(async S=>(await S.__tla,S)),__vite__mapDeps([12,1,2,3,4])),_.GlobalWorkerOptions.workerSrc=new URL("pdfjs-dist/build/pdf.worker.min.js",import.meta.url).toString(),_},parsedItemSeparator:" "}).load();await d({documents:x},{vectorDatabase:e.vectorDatabaseEntity,onProgressReport:_=>{c((_.handled+_.handling)/_.total)}})}},[d,e.vectorDatabaseEntity]),m=g.useMemo(()=>{switch(o){case"search":return h.jsx(xa,{value:"search",children:h.jsx(GB,{loading:n,onSimilaritySearch:p})});case"new":return h.jsx(xa,{className:"min-w-80",value:"new",children:h.jsx(XB,{loading:n,onCreateData:d})});case"file":return h.jsx(xa,{value:"file",children:h.jsx(JB,{loading:n,progress:s,onFileSubmit:f,fileOptions:{accept:".pdf,.txt,.text",maxSize:1}})});case"view":return h.jsx(xa,{value:"view",className:"max-h-full overflow-auto",children:h.jsx(Ly,{data:u.rows,headers:u.headers,limitLengthByColumns:{embedding:32}})})}},[d,f,p,n,o,s,u]);return h.jsx(fi,{open:l.visible,onOpenChange:l.hide,children:h.jsxs(xo,{className:"max-w-3xl",children:[h.jsx(_o,{children:h.jsxs("div",{className:"flex",children:[h.jsx(pe,{name:"file",className:"mr-2 h-4 w-4"}),h.jsx(jo,{children:t("chat.vector_database")})]})}),h.jsx("div",{className:"mx-auto w-full min-h-96 max-h-full overflow-hidden",children:h.jsx("div",{className:"w-full h-full",children:h.jsxs(eE,{value:o,onValueChange:i,defaultValue:"search",className:Z("w-full h-full mt-4"),children:[h.jsxs(Ey,{className:Z("grid w-full grid-cols-3",((v=e==null?void 0:e.vectorDatabaseEntity)==null?void 0:v.storage)===Vr.DatabaseNode?"grid-cols-4":"grid-cols-3"),children:[h.jsx(wa,{value:"search",children:t("chat.search")}),h.jsx(wa,{value:"new",children:t("chat.text")}),h.jsx(wa,{value:"file",children:t("chat.file")}),((b=e==null?void 0:e.vectorDatabaseEntity)==null?void 0:b.storage)===Vr.DatabaseNode?h.jsx(wa,{value:"view",children:t("chat.view")}):void 0]}),m]})})})]})})}),Vwe=e=>{const[t,n]=g.useState([]),r=Je(i=>i.currentSession),a=g.useCallback(async()=>{if(!e||!(r!=null&&r.id))return;const i=await ue("FlowEdge").find({where:{session_id:r.id,source:e.id},order:{id:"DESC"}}),{flowNodes:s,flowNodeDatas:c}=await Em({where:{session_id:r.id,id:Ha(i.map(l=>l.target)),source_type:"JSONData"},order:{updated_at:"DESC"},select:["id","source_id","source_type","updated_at"]});n(s.reduce((l,u)=>{var p;const d=(p=c[u.source_type])==null?void 0:p.find(f=>f.id===u.source_id);return d&&l.push({node:u,entity:d}),l},[]))},[r==null?void 0:r.id,e]),o=g.useCallback(async i=>{await ue("FlowNode").delete(i.id),await ue("JSONData").delete(i.source_id);const s=await ue("FlowEdge").find({where:[{source:i.id},{target:i.id}]});await Promise.all(s.map(c=>ue("FlowEdge").delete(c.id))),a()},[a]);return g.useEffect(()=>{e&&a()},[a,e]),{chatList:t,deleteChat:o,getChatList:a}};function qwe({schema:e,mainLLMInfo:t,loadLLM:n,retriverInfo:r,threadNode:a,onSelectThread:o,onAddNewThread:i,currentDataNode:s,setLLMInfo:c,changeLLMOptions:l,...u}){var O,N;const{t:d}=ke("applications"),[p,f]=g.useState(!1),m=tn(i0e),y=tn(Uwe),{chatList:v,getChatList:b,deleteChat:w}=Vwe(a),j=g.useCallback(async()=>{try{f(!0),await(i==null?void 0:i()),b()}finally{f(!1)}},[b,i]),x=g.useCallback(()=>{y.show({retriverInfo:r[0]})},[r,y]),_=g.useCallback(async(M,k)=>{M.stopPropagation(),m.show({onDelete:()=>w(k)})},[w,m]),S=g.useCallback(async M=>{t!=null&&t.llm&&(await l(t==null?void 0:t.llm,M),c(k=>k?{...k,llm:{...k.llm,options:M}}:void 0))},[l,t==null?void 0:t.llm,c]),E=g.useMemo(()=>{var M;return h.jsx(IS,{className:Z("overflow-hidden break-words whitespace-pre-wrap w-full rounded-lg"),source:(M=e==null?void 0:e.schema_items)!=null&&M.length?`\`\`\`javascript
${W9((e==null?void 0:e.schema_items)||[])}
\`\`\``:""})},[e==null?void 0:e.schema_items]);return h.jsxs(Bb,{variant:"sidebar",side:"right",collapsible:"none",...u,children:[h.jsx("div",{className:"h-1"}),h.jsxs(Du,{className:"justify-between",children:[h.jsx("div",{className:"text-sm pl-2",children:d("chat.history")}),h.jsx(Yn,{loading:p,onClick:j,variant:"link",className:"mr-[-6px]",children:h.jsx(pe,{name:"circle-plus"})})]}),h.jsxs(Ub,{children:[h.jsx(Ru,{className:"flex-1",children:h.jsx(uc,{children:v.map(({node:M},k)=>{var P;return h.jsx(bo,{onClick:()=>o(M),children:h.jsx(wo,{className:"cursor-pointer",children:h.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[h.jsxs("div",{className:"flex gap-2",children:[h.jsx(pe,{size:16,name:((P=s==null?void 0:s.node)==null?void 0:P.id)===M.id?"check":"chevron-right",className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"}),h.jsx("span",{children:`Thread ${k+1}`})]}),h.jsx(pe,{onClick:A=>_(A,M),size:16,name:"trash-2"})]})})},M.id)})})}),r!=null&&r.length?h.jsxs(Gt,{className:"m-2 p-2 max-w-full",children:[h.jsx("pre",{className:"overflow-auto",children:r.map((M,k)=>{var P;return h.jsx("span",{children:((P=M.promptEntity)==null?void 0:P.content)||""},`${k}`)})}),h.jsx(Ye,{onClick:x,className:"w-full mt-4",children:d("chat.vector_database")})]}):void 0,(O=e==null?void 0:e.schema_items)!=null&&O.length?h.jsx("div",{className:"m-2 !mb-0",children:h.jsx(g.Suspense,{fallback:h.jsx(vy,{}),children:E})}):void 0,h.jsx(LF,{options:(N=t==null?void 0:t.llm)==null?void 0:N.options,onChangeOptions:S,className:"p-2"}),h.jsx(Vbe,{llm:t==null?void 0:t.llm,status:t==null?void 0:t.status,progress:t==null?void 0:t.progress,loadLLM:n})]})]})}var EE="Avatar",[Wwe,j3e]=ur(EE),[Hwe,hz]=Wwe(EE),mz=g.forwardRef((e,t)=>{const{__scopeAvatar:n,...r}=e,[a,o]=g.useState("idle");return h.jsx(Hwe,{scope:n,imageLoadingStatus:a,onImageLoadingStatusChange:o,children:h.jsx(Ae.span,{...r,ref:t})})});mz.displayName=EE;var yz="AvatarImage",gz=g.forwardRef((e,t)=>{const{__scopeAvatar:n,src:r,onLoadingStatusChange:a=()=>{},...o}=e,i=hz(yz,n),s=Kwe(r,o.referrerPolicy),c=dr(l=>{a(l),i.onImageLoadingStatusChange(l)});return ln(()=>{s!=="idle"&&c(s)},[s,c]),s==="loaded"?h.jsx(Ae.img,{...o,ref:t,src:r}):null});gz.displayName=yz;var vz="AvatarFallback",bz=g.forwardRef((e,t)=>{const{__scopeAvatar:n,delayMs:r,...a}=e,o=hz(vz,n),[i,s]=g.useState(r===void 0);return g.useEffect(()=>{if(r!==void 0){const c=window.setTimeout(()=>s(!0),r);return()=>window.clearTimeout(c)}},[r]),i&&o.imageLoadingStatus!=="loaded"?h.jsx(Ae.span,{...a,ref:t}):null});bz.displayName=vz;function Kwe(e,t){const[n,r]=g.useState("idle");return ln(()=>{if(!e){r("error");return}let a=!0;const o=new window.Image,i=s=>()=>{a&&r(s)};return r("loading"),o.onload=i("loaded"),o.onerror=i("error"),o.src=e,t&&(o.referrerPolicy=t),()=>{a=!1}},[e,t]),n}var wz=mz,xz=gz,_z=bz;const jz=g.forwardRef(({className:e,...t},n)=>h.jsx(wz,{ref:n,className:Z("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));jz.displayName=wz.displayName;const Sz=g.forwardRef(({className:e,...t},n)=>h.jsx(xz,{ref:n,className:Z("aspect-square h-full w-full",e),...t}));Sz.displayName=xz.displayName;const Ez=g.forwardRef(({className:e,...t},n)=>h.jsx(_z,{ref:n,className:Z("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Ez.displayName=_z.displayName;const Zwe=lo("flex gap-2 max-w-[60%] items-end relative group",{variants:{variant:{received:"self-start",sent:"self-end flex-row-reverse"},layout:{default:"",ai:"max-w-full w-full items-center"}},defaultVariants:{variant:"received",layout:"default"}}),Oz=g.forwardRef(({className:e,variant:t,layout:n,children:r,...a},o)=>h.jsx("div",{className:Z(Zwe({variant:t,layout:n,className:e}),"relative group"),ref:o,...a,children:g.Children.map(r,i=>g.isValidElement(i)&&typeof i.type!="string"?g.cloneElement(i,{variant:t,layout:n,className:a==null?void 0:a.innerclassname}):i)}));Oz.displayName="ChatBubble";const Gwe=({src:e,fallback:t,className:n})=>h.jsxs(jz,{className:n,children:[h.jsx(Sz,{src:e,alt:"Avatar"}),h.jsx(Ez,{children:t})]}),Xwe=lo("p-4",{variants:{variant:{received:"bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg",sent:"border border-border rounded-l-lg rounded-tr-lg"},layout:{default:"",ai:"border-t w-full rounded-none bg-transparent"}},defaultVariants:{variant:"received",layout:"default"}}),Cz=g.forwardRef(({className:e,variant:t,layout:n,isLoading:r=!1,children:a,...o},i)=>h.jsx("div",{className:Z(Xwe({variant:t,layout:n,className:e}),"break-words max-w-full whitespace-pre-wrap"),ref:i,...o,children:r?h.jsx("div",{className:"flex items-center space-x-2",children:h.jsx(vy,{})}):a}));Cz.displayName="ChatBubbleMessage";const Jwe=({icon:e,onClick:t,className:n,variant:r="ghost",size:a="icon",...o})=>h.jsx(Ye,{variant:r,size:a,className:n,onClick:t,...o,children:e}),Ywe=g.forwardRef(({variant:e,className:t,children:n,...r},a)=>h.jsx("div",{ref:a,className:Z("absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200",e==="sent"?"-left-1 -translate-x-full flex-row-reverse":"-right-1 translate-x-full",t),...r,children:n}));Ywe.displayName="ChatBubbleActionWrapper";const Qwe=[{icon:"copy",label:"Copy"},{icon:"refresh-ccw",label:"Refresh"},{icon:"volume-2",label:"Volume"}],exe=g.memo(({message:e,index:t,isLastMessage:n,isGenerating:r,isSchema:a,onActionClick:o})=>{const i=g.useMemo(()=>h.jsx(IS,{style:{color:"unset !important"},source:e.content?a?`\`\`\`json
${e.content}
\`\`\``:e.content:""}),[a,e.content]);return h.jsxs(Oz,{innerclassname:e.role=="system"?"!bg-transparent font-semibold":void 0,variant:e.role=="user"?"sent":"received",children:[e.role==="system"?h.jsx("div",{className:"w-10 h-10"}):e.role==="assistant"?h.jsx(Gwe,{src:"",fallback:e.data&&typeof e.data=="object"&&"injectedMessage"in e.data?"\u{1F4C2}":"\u{1F916}"}):void 0,h.jsxs(Cz,{children:[r&&n&&(!e.content||a)?h.jsx(vy,{}):h.jsxs(g.Suspense,{fallback:h.jsx(vy,{}),children:[e.role==="system"?h.jsx(bn,{className:"!text-sm mb-1",children:"System"}):void 0,i]}),e.role==="assistant"&&n&&h.jsx("div",{className:"flex items-center mt-1.5 gap-1",children:!r&&h.jsx(h.Fragment,{children:Qwe.map((s,c)=>h.jsx(Jwe,{variant:"ghost",className:"size-5",icon:h.jsx(pe,{name:s.icon,className:"size-3"}),onClick:()=>o(s.label,e)},c))})})]})]},t)},()=>!1),txe=()=>({changeLLMOptions:g.useCallback(async(e,t)=>{e&&await ue("LLM").update(e.id,{options:t})},[])}),nxe=g.memo(()=>{const{t:e}=ke("applications"),t=g.useRef(!1),[n,r]=g.useState(!1),a=g.useCallback(()=>{setTimeout(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},50)},[]),o=Gpe(),{schema:i,threadInfo:s,mainLLMInfo:c,retriverInfo:l,currentDataNode:u,loadLLM:d,setLLMInfo:p,addNewDataNode:f,selectDataNode:m,updateMessagesData:y,onThreadMessagesLoaded:v}=o,{changeLLMOptions:b}=txe(),{sendMessage:w}=o0e(o),{input:j,messages:x,isLoading:_,reload:S,setInput:E,handleSubmit:O,handleInputChange:N,setMessages:M}=dk({fetch:async(T,R)=>{try{r(!0);const L=JSON.parse(R==null?void 0:R.body),D=qi(),z=L.messages[L.messages.length-1];return t.current=!0,M(B=>[...B,{id:qi(),content:z.content,role:"user"}]),await w(z.content,L.messages||[],{retriverInfo:l},{schema:i,onInjectedMessages:B=>{B.length&&M($=>[...$,...B.map(U=>U._getType()==="system"?{id:qi(),content:`${U.content}`,role:"system",data:{injectedMessage:!0}}:U._getType()==="human"?{id:qi(),content:`${U.content}`,role:"user",data:{injectedMessage:!0}}:{id:qi(),content:`${U.content}`,role:"assistant",data:{injectedMessage:!0}})])},onResponseMessageCreate:B=>{M($=>[...$,{id:D,content:B||"",role:"assistant"}])},onMessageUpdate:B=>{M($=>{const U=[...$],F=U.findIndex(H=>H.id===D);return F!==-1&&(U[F]={...U[F],content:B.nodeData.content||""}),U}),t.current&&a()}}),M(B=>(y(B),B)),r(!1),E(""),t.current&&a(),new Response}finally{r(!1)}}}),k=g.useRef(null);g.useEffect(()=>{const T=v(R=>{M(R||[]),a()});return()=>{T()}},[M,v,a]);const P=async(T,R)=>(r(!0),await O(R),!0),A=g.useCallback(async(T,R)=>{if(T==="Refresh"){r(!0);try{await S()}finally{r(!1)}}T==="Copy"&&R&&R.role==="assistant"&&navigator.clipboard.writeText(R.content),T==="Volume"&&(R!=null&&R.content)&&await qM.speak((R==null?void 0:R.content)||"")},[S]),C=g.useCallback(()=>t.current=!1,[]),I=g.useMemo(()=>x&&x.map((T,R)=>h.jsx(exe,{message:T,index:R,isLastMessage:R===x.length-1,isGenerating:n,isSchema:!!i,onActionClick:A},T.id||`${R}`)),[x,n,i,A]);return h.jsxs(Fb,{onClick:C,className:"max-h-full !overflow-hidden !min-h-full",style:{minHeight:"unset"},defaultOpen:!0,children:[h.jsx(zb,{className:"!max-h-full !overflow-hidden",style:{minHeight:"unset"},children:h.jsxs("main",{className:"flex h-full w-full max-w-2xl flex-col items-center mx-auto overflow-hidden",children:[h.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden min-w-full max-w-full",children:h.jsx(hI,{className:"!max-h-full",ref:k,children:I})}),h.jsx(w0,{className:"!max-w-2xl px-4",onSubmit:P,disabled:_||n||(c==null?void 0:c.status)!==et.Loaded,placeholder:e("chat.input_message_placeholder"),maxHeight:72,value:j,onChange:N})]})}),h.jsx(qwe,{schema:i,currentDataNode:u,threadNode:s==null?void 0:s.threadNode,loadLLM:d,mainLLMInfo:c,retriverInfo:l,onAddNewThread:f,onSelectThread:m,changeLLMOptions:b,setLLMInfo:p})]})}),rxe=()=>{const[e,t]=g.useState(),n=Je(u=>u.currentSession),{t:r}=ke("flows"),{toast:a}=nn(),{stream:o}=nl(),{loadModel:i}=Om(),{modalRef:s}=Pd(Nm),c=g.useCallback(async(u,d)=>{if(n!=null&&n.main_node_id){if(!(e!=null&&e.llm))return a({variant:"destructive",description:r("editor_node.errors.llm_not_found")});(e==null?void 0:e.status)!==et.Loaded&&(await i(e.llm.provider,e.llm.name,p=>{t(f=>f&&{...f,progress:p.text})}),t(p=>p&&{...p,status:et.Loaded,progress:""}));try{return(await o(e==null?void 0:e.llm.provider,typeof u=="string"?[new Ur(u)]:u,{onMessageUpdate:p=>{d==null||d(p.content)},llm:e==null?void 0:e.llm})).content}catch(p){if(p instanceof Error&&p.message.includes("LLM_NOT_LOADED_YET"))return a({title:r("editor_node.errors.llm_not_loaded_yet")});a({variant:"destructive",title:r("editor_node.errors.stream_message_failed")})}}},[n==null?void 0:n.main_node_id,e==null?void 0:e.llm,e==null?void 0:e.status,a,r,i,o]),l=g.useCallback(async()=>{if(!(n!=null&&n.main_node_id))return;const u=await ue("FlowEdge").find({where:{target:n.main_node_id}}),d=(await ue("FlowNode").find({where:{id:Ha(u.map(f=>f.source))}})).find(f=>f.source_type===ie.LLM);if(!d)return;const p=await ue("LLM").findOne({where:{id:d.source_id}});p&&(n.passphrase&&await yj(n.passphrase,s.current),await i(p.provider,p.name,f=>{t(m=>m&&{...m,llm:p,progress:f.text})}),t({llm:p,status:et.Loaded}))},[n==null?void 0:n.main_node_id,n==null?void 0:n.passphrase,i,s]);return g.useEffect(()=>{n!=null&&n.main_node_id&&l()},[n==null?void 0:n.main_node_id,l]),{mainLLMInfo:e,createMessage:c}},axe=()=>{const e=Je(o=>o.currentSession),t=g.useRef(null),[n,r]=g.useState(),a=g.useCallback(async o=>{e!=null&&e.main_node_id&&(clearTimeout(t.current),t.current=setTimeout(async()=>{e!=null&&e.main_node_id&&await ue("FlowNode").update(e.main_node_id,{data:o})},150))},[e]);return g.useEffect(()=>{e!=null&&e.main_node_id&&ue("FlowNode").findOne({where:{id:e.main_node_id}}).then(o=>{r(o)})},[e]),{flowNode:n,updateEditorContent:a}},oxe=g.lazy(()=>Ht(()=>import("./index-DYCql1Sf.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([13,1,2,14,15,7,16,4,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,3,56]))),ixe=g.memo(()=>{var o,i,s,c,l;const{flowNode:e,updateEditorContent:t}=axe(),{mainLLMInfo:n,createMessage:r}=rxe(),a=g.useCallback(u=>{t(u)},[t]);return h.jsxs("div",{className:"h-full w-full relative","data-registry":"plate",children:[h.jsx(Tu,{children:h.jsx($a,{children:h.jsxs("div",{className:Z("flex absolute !z-[51] right-1 top-0 max-w-28 h-9 items-center justify-center flex-row"),children:[(n==null?void 0:n.status)===et.Loaded&&((o=n==null?void 0:n.llm)!=null&&o.name)?h.jsx(Pr,{name:(i=n==null?void 0:n.llm)==null?void 0:i.name,className:"w-5 h-5 mr-1"}):void 0,h.jsx(Fa,{className:"overflow-hidden !text-ellipsis w-full max-w-full max-h-full whitespace-nowrap text-sm",children:n!=null&&n.progress?n==null?void 0:n.progress:(n==null?void 0:n.status)===et.Loaded?(s=n==null?void 0:n.llm)==null?void 0:s.name:h.jsx(pe,{size:16,name:"loader-circle",className:"animate-spin ml-2"})}),h.jsx(Yr,{children:h.jsx("p",{children:(n==null?void 0:n.progress)||((c=n==null?void 0:n.llm)==null?void 0:c.name)||""})})]})})}),h.jsx(g.Suspense,{fallback:h.jsx(ru,{simple:!0}),children:e?h.jsx(oxe,{defaultValue:e==null?void 0:e.data,onValueChange:a,copilotStream:r,hideDragIcon:!0,enableHistoryControl:!0},((l=n==null?void 0:n.llm)==null?void 0:l.name)||"default"):h.jsx(ru,{simple:!0})})]})}),sxe=()=>{const[e,t]=g.useState(!1),[n,r]=g.useState(),a=Je(f=>f.currentSession),{t:o}=ke("flows"),{toast:i}=nn(),{loadModel:s}=Om(),{stream:c}=nl(),{modalRef:l}=Pd(Nm),u=g.useCallback(async(f,m,y)=>{if(a!=null&&a.main_node_id){if(!(n!=null&&n.llm)){i({variant:"destructive",description:o("editor_node.errors.llm_not_found")});return}(n==null?void 0:n.status)!==et.Loaded&&(await s(n.llm.provider,n.llm.name,v=>{r(b=>b&&{...b,progress:v.text})}),r(v=>v&&{...v,status:et.Loaded,progress:""}));try{const v=m.map(w=>w.role==="system"?new kv(w.content):w.role==="assistant"?new Aa(w.content):new Ur(w.content)),{content:b}=await c(n.llm.provider,[...v,new Ur(f)],{onMessageUpdate:({content:w})=>{y==null||y(w)},llm:n.llm});return y==null||y(b),b}catch(v){if(v instanceof Error&&v.message.includes("LLM_NOT_LOADED_YET")){i({title:o("editor_node.errors.llm_not_loaded_yet")});return}i({variant:"destructive",title:o("editor_node.errors.stream_message_failed")})}}},[a==null?void 0:a.main_node_id,n==null?void 0:n.llm,n==null?void 0:n.status,i,o,s,c]),d=g.useCallback(async()=>{try{if(t(!0),!(a!=null&&a.main_node_id))return;const f=await ue("FlowEdge").find({where:{target:a.main_node_id}}),m=(await ue("FlowNode").find({where:{id:Ha(f.map(v=>v.source))}})).find(v=>v.source_type===ie.LLM);if(!m)return;const y=await ue("LLM").findOne({where:{id:m.source_id}});if(!y)return;a.passphrase&&await yj(a.passphrase,l.current),await s(y.provider,y.name,v=>{r(b=>b&&{...b,llm:y,progress:v.text})}),r({llm:y,status:et.Loaded})}finally{t(!1)}},[a==null?void 0:a.main_node_id,a==null?void 0:a.passphrase,s,l]),p=g.useCallback(async()=>{try{if(t(!0),!(n!=null&&n.llm))return;await s(n.llm.provider,n.llm.name,f=>{r(m=>m&&{...m,progress:f.text})}),r(f=>f&&{...f,status:et.Loaded,progress:""})}finally{t(!1)}},[s,n==null?void 0:n.llm]);return g.useEffect(()=>{a!=null&&a.main_node_id&&d()},[a==null?void 0:a.main_node_id,d]),{loading:e,mainLLMInfo:n,createMessage:u,loadCurrentModel:p}};Ck=function(e,t=""){const n=[];for(const[r,a]of Object.entries(e)){const o=qi(),i=[t,r].filter(Boolean).join("/"),s="file"in a&&"contents"in a.file?a.file:void 0,c={id:o,isSelectable:!0,content:typeof(s==null?void 0:s.contents)=="string"?s.contents:void 0,file:i,name:r,children:[]};"directory"in a&&(c.children=Ck(a.directory,i)),n.push(c)}return n},E0=function(e){const t=e.trim().split(`
`),n={};return t.forEach(r=>{const{file:a,content:o}=JSON.parse(r),i=a.split("/");let s=n;for(let c=0;c<i.length;c++){const l=i[c];c===i.length-1?s[l]={file:{contents:o}}:(s[l]||(s[l]={directory:{}}),s=s[l].directory)}}),n},x0=function(e){const t=[];function n(r,a=[]){for(const[o,i]of Object.entries(r))if("file"in i){const s=[...a,o].join("/");if("contents"in i.file){const c=i.file.contents;t.push(JSON.stringify({file:s,content:c}))}}else"directory"in i&&n(i.directory,[...a,o])}return n(e),t.join(`
`)},O0=function(e,t){return GG(`[UpdateCodeContainerFile] Changes ${t.map(n=>`${n.type||"create_or_update"}:${n.path}`).join(", ")}`),t.forEach(({path:n,content:r,type:a="create_or_update"})=>{const o=n.replace(/^\.\//,"").split("/");let i=e;for(let s=0;s<o.length;s++){const c=o[s];if(s===o.length-1)a==="delete"?c in i&&"file"in i[c]?delete i[c]:console.warn(`Path "${n}" is not a file or does not exist.`):c in i&&"file"in i[c]?i[c].file.contents=r:i[c]={file:{contents:r}};else if(c in i&&"directory"in i[c])i=i[c].directory;else if(a==="delete"){console.warn(`Path "${n}" does not exist.`);break}else i[c]={directory:{}},i=i[c].directory}}),e};const cxe=()=>{const e=Je(i=>i.currentSession),[t,n]=g.useState(),r=g.useCallback(async(i,s)=>{await ue("FlowNode").update(i,{raw:x0(s)})},[]),a=g.useCallback(async i=>{e!=null&&e.main_node_id&&n(s=>{if(!(e!=null&&e.main_node_id))return s;const c=O0(s||{},i);return r(e==null?void 0:e.main_node_id,c),c})},[e==null?void 0:e.main_node_id,r]),o=g.useCallback(async()=>{if(!(e!=null&&e.main_node_id))return;const i=await ue("FlowNode").findOne({where:{id:e==null?void 0:e.main_node_id}});i&&n(i.raw?E0(i.raw):{})},[e==null?void 0:e.main_node_id]);return g.useEffect(()=>{e!=null&&e.main_node_id&&o()},[e==null?void 0:e.main_node_id,o]),{fileSystemTree:t,updateCodeContainerFile:a,updateCodeContainerData:r}},lxe=g.lazy(()=>Ht(()=>import("./index-rmRFhhHt.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([57,1,2,14,21,35,4,58,59,60,3,61]))),uxe=g.memo(()=>{var s,c,l,u;const{loading:e,mainLLMInfo:t,loadCurrentModel:n,createMessage:r}=sxe(),{fileSystemTree:a,updateCodeContainerFile:o}=cxe(),i=g.useCallback((d,p,f)=>r(d,p,f),[r]);return h.jsxs("div",{className:"h-full w-full relative","data-registry":"plate",children:[h.jsx(Tu,{children:h.jsx($a,{children:h.jsxs("div",{className:Z("flex absolute !z-[51] right-1 top-0 max-w-28 h-9 items-center justify-center flex-row"),children:[(t==null?void 0:t.status)===et.Loaded&&((s=t==null?void 0:t.llm)!=null&&s.name)?h.jsx(Pr,{name:(c=t==null?void 0:t.llm)==null?void 0:c.name,className:"w-5 h-5 mr-1"}):void 0,h.jsxs(Fa,{className:"overflow-hidden !text-ellipsis w-full max-w-full max-h-full whitespace-nowrap text-sm",children:[t!=null&&t.progress?t.progress:(t==null?void 0:t.status)===et.Loaded?((l=t==null?void 0:t.llm)==null?void 0:l.name)||"":e?h.jsx(pe,{size:16,name:"loader-circle",className:"animate-spin ml-2"}):void 0,t!=null&&t.llm&&(t==null?void 0:t.status)!==et.Loaded?h.jsx(pe,{size:16,name:"loader-circle",onClick:n,className:"animate-spin ml-2"}):void 0]}),h.jsx(Yr,{children:h.jsx("p",{children:(t==null?void 0:t.progress)||((u=t==null?void 0:t.llm)==null?void 0:u.name)||""})})]})})}),h.jsx(g.Suspense,{fallback:h.jsx(ru,{simple:!0}),children:a!==void 0?h.jsx(lxe,{autoLoad:!0,hideAppName:!0,llm:t==null?void 0:t.llm,fileSystemTree:a,onUpdateFileContent:o,sendMessage:i}):void 0})]})});function dxe(){var t,n;const e=Je(r=>r.currentSession);if(!e)return h.jsx(ru,{simple:!0,className:"w-full h-full"});if(e.main_source_type==="Thread")return h.jsx(nxe,{});if(((t=e.main_node)==null?void 0:t.node_type)==="EDITOR_APP")return h.jsx(ixe,{});if(((n=e.main_node)==null?void 0:n.node_type)==="VSLITE_APP")return h.jsx(uxe,{})}var $y="Menubar",[OE,pxe,fxe]=mf($y),[Nz,S3e]=ur($y,[fxe,fo]),Gn=gh(),Mz=fo(),[hxe,CE]=Nz($y),kz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,value:r,onValueChange:a,defaultValue:o,loop:i=!0,dir:s,...c}=e,l=ai(s),u=Mz(n),[d="",p]=Tn({prop:r,onChange:a,defaultProp:o}),[f,m]=g.useState(null);return h.jsx(hxe,{scope:n,value:d,onMenuOpen:g.useCallback(y=>{p(y),m(y)},[p]),onMenuClose:g.useCallback(()=>p(""),[p]),onMenuToggle:g.useCallback(y=>{p(v=>v?"":y),m(y)},[p]),dir:l,loop:i,children:h.jsx(OE.Provider,{scope:n,children:h.jsx(OE.Slot,{scope:n,children:h.jsx(uu,{asChild:!0,...u,orientation:"horizontal",loop:i,dir:l,currentTabStopId:f,onCurrentTabStopIdChange:m,children:h.jsx(Ae.div,{role:"menubar",...c,ref:t})})})})})});kz.displayName=$y;var NE="MenubarMenu",[mxe,Pz]=Nz(NE),Az=e=>{const{__scopeMenubar:t,value:n,...r}=e,a=Rt(),o=n||a||"LEGACY_REACT_AUTO_VALUE",i=CE(NE,t),s=Gn(t),c=g.useRef(null),l=g.useRef(!1),u=i.value===o;return g.useEffect(()=>{u||(l.current=!1)},[u]),h.jsx(mxe,{scope:t,value:o,triggerId:Rt(),triggerRef:c,contentId:Rt(),wasKeyboardTriggerOpenRef:l,children:h.jsx(TT,{...s,open:u,onOpenChange:d=>{d||i.onMenuClose()},modal:!1,dir:i.dir,...r})})};Az.displayName=NE;var ME="MenubarTrigger",Tz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,disabled:r=!1,...a}=e,o=Mz(n),i=Gn(n),s=CE(ME,n),c=Pz(ME,n),l=g.useRef(null),u=jt(t,l,c.triggerRef),[d,p]=g.useState(!1),f=s.value===c.value;return h.jsx(OE.ItemSlot,{scope:n,value:c.value,disabled:r,children:h.jsx(du,{asChild:!0,...o,focusable:!r,tabStopId:c.value,children:h.jsx(IT,{asChild:!0,...i,children:h.jsx(Ae.button,{type:"button",role:"menuitem",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":f,"aria-controls":f?c.contentId:void 0,"data-highlighted":d?"":void 0,"data-state":f?"open":"closed","data-disabled":r?"":void 0,disabled:r,...a,ref:u,onPointerDown:ge(e.onPointerDown,m=>{!r&&m.button===0&&m.ctrlKey===!1&&(s.onMenuOpen(c.value),f||m.preventDefault())}),onPointerEnter:ge(e.onPointerEnter,()=>{var m;s.value&&!f&&(s.onMenuOpen(c.value),(m=l.current)==null||m.focus())}),onKeyDown:ge(e.onKeyDown,m=>{r||(["Enter"," "].includes(m.key)&&s.onMenuToggle(c.value),m.key==="ArrowDown"&&s.onMenuOpen(c.value),["Enter"," ","ArrowDown"].includes(m.key)&&(c.wasKeyboardTriggerOpenRef.current=!0,m.preventDefault()))}),onFocus:ge(e.onFocus,()=>p(!0)),onBlur:ge(e.onBlur,()=>p(!1))})})})})});Tz.displayName=ME;var yxe="MenubarPortal",Iz=e=>{const{__scopeMenubar:t,...n}=e,r=Gn(t);return h.jsx(RT,{...r,...n})};Iz.displayName=yxe;var kE="MenubarContent",Rz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,align:r="start",...a}=e,o=Gn(n),i=CE(kE,n),s=Pz(kE,n),c=pxe(n),l=g.useRef(!1);return h.jsx(DT,{id:s.contentId,"aria-labelledby":s.triggerId,"data-radix-menubar-content":"",...o,...a,ref:t,align:r,onCloseAutoFocus:ge(e.onCloseAutoFocus,u=>{var d;!i.value&&!l.current&&((d=s.triggerRef.current)==null||d.focus()),l.current=!1,u.preventDefault()}),onFocusOutside:ge(e.onFocusOutside,u=>{const d=u.target;c().some(p=>{var f;return(f=p.ref.current)==null?void 0:f.contains(d)})&&u.preventDefault()}),onInteractOutside:ge(e.onInteractOutside,()=>{l.current=!0}),onEntryFocus:u=>{s.wasKeyboardTriggerOpenRef.current||u.preventDefault()},onKeyDown:ge(e.onKeyDown,u=>{if(["ArrowRight","ArrowLeft"].includes(u.key)){const d=u.target,p=d.hasAttribute("data-radix-menubar-subtrigger"),f=d.closest("[data-radix-menubar-content]")!==u.currentTarget,m=(i.dir==="rtl"?"ArrowRight":"ArrowLeft")===u.key;if(!m&&p||f&&m)return;let y=c().filter(w=>!w.disabled).map(w=>w.value);m&&y.reverse();const v=y.indexOf(s.value);y=i.loop?Pxe(y,v+1):y.slice(v+1);const[b]=y;b&&i.onMenuOpen(b)}},{checkForDefaultPrevented:!1}),style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});Rz.displayName=kE;var gxe="MenubarGroup",vxe=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(LT,{...a,...r,ref:t})});vxe.displayName=gxe;var bxe="MenubarLabel",Dz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx($T,{...a,...r,ref:t})});Dz.displayName=bxe;var wxe="MenubarItem",Lz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(FT,{...a,...r,ref:t})});Lz.displayName=wxe;var xxe="MenubarCheckboxItem",$z=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(BT,{...a,...r,ref:t})});$z.displayName=xxe;var _xe="MenubarRadioGroup",jxe=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(zT,{...a,...r,ref:t})});jxe.displayName=_xe;var Sxe="MenubarRadioItem",Fz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(UT,{...a,...r,ref:t})});Fz.displayName=Sxe;var Exe="MenubarItemIndicator",Bz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(VT,{...a,...r,ref:t})});Bz.displayName=Exe;var Oxe="MenubarSeparator",zz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(qT,{...a,...r,ref:t})});zz.displayName=Oxe;var Cxe="MenubarArrow",Nxe=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(WT,{...a,...r,ref:t})});Nxe.displayName=Cxe;var Mxe="MenubarSubTrigger",Uz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(HT,{"data-radix-menubar-subtrigger":"",...a,...r,ref:t})});Uz.displayName=Mxe;var kxe="MenubarSubContent",Vz=g.forwardRef((e,t)=>{const{__scopeMenubar:n,...r}=e,a=Gn(n);return h.jsx(KT,{...a,"data-radix-menubar-content":"",...r,ref:t,style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});Vz.displayName=kxe;function Pxe(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var qz=kz,Axe=Az,Wz=Tz,Txe=Iz,Hz=Rz,Kz=Dz,Zz=Lz,Gz=$z,Xz=Fz,Jz=Bz,Yz=zz,Qz=Uz,e7=Vz;const PE=Axe,t7=g.forwardRef(({className:e,...t},n)=>h.jsx(qz,{ref:n,className:Z("flex h-10 items-center space-x-1 rounded-md border bg-background p-1",e),...t}));t7.displayName=qz.displayName;const AE=g.forwardRef(({className:e,...t},n)=>h.jsx(Wz,{ref:n,className:Z("flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...t}));AE.displayName=Wz.displayName;const Ixe=g.forwardRef(({className:e,inset:t,children:n,...r},a)=>h.jsxs(Qz,{ref:a,className:Z("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...r,children:[n,h.jsx(pe,{name:"chevron-right",className:"ml-auto h-4 w-4"})]}));Ixe.displayName=Qz.displayName;const Rxe=g.forwardRef(({className:e,...t},n)=>h.jsx(e7,{ref:n,className:Z("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));Rxe.displayName=e7.displayName;const n7=g.forwardRef(({className:e,align:t="start",alignOffset:n=-4,sideOffset:r=8,...a},o)=>h.jsx(Txe,{children:h.jsx(Hz,{ref:o,align:t,alignOffset:n,sideOffset:r,className:Z("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));n7.displayName=Hz.displayName;const r7=g.forwardRef(({className:e,inset:t,...n},r)=>h.jsx(Zz,{ref:r,className:Z("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...n}));r7.displayName=Zz.displayName;const Dxe=g.forwardRef(({className:e,children:t,checked:n,...r},a)=>h.jsxs(Gz,{ref:a,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...r,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(Jz,{children:h.jsx(pe,{name:"check",className:"h-4 w-4"})})}),t]}));Dxe.displayName=Gz.displayName;const Lxe=g.forwardRef(({className:e,children:t,...n},r)=>h.jsxs(Xz,{ref:r,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(Jz,{children:h.jsx(pe,{name:"circle",className:"h-2 w-2 fill-current"})})}),t]}));Lxe.displayName=Xz.displayName;const $xe=g.forwardRef(({className:e,inset:t,...n},r)=>h.jsx(Kz,{ref:r,className:Z("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));$xe.displayName=Kz.displayName;const Fxe=g.forwardRef(({className:e,...t},n)=>h.jsx(Yz,{ref:n,className:Z("-mx-1 my-1 h-px bg-muted",e),...t}));Fxe.displayName=Yz.displayName;let a7;Ie=QDe()(e3e(t3e((e,t)=>({...c6,...kpe(e,t)})))),a7=()=>{const e=Je(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,n]=g.useState(!1),r=Ie(i=>i.pushSyncNodeQueue),a=Ie(i=>i.createOrUpdateFlowNode),o=g.useCallback(async(i,s)=>{try{if(!e)throw new Error("Session not found");if(!s.provider||!s.name)throw new Error("Provider and name are required");n(!0);const c=await ue("LLM").findOne({where:{name:s.name,session_id:e}});return c?(r("LLM",{where:{source_type:"LLM",source_id:c.id}}),c):ue("LLM").save({name:`${s.name}`,status:s.provider===We.WebLLM?et.Started:et.Loaded,session_id:e,provider:s.provider,metadata:JSON.stringify(s.metadata||{}),model_type:s.model_type||vu.LLM,parameters:s.parameters||void 0,encrypted:s.encrypted||void 0,...s}).then(async l=>{var u,d,p;return await a({source_id:l.id,source_type:"LLM",node_type:ie.LLM,x:(u=i.position)==null?void 0:u.x,y:((d=i.position)==null?void 0:d.y)+(((p=i.measured)==null?void 0:p.height)||0)+30}),l})}finally{n(!1)}},[a,r,e]);return{loading:t,createLLM:o}};var o7=1,Bxe=.9,zxe=.8,Uxe=.17,TE=.1,IE=.999,Vxe=.9999,qxe=.99,Wxe=/[\\\/_+.#"@\[\(\{&]/,Hxe=/[\\\/_+.#"@\[\(\{&]/g,Kxe=/[\s-]/,i7=/[\s-]/g;function RE(e,t,n,r,a,o,i){if(o===t.length)return a===e.length?o7:qxe;var s=`${a},${o}`;if(i[s]!==void 0)return i[s];for(var c=r.charAt(o),l=n.indexOf(c,a),u=0,d,p,f,m;l>=0;)d=RE(e,t,n,r,l+1,o+1,i),d>u&&(l===a?d*=o7:Wxe.test(e.charAt(l-1))?(d*=zxe,f=e.slice(a,l-1).match(Hxe),f&&a>0&&(d*=Math.pow(IE,f.length))):Kxe.test(e.charAt(l-1))?(d*=Bxe,m=e.slice(a,l-1).match(i7),m&&a>0&&(d*=Math.pow(IE,m.length))):(d*=Uxe,a>0&&(d*=Math.pow(IE,l-a))),e.charAt(l)!==t.charAt(o)&&(d*=Vxe)),(d<TE&&n.charAt(l-1)===r.charAt(o+1)||r.charAt(o+1)===r.charAt(o)&&n.charAt(l-1)!==r.charAt(o))&&(p=RE(e,t,n,r,l+1,o+2,i),p*TE>d&&(d=p*TE)),d>u&&(u=d),l=n.indexOf(c,l+1);return i[s]=u,u}function s7(e){return e.toLowerCase().replace(i7," ")}function Zxe(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,RE(e,t,s7(e),s7(t),0,0,{})}var cp='[cmdk-group=""]',DE='[cmdk-group-items=""]',Gxe='[cmdk-group-heading=""]',LE='[cmdk-item=""]',c7=`${LE}:not([aria-disabled="true"])`,$E="cmdk-item-select",Ss="data-value",Xxe=(e,t,n)=>Zxe(e,t,n),l7=g.createContext(void 0),lp=()=>g.useContext(l7),u7=g.createContext(void 0),FE=()=>g.useContext(u7),d7=g.createContext(void 0),p7=g.forwardRef((e,t)=>{let n=dl(()=>{var $,U;return{search:"",value:(U=($=e.value)!=null?$:e.defaultValue)!=null?U:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=dl(()=>new Set),a=dl(()=>new Map),o=dl(()=>new Map),i=dl(()=>new Set),s=f7(e),{label:c,children:l,value:u,onValueChange:d,filter:p,shouldFilter:f,loop:m,disablePointerSelection:y=!1,vimBindings:v=!0,...b}=e,w=Rt(),j=Rt(),x=Rt(),_=g.useRef(null),S=s1e();Es(()=>{if(u!==void 0){let $=u.trim();n.current.value=$,E.emit()}},[u]),Es(()=>{S(6,A)},[]);let E=g.useMemo(()=>({subscribe:$=>(i.current.add($),()=>i.current.delete($)),snapshot:()=>n.current,setState:($,U,F)=>{var H,re,ee;if(!Object.is(n.current[$],U)){if(n.current[$]=U,$==="search")P(),M(),S(1,k);else if($==="value"&&(F||S(5,A),((H=s.current)==null?void 0:H.value)!==void 0)){let G=U??"";(ee=(re=s.current).onValueChange)==null||ee.call(re,G);return}E.emit()}},emit:()=>{i.current.forEach($=>$())}}),[]),O=g.useMemo(()=>({value:($,U,F)=>{var H;U!==((H=o.current.get($))==null?void 0:H.value)&&(o.current.set($,{value:U,keywords:F}),n.current.filtered.items.set($,N(U,F)),S(2,()=>{M(),E.emit()}))},item:($,U)=>(r.current.add($),U&&(a.current.has(U)?a.current.get(U).add($):a.current.set(U,new Set([$]))),S(3,()=>{P(),M(),n.current.value||k(),E.emit()}),()=>{o.current.delete($),r.current.delete($),n.current.filtered.items.delete($);let F=C();S(4,()=>{P(),(F==null?void 0:F.getAttribute("id"))===$&&k(),E.emit()})}),group:$=>(a.current.has($)||a.current.set($,new Set),()=>{o.current.delete($),a.current.delete($)}),filter:()=>s.current.shouldFilter,label:c||e["aria-label"],getDisablePointerSelection:()=>s.current.disablePointerSelection,listId:w,inputId:x,labelId:j,listInnerRef:_}),[]);function N($,U){var F,H;let re=(H=(F=s.current)==null?void 0:F.filter)!=null?H:Xxe;return $?re($,n.current.search,U):0}function M(){if(!n.current.search||s.current.shouldFilter===!1)return;let $=n.current.filtered.items,U=[];n.current.filtered.groups.forEach(H=>{let re=a.current.get(H),ee=0;re.forEach(G=>{let K=$.get(G);ee=Math.max(K,ee)}),U.push([H,ee])});let F=_.current;I().sort((H,re)=>{var ee,G;let K=H.getAttribute("id"),X=re.getAttribute("id");return((ee=$.get(X))!=null?ee:0)-((G=$.get(K))!=null?G:0)}).forEach(H=>{let re=H.closest(DE);re?re.appendChild(H.parentElement===re?H:H.closest(`${DE} > *`)):F.appendChild(H.parentElement===F?H:H.closest(`${DE} > *`))}),U.sort((H,re)=>re[1]-H[1]).forEach(H=>{var re;let ee=(re=_.current)==null?void 0:re.querySelector(`${cp}[${Ss}="${encodeURIComponent(H[0])}"]`);ee==null||ee.parentElement.appendChild(ee)})}function k(){let $=I().find(F=>F.getAttribute("aria-disabled")!=="true"),U=$==null?void 0:$.getAttribute(Ss);E.setState("value",U||void 0)}function P(){var $,U,F,H;if(!n.current.search||s.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let re=0;for(let ee of r.current){let G=(U=($=o.current.get(ee))==null?void 0:$.value)!=null?U:"",K=(H=(F=o.current.get(ee))==null?void 0:F.keywords)!=null?H:[],X=N(G,K);n.current.filtered.items.set(ee,X),X>0&&re++}for(let[ee,G]of a.current)for(let K of G)if(n.current.filtered.items.get(K)>0){n.current.filtered.groups.add(ee);break}n.current.filtered.count=re}function A(){var $,U,F;let H=C();H&&((($=H.parentElement)==null?void 0:$.firstChild)===H&&((F=(U=H.closest(cp))==null?void 0:U.querySelector(Gxe))==null||F.scrollIntoView({block:"nearest"})),H.scrollIntoView({block:"nearest"}))}function C(){var $;return($=_.current)==null?void 0:$.querySelector(`${LE}[aria-selected="true"]`)}function I(){var $;return Array.from((($=_.current)==null?void 0:$.querySelectorAll(c7))||[])}function T($){let U=I()[$];U&&E.setState("value",U.getAttribute(Ss))}function R($){var U;let F=C(),H=I(),re=H.findIndex(G=>G===F),ee=H[re+$];(U=s.current)!=null&&U.loop&&(ee=re+$<0?H[H.length-1]:re+$===H.length?H[0]:H[re+$]),ee&&E.setState("value",ee.getAttribute(Ss))}function L($){let U=C(),F=U==null?void 0:U.closest(cp),H;for(;F&&!H;)F=$>0?o1e(F,cp):i1e(F,cp),H=F==null?void 0:F.querySelector(c7);H?E.setState("value",H.getAttribute(Ss)):R($)}let D=()=>T(I().length-1),z=$=>{$.preventDefault(),$.metaKey?D():$.altKey?L(1):R(1)},B=$=>{$.preventDefault(),$.metaKey?T(0):$.altKey?L(-1):R(-1)};return g.createElement(Ae.div,{ref:t,tabIndex:-1,...b,"cmdk-root":"",onKeyDown:$=>{var U;if((U=b.onKeyDown)==null||U.call(b,$),!$.defaultPrevented)switch($.key){case"n":case"j":{v&&$.ctrlKey&&z($);break}case"ArrowDown":{z($);break}case"p":case"k":{v&&$.ctrlKey&&B($);break}case"ArrowUp":{B($);break}case"Home":{$.preventDefault(),T(0);break}case"End":{$.preventDefault(),D();break}case"Enter":if(!$.nativeEvent.isComposing&&$.keyCode!==229){$.preventDefault();let F=C();if(F){let H=new Event($E);F.dispatchEvent(H)}}}}},g.createElement("label",{"cmdk-label":"",htmlFor:O.inputId,id:O.labelId,style:l1e},c),Fy(e,$=>g.createElement(u7.Provider,{value:E},g.createElement(l7.Provider,{value:O},$))))}),Jxe=g.forwardRef((e,t)=>{var n,r;let a=Rt(),o=g.useRef(null),i=g.useContext(d7),s=lp(),c=f7(e),l=(r=(n=c.current)==null?void 0:n.forceMount)!=null?r:i==null?void 0:i.forceMount;Es(()=>{if(!l)return s.item(a,i==null?void 0:i.id)},[l]);let u=h7(a,o,[e.value,e.children,o],e.keywords),d=FE(),p=Os(S=>S.value&&S.value===u.current),f=Os(S=>l||s.filter()===!1?!0:S.search?S.filtered.items.get(a)>0:!0);g.useEffect(()=>{let S=o.current;if(!(!S||e.disabled))return S.addEventListener($E,m),()=>S.removeEventListener($E,m)},[f,e.onSelect,e.disabled]);function m(){var S,E;y(),(E=(S=c.current).onSelect)==null||E.call(S,u.current)}function y(){d.setState("value",u.current,!0)}if(!f)return null;let{disabled:v,value:b,onSelect:w,forceMount:j,keywords:x,..._}=e;return g.createElement(Ae.div,{ref:up([o,t]),..._,id:a,"cmdk-item":"",role:"option","aria-disabled":!!v,"aria-selected":!!p,"data-disabled":!!v,"data-selected":!!p,onPointerMove:v||s.getDisablePointerSelection()?void 0:y,onClick:v?void 0:m},e.children)}),Yxe=g.forwardRef((e,t)=>{let{heading:n,children:r,forceMount:a,...o}=e,i=Rt(),s=g.useRef(null),c=g.useRef(null),l=Rt(),u=lp(),d=Os(f=>a||u.filter()===!1?!0:f.search?f.filtered.groups.has(i):!0);Es(()=>u.group(i),[]),h7(i,s,[e.value,e.heading,c]);let p=g.useMemo(()=>({id:i,forceMount:a}),[a]);return g.createElement(Ae.div,{ref:up([s,t]),...o,"cmdk-group":"",role:"presentation",hidden:d?void 0:!0},n&&g.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:l},n),Fy(e,f=>g.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?l:void 0},g.createElement(d7.Provider,{value:p},f))))}),Qxe=g.forwardRef((e,t)=>{let{alwaysRender:n,...r}=e,a=g.useRef(null),o=Os(i=>!i.search);return!n&&!o?null:g.createElement(Ae.div,{ref:up([a,t]),...r,"cmdk-separator":"",role:"separator"})}),e1e=g.forwardRef((e,t)=>{let{onValueChange:n,...r}=e,a=e.value!=null,o=FE(),i=Os(u=>u.search),s=Os(u=>u.value),c=lp(),l=g.useMemo(()=>{var u;let d=(u=c.listInnerRef.current)==null?void 0:u.querySelector(`${LE}[${Ss}="${encodeURIComponent(s)}"]`);return d==null?void 0:d.getAttribute("id")},[]);return g.useEffect(()=>{e.value!=null&&o.setState("search",e.value)},[e.value]),g.createElement(Ae.input,{ref:t,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":l,id:c.inputId,type:"text",value:a?e.value:i,onChange:u=>{a||o.setState("search",u.target.value),n==null||n(u.target.value)}})}),t1e=g.forwardRef((e,t)=>{let{children:n,label:r="Suggestions",...a}=e,o=g.useRef(null),i=g.useRef(null),s=lp();return g.useEffect(()=>{if(i.current&&o.current){let c=i.current,l=o.current,u,d=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let p=c.offsetHeight;l.style.setProperty("--cmdk-list-height",p.toFixed(1)+"px")})});return d.observe(c),()=>{cancelAnimationFrame(u),d.unobserve(c)}}},[]),g.createElement(Ae.div,{ref:up([o,t]),...a,"cmdk-list":"",role:"listbox","aria-label":r,id:s.listId},Fy(e,c=>g.createElement("div",{ref:up([i,s.listInnerRef]),"cmdk-list-sizer":""},c)))}),n1e=g.forwardRef((e,t)=>{let{open:n,onOpenChange:r,overlayClassName:a,contentClassName:o,container:i,...s}=e;return g.createElement(ou,{open:n,onOpenChange:r},g.createElement(cu,{container:i},g.createElement(Zi,{"cmdk-overlay":"",className:a}),g.createElement(Gi,{"aria-label":e.label,"cmdk-dialog":"",className:o},g.createElement(p7,{ref:t,...s}))))}),r1e=g.forwardRef((e,t)=>Os(n=>n.filtered.count===0)?g.createElement(Ae.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),a1e=g.forwardRef((e,t)=>{let{progress:n,children:r,label:a="Loading...",...o}=e;return g.createElement(Ae.div,{ref:t,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},Fy(e,i=>g.createElement("div",{"aria-hidden":!0},i)))}),or=Object.assign(p7,{List:t1e,Item:Jxe,Input:e1e,Group:Yxe,Separator:Qxe,Dialog:n1e,Empty:r1e,Loading:a1e});function o1e(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function i1e(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function f7(e){let t=g.useRef(e);return Es(()=>{t.current=e}),t}var Es=typeof window>"u"?g.useEffect:g.useLayoutEffect;function dl(e){let t=g.useRef();return t.current===void 0&&(t.current=e()),t}function up(e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}function Os(e){let t=FE(),n=()=>e(t.snapshot());return xf.useSyncExternalStore(t.subscribe,n,n)}function h7(e,t,n,r=[]){let a=g.useRef(),o=lp();return Es(()=>{var i;let s=(()=>{var l;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(l=u.current.textContent)==null?void 0:l.trim():a.current}})(),c=r.map(l=>l.trim());o.value(e,s,c),(i=t.current)==null||i.setAttribute(Ss,s),a.current=s}),a}var s1e=()=>{let[e,t]=g.useState(),n=dl(()=>new Map);return Es(()=>{n.current.forEach(r=>r()),n.current=new Map},[e]),(r,a)=>{n.current.set(r,a),t({})}};function c1e(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function Fy({asChild:e,children:t},n){return e&&g.isValidElement(t)?g.cloneElement(c1e(t),{ref:t.ref},n(t.props.children)):n(t)}var l1e={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const m7=g.forwardRef(({className:e,...t},n)=>h.jsx(or,{ref:n,className:Z("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));m7.displayName=or.displayName;const y7=g.forwardRef(({className:e,...t},n)=>h.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[h.jsx(pe,{name:"search",className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),h.jsx(or.Input,{ref:n,className:Z("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));y7.displayName=or.Input.displayName;const g7=g.forwardRef(({className:e,...t},n)=>h.jsx(or.List,{ref:n,className:Z("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t}));g7.displayName=or.List.displayName;const v7=g.forwardRef((e,t)=>h.jsx(or.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));v7.displayName=or.Empty.displayName;const b7=g.forwardRef(({className:e,...t},n)=>h.jsx(or.Group,{ref:n,className:Z("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));b7.displayName=or.Group.displayName;const u1e=g.forwardRef(({className:e,...t},n)=>h.jsx(or.Separator,{ref:n,className:Z("-mx-1 h-px bg-border",e),...t}));u1e.displayName=or.Separator.displayName;const dp=g.forwardRef(({className:e,...t},n)=>h.jsx(or.Item,{ref:n,className:Z("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...t}));dp.displayName=or.Item.displayName;const d1e=lo("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ar=g.forwardRef(({className:e,variant:t,...n},r)=>h.jsx("div",{ref:r,role:"alert",className:Z(d1e({variant:t}),e),...n}));Ar.displayName="Alert";const Uo=g.forwardRef(({className:e,...t},n)=>h.jsx("h5",{ref:n,className:Z("mb-1 font-medium leading-none tracking-tight",e),...t}));Uo.displayName="AlertTitle";const pl=g.forwardRef(({className:e,...t},n)=>h.jsx("div",{ref:n,className:Z("text-sm [&_p]:leading-relaxed",e),...t}));pl.displayName="AlertDescription";var BE="Checkbox",[p1e,E3e]=ur(BE),[f1e,h1e]=p1e(BE),w7=g.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:r,checked:a,defaultChecked:o,required:i,disabled:s,value:c="on",onCheckedChange:l,form:u,...d}=e,[p,f]=g.useState(null),m=jt(t,x=>f(x)),y=g.useRef(!1),v=p?u||!!p.closest("form"):!0,[b=!1,w]=Tn({prop:a,defaultProp:o,onChange:l}),j=g.useRef(b);return g.useEffect(()=>{const x=p==null?void 0:p.form;if(x){const _=()=>w(j.current);return x.addEventListener("reset",_),()=>x.removeEventListener("reset",_)}},[p,w]),h.jsxs(f1e,{scope:n,state:b,disabled:s,children:[h.jsx(Ae.button,{type:"button",role:"checkbox","aria-checked":Ai(b)?"mixed":b,"aria-required":i,"data-state":j7(b),"data-disabled":s?"":void 0,disabled:s,value:c,...d,ref:m,onKeyDown:ge(e.onKeyDown,x=>{x.key==="Enter"&&x.preventDefault()}),onClick:ge(e.onClick,x=>{w(_=>Ai(_)?!0:!_),v&&(y.current=x.isPropagationStopped(),y.current||x.stopPropagation())})}),v&&h.jsx(m1e,{control:p,bubbles:!y.current,name:r,value:c,checked:b,required:i,disabled:s,form:u,style:{transform:"translateX(-100%)"},defaultChecked:Ai(o)?!1:o})]})});w7.displayName=BE;var x7="CheckboxIndicator",_7=g.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:r,...a}=e,o=h1e(x7,n);return h.jsx(zr,{present:r||Ai(o.state)||o.state===!0,children:h.jsx(Ae.span,{"data-state":j7(o.state),"data-disabled":o.disabled?"":void 0,...a,ref:t,style:{pointerEvents:"none",...e.style}})})});_7.displayName=x7;var m1e=e=>{const{control:t,checked:n,bubbles:r=!0,defaultChecked:a,...o}=e,i=g.useRef(null),s=YF(n),c=_f(t);g.useEffect(()=>{const u=i.current,d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"checked").set;if(s!==n&&p){const f=new Event("click",{bubbles:r});u.indeterminate=Ai(n),p.call(u,Ai(n)?!1:n),u.dispatchEvent(f)}},[s,n,r]);const l=g.useRef(Ai(n)?!1:n);return h.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a??l.current,...o,tabIndex:-1,ref:i,style:{...e.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Ai(e){return e==="indeterminate"}function j7(e){return Ai(e)?"indeterminate":e?"checked":"unchecked"}zv=w7,pk=_7;const zE=g.forwardRef(({className:e,...t},n)=>h.jsx(zv,{ref:n,className:Z("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:h.jsx(pk,{className:Z("flex items-center justify-center text-current"),children:h.jsx(pe,{name:"check",className:"h-4 w-4"})})}));zE.displayName=zv.displayName;const y1e=["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo"],g1e=["deepseek-r1-distill-llama-70b","llama-3.2-90b-vision-preview","llama-3.3-70b-versatile","llama-3.3-70b-specdec","llama3-70b-8192","gemma2-9b-it","llama3-8b-8192","mixtral-8x7b-32768"],v1e=["llama-3.2-90b-vision-preview"],b1e=["gemini-2.0-flash-exp","gemini-1.5-flash","gemini-1.5-pro","gemini-1.5-flash-8b"],S7="https://aistudio.google.com/app/apikey",By="https://platform.openai.com/api-keys",zy="https://console.groq.com/keys",w1e=[We.WebLLM,We.OpenAI,We.GoogleGenerativeAI,We.Groq],x1e=uo(({onConfirm:e,onCancel:t})=>{const n=tn(),{t:r}=ke("dialogs"),[a,o]=g.useState(""),i=l=>{o(l)},s=async()=>{try{if((a==null?void 0:a.length)!==6)return;await(e==null?void 0:e(a)),o(""),n.resolve(!0),n.hide()}catch(l){n.reject(l)}},c=()=>{t==null||t(),o(""),n.resolve(!1),n.hide()};return h.jsx(fi,{open:n.visible,onOpenChange:c,children:h.jsxs(xo,{className:"w-[330px]",children:[h.jsxs(_o,{children:[h.jsx(jo,{children:r("create_session_passkey.title")}),h.jsx($u,{children:r("create_session_passkey.description")})]}),h.jsx("div",{className:"py-4",children:h.jsxs(dj,{onChange:i,maxLength:6,children:[h.jsxs(Md,{children:[h.jsx(wr,{index:0,hidden:!0}),h.jsx(wr,{index:1,hidden:!0}),h.jsx(wr,{index:2,hidden:!0})]}),h.jsx(pj,{}),h.jsxs(Md,{children:[h.jsx(wr,{index:3,hidden:!0}),h.jsx(wr,{index:4,hidden:!0}),h.jsx(wr,{index:5,hidden:!0})]})]})}),h.jsx(Lu,{children:h.jsx(Ye,{disabled:(a==null?void 0:a.length)!==6,onClick:s,type:"submit",children:r("create_session_passkey.confirm")})})]})})}),_1e=()=>{const[e,t]=g.useState(!1),n=Je(o=>o.currentSession),r=Je(o=>o.setCurrentSession),a=g.useCallback(async o=>{if(!(!n||!o))try{t(!0);const i=await Wpe(),s=await mj(i,o);await ue("Session").update(n.id,{passphrase:s});const c=await ue("Session").findOne({where:{id:n.id}});return c&&r(c),{passphrase:i,encrypted:s}}finally{t(!1)}},[n,r]);return{loading:e,updateSessionPassphrase:a}},E7=()=>{const e=Je(a=>a.currentSession),{modalRef:t}=Pd(x1e),{updateSessionPassphrase:n}=_1e(),{confirmPassphrase:r}=AS();return{confirmOrCreatePassphrase:g.useCallback(async()=>{if(e!=null&&e.passphrase)await r();else{let a="";if(await t.current.show({onConfirm:async i=>{a=i}}),!a)throw new Error("Passphrase is required");const o=await n(a);if(!o)throw new Error("Failed to update session passphrase");await Wi.set("passphrase",o.passphrase)}return Wi.get("passphrase")},[r,t,e==null?void 0:e.passphrase,n])}};function j1e(e){var $,U;const{id:t,setDialog:n}=e,{t:r}=ke("components"),{toast:a}=nn(),o=In(t),[i,s]=g.useState(!1),[c,l]=g.useState(""),[u,d]=g.useState(!1),[p,f]=g.useState(""),[m,y]=g.useState(),[v,b]=g.useState(We.WebLLM),[w,j]=g.useState(!1),[x,_]=g.useState(),S=Je(F=>F.currentSession),E=co(F=>F.syncCachedLLMURLs),O=co(F=>F.cachedLLMURLs),{loading:N,createLLM:M}=a7(),{confirmOrCreatePassphrase:k}=E7();g.useEffect(()=>{Ht(()=>import("./index-C7uio77f.js").then(async F=>(await F.__tla,F)),__vite__mapDeps([9,1,2,3,4])).then(async({functionCallingModelIds:F,prebuiltAppConfig:H})=>{const re=H.model_list;_({modelList:re,functionCallingModelIds:F})})},[]),g.useEffect(()=>{E()},[E]);const P=g.useMemo(()=>c?v!==We.WebLLM:!1,[c,v]),A=g.useMemo(()=>!(x!=null&&x.functionCallingModelIds)||!(x!=null&&x.modelList)?[]:((p?x==null?void 0:x.modelList.filter(F=>F.model_id.toLowerCase().includes(p.toLowerCase())):x==null?void 0:x.modelList)||[]).sort((F,H)=>{const re=O.some(V=>V.includes(F.model_id)),ee=O.some(V=>V.includes(H.model_id));if(re&&!ee)return-1;if(!re&&ee)return 1;const G=JS.includes(F.model_id),K=JS.includes(H.model_id);if(G&&!K)return-1;if(!G&&K)return 1;const X=x==null?void 0:x.functionCallingModelIds.includes(F.model_id),ne=x==null?void 0:x.functionCallingModelIds.includes(H.model_id);return X&&!ne?-1:!X&&ne?1:F.vram_required_MB&&H.vram_required_MB&&F.vram_required_MB!==H.vram_required_MB?F.vram_required_MB-H.vram_required_MB:F.model_id.localeCompare(H.model_id)}),[x==null?void 0:x.modelList,x==null?void 0:x.functionCallingModelIds,p,O]),C=g.useMemo(()=>{if(c)switch(v){case We.WebLLM:return(x==null?void 0:x.modelList)&&A.find(F=>F.model_id===c);case We.Groq:return y({}),{model:c,model_id:c,model_type:v1e.includes(c)?2:0,overrides:{}};case We.OpenAI:return y({}),{model:c,model_id:c,model_type:2,overrides:{}};case We.GoogleGenerativeAI:return y({}),{model:c,model_id:c,model_type:2,overrides:{}}}},[c,x==null?void 0:x.modelList,A,v]);g.useEffect(()=>{!(C!=null&&C.model_id)||!O||j(O.some(F=>F.includes(C.model_id)))},[O,C==null?void 0:C.model_id]),g.useEffect(()=>{S!=null&&S.id&&(b(We.WebLLM),l(""),f(""),y({}))},[S==null?void 0:S.id]);const I=g.useCallback(F=>{l(F),d(!1)},[]),T=g.useCallback(F=>{f(F)},[]),R=g.useCallback(F=>{b(F),l(""),f(""),y({})},[]),L=async()=>{var F;if(!(!o||!S))try{s(!0);let H;if(P){const re=await k();if(!re)throw new Error("Passphrase is not found");H=await Zpe(m||{},re)}await M(o,{name:c,model_type:D(C==null?void 0:C.model_type),function_calling:C!=null&&C.model_id?(F=x==null?void 0:x.functionCallingModelIds)==null?void 0:F.includes(C==null?void 0:C.model_id):!1,encrypted:H,provider:v}),n==null||n(!1)}catch(H){Ws(H),a({variant:"destructive",description:r("add_llm_card.errors.failed_to_create")})}finally{s(!1),b(We.WebLLM),y({}),l(""),f("")}},D=g.useCallback(F=>F===1?vu.embedding:F===2?vu.VLM:vu.LLM,[]),z=g.useMemo(()=>{switch(v){case We.WebLLM:return A.map(F=>{var H;return h.jsxs(dp,{value:F.model_id,onSelect:I,children:[c===F.model_id?h.jsx(pe,{name:"check",className:"mr-2 h-4 w-4"}):h.jsx("div",{className:"mr-2 h-4 w-4"}),h.jsxs("span",{className:"max-w-md",children:[h.jsxs("div",{className:"flex gap-2 mb-2",children:[h.jsx(Pr,{name:F.model_id}),F.model_id]}),h.jsx("div",{className:"flex max-w-full flex-wrap gap-1",children:h.jsx(op,{model:F,isFunctionCalling:((H=x==null?void 0:x.functionCallingModelIds)==null?void 0:H.includes(F.model_id))||!1,name:F.model_id,isCached:O.some(re=>re.includes(F.model_id))||!1,cloud:v!==We.WebLLM})})]})]},F.model_id)});case We.OpenAI:return y1e.map(F=>h.jsxs(dp,{value:F,onSelect:I,children:[c===F?h.jsx(pe,{name:"check",className:"h-4 w-4"}):h.jsx("div",{className:"w-4"}),h.jsx("span",{className:"max-w-md",children:h.jsxs("div",{className:"flex gap-3",children:[h.jsx(Pr,{name:F}),F]})})]},F));case We.GoogleGenerativeAI:return b1e.map(F=>h.jsxs(dp,{value:F,onSelect:I,children:[c===F?h.jsx(pe,{name:"check",className:"h-4 w-4"}):h.jsx("div",{className:"w-4"}),h.jsx("span",{className:"max-w-md",children:h.jsxs("div",{className:"flex gap-3",children:[h.jsx(Pr,{name:F}),F]})})]},F));case We.Groq:return g1e.map(F=>h.jsxs(dp,{value:F,onSelect:I,children:[c===F?h.jsx(pe,{name:"check",className:"h-4 w-4"}):h.jsx("div",{className:"w-4"}),h.jsx("span",{className:"max-w-md",children:h.jsxs("div",{className:"flex gap-3",children:[h.jsx(Pr,{name:F}),F]})})]},F))}},[O,I,c,x==null?void 0:x.functionCallingModelIds,A,v]),B=g.useMemo(()=>{if(P)switch(v){case We.Groq:case We.OpenAI:return h.jsxs(h.Fragment,{children:[h.jsx(Ar,{variant:"destructive",className:"mt-4",children:r("add_llm_card.alert.session_passkey")}),h.jsxs("div",{className:"mt-4",children:[h.jsx(Be,{children:r("add_llm_card.encrypted_fields.api_key")}),h.jsx(Ye,{variant:"link",className:"px-1",children:h.jsxs("a",{href:v===We.OpenAI?By:zy,target:"_blank",rel:"noreferrer",children:["(",v===We.OpenAI?By:zy,")"]})}),h.jsx(Kt,{type:"password",value:(m==null?void 0:m.key)||"",onChange:F=>y(H=>({...H,key:F.target.value}))})]})]});case We.GoogleGenerativeAI:return h.jsxs(h.Fragment,{children:[h.jsx(Ar,{variant:"destructive",className:"mt-4",children:r("add_llm_card.alert.session_passkey")}),h.jsxs("div",{className:"mt-4",children:[h.jsx(Be,{children:r("add_llm_card.encrypted_fields.api_key")}),h.jsx(Ye,{variant:"link",className:"px-1",children:h.jsxs("a",{href:S7,target:"_blank",rel:"noreferrer",children:["(",S7,")"]})}),h.jsx(Kt,{type:"password",value:(m==null?void 0:m.key)||"",onChange:F=>y(H=>({...H,key:F.target.value}))})]}),h.jsxs("div",{className:"mt-4 flex items-center",children:[h.jsx(Be,{children:r("add_llm_card.encrypted_fields.enabled_google_search_retreival")}),h.jsx(zE,{checked:!!(m!=null&&m.enabled_google_search_retreival),className:"ml-2",onCheckedChange:F=>{y(H=>({...H,enabled_google_search_retreival:F?"true":""}))}})]})]})}},[P,v,r,m]);return h.jsxs(Gt,{className:"max-w-lg",children:[h.jsx(Mn,{children:h.jsx($n,{children:r("add_llm_card.title")})}),h.jsxs(kn,{children:[h.jsxs("div",{className:"grid w-full gap-1.5",children:[h.jsx(Be,{children:r("add_llm_card.provider")}),h.jsxs(Ya,{value:v,onValueChange:R,children:[h.jsx(ja,{className:"w-full mb-4",children:h.jsx(Qa,{placeholder:r("add_llm_card.provider_select_placeholder")})}),h.jsx(Sa,{children:Object.values(w1e).map(F=>h.jsx(Fn,{value:F,children:r(`add_llm_card.providers.${F.toLowerCase()}`)},F))})]}),h.jsx(Be,{children:r("add_llm_card.model_name")}),h.jsxs(Ef,{open:u,onOpenChange:d,children:[h.jsx(GS,{asChild:!0,children:h.jsxs(Ye,{variant:"outline",role:"combobox","aria-expanded":u,className:"w-full justify-between",children:[c?C==null?void 0:C.model_id:r("add_llm_card.select_model_placeholder"),h.jsx(pe,{name:"chevrons-up-down",className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),h.jsx(mu,{className:"w-full p-0",children:h.jsxs(m7,{children:[h.jsx(y7,{onValueChange:T,placeholder:r("add_llm_card.search_placeholder")}),h.jsxs(g7,{children:[h.jsx(v7,{children:r("add_llm_card.no_model")}),h.jsx(b7,{children:z})]})]})})]})]}),C?h.jsxs("div",{className:"mt-4",children:[h.jsxs("div",{className:"mt-4 text-sm text-muted-foreground center flex max-w-full flex-wrap gap-1",children:[h.jsx(Pr,{name:C.model_id,className:"mr-2"}),h.jsx(op,{model:C,isFunctionCalling:(($=x==null?void 0:x.functionCallingModelIds)==null?void 0:$.includes(C.model_id))||!1,name:C.model_id,isCached:O.some(F=>F.includes(C.model_id))||!1,cloud:v!==We.WebLLM})]}),h.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-bold mr-2",children:r("add_llm_card.model_url")}),C.model]}),C.model_lib?h.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[h.jsx("span",{className:"font-bold mr-2",children:r("add_llm_card.model_lib_url")}),C.model_lib]}):void 0,C.overrides&&((U=Object.keys(C.overrides))!=null&&U.length)?h.jsxs("div",{className:"mt-2 text-sm text-muted-foreground center flex",children:[h.jsx("span",{className:"font-bold mr-2",children:r("add_llm_card.metadata")}),JSON.stringify(C.overrides)]}):void 0]}):null,B]}),h.jsx(Ja,{className:"flex justify-between",children:h.jsx(Yn,{loading:N||i,disabled:!(c!=null&&c.length),onClick:L,className:"w-full",children:r(w?"add_llm_card.button_add":"add_llm_card.button_download_and_add")})})]})}const O7=()=>{const e=Je(o=>{var i;return(i=o.currentSession)==null?void 0:i.id}),[t,n]=g.useState(!1),r=Ie(o=>o.createOrUpdateFlowNode),a=g.useCallback(async(o,i)=>{var s,c,l;try{if(!o||!e)throw new Error("Source or Session not found");n(!0);const u=((s=o.position)==null?void 0:s.x)||0,d=(((c=o.position)==null?void 0:c.y)||0)+(((l=o.measured)==null?void 0:l.height)||0),p=await ue("Prompt").save({content:i.content,prefix:i.prefix,role:i.role||pr.System,status:Hr.Started,session_id:e,type:i.type||fr.Chat});if(!p)throw new Error("Failed to save prompt");if(!await r({source_id:p.id,source_type:"Prompt",node_type:ie.Prompt,x:u,y:d+20}))throw new Error("Failed to save prompt node")}finally{n(!1)}},[e,r]);return{loading:t,createPrompt:a}},S1e={[fr.Chat]:{label:"add_prompt_card.prompt_types.chat",value:fr.Chat},[fr.FewShotExample]:{label:"add_prompt_card.prompt_types.few_shot_example",value:fr.FewShotExample}},E1e={[pr.System]:{label:"add_prompt_card.prompt_roles.system",value:pr.System},[pr.Human]:{label:"add_prompt_card.prompt_roles.human",value:pr.Human},[pr.AI]:{label:"add_prompt_card.prompt_roles.ai",value:pr.AI}},UE=g.memo(({defaultPromptContent:e,defaultPromptRole:t,defaultPromptType:n,hidePromptRole:r,hidePromptType:a,loading:o,onSubmit:i})=>{const[s,c]=g.useState(e||""),[l,u]=g.useState(n||fr.Chat),[d,p]=g.useState(t),[f,m]=g.useState(""),{t:y}=ke("components"),v=g.useCallback(_=>{c(_.target.value)},[]),b=g.useCallback(_=>{m(_.target.value)},[]),w=g.useCallback(_=>{_===fr.FewShotExample&&c(`Question: {input}
Answer: {output}`),u(_)},[]),j=g.useCallback(_=>{p(_)},[]),x=async()=>{await i({content:s,role:d,prefix:f,type:l})&&(c(""),p(void 0),u("chat"),m(""))};return h.jsxs("div",{children:[h.jsxs("div",{className:"grid w-full gap-1.5",children:[a?void 0:h.jsxs(h.Fragment,{children:[h.jsx(Be,{children:y("add_prompt_card.prompt_type")}),h.jsxs(Ya,{value:l,onValueChange:w,children:[h.jsx(ja,{className:"w-full mb-4",children:h.jsx(Qa,{placeholder:y("add_prompt_card.type_select_placeholder")})}),h.jsx(Sa,{children:Object.values(S1e).map(_=>h.jsx(Fn,{value:_.value,children:y(_.label)},_.value))})]})]}),r?void 0:h.jsxs(h.Fragment,{children:[h.jsx(Be,{children:y("add_prompt_card.prompt_role")}),h.jsxs(Ya,{value:d,onValueChange:j,children:[h.jsx(ja,{className:"w-full mb-4",children:h.jsx(Qa,{placeholder:y("add_prompt_card.role_select_placeholder")})}),h.jsx(Sa,{children:Object.values(E1e).map(_=>h.jsx(Fn,{value:_.value,children:y(_.label)},_.value))})]})]}),l===fr.FewShotExample&&h.jsxs(h.Fragment,{children:[h.jsx(Be,{children:y("add_prompt_card.prompt_prefix")}),h.jsx(Mo,{value:f,onChange:b,disabled:!1,className:"h-20",placeholder:y("add_prompt_card.placeholder"),id:"message"}),h.jsx(Be,{children:y("add_prompt_card.prompt_content")}),h.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm justify-end items-center",children:[h.jsx(pe,{name:"info",className:"mr-2",size:14}),y("add_prompt_card.few_shot_example_note")]})]}),h.jsx(Mo,{value:s,onChange:v,disabled:!1,placeholder:y("add_prompt_card.placeholder"),id:"message"})]}),h.jsx("div",{children:h.jsx(Yn,{loading:o,disabled:!(s!=null&&s.length),onClick:x,className:"w-full mt-4",children:y("add_prompt_card.button")})})]})}),O1e=g.memo(e=>{const{id:t,thread:n,setDialog:r}=e,{t:a}=ke("components"),{toast:o}=nn(),i=In(t),{createPrompt:s,loading:c}=O7(),l=async u=>{if(i)try{if(!(u!=null&&u.content))throw new Error("Prompt data is missing");await s(i,{...u,content:u.content,thread:n}),r==null||r(!1)}catch(d){o({variant:"destructive",title:`${d}`})}};return h.jsxs(Gt,{className:"mw-full",children:[h.jsx(Mn,{children:h.jsx($n,{children:a("add_prompt_card.title")})}),h.jsx(kn,{children:h.jsx(UE,{onSubmit:l,loading:c,defaultPromptRole:"system",defaultPromptType:"chat"})})]})}),C1e=()=>{const e=Je(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,n]=g.useState(!1),r=Ie(i=>i.createOrUpdateFlowNode),a=g.useCallback((i,s,c,l)=>{var u;if(e){for(const d of s)(u=d.data)!=null&&u.length?a(i,d.data,c,d.id):c.push({name:d.name,type:d.type,enum:d.enum?JSON.stringify(d.enum):"",required:d.required,description:d.description,id:d.id||Uu(),parent_id:l,schema_id:i,session_id:e});return c}},[e]),o=g.useCallback(async(i,s)=>{var c,l,u;try{if(!i||!e)throw new Error("Source or Session not found");n(!0);const d=((c=i.position)==null?void 0:c.x)||0,p=(((l=i.position)==null?void 0:l.y)||0)+(((u=i.measured)==null?void 0:u.height)||0),f=await ue("Schema").save({name:"Untitled Schema",session_id:e});if(!f)throw new Error("Failed to save schema");const m=a(f.id,s,[],void 0);if(!(m!=null&&m.length))throw new Error("Failed to convert schema items");if(await ue("SchemaItem").save(m),!await r({source_id:f.id,source_type:"Schema",node_type:ie.Schema,x:d,y:p+20}))throw new Error("Failed to save schema node")}finally{n(!1)}},[e,a,r]);return{loading:t,createSchema:o}},C7=g.memo(({setData:e,data:t,id:n})=>{const{t:r}=ke("components"),[a,o]=g.useState({name:"",description:"",type:"string",required:!1,data:[]}),i=g.useMemo(()=>n&&t.find(y=>y.id===n)||a,[t,a,n]),s=g.useCallback(y=>{y.target.value&&!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(y.target.value)||(n?e(v=>[...v.map(b=>b.id===n?{...b,name:y.target.value||""}:b)]):o(v=>({...v,name:y.target.value||""})))},[n,e]),c=g.useCallback(y=>{n?e(v=>[...v.map(b=>b.id===n?{...b,description:y.target.value||""}:b)]):o(v=>({...v,description:y.target.value||""}))},[n,e]),l=g.useCallback(y=>{n?e(v=>[...v.map(b=>b.id===n?{...b,type:y||""}:b)]):o(v=>({...v,type:y||"string"}))},[n,e]),u=g.useCallback(y=>{n?e(v=>[...v.map(b=>b.id===n?{...b,required:!!y||!1}:b)]):o(v=>({...v,required:!!y||!1}))},[n,e]),d=g.useCallback(y=>{n?e(v=>[...v.map(b=>b.id===n?{...b,enum:y.target.value||""}:b)]):o(v=>({...v,enum:y.target.value||""}))},[n,e]),p=g.useCallback(()=>{if(t.find(y=>y.name===a.name))return au({variant:"destructive",content:"Name already exists"});a.id=Uu(),e(y=>[...y,{...a}]),o({name:"",description:"",type:"string",required:!1,id:Uu(),parent:n||void 0,data:[]})},[t,a,e,n]),f=g.useCallback(y=>{e(v=>[...v.map(b=>b.id===n?{...b,data:y(b.data||[])}:b)])},[n,e]),m=["object","array"].includes(i.type);return h.jsxs("div",{className:"w-full p-1",children:[h.jsxs("div",{children:[h.jsx(Be,{children:r("add_schema_card.field.name")}),h.jsx(Kt,{id:"name",onChange:s,placeholder:r("add_schema_card.field.name_placeholder"),value:(i==null?void 0:i.name)||""})]}),h.jsxs("div",{children:[h.jsx(Be,{children:r("add_schema_card.field.description")}),h.jsx(Kt,{id:"description",placeholder:r("add_schema_card.field.description_placeholder"),onChange:c,value:(i==null?void 0:i.description)||""})]}),h.jsxs("div",{children:[h.jsx(Be,{children:r("add_schema_card.field.type")}),h.jsxs(Ya,{onValueChange:l,value:(i==null?void 0:i.type)||"",children:[h.jsx(ja,{children:h.jsx(Qa,{placeholder:r("add_schema_card.field.type_placeholder")})}),h.jsxs(Sa,{children:[h.jsx(Fn,{value:"string",children:r("add_schema_card.types.string")}),h.jsx(Fn,{value:"boolean",children:r("add_schema_card.types.boolean")}),h.jsx(Fn,{value:"number",children:r("add_schema_card.types.number")}),h.jsx(Fn,{value:"object",children:r("add_schema_card.types.object")}),h.jsx(Fn,{value:"array",children:r("add_schema_card.types.array")})]})]})]}),h.jsxs("div",{className:"flex items-center h-10",children:[h.jsx(Be,{children:r("add_schema_card.field.required")}),h.jsx(zE,{className:"ml-2","aria-label":"Select row",onCheckedChange:u,checked:i==null?void 0:i.required})]}),m?h.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[h.jsx(Be,{children:r("add_schema_card.children")}),h.jsx(N7,{data:(i==null?void 0:i.data)||[],setData:f})]}):null,(i==null?void 0:i.type)==="enum"?h.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[h.jsx(Be,{children:r("add_schema_card.field.enum")}),h.jsx(Kt,{id:"enum",onChange:d,placeholder:"Enum"})]}):null,n?null:h.jsx("div",{className:"w-full flex justify-end mt-2",children:h.jsx(Ye,{variant:"secondary",disabled:!i.name||!i.description||!i.type,onClick:p,className:"w-full",children:r("add_schema_card.field.add_field")})})]})}),N7=g.memo(({data:e,setData:t})=>h.jsxs(ZB,{type:"single",collapsible:!0,children:[e.map(n=>h.jsxs(dE,{value:`${n.id}`,children:[h.jsx(pE,{children:n.name}),h.jsx(fE,{children:h.jsx(C7,{setData:t,data:e,id:n.id})})]},n.id||"new")),h.jsx(Gt,{className:"p-2 mt-4",children:h.jsx(C7,{setData:t,data:e})})]})),N1e=g.memo(e=>{const{t}=ke("components"),{id:n}=e,r=In(n),[a,o]=g.useState([]),{createSchema:i,loading:s}=C1e(),c=async()=>{if(r&&(a!=null&&a.length))try{await i(r,a),o([])}catch(l){au({variant:"destructive",title:`${l}`})}};return h.jsxs(Gt,{className:"max-w-lg",children:[h.jsx(Mn,{children:h.jsx($n,{children:t("add_schema_card.title")})}),h.jsx(kn,{className:"min-w-96",children:h.jsx(N7,{setData:o,data:a})}),h.jsx(Ja,{className:"flex justify-between",children:h.jsx(Yn,{loading:s,disabled:!(a!=null&&a.length),onClick:c,className:"w-full",children:t("add_schema_card.create")})})]})}),M7=()=>{const e=Je(o=>{var i;return(i=o.currentSession)==null?void 0:i.id}),[t,n]=g.useState(!1),r=Ie(o=>o.createOrUpdateFlowNode),a=g.useCallback(async(o,i,s)=>{var c,l,u;try{if(!o||!e)throw new Error("Source or Session not found");n(!0);const d=((c=o.position)==null?void 0:c.x)||0,p=(((l=o.position)==null?void 0:l.y)||0)+(((u=o.measured)==null?void 0:u.height)||0),f=n3e(i,s),m=await ue("CSVData").save({headers:f.headers,csv:f.data,session_id:e});if(!m)throw new Error("Failed to save");if(!await r({source_id:m.id,source_type:"CSVData",node_type:ie.CSVData,x:d,y:p+20}))throw new Error("Failed to save node")}finally{n(!1)}},[e,r]);return{loading:t,createCSVData:a}};function M1e({data:e}){const{t}=ke("components");return h.jsxs(Ty,{className:"w-full",children:[h.jsx(Iy,{children:h.jsxs(js,{children:[h.jsx(cl,{children:t("add_few_shot_example_card.input")}),h.jsx(cl,{children:t("add_few_shot_example_card.output")})]})}),h.jsx(Ry,{children:e==null?void 0:e.map((n,r)=>h.jsxs(js,{children:[h.jsx(ll,{className:"p-4",children:n.input}),h.jsx(ll,{className:"p-4",children:n.output})]},`${n.input}_${n.output}_${r}`))})]})}const k1e=g.memo(e=>{const{id:t}=e,{t:n}=ke("components"),[r,a]=g.useState([]),[o,i]=g.useState(""),[s,c]=g.useState(""),l=In(t),{createCSVData:u,loading:d}=M7(),p=()=>{a(m=>[...m,{input:o,output:s}]),i(""),c("")},f=async()=>{l&&await u(l,["input","output"],r.map(m=>[m.input,m.output]))};return h.jsxs(Gt,{className:"mw-full",children:[h.jsx(Mn,{children:h.jsx($n,{children:n("add_few_shot_example_card.title")})}),h.jsxs(kn,{children:[h.jsxs("div",{className:"flex flex-col space-y-1.5",children:[h.jsx(Be,{htmlFor:"name",children:n("add_few_shot_example_card.input")}),h.jsx(Kt,{value:o,onChange:m=>i(m.target.value||""),id:"name",placeholder:n("add_few_shot_example_card.input_placeholder")})]}),h.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[h.jsx(Be,{htmlFor:"name",children:n("add_few_shot_example_card.output")}),h.jsx(Mo,{value:s,onChange:m=>c(m.target.value||""),placeholder:n("add_few_shot_example_card.output_placeholder")})]}),h.jsx("div",{className:"w-full flex mt-4 justify-end",children:h.jsx(Ye,{disabled:!o||!s,onClick:p,className:"w-40",children:n("add_few_shot_example_card.add")})}),h.jsx(M1e,{data:r||[]})]}),h.jsx(Ja,{className:"flex justify-between",children:h.jsx(Yn,{loading:d,disabled:!(r!=null&&r.length),onClick:f,className:"w-full",children:n("add_few_shot_example_card.create")})})]})}),P1e=()=>{const e=Je(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,n]=g.useState(!1),r=Ie(i=>i.createOrUpdateFlowNode),a=Ie(i=>i.createOrUpdateFlowEdge),o=g.useCallback(async(i,s,c)=>{var l,u,d;try{if(!i||!e)throw new Error("Source or Session not found");if(!s.name||!s.description)throw new Error("Name is required");n(!0);const p=((l=i.position)==null?void 0:l.x)||0,f=(((u=i.position)==null?void 0:u.y)||0)+(((d=i.measured)==null?void 0:d.height)||0),m=await ue("ToolDefinition").save({...s,name:`${s.name}`,description:`${s.description}`,session_id:e});if(!m)throw new Error("Failed create tool.");const y=await r({source_id:m.id,source_type:"ToolDefinition",node_type:ie.ToolDefinition,x:p,y:f+20});if(!y)throw new Error("Failed to save node");c!=null&&c.schemaNode&&await a({source:c.schemaNode.id,target:y.id})}finally{n(!1)}},[e,r,a]);return{loading:t,createTool:o}},A1e=g.memo(e=>{const{t}=ke("components"),{toast:n}=nn(),{id:r}=e,a=In(r),[o,i]=g.useState(""),[s,c]=g.useState(""),{createTool:l,loading:u}=P1e(),d=m=>{i(m.target.value)},p=m=>{c(m.target.value)},f=async()=>{if(a&&o&&s)try{await l(a,{name:o,description:s}),i(""),c("")}catch(m){ni(m),n({variant:"destructive",title:t("add_tool_card.errors.create_tool_failed")})}};return h.jsxs(Gt,{className:"mw-full",children:[h.jsx(Mn,{children:h.jsx($n,{children:t("add_tool_card.title")})}),h.jsxs(kn,{children:[h.jsxs("div",{className:"flex flex-col space-y-1.5",children:[h.jsx(Be,{htmlFor:"name",children:t("add_tool_card.tool_name")}),h.jsx(Kt,{onChange:d,id:"name",placeholder:t("add_tool_card.name_placeholder")})]}),h.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[h.jsx(Be,{htmlFor:"name",children:t("add_tool_card.tool_description")}),h.jsx(Mo,{onChange:p,placeholder:t("add_tool_card.description_placeholder")})]})]}),h.jsx(Ja,{className:"flex justify-between",children:h.jsx(Yn,{loading:u,onClick:f,className:"w-full",children:t("add_tool_card.create")})})]})}),T1e=()=>{const e=Je(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,n]=g.useState(!1),r=Ie(i=>i.createOrUpdateFlowNode),a=Ie(i=>i.createOrUpdateFlowEdge),o=g.useCallback(async(i,s,c)=>{var l,u,d;try{if(!(s!=null&&s.name)||!i||!e)throw new Error("Source or Session not found");n(!0);const p=((l=i.position)==null?void 0:l.x)||0,f=(((u=i.position)==null?void 0:u.y)||0)+(((d=i.measured)==null?void 0:d.height)||0),m=await ue("VectorDatabase").save({...s,name:`${s.name}`,type:s.type||r3e.Local,storage:s.storage||Vr.DatabaseNode,raw:"",provider:s.provider||XG.Memory,session_id:e,metadata:c?JSON.stringify({textSplitter:c}):void 0});if(!m)throw new Error("Failed to save vectorDatabase");const y=await r({source_id:m.id,source_type:"VectorDatabase",node_type:ie.VectorDatabase,x:p,y:f+30});if(!y)throw new Error("Failed to save vectorDatabase node");if(s.storage===Vr.DataNode){const v=await ue("JSONLData").save({headers:a3e(["content","embedding","metadata"]),jsonl:"",session_id:e});if(!v)throw new Error("Failed to save databaseSource");const b=await r({source_id:v.id,source_type:"JSONLData",node_type:ie.JSONLData,x:p+80,y:f+30});if(!b)throw new Error("Failed to save databaseSource node");await a({source:b.id,target:y.id})}return{vectorDatabase:m,vectorDatabaseNode:y}}finally{n(!1)}},[e,r,a]);return{loading:t,createVectorDatabase:o}},pp=[XG.Memory],fp=[Vr.DatabaseNode],I1e=["TokenTextSplitter","CharacterTextSplitter","RecursiveCharacterTextSplitter"],R1e=g.memo(e=>{const{t}=ke("components"),{id:n}=e,r=In(n),{toast:a}=nn(),[o,i]=g.useState(""),[s,c]=g.useState(pp[0]),[l,u]=g.useState(fp[0]),[d,p]=g.useState({}),{loading:f,createVectorDatabase:m}=T1e(),y=g.useCallback(S=>{c(S)},[]),v=g.useCallback(S=>{u(S)},[]),b=g.useCallback(S=>{p(E=>({...E,type:S,chunkSize:500,chunkOverlap:40}))},[]),w=g.useCallback(S=>{i(S.target.value||"")},[]),j=g.useCallback(S=>{p(E=>({...E,chunkSize:Number(S.target.value)}))},[]),x=g.useCallback(S=>{p(E=>({...E,chunkOverlap:Number(S.target.value)}))},[]),_=async()=>{try{if(!r)return;await m(r,{name:o,provider:s,storage:l},d!=null&&d.type?{type:d.type,chunkSize:d.chunkSize||500,chunkOverlap:d.chunkOverlap||0}:void 0),i(""),p({})}catch{a({variant:"destructive",description:t("create_vector_database_card.errors.create_failed")})}};return h.jsxs(Gt,{className:"mw-full",children:[h.jsx(Mn,{children:h.jsx($n,{children:t("create_vector_database_card.title")})}),h.jsx(kn,{children:h.jsxs("div",{className:"grid w-full gap-1.5",children:[h.jsx(Be,{children:t("create_vector_database_card.name")}),h.jsx(Kt,{className:"mb-4",value:o,onChange:w}),(fp==null?void 0:fp.length)>1?h.jsxs(h.Fragment,{children:[h.jsx(Be,{children:t("create_vector_database_card.storage_type")}),h.jsxs(Ya,{value:l,onValueChange:v,children:[h.jsx(ja,{className:"w-full mb-4",children:h.jsx(Qa,{placeholder:t("create_vector_database_card.provider_select_placeholder")})}),h.jsx(Sa,{children:Object.values(fp).map(S=>h.jsx(Fn,{value:S,children:t(`create_vector_database_card.storage_types.${S.toLowerCase()}`)},S))})]})]}):void 0,(pp==null?void 0:pp.length)>1?h.jsxs(h.Fragment,{children:[h.jsx(Be,{children:t("create_vector_database_card.provider")}),h.jsxs(Ya,{value:s,onValueChange:y,children:[h.jsx(ja,{className:"w-full mb-4",children:h.jsx(Qa,{placeholder:t("create_vector_database_card.provider_select_placeholder")})}),h.jsx(Sa,{children:Object.values(pp).map(S=>h.jsx(Fn,{value:S,children:t(`create_vector_database_card.providers.${S.toLowerCase()}`)},S))})]})]}):void 0,h.jsx(Be,{children:t("create_vector_database_card.text_splitter")}),h.jsxs(Ya,{value:d.type,onValueChange:b,children:[h.jsx(ja,{className:"w-full mb-4",children:h.jsx(Qa,{placeholder:t("create_vector_database_card.text_splitter_select_placeholder")})}),h.jsx(Sa,{children:Object.values(I1e).map(S=>h.jsx(Fn,{value:S,children:t(`create_vector_database_card.text_splitters.${S.toLowerCase()}`)},S))})]}),d.type?h.jsxs(Gt,{children:[h.jsx(Mn,{children:h.jsx($n,{children:t("create_vector_database_card.text_splitter_configuration")})}),h.jsxs(kn,{children:[h.jsx(Be,{children:t("create_vector_database_card.text_splitter_chunksize")}),h.jsx(Kt,{value:d.chunkSize,onChange:j,placeholder:t("create_vector_database_card.text_splitter_chunksize_placeholder")}),h.jsx(Be,{children:t("create_vector_database_card.text_splitter_chunkoverlap")}),h.jsx(Kt,{value:d.chunkOverlap,onChange:x,placeholder:t("create_vector_database_card.text_splitter_chunkoverlap_placeholder")})]})]}):void 0]})}),h.jsx(Ja,{className:"flex justify-between",children:h.jsx(Yn,{disabled:!d.type||!o,loading:f,onClick:_,className:"w-full",children:t("create_vector_database_card.create")})})]})});function D1e({data:e}){const{t}=ke("components");return h.jsxs(Ty,{className:"w-full",children:[h.jsx(Iy,{children:h.jsx(js,{children:h.jsx(cl,{children:t("add_text_data.text")})})}),h.jsx(Ry,{children:e==null?void 0:e.map((n,r)=>h.jsx(js,{children:h.jsx(ll,{className:"p-4",children:n.text})},`${n.text}_${r}`))})]})}const L1e=g.memo(e=>{const{id:t}=e,{t:n}=ke("components"),[r,a]=g.useState([]),[o,i]=g.useState(""),s=In(t),{createCSVData:c,loading:l}=M7(),u=()=>{a(p=>[...p,{text:o}]),i("")},d=async()=>{s&&await c(s,["text"],r.map(p=>[p.text]))};return h.jsxs(Gt,{className:"mw-full",children:[h.jsx(Mn,{children:h.jsx($n,{children:n("add_text_data.title")})}),h.jsxs(kn,{children:[h.jsxs("div",{className:"flex flex-col space-y-1.5 mt-3",children:[h.jsx(Be,{htmlFor:"name",children:n("add_text_data.text")}),h.jsx(Mo,{value:o,onChange:p=>i(p.target.value||""),placeholder:n("add_text_data.text_placeholder")})]}),h.jsx("div",{className:"w-full flex mt-4 justify-end",children:h.jsx(Ye,{disabled:!o,onClick:u,className:"w-40",children:n("add_text_data.add")})}),h.jsx(D1e,{data:r||[]})]}),h.jsx(Ja,{className:"flex justify-between",children:h.jsx(Yn,{loading:l,disabled:!(r!=null&&r.length),onClick:d,className:"w-full",children:n("add_text_data.create")})})]})});var Vo=(e=>(e.ADD_LLM="ADD_LLM",e.ADD_PROMPT="ADD_PROMPT",e.ADD_TOOL_DEFINITION="ADD_TOOL_DEFINITION",e.ADD_SCHEMA="ADD_SCHEMA",e.ADD_FEW_SHOT_EXAMPLE="ADD_FEW_SHOT_EXAMPLE",e.ADD_VECTOR_DATABASE="ADD_VECTOR_DATABASE",e.ADD_TEXT_DATA="ADD_TEXT_DATA",e))(Vo||{});const $1e=["ADD_LLM","ADD_PROMPT","ADD_SCHEMA","ADD_VECTOR_DATABASE",{key:"more",label:"more",icon:"ellipsis",children:["ADD_TOOL_DEFINITION","ADD_FEW_SHOT_EXAMPLE"]}],F1e=()=>{const e="_coolMode_effect",t=document.getElementById(e);if(t)return t;const n=document.createElement("div");return n.setAttribute("id",e),n.setAttribute("style","overflow:hidden; position:fixed; height:100%; top:0; left:0; right:0; bottom:0; pointer-events:none; z-index:2147483647"),document.body.appendChild(n),n};let k7=0,P7,A7,T7,I7,R7,D7,Bn,dt,L7,$7,F7,B7,Uy,VE,qE,WE,z7,U7,HE,V7,q7,W7;P7=(e,t)=>{k7++;const n=(t==null?void 0:t.particle)||"circle",r=[15,20,25,35,45],a=45;let o=[],i=!1,s=0,c=0;const l=F1e();function u(){const E=(t==null?void 0:t.size)||r[Math.floor(Math.random()*r.length)],O=(t==null?void 0:t.speedHorz)||Math.random()*10,N=(t==null?void 0:t.speedUp)||Math.random()*25,M=Math.random()*360,k=Math.random()*35*(Math.random()<=.5?-1:1),P=c-E/2,A=s-E/2,C=Math.random()<=.5?-1:1,I=document.createElement("div");if(n==="circle"){const T="http://www.w3.org/2000/svg",R=document.createElementNS(T,"svg"),L=document.createElementNS(T,"circle");L.setAttributeNS(null,"cx",(E/2).toString()),L.setAttributeNS(null,"cy",(E/2).toString()),L.setAttributeNS(null,"r",(E/2).toString()),L.setAttributeNS(null,"fill",`hsl(${Math.random()*360}, 70%, 50%)`),R.appendChild(L),R.setAttribute("width",E.toString()),R.setAttribute("height",E.toString()),I.appendChild(R)}else I.innerHTML=`<img src="${n}" width="${E}" height="${E}" style="border-radius: 50%">`;I.style.position="absolute",I.style.transform=`translate3d(${A}px, ${P}px, 0px) rotate(${M}deg)`,l.appendChild(I),o.push({direction:C,element:I,left:A,size:E,speedHorz:O,speedUp:N,spinSpeed:k,spinVal:M,top:P})}function d(){o.forEach(E=>{E.left=E.left-E.speedHorz*E.direction,E.top=E.top-E.speedUp,E.speedUp=Math.min(E.size,E.speedUp-1),E.spinVal=E.spinVal+E.spinSpeed,E.top>=Math.max(window.innerHeight,document.body.clientHeight)+E.size&&(o=o.filter(O=>O!==E),E.element.remove()),E.element.setAttribute("style",["position:absolute","will-change:transform",`top:${E.top}px`,`left:${E.left}px`,`transform:rotate(${E.spinVal}deg)`].join(";"))})}let p,f=0;const m=30;function y(){const E=performance.now();i&&o.length<a&&E-f>m&&(u(),f=E),d(),p=requestAnimationFrame(y)}y();const v="ontouchstart"in window,b=v?"touchstart":"mousedown",w=v?"touchend":"mouseup",j=v?"touchmove":"mousemove",x=E=>{var O,N;"touches"in E?(s=(O=E.touches)==null?void 0:O[0].clientX,c=(N=E.touches)==null?void 0:N[0].clientY):(s=E.clientX,c=E.clientY)},_=E=>{x(E),i=!0},S=()=>{i=!1};return e.addEventListener(j,x,{passive:!0}),e.addEventListener(b,_,{passive:!0}),e.addEventListener(w,S,{passive:!0}),e.addEventListener("mouseleave",S,{passive:!0}),()=>{e.removeEventListener(j,x),e.removeEventListener(b,_),e.removeEventListener(w,S),e.removeEventListener("mouseleave",S);const E=setInterval(()=>{p&&o.length===0&&(cancelAnimationFrame(p),clearInterval(E),--k7===0&&l.remove())},500)}},A7=({children:e,options:t})=>{const n=g.useRef(null);return g.useEffect(()=>{if(n.current)return P7(n.current,t)},[t]),W.cloneElement(e,{ref:n})},T7=g.memo(e=>{const{t}=ke("flows"),n=eu(s=>s.theme),[r,a]=g.useState(`${Vo.ADD_LLM}`),o=g.useMemo(()=>h.jsxs(t7,{children:[h.jsx(PE,{children:h.jsx(A7,{children:h.jsx(Ye,{variant:"link",className:"!p-0 !pl-3",children:h.jsx(o3e,{width:32,height:32,className:Z(n==="dark"?"fill-white":"fill-black")})})})}),$1e.map(s=>typeof s=="object"?h.jsxs(PE,{children:[h.jsx(AE,{children:s.icon?h.jsx(pe,{name:s.icon}):t(`supported_nodes.${s.label}`)}),h.jsx(n7,{children:s.children.map(c=>h.jsx(r7,{onClick:()=>a(c),children:t(`supported_nodes.${c.toLowerCase()}`)},c))})]},s.key):h.jsx(PE,{children:h.jsx(AE,{value:s,onClick:()=>a(s),children:t(`supported_nodes.${s.toLowerCase()}`)})},s))]}),[t,n]),i=g.useMemo(()=>{switch(r){case Vo.ADD_LLM:return h.jsx(j1e,{...e});case Vo.ADD_PROMPT:return h.jsx(O1e,{...e});case Vo.ADD_SCHEMA:return h.jsx(N1e,{...e});case Vo.ADD_FEW_SHOT_EXAMPLE:return h.jsx(k1e,{...e});case Vo.ADD_TOOL_DEFINITION:return h.jsx(A1e,{...e});case Vo.ADD_VECTOR_DATABASE:return h.jsx(R1e,{...e});case Vo.ADD_TEXT_DATA:return h.jsx(L1e,{...e})}},[e,r]);return h.jsxs(h.Fragment,{children:[o,h.jsx("div",{className:"mt-4",children:i})]})}),I7=()=>{const[e,t]=g.useState(!1),n=es(),r=Je(s=>s.currentSession),a=Je(s=>s.getLatestApplications),o=g.useCallback(async(s,c,l,u)=>{var f;const d=(f=c.data)==null?void 0:f.entity;let p=c.type?i3e[c.type]:void 0;if(p&&d&&c&&typeof d=="object"&&"id"in d&&!l.has(`${d.id}`)&&!u.has(`${c.id}`)){p=p;const m=await ue(p).save({...d,...d&&typeof d=="object"&&"session_id"in d?{session_id:s.id}:{}});l.set(`${d.id}`,m.id);const y=await ue("FlowNode").findOne({where:{id:c.data.flowNode.id}}),v=await ue("FlowNode").save({...y||c.data.flowNode,session_id:s.id,id:void 0,source_type:p,source_id:m.id});return u.set(`${c.id}`,v.id),{entityName:p,entity:m,node:v}}else if(!u.has(`${c.id}`)){const m=await ue("FlowNode").findOne({where:{id:c.data.flowNode.id}}),y=await ue("FlowNode").save({...m||c.data.flowNode,node_type:c.type,session_id:s.id,id:void 0});return u.set(`${c.id}`,y.id),{node:y}}},[]),i=g.useCallback(async(s,c)=>{try{if(!r)throw new Error("No current session");t(!0);const l=await ue("Session").save({type:Vi.StandaloneApp,name:c.name||(r!=null&&r.name?`${r.name}`:"Standalone"),status:s3e.Started,passphrase:r.passphrase});if(!l)throw new Error("Failed create standalone session");const u=new Map,d=new Map,p=await o(l,s,u,d);if(!p)throw new Error("Failed to clone main node");await ue("Session").update(l.id,{main_node_id:p.node.id,main_source_id:p!=null&&p.entity?p.entity.id:void 0,main_source_type:p.entityName?p.entityName:void 0});for(const{node:f,connectedNodes:m}of c.connections)if(await o(l,f,u,d),m)for(const y of m)await o(l,y,u,d);for(const{connections:f}of c.connections)for(const m of f){const y=d.get(`${m.source}`),v=d.get(`${m.target}`);if(!y||!v)throw new Error("Failed to get connected flow node id");await ue("FlowEdge").save({source:y,target:v,sourceHandle:m.sourceHandle,targetHandle:m.targetHandle,session_id:l.id})}return a(),n(dn("application",{applicationId:l.id})),!0}finally{t(!1)}},[o,r,a,n]);return{loading:e,createStandaloneSession:i}},R7=()=>{const[e,t]=g.useState(!1),n=Ie(o=>o.updateNodes),r=Ie(o=>o.updateEdges),a=g.useCallback(async o=>{try{t(!0),await ue("FlowNode").delete(o);const i=await ue("FlowEdge").find({where:[{source:o},{target:o}]});return await Promise.all(i.map(s=>ue("FlowEdge").delete(s.id))),await n([{id:o,type:"remove"}]),await r(i.map(s=>({id:s.id,type:"remove"}))),!0}catch{return!1}finally{t(!1)}},[r,n]);return{loading:e,deleteNodeFlow:a}},D7=uo(({cloneStandaloneSession:e})=>{const t=tn(),{t:n}=ke("dialogs"),[r,a]=g.useState(""),{toast:o}=nn(),i=c=>{a(c.target.value)},s=async()=>{try{t.hide(),await e(r),a("")}catch{o({variant:"destructive",description:n("create_standalone_application.errors.create_failed")})}};return h.jsx(fi,{open:t.visible,onOpenChange:t.hide,children:h.jsxs(xo,{className:"sm:max-w-[425px]",children:[h.jsxs(_o,{children:[h.jsx(jo,{children:n("create_session.title")}),h.jsx($u,{children:n("create_standalone_application.description")})]}),h.jsx("div",{className:"grid gap-4 py-4",children:h.jsxs("div",{className:"flex flex-col space-y-1.5",children:[h.jsx(Be,{className:"mb-2",htmlFor:"name",children:n("create_standalone_application.name")}),h.jsx(Kt,{onChange:i,id:"name",value:r,placeholder:n("create_standalone_application.name_placeholder")})]})}),h.jsx(Lu,{children:h.jsx(Ye,{onClick:s,disabled:!r,type:"submit",children:n("create_standalone_application.create")})})]})})}),Bn=g.memo(({id:e,className:t,enableToStandalone:n,getLinkedConnections:r})=>{const{t:a}=ke("common"),{getNode:o}=br(),{loading:i,deleteNodeFlow:s}=R7(),{createStandaloneSession:c}=I7(),{toast:l}=nn(),u=tn(D7),d=g.useCallback(async()=>{try{await s(e),l({description:a("deleted")})}catch{l({description:a("errors.delete_failed"),variant:"destructive"})}},[s,e,l,a]),p=g.useCallback(async m=>{try{const y=o(e);if(!y)throw new Error("No current node");const v=(r==null?void 0:r(e))||[];await c(y,{name:m,connections:v}),l({description:a("standalone_session_created")})}catch(y){Ws(y),l({description:a("errors.create_standalone_session_failed"),variant:"destructive"})}},[o,e,r,c,l,a]),f=g.useCallback(()=>{u.show({cloneStandaloneSession:p})},[p,u]);return h.jsxs("div",{className:Z("flex absolute z-[51] right-0 top-0 h-10",t),children:[n?h.jsx(Ye,{className:"!rounded-none !px-2",onClick:f,variant:"ghost",children:h.jsx(pe,{name:"package-plus",size:16})}):void 0,h.jsx(Yn,{loading:i,className:"!rounded-none !px-2",onClick:d,variant:"ghost",children:h.jsx(pe,{name:"trash-2",size:16})})]})}),dt=g.memo(e=>{const{className:t,...n}=e;return h.jsx(Ed,{className:Z("!w-2 !h-2 !border-none !rounded-full !bg-slate-700",e.position===he.Top?"!top-[-2px]":"",t),...n})}),L7=()=>{const e=Je(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,n]=g.useState(!1),r=Ie(i=>i.createOrUpdateFlowNode),a=Ie(i=>i.createOrUpdateFlowEdge),o=g.useCallback(async i=>{var s,c;n(!0);try{const l=(s=i.data)==null?void 0:s.entity;if(!l||!e)throw new Error("LLM or Session not found");const u=i.position.x,d=i.position.y+(((c=i.measured)==null?void 0:c.height)||0),p=await ue("Thread").save({initial_llm_id:l.id,title:`New thread with ${l.name}`,status:Nf.Started,messages:[],session_id:e}),f=await r({source_id:p.id,source_type:"Thread",node_type:ie.Thread,x:u,y:d+60});if(!f)throw new Error("Failed to create thread node");const m=await a({source:i.id,target:f.id});return{thread:p,flowNode:f,flowEdge:m}}finally{n(!1)}},[a,r,e]);return{loading:t,createThread:o}},$7=(e,t)=>{var j;const{t:n}=ke("flows"),{toast:r}=nn(),[a,o]=g.useState(!1),[i,s]=g.useState(!1),c=In(e),{loadModel:l}=Om(),{createThread:u,loading:d}=L7(),p=Ie(x=>x.updateNodes),f=Ie(x=>x.pushSyncNodeQueue),{getNodes:m}=br(),y=g.useCallback(async()=>{try{if(s(!0),t.entity.id){const x=await ue("Thread").find({where:{initial_llm_id:t.entity.id}});f("Thread",{where:{source_type:"Thread",source_id:Ha(x.map(_=>_.id))}})}}finally{s(!1)}},[(j=t==null?void 0:t.entity)==null?void 0:j.id,f]),v=g.useCallback(async()=>{try{if(o(!0),t.entity&&c){await(l==null?void 0:l(t.entity.provider,`${t.entity.name}`,_=>{c.data.status=_.progress===100?et.Loaded:et.Loading,c.data.label=_.text,p([{id:e,type:"replace",item:c}])}));const x=m().filter(_=>_.type===ie.LLM?_.data.entity.provider===We.WebLLM:!1).map(_=>(_.data.status=et.Started,{id:_.id,type:"replace",item:_}));c.data.label="",c.data.status=et.Loaded,x.push({id:e,type:"replace",item:c}),p(x),await y()}}catch(x){ni(x),r({variant:"destructive",description:n("llm_node.errors.loading_model")})}finally{o(!1)}},[t.entity,m,e,l,c,y,n,r,p]),b=g.useCallback(async()=>{t.entity&&c&&await(u==null?void 0:u(c))},[t.entity,c,u]),w=g.useCallback(async x=>{t.entity&&c&&(c.data.entity.options=x,await ue("LLM").update(t.entity.id,{options:x}),p([{id:e,type:"replace",item:c}]))},[t.entity,e,c,p]);return g.useEffect(()=>{t.entity&&c&&t.entity.status!==t.status&&(c.data.status=t.entity.status,p([{id:e,type:"replace",item:c}]))},[]),{loadingModel:a,creatingThread:d,queringThreads:i,changeLLMOptions:w,loadModel:v,createThread:b,queryThreads:y}},qn=(e,t)=>{const[n,r]=g.useState(!1),[a,o]=g.useState([]),{deleteElements:i,getNode:s}=br();bm({type:"target",nodeId:e,onConnect:l=>{l!=null&&l.length&&o(u=>[...u,...jpe(l)])}});const c=g.useCallback(async(l,u,d,p)=>{try{return await t({id:e,edgeId:l,source:u,target:d,connection:p})}catch{return{deleteEdgeId:l}}},[t,e]);g.useEffect(()=>{!(a!=null&&a.length)||n||(async()=>{try{r(!0);const l=[...a];o([]);const u=[],d=s(e);await Promise.all(l.map(async p=>{const f="edgeId"in p?p.edgeId:void 0,m=s(p.source);if(!m||!d)return;const y=await c(`${f}`,m,d,p);y!=null&&y.deleteEdgeId&&u.push(...Array.isArray(y.deleteEdgeId)?y.deleteEdgeId:[y.deleteEdgeId])})),u!=null&&u.length&&await i({edges:u.map(p=>({id:p}))})}finally{r(!1)}})()},[i,s,e,n,c,a])},F7=e=>{const t=g.useCallback(async()=>{},[]);qn(e,t)},B7=g.memo(e=>{var b,w,j,x,_,S;const{id:t,data:n,isConnectable:r}=e,[a,o]=g.useState(),{t:i}=ke("flows"),{createThread:s,loadModel:c,queringThreads:l,queryThreads:u,loadingModel:d,changeLLMOptions:p}=$7(t,n);F7(t);const f=[et.Loading,et.Downloading].includes(n.status);g.useEffect(()=>{var E,O,N,M,k;if(!(a||!((E=n==null?void 0:n.entity)!=null&&E.name))){if(((O=n==null?void 0:n.entity)==null?void 0:O.provider)!==We.WebLLM){o({hasCache:!1,cloud:!0,isFunctionCalling:!0,info:{model_id:(N=n==null?void 0:n.entity)==null?void 0:N.name,model:(M=n==null?void 0:n.entity)==null?void 0:M.name,model_lib:(k=n==null?void 0:n.entity)==null?void 0:k.provider,model_type:2}});return}Ht(()=>import("./index-C7uio77f.js").then(async P=>(await P.__tla,P)),__vite__mapDeps([9,1,2,3,4])).then(async({hasModelInCache:P,functionCallingModelIds:A,prebuiltAppConfig:C})=>{var T,R;const I=await P((T=n==null?void 0:n.entity)==null?void 0:T.name);o({hasCache:I,isFunctionCalling:A.includes((R=n==null?void 0:n.entity)==null?void 0:R.name),info:C.model_list.find(L=>{var D;return L.model_id===((D=n==null?void 0:n.entity)==null?void 0:D.name)})})})}},[(b=n==null?void 0:n.entity)==null?void 0:b.name,(w=n==null?void 0:n.entity)==null?void 0:w.provider,a]);const m=g.useCallback(async E=>{await p(E)},[p]),y=g.useMemo(()=>{var E,O;switch(n.status){case et.Downloading:return h.jsx(pe,{className:"animate-spin w-7 h-7",name:"arrow-big-down-dash"});case et.Loaded:return h.jsx(Pr,{name:((E=n.entity)==null?void 0:E.name)||"brain",className:"w-7 h-7"});case et.Loading:return h.jsx(pe,{className:"animate-spin w-7 h-7",name:"loader-circle"});default:return h.jsx(Pr,{name:((O=n.entity)==null?void 0:O.name)||"brain",className:"w-7 h-7"})}},[(j=n.entity)==null?void 0:j.name,n.status]),v=g.useMemo(()=>f?null:d?h.jsx(Ye,{disabled:!0,className:"w-full mt-4",children:h.jsx(pe,{className:"animate-spin",size:24,name:"loader-circle"})}):n.status===et.Loaded?h.jsx(Ye,{onClick:s,className:"mt-4 w-full",children:i("llm_node.create_thread_button")}):h.jsxs("div",{className:"flex gap-2 mt-4",children:[a!=null&&a.hasCache?h.jsx(Yn,{loading:l,onClick:u,children:h.jsx(pe,{size:24,name:"message-square-more"})}):null,h.jsx(Ye,{disabled:d,onClick:c,className:"w-full",children:i(a!=null&&a.hasCache?"llm_node.load_model_button":"llm_node.download_model_button")})]}),[f,d,n.status,a==null?void 0:a.hasCache,l,u,c,i,s]);return h.jsxs("div",{children:[h.jsxs("div",{children:[h.jsx(Bn,{id:t}),h.jsxs(Ar,{className:"flex justify-center",children:[y,h.jsxs("div",{className:"ml-2 pt-1 max-w-lg",children:[h.jsx(Uo,{className:"flex gap-2 items-center pr-6",children:`${((x=n==null?void 0:n.entity)==null?void 0:x.name)||""}`}),h.jsx(pl,{className:"max-w-full",children:`${n.label||""}`}),h.jsx("div",{className:"max-w-full mt-2 flex-wrap flex gap-1",children:h.jsx(op,{model:a==null?void 0:a.info,isFunctionCalling:(a==null?void 0:a.isFunctionCalling)||!1,name:(_=n==null?void 0:n.entity)==null?void 0:_.name,isCached:(a==null?void 0:a.hasCache)||!1,cloud:(a==null?void 0:a.cloud)||!1})}),h.jsx(LF,{options:(S=n==null?void 0:n.entity)==null?void 0:S.options,onChangeOptions:m,className:"mt-2"}),v]})]}),f?h.jsx(hE,{className:"rounded-lg"}):void 0]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})}),Uy=g.memo(({tags:e,disabled:t,loading:n,onSubmit:r})=>{const{t:a}=ke("components"),o=async i=>{try{return await r(i),!0}catch{return!1}};return h.jsxs(Gt,{className:"min-w-80",children:[h.jsx(Mn,{children:h.jsx($n,{children:a("add_message_card.title")})}),h.jsxs(kn,{children:[h.jsx("div",{className:"grid w-full gap-1.5",children:h.jsx(w0,{onSubmit:o,disabled:t||n,placeholder:a("add_message_card.placeholder")})}),e?h.jsx("div",{className:"mt-2 gap-1 flex flex-wrap",children:e}):null]})]})}),VE=(e,t,n,r=[],a)=>{const o=e.map(i=>a.getNode(i));for(const i of o){if(!i)continue;const s=a.getHandleConnections({type:"target",nodeId:i.id});if(n.push(...s),i.type===ie.Thread){r.push(i.id),t.push(i);continue}else if(i.type!==ie.Message){r.push(i.id);continue}else if(r.includes(i.id))continue;r.push(i.id),t.push(i),s.length&&VE(s.map(c=>c.source),t,n,r,a)}return{nodes:t,connections:n}},qE=(e,t)=>{const n=t.getHandleConnections({nodeId:e.id,type:"target"}),r=n.map(d=>{const p=t.getNode(d.source);return p?{connections:t.getHandleConnections({nodeId:p.id,type:"target"}),node:p}:void 0}),a=r.filter(d=>{var p;return((p=d.node)==null?void 0:p.type)===ie.Prompt}),o=[];a!=null&&a.length&&a.forEach(d=>{var f;const p=(f=d.connections)==null?void 0:f.map(m=>t.getNode(m.source)).filter(Boolean);o.push({node:d.node,connections:d.connections,connectedNodes:p})});const i=r.filter(d=>{var p;return((p=d.node)==null?void 0:p.type)===ie.ToolDefinition}),s=[];i!=null&&i.length&&i.forEach(d=>{var f;const p=(f=d.connections)==null?void 0:f.map(m=>t.getNode(m.source)).filter(Boolean);p!=null&&p.find(m=>m.type===ie.Schema)&&s.push({node:d.node,connections:d.connections,connectedNodes:p})});const c=r.filter(d=>{var p;return((p=d.node)==null?void 0:p.type)===ie.PlaceHolder}),l=[];c!=null&&c.length&&c.forEach(d=>{var f;const p=(f=d.connections)==null?void 0:f.map(m=>t.getNode(m.source)).filter(Boolean);p&&l.push({node:d.node,connections:d.connections,connectedNodes:p})});const u=r.find(d=>{var p;return((p=d.node)==null?void 0:p.type)===ie.Schema});return{thread:{node:e,connections:n},llm:r.find(d=>{var p;return((p=d.node)==null?void 0:p.type)===ie.LLM}),schemas:u?[u]:[],prompts:o,tools:s,placeholders:l}},WE=e=>{const t=[];return e.forEach(n=>{var o,i,s;const{node:r,connectedNodes:a}=n;if((o=r.data)!=null&&o.entity){if(r.type===ie.Message){const c=r.data.entity;switch(c.role){case"human":t.push(new Ur(c.content));break;case"ai":t.push(new Aa(c.content));break}}else if(r.type===ie.Prompt){const c=r.data.entity;let l=`${c.prefix?`${c.prefix}
`:""}`;if(c.type===fr.FewShotExample){const u=(s=(i=a.find(d=>d.type===ie.CSVData))==null?void 0:i.data)==null?void 0:s.entity;if(u){const{rows:d}=JG(u.headers,u.csv);d.forEach(p=>{l+=`${c.content.replace(/{([^{}]*)}/g,(f,m)=>`${p[m]}`)}
`})}}else l+=c.content;switch(c.suffix&&(l+=`
${c.suffix}`),c.role){case"human":t.push(new Ur(l));break;case"system":t.push(new kv(l));break;default:t.push(new Aa(l));break}}}}),t},z7=(e,t)=>{const n=(e==null?void 0:e.filter(a=>a.type===ie.Message).map(a=>({node:a,connectedNodes:[]})).reverse())||[],r=[];return t.forEach(async a=>{r.unshift({node:a.node,connectedNodes:a.connectedNodes||[]})}),{history:WE(n),systems:WE(r)}},U7=e=>e?e.reduce((t,n)=>{var o,i,s,c,l;const r=(o=n.node.data)==null?void 0:o.entity,a=(c=(s=(i=n==null?void 0:n.connectedNodes)==null?void 0:i.find(u=>u.type===ie.Schema))==null?void 0:s.data)==null?void 0:c.entity;return r&&((l=a==null?void 0:a.schema_items)!=null&&l.length)&&t.push({name:r.name,description:r.description,schemaItems:a.schema_items}),t},[]):[],HE=({getNode:e,getHandleConnections:t})=>{const{t:n}=ke("create_new_message"),[r,a]=g.useState(!1),o=Je(m=>m.currentSession),i=Ie(m=>m.createOrUpdateFlowNode),s=Ie(m=>m.createOrUpdateFlowEdge),{similaritySearchWithScore:c}=rp(),{stream:l}=nl(),u=g.useCallback(async({content:m,threadId:y,sourceId:v,initialX:b,initialY:w,initialLLMId:j})=>{if(!o)throw new Error("Session is not found");const x=await ue("Message").save({thread_id:y,content:m,role:pr.Human,status:Hr.Started,llm_id:j,session_id:o.id});if(!x)throw new Error("Failed to save message");const _=await i({source_id:x.id,source_type:"Message",node_type:ie.Message,x:b,y:w+80});if(!_)throw new Error("Failed to save human message node");await s({source:v,target:_.id});const S=await ue("Message").save({thread_id:y,content:n("initial_ai_message"),role:pr.AI,status:Hr.Inprogress,llm_id:j,parent_message_id:x.id,session_id:o.id});if(!S)throw new Error("Failed to save message");const E=await i({source_id:S.id,source_type:"Message",node_type:ie.Message,x:b,y:w+250});if(!E)throw new Error("Failed to save ai message node");return await s({source:_.id,target:E.id}),{aiMessage:S,humanMessage:x,aiMessageNode:E,humanMessageNode:_}},[s,i,o,n]),d=g.useCallback(async(m,y)=>{const{placeholders:v}=y;if(!(v!=null&&v.length))return[];const b=[];return await Promise.all(v.map(async w=>{var x,_,S,E,O,N,M,k,P,A,C,I;const j=(x=w.node.data)==null?void 0:x.entity;if(j)switch(j.placeholder_type){case Xi.VECTOR_DATABASE_RETREIVER:{const T=(_=w.connectedNodes)==null?void 0:_.find(U=>U.type===ie.VectorDatabase),R=(S=T==null?void 0:T.data)==null?void 0:S.entity,L=(N=(O=(E=w.connectedNodes)==null?void 0:E.find(U=>U.type===ie.Prompt))==null?void 0:O.data)==null?void 0:N.entity;if(!L||!R||!T)return;const D=(M=j.metadata)!=null&&M.k?+((k=j.metadata)==null?void 0:k.k):1;let z=(P=j.metadata)!=null&&P.minimalScore?+((A=j.metadata)==null?void 0:A.minimalScore):void 0;z&&z>1&&(z=z/100);const B=[];if(R.storage===Vr.DataNode){const U=(I=(C=t({nodeId:T.id,type:"target"}).map(F=>e(F.source)).find(F=>(F==null?void 0:F.type)&&[ie.JSONLData,ie.CSVData].includes(F==null?void 0:F.type)))==null?void 0:C.data)==null?void 0:I.entity;if(!U)return;B.push(...await c(void 0,{database:{databaseId:R.id,dataSourceId:U.id,dataSourceType:WM(U)}},m.humanMessage.content,D)||[])}else B.push(...await c(void 0,{database:{databaseId:R.id}},m.humanMessage.content,D)||[]);if(!B)return[];const $=new oi({template:L.content,inputVariables:["context"]});b.push(new Aa(await $.format({context:z?B.filter(([,U])=>U>=z).map(([U])=>U.pageContent).join(`
`):B.map(([U])=>U.pageContent).join(`
`)})))}}})),b},[t,e,c]),p=g.useCallback(async(m,y,v,{onMessageUpdate:b})=>{var I;const{prompts:w,tools:j,schemas:x,placeholders:_,llm:S}=y,E=(I=S==null?void 0:S.node.data)==null?void 0:I.entity;if(!E)throw new Error("LLM is not found");const O=[];_!=null&&_.length&&O.push(...await d(m,y));const{history:N,systems:M}=z7(v,w),k=[...M,...O,...N,new Ur(m.humanMessage.content)],P=x.map(T=>{var R;return(R=T.node.data)==null?void 0:R.entity}).filter(Boolean),{lastChunk:A,content:C}=await l(E.provider,k,{tools:U7(j),schemas:P,llm:E,onMessageUpdate:({content:T})=>{b==null||b({id:m.aiMessageNode.id,nodeData:{loading:!0,content:T}})}});return m.aiMessage.content=C,m.aiMessage.metadata=JSON.stringify({message:A}),b==null||b({id:m.aiMessageNode.id,nodeData:{content:C,loading:!1,entity:m.aiMessage}}),m.aiMessage.id&&await ue("Message").update(m.aiMessage.id,{content:C,metadata:JSON.stringify({message:A})}),C},[d,l]),f=g.useCallback(async(m,y,v)=>{var S,E,O;const{nodes:b}=VE([m.id],[],[],[],{getNode:e,getHandleConnections:t}),w=b.find(N=>N.type===ie.Thread),j=w==null?void 0:w.data.entity;if(!m||!j||!w)throw new Error("Source or thread is not found");const x=qE(w,{getNode:e,getHandleConnections:t});if(!(x!=null&&x.thread))throw new Error("Thread node is not found");let _;try{a(!0);const N=((S=m.position)==null?void 0:S.x)||0,M=(((E=m.position)==null?void 0:E.y)||0)+(((O=m.measured)==null?void 0:O.height)||0);return _=await u({content:y,initialX:N,initialY:M,sourceId:m.id,threadId:j.id,initialLLMId:j.initial_llm_id}),await p(_,x,b,v),await ue("Message").update(`${_.aiMessage.id}`,{status:Hr.Success}),_.aiMessage.status=Hr.Success,v.onMessageUpdate({id:_.aiMessageNode.id,nodeData:{entity:_.aiMessage,loading:!1}}),!0}catch(N){Ws(N),_!=null&&_.aiMessage&&await ue("Message").update(`${_.aiMessage.id}`,{status:Hr.Failed,content:n("errors.ai_message_content_failed")}),_!=null&&_.aiMessageNode.id&&(v==null||v.onMessageUpdate({id:_.aiMessageNode.id,nodeData:{content:n("errors.ai_message_content_failed"),entity:{..._.aiMessage,status:Hr.Failed,content:n("errors.ai_message_content_failed")},loading:!1}}))}finally{a(!1)}},[t,e,u,p,n]);return{loading:r,createMessage:f}},V7=(e,t)=>{const n=In(e),{t:r}=ke("flows"),{getNode:a,getHandleConnections:o}=br(),i=Ie(p=>p.updateNodes),{createMessage:s,loading:c}=HE({getNode:a,getHandleConnections:o}),l=g.useCallback(p=>{if(!p.id)return;const f=a(p.id);!f||!p.nodeData||i([{id:f.id,type:"replace",item:{...f,data:{...f.data,...rd(p.nodeData,ad)}}}])},[a,i]),u=g.useCallback(async p=>{if(n&&t.entity)try{await s(n,p,{onMessageUpdate:l})}catch(f){if(f instanceof Error&&f.message.includes("LLM_NOT_LOADED_YET"))return au({variant:"destructive",title:r("thread_node.errors.llm_not_loaded_yet")});au({variant:"destructive",title:`${f}`})}},[n,t.entity,s,l,r]),d=g.useCallback(p=>{const f=a(p);if(!f)return[];const m=[],y=qE(f,{getNode:a,getHandleConnections:o});return y.thread&&m.push({node:y.thread.node,connectedNodes:[],connections:y.thread.connections}),y.prompts&&m.push(...y.prompts.map(v=>({node:v.node,connectedNodes:v.connectedNodes,connections:v.connections}))),y.schemas&&m.push(...y.schemas.map(v=>({node:v.node,connectedNodes:[],connections:v.connections}))),y.placeholders&&y.placeholders.forEach(v=>{const b=v.connections.map(w=>a(w.source)).filter(Boolean);m.push({node:v.node,connectedNodes:b||[],connections:v.connections})}),y.llm&&m.push(y.llm),m},[o,a]);return{loading:c,createMessage:u,getLinkedConnections:d}},q7=e=>{const t=Ie(r=>r.createOrUpdateFlowEdge),n=g.useCallback(async({edgeId:r,source:a,target:o,connection:i})=>{try{if((a==null?void 0:a.type)===ie.Prompt&&(o==null?void 0:o.type)===ie.Thread){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}else if((a==null?void 0:a.type)===ie.LLM&&(o==null?void 0:o.type)===ie.Thread){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}else if((a==null?void 0:a.type)===ie.Schema&&(o==null?void 0:o.type)===ie.Thread){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}else if((a==null?void 0:a.type)===ie.ToolDefinition&&(o==null?void 0:o.type)===ie.Thread){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}else if((a==null?void 0:a.type)===ie.VectorDatabase&&(o==null?void 0:o.type)===ie.Thread){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}else if((a==null?void 0:a.type)===ie.PlaceHolder&&(o==null?void 0:o.type)===ie.Thread&&a.data.entity.placeholder_type===Xi.VECTOR_DATABASE_RETREIVER){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},W7=g.memo(e=>{const{id:t,data:n,isConnectable:r}=e,{t:a}=ke("flows"),[o,i]=g.useState(!1),s=bm({type:"source"}),c=bm({type:"target"}),{getNode:l}=br(),{loading:u,createMessage:d,getLinkedConnections:p}=V7(t,n);q7(t);const f=g.useCallback(async(...b)=>(i(!1),await d(...b)),[d]),m=g.useMemo(()=>s.length>0,[s]),y=g.useCallback(()=>{i(b=>!b)},[]),v=g.useMemo(()=>{var w,j;const b=c.map((x,_)=>{var E;const S=l(x.source);if((S==null?void 0:S.type)===ie.Schema)return h.jsx(bn,{children:a("thread_node.structured_output")},`${_}`);if((S==null?void 0:S.type)===ie.Prompt){const O=S.data.entity;return h.jsx(bn,{children:a(O.type===fr.FewShotExample?"thread_node.prompts.few_shot_example":`thread_node.prompts.${O.role.toLowerCase()}`)},`${_}`)}else if((S==null?void 0:S.type)===ie.PlaceHolder&&((E=S.data.entity)==null?void 0:E.placeholder_type)===Xi.VECTOR_DATABASE_RETREIVER)return h.jsx(bn,{children:a("thread_node.vector_database_retriever")},`${_}`)}).filter(Boolean);return e.data.entity&&!((j=(w=e.data.entity)==null?void 0:w.messages)!=null&&j.length)&&!m?h.jsx(Uy,{disabled:u,loading:u,onSubmit:f,tags:b}):b!=null&&b.length?h.jsxs(Gt,{className:"p-4 pt-2",children:[h.jsx($n,{className:"mb-2",children:a("thread_node.title")}),h.jsx("div",{className:"flex gap-1.5",children:b}),h.jsx("div",{className:"mt-4 w-full flex justify-end",children:h.jsxs(Ye,{onClick:y,variant:"outline",children:[h.jsx(pe,{name:o?"copy-minus":"copy-plus"}),a(o?"thread_node.hide":"thread_node.clone")]})})]}):h.jsx("div",{className:"w-12 h-10"})},[m,l,f,y,u,e.data.entity,o,a,c]);return h.jsxs("div",{children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsxs("div",{children:[h.jsx(Bn,{id:t,enableToStandalone:!0,getLinkedConnections:p}),v,o?h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),h.jsx("div",{className:"absolute mt-[30px] w-full",children:h.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:h.jsx(Uy,{disabled:u,loading:u,onSubmit:f})})})]}):void 0]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})});function B1e({data:e,onNewThread:t,loading:n,showThread:r}){var o;const{t:a}=ke("flows");return h.jsxs(Ar,{className:"flex min-w-52",children:[h.jsx(pe,{size:24,name:"user"}),h.jsxs("div",{className:"ml-2 max-w-full w-full",children:[h.jsx(Uo,{children:"Human"}),h.jsx(pl,{children:`${e.content||((o=e.entity)==null?void 0:o.content)||""}`}),t?h.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:h.jsxs(Ye,{onClick:t,disabled:n,variant:"outline",children:[h.jsx(pe,{name:r?"minus":"plus",size:16}),a(r?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]})]})}function z1e({data:e,onNewThread:t,loading:n,showThread:r}){var c,l,u,d,p,f,m,y,v;const{t:a}=ke("flows"),o=g.useMemo(()=>{var b;try{return JSON.parse(((b=e==null?void 0:e.entity)==null?void 0:b.metadata)||"{}")}catch{return{}}},[(c=e==null?void 0:e.entity)==null?void 0:c.metadata]),i=e.entity.status===Hr.Failed,s=g.useMemo(()=>{var b;return h.jsx(IS,{source:`${e.content||((b=e.entity)==null?void 0:b.content)||""}`})},[e.content,(l=e.entity)==null?void 0:l.content]);return h.jsxs(Ar,{className:Z("flex min-w-52",i?"bg-background":""),variant:i?"destructive":"default",children:[h.jsx(pe,{className:Z(e.loading?"animate-spin":void 0),size:24,name:e.loading?"loader-circle":"bot"}),h.jsx(pe,{name:r?"minus":"plus",size:24}),h.jsxs("div",{className:"ml-2 w-full max-w-full",children:[h.jsx(Uo,{children:a(`message_node.message_roles.${(d=(u=e.entity)==null?void 0:u.role)==null?void 0:d.toLowerCase()}`)}),h.jsx(g.Suspense,{fallback:h.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:h.jsx(pe,{name:"loader-circle",className:"animate-spin"})}),children:i?e.content||((p=e.entity)==null?void 0:p.content)||"":s}),Array.isArray((f=o==null?void 0:o.message)==null?void 0:f.tool_calls)&&((y=(m=o==null?void 0:o.message)==null?void 0:m.tool_calls)!=null&&y.length)?(v=o==null?void 0:o.message)==null?void 0:v.tool_calls.map((b,w)=>h.jsx(bn,{children:a("message_node.tool_call",{name:b.name,args:Object.entries(b.args).map(([j,x])=>`"${j}": "${x}"`).join(", ")})},`${b.name}_${w}`)):null,t?h.jsx("div",{className:"w-full mt-2 flex items-center justify-end",children:h.jsxs(Ye,{onClick:t,disabled:n,variant:"outline",children:[h.jsx(pe,{name:r?"minus":"plus",size:16}),a(r?"message_node.hide_thread":"message_node.new_thread")]})}):void 0]}),e.loading?h.jsx(hE,{size:350,duration:10}):void 0]})}const U1e=e=>{const{t}=ke("flows"),n=In(e),r=Ie(u=>u.updateNodes),{getNode:a,getHandleConnections:o}=br(),{createMessage:i,loading:s}=HE({getNode:a,getHandleConnections:o}),c=g.useCallback(u=>{if(!u.id)return;const d=a(u.id);!d||!u.nodeData||r([{id:d.id,type:"replace",item:{...d,data:{...d.data,...rd(u.nodeData,ad)}}}])},[a,r]),l=g.useCallback(async u=>{if(n)try{await i(n,u,{onMessageUpdate:c})}catch(d){if(d instanceof Error&&d.message.includes("LLM_NOT_LOADED_YET"))return au({variant:"destructive",title:t("message_node.errors.llm_not_loaded_yet")});au({variant:"destructive",title:t("message_node.errors.create_message")})}},[n,t,i,c]);return{loading:s,createMessage:l}},H7=()=>{const e=Je(r=>r.currentSession),t=Ie(r=>r.createOrUpdateFlowNode),n=Ie(r=>r.createOrUpdateFlowEdge);return{createIdieMessage:g.useCallback(async(r,a,o,i)=>{var m,y,v,b,w;if(!r||!a||!e)return;const s=(y=(m=i==null?void 0:i.promptNode)==null?void 0:m.data)==null?void 0:y.entity,c=((v=r.position)==null?void 0:v.x)||0,l=(((b=r.position)==null?void 0:b.y)||0)+(((w=r.measured)==null?void 0:w.height)||0),u=await ue("Message").save({thread_id:a.id,content:o,role:(s==null?void 0:s.role)||pr.Human,status:Hr.Started,llm_id:a.initial_llm_id,session_id:e.id});if(!u)throw new Error("Failed to save message");const d=await t({source_id:u.id,source_type:"Message",node_type:ie.Message,x:c,y:l});if(!d)throw new Error("Failed to save message node");const p=await n({source:r.id,target:d.id});let f;return i!=null&&i.promptNode&&(f=await n({source:i==null?void 0:i.promptNode.id,target:d.id})),{message:u,edgeToPrompt:f,messageNode:d,messageEdge:p}},[t,n])}},V1e=e=>{const{createIdieMessage:t}=H7(),n=g.useCallback(async({edgeId:r,source:a,target:o})=>{var i,s;try{if((a==null?void 0:a.type)===ie.Prompt&&(o==null?void 0:o.type)===ie.Message){const c=(i=o==null?void 0:o.data)==null?void 0:i.entity,l=(s=a==null?void 0:a.data)==null?void 0:s.entity;if(!l||!c||!o)return{deleteEdgeId:r};await t(o,{id:c==null?void 0:c.thread_id,title:"",status:Nf.Started,initial_llm_id:c.llm_id,session_id:l.session_id},l.content,{promptNode:a});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},q1e=g.memo(e=>{var j,x,_;const{id:t,data:n,isConnectable:r}=e,[a,o]=g.useState(!1),[i,s]=g.useState(!1),{t:c}=ke("common"),l=bm({type:"source"}),{loading:u,createMessage:d}=U1e(t),{toast:p}=nn();V1e(t);const f=g.useCallback(async(...S)=>{const E=await d(...S);return o(!1),E},[d]),m=g.useMemo(()=>l.length===0,[l]),y=g.useCallback(()=>{var S;(S=n.entity)!=null&&S.content&&(navigator.clipboard.writeText(n.entity.content),p({description:c("copied")}))},[p,n,c]),v=g.useCallback(async()=>{var S;try{if(i)return await qM.stop(),s(!1);s(!0),await qM.speak(((S=n.entity)==null?void 0:S.content)||"")}catch{p({variant:"destructive",description:c("errors.speech_is_not_supported")})}finally{s(!1)}},[(j=n.entity)==null?void 0:j.content,i,c,p]),b=g.useCallback(()=>{o(S=>!S)},[]),w=g.useMemo(()=>{var S;if(!(!m&&!a||n.loading||u||((S=n==null?void 0:n.entity)==null?void 0:S.status)==="inprogress"))return h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"w-[1px] absolute ml-[50%] h-[30px] bg-gray-500"}),h.jsx("div",{className:"absolute mt-[30px] w-full",children:h.jsx("div",{className:"ml-[10%] w-80 animate-in slide-in-from-bottom-5",children:h.jsx(Uy,{disabled:u,loading:u,onSubmit:f})})})]})},[(x=n==null?void 0:n.entity)==null?void 0:x.status,n.loading,f,m,u,a]);return h.jsxs("div",{children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsxs("div",{className:"max-w-sm min-w-64",children:[h.jsxs("div",{className:"w-auto",children:[h.jsx(Bn,{id:t}),h.jsx("div",{children:((_=n.entity)==null?void 0:_.role)===pr.Human?h.jsx(B1e,{data:n,showThread:a,onNewThread:m?void 0:b}):h.jsx(z1e,{data:n,showThread:a,loading:u,onNewThread:m?void 0:b})}),h.jsx(Ye,{onClick:v,className:"absolute top-0 right-[68px] !px-2 !rounded-none",variant:"ghost",children:h.jsx(pe,{name:i?"circle-stop":"speech",size:16})}),h.jsx(Ye,{onClick:y,className:"absolute top-0 right-[36px] !px-2 !rounded-none",variant:"ghost",children:h.jsx(pe,{name:"copy",size:16})})]}),w]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})}),W1e=e=>{const t=Ie(a=>a.createOrUpdateFlowEdge),{createIdieMessage:n}=H7(),r=g.useCallback(async({edgeId:a,source:o,target:i})=>{var s,c,l,u;try{const d=(s=i==null?void 0:i.data)==null?void 0:s.entity,p=(c=o==null?void 0:o.data)==null?void 0:c.entity;if((o==null?void 0:o.type)===ie.Message&&(i==null?void 0:i.type)===ie.Prompt){const f=(l=o==null?void 0:o.data)==null?void 0:l.entity,m=(u=i==null?void 0:i.data)==null?void 0:u.entity;if(!m||!f||!i)return{deleteEdgeId:a};await n(o,{id:f==null?void 0:f.thread_id,title:"",status:Nf.Started,initial_llm_id:f.llm_id,session_id:m.session_id},m.content,{promptNode:i});return}else if((o==null?void 0:o.type)===ie.CSVData&&(i==null?void 0:i.type)===ie.Prompt&&(d==null?void 0:d.type)===fr.FewShotExample&&(p!=null&&p.headers.includes("input"))&&(p!=null&&p.headers.includes("output"))){await t({source:o.id,target:i.id});return}return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[n,t]);qn(e,r)},H1e=g.memo(e=>{var l,u,d;const{id:t,data:n,isConnectable:r}=e;W1e(t);const a=tn(nz),o=g.useMemo(()=>{var p,f,m;return`${(p=n.entity)!=null&&p.prefix?`${(f=n.entity)==null?void 0:f.prefix}
`:""}${((m=n.entity)==null?void 0:m.content)||""}`},[(l=n.entity)==null?void 0:l.prefix,(u=n.entity)==null?void 0:u.content]),i=g.useMemo(()=>{var f;const p=/{(.*?)}/g;return((f=o.match(p))==null?void 0:f.map(m=>m.replace("{","").replace("}","")))||[]},[o]),s=o.length>990,c=()=>{a.show({title:"Prompt",content:o})};return h.jsxs("div",{className:"min-w-56",children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsxs("div",{children:[h.jsx(Bn,{id:t}),h.jsxs(Ar,{className:"flex justify-center max-w-72",variant:"default",children:[h.jsx(pe,{size:24,name:"notepad-text"}),h.jsxs("div",{className:"ml-2 max-w-full break-words break-all",children:[h.jsx(Uo,{children:`${((d=n.entity)==null?void 0:d.role)||""}`}),h.jsxs(pl,{onClick:s?c:void 0,children:[s?`${o.slice(0,990)}...`:o,s?h.jsx("span",{className:"float-right",children:h.jsx(pe,{name:"chevron-right"})}):void 0]}),i!=null&&i.length?i.map((p,f)=>h.jsx(bn,{className:"mt-2 mr-1",variant:"default",children:p},f)):void 0]})]})]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})});var K1e=d3();const Tr=st(K1e);var KE,K7;function Z1e(){if(K7)return KE;K7=1;function e(t){return t==null}return KE=e,KE}var G1e=Z1e();const wt=st(G1e);var ZE,Z7;function X1e(){if(Z7)return ZE;Z7=1;var e=ko(),t=Wn(),n=Ta(),r="[object String]";function a(o){return typeof o=="string"||!t(o)&&n(o)&&e(o)==r}return ZE=a,ZE}var J1e=X1e();const hp=st(J1e);var Y1e=wf();const at=st(Y1e);var Q1e=Wr();const fl=st(Q1e);var G7={exports:{}},xt={},X7;function e_e(){if(X7)return xt;X7=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),s=Symbol.for("react.server_context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.for("react.offscreen"),m;m=Symbol.for("react.module.reference");function y(v){if(typeof v=="object"&&v!==null){var b=v.$$typeof;switch(b){case e:switch(v=v.type,v){case n:case a:case r:case l:case u:return v;default:switch(v=v&&v.$$typeof,v){case s:case i:case c:case p:case d:case o:return v;default:return b}}case t:return b}}}return xt.ContextConsumer=i,xt.ContextProvider=o,xt.Element=e,xt.ForwardRef=c,xt.Fragment=n,xt.Lazy=p,xt.Memo=d,xt.Portal=t,xt.Profiler=a,xt.StrictMode=r,xt.Suspense=l,xt.SuspenseList=u,xt.isAsyncMode=function(){return!1},xt.isConcurrentMode=function(){return!1},xt.isContextConsumer=function(v){return y(v)===i},xt.isContextProvider=function(v){return y(v)===o},xt.isElement=function(v){return typeof v=="object"&&v!==null&&v.$$typeof===e},xt.isForwardRef=function(v){return y(v)===c},xt.isFragment=function(v){return y(v)===n},xt.isLazy=function(v){return y(v)===p},xt.isMemo=function(v){return y(v)===d},xt.isPortal=function(v){return y(v)===t},xt.isProfiler=function(v){return y(v)===a},xt.isStrictMode=function(v){return y(v)===r},xt.isSuspense=function(v){return y(v)===l},xt.isSuspenseList=function(v){return y(v)===u},xt.isValidElementType=function(v){return typeof v=="string"||typeof v=="function"||v===n||v===a||v===r||v===l||v===u||v===f||typeof v=="object"&&v!==null&&(v.$$typeof===p||v.$$typeof===d||v.$$typeof===o||v.$$typeof===i||v.$$typeof===c||v.$$typeof===m||v.getModuleId!==void 0)},xt.typeOf=y,xt}var J7;function t_e(){return J7||(J7=1,G7.exports=e_e()),G7.exports}var n_e=t_e(),GE,Y7;function Q7(){if(Y7)return GE;Y7=1;var e=ko(),t=Ta(),n="[object Number]";function r(a){return typeof a=="number"||t(a)&&e(a)==n}return GE=r,GE}var XE,eU;function r_e(){if(eU)return XE;eU=1;var e=Q7();function t(n){return e(n)&&n!=+n}return XE=t,XE}var a_e=r_e();const mp=st(a_e);var o_e=Q7();const i_e=st(o_e);var Ea=function(e){return e===0?0:e>0?1:-1},Cs=function(e){return hp(e)&&e.indexOf("%")===e.length-1},ye=function(e){return i_e(e)&&!mp(e)},hn=function(e){return ye(e)||hp(e)},s_e=0,Vy=function(e){var t=++s_e;return"".concat(e||"").concat(t)},Ns=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!ye(e)&&!hp(e))return n;var a;if(Cs(e)){var o=e.indexOf("%");a=t*parseFloat(e.slice(0,o))/100}else a=+e;return mp(a)&&(a=n),r&&a>t&&(a=t),a},Ti=function(e){if(!e)return null;var t=Object.keys(e);return t&&t.length?e[t[0]]:null},c_e=function(e){if(!Array.isArray(e))return!1;for(var t=e.length,n={},r=0;r<t;r++)if(!n[e[r]])n[e[r]]=!0;else return!0;return!1},hl=function(e,t){return ye(e)&&ye(t)?function(n){return e+n*(t-e)}:function(){return t}};function JE(e,t,n){return!e||!e.length?null:e.find(function(r){return r&&(typeof t=="function"?t(r):Tr(r,t))===n})}function ml(e,t){for(var n in e)if({}.hasOwnProperty.call(e,n)&&(!{}.hasOwnProperty.call(t,n)||e[n]!==t[n]))return!1;for(var r in t)if({}.hasOwnProperty.call(t,r)&&!{}.hasOwnProperty.call(e,r))return!1;return!0}function YE(e){"@babel/helpers - typeof";return YE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YE(e)}var l_e=["viewBox","children"],u_e=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],tU=["points","pathLength"],QE={svg:l_e,polygon:tU,polyline:tU},eO=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],qy=function(e,t){if(!e||typeof e=="function"||typeof e=="boolean")return null;var n=e;if(g.isValidElement(e)&&(n=e.props),!fl(n))return null;var r={};return Object.keys(n).forEach(function(a){eO.includes(a)&&(r[a]=t||function(o){return n[a](n,o)})}),r},d_e=function(e,t,n){return function(r){return e(t,n,r),null}},Wy=function(e,t,n){if(!fl(e)||YE(e)!=="object")return null;var r=null;return Object.keys(e).forEach(function(a){var o=e[a];eO.includes(a)&&typeof o=="function"&&(r||(r={}),r[a]=d_e(o,t,n))}),r},p_e=["children"],f_e=["children"];function nU(e,t){if(e==null)return{};var n=h_e(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function h_e(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}var rU={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"},qo=function(e){return typeof e=="string"?e:e?e.displayName||e.name||"Component":""},aU=null,tO=null,nO=function e(t){if(t===aU&&Array.isArray(tO))return tO;var n=[];return g.Children.forEach(t,function(r){wt(r)||(n_e.isFragment(r)?n=n.concat(e(r.props.children)):n.push(r))}),tO=n,aU=t,n};function Oa(e,t){var n=[],r=[];return Array.isArray(t)?r=t.map(function(a){return qo(a)}):r=[qo(t)],nO(e).forEach(function(a){var o=Tr(a,"type.displayName")||Tr(a,"type.name");r.indexOf(o)!==-1&&n.push(a)}),n}function jr(e,t){var n=Oa(e,t);return n&&n[0]}var oU=function(e){if(!e||!e.props)return!1;var t=e.props,n=t.width,r=t.height;return!(!ye(n)||n<=0||!ye(r)||r<=0)},m_e=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],y_e=function(e){return e&&e.type&&hp(e.type)&&m_e.indexOf(e.type)>=0},g_e=function(e,t,n,r){var a,o=(a=QE==null?void 0:QE[r])!==null&&a!==void 0?a:[];return!at(e)&&(r&&o.includes(t)||u_e.includes(t))||n&&eO.includes(t)},bt=function(e,t,n){if(!e||typeof e=="function"||typeof e=="boolean")return null;var r=e;if(g.isValidElement(e)&&(r=e.props),!fl(r))return null;var a={};return Object.keys(r).forEach(function(o){var i;g_e((i=r)===null||i===void 0?void 0:i[o],o,t,n)&&(a[o]=r[o])}),a},rO=function e(t,n){if(t===n)return!0;var r=g.Children.count(t);if(r!==g.Children.count(n))return!1;if(r===0)return!0;if(r===1)return iU(Array.isArray(t)?t[0]:t,Array.isArray(n)?n[0]:n);for(var a=0;a<r;a++){var o=t[a],i=n[a];if(Array.isArray(o)||Array.isArray(i)){if(!e(o,i))return!1}else if(!iU(o,i))return!1}return!0},iU=function(e,t){if(wt(e)&&wt(t))return!0;if(!wt(e)&&!wt(t)){var n=e.props||{},r=n.children,a=nU(n,p_e),o=t.props||{},i=o.children,s=nU(o,f_e);return r&&i?ml(a,s)&&rO(r,i):!r&&!i?ml(a,s):!1}return!1},sU=function(e,t){var n=[],r={};return nO(e).forEach(function(a,o){if(y_e(a))n.push(a);else if(a){var i=qo(a.type),s=t[i]||{},c=s.handler,l=s.once;if(c&&(!l||!r[i])){var u=c(a,i,o);n.push(u),r[i]=!0}}}),n},v_e=function(e){var t=e&&e.type;return t&&rU[t]?rU[t]:null},b_e=function(e,t){return nO(t).indexOf(e)},w_e=["children","width","height","viewBox","className","style","title","desc"];function aO(){return aO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},aO.apply(this,arguments)}function x_e(e,t){if(e==null)return{};var n=__e(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function __e(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function oO(e){var t=e.children,n=e.width,r=e.height,a=e.viewBox,o=e.className,i=e.style,s=e.title,c=e.desc,l=x_e(e,w_e),u=a||{width:n,height:r,x:0,y:0},d=St("recharts-surface",o);return W.createElement("svg",aO({},bt(l,!0,"svg"),{className:d,width:n,height:r,style:i,viewBox:"".concat(u.x," ").concat(u.y," ").concat(u.width," ").concat(u.height)}),W.createElement("title",null,s),W.createElement("desc",null,c),t)}var j_e=["children","className"];function iO(){return iO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},iO.apply(this,arguments)}function S_e(e,t){if(e==null)return{};var n=E_e(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function E_e(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}var wn=W.forwardRef(function(e,t){var n=e.children,r=e.className,a=S_e(e,j_e),o=St("recharts-layer",r);return W.createElement("g",iO({className:o},bt(a,!0),{ref:t}),n)}),Wo=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a]},sO,cU;function O_e(){if(cU)return sO;cU=1;var e=T0();function t(n,r,a){var o=n.length;return a=a===void 0?o:a,!r&&a>=o?n:e(n,r,a)}return sO=t,sO}var cO,lU;function uU(){if(lU)return cO;lU=1;var e="\uD800-\uDFFF",t="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",a=t+n+r,o="\\ufe0e\\ufe0f",i="\\u200d",s=RegExp("["+i+e+a+o+"]");function c(l){return s.test(l)}return cO=c,cO}var lO,dU;function C_e(){if(dU)return lO;dU=1;function e(t){return t.split("")}return lO=e,lO}var uO,pU;function N_e(){if(pU)return uO;pU=1;var e="\uD800-\uDFFF",t="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",a=t+n+r,o="\\ufe0e\\ufe0f",i="["+e+"]",s="["+a+"]",c="\uD83C[\uDFFB-\uDFFF]",l="(?:"+s+"|"+c+")",u="[^"+e+"]",d="(?:\uD83C[\uDDE6-\uDDFF]){2}",p="[\uD800-\uDBFF][\uDC00-\uDFFF]",f="\\u200d",m=l+"?",y="["+o+"]?",v="(?:"+f+"(?:"+[u,d,p].join("|")+")"+y+m+")*",b=y+m+v,w="(?:"+[u+s+"?",s,d,p,i].join("|")+")",j=RegExp(c+"(?="+c+")|"+w+b,"g");function x(_){return _.match(j)||[]}return uO=x,uO}var dO,fU;function M_e(){if(fU)return dO;fU=1;var e=C_e(),t=uU(),n=N_e();function r(a){return t(a)?n(a):e(a)}return dO=r,dO}var pO,hU;function k_e(){if(hU)return pO;hU=1;var e=O_e(),t=uU(),n=M_e(),r=i3();function a(o){return function(i){i=r(i);var s=t(i)?n(i):void 0,c=s?s[0]:i.charAt(0),l=s?e(s,1).join(""):i.slice(1);return c[o]()+l}}return pO=a,pO}var fO,mU;function P_e(){if(mU)return fO;mU=1;var e=k_e(),t=e("toUpperCase");return fO=t,fO}var A_e=P_e();const Hy=st(A_e);function $t(e){return function(){return e}}const yU=Math.cos,Ky=Math.sin,Ca=Math.sqrt,Zy=Math.PI,Gy=2*Zy,hO=Math.PI,mO=2*hO,Ms=1e-6,T_e=mO-Ms;function gU(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function I_e(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return gU;const n=10**t;return function(r){this._+=r[0];for(let a=1,o=r.length;a<o;++a)this._+=Math.round(arguments[a]*n)/n+r[a]}}class R_e{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?gU:I_e(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,r,a){this._append`Q${+t},${+n},${this._x1=+r},${this._y1=+a}`}bezierCurveTo(t,n,r,a,o,i){this._append`C${+t},${+n},${+r},${+a},${this._x1=+o},${this._y1=+i}`}arcTo(t,n,r,a,o){if(t=+t,n=+n,r=+r,a=+a,o=+o,o<0)throw new Error(`negative radius: ${o}`);let i=this._x1,s=this._y1,c=r-t,l=a-n,u=i-t,d=s-n,p=u*u+d*d;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(p>Ms)if(!(Math.abs(d*c-l*u)>Ms)||!o)this._append`L${this._x1=t},${this._y1=n}`;else{let f=r-i,m=a-s,y=c*c+l*l,v=f*f+m*m,b=Math.sqrt(y),w=Math.sqrt(p),j=o*Math.tan((hO-Math.acos((y+p-v)/(2*b*w)))/2),x=j/w,_=j/b;Math.abs(x-1)>Ms&&this._append`L${t+x*u},${n+x*d}`,this._append`A${o},${o},0,0,${+(d*f>u*m)},${this._x1=t+_*c},${this._y1=n+_*l}`}}arc(t,n,r,a,o,i){if(t=+t,n=+n,r=+r,i=!!i,r<0)throw new Error(`negative radius: ${r}`);let s=r*Math.cos(a),c=r*Math.sin(a),l=t+s,u=n+c,d=1^i,p=i?a-o:o-a;this._x1===null?this._append`M${l},${u}`:(Math.abs(this._x1-l)>Ms||Math.abs(this._y1-u)>Ms)&&this._append`L${l},${u}`,r&&(p<0&&(p=p%mO+mO),p>T_e?this._append`A${r},${r},0,1,${d},${t-s},${n-c}A${r},${r},0,1,${d},${this._x1=l},${this._y1=u}`:p>Ms&&this._append`A${r},${r},0,${+(p>=hO)},${d},${this._x1=t+r*Math.cos(o)},${this._y1=n+r*Math.sin(o)}`)}rect(t,n,r,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${r=+r}v${+a}h${-r}Z`}toString(){return this._}}function yO(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);t=r}return e},()=>new R_e(t)}function gO(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function vU(e){this._context=e}vU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Xy(e){return new vU(e)}function bU(e){return e[0]}function wU(e){return e[1]}function xU(e,t){var n=$t(!0),r=null,a=Xy,o=null,i=yO(s);e=typeof e=="function"?e:e===void 0?bU:$t(e),t=typeof t=="function"?t:t===void 0?wU:$t(t);function s(c){var l,u=(c=gO(c)).length,d,p=!1,f;for(r==null&&(o=a(f=i())),l=0;l<=u;++l)!(l<u&&n(d=c[l],l,c))===p&&((p=!p)?o.lineStart():o.lineEnd()),p&&o.point(+e(d,l,c),+t(d,l,c));if(f)return o=null,f+""||null}return s.x=function(c){return arguments.length?(e=typeof c=="function"?c:$t(+c),s):e},s.y=function(c){return arguments.length?(t=typeof c=="function"?c:$t(+c),s):t},s.defined=function(c){return arguments.length?(n=typeof c=="function"?c:$t(!!c),s):n},s.curve=function(c){return arguments.length?(a=c,r!=null&&(o=a(r)),s):a},s.context=function(c){return arguments.length?(c==null?r=o=null:o=a(r=c),s):r},s}function Jy(e,t,n){var r=null,a=$t(!0),o=null,i=Xy,s=null,c=yO(l);e=typeof e=="function"?e:e===void 0?bU:$t(+e),t=typeof t=="function"?t:$t(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?wU:$t(+n);function l(d){var p,f,m,y=(d=gO(d)).length,v,b=!1,w,j=new Array(y),x=new Array(y);for(o==null&&(s=i(w=c())),p=0;p<=y;++p){if(!(p<y&&a(v=d[p],p,d))===b)if(b=!b)f=p,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),m=p-1;m>=f;--m)s.point(j[m],x[m]);s.lineEnd(),s.areaEnd()}b&&(j[p]=+e(v,p,d),x[p]=+t(v,p,d),s.point(r?+r(v,p,d):j[p],n?+n(v,p,d):x[p]))}if(w)return s=null,w+""||null}function u(){return xU().defined(a).curve(i).context(o)}return l.x=function(d){return arguments.length?(e=typeof d=="function"?d:$t(+d),r=null,l):e},l.x0=function(d){return arguments.length?(e=typeof d=="function"?d:$t(+d),l):e},l.x1=function(d){return arguments.length?(r=d==null?null:typeof d=="function"?d:$t(+d),l):r},l.y=function(d){return arguments.length?(t=typeof d=="function"?d:$t(+d),n=null,l):t},l.y0=function(d){return arguments.length?(t=typeof d=="function"?d:$t(+d),l):t},l.y1=function(d){return arguments.length?(n=d==null?null:typeof d=="function"?d:$t(+d),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(d){return arguments.length?(a=typeof d=="function"?d:$t(!!d),l):a},l.curve=function(d){return arguments.length?(i=d,o!=null&&(s=i(o)),l):i},l.context=function(d){return arguments.length?(d==null?o=s=null:s=i(o=d),l):o},l}class _U{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}function D_e(e){return new _U(e,!0)}function L_e(e){return new _U(e,!1)}const vO={draw(e,t){const n=Ca(t/Zy);e.moveTo(n,0),e.arc(0,0,n,0,Gy)}},$_e={draw(e,t){const n=Ca(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},jU=Ca(1/3),F_e=jU*2,B_e={draw(e,t){const n=Ca(t/F_e),r=n*jU;e.moveTo(0,-n),e.lineTo(r,0),e.lineTo(0,n),e.lineTo(-r,0),e.closePath()}},z_e={draw(e,t){const n=Ca(t),r=-n/2;e.rect(r,r,n,n)}},U_e=.8908130915292852,SU=Ky(Zy/10)/Ky(7*Zy/10),V_e=Ky(Gy/10)*SU,q_e=-yU(Gy/10)*SU,W_e={draw(e,t){const n=Ca(t*U_e),r=V_e*n,a=q_e*n;e.moveTo(0,-n),e.lineTo(r,a);for(let o=1;o<5;++o){const i=Gy*o/5,s=yU(i),c=Ky(i);e.lineTo(c*n,-s*n),e.lineTo(s*r-c*a,c*r+s*a)}e.closePath()}},bO=Ca(3),H_e={draw(e,t){const n=-Ca(t/(bO*3));e.moveTo(0,n*2),e.lineTo(-bO*n,-n),e.lineTo(bO*n,-n),e.closePath()}},Ir=-.5,Rr=Ca(3)/2,wO=1/Ca(12),K_e=(wO/2+1)*3,Z_e={draw(e,t){const n=Ca(t/K_e),r=n/2,a=n*wO,o=r,i=n*wO+n,s=-o,c=i;e.moveTo(r,a),e.lineTo(o,i),e.lineTo(s,c),e.lineTo(Ir*r-Rr*a,Rr*r+Ir*a),e.lineTo(Ir*o-Rr*i,Rr*o+Ir*i),e.lineTo(Ir*s-Rr*c,Rr*s+Ir*c),e.lineTo(Ir*r+Rr*a,Ir*a-Rr*r),e.lineTo(Ir*o+Rr*i,Ir*i-Rr*o),e.lineTo(Ir*s+Rr*c,Ir*c-Rr*s),e.closePath()}};function G_e(e,t){let n=null,r=yO(a);e=typeof e=="function"?e:$t(e||vO),t=typeof t=="function"?t:$t(t===void 0?64:+t);function a(){let o;if(n||(n=o=r()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),o)return n=null,o+""||null}return a.type=function(o){return arguments.length?(e=typeof o=="function"?o:$t(o),a):e},a.size=function(o){return arguments.length?(t=typeof o=="function"?o:$t(+o),a):t},a.context=function(o){return arguments.length?(n=o??null,a):n},a}function Yy(){}function Qy(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function EU(e){this._context=e}EU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Qy(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Qy(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function X_e(e){return new EU(e)}function OU(e){this._context=e}OU.prototype={areaStart:Yy,areaEnd:Yy,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Qy(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function J_e(e){return new OU(e)}function CU(e){this._context=e}CU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Qy(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Y_e(e){return new CU(e)}function NU(e){this._context=e}NU.prototype={areaStart:Yy,areaEnd:Yy,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Q_e(e){return new NU(e)}function MU(e){return e<0?-1:1}function kU(e,t,n){var r=e._x1-e._x0,a=t-e._x1,o=(e._y1-e._y0)/(r||a<0&&-0),i=(n-e._y1)/(a||r<0&&-0),s=(o*a+i*r)/(r+a);return(MU(o)+MU(i))*Math.min(Math.abs(o),Math.abs(i),.5*Math.abs(s))||0}function PU(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function xO(e,t,n){var r=e._x0,a=e._y0,o=e._x1,i=e._y1,s=(o-r)/3;e._context.bezierCurveTo(r+s,a+s*t,o-s,i-s*n,o,i)}function eg(e){this._context=e}eg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:xO(this,this._t0,PU(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,xO(this,PU(this,n=kU(this,e,t)),n);break;default:xO(this,this._t0,n=kU(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function AU(e){this._context=new TU(e)}(AU.prototype=Object.create(eg.prototype)).point=function(e,t){eg.prototype.point.call(this,t,e)};function TU(e){this._context=e}TU.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,a,o){this._context.bezierCurveTo(t,e,r,n,o,a)}};function eje(e){return new eg(e)}function tje(e){return new AU(e)}function IU(e){this._context=e}IU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=RU(e),a=RU(t),o=0,i=1;i<n;++o,++i)this._context.bezierCurveTo(r[0][o],a[0][o],r[1][o],a[1][o],e[i],t[i]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function RU(e){var t,n=e.length-1,r,a=new Array(n),o=new Array(n),i=new Array(n);for(a[0]=0,o[0]=2,i[0]=e[0]+2*e[1],t=1;t<n-1;++t)a[t]=1,o[t]=4,i[t]=4*e[t]+2*e[t+1];for(a[n-1]=2,o[n-1]=7,i[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=a[t]/o[t-1],o[t]-=r,i[t]-=r*i[t-1];for(a[n-1]=i[n-1]/o[n-1],t=n-2;t>=0;--t)a[t]=(i[t]-a[t+1])/o[t];for(o[n-1]=(e[n]+a[n-1])/2,t=0;t<n-1;++t)o[t]=2*e[t+1]-a[t+1];return[a,o]}function nje(e){return new IU(e)}function tg(e,t){this._context=e,this._t=t}tg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function rje(e){return new tg(e,.5)}function aje(e){return new tg(e,0)}function oje(e){return new tg(e,1)}function yl(e,t){if((i=e.length)>1)for(var n=1,r,a,o=e[t[0]],i,s=o.length;n<i;++n)for(a=o,o=e[t[n]],r=0;r<s;++r)o[r][1]+=o[r][0]=isNaN(a[r][1])?a[r][0]:a[r][1]}function _O(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function ije(e,t){return e[t]}function sje(e){const t=[];return t.key=e,t}function cje(){var e=$t([]),t=_O,n=yl,r=ije;function a(o){var i=Array.from(e.apply(this,arguments),sje),s,c=i.length,l=-1,u;for(const d of o)for(s=0,++l;s<c;++s)(i[s][l]=[0,+r(d,i[s].key,l,o)]).data=d;for(s=0,u=gO(t(i));s<c;++s)i[u[s]].index=s;return n(i,u),i}return a.keys=function(o){return arguments.length?(e=typeof o=="function"?o:$t(Array.from(o)),a):e},a.value=function(o){return arguments.length?(r=typeof o=="function"?o:$t(+o),a):r},a.order=function(o){return arguments.length?(t=o==null?_O:typeof o=="function"?o:$t(Array.from(o)),a):t},a.offset=function(o){return arguments.length?(n=o??yl,a):n},a}function lje(e,t){if((r=e.length)>0){for(var n,r,a=0,o=e[0].length,i;a<o;++a){for(i=n=0;n<r;++n)i+=e[n][a][1]||0;if(i)for(n=0;n<r;++n)e[n][a][1]/=i}yl(e,t)}}function uje(e,t){if((a=e.length)>0){for(var n=0,r=e[t[0]],a,o=r.length;n<o;++n){for(var i=0,s=0;i<a;++i)s+=e[i][n][1]||0;r[n][1]+=r[n][0]=-s/2}yl(e,t)}}function dje(e,t){if(!(!((i=e.length)>0)||!((o=(a=e[t[0]]).length)>0))){for(var n=0,r=1,a,o,i;r<o;++r){for(var s=0,c=0,l=0;s<i;++s){for(var u=e[t[s]],d=u[r][1]||0,p=u[r-1][1]||0,f=(d-p)/2,m=0;m<s;++m){var y=e[t[m]],v=y[r][1]||0,b=y[r-1][1]||0;f+=v-b}c+=d,l+=f*d}a[r-1][1]+=a[r-1][0]=n,c&&(n-=l/c)}a[r-1][1]+=a[r-1][0]=n,yl(e,t)}}function yp(e){"@babel/helpers - typeof";return yp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yp(e)}var pje=["type","size","sizeType"];function jO(){return jO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},jO.apply(this,arguments)}function DU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function LU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DU(Object(n),!0).forEach(function(r){fje(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function fje(e,t,n){return t=hje(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hje(e){var t=mje(e,"string");return yp(t)=="symbol"?t:t+""}function mje(e,t){if(yp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(yp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yje(e,t){if(e==null)return{};var n=gje(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function gje(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}var $U={symbolCircle:vO,symbolCross:$_e,symbolDiamond:B_e,symbolSquare:z_e,symbolStar:W_e,symbolTriangle:H_e,symbolWye:Z_e},vje=Math.PI/180,bje=function(e){var t="symbol".concat(Hy(e));return $U[t]||vO},wje=function(e,t,n){if(t==="area")return e;switch(n){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var r=18*vje;return 1.25*e*e*(Math.tan(r)-Math.tan(r*2)*Math.pow(Math.tan(r),2))}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},xje=function(e,t){$U["symbol".concat(Hy(e))]=t},SO=function(e){var t=e.type,n=t===void 0?"circle":t,r=e.size,a=r===void 0?64:r,o=e.sizeType,i=o===void 0?"area":o,s=yje(e,pje),c=LU(LU({},s),{},{type:n,size:a,sizeType:i}),l=function(){var m=bje(n),y=G_e().type(m).size(wje(a,i,n));return y()},u=c.className,d=c.cx,p=c.cy,f=bt(c,!0);return d===+d&&p===+p&&a===+a?W.createElement("path",jO({},f,{className:St("recharts-symbols",u),transform:"translate(".concat(d,", ").concat(p,")"),d:l()})):null};SO.registerSymbol=xje;function gl(e){"@babel/helpers - typeof";return gl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gl(e)}function EO(){return EO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},EO.apply(this,arguments)}function FU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function _je(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FU(Object(n),!0).forEach(function(r){gp(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function jje(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Sje(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,zU(r.key),r)}}function Eje(e,t,n){return t&&Sje(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Oje(e,t,n){return t=ng(t),Cje(e,BU()?Reflect.construct(t,n||[],ng(e).constructor):t.apply(e,n))}function Cje(e,t){if(t&&(gl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nje(e)}function Nje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function BU(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BU=function(){return!!e})()}function ng(e){return ng=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ng(e)}function Mje(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OO(e,t)}function OO(e,t){return OO=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},OO(e,t)}function gp(e,t,n){return t=zU(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zU(e){var t=kje(e,"string");return gl(t)=="symbol"?t:t+""}function kje(e,t){if(gl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(gl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Dr=32,CO=function(e){function t(){return jje(this,t),Oje(this,t,arguments)}return Mje(t,e),Eje(t,[{key:"renderIcon",value:function(n){var r=this.props.inactiveColor,a=Dr/2,o=Dr/6,i=Dr/3,s=n.inactive?r:n.color;if(n.type==="plainline")return W.createElement("line",{strokeWidth:4,fill:"none",stroke:s,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:a,x2:Dr,y2:a,className:"recharts-legend-icon"});if(n.type==="line")return W.createElement("path",{strokeWidth:4,fill:"none",stroke:s,d:"M0,".concat(a,"h").concat(i,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(2*i,",").concat(a,`
            H`).concat(Dr,"M").concat(2*i,",").concat(a,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(i,",").concat(a),className:"recharts-legend-icon"});if(n.type==="rect")return W.createElement("path",{stroke:"none",fill:s,d:"M0,".concat(Dr/8,"h").concat(Dr,"v").concat(Dr*3/4,"h").concat(-Dr,"z"),className:"recharts-legend-icon"});if(W.isValidElement(n.legendIcon)){var c=_je({},n);return delete c.legendIcon,W.cloneElement(n.legendIcon,c)}return W.createElement(SO,{fill:s,cx:a,cy:a,size:Dr,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,r=this.props,a=r.payload,o=r.iconSize,i=r.layout,s=r.formatter,c=r.inactiveColor,l={x:0,y:0,width:Dr,height:Dr},u={display:i==="horizontal"?"inline-block":"block",marginRight:10},d={display:"inline-block",verticalAlign:"middle",marginRight:4};return a.map(function(p,f){var m=p.formatter||s,y=St(gp(gp({"recharts-legend-item":!0},"legend-item-".concat(f),!0),"inactive",p.inactive));if(p.type==="none")return null;var v=at(p.value)?null:p.value;Wo(!at(p.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var b=p.inactive?c:p.color;return W.createElement("li",EO({className:y,style:u,key:"legend-item-".concat(f)},Wy(n.props,p,f)),W.createElement(oO,{width:o,height:o,viewBox:l,style:d},n.renderIcon(p)),W.createElement("span",{className:"recharts-legend-item-text",style:{color:b}},m?m(v,p,f):v))})}},{key:"render",value:function(){var n=this.props,r=n.payload,a=n.layout,o=n.align;if(!r||!r.length)return null;var i={padding:0,margin:0,textAlign:a==="horizontal"?o:"left"};return W.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(g.PureComponent);gp(CO,"displayName","Legend"),gp(CO,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var NO,UU;function VU(){if(UU)return NO;UU=1;function e(t,n,r,a){for(var o=t.length,i=r+(a?1:-1);a?i--:++i<o;)if(n(t[i],i,t))return i;return-1}return NO=e,NO}var MO,qU;function Pje(){if(qU)return MO;qU=1;function e(t){return t!==t}return MO=e,MO}var kO,WU;function Aje(){if(WU)return kO;WU=1;function e(t,n,r){for(var a=r-1,o=t.length;++a<o;)if(t[a]===n)return a;return-1}return kO=e,kO}var PO,HU;function Tje(){if(HU)return PO;HU=1;var e=VU(),t=Pje(),n=Aje();function r(a,o,i){return o===o?n(a,o,i):e(a,t,i)}return PO=r,PO}var AO,KU;function Ije(){if(KU)return AO;KU=1;var e=Tje();function t(n,r){var a=n==null?0:n.length;return!!a&&e(n,r,0)>-1}return AO=t,AO}var TO,ZU;function Rje(){if(ZU)return TO;ZU=1;function e(t,n,r){for(var a=-1,o=t==null?0:t.length;++a<o;)if(r(n,t[a]))return!0;return!1}return TO=e,TO}var IO,GU;function Dje(){if(GU)return IO;GU=1;function e(){}return IO=e,IO}var RO,XU;function Lje(){if(XU)return RO;XU=1;var e=FD(),t=Dje(),n=Ox(),r=1/0,a=e&&1/n(new e([,-0]))[1]==r?function(o){return new e(o)}:t;return RO=a,RO}var DO,JU;function $je(){if(JU)return DO;JU=1;var e=ZR(),t=Ije(),n=Rje(),r=YR(),a=Lje(),o=Ox(),i=200;function s(c,l,u){var d=-1,p=t,f=c.length,m=!0,y=[],v=y;if(u)m=!1,p=n;else if(f>=i){var b=l?null:a(c);if(b)return o(b);m=!1,p=r,v=new e}else v=l?[]:y;e:for(;++d<f;){var w=c[d],j=l?l(w):w;if(w=u||w!==0?w:0,m&&j===j){for(var x=v.length;x--;)if(v[x]===j)continue e;l&&v.push(j),y.push(w)}else p(v,j,u)||(v!==y&&v.push(j),y.push(w))}return y}return DO=s,DO}var LO,YU;function Fje(){if(YU)return LO;YU=1;var e=za(),t=$je();function n(r,a){return r&&r.length?t(r,e(a,2)):[]}return LO=n,LO}var Bje=Fje();const QU=st(Bje);function eV(e,t,n){return t===!0?QU(e,n):at(t)?QU(e,t):e}function vl(e){"@babel/helpers - typeof";return vl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vl(e)}var zje=["ref"];function tV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Ho(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tV(Object(n),!0).forEach(function(r){ag(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Uje(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nV(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,aV(r.key),r)}}function Vje(e,t,n){return t&&nV(e.prototype,t),n&&nV(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function qje(e,t,n){return t=rg(t),Wje(e,rV()?Reflect.construct(t,n||[],rg(e).constructor):t.apply(e,n))}function Wje(e,t){if(t&&(vl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Hje(e)}function Hje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rV(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rV=function(){return!!e})()}function rg(e){return rg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rg(e)}function Kje(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$O(e,t)}function $O(e,t){return $O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},$O(e,t)}function ag(e,t,n){return t=aV(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aV(e){var t=Zje(e,"string");return vl(t)=="symbol"?t:t+""}function Zje(e,t){if(vl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(vl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gje(e,t){if(e==null)return{};var n=Xje(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Xje(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function Jje(e){return e.value}function Yje(e,t){if(W.isValidElement(e))return W.cloneElement(e,t);if(typeof e=="function")return W.createElement(e,t);t.ref;var n=Gje(t,zje);return W.createElement(CO,n)}var oV=1,bl=function(e){function t(){var n;Uje(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return n=qje(this,t,[].concat(a)),ag(n,"lastBoundingBox",{width:-1,height:-1}),n}return Kje(t,e),Vje(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,r=this.getBBox();r?(Math.abs(r.width-this.lastBoundingBox.width)>oV||Math.abs(r.height-this.lastBoundingBox.height)>oV)&&(this.lastBoundingBox.width=r.width,this.lastBoundingBox.height=r.height,n&&n(r)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Ho({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var r=this.props,a=r.layout,o=r.align,i=r.verticalAlign,s=r.margin,c=r.chartWidth,l=r.chartHeight,u,d;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(o==="center"&&a==="vertical"){var p=this.getBBoxSnapshot();u={left:((c||0)-p.width)/2}}else u=o==="right"?{right:s&&s.right||0}:{left:s&&s.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(i==="middle"){var f=this.getBBoxSnapshot();d={top:((l||0)-f.height)/2}}else d=i==="bottom"?{bottom:s&&s.bottom||0}:{top:s&&s.top||0};return Ho(Ho({},u),d)}},{key:"render",value:function(){var n=this,r=this.props,a=r.content,o=r.width,i=r.height,s=r.wrapperStyle,c=r.payloadUniqBy,l=r.payload,u=Ho(Ho({position:"absolute",width:o||"auto",height:i||"auto"},this.getDefaultPosition(s)),s);return W.createElement("div",{className:"recharts-legend-wrapper",style:u,ref:function(d){n.wrapperNode=d}},Yje(a,Ho(Ho({},this.props),{},{payload:eV(l,c,Jje)})))}}],[{key:"getWithHeight",value:function(n,r){var a=Ho(Ho({},this.defaultProps),n.props),o=a.layout;return o==="vertical"&&ye(n.props.height)?{height:n.props.height}:o==="horizontal"?{width:n.props.width||r}:null}}])}(g.PureComponent);ag(bl,"displayName","Legend"),ag(bl,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var FO,iV;function Qje(){if(iV)return FO;iV=1;var e=Js(),t=bf(),n=Wn(),r=e?e.isConcatSpreadable:void 0;function a(o){return n(o)||t(o)||!!(r&&o&&o[r])}return FO=a,FO}var BO,sV;Av=function(){if(sV)return BO;sV=1;var e=Mx(),t=Qje();function n(r,a,o,i,s){var c=-1,l=r.length;for(o||(o=t),s||(s=[]);++c<l;){var u=r[c];a>0&&o(u)?a>1?n(u,a-1,o,i,s):e(s,u):i||(s[s.length]=u)}return s}return BO=n,BO};var zO,cV;function eSe(){if(cV)return zO;cV=1;function e(t){return function(n,r,a){for(var o=-1,i=Object(n),s=a(n),c=s.length;c--;){var l=s[t?c:++o];if(r(i[l],l,i)===!1)break}return n}}return zO=e,zO}var UO,lV;XM=function(){if(lV)return UO;lV=1;var e=eSe(),t=e();return UO=t,UO};var VO,uV;function dV(){if(uV)return VO;uV=1;var e=XM(),t=pu();function n(r,a){return r&&e(r,a,t)}return VO=n,VO}var qO,pV;function tSe(){if(pV)return qO;pV=1;var e=Ki();function t(n,r){return function(a,o){if(a==null)return a;if(!e(a))return n(a,o);for(var i=a.length,s=r?i:-1,c=Object(a);(r?s--:++s<i)&&o(c[s],s,c)!==!1;);return a}}return qO=t,qO}var WO,fV;function HO(){if(fV)return WO;fV=1;var e=dV(),t=tSe(),n=t(e);return WO=n,WO}var KO,hV;function mV(){if(hV)return KO;hV=1;var e=HO(),t=Ki();function n(r,a){var o=-1,i=t(r)?Array(r.length):[];return e(r,function(s,c,l){i[++o]=a(s,c,l)}),i}return KO=n,KO}var ZO,yV;function nSe(){if(yV)return ZO;yV=1;function e(t,n){var r=t.length;for(t.sort(n);r--;)t[r]=t[r].value;return t}return ZO=e,ZO}var GO,gV;function rSe(){if(gV)return GO;gV=1;var e=gc();function t(n,r){if(n!==r){var a=n!==void 0,o=n===null,i=n===n,s=e(n),c=r!==void 0,l=r===null,u=r===r,d=e(r);if(!l&&!d&&!s&&n>r||s&&c&&u&&!l&&!d||o&&c&&u||!a&&u||!i)return 1;if(!o&&!s&&!d&&n<r||d&&a&&i&&!o&&!s||l&&a&&i||!c&&i||!u)return-1}return 0}return GO=t,GO}var XO,vV;function aSe(){if(vV)return XO;vV=1;var e=rSe();function t(n,r,a){for(var o=-1,i=n.criteria,s=r.criteria,c=i.length,l=a.length;++o<c;){var u=e(i[o],s[o]);if(u){if(o>=l)return u;var d=a[o];return u*(d=="desc"?-1:1)}}return n.index-r.index}return XO=t,XO}var JO,bV;function oSe(){if(bV)return JO;bV=1;var e=iu(),t=yu(),n=za(),r=mV(),a=nSe(),o=k0(),i=aSe(),s=vc(),c=Wn();function l(u,d,p){d.length?d=e(d,function(y){return c(y)?function(v){return t(v,y.length===1?y[0]:y)}:y}):d=[s];var f=-1;d=e(d,o(n));var m=r(u,function(y,v,b){var w=e(d,function(j){return j(y)});return{criteria:w,index:++f,value:y}});return a(m,function(y,v){return i(y,v,p)})}return JO=l,JO}var YO,wV;ak=function(){if(wV)return YO;wV=1;function e(t,n,r){switch(r.length){case 0:return t.call(n);case 1:return t.call(n,r[0]);case 2:return t.call(n,r[0],r[1]);case 3:return t.call(n,r[0],r[1],r[2])}return t.apply(n,r)}return YO=e,YO};var QO,xV;GM=function(){if(xV)return QO;xV=1;var e=ak(),t=Math.max;function n(r,a,o){return a=t(a===void 0?r.length-1:a,0),function(){for(var i=arguments,s=-1,c=t(i.length-a,0),l=Array(c);++s<c;)l[s]=i[a+s];s=-1;for(var u=Array(a+1);++s<a;)u[s]=i[s];return u[a]=o(l),e(r,this,u)}}return QO=n,QO};var eC,_V;function iSe(){if(_V)return eC;_V=1;function e(t){return function(){return t}}return eC=e,eC}var tC,jV;function sSe(){if(jV)return tC;jV=1;var e=iSe(),t=j3(),n=vc(),r=t?function(a,o){return t(a,"toString",{configurable:!0,enumerable:!1,value:e(o),writable:!0})}:n;return tC=r,tC}var nC,SV;function cSe(){if(SV)return nC;SV=1;var e=800,t=16,n=Date.now;function r(a){var o=0,i=0;return function(){var s=n(),c=t-(s-i);if(i=s,c>0){if(++o>=e)return arguments[0]}else o=0;return a.apply(void 0,arguments)}}return nC=r,nC}var rC,EV;ZM=function(){if(EV)return rC;EV=1;var e=sSe(),t=cSe(),n=t(e);return rC=n,rC};var aC,OV;JM=function(){if(OV)return aC;OV=1;var e=vc(),t=GM(),n=ZM();function r(a,o){return n(t(a,o,e),a+"")}return aC=r,aC};var oC,CV;function lSe(){if(CV)return oC;CV=1;var e=Av(),t=oSe(),n=JM(),r=Hs(),a=n(function(o,i){if(o==null)return[];var s=i.length;return s>1&&r(o,i[0],i[1])?i=[]:s>2&&r(i[0],i[1],i[2])&&(i=[i[0]]),t(o,e(i,1),[])});return oC=a,oC}var uSe=lSe();const iC=st(uSe);function vp(e){"@babel/helpers - typeof";return vp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vp(e)}function sC(){return sC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},sC.apply(this,arguments)}function dSe(e,t){return mSe(e)||hSe(e,t)||fSe(e,t)||pSe()}function pSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fSe(e,t){if(e){if(typeof e=="string")return NV(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return NV(e,t)}}function NV(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hSe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function mSe(e){if(Array.isArray(e))return e}function MV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function cC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MV(Object(n),!0).forEach(function(r){ySe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function ySe(e,t,n){return t=gSe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gSe(e){var t=vSe(e,"string");return vp(t)=="symbol"?t:t+""}function vSe(e,t){if(vp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(vp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bSe(e){return Array.isArray(e)&&hn(e[0])&&hn(e[1])?e.join(" ~ "):e}var wSe=function(e){var t=e.separator,n=t===void 0?" : ":t,r=e.contentStyle,a=r===void 0?{}:r,o=e.itemStyle,i=o===void 0?{}:o,s=e.labelStyle,c=s===void 0?{}:s,l=e.payload,u=e.formatter,d=e.itemSorter,p=e.wrapperClassName,f=e.labelClassName,m=e.label,y=e.labelFormatter,v=e.accessibilityLayer,b=v===void 0?!1:v,w=function(){if(l&&l.length){var M={padding:0,margin:0},k=(d?iC(l,d):l).map(function(P,A){if(P.type==="none")return null;var C=cC({display:"block",paddingTop:4,paddingBottom:4,color:P.color||"#000"},i),I=P.formatter||u||bSe,T=P.value,R=P.name,L=T,D=R;if(I&&L!=null&&D!=null){var z=I(T,R,P,A,l);if(Array.isArray(z)){var B=dSe(z,2);L=B[0],D=B[1]}else L=z}return W.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(A),style:C},hn(D)?W.createElement("span",{className:"recharts-tooltip-item-name"},D):null,hn(D)?W.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,W.createElement("span",{className:"recharts-tooltip-item-value"},L),W.createElement("span",{className:"recharts-tooltip-item-unit"},P.unit||""))});return W.createElement("ul",{className:"recharts-tooltip-item-list",style:M},k)}return null},j=cC({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},a),x=cC({margin:0},c),_=!wt(m),S=_?m:"",E=St("recharts-default-tooltip",p),O=St("recharts-tooltip-label",f);_&&y&&l!==void 0&&l!==null&&(S=y(m,l));var N=b?{role:"status","aria-live":"assertive"}:{};return W.createElement("div",sC({className:E,style:j},N),W.createElement("p",{className:O,style:x},W.isValidElement(S)?S:"".concat(S)),w())};function bp(e){"@babel/helpers - typeof";return bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bp(e)}function og(e,t,n){return t=xSe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xSe(e){var t=_Se(e,"string");return bp(t)=="symbol"?t:t+""}function _Se(e,t){if(bp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(bp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wp="recharts-tooltip-wrapper",jSe={visibility:"hidden"};function SSe(e){var t=e.coordinate,n=e.translateX,r=e.translateY;return St(wp,og(og(og(og({},"".concat(wp,"-right"),ye(n)&&t&&ye(t.x)&&n>=t.x),"".concat(wp,"-left"),ye(n)&&t&&ye(t.x)&&n<t.x),"".concat(wp,"-bottom"),ye(r)&&t&&ye(t.y)&&r>=t.y),"".concat(wp,"-top"),ye(r)&&t&&ye(t.y)&&r<t.y))}function kV(e){var t=e.allowEscapeViewBox,n=e.coordinate,r=e.key,a=e.offsetTopLeft,o=e.position,i=e.reverseDirection,s=e.tooltipDimension,c=e.viewBox,l=e.viewBoxDimension;if(o&&ye(o[r]))return o[r];var u=n[r]-s-a,d=n[r]+a;if(t[r])return i[r]?u:d;if(i[r]){var p=u,f=c[r];return p<f?Math.max(d,c[r]):Math.max(u,c[r])}var m=d+s,y=c[r]+l;return m>y?Math.max(u,c[r]):Math.max(d,c[r])}function ESe(e){var t=e.translateX,n=e.translateY,r=e.useTranslate3d;return{transform:r?"translate3d(".concat(t,"px, ").concat(n,"px, 0)"):"translate(".concat(t,"px, ").concat(n,"px)")}}function OSe(e){var t=e.allowEscapeViewBox,n=e.coordinate,r=e.offsetTopLeft,a=e.position,o=e.reverseDirection,i=e.tooltipBox,s=e.useTranslate3d,c=e.viewBox,l,u,d;return i.height>0&&i.width>0&&n?(u=kV({allowEscapeViewBox:t,coordinate:n,key:"x",offsetTopLeft:r,position:a,reverseDirection:o,tooltipDimension:i.width,viewBox:c,viewBoxDimension:c.width}),d=kV({allowEscapeViewBox:t,coordinate:n,key:"y",offsetTopLeft:r,position:a,reverseDirection:o,tooltipDimension:i.height,viewBox:c,viewBoxDimension:c.height}),l=ESe({translateX:u,translateY:d,useTranslate3d:s})):l=jSe,{cssProperties:l,cssClasses:SSe({translateX:u,translateY:d,coordinate:n})}}function wl(e){"@babel/helpers - typeof";return wl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wl(e)}function PV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function AV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PV(Object(n),!0).forEach(function(r){uC(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function CSe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function NSe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,IV(r.key),r)}}function MSe(e,t,n){return t&&NSe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function kSe(e,t,n){return t=ig(t),PSe(e,TV()?Reflect.construct(t,n||[],ig(e).constructor):t.apply(e,n))}function PSe(e,t){if(t&&(wl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ASe(e)}function ASe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function TV(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(TV=function(){return!!e})()}function ig(e){return ig=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ig(e)}function TSe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lC(e,t)}function lC(e,t){return lC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},lC(e,t)}function uC(e,t,n){return t=IV(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IV(e){var t=ISe(e,"string");return wl(t)=="symbol"?t:t+""}function ISe(e,t){if(wl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(wl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var RV=1,RSe=function(e){function t(){var n;CSe(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return n=kSe(this,t,[].concat(a)),uC(n,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),uC(n,"handleKeyDown",function(i){if(i.key==="Escape"){var s,c,l,u;n.setState({dismissed:!0,dismissedAtCoordinate:{x:(s=(c=n.props.coordinate)===null||c===void 0?void 0:c.x)!==null&&s!==void 0?s:0,y:(l=(u=n.props.coordinate)===null||u===void 0?void 0:u.y)!==null&&l!==void 0?l:0}})}}),n}return TSe(t,e),MSe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>RV||Math.abs(n.height-this.state.lastBoundingBox.height)>RV)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,r;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((r=this.props.coordinate)===null||r===void 0?void 0:r.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,r=this.props,a=r.active,o=r.allowEscapeViewBox,i=r.animationDuration,s=r.animationEasing,c=r.children,l=r.coordinate,u=r.hasPayload,d=r.isAnimationActive,p=r.offset,f=r.position,m=r.reverseDirection,y=r.useTranslate3d,v=r.viewBox,b=r.wrapperStyle,w=OSe({allowEscapeViewBox:o,coordinate:l,offsetTopLeft:p,position:f,reverseDirection:m,tooltipBox:this.state.lastBoundingBox,useTranslate3d:y,viewBox:v}),j=w.cssClasses,x=w.cssProperties,_=AV(AV({transition:d&&a?"transform ".concat(i,"ms ").concat(s):void 0},x),{},{pointerEvents:"none",visibility:!this.state.dismissed&&a&&u?"visible":"hidden",position:"absolute",top:0,left:0},b);return W.createElement("div",{tabIndex:-1,className:j,style:_,ref:function(S){n.wrapperNode=S}},c)}}])}(g.PureComponent),DSe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Ii={isSsr:DSe(),get:function(e){return Ii[e]},set:function(e,t){if(typeof e=="string")Ii[e]=t;else{var n=Object.keys(e);n&&n.length&&n.forEach(function(r){Ii[r]=e[r]})}}};function xl(e){"@babel/helpers - typeof";return xl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xl(e)}function DV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function LV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DV(Object(n),!0).forEach(function(r){pC(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function LSe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,FV(r.key),r)}}function FSe(e,t,n){return t&&$Se(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function BSe(e,t,n){return t=sg(t),zSe(e,$V()?Reflect.construct(t,n||[],sg(e).constructor):t.apply(e,n))}function zSe(e,t){if(t&&(xl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return USe(e)}function USe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $V(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($V=function(){return!!e})()}function sg(e){return sg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sg(e)}function VSe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dC(e,t)}function dC(e,t){return dC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},dC(e,t)}function pC(e,t,n){return t=FV(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function FV(e){var t=qSe(e,"string");return xl(t)=="symbol"?t:t+""}function qSe(e,t){if(xl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(xl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function WSe(e){return e.dataKey}function HSe(e,t){return W.isValidElement(e)?W.cloneElement(e,t):typeof e=="function"?W.createElement(e,t):W.createElement(wSe,t)}var eo=function(e){function t(){return LSe(this,t),BSe(this,t,arguments)}return VSe(t,e),FSe(t,[{key:"render",value:function(){var n=this,r=this.props,a=r.active,o=r.allowEscapeViewBox,i=r.animationDuration,s=r.animationEasing,c=r.content,l=r.coordinate,u=r.filterNull,d=r.isAnimationActive,p=r.offset,f=r.payload,m=r.payloadUniqBy,y=r.position,v=r.reverseDirection,b=r.useTranslate3d,w=r.viewBox,j=r.wrapperStyle,x=f??[];u&&x.length&&(x=eV(f.filter(function(S){return S.value!=null&&(S.hide!==!0||n.props.includeHidden)}),m,WSe));var _=x.length>0;return W.createElement(RSe,{allowEscapeViewBox:o,animationDuration:i,animationEasing:s,isAnimationActive:d,active:a,coordinate:l,hasPayload:_,offset:p,position:y,reverseDirection:v,useTranslate3d:b,viewBox:w,wrapperStyle:j},HSe(c,LV(LV({},this.props),{},{payload:x})))}}])}(g.PureComponent);pC(eo,"displayName","Tooltip"),pC(eo,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Ii.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var fC,BV;function KSe(){if(BV)return fC;BV=1;var e=qr(),t=function(){return e.Date.now()};return fC=t,fC}var hC,zV;tk=function(){if(zV)return hC;zV=1;var e=Wr(),t=KSe(),n=cz(),r="Expected a function",a=Math.max,o=Math.min;function i(s,c,l){var u,d,p,f,m,y,v=0,b=!1,w=!1,j=!0;if(typeof s!="function")throw new TypeError(r);c=n(c)||0,e(l)&&(b=!!l.leading,w="maxWait"in l,p=w?a(n(l.maxWait)||0,c):p,j="trailing"in l?!!l.trailing:j);function x(A){var C=u,I=d;return u=d=void 0,v=A,f=s.apply(I,C),f}function _(A){return v=A,m=setTimeout(O,c),b?x(A):f}function S(A){var C=A-y,I=A-v,T=c-C;return w?o(T,p-I):T}function E(A){var C=A-y,I=A-v;return y===void 0||C>=c||C<0||w&&I>=p}function O(){var A=t();if(E(A))return N(A);m=setTimeout(O,S(A))}function N(A){return m=void 0,j&&u?x(A):(u=d=void 0,f)}function M(){m!==void 0&&clearTimeout(m),v=0,u=y=d=m=void 0}function k(){return m===void 0?f:N(t())}function P(){var A=t(),C=E(A);if(u=arguments,d=this,y=A,C){if(m===void 0)return _(y);if(w)return clearTimeout(m),m=setTimeout(O,c),x(y)}return m===void 0&&(m=setTimeout(O,c)),f}return P.cancel=M,P.flush=k,P}return hC=i,hC};var mC,UV;function ZSe(){if(UV)return mC;UV=1;var e=tk(),t=Wr(),n="Expected a function";function r(a,o,i){var s=!0,c=!0;if(typeof a!="function")throw new TypeError(n);return t(i)&&(s="leading"in i?!!i.leading:s,c="trailing"in i?!!i.trailing:c),e(a,o,{leading:s,maxWait:o,trailing:c})}return mC=r,mC}var GSe=ZSe();Rv=st(GSe);function xp(e){"@babel/helpers - typeof";return xp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xp(e)}function VV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function cg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VV(Object(n),!0).forEach(function(r){XSe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function XSe(e,t,n){return t=JSe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function JSe(e){var t=YSe(e,"string");return xp(t)=="symbol"?t:t+""}function YSe(e,t){if(xp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(xp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QSe(e,t){return rEe(e)||nEe(e,t)||tEe(e,t)||eEe()}function eEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tEe(e,t){if(e){if(typeof e=="string")return qV(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qV(e,t)}}function qV(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nEe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function rEe(e){if(Array.isArray(e))return e}var aEe=g.forwardRef(function(e,t){var n=e.aspect,r=e.initialDimension,a=r===void 0?{width:-1,height:-1}:r,o=e.width,i=o===void 0?"100%":o,s=e.height,c=s===void 0?"100%":s,l=e.minWidth,u=l===void 0?0:l,d=e.minHeight,p=e.maxHeight,f=e.children,m=e.debounce,y=m===void 0?0:m,v=e.id,b=e.className,w=e.onResize,j=e.style,x=j===void 0?{}:j,_=g.useRef(null),S=g.useRef();S.current=w,g.useImperativeHandle(t,function(){return Object.defineProperty(_.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),_.current},configurable:!0})});var E=g.useState({containerWidth:a.width,containerHeight:a.height}),O=QSe(E,2),N=O[0],M=O[1],k=g.useCallback(function(A,C){M(function(I){var T=Math.round(A),R=Math.round(C);return I.containerWidth===T&&I.containerHeight===R?I:{containerWidth:T,containerHeight:R}})},[]);g.useEffect(function(){var A=function(L){var D,z=L[0].contentRect,B=z.width,$=z.height;k(B,$),(D=S.current)===null||D===void 0||D.call(S,B,$)};y>0&&(A=Rv(A,y,{trailing:!0,leading:!1}));var C=new ResizeObserver(A),I=_.current.getBoundingClientRect(),T=I.width,R=I.height;return k(T,R),C.observe(_.current),function(){C.disconnect()}},[k,y]);var P=g.useMemo(function(){var A=N.containerWidth,C=N.containerHeight;if(A<0||C<0)return null;Wo(Cs(i)||Cs(c),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,i,c),Wo(!n||n>0,"The aspect(%s) must be greater than zero.",n);var I=Cs(i)?A:i,T=Cs(c)?C:c;n&&n>0&&(I?T=I/n:T&&(I=T*n),p&&T>p&&(T=p)),Wo(I>0||T>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,I,T,i,c,u,d,n);var R=!Array.isArray(f)&&qo(f.type).endsWith("Chart");return W.Children.map(f,function(L){return W.isValidElement(L)?g.cloneElement(L,cg({width:I,height:T},R?{style:cg({height:"100%",width:"100%",maxHeight:T,maxWidth:I},L.props.style)}:{})):L})},[n,f,c,p,d,u,N,i]);return W.createElement("div",{id:v?"".concat(v):void 0,className:St("recharts-responsive-container",b),style:cg(cg({},x),{},{width:i,height:c,minWidth:u,minHeight:d,maxHeight:p}),ref:_},P)}),WV=function(e){return null};WV.displayName="Cell";function _p(e){"@babel/helpers - typeof";return _p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_p(e)}function HV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function yC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HV(Object(n),!0).forEach(function(r){oEe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function oEe(e,t,n){return t=iEe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iEe(e){var t=sEe(e,"string");return _p(t)=="symbol"?t:t+""}function sEe(e,t){if(_p(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(_p(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _l={widthCache:{},cacheCount:0},cEe=2e3,lEe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},KV="recharts_measurement_span";function uEe(e){var t=yC({},e);return Object.keys(t).forEach(function(n){t[n]||delete t[n]}),t}var jp=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||Ii.isSsr)return{width:0,height:0};var n=uEe(t),r=JSON.stringify({text:e,copyStyle:n});if(_l.widthCache[r])return _l.widthCache[r];try{var a=document.getElementById(KV);a||(a=document.createElement("span"),a.setAttribute("id",KV),a.setAttribute("aria-hidden","true"),document.body.appendChild(a));var o=yC(yC({},lEe),n);Object.assign(a.style,o),a.textContent="".concat(e);var i=a.getBoundingClientRect(),s={width:i.width,height:i.height};return _l.widthCache[r]=s,++_l.cacheCount>cEe&&(_l.cacheCount=0,_l.widthCache={}),s}catch{return{width:0,height:0}}},dEe=function(e){return{top:e.top+window.scrollY-document.documentElement.clientTop,left:e.left+window.scrollX-document.documentElement.clientLeft}};function Sp(e){"@babel/helpers - typeof";return Sp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sp(e)}function lg(e,t){return mEe(e)||hEe(e,t)||fEe(e,t)||pEe()}function pEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fEe(e,t){if(e){if(typeof e=="string")return ZV(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ZV(e,t)}}function ZV(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hEe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function mEe(e){if(Array.isArray(e))return e}function yEe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function GV(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vEe(r.key),r)}}function gEe(e,t,n){return t&&GV(e.prototype,t),n&&GV(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function vEe(e){var t=bEe(e,"string");return Sp(t)=="symbol"?t:t+""}function bEe(e,t){if(Sp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Sp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var XV=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,JV=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,wEe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,xEe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,YV={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},_Ee=Object.keys(YV),jl="NaN";function jEe(e,t){return e*YV[t]}var ug=function(){function e(t,n){yEe(this,e),this.num=t,this.unit=n,this.num=t,this.unit=n,Number.isNaN(t)&&(this.unit=""),n!==""&&!wEe.test(n)&&(this.num=NaN,this.unit=""),_Ee.includes(n)&&(this.num=jEe(t,n),this.unit="px")}return gEe(e,[{key:"add",value:function(t){return this.unit!==t.unit?new e(NaN,""):new e(this.num+t.num,this.unit)}},{key:"subtract",value:function(t){return this.unit!==t.unit?new e(NaN,""):new e(this.num-t.num,this.unit)}},{key:"multiply",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new e(NaN,""):new e(this.num*t.num,this.unit||t.unit)}},{key:"divide",value:function(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new e(NaN,""):new e(this.num/t.num,this.unit||t.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(t){var n,r=(n=xEe.exec(t))!==null&&n!==void 0?n:[],a=lg(r,3),o=a[1],i=a[2];return new e(parseFloat(o),i??"")}}])}();function QV(e){if(e.includes(jl))return jl;for(var t=e;t.includes("*")||t.includes("/");){var n,r=(n=XV.exec(t))!==null&&n!==void 0?n:[],a=lg(r,4),o=a[1],i=a[2],s=a[3],c=ug.parse(o??""),l=ug.parse(s??""),u=i==="*"?c.multiply(l):c.divide(l);if(u.isNaN())return jl;t=t.replace(XV,u.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var d,p=(d=JV.exec(t))!==null&&d!==void 0?d:[],f=lg(p,4),m=f[1],y=f[2],v=f[3],b=ug.parse(m??""),w=ug.parse(v??""),j=y==="+"?b.add(w):b.subtract(w);if(j.isNaN())return jl;t=t.replace(JV,j.toString())}return t}var eq=/\(([^()]*)\)/;function SEe(e){for(var t=e;t.includes("(");){var n=eq.exec(t),r=lg(n,2),a=r[1];t=t.replace(eq,QV(a))}return t}function EEe(e){var t=e.replace(/\s+/g,"");return t=SEe(t),t=QV(t),t}function OEe(e){try{return EEe(e)}catch{return jl}}function gC(e){var t=OEe(e.slice(5,-1));return t===jl?"":t}var CEe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],NEe=["dx","dy","angle","className","breakAll"];function vC(){return vC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vC.apply(this,arguments)}function tq(e,t){if(e==null)return{};var n=MEe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function MEe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function nq(e,t){return TEe(e)||AEe(e,t)||PEe(e,t)||kEe()}function kEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PEe(e,t){if(e){if(typeof e=="string")return rq(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rq(e,t)}}function rq(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function AEe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function TEe(e){if(Array.isArray(e))return e}var aq=/[ \f\n\r\t\v\u2028\u2029]+/,oq=function(e){var t=e.children,n=e.breakAll,r=e.style;try{var a=[];wt(t)||(n?a=t.toString().split(""):a=t.toString().split(aq));var o=a.map(function(s){return{word:s,width:jp(s,r).width}}),i=n?0:jp("\xA0",r).width;return{wordsWithComputedWidth:o,spaceWidth:i}}catch{return null}},IEe=function(e,t,n,r,a){var o=e.maxLines,i=e.children,s=e.style,c=e.breakAll,l=ye(o),u=i,d=function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return A.reduce(function(C,I){var T=I.word,R=I.width,L=C[C.length-1];if(L&&(r==null||a||L.width+R+n<Number(r)))L.words.push(T),L.width+=R+n;else{var D={words:[T],width:R};C.push(D)}return C},[])},p=d(t),f=function(A){return A.reduce(function(C,I){return C.width>I.width?C:I})};if(!l)return p;for(var m="\u2026",y=function(A){var C=u.slice(0,A),I=oq({breakAll:c,style:s,children:C+m}).wordsWithComputedWidth,T=d(I),R=T.length>o||f(T).width>Number(r);return[R,T]},v=0,b=u.length-1,w=0,j;v<=b&&w<=u.length-1;){var x=Math.floor((v+b)/2),_=x-1,S=y(_),E=nq(S,2),O=E[0],N=E[1],M=y(x),k=nq(M,1),P=k[0];if(!O&&!P&&(v=x+1),O&&P&&(b=x-1),!O&&P){j=N;break}w++}return j||p},iq=function(e){var t=wt(e)?[]:e.toString().split(aq);return[{words:t}]},REe=function(e){var t=e.width,n=e.scaleToFit,r=e.children,a=e.style,o=e.breakAll,i=e.maxLines;if((t||n)&&!Ii.isSsr){var s,c,l=oq({breakAll:o,children:r,style:a});if(l){var u=l.wordsWithComputedWidth,d=l.spaceWidth;s=u,c=d}else return iq(r);return IEe({breakAll:o,children:r,maxLines:i,style:a},s,c,t,n)}return iq(r)},sq="#808080",dg=function(e){var t=e.x,n=t===void 0?0:t,r=e.y,a=r===void 0?0:r,o=e.lineHeight,i=o===void 0?"1em":o,s=e.capHeight,c=s===void 0?"0.71em":s,l=e.scaleToFit,u=l===void 0?!1:l,d=e.textAnchor,p=d===void 0?"start":d,f=e.verticalAnchor,m=f===void 0?"end":f,y=e.fill,v=y===void 0?sq:y,b=tq(e,CEe),w=g.useMemo(function(){return REe({breakAll:b.breakAll,children:b.children,maxLines:b.maxLines,scaleToFit:u,style:b.style,width:b.width})},[b.breakAll,b.children,b.maxLines,u,b.style,b.width]),j=b.dx,x=b.dy,_=b.angle,S=b.className,E=b.breakAll,O=tq(b,NEe);if(!hn(n)||!hn(a))return null;var N=n+(ye(j)?j:0),M=a+(ye(x)?x:0),k;switch(m){case"start":k=gC("calc(".concat(c,")"));break;case"middle":k=gC("calc(".concat((w.length-1)/2," * -").concat(i," + (").concat(c," / 2))"));break;default:k=gC("calc(".concat(w.length-1," * -").concat(i,")"));break}var P=[];if(u){var A=w[0].width,C=b.width;P.push("scale(".concat((ye(C)?C/A:1)/A,")"))}return _&&P.push("rotate(".concat(_,", ").concat(N,", ").concat(M,")")),P.length&&(O.transform=P.join(" ")),W.createElement("text",vC({},bt(O,!0),{x:N,y:M,className:St("recharts-text",S),textAnchor:p,fill:v.includes("url")?sq:v}),w.map(function(I,T){var R=I.words.join(E?"":" ");return W.createElement("tspan",{x:N,dy:T===0?k:i,key:"".concat(R,"-").concat(T)},R)}))};function Ri(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function DEe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function bC(e){let t,n,r;e.length!==2?(t=Ri,n=(s,c)=>Ri(e(s),c),r=(s,c)=>e(s)-c):(t=e===Ri||e===DEe?e:LEe,n=e,r=e);function a(s,c,l=0,u=s.length){if(l<u){if(t(c,c)!==0)return u;do{const d=l+u>>>1;n(s[d],c)<0?l=d+1:u=d}while(l<u)}return l}function o(s,c,l=0,u=s.length){if(l<u){if(t(c,c)!==0)return u;do{const d=l+u>>>1;n(s[d],c)<=0?l=d+1:u=d}while(l<u)}return l}function i(s,c,l=0,u=s.length){const d=a(s,c,l,u-1);return d>l&&r(s[d-1],c)>-r(s[d],c)?d-1:d}return{left:a,center:i,right:o}}function LEe(){return 0}function cq(e){return e===null?NaN:+e}function*$Ee(e,t){for(let n of e)n!=null&&(n=+n)>=n&&(yield n)}const FEe=bC(Ri),Ep=FEe.right;bC(cq).center;class lq extends Map{constructor(t,n=UEe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[r,a]of t)this.set(r,a)}get(t){return super.get(uq(this,t))}has(t){return super.has(uq(this,t))}set(t,n){return super.set(BEe(this,t),n)}delete(t){return super.delete(zEe(this,t))}}function uq({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function BEe({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function zEe({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(r),e.delete(r)),n}function UEe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function VEe(e=Ri){if(e===Ri)return dq;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const r=e(t,n);return r||r===0?r:(e(n,n)===0)-(e(t,t)===0)}}function dq(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const qEe=Math.sqrt(50),WEe=Math.sqrt(10),HEe=Math.sqrt(2);function pg(e,t,n){const r=(t-e)/Math.max(0,n),a=Math.floor(Math.log10(r)),o=r/Math.pow(10,a),i=o>=qEe?10:o>=WEe?5:o>=HEe?2:1;let s,c,l;return a<0?(l=Math.pow(10,-a)/i,s=Math.round(e*l),c=Math.round(t*l),s/l<e&&++s,c/l>t&&--c,l=-l):(l=Math.pow(10,a)*i,s=Math.round(e/l),c=Math.round(t/l),s*l<e&&++s,c*l>t&&--c),c<s&&.5<=n&&n<2?pg(e,t,n*2):[s,c,l]}function wC(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const r=t<e,[a,o,i]=r?pg(t,e,n):pg(e,t,n);if(!(o>=a))return[];const s=o-a+1,c=new Array(s);if(r)if(i<0)for(let l=0;l<s;++l)c[l]=(o-l)/-i;else for(let l=0;l<s;++l)c[l]=(o-l)*i;else if(i<0)for(let l=0;l<s;++l)c[l]=(a+l)/-i;else for(let l=0;l<s;++l)c[l]=(a+l)*i;return c}function xC(e,t,n){return t=+t,e=+e,n=+n,pg(e,t,n)[2]}function _C(e,t,n){t=+t,e=+e,n=+n;const r=t<e,a=r?xC(t,e,n):xC(e,t,n);return(r?-1:1)*(a<0?1/-a:a)}function pq(e,t){let n;for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function fq(e,t){let n;for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}function hq(e,t,n=0,r=1/0,a){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(e.length-1,r)),!(n<=t&&t<=r))return e;for(a=a===void 0?dq:VEe(a);r>n;){if(r-n>600){const c=r-n+1,l=t-n+1,u=Math.log(c),d=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*d*(c-d)/c)*(l-c/2<0?-1:1),f=Math.max(n,Math.floor(t-l*d/c+p)),m=Math.min(r,Math.floor(t+(c-l)*d/c+p));hq(e,t,f,m,a)}const o=e[t];let i=n,s=r;for(Op(e,n,t),a(e[r],o)>0&&Op(e,n,r);i<s;){for(Op(e,i,s),++i,--s;a(e[i],o)<0;)++i;for(;a(e[s],o)>0;)--s}a(e[n],o)===0?Op(e,n,s):(++s,Op(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function Op(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function KEe(e,t,n){if(e=Float64Array.from($Ee(e)),!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return fq(e);if(t>=1)return pq(e);var r,a=(r-1)*t,o=Math.floor(a),i=pq(hq(e,o).subarray(0,o+1)),s=fq(e.subarray(o+1));return i+(s-i)*(a-o)}}function ZEe(e,t,n=cq){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,a=(r-1)*t,o=Math.floor(a),i=+n(e[o],o,e),s=+n(e[o+1],o+1,e);return i+(s-i)*(a-o)}}function GEe(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var r=-1,a=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(a);++r<a;)o[r]=e+r*n;return o}function Lr(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ko(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const jC=Symbol("implicit");function SC(){var e=new lq,t=[],n=[],r=jC;function a(o){let i=e.get(o);if(i===void 0){if(r!==jC)return r;e.set(o,i=t.push(o)-1)}return n[i%n.length]}return a.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new lq;for(const i of o)e.has(i)||e.set(i,t.push(i)-1);return a},a.range=function(o){return arguments.length?(n=Array.from(o),a):n.slice()},a.unknown=function(o){return arguments.length?(r=o,a):r},a.copy=function(){return SC(t,n).unknown(r)},Lr.apply(a,arguments),a}function Cp(){var e=SC().unknown(void 0),t=e.domain,n=e.range,r=0,a=1,o,i,s=!1,c=0,l=0,u=.5;delete e.unknown;function d(){var p=t().length,f=a<r,m=f?a:r,y=f?r:a;o=(y-m)/Math.max(1,p-c+l*2),s&&(o=Math.floor(o)),m+=(y-m-o*(p-c))*u,i=o*(1-c),s&&(m=Math.round(m),i=Math.round(i));var v=GEe(p).map(function(b){return m+o*b});return n(f?v.reverse():v)}return e.domain=function(p){return arguments.length?(t(p),d()):t()},e.range=function(p){return arguments.length?([r,a]=p,r=+r,a=+a,d()):[r,a]},e.rangeRound=function(p){return[r,a]=p,r=+r,a=+a,s=!0,d()},e.bandwidth=function(){return i},e.step=function(){return o},e.round=function(p){return arguments.length?(s=!!p,d()):s},e.padding=function(p){return arguments.length?(c=Math.min(1,l=+p),d()):c},e.paddingInner=function(p){return arguments.length?(c=Math.min(1,p),d()):c},e.paddingOuter=function(p){return arguments.length?(l=+p,d()):l},e.align=function(p){return arguments.length?(u=Math.max(0,Math.min(1,p)),d()):u},e.copy=function(){return Cp(t(),[r,a]).round(s).paddingInner(c).paddingOuter(l).align(u)},Lr.apply(d(),arguments)}function mq(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return mq(t())},e}function Np(){return mq(Cp.apply(null,arguments).paddingInner(1))}function XEe(e){return function(){return e}}function fg(e){return+e}var yq=[0,1];function Xn(e){return e}function EC(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:XEe(isNaN(t)?NaN:.5)}function JEe(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function YEe(e,t,n){var r=e[0],a=e[1],o=t[0],i=t[1];return a<r?(r=EC(a,r),o=n(i,o)):(r=EC(r,a),o=n(o,i)),function(s){return o(r(s))}}function QEe(e,t,n){var r=Math.min(e.length,t.length)-1,a=new Array(r),o=new Array(r),i=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<r;)a[i]=EC(e[i],e[i+1]),o[i]=n(t[i],t[i+1]);return function(s){var c=Ep(e,s,1,r)-1;return o[c](a[c](s))}}function Mp(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function hg(){var e=yq,t=yq,n=_c,r,a,o,i=Xn,s,c,l;function u(){var p=Math.min(e.length,t.length);return i!==Xn&&(i=JEe(e[0],e[p-1])),s=p>2?QEe:YEe,c=l=null,d}function d(p){return p==null||isNaN(p=+p)?o:(c||(c=s(e.map(r),t,n)))(r(i(p)))}return d.invert=function(p){return i(a((l||(l=s(t,e.map(r),na)))(p)))},d.domain=function(p){return arguments.length?(e=Array.from(p,fg),u()):e.slice()},d.range=function(p){return arguments.length?(t=Array.from(p),u()):t.slice()},d.rangeRound=function(p){return t=Array.from(p),n=c_,u()},d.clamp=function(p){return arguments.length?(i=p?!0:Xn,u()):i!==Xn},d.interpolate=function(p){return arguments.length?(n=p,u()):n},d.unknown=function(p){return arguments.length?(o=p,d):o},function(p,f){return r=p,a=f,u()}}function OC(){return hg()(Xn,Xn)}function eOe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function mg(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Sl(e){return e=mg(Math.abs(e)),e?e[1]:NaN}function tOe(e,t){return function(n,r){for(var a=n.length,o=[],i=0,s=e[0],c=0;a>0&&s>0&&(c+s+1>r&&(s=Math.max(1,r-c)),o.push(n.substring(a-=s,a+s)),!((c+=s+1)>r));)s=e[i=(i+1)%e.length];return o.reverse().join(t)}}function nOe(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var rOe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function kp(e){if(!(t=rOe.exec(e)))throw new Error("invalid format: "+e);var t;return new CC({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}kp.prototype=CC.prototype;function CC(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}CC.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function aOe(e){e:for(var t=e.length,n=1,r=-1,a;n<t;++n)switch(e[n]){case".":r=a=n;break;case"0":r===0&&(r=n),a=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(a+1):e}var gq;function oOe(e,t){var n=mg(e,t);if(!n)return e+"";var r=n[0],a=n[1],o=a-(gq=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,i=r.length;return o===i?r:o>i?r+new Array(o-i+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+mg(e,Math.max(0,t+o-1))[0]}function vq(e,t){var n=mg(e,t);if(!n)return e+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}const bq={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:eOe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>vq(e*100,t),r:vq,s:oOe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function wq(e){return e}var xq=Array.prototype.map,_q=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function iOe(e){var t=e.grouping===void 0||e.thousands===void 0?wq:tOe(xq.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?wq:nOe(xq.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"\u2212":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function l(d){d=kp(d);var p=d.fill,f=d.align,m=d.sign,y=d.symbol,v=d.zero,b=d.width,w=d.comma,j=d.precision,x=d.trim,_=d.type;_==="n"?(w=!0,_="g"):bq[_]||(j===void 0&&(j=12),x=!0,_="g"),(v||p==="0"&&f==="=")&&(v=!0,p="0",f="=");var S=y==="$"?n:y==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",E=y==="$"?r:/[%p]/.test(_)?i:"",O=bq[_],N=/[defgprs%]/.test(_);j=j===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,j)):Math.max(0,Math.min(20,j));function M(k){var P=S,A=E,C,I,T;if(_==="c")A=O(k)+A,k="";else{k=+k;var R=k<0||1/k<0;if(k=isNaN(k)?c:O(Math.abs(k),j),x&&(k=aOe(k)),R&&+k==0&&m!=="+"&&(R=!1),P=(R?m==="("?m:s:m==="-"||m==="("?"":m)+P,A=(_==="s"?_q[8+gq/3]:"")+A+(R&&m==="("?")":""),N){for(C=-1,I=k.length;++C<I;)if(T=k.charCodeAt(C),48>T||T>57){A=(T===46?a+k.slice(C+1):k.slice(C))+A,k=k.slice(0,C);break}}}w&&!v&&(k=t(k,1/0));var L=P.length+k.length+A.length,D=L<b?new Array(b-L+1).join(p):"";switch(w&&v&&(k=t(D+k,D.length?b-A.length:1/0),D=""),f){case"<":k=P+k+A+D;break;case"=":k=P+D+k+A;break;case"^":k=D.slice(0,L=D.length>>1)+P+k+A+D.slice(L);break;default:k=D+P+k+A;break}return o(k)}return M.toString=function(){return d+""},M}function u(d,p){var f=l((d=kp(d),d.type="f",d)),m=Math.max(-8,Math.min(8,Math.floor(Sl(p)/3)))*3,y=Math.pow(10,-m),v=_q[8+m/3];return function(b){return f(y*b)+v}}return{format:l,formatPrefix:u}}var yg,NC,jq;sOe({thousands:",",grouping:[3],currency:["$",""]});function sOe(e){return yg=iOe(e),NC=yg.format,jq=yg.formatPrefix,yg}function cOe(e){return Math.max(0,-Sl(Math.abs(e)))}function lOe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Sl(t)/3)))*3-Sl(Math.abs(e)))}function uOe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Sl(t)-Sl(e))+1}function Sq(e,t,n,r){var a=_C(e,t,n),o;switch(r=kp(r??",f"),r.type){case"s":{var i=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(o=lOe(a,i))&&(r.precision=o),jq(r,i)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=uOe(a,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=cOe(a))&&(r.precision=o-(r.type==="%")*2);break}}return NC(r)}function Di(e){var t=e.domain;return e.ticks=function(n){var r=t();return wC(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var a=t();return Sq(a[0],a[a.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),a=0,o=r.length-1,i=r[a],s=r[o],c,l,u=10;for(s<i&&(l=i,i=s,s=l,l=a,a=o,o=l);u-- >0;){if(l=xC(i,s,n),l===c)return r[a]=i,r[o]=s,t(r);if(l>0)i=Math.floor(i/l)*l,s=Math.ceil(s/l)*l;else if(l<0)i=Math.ceil(i*l)/l,s=Math.floor(s*l)/l;else break;c=l}return e},e}function gg(){var e=OC();return e.copy=function(){return Mp(e,gg())},Lr.apply(e,arguments),Di(e)}function Eq(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,fg),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return Eq(e).unknown(t)},e=arguments.length?Array.from(e,fg):[0,1],Di(n)}function Oq(e,t){e=e.slice();var n=0,r=e.length-1,a=e[n],o=e[r],i;return o<a&&(i=n,n=r,r=i,i=a,a=o,o=i),e[n]=t.floor(a),e[r]=t.ceil(o),e}function Cq(e){return Math.log(e)}function Nq(e){return Math.exp(e)}function dOe(e){return-Math.log(-e)}function pOe(e){return-Math.exp(-e)}function fOe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function hOe(e){return e===10?fOe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function mOe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function Mq(e){return(t,n)=>-e(-t,n)}function MC(e){const t=e(Cq,Nq),n=t.domain;let r=10,a,o;function i(){return a=mOe(r),o=hOe(r),n()[0]<0?(a=Mq(a),o=Mq(o),e(dOe,pOe)):e(Cq,Nq),t}return t.base=function(s){return arguments.length?(r=+s,i()):r},t.domain=function(s){return arguments.length?(n(s),i()):n()},t.ticks=s=>{const c=n();let l=c[0],u=c[c.length-1];const d=u<l;d&&([l,u]=[u,l]);let p=a(l),f=a(u),m,y;const v=s==null?10:+s;let b=[];if(!(r%1)&&f-p<v){if(p=Math.floor(p),f=Math.ceil(f),l>0){for(;p<=f;++p)for(m=1;m<r;++m)if(y=p<0?m/o(-p):m*o(p),!(y<l)){if(y>u)break;b.push(y)}}else for(;p<=f;++p)for(m=r-1;m>=1;--m)if(y=p>0?m/o(-p):m*o(p),!(y<l)){if(y>u)break;b.push(y)}b.length*2<v&&(b=wC(l,u,v))}else b=wC(p,f,Math.min(f-p,v)).map(o);return d?b.reverse():b},t.tickFormat=(s,c)=>{if(s==null&&(s=10),c==null&&(c=r===10?"s":","),typeof c!="function"&&(!(r%1)&&(c=kp(c)).precision==null&&(c.trim=!0),c=NC(c)),s===1/0)return c;const l=Math.max(1,r*s/t.ticks().length);return u=>{let d=u/o(Math.round(a(u)));return d*r<r-.5&&(d*=r),d<=l?c(u):""}},t.nice=()=>n(Oq(n(),{floor:s=>o(Math.floor(a(s))),ceil:s=>o(Math.ceil(a(s)))})),t}function kq(){const e=MC(hg()).domain([1,10]);return e.copy=()=>Mp(e,kq()).base(e.base()),Lr.apply(e,arguments),e}function Pq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Aq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function kC(e){var t=1,n=e(Pq(t),Aq(t));return n.constant=function(r){return arguments.length?e(Pq(t=+r),Aq(t)):t},Di(n)}function Tq(){var e=kC(hg());return e.copy=function(){return Mp(e,Tq()).constant(e.constant())},Lr.apply(e,arguments)}function Iq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function yOe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function gOe(e){return e<0?-e*e:e*e}function PC(e){var t=e(Xn,Xn),n=1;function r(){return n===1?e(Xn,Xn):n===.5?e(yOe,gOe):e(Iq(n),Iq(1/n))}return t.exponent=function(a){return arguments.length?(n=+a,r()):n},Di(t)}function AC(){var e=PC(hg());return e.copy=function(){return Mp(e,AC()).exponent(e.exponent())},Lr.apply(e,arguments),e}function vOe(){return AC.apply(null,arguments).exponent(.5)}function Rq(e){return Math.sign(e)*e*e}function bOe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function Dq(){var e=OC(),t=[0,1],n=!1,r;function a(o){var i=bOe(e(o));return isNaN(i)?r:n?Math.round(i):i}return a.invert=function(o){return e.invert(Rq(o))},a.domain=function(o){return arguments.length?(e.domain(o),a):e.domain()},a.range=function(o){return arguments.length?(e.range((t=Array.from(o,fg)).map(Rq)),a):t.slice()},a.rangeRound=function(o){return a.range(o).round(!0)},a.round=function(o){return arguments.length?(n=!!o,a):n},a.clamp=function(o){return arguments.length?(e.clamp(o),a):e.clamp()},a.unknown=function(o){return arguments.length?(r=o,a):r},a.copy=function(){return Dq(e.domain(),t).round(n).clamp(e.clamp()).unknown(r)},Lr.apply(a,arguments),Di(a)}function Lq(){var e=[],t=[],n=[],r;function a(){var i=0,s=Math.max(1,t.length);for(n=new Array(s-1);++i<s;)n[i-1]=ZEe(e,i/s);return o}function o(i){return i==null||isNaN(i=+i)?r:t[Ep(n,i)]}return o.invertExtent=function(i){var s=t.indexOf(i);return s<0?[NaN,NaN]:[s>0?n[s-1]:e[0],s<n.length?n[s]:e[e.length-1]]},o.domain=function(i){if(!arguments.length)return e.slice();e=[];for(let s of i)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Ri),a()},o.range=function(i){return arguments.length?(t=Array.from(i),a()):t.slice()},o.unknown=function(i){return arguments.length?(r=i,o):r},o.quantiles=function(){return n.slice()},o.copy=function(){return Lq().domain(e).range(t).unknown(r)},Lr.apply(o,arguments)}function $q(){var e=0,t=1,n=1,r=[.5],a=[0,1],o;function i(c){return c!=null&&c<=c?a[Ep(r,c,0,n)]:o}function s(){var c=-1;for(r=new Array(n);++c<n;)r[c]=((c+1)*t-(c-n)*e)/(n+1);return i}return i.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,s()):[e,t]},i.range=function(c){return arguments.length?(n=(a=Array.from(c)).length-1,s()):a.slice()},i.invertExtent=function(c){var l=a.indexOf(c);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},i.unknown=function(c){return arguments.length&&(o=c),i},i.thresholds=function(){return r.slice()},i.copy=function(){return $q().domain([e,t]).range(a).unknown(o)},Lr.apply(Di(i),arguments)}function Fq(){var e=[.5],t=[0,1],n,r=1;function a(o){return o!=null&&o<=o?t[Ep(e,o,0,r)]:n}return a.domain=function(o){return arguments.length?(e=Array.from(o),r=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(o){return arguments.length?(t=Array.from(o),r=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(o){var i=t.indexOf(o);return[e[i-1],e[i]]},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return Fq().domain(e).range(t).unknown(n)},Lr.apply(a,arguments)}const TC=new Date,IC=new Date;function mn(e,t,n,r){function a(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return a.floor=o=>(e(o=new Date(+o)),o),a.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),a.round=o=>{const i=a(o),s=a.ceil(o);return o-i<s-o?i:s},a.offset=(o,i)=>(t(o=new Date(+o),i==null?1:Math.floor(i)),o),a.range=(o,i,s)=>{const c=[];if(o=a.ceil(o),s=s==null?1:Math.floor(s),!(o<i)||!(s>0))return c;let l;do c.push(l=new Date(+o)),t(o,s),e(o);while(l<o&&o<i);return c},a.filter=o=>mn(i=>{if(i>=i)for(;e(i),!o(i);)i.setTime(i-1)},(i,s)=>{if(i>=i)if(s<0)for(;++s<=0;)for(;t(i,-1),!o(i););else for(;--s>=0;)for(;t(i,1),!o(i););}),n&&(a.count=(o,i)=>(TC.setTime(+o),IC.setTime(+i),e(TC),e(IC),Math.floor(n(TC,IC))),a.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?a.filter(r?i=>r(i)%o===0:i=>a.count(0,i)%o===0):a)),a}const vg=mn(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);vg.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?mn(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):vg),vg.range;const Zo=1e3,$r=Zo*60,Go=$r*60,Xo=Go*24,RC=Xo*7,Bq=Xo*30,DC=Xo*365,ks=mn(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Zo)},(e,t)=>(t-e)/Zo,e=>e.getUTCSeconds());ks.range;const LC=mn(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Zo)},(e,t)=>{e.setTime(+e+t*$r)},(e,t)=>(t-e)/$r,e=>e.getMinutes());LC.range;const $C=mn(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*$r)},(e,t)=>(t-e)/$r,e=>e.getUTCMinutes());$C.range;const FC=mn(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Zo-e.getMinutes()*$r)},(e,t)=>{e.setTime(+e+t*Go)},(e,t)=>(t-e)/Go,e=>e.getHours());FC.range;const BC=mn(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Go)},(e,t)=>(t-e)/Go,e=>e.getUTCHours());BC.range;const Pp=mn(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*$r)/Xo,e=>e.getDate()-1);Pp.range;const bg=mn(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Xo,e=>e.getUTCDate()-1);bg.range;const zq=mn(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Xo,e=>Math.floor(e/Xo));zq.range;function Ps(e){return mn(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*$r)/RC)}const wg=Ps(0),xg=Ps(1),wOe=Ps(2),xOe=Ps(3),El=Ps(4),_Oe=Ps(5),jOe=Ps(6);wg.range,xg.range,wOe.range,xOe.range,El.range,_Oe.range,jOe.range;function As(e){return mn(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/RC)}const _g=As(0),jg=As(1),SOe=As(2),EOe=As(3),Ol=As(4),OOe=As(5),COe=As(6);_g.range,jg.range,SOe.range,EOe.range,Ol.range,OOe.range,COe.range;const zC=mn(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());zC.range;const UC=mn(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());UC.range;const Jo=mn(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Jo.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:mn(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}),Jo.range;const Yo=mn(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Yo.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:mn(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}),Yo.range;function Uq(e,t,n,r,a,o){const i=[[ks,1,Zo],[ks,5,5*Zo],[ks,15,15*Zo],[ks,30,30*Zo],[o,1,$r],[o,5,5*$r],[o,15,15*$r],[o,30,30*$r],[a,1,Go],[a,3,3*Go],[a,6,6*Go],[a,12,12*Go],[r,1,Xo],[r,2,2*Xo],[n,1,RC],[t,1,Bq],[t,3,3*Bq],[e,1,DC]];function s(l,u,d){const p=u<l;p&&([l,u]=[u,l]);const f=d&&typeof d.range=="function"?d:c(l,u,d),m=f?f.range(l,+u+1):[];return p?m.reverse():m}function c(l,u,d){const p=Math.abs(u-l)/d,f=bC(([,,v])=>v).right(i,p);if(f===i.length)return e.every(_C(l/DC,u/DC,d));if(f===0)return vg.every(Math.max(_C(l,u,d),1));const[m,y]=i[p/i[f-1][2]<i[f][2]/p?f-1:f];return m.every(y)}return[s,c]}const[NOe,MOe]=Uq(Yo,UC,_g,zq,BC,$C),[kOe,POe]=Uq(Jo,zC,wg,Pp,FC,LC);function VC(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function qC(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ap(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function AOe(e){var t=e.dateTime,n=e.date,r=e.time,a=e.periods,o=e.days,i=e.shortDays,s=e.months,c=e.shortMonths,l=Tp(a),u=Ip(a),d=Tp(o),p=Ip(o),f=Tp(i),m=Ip(i),y=Tp(s),v=Ip(s),b=Tp(c),w=Ip(c),j={a:R,A:L,b:D,B:z,c:null,d:Zq,e:Zq,f:tCe,g:dCe,G:fCe,H:YOe,I:QOe,j:eCe,L:Gq,m:nCe,M:rCe,p:B,q:$,Q:tW,s:nW,S:aCe,u:oCe,U:iCe,V:sCe,w:cCe,W:lCe,x:null,X:null,y:uCe,Y:pCe,Z:hCe,"%":eW},x={a:U,A:F,b:H,B:re,c:null,d:Jq,e:Jq,f:vCe,g:NCe,G:kCe,H:mCe,I:yCe,j:gCe,L:Yq,m:bCe,M:wCe,p:ee,q:G,Q:tW,s:nW,S:xCe,u:_Ce,U:jCe,V:SCe,w:ECe,W:OCe,x:null,X:null,y:CCe,Y:MCe,Z:PCe,"%":eW},_={a:M,A:k,b:P,B:A,c:C,d:Hq,e:Hq,f:ZOe,g:Wq,G:qq,H:Kq,I:Kq,j:qOe,L:KOe,m:VOe,M:WOe,p:N,q:UOe,Q:XOe,s:JOe,S:HOe,u:LOe,U:$Oe,V:FOe,w:DOe,W:BOe,x:I,X:T,y:Wq,Y:qq,Z:zOe,"%":GOe};j.x=S(n,j),j.X=S(r,j),j.c=S(t,j),x.x=S(n,x),x.X=S(r,x),x.c=S(t,x);function S(K,X){return function(ne){var V=[],le=-1,ae=0,de=K.length,je,Le,$e;for(ne instanceof Date||(ne=new Date(+ne));++le<de;)K.charCodeAt(le)===37&&(V.push(K.slice(ae,le)),(Le=Vq[je=K.charAt(++le)])!=null?je=K.charAt(++le):Le=je==="e"?" ":"0",($e=X[je])&&(je=$e(ne,Le)),V.push(je),ae=le+1);return V.push(K.slice(ae,le)),V.join("")}}function E(K,X){return function(ne){var V=Ap(1900,void 0,1),le=O(V,K,ne+="",0),ae,de;if(le!=ne.length)return null;if("Q"in V)return new Date(V.Q);if("s"in V)return new Date(V.s*1e3+("L"in V?V.L:0));if(X&&!("Z"in V)&&(V.Z=0),"p"in V&&(V.H=V.H%12+V.p*12),V.m===void 0&&(V.m="q"in V?V.q:0),"V"in V){if(V.V<1||V.V>53)return null;"w"in V||(V.w=1),"Z"in V?(ae=qC(Ap(V.y,0,1)),de=ae.getUTCDay(),ae=de>4||de===0?jg.ceil(ae):jg(ae),ae=bg.offset(ae,(V.V-1)*7),V.y=ae.getUTCFullYear(),V.m=ae.getUTCMonth(),V.d=ae.getUTCDate()+(V.w+6)%7):(ae=VC(Ap(V.y,0,1)),de=ae.getDay(),ae=de>4||de===0?xg.ceil(ae):xg(ae),ae=Pp.offset(ae,(V.V-1)*7),V.y=ae.getFullYear(),V.m=ae.getMonth(),V.d=ae.getDate()+(V.w+6)%7)}else("W"in V||"U"in V)&&("w"in V||(V.w="u"in V?V.u%7:"W"in V?1:0),de="Z"in V?qC(Ap(V.y,0,1)).getUTCDay():VC(Ap(V.y,0,1)).getDay(),V.m=0,V.d="W"in V?(V.w+6)%7+V.W*7-(de+5)%7:V.w+V.U*7-(de+6)%7);return"Z"in V?(V.H+=V.Z/100|0,V.M+=V.Z%100,qC(V)):VC(V)}}function O(K,X,ne,V){for(var le=0,ae=X.length,de=ne.length,je,Le;le<ae;){if(V>=de)return-1;if(je=X.charCodeAt(le++),je===37){if(je=X.charAt(le++),Le=_[je in Vq?X.charAt(le++):je],!Le||(V=Le(K,ne,V))<0)return-1}else if(je!=ne.charCodeAt(V++))return-1}return V}function N(K,X,ne){var V=l.exec(X.slice(ne));return V?(K.p=u.get(V[0].toLowerCase()),ne+V[0].length):-1}function M(K,X,ne){var V=f.exec(X.slice(ne));return V?(K.w=m.get(V[0].toLowerCase()),ne+V[0].length):-1}function k(K,X,ne){var V=d.exec(X.slice(ne));return V?(K.w=p.get(V[0].toLowerCase()),ne+V[0].length):-1}function P(K,X,ne){var V=b.exec(X.slice(ne));return V?(K.m=w.get(V[0].toLowerCase()),ne+V[0].length):-1}function A(K,X,ne){var V=y.exec(X.slice(ne));return V?(K.m=v.get(V[0].toLowerCase()),ne+V[0].length):-1}function C(K,X,ne){return O(K,t,X,ne)}function I(K,X,ne){return O(K,n,X,ne)}function T(K,X,ne){return O(K,r,X,ne)}function R(K){return i[K.getDay()]}function L(K){return o[K.getDay()]}function D(K){return c[K.getMonth()]}function z(K){return s[K.getMonth()]}function B(K){return a[+(K.getHours()>=12)]}function $(K){return 1+~~(K.getMonth()/3)}function U(K){return i[K.getUTCDay()]}function F(K){return o[K.getUTCDay()]}function H(K){return c[K.getUTCMonth()]}function re(K){return s[K.getUTCMonth()]}function ee(K){return a[+(K.getUTCHours()>=12)]}function G(K){return 1+~~(K.getUTCMonth()/3)}return{format:function(K){var X=S(K+="",j);return X.toString=function(){return K},X},parse:function(K){var X=E(K+="",!1);return X.toString=function(){return K},X},utcFormat:function(K){var X=S(K+="",x);return X.toString=function(){return K},X},utcParse:function(K){var X=E(K+="",!0);return X.toString=function(){return K},X}}}var Vq={"-":"",_:" ",0:"0"},xn=/^\s*\d+/,TOe=/^%/,IOe=/[\\^$*+?|[\]().{}]/g;function ft(e,t,n){var r=e<0?"-":"",a=(r?-e:e)+"",o=a.length;return r+(o<n?new Array(n-o+1).join(t)+a:a)}function ROe(e){return e.replace(IOe,"\\$&")}function Tp(e){return new RegExp("^(?:"+e.map(ROe).join("|")+")","i")}function Ip(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function DOe(e,t,n){var r=xn.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function LOe(e,t,n){var r=xn.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function $Oe(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function FOe(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function BOe(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function qq(e,t,n){var r=xn.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Wq(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function zOe(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function UOe(e,t,n){var r=xn.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function VOe(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Hq(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function qOe(e,t,n){var r=xn.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Kq(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function WOe(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function HOe(e,t,n){var r=xn.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function KOe(e,t,n){var r=xn.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function ZOe(e,t,n){var r=xn.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function GOe(e,t,n){var r=TOe.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function XOe(e,t,n){var r=xn.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function JOe(e,t,n){var r=xn.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Zq(e,t){return ft(e.getDate(),t,2)}function YOe(e,t){return ft(e.getHours(),t,2)}function QOe(e,t){return ft(e.getHours()%12||12,t,2)}function eCe(e,t){return ft(1+Pp.count(Jo(e),e),t,3)}function Gq(e,t){return ft(e.getMilliseconds(),t,3)}function tCe(e,t){return Gq(e,t)+"000"}function nCe(e,t){return ft(e.getMonth()+1,t,2)}function rCe(e,t){return ft(e.getMinutes(),t,2)}function aCe(e,t){return ft(e.getSeconds(),t,2)}function oCe(e){var t=e.getDay();return t===0?7:t}function iCe(e,t){return ft(wg.count(Jo(e)-1,e),t,2)}function Xq(e){var t=e.getDay();return t>=4||t===0?El(e):El.ceil(e)}function sCe(e,t){return e=Xq(e),ft(El.count(Jo(e),e)+(Jo(e).getDay()===4),t,2)}function cCe(e){return e.getDay()}function lCe(e,t){return ft(xg.count(Jo(e)-1,e),t,2)}function uCe(e,t){return ft(e.getFullYear()%100,t,2)}function dCe(e,t){return e=Xq(e),ft(e.getFullYear()%100,t,2)}function pCe(e,t){return ft(e.getFullYear()%1e4,t,4)}function fCe(e,t){var n=e.getDay();return e=n>=4||n===0?El(e):El.ceil(e),ft(e.getFullYear()%1e4,t,4)}function hCe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ft(t/60|0,"0",2)+ft(t%60,"0",2)}function Jq(e,t){return ft(e.getUTCDate(),t,2)}function mCe(e,t){return ft(e.getUTCHours(),t,2)}function yCe(e,t){return ft(e.getUTCHours()%12||12,t,2)}function gCe(e,t){return ft(1+bg.count(Yo(e),e),t,3)}function Yq(e,t){return ft(e.getUTCMilliseconds(),t,3)}function vCe(e,t){return Yq(e,t)+"000"}function bCe(e,t){return ft(e.getUTCMonth()+1,t,2)}function wCe(e,t){return ft(e.getUTCMinutes(),t,2)}function xCe(e,t){return ft(e.getUTCSeconds(),t,2)}function _Ce(e){var t=e.getUTCDay();return t===0?7:t}function jCe(e,t){return ft(_g.count(Yo(e)-1,e),t,2)}function Qq(e){var t=e.getUTCDay();return t>=4||t===0?Ol(e):Ol.ceil(e)}function SCe(e,t){return e=Qq(e),ft(Ol.count(Yo(e),e)+(Yo(e).getUTCDay()===4),t,2)}function ECe(e){return e.getUTCDay()}function OCe(e,t){return ft(jg.count(Yo(e)-1,e),t,2)}function CCe(e,t){return ft(e.getUTCFullYear()%100,t,2)}function NCe(e,t){return e=Qq(e),ft(e.getUTCFullYear()%100,t,2)}function MCe(e,t){return ft(e.getUTCFullYear()%1e4,t,4)}function kCe(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Ol(e):Ol.ceil(e),ft(e.getUTCFullYear()%1e4,t,4)}function PCe(){return"+0000"}function eW(){return"%"}function tW(e){return+e}function nW(e){return Math.floor(+e/1e3)}var Cl,rW,aW;ACe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ACe(e){return Cl=AOe(e),rW=Cl.format,Cl.parse,aW=Cl.utcFormat,Cl.utcParse,Cl}function TCe(e){return new Date(e)}function ICe(e){return e instanceof Date?+e:+new Date(+e)}function WC(e,t,n,r,a,o,i,s,c,l){var u=OC(),d=u.invert,p=u.domain,f=l(".%L"),m=l(":%S"),y=l("%I:%M"),v=l("%I %p"),b=l("%a %d"),w=l("%b %d"),j=l("%B"),x=l("%Y");function _(S){return(c(S)<S?f:s(S)<S?m:i(S)<S?y:o(S)<S?v:r(S)<S?a(S)<S?b:w:n(S)<S?j:x)(S)}return u.invert=function(S){return new Date(d(S))},u.domain=function(S){return arguments.length?p(Array.from(S,ICe)):p().map(TCe)},u.ticks=function(S){var E=p();return e(E[0],E[E.length-1],S??10)},u.tickFormat=function(S,E){return E==null?_:l(E)},u.nice=function(S){var E=p();return(!S||typeof S.range!="function")&&(S=t(E[0],E[E.length-1],S??10)),S?p(Oq(E,S)):u},u.copy=function(){return Mp(u,WC(e,t,n,r,a,o,i,s,c,l))},u}function RCe(){return Lr.apply(WC(kOe,POe,Jo,zC,wg,Pp,FC,LC,ks,rW).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function DCe(){return Lr.apply(WC(NOe,MOe,Yo,UC,_g,bg,BC,$C,ks,aW).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Sg(){var e=0,t=1,n,r,a,o,i=Xn,s=!1,c;function l(d){return d==null||isNaN(d=+d)?c:i(a===0?.5:(d=(o(d)-n)*a,s?Math.max(0,Math.min(1,d)):d))}l.domain=function(d){return arguments.length?([e,t]=d,n=o(e=+e),r=o(t=+t),a=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(d){return arguments.length?(s=!!d,l):s},l.interpolator=function(d){return arguments.length?(i=d,l):i};function u(d){return function(p){var f,m;return arguments.length?([f,m]=p,i=d(f,m),l):[i(0),i(1)]}}return l.range=u(_c),l.rangeRound=u(c_),l.unknown=function(d){return arguments.length?(c=d,l):c},function(d){return o=d,n=d(e),r=d(t),a=n===r?0:1/(r-n),l}}function Li(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function oW(){var e=Di(Sg()(Xn));return e.copy=function(){return Li(e,oW())},Ko.apply(e,arguments)}function iW(){var e=MC(Sg()).domain([1,10]);return e.copy=function(){return Li(e,iW()).base(e.base())},Ko.apply(e,arguments)}function sW(){var e=kC(Sg());return e.copy=function(){return Li(e,sW()).constant(e.constant())},Ko.apply(e,arguments)}function HC(){var e=PC(Sg());return e.copy=function(){return Li(e,HC()).exponent(e.exponent())},Ko.apply(e,arguments)}function LCe(){return HC.apply(null,arguments).exponent(.5)}function cW(){var e=[],t=Xn;function n(r){if(r!=null&&!isNaN(r=+r))return t((Ep(e,r,1)-1)/(e.length-1))}return n.domain=function(r){if(!arguments.length)return e.slice();e=[];for(let a of r)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Ri),n},n.interpolator=function(r){return arguments.length?(t=r,n):t},n.range=function(){return e.map((r,a)=>t(a/(e.length-1)))},n.quantiles=function(r){return Array.from({length:r+1},(a,o)=>KEe(e,o/r))},n.copy=function(){return cW(t).domain(e)},Ko.apply(n,arguments)}function Eg(){var e=0,t=.5,n=1,r=1,a,o,i,s,c,l=Xn,u,d=!1,p;function f(y){return isNaN(y=+y)?p:(y=.5+((y=+u(y))-o)*(r*y<r*o?s:c),l(d?Math.max(0,Math.min(1,y)):y))}f.domain=function(y){return arguments.length?([e,t,n]=y,a=u(e=+e),o=u(t=+t),i=u(n=+n),s=a===o?0:.5/(o-a),c=o===i?0:.5/(i-o),r=o<a?-1:1,f):[e,t,n]},f.clamp=function(y){return arguments.length?(d=!!y,f):d},f.interpolator=function(y){return arguments.length?(l=y,f):l};function m(y){return function(v){var b,w,j;return arguments.length?([b,w,j]=v,l=nse(y,[b,w,j]),f):[l(0),l(.5),l(1)]}}return f.range=m(_c),f.rangeRound=m(c_),f.unknown=function(y){return arguments.length?(p=y,f):p},function(y){return u=y,a=y(e),o=y(t),i=y(n),s=a===o?0:.5/(o-a),c=o===i?0:.5/(i-o),r=o<a?-1:1,f}}function lW(){var e=Di(Eg()(Xn));return e.copy=function(){return Li(e,lW())},Ko.apply(e,arguments)}function uW(){var e=MC(Eg()).domain([.1,1,10]);return e.copy=function(){return Li(e,uW()).base(e.base())},Ko.apply(e,arguments)}function dW(){var e=kC(Eg());return e.copy=function(){return Li(e,dW()).constant(e.constant())},Ko.apply(e,arguments)}function KC(){var e=PC(Eg());return e.copy=function(){return Li(e,KC()).exponent(e.exponent())},Ko.apply(e,arguments)}function $Ce(){return KC.apply(null,arguments).exponent(.5)}const pW=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Cp,scaleDiverging:lW,scaleDivergingLog:uW,scaleDivergingPow:KC,scaleDivergingSqrt:$Ce,scaleDivergingSymlog:dW,scaleIdentity:Eq,scaleImplicit:jC,scaleLinear:gg,scaleLog:kq,scaleOrdinal:SC,scalePoint:Np,scalePow:AC,scaleQuantile:Lq,scaleQuantize:$q,scaleRadial:Dq,scaleSequential:oW,scaleSequentialLog:iW,scaleSequentialPow:HC,scaleSequentialQuantile:cW,scaleSequentialSqrt:LCe,scaleSequentialSymlog:sW,scaleSqrt:vOe,scaleSymlog:Tq,scaleThreshold:Fq,scaleTime:RCe,scaleUtc:DCe,tickFormat:Sq},Symbol.toStringTag,{value:"Module"}));var ZC,fW;function hW(){if(fW)return ZC;fW=1;var e=gc();function t(n,r,a){for(var o=-1,i=n.length;++o<i;){var s=n[o],c=r(s);if(c!=null&&(l===void 0?c===c&&!e(c):a(c,l)))var l=c,u=s}return u}return ZC=t,ZC}var GC,mW;function FCe(){if(mW)return GC;mW=1;function e(t,n){return t>n}return GC=e,GC}var XC,yW;function BCe(){if(yW)return XC;yW=1;var e=hW(),t=FCe(),n=vc();function r(a){return a&&a.length?e(a,n,t):void 0}return XC=r,XC}var zCe=BCe();const Og=st(zCe);var JC,gW;function UCe(){if(gW)return JC;gW=1;function e(t,n){return t<n}return JC=e,JC}var YC,vW;function VCe(){if(vW)return YC;vW=1;var e=hW(),t=UCe(),n=vc();function r(a){return a&&a.length?e(a,n,t):void 0}return YC=r,YC}var qCe=VCe();const Cg=st(qCe);var QC,bW;YM=function(){if(bW)return QC;bW=1;var e=iu(),t=za(),n=mV(),r=Wn();function a(o,i){var s=r(o)?e:n;return s(o,t(i,3))}return QC=a,QC};var eN,wW;function WCe(){if(wW)return eN;wW=1;var e=Av(),t=YM();function n(r,a){return e(t(r,a),1)}return eN=n,eN}var HCe=WCe();const KCe=st(HCe);var tN,xW;function ZCe(){if(xW)return tN;xW=1;var e=c1();function t(n,r){return e(n,r)}return tN=t,tN}var GCe=ZCe();const nN=st(GCe);var Nl=1e9,XCe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},oN,Vt=!0,Fr="[DecimalError] ",Ts=Fr+"Invalid argument: ",rN=Fr+"Exponent out of range: ",Ml=Math.floor,Is=Math.pow,JCe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Sr,_n=1e7,Ft=7,_W=9007199254740991,Ng=Ml(_W/Ft),Ce={};Ce.absoluteValue=Ce.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},Ce.comparedTo=Ce.cmp=function(e){var t,n,r,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(r=o.d.length,a=e.d.length,t=0,n=r<a?r:a;t<n;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return r===a?0:r>a^o.s<0?1:-1},Ce.decimalPlaces=Ce.dp=function(){var e=this,t=e.d.length-1,n=(t-e.e)*Ft;if(t=e.d[t],t)for(;t%10==0;t/=10)n--;return n<0?0:n},Ce.dividedBy=Ce.div=function(e){return Qo(this,new this.constructor(e))},Ce.dividedToIntegerBy=Ce.idiv=function(e){var t=this,n=t.constructor;return Tt(Qo(t,new n(e),0,1),n.precision)},Ce.equals=Ce.eq=function(e){return!this.cmp(e)},Ce.exponent=function(){return sn(this)},Ce.greaterThan=Ce.gt=function(e){return this.cmp(e)>0},Ce.greaterThanOrEqualTo=Ce.gte=function(e){return this.cmp(e)>=0},Ce.isInteger=Ce.isint=function(){return this.e>this.d.length-2},Ce.isNegative=Ce.isneg=function(){return this.s<0},Ce.isPositive=Ce.ispos=function(){return this.s>0},Ce.isZero=function(){return this.s===0},Ce.lessThan=Ce.lt=function(e){return this.cmp(e)<0},Ce.lessThanOrEqualTo=Ce.lte=function(e){return this.cmp(e)<1},Ce.logarithm=Ce.log=function(e){var t,n=this,r=n.constructor,a=r.precision,o=a+5;if(e===void 0)e=new r(10);else if(e=new r(e),e.s<1||e.eq(Sr))throw Error(Fr+"NaN");if(n.s<1)throw Error(Fr+(n.s?"NaN":"-Infinity"));return n.eq(Sr)?new r(0):(Vt=!1,t=Qo(Rp(n,o),Rp(e,o),o),Vt=!0,Tt(t,a))},Ce.minus=Ce.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?OW(t,e):jW(t,(e.s=-e.s,e))},Ce.modulo=Ce.mod=function(e){var t,n=this,r=n.constructor,a=r.precision;if(e=new r(e),!e.s)throw Error(Fr+"NaN");return n.s?(Vt=!1,t=Qo(n,e,0,1).times(e),Vt=!0,n.minus(t)):Tt(new r(n),a)},Ce.naturalExponential=Ce.exp=function(){return SW(this)},Ce.naturalLogarithm=Ce.ln=function(){return Rp(this)},Ce.negated=Ce.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},Ce.plus=Ce.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?jW(t,e):OW(t,(e.s=-e.s,e))},Ce.precision=Ce.sd=function(e){var t,n,r,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Ts+e);if(t=sn(a)+1,r=a.d.length-1,n=r*Ft+1,r=a.d[r],r){for(;r%10==0;r/=10)n--;for(r=a.d[0];r>=10;r/=10)n++}return e&&t>n?t:n},Ce.squareRoot=Ce.sqrt=function(){var e,t,n,r,a,o,i,s=this,c=s.constructor;if(s.s<1){if(!s.s)return new c(0);throw Error(Fr+"NaN")}for(e=sn(s),Vt=!1,a=Math.sqrt(+s),a==0||a==1/0?(t=no(s.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=Ml((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),r=new c(t)):r=new c(a.toString()),n=c.precision,a=i=n+3;;)if(o=r,r=o.plus(Qo(s,o,i+2)).times(.5),no(o.d).slice(0,i)===(t=no(r.d)).slice(0,i)){if(t=t.slice(i-3,i+1),a==i&&t=="4999"){if(Tt(o,n+1,0),o.times(o).eq(s)){r=o;break}}else if(t!="9999")break;i+=4}return Vt=!0,Tt(r,n)},Ce.times=Ce.mul=function(e){var t,n,r,a,o,i,s,c,l,u=this,d=u.constructor,p=u.d,f=(e=new d(e)).d;if(!u.s||!e.s)return new d(0);for(e.s*=u.s,n=u.e+e.e,c=p.length,l=f.length,c<l&&(o=p,p=f,f=o,i=c,c=l,l=i),o=[],i=c+l,r=i;r--;)o.push(0);for(r=l;--r>=0;){for(t=0,a=c+r;a>r;)s=o[a]+f[r]*p[a-r-1]+t,o[a--]=s%_n|0,t=s/_n|0;o[a]=(o[a]+t)%_n|0}for(;!o[--i];)o.pop();return t?++n:o.shift(),e.d=o,e.e=n,Vt?Tt(e,d.precision):e},Ce.toDecimalPlaces=Ce.todp=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(to(e,0,Nl),t===void 0?t=r.rounding:to(t,0,8),Tt(n,e+sn(n)+1,t))},Ce.toExponential=function(e,t){var n,r=this,a=r.constructor;return e===void 0?n=Rs(r,!0):(to(e,0,Nl),t===void 0?t=a.rounding:to(t,0,8),r=Tt(new a(r),e+1,t),n=Rs(r,!0,e+1)),n},Ce.toFixed=function(e,t){var n,r,a=this,o=a.constructor;return e===void 0?Rs(a):(to(e,0,Nl),t===void 0?t=o.rounding:to(t,0,8),r=Tt(new o(a),e+sn(a)+1,t),n=Rs(r.abs(),!1,e+sn(r)+1),a.isneg()&&!a.isZero()?"-"+n:n)},Ce.toInteger=Ce.toint=function(){var e=this,t=e.constructor;return Tt(new t(e),sn(e)+1,t.rounding)},Ce.toNumber=function(){return+this},Ce.toPower=Ce.pow=function(e){var t,n,r,a,o,i,s=this,c=s.constructor,l=12,u=+(e=new c(e));if(!e.s)return new c(Sr);if(s=new c(s),!s.s){if(e.s<1)throw Error(Fr+"Infinity");return s}if(s.eq(Sr))return s;if(r=c.precision,e.eq(Sr))return Tt(s,r);if(t=e.e,n=e.d.length-1,i=t>=n,o=s.s,i){if((n=u<0?-u:u)<=_W){for(a=new c(Sr),t=Math.ceil(r/Ft+4),Vt=!1;n%2&&(a=a.times(s),CW(a.d,t)),n=Ml(n/2),n!==0;)s=s.times(s),CW(s.d,t);return Vt=!0,e.s<0?new c(Sr).div(a):Tt(a,r)}}else if(o<0)throw Error(Fr+"NaN");return o=o<0&&e.d[Math.max(t,n)]&1?-1:1,s.s=1,Vt=!1,a=e.times(Rp(s,r+l)),Vt=!0,a=SW(a),a.s=o,a},Ce.toPrecision=function(e,t){var n,r,a=this,o=a.constructor;return e===void 0?(n=sn(a),r=Rs(a,n<=o.toExpNeg||n>=o.toExpPos)):(to(e,1,Nl),t===void 0?t=o.rounding:to(t,0,8),a=Tt(new o(a),e,t),n=sn(a),r=Rs(a,e<=n||n<=o.toExpNeg,e)),r},Ce.toSignificantDigits=Ce.tosd=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(to(e,1,Nl),t===void 0?t=r.rounding:to(t,0,8)),Tt(new r(n),e,t)},Ce.toString=Ce.valueOf=Ce.val=Ce.toJSON=Ce[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=sn(e),n=e.constructor;return Rs(e,t<=n.toExpNeg||t>=n.toExpPos)};function jW(e,t){var n,r,a,o,i,s,c,l,u=e.constructor,d=u.precision;if(!e.s||!t.s)return t.s||(t=new u(e)),Vt?Tt(t,d):t;if(c=e.d,l=t.d,i=e.e,a=t.e,c=c.slice(),o=i-a,o){for(o<0?(r=c,o=-o,s=l.length):(r=l,a=i,s=c.length),i=Math.ceil(d/Ft),s=i>s?i+1:s+1,o>s&&(o=s,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(s=c.length,o=l.length,s-o<0&&(o=s,r=l,l=c,c=r),n=0;o;)n=(c[--o]=c[o]+l[o]+n)/_n|0,c[o]%=_n;for(n&&(c.unshift(n),++a),s=c.length;c[--s]==0;)c.pop();return t.d=c,t.e=a,Vt?Tt(t,d):t}function to(e,t,n){if(e!==~~e||e<t||e>n)throw Error(Ts+e)}function no(e){var t,n,r,a=e.length-1,o="",i=e[0];if(a>0){for(o+=i,t=1;t<a;t++)r=e[t]+"",n=Ft-r.length,n&&(o+=$i(n)),o+=r;i=e[t],r=i+"",n=Ft-r.length,n&&(o+=$i(n))}else if(i===0)return"0";for(;i%10===0;)i/=10;return o+i}var Qo=function(){function e(r,a){var o,i=0,s=r.length;for(r=r.slice();s--;)o=r[s]*a+i,r[s]=o%_n|0,i=o/_n|0;return i&&r.unshift(i),r}function t(r,a,o,i){var s,c;if(o!=i)c=o>i?1:-1;else for(s=c=0;s<o;s++)if(r[s]!=a[s]){c=r[s]>a[s]?1:-1;break}return c}function n(r,a,o){for(var i=0;o--;)r[o]-=i,i=r[o]<a[o]?1:0,r[o]=i*_n+r[o]-a[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,a,o,i){var s,c,l,u,d,p,f,m,y,v,b,w,j,x,_,S,E,O,N=r.constructor,M=r.s==a.s?1:-1,k=r.d,P=a.d;if(!r.s)return new N(r);if(!a.s)throw Error(Fr+"Division by zero");for(c=r.e-a.e,E=P.length,_=k.length,f=new N(M),m=f.d=[],l=0;P[l]==(k[l]||0);)++l;if(P[l]>(k[l]||0)&&--c,o==null?w=o=N.precision:i?w=o+(sn(r)-sn(a))+1:w=o,w<0)return new N(0);if(w=w/Ft+2|0,l=0,E==1)for(u=0,P=P[0],w++;(l<_||u)&&w--;l++)j=u*_n+(k[l]||0),m[l]=j/P|0,u=j%P|0;else{for(u=_n/(P[0]+1)|0,u>1&&(P=e(P,u),k=e(k,u),E=P.length,_=k.length),x=E,y=k.slice(0,E),v=y.length;v<E;)y[v++]=0;O=P.slice(),O.unshift(0),S=P[0],P[1]>=_n/2&&++S;do u=0,s=t(P,y,E,v),s<0?(b=y[0],E!=v&&(b=b*_n+(y[1]||0)),u=b/S|0,u>1?(u>=_n&&(u=_n-1),d=e(P,u),p=d.length,v=y.length,s=t(d,y,p,v),s==1&&(u--,n(d,E<p?O:P,p))):(u==0&&(s=u=1),d=P.slice()),p=d.length,p<v&&d.unshift(0),n(y,d,v),s==-1&&(v=y.length,s=t(P,y,E,v),s<1&&(u++,n(y,E<v?O:P,v))),v=y.length):s===0&&(u++,y=[0]),m[l++]=u,s&&y[0]?y[v++]=k[x]||0:(y=[k[x]],v=1);while((x++<_||y[0]!==void 0)&&w--)}return m[0]||m.shift(),f.e=c,Tt(f,i?o+sn(f)+1:o)}}();function SW(e,t){var n,r,a,o,i,s,c=0,l=0,u=e.constructor,d=u.precision;if(sn(e)>16)throw Error(rN+sn(e));if(!e.s)return new u(Sr);for(t==null?(Vt=!1,s=d):s=t,i=new u(.03125);e.abs().gte(.1);)e=e.times(i),l+=5;for(r=Math.log(Is(2,l))/Math.LN10*2+5|0,s+=r,n=a=o=new u(Sr),u.precision=s;;){if(a=Tt(a.times(e),s),n=n.times(++c),i=o.plus(Qo(a,n,s)),no(i.d).slice(0,s)===no(o.d).slice(0,s)){for(;l--;)o=Tt(o.times(o),s);return u.precision=d,t==null?(Vt=!0,Tt(o,d)):o}o=i}}function sn(e){for(var t=e.e*Ft,n=e.d[0];n>=10;n/=10)t++;return t}function aN(e,t,n){if(t>e.LN10.sd())throw Vt=!0,n&&(e.precision=n),Error(Fr+"LN10 precision limit exceeded");return Tt(new e(e.LN10),t)}function $i(e){for(var t="";e--;)t+="0";return t}function Rp(e,t){var n,r,a,o,i,s,c,l,u,d=1,p=10,f=e,m=f.d,y=f.constructor,v=y.precision;if(f.s<1)throw Error(Fr+(f.s?"NaN":"-Infinity"));if(f.eq(Sr))return new y(0);if(t==null?(Vt=!1,l=v):l=t,f.eq(10))return t==null&&(Vt=!0),aN(y,l);if(l+=p,y.precision=l,n=no(m),r=n.charAt(0),o=sn(f),Math.abs(o)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)f=f.times(e),n=no(f.d),r=n.charAt(0),d++;o=sn(f),r>1?(f=new y("0."+n),o++):f=new y(r+"."+n.slice(1))}else return c=aN(y,l+2,v).times(o+""),f=Rp(new y(r+"."+n.slice(1)),l-p).plus(c),y.precision=v,t==null?(Vt=!0,Tt(f,v)):f;for(s=i=f=Qo(f.minus(Sr),f.plus(Sr),l),u=Tt(f.times(f),l),a=3;;){if(i=Tt(i.times(u),l),c=s.plus(Qo(i,new y(a),l)),no(c.d).slice(0,l)===no(s.d).slice(0,l))return s=s.times(2),o!==0&&(s=s.plus(aN(y,l+2,v).times(o+""))),s=Qo(s,new y(d),l),y.precision=v,t==null?(Vt=!0,Tt(s,v)):s;s=c,a+=2}}function EW(e,t){var n,r,a;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;)++r;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(r,a),t){if(a-=r,n=n-r-1,e.e=Ml(n/Ft),e.d=[],r=(n+1)%Ft,n<0&&(r+=Ft),r<a){for(r&&e.d.push(+t.slice(0,r)),a-=Ft;r<a;)e.d.push(+t.slice(r,r+=Ft));t=t.slice(r),r=Ft-t.length}else r-=a;for(;r--;)t+="0";if(e.d.push(+t),Vt&&(e.e>Ng||e.e<-Ng))throw Error(rN+n)}else e.s=0,e.e=0,e.d=[0];return e}function Tt(e,t,n){var r,a,o,i,s,c,l,u,d=e.d;for(i=1,o=d[0];o>=10;o/=10)i++;if(r=t-i,r<0)r+=Ft,a=t,l=d[u=0];else{if(u=Math.ceil((r+1)/Ft),o=d.length,u>=o)return e;for(l=o=d[u],i=1;o>=10;o/=10)i++;r%=Ft,a=r-Ft+i}if(n!==void 0&&(o=Is(10,i-a-1),s=l/o%10|0,c=t<0||d[u+1]!==void 0||l%o,c=n<4?(s||c)&&(n==0||n==(e.s<0?3:2)):s>5||s==5&&(n==4||c||n==6&&(r>0?a>0?l/Is(10,i-a):0:d[u-1])%10&1||n==(e.s<0?8:7))),t<1||!d[0])return c?(o=sn(e),d.length=1,t=t-o-1,d[0]=Is(10,(Ft-t%Ft)%Ft),e.e=Ml(-t/Ft)||0):(d.length=1,d[0]=e.e=e.s=0),e;if(r==0?(d.length=u,o=1,u--):(d.length=u+1,o=Is(10,Ft-r),d[u]=a>0?(l/Is(10,i-a)%Is(10,a)|0)*o:0),c)for(;;)if(u==0){(d[0]+=o)==_n&&(d[0]=1,++e.e);break}else{if(d[u]+=o,d[u]!=_n)break;d[u--]=0,o=1}for(r=d.length;d[--r]===0;)d.pop();if(Vt&&(e.e>Ng||e.e<-Ng))throw Error(rN+sn(e));return e}function OW(e,t){var n,r,a,o,i,s,c,l,u,d,p=e.constructor,f=p.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new p(e),Vt?Tt(t,f):t;if(c=e.d,d=t.d,r=t.e,l=e.e,c=c.slice(),i=l-r,i){for(u=i<0,u?(n=c,i=-i,s=d.length):(n=d,r=l,s=c.length),a=Math.max(Math.ceil(f/Ft),s)+2,i>a&&(i=a,n.length=1),n.reverse(),a=i;a--;)n.push(0);n.reverse()}else{for(a=c.length,s=d.length,u=a<s,u&&(s=a),a=0;a<s;a++)if(c[a]!=d[a]){u=c[a]<d[a];break}i=0}for(u&&(n=c,c=d,d=n,t.s=-t.s),s=c.length,a=d.length-s;a>0;--a)c[s++]=0;for(a=d.length;a>i;){if(c[--a]<d[a]){for(o=a;o&&c[--o]===0;)c[o]=_n-1;--c[o],c[a]+=_n}c[a]-=d[a]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--r;return c[0]?(t.d=c,t.e=r,Vt?Tt(t,f):t):new p(0)}function Rs(e,t,n){var r,a=sn(e),o=no(e.d),i=o.length;return t?(n&&(r=n-i)>0?o=o.charAt(0)+"."+o.slice(1)+$i(r):i>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+$i(-a-1)+o,n&&(r=n-i)>0&&(o+=$i(r))):a>=i?(o+=$i(a+1-i),n&&(r=n-a-1)>0&&(o=o+"."+$i(r))):((r=a+1)<i&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-i)>0&&(a+1===i&&(o+="."),o+=$i(r))),e.s<0?"-"+o:o}function CW(e,t){if(e.length>t)return e.length=t,!0}function NW(e){var t,n,r;function a(o){var i=this;if(!(i instanceof a))return new a(o);if(i.constructor=a,o instanceof a){i.s=o.s,i.e=o.e,i.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(Ts+o);if(o>0)i.s=1;else if(o<0)o=-o,i.s=-1;else{i.s=0,i.e=0,i.d=[0];return}if(o===~~o&&o<1e7){i.e=0,i.d=[o];return}return EW(i,o.toString())}else if(typeof o!="string")throw Error(Ts+o);if(o.charCodeAt(0)===45?(o=o.slice(1),i.s=-1):i.s=1,JCe.test(o))EW(i,o);else throw Error(Ts+o)}if(a.prototype=Ce,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=NW,a.config=a.set=YCe,e===void 0&&(e={}),e)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return a.config(e),a}function YCe(e){if(!e||typeof e!="object")throw Error(Fr+"Object expected");var t,n,r,a=["precision",1,Nl,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((r=e[n=a[t]])!==void 0)if(Ml(r)===r&&r>=a[t+1]&&r<=a[t+2])this[n]=r;else throw Error(Ts+n+": "+r);if((r=e[n="LN10"])!==void 0)if(r==Math.LN10)this[n]=new this(r);else throw Error(Ts+n+": "+r);return this}var oN=NW(XCe);Sr=new oN(1);const Pt=oN;function QCe(e){return rNe(e)||nNe(e)||tNe(e)||eNe()}function eNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tNe(e,t){if(e){if(typeof e=="string")return iN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return iN(e,t)}}function nNe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function rNe(e){if(Array.isArray(e))return iN(e)}function iN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var aNe=function(e){return e},MW={"@@functional/placeholder":!0},kW=function(e){return e===MW},PW=function(e){return function t(){return arguments.length===0||arguments.length===1&&kW(arguments.length<=0?void 0:arguments[0])?t:e.apply(void 0,arguments)}},oNe=function e(t,n){return t===1?n:PW(function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var i=a.filter(function(s){return s!==MW}).length;return i>=t?n.apply(void 0,a):e(t-i,PW(function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];var u=a.map(function(d){return kW(d)?c.shift():d});return n.apply(void 0,QCe(u).concat(c))}))})},Mg=function(e){return oNe(e.length,e)},sN=function(e,t){for(var n=[],r=e;r<t;++r)n[r-e]=r;return n},iNe=Mg(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(n){return t[n]}).map(e)}),sNe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!t.length)return aNe;var r=t.reverse(),a=r[0],o=r.slice(1);return function(){return o.reduce(function(i,s){return s(i)},a.apply(void 0,arguments))}},cN=function(e){return Array.isArray(e)?e.reverse():e.split("").reverse.join("")},AW=function(e){var t=null,n=null;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t&&a.every(function(i,s){return i===t[s]})||(t=a,n=e.apply(void 0,a)),n}};function cNe(e){var t;return e===0?t=1:t=Math.floor(new Pt(e).abs().log(10).toNumber())+1,t}function lNe(e,t,n){for(var r=new Pt(e),a=0,o=[];r.lt(t)&&a<1e5;)o.push(r.toNumber()),r=r.add(n),a++;return o}var uNe=Mg(function(e,t,n){var r=+e,a=+t;return r+n*(a-r)}),dNe=Mg(function(e,t,n){var r=t-+e;return r=r||1/0,(n-e)/r}),pNe=Mg(function(e,t,n){var r=t-+e;return r=r||1/0,Math.max(0,Math.min(1,(n-e)/r))});const kg={rangeStep:lNe,getDigitCount:cNe,interpolateNumber:uNe,uninterpolateNumber:dNe,uninterpolateTruncation:pNe};function lN(e){return mNe(e)||hNe(e)||TW(e)||fNe()}function fNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hNe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function mNe(e){if(Array.isArray(e))return uN(e)}function Dp(e,t){return vNe(e)||gNe(e,t)||TW(e,t)||yNe()}function yNe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TW(e,t){if(e){if(typeof e=="string")return uN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uN(e,t)}}function uN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gNe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],r=!0,a=!1,o=void 0;try{for(var i=e[Symbol.iterator](),s;!(r=(s=i.next()).done)&&(n.push(s.value),!(t&&n.length===t));r=!0);}catch(c){a=!0,o=c}finally{try{!r&&i.return!=null&&i.return()}finally{if(a)throw o}}return n}}function vNe(e){if(Array.isArray(e))return e}function IW(e){var t=Dp(e,2),n=t[0],r=t[1],a=n,o=r;return n>r&&(a=r,o=n),[a,o]}function RW(e,t,n){if(e.lte(0))return new Pt(0);var r=kg.getDigitCount(e.toNumber()),a=new Pt(10).pow(r),o=e.div(a),i=r!==1?.05:.1,s=new Pt(Math.ceil(o.div(i).toNumber())).add(n).mul(i),c=s.mul(a);return t?c:new Pt(Math.ceil(c))}function bNe(e,t,n){var r=1,a=new Pt(e);if(!a.isint()&&n){var o=Math.abs(e);o<1?(r=new Pt(10).pow(kg.getDigitCount(e)-1),a=new Pt(Math.floor(a.div(r).toNumber())).mul(r)):o>1&&(a=new Pt(Math.floor(e)))}else e===0?a=new Pt(Math.floor((t-1)/2)):n||(a=new Pt(Math.floor(e)));var i=Math.floor((t-1)/2),s=sNe(iNe(function(c){return a.add(new Pt(c-i).mul(r)).toNumber()}),sN);return s(0,t)}function DW(e,t,n,r){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(n-1)))return{step:new Pt(0),tickMin:new Pt(0),tickMax:new Pt(0)};var o=RW(new Pt(t).sub(e).div(n-1),r,a),i;e<=0&&t>=0?i=new Pt(0):(i=new Pt(e).add(t).div(2),i=i.sub(new Pt(i).mod(o)));var s=Math.ceil(i.sub(e).div(o).toNumber()),c=Math.ceil(new Pt(t).sub(i).div(o).toNumber()),l=s+c+1;return l>n?DW(e,t,n,r,a+1):(l<n&&(c=t>0?c+(n-l):c,s=t>0?s:s+(n-l)),{step:o,tickMin:i.sub(new Pt(s).mul(o)),tickMax:i.add(new Pt(c).mul(o))})}function wNe(e){var t=Dp(e,2),n=t[0],r=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=Math.max(a,2),s=IW([n,r]),c=Dp(s,2),l=c[0],u=c[1];if(l===-1/0||u===1/0){var d=u===1/0?[l].concat(lN(sN(0,a-1).map(function(){return 1/0}))):[].concat(lN(sN(0,a-1).map(function(){return-1/0})),[u]);return n>r?cN(d):d}if(l===u)return bNe(l,a,o);var p=DW(l,u,i,o),f=p.step,m=p.tickMin,y=p.tickMax,v=kg.rangeStep(m,y.add(new Pt(.1).mul(f)),f);return n>r?cN(v):v}function xNe(e,t){var n=Dp(e,2),r=n[0],a=n[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=IW([r,a]),s=Dp(i,2),c=s[0],l=s[1];if(c===-1/0||l===1/0)return[r,a];if(c===l)return[c];var u=Math.max(t,2),d=RW(new Pt(l).sub(c).div(u-1),o,0),p=[].concat(lN(kg.rangeStep(new Pt(c),new Pt(l).sub(new Pt(.99).mul(d)),d)),[l]);return r>a?cN(p):p}var _Ne=AW(wNe),jNe=AW(xNe),SNe="Invariant failed";function Ds(e,t){throw new Error(SNe)}var ENe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function kl(e){"@babel/helpers - typeof";return kl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kl(e)}function Pg(){return Pg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Pg.apply(this,arguments)}function ONe(e,t){return kNe(e)||MNe(e,t)||NNe(e,t)||CNe()}function CNe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NNe(e,t){if(e){if(typeof e=="string")return LW(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return LW(e,t)}}function LW(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function MNe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function kNe(e){if(Array.isArray(e))return e}function PNe(e,t){if(e==null)return{};var n=ANe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ANe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function TNe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function INe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,BW(r.key),r)}}function RNe(e,t,n){return t&&INe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function DNe(e,t,n){return t=Ag(t),LNe(e,$W()?Reflect.construct(t,n||[],Ag(e).constructor):t.apply(e,n))}function LNe(e,t){if(t&&(kl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $Ne(e)}function $Ne(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $W(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($W=function(){return!!e})()}function Ag(e){return Ag=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ag(e)}function FNe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dN(e,t)}function dN(e,t){return dN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},dN(e,t)}function FW(e,t,n){return t=BW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function BW(e){var t=BNe(e,"string");return kl(t)=="symbol"?t:t+""}function BNe(e,t){if(kl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(kl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Tg=function(e){function t(){return TNe(this,t),DNe(this,t,arguments)}return FNe(t,e),RNe(t,[{key:"render",value:function(){var n=this.props,r=n.offset,a=n.layout,o=n.width,i=n.dataKey,s=n.data,c=n.dataPointFormatter,l=n.xAxis,u=n.yAxis,d=PNe(n,ENe),p=bt(d,!1);this.props.direction==="x"&&l.type!=="number"&&Ds();var f=s.map(function(m){var y=c(m,i),v=y.x,b=y.y,w=y.value,j=y.errorVal;if(!j)return null;var x=[],_,S;if(Array.isArray(j)){var E=ONe(j,2);_=E[0],S=E[1]}else _=S=j;if(a==="vertical"){var O=l.scale,N=b+r,M=N+o,k=N-o,P=O(w-_),A=O(w+S);x.push({x1:A,y1:M,x2:A,y2:k}),x.push({x1:P,y1:N,x2:A,y2:N}),x.push({x1:P,y1:M,x2:P,y2:k})}else if(a==="horizontal"){var C=u.scale,I=v+r,T=I-o,R=I+o,L=C(w-_),D=C(w+S);x.push({x1:T,y1:D,x2:R,y2:D}),x.push({x1:I,y1:L,x2:I,y2:D}),x.push({x1:T,y1:L,x2:R,y2:L})}return W.createElement(wn,Pg({className:"recharts-errorBar",key:"bar-".concat(x.map(function(z){return"".concat(z.x1,"-").concat(z.x2,"-").concat(z.y1,"-").concat(z.y2)}))},p),x.map(function(z){return W.createElement("line",Pg({},z,{key:"line-".concat(z.x1,"-").concat(z.x2,"-").concat(z.y1,"-").concat(z.y2)}))}))});return W.createElement(wn,{className:"recharts-errorBars"},f)}}])}(W.Component);FW(Tg,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"}),FW(Tg,"displayName","ErrorBar");function Lp(e){"@babel/helpers - typeof";return Lp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lp(e)}function zW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Ls(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zW(Object(n),!0).forEach(function(r){zNe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zW(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function zNe(e,t,n){return t=UNe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function UNe(e){var t=VNe(e,"string");return Lp(t)=="symbol"?t:t+""}function VNe(e,t){if(Lp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Lp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var UW=function(e){var t=e.children,n=e.formattedGraphicalItems,r=e.legendWidth,a=e.legendContent,o=jr(t,bl);if(!o)return null;var i=bl.defaultProps,s=i!==void 0?Ls(Ls({},i),o.props):{},c;return o.props&&o.props.payload?c=o.props&&o.props.payload:a==="children"?c=(n||[]).reduce(function(l,u){var d=u.item,p=u.props,f=p.sectors||p.data||[];return l.concat(f.map(function(m){return{type:o.props.iconType||d.props.legendType,value:m.name,color:m.fill,payload:m}}))},[]):c=(n||[]).map(function(l){var u=l.item,d=u.type.defaultProps,p=d!==void 0?Ls(Ls({},d),u.props):{},f=p.dataKey,m=p.name,y=p.legendType,v=p.hide;return{inactive:v,dataKey:f,type:s.iconType||y||"square",color:fN(u),value:m||f,payload:p}}),Ls(Ls(Ls({},s),bl.getWithHeight(o,r)),{},{payload:c,item:o})};function $p(e){"@babel/helpers - typeof";return $p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$p(e)}function VW(e){return KNe(e)||HNe(e)||WNe(e)||qNe()}function qNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WNe(e,t){if(e){if(typeof e=="string")return pN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pN(e,t)}}function HNe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function KNe(e){if(Array.isArray(e))return pN(e)}function pN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Yt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qW(Object(n),!0).forEach(function(r){Pl(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qW(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Pl(e,t,n){return t=ZNe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ZNe(e){var t=GNe(e,"string");return $p(t)=="symbol"?t:t+""}function GNe(e,t){if($p(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if($p(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ro(e,t,n){return wt(e)||wt(t)?n:hn(t)?Tr(e,t,n):at(t)?t(e):n}function Ig(e,t,n,r){var a=KCe(e,function(s){return ro(s,t)});if(n==="number"){var o=a.filter(function(s){return ye(s)||parseFloat(s)});return o.length?[Cg(o),Og(o)]:[1/0,-1/0]}var i=r?a.filter(function(s){return!wt(s)}):a;return i.map(function(s){return hn(s)||s instanceof Date?s:""})}var XNe=function(e){var t,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=-1,i=(t=n==null?void 0:n.length)!==null&&t!==void 0?t:0;if(i<=1)return 0;if(a&&a.axisType==="angleAxis"&&Math.abs(Math.abs(a.range[1]-a.range[0])-360)<=1e-6)for(var s=a.range,c=0;c<i;c++){var l=c>0?r[c-1].coordinate:r[i-1].coordinate,u=r[c].coordinate,d=c>=i-1?r[0].coordinate:r[c+1].coordinate,p=void 0;if(Ea(u-l)!==Ea(d-u)){var f=[];if(Ea(d-u)===Ea(s[1]-s[0])){p=d;var m=u+s[1]-s[0];f[0]=Math.min(m,(m+l)/2),f[1]=Math.max(m,(m+l)/2)}else{p=l;var y=d+s[1]-s[0];f[0]=Math.min(u,(y+u)/2),f[1]=Math.max(u,(y+u)/2)}var v=[Math.min(u,(p+u)/2),Math.max(u,(p+u)/2)];if(e>v[0]&&e<=v[1]||e>=f[0]&&e<=f[1]){o=r[c].index;break}}else{var b=Math.min(l,d),w=Math.max(l,d);if(e>(b+u)/2&&e<=(w+u)/2){o=r[c].index;break}}}else for(var j=0;j<i;j++)if(j===0&&e<=(n[j].coordinate+n[j+1].coordinate)/2||j>0&&j<i-1&&e>(n[j].coordinate+n[j-1].coordinate)/2&&e<=(n[j].coordinate+n[j+1].coordinate)/2||j===i-1&&e>(n[j].coordinate+n[j-1].coordinate)/2){o=n[j].index;break}return o},fN=function(e){var t,n=e,r=n.type.displayName,a=(t=e.type)!==null&&t!==void 0&&t.defaultProps?Yt(Yt({},e.type.defaultProps),e.props):e.props,o=a.stroke,i=a.fill,s;switch(r){case"Line":s=o;break;case"Area":case"Radar":s=o&&o!=="none"?o:i;break;default:s=i;break}return s},JNe=function(e){var t=e.barSize,n=e.totalSize,r=e.stackGroups,a=r===void 0?{}:r;if(!a)return{};for(var o={},i=Object.keys(a),s=0,c=i.length;s<c;s++)for(var l=a[i[s]].stackGroups,u=Object.keys(l),d=0,p=u.length;d<p;d++){var f=l[u[d]],m=f.items,y=f.cateAxisId,v=m.filter(function(S){return qo(S.type).indexOf("Bar")>=0});if(v&&v.length){var b=v[0].type.defaultProps,w=b!==void 0?Yt(Yt({},b),v[0].props):v[0].props,j=w.barSize,x=w[y];o[x]||(o[x]=[]);var _=wt(j)?t:j;o[x].push({item:v[0],stackList:v.slice(1),barSize:wt(_)?void 0:Ns(_,n,0)})}}return o},YNe=function(e){var t=e.barGap,n=e.barCategoryGap,r=e.bandSize,a=e.sizeList,o=a===void 0?[]:a,i=e.maxBarSize,s=o.length;if(s<1)return null;var c=Ns(t,r,0,!0),l,u=[];if(o[0].barSize===+o[0].barSize){var d=!1,p=r/s,f=o.reduce(function(j,x){return j+x.barSize||0},0);f+=(s-1)*c,f>=r&&(f-=(s-1)*c,c=0),f>=r&&p>0&&(d=!0,p*=.9,f=s*p);var m=(r-f)/2>>0,y={offset:m-c,size:0};l=o.reduce(function(j,x){var _={item:x.item,position:{offset:y.offset+y.size+c,size:d?p:x.barSize}},S=[].concat(VW(j),[_]);return y=S[S.length-1].position,x.stackList&&x.stackList.length&&x.stackList.forEach(function(E){S.push({item:E,position:y})}),S},u)}else{var v=Ns(n,r,0,!0);r-2*v-(s-1)*c<=0&&(c=0);var b=(r-2*v-(s-1)*c)/s;b>1&&(b>>=0);var w=i===+i?Math.min(b,i):b;l=o.reduce(function(j,x,_){var S=[].concat(VW(j),[{item:x.item,position:{offset:v+(b+c)*_+(b-w)/2,size:w}}]);return x.stackList&&x.stackList.length&&x.stackList.forEach(function(E){S.push({item:E,position:S[S.length-1].position})}),S},u)}return l},QNe=function(e,t,n,r){var a=n.children,o=n.width,i=n.margin,s=o-(i.left||0)-(i.right||0),c=UW({children:a,legendWidth:s});if(c){var l=r||{},u=l.width,d=l.height,p=c.align,f=c.verticalAlign,m=c.layout;if((m==="vertical"||m==="horizontal"&&f==="middle")&&p!=="center"&&ye(e[p]))return Yt(Yt({},e),{},Pl({},p,e[p]+(u||0)));if((m==="horizontal"||m==="vertical"&&p==="center")&&f!=="middle"&&ye(e[f]))return Yt(Yt({},e),{},Pl({},f,e[f]+(d||0)))}return e},eMe=function(e,t,n){return wt(t)?!0:e==="horizontal"?t==="yAxis":e==="vertical"||n==="x"?t==="xAxis":n==="y"?t==="yAxis":!0},WW=function(e,t,n,r,a){var o=t.props.children,i=Oa(o,Tg).filter(function(c){return eMe(r,a,c.props.direction)});if(i&&i.length){var s=i.map(function(c){return c.props.dataKey});return e.reduce(function(c,l){var u=ro(l,n);if(wt(u))return c;var d=Array.isArray(u)?[Cg(u),Og(u)]:[u,u],p=s.reduce(function(f,m){var y=ro(l,m,0),v=d[0]-Math.abs(Array.isArray(y)?y[0]:y),b=d[1]+Math.abs(Array.isArray(y)?y[1]:y);return[Math.min(v,f[0]),Math.max(b,f[1])]},[1/0,-1/0]);return[Math.min(p[0],c[0]),Math.max(p[1],c[1])]},[1/0,-1/0])}return null},tMe=function(e,t,n,r,a){var o=t.map(function(i){return WW(e,i,n,a,r)}).filter(function(i){return!wt(i)});return o&&o.length?o.reduce(function(i,s){return[Math.min(i[0],s[0]),Math.max(i[1],s[1])]},[1/0,-1/0]):null},HW=function(e,t,n,r,a){var o=t.map(function(s){var c=s.props.dataKey;return n==="number"&&c&&WW(e,s,c,r)||Ig(e,c,n,a)});if(n==="number")return o.reduce(function(s,c){return[Math.min(s[0],c[0]),Math.max(s[1],c[1])]},[1/0,-1/0]);var i={};return o.reduce(function(s,c){for(var l=0,u=c.length;l<u;l++)i[c[l]]||(i[c[l]]=!0,s.push(c[l]));return s},[])},KW=function(e,t){return e==="horizontal"&&t==="xAxis"||e==="vertical"&&t==="yAxis"||e==="centric"&&t==="angleAxis"||e==="radial"&&t==="radiusAxis"},ZW=function(e,t,n,r){if(r)return e.map(function(s){return s.coordinate});var a,o,i=e.map(function(s){return s.coordinate===t&&(a=!0),s.coordinate===n&&(o=!0),s.coordinate});return a||i.push(t),o||i.push(n),i},ei=function(e,t,n){if(!e)return null;var r=e.scale,a=e.duplicateDomain,o=e.type,i=e.range,s=e.realScaleType==="scaleBand"?r.bandwidth()/2:2,c=(t||n)&&o==="category"&&r.bandwidth?r.bandwidth()/s:0;if(c=e.axisType==="angleAxis"&&(i==null?void 0:i.length)>=2?Ea(i[0]-i[1])*2*c:c,t&&(e.ticks||e.niceTicks)){var l=(e.ticks||e.niceTicks).map(function(u){var d=a?a.indexOf(u):u;return{coordinate:r(d)+c,value:u,offset:c}});return l.filter(function(u){return!mp(u.coordinate)})}return e.isCategorical&&e.categoricalDomain?e.categoricalDomain.map(function(u,d){return{coordinate:r(u)+c,value:u,index:d,offset:c}}):r.ticks&&!n?r.ticks(e.tickCount).map(function(u){return{coordinate:r(u)+c,value:u,offset:c}}):r.domain().map(function(u,d){return{coordinate:r(u)+c,value:a?a[u]:u,index:d,offset:c}})},hN=new WeakMap,Rg=function(e,t){if(typeof t!="function")return e;hN.has(e)||hN.set(e,new WeakMap);var n=hN.get(e);if(n.has(t))return n.get(t);var r=function(){e.apply(void 0,arguments),t.apply(void 0,arguments)};return n.set(t,r),r},nMe=function(e,t,n){var r=e.scale,a=e.type,o=e.layout,i=e.axisType;if(r==="auto")return o==="radial"&&i==="radiusAxis"?{scale:Cp(),realScaleType:"band"}:o==="radial"&&i==="angleAxis"?{scale:gg(),realScaleType:"linear"}:a==="category"&&t&&(t.indexOf("LineChart")>=0||t.indexOf("AreaChart")>=0||t.indexOf("ComposedChart")>=0&&!n)?{scale:Np(),realScaleType:"point"}:a==="category"?{scale:Cp(),realScaleType:"band"}:{scale:gg(),realScaleType:"linear"};if(hp(r)){var s="scale".concat(Hy(r));return{scale:(pW[s]||Np)(),realScaleType:pW[s]?s:"point"}}return at(r)?{scale:r}:{scale:Np(),realScaleType:"point"}},GW=1e-4,rMe=function(e){var t=e.domain();if(!(!t||t.length<=2)){var n=t.length,r=e.range(),a=Math.min(r[0],r[1])-GW,o=Math.max(r[0],r[1])+GW,i=e(t[0]),s=e(t[n-1]);(i<a||i>o||s<a||s>o)&&e.domain([t[0],t[n-1]])}},aMe=function(e,t){if(!e)return null;for(var n=0,r=e.length;n<r;n++)if(e[n].item===t)return e[n].position;return null},oMe=function(e,t){if(!t||t.length!==2||!ye(t[0])||!ye(t[1]))return e;var n=Math.min(t[0],t[1]),r=Math.max(t[0],t[1]),a=[e[0],e[1]];return(!ye(e[0])||e[0]<n)&&(a[0]=n),(!ye(e[1])||e[1]>r)&&(a[1]=r),a[0]>r&&(a[0]=r),a[1]<n&&(a[1]=n),a},iMe=function(e){var t=e.length;if(!(t<=0))for(var n=0,r=e[0].length;n<r;++n)for(var a=0,o=0,i=0;i<t;++i){var s=mp(e[i][n][1])?e[i][n][0]:e[i][n][1];s>=0?(e[i][n][0]=a,e[i][n][1]=a+s,a=e[i][n][1]):(e[i][n][0]=o,e[i][n][1]=o+s,o=e[i][n][1])}},sMe=function(e){var t=e.length;if(!(t<=0))for(var n=0,r=e[0].length;n<r;++n)for(var a=0,o=0;o<t;++o){var i=mp(e[o][n][1])?e[o][n][0]:e[o][n][1];i>=0?(e[o][n][0]=a,e[o][n][1]=a+i,a=e[o][n][1]):(e[o][n][0]=0,e[o][n][1]=0)}},cMe={sign:iMe,expand:lje,none:yl,silhouette:uje,wiggle:dje,positive:sMe},lMe=function(e,t,n){var r=t.map(function(i){return i.props.dataKey}),a=cMe[n],o=cje().keys(r).value(function(i,s){return+ro(i,s,0)}).order(_O).offset(a);return o(e)},uMe=function(e,t,n,r,a,o){if(!e)return null;var i=o?t.reverse():t,s={},c=i.reduce(function(u,d){var p,f=(p=d.type)!==null&&p!==void 0&&p.defaultProps?Yt(Yt({},d.type.defaultProps),d.props):d.props,m=f.stackId,y=f.hide;if(y)return u;var v=f[n],b=u[v]||{hasStack:!1,stackGroups:{}};if(hn(m)){var w=b.stackGroups[m]||{numericAxisId:n,cateAxisId:r,items:[]};w.items.push(d),b.hasStack=!0,b.stackGroups[m]=w}else b.stackGroups[Vy("_stackId_")]={numericAxisId:n,cateAxisId:r,items:[d]};return Yt(Yt({},u),{},Pl({},v,b))},s),l={};return Object.keys(c).reduce(function(u,d){var p=c[d];if(p.hasStack){var f={};p.stackGroups=Object.keys(p.stackGroups).reduce(function(m,y){var v=p.stackGroups[y];return Yt(Yt({},m),{},Pl({},y,{numericAxisId:n,cateAxisId:r,items:v.items,stackedData:lMe(e,v.items,a)}))},f)}return Yt(Yt({},u),{},Pl({},d,p))},l)},dMe=function(e,t){var n=t.realScaleType,r=t.type,a=t.tickCount,o=t.originalDomain,i=t.allowDecimals,s=n||t.scale;if(s!=="auto"&&s!=="linear")return null;if(a&&r==="number"&&o&&(o[0]==="auto"||o[1]==="auto")){var c=e.domain();if(!c.length)return null;var l=_Ne(c,a,i);return e.domain([Cg(l),Og(l)]),{niceTicks:l}}if(a&&r==="number"){var u=e.domain(),d=jNe(u,a,i);return{niceTicks:d}}return null},XW=function(e){var t=e.axis,n=e.ticks,r=e.offset,a=e.bandSize,o=e.entry,i=e.index;if(t.type==="category")return n[i]?n[i].coordinate+r:null;var s=ro(o,t.dataKey,t.domain[i]);return wt(s)?null:t.scale(s)-a/2+r},pMe=function(e){var t=e.numericAxis,n=t.scale.domain();if(t.type==="number"){var r=Math.min(n[0],n[1]),a=Math.max(n[0],n[1]);return r<=0&&a>=0?0:a<0?a:r}return n[0]},fMe=function(e,t){var n,r=(n=e.type)!==null&&n!==void 0&&n.defaultProps?Yt(Yt({},e.type.defaultProps),e.props):e.props,a=r.stackId;if(hn(a)){var o=t[a];if(o){var i=o.items.indexOf(e);return i>=0?o.stackedData[i]:null}}return null},hMe=function(e){return e.reduce(function(t,n){return[Cg(n.concat([t[0]]).filter(ye)),Og(n.concat([t[1]]).filter(ye))]},[1/0,-1/0])},JW=function(e,t,n){return Object.keys(e).reduce(function(r,a){var o=e[a],i=o.stackedData,s=i.reduce(function(c,l){var u=hMe(l.slice(t,n+1));return[Math.min(c[0],u[0]),Math.max(c[1],u[1])]},[1/0,-1/0]);return[Math.min(s[0],r[0]),Math.max(s[1],r[1])]},[1/0,-1/0]).map(function(r){return r===1/0||r===-1/0?0:r})},YW=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,QW=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,mN=function(e,t,n){if(at(e))return e(t,n);if(!Array.isArray(e))return t;var r=[];if(ye(e[0]))r[0]=n?e[0]:Math.min(e[0],t[0]);else if(YW.test(e[0])){var a=+YW.exec(e[0])[1];r[0]=t[0]-a}else at(e[0])?r[0]=e[0](t[0]):r[0]=t[0];if(ye(e[1]))r[1]=n?e[1]:Math.max(e[1],t[1]);else if(QW.test(e[1])){var o=+QW.exec(e[1])[1];r[1]=t[1]+o}else at(e[1])?r[1]=e[1](t[1]):r[1]=t[1];return r},Dg=function(e,t,n){if(e&&e.scale&&e.scale.bandwidth){var r=e.scale.bandwidth();if(!n||r>0)return r}if(e&&t&&t.length>=2){for(var a=iC(t,function(u){return u.coordinate}),o=1/0,i=1,s=a.length;i<s;i++){var c=a[i],l=a[i-1];o=Math.min((c.coordinate||0)-(l.coordinate||0),o)}return o===1/0?0:o}return n?void 0:0},eH=function(e,t,n){return!e||!e.length||nN(e,Tr(n,"type.defaultProps.domain"))?t:e},tH=function(e,t){var n=e.type.defaultProps?Yt(Yt({},e.type.defaultProps),e.props):e.props,r=n.dataKey,a=n.name,o=n.unit,i=n.formatter,s=n.tooltipType,c=n.chartType,l=n.hide;return Yt(Yt({},bt(e,!1)),{},{dataKey:r,unit:o,formatter:i,name:a||r,color:fN(e),value:ro(t,r),type:s,payload:t,chartType:c,hide:l})};function Fp(e){"@babel/helpers - typeof";return Fp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fp(e)}function nH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function rH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nH(Object(n),!0).forEach(function(r){mMe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function mMe(e,t,n){return t=yMe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yMe(e){var t=gMe(e,"string");return Fp(t)=="symbol"?t:t+""}function gMe(e,t){if(Fp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Fp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Lg=Math.PI/180,vMe=function(e){return e*180/Math.PI},Pn=function(e,t,n,r){return{x:e+Math.cos(-Lg*r)*n,y:t+Math.sin(-Lg*r)*n}},bMe=function(e,t){var n=e.x,r=e.y,a=t.x,o=t.y;return Math.sqrt(Math.pow(n-a,2)+Math.pow(r-o,2))},wMe=function(e,t){var n=e.x,r=e.y,a=t.cx,o=t.cy,i=bMe({x:n,y:r},{x:a,y:o});if(i<=0)return{radius:i};var s=(n-a)/i,c=Math.acos(s);return r>o&&(c=2*Math.PI-c),{radius:i,angle:vMe(c),angleInRadian:c}},xMe=function(e){var t=e.startAngle,n=e.endAngle,r=Math.floor(t/360),a=Math.floor(n/360),o=Math.min(r,a);return{startAngle:t-o*360,endAngle:n-o*360}},_Me=function(e,t){var n=t.startAngle,r=t.endAngle,a=Math.floor(n/360),o=Math.floor(r/360),i=Math.min(a,o);return e+i*360},aH=function(e,t){var n=e.x,r=e.y,a=wMe({x:n,y:r},t),o=a.radius,i=a.angle,s=t.innerRadius,c=t.outerRadius;if(o<s||o>c)return!1;if(o===0)return!0;var l=xMe(t),u=l.startAngle,d=l.endAngle,p=i,f;if(u<=d){for(;p>d;)p-=360;for(;p<u;)p+=360;f=p>=u&&p<=d}else{for(;p>u;)p-=360;for(;p<d;)p+=360;f=p>=d&&p<=u}return f?rH(rH({},t),{},{radius:o,angle:_Me(p,t)}):null};function Bp(e){"@babel/helpers - typeof";return Bp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bp(e)}var jMe=["offset"];function SMe(e){return NMe(e)||CMe(e)||OMe(e)||EMe()}function EMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OMe(e,t){if(e){if(typeof e=="string")return yN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yN(e,t)}}function CMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function NMe(e){if(Array.isArray(e))return yN(e)}function yN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function MMe(e,t){if(e==null)return{};var n=kMe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function kMe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function oH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function yn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oH(Object(n),!0).forEach(function(r){PMe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function PMe(e,t,n){return t=AMe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function AMe(e){var t=TMe(e,"string");return Bp(t)=="symbol"?t:t+""}function TMe(e,t){if(Bp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Bp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function zp(){return zp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zp.apply(this,arguments)}var IMe=function(e){var t=e.value,n=e.formatter,r=wt(e.children)?t:e.children;return at(n)?n(r):r},RMe=function(e,t){var n=Ea(t-e),r=Math.min(Math.abs(t-e),360);return n*r},DMe=function(e,t,n){var r=e.position,a=e.viewBox,o=e.offset,i=e.className,s=a,c=s.cx,l=s.cy,u=s.innerRadius,d=s.outerRadius,p=s.startAngle,f=s.endAngle,m=s.clockWise,y=(u+d)/2,v=RMe(p,f),b=v>=0?1:-1,w,j;r==="insideStart"?(w=p+b*o,j=m):r==="insideEnd"?(w=f-b*o,j=!m):r==="end"&&(w=f+b*o,j=m),j=v<=0?j:!j;var x=Pn(c,l,y,w),_=Pn(c,l,y,w+(j?1:-1)*359),S="M".concat(x.x,",").concat(x.y,`
    A`).concat(y,",").concat(y,",0,1,").concat(j?0:1,`,
    `).concat(_.x,",").concat(_.y),E=wt(e.id)?Vy("recharts-radial-line-"):e.id;return W.createElement("text",zp({},n,{dominantBaseline:"central",className:St("recharts-radial-bar-label",i)}),W.createElement("defs",null,W.createElement("path",{id:E,d:S})),W.createElement("textPath",{xlinkHref:"#".concat(E)},t))},LMe=function(e){var t=e.viewBox,n=e.offset,r=e.position,a=t,o=a.cx,i=a.cy,s=a.innerRadius,c=a.outerRadius,l=a.startAngle,u=a.endAngle,d=(l+u)/2;if(r==="outside"){var p=Pn(o,i,c+n,d),f=p.x,m=p.y;return{x:f,y:m,textAnchor:f>=o?"start":"end",verticalAnchor:"middle"}}if(r==="center")return{x:o,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(r==="centerTop")return{x:o,y:i,textAnchor:"middle",verticalAnchor:"start"};if(r==="centerBottom")return{x:o,y:i,textAnchor:"middle",verticalAnchor:"end"};var y=(s+c)/2,v=Pn(o,i,y,d),b=v.x,w=v.y;return{x:b,y:w,textAnchor:"middle",verticalAnchor:"middle"}},$Me=function(e){var t=e.viewBox,n=e.parentViewBox,r=e.offset,a=e.position,o=t,i=o.x,s=o.y,c=o.width,l=o.height,u=l>=0?1:-1,d=u*r,p=u>0?"end":"start",f=u>0?"start":"end",m=c>=0?1:-1,y=m*r,v=m>0?"end":"start",b=m>0?"start":"end";if(a==="top"){var w={x:i+c/2,y:s-u*r,textAnchor:"middle",verticalAnchor:p};return yn(yn({},w),n?{height:Math.max(s-n.y,0),width:c}:{})}if(a==="bottom"){var j={x:i+c/2,y:s+l+d,textAnchor:"middle",verticalAnchor:f};return yn(yn({},j),n?{height:Math.max(n.y+n.height-(s+l),0),width:c}:{})}if(a==="left"){var x={x:i-y,y:s+l/2,textAnchor:v,verticalAnchor:"middle"};return yn(yn({},x),n?{width:Math.max(x.x-n.x,0),height:l}:{})}if(a==="right"){var _={x:i+c+y,y:s+l/2,textAnchor:b,verticalAnchor:"middle"};return yn(yn({},_),n?{width:Math.max(n.x+n.width-_.x,0),height:l}:{})}var S=n?{width:c,height:l}:{};return a==="insideLeft"?yn({x:i+y,y:s+l/2,textAnchor:b,verticalAnchor:"middle"},S):a==="insideRight"?yn({x:i+c-y,y:s+l/2,textAnchor:v,verticalAnchor:"middle"},S):a==="insideTop"?yn({x:i+c/2,y:s+d,textAnchor:"middle",verticalAnchor:f},S):a==="insideBottom"?yn({x:i+c/2,y:s+l-d,textAnchor:"middle",verticalAnchor:p},S):a==="insideTopLeft"?yn({x:i+y,y:s+d,textAnchor:b,verticalAnchor:f},S):a==="insideTopRight"?yn({x:i+c-y,y:s+d,textAnchor:v,verticalAnchor:f},S):a==="insideBottomLeft"?yn({x:i+y,y:s+l-d,textAnchor:b,verticalAnchor:p},S):a==="insideBottomRight"?yn({x:i+c-y,y:s+l-d,textAnchor:v,verticalAnchor:p},S):fl(a)&&(ye(a.x)||Cs(a.x))&&(ye(a.y)||Cs(a.y))?yn({x:i+Ns(a.x,c),y:s+Ns(a.y,l),textAnchor:"end",verticalAnchor:"end"},S):yn({x:i+c/2,y:s+l/2,textAnchor:"middle",verticalAnchor:"middle"},S)},FMe=function(e){return"cx"in e&&ye(e.cx)};function zn(e){var t=e.offset,n=t===void 0?5:t,r=MMe(e,jMe),a=yn({offset:n},r),o=a.viewBox,i=a.position,s=a.value,c=a.children,l=a.content,u=a.className,d=u===void 0?"":u,p=a.textBreakAll;if(!o||wt(s)&&wt(c)&&!g.isValidElement(l)&&!at(l))return null;if(g.isValidElement(l))return g.cloneElement(l,a);var f;if(at(l)){if(f=g.createElement(l,a),g.isValidElement(f))return f}else f=IMe(a);var m=FMe(o),y=bt(a,!0);if(m&&(i==="insideStart"||i==="insideEnd"||i==="end"))return DMe(a,f,y);var v=m?LMe(a):$Me(a);return W.createElement(dg,zp({className:St("recharts-label",d)},y,v,{breakAll:p}),f)}zn.displayName="Label";var iH=function(e){var t=e.cx,n=e.cy,r=e.angle,a=e.startAngle,o=e.endAngle,i=e.r,s=e.radius,c=e.innerRadius,l=e.outerRadius,u=e.x,d=e.y,p=e.top,f=e.left,m=e.width,y=e.height,v=e.clockWise,b=e.labelViewBox;if(b)return b;if(ye(m)&&ye(y)){if(ye(u)&&ye(d))return{x:u,y:d,width:m,height:y};if(ye(p)&&ye(f))return{x:p,y:f,width:m,height:y}}return ye(u)&&ye(d)?{x:u,y:d,width:0,height:0}:ye(t)&&ye(n)?{cx:t,cy:n,startAngle:a||r||0,endAngle:o||r||0,innerRadius:c||0,outerRadius:l||s||i||0,clockWise:v}:e.viewBox?e.viewBox:{}},BMe=function(e,t){return e?e===!0?W.createElement(zn,{key:"label-implicit",viewBox:t}):hn(e)?W.createElement(zn,{key:"label-implicit",viewBox:t,value:e}):g.isValidElement(e)?e.type===zn?g.cloneElement(e,{key:"label-implicit",viewBox:t}):W.createElement(zn,{key:"label-implicit",content:e,viewBox:t}):at(e)?W.createElement(zn,{key:"label-implicit",content:e,viewBox:t}):fl(e)?W.createElement(zn,zp({viewBox:t},e,{key:"label-implicit"})):null:null},zMe=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&n&&!e.label)return null;var r=e.children,a=iH(e),o=Oa(r,zn).map(function(s,c){return g.cloneElement(s,{viewBox:t||a,key:"label-".concat(c)})});if(!n)return o;var i=BMe(e.label,t||a);return[i].concat(SMe(o))};zn.parseViewBox=iH,zn.renderCallByParent=zMe;var gN,sH;Fk=function(){if(sH)return gN;sH=1;function e(t){var n=t==null?0:t.length;return n?t[n-1]:void 0}return gN=e,gN};var UMe=Fk();QM=st(UMe);function Up(e){"@babel/helpers - typeof";return Up=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Up(e)}var VMe=["valueAccessor"],qMe=["data","dataKey","clockWise","id","textBreakAll"];function WMe(e){return GMe(e)||ZMe(e)||KMe(e)||HMe()}function HMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KMe(e,t){if(e){if(typeof e=="string")return vN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vN(e,t)}}function ZMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function GMe(e){if(Array.isArray(e))return vN(e)}function vN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $g(){return $g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$g.apply(this,arguments)}function cH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function lH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cH(Object(n),!0).forEach(function(r){XMe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function XMe(e,t,n){return t=JMe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function JMe(e){var t=YMe(e,"string");return Up(t)=="symbol"?t:t+""}function YMe(e,t){if(Up(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Up(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uH(e,t){if(e==null)return{};var n=QMe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function QMe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}var eke=function(e){return Array.isArray(e.value)?QM(e.value):e.value};function $s(e){var t=e.valueAccessor,n=t===void 0?eke:t,r=uH(e,VMe),a=r.data,o=r.dataKey,i=r.clockWise,s=r.id,c=r.textBreakAll,l=uH(r,qMe);return!a||!a.length?null:W.createElement(wn,{className:"recharts-label-list"},a.map(function(u,d){var p=wt(o)?n(u,d):ro(u&&u.payload,o),f=wt(s)?{}:{id:"".concat(s,"-").concat(d)};return W.createElement(zn,$g({},bt(u,!0),l,f,{parentViewBox:u.parentViewBox,value:p,textBreakAll:c,viewBox:zn.parseViewBox(wt(i)?u:lH(lH({},u),{},{clockWise:i})),key:"label-".concat(d),index:d}))}))}$s.displayName="LabelList";function tke(e,t){return e?e===!0?W.createElement($s,{key:"labelList-implicit",data:t}):W.isValidElement(e)||at(e)?W.createElement($s,{key:"labelList-implicit",data:t,content:e}):fl(e)?W.createElement($s,$g({data:t},e,{key:"labelList-implicit"})):null:null}function nke(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&n&&!e.label)return null;var r=e.children,a=Oa(r,$s).map(function(i,s){return g.cloneElement(i,{data:t,key:"labelList-".concat(s)})});if(!n)return a;var o=tke(e.label,t);return[o].concat(WMe(a))}$s.renderCallByParent=nke;function Vp(e){"@babel/helpers - typeof";return Vp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vp(e)}function bN(){return bN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bN.apply(this,arguments)}function dH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function pH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dH(Object(n),!0).forEach(function(r){rke(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function rke(e,t,n){return t=ake(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ake(e){var t=oke(e,"string");return Vp(t)=="symbol"?t:t+""}function oke(e,t){if(Vp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Vp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ike=function(e,t){var n=Ea(t-e),r=Math.min(Math.abs(t-e),359.999);return n*r},Fg=function(e){var t=e.cx,n=e.cy,r=e.radius,a=e.angle,o=e.sign,i=e.isExternal,s=e.cornerRadius,c=e.cornerIsExternal,l=s*(i?1:-1)+r,u=Math.asin(s/l)/Lg,d=c?a:a+o*u,p=Pn(t,n,l,d),f=Pn(t,n,r,d),m=c?a-o*u:a,y=Pn(t,n,l*Math.cos(u*Lg),m);return{center:p,circleTangency:f,lineTangency:y,theta:u}},fH=function(e){var t=e.cx,n=e.cy,r=e.innerRadius,a=e.outerRadius,o=e.startAngle,i=e.endAngle,s=ike(o,i),c=o+s,l=Pn(t,n,a,o),u=Pn(t,n,a,c),d="M ".concat(l.x,",").concat(l.y,`
    A `).concat(a,",").concat(a,`,0,
    `).concat(+(Math.abs(s)>180),",").concat(+(o>c),`,
    `).concat(u.x,",").concat(u.y,`
  `);if(r>0){var p=Pn(t,n,r,o),f=Pn(t,n,r,c);d+="L ".concat(f.x,",").concat(f.y,`
            A `).concat(r,",").concat(r,`,0,
            `).concat(+(Math.abs(s)>180),",").concat(+(o<=c),`,
            `).concat(p.x,",").concat(p.y," Z")}else d+="L ".concat(t,",").concat(n," Z");return d},ske=function(e){var t=e.cx,n=e.cy,r=e.innerRadius,a=e.outerRadius,o=e.cornerRadius,i=e.forceCornerRadius,s=e.cornerIsExternal,c=e.startAngle,l=e.endAngle,u=Ea(l-c),d=Fg({cx:t,cy:n,radius:a,angle:c,sign:u,cornerRadius:o,cornerIsExternal:s}),p=d.circleTangency,f=d.lineTangency,m=d.theta,y=Fg({cx:t,cy:n,radius:a,angle:l,sign:-u,cornerRadius:o,cornerIsExternal:s}),v=y.circleTangency,b=y.lineTangency,w=y.theta,j=s?Math.abs(c-l):Math.abs(c-l)-m-w;if(j<0)return i?"M ".concat(f.x,",").concat(f.y,`
        a`).concat(o,",").concat(o,",0,0,1,").concat(o*2,`,0
        a`).concat(o,",").concat(o,",0,0,1,").concat(-o*2,`,0
      `):fH({cx:t,cy:n,innerRadius:r,outerRadius:a,startAngle:c,endAngle:l});var x="M ".concat(f.x,",").concat(f.y,`
    A`).concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(p.x,",").concat(p.y,`
    A`).concat(a,",").concat(a,",0,").concat(+(j>180),",").concat(+(u<0),",").concat(v.x,",").concat(v.y,`
    A`).concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(b.x,",").concat(b.y,`
  `);if(r>0){var _=Fg({cx:t,cy:n,radius:r,angle:c,sign:u,isExternal:!0,cornerRadius:o,cornerIsExternal:s}),S=_.circleTangency,E=_.lineTangency,O=_.theta,N=Fg({cx:t,cy:n,radius:r,angle:l,sign:-u,isExternal:!0,cornerRadius:o,cornerIsExternal:s}),M=N.circleTangency,k=N.lineTangency,P=N.theta,A=s?Math.abs(c-l):Math.abs(c-l)-O-P;if(A<0&&o===0)return"".concat(x,"L").concat(t,",").concat(n,"Z");x+="L".concat(k.x,",").concat(k.y,`
      A`).concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(M.x,",").concat(M.y,`
      A`).concat(r,",").concat(r,",0,").concat(+(A>180),",").concat(+(u>0),",").concat(S.x,",").concat(S.y,`
      A`).concat(o,",").concat(o,",0,0,").concat(+(u<0),",").concat(E.x,",").concat(E.y,"Z")}else x+="L".concat(t,",").concat(n,"Z");return x},cke={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},hH=function(e){var t=pH(pH({},cke),e),n=t.cx,r=t.cy,a=t.innerRadius,o=t.outerRadius,i=t.cornerRadius,s=t.forceCornerRadius,c=t.cornerIsExternal,l=t.startAngle,u=t.endAngle,d=t.className;if(o<a||l===u)return null;var p=St("recharts-sector",d),f=o-a,m=Ns(i,f,0,!0),y;return m>0&&Math.abs(l-u)<360?y=ske({cx:n,cy:r,innerRadius:a,outerRadius:o,cornerRadius:Math.min(m,f/2),forceCornerRadius:s,cornerIsExternal:c,startAngle:l,endAngle:u}):y=fH({cx:n,cy:r,innerRadius:a,outerRadius:o,startAngle:l,endAngle:u}),W.createElement("path",bN({},bt(t,!0),{className:p,d:y,role:"img"}))};function qp(e){"@babel/helpers - typeof";return qp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qp(e)}function wN(){return wN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wN.apply(this,arguments)}function mH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function yH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mH(Object(n),!0).forEach(function(r){lke(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function lke(e,t,n){return t=uke(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uke(e){var t=dke(e,"string");return qp(t)=="symbol"?t:t+""}function dke(e,t){if(qp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(qp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gH={curveBasisClosed:J_e,curveBasisOpen:Y_e,curveBasis:X_e,curveBumpX:D_e,curveBumpY:L_e,curveLinearClosed:Q_e,curveLinear:Xy,curveMonotoneX:eje,curveMonotoneY:tje,curveNatural:nje,curveStep:rje,curveStepAfter:oje,curveStepBefore:aje},Bg=function(e){return e.x===+e.x&&e.y===+e.y},Wp=function(e){return e.x},Hp=function(e){return e.y},pke=function(e,t){if(at(e))return e;var n="curve".concat(Hy(e));return(n==="curveMonotone"||n==="curveBump")&&t?gH["".concat(n).concat(t==="vertical"?"Y":"X")]:gH[n]||Xy},fke=function(e){var t=e.type,n=t===void 0?"linear":t,r=e.points,a=r===void 0?[]:r,o=e.baseLine,i=e.layout,s=e.connectNulls,c=s===void 0?!1:s,l=pke(n,i),u=c?a.filter(function(m){return Bg(m)}):a,d;if(Array.isArray(o)){var p=c?o.filter(function(m){return Bg(m)}):o,f=u.map(function(m,y){return yH(yH({},m),{},{base:p[y]})});return i==="vertical"?d=Jy().y(Hp).x1(Wp).x0(function(m){return m.base.x}):d=Jy().x(Wp).y1(Hp).y0(function(m){return m.base.y}),d.defined(Bg).curve(l),d(f)}return i==="vertical"&&ye(o)?d=Jy().y(Hp).x1(Wp).x0(o):ye(o)?d=Jy().x(Wp).y1(Hp).y0(o):d=xU().x(Wp).y(Hp),d.defined(Bg).curve(l),d(u)},vH=function(e){var t=e.className,n=e.points,r=e.path,a=e.pathRef;if((!n||!n.length)&&!r)return null;var o=n&&n.length?fke(e):r;return W.createElement("path",wN({},bt(e,!1),qy(e),{className:St("recharts-curve",t),d:o,ref:a}))},bH={exports:{}},xN,wH;function hke(){if(wH)return xN;wH=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return xN=e,xN}var _N,xH;function mke(){if(xH)return _N;xH=1;var e=hke();function t(){}function n(){}return n.resetWarningCache=t,_N=function(){function r(i,s,c,l,u,d){if(d!==e){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}r.isRequired=r;function a(){return r}var o={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:a,element:r,elementType:r,instanceOf:a,node:r,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:n,resetWarningCache:t};return o.PropTypes=o,o},_N}var _H;function yke(){return _H||(_H=1,bH.exports=mke()()),bH.exports}var gke=yke();const Ze=st(gke);var vke=Object.getOwnPropertyNames,bke=Object.getOwnPropertySymbols,wke=Object.prototype.hasOwnProperty;function jH(e,t){return function(n,r,a){return e(n,r,a)&&t(n,r,a)}}function zg(e){return function(t,n,r){if(!t||!n||typeof t!="object"||typeof n!="object")return e(t,n,r);var a=r.cache,o=a.get(t),i=a.get(n);if(o&&i)return o===n&&i===t;a.set(t,n),a.set(n,t);var s=e(t,n,r);return a.delete(t),a.delete(n),s}}function SH(e){return vke(e).concat(bke(e))}var EH=Object.hasOwn||function(e,t){return wke.call(e,t)};function Al(e,t){return e||t?e===t:e===t||e!==e&&t!==t}var OH="_owner",CH=Object.getOwnPropertyDescriptor,NH=Object.keys;function xke(e,t,n){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(!n.equals(e[r],t[r],r,r,e,t,n))return!1;return!0}function _ke(e,t){return Al(e.getTime(),t.getTime())}function MH(e,t,n){if(e.size!==t.size)return!1;for(var r={},a=e.entries(),o=0,i,s;(i=a.next())&&!i.done;){for(var c=t.entries(),l=!1,u=0;(s=c.next())&&!s.done;){var d=i.value,p=d[0],f=d[1],m=s.value,y=m[0],v=m[1];!l&&!r[u]&&(l=n.equals(p,y,o,u,e,t,n)&&n.equals(f,v,p,y,e,t,n))&&(r[u]=!0),u++}if(!l)return!1;o++}return!0}function jke(e,t,n){var r=NH(e),a=r.length;if(NH(t).length!==a)return!1;for(var o;a-- >0;)if(o=r[a],o===OH&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof||!EH(t,o)||!n.equals(e[o],t[o],o,o,e,t,n))return!1;return!0}function Kp(e,t,n){var r=SH(e),a=r.length;if(SH(t).length!==a)return!1;for(var o,i,s;a-- >0;)if(o=r[a],o===OH&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof||!EH(t,o)||!n.equals(e[o],t[o],o,o,e,t,n)||(i=CH(e,o),s=CH(t,o),(i||s)&&(!i||!s||i.configurable!==s.configurable||i.enumerable!==s.enumerable||i.writable!==s.writable)))return!1;return!0}function Ske(e,t){return Al(e.valueOf(),t.valueOf())}function Eke(e,t){return e.source===t.source&&e.flags===t.flags}function kH(e,t,n){if(e.size!==t.size)return!1;for(var r={},a=e.values(),o,i;(o=a.next())&&!o.done;){for(var s=t.values(),c=!1,l=0;(i=s.next())&&!i.done;)!c&&!r[l]&&(c=n.equals(o.value,i.value,o.value,i.value,e,t,n))&&(r[l]=!0),l++;if(!c)return!1}return!0}function Oke(e,t){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(e[n]!==t[n])return!1;return!0}var Cke="[object Arguments]",Nke="[object Boolean]",Mke="[object Date]",kke="[object Map]",Pke="[object Number]",Ake="[object Object]",Tke="[object RegExp]",Ike="[object Set]",Rke="[object String]",Dke=Array.isArray,PH=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,AH=Object.assign,Lke=Object.prototype.toString.call.bind(Object.prototype.toString);function $ke(e){var t=e.areArraysEqual,n=e.areDatesEqual,r=e.areMapsEqual,a=e.areObjectsEqual,o=e.arePrimitiveWrappersEqual,i=e.areRegExpsEqual,s=e.areSetsEqual,c=e.areTypedArraysEqual;return function(l,u,d){if(l===u)return!0;if(l==null||u==null||typeof l!="object"||typeof u!="object")return l!==l&&u!==u;var p=l.constructor;if(p!==u.constructor)return!1;if(p===Object)return a(l,u,d);if(Dke(l))return t(l,u,d);if(PH!=null&&PH(l))return c(l,u,d);if(p===Date)return n(l,u,d);if(p===RegExp)return i(l,u,d);if(p===Map)return r(l,u,d);if(p===Set)return s(l,u,d);var f=Lke(l);return f===Mke?n(l,u,d):f===Tke?i(l,u,d):f===kke?r(l,u,d):f===Ike?s(l,u,d):f===Ake?typeof l.then!="function"&&typeof u.then!="function"&&a(l,u,d):f===Cke?a(l,u,d):f===Nke||f===Pke||f===Rke?o(l,u,d):!1}}function Fke(e){var t=e.circular,n=e.createCustomConfig,r=e.strict,a={areArraysEqual:r?Kp:xke,areDatesEqual:_ke,areMapsEqual:r?jH(MH,Kp):MH,areObjectsEqual:r?Kp:jke,arePrimitiveWrappersEqual:Ske,areRegExpsEqual:Eke,areSetsEqual:r?jH(kH,Kp):kH,areTypedArraysEqual:r?Kp:Oke};if(n&&(a=AH({},a,n(a))),t){var o=zg(a.areArraysEqual),i=zg(a.areMapsEqual),s=zg(a.areObjectsEqual),c=zg(a.areSetsEqual);a=AH({},a,{areArraysEqual:o,areMapsEqual:i,areObjectsEqual:s,areSetsEqual:c})}return a}function Bke(e){return function(t,n,r,a,o,i,s){return e(t,n,s)}}function zke(e){var t=e.circular,n=e.comparator,r=e.createState,a=e.equals,o=e.strict;if(r)return function(s,c){var l=r(),u=l.cache,d=u===void 0?t?new WeakMap:void 0:u,p=l.meta;return n(s,c,{cache:d,equals:a,meta:p,strict:o})};if(t)return function(s,c){return n(s,c,{cache:new WeakMap,equals:a,meta:void 0,strict:o})};var i={cache:void 0,equals:a,meta:void 0,strict:o};return function(s,c){return n(s,c,i)}}var Uke=Fi();Fi({strict:!0}),Fi({circular:!0}),Fi({circular:!0,strict:!0}),Fi({createInternalComparator:function(){return Al}}),Fi({strict:!0,createInternalComparator:function(){return Al}}),Fi({circular:!0,createInternalComparator:function(){return Al}}),Fi({circular:!0,createInternalComparator:function(){return Al},strict:!0});function Fi(e){e===void 0&&(e={});var t=e.circular,n=t===void 0?!1:t,r=e.createInternalComparator,a=e.createState,o=e.strict,i=o===void 0?!1:o,s=Fke(e),c=$ke(s),l=r?r(c):Bke(c);return zke({circular:n,comparator:c,createState:a,equals:l,strict:i})}function Vke(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function TH(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=-1,r=function a(o){n<0&&(n=o),o-n>t?(e(o),n=-1):Vke(a)};requestAnimationFrame(r)}function jN(e){"@babel/helpers - typeof";return jN=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jN(e)}function qke(e){return Zke(e)||Kke(e)||Hke(e)||Wke()}function Wke(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hke(e,t){if(e){if(typeof e=="string")return IH(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return IH(e,t)}}function IH(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kke(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Zke(e){if(Array.isArray(e))return e}function Gke(){var e={},t=function(){return null},n=!1,r=function a(o){if(!n){if(Array.isArray(o)){if(!o.length)return;var i=o,s=qke(i),c=s[0],l=s.slice(1);if(typeof c=="number"){TH(a.bind(null,l),c);return}a(c),TH(a.bind(null,l));return}jN(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){n=!0},start:function(a){n=!1,r(a)},subscribe:function(a){return t=a,function(){t=function(){return null}}}}}function Zp(e){"@babel/helpers - typeof";return Zp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zp(e)}function RH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function DH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RH(Object(n),!0).forEach(function(r){LH(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function LH(e,t,n){return t=Xke(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xke(e){var t=Jke(e,"string");return Zp(t)==="symbol"?t:String(t)}function Jke(e,t){if(Zp(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Zp(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Yke=function(e,t){return[Object.keys(e),Object.keys(t)].reduce(function(n,r){return n.filter(function(a){return r.includes(a)})})},Qke=function(e){return e},ePe=function(e){return e.replace(/([A-Z])/g,function(t){return"-".concat(t.toLowerCase())})},Gp=function(e,t){return Object.keys(t).reduce(function(n,r){return DH(DH({},n),{},LH({},r,e(r,t[r])))},{})},$H=function(e,t,n){return e.map(function(r){return"".concat(ePe(r)," ").concat(t,"ms ").concat(n)}).join(",")};function tPe(e,t){return aPe(e)||rPe(e,t)||FH(e,t)||nPe()}function nPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rPe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function aPe(e){if(Array.isArray(e))return e}function oPe(e){return cPe(e)||sPe(e)||FH(e)||iPe()}function iPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FH(e,t){if(e){if(typeof e=="string")return SN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SN(e,t)}}function sPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function cPe(e){if(Array.isArray(e))return SN(e)}function SN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ug=1e-4,BH=function(e,t){return[0,3*e,3*t-6*e,3*e-3*t+1]},zH=function(e,t){return e.map(function(n,r){return n*Math.pow(t,r)}).reduce(function(n,r){return n+r})},UH=function(e,t){return function(n){var r=BH(e,t);return zH(r,n)}},lPe=function(e,t){return function(n){var r=BH(e,t),a=[].concat(oPe(r.map(function(o,i){return o*i}).slice(1)),[0]);return zH(a,n)}},VH=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1],o=t[2],i=t[3];if(t.length===1)switch(t[0]){case"linear":r=0,a=0,o=1,i=1;break;case"ease":r=.25,a=.1,o=.25,i=1;break;case"ease-in":r=.42,a=0,o=1,i=1;break;case"ease-out":r=.42,a=0,o=.58,i=1;break;case"ease-in-out":r=0,a=0,o=.58,i=1;break;default:{var s=t[0].split("(");if(s[0]==="cubic-bezier"&&s[1].split(")")[0].split(",").length===4){var c=s[1].split(")")[0].split(",").map(function(y){return parseFloat(y)}),l=tPe(c,4);r=l[0],a=l[1],o=l[2],i=l[3]}}}var u=UH(r,o),d=UH(a,i),p=lPe(r,o),f=function(y){return y>1?1:y<0?0:y},m=function(y){for(var v=y>1?1:y,b=v,w=0;w<8;++w){var j=u(b)-v,x=p(b);if(Math.abs(j-v)<Ug||x<Ug)return d(b);b=f(b-j/x)}return d(b)};return m.isStepper=!1,m},uPe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.stiff,n=t===void 0?100:t,r=e.damping,a=r===void 0?8:r,o=e.dt,i=o===void 0?17:o,s=function(c,l,u){var d=-(c-l)*n,p=u*a,f=u+(d-p)*i/1e3,m=u*i/1e3+c;return Math.abs(m-l)<Ug&&Math.abs(f)<Ug?[l,0]:[m,f]};return s.isStepper=!0,s.dt=i,s},dPe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0];if(typeof r=="string")switch(r){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return VH(r);case"spring":return uPe();default:if(r.split("(")[0]==="cubic-bezier")return VH(r)}return typeof r=="function"?r:null};function Xp(e){"@babel/helpers - typeof";return Xp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xp(e)}function qH(e){return hPe(e)||fPe(e)||HH(e)||pPe()}function pPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function hPe(e){if(Array.isArray(e))return ON(e)}function WH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function An(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WH(Object(n),!0).forEach(function(r){EN(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function EN(e,t,n){return t=mPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mPe(e){var t=yPe(e,"string");return Xp(t)==="symbol"?t:String(t)}function yPe(e,t){if(Xp(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Xp(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gPe(e,t){return wPe(e)||bPe(e,t)||HH(e,t)||vPe()}function vPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HH(e,t){if(e){if(typeof e=="string")return ON(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ON(e,t)}}function ON(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bPe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function wPe(e){if(Array.isArray(e))return e}var Vg=function(e,t,n){return e+(t-e)*n},CN=function(e){var t=e.from,n=e.to;return t!==n},xPe=function e(t,n,r){var a=Gp(function(o,i){if(CN(i)){var s=t(i.from,i.to,i.velocity),c=gPe(s,2),l=c[0],u=c[1];return An(An({},i),{},{from:l,velocity:u})}return i},n);return r<1?Gp(function(o,i){return CN(i)?An(An({},i),{},{velocity:Vg(i.velocity,a[o].velocity,r),from:Vg(i.from,a[o].from,r)}):i},n):e(t,a,r-1)};const _Pe=function(e,t,n,r,a){var o=Yke(e,t),i=o.reduce(function(v,b){return An(An({},v),{},EN({},b,[e[b],t[b]]))},{}),s=o.reduce(function(v,b){return An(An({},v),{},EN({},b,{from:e[b],velocity:0,to:t[b]}))},{}),c=-1,l,u,d=function(){return null},p=function(){return Gp(function(v,b){return b.from},s)},f=function(){return!Object.values(s).filter(CN).length},m=function(v){l||(l=v);var b=v-l,w=b/n.dt;s=xPe(n,s,w),a(An(An(An({},e),t),p())),l=v,f()||(c=requestAnimationFrame(d))},y=function(v){u||(u=v);var b=(v-u)/r,w=Gp(function(x,_){return Vg.apply(void 0,qH(_).concat([n(b)]))},i);if(a(An(An(An({},e),t),w)),b<1)c=requestAnimationFrame(d);else{var j=Gp(function(x,_){return Vg.apply(void 0,qH(_).concat([n(1)]))},i);a(An(An(An({},e),t),j))}};return d=n.isStepper?m:y,function(){return requestAnimationFrame(d),function(){cancelAnimationFrame(c)}}};function Tl(e){"@babel/helpers - typeof";return Tl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tl(e)}var jPe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function SPe(e,t){if(e==null)return{};var n=EPe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function EPe(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,o;for(o=0;o<r.length;o++)a=r[o],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function NN(e){return MPe(e)||NPe(e)||CPe(e)||OPe()}function OPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CPe(e,t){if(e){if(typeof e=="string")return MN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MN(e,t)}}function NPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function MPe(e){if(Array.isArray(e))return MN(e)}function MN(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function KH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Na(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KH(Object(n),!0).forEach(function(r){Jp(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Jp(e,t,n){return t=ZH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kPe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PPe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ZH(r.key),r)}}function APe(e,t,n){return t&&PPe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ZH(e){var t=TPe(e,"string");return Tl(t)==="symbol"?t:String(t)}function TPe(e,t){if(Tl(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Tl(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function IPe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kN(e,t)}function kN(e,t){return kN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},kN(e,t)}function RPe(e){var t=DPe();return function(){var n=qg(e),r;if(t){var a=qg(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return PN(this,r)}}function PN(e,t){if(t&&(Tl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return AN(e)}function AN(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DPe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function qg(e){return qg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qg(e)}var Bi=function(e){IPe(n,e);var t=RPe(n);function n(r,a){var o;kPe(this,n),o=t.call(this,r,a);var i=o.props,s=i.isActive,c=i.attributeName,l=i.from,u=i.to,d=i.steps,p=i.children,f=i.duration;if(o.handleStyleChange=o.handleStyleChange.bind(AN(o)),o.changeStyle=o.changeStyle.bind(AN(o)),!s||f<=0)return o.state={style:{}},typeof p=="function"&&(o.state={style:u}),PN(o);if(d&&d.length)o.state={style:d[0].style};else if(l){if(typeof p=="function")return o.state={style:l},PN(o);o.state={style:c?Jp({},c,l):l}}else o.state={style:{}};return o}return APe(n,[{key:"componentDidMount",value:function(){var r=this.props,a=r.isActive,o=r.canBegin;this.mounted=!0,!(!a||!o)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(r){var a=this.props,o=a.isActive,i=a.canBegin,s=a.attributeName,c=a.shouldReAnimate,l=a.to,u=a.from,d=this.state.style;if(i){if(!o){var p={style:s?Jp({},s,l):l};this.state&&d&&(s&&d[s]!==l||!s&&d!==l)&&this.setState(p);return}if(!(Uke(r.to,l)&&r.canBegin&&r.isActive)){var f=!r.canBegin||!r.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var m=f||c?u:r.to;if(this.state&&d){var y={style:s?Jp({},s,m):m};(s&&d[s]!==m||!s&&d!==m)&&this.setState(y)}this.runAnimation(Na(Na({},this.props),{},{from:m,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var r=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),r&&r()}},{key:"handleStyleChange",value:function(r){this.changeStyle(r)}},{key:"changeStyle",value:function(r){this.mounted&&this.setState({style:r})}},{key:"runJSAnimation",value:function(r){var a=this,o=r.from,i=r.to,s=r.duration,c=r.easing,l=r.begin,u=r.onAnimationEnd,d=r.onAnimationStart,p=_Pe(o,i,dPe(c),s,this.changeStyle),f=function(){a.stopJSAnimation=p()};this.manager.start([d,l,f,s,u])}},{key:"runStepAnimation",value:function(r){var a=this,o=r.steps,i=r.begin,s=r.onAnimationStart,c=o[0],l=c.style,u=c.duration,d=u===void 0?0:u,p=function(f,m,y){if(y===0)return f;var v=m.duration,b=m.easing,w=b===void 0?"ease":b,j=m.style,x=m.properties,_=m.onAnimationEnd,S=y>0?o[y-1]:m,E=x||Object.keys(j);if(typeof w=="function"||w==="spring")return[].concat(NN(f),[a.runJSAnimation.bind(a,{from:S.style,to:j,duration:v,easing:w}),v]);var O=$H(E,v,w),N=Na(Na(Na({},S.style),j),{},{transition:O});return[].concat(NN(f),[N,v,_]).filter(Qke)};return this.manager.start([s].concat(NN(o.reduce(p,[l,Math.max(d,i)])),[r.onAnimationEnd]))}},{key:"runAnimation",value:function(r){this.manager||(this.manager=Gke());var a=r.begin,o=r.duration,i=r.attributeName,s=r.to,c=r.easing,l=r.onAnimationStart,u=r.onAnimationEnd,d=r.steps,p=r.children,f=this.manager;if(this.unSubscribe=f.subscribe(this.handleStyleChange),typeof c=="function"||typeof p=="function"||c==="spring"){this.runJSAnimation(r);return}if(d.length>1){this.runStepAnimation(r);return}var m=i?Jp({},i,s):s,y=$H(Object.keys(m),o,c);f.start([l,a,Na(Na({},m),{},{transition:y}),o,u])}},{key:"render",value:function(){var r=this.props,a=r.children;r.begin;var o=r.duration;r.attributeName,r.easing;var i=r.isActive;r.steps,r.from,r.to,r.canBegin,r.onAnimationEnd,r.shouldReAnimate,r.onAnimationReStart;var s=SPe(r,jPe),c=g.Children.count(a),l=this.state.style;if(typeof a=="function")return a(l);if(!i||c===0||o<=0)return a;var u=function(d){var p=d.props,f=p.style,m=f===void 0?{}:f,y=p.className,v=g.cloneElement(d,Na(Na({},s),{},{style:Na(Na({},m),l),className:y}));return v};return c===1?u(g.Children.only(a)):W.createElement("div",null,g.Children.map(a,function(d){return u(d)}))}}]),n}(g.PureComponent);Bi.displayName="Animate",Bi.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}},Bi.propTypes={from:Ze.oneOfType([Ze.object,Ze.string]),to:Ze.oneOfType([Ze.object,Ze.string]),attributeName:Ze.string,duration:Ze.number,begin:Ze.number,easing:Ze.oneOfType([Ze.string,Ze.func]),steps:Ze.arrayOf(Ze.shape({duration:Ze.number.isRequired,style:Ze.object.isRequired,easing:Ze.oneOfType([Ze.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Ze.func]),properties:Ze.arrayOf("string"),onAnimationEnd:Ze.func})),children:Ze.oneOfType([Ze.node,Ze.func]),isActive:Ze.bool,canBegin:Ze.bool,onAnimationEnd:Ze.func,shouldReAnimate:Ze.bool,onAnimationStart:Ze.func,onAnimationReStart:Ze.func},Ze.object,Ze.object,Ze.object,Ze.element,Ze.object,Ze.object,Ze.object,Ze.oneOfType([Ze.array,Ze.element]),Ze.any;function Yp(e){"@babel/helpers - typeof";return Yp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yp(e)}function Wg(){return Wg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Wg.apply(this,arguments)}function LPe(e,t){return zPe(e)||BPe(e,t)||FPe(e,t)||$Pe()}function $Pe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FPe(e,t){if(e){if(typeof e=="string")return GH(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return GH(e,t)}}function GH(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function BPe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function zPe(e){if(Array.isArray(e))return e}function XH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function JH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XH(Object(n),!0).forEach(function(r){UPe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XH(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function UPe(e,t,n){return t=VPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function VPe(e){var t=qPe(e,"string");return Yp(t)=="symbol"?t:t+""}function qPe(e,t){if(Yp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Yp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var YH=function(e,t,n,r,a){var o=Math.min(Math.abs(n)/2,Math.abs(r)/2),i=r>=0?1:-1,s=n>=0?1:-1,c=r>=0&&n>=0||r<0&&n<0?1:0,l;if(o>0&&a instanceof Array){for(var u=[0,0,0,0],d=0,p=4;d<p;d++)u[d]=a[d]>o?o:a[d];l="M".concat(e,",").concat(t+i*u[0]),u[0]>0&&(l+="A ".concat(u[0],",").concat(u[0],",0,0,").concat(c,",").concat(e+s*u[0],",").concat(t)),l+="L ".concat(e+n-s*u[1],",").concat(t),u[1]>0&&(l+="A ".concat(u[1],",").concat(u[1],",0,0,").concat(c,`,
        `).concat(e+n,",").concat(t+i*u[1])),l+="L ".concat(e+n,",").concat(t+r-i*u[2]),u[2]>0&&(l+="A ".concat(u[2],",").concat(u[2],",0,0,").concat(c,`,
        `).concat(e+n-s*u[2],",").concat(t+r)),l+="L ".concat(e+s*u[3],",").concat(t+r),u[3]>0&&(l+="A ".concat(u[3],",").concat(u[3],",0,0,").concat(c,`,
        `).concat(e,",").concat(t+r-i*u[3])),l+="Z"}else if(o>0&&a===+a&&a>0){var f=Math.min(o,a);l="M ".concat(e,",").concat(t+i*f,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e+s*f,",").concat(t,`
            L `).concat(e+n-s*f,",").concat(t,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e+n,",").concat(t+i*f,`
            L `).concat(e+n,",").concat(t+r-i*f,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e+n-s*f,",").concat(t+r,`
            L `).concat(e+s*f,",").concat(t+r,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e,",").concat(t+r-i*f," Z")}else l="M ".concat(e,",").concat(t," h ").concat(n," v ").concat(r," h ").concat(-n," Z");return l},WPe=function(e,t){if(!e||!t)return!1;var n=e.x,r=e.y,a=t.x,o=t.y,i=t.width,s=t.height;if(Math.abs(i)>0&&Math.abs(s)>0){var c=Math.min(a,a+i),l=Math.max(a,a+i),u=Math.min(o,o+s),d=Math.max(o,o+s);return n>=c&&n<=l&&r>=u&&r<=d}return!1},HPe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},TN=function(e){var t=JH(JH({},HPe),e),n=g.useRef(),r=g.useState(-1),a=LPe(r,2),o=a[0],i=a[1];g.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var j=n.current.getTotalLength();j&&i(j)}catch{}},[]);var s=t.x,c=t.y,l=t.width,u=t.height,d=t.radius,p=t.className,f=t.animationEasing,m=t.animationDuration,y=t.animationBegin,v=t.isAnimationActive,b=t.isUpdateAnimationActive;if(s!==+s||c!==+c||l!==+l||u!==+u||l===0||u===0)return null;var w=St("recharts-rectangle",p);return b?W.createElement(Bi,{canBegin:o>0,from:{width:l,height:u,x:s,y:c},to:{width:l,height:u,x:s,y:c},duration:m,animationEasing:f,isActive:b},function(j){var x=j.width,_=j.height,S=j.x,E=j.y;return W.createElement(Bi,{canBegin:o>0,from:"0px ".concat(o===-1?1:o,"px"),to:"".concat(o,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:m,isActive:v,easing:f},W.createElement("path",Wg({},bt(t,!0),{className:w,d:YH(S,E,x,_,d),ref:n})))}):W.createElement("path",Wg({},bt(t,!0),{className:w,d:YH(s,c,l,u,d)}))};function IN(){return IN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},IN.apply(this,arguments)}var QH=function(e){var t=e.cx,n=e.cy,r=e.r,a=e.className,o=St("recharts-dot",a);return t===+t&&n===+n&&r===+r?W.createElement("circle",IN({},bt(e,!1),qy(e),{className:o,cx:t,cy:n,r})):null};function Qp(e){"@babel/helpers - typeof";return Qp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qp(e)}var KPe=["x","y","top","left","width","height","className"];function RN(){return RN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},RN.apply(this,arguments)}function eK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function ZPe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eK(Object(n),!0).forEach(function(r){GPe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function GPe(e,t,n){return t=XPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XPe(e){var t=JPe(e,"string");return Qp(t)=="symbol"?t:t+""}function JPe(e,t){if(Qp(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Qp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function YPe(e,t){if(e==null)return{};var n=QPe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function QPe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}var eAe=function(e,t,n,r,a,o){return"M".concat(e,",").concat(a,"v").concat(r,"M").concat(o,",").concat(t,"h").concat(n)},tAe=function(e){var t=e.x,n=t===void 0?0:t,r=e.y,a=r===void 0?0:r,o=e.top,i=o===void 0?0:o,s=e.left,c=s===void 0?0:s,l=e.width,u=l===void 0?0:l,d=e.height,p=d===void 0?0:d,f=e.className,m=YPe(e,KPe),y=ZPe({x:n,y:a,top:i,left:c,width:u,height:p},m);return!ye(n)||!ye(a)||!ye(u)||!ye(p)||!ye(i)||!ye(c)?null:W.createElement("path",RN({},bt(y,!0),{className:St("recharts-cross",f),d:eAe(n,a,u,p,i,c)}))},DN,tK;KM=function(){if(tK)return DN;tK=1;var e=ko(),t=N0(),n=Ta(),r="[object Object]",a=Function.prototype,o=Object.prototype,i=a.toString,s=o.hasOwnProperty,c=i.call(Object);function l(u){if(!n(u)||e(u)!=r)return!1;var d=t(u);if(d===null)return!0;var p=s.call(d,"constructor")&&d.constructor;return typeof p=="function"&&p instanceof p&&i.call(p)==c}return DN=l,DN};var nAe=KM();const rAe=st(nAe);var LN,nK;function aAe(){if(nK)return LN;nK=1;var e=ko(),t=Ta(),n="[object Boolean]";function r(a){return a===!0||a===!1||t(a)&&e(a)==n}return LN=r,LN}var oAe=aAe();const iAe=st(oAe);function ef(e){"@babel/helpers - typeof";return ef=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ef(e)}function Hg(){return Hg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Hg.apply(this,arguments)}function sAe(e,t){return dAe(e)||uAe(e,t)||lAe(e,t)||cAe()}function cAe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lAe(e,t){if(e){if(typeof e=="string")return rK(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rK(e,t)}}function rK(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function uAe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function dAe(e){if(Array.isArray(e))return e}function aK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function oK(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aK(Object(n),!0).forEach(function(r){pAe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function pAe(e,t,n){return t=fAe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fAe(e){var t=hAe(e,"string");return ef(t)=="symbol"?t:t+""}function hAe(e,t){if(ef(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(ef(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var iK=function(e,t,n,r,a){var o=n-r,i;return i="M ".concat(e,",").concat(t),i+="L ".concat(e+n,",").concat(t),i+="L ".concat(e+n-o/2,",").concat(t+a),i+="L ".concat(e+n-o/2-r,",").concat(t+a),i+="L ".concat(e,",").concat(t," Z"),i},mAe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},yAe=function(e){var t=oK(oK({},mAe),e),n=g.useRef(),r=g.useState(-1),a=sAe(r,2),o=a[0],i=a[1];g.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var w=n.current.getTotalLength();w&&i(w)}catch{}},[]);var s=t.x,c=t.y,l=t.upperWidth,u=t.lowerWidth,d=t.height,p=t.className,f=t.animationEasing,m=t.animationDuration,y=t.animationBegin,v=t.isUpdateAnimationActive;if(s!==+s||c!==+c||l!==+l||u!==+u||d!==+d||l===0&&u===0||d===0)return null;var b=St("recharts-trapezoid",p);return v?W.createElement(Bi,{canBegin:o>0,from:{upperWidth:0,lowerWidth:0,height:d,x:s,y:c},to:{upperWidth:l,lowerWidth:u,height:d,x:s,y:c},duration:m,animationEasing:f,isActive:v},function(w){var j=w.upperWidth,x=w.lowerWidth,_=w.height,S=w.x,E=w.y;return W.createElement(Bi,{canBegin:o>0,from:"0px ".concat(o===-1?1:o,"px"),to:"".concat(o,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:m,easing:f},W.createElement("path",Hg({},bt(t,!0),{className:b,d:iK(S,E,j,x,_),ref:n})))}):W.createElement("g",null,W.createElement("path",Hg({},bt(t,!0),{className:b,d:iK(s,c,l,u,d)})))},gAe=["option","shapeType","propTransformer","activeClassName","isActive"];function tf(e){"@babel/helpers - typeof";return tf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tf(e)}function vAe(e,t){if(e==null)return{};var n=bAe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function bAe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function sK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Kg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sK(Object(n),!0).forEach(function(r){wAe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function wAe(e,t,n){return t=xAe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xAe(e){var t=_Ae(e,"string");return tf(t)=="symbol"?t:t+""}function _Ae(e,t){if(tf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(tf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function jAe(e,t){return Kg(Kg({},t),e)}function SAe(e,t){return e==="symbols"}function cK(e){var t=e.shapeType,n=e.elementProps;switch(t){case"rectangle":return W.createElement(TN,n);case"trapezoid":return W.createElement(yAe,n);case"sector":return W.createElement(hH,n);case"symbols":if(SAe(t))return W.createElement(SO,n);break;default:return null}}function EAe(e){return g.isValidElement(e)?e.props:e}function OAe(e){var t=e.option,n=e.shapeType,r=e.propTransformer,a=r===void 0?jAe:r,o=e.activeClassName,i=o===void 0?"recharts-active-shape":o,s=e.isActive,c=vAe(e,gAe),l;if(g.isValidElement(t))l=g.cloneElement(t,Kg(Kg({},c),EAe(t)));else if(at(t))l=t(c);else if(rAe(t)&&!iAe(t)){var u=a(t,c);l=W.createElement(cK,{shapeType:n,elementProps:u})}else{var d=c;l=W.createElement(cK,{shapeType:n,elementProps:d})}return s?W.createElement(wn,{className:i},l):l}function Zg(e,t){return t!=null&&"trapezoids"in e.props}function Gg(e,t){return t!=null&&"sectors"in e.props}function nf(e,t){return t!=null&&"points"in e.props}function CAe(e,t){var n,r,a=e.x===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.x)||e.x===t.x,o=e.y===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.y)||e.y===t.y;return a&&o}function NAe(e,t){var n=e.endAngle===t.endAngle,r=e.startAngle===t.startAngle;return n&&r}function MAe(e,t){var n=e.x===t.x,r=e.y===t.y,a=e.z===t.z;return n&&r&&a}function kAe(e,t){var n;return Zg(e,t)?n=CAe:Gg(e,t)?n=NAe:nf(e,t)&&(n=MAe),n}function PAe(e,t){var n;return Zg(e,t)?n="trapezoids":Gg(e,t)?n="sectors":nf(e,t)&&(n="points"),n}function AAe(e,t){if(Zg(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}if(Gg(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}return nf(e,t)?t.payload:{}}function TAe(e){var t=e.activeTooltipItem,n=e.graphicalItem,r=e.itemData,a=PAe(n,t),o=AAe(n,t),i=r.filter(function(c,l){var u=nN(o,c),d=n.props[a].filter(function(m){var y=kAe(n,t);return y(m,t)}),p=n.props[a].indexOf(d[d.length-1]),f=l===p;return u&&f}),s=r.indexOf(i[i.length-1]);return s}var $N,lK;function IAe(){if(lK)return $N;lK=1;var e=Math.ceil,t=Math.max;function n(r,a,o,i){for(var s=-1,c=t(e((a-r)/(o||1)),0),l=Array(c);c--;)l[i?c:++s]=r,r+=o;return l}return $N=n,$N}var FN,uK;function RAe(){if(uK)return FN;uK=1;var e=IAe(),t=Hs(),n=uz();function r(a){return function(o,i,s){return s&&typeof s!="number"&&t(o,i,s)&&(i=s=void 0),o=n(o),i===void 0?(i=o,o=0):i=n(i),s=s===void 0?o<i?1:-1:n(s),e(o,i,s,a)}}return FN=r,FN}var BN,dK;function DAe(){if(dK)return BN;dK=1;var e=RAe(),t=e();return BN=t,BN}var LAe=DAe();const Xg=st(LAe);function rf(e){"@babel/helpers - typeof";return rf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rf(e)}function pK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function fK(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pK(Object(n),!0).forEach(function(r){hK(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function hK(e,t,n){return t=$Ae(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $Ae(e){var t=FAe(e,"string");return rf(t)=="symbol"?t:t+""}function FAe(e,t){if(rf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(rf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var BAe=["Webkit","Moz","O","ms"],zAe=function(e,t){var n=e.replace(/(\w)/,function(a){return a.toUpperCase()}),r=BAe.reduce(function(a,o){return fK(fK({},a),{},hK({},o+n,t))},{});return r[e]=t,r};function Il(e){"@babel/helpers - typeof";return Il=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Il(e)}function Jg(){return Jg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Jg.apply(this,arguments)}function mK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function zN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mK(Object(n),!0).forEach(function(r){Er(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function UAe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vK(r.key),r)}}function VAe(e,t,n){return t&&yK(e.prototype,t),n&&yK(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function qAe(e,t,n){return t=Yg(t),WAe(e,gK()?Reflect.construct(t,n||[],Yg(e).constructor):t.apply(e,n))}function WAe(e,t){if(t&&(Il(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return HAe(e)}function HAe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gK=function(){return!!e})()}function Yg(e){return Yg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yg(e)}function KAe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UN(e,t)}function UN(e,t){return UN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},UN(e,t)}function Er(e,t,n){return t=vK(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vK(e){var t=ZAe(e,"string");return Il(t)=="symbol"?t:t+""}function ZAe(e,t){if(Il(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Il(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var GAe=function(e){var t=e.data,n=e.startIndex,r=e.endIndex,a=e.x,o=e.width,i=e.travellerWidth;if(!t||!t.length)return{};var s=t.length,c=Np().domain(Xg(0,s)).range([a,a+o-i]),l=c.domain().map(function(u){return c(u)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:c(n),endX:c(r),scale:c,scaleValues:l}},bK=function(e){return e.changedTouches&&!!e.changedTouches.length},Rl=function(e){function t(n){var r;return UAe(this,t),r=qAe(this,t,[n]),Er(r,"handleDrag",function(a){r.leaveTimer&&(clearTimeout(r.leaveTimer),r.leaveTimer=null),r.state.isTravellerMoving?r.handleTravellerMove(a):r.state.isSlideMoving&&r.handleSlideDrag(a)}),Er(r,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&r.handleDrag(a.changedTouches[0])}),Er(r,"handleDragEnd",function(){r.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=r.props,o=a.endIndex,i=a.onDragEnd,s=a.startIndex;i==null||i({endIndex:o,startIndex:s})}),r.detachDragEndListener()}),Er(r,"handleLeaveWrapper",function(){(r.state.isTravellerMoving||r.state.isSlideMoving)&&(r.leaveTimer=window.setTimeout(r.handleDragEnd,r.props.leaveTimeOut))}),Er(r,"handleEnterSlideOrTraveller",function(){r.setState({isTextActive:!0})}),Er(r,"handleLeaveSlideOrTraveller",function(){r.setState({isTextActive:!1})}),Er(r,"handleSlideDragStart",function(a){var o=bK(a)?a.changedTouches[0]:a;r.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),r.attachDragEndListener()}),r.travellerDragStartHandlers={startX:r.handleTravellerDragStart.bind(r,"startX"),endX:r.handleTravellerDragStart.bind(r,"endX")},r.state={},r}return KAe(t,e),VAe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var r=n.startX,a=n.endX,o=this.state.scaleValues,i=this.props,s=i.gap,c=i.data,l=c.length-1,u=Math.min(r,a),d=Math.max(r,a),p=t.getIndexInRange(o,u),f=t.getIndexInRange(o,d);return{startIndex:p-p%s,endIndex:f===l?l:f-f%s}}},{key:"getTextOfTick",value:function(n){var r=this.props,a=r.data,o=r.tickFormatter,i=r.dataKey,s=ro(a[n],i,n);return at(o)?o(s,n):s}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var r=this.state,a=r.slideMoveStartX,o=r.startX,i=r.endX,s=this.props,c=s.x,l=s.width,u=s.travellerWidth,d=s.startIndex,p=s.endIndex,f=s.onChange,m=n.pageX-a;m>0?m=Math.min(m,c+l-u-i,c+l-u-o):m<0&&(m=Math.max(m,c-o,c-i));var y=this.getIndex({startX:o+m,endX:i+m});(y.startIndex!==d||y.endIndex!==p)&&f&&f(y),this.setState({startX:o+m,endX:i+m,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,r){var a=bK(r)?r.changedTouches[0]:r;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:a.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var r=this.state,a=r.brushMoveStartX,o=r.movingTravellerId,i=r.endX,s=r.startX,c=this.state[o],l=this.props,u=l.x,d=l.width,p=l.travellerWidth,f=l.onChange,m=l.gap,y=l.data,v={startX:this.state.startX,endX:this.state.endX},b=n.pageX-a;b>0?b=Math.min(b,u+d-p-c):b<0&&(b=Math.max(b,u-c)),v[o]=c+b;var w=this.getIndex(v),j=w.startIndex,x=w.endIndex,_=function(){var S=y.length-1;return o==="startX"&&(i>s?j%m===0:x%m===0)||i<s&&x===S||o==="endX"&&(i>s?x%m===0:j%m===0)||i>s&&x===S};this.setState(Er(Er({},o,c+b),"brushMoveStartX",n.pageX),function(){f&&_()&&f(w)})}},{key:"handleTravellerMoveKeyboard",value:function(n,r){var a=this,o=this.state,i=o.scaleValues,s=o.startX,c=o.endX,l=this.state[r],u=i.indexOf(l);if(u!==-1){var d=u+n;if(!(d===-1||d>=i.length)){var p=i[d];r==="startX"&&p>=c||r==="endX"&&p<=s||this.setState(Er({},r,p),function(){a.props.onChange(a.getIndex({startX:a.state.startX,endX:a.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,r=n.x,a=n.y,o=n.width,i=n.height,s=n.fill,c=n.stroke;return W.createElement("rect",{stroke:c,fill:s,x:r,y:a,width:o,height:i})}},{key:"renderPanorama",value:function(){var n=this.props,r=n.x,a=n.y,o=n.width,i=n.height,s=n.data,c=n.children,l=n.padding,u=g.Children.only(c);return u?W.cloneElement(u,{x:r,y:a,width:o,height:i,margin:l,compact:!0,data:s}):null}},{key:"renderTravellerLayer",value:function(n,r){var a,o,i=this,s=this.props,c=s.y,l=s.travellerWidth,u=s.height,d=s.traveller,p=s.ariaLabel,f=s.data,m=s.startIndex,y=s.endIndex,v=Math.max(n,this.props.x),b=zN(zN({},bt(this.props,!1)),{},{x:v,y:c,width:l,height:u}),w=p||"Min value: ".concat((a=f[m])===null||a===void 0?void 0:a.name,", Max value: ").concat((o=f[y])===null||o===void 0?void 0:o.name);return W.createElement(wn,{tabIndex:0,role:"slider","aria-label":w,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[r],onTouchStart:this.travellerDragStartHandlers[r],onKeyDown:function(j){["ArrowLeft","ArrowRight"].includes(j.key)&&(j.preventDefault(),j.stopPropagation(),i.handleTravellerMoveKeyboard(j.key==="ArrowRight"?1:-1,r))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(d,b))}},{key:"renderSlide",value:function(n,r){var a=this.props,o=a.y,i=a.height,s=a.stroke,c=a.travellerWidth,l=Math.min(n,r)+c,u=Math.max(Math.abs(r-n)-c,0);return W.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:s,fillOpacity:.2,x:l,y:o,width:u,height:i})}},{key:"renderText",value:function(){var n=this.props,r=n.startIndex,a=n.endIndex,o=n.y,i=n.height,s=n.travellerWidth,c=n.stroke,l=this.state,u=l.startX,d=l.endX,p=5,f={pointerEvents:"none",fill:c};return W.createElement(wn,{className:"recharts-brush-texts"},W.createElement(dg,Jg({textAnchor:"end",verticalAnchor:"middle",x:Math.min(u,d)-p,y:o+i/2},f),this.getTextOfTick(r)),W.createElement(dg,Jg({textAnchor:"start",verticalAnchor:"middle",x:Math.max(u,d)+s+p,y:o+i/2},f),this.getTextOfTick(a)))}},{key:"render",value:function(){var n=this.props,r=n.data,a=n.className,o=n.children,i=n.x,s=n.y,c=n.width,l=n.height,u=n.alwaysShowText,d=this.state,p=d.startX,f=d.endX,m=d.isTextActive,y=d.isSlideMoving,v=d.isTravellerMoving,b=d.isTravellerFocused;if(!r||!r.length||!ye(i)||!ye(s)||!ye(c)||!ye(l)||c<=0||l<=0)return null;var w=St("recharts-brush",a),j=W.Children.count(o)===1,x=zAe("userSelect","none");return W.createElement(wn,{className:w,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:x},this.renderBackground(),j&&this.renderPanorama(),this.renderSlide(p,f),this.renderTravellerLayer(p,"startX"),this.renderTravellerLayer(f,"endX"),(m||y||v||b||u)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var r=n.x,a=n.y,o=n.width,i=n.height,s=n.stroke,c=Math.floor(a+i/2)-1;return W.createElement(W.Fragment,null,W.createElement("rect",{x:r,y:a,width:o,height:i,fill:s,stroke:"none"}),W.createElement("line",{x1:r+1,y1:c,x2:r+o-1,y2:c,fill:"none",stroke:"#fff"}),W.createElement("line",{x1:r+1,y1:c+2,x2:r+o-1,y2:c+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,r){var a;return W.isValidElement(n)?a=W.cloneElement(n,r):at(n)?a=n(r):a=t.renderDefaultTraveller(r),a}},{key:"getDerivedStateFromProps",value:function(n,r){var a=n.data,o=n.width,i=n.x,s=n.travellerWidth,c=n.updateId,l=n.startIndex,u=n.endIndex;if(a!==r.prevData||c!==r.prevUpdateId)return zN({prevData:a,prevTravellerWidth:s,prevUpdateId:c,prevX:i,prevWidth:o},a&&a.length?GAe({data:a,width:o,x:i,travellerWidth:s,startIndex:l,endIndex:u}):{scale:null,scaleValues:null});if(r.scale&&(o!==r.prevWidth||i!==r.prevX||s!==r.prevTravellerWidth)){r.scale.range([i,i+o-s]);var d=r.scale.domain().map(function(p){return r.scale(p)});return{prevData:a,prevTravellerWidth:s,prevUpdateId:c,prevX:i,prevWidth:o,startX:r.scale(n.startIndex),endX:r.scale(n.endIndex),scaleValues:d}}return null}},{key:"getIndexInRange",value:function(n,r){for(var a=n.length,o=0,i=a-1;i-o>1;){var s=Math.floor((o+i)/2);n[s]>r?i=s:o=s}return r>=n[i]?i:o}}])}(g.PureComponent);Er(Rl,"displayName","Brush"),Er(Rl,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var VN,wK;function XAe(){if(wK)return VN;wK=1;var e=HO();function t(n,r){var a;return e(n,function(o,i,s){return a=r(o,i,s),!a}),!!a}return VN=t,VN}var qN,xK;function JAe(){if(xK)return qN;xK=1;var e=XR(),t=za(),n=XAe(),r=Wn(),a=Hs();function o(i,s,c){var l=r(i)?e:n;return c&&a(i,s,c)&&(s=void 0),l(i,t(s,3))}return qN=o,qN}var YAe=JAe();const QAe=st(YAe);var ao=function(e,t){var n=e.alwaysShow,r=e.ifOverflow;return n&&(r="extendDomain"),r===t},WN,_K;function e2e(){if(_K)return WN;_K=1;var e=Lv(),t=dV(),n=za();function r(a,o){var i={};return o=n(o,3),t(a,function(s,c,l){e(i,c,o(s,c,l))}),i}return WN=r,WN}var t2e=e2e();const n2e=st(t2e);var HN,jK;function r2e(){if(jK)return HN;jK=1;function e(t,n){for(var r=-1,a=t==null?0:t.length;++r<a;)if(!n(t[r],r,t))return!1;return!0}return HN=e,HN}var KN,SK;function a2e(){if(SK)return KN;SK=1;var e=HO();function t(n,r){var a=!0;return e(n,function(o,i,s){return a=!!r(o,i,s),a}),a}return KN=t,KN}var ZN,EK;function o2e(){if(EK)return ZN;EK=1;var e=r2e(),t=a2e(),n=za(),r=Wn(),a=Hs();function o(i,s,c){var l=r(i)?e:t;return c&&a(i,s,c)&&(s=void 0),l(i,n(s,3))}return ZN=o,ZN}var i2e=o2e();const OK=st(i2e);var s2e=["x","y"];function af(e){"@babel/helpers - typeof";return af=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},af(e)}function GN(){return GN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},GN.apply(this,arguments)}function CK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function of(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?CK(Object(n),!0).forEach(function(r){c2e(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function c2e(e,t,n){return t=l2e(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l2e(e){var t=u2e(e,"string");return af(t)=="symbol"?t:t+""}function u2e(e,t){if(af(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(af(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function d2e(e,t){if(e==null)return{};var n=p2e(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function p2e(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function f2e(e,t){var n=e.x,r=e.y,a=d2e(e,s2e),o="".concat(n),i=parseInt(o,10),s="".concat(r),c=parseInt(s,10),l="".concat(t.height||a.height),u=parseInt(l,10),d="".concat(t.width||a.width),p=parseInt(d,10);return of(of(of(of(of({},t),a),i?{x:i}:{}),c?{y:c}:{}),{},{height:u,width:p,name:t.name,radius:t.radius})}function NK(e){return W.createElement(OAe,GN({shapeType:"rectangle",propTransformer:f2e,activeClassName:"recharts-active-bar"},e))}var h2e=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,r){if(typeof e=="number")return e;var a=typeof n=="number";return a?e(n,r):(a||Ds(),t)}},m2e=["value","background"],MK;function Dl(e){"@babel/helpers - typeof";return Dl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dl(e)}function y2e(e,t){if(e==null)return{};var n=g2e(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function g2e(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function Qg(){return Qg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Qg.apply(this,arguments)}function kK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function cn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kK(Object(n),!0).forEach(function(r){zi(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function v2e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,TK(r.key),r)}}function b2e(e,t,n){return t&&PK(e.prototype,t),n&&PK(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function w2e(e,t,n){return t=ev(t),x2e(e,AK()?Reflect.construct(t,n||[],ev(e).constructor):t.apply(e,n))}function x2e(e,t){if(t&&(Dl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _2e(e)}function _2e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function AK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(AK=function(){return!!e})()}function ev(e){return ev=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ev(e)}function j2e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&XN(e,t)}function XN(e,t){return XN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},XN(e,t)}function zi(e,t,n){return t=TK(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TK(e){var t=S2e(e,"string");return Dl(t)=="symbol"?t:t+""}function S2e(e,t){if(Dl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Dl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Fs=function(e){function t(){var n;v2e(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return n=w2e(this,t,[].concat(a)),zi(n,"state",{isAnimationFinished:!1}),zi(n,"id",Vy("recharts-bar-")),zi(n,"handleAnimationEnd",function(){var i=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),i&&i()}),zi(n,"handleAnimationStart",function(){var i=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),i&&i()}),n}return j2e(t,e),b2e(t,[{key:"renderRectanglesStatically",value:function(n){var r=this,a=this.props,o=a.shape,i=a.dataKey,s=a.activeIndex,c=a.activeBar,l=bt(this.props,!1);return n&&n.map(function(u,d){var p=d===s,f=p?c:o,m=cn(cn(cn({},l),u),{},{isActive:p,option:f,index:d,dataKey:i,onAnimationStart:r.handleAnimationStart,onAnimationEnd:r.handleAnimationEnd});return W.createElement(wn,Qg({className:"recharts-bar-rectangle"},Wy(r.props,u,d),{key:"rectangle-".concat(u==null?void 0:u.x,"-").concat(u==null?void 0:u.y,"-").concat(u==null?void 0:u.value)}),W.createElement(NK,m))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,r=this.props,a=r.data,o=r.layout,i=r.isAnimationActive,s=r.animationBegin,c=r.animationDuration,l=r.animationEasing,u=r.animationId,d=this.state.prevData;return W.createElement(Bi,{begin:s,duration:c,isActive:i,easing:l,from:{t:0},to:{t:1},key:"bar-".concat(u),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var f=p.t,m=a.map(function(y,v){var b=d&&d[v];if(b){var w=hl(b.x,y.x),j=hl(b.y,y.y),x=hl(b.width,y.width),_=hl(b.height,y.height);return cn(cn({},y),{},{x:w(f),y:j(f),width:x(f),height:_(f)})}if(o==="horizontal"){var S=hl(0,y.height),E=S(f);return cn(cn({},y),{},{y:y.y+y.height-E,height:E})}var O=hl(0,y.width),N=O(f);return cn(cn({},y),{},{width:N})});return W.createElement(wn,null,n.renderRectanglesStatically(m))})}},{key:"renderRectangles",value:function(){var n=this.props,r=n.data,a=n.isAnimationActive,o=this.state.prevData;return a&&r&&r.length&&(!o||!nN(o,r))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(r)}},{key:"renderBackground",value:function(){var n=this,r=this.props,a=r.data,o=r.dataKey,i=r.activeIndex,s=bt(this.props.background,!1);return a.map(function(c,l){c.value;var u=c.background,d=y2e(c,m2e);if(!u)return null;var p=cn(cn(cn(cn(cn({},d),{},{fill:"#eee"},u),s),Wy(n.props,c,l)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:o,index:l,className:"recharts-bar-background-rectangle"});return W.createElement(NK,Qg({key:"background-bar-".concat(l),option:n.props.background,isActive:l===i},p))})}},{key:"renderErrorBar",value:function(n,r){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var a=this.props,o=a.data,i=a.xAxis,s=a.yAxis,c=a.layout,l=a.children,u=Oa(l,Tg);if(!u)return null;var d=c==="vertical"?o[0].height/2:o[0].width/2,p=function(m,y){var v=Array.isArray(m.value)?m.value[1]:m.value;return{x:m.x,y:m.y,value:v,errorVal:ro(m,y)}},f={clipPath:n?"url(#clipPath-".concat(r,")"):null};return W.createElement(wn,f,u.map(function(m){return W.cloneElement(m,{key:"error-bar-".concat(r,"-").concat(m.props.dataKey),data:o,xAxis:i,yAxis:s,layout:c,offset:d,dataPointFormatter:p})}))}},{key:"render",value:function(){var n=this.props,r=n.hide,a=n.data,o=n.className,i=n.xAxis,s=n.yAxis,c=n.left,l=n.top,u=n.width,d=n.height,p=n.isAnimationActive,f=n.background,m=n.id;if(r||!a||!a.length)return null;var y=this.state.isAnimationFinished,v=St("recharts-bar",o),b=i&&i.allowDataOverflow,w=s&&s.allowDataOverflow,j=b||w,x=wt(m)?this.id:m;return W.createElement(wn,{className:v},b||w?W.createElement("defs",null,W.createElement("clipPath",{id:"clipPath-".concat(x)},W.createElement("rect",{x:b?c:c-u/2,y:w?l:l-d/2,width:b?u:u*2,height:w?d:d*2}))):null,W.createElement(wn,{className:"recharts-bar-rectangles",clipPath:j?"url(#clipPath-".concat(x,")"):null},f?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(j,x),(!p||y)&&$s.renderCallByParent(this.props,a))}}],[{key:"getDerivedStateFromProps",value:function(n,r){return n.animationId!==r.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:r.curData}:n.data!==r.curData?{curData:n.data}:null}}])}(g.PureComponent);MK=Fs,zi(Fs,"displayName","Bar"),zi(Fs,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Ii.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"}),zi(Fs,"getComposedData",function(e){var t=e.props,n=e.item,r=e.barPosition,a=e.bandSize,o=e.xAxis,i=e.yAxis,s=e.xAxisTicks,c=e.yAxisTicks,l=e.stackedData,u=e.dataStartIndex,d=e.displayedData,p=e.offset,f=aMe(r,n);if(!f)return null;var m=t.layout,y=n.type.defaultProps,v=y!==void 0?cn(cn({},y),n.props):n.props,b=v.dataKey,w=v.children,j=v.minPointSize,x=m==="horizontal"?i:o,_=l?x.scale.domain():null,S=pMe({numericAxis:x}),E=Oa(w,WV),O=d.map(function(N,M){var k,P,A,C,I,T;l?k=oMe(l[u+M],_):(k=ro(N,b),Array.isArray(k)||(k=[S,k]));var R=h2e(j,MK.defaultProps.minPointSize)(k[1],M);if(m==="horizontal"){var L,D=[i.scale(k[0]),i.scale(k[1])],z=D[0],B=D[1];P=XW({axis:o,ticks:s,bandSize:a,offset:f.offset,entry:N,index:M}),A=(L=B??z)!==null&&L!==void 0?L:void 0,C=f.size;var $=z-B;if(I=Number.isNaN($)?0:$,T={x:P,y:i.y,width:C,height:i.height},Math.abs(R)>0&&Math.abs(I)<Math.abs(R)){var U=Ea(I||R)*(Math.abs(R)-Math.abs(I));A-=U,I+=U}}else{var F=[o.scale(k[0]),o.scale(k[1])],H=F[0],re=F[1];if(P=H,A=XW({axis:i,ticks:c,bandSize:a,offset:f.offset,entry:N,index:M}),C=re-H,I=f.size,T={x:o.x,y:A,width:o.width,height:I},Math.abs(R)>0&&Math.abs(C)<Math.abs(R)){var ee=Ea(C||R)*(Math.abs(R)-Math.abs(C));C+=ee}}return cn(cn(cn({},N),{},{x:P,y:A,width:C,height:I,value:l?k:k[1],payload:N,background:T},E&&E[M]&&E[M].props),{},{tooltipPayload:[tH(n,N)],tooltipPosition:{x:P+C/2,y:A+I/2}})});return cn({data:O,layout:m},p)});function sf(e){"@babel/helpers - typeof";return sf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sf(e)}function E2e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function IK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,DK(r.key),r)}}function O2e(e,t,n){return t&&IK(e.prototype,t),n&&IK(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function RK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Ma(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RK(Object(n),!0).forEach(function(r){tv(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function tv(e,t,n){return t=DK(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function DK(e){var t=C2e(e,"string");return sf(t)=="symbol"?t:t+""}function C2e(e,t){if(sf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(sf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var N2e=function(e,t,n,r,a){var o=e.width,i=e.height,s=e.layout,c=e.children,l=Object.keys(t),u={left:n.left,leftMirror:n.left,right:o-n.right,rightMirror:o-n.right,top:n.top,topMirror:n.top,bottom:i-n.bottom,bottomMirror:i-n.bottom},d=!!jr(c,Fs);return l.reduce(function(p,f){var m=t[f],y=m.orientation,v=m.domain,b=m.padding,w=b===void 0?{}:b,j=m.mirror,x=m.reversed,_="".concat(y).concat(j?"Mirror":""),S,E,O,N,M;if(m.type==="number"&&(m.padding==="gap"||m.padding==="no-gap")){var k=v[1]-v[0],P=1/0,A=m.categoricalDomain.sort();if(A.forEach(function(U,F){F>0&&(P=Math.min((U||0)-(A[F-1]||0),P))}),Number.isFinite(P)){var C=P/k,I=m.layout==="vertical"?n.height:n.width;if(m.padding==="gap"&&(S=C*I/2),m.padding==="no-gap"){var T=Ns(e.barCategoryGap,C*I),R=C*I/2;S=R-T-(R-T)/I*T}}}r==="xAxis"?E=[n.left+(w.left||0)+(S||0),n.left+n.width-(w.right||0)-(S||0)]:r==="yAxis"?E=s==="horizontal"?[n.top+n.height-(w.bottom||0),n.top+(w.top||0)]:[n.top+(w.top||0)+(S||0),n.top+n.height-(w.bottom||0)-(S||0)]:E=m.range,x&&(E=[E[1],E[0]]);var L=nMe(m,a,d),D=L.scale,z=L.realScaleType;D.domain(v).range(E),rMe(D);var B=dMe(D,Ma(Ma({},m),{},{realScaleType:z}));r==="xAxis"?(M=y==="top"&&!j||y==="bottom"&&j,O=n.left,N=u[_]-M*m.height):r==="yAxis"&&(M=y==="left"&&!j||y==="right"&&j,O=u[_]-M*m.width,N=n.top);var $=Ma(Ma(Ma({},m),B),{},{realScaleType:z,x:O,y:N,scale:D,width:r==="xAxis"?n.width:m.width,height:r==="yAxis"?n.height:m.height});return $.bandSize=Dg($,B),!m.hide&&r==="xAxis"?u[_]+=(M?-1:1)*$.height:m.hide||(u[_]+=(M?-1:1)*$.width),Ma(Ma({},p),{},tv({},f,$))},{})},LK=function(e,t){var n=e.x,r=e.y,a=t.x,o=t.y;return{x:Math.min(n,a),y:Math.min(r,o),width:Math.abs(a-n),height:Math.abs(o-r)}},M2e=function(e){var t=e.x1,n=e.y1,r=e.x2,a=e.y2;return LK({x:t,y:n},{x:r,y:a})},$K=function(){function e(t){E2e(this,e),this.scale=t}return O2e(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.bandAware,a=n.position;if(t!==void 0){if(a)switch(a){case"start":return this.scale(t);case"middle":{var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+o}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(t)+i}default:return this.scale(t)}if(r){var s=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+s}return this.scale(t)}}},{key:"isInRange",value:function(t){var n=this.range(),r=n[0],a=n[n.length-1];return r<=a?t>=r&&t<=a:t>=a&&t<=r}}],[{key:"create",value:function(t){return new e(t)}}])}();tv($K,"EPS",1e-4);var JN=function(e){var t=Object.keys(e).reduce(function(n,r){return Ma(Ma({},n),{},tv({},r,$K.create(e[r])))},{});return Ma(Ma({},t),{},{apply:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=r.bandAware,o=r.position;return n2e(n,function(i,s){return t[s].apply(i,{bandAware:a,position:o})})},isInRange:function(n){return OK(n,function(r,a){return t[a].isInRange(r)})}})};function k2e(e){return(e%180+180)%180}var P2e=function(e){var t=e.width,n=e.height,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=k2e(r),o=a*Math.PI/180,i=Math.atan(n/t),s=o>i&&o<Math.PI-i?n/Math.sin(o):t/Math.cos(o);return Math.abs(s)},YN,FK;function A2e(){if(FK)return YN;FK=1;var e=za(),t=Ki(),n=pu();function r(a){return function(o,i,s){var c=Object(o);if(!t(o)){var l=e(i,3);o=n(o),i=function(d){return l(c[d],d,c)}}var u=a(o,i,s);return u>-1?c[l?o[u]:u]:void 0}}return YN=r,YN}var QN,BK;function T2e(){if(BK)return QN;BK=1;var e=VU(),t=za(),n=pz(),r=Math.max;function a(o,i,s){var c=o==null?0:o.length;if(!c)return-1;var l=s==null?0:n(s);return l<0&&(l=r(c+l,0)),e(o,t(i,3),l)}return QN=a,QN}var eM,zK;function I2e(){if(zK)return eM;zK=1;var e=A2e(),t=T2e(),n=e(t);return eM=n,eM}var R2e=I2e();const D2e=st(R2e);var L2e=e3(),$2e=st(L2e)(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),tM=g.createContext(void 0),nM=g.createContext(void 0),UK=g.createContext(void 0),VK=g.createContext({}),qK=g.createContext(void 0),WK=g.createContext(0),HK=g.createContext(0),KK=function(e){var t=e.state,n=t.xAxisMap,r=t.yAxisMap,a=t.offset,o=e.clipPathId,i=e.children,s=e.width,c=e.height,l=$2e(a);return W.createElement(tM.Provider,{value:n},W.createElement(nM.Provider,{value:r},W.createElement(VK.Provider,{value:a},W.createElement(UK.Provider,{value:l},W.createElement(qK.Provider,{value:o},W.createElement(WK.Provider,{value:c},W.createElement(HK.Provider,{value:s},i)))))))},F2e=function(){return g.useContext(qK)},ZK=function(e){var t=g.useContext(tM);t==null&&Ds();var n=t[e];return n==null&&Ds(),n},B2e=function(){var e=g.useContext(tM);return Ti(e)},z2e=function(){var e=g.useContext(nM),t=D2e(e,function(n){return OK(n.domain,Number.isFinite)});return t||Ti(e)},GK=function(e){var t=g.useContext(nM);t==null&&Ds();var n=t[e];return n==null&&Ds(),n},U2e=function(){var e=g.useContext(UK);return e},V2e=function(){return g.useContext(VK)},rM=function(){return g.useContext(HK)},aM=function(){return g.useContext(WK)};function Ll(e){"@babel/helpers - typeof";return Ll=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ll(e)}function q2e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W2e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,QK(r.key),r)}}function H2e(e,t,n){return t&&W2e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function K2e(e,t,n){return t=nv(t),Z2e(e,XK()?Reflect.construct(t,n||[],nv(e).constructor):t.apply(e,n))}function Z2e(e,t){if(t&&(Ll(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return G2e(e)}function G2e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function XK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(XK=function(){return!!e})()}function nv(e){return nv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nv(e)}function X2e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oM(e,t)}function oM(e,t){return oM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},oM(e,t)}function JK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function YK(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JK(Object(n),!0).forEach(function(r){iM(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JK(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function iM(e,t,n){return t=QK(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QK(e){var t=J2e(e,"string");return Ll(t)=="symbol"?t:t+""}function J2e(e,t){if(Ll(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Ll(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Y2e(e,t){return nTe(e)||tTe(e,t)||eTe(e,t)||Q2e()}function Q2e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eTe(e,t){if(e){if(typeof e=="string")return eZ(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eZ(e,t)}}function eZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tTe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function nTe(e){if(Array.isArray(e))return e}function sM(){return sM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},sM.apply(this,arguments)}var rTe=function(e,t){var n;return W.isValidElement(e)?n=W.cloneElement(e,t):at(e)?n=e(t):n=W.createElement("line",sM({},t,{className:"recharts-reference-line-line"})),n},aTe=function(e,t,n,r,a,o,i,s,c){var l=a.x,u=a.y,d=a.width,p=a.height;if(n){var f=c.y,m=e.y.apply(f,{position:o});if(ao(c,"discard")&&!e.y.isInRange(m))return null;var y=[{x:l+d,y:m},{x:l,y:m}];return s==="left"?y.reverse():y}if(t){var v=c.x,b=e.x.apply(v,{position:o});if(ao(c,"discard")&&!e.x.isInRange(b))return null;var w=[{x:b,y:u+p},{x:b,y:u}];return i==="top"?w.reverse():w}if(r){var j=c.segment,x=j.map(function(_){return e.apply(_,{position:o})});return ao(c,"discard")&&QAe(x,function(_){return!e.isInRange(_)})?null:x}return null};function oTe(e){var t=e.x,n=e.y,r=e.segment,a=e.xAxisId,o=e.yAxisId,i=e.shape,s=e.className,c=e.alwaysShow,l=F2e(),u=ZK(a),d=GK(o),p=U2e();if(!l||!p)return null;Wo(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=JN({x:u.scale,y:d.scale}),m=hn(t),y=hn(n),v=r&&r.length===2,b=aTe(f,m,y,v,p,e.position,u.orientation,d.orientation,e);if(!b)return null;var w=Y2e(b,2),j=w[0],x=j.x,_=j.y,S=w[1],E=S.x,O=S.y,N=ao(e,"hidden")?"url(#".concat(l,")"):void 0,M=YK(YK({clipPath:N},bt(e,!0)),{},{x1:x,y1:_,x2:E,y2:O});return W.createElement(wn,{className:St("recharts-reference-line",s)},rTe(i,M),zn.renderCallByParent(e,M2e({x1:x,y1:_,x2:E,y2:O})))}var cM=function(e){function t(){return q2e(this,t),K2e(this,t,arguments)}return X2e(t,e),H2e(t,[{key:"render",value:function(){return W.createElement(oTe,this.props)}}])}(W.Component);iM(cM,"displayName","ReferenceLine"),iM(cM,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function lM(){return lM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lM.apply(this,arguments)}function $l(e){"@babel/helpers - typeof";return $l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$l(e)}function tZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function nZ(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tZ(Object(n),!0).forEach(function(r){av(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tZ(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function iTe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sTe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,aZ(r.key),r)}}function cTe(e,t,n){return t&&sTe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function lTe(e,t,n){return t=rv(t),uTe(e,rZ()?Reflect.construct(t,n||[],rv(e).constructor):t.apply(e,n))}function uTe(e,t){if(t&&($l(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dTe(e)}function dTe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rZ=function(){return!!e})()}function rv(e){return rv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rv(e)}function pTe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uM(e,t)}function uM(e,t){return uM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},uM(e,t)}function av(e,t,n){return t=aZ(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aZ(e){var t=fTe(e,"string");return $l(t)=="symbol"?t:t+""}function fTe(e,t){if($l(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if($l(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hTe=function(e){var t=e.x,n=e.y,r=e.xAxis,a=e.yAxis,o=JN({x:r.scale,y:a.scale}),i=o.apply({x:t,y:n},{bandAware:!0});return ao(e,"discard")&&!o.isInRange(i)?null:i},ov=function(e){function t(){return iTe(this,t),lTe(this,t,arguments)}return pTe(t,e),cTe(t,[{key:"render",value:function(){var n=this.props,r=n.x,a=n.y,o=n.r,i=n.alwaysShow,s=n.clipPathId,c=hn(r),l=hn(a);if(Wo(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!c||!l)return null;var u=hTe(this.props);if(!u)return null;var d=u.x,p=u.y,f=this.props,m=f.shape,y=f.className,v=ao(this.props,"hidden")?"url(#".concat(s,")"):void 0,b=nZ(nZ({clipPath:v},bt(this.props,!0)),{},{cx:d,cy:p});return W.createElement(wn,{className:St("recharts-reference-dot",y)},t.renderDot(m,b),zn.renderCallByParent(this.props,{x:d-o,y:p-o,width:2*o,height:2*o}))}}])}(W.Component);av(ov,"displayName","ReferenceDot"),av(ov,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1}),av(ov,"renderDot",function(e,t){var n;return W.isValidElement(e)?n=W.cloneElement(e,t):at(e)?n=e(t):n=W.createElement(QH,lM({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),n});function dM(){return dM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dM.apply(this,arguments)}function Fl(e){"@babel/helpers - typeof";return Fl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fl(e)}function oZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function iZ(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oZ(Object(n),!0).forEach(function(r){sv(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oZ(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function mTe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yTe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,cZ(r.key),r)}}function gTe(e,t,n){return t&&yTe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function vTe(e,t,n){return t=iv(t),bTe(e,sZ()?Reflect.construct(t,n||[],iv(e).constructor):t.apply(e,n))}function bTe(e,t){if(t&&(Fl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wTe(e)}function wTe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sZ=function(){return!!e})()}function iv(e){return iv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},iv(e)}function xTe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pM(e,t)}function pM(e,t){return pM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},pM(e,t)}function sv(e,t,n){return t=cZ(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cZ(e){var t=_Te(e,"string");return Fl(t)=="symbol"?t:t+""}function _Te(e,t){if(Fl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Fl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var jTe=function(e,t,n,r,a){var o=a.x1,i=a.x2,s=a.y1,c=a.y2,l=a.xAxis,u=a.yAxis;if(!l||!u)return null;var d=JN({x:l.scale,y:u.scale}),p={x:e?d.x.apply(o,{position:"start"}):d.x.rangeMin,y:n?d.y.apply(s,{position:"start"}):d.y.rangeMin},f={x:t?d.x.apply(i,{position:"end"}):d.x.rangeMax,y:r?d.y.apply(c,{position:"end"}):d.y.rangeMax};return ao(a,"discard")&&(!d.isInRange(p)||!d.isInRange(f))?null:LK(p,f)},cv=function(e){function t(){return mTe(this,t),vTe(this,t,arguments)}return xTe(t,e),gTe(t,[{key:"render",value:function(){var n=this.props,r=n.x1,a=n.x2,o=n.y1,i=n.y2,s=n.className,c=n.alwaysShow,l=n.clipPathId;Wo(c===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var u=hn(r),d=hn(a),p=hn(o),f=hn(i),m=this.props.shape;if(!u&&!d&&!p&&!f&&!m)return null;var y=jTe(u,d,p,f,this.props);if(!y&&!m)return null;var v=ao(this.props,"hidden")?"url(#".concat(l,")"):void 0;return W.createElement(wn,{className:St("recharts-reference-area",s)},t.renderRect(m,iZ(iZ({clipPath:v},bt(this.props,!0)),y)),zn.renderCallByParent(this.props,y))}}])}(W.Component);sv(cv,"displayName","ReferenceArea"),sv(cv,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1}),sv(cv,"renderRect",function(e,t){var n;return W.isValidElement(e)?n=W.cloneElement(e,t):at(e)?n=e(t):n=W.createElement(TN,dM({},t,{className:"recharts-reference-area-rect"})),n});function lZ(e,t,n){if(t<1)return[];if(t===1&&n===void 0)return e;for(var r=[],a=0;a<e.length;a+=t)r.push(e[a]);return r}function STe(e,t,n){var r={width:e.width+t.width,height:e.height+t.height};return P2e(r,n)}function ETe(e,t,n){var r=n==="width",a=e.x,o=e.y,i=e.width,s=e.height;return t===1?{start:r?a:o,end:r?a+i:o+s}:{start:r?a+i:o+s,end:r?a:o}}function lv(e,t,n,r,a){if(e*t<e*r||e*t>e*a)return!1;var o=n();return e*(t-e*o/2-r)>=0&&e*(t+e*o/2-a)<=0}function OTe(e,t){return lZ(e,t+1)}function CTe(e,t,n,r,a){for(var o=(r||[]).slice(),i=t.start,s=t.end,c=0,l=1,u=i,d=function(){var f=r==null?void 0:r[c];if(f===void 0)return{v:lZ(r,l)};var m=c,y,v=function(){return y===void 0&&(y=n(f,m)),y},b=f.coordinate,w=c===0||lv(e,b,v,u,s);w||(c=0,u=i,l+=1),w&&(u=b+e*(v()/2+a),c+=l)},p;l<=o.length;)if(p=d(),p)return p.v;return[]}function cf(e){"@babel/helpers - typeof";return cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cf(e)}function uZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Un(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uZ(Object(n),!0).forEach(function(r){NTe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uZ(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function NTe(e,t,n){return t=MTe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function MTe(e){var t=kTe(e,"string");return cf(t)=="symbol"?t:t+""}function kTe(e,t){if(cf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(cf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function PTe(e,t,n,r,a){for(var o=(r||[]).slice(),i=o.length,s=t.start,c=t.end,l=function(d){var p=o[d],f,m=function(){return f===void 0&&(f=n(p,d)),f};if(d===i-1){var y=e*(p.coordinate+e*m()/2-c);o[d]=p=Un(Un({},p),{},{tickCoord:y>0?p.coordinate-y*e:p.coordinate})}else o[d]=p=Un(Un({},p),{},{tickCoord:p.coordinate});var v=lv(e,p.tickCoord,m,s,c);v&&(c=p.tickCoord-e*(m()/2+a),o[d]=Un(Un({},p),{},{isShow:!0}))},u=i-1;u>=0;u--)l(u);return o}function ATe(e,t,n,r,a,o){var i=(r||[]).slice(),s=i.length,c=t.start,l=t.end;if(o){var u=r[s-1],d=n(u,s-1),p=e*(u.coordinate+e*d/2-l);i[s-1]=u=Un(Un({},u),{},{tickCoord:p>0?u.coordinate-p*e:u.coordinate});var f=lv(e,u.tickCoord,function(){return d},c,l);f&&(l=u.tickCoord-e*(d/2+a),i[s-1]=Un(Un({},u),{},{isShow:!0}))}for(var m=o?s-1:s,y=function(b){var w=i[b],j,x=function(){return j===void 0&&(j=n(w,b)),j};if(b===0){var _=e*(w.coordinate-e*x()/2-c);i[b]=w=Un(Un({},w),{},{tickCoord:_<0?w.coordinate-_*e:w.coordinate})}else i[b]=w=Un(Un({},w),{},{tickCoord:w.coordinate});var S=lv(e,w.tickCoord,x,c,l);S&&(c=w.tickCoord+e*(x()/2+a),i[b]=Un(Un({},w),{},{isShow:!0}))},v=0;v<m;v++)y(v);return i}function fM(e,t,n){var r=e.tick,a=e.ticks,o=e.viewBox,i=e.minTickGap,s=e.orientation,c=e.interval,l=e.tickFormatter,u=e.unit,d=e.angle;if(!a||!a.length||!r)return[];if(ye(c)||Ii.isSsr)return OTe(a,typeof c=="number"&&ye(c)?c:0);var p=[],f=s==="top"||s==="bottom"?"width":"height",m=u&&f==="width"?jp(u,{fontSize:t,letterSpacing:n}):{width:0,height:0},y=function(w,j){var x=at(l)?l(w.value,j):w.value;return f==="width"?STe(jp(x,{fontSize:t,letterSpacing:n}),m,d):jp(x,{fontSize:t,letterSpacing:n})[f]},v=a.length>=2?Ea(a[1].coordinate-a[0].coordinate):1,b=ETe(o,v,f);return c==="equidistantPreserveStart"?CTe(v,b,y,a,i):(c==="preserveStart"||c==="preserveStartEnd"?p=ATe(v,b,y,a,i,c==="preserveStartEnd"):p=PTe(v,b,y,a,i),p.filter(function(w){return w.isShow}))}var TTe=["viewBox"],ITe=["viewBox"],RTe=["ticks"];function Bl(e){"@babel/helpers - typeof";return Bl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bl(e)}function zl(){return zl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zl.apply(this,arguments)}function dZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Jn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dZ(Object(n),!0).forEach(function(r){yM(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dZ(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function hM(e,t){if(e==null)return{};var n=DTe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function DTe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function LTe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pZ(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,hZ(r.key),r)}}function $Te(e,t,n){return t&&pZ(e.prototype,t),n&&pZ(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function FTe(e,t,n){return t=uv(t),BTe(e,fZ()?Reflect.construct(t,n||[],uv(e).constructor):t.apply(e,n))}function BTe(e,t){if(t&&(Bl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zTe(e)}function zTe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fZ=function(){return!!e})()}function uv(e){return uv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uv(e)}function UTe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mM(e,t)}function mM(e,t){return mM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},mM(e,t)}function yM(e,t,n){return t=hZ(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hZ(e){var t=VTe(e,"string");return Bl(t)=="symbol"?t:t+""}function VTe(e,t){if(Bl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Bl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ul=function(e){function t(n){var r;return LTe(this,t),r=FTe(this,t,[n]),r.state={fontSize:"",letterSpacing:""},r}return UTe(t,e),$Te(t,[{key:"shouldComponentUpdate",value:function(n,r){var a=n.viewBox,o=hM(n,TTe),i=this.props,s=i.viewBox,c=hM(i,ITe);return!ml(a,s)||!ml(o,c)||!ml(r,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var r=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];r&&this.setState({fontSize:window.getComputedStyle(r).fontSize,letterSpacing:window.getComputedStyle(r).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var r=this.props,a=r.x,o=r.y,i=r.width,s=r.height,c=r.orientation,l=r.tickSize,u=r.mirror,d=r.tickMargin,p,f,m,y,v,b,w=u?-1:1,j=n.tickSize||l,x=ye(n.tickCoord)?n.tickCoord:n.coordinate;switch(c){case"top":p=f=n.coordinate,y=o+ +!u*s,m=y-w*j,b=m-w*d,v=x;break;case"left":m=y=n.coordinate,f=a+ +!u*i,p=f-w*j,v=p-w*d,b=x;break;case"right":m=y=n.coordinate,f=a+ +u*i,p=f+w*j,v=p+w*d,b=x;break;default:p=f=n.coordinate,y=o+ +u*s,m=y+w*j,b=m+w*d,v=x;break}return{line:{x1:p,y1:m,x2:f,y2:y},tick:{x:v,y:b}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,r=n.orientation,a=n.mirror,o;switch(r){case"left":o=a?"start":"end";break;case"right":o=a?"end":"start";break;default:o="middle";break}return o}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,r=n.orientation,a=n.mirror,o="end";switch(r){case"left":case"right":o="middle";break;case"top":o=a?"start":"end";break;default:o=a?"end":"start";break}return o}},{key:"renderAxisLine",value:function(){var n=this.props,r=n.x,a=n.y,o=n.width,i=n.height,s=n.orientation,c=n.mirror,l=n.axisLine,u=Jn(Jn(Jn({},bt(this.props,!1)),bt(l,!1)),{},{fill:"none"});if(s==="top"||s==="bottom"){var d=+(s==="top"&&!c||s==="bottom"&&c);u=Jn(Jn({},u),{},{x1:r,y1:a+d*i,x2:r+o,y2:a+d*i})}else{var p=+(s==="left"&&!c||s==="right"&&c);u=Jn(Jn({},u),{},{x1:r+p*o,y1:a,x2:r+p*o,y2:a+i})}return W.createElement("line",zl({},u,{className:St("recharts-cartesian-axis-line",Tr(l,"className"))}))}},{key:"renderTicks",value:function(n,r,a){var o=this,i=this.props,s=i.tickLine,c=i.stroke,l=i.tick,u=i.tickFormatter,d=i.unit,p=fM(Jn(Jn({},this.props),{},{ticks:n}),r,a),f=this.getTickTextAnchor(),m=this.getTickVerticalAnchor(),y=bt(this.props,!1),v=bt(l,!1),b=Jn(Jn({},y),{},{fill:"none"},bt(s,!1)),w=p.map(function(j,x){var _=o.getTickLineCoord(j),S=_.line,E=_.tick,O=Jn(Jn(Jn(Jn({textAnchor:f,verticalAnchor:m},y),{},{stroke:"none",fill:c},v),E),{},{index:x,payload:j,visibleTicksCount:p.length,tickFormatter:u});return W.createElement(wn,zl({className:"recharts-cartesian-axis-tick",key:"tick-".concat(j.value,"-").concat(j.coordinate,"-").concat(j.tickCoord)},Wy(o.props,j,x)),s&&W.createElement("line",zl({},b,S,{className:St("recharts-cartesian-axis-tick-line",Tr(s,"className"))})),l&&t.renderTickItem(l,O,"".concat(at(u)?u(j.value,x):j.value).concat(d||"")))});return W.createElement("g",{className:"recharts-cartesian-axis-ticks"},w)}},{key:"render",value:function(){var n=this,r=this.props,a=r.axisLine,o=r.width,i=r.height,s=r.ticksGenerator,c=r.className,l=r.hide;if(l)return null;var u=this.props,d=u.ticks,p=hM(u,RTe),f=d;return at(s)&&(f=d&&d.length>0?s(this.props):s(p)),o<=0||i<=0||!f||!f.length?null:W.createElement(wn,{className:St("recharts-cartesian-axis",c),ref:function(m){n.layerReference=m}},a&&this.renderAxisLine(),this.renderTicks(f,this.state.fontSize,this.state.letterSpacing),zn.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,r,a){var o;return W.isValidElement(n)?o=W.cloneElement(n,r):at(n)?o=n(r):o=W.createElement(dg,zl({},r,{className:"recharts-cartesian-axis-tick-value"}),a),o}}])}(g.Component);yM(Ul,"displayName","CartesianAxis"),yM(Ul,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var qTe=["x1","y1","x2","y2","key"],WTe=["offset"];function Bs(e){"@babel/helpers - typeof";return Bs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bs(e)}function mZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Vn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mZ(Object(n),!0).forEach(function(r){HTe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mZ(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function HTe(e,t,n){return t=KTe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KTe(e){var t=ZTe(e,"string");return Bs(t)=="symbol"?t:t+""}function ZTe(e,t){if(Bs(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Bs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function zs(){return zs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},zs.apply(this,arguments)}function yZ(e,t){if(e==null)return{};var n=GTe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function GTe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}var XTe=function(e){var t=e.fill;if(!t||t==="none")return null;var n=e.fillOpacity,r=e.x,a=e.y,o=e.width,i=e.height,s=e.ry;return W.createElement("rect",{x:r,y:a,ry:s,width:o,height:i,stroke:"none",fill:t,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function gZ(e,t){var n;if(W.isValidElement(e))n=W.cloneElement(e,t);else if(at(e))n=e(t);else{var r=t.x1,a=t.y1,o=t.x2,i=t.y2,s=t.key,c=yZ(t,qTe),l=bt(c,!1);l.offset;var u=yZ(l,WTe);n=W.createElement("line",zs({},u,{x1:r,y1:a,x2:o,y2:i,fill:"none",key:s}))}return n}function JTe(e){var t=e.x,n=e.width,r=e.horizontal,a=r===void 0?!0:r,o=e.horizontalPoints;if(!a||!o||!o.length)return null;var i=o.map(function(s,c){var l=Vn(Vn({},e),{},{x1:t,y1:s,x2:t+n,y2:s,key:"line-".concat(c),index:c});return gZ(a,l)});return W.createElement("g",{className:"recharts-cartesian-grid-horizontal"},i)}function YTe(e){var t=e.y,n=e.height,r=e.vertical,a=r===void 0?!0:r,o=e.verticalPoints;if(!a||!o||!o.length)return null;var i=o.map(function(s,c){var l=Vn(Vn({},e),{},{x1:s,y1:t,x2:s,y2:t+n,key:"line-".concat(c),index:c});return gZ(a,l)});return W.createElement("g",{className:"recharts-cartesian-grid-vertical"},i)}function QTe(e){var t=e.horizontalFill,n=e.fillOpacity,r=e.x,a=e.y,o=e.width,i=e.height,s=e.horizontalPoints,c=e.horizontal,l=c===void 0?!0:c;if(!l||!t||!t.length)return null;var u=s.map(function(p){return Math.round(p+a-a)}).sort(function(p,f){return p-f});a!==u[0]&&u.unshift(0);var d=u.map(function(p,f){var m=!u[f+1],y=m?a+i-p:u[f+1]-p;if(y<=0)return null;var v=f%t.length;return W.createElement("rect",{key:"react-".concat(f),y:p,x:r,height:y,width:o,stroke:"none",fill:t[v],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return W.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},d)}function eIe(e){var t=e.vertical,n=t===void 0?!0:t,r=e.verticalFill,a=e.fillOpacity,o=e.x,i=e.y,s=e.width,c=e.height,l=e.verticalPoints;if(!n||!r||!r.length)return null;var u=l.map(function(p){return Math.round(p+o-o)}).sort(function(p,f){return p-f});o!==u[0]&&u.unshift(0);var d=u.map(function(p,f){var m=!u[f+1],y=m?o+s-p:u[f+1]-p;if(y<=0)return null;var v=f%r.length;return W.createElement("rect",{key:"react-".concat(f),x:p,y:i,width:y,height:c,stroke:"none",fill:r[v],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return W.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},d)}var tIe=function(e,t){var n=e.xAxis,r=e.width,a=e.height,o=e.offset;return ZW(fM(Vn(Vn(Vn({},Ul.defaultProps),n),{},{ticks:ei(n,!0),viewBox:{x:0,y:0,width:r,height:a}})),o.left,o.left+o.width,t)},nIe=function(e,t){var n=e.yAxis,r=e.width,a=e.height,o=e.offset;return ZW(fM(Vn(Vn(Vn({},Ul.defaultProps),n),{},{ticks:ei(n,!0),viewBox:{x:0,y:0,width:r,height:a}})),o.top,o.top+o.height,t)},Vl={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function vZ(e){var t,n,r,a,o,i,s=rM(),c=aM(),l=V2e(),u=Vn(Vn({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Vl.stroke,fill:(n=e.fill)!==null&&n!==void 0?n:Vl.fill,horizontal:(r=e.horizontal)!==null&&r!==void 0?r:Vl.horizontal,horizontalFill:(a=e.horizontalFill)!==null&&a!==void 0?a:Vl.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:Vl.vertical,verticalFill:(i=e.verticalFill)!==null&&i!==void 0?i:Vl.verticalFill,x:ye(e.x)?e.x:l.left,y:ye(e.y)?e.y:l.top,width:ye(e.width)?e.width:l.width,height:ye(e.height)?e.height:l.height}),d=u.x,p=u.y,f=u.width,m=u.height,y=u.syncWithTicks,v=u.horizontalValues,b=u.verticalValues,w=B2e(),j=z2e();if(!ye(f)||f<=0||!ye(m)||m<=0||!ye(d)||d!==+d||!ye(p)||p!==+p)return null;var x=u.verticalCoordinatesGenerator||tIe,_=u.horizontalCoordinatesGenerator||nIe,S=u.horizontalPoints,E=u.verticalPoints;if((!S||!S.length)&&at(_)){var O=v&&v.length,N=_({yAxis:j?Vn(Vn({},j),{},{ticks:O?v:j.ticks}):void 0,width:s,height:c,offset:l},O?!0:y);Wo(Array.isArray(N),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Bs(N),"]")),Array.isArray(N)&&(S=N)}if((!E||!E.length)&&at(x)){var M=b&&b.length,k=x({xAxis:w?Vn(Vn({},w),{},{ticks:M?b:w.ticks}):void 0,width:s,height:c,offset:l},M?!0:y);Wo(Array.isArray(k),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Bs(k),"]")),Array.isArray(k)&&(E=k)}return W.createElement("g",{className:"recharts-cartesian-grid"},W.createElement(XTe,{fill:u.fill,fillOpacity:u.fillOpacity,x:u.x,y:u.y,width:u.width,height:u.height,ry:u.ry}),W.createElement(JTe,zs({},u,{offset:l,horizontalPoints:S,xAxis:w,yAxis:j})),W.createElement(YTe,zs({},u,{offset:l,verticalPoints:E,xAxis:w,yAxis:j})),W.createElement(QTe,zs({},u,{horizontalPoints:S})),W.createElement(eIe,zs({},u,{verticalPoints:E})))}vZ.displayName="CartesianGrid";function ql(e){"@babel/helpers - typeof";return ql=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ql(e)}function rIe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function aIe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,xZ(r.key),r)}}function oIe(e,t,n){return t&&aIe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function iIe(e,t,n){return t=dv(t),sIe(e,bZ()?Reflect.construct(t,n||[],dv(e).constructor):t.apply(e,n))}function sIe(e,t){if(t&&(ql(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cIe(e)}function cIe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bZ=function(){return!!e})()}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dv(e)}function lIe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&gM(e,t)}function gM(e,t){return gM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},gM(e,t)}function wZ(e,t,n){return t=xZ(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xZ(e){var t=uIe(e,"string");return ql(t)=="symbol"?t:t+""}function uIe(e,t){if(ql(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(ql(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vM(){return vM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vM.apply(this,arguments)}function dIe(e){var t=e.xAxisId,n=rM(),r=aM(),a=ZK(t);return a==null?null:W.createElement(Ul,vM({},a,{className:St("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:n,height:r},ticksGenerator:function(o){return ei(o,!0)}}))}var pv=function(e){function t(){return rIe(this,t),iIe(this,t,arguments)}return lIe(t,e),oIe(t,[{key:"render",value:function(){return W.createElement(dIe,this.props)}}])}(W.Component);wZ(pv,"displayName","XAxis"),wZ(pv,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Wl(e){"@babel/helpers - typeof";return Wl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wl(e)}function pIe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fIe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,SZ(r.key),r)}}function hIe(e,t,n){return t&&fIe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function mIe(e,t,n){return t=fv(t),yIe(e,_Z()?Reflect.construct(t,n||[],fv(e).constructor):t.apply(e,n))}function yIe(e,t){if(t&&(Wl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gIe(e)}function gIe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _Z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_Z=function(){return!!e})()}function fv(e){return fv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fv(e)}function vIe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bM(e,t)}function bM(e,t){return bM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},bM(e,t)}function jZ(e,t,n){return t=SZ(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SZ(e){var t=bIe(e,"string");return Wl(t)=="symbol"?t:t+""}function bIe(e,t){if(Wl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Wl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wM(){return wM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wM.apply(this,arguments)}var wIe=function(e){var t=e.yAxisId,n=rM(),r=aM(),a=GK(t);return a==null?null:W.createElement(Ul,wM({},a,{className:St("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:n,height:r},ticksGenerator:function(o){return ei(o,!0)}}))},xM=function(e){function t(){return pIe(this,t),mIe(this,t,arguments)}return vIe(t,e),hIe(t,[{key:"render",value:function(){return W.createElement(wIe,this.props)}}])}(W.Component);jZ(xM,"displayName","YAxis"),jZ(xM,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function EZ(e){return SIe(e)||jIe(e)||_Ie(e)||xIe()}function xIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Ie(e,t){if(e){if(typeof e=="string")return _M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _M(e,t)}}function jIe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function SIe(e){if(Array.isArray(e))return _M(e)}function _M(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var jM=function(e,t,n,r,a){var o=Oa(e,cM),i=Oa(e,ov),s=[].concat(EZ(o),EZ(i)),c=Oa(e,cv),l="".concat(r,"Id"),u=r[0],d=t;if(s.length&&(d=s.reduce(function(m,y){if(y.props[l]===n&&ao(y.props,"extendDomain")&&ye(y.props[u])){var v=y.props[u];return[Math.min(m[0],v),Math.max(m[1],v)]}return m},d)),c.length){var p="".concat(u,"1"),f="".concat(u,"2");d=c.reduce(function(m,y){if(y.props[l]===n&&ao(y.props,"extendDomain")&&ye(y.props[p])&&ye(y.props[f])){var v=y.props[p],b=y.props[f];return[Math.min(m[0],v,b),Math.max(m[1],v,b)]}return m},d)}return a&&a.length&&(d=a.reduce(function(m,y){return ye(y)?[Math.min(m[0],y),Math.max(m[1],y)]:m},d)),d},OZ={exports:{}},CZ;function EIe(){return CZ||(CZ=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function a(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,d,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new a(u,d||c,p),m=n?n+l:l;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],f]:c._events[m].push(f):(c._events[m]=f,c._eventsCount++),c}function i(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function s(){this._events=new r,this._eventsCount=0}s.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)t.call(l,u)&&c.push(n?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},s.prototype.listeners=function(c){var l=n?n+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,p=u.length,f=new Array(p);d<p;d++)f[d]=u[d].fn;return f},s.prototype.listenerCount=function(c){var l=n?n+c:c,u=this._events[l];return u?u.fn?1:u.length:0},s.prototype.emit=function(c,l,u,d,p,f){var m=n?n+c:c;if(!this._events[m])return!1;var y=this._events[m],v=arguments.length,b,w;if(y.fn){switch(y.once&&this.removeListener(c,y.fn,void 0,!0),v){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,u),!0;case 4:return y.fn.call(y.context,l,u,d),!0;case 5:return y.fn.call(y.context,l,u,d,p),!0;case 6:return y.fn.call(y.context,l,u,d,p,f),!0}for(w=1,b=new Array(v-1);w<v;w++)b[w-1]=arguments[w];y.fn.apply(y.context,b)}else{var j=y.length,x;for(w=0;w<j;w++)switch(y[w].once&&this.removeListener(c,y[w].fn,void 0,!0),v){case 1:y[w].fn.call(y[w].context);break;case 2:y[w].fn.call(y[w].context,l);break;case 3:y[w].fn.call(y[w].context,l,u);break;case 4:y[w].fn.call(y[w].context,l,u,d);break;default:if(!b)for(x=1,b=new Array(v-1);x<v;x++)b[x-1]=arguments[x];y[w].fn.apply(y[w].context,b)}}return!0},s.prototype.on=function(c,l,u){return o(this,c,l,u,!1)},s.prototype.once=function(c,l,u){return o(this,c,l,u,!0)},s.prototype.removeListener=function(c,l,u,d){var p=n?n+c:c;if(!this._events[p])return this;if(!l)return i(this,p),this;var f=this._events[p];if(f.fn)f.fn===l&&(!d||f.once)&&(!u||f.context===u)&&i(this,p);else{for(var m=0,y=[],v=f.length;m<v;m++)(f[m].fn!==l||d&&!f[m].once||u&&f[m].context!==u)&&y.push(f[m]);y.length?this._events[p]=y.length===1?y[0]:y:i(this,p)}return this},s.prototype.removeAllListeners=function(c){var l;return c?(l=n?n+c:c,this._events[l]&&i(this,l)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(OZ)),OZ.exports}var OIe=EIe();const CIe=st(OIe);var SM=new CIe,EM="recharts.syncMouseEvents";function lf(e){"@babel/helpers - typeof";return lf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lf(e)}function NIe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function MIe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,NZ(r.key),r)}}function kIe(e,t,n){return t&&MIe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function OM(e,t,n){return t=NZ(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NZ(e){var t=PIe(e,"string");return lf(t)=="symbol"?t:t+""}function PIe(e,t){if(lf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(lf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var AIe=function(){function e(){NIe(this,e),OM(this,"activeIndex",0),OM(this,"coordinateList",[]),OM(this,"layout","horizontal")}return kIe(e,[{key:"setDetails",value:function(t){var n,r=t.coordinateList,a=r===void 0?null:r,o=t.container,i=o===void 0?null:o,s=t.layout,c=s===void 0?null:s,l=t.offset,u=l===void 0?null:l,d=t.mouseHandlerCallback,p=d===void 0?null:d;this.coordinateList=(n=a??this.coordinateList)!==null&&n!==void 0?n:[],this.container=i??this.container,this.layout=c??this.layout,this.offset=u??this.offset,this.mouseHandlerCallback=p??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(t){if(this.coordinateList.length!==0)switch(t.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(t){this.activeIndex=t}},{key:"spoofMouse",value:function(){var t,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var r=this.container.getBoundingClientRect(),a=r.x,o=r.y,i=r.height,s=this.coordinateList[this.activeIndex].coordinate,c=((t=window)===null||t===void 0?void 0:t.scrollX)||0,l=((n=window)===null||n===void 0?void 0:n.scrollY)||0,u=a+s+c,d=o+this.offset.top+i/2+l;this.mouseHandlerCallback({pageX:u,pageY:d})}}}])}();function TIe(e,t,n){if(n==="number"&&t===!0&&Array.isArray(e)){var r=e==null?void 0:e[0],a=e==null?void 0:e[1];if(r&&a&&ye(r)&&ye(a))return!0}return!1}function IIe(e,t,n,r){var a=r/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:n.left+.5,y:e==="horizontal"?n.top+.5:t.y-a,width:e==="horizontal"?r:n.width-1,height:e==="horizontal"?n.height-1:r}}function MZ(e){var t=e.cx,n=e.cy,r=e.radius,a=e.startAngle,o=e.endAngle,i=Pn(t,n,r,a),s=Pn(t,n,r,o);return{points:[i,s],cx:t,cy:n,radius:r,startAngle:a,endAngle:o}}function RIe(e,t,n){var r,a,o,i;if(e==="horizontal")r=t.x,o=r,a=n.top,i=n.top+n.height;else if(e==="vertical")a=t.y,i=a,r=n.left,o=n.left+n.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var s=t.cx,c=t.cy,l=t.innerRadius,u=t.outerRadius,d=t.angle,p=Pn(s,c,l,d),f=Pn(s,c,u,d);r=p.x,a=p.y,o=f.x,i=f.y}else return MZ(t);return[{x:r,y:a},{x:o,y:i}]}function uf(e){"@babel/helpers - typeof";return uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uf(e)}function kZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function hv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kZ(Object(n),!0).forEach(function(r){DIe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kZ(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function DIe(e,t,n){return t=LIe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LIe(e){var t=$Ie(e,"string");return uf(t)=="symbol"?t:t+""}function $Ie(e,t){if(uf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(uf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function FIe(e){var t,n,r=e.element,a=e.tooltipEventType,o=e.isActive,i=e.activeCoordinate,s=e.activePayload,c=e.offset,l=e.activeTooltipIndex,u=e.tooltipAxisBandSize,d=e.layout,p=e.chartName,f=(t=r.props.cursor)!==null&&t!==void 0?t:(n=r.type.defaultProps)===null||n===void 0?void 0:n.cursor;if(!r||!f||!o||!i||p!=="ScatterChart"&&a!=="axis")return null;var m,y=vH;if(p==="ScatterChart")m=i,y=tAe;else if(p==="BarChart")m=IIe(d,i,c,u),y=TN;else if(d==="radial"){var v=MZ(i),b=v.cx,w=v.cy,j=v.radius,x=v.startAngle,_=v.endAngle;m={cx:b,cy:w,startAngle:x,endAngle:_,innerRadius:j,outerRadius:j},y=hH}else m={points:RIe(d,i,c)},y=vH;var S=hv(hv(hv(hv({stroke:"#ccc",pointerEvents:"none"},c),m),bt(f,!1)),{},{payload:s,payloadIndex:l,className:St("recharts-tooltip-cursor",f.className)});return g.isValidElement(f)?g.cloneElement(f,S):g.createElement(y,S)}var BIe=["item"],zIe=["children","className","width","height","style","compact","title","desc"];function Hl(e){"@babel/helpers - typeof";return Hl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hl(e)}function Kl(){return Kl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Kl.apply(this,arguments)}function PZ(e,t){return qIe(e)||VIe(e,t)||IZ(e,t)||UIe()}function UIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VIe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,t!==0)for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function qIe(e){if(Array.isArray(e))return e}function AZ(e,t){if(e==null)return{};var n=WIe(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function WIe(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function HIe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KIe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,DZ(r.key),r)}}function ZIe(e,t,n){return t&&KIe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function GIe(e,t,n){return t=mv(t),XIe(e,TZ()?Reflect.construct(t,n||[],mv(e).constructor):t.apply(e,n))}function XIe(e,t){if(t&&(Hl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JIe(e)}function JIe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function TZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(TZ=function(){return!!e})()}function mv(e){return mv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mv(e)}function YIe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CM(e,t)}function CM(e,t){return CM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},CM(e,t)}function Zl(e){return tRe(e)||eRe(e)||IZ(e)||QIe()}function QIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IZ(e,t){if(e){if(typeof e=="string")return NM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return NM(e,t)}}function eRe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function tRe(e){if(Array.isArray(e))return NM(e)}function NM(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function RZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RZ(Object(n),!0).forEach(function(r){Fe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RZ(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Fe(e,t,n){return t=DZ(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function DZ(e){var t=nRe(e,"string");return Hl(t)=="symbol"?t:t+""}function nRe(e,t){if(Hl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(Hl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var rRe={xAxis:["bottom","top"],yAxis:["left","right"]},aRe={width:"100%",height:"100%"},LZ={x:0,y:0};function yv(e){return e}var oRe=function(e,t){return t==="horizontal"?e.x:t==="vertical"?e.y:t==="centric"?e.angle:e.radius},iRe=function(e,t,n,r){var a=t.find(function(l){return l&&l.index===n});if(a){if(e==="horizontal")return{x:a.coordinate,y:r.y};if(e==="vertical")return{x:r.x,y:a.coordinate};if(e==="centric"){var o=a.coordinate,i=r.radius;return se(se(se({},r),Pn(r.cx,r.cy,i,o)),{},{angle:o,radius:i})}var s=a.coordinate,c=r.angle;return se(se(se({},r),Pn(r.cx,r.cy,s,c)),{},{angle:c,radius:s})}return LZ},gv=function(e,t){var n=t.graphicalItems,r=t.dataStartIndex,a=t.dataEndIndex,o=(n??[]).reduce(function(i,s){var c=s.props.data;return c&&c.length?[].concat(Zl(i),Zl(c)):i},[]);return o.length>0?o:e&&e.length&&ye(r)&&ye(a)?e.slice(r,a+1):[]};function $Z(e){return e==="number"?[0,"auto"]:void 0}var MM=function(e,t,n,r){var a=e.graphicalItems,o=e.tooltipAxis,i=gv(t,e);return n<0||!a||!a.length||n>=i.length?null:a.reduce(function(s,c){var l,u=(l=c.props.data)!==null&&l!==void 0?l:t;u&&e.dataStartIndex+e.dataEndIndex!==0&&e.dataEndIndex-e.dataStartIndex>=n&&(u=u.slice(e.dataStartIndex,e.dataEndIndex+1));var d;if(o.dataKey&&!o.allowDuplicatedCategory){var p=u===void 0?i:u;d=JE(p,o.dataKey,r)}else d=u&&u[n]||i[n];return d?[].concat(Zl(s),[tH(c,d)]):s},[])},FZ=function(e,t,n,r){var a=r||{x:e.chartX,y:e.chartY},o=oRe(a,n),i=e.orderedTooltipTicks,s=e.tooltipAxis,c=e.tooltipTicks,l=XNe(o,i,c,s);if(l>=0&&c){var u=c[l]&&c[l].value,d=MM(e,t,l,u),p=iRe(n,i,l,a);return{activeTooltipIndex:l,activeLabel:u,activePayload:d,activeCoordinate:p}}return null},sRe=function(e,t){var n=t.axes,r=t.graphicalItems,a=t.axisType,o=t.axisIdKey,i=t.stackGroups,s=t.dataStartIndex,c=t.dataEndIndex,l=e.layout,u=e.children,d=e.stackOffset,p=KW(l,a);return n.reduce(function(f,m){var y,v=m.type.defaultProps!==void 0?se(se({},m.type.defaultProps),m.props):m.props,b=v.type,w=v.dataKey,j=v.allowDataOverflow,x=v.allowDuplicatedCategory,_=v.scale,S=v.ticks,E=v.includeHidden,O=v[o];if(f[O])return f;var N=gv(e.data,{graphicalItems:r.filter(function(B){var $,U=o in B.props?B.props[o]:($=B.type.defaultProps)===null||$===void 0?void 0:$[o];return U===O}),dataStartIndex:s,dataEndIndex:c}),M=N.length,k,P,A;TIe(v.domain,j,b)&&(k=mN(v.domain,null,j),p&&(b==="number"||_!=="auto")&&(A=Ig(N,w,"category")));var C=$Z(b);if(!k||k.length===0){var I,T=(I=v.domain)!==null&&I!==void 0?I:C;if(w){if(k=Ig(N,w,b),b==="category"&&p){var R=c_e(k);x&&R?(P=k,k=Xg(0,M)):x||(k=eH(T,k,m).reduce(function(B,$){return B.indexOf($)>=0?B:[].concat(Zl(B),[$])},[]))}else if(b==="category")x?k=k.filter(function(B){return B!==""&&!wt(B)}):k=eH(T,k,m).reduce(function(B,$){return B.indexOf($)>=0||$===""||wt($)?B:[].concat(Zl(B),[$])},[]);else if(b==="number"){var L=tMe(N,r.filter(function(B){var $,U,F=o in B.props?B.props[o]:($=B.type.defaultProps)===null||$===void 0?void 0:$[o],H="hide"in B.props?B.props.hide:(U=B.type.defaultProps)===null||U===void 0?void 0:U.hide;return F===O&&(E||!H)}),w,a,l);L&&(k=L)}p&&(b==="number"||_!=="auto")&&(A=Ig(N,w,"category"))}else p?k=Xg(0,M):i&&i[O]&&i[O].hasStack&&b==="number"?k=d==="expand"?[0,1]:JW(i[O].stackGroups,s,c):k=HW(N,r.filter(function(B){var $=o in B.props?B.props[o]:B.type.defaultProps[o],U="hide"in B.props?B.props.hide:B.type.defaultProps.hide;return $===O&&(E||!U)}),b,l,!0);if(b==="number")k=jM(u,k,O,a,S),T&&(k=mN(T,k,j));else if(b==="category"&&T){var D=T,z=k.every(function(B){return D.indexOf(B)>=0});z&&(k=D)}}return se(se({},f),{},Fe({},O,se(se({},v),{},{axisType:a,domain:k,categoricalDomain:A,duplicateDomain:P,originalDomain:(y=v.domain)!==null&&y!==void 0?y:C,isCategorical:p,layout:l})))},{})},cRe=function(e,t){var n=t.graphicalItems,r=t.Axis,a=t.axisType,o=t.axisIdKey,i=t.stackGroups,s=t.dataStartIndex,c=t.dataEndIndex,l=e.layout,u=e.children,d=gv(e.data,{graphicalItems:n,dataStartIndex:s,dataEndIndex:c}),p=d.length,f=KW(l,a),m=-1;return n.reduce(function(y,v){var b=v.type.defaultProps!==void 0?se(se({},v.type.defaultProps),v.props):v.props,w=b[o],j=$Z("number");if(!y[w]){m++;var x;return f?x=Xg(0,p):i&&i[w]&&i[w].hasStack?(x=JW(i[w].stackGroups,s,c),x=jM(u,x,w,a)):(x=mN(j,HW(d,n.filter(function(_){var S,E,O=o in _.props?_.props[o]:(S=_.type.defaultProps)===null||S===void 0?void 0:S[o],N="hide"in _.props?_.props.hide:(E=_.type.defaultProps)===null||E===void 0?void 0:E.hide;return O===w&&!N}),"number",l),r.defaultProps.allowDataOverflow),x=jM(u,x,w,a)),se(se({},y),{},Fe({},w,se(se({axisType:a},r.defaultProps),{},{hide:!0,orientation:Tr(rRe,"".concat(a,".").concat(m%2),null),domain:x,originalDomain:j,isCategorical:f,layout:l})))}return y},{})},lRe=function(e,t){var n=t.axisType,r=n===void 0?"xAxis":n,a=t.AxisComp,o=t.graphicalItems,i=t.stackGroups,s=t.dataStartIndex,c=t.dataEndIndex,l=e.children,u="".concat(r,"Id"),d=Oa(l,a),p={};return d&&d.length?p=sRe(e,{axes:d,graphicalItems:o,axisType:r,axisIdKey:u,stackGroups:i,dataStartIndex:s,dataEndIndex:c}):o&&o.length&&(p=cRe(e,{Axis:a,graphicalItems:o,axisType:r,axisIdKey:u,stackGroups:i,dataStartIndex:s,dataEndIndex:c})),p},uRe=function(e){var t=Ti(e),n=ei(t,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:iC(n,function(r){return r.coordinate}),tooltipAxis:t,tooltipAxisBandSize:Dg(t,n)}},BZ=function(e){var t=e.children,n=e.defaultShowTooltip,r=jr(t,Rl),a=0,o=0;return e.data&&e.data.length!==0&&(o=e.data.length-1),r&&r.props&&(r.props.startIndex>=0&&(a=r.props.startIndex),r.props.endIndex>=0&&(o=r.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:a,dataEndIndex:o,activeTooltipIndex:-1,isTooltipActive:!!n}},dRe=function(e){return!e||!e.length?!1:e.some(function(t){var n=qo(t&&t.type);return n&&n.indexOf("Bar")>=0})},zZ=function(e){return e==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:e==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:e==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},pRe=function(e,t){var n=e.props,r=e.graphicalItems,a=e.xAxisMap,o=a===void 0?{}:a,i=e.yAxisMap,s=i===void 0?{}:i,c=n.width,l=n.height,u=n.children,d=n.margin||{},p=jr(u,Rl),f=jr(u,bl),m=Object.keys(s).reduce(function(x,_){var S=s[_],E=S.orientation;return!S.mirror&&!S.hide?se(se({},x),{},Fe({},E,x[E]+S.width)):x},{left:d.left||0,right:d.right||0}),y=Object.keys(o).reduce(function(x,_){var S=o[_],E=S.orientation;return!S.mirror&&!S.hide?se(se({},x),{},Fe({},E,Tr(x,"".concat(E))+S.height)):x},{top:d.top||0,bottom:d.bottom||0}),v=se(se({},y),m),b=v.bottom;p&&(v.bottom+=p.props.height||Rl.defaultProps.height),f&&t&&(v=QNe(v,r,n,t));var w=c-v.left-v.right,j=l-v.top-v.bottom;return se(se({brushBottom:b},v),{},{width:Math.max(w,0),height:Math.max(j,0)})},fRe=function(e,t){if(t==="xAxis")return e[t].width;if(t==="yAxis")return e[t].height},hRe=function(e){var t=e.chartName,n=e.GraphicalChild,r=e.defaultTooltipEventType,a=r===void 0?"axis":r,o=e.validateTooltipEventTypes,i=o===void 0?["axis"]:o,s=e.axisComponents,c=e.legendContent,l=e.formatAxisMap,u=e.defaultProps,d=function(y,v){var b=v.graphicalItems,w=v.stackGroups,j=v.offset,x=v.updateId,_=v.dataStartIndex,S=v.dataEndIndex,E=y.barSize,O=y.layout,N=y.barGap,M=y.barCategoryGap,k=y.maxBarSize,P=zZ(O),A=P.numericAxisName,C=P.cateAxisName,I=dRe(b),T=[];return b.forEach(function(R,L){var D=gv(y.data,{graphicalItems:[R],dataStartIndex:_,dataEndIndex:S}),z=R.type.defaultProps!==void 0?se(se({},R.type.defaultProps),R.props):R.props,B=z.dataKey,$=z.maxBarSize,U=z["".concat(A,"Id")],F=z["".concat(C,"Id")],H={},re=s.reduce(function(Se,Ve){var He=v["".concat(Ve.axisType,"Map")],Ke=z["".concat(Ve.axisType,"Id")];He&&He[Ke]||Ve.axisType==="zAxis"||Ds();var It=He[Ke];return se(se({},Se),{},Fe(Fe({},Ve.axisType,It),"".concat(Ve.axisType,"Ticks"),ei(It)))},H),ee=re[C],G=re["".concat(C,"Ticks")],K=w&&w[U]&&w[U].hasStack&&fMe(R,w[U].stackGroups),X=qo(R.type).indexOf("Bar")>=0,ne=Dg(ee,G),V=[],le=I&&JNe({barSize:E,stackGroups:w,totalSize:fRe(re,C)});if(X){var ae,de,je=wt($)?k:$,Le=(ae=(de=Dg(ee,G,!0))!==null&&de!==void 0?de:je)!==null&&ae!==void 0?ae:0;V=YNe({barGap:N,barCategoryGap:M,bandSize:Le!==ne?Le:ne,sizeList:le[F],maxBarSize:je}),Le!==ne&&(V=V.map(function(Se){return se(se({},Se),{},{position:se(se({},Se.position),{},{offset:Se.position.offset-Le/2})})}))}var $e=R&&R.type&&R.type.getComposedData;$e&&T.push({props:se(se({},$e(se(se({},re),{},{displayedData:D,props:y,dataKey:B,item:R,bandSize:ne,barPosition:V,offset:j,stackedData:K,layout:O,dataStartIndex:_,dataEndIndex:S}))),{},Fe(Fe(Fe({key:R.key||"item-".concat(L)},A,re[A]),C,re[C]),"animationId",x)),childIndex:b_e(R,y.children),item:R})}),T},p=function(y,v){var b=y.props,w=y.dataStartIndex,j=y.dataEndIndex,x=y.updateId;if(!oU({props:b}))return null;var _=b.children,S=b.layout,E=b.stackOffset,O=b.data,N=b.reverseStackOrder,M=zZ(S),k=M.numericAxisName,P=M.cateAxisName,A=Oa(_,n),C=uMe(O,A,"".concat(k,"Id"),"".concat(P,"Id"),E,N),I=s.reduce(function(z,B){var $="".concat(B.axisType,"Map");return se(se({},z),{},Fe({},$,lRe(b,se(se({},B),{},{graphicalItems:A,stackGroups:B.axisType===k&&C,dataStartIndex:w,dataEndIndex:j}))))},{}),T=pRe(se(se({},I),{},{props:b,graphicalItems:A}),v==null?void 0:v.legendBBox);Object.keys(I).forEach(function(z){I[z]=l(b,I[z],T,z.replace("Map",""),t)});var R=I["".concat(P,"Map")],L=uRe(R),D=d(b,se(se({},I),{},{dataStartIndex:w,dataEndIndex:j,updateId:x,graphicalItems:A,stackGroups:C,offset:T}));return se(se({formattedGraphicalItems:D,graphicalItems:A,offset:T,stackGroups:C},L),I)},f=function(y){function v(b){var w,j,x;return HIe(this,v),x=GIe(this,v,[b]),Fe(x,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Fe(x,"accessibilityManager",new AIe),Fe(x,"handleLegendBBoxUpdate",function(_){if(_){var S=x.state,E=S.dataStartIndex,O=S.dataEndIndex,N=S.updateId;x.setState(se({legendBBox:_},p({props:x.props,dataStartIndex:E,dataEndIndex:O,updateId:N},se(se({},x.state),{},{legendBBox:_}))))}}),Fe(x,"handleReceiveSyncEvent",function(_,S,E){if(x.props.syncId===_){if(E===x.eventEmitterSymbol&&typeof x.props.syncMethod!="function")return;x.applySyncEvent(S)}}),Fe(x,"handleBrushChange",function(_){var S=_.startIndex,E=_.endIndex;if(S!==x.state.dataStartIndex||E!==x.state.dataEndIndex){var O=x.state.updateId;x.setState(function(){return se({dataStartIndex:S,dataEndIndex:E},p({props:x.props,dataStartIndex:S,dataEndIndex:E,updateId:O},x.state))}),x.triggerSyncEvent({dataStartIndex:S,dataEndIndex:E})}}),Fe(x,"handleMouseEnter",function(_){var S=x.getMouseInfo(_);if(S){var E=se(se({},S),{},{isTooltipActive:!0});x.setState(E),x.triggerSyncEvent(E);var O=x.props.onMouseEnter;at(O)&&O(E,_)}}),Fe(x,"triggeredAfterMouseMove",function(_){var S=x.getMouseInfo(_),E=S?se(se({},S),{},{isTooltipActive:!0}):{isTooltipActive:!1};x.setState(E),x.triggerSyncEvent(E);var O=x.props.onMouseMove;at(O)&&O(E,_)}),Fe(x,"handleItemMouseEnter",function(_){x.setState(function(){return{isTooltipActive:!0,activeItem:_,activePayload:_.tooltipPayload,activeCoordinate:_.tooltipPosition||{x:_.cx,y:_.cy}}})}),Fe(x,"handleItemMouseLeave",function(){x.setState(function(){return{isTooltipActive:!1}})}),Fe(x,"handleMouseMove",function(_){_.persist(),x.throttleTriggeredAfterMouseMove(_)}),Fe(x,"handleMouseLeave",function(_){x.throttleTriggeredAfterMouseMove.cancel();var S={isTooltipActive:!1};x.setState(S),x.triggerSyncEvent(S);var E=x.props.onMouseLeave;at(E)&&E(S,_)}),Fe(x,"handleOuterEvent",function(_){var S=v_e(_),E=Tr(x.props,"".concat(S));if(S&&at(E)){var O,N;/.*touch.*/i.test(S)?N=x.getMouseInfo(_.changedTouches[0]):N=x.getMouseInfo(_),E((O=N)!==null&&O!==void 0?O:{},_)}}),Fe(x,"handleClick",function(_){var S=x.getMouseInfo(_);if(S){var E=se(se({},S),{},{isTooltipActive:!0});x.setState(E),x.triggerSyncEvent(E);var O=x.props.onClick;at(O)&&O(E,_)}}),Fe(x,"handleMouseDown",function(_){var S=x.props.onMouseDown;if(at(S)){var E=x.getMouseInfo(_);S(E,_)}}),Fe(x,"handleMouseUp",function(_){var S=x.props.onMouseUp;if(at(S)){var E=x.getMouseInfo(_);S(E,_)}}),Fe(x,"handleTouchMove",function(_){_.changedTouches!=null&&_.changedTouches.length>0&&x.throttleTriggeredAfterMouseMove(_.changedTouches[0])}),Fe(x,"handleTouchStart",function(_){_.changedTouches!=null&&_.changedTouches.length>0&&x.handleMouseDown(_.changedTouches[0])}),Fe(x,"handleTouchEnd",function(_){_.changedTouches!=null&&_.changedTouches.length>0&&x.handleMouseUp(_.changedTouches[0])}),Fe(x,"triggerSyncEvent",function(_){x.props.syncId!==void 0&&SM.emit(EM,x.props.syncId,_,x.eventEmitterSymbol)}),Fe(x,"applySyncEvent",function(_){var S=x.props,E=S.layout,O=S.syncMethod,N=x.state.updateId,M=_.dataStartIndex,k=_.dataEndIndex;if(_.dataStartIndex!==void 0||_.dataEndIndex!==void 0)x.setState(se({dataStartIndex:M,dataEndIndex:k},p({props:x.props,dataStartIndex:M,dataEndIndex:k,updateId:N},x.state)));else if(_.activeTooltipIndex!==void 0){var P=_.chartX,A=_.chartY,C=_.activeTooltipIndex,I=x.state,T=I.offset,R=I.tooltipTicks;if(!T)return;if(typeof O=="function")C=O(R,_);else if(O==="value"){C=-1;for(var L=0;L<R.length;L++)if(R[L].value===_.activeLabel){C=L;break}}var D=se(se({},T),{},{x:T.left,y:T.top}),z=Math.min(P,D.x+D.width),B=Math.min(A,D.y+D.height),$=R[C]&&R[C].value,U=MM(x.state,x.props.data,C),F=R[C]?{x:E==="horizontal"?R[C].coordinate:z,y:E==="horizontal"?B:R[C].coordinate}:LZ;x.setState(se(se({},_),{},{activeLabel:$,activeCoordinate:F,activePayload:U,activeTooltipIndex:C}))}else x.setState(_)}),Fe(x,"renderCursor",function(_){var S,E=x.state,O=E.isTooltipActive,N=E.activeCoordinate,M=E.activePayload,k=E.offset,P=E.activeTooltipIndex,A=E.tooltipAxisBandSize,C=x.getTooltipEventType(),I=(S=_.props.active)!==null&&S!==void 0?S:O,T=x.props.layout,R=_.key||"_recharts-cursor";return W.createElement(FIe,{key:R,activeCoordinate:N,activePayload:M,activeTooltipIndex:P,chartName:t,element:_,isActive:I,layout:T,offset:k,tooltipAxisBandSize:A,tooltipEventType:C})}),Fe(x,"renderPolarAxis",function(_,S,E){var O=Tr(_,"type.axisType"),N=Tr(x.state,"".concat(O,"Map")),M=_.type.defaultProps,k=M!==void 0?se(se({},M),_.props):_.props,P=N&&N[k["".concat(O,"Id")]];return g.cloneElement(_,se(se({},P),{},{className:St(O,P.className),key:_.key||"".concat(S,"-").concat(E),ticks:ei(P,!0)}))}),Fe(x,"renderPolarGrid",function(_){var S=_.props,E=S.radialLines,O=S.polarAngles,N=S.polarRadius,M=x.state,k=M.radiusAxisMap,P=M.angleAxisMap,A=Ti(k),C=Ti(P),I=C.cx,T=C.cy,R=C.innerRadius,L=C.outerRadius;return g.cloneElement(_,{polarAngles:Array.isArray(O)?O:ei(C,!0).map(function(D){return D.coordinate}),polarRadius:Array.isArray(N)?N:ei(A,!0).map(function(D){return D.coordinate}),cx:I,cy:T,innerRadius:R,outerRadius:L,key:_.key||"polar-grid",radialLines:E})}),Fe(x,"renderLegend",function(){var _=x.state.formattedGraphicalItems,S=x.props,E=S.children,O=S.width,N=S.height,M=x.props.margin||{},k=O-(M.left||0)-(M.right||0),P=UW({children:E,formattedGraphicalItems:_,legendWidth:k,legendContent:c});if(!P)return null;var A=P.item,C=AZ(P,BIe);return g.cloneElement(A,se(se({},C),{},{chartWidth:O,chartHeight:N,margin:M,onBBoxUpdate:x.handleLegendBBoxUpdate}))}),Fe(x,"renderTooltip",function(){var _,S=x.props,E=S.children,O=S.accessibilityLayer,N=jr(E,eo);if(!N)return null;var M=x.state,k=M.isTooltipActive,P=M.activeCoordinate,A=M.activePayload,C=M.activeLabel,I=M.offset,T=(_=N.props.active)!==null&&_!==void 0?_:k;return g.cloneElement(N,{viewBox:se(se({},I),{},{x:I.left,y:I.top}),active:T,label:C,payload:T?A:[],coordinate:P,accessibilityLayer:O})}),Fe(x,"renderBrush",function(_){var S=x.props,E=S.margin,O=S.data,N=x.state,M=N.offset,k=N.dataStartIndex,P=N.dataEndIndex,A=N.updateId;return g.cloneElement(_,{key:_.key||"_recharts-brush",onChange:Rg(x.handleBrushChange,_.props.onChange),data:O,x:ye(_.props.x)?_.props.x:M.left,y:ye(_.props.y)?_.props.y:M.top+M.height+M.brushBottom-(E.bottom||0),width:ye(_.props.width)?_.props.width:M.width,startIndex:k,endIndex:P,updateId:"brush-".concat(A)})}),Fe(x,"renderReferenceElement",function(_,S,E){if(!_)return null;var O=x,N=O.clipPathId,M=x.state,k=M.xAxisMap,P=M.yAxisMap,A=M.offset,C=_.type.defaultProps||{},I=_.props,T=I.xAxisId,R=T===void 0?C.xAxisId:T,L=I.yAxisId,D=L===void 0?C.yAxisId:L;return g.cloneElement(_,{key:_.key||"".concat(S,"-").concat(E),xAxis:k[R],yAxis:P[D],viewBox:{x:A.left,y:A.top,width:A.width,height:A.height},clipPathId:N})}),Fe(x,"renderActivePoints",function(_){var S=_.item,E=_.activePoint,O=_.basePoint,N=_.childIndex,M=_.isRange,k=[],P=S.props.key,A=S.item.type.defaultProps!==void 0?se(se({},S.item.type.defaultProps),S.item.props):S.item.props,C=A.activeDot,I=A.dataKey,T=se(se({index:N,dataKey:I,cx:E.x,cy:E.y,r:4,fill:fN(S.item),strokeWidth:2,stroke:"#fff",payload:E.payload,value:E.value},bt(C,!1)),qy(C));return k.push(v.renderActiveDot(C,T,"".concat(P,"-activePoint-").concat(N))),O?k.push(v.renderActiveDot(C,se(se({},T),{},{cx:O.x,cy:O.y}),"".concat(P,"-basePoint-").concat(N))):M&&k.push(null),k}),Fe(x,"renderGraphicChild",function(_,S,E){var O=x.filterFormatItem(_,S,E);if(!O)return null;var N=x.getTooltipEventType(),M=x.state,k=M.isTooltipActive,P=M.tooltipAxis,A=M.activeTooltipIndex,C=M.activeLabel,I=x.props.children,T=jr(I,eo),R=O.props,L=R.points,D=R.isRange,z=R.baseLine,B=O.item.type.defaultProps!==void 0?se(se({},O.item.type.defaultProps),O.item.props):O.item.props,$=B.activeDot,U=B.hide,F=B.activeBar,H=B.activeShape,re=!!(!U&&k&&T&&($||F||H)),ee={};N!=="axis"&&T&&T.props.trigger==="click"?ee={onClick:Rg(x.handleItemMouseEnter,_.props.onClick)}:N!=="axis"&&(ee={onMouseLeave:Rg(x.handleItemMouseLeave,_.props.onMouseLeave),onMouseEnter:Rg(x.handleItemMouseEnter,_.props.onMouseEnter)});var G=g.cloneElement(_,se(se({},O.props),ee));function K(He){return typeof P.dataKey=="function"?P.dataKey(He.payload):null}if(re)if(A>=0){var X,ne;if(P.dataKey&&!P.allowDuplicatedCategory){var V=typeof P.dataKey=="function"?K:"payload.".concat(P.dataKey.toString());X=JE(L,V,C),ne=D&&z&&JE(z,V,C)}else X=L==null?void 0:L[A],ne=D&&z&&z[A];if(H||F){var le=_.props.activeIndex!==void 0?_.props.activeIndex:A;return[g.cloneElement(_,se(se(se({},O.props),ee),{},{activeIndex:le})),null,null]}if(!wt(X))return[G].concat(Zl(x.renderActivePoints({item:O,activePoint:X,basePoint:ne,childIndex:A,isRange:D})))}else{var ae,de=(ae=x.getItemByXY(x.state.activeCoordinate))!==null&&ae!==void 0?ae:{graphicalItem:G},je=de.graphicalItem,Le=je.item,$e=Le===void 0?_:Le,Se=je.childIndex,Ve=se(se(se({},O.props),ee),{},{activeIndex:Se});return[g.cloneElement($e,Ve),null,null]}return D?[G,null,null]:[G,null]}),Fe(x,"renderCustomized",function(_,S,E){return g.cloneElement(_,se(se({key:"recharts-customized-".concat(E)},x.props),x.state))}),Fe(x,"renderMap",{CartesianGrid:{handler:yv,once:!0},ReferenceArea:{handler:x.renderReferenceElement},ReferenceLine:{handler:yv},ReferenceDot:{handler:x.renderReferenceElement},XAxis:{handler:yv},YAxis:{handler:yv},Brush:{handler:x.renderBrush,once:!0},Bar:{handler:x.renderGraphicChild},Line:{handler:x.renderGraphicChild},Area:{handler:x.renderGraphicChild},Radar:{handler:x.renderGraphicChild},RadialBar:{handler:x.renderGraphicChild},Scatter:{handler:x.renderGraphicChild},Pie:{handler:x.renderGraphicChild},Funnel:{handler:x.renderGraphicChild},Tooltip:{handler:x.renderCursor,once:!0},PolarGrid:{handler:x.renderPolarGrid,once:!0},PolarAngleAxis:{handler:x.renderPolarAxis},PolarRadiusAxis:{handler:x.renderPolarAxis},Customized:{handler:x.renderCustomized}}),x.clipPathId="".concat((w=b.id)!==null&&w!==void 0?w:Vy("recharts"),"-clip"),x.throttleTriggeredAfterMouseMove=Rv(x.triggeredAfterMouseMove,(j=b.throttleDelay)!==null&&j!==void 0?j:1e3/60),x.state={},x}return YIe(v,y),ZIe(v,[{key:"componentDidMount",value:function(){var b,w;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(b=this.props.margin.left)!==null&&b!==void 0?b:0,top:(w=this.props.margin.top)!==null&&w!==void 0?w:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var b=this.props,w=b.children,j=b.data,x=b.height,_=b.layout,S=jr(w,eo);if(S){var E=S.props.defaultIndex;if(!(typeof E!="number"||E<0||E>this.state.tooltipTicks.length-1)){var O=this.state.tooltipTicks[E]&&this.state.tooltipTicks[E].value,N=MM(this.state,j,E,O),M=this.state.tooltipTicks[E].coordinate,k=(this.state.offset.top+x)/2,P=_==="horizontal",A=P?{x:M,y:k}:{y:M,x:k},C=this.state.formattedGraphicalItems.find(function(T){var R=T.item;return R.type.name==="Scatter"});C&&(A=se(se({},A),C.props.points[E].tooltipPosition),N=C.props.points[E].tooltipPayload);var I={activeTooltipIndex:E,isTooltipActive:!0,activeLabel:O,activePayload:N,activeCoordinate:A};this.setState(I),this.renderCursor(S),this.accessibilityManager.setIndex(E)}}}},{key:"getSnapshotBeforeUpdate",value:function(b,w){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==w.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==b.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==b.margin){var j,x;this.accessibilityManager.setDetails({offset:{left:(j=this.props.margin.left)!==null&&j!==void 0?j:0,top:(x=this.props.margin.top)!==null&&x!==void 0?x:0}})}return null}},{key:"componentDidUpdate",value:function(b){rO([jr(b.children,eo)],[jr(this.props.children,eo)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var b=jr(this.props.children,eo);if(b&&typeof b.props.shared=="boolean"){var w=b.props.shared?"axis":"item";return i.indexOf(w)>=0?w:a}return a}},{key:"getMouseInfo",value:function(b){if(!this.container)return null;var w=this.container,j=w.getBoundingClientRect(),x=dEe(j),_={chartX:Math.round(b.pageX-x.left),chartY:Math.round(b.pageY-x.top)},S=j.width/w.offsetWidth||1,E=this.inRange(_.chartX,_.chartY,S);if(!E)return null;var O=this.state,N=O.xAxisMap,M=O.yAxisMap,k=this.getTooltipEventType();if(k!=="axis"&&N&&M){var P=Ti(N).scale,A=Ti(M).scale,C=P&&P.invert?P.invert(_.chartX):null,I=A&&A.invert?A.invert(_.chartY):null;return se(se({},_),{},{xValue:C,yValue:I})}var T=FZ(this.state,this.props.data,this.props.layout,E);return T?se(se({},_),T):null}},{key:"inRange",value:function(b,w){var j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,x=this.props.layout,_=b/j,S=w/j;if(x==="horizontal"||x==="vertical"){var E=this.state.offset,O=_>=E.left&&_<=E.left+E.width&&S>=E.top&&S<=E.top+E.height;return O?{x:_,y:S}:null}var N=this.state,M=N.angleAxisMap,k=N.radiusAxisMap;if(M&&k){var P=Ti(M);return aH({x:_,y:S},P)}return null}},{key:"parseEventsOfWrapper",value:function(){var b=this.props.children,w=this.getTooltipEventType(),j=jr(b,eo),x={};j&&w==="axis"&&(j.props.trigger==="click"?x={onClick:this.handleClick}:x={onMouseEnter:this.handleMouseEnter,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd});var _=qy(this.props,this.handleOuterEvent);return se(se({},_),x)}},{key:"addListener",value:function(){SM.on(EM,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){SM.removeListener(EM,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(b,w,j){for(var x=this.state.formattedGraphicalItems,_=0,S=x.length;_<S;_++){var E=x[_];if(E.item===b||E.props.key===b.key||w===qo(E.item.type)&&j===E.childIndex)return E}return null}},{key:"renderClipPath",value:function(){var b=this.clipPathId,w=this.state.offset,j=w.left,x=w.top,_=w.height,S=w.width;return W.createElement("defs",null,W.createElement("clipPath",{id:b},W.createElement("rect",{x:j,y:x,height:_,width:S})))}},{key:"getXScales",value:function(){var b=this.state.xAxisMap;return b?Object.entries(b).reduce(function(w,j){var x=PZ(j,2),_=x[0],S=x[1];return se(se({},w),{},Fe({},_,S.scale))},{}):null}},{key:"getYScales",value:function(){var b=this.state.yAxisMap;return b?Object.entries(b).reduce(function(w,j){var x=PZ(j,2),_=x[0],S=x[1];return se(se({},w),{},Fe({},_,S.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(b){var w;return(w=this.state.xAxisMap)===null||w===void 0||(w=w[b])===null||w===void 0?void 0:w.scale}},{key:"getYScaleByAxisId",value:function(b){var w;return(w=this.state.yAxisMap)===null||w===void 0||(w=w[b])===null||w===void 0?void 0:w.scale}},{key:"getItemByXY",value:function(b){var w=this.state,j=w.formattedGraphicalItems,x=w.activeItem;if(j&&j.length)for(var _=0,S=j.length;_<S;_++){var E=j[_],O=E.props,N=E.item,M=N.type.defaultProps!==void 0?se(se({},N.type.defaultProps),N.props):N.props,k=qo(N.type);if(k==="Bar"){var P=(O.data||[]).find(function(T){return WPe(b,T)});if(P)return{graphicalItem:E,payload:P}}else if(k==="RadialBar"){var A=(O.data||[]).find(function(T){return aH(b,T)});if(A)return{graphicalItem:E,payload:A}}else if(Zg(E,x)||Gg(E,x)||nf(E,x)){var C=TAe({graphicalItem:E,activeTooltipItem:x,itemData:M.data}),I=M.activeIndex===void 0?C:M.activeIndex;return{graphicalItem:se(se({},E),{},{childIndex:I}),payload:nf(E,x)?M.data[C]:E.props.data[C]}}}return null}},{key:"render",value:function(){var b=this;if(!oU(this))return null;var w=this.props,j=w.children,x=w.className,_=w.width,S=w.height,E=w.style,O=w.compact,N=w.title,M=w.desc,k=AZ(w,zIe),P=bt(k,!1);if(O)return W.createElement(KK,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},W.createElement(oO,Kl({},P,{width:_,height:S,title:N,desc:M}),this.renderClipPath(),sU(j,this.renderMap)));if(this.props.accessibilityLayer){var A,C;P.tabIndex=(A=this.props.tabIndex)!==null&&A!==void 0?A:0,P.role=(C=this.props.role)!==null&&C!==void 0?C:"application",P.onKeyDown=function(T){b.accessibilityManager.keyboardEvent(T)},P.onFocus=function(){b.accessibilityManager.focus()}}var I=this.parseEventsOfWrapper();return W.createElement(KK,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},W.createElement("div",Kl({className:St("recharts-wrapper",x),style:se({position:"relative",cursor:"default",width:_,height:S},E)},I,{ref:function(T){b.container=T}}),W.createElement(oO,Kl({},P,{width:_,height:S,title:N,desc:M,style:aRe}),this.renderClipPath(),sU(j,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(g.Component);Fe(f,"displayName",t),Fe(f,"defaultProps",se({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},u)),Fe(f,"getDerivedStateFromProps",function(y,v){var b=y.dataKey,w=y.data,j=y.children,x=y.width,_=y.height,S=y.layout,E=y.stackOffset,O=y.margin,N=v.dataStartIndex,M=v.dataEndIndex;if(v.updateId===void 0){var k=BZ(y);return se(se(se({},k),{},{updateId:0},p(se(se({props:y},k),{},{updateId:0}),v)),{},{prevDataKey:b,prevData:w,prevWidth:x,prevHeight:_,prevLayout:S,prevStackOffset:E,prevMargin:O,prevChildren:j})}if(b!==v.prevDataKey||w!==v.prevData||x!==v.prevWidth||_!==v.prevHeight||S!==v.prevLayout||E!==v.prevStackOffset||!ml(O,v.prevMargin)){var P=BZ(y),A={chartX:v.chartX,chartY:v.chartY,isTooltipActive:v.isTooltipActive},C=se(se({},FZ(v,w,S)),{},{updateId:v.updateId+1}),I=se(se(se({},P),A),C);return se(se(se({},I),p(se({props:y},I),v)),{},{prevDataKey:b,prevData:w,prevWidth:x,prevHeight:_,prevLayout:S,prevStackOffset:E,prevMargin:O,prevChildren:j})}if(!rO(j,v.prevChildren)){var T,R,L,D,z=jr(j,Rl),B=z&&(T=(R=z.props)===null||R===void 0?void 0:R.startIndex)!==null&&T!==void 0?T:N,$=z&&(L=(D=z.props)===null||D===void 0?void 0:D.endIndex)!==null&&L!==void 0?L:M,U=B!==N||$!==M,F=!wt(w),H=F&&!U?v.updateId:v.updateId+1;return se(se({updateId:H},p(se(se({props:y},v),{},{updateId:H,dataStartIndex:B,dataEndIndex:$}),v)),{},{prevChildren:j,dataStartIndex:B,dataEndIndex:$})}return null}),Fe(f,"renderActiveDot",function(y,v,b){var w;return g.isValidElement(y)?w=g.cloneElement(y,v):at(y)?w=y(v):w=W.createElement(QH,v),W.createElement(wn,{className:"recharts-active-dot",key:b},w)});var m=g.forwardRef(function(y,v){return W.createElement(f,Kl({},y,{ref:v}))});return m.displayName=f.displayName,m},mRe=hRe({chartName:"BarChart",GraphicalChild:Fs,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:pv},{axisType:"yAxis",AxisComp:xM}],formatAxisMap:N2e});const yRe={light:"",dark:".dark"},UZ=g.createContext(null);function VZ(){const e=g.useContext(UZ);if(!e)throw new Error("useChart must be used within a <ChartContainer />");return e}const qZ=g.forwardRef(({id:e,className:t,children:n,config:r,...a},o)=>{const i=g.useId(),s=`chart-${e||i.replace(/:/g,"")}`;return h.jsx(UZ.Provider,{value:{config:r},children:h.jsxs("div",{"data-chart":s,ref:o,className:Z("flex aspect-video justify-center text-xs",t),...a,children:[h.jsx(gRe,{id:s,config:r}),h.jsx(aEe,{children:n})]})})});qZ.displayName="Chart";const gRe=({id:e,config:t})=>{const n=Object.entries(t).filter(([r,a])=>a.theme||a.color);return n.length?h.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(yRe).map(([r,a])=>`
${a} [data-chart=${e}] {
${n.map(([o,i])=>{var c;const s=((c=i.theme)==null?void 0:c[r])||i.color;return s?`  --color-${o}: ${s};`:null}).join(`
`)}
}
`).join(`
`)}}):null},vRe=eo,WZ=g.forwardRef(({active:e,payload:t,className:n,indicator:r="dot",hideLabel:a=!1,hideIndicator:o=!1,label:i,labelFormatter:s,labelClassName:c,formatter:l,color:u,nameKey:d,labelKey:p},f)=>{const{config:m}=VZ(),y=g.useMemo(()=>{var _;if(a||!(t!=null&&t.length))return null;const[b]=t,w=`${p||b.dataKey||b.name||"value"}`,j=kM(m,b,w),x=!p&&typeof i=="string"?((_=m[i])==null?void 0:_.label)||i:j==null?void 0:j.label;return s?h.jsx("div",{className:Z("font-medium",c),children:s(x,t)}):x?h.jsx("div",{className:Z("font-medium",c),children:x}):null},[i,s,t,a,c,m,p]);if(!e||!(t!=null&&t.length))return null;const v=t.length===1&&r!=="dot";return h.jsxs("div",{ref:f,className:Z("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",n),children:[v?null:y,h.jsx("div",{className:"grid gap-1.5",children:t.map((b,w)=>{const j=`${d||b.name||b.dataKey||"value"}`,x=kM(m,b,j),_=u||b.payload.fill||b.color;return h.jsx("div",{className:Z("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",r==="dot"&&"items-center"),children:l&&(b==null?void 0:b.value)!==void 0&&b.name?l(b.value,b.name,b,w,b.payload):h.jsxs(h.Fragment,{children:[x!=null&&x.icon?h.jsx(x.icon,{}):!o&&h.jsx("div",{className:Z("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":r==="dot","w-1":r==="line","w-0 border-[1.5px] border-dashed bg-transparent":r==="dashed","my-0.5":v&&r==="dashed"}),style:{"--color-bg":_,"--color-border":_}}),h.jsxs("div",{className:Z("flex flex-1 justify-between leading-none",v?"items-end":"items-center"),children:[h.jsxs("div",{className:"grid gap-1.5",children:[v?y:null,h.jsx("span",{className:"text-muted-foreground",children:(x==null?void 0:x.label)||b.name})]}),b.value&&h.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:b.value.toLocaleString()})]})]})},b.dataKey)})})]})});WZ.displayName="ChartTooltip";const bRe=g.forwardRef(({className:e,hideIcon:t=!1,payload:n,verticalAlign:r="bottom",nameKey:a},o)=>{const{config:i}=VZ();return n!=null&&n.length?h.jsx("div",{ref:o,className:Z("flex items-center justify-center gap-4",r==="top"?"pb-3":"pt-3",e),children:n.map(s=>{const c=`${a||s.dataKey||"value"}`,l=kM(i,s,c);return h.jsxs("div",{className:Z("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[l!=null&&l.icon&&!t?h.jsx(l.icon,{}):h.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:s.color}}),l==null?void 0:l.label]},s.value)})}):null});bRe.displayName="ChartLegend";function kM(e,t,n){if(typeof t!="object"||t===null)return;const r="payload"in t&&typeof t.payload=="object"&&t.payload!==null?t.payload:void 0;let a=n;return n in t&&typeof t[n]=="string"?a=t[n]:r&&n in r&&typeof r[n]=="string"&&(a=r[n]),a in e?e[a]:e[n]}const HZ=e=>{const t=["Bytes","KB","MB","GB","TB"];if(e===void 0)return"Unknown size";if(e===0)return"0 Byte";const n=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,n))} ${t[n]}`},wRe=g.memo(()=>{const{t:e}=ke("flows"),[t,n]=g.useState(),r=co(m=>m.cachedLLMURLs),a=Je(m=>m.currentSession),[o,i]=g.useState(),[s,c]=g.useState(""),[l,u]=g.useState(),d=g.useMemo(()=>({nodes:{label:e("session_info_node.entities.nodes"),color:"#2563eb"},edges:{label:e("session_info_node.entities.edges"),color:"#34d399"},threads:{label:e("session_info_node.entities.threads"),color:"#fbbf24"},llms:{label:e("session_info_node.entities.llms"),color:"#f87171"},prompts:{label:e("session_info_node.entities.prompts"),color:"#a78bfa"},tools:{label:e("session_info_node.entities.tools"),color:"#ffcccb"},schemas:{label:e("session_info_node.entities.schemas"),color:"#ffb6c1"},vectorDatabases:{label:e("session_info_node.entities.vector_databases"),color:"#ff69b4"},jsonlDatas:{label:e("session_info_node.entities.jsonl_data"),color:"#ff1493"},csvDatas:{label:e("session_info_node.entities.csv_data"),color:"#db7093"}}),[e]);g.useEffect(()=>{Ht(async()=>{const{functionCallingModelIds:m,prebuiltAppConfig:y}=await import("./index-C7uio77f.js").then(async v=>(await v.__tla,v));return{functionCallingModelIds:m,prebuiltAppConfig:y}},__vite__mapDeps([9,1,2,3,4])).then(({functionCallingModelIds:m,prebuiltAppConfig:y})=>{n(r==null?void 0:r.map(v=>{const b=y.model_list.find(w=>v.includes(w.model));if(b)return{model_id:(b==null?void 0:b.model_id)||"",info:b,isFunctionCalling:m.includes((b==null?void 0:b.model_id)||"")}}))})},[r,a==null?void 0:a.id]);const p=g.useCallback(async()=>{navigator.storage.estimate().then(m=>{m&&c(e("session_info_node.used_bytes",{used:HZ(m.usage),total:HZ(m==null?void 0:m.quota)}))}),a!=null&&a.id&&(Promise.all([ue("FlowNode").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("FlowEdge").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("Thread").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("Prompt").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("LLM").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("Schema").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("ToolDefinition").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("VectorDatabase").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("JSONLData").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}}),ue("CSVData").findOne({where:{session_id:a==null?void 0:a.id},order:{updated_at:"DESC"}})]).then(m=>{const y=m.reduce((v,b)=>b!=null&&b.updated_at&&(!v||new Date(b.updated_at)>v)?new Date(b.updated_at):v,a.updated_at?new Date(a.updated_at):void 0);i(y)}),Promise.all([ue("FlowNode").count({where:{session_id:a==null?void 0:a.id}}),ue("FlowEdge").count({where:{session_id:a==null?void 0:a.id}}),ue("Thread").count({where:{session_id:a==null?void 0:a.id}}),ue("Prompt").count({where:{session_id:a==null?void 0:a.id}}),ue("LLM").count({where:{session_id:a==null?void 0:a.id}}),ue("ToolDefinition").count({where:{session_id:a==null?void 0:a.id}}),ue("Schema").count({where:{session_id:a==null?void 0:a.id}}),ue("VectorDatabase").count({where:{session_id:a==null?void 0:a.id}}),ue("JSONLData").count({where:{session_id:a==null?void 0:a.id}}),ue("CSVData").count({where:{session_id:a==null?void 0:a.id}})]).then(([m,y,v,b,w,j,x,_,S,E])=>{u([{name:e("session_info_node.count_info.title"),nodes:m||0,edges:y||0,threads:v||0,prompts:b||0,llms:w||0,tools:j||0,schemas:x||0,vectorDatabases:_||0,jsonlDatas:S||0,csvDatas:E||0}])}))},[a==null?void 0:a.id,a==null?void 0:a.updated_at,e]),f=g.useCallback(()=>{p()},[p]);return g.useEffect(()=>{p()},[p]),h.jsxs(Gt,{className:"w-96",children:[h.jsxs(Mn,{children:[h.jsx($n,{children:e("session_info_node.title")}),h.jsx(H9,{children:o||a!=null&&a.updated_at?c3e(o||(a==null?void 0:a.updated_at)).fromNow():""})]}),h.jsxs(kn,{className:"grid gap-4",children:[h.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:h.jsxs("div",{className:"flex-1 space-y-1",children:[h.jsx("p",{className:"text-sm font-medium leading-none",children:e("session_info_node.disk_size")}),h.jsx("p",{className:"text-sm text-muted-foreground",children:s})]})}),h.jsx("div",{className:"flex items-center space-x-4 rounded-md border p-4",children:h.jsxs("div",{className:"flex-1 space-y-1",children:[h.jsxs("div",{className:"text-sm font-medium leading-none",children:[e("session_info_node.cached_llms"),h.jsx(bn,{className:"ml-2",children:(t==null?void 0:t.length)||0})]}),t==null?void 0:t.map(m=>h.jsxs("div",{className:"text-sm text-muted-foreground gap-1",children:[m==null?void 0:m.model_id,h.jsx("div",{className:"max-w-full gap-1 flex flex-wrap mt-1",children:h.jsx(op,{model:m==null?void 0:m.info,isFunctionCalling:(m==null?void 0:m.isFunctionCalling)||!1,isCached:!0,cloud:!1})})]},m==null?void 0:m.model_id))]})}),h.jsx("div",{children:h.jsx(qZ,{config:d,className:"min-h-28 w-full",children:h.jsxs(mRe,{accessibilityLayer:!0,data:l,children:[h.jsx(vZ,{vertical:!1}),h.jsx(pv,{dataKey:"name",tickLine:!1,tickMargin:10,axisLine:!1}),h.jsx(vRe,{content:h.jsx(WZ,{})}),Object.entries(d).map(([m,y])=>h.jsx(Fs,{dataKey:m,fill:y.color,radius:4},m))]})})})]}),h.jsx(Ja,{children:h.jsxs(Ye,{className:"w-full",onClick:f,children:[h.jsx(pe,{size:24,name:"refresh-ccw"}),e("session_info_node.reload")]})})]})}),xRe=e=>{const t=g.useCallback(async({edgeId:n})=>{try{return{deleteEdgeId:n}}catch{return{deleteEdgeId:n}}},[]);qn(e,t)},_Re=g.memo(e=>{var c,l;const{t}=ke("flows"),{id:n,data:r,isConnectable:a}=e,o=g.useRef(!1),i=In(n),s=Ie(u=>u.updateNodes);return xRe(n),g.useEffect(()=>{var d;const u=r==null?void 0:r.entity;!u||!i||o.current||(d=u==null?void 0:u.schema_items)!=null&&d.length||r.loaded||(o.current=!0,ue("SchemaItem").find({where:{schema_id:u.id}}).then(p=>{s([{id:i.id,type:"replace",item:{...i,data:{...(i==null?void 0:i.data)||{},loaded:!0,entity:{...r.entity,schema_items:p}}}}])}).finally(()=>{o.current=!1}))},[r.entity,r.loaded,i,s]),h.jsxs("div",{children:[h.jsxs("div",{children:[h.jsx(Bn,{id:n}),h.jsxs(eE,{defaultValue:"account",className:"w-[400px]",children:[h.jsxs(Ey,{className:"grid w-full grid-cols-2",children:[h.jsx(wa,{value:"account",children:t("schema_node.typescript")}),h.jsx(wa,{value:"password",children:t("schema_node.zod")})]}),h.jsx(xa,{value:"account",children:h.jsx(Gt,{className:"p-4",children:h.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:n0e(((c=r==null?void 0:r.entity)==null?void 0:c.schema_items)||[])})})}),h.jsx(xa,{value:"password",children:h.jsx(Gt,{className:"p-4 max-w-full",children:h.jsx("pre",{className:"overflow-hidden break-words whitespace-pre-wrap",children:W9(((l=r==null?void 0:r.entity)==null?void 0:l.schema_items)||[])})})})]})]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:a})]})}),jRe=g.memo(e=>{var o,i;const{id:t,data:n,isConnectable:r}=e,a=g.useMemo(()=>{if(!(n!=null&&n.entity))return{headers:[],rows:[]};const s=Pv(n.entity.csv);return{headers:HM(n.entity.headers),rows:s.map(c=>HM(c))}},[n==null?void 0:n.entity]);return h.jsxs("div",{children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsxs("div",{children:[h.jsx(Bn,{id:t}),h.jsxs(Gt,{className:"min-w-32 min-h-16 p-4",children:[h.jsx(Mn,{className:"!p-0",children:h.jsxs("div",{className:"pt-2 flex !flex-row",children:[h.jsx(pe,{name:"file-spreadsheet",className:"mr-2"}),h.jsxs(Be,{className:"!font-medium leading-none tracking-tight pr-8",children:[ie.CSVData," ",(o=a==null?void 0:a.rows)!=null&&o.length?`(${((i=a==null?void 0:a.rows)==null?void 0:i.length)||0})`:""]})]})}),h.jsx(kn,{className:"pb-0",children:h.jsx(Ly,{data:a.rows,headers:a.headers})})]})]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})}),SRe=e=>{const t=Ie(r=>r.createOrUpdateFlowEdge),n=g.useCallback(async({edgeId:r,source:a,target:o,connection:i})=>{try{if((a==null?void 0:a.type)===ie.Schema&&(o==null?void 0:o.type)===ie.ToolDefinition){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},ERe=g.memo(({id:e,data:t,isConnectable:n})=>{var r,a;return SRe(e),h.jsxs("div",{children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:n}),h.jsx("div",{children:h.jsxs(Ar,{className:"flex justify-center",children:[h.jsx(pe,{size:24,name:"wrench"}),h.jsxs("div",{className:"ml-2",children:[h.jsx(Uo,{children:`${((r=t.entity)==null?void 0:r.name)||""}`}),h.jsx(pl,{children:`${((a=t.entity)==null?void 0:a.description)||""}`})]})]})}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:n})]})}),ORe=g.memo(e=>{var d,p;const[t,n]=g.useState(!1),[r,a]=g.useState({}),[o,i]=g.useState({}),{confirmPassphrase:s}=AS(),{t:c}=ke("atoms"),l=async()=>{var f;if(t)a({}),i({});else{if((f=Object.keys(e.encrypted||{}))!=null&&f.length){await s();const m={},y=await Wi.get("passphrase");if(!y)throw new Error("Passphrase is not found");await Promise.all(Object.keys(e.encrypted||{}).map(async v=>{var b;(b=e.encrypted)!=null&&b[v]&&(m[v]=await Mm(r[v],y))})),i(m||{})}a({...e.options})}n(!t)},u=()=>{var f;(f=e.onChangeOptions)==null||f.call(e,r||{},o||{}),n(!1)};return h.jsx("div",{className:Z("min-w-20 flex justify-end",e.className),children:h.jsxs(Ef,{open:t,onOpenChange:n,children:[h.jsx(b0,{children:h.jsx("div",{className:"flex justify-end gap-2 !cursor-pointer",children:h.jsxs(Ye,{onClick:l,variant:"link",className:"flex items-center px-0 !cursor-pointer",children:[h.jsx(pe,{name:"settings"}),h.jsx(Be,{children:c("embedding_setting.title")})]})})}),h.jsx(mu,{className:"w-full p-0",children:t?h.jsxs(Gt,{className:"!border-none max-w-96 min-w-56",children:[h.jsx(Mn,{children:h.jsx($n,{children:c("embedding_setting.title")})}),h.jsxs(kn,{children:[h.jsxs(Be,{children:[c("embedding_setting.provider"),":"]}),h.jsxs(Ya,{value:r!=null&&r.provider?`${r==null?void 0:r.provider}`:"local_transformers",onValueChange:f=>a({provider:f}),children:[h.jsx(ja,{className:"",children:h.jsx(Qa,{placeholder:c("embedding_setting.provider_placeholder")})}),h.jsxs(Sa,{children:[h.jsx(Fn,{value:"local_transformers",children:c("embedding_setting.providers.local_transformers")},"local_transformers"),(d=e.supportedProviders)==null?void 0:d.map(f=>h.jsx(Fn,{value:f,children:c(`embedding_setting.providers.${f.toLowerCase()}`)},f))]})]}),(p=e.supportedProviders)!=null&&p.length?void 0:h.jsx(Be,{className:"text-red-500 !pt-2",children:c("embedding_setting.alerts.no_provider")}),h.jsx(h.Fragment,{children:r.provider&&r.provider!=="local_transformers"?h.jsxs(h.Fragment,{children:[h.jsx(Ar,{variant:"destructive",className:"mt-4",children:c("embedding_setting.alerts.session_passkey")}),h.jsxs("div",{className:"mt-4",children:[h.jsx(Be,{children:c("embedding_setting.encrypted_fields.api_key")}),h.jsx(Ye,{variant:"link",className:"px-1",children:h.jsxs("a",{href:r.provider===We.OpenAI?By:zy,target:"_blank",rel:"noreferrer",children:["(",r.provider===We.OpenAI?By:zy,")"]})}),h.jsx(Kt,{type:"password",value:o!=null&&o.key?`${o==null?void 0:o.key}`:"",onChange:f=>i(m=>({...m,key:f.target.value}))})]})]}):void 0})]}),h.jsx(Ja,{className:"flex justify-end",children:h.jsx(Ye,{variant:"secondary",onClick:u,children:c("embedding_setting.save")})})]}):void 0})]})})}),CRe=e=>{const t=g.useCallback(async({edgeId:n})=>({deleteEdgeId:n}),[]);qn(e,t)},NRe=e=>{const t=Je(s=>{var c;return(c=s.currentSession)==null?void 0:c.id}),n=In(e),r=EL(),a=Ie(s=>s.updateNodes),{confirmOrCreatePassphrase:o}=E7(),i=g.useCallback(async(s,c)=>{var l;if(n&&t){let u=e!==bi.DEFAULT_EMBEDDING_MODEL?await ue("FlowNode").findOne({where:{id:e}}):void 0;const d={};if((l=Object.keys(c||{}))!=null&&l.length){await o();const m=await Wi.get("passphrase");if(!m)throw new Error("Passphrase is not found");await Promise.all(Object.keys(c||{}).map(async y=>{c!=null&&c[y]&&(d[y]=await mj(c[y],m))}))}let p;const f=[];u?(await ue("FlowNodePlaceholder").update(u.source_id,{encrypted:d,data:s}),p=await ue("FlowNodePlaceholder").findOne({where:{id:u.source_id}}),f.push({id:u.id,type:"replace",item:n})):(f.push({id:e,type:"remove"}),p=await ue("FlowNodePlaceholder").save({placeholder_type:Xi.DEFAULT_EMBEDDING_MODEL,encrypted:d,data:s,session_id:t}),u=await ue("FlowNode").save({node_type:ie.DefaultEmbeddingModel,session_id:t,source_type:"FlowNodePlaceholder",source_id:p.id,x:n.position.x,y:n.position.y}),f.push({type:"add",item:n})),n.data.entity=p,n.data.flowNode=u,a(f)}},[o,t,e,n,a]);return g.useEffect(()=>{e===bi.DEFAULT_EMBEDDING_MODEL&&r.find(s=>s.type===ie.DefaultEmbeddingModel&&s.id!==bi.DEFAULT_EMBEDDING_MODEL)&&a([{id:e,type:"remove"}])},[e,r,a]),{changeLLMOptions:i}},MRe=g.memo(e=>{var s,c,l,u;const{id:t,data:n,isConnectable:r}=e,{changeLLMOptions:a}=NRe(t);CRe(t);let o="brain",i=BG;switch(`${(c=(s=n==null?void 0:n.entity)==null?void 0:s.data)==null?void 0:c.provider}`){case We.OpenAI:o="gpt",i="text-embedding-3-small";break;case We.GoogleGenerativeAI:o="gemma",i="text-embedding-004";break}return h.jsxs("div",{children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsx("div",{children:h.jsxs(Ar,{className:"flex justify-center max-w-auto",variant:"default",children:[h.jsx(Pr,{name:o,className:"w-7 h-7"}),h.jsxs("div",{className:"ml-2 pr-4 flex justify-center gap-1 flex-col",children:[h.jsx("div",{className:"min-h-8 flex items-center",children:h.jsx(Uo,{children:`${i||""}`})}),h.jsx(ORe,{supportedProviders:[We.OpenAI,We.GoogleGenerativeAI],onChangeOptions:a,encrypted:(l=n.entity)==null?void 0:l.encrypted,options:(u=n.entity)==null?void 0:u.data})]})]})}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})}),kRe=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
Use three sentences maximum and keep the answer as concise as possible.

{context}
`,PRe=uo(e=>{const{source:t,documents:n}=e,r=tn(),{toast:a}=nn(),{t:o}=ke("dialogs"),{loading:i,createPrompt:s}=O7(),c=async l=>{try{if(!l.content||!l.content.includes("{context}")){a({title:o("create_vector_database_prompt.errors.fill_context"),variant:"destructive"});return}const u=l.content.replace("{context}",n.map(d=>`<document>${d.pageContent}</document>`).join(`
`));return await s(t,{...l,content:u}),r.hide(),!0}catch{a({title:o("create_vector_database_prompt.errors.create_failed"),variant:"destructive"})}};return h.jsx(fi,{open:r.visible,onOpenChange:r.hide,children:h.jsxs(xo,{className:"sm:max-w-[425px]",children:[h.jsx(_o,{children:h.jsxs("div",{className:"flex",children:[h.jsx(pe,{name:"file",className:"mr-2 h-4 w-4"}),h.jsx(jo,{children:o("create_vector_database_prompt.title")})]})}),h.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[h.jsx(UE,{onSubmit:c,loading:i,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:kRe}),h.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[h.jsx(pe,{name:"info",className:"mr-2",size:14}),o("create_vector_database_prompt.fill_content_note")]})]})]})})}),ARe=()=>{const e=Je(i=>{var s;return(s=i.currentSession)==null?void 0:s.id}),[t,n]=g.useState(!1),r=Ie(i=>i.createOrUpdateFlowNode),a=Ie(i=>i.createOrUpdateFlowEdge),o=g.useCallback(async({prompt:i,source:s,metadata:c})=>{var l,u,d,p;try{const f=(l=s==null?void 0:s.data)==null?void 0:l.entity;if(!f||!e)throw new Error("Source or Session not found");n(!0);const m=((u=s.position)==null?void 0:u.x)||0,y=(((d=s.position)==null?void 0:d.y)||0)+(((p=s.measured)==null?void 0:p.height)||0),v=await ue("Prompt").save({...i,status:(i==null?void 0:i.status)||Hr.Started,role:(i==null?void 0:i.role)||pr.System,type:(i==null?void 0:i.type)||fr.Chat,content:(i==null?void 0:i.content)||"{context}",session_id:e});if(!v)throw new Error("Failed to save prompt");const b=await r({source_id:v.id,source_type:"Prompt",node_type:ie.Prompt,x:m,y:y+20});if(!b)throw new Error("Failed to save prompt node");const w=await ue("FlowNodePlaceholder").save({placeholder:`Retriever for ${f.name}`,placeholder_type:Xi.VECTOR_DATABASE_RETREIVER,session_id:e,metadata:c});if(!w)throw new Error("Failed to save node placeholder");const j=await r({source_id:w.id,source_type:"FlowNodePlaceholder",node_type:ie.PlaceHolder,x:m,y:y+40});if(!j)throw new Error("Failed to save node placeholder node");await a({source:b.id,target:j.id}),await a({source:s.id,target:j.id})}finally{n(!1)}},[e,r,a]);return{loading:t,createVectorDatabaseRetriever:o}},TRe=`Use the following pieces of context to answer the question at the end.
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}
`,IRe=uo(e=>{const{source:t}=e,n=tn(),{toast:r}=nn(),{t:a}=ke("dialogs"),[o,i]=g.useState(1),[s,c]=g.useState(void 0),{loading:l,createVectorDatabaseRetriever:u}=ARe(),d=async m=>{try{const y=m.content;if(!y||!y.includes("{context}")){r({title:a("create_vector_database_retriever.errors.fill_context"),variant:"destructive"});return}return await u({source:t,prompt:{content:y},metadata:{k:o,minimalScore:s}}),i(1),c(void 0),n.hide(),!0}catch{r({title:a("create_vector_database_retriever.errors.create_failed"),variant:"destructive"})}},p=m=>{i(m.target.value?Number(m.target.value):void 0)},f=m=>{c(m.target.value?Number(m.target.value):void 0)};return h.jsx(fi,{open:n.visible,onOpenChange:n.hide,children:h.jsxs(xo,{className:"sm:max-w-[425px]",children:[h.jsx(_o,{children:h.jsxs("div",{className:"flex",children:[h.jsx(pe,{name:"file",className:"mr-2 h-4 w-4"}),h.jsx(jo,{children:a("create_vector_database_retriever.title")})]})}),h.jsxs("div",{className:"flex gap-4 py-4 flex-col",children:[h.jsx(UE,{onSubmit:d,loading:l,hidePromptType:!0,defaultPromptRole:"system",defaultPromptContent:TRe}),h.jsxs(Gt,{children:[h.jsx(Mn,{children:h.jsx($n,{children:a("create_vector_database_retriever.retriever_settings")})}),h.jsxs(kn,{children:[h.jsx(Be,{children:a("create_vector_database_retriever.retriever_k")}),h.jsx(Kt,{value:o||"",type:"number",onChange:p,placeholder:a("create_vector_database_retriever.retriever_k_placeholder")}),h.jsx(Be,{children:a("create_vector_database_retriever.retriever_minimum_score")}),h.jsx(Kt,{value:s||"",type:"number",onChange:f,placeholder:a("create_vector_database_retriever.retriever_minimum_score_placeholder")})]})]}),h.jsxs("div",{className:"w-full border-0 text-gray-700 flex text-sm items-center",children:[h.jsx(pe,{name:"info",className:"mr-2",size:14}),a("create_vector_database_retriever.fill_content_note")]})]})]})})}),RRe=e=>{const t=Ie(a=>a.createOrUpdateFlowEdge),{index:n}=rp(),r=g.useCallback(async({edgeId:a,target:o,source:i})=>{var s,c;try{const l=(s=o==null?void 0:o.data)==null?void 0:s.entity;if((i==null?void 0:i.type)===ie.CSVData&&(o==null?void 0:o.type)===ie.VectorDatabase){const u=(c=i==null?void 0:i.data)==null?void 0:c.entity;if(!u||!l)return{deleteEdgeId:a};const{rows:d}=JG(u.headers,u.csv),p=d.map(f=>new vf({pageContent:`${f.text}`}));await n(void 0,{database:{databaseId:l.id,dataSourceId:u.id,dataSourceType:"CSVData"}},p),await t({source:i.id,target:o.id});return}return{deleteEdgeId:a}}catch{return{deleteEdgeId:a}}},[t,n]);qn(e,r)},DRe=e=>{const[t,n]=g.useState(!1),{t:r}=ke("flows"),{toast:a}=nn(),{getNode:o,getHandleConnections:i}=br(),s=Ie(p=>p.updateNodes),{index:c,similaritySearchWithScore:l}=rp(),u=g.useCallback(async(p,f)=>{var m,y,v;try{const b=o(e);if(!b)return;const w=(m=b.data)==null?void 0:m.entity;if(!w){a({variant:"destructive",title:r("vector_database_node.errors.vector_database_not_found")});return}if(w.storage===Vr.DataNode){const j=(v=(y=i({nodeId:e,type:"target"}).map(x=>o(x.source)).find(x=>(x==null?void 0:x.type)&&[ie.JSONLData,ie.CSVData].includes(x==null?void 0:x.type)))==null?void 0:y.data)==null?void 0:v.entity;if(!j){a({variant:"destructive",title:r("vector_database_node.errors.data_node_not_found")});return}return n(!0),await l(void 0,{database:{databaseId:w.id,dataSourceId:j.id,dataSourceType:WM(j)}},p,f==null?void 0:f.k)}else return n(!0),await l(void 0,{database:{databaseId:w.id}},p,f==null?void 0:f.k)}catch{a({variant:"destructive",title:r("vector_database_node.errors.similarity_search_failed")})}finally{n(!1)}},[i,e,l,a,r,o]),d=g.useCallback(async(p,f)=>{var m,y,v,b;try{const w=o(e);if(!w)return;n(!0);const j=p.content?[new vf({pageContent:p.content,id:p.id,metadata:{id:p.id}})]:p.documents;if(!(j!=null&&j.length)){a({variant:"destructive",title:r("vector_database_node.errors.content_not_found")});return}const x=(m=w.data)==null?void 0:m.entity;if(!x||!w){a({variant:"destructive",title:r("vector_database_node.errors.vector_database_not_found")});return}if(x.storage===Vr.DataNode){const _=i({nodeId:e,type:"target"}).map(M=>o(M.source)).find(M=>(M==null?void 0:M.type)&&[ie.JSONLData,ie.CSVData].includes(M==null?void 0:M.type)),S=(y=_==null?void 0:_.data)==null?void 0:y.entity;if(!S){a({variant:"destructive",title:r("vector_database_node.errors.data_node_not_found")});return}const E=WM(S),O=SE(j,10);let N=0;for(const M of O){if((v=f==null?void 0:f.onProgressReport)==null||v.call(f,{handling:M.length,handled:N,total:j.length}),await c(void 0,{database:{databaseId:x.id,dataSourceId:S.id,dataSourceType:E}},M),E&&_){const k=await ue(E).findOne({where:{id:S.id}});s([{type:"replace",id:_.id,item:{..._,data:{..._.data,entity:k}}}])}N+=M.length}}else{const _=SE(j,10);let S=0;for(const E of _){(b=f==null?void 0:f.onProgressReport)==null||b.call(f,{handling:E.length,handled:S,total:j.length}),await c(void 0,{database:{databaseId:x.id}},E);const O=await ue("VectorDatabase").findOne({where:{id:`${x.id}`}});s([{type:"replace",id:w.id,item:{...w,data:{...w.data,entity:O}}}]),S+=E.length}}}catch{a({variant:"destructive",title:r("vector_database_node.errors.similarity_search_failed")})}finally{n(!1)}},[i,e,c,a,r,o,s]);return{loading:t,indexData:d,similaritySearchWithScore:u}},LRe=g.memo(e=>{var S,E,O,N;const{t}=ke("flows"),[n,r]=g.useState(0),[a,o]=g.useState("search"),i=In(e.id),{id:s,data:c,isConnectable:l}=e,{loading:u,similaritySearchWithScore:d,indexData:p}=DRe(s),f=tn(PRe),m=tn(IRe);RRe(s);const y=g.useCallback(async(...M)=>{i&&await p(...M)},[p,i]),v=g.useCallback(async(M,k)=>{const P=M.trim(),A=await d(P,{k});if(A!=null&&A.length)return A},[d]),b=g.useCallback(M=>{f.show({source:i,documents:M.map(([k])=>k)})},[f,i]),w=g.useCallback(async()=>{m.show({source:i})},[m,i]),j=g.useCallback(async M=>{if(M.type.includes("text")||M.type.includes("txt")){const k=new FileReader;k.onload=async P=>{var C;const A=(C=P.target)==null?void 0:C.result;await y({content:A})},k.readAsText(M)}else if(M.type.endsWith("pdf")){const k=new Blob([M],{type:"application/pdf"}),P=await new $F(k,{pdfjs:async()=>{const A=await Ht(()=>import("./pdf.min-uhRye5Eo.js").then(async C=>(await C.__tla,C)),__vite__mapDeps([11,1,2,3,4]));return await Ht(()=>import("./pdf.worker.min-CTxugM4J.js").then(async C=>(await C.__tla,C)),__vite__mapDeps([12,1,2,3,4])),A.GlobalWorkerOptions.workerSrc=new URL("pdfjs-dist/build/pdf.worker.min.js",import.meta.url).toString(),A},parsedItemSeparator:" "}).load();await y({documents:P},{onProgressReport:A=>{r((A.handled+A.handling)/A.total)}})}},[y]),x=g.useMemo(()=>{var P,A;if(!((P=c==null?void 0:c.entity)!=null&&P.raw))return{headers:[],rows:[]};const M=["content","embedding","metadata"],k=Pv((A=c==null?void 0:c.entity)==null?void 0:A.raw);return{headers:M,rows:k.map(C=>{try{return JSON.parse(C)}catch{return[]}})}},[(S=c==null?void 0:c.entity)==null?void 0:S.raw]),_=g.useMemo(()=>{switch(a){case"search":return h.jsx(xa,{value:"search",children:h.jsx(GB,{loading:u,onSimilaritySearch:v,onCreatePrompt:b,onCreateRetriever:w})});case"new":return h.jsx(xa,{className:"min-w-80",value:"new",children:h.jsx(XB,{loading:u,onCreateData:y})});case"file":return h.jsx(xa,{value:"file",children:h.jsx(JB,{loading:u,progress:n,onFileSubmit:j,fileOptions:{accept:".pdf,.txt,.text",maxSize:2}})});case"view":return h.jsx(xa,{value:"view",children:h.jsx(Ly,{data:x.rows,headers:x.headers,limitLengthByColumns:{embedding:32}})})}},[y,b,w,j,v,u,a,n,x]);return h.jsxs("div",{className:"min-w-72",children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:l}),h.jsxs("div",{className:"max-w-full",children:[h.jsx(Bn,{id:s}),h.jsxs(Ar,{className:"flex justify-center",variant:"default",children:[h.jsx(pe,{size:24,name:"database-zap"}),h.jsxs("div",{className:"ml-2 max-w-full",children:[h.jsx(Uo,{children:`${((E=c.entity)==null?void 0:E.name)||""}`}),h.jsxs(eE,{value:a,onValueChange:o,defaultValue:"search",className:Z("w-full mt-4"),children:[h.jsxs(Ey,{className:Z("grid w-full grid-cols-3",((O=c.entity)==null?void 0:O.storage)===Vr.DatabaseNode?"grid-cols-4":"grid-cols-3"),children:[h.jsx(wa,{value:"search",children:t("vector_database_node.search")}),h.jsx(wa,{value:"new",children:t("vector_database_node.text")}),h.jsx(wa,{value:"file",children:t("vector_database_node.file")}),((N=c.entity)==null?void 0:N.storage)===Vr.DatabaseNode?h.jsx(wa,{value:"view",children:t("vector_database_node.view")}):void 0]}),_]})]})]})]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:l})]})}),$Re={embedding:32},FRe=g.memo(e=>{var o,i,s;const{id:t,data:n,isConnectable:r}=e,a=g.useMemo(()=>{var u;if(!((u=n==null?void 0:n.entity)!=null&&u.jsonl))return{headers:[],rows:[]};const c=HM(n.entity.headers||""),l=Pv(n.entity.jsonl);return{headers:c,rows:l.map(d=>{try{return JSON.parse(d)}catch{return[]}})}},[(o=n==null?void 0:n.entity)==null?void 0:o.jsonl,n.entity.headers]);return h.jsxs("div",{className:"min-w-80",children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsxs("div",{children:[h.jsx(Bn,{id:t}),h.jsxs(Gt,{className:"min-w-32 min-h-16 p-4",children:[h.jsx(Mn,{className:"!p-0",children:h.jsxs("div",{className:"pt-2 flex !flex-row",children:[h.jsx(pe,{name:"file-json",className:"mr-2"}),h.jsxs(Be,{className:"!font-medium leading-none tracking-tight pr-8",children:[ie.JSONLData," ",(i=a==null?void 0:a.rows)!=null&&i.length?`(${((s=a==null?void 0:a.rows)==null?void 0:s.length)||0})`:""]})]})}),h.jsx(kn,{className:"pb-0",children:h.jsx(Ly,{data:a.rows,headers:a.headers,limitLengthByColumns:$Re})})]})]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})}),KZ=60,ZZ=140,BRe=lo("supports-backdrop-blur:bg-white/10 supports-backdrop-blur:dark:bg-black/10 mx-auto flex h-[58px] w-max gap-2 rounded-lg border p-2 backdrop-blur-md"),GZ=W.forwardRef(({className:e,children:t,magnification:n=KZ,distance:r=ZZ,direction:a="bottom",...o},i)=>{const s=I0(1/0),c=()=>W.Children.map(t,l=>W.isValidElement(l)&&l.type===df?W.cloneElement(l,{...l.props,mouseX:s,magnification:n,distance:r}):l);return h.jsx(hf.div,{ref:i,onMouseMove:l=>s.set(l.pageX),onMouseLeave:()=>s.set(1/0),...o,className:Z(BRe({className:e}),{"items-start":a==="top","items-center":a==="middle","items-end":a==="bottom"}),children:c()})});GZ.displayName="Dock";const df=({magnification:e=KZ,distance:t=ZZ,mouseX:n,className:r,children:a,...o})=>{const i=g.useRef(null),s=Wk(n||new l3e,u=>{var p;const d=((p=i.current)==null?void 0:p.getBoundingClientRect())??{x:0,width:0};return u-d.x-d.width/2}),c=Wk(s,[-t,0,t],[40,e,40]),l=gX(c,{mass:.1,stiffness:150,damping:12});return h.jsx(hf.div,{ref:i,style:{width:l},className:Z("flex aspect-square cursor-pointer items-center justify-center rounded-full",r),...o,children:a})};df.displayName="DockIcon";let XZ,JZ,YZ,QZ,vv,eG,pf,tG,nG,rG,aG,oG,iG,sG,cG,lG,uG,dG,pG,fG,hG,mG,yG,gG,vG,bG,wG,xG;XZ=e=>g.createElement("svg",{viewBox:"0 0 256 254",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:256,height:254,preserveAspectRatio:"xMidYMid",...e},g.createElement("defs",null,g.createElement("linearGradient",{id:"c",x1:"50%",x2:"50%",y1:"0%",y2:"100%"},g.createElement("stop",{offset:"0%",stopColor:"#FFF"}),g.createElement("stop",{offset:"100%",stopColor:"#FFF",stopOpacity:0})),g.createElement("path",{id:"a",d:"M180.828 252.605a15.872 15.872 0 0 0 12.65-.486l52.501-25.262a15.94 15.94 0 0 0 9.025-14.364V41.197a15.939 15.939 0 0 0-9.025-14.363l-52.5-25.263a15.877 15.877 0 0 0-18.115 3.084L74.857 96.35l-43.78-33.232a10.614 10.614 0 0 0-13.56.603L3.476 76.494c-4.63 4.211-4.635 11.495-.012 15.713l37.967 34.638-37.967 34.637c-4.623 4.219-4.618 11.502.012 15.714l14.041 12.772a10.614 10.614 0 0 0 13.56.604l43.78-33.233 100.507 91.695a15.853 15.853 0 0 0 5.464 3.571Zm10.464-183.649-76.262 57.889 76.262 57.888V68.956Z"})),g.createElement("mask",{id:"b",fill:"#fff"},g.createElement("use",{xlinkHref:"#a"})),g.createElement("path",{fill:"#0065A9",d:"M246.135 26.873 193.593 1.575a15.885 15.885 0 0 0-18.123 3.08L3.466 161.482c-4.626 4.219-4.62 11.502.012 15.714l14.05 12.772a10.625 10.625 0 0 0 13.569.604L238.229 33.436c6.949-5.271 16.93-.315 16.93 8.407v-.61a15.938 15.938 0 0 0-9.024-14.36Z"}),g.createElement("path",{fill:"#007ACC",d:"m246.135 226.816-52.542 25.298a15.887 15.887 0 0 1-18.123-3.08L3.466 92.207c-4.626-4.218-4.62-11.502.012-15.713l14.05-12.773a10.625 10.625 0 0 1 13.569-.603l207.132 157.135c6.949 5.271 16.93.315 16.93-8.408v.611a15.939 15.939 0 0 1-9.024 14.36Z"}),g.createElement("path",{fill:"#1F9CF0",d:"M193.428 252.134a15.892 15.892 0 0 1-18.125-3.083c5.881 5.88 15.938 1.715 15.938-6.603V11.273c0-8.318-10.057-12.483-15.938-6.602a15.892 15.892 0 0 1 18.125-3.084l52.533 25.263a15.937 15.937 0 0 1 9.03 14.363V212.51c0 6.125-3.51 11.709-9.03 14.363l-52.533 25.262Z"}),g.createElement("path",{fill:"url(#c)",fillOpacity:.25,d:"M180.828 252.605a15.874 15.874 0 0 0 12.65-.486l52.5-25.263a15.938 15.938 0 0 0 9.026-14.363V41.197a15.939 15.939 0 0 0-9.025-14.363L193.477 1.57a15.877 15.877 0 0 0-18.114 3.084L74.857 96.35l-43.78-33.232a10.614 10.614 0 0 0-13.56.603L3.476 76.494c-4.63 4.211-4.635 11.495-.012 15.713l37.967 34.638-37.967 34.637c-4.623 4.219-4.618 11.502.012 15.714l14.041 12.772a10.614 10.614 0 0 0 13.56.604l43.78-33.233 100.506 91.695a15.857 15.857 0 0 0 5.465 3.571Zm10.464-183.65-76.262 57.89 76.262 57.888V68.956Z"})),JZ="/NoLLMChat/assets/plate-editor-C1jTW62C.png",YZ={[ie.Shape]:{width:100,height:100},[ie.CircleShape]:{width:100,height:100},[ie.TriangleShape]:{width:100,height:100},[ie.EditorApp]:{width:1240,height:400}},QZ=e=>{const t=In(e),n=Je(s=>s.currentSession),[r,a]=g.useState(!1),o=Ie(s=>s.createOrUpdateFlowNode),i=g.useCallback(async s=>{var c,l,u;try{if(a(!0),t&&(n==null?void 0:n.id)){const d=((c=t.position)==null?void 0:c.x)||0,p=(((l=t.position)==null?void 0:l.y)||0)+(((u=t.measured)==null?void 0:u.height)||0),f=await ue("FlowNodeData").save({data:{},session_id:n.id});if(!f)throw new Error("Failed to save node data");if(!await o({node_type:s,data:{},source_id:f.id,source_type:"FlowNodeData",x:d,y:p+20,...YZ[s]||{}}))throw new Error("Failed to save node")}}finally{a(!1)}},[o,n==null?void 0:n.id,t]);return{loading:r,createNode:i}},vv={applications:[{key:ie.EditorApp,image:JZ,label:"application_bar.editor"},{key:ie.VSLiteApp,icon:XZ,label:"application_bar.vslite"}],shapes:[{key:ie.Shape,icon:"square",label:"application_bar.square"},{key:ie.CircleShape,icon:"circle",label:"application_bar.circle"},{key:ie.TriangleShape,icon:"triangle",label:"application_bar.triangle"}],old:[{key:ie.CodeContainerApp,icon:"file-code-2",label:"application_bar.code_editor"}]},eG=g.memo(e=>{const{t}=ke("flows"),{toast:n}=nn(),{loading:r,createNode:a}=QZ(e.id),o=async i=>{try{if(r)return;await a(i)}catch{n({description:t("application_bar.errors.add_node_failed"),variant:"destructive"})}};return h.jsx(Tu,{children:h.jsxs(GZ,{direction:"middle",children:[vv.applications.map(i=>{const s=i.icon;return h.jsx(df,{children:h.jsxs($a,{children:[h.jsxs(Fa,{children:[s?h.jsx(s,{width:20,height:20,onClick:()=>o(i.key)}):void 0,i.image?h.jsx("img",{src:i.image,alt:t(i.label),className:"w-8 h-8 rounded-md",onClick:()=>o(i.key)}):void 0]}),h.jsx(Yr,{children:h.jsx("p",{children:t(i.label)})})]})},i.label)}),h.jsx(Gs,{orientation:"vertical",className:"h-full"}),vv.shapes.map(i=>h.jsx(df,{children:h.jsxs($a,{children:[h.jsx(Fa,{children:h.jsx(pe,{onClick:()=>o(i.key),name:i.icon})}),h.jsx(Yr,{children:h.jsx("p",{children:t(i.label)})})]})},i.label)),h.jsx(Gs,{orientation:"vertical",className:"h-full"}),vv.old.map(i=>h.jsx(df,{children:h.jsxs($a,{children:[h.jsx(Fa,{children:h.jsx(pe,{onClick:()=>o(i.key),name:i.icon})}),h.jsx(Yr,{children:h.jsx("p",{children:t(i.label)})})]})},i.label))]})})}),pf=g.memo(e=>{const{lineClassName:t,handleClassName:n,...r}=e;return h.jsx(Pde,{lineClassName:Z("!border-1.5",t),handleClassName:Z("!w-2 !h-2 !border-2 !rounded-full",n),...r})}),tG=e=>{const t=Ie(r=>r.createOrUpdateFlowEdge),n=g.useCallback(async({edgeId:r,source:a,target:o,connection:i})=>{try{if([ie.CircleShape,ie.TriangleShape].includes(a==null?void 0:a.type)&&(o==null?void 0:o.type)===ie.Shape){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},nG=g.memo(e=>{const{id:t,selected:n,isConnectable:r}=e;return tG(t),h.jsxs(h.Fragment,{children:[h.jsx(pf,{isVisible:!!n,minWidth:40,minHeight:40}),h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border border",children:h.jsx(Bn,{id:t})}),h.jsx(dt,{type:"source",position:he.Bottom,isConnectable:r})]})}),rG=e=>{const t=Ie(r=>r.createOrUpdateFlowEdge),n=g.useCallback(async({edgeId:r,source:a,target:o,connection:i})=>{try{if([ie.Shape,ie.TriangleShape].includes(a==null?void 0:a.type)&&(o==null?void 0:o.type)===ie.CircleShape){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},aG=g.memo(e=>{const{id:t,selected:n,isConnectable:r}=e;return rG(t),h.jsxs(h.Fragment,{children:[h.jsx(pf,{isVisible:!!n,minWidth:40,minHeight:40}),h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsx("div",{className:"min-w-10 min-h-10 w-full h-full bg-border rounded-full border",children:h.jsx(Bn,{id:t})}),h.jsx(dt,{type:"source",position:he.Bottom,isConnectable:r})]})}),oG=e=>{const t=Ie(r=>r.createOrUpdateFlowEdge),n=g.useCallback(async({edgeId:r,source:a,target:o,connection:i})=>{try{if([ie.CircleShape,ie.Shape].includes(a==null?void 0:a.type)&&(o==null?void 0:o.type)===ie.TriangleShape){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},iG=g.memo(e=>{const{id:t,selected:n,width:r,height:a,isConnectable:o}=e;return oG(t),h.jsxs(h.Fragment,{children:[h.jsx(pf,{isVisible:!!n,minWidth:40,minHeight:40}),h.jsx(dt,{type:"target",position:he.Top,isConnectable:o}),h.jsx("div",{className:"w-0 h-0 border-l-transparent border-r-transparent border-b-border",style:{borderLeftWidth:(r||0)/2,borderRightWidth:(r||0)/2,borderBottomWidth:a||0}}),h.jsx(Bn,{id:t,className:"absolute top-0 right-0"}),h.jsx(dt,{type:"source",position:he.Bottom,isConnectable:o})]})}),sG=e=>{const t=Ie(r=>r.createOrUpdateFlowEdge),n=g.useCallback(async({edgeId:r,source:a,target:o,connection:i})=>{try{if((a==null?void 0:a.type)===ie.LLM&&(o==null?void 0:o.type)===ie.EditorApp){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},cG=e=>{const t=In(e),{t:n}=ke("flows"),r=g.useRef(null),{toast:a}=nn(),{getNode:o,getHandleConnections:i}=br(),{stream:s}=nl(),c=g.useCallback(async d=>{t&&(clearTimeout(r.current),r.current=setTimeout(async()=>{await ue("FlowNode").update(t.id,{data:d})},150))},[t]),l=g.useCallback(async(d,p)=>{var f;if(t){const m=i({nodeId:e,type:"target"}).find(b=>{var w;return((w=o(b.source))==null?void 0:w.type)===ie.LLM}),y=m?o(m==null?void 0:m.source):void 0,v=(f=y==null?void 0:y.data)==null?void 0:f.entity;if(!y||!v)return a({variant:"destructive",description:n("editor_node.errors.llm_not_found")});if(y.data.status!==et.Loaded)return a({variant:"destructive",description:n("editor_node.errors.llm_not_loaded_yet")});try{return(await s(v.provider,typeof d=="string"?[new Ur(d)]:d,{onMessageUpdate:b=>{p==null||p(b.content)},llm:v})).content}catch(b){if(b instanceof Error&&b.message.includes("LLM_NOT_LOADED_YET"))return a({title:n("editor_node.errors.llm_not_loaded_yet")});a({variant:"destructive",title:n("editor_node.errors.stream_message_failed")})}}},[t,i,e,o,a,n,s]),u=g.useCallback(d=>{if(!o(d))return[];const p=[];return i({nodeId:d,type:"target"}).forEach(f=>{const m=o(f.source);!m||m.type!==ie.LLM||p.push({node:m,connections:[f]})}),p},[i,o]);return{createMessage:l,updateEditorContent:c,getLinkedConnections:u}},lG=g.lazy(()=>Ht(()=>import("./index-DYCql1Sf.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([13,1,2,14,15,7,16,4,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,3,56]))),uG=g.memo(e=>{var l;const{id:t,data:n,selected:r,isConnectable:a}=e;sG(t);const{createMessage:o,updateEditorContent:i,getLinkedConnections:s}=cG(t),c=g.useCallback(u=>{i(u)},[i]);return h.jsxs("div",{className:"w-full min-w-[1240px] h-full",children:[h.jsx(pf,{isVisible:!!r,minWidth:1240,minHeight:400}),h.jsx(dt,{type:"target",position:he.Top,isConnectable:a}),h.jsxs("div",{className:"min-w-10 min-h-10 w-full h-full rounded-lg border bg-background",children:[h.jsx(Bn,{className:"!z-[100]",id:t,enableToStandalone:!0,getLinkedConnections:s}),h.jsx(g.Suspense,{fallback:h.jsx("div",{className:"h-full w-ful rounded-lg flex justify-center items-center",children:h.jsx(pe,{name:"loader-circle",className:"animate-spin"})}),children:h.jsx("div",{className:"h-full w-ful rounded-lg","data-registry":"plate",children:h.jsx(lG,{defaultValue:(l=n==null?void 0:n.flowNode)==null?void 0:l.data,onValueChange:c,copilotStream:o})})})]}),h.jsx(dt,{type:"source",position:he.Bottom,isConnectable:a})]})}),dG=e=>{const t=g.useCallback(async({edgeId:n})=>{try{return{deleteEdgeId:n}}catch{return{deleteEdgeId:n}}},[]);qn(e,t)},pG=g.memo(e=>{var i,s;const{id:t,data:n,isConnectable:r}=e,{t:a}=ke("flows");dG(t);let o="";switch((i=n.entity)==null?void 0:i.placeholder_type){case"VECTOR_DATABASE_RETREIVER":o=a("placeholder_node.vector_database_retriever");break}return h.jsxs("div",{children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:r}),h.jsxs(Ar,{className:"flex justify-center max-w-80",variant:"default",children:[h.jsx(Bn,{id:t}),h.jsx(pe,{name:"land-plot",className:"w-7 h-7"}),h.jsxs("div",{className:"ml-2 pr-4",children:[h.jsx(Uo,{children:`${((s=n.entity)==null?void 0:s.placeholder)||""}`}),h.jsx(pl,{children:o?h.jsx(bn,{children:o}):void 0})]})]}),h.jsx(dt,{type:"source",position:he.Bottom,id:"a",isConnectable:r})]})}),fG=g.lazy(()=>Ht(()=>import("./CodeContainerApp-D0VlGn_D.js").then(async e=>(await e.__tla,e)).then(e=>e.C),__vite__mapDeps([62,1,2,14,60,6]))),hG=g.memo(e=>{const{id:t,isConnectable:n}=e;return h.jsxs("div",{className:"w-[1380px] h-[600px] rounded-lg border overflow-hidden shadow-sm",children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:n}),h.jsxs("div",{className:"w-full h-full rounded-lg border bg-card overflow-hidden",children:[h.jsx(Bn,{id:t}),h.jsx(g.Suspense,{fallback:h.jsx("div",{className:"h-full w-full flex justify-center items-center",children:h.jsx(pe,{name:"loader-circle",className:"animate-spin"})}),children:h.jsx(fG,{...e})})]}),h.jsx(dt,{type:"source",position:he.Bottom,isConnectable:n})]})}),mG=["empty-source","vite-vue","shadcn-react-vite","todo-app-react-vite","porfolio-nextjs"],yG=async e=>{switch(e){case"empty-source":return Ht(()=>import("./empty-source-Dw1dvL8s.js"),[]).then(t=>t.BASE);case"vite-vue":return Ht(()=>import("./vite-vue-Bmz2z3Fo.js"),[]).then(t=>t.BASE);case"shadcn-react-vite":return Ht(()=>import("./shadcn-react-vite-CDJ9BaE9.js"),[]).then(t=>t.BASE);case"todo-app-react-vite":return Ht(()=>import("./todo-app-react-vite-BBWBkRjR.js"),[]).then(t=>t.BASE);case"porfolio-nextjs":return Ht(()=>import("./porfolio-nextjs-DCkli5iW.js"),[]).then(t=>t.BASE);default:throw new Error(`Unknown source base: ${e}`)}},Nk=g.memo(({className:e,onUpdateSourceBase:t})=>{const{t:n}=ke("components"),[r,a]=g.useState();return h.jsxs(Gt,{className:Z("mw-full",e),children:[h.jsx(Mn,{className:"p-4",children:h.jsx($n,{children:n("add_source_base.title")})}),h.jsx(kn,{className:"p-4",children:h.jsxs("div",{className:"flex items-center justify-center w-full h-full flex-col",children:[h.jsxs(Ya,{onValueChange:o=>a(o),children:[h.jsx(ja,{className:"w-full mb-4",children:h.jsx(Qa,{placeholder:n("add_source_base.source_base_select_placeholder")})}),h.jsx(Sa,{children:mG.map(o=>h.jsx(Fn,{value:`${o}`,children:n(`add_source_base.sourcebases.${o.toLowerCase()}`)},`${o}`))})]}),h.jsx(Ye,{className:"w-full",onClick:async()=>r&&t(await yG(r)),children:n("add_source_base.update_source")})]})})]})}),gG=()=>{const{getNode:e,getHandleConnections:t}=br(),{stream:n}=nl(),r=g.useCallback(async(o,i)=>{await ue("FlowNode").update(o,{raw:x0(i)})},[]),a=g.useCallback(o=>{if(!e(o))return[];const i=[];return t({nodeId:o,type:"target"}).forEach(s=>{const c=e(s.source);!c||c.type!==ie.LLM||i.push({node:c,connections:[s]})}),i},[t,e]);return{sendMessage:g.useCallback(async(o,i,{onMessageUpdate:s,onResponseMessageCreate:c}={})=>{const l=i.map(d=>d.role==="system"?new kv(d.content):d.role==="user"?new Ur(d.content):new Aa(d.content));c==null||c();const{content:u}=await n(We.WebLLM,[...l,new Ur(o)],{onMessageUpdate:({content:d})=>{s==null||s({nodeData:{loading:!0,content:d}})},llm:void 0});return s==null||s({nodeData:{loading:!1,content:u}}),u},[n]),getLinkedConnections:a,updateCodeContainerData:r}},vG=e=>{const t=Ie(r=>r.createOrUpdateFlowEdge),n=g.useCallback(async({edgeId:r,source:a,target:o,connection:i})=>{try{if((a==null?void 0:a.type)===ie.LLM&&(o==null?void 0:o.type)===ie.VSLiteApp){await t({source:i.source,target:i.target,sourceHandle:i.sourceHandle,targetHandle:i.targetHandle});return}return{deleteEdgeId:r}}catch{return{deleteEdgeId:r}}},[t]);qn(e,n)},bG=g.lazy(()=>Ht(()=>import("./index-rmRFhhHt.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([57,1,2,14,21,35,4,58,59,60,3,61]))),wG=g.memo(e=>{var p,f,m,y;const{id:t,isConnectable:n,data:r}=e,[a,o]=g.useState((p=r==null?void 0:r.flowNode)!=null&&p.raw?E0(r.flowNode.raw):void 0),{updateCodeContainerData:i,getLinkedConnections:s,sendMessage:c}=gG();vG(t);const l=g.useCallback(async v=>{var b,w;(b=r==null?void 0:r.flowNode)!=null&&b.id&&(await i((w=r==null?void 0:r.flowNode)==null?void 0:w.id,v),o(v))},[(f=r==null?void 0:r.flowNode)==null?void 0:f.id,i]),u=g.useCallback(async(v,b)=>{var w;return(w=r==null?void 0:r.flowNode)!=null&&w.id?await c(v,b):void 0},[(m=r==null?void 0:r.flowNode)==null?void 0:m.id,c]),d=g.useCallback(async v=>{o(b=>{var j;const w=O0(b||{},v);return i((j=r==null?void 0:r.flowNode)==null?void 0:j.id,w),w})},[(y=r==null?void 0:r.flowNode)==null?void 0:y.id,i]);return a?h.jsxs("div",{className:"w-[1380px] h-[600px] rounded-lg border overflow-hidden shadow-sm",children:[h.jsx(dt,{type:"target",position:he.Top,isConnectable:n}),h.jsxs("div",{className:"w-full h-full rounded-lg border bg-card overflow-hidden",children:[h.jsx(Bn,{id:t,className:"z-50",enableToStandalone:!0,getLinkedConnections:s}),h.jsx(g.Suspense,{fallback:h.jsx("div",{className:"h-full w-full flex justify-center items-center",children:h.jsx(pe,{name:"loader-circle",className:"animate-spin"})}),children:h.jsx(bG,{fileSystemTree:a,onUpdateFileContent:d,sendMessage:u})})]}),h.jsx(dt,{type:"source",position:he.Bottom,isConnectable:n})]}):h.jsx("div",{className:"h-full flex justify-center items-center",children:h.jsx(Nk,{className:"w-64",onUpdateSourceBase:l})})}),xG={[ie.LLM]:B7,[ie.Toolbox]:T7,[ie.Thread]:W7,[ie.Message]:q1e,[ie.Prompt]:H1e,[ie.SessionInfo]:wRe,[ie.Schema]:_Re,[ie.CSVData]:jRe,[ie.ToolDefinition]:ERe,[ie.DefaultEmbeddingModel]:MRe,[ie.VectorDatabase]:LRe,[ie.JSONLData]:FRe,[ie.ApplicationBar]:eG,[ie.Shape]:nG,[ie.CircleShape]:aG,[ie.TriangleShape]:iG,[ie.EditorApp]:uG,[ie.PlaceHolder]:pG,[ie.CodeContainerApp]:hG,[ie.VSLiteApp]:wG};function zRe(e,t=[]){let n=[];function r(o,i){const s=g.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:p,children:f,...m}=d,y=(p==null?void 0:p[e][c])||s,v=g.useMemo(()=>m,Object.values(m));return h.jsx(y.Provider,{value:v,children:f})}function u(d,p){const f=(p==null?void 0:p[e][c])||s,m=g.useContext(f);if(m)return m;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return l.displayName=o+"Provider",[l,u]}const a=()=>{const o=n.map(i=>g.createContext(i));return function(i){const s=(i==null?void 0:i[e])||o;return g.useMemo(()=>({[`__scope${e}`]:{...i,[e]:s}}),[i,s])}};return a.scopeName=e,[r,URe(a,...t)]}function URe(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=r.reduce((i,{useScope:s,scopeName:c})=>{const l=s(a)[`__scope${c}`];return{...i,...l}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return n.scopeName=t.scopeName,n}var VRe="Toggle",PM=g.forwardRef((e,t)=>{const{pressed:n,defaultPressed:r=!1,onPressedChange:a,...o}=e,[i=!1,s]=Tn({prop:n,onChange:a,defaultProp:r});return h.jsx(Ae.button,{type:"button","aria-pressed":i,"data-state":i?"on":"off","data-disabled":e.disabled?"":void 0,...o,ref:t,onClick:ge(e.onClick,()=>{e.disabled||s(!i)})})});PM.displayName=VRe;let AM,Us,TM,IM,bv;AM=PM,Us="ToggleGroup",[TM,eX]=zRe(Us,[fo]),IM=fo(),bv=W.forwardRef((e,t)=>{const{type:n,...r}=e;if(n==="single"){const a=r;return h.jsx(qRe,{...a,ref:t})}if(n==="multiple"){const a=r;return h.jsx(WRe,{...a,ref:t})}throw new Error(`Missing prop \`type\` expected on \`${Us}\``)}),bv.displayName=Us;var[_G,jG]=TM(Us),qRe=W.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...o}=e,[i,s]=Tn({prop:n,defaultProp:r,onChange:a});return h.jsx(_G,{scope:e.__scopeToggleGroup,type:"single",value:i?[i]:[],onItemActivate:s,onItemDeactivate:W.useCallback(()=>s(""),[s]),children:h.jsx(SG,{...o,ref:t})})}),WRe=W.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...o}=e,[i=[],s]=Tn({prop:n,defaultProp:r,onChange:a}),c=W.useCallback(u=>s((d=[])=>[...d,u]),[s]),l=W.useCallback(u=>s((d=[])=>d.filter(p=>p!==u)),[s]);return h.jsx(_G,{scope:e.__scopeToggleGroup,type:"multiple",value:i,onItemActivate:c,onItemDeactivate:l,children:h.jsx(SG,{...o,ref:t})})});bv.displayName=Us;var[HRe,KRe]=TM(Us),SG=W.forwardRef((e,t)=>{const{__scopeToggleGroup:n,disabled:r=!1,rovingFocus:a=!0,orientation:o,dir:i,loop:s=!0,...c}=e,l=IM(n),u=ai(i),d={role:"group",dir:u,...c};return h.jsx(HRe,{scope:n,rovingFocus:a,disabled:r,children:a?h.jsx(uu,{asChild:!0,...l,orientation:o,dir:u,loop:s,children:h.jsx(Ae.div,{...d,ref:t})}):h.jsx(Ae.div,{...d,ref:t})})}),wv="ToggleGroupItem",EG=W.forwardRef((e,t)=>{const n=jG(wv,e.__scopeToggleGroup),r=KRe(wv,e.__scopeToggleGroup),a=IM(e.__scopeToggleGroup),o=n.value.includes(e.value),i=r.disabled||e.disabled,s={...e,pressed:o,disabled:i},c=W.useRef(null);return r.rovingFocus?h.jsx(du,{asChild:!0,...a,focusable:!i,active:o,ref:c,children:h.jsx(RM,{...s,ref:t})}):h.jsx(RM,{...s,ref:t})});EG.displayName=wv;let RM;RM=W.forwardRef((e,t)=>{const{__scopeToggleGroup:n,value:r,...a}=e,o=jG(wv,n),i={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},s=o.type==="single"?i:void 0;return h.jsx(PM,{...s,...a,ref:t,onPressedChange:c=>{c?o.onItemActivate(r):o.onItemDeactivate(r)}})}),Uv=bv,Vv=EG;const OG=lo("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),ZRe=g.forwardRef(({className:e,variant:t,size:n,...r},a)=>h.jsx(AM,{ref:a,className:Z(OG({variant:t,size:n,className:e})),...r}));ZRe.displayName=AM.displayName;const CG=g.createContext({size:"default",variant:"default"}),NG=g.forwardRef(({className:e,variant:t,size:n,children:r,...a},o)=>h.jsx(Uv,{ref:o,className:Z("flex items-center justify-center gap-1",e),...a,children:h.jsx(CG.Provider,{value:{variant:t,size:n},children:r})}));NG.displayName=Uv.displayName;const MG=g.forwardRef(({className:e,children:t,variant:n,size:r,...a},o)=>{const i=g.useContext(CG);return h.jsx(Vv,{ref:o,className:Z(OG({variant:i.variant||n,size:i.size||r}),e),...a,children:t})});MG.displayName=Vv.displayName;function GRe(){const e=tt(t=>`x: ${t.transform[0].toFixed(2)}, y: ${t.transform[1].toFixed(2)}, zoom: ${t.transform[2].toFixed(2)}`);return h.jsx("div",{children:e})}function XRe({change:e}){var r,a,o,i;const t="id"in e?e.id:"-",{type:n}=e;return h.jsxs("div",{className:"mb-3",children:[h.jsxs("div",{children:["node id: ",t]}),h.jsxs("div",{children:[n==="add"?JSON.stringify(e.item,null,2):null,n==="dimensions"?`dimensions: ${(r=e.dimensions)==null?void 0:r.width} \xD7 ${(a=e.dimensions)==null?void 0:a.height}`:null,n==="position"?`position: ${(o=e.position)==null?void 0:o.x.toFixed(1)}, ${(i=e.position)==null?void 0:i.y.toFixed(1)}`:null,n==="remove"?"remove":null,n==="select"?e.selected?"select":"unselect":null]})]})}function JRe({limit:e=20}){const[t,n]=g.useState([]),r=Lt(),a=g.useCallback(i=>{n(s=>[...i,...s].slice(0,e))},[e]);g.useEffect(()=>(r.setState({onNodesChange:a}),()=>r.setState({onNodesChange:void 0})),[a,r]);const o=()=>h.jsx("div",{children:"No Changes Triggered"});return h.jsx(h.Fragment,{children:t.length===0?h.jsx(o,{}):t.map((i,s)=>h.jsx(XRe,{change:i},s))})}function YRe(){const{getInternalNode:e}=br(),t=EL();return h.jsx(ade,{children:h.jsx("div",{className:"text-secondary-foreground",children:t.map(n=>{var o,i;const r=e(n.id);if(!r)return null;const a=r==null?void 0:r.internals.positionAbsolute;return h.jsx(QRe,{id:n.id,selected:!!n.selected,type:n.type||"default",position:n.position,absPosition:a,width:((o=n.measured)==null?void 0:o.width)??0,height:((i=n.measured)==null?void 0:i.height)??0,data:n.data},n.id)})})})}function QRe({id:e,type:t,selected:n,position:r,absPosition:a,width:o,height:i,data:s}){if(!o||!i)return null;const c=`translate(${a.x}px, ${a.y+i}px)`,l=`${r.x.toFixed(1)}, ${r.y.toFixed(1)}`,u=`${o} \xD7 ${i}`,d=n?"Selected":"Not Selected";return h.jsxs("div",{style:{position:"absolute",transform:c,width:o*2},className:"text-xs",children:[h.jsxs("div",{children:["id: ",e]}),h.jsxs("div",{children:["type: ",t]}),h.jsxs("div",{children:["selected: ",d]}),h.jsxs("div",{children:["position: ",l]}),h.jsxs("div",{children:["dimensions: ",u]}),h.jsxs("div",{children:["data: ",JSON.stringify(s,null,2)]})]})}function eDe({tools:e}){return h.jsx(kc,{position:"top-left",className:"bg-card p-1 border rounded shadow-sm",children:h.jsx(NG,{type:"multiple",children:e.map(({active:t,setActive:n,label:r,value:a})=>h.jsx(MG,{value:a,onClick:()=>n(o=>!o),"aria-pressed":t,className:"bg-card text-card-foreground transition-colors duration-300 hover:bg-secondary hover:text-secondary-foreground",children:r},a))})})}function kG(){const[e,t]=g.useState(!1),[n,r]=g.useState(!1),[a,o]=g.useState(!1),i=[{active:e,setActive:t,label:"Node Inspector",value:"node-inspector"},{active:n,setActive:r,label:"Change Logger",value:"change-logger"},{active:a,setActive:o,label:"Viewport Logger",value:"viewport-logger"}];return h.jsxs(h.Fragment,{children:[h.jsx(eDe,{tools:i}),n&&h.jsx(kc,{className:"text-xs p-5 bg-white rounded shadow-md overflow-y-auto max-h-[50%] mt-20",position:"bottom-right",children:h.jsx(JRe,{})}),e&&h.jsx(YRe,{}),a&&h.jsx(kc,{position:"bottom-left",className:"text-secondary-foreground",children:h.jsx(GRe,{})})]})}kG.displayName="DevTools";const tDe=()=>{const e=g.useRef({}),t=g.useRef({}),n=Ie(N=>N.flowEdges),r=Je(N=>N.currentSession),a=Ie(N=>N.setNodes),o=Ie(N=>N.updateNodes),i=Ie(N=>N.updateEdges),s=Ie(N=>N.addConnectionToEdges),c=Ie(N=>N.reset),l=Ie(N=>N.findFlowEdges),u=Ie(N=>N.deleteFlowNode),d=Ie(N=>N.deleteFlowEdge),p=Ie(N=>N.updateFlowNode),f=Ie(N=>N.getNodes),m=Ie(N=>N.findFlowNodesWithSource),y=g.useRef(n),v=g.useRef(),[b,w]=g.useState({loading:!1});y.current=n;const j=g.useCallback(async(N,M)=>{try{v.current=N,c(),await(M==null?void 0:M())}catch{v.current=void 0}},[c]),x=g.useCallback(async N=>{try{if(!(r!=null&&r.id))return;w(P=>({...P,loading:!0}));const M=await m({...N,where:{...N.where,session_id:r.id}}),k=await l({where:[{source:Ha(M.map(P=>P.id))},{target:Ha(M.map(P=>P.id))}]});return{flowNodes:M,flowEdges:k}}finally{w(M=>({...M,loading:!1}))}},[m,l,r==null?void 0:r.id]),_=g.useCallback(async N=>{var M,k;for(const P of N)if("id"in P&&Object.values(bi).includes(P.id)&&P.type!=="remove")o([P]);else if(P.type==="position"&&P.position&&!isNaN(P.position.x)&&!isNaN(P.position.y)){o([P]);const A=P.position.x,C=P.position.y;clearTimeout(e.current[P.id]),e.current[P.id]=setTimeout(async()=>{e.current[P.id]=void 0,await p({id:P.id,x:A,y:C},{silent:!0})},200)}else if(P.type==="remove"){const A=(M=f([P.id]))==null?void 0:M[0];if(!(A!=null&&A.type)||Mpe.includes(A.type))return;await u({id:P.id})}else if(P.type==="dimensions"&&P.dimensions&&!isNaN(P.dimensions.width)&&!isNaN(P.dimensions.height)){const A=(k=f([P.id]))==null?void 0:k[0];if(!(A!=null&&A.width)&&!(A!=null&&A.height))return;o([P]),clearTimeout(t.current[P.id]);const C=P.dimensions.width,I=P.dimensions.height;t.current[P.id]=setTimeout(async()=>{await p({id:P.id,width:C,height:I},{silent:!0})},200)}else P.type==="select"&&o([P])},[o,p,f,u]),S=g.useCallback(N=>{Promise.all(N.map(async M=>{if(M.type==="remove")return d({id:M.id})})),i(N)},[d,i]),E=g.useCallback(N=>{s(N)},[s]),O=g.useCallback(N=>{a(M=>{var C,I;let k;if(typeof N=="function"?k=N(M):k=N,!k)return M;const P=M==null?void 0:M.find(T=>T.id===k.id),A={id:k.id,item:P?xm(P,k):{...k,position:{x:((C=k.position)==null?void 0:C.x)||0,y:((I=k.position)==null?void 0:I.y)||0}},type:P?"replace":"add"};return ps([A],M)})},[a]);return{initialFlow:j,loadingState:b,prepareFlowInfo:x,updateNodeChanges:_,updateEdgeChanges:S,updateOrCreateNode:O,currentSessionIdRef:v,updateEdgeConnection:E}},nDe=e=>{const t=Je(l=>{var u;return(u=l.currentSession)==null?void 0:u.id}),{loadingState:n,prepareFlowInfo:r,initialFlow:a,currentSessionIdRef:o}=e,i=Ie(l=>l.ready),s=Ie(l=>l.removeSyncNodeQueue),c=Ie(l=>l.removeSyncEdgeQueue);g.useLayoutEffect(()=>{},[t]),g.useEffect(()=>{n.loading||!i||!t||o.current===t||a(t,async()=>{await r({where:{session_id:t}})})},[a,r,n.loading,o,i,t]),g.useEffect(()=>{const l=Ie.subscribe(d=>d.syncNodeQueue,async(d,p)=>{const f=p.map(y=>y.timestamp),m=d.filter(y=>!f.includes(y.timestamp));m.length&&s(m.map(y=>y.timestamp))}),u=Ie.subscribe(d=>d.syncEdgeQueue,async(d,p)=>{const f=p.map(y=>y.timestamp),m=d.filter(y=>!f.includes(y.timestamp));m.length&&c(m.map(y=>y.timestamp))});return()=>{l(),u()}},[r,c,s])},rDe=()=>{const[e,t]=g.useState(!0),n=tDe(),r=co(u=>u.selectedModel),a=g.useRef(r),o=co(u=>u.setInitProgressCallback),{updateOrCreateNode:i,updateNodeChanges:s,updateEdgeChanges:c,updateEdgeConnection:l}=n;return nDe(n),a.current=r,g.useEffect(()=>{const u=o==null?void 0:o(d=>{if(!a.current)return;const p=`${a.current}`;i(f=>{const m=f==null?void 0:f.find(y=>{var v;return(v=y.data)!=null&&v.entity&&typeof y.data.entity=="object"&&"name"in y.data.entity?y.data.entity.name===p:!1});if(m)return m.data.label=d.text,m.data.status=et.Loading,d.progress===100&&(m.data.label="",m.data.status=et.Loaded),m})});return()=>{u==null||u()}},[o,i]),g.useMemo(()=>({updateNodeChanges:s,updateEdgeChanges:c,initializing:e,setInitializing:t,updateEdgeConnection:l}),[s,c,e,t,l])},aDe=()=>{const e=eu(l=>l.theme),t=Ie(l=>l.nodes),n=Ie(l=>l.edges),{updateNodeChanges:r,updateEdgeChanges:a,updateEdgeConnection:o}=rDe(),i=g.useCallback(l=>{r(l)},[r]),s=g.useCallback(l=>{a(l)},[a]),c=g.useCallback(l=>{o(l)},[o]);return h.jsxs(nde,{nodes:t,edges:n,nodeTypes:xG,onNodesChange:i,onEdgesChange:s,onConnect:c,panOnScroll:!0,panOnScrollMode:mi.Free,colorMode:e,fitView:!0,children:[h.jsx(ude,{variant:Lo.Dots,gap:24,size:1}),h.jsx(gde,{}),h.jsx(Mde,{}),u3e?h.jsx(kG,{}):void 0]})},oDe=g.memo(aDe);function iDe(){return h.jsx(oDe,{})}const sDe=g.lazy(()=>Ht(()=>import("./DocumentViewer-YyJ3Pu3j.js").then(async e=>(await e.__tla,e)),__vite__mapDeps([63,1,2,15]))),cDe=()=>{const{documentId:e}=$f();return h.jsx(g.Suspense,{fallback:h.jsx(ru,{flickeringGrid:!0,className:"w-full h-full"}),children:h.jsx(sDe,{name:e||""})})};function xv(){const e=NP();return Ws(e),h.jsx(d3e,{})}const lDe=LJ(h.jsxs(ci,{errorElement:h.jsx(xv,{}),children:[h.jsxs(ci,{element:h.jsx(fI,{requiredSession:!0}),children:[h.jsx(ci,{path:fh.whiteboard,Component:iDe,errorElement:h.jsx(xv,{})}),h.jsx(ci,{path:fh.application,errorElement:h.jsx(xv,{}),Component:dxe}),h.jsx(ci,{path:"*",element:h.jsx(IJ,{to:dn("whiteboard")})})]}),h.jsx(ci,{element:h.jsx(fI,{}),children:h.jsx(ci,{path:fh.document,errorElement:h.jsx(xv,{}),Component:cDe})})]})),uDe=(e,t)=>{switch($ee){case"browser":return LP(e,t);case"hash":return sY(e);default:return LP(e,t)}},dDe=uDe(lDe,{basename:"/NoLLMChat/"});GG("[BASE_URL]","/NoLLMChat/");let PG;PG=g.memo(()=>{const e=!window.location.pathname.includes("/NoLLMChat/");return g.useLayoutEffect(()=>{e&&(window.location.href="/NoLLMChat/".replace("//","/"))},[e]),e?h.jsx(ru,{className:"w-screen h-screen",simple:!0}):h.jsx(vY,{router:dDe})},()=>!0),oX=Object.freeze(Object.defineProperty({__proto__:null,default:PG},Symbol.toStringTag,{value:"Module"}))});export{ou as $,KM as A,Av as B,ZM as C,GM as D,iu as E,Tv as F,su as G,Ki as H,bf as I,wf as J,Iv as K,XM as L,JM as M,Hs as N,YM as O,QM as P,ek as Q,tk as R,Rv as S,nk as T,rk as U,ak as V,ok as W,ik as X,sk as Y,Dv as Z,Rt as _,h3e as __tla,Lv as a,$v as a$,cu as a0,Zi as a1,Gi as a2,xf as a3,lu as a4,Ks as a5,Zs as a6,ck as a7,Fv as a8,lk as a9,uk as aA,QG as aB,Bv as aC,dk as aD,zv as aE,pk as aF,fo as aG,eX as aH,ai as aI,uu as aJ,du as aK,Uv as aL,Vv as aM,qv as aN,Wv as aO,Hv as aP,Kv as aQ,Zv as aR,Gv as aS,fk as aT,hk as aU,_f as aV,Xv as aW,Jv as aX,Yv as aY,Qv as aZ,e0 as a_,mk as aa,tX as ab,t0 as ac,nX as ad,yk as ae,gk as af,vk as ag,n0 as ah,bk as ai,rX as aj,r0 as ak,a0 as al,o0 as am,wk as an,i0 as ao,s0 as ap,c0 as aq,l0 as ar,u0 as as,d0 as at,xk as au,_k as av,aX as aw,p0 as ax,jk as ay,Sk as az,pu as b,f0 as b0,h0 as b1,m0 as b2,jf as b3,En as b4,y0 as b5,Sf as b6,g0 as b7,v0 as b8,fu as b9,oX as bA,hu as ba,b0 as bb,Ef as bc,Be as bd,Gs as be,mu as bf,w0 as bg,Yn as bh,Ie as bi,qn as bj,In as bk,x0 as bl,_0 as bm,Ek as bn,Ok as bo,j0 as bp,S0 as bq,Ye as br,Ck as bs,E0 as bt,O0 as bu,Nk as bv,Mk as bw,kk as bx,Xs as by,oi as bz,Pk as c,qr as d,C0 as e,Ak as f,Tk as g,Js as h,Wr as i,N0 as j,M0 as k,Ik as l,Ta as m,Rk as n,k0 as o,P0 as p,Dk as q,Lk as r,$k as s,A0 as t,Wn as u,yu as v,T0 as w,gu as x,Ys as y,Fk as z};
