const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BQ8Gn5fu.js","assets/index-BJoMvrGn.js","assets/index-B7JTfCGt.css","assets/copy-DMx1oqjh.js","assets/createLucideIcon-B8XkSs97.js","assets/refresh-ccw-DZlr816t.js","assets/volume-2-DuuhrYCq.js","assets/index-BQCnMJUN.js","assets/objectWithoutPropertiesLoose-BjXSgPXB.js","assets/index-BtKEEgba.js","assets/index-Cr8Tc6mT.css","assets/HomePage-DNmSHrP7.js"])))=>i.map(i=>d[i]);
import{r as m,M as L6,j as x,u as GM,P as $6,a as B6,L as F6,R as JM,b as z6,c as dr,d as hr,e as uo,f as Ue,g as Me,h as on,i as yt,k as ne,l as Un,S as Hn,m as qn,D as uf,n as V6,o as df,p as $e,q as eC,s as tC,t as W6,v as an,w as hf,x as kt,y as pf,z as nC,A as Oa,B as rC,C as je,E as oC,F as aC,G as U6,H as iC,I as Fs,J as Qn,K as sC,N as zs,O as ho,Q as H6,T as q6,U as lC,V as lt,W as Q6,X as pr,Y as Vs,Z as Ws,_ as K6,$ as Y6,a0 as X6,a1 as Z6,a2 as ff,a3 as G6,a4 as cC,a5 as J6,__tla as eL}from"./index-BJoMvrGn.js";import tL,{__tla as nL}from"./copy-DMx1oqjh.js";import rL,{__tla as oL}from"./refresh-ccw-DZlr816t.js";import aL,{__tla as iL}from"./volume-2-DuuhrYCq.js";let uC,mf,Us,yf,Aa,Hs,ka,gf,qs,vf,Qs,ja,xf,Ra,Pa,fr,bf,mr,wf,Ef,Ks,Kn,dC,_f,Ys,Mf,Ta,Xs,yr,hC,Cf,pC,fC,Nf,Ia,Sf,Zs,Gs,Js,el,Of,tl,po,nl,rl,ol,al,Da,il,La,Af,kf,jf,$a,Ba,Qt,sl,Rf,Pf,Tf,If,Fa,Df,Lf,$f,ll,za,cl,Va,fo,xe,mo,mC,yC,ul,dl,Bf,Ff,zf,hl,Wa,Ua,sn,Vf,gr,ln,vr,pl,xr,Wf,Uf,Hf,qf,fl,ml,Ha,ke,He,gC,vC,yo,xC,qa,Yn,bC,Qf,Kf,yl,Yf,Xf,Zf,wC,gl,Gf,EC,vl,xl,bl,Jf,wl,El,_l,Ml,Cl,Nl,em,tm,_C,Sl,Ol,Al,kl,Xn,MC,An,CC,NC,jl,nm,rm,Rl,om,am,Pl,im,sm,Tl,lm,cm,Il,go,br,Dl,um,dm,hm,pm,fm,Ll,$l,mm,ym,gm,vo,wr,Er,SC,vm,xm,bm,Bl,wm,OC,Em,Fl,zl,_m,Mm,cn,Cm,Nm,Sm,jt,Om,Am,km,It,jm,Rm,AC,Vl,Dt,Pm,Tm,xo,Wl,sL=Promise.all([(()=>{try{return eL}catch{}})(),(()=>{try{return nL}catch{}})(),(()=>{try{return oL}catch{}})(),(()=>{try{return iL}catch{}})()]).then(async()=>{Dt=(t=>(t.Started="started",t.Downloading="downloading",t.Downloaded="downloaded",t.Loading="loading",t.Loaded="loaded",t))(Dt||{}),Tm=(t=>(t.LLM="LLM",t.embedding="embedding",t.VLM="VLM",t))(Tm||{}),Pm=(t=>(t.WebLLM="WebLLM",t.OpenAI="OpenAI",t))(Pm||{}),hl=(t=>(t.VECTOR_DATABASE_RETREIVER="VECTOR_DATABASE_RETREIVER",t))(hl||{});class jC extends m.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function RC({children:t,isPresent:e}){const n=m.useId(),r=m.useRef(null),o=m.useRef({width:0,height:0,top:0,left:0}),{nonce:a}=m.useContext(L6);return m.useInsertionEffect(()=>{const{width:i,height:s,top:l,left:c}=o.current;if(e||!r.current||!i||!s)return;r.current.dataset.motionPopId=n;const d=document.createElement("style");return a&&(d.nonce=a),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${s}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[e]),x.jsx(jC,{isPresent:e,childRef:r,sizeRef:o,children:m.cloneElement(t,{ref:r})})}const PC=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:o,presenceAffectsLayout:a,mode:i})=>{const s=GM(TC),l=m.useId(),c=m.useCallback(u=>{s.set(u,!0);for(const h of s.values())if(!h)return;r&&r()},[s,r]),d=m.useMemo(()=>({id:l,initial:e,isPresent:n,custom:o,onExitComplete:c,register:u=>(s.set(u,!1),()=>s.delete(u))}),a?[Math.random(),c]:[n,c]);return m.useMemo(()=>{s.forEach((u,h)=>s.set(h,!1))},[n]),m.useEffect(()=>{!n&&!s.size&&r&&r()},[n]),i==="popLayout"&&(t=x.jsx(RC,{isPresent:n,children:t})),x.jsx($6.Provider,{value:d,children:t})};function TC(){return new Map}const Qa=t=>t.key||"";function Dm(t){const e=[];return m.Children.forEach(t,n=>{m.isValidElement(n)&&e.push(n)}),e}const IC=({children:t,exitBeforeEnter:e,custom:n,initial:r=!0,onExitComplete:o,presenceAffectsLayout:a=!0,mode:i="sync"})=>{const s=m.useMemo(()=>Dm(t),[t]),l=s.map(Qa),c=m.useRef(!0),d=m.useRef(s),u=GM(()=>new Map),[h,p]=m.useState(s),[y,f]=m.useState(s);B6(()=>{c.current=!1,d.current=s;for(let b=0;b<y.length;b++){const w=Qa(y[b]);l.includes(w)?u.delete(w):u.get(w)!==!0&&u.set(w,!1)}},[y,l.length,l.join("-")]);const v=[];if(s!==h){let b=[...s];for(let w=0;w<y.length;w++){const E=y[w],M=Qa(E);l.includes(M)||(b.splice(w,0,E),v.push(E))}i==="wait"&&v.length&&(b=v),f(Dm(b)),p(s);return}const{forceRender:g}=m.useContext(F6);return x.jsx(x.Fragment,{children:y.map(b=>{const w=Qa(b),E=s===y||l.includes(w),M=()=>{if(u.has(w))u.set(w,!0);else return;let S=!0;u.forEach(N=>{N||(S=!1)}),S&&(g==null||g(),f(d.current),o&&o())};return x.jsx(PC,{isPresent:E,initial:!c.current||r?void 0:!1,custom:E?void 0:n,presenceAffectsLayout:a,mode:i,onExitComplete:E?void 0:M,children:b},w)})})};function Xe(){return Xe=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Xe.apply(this,arguments)}var ot;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ot||(ot={}));const Lm="popstate";function DC(t){t===void 0&&(t={});function e(r,o){let{pathname:a,search:i,hash:s}=r.location;return bo("",{pathname:a,search:i,hash:s},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){return typeof o=="string"?o:wo(o)}return $C(e,n,null,t)}function Ne(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function _r(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function LC(){return Math.random().toString(36).substr(2,8)}function $m(t,e){return{usr:t.state,key:t.key,idx:e}}function bo(t,e,n,r){return n===void 0&&(n=null),Xe({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?kn(e):e,{state:n,key:e&&e.key||r||LC()})}function wo(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function kn(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function $C(t,e,n,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:a=!1}=r,i=o.history,s=ot.Pop,l=null,c=d();c==null&&(c=0,i.replaceState(Xe({},i.state,{idx:c}),""));function d(){return(i.state||{idx:null}).idx}function u(){s=ot.Pop;let v=d(),g=v==null?null:v-c;c=v,l&&l({action:s,location:f.location,delta:g})}function h(v,g){s=ot.Push;let b=bo(f.location,v,g);c=d()+1;let w=$m(b,c),E=f.createHref(b);try{i.pushState(w,"",E)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;o.location.assign(E)}a&&l&&l({action:s,location:f.location,delta:1})}function p(v,g){s=ot.Replace;let b=bo(f.location,v,g);c=d();let w=$m(b,c),E=f.createHref(b);i.replaceState(w,"",E),a&&l&&l({action:s,location:f.location,delta:0})}function y(v){let g=o.location.origin!=="null"?o.location.origin:o.location.href,b=typeof v=="string"?v:wo(v);return b=b.replace(/ $/,"%20"),Ne(g,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,g)}let f={get action(){return s},get location(){return t(o,i)},listen(v){if(l)throw new Error("A history only accepts one active listener");return o.addEventListener(Lm,u),l=v,()=>{o.removeEventListener(Lm,u),l=null}},createHref(v){return e(o,v)},createURL:y,encodeLocation(v){let g=y(v);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:p,go(v){return i.go(v)}};return f}var Fe;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Fe||(Fe={}));const BC=new Set(["lazy","caseSensitive","path","id","index","children"]);function FC(t){return t.index===!0}function Eo(t,e,n,r){return n===void 0&&(n=[]),r===void 0&&(r={}),t.map((o,a)=>{let i=[...n,String(a)],s=typeof o.id=="string"?o.id:i.join("-");if(Ne(o.index!==!0||!o.children,"Cannot specify children on an index route"),Ne(!r[s],'Found a route id collision on id "'+s+`".  Route id's must be globally unique within Data Router usages`),FC(o)){let l=Xe({},o,e(o),{id:s});return r[s]=l,l}else{let l=Xe({},o,e(o),{id:s,children:void 0});return r[s]=l,o.children&&(l.children=Eo(o.children,e,i,r)),l}})}function Zn(t,e,n){return n===void 0&&(n="/"),Ka(t,e,n,!1)}function Ka(t,e,n,r){let o=typeof e=="string"?kn(e):e,a=_o(o.pathname||"/",n);if(a==null)return null;let i=Bm(t);VC(i);let s=null;for(let l=0;s==null&&l<i.length;++l){let c=JC(a);s=ZC(i[l],c,r)}return s}function zC(t,e){let{route:n,pathname:r,params:o}=t;return{id:n.id,pathname:r,params:o,data:e[n.id],handle:n.handle}}function Bm(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let o=(a,i,s)=>{let l={relativePath:s===void 0?a.path||"":s,caseSensitive:a.caseSensitive===!0,childrenIndex:i,route:a};l.relativePath.startsWith("/")&&(Ne(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=jn([r,l.relativePath]),d=n.concat(l);a.children&&a.children.length>0&&(Ne(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),Bm(a.children,e,d,c)),!(a.path==null&&!a.index)&&e.push({path:c,score:YC(c,a.index),routesMeta:d})};return t.forEach((a,i)=>{var s;if(a.path===""||!((s=a.path)!=null&&s.includes("?")))o(a,i);else for(let l of Fm(a.path))o(a,i,l)}),e}function Fm(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,o=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return o?[a,""]:[a];let i=Fm(r.join("/")),s=[];return s.push(...i.map(l=>l===""?a:[a,l].join("/"))),o&&s.push(...i),s.map(l=>t.startsWith("/")&&l===""?"/":l)}function VC(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:XC(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const WC=/^:[\w-]+$/,UC=3,HC=2,qC=1,QC=10,KC=-2,zm=t=>t==="*";function YC(t,e){let n=t.split("/"),r=n.length;return n.some(zm)&&(r+=KC),e&&(r+=HC),n.filter(o=>!zm(o)).reduce((o,a)=>o+(WC.test(a)?UC:a===""?qC:QC),r)}function XC(t,e){return t.length===e.length&&t.slice(0,-1).every((n,r)=>n===e[r])?t[t.length-1]-e[e.length-1]:0}function ZC(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,o={},a="/",i=[];for(let s=0;s<r.length;++s){let l=r[s],c=s===r.length-1,d=a==="/"?e:e.slice(a.length)||"/",u=Vm({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},d),h=l.route;if(!u&&c&&n&&!r[r.length-1].route.index&&(u=Vm({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!u)return null;Object.assign(o,u.params),i.push({params:o,pathname:jn([a,u.pathname]),pathnameBase:nN(jn([a,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(a=jn([a,u.pathnameBase]))}return i}function Vm(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=GC(t.path,t.caseSensitive,t.end),o=e.match(n);if(!o)return null;let a=o[0],i=a.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((l,c,d)=>{let{paramName:u,isOptional:h}=c;if(u==="*"){let y=s[d]||"";i=a.slice(0,a.length-y.length).replace(/(.)\/+$/,"$1")}const p=s[d];return h&&!p?l[u]=void 0:l[u]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:a,pathnameBase:i,pattern:t}}function GC(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),_r(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],o="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,i,s)=>(r.push({paramName:i,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),o+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":t!==""&&t!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),r]}function JC(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return _r(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function _o(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function eN(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:o=""}=typeof t=="string"?kn(t):t;return{pathname:n?n.startsWith("/")?n:tN(n,e):e,search:rN(r),hash:oN(o)}}function tN(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Ul(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Wm(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Hl(t,e){let n=Wm(t);return e?n.map((r,o)=>o===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function ql(t,e,n,r){r===void 0&&(r=!1);let o;typeof t=="string"?o=kn(t):(o=Xe({},t),Ne(!o.pathname||!o.pathname.includes("?"),Ul("?","pathname","search",o)),Ne(!o.pathname||!o.pathname.includes("#"),Ul("#","pathname","hash",o)),Ne(!o.search||!o.search.includes("#"),Ul("#","search","hash",o)));let a=t===""||o.pathname==="",i=a?"/":o.pathname,s;if(i==null)s=n;else{let u=e.length-1;if(!r&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),u-=1;o.pathname=h.join("/")}s=u>=0?e[u]:"/"}let l=eN(o,s),c=i&&i!=="/"&&i.endsWith("/"),d=(a||i===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||d)&&(l.pathname+="/"),l}const jn=t=>t.join("/").replace(/\/\/+/g,"/"),nN=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),rN=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,oN=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;class Ya{constructor(e,n,r,o){o===void 0&&(o=!1),this.status=e,this.statusText=n||"",this.internal=o,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}}function Xa(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Um=["post","put","patch","delete"],aN=new Set(Um),iN=["get",...Um],sN=new Set(iN),lN=new Set([301,302,303,307,308]),cN=new Set([307,308]),Ql={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},uN={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Mo={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},Kl=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dN=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),Hm="remix-router-transitions";function hN(t){const e=t.window?t.window:typeof window<"u"?window:void 0,n=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",r=!n;Ne(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let o;if(t.mapRouteProperties)o=t.mapRouteProperties;else if(t.detectErrorBoundary){let T=t.detectErrorBoundary;o=$=>({hasErrorBoundary:T($)})}else o=dN;let a={},i=Eo(t.routes,o,void 0,a),s,l=t.basename||"/",c=t.unstable_dataStrategy||gN,d=t.unstable_patchRoutesOnNavigation,u=Xe({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},t.future),h=null,p=new Set,y=1e3,f=new Set,v=null,g=null,b=null,w=t.hydrationData!=null,E=Zn(i,t.history.location,l),M=null;if(E==null&&!d){let T=vt(404,{pathname:t.history.location.pathname}),{matches:$,route:z}=ry(i);E=$,M={[z.id]:T}}E&&!t.hydrationData&&zn(E,i,t.history.location.pathname).active&&(E=null);let S;if(E)if(E.some(T=>T.route.lazy))S=!1;else if(!E.some(T=>T.route.loader))S=!0;else if(u.v7_partialHydration){let T=t.hydrationData?t.hydrationData.loaderData:null,$=t.hydrationData?t.hydrationData.errors:null,z=K=>K.route.loader?typeof K.route.loader=="function"&&K.route.loader.hydrate===!0?!1:T&&T[K.route.id]!==void 0||$&&$[K.route.id]!==void 0:!0;if($){let K=E.findIndex(pe=>$[pe.route.id]!==void 0);S=E.slice(0,K+1).every(z)}else S=E.every(z)}else S=t.hydrationData!=null;else if(S=!1,E=[],u.v7_partialHydration){let T=zn(null,i,t.history.location.pathname);T.active&&T.matches&&(E=T.matches)}let N,_={historyAction:t.history.action,location:t.history.location,matches:E,initialized:S,navigation:Ql,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||M,fetchers:new Map,blockers:new Map},O=ot.Pop,k=!1,I,B=!1,L=new Map,C=null,P=!1,j=!1,D=[],R=new Set,A=new Map,V=0,q=-1,Y=new Map,H=new Set,G=new Map,Z=new Map,J=new Set,ce=new Map,U=new Map,te=new Map,re=!1;function ie(){if(h=t.history.listen(T=>{let{action:$,location:z,delta:K}=T;if(re){re=!1;return}_r(U.size===0||K!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let pe=fe({currentLocation:_.location,nextLocation:z,historyAction:$});if(pe&&K!=null){re=!0,t.history.go(K*-1),ue(pe,{state:"blocked",location:z,proceed(){ue(pe,{state:"proceeding",proceed:void 0,reset:void 0,location:z}),t.history.go(K)},reset(){let ye=new Map(_.blockers);ye.set(pe,Mo),he({blockers:ye})}});return}return Re($,z)}),n){kN(e,L);let T=()=>jN(e,L);e.addEventListener("pagehide",T),C=()=>e.removeEventListener("pagehide",T)}return _.initialized||Re(ot.Pop,_.location,{initialHydration:!0}),N}function X(){h&&h(),C&&C(),p.clear(),I&&I.abort(),_.fetchers.forEach((T,$)=>W($)),_.blockers.forEach((T,$)=>le($))}function oe(T){return p.add(T),()=>p.delete(T)}function he(T,$){$===void 0&&($={}),_=Xe({},_,T);let z=[],K=[];u.v7_fetcherPersist&&_.fetchers.forEach((pe,ye)=>{pe.state==="idle"&&(J.has(ye)?K.push(ye):z.push(ye))}),[...p].forEach(pe=>pe(_,{deletedFetchers:K,unstable_viewTransitionOpts:$.viewTransitionOpts,unstable_flushSync:$.flushSync===!0})),u.v7_fetcherPersist&&(z.forEach(pe=>_.fetchers.delete(pe)),K.forEach(pe=>W(pe)))}function ge(T,$,z){var K,pe;let{flushSync:ye}=z===void 0?{}:z,we=_.actionData!=null&&_.navigation.formMethod!=null&&Lt(_.navigation.formMethod)&&_.navigation.state==="loading"&&((K=T.state)==null?void 0:K._isRedirect)!==!0,ae;$.actionData?Object.keys($.actionData).length>0?ae=$.actionData:ae=null:we?ae=_.actionData:ae=null;let _e=$.loaderData?ty(_.loaderData,$.loaderData,$.matches||[],$.errors):_.loaderData,be=_.blockers;be.size>0&&(be=new Map(be),be.forEach((Oe,Pe)=>be.set(Pe,Mo)));let Ce=k===!0||_.navigation.formMethod!=null&&Lt(_.navigation.formMethod)&&((pe=T.state)==null?void 0:pe._isRedirect)!==!0;s&&(i=s,s=void 0),P||O===ot.Pop||(O===ot.Push?t.history.push(T,T.state):O===ot.Replace&&t.history.replace(T,T.state));let Be;if(O===ot.Pop){let Oe=L.get(_.location.pathname);Oe&&Oe.has(T.pathname)?Be={currentLocation:_.location,nextLocation:T}:L.has(T.pathname)&&(Be={currentLocation:T,nextLocation:_.location})}else if(B){let Oe=L.get(_.location.pathname);Oe?Oe.add(T.pathname):(Oe=new Set([T.pathname]),L.set(_.location.pathname,Oe)),Be={currentLocation:_.location,nextLocation:T}}he(Xe({},$,{actionData:ae,loaderData:_e,historyAction:O,location:T,initialized:!0,navigation:Ql,revalidation:"idle",restoreScrollPosition:ao(T,$.matches||_.matches),preventScrollReset:Ce,blockers:be}),{viewTransitionOpts:Be,flushSync:ye===!0}),O=ot.Pop,k=!1,B=!1,P=!1,j=!1,D=[]}async function Ve(T,$){if(typeof T=="number"){t.history.go(T);return}let z=Yl(_.location,_.matches,l,u.v7_prependBasename,T,u.v7_relativeSplatPath,$==null?void 0:$.fromRouteId,$==null?void 0:$.relative),{path:K,submission:pe,error:ye}=qm(u.v7_normalizeFormMethod,!1,z,$),we=_.location,ae=bo(_.location,K,$&&$.state);ae=Xe({},ae,t.history.encodeLocation(ae));let _e=$&&$.replace!=null?$.replace:void 0,be=ot.Push;_e===!0?be=ot.Replace:_e===!1||pe!=null&&Lt(pe.formMethod)&&pe.formAction===_.location.pathname+_.location.search&&(be=ot.Replace);let Ce=$&&"preventScrollReset"in $?$.preventScrollReset===!0:void 0,Be=($&&$.unstable_flushSync)===!0,Oe=fe({currentLocation:we,nextLocation:ae,historyAction:be});if(Oe){ue(Oe,{state:"blocked",location:ae,proceed(){ue(Oe,{state:"proceeding",proceed:void 0,reset:void 0,location:ae}),Ve(T,$)},reset(){let Pe=new Map(_.blockers);Pe.set(Oe,Mo),he({blockers:Pe})}});return}return await Re(be,ae,{submission:pe,pendingError:ye,preventScrollReset:Ce,replace:$&&$.replace,enableViewTransition:$&&$.unstable_viewTransition,flushSync:Be})}function st(){if(Sn(),he({revalidation:"loading"}),_.navigation.state!=="submitting"){if(_.navigation.state==="idle"){Re(_.historyAction,_.location,{startUninterruptedRevalidation:!0});return}Re(O||_.historyAction,_.navigation.location,{overrideNavigation:_.navigation})}}async function Re(T,$,z){I&&I.abort(),I=null,O=T,P=(z&&z.startUninterruptedRevalidation)===!0,oo(_.location,_.matches),k=(z&&z.preventScrollReset)===!0,B=(z&&z.enableViewTransition)===!0;let K=s||i,pe=z&&z.overrideNavigation,ye=Zn(K,$,l),we=(z&&z.flushSync)===!0,ae=zn(ye,K,$.pathname);if(ae.active&&ae.matches&&(ye=ae.matches),!ye){let{error:rt,notFoundMatches:mt,route:nt}=me($.pathname);ge($,{matches:mt,loaderData:{},errors:{[nt.id]:rt}},{flushSync:we});return}if(_.initialized&&!j&&_N(_.location,$)&&!(z&&z.submission&&Lt(z.submission.formMethod))){ge($,{matches:ye},{flushSync:we});return}I=new AbortController;let _e=Mr(t.history,$,I.signal,z&&z.submission),be;if(z&&z.pendingError)be=[Cr(ye).route.id,{type:Fe.error,error:z.pendingError}];else if(z&&z.submission&&Lt(z.submission.formMethod)){let rt=await De(_e,$,z.submission,ye,ae.active,{replace:z.replace,flushSync:we});if(rt.shortCircuited)return;if(rt.pendingActionResult){let[mt,nt]=rt.pendingActionResult;if(Mt(nt)&&Xa(nt.error)&&nt.error.status===404){I=null,ge($,{matches:rt.matches,loaderData:{},errors:{[mt]:nt.error}});return}}ye=rt.matches||ye,be=rt.pendingActionResult,pe=Gl($,z.submission),we=!1,ae.active=!1,_e=Mr(t.history,_e.url,_e.signal)}let{shortCircuited:Ce,matches:Be,loaderData:Oe,errors:Pe}=await et(_e,$,ye,ae.active,pe,z&&z.submission,z&&z.fetcherSubmission,z&&z.replace,z&&z.initialHydration===!0,we,be);Ce||(I=null,ge($,Xe({matches:Be||ye},ny(be),{loaderData:Oe,errors:Pe})))}async function De(T,$,z,K,pe,ye){ye===void 0&&(ye={}),Sn();let we=ON($,z);if(he({navigation:we},{flushSync:ye.flushSync===!0}),pe){let be=await io(K,$.pathname,T.signal);if(be.type==="aborted")return{shortCircuited:!0};if(be.type==="error"){let{boundaryId:Ce,error:Be}=Ee($.pathname,be);return{matches:be.partialMatches,pendingActionResult:[Ce,{type:Fe.error,error:Be}]}}else if(be.matches)K=be.matches;else{let{notFoundMatches:Ce,error:Be,route:Oe}=me($.pathname);return{matches:Ce,pendingActionResult:[Oe.id,{type:Fe.error,error:Be}]}}}let ae,_e=Co(K,$);if(!_e.route.action&&!_e.route.lazy)ae={type:Fe.error,error:vt(405,{method:T.method,pathname:$.pathname,routeId:_e.route.id})};else if(ae=(await ut("action",T,[_e],K))[0],T.signal.aborted)return{shortCircuited:!0};if(Jn(ae)){let be;return ye&&ye.replace!=null?be=ye.replace:be=Gm(ae.response.headers.get("Location"),new URL(T.url),l)===_.location.pathname+_.location.search,await ft(T,ae,{submission:z,replace:be}),{shortCircuited:!0}}if(Gn(ae))throw vt(400,{type:"defer-action"});if(Mt(ae)){let be=Cr(K,_e.route.id);return(ye&&ye.replace)!==!0&&(O=ot.Push),{matches:K,pendingActionResult:[be.route.id,ae]}}return{matches:K,pendingActionResult:[_e.route.id,ae]}}async function et(T,$,z,K,pe,ye,we,ae,_e,be,Ce){let Be=pe||Gl($,ye),Oe=ye||we||uy(Be),Pe=!P&&(!u.v7_partialHydration||!_e);if(K){if(Pe){let qe=We(Ce);he(Xe({navigation:Be},qe!==void 0?{actionData:qe}:{}),{flushSync:be})}let Ae=await io(z,$.pathname,T.signal);if(Ae.type==="aborted")return{shortCircuited:!0};if(Ae.type==="error"){let{boundaryId:qe,error:Te}=Ee($.pathname,Ae);return{matches:Ae.partialMatches,loaderData:{},errors:{[qe]:Te}}}else if(Ae.matches)z=Ae.matches;else{let{error:qe,notFoundMatches:Te,route:At}=me($.pathname);return{matches:Te,loaderData:{},errors:{[At.id]:qe}}}}let rt=s||i,[mt,nt]=Qm(t.history,_,z,Oe,$,u.v7_partialHydration&&_e===!0,u.v7_skipActionErrorRevalidation,j,D,R,J,G,H,rt,l,Ce);if(Le(Ae=>!(z&&z.some(qe=>qe.route.id===Ae))||mt&&mt.some(qe=>qe.route.id===Ae)),q=++V,mt.length===0&&nt.length===0){let Ae=Ge();return ge($,Xe({matches:z,loaderData:{},errors:Ce&&Mt(Ce[1])?{[Ce[0]]:Ce[1].error}:null},ny(Ce),Ae?{fetchers:new Map(_.fetchers)}:{}),{flushSync:be}),{shortCircuited:!0}}if(Pe){let Ae={};if(!K){Ae.navigation=Be;let qe=We(Ce);qe!==void 0&&(Ae.actionData=qe)}nt.length>0&&(Ae.fetchers=Ze(nt)),he(Ae,{flushSync:be})}nt.forEach(Ae=>{A.has(Ae.key)&&ee(Ae.key),Ae.controller&&A.set(Ae.key,Ae.controller)});let nn=()=>nt.forEach(Ae=>ee(Ae.key));I&&I.signal.addEventListener("abort",nn);let{loaderResults:Vn,fetcherResults:so}=await tn(_.matches,z,mt,nt,T);if(T.signal.aborted)return{shortCircuited:!0};I&&I.signal.removeEventListener("abort",nn),nt.forEach(Ae=>A.delete(Ae.key));let qt=oy([...Vn,...so]);if(qt){if(qt.idx>=mt.length){let Ae=nt[qt.idx-mt.length].key;H.add(Ae)}return await ft(T,qt.result,{replace:ae}),{shortCircuited:!0}}let{loaderData:rn,errors:On}=ey(_,z,mt,Vn,Ce,nt,so,ce);ce.forEach((Ae,qe)=>{Ae.subscribe(Te=>{(Te||Ae.done)&&ce.delete(qe)})}),u.v7_partialHydration&&_e&&_.errors&&Object.entries(_.errors).filter(Ae=>{let[qe]=Ae;return!mt.some(Te=>Te.route.id===qe)}).forEach(Ae=>{let[qe,Te]=Ae;On=Object.assign(On||{},{[qe]:Te})});let lo=Ge(),co=Ke(q),Wn=lo||co||nt.length>0;return Xe({matches:z,loaderData:rn,errors:On},Wn?{fetchers:new Map(_.fetchers)}:{})}function We(T){if(T&&!Mt(T[1]))return{[T[0]]:T[1].data};if(_.actionData)return Object.keys(_.actionData).length===0?null:_.actionData}function Ze(T){return T.forEach($=>{let z=_.fetchers.get($.key),K=No(void 0,z?z.data:void 0);_.fetchers.set($.key,K)}),new Map(_.fetchers)}function wt(T,$,z,K){if(r)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");A.has(T)&&ee(T);let pe=(K&&K.unstable_flushSync)===!0,ye=s||i,we=Yl(_.location,_.matches,l,u.v7_prependBasename,z,u.v7_relativeSplatPath,$,K==null?void 0:K.relative),ae=Zn(ye,we,l),_e=zn(ae,ye,we);if(_e.active&&_e.matches&&(ae=_e.matches),!ae){Et(T,$,vt(404,{pathname:we}),{flushSync:pe});return}let{path:be,submission:Ce,error:Be}=qm(u.v7_normalizeFormMethod,!0,we,K);if(Be){Et(T,$,Be,{flushSync:pe});return}let Oe=Co(ae,be);if(k=(K&&K.preventScrollReset)===!0,Ce&&Lt(Ce.formMethod)){tt(T,$,be,Oe,ae,_e.active,pe,Ce);return}G.set(T,{routeId:$,path:be}),ct(T,$,be,Oe,ae,_e.active,pe,Ce)}async function tt(T,$,z,K,pe,ye,we,ae){Sn(),G.delete(T);function _e(Te){if(!Te.route.action&&!Te.route.lazy){let At=vt(405,{method:ae.formMethod,pathname:z,routeId:$});return Et(T,$,At,{flushSync:we}),!0}return!1}if(!ye&&_e(K))return;let be=_.fetchers.get(T);Tt(T,AN(ae,be),{flushSync:we});let Ce=new AbortController,Be=Mr(t.history,z,Ce.signal,ae);if(ye){let Te=await io(pe,z,Be.signal);if(Te.type==="aborted")return;if(Te.type==="error"){let{error:At}=Ee(z,Te);Et(T,$,At,{flushSync:we});return}else if(Te.matches){if(pe=Te.matches,K=Co(pe,z),_e(K))return}else{Et(T,$,vt(404,{pathname:z}),{flushSync:we});return}}A.set(T,Ce);let Oe=V,Pe=(await ut("action",Be,[K],pe))[0];if(Be.signal.aborted){A.get(T)===Ce&&A.delete(T);return}if(u.v7_fetcherPersist&&J.has(T)){if(Jn(Pe)||Mt(Pe)){Tt(T,Rn(void 0));return}}else{if(Jn(Pe))if(A.delete(T),q>Oe){Tt(T,Rn(void 0));return}else return H.add(T),Tt(T,No(ae)),ft(Be,Pe,{fetcherSubmission:ae});if(Mt(Pe)){Et(T,$,Pe.error);return}}if(Gn(Pe))throw vt(400,{type:"defer-action"});let rt=_.navigation.location||_.location,mt=Mr(t.history,rt,Ce.signal),nt=s||i,nn=_.navigation.state!=="idle"?Zn(nt,_.navigation.location,l):_.matches;Ne(nn,"Didn't find any matches after fetcher action");let Vn=++V;Y.set(T,Vn);let so=No(ae,Pe.data);_.fetchers.set(T,so);let[qt,rn]=Qm(t.history,_,nn,ae,rt,!1,u.v7_skipActionErrorRevalidation,j,D,R,J,G,H,nt,l,[K.route.id,Pe]);rn.filter(Te=>Te.key!==T).forEach(Te=>{let At=Te.key,Bs=_.fetchers.get(At),lf=No(void 0,Bs?Bs.data:void 0);_.fetchers.set(At,lf),A.has(At)&&ee(At),Te.controller&&A.set(At,Te.controller)}),he({fetchers:new Map(_.fetchers)});let On=()=>rn.forEach(Te=>ee(Te.key));Ce.signal.addEventListener("abort",On);let{loaderResults:lo,fetcherResults:co}=await tn(_.matches,nn,qt,rn,mt);if(Ce.signal.aborted)return;Ce.signal.removeEventListener("abort",On),Y.delete(T),A.delete(T),rn.forEach(Te=>A.delete(Te.key));let Wn=oy([...lo,...co]);if(Wn){if(Wn.idx>=qt.length){let Te=rn[Wn.idx-qt.length].key;H.add(Te)}return ft(mt,Wn.result)}let{loaderData:Ae,errors:qe}=ey(_,_.matches,qt,lo,void 0,rn,co,ce);if(_.fetchers.has(T)){let Te=Rn(Pe.data);_.fetchers.set(T,Te)}Ke(Vn),_.navigation.state==="loading"&&Vn>q?(Ne(O,"Expected pending action"),I&&I.abort(),ge(_.navigation.location,{matches:nn,loaderData:Ae,errors:qe,fetchers:new Map(_.fetchers)})):(he({errors:qe,loaderData:ty(_.loaderData,Ae,nn,qe),fetchers:new Map(_.fetchers)}),j=!1)}async function ct(T,$,z,K,pe,ye,we,ae){let _e=_.fetchers.get(T);Tt(T,No(ae,_e?_e.data:void 0),{flushSync:we});let be=new AbortController,Ce=Mr(t.history,z,be.signal);if(ye){let Pe=await io(pe,z,Ce.signal);if(Pe.type==="aborted")return;if(Pe.type==="error"){let{error:rt}=Ee(z,Pe);Et(T,$,rt,{flushSync:we});return}else if(Pe.matches)pe=Pe.matches,K=Co(pe,z);else{Et(T,$,vt(404,{pathname:z}),{flushSync:we});return}}A.set(T,be);let Be=V,Oe=(await ut("loader",Ce,[K],pe))[0];if(Gn(Oe)&&(Oe=await cy(Oe,Ce.signal,!0)||Oe),A.get(T)===be&&A.delete(T),!Ce.signal.aborted){if(J.has(T)){Tt(T,Rn(void 0));return}if(Jn(Oe))if(q>Be){Tt(T,Rn(void 0));return}else{H.add(T),await ft(Ce,Oe);return}if(Mt(Oe)){Et(T,$,Oe.error);return}Ne(!Gn(Oe),"Unhandled fetcher deferred data"),Tt(T,Rn(Oe.data))}}async function ft(T,$,z){let{submission:K,fetcherSubmission:pe,replace:ye}=z===void 0?{}:z;$.response.headers.has("X-Remix-Revalidate")&&(j=!0);let we=$.response.headers.get("Location");Ne(we,"Expected a Location header on the redirect Response"),we=Gm(we,new URL(T.url),l);let ae=bo(_.location,we,{_isRedirect:!0});if(n){let Pe=!1;if($.response.headers.has("X-Remix-Reload-Document"))Pe=!0;else if(Kl.test(we)){const rt=t.history.createURL(we);Pe=rt.origin!==e.location.origin||_o(rt.pathname,l)==null}if(Pe){ye?e.location.replace(we):e.location.assign(we);return}}I=null;let _e=ye===!0||$.response.headers.has("X-Remix-Replace")?ot.Replace:ot.Push,{formMethod:be,formAction:Ce,formEncType:Be}=_.navigation;!K&&!pe&&be&&Ce&&Be&&(K=uy(_.navigation));let Oe=K||pe;if(cN.has($.response.status)&&Oe&&Lt(Oe.formMethod))await Re(_e,ae,{submission:Xe({},Oe,{formAction:we}),preventScrollReset:k});else{let Pe=Gl(ae,K);await Re(_e,ae,{overrideNavigation:Pe,fetcherSubmission:pe,preventScrollReset:k})}}async function ut(T,$,z,K){try{let pe=await vN(c,T,$,z,K,a,o);return await Promise.all(pe.map((ye,we)=>{if(CN(ye)){let ae=ye.result;return{type:Fe.redirect,response:wN(ae,$,z[we].route.id,K,l,u.v7_relativeSplatPath)}}return bN(ye)}))}catch(pe){return z.map(()=>({type:Fe.error,error:pe}))}}async function tn(T,$,z,K,pe){let[ye,...we]=await Promise.all([z.length?ut("loader",pe,z,$):[],...K.map(ae=>{if(ae.matches&&ae.match&&ae.controller){let _e=Mr(t.history,ae.path,ae.controller.signal);return ut("loader",_e,[ae.match],ae.matches).then(be=>be[0])}else return Promise.resolve({type:Fe.error,error:vt(404,{pathname:ae.path})})})]);return await Promise.all([ly(T,z,ye,ye.map(()=>pe.signal),!1,_.loaderData),ly(T,K.map(ae=>ae.match),we,K.map(ae=>ae.controller?ae.controller.signal:null),!0)]),{loaderResults:ye,fetcherResults:we}}function Sn(){j=!0,D.push(...Le()),G.forEach((T,$)=>{A.has($)&&(R.add($),ee($))})}function Tt(T,$,z){z===void 0&&(z={}),_.fetchers.set(T,$),he({fetchers:new Map(_.fetchers)},{flushSync:(z&&z.flushSync)===!0})}function Et(T,$,z,K){K===void 0&&(K={});let pe=Cr(_.matches,$);W(T),he({errors:{[pe.route.id]:z},fetchers:new Map(_.fetchers)},{flushSync:(K&&K.flushSync)===!0})}function F(T){return u.v7_fetcherPersist&&(Z.set(T,(Z.get(T)||0)+1),J.has(T)&&J.delete(T)),_.fetchers.get(T)||uN}function W(T){let $=_.fetchers.get(T);A.has(T)&&!($&&$.state==="loading"&&Y.has(T))&&ee(T),G.delete(T),Y.delete(T),H.delete(T),J.delete(T),R.delete(T),_.fetchers.delete(T)}function Q(T){if(u.v7_fetcherPersist){let $=(Z.get(T)||0)-1;$<=0?(Z.delete(T),J.add(T)):Z.set(T,$)}else W(T);he({fetchers:new Map(_.fetchers)})}function ee(T){let $=A.get(T);Ne($,"Expected fetch controller: "+T),$.abort(),A.delete(T)}function ve(T){for(let $ of T){let z=F($),K=Rn(z.data);_.fetchers.set($,K)}}function Ge(){let T=[],$=!1;for(let z of H){let K=_.fetchers.get(z);Ne(K,"Expected fetcher: "+z),K.state==="loading"&&(H.delete(z),T.push(z),$=!0)}return ve(T),$}function Ke(T){let $=[];for(let[z,K]of Y)if(K<T){let pe=_.fetchers.get(z);Ne(pe,"Expected fetcher: "+z),pe.state==="loading"&&(ee(z),Y.delete(z),$.push(z))}return ve($),$.length>0}function Se(T,$){let z=_.blockers.get(T)||Mo;return U.get(T)!==$&&U.set(T,$),z}function le(T){_.blockers.delete(T),U.delete(T)}function ue(T,$){let z=_.blockers.get(T)||Mo;Ne(z.state==="unblocked"&&$.state==="blocked"||z.state==="blocked"&&$.state==="blocked"||z.state==="blocked"&&$.state==="proceeding"||z.state==="blocked"&&$.state==="unblocked"||z.state==="proceeding"&&$.state==="unblocked","Invalid blocker state transition: "+z.state+" -> "+$.state);let K=new Map(_.blockers);K.set(T,$),he({blockers:K})}function fe(T){let{currentLocation:$,nextLocation:z,historyAction:K}=T;if(U.size===0)return;U.size>1&&_r(!1,"A router only supports one blocker at a time");let pe=Array.from(U.entries()),[ye,we]=pe[pe.length-1],ae=_.blockers.get(ye);if(!(ae&&ae.state==="proceeding")&&we({currentLocation:$,nextLocation:z,historyAction:K}))return ye}function me(T){let $=vt(404,{pathname:T}),z=s||i,{matches:K,route:pe}=ry(z);return Le(),{notFoundMatches:K,route:pe,error:$}}function Ee(T,$){return{boundaryId:Cr($.partialMatches).route.id,error:vt(400,{type:"route-discovery",pathname:T,message:$.error!=null&&"message"in $.error?$.error:String($.error)})}}function Le(T){let $=[];return ce.forEach((z,K)=>{(!T||T(K))&&(z.cancel(),$.push(K),ce.delete(K))}),$}function Ye(T,$,z){if(v=T,b=$,g=z||null,!w&&_.navigation===Ql){w=!0;let K=ao(_.location,_.matches);K!=null&&he({restoreScrollPosition:K})}return()=>{v=null,b=null,g=null}}function gt(T,$){return g&&g(T,$.map(z=>zC(z,_.loaderData)))||T.key}function oo(T,$){if(v&&b){let z=gt(T,$);v[z]=b()}}function ao(T,$){if(v){let z=gt(T,$),K=v[z];if(typeof K=="number")return K}return null}function zn(T,$,z){if(d){if(f.has(z))return{active:!1,matches:T};if(T){if(Object.keys(T[0].params).length>0)return{active:!0,matches:Ka($,z,l,!0)}}else return{active:!0,matches:Ka($,z,l,!0)||[]}}return{active:!1,matches:null}}async function io(T,$,z){let K=T;for(;;){let pe=s==null,ye=s||i;try{await yN(d,$,K,ye,a,o,te,z)}catch(_e){return{type:"error",error:_e,partialMatches:K}}finally{pe&&(i=[...i])}if(z.aborted)return{type:"aborted"};let we=Zn(ye,$,l);if(we)return $s($,f),{type:"success",matches:we};let ae=Ka(ye,$,l,!0);if(!ae||K.length===ae.length&&K.every((_e,be)=>_e.route.id===ae[be].route.id))return $s($,f),{type:"success",matches:null};K=ae}}function $s(T,$){if($.size>=y){let z=$.values().next().value;$.delete(z)}$.add(T)}function af(T){a={},s=Eo(T,o,void 0,a)}function sf(T,$){let z=s==null;Xm(T,$,s||i,a,o),z&&(i=[...i],he({}))}return N={get basename(){return l},get future(){return u},get state(){return _},get routes(){return i},get window(){return e},initialize:ie,subscribe:oe,enableScrollRestoration:Ye,navigate:Ve,fetch:wt,revalidate:st,createHref:T=>t.history.createHref(T),encodeLocation:T=>t.history.encodeLocation(T),getFetcher:F,deleteFetcher:Q,dispose:X,getBlocker:Se,deleteBlocker:le,patchRoutes:sf,_internalFetchControllers:A,_internalActiveDeferreds:ce,_internalSetRoutes:af},N}function pN(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function Yl(t,e,n,r,o,a,i,s){let l,c;if(i){l=[];for(let u of e)if(l.push(u),u.route.id===i){c=u;break}}else l=e,c=e[e.length-1];let d=ql(o||".",Hl(l,a),_o(t.pathname,n)||t.pathname,s==="path");return o==null&&(d.search=t.search,d.hash=t.hash),(o==null||o===""||o===".")&&c&&c.route.index&&!Zl(d.search)&&(d.search=d.search?d.search.replace(/^\?/,"?index&"):"?index"),r&&n!=="/"&&(d.pathname=d.pathname==="/"?n:jn([n,d.pathname])),wo(d)}function qm(t,e,n,r){if(!r||!pN(r))return{path:n};if(r.formMethod&&!SN(r.formMethod))return{path:n,error:vt(405,{method:r.formMethod})};let o=()=>({path:n,error:vt(400,{type:"invalid-body"})}),a=r.formMethod||"get",i=t?a.toUpperCase():a.toLowerCase(),s=ay(n);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Lt(i))return o();let h=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((p,y)=>{let[f,v]=y;return""+p+f+"="+v+`
`},""):String(r.body);return{path:n,submission:{formMethod:i,formAction:s,formEncType:r.formEncType,formData:void 0,json:void 0,text:h}}}else if(r.formEncType==="application/json"){if(!Lt(i))return o();try{let h=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:n,submission:{formMethod:i,formAction:s,formEncType:r.formEncType,formData:void 0,json:h,text:void 0}}}catch{return o()}}}Ne(typeof FormData=="function","FormData is not available in this environment");let l,c;if(r.formData)l=Xl(r.formData),c=r.formData;else if(r.body instanceof FormData)l=Xl(r.body),c=r.body;else if(r.body instanceof URLSearchParams)l=r.body,c=Jm(l);else if(r.body==null)l=new URLSearchParams,c=new FormData;else try{l=new URLSearchParams(r.body),c=Jm(l)}catch{return o()}let d={formMethod:i,formAction:s,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:c,json:void 0,text:void 0};if(Lt(d.formMethod))return{path:n,submission:d};let u=kn(n);return e&&u.search&&Zl(u.search)&&l.append("index",""),u.search="?"+l,{path:wo(u),submission:d}}function fN(t,e){let n=t;if(e){let r=t.findIndex(o=>o.route.id===e);r>=0&&(n=t.slice(0,r))}return n}function Qm(t,e,n,r,o,a,i,s,l,c,d,u,h,p,y,f){let v=f?Mt(f[1])?f[1].error:f[1].data:void 0,g=t.createURL(e.location),b=t.createURL(o),w=f&&Mt(f[1])?f[0]:void 0,E=w?fN(n,w):n,M=f?f[1].statusCode:void 0,S=i&&M&&M>=400,N=E.filter((O,k)=>{let{route:I}=O;if(I.lazy)return!0;if(I.loader==null)return!1;if(a)return typeof I.loader!="function"||I.loader.hydrate?!0:e.loaderData[I.id]===void 0&&(!e.errors||e.errors[I.id]===void 0);if(mN(e.loaderData,e.matches[k],O)||l.some(C=>C===O.route.id))return!0;let B=e.matches[k],L=O;return Ym(O,Xe({currentUrl:g,currentParams:B.params,nextUrl:b,nextParams:L.params},r,{actionResult:v,actionStatus:M,defaultShouldRevalidate:S?!1:s||g.pathname+g.search===b.pathname+b.search||g.search!==b.search||Km(B,L)}))}),_=[];return u.forEach((O,k)=>{if(a||!n.some(P=>P.route.id===O.routeId)||d.has(k))return;let I=Zn(p,O.path,y);if(!I){_.push({key:k,routeId:O.routeId,path:O.path,matches:null,match:null,controller:null});return}let B=e.fetchers.get(k),L=Co(I,O.path),C=!1;h.has(k)?C=!1:c.has(k)?(c.delete(k),C=!0):B&&B.state!=="idle"&&B.data===void 0?C=s:C=Ym(L,Xe({currentUrl:g,currentParams:e.matches[e.matches.length-1].params,nextUrl:b,nextParams:n[n.length-1].params},r,{actionResult:v,actionStatus:M,defaultShouldRevalidate:S?!1:s})),C&&_.push({key:k,routeId:O.routeId,path:O.path,matches:I,match:L,controller:new AbortController})}),[N,_]}function mN(t,e,n){let r=!e||n.route.id!==e.route.id,o=t[n.route.id]===void 0;return r||o}function Km(t,e){let n=t.route.path;return t.pathname!==e.pathname||n!=null&&n.endsWith("*")&&t.params["*"]!==e.params["*"]}function Ym(t,e){if(t.route.shouldRevalidate){let n=t.route.shouldRevalidate(e);if(typeof n=="boolean")return n}return e.defaultShouldRevalidate}async function yN(t,e,n,r,o,a,i,s){let l=[e,...n.map(c=>c.route.id)].join("-");try{let c=i.get(l);c||(c=t({path:e,matches:n,patch:(d,u)=>{s.aborted||Xm(d,u,r,o,a)}}),i.set(l,c)),c&&MN(c)&&await c}finally{i.delete(l)}}function Xm(t,e,n,r,o){if(t){var a;let i=r[t];Ne(i,"No route found to patch children into: routeId = "+t);let s=Eo(e,o,[t,"patch",String(((a=i.children)==null?void 0:a.length)||"0")],r);i.children?i.children.push(...s):i.children=s}else{let i=Eo(e,o,["patch",String(n.length||"0")],r);n.push(...i)}}async function Zm(t,e,n){if(!t.lazy)return;let r=await t.lazy();if(!t.lazy)return;let o=n[t.id];Ne(o,"No route found in manifest");let a={};for(let i in r){let s=o[i]!==void 0&&i!=="hasErrorBoundary";_r(!s,'Route "'+o.id+'" has a static property "'+i+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+i+'" will be ignored.')),!s&&!BC.has(i)&&(a[i]=r[i])}Object.assign(o,a),Object.assign(o,Xe({},e(o),{lazy:void 0}))}function gN(t){return Promise.all(t.matches.map(e=>e.resolve()))}async function vN(t,e,n,r,o,a,i,s){let l=r.reduce((u,h)=>u.add(h.route.id),new Set),c=new Set,d=await t({matches:o.map(u=>{let h=l.has(u.route.id);return Xe({},u,{shouldLoad:h,resolve:p=>(c.add(u.route.id),h?xN(e,n,u,a,i,p,s):Promise.resolve({type:Fe.data,result:void 0}))})}),request:n,params:o[0].params,context:s});return o.forEach(u=>Ne(c.has(u.route.id),'`match.resolve()` was not called for route id "'+u.route.id+'". You must call `match.resolve()` on every match passed to `dataStrategy` to ensure all routes are properly loaded.')),d.filter((u,h)=>l.has(o[h].route.id))}async function xN(t,e,n,r,o,a,i){let s,l,c=d=>{let u,h=new Promise((f,v)=>u=v);l=()=>u(),e.signal.addEventListener("abort",l);let p=f=>typeof d!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+t+'" [routeId: '+n.route.id+"]"))):d({request:e,params:n.params,context:i},...f!==void 0?[f]:[]),y;return a?y=a(f=>p(f)):y=(async()=>{try{return{type:"data",result:await p()}}catch(f){return{type:"error",result:f}}})(),Promise.race([y,h])};try{let d=n.route[t];if(n.route.lazy)if(d){let u,[h]=await Promise.all([c(d).catch(p=>{u=p}),Zm(n.route,o,r)]);if(u!==void 0)throw u;s=h}else if(await Zm(n.route,o,r),d=n.route[t],d)s=await c(d);else if(t==="action"){let u=new URL(e.url),h=u.pathname+u.search;throw vt(405,{method:e.method,pathname:h,routeId:n.route.id})}else return{type:Fe.data,result:void 0};else if(d)s=await c(d);else{let u=new URL(e.url),h=u.pathname+u.search;throw vt(404,{pathname:h})}Ne(s.result!==void 0,"You defined "+(t==="action"?"an action":"a loader")+" for route "+('"'+n.route.id+"\" but didn't return anything from your `"+t+"` ")+"function. Please return a value or `null`.")}catch(d){return{type:Fe.error,result:d}}finally{l&&e.signal.removeEventListener("abort",l)}return s}async function bN(t){let{result:e,type:n}=t;if(sy(e)){let c;try{let d=e.headers.get("Content-Type");d&&/\bapplication\/json\b/.test(d)?e.body==null?c=null:c=await e.json():c=await e.text()}catch(d){return{type:Fe.error,error:d}}return n===Fe.error?{type:Fe.error,error:new Ya(e.status,e.statusText,c),statusCode:e.status,headers:e.headers}:{type:Fe.data,data:c,statusCode:e.status,headers:e.headers}}if(n===Fe.error){if(iy(e)){var r;if(e.data instanceof Error){var o;return{type:Fe.error,error:e.data,statusCode:(o=e.init)==null?void 0:o.status}}e=new Ya(((r=e.init)==null?void 0:r.status)||500,void 0,e.data)}return{type:Fe.error,error:e,statusCode:Xa(e)?e.status:void 0}}if(NN(e)){var a,i;return{type:Fe.deferred,deferredData:e,statusCode:(a=e.init)==null?void 0:a.status,headers:((i=e.init)==null?void 0:i.headers)&&new Headers(e.init.headers)}}if(iy(e)){var s,l;return{type:Fe.data,data:e.data,statusCode:(s=e.init)==null?void 0:s.status,headers:(l=e.init)!=null&&l.headers?new Headers(e.init.headers):void 0}}return{type:Fe.data,data:e}}function wN(t,e,n,r,o,a){let i=t.headers.get("Location");if(Ne(i,"Redirects returned/thrown from loaders/actions must have a Location header"),!Kl.test(i)){let s=r.slice(0,r.findIndex(l=>l.route.id===n)+1);i=Yl(new URL(e.url),s,o,!0,i,a),t.headers.set("Location",i)}return t}function Gm(t,e,n){if(Kl.test(t)){let r=t,o=r.startsWith("//")?new URL(e.protocol+r):new URL(r),a=_o(o.pathname,n)!=null;if(o.origin===e.origin&&a)return o.pathname+o.search+o.hash}return t}function Mr(t,e,n,r){let o=t.createURL(ay(e)).toString(),a={signal:n};if(r&&Lt(r.formMethod)){let{formMethod:i,formEncType:s}=r;a.method=i.toUpperCase(),s==="application/json"?(a.headers=new Headers({"Content-Type":s}),a.body=JSON.stringify(r.json)):s==="text/plain"?a.body=r.text:s==="application/x-www-form-urlencoded"&&r.formData?a.body=Xl(r.formData):a.body=r.formData}return new Request(o,a)}function Xl(t){let e=new URLSearchParams;for(let[n,r]of t.entries())e.append(n,typeof r=="string"?r:r.name);return e}function Jm(t){let e=new FormData;for(let[n,r]of t.entries())e.append(n,r);return e}function EN(t,e,n,r,o,a){let i={},s=null,l,c=!1,d={},u=r&&Mt(r[1])?r[1].error:void 0;return n.forEach((h,p)=>{let y=e[p].route.id;if(Ne(!Jn(h),"Cannot handle redirect results in processLoaderData"),Mt(h)){let f=h.error;u!==void 0&&(f=u,u=void 0),s=s||{};{let v=Cr(t,y);s[v.route.id]==null&&(s[v.route.id]=f)}i[y]=void 0,c||(c=!0,l=Xa(h.error)?h.error.status:500),h.headers&&(d[y]=h.headers)}else Gn(h)?(o.set(y,h.deferredData),i[y]=h.deferredData.data,h.statusCode!=null&&h.statusCode!==200&&!c&&(l=h.statusCode),h.headers&&(d[y]=h.headers)):(i[y]=h.data,h.statusCode&&h.statusCode!==200&&!c&&(l=h.statusCode),h.headers&&(d[y]=h.headers))}),u!==void 0&&r&&(s={[r[0]]:u},i[r[0]]=void 0),{loaderData:i,errors:s,statusCode:l||200,loaderHeaders:d}}function ey(t,e,n,r,o,a,i,s){let{loaderData:l,errors:c}=EN(e,n,r,o,s);for(let d=0;d<a.length;d++){let{key:u,match:h,controller:p}=a[d];Ne(i!==void 0&&i[d]!==void 0,"Did not find corresponding fetcher result");let y=i[d];if(!(p&&p.signal.aborted))if(Mt(y)){let f=Cr(t.matches,h==null?void 0:h.route.id);c&&c[f.route.id]||(c=Xe({},c,{[f.route.id]:y.error})),t.fetchers.delete(u)}else if(Jn(y))Ne(!1,"Unhandled fetcher revalidation redirect");else if(Gn(y))Ne(!1,"Unhandled fetcher deferred data");else{let f=Rn(y.data);t.fetchers.set(u,f)}}return{loaderData:l,errors:c}}function ty(t,e,n,r){let o=Xe({},e);for(let a of n){let i=a.route.id;if(e.hasOwnProperty(i)?e[i]!==void 0&&(o[i]=e[i]):t[i]!==void 0&&a.route.loader&&(o[i]=t[i]),r&&r.hasOwnProperty(i))break}return o}function ny(t){return t?Mt(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function Cr(t,e){return(e?t.slice(0,t.findIndex(n=>n.route.id===e)+1):[...t]).reverse().find(n=>n.route.hasErrorBoundary===!0)||t[0]}function ry(t){let e=t.length===1?t[0]:t.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function vt(t,e){let{pathname:n,routeId:r,method:o,type:a,message:i}=e===void 0?{}:e,s="Unknown Server Error",l="Unknown @remix-run/router error";return t===400?(s="Bad Request",a==="route-discovery"?l='Unable to match URL "'+n+'" - the `unstable_patchRoutesOnNavigation()` '+(`function threw the following error:
`+i):o&&n&&r?l="You made a "+o+' request to "'+n+'" but '+('did not provide a `loader` for route "'+r+'", ')+"so there is no way to handle the request.":a==="defer-action"?l="defer() is not supported in actions":a==="invalid-body"&&(l="Unable to encode submission body")):t===403?(s="Forbidden",l='Route "'+r+'" does not match URL "'+n+'"'):t===404?(s="Not Found",l='No route matches URL "'+n+'"'):t===405&&(s="Method Not Allowed",o&&n&&r?l="You made a "+o.toUpperCase()+' request to "'+n+'" but '+('did not provide an `action` for route "'+r+'", ')+"so there is no way to handle the request.":o&&(l='Invalid request method "'+o.toUpperCase()+'"')),new Ya(t||500,s,new Error(l),!0)}function oy(t){for(let e=t.length-1;e>=0;e--){let n=t[e];if(Jn(n))return{result:n,idx:e}}}function ay(t){let e=typeof t=="string"?kn(t):t;return wo(Xe({},e,{hash:""}))}function _N(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function MN(t){return typeof t=="object"&&t!=null&&"then"in t}function CN(t){return sy(t.result)&&lN.has(t.result.status)}function Gn(t){return t.type===Fe.deferred}function Mt(t){return t.type===Fe.error}function Jn(t){return(t&&t.type)===Fe.redirect}function iy(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function NN(t){let e=t;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function sy(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function SN(t){return sN.has(t.toLowerCase())}function Lt(t){return aN.has(t.toLowerCase())}async function ly(t,e,n,r,o,a){for(let i=0;i<n.length;i++){let s=n[i],l=e[i];if(!l)continue;let c=t.find(u=>u.route.id===l.route.id),d=c!=null&&!Km(c,l)&&(a&&a[l.route.id])!==void 0;if(Gn(s)&&(o||d)){let u=r[i];Ne(u,"Expected an AbortSignal for revalidating fetcher deferred result"),await cy(s,u,o).then(h=>{h&&(n[i]=h||n[i])})}}}async function cy(t,e,n){if(n===void 0&&(n=!1),!await t.deferredData.resolveData(e)){if(n)try{return{type:Fe.data,data:t.deferredData.unwrappedData}}catch(r){return{type:Fe.error,error:r}}return{type:Fe.data,data:t.deferredData.data}}}function Zl(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function Co(t,e){let n=typeof e=="string"?kn(e).search:e.search;if(t[t.length-1].route.index&&Zl(n||""))return t[t.length-1];let r=Wm(t);return r[r.length-1]}function uy(t){let{formMethod:e,formAction:n,formEncType:r,text:o,formData:a,json:i}=t;if(!(!e||!n||!r)){if(o!=null)return{formMethod:e,formAction:n,formEncType:r,formData:void 0,json:void 0,text:o};if(a!=null)return{formMethod:e,formAction:n,formEncType:r,formData:a,json:void 0,text:void 0};if(i!==void 0)return{formMethod:e,formAction:n,formEncType:r,formData:void 0,json:i,text:void 0}}}function Gl(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function ON(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function No(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function AN(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function Rn(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function kN(t,e){try{let n=t.sessionStorage.getItem(Hm);if(n){let r=JSON.parse(n);for(let[o,a]of Object.entries(r||{}))a&&Array.isArray(a)&&e.set(o,new Set(a||[]))}}catch{}}function jN(t,e){if(e.size>0){let n={};for(let[r,o]of e)n[r]=[...o];try{t.sessionStorage.setItem(Hm,JSON.stringify(n))}catch(r){_r(!1,"Failed to save applied view transitions in sessionStorage ("+r+").")}}}function Za(){return Za=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Za.apply(this,arguments)}const Ga=m.createContext(null),dy=m.createContext(null),So=m.createContext(null),Jl=m.createContext(null),un=m.createContext({outlet:null,matches:[],isDataRoute:!1}),hy=m.createContext(null);function Oo(){return m.useContext(Jl)!=null}function Ja(){return Oo()||Ne(!1),m.useContext(Jl).location}function py(t){m.useContext(So).static||m.useLayoutEffect(t)}function ei(){let{isDataRoute:t}=m.useContext(un);return t?qN():RN()}function RN(){Oo()||Ne(!1);let t=m.useContext(Ga),{basename:e,future:n,navigator:r}=m.useContext(So),{matches:o}=m.useContext(un),{pathname:a}=Ja(),i=JSON.stringify(Hl(o,n.v7_relativeSplatPath)),s=m.useRef(!1);return py(()=>{s.current=!0}),m.useCallback(function(l,c){if(c===void 0&&(c={}),!s.current)return;if(typeof l=="number"){r.go(l);return}let d=ql(l,JSON.parse(i),a,c.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:jn([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,i,a,t])}const PN=m.createContext(null);function TN(t){let e=m.useContext(un).outlet;return e&&m.createElement(PN.Provider,{value:t},e)}function IN(){let{matches:t}=m.useContext(un),e=t[t.length-1];return e?e.params:{}}function DN(t,e,n,r){Oo()||Ne(!1);let{navigator:o}=m.useContext(So),{matches:a}=m.useContext(un),i=a[a.length-1],s=i?i.params:{};i&&i.pathname;let l=i?i.pathnameBase:"/";i&&i.route;let c=Ja(),d;d=c;let u=d.pathname||"/",h=u;if(l!=="/"){let y=l.replace(/^\//,"").split("/");h="/"+u.replace(/^\//,"").split("/").slice(y.length).join("/")}let p=Zn(t,{pathname:h});return zN(p&&p.map(y=>Object.assign({},y,{params:Object.assign({},s,y.params),pathname:jn([l,o.encodeLocation?o.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?l:jn([l,o.encodeLocation?o.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),a,n,r)}function LN(){let t=HN(),e=Xa(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return m.createElement(m.Fragment,null,m.createElement("h2",null,"Unexpected Application Error!"),m.createElement("h3",{style:{fontStyle:"italic"}},e),n?m.createElement("pre",{style:r},n):null,null)}const $N=m.createElement(LN,null);class BN extends m.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?m.createElement(un.Provider,{value:this.props.routeContext},m.createElement(hy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function FN(t){let{routeContext:e,match:n,children:r}=t,o=m.useContext(Ga);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),m.createElement(un.Provider,{value:e},r)}function zN(t,e,n,r){var o;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var a;if(!n)return null;if(n.errors)t=n.matches;else if((a=r)!=null&&a.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,s=(o=n)==null?void 0:o.errors;if(s!=null){let d=i.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);d>=0||Ne(!1),i=i.slice(0,Math.min(i.length,d+1))}let l=!1,c=-1;if(n&&r&&r.v7_partialHydration)for(let d=0;d<i.length;d++){let u=i[d];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(c=d),u.route.id){let{loaderData:h,errors:p}=n,y=u.route.loader&&h[u.route.id]===void 0&&(!p||p[u.route.id]===void 0);if(u.route.lazy||y){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}return i.reduceRight((d,u,h)=>{let p,y=!1,f=null,v=null;n&&(p=s&&u.route.id?s[u.route.id]:void 0,f=u.route.errorElement||$N,l&&(c<0&&h===0?(y=!0,v=null):c===h&&(y=!0,v=u.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,h+1)),b=()=>{let w;return p?w=f:y?w=v:u.route.Component?w=m.createElement(u.route.Component,null):u.route.element?w=u.route.element:w=d,m.createElement(FN,{match:u,routeContext:{outlet:d,matches:g,isDataRoute:n!=null},children:w})};return n&&(u.route.ErrorBoundary||u.route.errorElement||h===0)?m.createElement(BN,{location:n.location,revalidation:n.revalidation,component:f,error:p,children:b(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):b()},null)}var fy=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(fy||{}),ti=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ti||{});function VN(t){let e=m.useContext(Ga);return e||Ne(!1),e}function WN(t){let e=m.useContext(dy);return e||Ne(!1),e}function UN(t){let e=m.useContext(un);return e||Ne(!1),e}function my(t){let e=UN(),n=e.matches[e.matches.length-1];return n.route.id||Ne(!1),n.route.id}function HN(){var t;let e=m.useContext(hy),n=WN(ti.UseRouteError),r=my(ti.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function qN(){let{router:t}=VN(fy.UseNavigateStable),e=my(ti.UseNavigateStable),n=m.useRef(!1);return py(()=>{n.current=!0}),m.useCallback(function(r,o){o===void 0&&(o={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,Za({fromRouteId:e},o)))},[t,e])}function QN(t){let{to:e,replace:n,state:r,relative:o}=t;Oo()||Ne(!1);let{future:a,static:i}=m.useContext(So),{matches:s}=m.useContext(un),{pathname:l}=Ja(),c=ei(),d=ql(e,Hl(s,a.v7_relativeSplatPath),l,o==="path"),u=JSON.stringify(d);return m.useEffect(()=>c(JSON.parse(u),{replace:n,state:r,relative:o}),[c,u,o,n,r]),null}function KN(t){return TN(t.context)}function Ao(t){Ne(!1)}function YN(t){let{basename:e="/",children:n=null,location:r,navigationType:o=ot.Pop,navigator:a,static:i=!1,future:s}=t;Oo()&&Ne(!1);let l=e.replace(/^\/*/,"/"),c=m.useMemo(()=>({basename:l,navigator:a,static:i,future:Za({v7_relativeSplatPath:!1},s)}),[l,s,a,i]);typeof r=="string"&&(r=kn(r));let{pathname:d="/",search:u="",hash:h="",state:p=null,key:y="default"}=r,f=m.useMemo(()=>{let v=_o(d,l);return v==null?null:{location:{pathname:v,search:u,hash:h,state:p,key:y},navigationType:o}},[l,d,u,h,p,y,o]);return f==null?null:m.createElement(So.Provider,{value:c},m.createElement(Jl.Provider,{children:n,value:f}))}new Promise(()=>{});function ec(t,e){e===void 0&&(e=[]);let n=[];return m.Children.forEach(t,(r,o)=>{if(!m.isValidElement(r))return;let a=[...e,o];if(r.type===m.Fragment){n.push.apply(n,ec(r.props.children,a));return}r.type!==Ao&&Ne(!1),!r.props.index||!r.props.children||Ne(!1);let i={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=ec(r.props.children,a)),n.push(i)}),n}function XN(t){let e={hasErrorBoundary:t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&Object.assign(e,{element:m.createElement(t.Component),Component:void 0}),t.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:m.createElement(t.HydrateFallback),HydrateFallback:void 0}),t.ErrorBoundary&&Object.assign(e,{errorElement:m.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),e}function ni(){return ni=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ni.apply(this,arguments)}const ZN="6";try{window.__reactRouterVersion=ZN}catch{}function GN(t,e){return hN({basename:e==null?void 0:e.basename,future:ni({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:DC({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||JN(),routes:t,mapRouteProperties:XN,unstable_dataStrategy:e==null?void 0:e.unstable_dataStrategy,unstable_patchRoutesOnNavigation:e==null?void 0:e.unstable_patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function JN(){var t;let e=(t=window)==null?void 0:t.__staticRouterHydrationData;return e&&e.errors&&(e=ni({},e,{errors:eS(e.errors)})),e}function eS(t){if(!t)return null;let e=Object.entries(t),n={};for(let[r,o]of e)if(o&&o.__type==="RouteErrorResponse")n[r]=new Ya(o.status,o.statusText,o.data,o.internal===!0);else if(o&&o.__type==="Error"){if(o.__subType){let a=window[o.__subType];if(typeof a=="function")try{let i=new a(o.message);i.stack="",n[r]=i}catch{}}if(n[r]==null){let a=new Error(o.message);a.stack="",n[r]=a}}else n[r]=o;return n}const tS=m.createContext({isTransitioning:!1}),nS=m.createContext(new Map),rS="startTransition",yy=JM[rS],oS="flushSync",gy=z6[oS];function aS(t){yy?yy(t):t()}function ko(t){gy?gy(t):t()}class iS{constructor(){this.status="pending",this.promise=new Promise((e,n)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",n(r))}})}}function sS(t){let{fallbackElement:e,router:n,future:r}=t,[o,a]=m.useState(n.state),[i,s]=m.useState(),[l,c]=m.useState({isTransitioning:!1}),[d,u]=m.useState(),[h,p]=m.useState(),[y,f]=m.useState(),v=m.useRef(new Map),{v7_startTransition:g}=r||{},b=m.useCallback(_=>{g?aS(_):_()},[g]),w=m.useCallback((_,O)=>{let{deletedFetchers:k,unstable_flushSync:I,unstable_viewTransitionOpts:B}=O;k.forEach(C=>v.current.delete(C)),_.fetchers.forEach((C,P)=>{C.data!==void 0&&v.current.set(P,C.data)});let L=n.window==null||n.window.document==null||typeof n.window.document.startViewTransition!="function";if(!B||L){I?ko(()=>a(_)):b(()=>a(_));return}if(I){ko(()=>{h&&(d&&d.resolve(),h.skipTransition()),c({isTransitioning:!0,flushSync:!0,currentLocation:B.currentLocation,nextLocation:B.nextLocation})});let C=n.window.document.startViewTransition(()=>{ko(()=>a(_))});C.finished.finally(()=>{ko(()=>{u(void 0),p(void 0),s(void 0),c({isTransitioning:!1})})}),ko(()=>p(C));return}h?(d&&d.resolve(),h.skipTransition(),f({state:_,currentLocation:B.currentLocation,nextLocation:B.nextLocation})):(s(_),c({isTransitioning:!0,flushSync:!1,currentLocation:B.currentLocation,nextLocation:B.nextLocation}))},[n.window,h,d,v,b]);m.useLayoutEffect(()=>n.subscribe(w),[n,w]),m.useEffect(()=>{l.isTransitioning&&!l.flushSync&&u(new iS)},[l]),m.useEffect(()=>{if(d&&i&&n.window){let _=i,O=d.promise,k=n.window.document.startViewTransition(async()=>{b(()=>a(_)),await O});k.finished.finally(()=>{u(void 0),p(void 0),s(void 0),c({isTransitioning:!1})}),p(k)}},[b,i,d,n.window]),m.useEffect(()=>{d&&i&&o.location.key===i.location.key&&d.resolve()},[d,h,o.location,i]),m.useEffect(()=>{!l.isTransitioning&&y&&(s(y.state),c({isTransitioning:!0,flushSync:!1,currentLocation:y.currentLocation,nextLocation:y.nextLocation}),f(void 0))},[l.isTransitioning,y]),m.useEffect(()=>{},[]);let E=m.useMemo(()=>({createHref:n.createHref,encodeLocation:n.encodeLocation,go:_=>n.navigate(_),push:(_,O,k)=>n.navigate(_,{state:O,preventScrollReset:k==null?void 0:k.preventScrollReset}),replace:(_,O,k)=>n.navigate(_,{replace:!0,state:O,preventScrollReset:k==null?void 0:k.preventScrollReset})}),[n]),M=n.basename||"/",S=m.useMemo(()=>({router:n,navigator:E,static:!1,basename:M}),[n,E,M]),N=m.useMemo(()=>({v7_relativeSplatPath:n.future.v7_relativeSplatPath}),[n.future.v7_relativeSplatPath]);return m.createElement(m.Fragment,null,m.createElement(Ga.Provider,{value:S},m.createElement(dy.Provider,{value:o},m.createElement(nS.Provider,{value:v.current},m.createElement(tS.Provider,{value:l},m.createElement(YN,{basename:M,location:o.location,navigationType:o.historyAction,navigator:E,future:N},o.initialized||n.future.v7_partialHydration?m.createElement(lS,{routes:n.routes,future:n.future,state:o}):e))))),null)}const lS=m.memo(cS);function cS(t){let{routes:e,future:n,state:r}=t;return DN(e,void 0,r,n)}var vy;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(vy||(vy={}));var xy;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(xy||(xy={}));var uS=JM.useId||(()=>{}),dS=0;It=function(t){const[e,n]=m.useState(uS());return dr(()=>{n(r=>r??String(dS++))},[t]),e?`radix-${e}`:""};let ri,by,wy,oi,tc;ri="Collapsible",[by,uC]=hr(ri),[wy,oi]=by(ri),tc=m.forwardRef((t,e)=>{const{__scopeCollapsible:n,open:r,defaultOpen:o,disabled:a,onOpenChange:i,...s}=t,[l=!1,c]=uo({prop:r,defaultProp:o,onChange:i});return x.jsx(wy,{scope:n,disabled:a,contentId:It(),open:l,onOpenToggle:m.useCallback(()=>c(d=>!d),[c]),children:x.jsx(Ue.div,{"data-state":ac(l),"data-disabled":a?"":void 0,...s,ref:e})})}),tc.displayName=ri;var Ey="CollapsibleTrigger",nc=m.forwardRef((t,e)=>{const{__scopeCollapsible:n,...r}=t,o=oi(Ey,n);return x.jsx(Ue.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":ac(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...r,ref:e,onClick:Me(t.onClick,o.onOpenToggle)})});nc.displayName=Ey;var rc="CollapsibleContent",oc=m.forwardRef((t,e)=>{const{forceMount:n,...r}=t,o=oi(rc,t.__scopeCollapsible);return x.jsx(on,{present:n||o.open,children:({present:a})=>x.jsx(hS,{...r,ref:e,present:a})})});oc.displayName=rc;var hS=m.forwardRef((t,e)=>{const{__scopeCollapsible:n,present:r,children:o,...a}=t,i=oi(rc,n),[s,l]=m.useState(r),c=m.useRef(null),d=yt(e,c),u=m.useRef(0),h=u.current,p=m.useRef(0),y=p.current,f=i.open||s,v=m.useRef(f),g=m.useRef();return m.useEffect(()=>{const b=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(b)},[]),dr(()=>{const b=c.current;if(b){g.current=g.current||{transitionDuration:b.style.transitionDuration,animationName:b.style.animationName},b.style.transitionDuration="0s",b.style.animationName="none";const w=b.getBoundingClientRect();u.current=w.height,p.current=w.width,v.current||(b.style.transitionDuration=g.current.transitionDuration,b.style.animationName=g.current.animationName),l(r)}},[i.open,r]),x.jsx(Ue.div,{"data-state":ac(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!f,...a,ref:d,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":y?`${y}px`:void 0,...t.style},children:f&&o})});function ac(t){return t?"open":"closed"}Cf=tc,pC=nc,fC=oc;const pS=Cf,fS=nc,mS=oc,ic=768;function yS(){const[t,e]=m.useState(void 0);return m.useEffect(()=>{const n=window.matchMedia(`(max-width: ${ic-1}px)`),r=()=>{e(window.innerWidth<ic)};return n.addEventListener("change",r),e(window.innerWidth<ic),()=>n.removeEventListener("change",r)},[]),!!t}Fa=Un("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Kn=m.forwardRef(({className:t,variant:e,size:n,asChild:r=!1,...o},a)=>{const i=r?Hn:"button";return x.jsx(i,{className:ne(Fa({variant:e,size:n,className:t})),ref:a,...o})}),Kn.displayName="Button",Ia=m.forwardRef(({className:t,type:e,...n},r)=>x.jsx("input",{type:e,className:ne("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...n})),Ia.displayName="Input";var gS="Separator",_y="horizontal",vS=["horizontal","vertical"],My=m.forwardRef((t,e)=>{const{decorative:n,orientation:r=_y,...o}=t,a=xS(r)?r:_y,i=n?{role:"none"}:{"aria-orientation":a==="vertical"?a:void 0,role:"separator"};return x.jsx(Ue.div,{"data-orientation":a,...i,...o,ref:e})});My.displayName=gS;function xS(t){return vS.includes(t)}yl=My,za=m.forwardRef(({className:t,orientation:e="horizontal",decorative:n=!0,...r},o)=>x.jsx(yl,{ref:o,decorative:n,orientation:e,className:ne("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...r})),za.displayName=yl.displayName;let ai,ii,sc,Cy;ai="focusScope.autoFocusOnMount",ii="focusScope.autoFocusOnUnmount",sc={bubbles:!1,cancelable:!0},Cy="FocusScope",ka=m.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:a,...i}=t,[s,l]=m.useState(null),c=qn(o),d=qn(a),u=m.useRef(null),h=yt(e,f=>l(f)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(r){let f=function(w){if(p.paused||!s)return;const E=w.target;s.contains(E)?u.current=E:Pn(u.current,{select:!0})},v=function(w){if(p.paused||!s)return;const E=w.relatedTarget;E!==null&&(s.contains(E)||Pn(u.current,{select:!0}))},g=function(w){if(document.activeElement===document.body)for(const E of w)E.removedNodes.length>0&&Pn(s)};document.addEventListener("focusin",f),document.addEventListener("focusout",v);const b=new MutationObserver(g);return s&&b.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",v),b.disconnect()}}},[r,s,p.paused]),m.useEffect(()=>{if(s){Oy.add(p);const f=document.activeElement;if(!s.contains(f)){const v=new CustomEvent(ai,sc);s.addEventListener(ai,c),s.dispatchEvent(v),v.defaultPrevented||(bS(CS(Ny(s)),{select:!0}),document.activeElement===f&&Pn(s))}return()=>{s.removeEventListener(ai,c),setTimeout(()=>{const v=new CustomEvent(ii,sc);s.addEventListener(ii,d),s.dispatchEvent(v),v.defaultPrevented||Pn(f??document.body,{select:!0}),s.removeEventListener(ii,d),Oy.remove(p)},0)}}},[s,c,d,p]);const y=m.useCallback(f=>{if(!n&&!r||p.paused)return;const v=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,g=document.activeElement;if(v&&g){const b=f.currentTarget,[w,E]=wS(b);w&&E?!f.shiftKey&&g===E?(f.preventDefault(),n&&Pn(w,{select:!0})):f.shiftKey&&g===w&&(f.preventDefault(),n&&Pn(E,{select:!0})):g===b&&f.preventDefault()}},[n,r,p.paused]);return x.jsx(Ue.div,{tabIndex:-1,...i,ref:h,onKeyDown:y})}),ka.displayName=Cy;function bS(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Pn(r,{select:e}),document.activeElement!==n)return}function wS(t){const e=Ny(t),n=Sy(e,t),r=Sy(e.reverse(),t);return[n,r]}function Ny(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Sy(t,e){for(const n of t)if(!ES(n,{upTo:e}))return n}function ES(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function _S(t){return t instanceof HTMLInputElement&&"select"in t}function Pn(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&_S(t)&&e&&t.select()}}var Oy=MS();function MS(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=Ay(t,e),t.unshift(e)},remove(e){var n;t=Ay(t,e),(n=t[0])==null||n.resume()}}}function Ay(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function CS(t){return t.filter(e=>e.tagName!=="A")}var lc=0;Hs=function(){m.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??ky()),document.body.insertAdjacentElement("beforeend",t[1]??ky()),lc++,()=>{lc===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),lc--}},[])};function ky(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Kt=function(){return Kt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Kt.apply(this,arguments)};function jy(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function NS(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,a;r<o;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))}var si="right-scroll-bar-position",li="width-before-scroll-bar",SS="with-scroll-bars-hidden",OS="--removed-body-scroll-bar-size";function cc(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function AS(t,e){var n=m.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=e,n.facade}var kS=typeof window<"u"?m.useLayoutEffect:m.useEffect,Ry=new WeakMap;function jS(t,e){var n=AS(null,function(r){return t.forEach(function(o){return cc(o,r)})});return kS(function(){var r=Ry.get(n);if(r){var o=new Set(r),a=new Set(t),i=n.current;o.forEach(function(s){a.has(s)||cc(s,null)}),a.forEach(function(s){o.has(s)||cc(s,i)})}Ry.set(n,t)},[t]),n}function RS(t){return t}function PS(t,e){e===void 0&&(e=RS);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(a){var i=e(a,r);return n.push(i),function(){n=n.filter(function(s){return s!==i})}},assignSyncMedium:function(a){for(r=!0;n.length;){var i=n;n=[],i.forEach(a)}n={push:function(s){return a(s)},filter:function(){return n}}},assignMedium:function(a){r=!0;var i=[];if(n.length){var s=n;n=[],s.forEach(a),i=n}var l=function(){var d=i;i=[],d.forEach(a)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(d){i.push(d),c()},filter:function(d){return i=i.filter(d),n}}}};return o}function TS(t){t===void 0&&(t={});var e=PS(null);return e.options=Kt({async:!0,ssr:!1},t),e}var Py=function(t){var e=t.sideCar,n=jy(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return m.createElement(r,Kt({},n))};Py.isSideCarExport=!0;function IS(t,e){return t.useMedium(e),Py}var Ty=TS(),uc=function(){},ci=m.forwardRef(function(t,e){var n=m.useRef(null),r=m.useState({onScrollCapture:uc,onWheelCapture:uc,onTouchMoveCapture:uc}),o=r[0],a=r[1],i=t.forwardProps,s=t.children,l=t.className,c=t.removeScrollBar,d=t.enabled,u=t.shards,h=t.sideCar,p=t.noIsolation,y=t.inert,f=t.allowPinchZoom,v=t.as,g=v===void 0?"div":v,b=t.gapMode,w=jy(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),E=h,M=jS([n,e]),S=Kt(Kt({},w),o);return m.createElement(m.Fragment,null,d&&m.createElement(E,{sideCar:Ty,removeScrollBar:c,shards:u,noIsolation:p,inert:y,setCallbacks:a,allowPinchZoom:!!f,lockRef:n,gapMode:b}),i?m.cloneElement(m.Children.only(s),Kt(Kt({},S),{ref:M})):m.createElement(g,Kt({},S,{className:l,ref:M}),s))});ci.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},ci.classNames={fullWidth:li,zeroRight:si};var DS=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function LS(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=DS();return e&&t.setAttribute("nonce",e),t}function $S(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function BS(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var FS=function(){var t=0,e=null;return{add:function(n){t==0&&(e=LS())&&($S(e,n),BS(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},zS=function(){var t=FS();return function(e,n){m.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},Iy=function(){var t=zS(),e=function(n){var r=n.styles,o=n.dynamic;return t(r,o),null};return e},VS={left:0,top:0,right:0,gap:0},dc=function(t){return parseInt(t||"",10)||0},WS=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],o=e[t==="padding"?"paddingRight":"marginRight"];return[dc(n),dc(r),dc(o)]},US=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return VS;var e=WS(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},HS=Iy(),Nr="data-scroll-locked",qS=function(t,e,n,r){var o=t.left,a=t.top,i=t.right,s=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(SS,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(s,"px ").concat(r,`;
  }
  body[`).concat(Nr,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(a,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(si,` {
    right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(li,` {
    margin-right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(si," .").concat(si,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(li," .").concat(li,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Nr,`] {
    `).concat(OS,": ").concat(s,`px;
  }
`)},Dy=function(){var t=parseInt(document.body.getAttribute(Nr)||"0",10);return isFinite(t)?t:0},QS=function(){m.useEffect(function(){return document.body.setAttribute(Nr,(Dy()+1).toString()),function(){var t=Dy()-1;t<=0?document.body.removeAttribute(Nr):document.body.setAttribute(Nr,t.toString())}},[])},KS=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,o=r===void 0?"margin":r;QS();var a=m.useMemo(function(){return US(o)},[o]);return m.createElement(HS,{styles:qS(a,!e,o,n?"":"!important")})},hc=!1;if(typeof window<"u")try{var ui=Object.defineProperty({},"passive",{get:function(){return hc=!0,!0}});window.addEventListener("test",ui,ui),window.removeEventListener("test",ui,ui)}catch{hc=!1}var Sr=hc?{passive:!1}:!1,YS=function(t){return t.tagName==="TEXTAREA"},Ly=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!YS(t)&&n[e]==="visible")},XS=function(t){return Ly(t,"overflowY")},ZS=function(t){return Ly(t,"overflowX")},$y=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=By(t,r);if(o){var a=Fy(t,r),i=a[1],s=a[2];if(i>s)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},GS=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},JS=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},By=function(t,e){return t==="v"?XS(e):ZS(e)},Fy=function(t,e){return t==="v"?GS(e):JS(e)},e2=function(t,e){return t==="h"&&e==="rtl"?-1:1},t2=function(t,e,n,r,o){var a=e2(t,window.getComputedStyle(e).direction),i=a*r,s=n.target,l=e.contains(s),c=!1,d=i>0,u=0,h=0;do{var p=Fy(t,s),y=p[0],f=p[1],v=p[2],g=f-v-a*y;(y||g)&&By(t,s)&&(u+=g,h+=y),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!l&&s!==document.body||l&&(e.contains(s)||e===s));return(d&&(Math.abs(u)<1||!o)||!d&&(Math.abs(h)<1||!o))&&(c=!0),c},di=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},zy=function(t){return[t.deltaX,t.deltaY]},Vy=function(t){return t&&"current"in t?t.current:t},n2=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r2=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},o2=0,Or=[];function a2(t){var e=m.useRef([]),n=m.useRef([0,0]),r=m.useRef(),o=m.useState(o2++)[0],a=m.useState(Iy)[0],i=m.useRef(t);m.useEffect(function(){i.current=t},[t]),m.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(o));var f=NS([t.lockRef.current],(t.shards||[]).map(Vy),!0).filter(Boolean);return f.forEach(function(v){return v.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),f.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(o))})}}},[t.inert,t.lockRef.current,t.shards]);var s=m.useCallback(function(f,v){if("touches"in f&&f.touches.length===2||f.type==="wheel"&&f.ctrlKey)return!i.current.allowPinchZoom;var g=di(f),b=n.current,w="deltaX"in f?f.deltaX:b[0]-g[0],E="deltaY"in f?f.deltaY:b[1]-g[1],M,S=f.target,N=Math.abs(w)>Math.abs(E)?"h":"v";if("touches"in f&&N==="h"&&S.type==="range")return!1;var _=$y(N,S);if(!_)return!0;if(_?M=N:(M=N==="v"?"h":"v",_=$y(N,S)),!_)return!1;if(!r.current&&"changedTouches"in f&&(w||E)&&(r.current=M),!M)return!0;var O=r.current||M;return t2(O,v,f,O==="h"?w:E,!0)},[]),l=m.useCallback(function(f){var v=f;if(!(!Or.length||Or[Or.length-1]!==a)){var g="deltaY"in v?zy(v):di(v),b=e.current.filter(function(M){return M.name===v.type&&(M.target===v.target||v.target===M.shadowParent)&&n2(M.delta,g)})[0];if(b&&b.should){v.cancelable&&v.preventDefault();return}if(!b){var w=(i.current.shards||[]).map(Vy).filter(Boolean).filter(function(M){return M.contains(v.target)}),E=w.length>0?s(v,w[0]):!i.current.noIsolation;E&&v.cancelable&&v.preventDefault()}}},[]),c=m.useCallback(function(f,v,g,b){var w={name:f,delta:v,target:g,should:b,shadowParent:i2(g)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(E){return E!==w})},1)},[]),d=m.useCallback(function(f){n.current=di(f),r.current=void 0},[]),u=m.useCallback(function(f){c(f.type,zy(f),f.target,s(f,t.lockRef.current))},[]),h=m.useCallback(function(f){c(f.type,di(f),f.target,s(f,t.lockRef.current))},[]);m.useEffect(function(){return Or.push(a),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",l,Sr),document.addEventListener("touchmove",l,Sr),document.addEventListener("touchstart",d,Sr),function(){Or=Or.filter(function(f){return f!==a}),document.removeEventListener("wheel",l,Sr),document.removeEventListener("touchmove",l,Sr),document.removeEventListener("touchstart",d,Sr)}},[]);var p=t.removeScrollBar,y=t.inert;return m.createElement(m.Fragment,null,y?m.createElement(a,{styles:r2(o)}):null,p?m.createElement(KS,{gapMode:t.gapMode}):null)}function i2(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const s2=IS(Ty,a2);Aa=m.forwardRef(function(t,e){return m.createElement(ci,Kt({},t,{ref:e,sideCar:s2}))}),Aa.classNames=ci.classNames;let Wy,er,jo,Ro,hi,pc,Uy,Hy,pi,fc,mc,qy,Rt,yc;Wy=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},er=new WeakMap,jo=new WeakMap,Ro={},hi=0,pc=function(t){return t&&(t.host||pc(t.parentNode))},Uy=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=pc(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Hy=function(t,e,n,r){var o=Uy(e,Array.isArray(t)?t:[t]);Ro[n]||(Ro[n]=new WeakMap);var a=Ro[n],i=[],s=new Set,l=new Set(o),c=function(u){!u||s.has(u)||(s.add(u),c(u.parentNode))};o.forEach(c);var d=function(u){!u||l.has(u)||Array.prototype.forEach.call(u.children,function(h){if(s.has(h))d(h);else try{var p=h.getAttribute(r),y=p!==null&&p!=="false",f=(er.get(h)||0)+1,v=(a.get(h)||0)+1;er.set(h,f),a.set(h,v),i.push(h),f===1&&y&&jo.set(h,!0),v===1&&h.setAttribute(n,"true"),y||h.setAttribute(r,"true")}catch(g){console.error("aria-hidden: cannot operate on ",h,g)}})};return d(e),s.clear(),hi++,function(){i.forEach(function(u){var h=er.get(u)-1,p=a.get(u)-1;er.set(u,h),a.set(u,p),h||(jo.has(u)||u.removeAttribute(r),jo.delete(u)),p||u.removeAttribute(n)}),hi--,hi||(er=new WeakMap,er=new WeakMap,jo=new WeakMap,Ro={})}},Us=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),o=Wy(t);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),Hy(r,o,n,"aria-hidden")):function(){return null}},pi="Dialog",[fc,mc]=hr(pi),[qy,Rt]=fc(pi),yc=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:o,onOpenChange:a,modal:i=!0}=t,s=m.useRef(null),l=m.useRef(null),[c=!1,d]=uo({prop:r,defaultProp:o,onChange:a});return x.jsx(qy,{scope:e,triggerRef:s,contentRef:l,contentId:It(),titleId:It(),descriptionId:It(),open:c,onOpenChange:d,onOpenToggle:m.useCallback(()=>d(u=>!u),[d]),modal:i,children:n})},yc.displayName=pi;var Qy="DialogTrigger",Ky=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=Rt(Qy,n),a=yt(e,o.triggerRef);return x.jsx(Ue.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":xc(o.open),...r,ref:a,onClick:Me(t.onClick,o.onOpenToggle)})});Ky.displayName=Qy;var gc="DialogPortal",[l2,Yy]=fc(gc,{forceMount:void 0}),Xy=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:o}=t,a=Rt(gc,e);return x.jsx(l2,{scope:e,forceMount:n,children:m.Children.map(r,i=>x.jsx(on,{present:n||a.open,children:x.jsx(df,{asChild:!0,container:o,children:i})}))})};Xy.displayName=gc;var fi="DialogOverlay",Zy=m.forwardRef((t,e)=>{const n=Yy(fi,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,a=Rt(fi,t.__scopeDialog);return a.modal?x.jsx(on,{present:r||a.open,children:x.jsx(c2,{...o,ref:e})}):null});Zy.displayName=fi;var c2=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=Rt(fi,n);return x.jsx(Aa,{as:Hn,allowPinchZoom:!0,shards:[o.contentRef],children:x.jsx(Ue.div,{"data-state":xc(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),tr="DialogContent",Gy=m.forwardRef((t,e)=>{const n=Yy(tr,t.__scopeDialog),{forceMount:r=n.forceMount,...o}=t,a=Rt(tr,t.__scopeDialog);return x.jsx(on,{present:r||a.open,children:a.modal?x.jsx(u2,{...o,ref:e}):x.jsx(d2,{...o,ref:e})})});Gy.displayName=tr;var u2=m.forwardRef((t,e)=>{const n=Rt(tr,t.__scopeDialog),r=m.useRef(null),o=yt(e,n.contentRef,r);return m.useEffect(()=>{const a=r.current;if(a)return Us(a)},[]),x.jsx(Jy,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Me(t.onCloseAutoFocus,a=>{var i;a.preventDefault(),(i=n.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Me(t.onPointerDownOutside,a=>{const i=a.detail.originalEvent,s=i.button===0&&i.ctrlKey===!0;(i.button===2||s)&&a.preventDefault()}),onFocusOutside:Me(t.onFocusOutside,a=>a.preventDefault())})}),d2=m.forwardRef((t,e)=>{const n=Rt(tr,t.__scopeDialog),r=m.useRef(!1),o=m.useRef(!1);return x.jsx(Jy,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var i,s;(i=t.onCloseAutoFocus)==null||i.call(t,a),a.defaultPrevented||(r.current||((s=n.triggerRef.current)==null||s.focus()),a.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:a=>{var s,l;(s=t.onInteractOutside)==null||s.call(t,a),a.defaultPrevented||(r.current=!0,a.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=a.target;(l=n.triggerRef.current)!=null&&l.contains(i)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&o.current&&a.preventDefault()}})}),Jy=m.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:a,...i}=t,s=Rt(tr,n),l=m.useRef(null),c=yt(e,l);return Hs(),x.jsxs(x.Fragment,{children:[x.jsx(ka,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:a,children:x.jsx(uf,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":xc(s.open),...i,ref:c,onDismiss:()=>s.onOpenChange(!1)})}),x.jsxs(x.Fragment,{children:[x.jsx(ig,{titleId:s.titleId}),x.jsx(lg,{contentRef:l,descriptionId:s.descriptionId})]})]})}),vc="DialogTitle",eg=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=Rt(vc,n);return x.jsx(Ue.h2,{id:o.titleId,...r,ref:e})});eg.displayName=vc;var tg="DialogDescription",ng=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=Rt(tg,n);return x.jsx(Ue.p,{id:o.descriptionId,...r,ref:e})});ng.displayName=tg;var rg="DialogClose",og=m.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,o=Rt(rg,n);return x.jsx(Ue.button,{type:"button",...r,ref:e,onClick:Me(t.onClick,()=>o.onOpenChange(!1))})});og.displayName=rg;function xc(t){return t?"open":"closed"}let bc,ag,wc,ig,sg,lg,cg;bc="DialogTitleWarning",[ag,wc]=V6(bc,{contentName:tr,titleName:vc,docsSlug:"dialog"}),ig=({titleId:t})=>{const e=wc(bc),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return m.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},sg="DialogDescriptionWarning",lg=({contentRef:t,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${wc(sg).contentName}}.`;return m.useEffect(()=>{var o;const r=(o=t.current)==null?void 0:o.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(n))},[n,t,e]),null},Ra=yc,cg=Ky,Pa=Xy,fr=Zy,mr=Gy,wr=eg,Er=ng,vo=og;const h2=Ra,p2=Pa,ug=m.forwardRef(({className:t,...e},n)=>x.jsx(fr,{className:ne("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:n}));ug.displayName=fr.displayName;const f2=Un("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),dg=m.forwardRef(({side:t="right",className:e,children:n,...r},o)=>x.jsxs(p2,{children:[x.jsx(ug,{}),x.jsxs(mr,{ref:o,className:ne(f2({side:t}),e),...r,children:[n,x.jsxs(vo,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[x.jsx($e,{name:"x",className:"h-4 w-4"}),x.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));dg.displayName=mr.displayName;const m2=m.forwardRef(({className:t,...e},n)=>x.jsx(wr,{ref:n,className:ne("text-lg font-semibold text-foreground",t),...e}));m2.displayName=wr.displayName;const y2=m.forwardRef(({className:t,...e},n)=>x.jsx(Er,{ref:n,className:ne("text-sm text-muted-foreground",t),...e}));y2.displayName=Er.displayName;function hg({className:t,...e}){return x.jsx("div",{className:ne("animate-pulse rounded-md bg-muted",t),...e})}const g2=["top","right","bottom","left"],Yt=Math.min,Ct=Math.max,mi=Math.round,yi=Math.floor,Tn=t=>({x:t,y:t}),v2={left:"right",right:"left",bottom:"top",top:"bottom"},x2={start:"end",end:"start"};function Ec(t,e,n){return Ct(t,Yt(e,n))}function dn(t,e){return typeof t=="function"?t(e):t}function hn(t){return t.split("-")[0]}function Ar(t){return t.split("-")[1]}function _c(t){return t==="x"?"y":"x"}function Mc(t){return t==="y"?"height":"width"}function In(t){return["top","bottom"].includes(hn(t))?"y":"x"}function Cc(t){return _c(In(t))}function b2(t,e,n){n===void 0&&(n=!1);const r=Ar(t),o=Cc(t),a=Mc(o);let i=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(i=gi(i)),[i,gi(i)]}function w2(t){const e=gi(t);return[Nc(t),e,Nc(e)]}function Nc(t){return t.replace(/start|end/g,e=>x2[e])}function E2(t,e,n){const r=["left","right"],o=["right","left"],a=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:r:e?r:o;case"left":case"right":return e?a:i;default:return[]}}function _2(t,e,n,r){const o=Ar(t);let a=E2(hn(t),n==="start",r);return o&&(a=a.map(i=>i+"-"+o),e&&(a=a.concat(a.map(Nc)))),a}function gi(t){return t.replace(/left|right|bottom|top/g,e=>v2[e])}function M2(t){return{top:0,right:0,bottom:0,left:0,...t}}function pg(t){return typeof t!="number"?M2(t):{top:t,right:t,bottom:t,left:t}}function vi(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function fg(t,e,n){let{reference:r,floating:o}=t;const a=In(e),i=Cc(e),s=Mc(i),l=hn(e),c=a==="y",d=r.x+r.width/2-o.width/2,u=r.y+r.height/2-o.height/2,h=r[s]/2-o[s]/2;let p;switch(l){case"top":p={x:d,y:r.y-o.height};break;case"bottom":p={x:d,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:u};break;case"left":p={x:r.x-o.width,y:u};break;default:p={x:r.x,y:r.y}}switch(Ar(e)){case"start":p[i]-=h*(n&&c?-1:1);break;case"end":p[i]+=h*(n&&c?-1:1);break}return p}const C2=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:a=[],platform:i}=n,s=a.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:o}),{x:d,y:u}=fg(c,r,l),h=r,p={},y=0;for(let f=0;f<s.length;f++){const{name:v,fn:g}=s[f],{x:b,y:w,data:E,reset:M}=await g({x:d,y:u,initialPlacement:r,placement:h,strategy:o,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});d=b??d,u=w??u,p={...p,[v]:{...p[v],...E}},M&&y<=50&&(y++,typeof M=="object"&&(M.placement&&(h=M.placement),M.rects&&(c=M.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:o}):M.rects),{x:d,y:u}=fg(c,h,l)),f=-1)}return{x:d,y:u,placement:h,strategy:o,middlewareData:p}};async function Po(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:a,rects:i,elements:s,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=dn(e,t),y=pg(p),f=s[h?u==="floating"?"reference":"floating":u],v=vi(await a.getClippingRect({element:(n=await(a.isElement==null?void 0:a.isElement(f)))==null||n?f:f.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(s.floating)),boundary:c,rootBoundary:d,strategy:l})),g=u==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,b=await(a.getOffsetParent==null?void 0:a.getOffsetParent(s.floating)),w=await(a.isElement==null?void 0:a.isElement(b))?await(a.getScale==null?void 0:a.getScale(b))||{x:1,y:1}:{x:1,y:1},E=vi(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:g,offsetParent:b,strategy:l}):g);return{top:(v.top-E.top+y.top)/w.y,bottom:(E.bottom-v.bottom+y.bottom)/w.y,left:(v.left-E.left+y.left)/w.x,right:(E.right-v.right+y.right)/w.x}}const N2=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:a,platform:i,elements:s,middlewareData:l}=e,{element:c,padding:d=0}=dn(t,e)||{};if(c==null)return{};const u=pg(d),h={x:n,y:r},p=Cc(o),y=Mc(p),f=await i.getDimensions(c),v=p==="y",g=v?"top":"left",b=v?"bottom":"right",w=v?"clientHeight":"clientWidth",E=a.reference[y]+a.reference[p]-h[p]-a.floating[y],M=h[p]-a.reference[p],S=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let N=S?S[w]:0;(!N||!await(i.isElement==null?void 0:i.isElement(S)))&&(N=s.floating[w]||a.floating[y]);const _=E/2-M/2,O=N/2-f[y]/2-1,k=Yt(u[g],O),I=Yt(u[b],O),B=k,L=N-f[y]-I,C=N/2-f[y]/2+_,P=Ec(B,C,L),j=!l.arrow&&Ar(o)!=null&&C!==P&&a.reference[y]/2-(C<B?k:I)-f[y]/2<0,D=j?C<B?C-B:C-L:0;return{[p]:h[p]+D,data:{[p]:P,centerOffset:C-P-D,...j&&{alignmentOffset:D}},reset:j}}}),S2=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:a,rects:i,initialPlacement:s,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:f=!0,...v}=dn(t,e);if((n=a.arrow)!=null&&n.alignmentOffset)return{};const g=hn(o),b=In(s),w=hn(s)===s,E=await(l.isRTL==null?void 0:l.isRTL(c.floating)),M=h||(w||!f?[gi(s)]:w2(s)),S=y!=="none";!h&&S&&M.push(..._2(s,f,y,E));const N=[s,...M],_=await Po(e,v),O=[];let k=((r=a.flip)==null?void 0:r.overflows)||[];if(d&&O.push(_[g]),u){const C=b2(o,i,E);O.push(_[C[0]],_[C[1]])}if(k=[...k,{placement:o,overflows:O}],!O.every(C=>C<=0)){var I,B;const C=(((I=a.flip)==null?void 0:I.index)||0)+1,P=N[C];if(P)return{data:{index:C,overflows:k},reset:{placement:P}};let j=(B=k.filter(D=>D.overflows[0]<=0).sort((D,R)=>D.overflows[1]-R.overflows[1])[0])==null?void 0:B.placement;if(!j)switch(p){case"bestFit":{var L;const D=(L=k.filter(R=>{if(S){const A=In(R.placement);return A===b||A==="y"}return!0}).map(R=>[R.placement,R.overflows.filter(A=>A>0).reduce((A,V)=>A+V,0)]).sort((R,A)=>R[1]-A[1])[0])==null?void 0:L[0];D&&(j=D);break}case"initialPlacement":j=s;break}if(o!==j)return{reset:{placement:j}}}return{}}}};function mg(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function yg(t){return g2.some(e=>t[e]>=0)}const O2=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...o}=dn(t,e);switch(r){case"referenceHidden":{const a=await Po(e,{...o,elementContext:"reference"}),i=mg(a,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:yg(i)}}}case"escaped":{const a=await Po(e,{...o,altBoundary:!0}),i=mg(a,n.floating);return{data:{escapedOffsets:i,escaped:yg(i)}}}default:return{}}}}};async function A2(t,e){const{placement:n,platform:r,elements:o}=t,a=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=hn(n),s=Ar(n),l=In(n)==="y",c=["left","top"].includes(i)?-1:1,d=a&&l?-1:1,u=dn(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:y}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return s&&typeof y=="number"&&(p=s==="end"?y*-1:y),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}const k2=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:a,placement:i,middlewareData:s}=e,l=await A2(e,t);return i===((n=s.offset)==null?void 0:n.placement)&&(r=s.arrow)!=null&&r.alignmentOffset?{}:{x:o+l.x,y:a+l.y,data:{...l,placement:i}}}}},j2=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:a=!0,crossAxis:i=!1,limiter:s={fn:v=>{let{x:g,y:b}=v;return{x:g,y:b}}},...l}=dn(t,e),c={x:n,y:r},d=await Po(e,l),u=In(hn(o)),h=_c(u);let p=c[h],y=c[u];if(a){const v=h==="y"?"top":"left",g=h==="y"?"bottom":"right",b=p+d[v],w=p-d[g];p=Ec(b,p,w)}if(i){const v=u==="y"?"top":"left",g=u==="y"?"bottom":"right",b=y+d[v],w=y-d[g];y=Ec(b,y,w)}const f=s.fn({...e,[h]:p,[u]:y});return{...f,data:{x:f.x-n,y:f.y-r}}}}},R2=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:o,rects:a,middlewareData:i}=e,{offset:s=0,mainAxis:l=!0,crossAxis:c=!0}=dn(t,e),d={x:n,y:r},u=In(o),h=_c(u);let p=d[h],y=d[u];const f=dn(s,e),v=typeof f=="number"?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){const w=h==="y"?"height":"width",E=a.reference[h]-a.floating[w]+v.mainAxis,M=a.reference[h]+a.reference[w]-v.mainAxis;p<E?p=E:p>M&&(p=M)}if(c){var g,b;const w=h==="y"?"width":"height",E=["top","left"].includes(hn(o)),M=a.reference[u]-a.floating[w]+(E&&((g=i.offset)==null?void 0:g[u])||0)+(E?0:v.crossAxis),S=a.reference[u]+a.reference[w]+(E?0:((b=i.offset)==null?void 0:b[u])||0)-(E?v.crossAxis:0);y<M?y=M:y>S&&(y=S)}return{[h]:p,[u]:y}}}},P2=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:n,rects:r,platform:o,elements:a}=e,{apply:i=()=>{},...s}=dn(t,e),l=await Po(e,s),c=hn(n),d=Ar(n),u=In(n)==="y",{width:h,height:p}=r.floating;let y,f;c==="top"||c==="bottom"?(y=c,f=d===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(f=c,y=d==="end"?"top":"bottom");const v=p-l.top-l.bottom,g=h-l.left-l.right,b=Yt(p-l[y],v),w=Yt(h-l[f],g),E=!e.middlewareData.shift;let M=b,S=w;if(u?S=d||E?Yt(w,g):g:M=d||E?Yt(b,v):v,E&&!d){const _=Ct(l.left,0),O=Ct(l.right,0),k=Ct(l.top,0),I=Ct(l.bottom,0);u?S=h-2*(_!==0||O!==0?_+O:Ct(l.left,l.right)):M=p-2*(k!==0||I!==0?k+I:Ct(l.top,l.bottom))}await i({...e,availableWidth:S,availableHeight:M});const N=await o.getDimensions(a.floating);return h!==N.width||p!==N.height?{reset:{rects:!0}}:{}}}};function kr(t){return gg(t)?(t.nodeName||"").toLowerCase():"#document"}function Nt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function pn(t){var e;return(e=(gg(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function gg(t){return t instanceof Node||t instanceof Nt(t).Node}function $t(t){return t instanceof Element||t instanceof Nt(t).Element}function Xt(t){return t instanceof HTMLElement||t instanceof Nt(t).HTMLElement}function vg(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Nt(t).ShadowRoot}function To(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=Bt(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(o)}function T2(t){return["table","td","th"].includes(kr(t))}function xi(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function Sc(t){const e=Oc(),n=$t(t)?Bt(t):t;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function I2(t){let e=Dn(t);for(;Xt(e)&&!jr(e);){if(Sc(e))return e;if(xi(e))return null;e=Dn(e)}return null}function Oc(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function jr(t){return["html","body","#document"].includes(kr(t))}function Bt(t){return Nt(t).getComputedStyle(t)}function bi(t){return $t(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Dn(t){if(kr(t)==="html")return t;const e=t.assignedSlot||t.parentNode||vg(t)&&t.host||pn(t);return vg(e)?e.host:e}function xg(t){const e=Dn(t);return jr(e)?t.ownerDocument?t.ownerDocument.body:t.body:Xt(e)&&To(e)?e:xg(e)}function Io(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=xg(t),a=o===((r=t.ownerDocument)==null?void 0:r.body),i=Nt(o);if(a){const s=Ac(i);return e.concat(i,i.visualViewport||[],To(o)?o:[],s&&n?Io(s):[])}return e.concat(o,Io(o,[],n))}function Ac(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function bg(t){const e=Bt(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=Xt(t),a=o?t.offsetWidth:n,i=o?t.offsetHeight:r,s=mi(n)!==a||mi(r)!==i;return s&&(n=a,r=i),{width:n,height:r,$:s}}function kc(t){return $t(t)?t:t.contextElement}function Rr(t){const e=kc(t);if(!Xt(e))return Tn(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:a}=bg(e);let i=(a?mi(n.width):n.width)/r,s=(a?mi(n.height):n.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!s||!Number.isFinite(s))&&(s=1),{x:i,y:s}}const D2=Tn(0);function wg(t){const e=Nt(t);return!Oc()||!e.visualViewport?D2:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function L2(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Nt(t)?!1:e}function nr(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),a=kc(t);let i=Tn(1);e&&(r?$t(r)&&(i=Rr(r)):i=Rr(t));const s=L2(a,n,r)?wg(a):Tn(0);let l=(o.left+s.x)/i.x,c=(o.top+s.y)/i.y,d=o.width/i.x,u=o.height/i.y;if(a){const h=Nt(a),p=r&&$t(r)?Nt(r):r;let y=h,f=Ac(y);for(;f&&r&&p!==y;){const v=Rr(f),g=f.getBoundingClientRect(),b=Bt(f),w=g.left+(f.clientLeft+parseFloat(b.paddingLeft))*v.x,E=g.top+(f.clientTop+parseFloat(b.paddingTop))*v.y;l*=v.x,c*=v.y,d*=v.x,u*=v.y,l+=w,c+=E,y=Nt(f),f=Ac(y)}}return vi({width:d,height:u,x:l,y:c})}function $2(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const a=o==="fixed",i=pn(r),s=e?xi(e.floating):!1;if(r===i||s&&a)return n;let l={scrollLeft:0,scrollTop:0},c=Tn(1);const d=Tn(0),u=Xt(r);if((u||!u&&!a)&&((kr(r)!=="body"||To(i))&&(l=bi(r)),Xt(r))){const h=nr(r);c=Rr(r),d.x=h.x+r.clientLeft,d.y=h.y+r.clientTop}return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+d.x,y:n.y*c.y-l.scrollTop*c.y+d.y}}function B2(t){return Array.from(t.getClientRects())}function Eg(t){return nr(pn(t)).left+bi(t).scrollLeft}function F2(t){const e=pn(t),n=bi(t),r=t.ownerDocument.body,o=Ct(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),a=Ct(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+Eg(t);const s=-n.scrollTop;return Bt(r).direction==="rtl"&&(i+=Ct(e.clientWidth,r.clientWidth)-o),{width:o,height:a,x:i,y:s}}function z2(t,e){const n=Nt(t),r=pn(t),o=n.visualViewport;let a=r.clientWidth,i=r.clientHeight,s=0,l=0;if(o){a=o.width,i=o.height;const c=Oc();(!c||c&&e==="fixed")&&(s=o.offsetLeft,l=o.offsetTop)}return{width:a,height:i,x:s,y:l}}function V2(t,e){const n=nr(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,a=Xt(t)?Rr(t):Tn(1),i=t.clientWidth*a.x,s=t.clientHeight*a.y,l=o*a.x,c=r*a.y;return{width:i,height:s,x:l,y:c}}function _g(t,e,n){let r;if(e==="viewport")r=z2(t,n);else if(e==="document")r=F2(pn(t));else if($t(e))r=V2(e,n);else{const o=wg(t);r={...e,x:e.x-o.x,y:e.y-o.y}}return vi(r)}function Mg(t,e){const n=Dn(t);return n===e||!$t(n)||jr(n)?!1:Bt(n).position==="fixed"||Mg(n,e)}function W2(t,e){const n=e.get(t);if(n)return n;let r=Io(t,[],!1).filter(s=>$t(s)&&kr(s)!=="body"),o=null;const a=Bt(t).position==="fixed";let i=a?Dn(t):t;for(;$t(i)&&!jr(i);){const s=Bt(i),l=Sc(i);!l&&s.position==="fixed"&&(o=null),(a?!l&&!o:!l&&s.position==="static"&&o&&["absolute","fixed"].includes(o.position)||To(i)&&!l&&Mg(t,i))?r=r.filter(c=>c!==i):o=s,i=Dn(i)}return e.set(t,r),r}function U2(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const a=[...n==="clippingAncestors"?xi(e)?[]:W2(e,this._c):[].concat(n),r],i=a[0],s=a.reduce((l,c)=>{const d=_g(e,c,o);return l.top=Ct(d.top,l.top),l.right=Yt(d.right,l.right),l.bottom=Yt(d.bottom,l.bottom),l.left=Ct(d.left,l.left),l},_g(e,i,o));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function H2(t){const{width:e,height:n}=bg(t);return{width:e,height:n}}function q2(t,e,n){const r=Xt(e),o=pn(e),a=n==="fixed",i=nr(t,!0,a,e);let s={scrollLeft:0,scrollTop:0};const l=Tn(0);if(r||!r&&!a)if((kr(e)!=="body"||To(o))&&(s=bi(e)),r){const u=nr(e,!0,a,e);l.x=u.x+e.clientLeft,l.y=u.y+e.clientTop}else o&&(l.x=Eg(o));const c=i.left+s.scrollLeft-l.x,d=i.top+s.scrollTop-l.y;return{x:c,y:d,width:i.width,height:i.height}}function jc(t){return Bt(t).position==="static"}function Cg(t,e){return!Xt(t)||Bt(t).position==="fixed"?null:e?e(t):t.offsetParent}function Ng(t,e){const n=Nt(t);if(xi(t))return n;if(!Xt(t)){let o=Dn(t);for(;o&&!jr(o);){if($t(o)&&!jc(o))return o;o=Dn(o)}return n}let r=Cg(t,e);for(;r&&T2(r)&&jc(r);)r=Cg(r,e);return r&&jr(r)&&jc(r)&&!Sc(r)?n:r||I2(t)||n}const Q2=async function(t){const e=this.getOffsetParent||Ng,n=this.getDimensions,r=await n(t.floating);return{reference:q2(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function K2(t){return Bt(t).direction==="rtl"}const Y2={convertOffsetParentRelativeRectToViewportRelativeRect:$2,getDocumentElement:pn,getClippingRect:U2,getOffsetParent:Ng,getElementRects:Q2,getClientRects:B2,getDimensions:H2,getScale:Rr,isElement:$t,isRTL:K2};function X2(t,e){let n=null,r;const o=pn(t);function a(){var s;clearTimeout(r),(s=n)==null||s.disconnect(),n=null}function i(s,l){s===void 0&&(s=!1),l===void 0&&(l=1),a();const{left:c,top:d,width:u,height:h}=t.getBoundingClientRect();if(s||e(),!u||!h)return;const p=yi(d),y=yi(o.clientWidth-(c+u)),f=yi(o.clientHeight-(d+h)),v=yi(c),g={rootMargin:-p+"px "+-y+"px "+-f+"px "+-v+"px",threshold:Ct(0,Yt(1,l))||1};let b=!0;function w(E){const M=E[0].intersectionRatio;if(M!==l){if(!b)return i();M?i(!1,M):r=setTimeout(()=>{i(!1,1e-7)},1e3)}b=!1}try{n=new IntersectionObserver(w,{...g,root:o.ownerDocument})}catch{n=new IntersectionObserver(w,g)}n.observe(t)}return i(!0),a}Kf=function(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:a=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=kc(t),d=o||a?[...c?Io(c):[],...Io(e)]:[];d.forEach(g=>{o&&g.addEventListener("scroll",n,{passive:!0}),a&&g.addEventListener("resize",n)});const u=c&&s?X2(c,n):null;let h=-1,p=null;i&&(p=new ResizeObserver(g=>{let[b]=g;b&&b.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var w;(w=p)==null||w.observe(e)})),n()}),c&&!l&&p.observe(c),p.observe(e));let y,f=l?nr(t):null;l&&v();function v(){const g=nr(t);f&&(g.x!==f.x||g.y!==f.y||g.width!==f.width||g.height!==f.height)&&n(),f=g,y=requestAnimationFrame(v)}return n(),()=>{var g;d.forEach(b=>{o&&b.removeEventListener("scroll",n),a&&b.removeEventListener("resize",n)}),u==null||u(),(g=p)==null||g.disconnect(),p=null,l&&cancelAnimationFrame(y)}};let Sg;pm=k2,vm=j2,fm=S2,bm=P2,Sg=O2,Bl=N2,xm=R2,Qf=(t,e,n)=>{const r=new Map,o={platform:Y2,...n},a={...o.platform,_c:r};return C2(t,e,{...o,platform:a})};var wi=typeof document<"u"?m.useLayoutEffect:m.useEffect;function Ei(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!Ei(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const a=o[r];if(!(a==="_owner"&&t.$$typeof)&&!Ei(t[a],e[a]))return!1}return!0}return t!==t&&e!==e}function Og(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Ag(t,e){const n=Og(t);return Math.round(e*n)/n}function kg(t){const e=m.useRef(t);return wi(()=>{e.current=t}),e}function Z2(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:a,floating:i}={},transform:s=!0,whileElementsMounted:l,open:c}=t,[d,u]=m.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=m.useState(r);Ei(h,r)||p(r);const[y,f]=m.useState(null),[v,g]=m.useState(null),b=m.useCallback(D=>{D!==S.current&&(S.current=D,f(D))},[]),w=m.useCallback(D=>{D!==N.current&&(N.current=D,g(D))},[]),E=a||y,M=i||v,S=m.useRef(null),N=m.useRef(null),_=m.useRef(d),O=l!=null,k=kg(l),I=kg(o),B=m.useCallback(()=>{if(!S.current||!N.current)return;const D={placement:e,strategy:n,middleware:h};I.current&&(D.platform=I.current),Qf(S.current,N.current,D).then(R=>{const A={...R,isPositioned:!0};L.current&&!Ei(_.current,A)&&(_.current=A,eC.flushSync(()=>{u(A)}))})},[h,e,n,I]);wi(()=>{c===!1&&_.current.isPositioned&&(_.current.isPositioned=!1,u(D=>({...D,isPositioned:!1})))},[c]);const L=m.useRef(!1);wi(()=>(L.current=!0,()=>{L.current=!1}),[]),wi(()=>{if(E&&(S.current=E),M&&(N.current=M),E&&M){if(k.current)return k.current(E,M,B);B()}},[E,M,B,k,O]);const C=m.useMemo(()=>({reference:S,floating:N,setReference:b,setFloating:w}),[b,w]),P=m.useMemo(()=>({reference:E,floating:M}),[E,M]),j=m.useMemo(()=>{const D={position:n,left:0,top:0};if(!P.floating)return D;const R=Ag(P.floating,d.x),A=Ag(P.floating,d.y);return s?{...D,transform:"translate("+R+"px, "+A+"px)",...Og(P.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:R,top:A}},[n,s,P.floating,d.x,d.y]);return m.useMemo(()=>({...d,update:B,refs:C,elements:P,floatingStyles:j}),[d,B,C,P,j])}const G2=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?Bl({element:r.current,padding:o}).fn(n):{}:r?Bl({element:r,padding:o}).fn(n):{}}}},J2=(t,e)=>({...pm(t),options:[t,e]}),eO=(t,e)=>({...vm(t),options:[t,e]}),tO=(t,e)=>({...xm(t),options:[t,e]}),nO=(t,e)=>({...fm(t),options:[t,e]}),rO=(t,e)=>({...bm(t),options:[t,e]}),oO=(t,e)=>({...Sg(t),options:[t,e]}),aO=(t,e)=>({...G2(t),options:[t,e]});var iO="Arrow",jg=m.forwardRef((t,e)=>{const{children:n,width:r=10,height:o=5,...a}=t;return x.jsx(Ue.svg,{...a,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:x.jsx("polygon",{points:"0,0 30,0 15,10"})})});jg.displayName=iO;var sO=jg;function lO(t,e=[]){let n=[];function r(a,i){const s=m.createContext(i),l=n.length;n=[...n,i];function c(u){const{scope:h,children:p,...y}=u,f=(h==null?void 0:h[t][l])||s,v=m.useMemo(()=>y,Object.values(y));return x.jsx(f.Provider,{value:v,children:p})}function d(u,h){const p=(h==null?void 0:h[t][l])||s,y=m.useContext(p);if(y)return y;if(i!==void 0)return i;throw new Error(`\`${u}\` must be used within \`${a}\``)}return c.displayName=a+"Provider",[c,d]}const o=()=>{const a=n.map(i=>m.createContext(i));return function(i){const s=(i==null?void 0:i[t])||a;return m.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return o.scopeName=t,[r,cO(o,...e)]}function cO(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(o){const a=r.reduce((i,{useScope:s,scopeName:l})=>{const c=s(o)[`__scope${l}`];return{...i,...c}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}Nf=function(t){const[e,n]=m.useState(void 0);return dr(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const a=o[0];let i,s;if("borderBoxSize"in a){const l=a.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,s=c.blockSize}else i=t.offsetWidth,s=t.offsetHeight;n({width:i,height:s})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e};let _i,Rc,Rg,Pc,Tc;_i="Popper",[Rc,xo]=lO(_i),[Rg,Pc]=Rc(_i),Tc=t=>{const{__scopePopper:e,children:n}=t,[r,o]=m.useState(null);return x.jsx(Rg,{scope:e,anchor:r,onAnchorChange:o,children:n})},Tc.displayName=_i;var Pg="PopperAnchor",Tg=m.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...o}=t,a=Pc(Pg,n),i=m.useRef(null),s=yt(e,i);return m.useEffect(()=>{a.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:x.jsx(Ue.div,{...o,ref:s})});Tg.displayName=Pg;var Ic="PopperContent",[uO,dO]=Rc(Ic),Ig=m.forwardRef((t,e)=>{var ce,U,te,re,ie,X;const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:a="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:d=0,sticky:u="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:y,...f}=t,v=Pc(Ic,n),[g,b]=m.useState(null),w=yt(e,oe=>b(oe)),[E,M]=m.useState(null),S=Nf(E),N=(S==null?void 0:S.width)??0,_=(S==null?void 0:S.height)??0,O=r+(a!=="center"?"-"+a:""),k=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},I=Array.isArray(c)?c:[c],B=I.length>0,L={padding:k,boundary:I.filter(pO),altBoundary:B},{refs:C,floatingStyles:P,placement:j,isPositioned:D,middlewareData:R}=Z2({strategy:"fixed",placement:O,whileElementsMounted:(...oe)=>Kf(...oe,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[J2({mainAxis:o+_,alignmentAxis:i}),l&&eO({mainAxis:!0,crossAxis:!1,limiter:u==="partial"?tO():void 0,...L}),l&&nO({...L}),rO({...L,apply:({elements:oe,rects:he,availableWidth:ge,availableHeight:Ve})=>{const{width:st,height:Re}=he.reference,De=oe.floating.style;De.setProperty("--radix-popper-available-width",`${ge}px`),De.setProperty("--radix-popper-available-height",`${Ve}px`),De.setProperty("--radix-popper-anchor-width",`${st}px`),De.setProperty("--radix-popper-anchor-height",`${Re}px`)}}),E&&aO({element:E,padding:s}),fO({arrowWidth:N,arrowHeight:_}),h&&oO({strategy:"referenceHidden",...L})]}),[A,V]=$g(j),q=qn(y);dr(()=>{D&&(q==null||q())},[D,q]);const Y=(ce=R.arrow)==null?void 0:ce.x,H=(U=R.arrow)==null?void 0:U.y,G=((te=R.arrow)==null?void 0:te.centerOffset)!==0,[Z,J]=m.useState();return dr(()=>{g&&J(window.getComputedStyle(g).zIndex)},[g]),x.jsx("div",{ref:C.setFloating,"data-radix-popper-content-wrapper":"",style:{...P,transform:D?P.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Z,"--radix-popper-transform-origin":[(re=R.transformOrigin)==null?void 0:re.x,(ie=R.transformOrigin)==null?void 0:ie.y].join(" "),...((X=R.hide)==null?void 0:X.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:x.jsx(uO,{scope:n,placedSide:A,onArrowChange:M,arrowX:Y,arrowY:H,shouldHideArrow:G,children:x.jsx(Ue.div,{"data-side":A,"data-align":V,...f,ref:w,style:{...f.style,animation:D?void 0:"none"}})})})});Ig.displayName=Ic;var Dg="PopperArrow",hO={top:"bottom",right:"left",bottom:"top",left:"right"},Lg=m.forwardRef(function(t,e){const{__scopePopper:n,...r}=t,o=dO(Dg,n),a=hO[o.placedSide];return x.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:x.jsx(sO,{...r,ref:e,style:{...r.style,display:"block"}})})});Lg.displayName=Dg;function pO(t){return t!==null}var fO=t=>({name:"transformOrigin",options:t,fn(e){var f,v,g;const{placement:n,rects:r,middlewareData:o}=e,a=((f=o.arrow)==null?void 0:f.centerOffset)!==0,i=a?0:t.arrowWidth,s=a?0:t.arrowHeight,[l,c]=$g(n),d={start:"0%",center:"50%",end:"100%"}[c],u=(((v=o.arrow)==null?void 0:v.x)??0)+i/2,h=(((g=o.arrow)==null?void 0:g.y)??0)+s/2;let p="",y="";return l==="bottom"?(p=a?d:`${u}px`,y=`${-s}px`):l==="top"?(p=a?d:`${u}px`,y=`${r.floating.height+s}px`):l==="right"?(p=`${-s}px`,y=a?d:`${h}px`):l==="left"&&(p=`${r.floating.width+s}px`,y=a?d:`${h}px`),{data:{x:p,y}}}});function $g(t){const[e,n="center"]=t.split("-");return[e,n]}let Do,mO,Lo,Dc,Bg,Mi,Fg,Ci,Lc;ja=Tc,Wl=Tg,qs=Ig,Qs=Lg,[Do,mO]=hr("Tooltip",[xo]),Lo=xo(),Dc="TooltipProvider",Bg=700,Mi="tooltip.open",[Fg,Ci]=Do(Dc),Lc=t=>{const{__scopeTooltip:e,delayDuration:n=Bg,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:a}=t,[i,s]=m.useState(!0),l=m.useRef(!1),c=m.useRef(0);return m.useEffect(()=>{const d=c.current;return()=>window.clearTimeout(d)},[]),x.jsx(Fg,{scope:e,isOpenDelayed:i,delayDuration:n,onOpen:m.useCallback(()=>{window.clearTimeout(c.current),s(!1)},[]),onClose:m.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>s(!0),r)},[r]),isPointerInTransitRef:l,onPointerInTransitChange:m.useCallback(d=>{l.current=d},[]),disableHoverableContent:o,children:a})},Lc.displayName=Dc;var Ni="Tooltip",[yO,$o]=Do(Ni),zg=t=>{const{__scopeTooltip:e,children:n,open:r,defaultOpen:o=!1,onOpenChange:a,disableHoverableContent:i,delayDuration:s}=t,l=Ci(Ni,t.__scopeTooltip),c=Lo(e),[d,u]=m.useState(null),h=It(),p=m.useRef(0),y=i??l.disableHoverableContent,f=s??l.delayDuration,v=m.useRef(!1),[g=!1,b]=uo({prop:r,defaultProp:o,onChange:N=>{N?(l.onOpen(),document.dispatchEvent(new CustomEvent(Mi))):l.onClose(),a==null||a(N)}}),w=m.useMemo(()=>g?v.current?"delayed-open":"instant-open":"closed",[g]),E=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v.current=!1,b(!0)},[b]),M=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,b(!1)},[b]),S=m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,b(!0),p.current=0},f)},[f,b]);return m.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),x.jsx(ja,{...c,children:x.jsx(yO,{scope:e,contentId:h,open:g,stateAttribute:w,trigger:d,onTriggerChange:u,onTriggerEnter:m.useCallback(()=>{l.isOpenDelayed?S():E()},[l.isOpenDelayed,S,E]),onTriggerLeave:m.useCallback(()=>{y?M():(window.clearTimeout(p.current),p.current=0)},[M,y]),onOpen:E,onClose:M,disableHoverableContent:y,children:n})})};zg.displayName=Ni;var $c="TooltipTrigger",Vg=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=$o($c,n),a=Ci($c,n),i=Lo(n),s=m.useRef(null),l=yt(e,s,o.onTriggerChange),c=m.useRef(!1),d=m.useRef(!1),u=m.useCallback(()=>c.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",u),[u]),x.jsx(Wl,{asChild:!0,...i,children:x.jsx(Ue.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:l,onPointerMove:Me(t.onPointerMove,h=>{h.pointerType!=="touch"&&!d.current&&!a.isPointerInTransitRef.current&&(o.onTriggerEnter(),d.current=!0)}),onPointerLeave:Me(t.onPointerLeave,()=>{o.onTriggerLeave(),d.current=!1}),onPointerDown:Me(t.onPointerDown,()=>{c.current=!0,document.addEventListener("pointerup",u,{once:!0})}),onFocus:Me(t.onFocus,()=>{c.current||o.onOpen()}),onBlur:Me(t.onBlur,o.onClose),onClick:Me(t.onClick,o.onClose)})})});Vg.displayName=$c;var Bc="TooltipPortal",[gO,vO]=Do(Bc,{forceMount:void 0}),Wg=t=>{const{__scopeTooltip:e,forceMount:n,children:r,container:o}=t,a=$o(Bc,e);return x.jsx(gO,{scope:e,forceMount:n,children:x.jsx(on,{present:n||a.open,children:x.jsx(df,{asChild:!0,container:o,children:r})})})};Wg.displayName=Bc;var Pr="TooltipContent",Ug=m.forwardRef((t,e)=>{const n=vO(Pr,t.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...a}=t,i=$o(Pr,t.__scopeTooltip);return x.jsx(on,{present:r||i.open,children:i.disableHoverableContent?x.jsx(Hg,{side:o,...a,ref:e}):x.jsx(xO,{side:o,...a,ref:e})})}),xO=m.forwardRef((t,e)=>{const n=$o(Pr,t.__scopeTooltip),r=Ci(Pr,t.__scopeTooltip),o=m.useRef(null),a=yt(e,o),[i,s]=m.useState(null),{trigger:l,onClose:c}=n,d=o.current,{onPointerInTransitChange:u}=r,h=m.useCallback(()=>{s(null),u(!1)},[u]),p=m.useCallback((y,f)=>{const v=y.currentTarget,g={x:y.clientX,y:y.clientY},b=_O(g,v.getBoundingClientRect()),w=MO(g,b),E=CO(f.getBoundingClientRect()),M=SO([...w,...E]);s(M),u(!0)},[u]);return m.useEffect(()=>()=>h(),[h]),m.useEffect(()=>{if(l&&d){const y=v=>p(v,d),f=v=>p(v,l);return l.addEventListener("pointerleave",y),d.addEventListener("pointerleave",f),()=>{l.removeEventListener("pointerleave",y),d.removeEventListener("pointerleave",f)}}},[l,d,p,h]),m.useEffect(()=>{if(i){const y=f=>{const v=f.target,g={x:f.clientX,y:f.clientY},b=(l==null?void 0:l.contains(v))||(d==null?void 0:d.contains(v)),w=!NO(g,i);b?h():w&&(h(),c())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[l,d,i,c,h]),x.jsx(Hg,{...t,ref:a})}),[bO,wO]=Do(Ni,{isInside:!1}),Hg=m.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:a,onPointerDownOutside:i,...s}=t,l=$o(Pr,n),c=Lo(n),{onClose:d}=l;return m.useEffect(()=>(document.addEventListener(Mi,d),()=>document.removeEventListener(Mi,d)),[d]),m.useEffect(()=>{if(l.trigger){const u=h=>{var p;(p=h.target)!=null&&p.contains(l.trigger)&&d()};return window.addEventListener("scroll",u,{capture:!0}),()=>window.removeEventListener("scroll",u,{capture:!0})}},[l.trigger,d]),x.jsx(uf,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:a,onPointerDownOutside:i,onFocusOutside:u=>u.preventDefault(),onDismiss:d,children:x.jsxs(qs,{"data-state":l.stateAttribute,...c,...s,ref:e,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[x.jsx(tC,{children:r}),x.jsx(bO,{scope:n,isInside:!0,children:x.jsx(W6,{id:l.contentId,role:"tooltip",children:o||r})})]})})});Ug.displayName=Pr;var qg="TooltipArrow",EO=m.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,o=Lo(n);return wO(qg,n).isInside?null:x.jsx(Qs,{...o,...r,ref:e})});EO.displayName=qg;function _O(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),o=Math.abs(e.right-t.x),a=Math.abs(e.left-t.x);switch(Math.min(n,r,o,a)){case a:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function MO(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function CO(t){const{top:e,right:n,bottom:r,left:o}=t;return[{x:o,y:e},{x:n,y:e},{x:n,y:r},{x:o,y:r}]}function NO(t,e){const{x:n,y:r}=t;let o=!1;for(let a=0,i=e.length-1;a<e.length;i=a++){const s=e[a].x,l=e[a].y,c=e[i].x,d=e[i].y;l>r!=d>r&&n<(c-s)*(r-l)/(d-l)+s&&(o=!o)}return o}function SO(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),OO(e)}function OO(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const o=t[r];for(;e.length>=2;){const a=e[e.length-1],i=e[e.length-2];if((a.x-i.x)*(o.y-i.y)>=(a.y-i.y)*(o.x-i.x))e.pop();else break}e.push(o)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const o=t[r];for(;n.length>=2;){const a=n[n.length-1],i=n[n.length-2];if((a.x-i.x)*(o.y-i.y)>=(a.y-i.y)*(o.x-i.x))n.pop();else break}n.push(o)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}Yf=Lc,Xf=zg,Zf=Vg,wC=Wg,gl=Ug,Df=Yf,Lf=Xf,$f=Zf,ll=m.forwardRef(({className:t,sideOffset:e=4,...n},r)=>x.jsx(gl,{ref:r,sideOffset:e,className:ne("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})),ll.displayName=gl.displayName;const AO="sidebar:state",kO=60*60*24*7,jO="16rem",RO="18rem",PO="3rem",TO="b",Qg=m.createContext(null);function Bo(){const t=m.useContext(Qg);if(!t)throw new Error("useSidebar must be used within a SidebarProvider.");return t}const Fc=m.forwardRef(({defaultOpen:t=!0,open:e,onOpenChange:n,className:r,style:o,children:a,...i},s)=>{const l=yS(),[c,d]=m.useState(!1),[u,h]=m.useState(t),p=e??u,y=m.useCallback(b=>{const w=typeof b=="function"?b(p):b;n?n(w):h(w),document.cookie=`${AO}=${w}; path=/; max-age=${kO}`},[n,p]),f=m.useCallback(()=>l?d(b=>!b):y(b=>!b),[l,y,d]);m.useEffect(()=>{const b=w=>{w.key===TO&&(w.metaKey||w.ctrlKey)&&(w.preventDefault(),f())};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[f]);const v=p?"expanded":"collapsed",g=m.useMemo(()=>({state:v,open:p,setOpen:y,isMobile:l,openMobile:c,setOpenMobile:d,toggleSidebar:f}),[v,p,y,l,c,d,f]);return x.jsx(Qg.Provider,{value:g,children:x.jsx(Df,{delayDuration:0,children:x.jsx("div",{style:{"--sidebar-width":jO,"--sidebar-width-icon":PO,...o},className:ne("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",r),ref:s,...i,children:a})})})});Fc.displayName="SidebarProvider";const zc=m.forwardRef(({side:t="left",variant:e="sidebar",collapsible:n="offcanvas",className:r,children:o,...a},i)=>{const{isMobile:s,state:l,openMobile:c,setOpenMobile:d}=Bo();return n==="none"?x.jsx("div",{className:ne("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",r),ref:i,...a,children:o}):s?x.jsx(h2,{open:c,onOpenChange:d,...a,children:x.jsx(dg,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":RO},side:t,children:x.jsx("div",{className:"flex h-full w-full flex-col",children:o})})}):x.jsxs("div",{ref:i,className:"group peer hidden md:block text-sidebar-foreground","data-state":l,"data-collapsible":l==="collapsed"?n:"","data-variant":e,"data-side":t,children:[x.jsx("div",{className:ne("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",e==="floating"||e==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),x.jsx("div",{className:ne("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",t==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",e==="floating"||e==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",r),...a,children:x.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:o})})]})});zc.displayName="Sidebar";const Kg=m.forwardRef(({className:t,onClick:e,...n},r)=>{const{toggleSidebar:o}=Bo();return x.jsx(Kn,{ref:r,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:ne("h-7 w-7",t),onClick:a=>{e==null||e(a),o()},...n,children:x.jsx($e,{size:32,name:"panel-left"})})});Kg.displayName="SidebarTrigger";const Yg=m.forwardRef(({className:t,...e},n)=>{const{toggleSidebar:r}=Bo();return x.jsx("button",{ref:n,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:r,title:"Toggle Sidebar",className:ne("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...e})});Yg.displayName="SidebarRail";const Vc=m.forwardRef(({className:t,...e},n)=>x.jsx("main",{ref:n,className:ne("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...e}));Vc.displayName="SidebarInset";const IO=m.forwardRef(({className:t,...e},n)=>x.jsx(Ia,{ref:n,"data-sidebar":"input",className:ne("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...e}));IO.displayName="SidebarInput";const DO=m.forwardRef(({className:t,...e},n)=>x.jsx("div",{ref:n,"data-sidebar":"header",className:ne("flex flex-col gap-2 p-2",t),...e}));DO.displayName="SidebarHeader";const Xg=m.forwardRef(({className:t,...e},n)=>x.jsx("div",{ref:n,"data-sidebar":"footer",className:ne("flex flex-col gap-2 p-2",t),...e}));Xg.displayName="SidebarFooter";const LO=m.forwardRef(({className:t,...e},n)=>x.jsx(za,{ref:n,"data-sidebar":"separator",className:ne("mx-2 w-auto bg-sidebar-border",t),...e}));LO.displayName="SidebarSeparator";const Wc=m.forwardRef(({className:t,...e},n)=>x.jsx("div",{ref:n,"data-sidebar":"content",className:ne("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...e}));Wc.displayName="SidebarContent";const Fo=m.forwardRef(({className:t,...e},n)=>x.jsx("div",{ref:n,"data-sidebar":"group",className:ne("relative flex w-full min-w-0 flex-col p-2",t),...e}));Fo.displayName="SidebarGroup";const Si=m.forwardRef(({className:t,asChild:e=!1,...n},r)=>{const o=e?Hn:"div";return x.jsx(o,{ref:r,"data-sidebar":"group-label",className:ne("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...n})});Si.displayName="SidebarGroupLabel";const $O=m.forwardRef(({className:t,asChild:e=!1,...n},r)=>{const o=e?Hn:"button";return x.jsx(o,{ref:r,"data-sidebar":"group-action",className:ne("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...n})});$O.displayName="SidebarGroupAction";const BO=m.forwardRef(({className:t,...e},n)=>x.jsx("div",{ref:n,"data-sidebar":"group-content",className:ne("w-full text-sm",t),...e}));BO.displayName="SidebarGroupContent";const Tr=m.forwardRef(({className:t,...e},n)=>x.jsx("ul",{ref:n,"data-sidebar":"menu",className:ne("flex w-full min-w-0 flex-col gap-1",t),...e}));Tr.displayName="SidebarMenu";const fn=m.forwardRef(({className:t,...e},n)=>x.jsx("li",{ref:n,"data-sidebar":"menu-item",className:ne("group/menu-item relative",t),...e}));fn.displayName="SidebarMenuItem";const FO=Un("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),mn=m.forwardRef(({asChild:t=!1,isActive:e=!1,variant:n="default",size:r="default",tooltip:o,className:a,...i},s)=>{const l=t?Hn:"button",{isMobile:c,state:d}=Bo(),u=x.jsx(l,{ref:s,"data-sidebar":"menu-button","data-size":r,"data-active":e,className:ne(FO({variant:n,size:r}),a),...i});return o?(typeof o=="string"&&(o={children:o}),x.jsxs(Lf,{children:[x.jsx($f,{asChild:!0,children:u}),x.jsx(ll,{side:"right",align:"center",hidden:d!=="collapsed"||c,...o})]})):u});mn.displayName="SidebarMenuButton";const zO=m.forwardRef(({className:t,asChild:e=!1,showOnHover:n=!1,...r},o)=>{const a=e?Hn:"button";return x.jsx(a,{ref:o,"data-sidebar":"menu-action",className:ne("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",n&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...r})});zO.displayName="SidebarMenuAction";const VO=m.forwardRef(({className:t,...e},n)=>x.jsx("div",{ref:n,"data-sidebar":"menu-badge",className:ne("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...e}));VO.displayName="SidebarMenuBadge";const WO=m.forwardRef(({className:t,showIcon:e=!1,...n},r)=>{const o=m.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return x.jsxs("div",{ref:r,"data-sidebar":"menu-skeleton",className:ne("rounded-md h-8 flex gap-2 px-2 items-center",t),...n,children:[e&&x.jsx(hg,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),x.jsx(hg,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":o}})]})});WO.displayName="SidebarMenuSkeleton";const Zg=m.forwardRef(({className:t,...e},n)=>x.jsx("ul",{ref:n,"data-sidebar":"menu-sub",className:ne("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...e}));Zg.displayName="SidebarMenuSub";const Gg=m.forwardRef(({...t},e)=>x.jsx("li",{ref:e,...t}));Gg.displayName="SidebarMenuSubItem";const Jg=m.forwardRef(({asChild:t=!1,size:e="md",isActive:n,className:r,...o},a)=>{const i=t?Hn:"a";return x.jsx(i,{ref:a,"data-sidebar":"menu-sub-button","data-size":e,"data-active":n,className:ne("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",e==="sm"&&"text-xs",e==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",r),...o})});Jg.displayName="SidebarMenuSubButton";function UO({items:t}){const{t:e}=an("documents");return x.jsxs(Fo,{children:[x.jsx(Si,{children:x.jsx("div",{className:"text-sm",children:e("title")})}),x.jsx(Tr,{children:t.map(n=>{var r;return x.jsx(pS,{asChild:!0,defaultOpen:n.isActive,className:"group/collapsible",children:x.jsxs(fn,{children:[x.jsx(fS,{asChild:!0,children:x.jsxs(mn,{className:"cursor-pointer",tooltip:e(n.title),children:[n.icon,x.jsx("span",{children:e(n.title)}),x.jsx($e,{name:"chevron-right",className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),x.jsx(mS,{children:x.jsx(Zg,{children:(r=n.items)==null?void 0:r.map(o=>x.jsx(Gg,{className:"cursor-pointer",children:x.jsx(Jg,{asChild:!0,children:x.jsx("span",{children:e(o.title)})})},e(o.title)))})})]})},n.title)})})]})}const Uc={application:"/application/:applicationId?",whiteboard:"/whiteboard/:sessionId?"},Ft=(t,e)=>{const n=Uc[t];return e?Object.keys(e||{}).reduce((r,o)=>r.replace(`:${o}`,(e==null?void 0:e[o])||""),n):n.replace(/\/:[^/]+/g,"")},HO=m.memo(({text:t,colors:e={first:"#9E7AFF",second:"#FE8BBB"},className:n,sparklesCount:r=10,...o})=>{const[a,i]=m.useState([]);return m.useEffect(()=>{const s=()=>{const u=`${Math.random()*100}%`,h=`${Math.random()*100}%`,p=Math.random()>.5?e.first:e.second,y=Math.random()*2,f=Math.random()*1+.3,v=Math.random()*10+5;return{id:`${u}-${h}-${Date.now()}`,x:u,y:h,color:p,delay:y,scale:f,lifespan:v}},l=()=>{const u=Array.from({length:r},s);i(u)},c=()=>{i(u=>u.map(h=>h.lifespan<=0?s():{...h,lifespan:h.lifespan-.1}))};l();const d=setInterval(c,100);return()=>clearInterval(d)},[e.first,e.second]),x.jsx("div",{className:ne("text-6xl font-bold",n),...o,style:{"--sparkles-first-color":`${e.first}`,"--sparkles-second-color":`${e.second}`},children:x.jsxs("span",{className:"relative inline-block",children:[a.map(s=>x.jsx(qO,{...s},s.id)),x.jsx("strong",{children:t})]})})},(t,e)=>t.text===e.text),qO=({id:t,x:e,y:n,color:r,delay:o,scale:a})=>x.jsx(hf.svg,{className:"pointer-events-none absolute z-20",initial:{opacity:0,left:e,top:n},animate:{opacity:[0,1,0],scale:[0,a,0],rotate:[75,120,150]},transition:{duration:.8,repeat:1/0,delay:o},width:"21",height:"21",viewBox:"0 0 21 21",children:x.jsx("path",{d:"M9.82531 0.843845C10.0553 0.215178 10.9446 0.215178 11.1746 0.843845L11.8618 2.72026C12.4006 4.19229 12.3916 6.39157 13.5 7.5C14.6084 8.60843 16.8077 8.59935 18.2797 9.13822L20.1561 9.82534C20.7858 10.0553 20.7858 10.9447 20.1561 11.1747L18.2797 11.8618C16.8077 12.4007 14.6084 12.3916 13.5 13.5C12.3916 14.6084 12.4006 16.8077 11.8618 18.2798L11.1746 20.1562C10.9446 20.7858 10.0553 20.7858 9.82531 20.1562L9.13819 18.2798C8.59932 16.8077 8.60843 14.6084 7.5 13.5C6.39157 12.3916 4.19225 12.4007 2.72023 11.8618L0.843814 11.1747C0.215148 10.9447 0.215148 10.0553 0.843814 9.82534L2.72023 9.13822C4.19225 8.59935 6.39157 8.60843 7.5 7.5C8.60843 6.39157 8.59932 4.19229 9.13819 2.72026L9.82531 0.843845Z",fill:r})},t);function QO({className:t,onClick:e}){const{t:n}=an("sidebar");return x.jsxs(mn,{className:ne(t,"tw-w-full"),onClick:e,children:[x.jsx($e,{name:"frame"}),x.jsx(HO,{text:n("new_session"),className:"text-sm",sparklesCount:3})]})}let e0,t0,Hc;e0=()=>{const[t,e]=m.useState(!1),n=kt(i=>i.setCurrentSession),r=kt(i=>i.createSession),o=pf(i=>i.setSelectedSessionId),a=m.useCallback(async i=>{try{e(!0);const s=await r(i);n(s),o(s.id)}finally{e(!1)}},[r,n,o]);return{loading:t,createSession:a}},Sf=Ra,t0=Pa,Hc=m.forwardRef(({className:t,...e},n)=>x.jsx(fr,{ref:n,className:ne("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e})),Hc.displayName=fr.displayName,Zs=m.forwardRef(({className:t,children:e,...n},r)=>x.jsxs(t0,{children:[x.jsx(Hc,{}),x.jsxs(mr,{ref:r,className:ne("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[e,x.jsxs(vo,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[x.jsx($e,{name:"x",className:"h-4 w-4"}),x.jsx("span",{className:"sr-only",children:"Close"})]})]})]})),Zs.displayName=mr.displayName,Gs=({className:t,...e})=>x.jsx("div",{className:ne("flex flex-col space-y-1.5 text-center sm:text-left",t),...e}),Gs.displayName="DialogHeader",cl=({className:t,...e})=>x.jsx("div",{className:ne("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e}),cl.displayName="DialogFooter",Js=m.forwardRef(({className:t,...e},n)=>x.jsx(wr,{ref:n,className:ne("text-lg font-semibold leading-none tracking-tight",t),...e})),Js.displayName=wr.displayName,el=m.forwardRef(({className:t,...e},n)=>x.jsx(Er,{ref:n,className:ne("text-sm text-muted-foreground",t),...e})),el.displayName=Er.displayName;var KO="Label",n0=m.forwardRef((t,e)=>x.jsx(Ue.label,{...t,ref:e,onMouseDown:n=>{var r;n.target.closest("button, input, select, textarea")||((r=t.onMouseDown)==null||r.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));n0.displayName=KO;var r0=n0;let o0;o0=Un("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ta=m.forwardRef(({className:t,...e},n)=>x.jsx(r0,{ref:n,className:ne(o0(),t),...e})),Ta.displayName=r0.displayName;const YO=nC(()=>{const t=Oa(),{t:e}=an("dialogs"),[n,r]=m.useState(""),{toast:o}=rC(),{loading:a,createSession:i}=e0(),s=c=>{r(c.target.value)},l=async()=>{try{await i({name:n}),t.hide()}catch{o({variant:"destructive",description:e("create_session.errors.create_failed")})}};return x.jsx(Sf,{open:t.visible,onOpenChange:t.hide,children:x.jsxs(Zs,{className:"sm:max-w-[425px]",children:[x.jsxs(Gs,{children:[x.jsx(Js,{children:e("create_session.title")}),x.jsx(el,{children:e("create_session.description")})]}),x.jsx("div",{className:"grid gap-4 py-4",children:x.jsxs("div",{className:"flex flex-col space-y-1.5",children:[x.jsx(Ta,{className:"mb-2",htmlFor:"name",children:e("create_session.name")}),x.jsx(Ia,{onChange:s,id:"name",value:n,placeholder:e("create_session.name_placeholder")})]})}),x.jsx(cl,{children:x.jsx(Kn,{onClick:l,disabled:a||!n,type:"submit",children:e("create_session.create")})})]})})}),XO=()=>{const[t,e]=m.useState(!1),n=kt(o=>o.deleteSession),r=m.useCallback(async o=>{try{e(!0),await n(o),await Promise.all([je("FlowEdge").find({select:["id"],where:{session_id:o}}).then(a=>Promise.all(a.map(i=>je("FlowEdge").delete(i.id)))),je("FlowNode").find({select:["id"],where:{session_id:o}}).then(a=>Promise.all(a.map(i=>je("FlowNode").delete(i.id))))])}finally{e(!1)}},[n]);return{loading:t,deleteSession:r}};var a0="AlertDialog",[ZO,lL]=hr(a0,[mc]),yn=mc(),i0=t=>{const{__scopeAlertDialog:e,...n}=t,r=yn(e);return x.jsx(Ra,{...r,...n,modal:!0})};i0.displayName=a0;var GO="AlertDialogTrigger",JO=m.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,o=yn(n);return x.jsx(cg,{...o,...r,ref:e})});JO.displayName=GO;var eA="AlertDialogPortal",s0=t=>{const{__scopeAlertDialog:e,...n}=t,r=yn(e);return x.jsx(Pa,{...r,...n})};s0.displayName=eA;var tA="AlertDialogOverlay",l0=m.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,o=yn(n);return x.jsx(fr,{...o,...r,ref:e})});l0.displayName=tA;var Ir="AlertDialogContent",[nA,rA]=ZO(Ir),c0=m.forwardRef((t,e)=>{const{__scopeAlertDialog:n,children:r,...o}=t,a=yn(n),i=m.useRef(null),s=yt(e,i),l=m.useRef(null);return x.jsx(ag,{contentName:Ir,titleName:u0,docsSlug:"alert-dialog",children:x.jsx(nA,{scope:n,cancelRef:l,children:x.jsxs(mr,{role:"alertdialog",...a,...o,ref:s,onOpenAutoFocus:Me(o.onOpenAutoFocus,c=>{var d;c.preventDefault(),(d=l.current)==null||d.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault(),children:[x.jsx(tC,{children:r}),x.jsx(g0,{contentRef:i})]})})})});c0.displayName=Ir;var u0="AlertDialogTitle",d0=m.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,o=yn(n);return x.jsx(wr,{...o,...r,ref:e})});d0.displayName=u0;var h0="AlertDialogDescription",p0=m.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,o=yn(n);return x.jsx(Er,{...o,...r,ref:e})});p0.displayName=h0;var oA="AlertDialogAction",f0=m.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,o=yn(n);return x.jsx(vo,{...o,...r,ref:e})});f0.displayName=oA;var m0="AlertDialogCancel",y0=m.forwardRef((t,e)=>{const{__scopeAlertDialog:n,...r}=t,{cancelRef:o}=rA(m0,n),a=yn(n),i=yt(e,o);return x.jsx(vo,{...a,...r,ref:i})});y0.displayName=m0;let g0;g0=({contentRef:t})=>{const e=`\`${Ir}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Ir}\` by passing a \`${h0}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ir}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return m.useEffect(()=>{var n;document.getElementById((n=t.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(e)},[e,t]),null},ym=i0,mm=s0,Sl=l0,Ol=c0,ml=f0,$l=y0,Al=d0,kl=p0;const aA=ym,iA=mm,v0=m.forwardRef(({className:t,...e},n)=>x.jsx(Sl,{className:ne("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:n}));v0.displayName=Sl.displayName;const x0=m.forwardRef(({className:t,...e},n)=>x.jsxs(iA,{children:[x.jsx(v0,{}),x.jsx(Ol,{ref:n,className:ne("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...e})]}));x0.displayName=Ol.displayName;const b0=({className:t,...e})=>x.jsx("div",{className:ne("flex flex-col space-y-2 text-center sm:text-left",t),...e});b0.displayName="AlertDialogHeader";const w0=({className:t,...e})=>x.jsx("div",{className:ne("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});w0.displayName="AlertDialogFooter";const E0=m.forwardRef(({className:t,...e},n)=>x.jsx(Al,{ref:n,className:ne("text-lg font-semibold",t),...e}));E0.displayName=Al.displayName;const _0=m.forwardRef(({className:t,...e},n)=>x.jsx(kl,{ref:n,className:ne("text-sm text-muted-foreground",t),...e}));_0.displayName=kl.displayName;const M0=m.forwardRef(({className:t,...e},n)=>x.jsx(ml,{ref:n,className:ne(Fa(),t),...e}));M0.displayName=ml.displayName;const C0=m.forwardRef(({className:t,...e},n)=>x.jsx($l,{ref:n,className:ne(Fa({variant:"outline"}),"mt-2 sm:mt-0",t),...e}));C0.displayName=$l.displayName;const N0=nC(({id:t})=>{const{t:e}=an("dialogs"),n=Oa(),{toast:r}=rC(),{deleteSession:o}=XO(),a=async()=>{try{await o(t),n.hide()}catch{r({variant:"destructive",description:e("delete_session.errors.delete_failed")})}};return x.jsx(aA,{open:n.visible,onOpenChange:n.hide,children:x.jsxs(x0,{children:[x.jsxs(b0,{children:[x.jsx(E0,{children:e("delete_session.title")}),x.jsx(_0,{children:e("delete_session.description")})]}),x.jsxs(w0,{children:[x.jsx(C0,{onClick:n.hide,children:e("delete_session.cancel")}),x.jsx(M0,{onClick:a,children:e("delete_session.delete")})]})]})})});function sA({sessions:t,currentSession:e,setCurrentSession:n}){const{t:r}=an("sidebar"),o=ei(),a=Oa(YO),i=Oa(N0),s=m.useCallback(()=>{a.show({})},[a]),l=m.useCallback((d,u)=>{i.show({id:u}),d.preventDefault()},[i]),c=d=>{n(d),o(Ft("whiteboard",{sessionId:d.id}))};return x.jsxs(Fo,{className:"group-data-[collapsible=icon]:hidden",children:[x.jsx(Si,{children:x.jsx("div",{className:"text-sm",children:r("sessions")})}),x.jsxs(Tr,{children:[x.jsx(fn,{children:x.jsx(QO,{onClick:s,className:"w-full"})}),t.map(d=>x.jsx(fn,{className:"cursor-pointer",children:x.jsx(mn,{asChild:!0,onClick:()=>c(d),children:x.jsxs("div",{className:"flex flex-row justify-between items-center",children:[x.jsxs("div",{className:"flex gap-2",children:[(e==null?void 0:e.id)===d.id?x.jsx($e,{size:16,color:"green",name:"check"}):x.jsx($e,{size:16,name:"chevron-right"}),x.jsx("span",{children:d.name})]}),x.jsx($e,{onClick:u=>l(u,d.id),size:16,name:"trash-2"})]})})},d.id)),t!=null&&t.length?x.jsx(fn,{children:x.jsxs(mn,{className:"text-sidebar-foreground/70",children:[x.jsx($e,{name:"ellipsis",className:"text-sidebar-foreground/70"}),x.jsx("span",{children:r("more_session")})]})}):null]})]})}var lA=m.createContext(void 0);Vl=function(t){const e=m.useContext(lA);return t||e||"ltr"};function cA(t,e=[]){let n=[];function r(a,i){const s=m.createContext(i),l=n.length;n=[...n,i];function c(u){const{scope:h,children:p,...y}=u,f=(h==null?void 0:h[t][l])||s,v=m.useMemo(()=>y,Object.values(y));return x.jsx(f.Provider,{value:v,children:p})}function d(u,h){const p=(h==null?void 0:h[t][l])||s,y=m.useContext(p);if(y)return y;if(i!==void 0)return i;throw new Error(`\`${u}\` must be used within \`${a}\``)}return c.displayName=a+"Provider",[c,d]}const o=()=>{const a=n.map(i=>m.createContext(i));return function(i){const s=(i==null?void 0:i[t])||a;return m.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return o.scopeName=t,[r,uA(o,...e)]}function uA(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(o){const a=r.reduce((i,{useScope:s,scopeName:l})=>{const c=s(o)[`__scope${l}`];return{...i,...c}},{});return m.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}let Oi,S0,zo,Ai,qc,O0,A0,k0,j0,Qc;Oi="rovingFocusGroup.onEntryFocus",S0={bubbles:!1,cancelable:!0},zo="RovingFocusGroup",[Ai,qc,O0]=oC(zo),[A0,zl]=cA(zo,[O0]),[k0,j0]=A0(zo),Qc=m.forwardRef((t,e)=>x.jsx(Ai.Provider,{scope:t.__scopeRovingFocusGroup,children:x.jsx(Ai.Slot,{scope:t.__scopeRovingFocusGroup,children:x.jsx(dA,{...t,ref:e})})})),Qc.displayName=zo;var dA=m.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:o=!1,dir:a,currentTabStopId:i,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...u}=t,h=m.useRef(null),p=yt(e,h),y=Vl(a),[f=null,v]=uo({prop:i,defaultProp:s,onChange:l}),[g,b]=m.useState(!1),w=qn(c),E=qc(n),M=m.useRef(!1),[S,N]=m.useState(0);return m.useEffect(()=>{const _=h.current;if(_)return _.addEventListener(Oi,w),()=>_.removeEventListener(Oi,w)},[w]),x.jsx(k0,{scope:n,orientation:r,dir:y,loop:o,currentTabStopId:f,onItemFocus:m.useCallback(_=>v(_),[v]),onItemShiftTab:m.useCallback(()=>b(!0),[]),onFocusableItemAdd:m.useCallback(()=>N(_=>_+1),[]),onFocusableItemRemove:m.useCallback(()=>N(_=>_-1),[]),children:x.jsx(Ue.div,{tabIndex:g||S===0?-1:0,"data-orientation":r,...u,ref:p,style:{outline:"none",...t.style},onMouseDown:Me(t.onMouseDown,()=>{M.current=!0}),onFocus:Me(t.onFocus,_=>{const O=!M.current;if(_.target===_.currentTarget&&O&&!g){const k=new CustomEvent(Oi,S0);if(_.currentTarget.dispatchEvent(k),!k.defaultPrevented){const I=E().filter(P=>P.focusable),B=I.find(P=>P.active),L=I.find(P=>P.id===f),C=[B,L,...I].filter(Boolean).map(P=>P.ref.current);T0(C,d)}}M.current=!1}),onBlur:Me(t.onBlur,()=>b(!1))})})}),R0="RovingFocusGroupItem",P0=m.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:o=!1,tabStopId:a,...i}=t,s=It(),l=a||s,c=j0(R0,n),d=c.currentTabStopId===l,u=qc(n),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return m.useEffect(()=>{if(r)return h(),()=>p()},[r,h,p]),x.jsx(Ai.ItemSlot,{scope:n,id:l,focusable:r,active:o,children:x.jsx(Ue.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...i,ref:e,onMouseDown:Me(t.onMouseDown,y=>{r?c.onItemFocus(l):y.preventDefault()}),onFocus:Me(t.onFocus,()=>c.onItemFocus(l)),onKeyDown:Me(t.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){c.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const f=fA(y,c.orientation,c.dir);if(f!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let v=u().filter(g=>g.focusable).map(g=>g.ref.current);if(f==="last")v.reverse();else if(f==="prev"||f==="next"){f==="prev"&&v.reverse();const g=v.indexOf(y.currentTarget);v=c.loop?mA(v,g+1):v.slice(g+1)}setTimeout(()=>T0(v))}})})})});P0.displayName=R0;var hA={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function pA(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function fA(t,e,n){const r=pA(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return hA[r]}function T0(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function mA(t,e){return t.map((n,r)=>t[(e+r)%t.length])}let ki,I0,Kc,D0,L0,$0,Dr,Lr,B0,F0,Ln,$r,Yc,Xc,gn,z0,Br,Zc;wf=Qc,vf=P0,ki=["Enter"," "],I0=["ArrowDown","PageUp","Home"],Kc=["ArrowUp","PageDown","End"],D0=[...I0,...Kc],L0={ltr:[...ki,"ArrowRight"],rtl:[...ki,"ArrowLeft"]},$0={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Dr="Menu",[Lr,B0,F0]=oC(Dr),[Ln,Fl]=hr(Dr,[F0,xo,zl]),$r=xo(),Yc=zl(),[Xc,gn]=Ln(Dr),[z0,Br]=Ln(Dr),Zc=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:o,onOpenChange:a,modal:i=!0}=t,s=$r(e),[l,c]=m.useState(null),d=m.useRef(!1),u=qn(a),h=Vl(o);return m.useEffect(()=>{const p=()=>{d.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>d.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),x.jsx(ja,{...s,children:x.jsx(Xc,{scope:e,open:n,onOpenChange:u,content:l,onContentChange:c,children:x.jsx(z0,{scope:e,onClose:m.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:h,modal:i,children:r})})})},Zc.displayName=Dr;var yA="MenuAnchor",Gc=m.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,o=$r(n);return x.jsx(Wl,{...o,...r,ref:e})});Gc.displayName=yA;var Jc="MenuPortal",[gA,V0]=Ln(Jc,{forceMount:void 0}),W0=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:o}=t,a=gn(Jc,e);return x.jsx(gA,{scope:e,forceMount:n,children:x.jsx(on,{present:n||a.open,children:x.jsx(df,{asChild:!0,container:o,children:r})})})};W0.displayName=Jc;var Pt="MenuContent",[vA,eu]=Ln(Pt),U0=m.forwardRef((t,e)=>{const n=V0(Pt,t.__scopeMenu),{forceMount:r=n.forceMount,...o}=t,a=gn(Pt,t.__scopeMenu),i=Br(Pt,t.__scopeMenu);return x.jsx(Lr.Provider,{scope:t.__scopeMenu,children:x.jsx(on,{present:r||a.open,children:x.jsx(Lr.Slot,{scope:t.__scopeMenu,children:i.modal?x.jsx(xA,{...o,ref:e}):x.jsx(bA,{...o,ref:e})})})})}),xA=m.forwardRef((t,e)=>{const n=gn(Pt,t.__scopeMenu),r=m.useRef(null),o=yt(e,r);return m.useEffect(()=>{const a=r.current;if(a)return Us(a)},[]),x.jsx(tu,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Me(t.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),bA=m.forwardRef((t,e)=>{const n=gn(Pt,t.__scopeMenu);return x.jsx(tu,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),tu=m.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:o,onOpenAutoFocus:a,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:y,...f}=t,v=gn(Pt,n),g=Br(Pt,n),b=$r(n),w=Yc(n),E=B0(n),[M,S]=m.useState(null),N=m.useRef(null),_=yt(e,N,v.onContentChange),O=m.useRef(0),k=m.useRef(""),I=m.useRef(0),B=m.useRef(null),L=m.useRef("right"),C=m.useRef(0),P=y?Aa:m.Fragment,j=y?{as:Hn,allowPinchZoom:!0}:void 0,D=A=>{var ce,U;const V=k.current+A,q=E().filter(te=>!te.disabled),Y=document.activeElement,H=(ce=q.find(te=>te.ref.current===Y))==null?void 0:ce.textValue,G=q.map(te=>te.textValue),Z=RA(G,V,H),J=(U=q.find(te=>te.textValue===Z))==null?void 0:U.ref.current;(function te(re){k.current=re,window.clearTimeout(O.current),re!==""&&(O.current=window.setTimeout(()=>te(""),1e3))})(V),J&&setTimeout(()=>J.focus())};m.useEffect(()=>()=>window.clearTimeout(O.current),[]),Hs();const R=m.useCallback(A=>{var V,q;return L.current===((V=B.current)==null?void 0:V.side)&&TA(A,(q=B.current)==null?void 0:q.area)},[]);return x.jsx(vA,{scope:n,searchRef:k,onItemEnter:m.useCallback(A=>{R(A)&&A.preventDefault()},[R]),onItemLeave:m.useCallback(A=>{var V;R(A)||((V=N.current)==null||V.focus(),S(null))},[R]),onTriggerLeave:m.useCallback(A=>{R(A)&&A.preventDefault()},[R]),pointerGraceTimerRef:I,onPointerGraceIntentChange:m.useCallback(A=>{B.current=A},[]),children:x.jsx(P,{...j,children:x.jsx(ka,{asChild:!0,trapped:o,onMountAutoFocus:Me(a,A=>{var V;A.preventDefault(),(V=N.current)==null||V.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:x.jsx(uf,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,children:x.jsx(wf,{asChild:!0,...w,dir:g.dir,orientation:"vertical",loop:r,currentTabStopId:M,onCurrentTabStopIdChange:S,onEntryFocus:Me(l,A=>{g.isUsingKeyboardRef.current||A.preventDefault()}),preventScrollOnEntryFocus:!0,children:x.jsx(qs,{role:"menu","aria-orientation":"vertical","data-state":lv(v.open),"data-radix-menu-content":"",dir:g.dir,...b,...f,ref:_,style:{outline:"none",...f.style},onKeyDown:Me(f.onKeyDown,A=>{const V=A.target.closest("[data-radix-menu-content]")===A.currentTarget,q=A.ctrlKey||A.altKey||A.metaKey,Y=A.key.length===1;V&&(A.key==="Tab"&&A.preventDefault(),!q&&Y&&D(A.key));const H=N.current;if(A.target!==H||!D0.includes(A.key))return;A.preventDefault();const G=E().filter(Z=>!Z.disabled).map(Z=>Z.ref.current);Kc.includes(A.key)&&G.reverse(),kA(G)}),onBlur:Me(t.onBlur,A=>{A.currentTarget.contains(A.target)||(window.clearTimeout(O.current),k.current="")}),onPointerMove:Me(t.onPointerMove,Wo(A=>{const V=A.target,q=C.current!==A.clientX;if(A.currentTarget.contains(V)&&q){const Y=A.clientX>C.current?"right":"left";L.current=Y,C.current=A.clientX}}))})})})})})})});U0.displayName=Pt;var wA="MenuGroup",nu=m.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return x.jsx(Ue.div,{role:"group",...r,ref:e})});nu.displayName=wA;var EA="MenuLabel",H0=m.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return x.jsx(Ue.div,{...r,ref:e})});H0.displayName=EA;var ji="MenuItem",q0="menu.itemSelect",Ri=m.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...o}=t,a=m.useRef(null),i=Br(ji,t.__scopeMenu),s=eu(ji,t.__scopeMenu),l=yt(e,a),c=m.useRef(!1),d=()=>{const u=a.current;if(!n&&u){const h=new CustomEvent(q0,{bubbles:!0,cancelable:!0});u.addEventListener(q0,p=>r==null?void 0:r(p),{once:!0}),U6(u,h),h.defaultPrevented?c.current=!1:i.onClose()}};return x.jsx(Q0,{...o,ref:l,disabled:n,onClick:Me(t.onClick,d),onPointerDown:u=>{var h;(h=t.onPointerDown)==null||h.call(t,u),c.current=!0},onPointerUp:Me(t.onPointerUp,u=>{var h;c.current||((h=u.currentTarget)==null||h.click())}),onKeyDown:Me(t.onKeyDown,u=>{const h=s.searchRef.current!=="";n||h&&u.key===" "||ki.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Ri.displayName=ji;var Q0=m.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:o,...a}=t,i=eu(ji,n),s=Yc(n),l=m.useRef(null),c=yt(e,l),[d,u]=m.useState(!1),[h,p]=m.useState("");return m.useEffect(()=>{const y=l.current;y&&p((y.textContent??"").trim())},[a.children]),x.jsx(Lr.ItemSlot,{scope:n,disabled:r,textValue:o??h,children:x.jsx(vf,{asChild:!0,...s,focusable:!r,children:x.jsx(Ue.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...a,ref:c,onPointerMove:Me(t.onPointerMove,Wo(y=>{r?i.onItemLeave(y):(i.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Me(t.onPointerLeave,Wo(y=>i.onItemLeave(y))),onFocus:Me(t.onFocus,()=>u(!0)),onBlur:Me(t.onBlur,()=>u(!1))})})})}),_A="MenuCheckboxItem",K0=m.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...o}=t;return x.jsx(J0,{scope:t.__scopeMenu,checked:n,children:x.jsx(Ri,{role:"menuitemcheckbox","aria-checked":Pi(n)?"mixed":n,...o,ref:e,"data-state":au(n),onSelect:Me(o.onSelect,()=>r==null?void 0:r(Pi(n)?!0:!n),{checkForDefaultPrevented:!1})})})});K0.displayName=_A;var Y0="MenuRadioGroup",[MA,CA]=Ln(Y0,{value:void 0,onValueChange:()=>{}}),X0=m.forwardRef((t,e)=>{const{value:n,onValueChange:r,...o}=t,a=qn(r);return x.jsx(MA,{scope:t.__scopeMenu,value:n,onValueChange:a,children:x.jsx(nu,{...o,ref:e})})});X0.displayName=Y0;var Z0="MenuRadioItem",G0=m.forwardRef((t,e)=>{const{value:n,...r}=t,o=CA(Z0,t.__scopeMenu),a=n===o.value;return x.jsx(J0,{scope:t.__scopeMenu,checked:a,children:x.jsx(Ri,{role:"menuitemradio","aria-checked":a,...r,ref:e,"data-state":au(a),onSelect:Me(r.onSelect,()=>{var i;return(i=o.onValueChange)==null?void 0:i.call(o,n)},{checkForDefaultPrevented:!1})})})});G0.displayName=Z0;var ru="MenuItemIndicator",[J0,NA]=Ln(ru,{checked:!1}),ev=m.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...o}=t,a=NA(ru,n);return x.jsx(on,{present:r||Pi(a.checked)||a.checked===!0,children:x.jsx(Ue.span,{...o,ref:e,"data-state":au(a.checked)})})});ev.displayName=ru;var SA="MenuSeparator",tv=m.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return x.jsx(Ue.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});tv.displayName=SA;var OA="MenuArrow",nv=m.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,o=$r(n);return x.jsx(Qs,{...o,...r,ref:e})});nv.displayName=OA;var ou="MenuSub",[AA,rv]=Ln(ou),ov=t=>{const{__scopeMenu:e,children:n,open:r=!1,onOpenChange:o}=t,a=gn(ou,e),i=$r(e),[s,l]=m.useState(null),[c,d]=m.useState(null),u=qn(o);return m.useEffect(()=>(a.open===!1&&u(!1),()=>u(!1)),[a.open,u]),x.jsx(ja,{...i,children:x.jsx(Xc,{scope:e,open:r,onOpenChange:u,content:c,onContentChange:d,children:x.jsx(AA,{scope:e,contentId:It(),triggerId:It(),trigger:s,onTriggerChange:l,children:n})})})};ov.displayName=ou;var Vo="MenuSubTrigger",av=m.forwardRef((t,e)=>{const n=gn(Vo,t.__scopeMenu),r=Br(Vo,t.__scopeMenu),o=rv(Vo,t.__scopeMenu),a=eu(Vo,t.__scopeMenu),i=m.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:l}=a,c={__scopeMenu:t.__scopeMenu},d=m.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return m.useEffect(()=>d,[d]),m.useEffect(()=>{const u=s.current;return()=>{window.clearTimeout(u),l(null)}},[s,l]),x.jsx(Gc,{asChild:!0,...c,children:x.jsx(Q0,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":lv(n.open),...t,ref:aC(e,o.onTriggerChange),onClick:u=>{var h;(h=t.onClick)==null||h.call(t,u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Me(t.onPointerMove,Wo(u=>{a.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!n.open&&!i.current&&(a.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:Me(t.onPointerLeave,Wo(u=>{var p,y;d();const h=(p=n.content)==null?void 0:p.getBoundingClientRect();if(h){const f=(y=n.content)==null?void 0:y.dataset.side,v=f==="right",g=v?-5:5,b=h[v?"left":"right"],w=h[v?"right":"left"];a.onPointerGraceIntentChange({area:[{x:u.clientX+g,y:u.clientY},{x:b,y:h.top},{x:w,y:h.top},{x:w,y:h.bottom},{x:b,y:h.bottom}],side:f}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(u),u.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:Me(t.onKeyDown,u=>{var p;const h=a.searchRef.current!=="";t.disabled||h&&u.key===" "||L0[r.dir].includes(u.key)&&(n.onOpenChange(!0),(p=n.content)==null||p.focus(),u.preventDefault())})})})});av.displayName=Vo;var iv="MenuSubContent",sv=m.forwardRef((t,e)=>{const n=V0(Pt,t.__scopeMenu),{forceMount:r=n.forceMount,...o}=t,a=gn(Pt,t.__scopeMenu),i=Br(Pt,t.__scopeMenu),s=rv(iv,t.__scopeMenu),l=m.useRef(null),c=yt(e,l);return x.jsx(Lr.Provider,{scope:t.__scopeMenu,children:x.jsx(on,{present:r||a.open,children:x.jsx(Lr.Slot,{scope:t.__scopeMenu,children:x.jsx(tu,{id:s.contentId,"aria-labelledby":s.triggerId,...o,ref:c,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var u;i.isUsingKeyboardRef.current&&((u=l.current)==null||u.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:Me(t.onFocusOutside,d=>{d.target!==s.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:Me(t.onEscapeKeyDown,d=>{i.onClose(),d.preventDefault()}),onKeyDown:Me(t.onKeyDown,d=>{var p;const u=d.currentTarget.contains(d.target),h=$0[i.dir].includes(d.key);u&&h&&(a.onOpenChange(!1),(p=s.trigger)==null||p.focus(),d.preventDefault())})})})})})});sv.displayName=iv;function lv(t){return t?"open":"closed"}function Pi(t){return t==="indeterminate"}function au(t){return Pi(t)?"indeterminate":t?"checked":"unchecked"}function kA(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function jA(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function RA(t,e,n){const r=e.length>1&&Array.from(e).every(s=>s===e[0])?e[0]:e,o=n?t.indexOf(n):-1;let a=jA(t,Math.max(o,0));r.length===1&&(a=a.filter(s=>s!==n));const i=a.find(s=>s.toLowerCase().startsWith(r.toLowerCase()));return i!==n?i:void 0}function PA(t,e){const{x:n,y:r}=t;let o=!1;for(let a=0,i=e.length-1;a<e.length;i=a++){const s=e[a].x,l=e[a].y,c=e[i].x,d=e[i].y;l>r!=d>r&&n<(c-s)*(r-l)/(d-l)+s&&(o=!o)}return o}function TA(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return PA(n,e)}function Wo(t){return e=>e.pointerType==="mouse"?t(e):void 0}let Ti,cv,IA,dt,uv,iu,su;jm=Zc,mf=Gc,bf=W0,yf=U0,gf=nu,xf=H0,_m=Ri,Mm=K0,Cm=X0,Nm=G0,Sm=ev,Ef=tv,Om=nv,gm=ov,Am=av,km=sv,Ti="DropdownMenu",[cv,IA]=hr(Ti,[Fl]),dt=Fl(),[uv,iu]=cv(Ti),su=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:o,defaultOpen:a,onOpenChange:i,modal:s=!0}=t,l=dt(e),c=m.useRef(null),[d=!1,u]=uo({prop:o,defaultProp:a,onChange:i});return x.jsx(uv,{scope:e,triggerId:It(),triggerRef:c,contentId:It(),open:d,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(h=>!h),[u]),modal:s,children:x.jsx(jm,{...l,open:d,onOpenChange:u,dir:r,modal:s,children:n})})},su.displayName=Ti;var dv="DropdownMenuTrigger",hv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...o}=t,a=iu(dv,n),i=dt(n);return x.jsx(mf,{asChild:!0,...i,children:x.jsx(Ue.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...o,ref:aC(e,a.triggerRef),onPointerDown:Me(t.onPointerDown,s=>{!r&&s.button===0&&s.ctrlKey===!1&&(a.onOpenToggle(),a.open||s.preventDefault())}),onKeyDown:Me(t.onKeyDown,s=>{r||(["Enter"," "].includes(s.key)&&a.onOpenToggle(),s.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});hv.displayName=dv;var DA="DropdownMenuPortal",pv=t=>{const{__scopeDropdownMenu:e,...n}=t,r=dt(e);return x.jsx(bf,{...r,...n})};pv.displayName=DA;var fv="DropdownMenuContent",mv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=iu(fv,n),a=dt(n),i=m.useRef(!1);return x.jsx(yf,{id:o.contentId,"aria-labelledby":o.triggerId,...a,...r,ref:e,onCloseAutoFocus:Me(t.onCloseAutoFocus,s=>{var l;i.current||((l=o.triggerRef.current)==null||l.focus()),i.current=!1,s.preventDefault()}),onInteractOutside:Me(t.onInteractOutside,s=>{const l=s.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!o.modal||d)&&(i.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});mv.displayName=fv;var LA="DropdownMenuGroup",yv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(gf,{...o,...r,ref:e})});yv.displayName=LA;var $A="DropdownMenuLabel",gv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(xf,{...o,...r,ref:e})});gv.displayName=$A;var BA="DropdownMenuItem",vv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(_m,{...o,...r,ref:e})});vv.displayName=BA;var FA="DropdownMenuCheckboxItem",xv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(Mm,{...o,...r,ref:e})});xv.displayName=FA;var zA="DropdownMenuRadioGroup",bv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(Cm,{...o,...r,ref:e})});bv.displayName=zA;var VA="DropdownMenuRadioItem",wv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(Nm,{...o,...r,ref:e})});wv.displayName=VA;var WA="DropdownMenuItemIndicator",Ev=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(Sm,{...o,...r,ref:e})});Ev.displayName=WA;var UA="DropdownMenuSeparator",_v=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(Ef,{...o,...r,ref:e})});_v.displayName=UA;var HA="DropdownMenuArrow",qA=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(Om,{...o,...r,ref:e})});qA.displayName=HA;var QA=t=>{const{__scopeDropdownMenu:e,children:n,open:r,onOpenChange:o,defaultOpen:a}=t,i=dt(e),[s=!1,l]=uo({prop:r,defaultProp:a,onChange:o});return x.jsx(gm,{...i,open:s,onOpenChange:l,children:n})},KA="DropdownMenuSubTrigger",Mv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(Am,{...o,...r,ref:e})});Mv.displayName=KA;var YA="DropdownMenuSubContent",Cv=m.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,o=dt(n);return x.jsx(km,{...o,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Cv.displayName=YA,em=su,tm=hv,Jf=pv,vl=mv,Gf=yv,Cl=gv,wl=vv,El=xv,EC=bv,Ml=wv,_l=Ev,Nl=_v,_C=QA,xl=Mv,bl=Cv;const XA=em,ZA=tm,GA=Gf,JA=m.forwardRef(({className:t,inset:e,children:n,...r},o)=>x.jsxs(xl,{ref:o,className:ne("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...r,children:[n,x.jsx($e,{name:"chevron-right",className:"ml-auto"})]}));JA.displayName=xl.displayName;const ek=m.forwardRef(({className:t,...e},n)=>x.jsx(bl,{ref:n,className:ne("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));ek.displayName=bl.displayName;const Nv=m.forwardRef(({className:t,sideOffset:e=4,...n},r)=>x.jsx(Jf,{children:x.jsx(vl,{ref:r,sideOffset:e,className:ne("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));Nv.displayName=vl.displayName;const Sv=m.forwardRef(({className:t,inset:e,...n},r)=>x.jsx(wl,{ref:r,className:ne("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...n}));Sv.displayName=wl.displayName;const tk=m.forwardRef(({className:t,children:e,checked:n,...r},o)=>x.jsxs(El,{ref:o,className:ne("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...r,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(_l,{children:x.jsx($e,{name:"check",className:"h-4 w-4"})})}),e]}));tk.displayName=El.displayName;const nk=m.forwardRef(({className:t,children:e,...n},r)=>x.jsxs(Ml,{ref:r,className:ne("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(_l,{children:x.jsx($e,{name:"circle",className:"h-4 w-4"})})}),e]}));nk.displayName=Ml.displayName;const rk=m.forwardRef(({className:t,inset:e,...n},r)=>x.jsx(Cl,{ref:r,className:ne("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...n}));rk.displayName=Cl.displayName;const ok=m.forwardRef(({className:t,...e},n)=>x.jsx(Nl,{ref:n,className:ne("-mx-1 my-1 h-px bg-muted",t),...e}));ok.displayName=Nl.displayName;function ak(){const{t}=an("sidebar"),{isMobile:e}=Bo();return x.jsx(Tr,{children:x.jsx(fn,{children:x.jsxs(XA,{children:[x.jsx(ZA,{asChild:!0,children:x.jsxs(mn,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[x.jsx("div",{children:x.jsx($e,{name:"settings",size:28,className:"pr-2"})}),x.jsx($e,{name:"chevrons-up-down",className:"ml-auto size-4"})]})}),x.jsx(Nv,{className:"w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg",side:e?"bottom":"right",align:"end",sideOffset:4,children:x.jsx(GA,{children:x.jsxs(Sv,{children:[x.jsx($e,{name:"sparkles"}),t("contact")]})})})]})})})}const ik=Un("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});sn=function({className:t,variant:e,...n}){return x.jsx("div",{className:ne(ik({variant:e}),t),...n})};function sk({applications:t,currentSession:e,setCurrentSession:n}){const{t:r}=an("sidebar"),o=ei(),a=Oa(N0),i=m.useCallback((c,d)=>{a.show({id:d}),c.preventDefault()},[a]),s=c=>{n(c),o(Ft("application",{applicationId:c.id}))},l=c=>{switch(c.main_source_type){case"Thread":return x.jsx(sn,{className:"ml-1",color:"blue",children:r("application_types.chat")});default:return null}};return x.jsxs(Fo,{className:"group-data-[collapsible=icon]:hidden pt-0",children:[x.jsx(Si,{children:x.jsx("div",{className:"text-sm",children:r("applications")})}),x.jsxs(Tr,{children:[t==null?void 0:t.map(c=>x.jsx(fn,{className:"cursor-pointer",children:x.jsx(mn,{asChild:!0,onClick:()=>s(c),children:x.jsxs("div",{className:"flex flex-row justify-between items-center !h-auto",children:[x.jsxs("div",{className:"flex gap-2",children:[(e==null?void 0:e.id)===c.id?x.jsx($e,{size:16,color:"green",name:"check"}):x.jsx($e,{size:16,name:"chevron-right"}),x.jsxs("span",{children:[c.name,l(c)]})]}),x.jsx($e,{onClick:d=>i(d,c.id),size:16,name:"trash-2"})]})})},c.id)),t?x.jsx(fn,{children:x.jsxs(mn,{className:"text-sidebar-foreground/70",children:[x.jsx($e,{name:"ellipsis",className:"text-sidebar-foreground/70"}),x.jsx("span",{children:r("more_session")})]})}):null]})]})}const lk={navMain:[{title:"playground.title",icon:x.jsx($e,{name:"square-terminal"}),isActive:!0,items:[{title:"playground.drag_and_drop"},{title:"playground.node_connections"},{title:"playground.delete_nodes"}]},{title:"model.title",url:"#",icon:x.jsx($e,{name:"bot"}),items:[{title:"model.llm"},{title:"model.embedding"}]},{title:"tutorial.title",icon:x.jsx($e,{name:"book-open"}),items:[{title:"tutorial.get_started"},{title:"tutorial.chat_with_llm"},{title:"tutorial.ai_structured_output"},{title:"tutorial.tool_calling"},{title:"tutorial.few_shot_example"},{title:"tutorial.vector_database"}]},{title:"application.title",icon:x.jsx($e,{name:"settings-2"}),items:[{title:"application.changelog"}]}]};function ck({sessions:t,applications:e,currentSession:n,setCurrentSession:r,...o}){return x.jsxs(zc,{collapsible:"icon",...o,children:[x.jsx("div",{className:"h-1"}),x.jsxs(Wc,{children:[x.jsx(sA,{sessions:t||[],currentSession:n,setCurrentSession:r}),x.jsx(sk,{applications:e||[],currentSession:n,setCurrentSession:r}),x.jsx(UO,{items:lk.navMain})]}),x.jsx(Xg,{children:x.jsx(ak,{})}),x.jsx(Yg,{})]})}function uk(){const{t}=an("common"),e=IN(),n=ei(),r=Ja(),o=pf(u=>u.setTheme),a=pf(u=>u.theme),i=kt(u=>u.currentSession),s=kt(u=>u.sessions),l=kt(u=>u.applications),c=kt(u=>u.setCurrentSession);m.useEffect(()=>{i!=null&&i.id&&(r.pathname.includes(Ft("whiteboard"))?e.sessionId?e.sessionId&&e.sessionId!==(i==null?void 0:i.id)&&c(e.sessionId):n(Ft("whiteboard",{sessionId:i==null?void 0:i.id})):r.pathname.includes(Ft("application"))&&(e.applicationId?e.applicationId&&e.applicationId!==(i==null?void 0:i.id)&&c(e.applicationId):n(Ft("application",{applicationId:i==null?void 0:i.id}))))},[i==null?void 0:i.id,r.pathname,n,e.applicationId,e.sessionId,c]),m.useEffect(()=>{c(e.sessionId||e.applicationId).then(u=>{u.type===iC.StandaloneApp&&window.location.pathname.includes(Ft("whiteboard"))?n(Ft("application",{applicationId:u.id})):u.type===iC.Whiteboard&&window.location.pathname.includes(Ft("application"))&&n(Ft("whiteboard",{sessionId:u.id}))})},[n,e.applicationId,e.sessionId,c]);const d=m.useCallback(()=>{o(a==="dark"?"light":"dark")},[a,o]);return x.jsxs(Fc,{defaultOpen:!1,children:[x.jsx(ck,{sessions:s,applications:l,currentSession:i,setCurrentSession:c}),x.jsxs(Vc,{className:"max-h-screen overflow-hidden",children:[x.jsxs("header",{className:"flex h-14 shrink-0 items-center gap-2 transition-[width,height] ease-linear justify-between",children:[x.jsxs("div",{className:"flex items-center gap-2 px-4",children:[x.jsx(Kg,{}),x.jsx(Ta,{children:t("whiteboard")})]}),x.jsxs("div",{className:"flex items-center gap-2 px-4",children:[x.jsx(Kn,{onClick:d,variant:"link",children:x.jsx($e,{size:18,name:a==="dark"?"moon":"sun"})}),x.jsx("a",{referrerPolicy:"no-referrer",target:"_blank",href:"https://github.com/zrg-team/NoLLMChat",children:x.jsx($e,{size:18,name:"github"})})]})]}),x.jsx(za,{className:"shrink-0"}),x.jsx("div",{className:"flex flex-1 flex-col p-0 m-0 overflow-y-auto",children:x.jsx(KN,{})})]})]})}var lu="Avatar",[dk,cL]=hr(lu),[hk,Ov]=dk(lu),Av=m.forwardRef((t,e)=>{const{__scopeAvatar:n,...r}=t,[o,a]=m.useState("idle");return x.jsx(hk,{scope:n,imageLoadingStatus:o,onImageLoadingStatusChange:a,children:x.jsx(Ue.span,{...r,ref:e})})});Av.displayName=lu;var kv="AvatarImage",jv=m.forwardRef((t,e)=>{const{__scopeAvatar:n,src:r,onLoadingStatusChange:o=()=>{},...a}=t,i=Ov(kv,n),s=pk(r,a.referrerPolicy),l=qn(c=>{o(c),i.onImageLoadingStatusChange(c)});return dr(()=>{s!=="idle"&&l(s)},[s,l]),s==="loaded"?x.jsx(Ue.img,{...a,ref:e,src:r}):null});jv.displayName=kv;var Rv="AvatarFallback",Pv=m.forwardRef((t,e)=>{const{__scopeAvatar:n,delayMs:r,...o}=t,a=Ov(Rv,n),[i,s]=m.useState(r===void 0);return m.useEffect(()=>{if(r!==void 0){const l=window.setTimeout(()=>s(!0),r);return()=>window.clearTimeout(l)}},[r]),i&&a.imageLoadingStatus!=="loaded"?x.jsx(Ue.span,{...o,ref:e}):null});Pv.displayName=Rv;function pk(t,e){const[n,r]=m.useState("idle");return dr(()=>{if(!t){r("error");return}let o=!0;const a=new window.Image,i=s=>()=>{o&&r(s)};return r("loading"),a.onload=i("loaded"),a.onerror=i("error"),a.src=t,e&&(a.referrerPolicy=e),()=>{o=!1}},[t,e]),n}var Tv=Av,Iv=jv,Dv=Pv;const Lv=m.forwardRef(({className:t,...e},n)=>x.jsx(Tv,{ref:n,className:ne("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...e}));Lv.displayName=Tv.displayName;const $v=m.forwardRef(({className:t,...e},n)=>x.jsx(Iv,{ref:n,className:ne("aspect-square h-full w-full",t),...e}));$v.displayName=Iv.displayName;const Bv=m.forwardRef(({className:t,...e},n)=>x.jsx(Dv,{ref:n,className:ne("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...e}));Bv.displayName=Dv.displayName;function Fv(){return x.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[x.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor",children:x.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),x.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",children:x.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),x.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor",children:x.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const fk=Un("flex gap-2 max-w-[60%] items-end relative group",{variants:{variant:{received:"self-start",sent:"self-end flex-row-reverse"},layout:{default:"",ai:"max-w-full w-full items-center"}},defaultVariants:{variant:"received",layout:"default"}}),zv=m.forwardRef(({className:t,variant:e,layout:n,children:r,...o},a)=>x.jsx("div",{className:ne(fk({variant:e,layout:n,className:t}),"relative group"),ref:a,...o,children:m.Children.map(r,i=>m.isValidElement(i)&&typeof i.type!="string"?m.cloneElement(i,{variant:e,layout:n}):i)}));zv.displayName="ChatBubble";const mk=({src:t,fallback:e,className:n})=>x.jsxs(Lv,{className:n,children:[x.jsx($v,{src:t,alt:"Avatar"}),x.jsx(Bv,{children:e})]}),yk=Un("p-4",{variants:{variant:{received:"bg-secondary text-secondary-foreground rounded-r-lg rounded-tl-lg",sent:"bg-primary text-primary-foreground rounded-l-lg rounded-tr-lg"},layout:{default:"",ai:"border-t w-full rounded-none bg-transparent"}},defaultVariants:{variant:"received",layout:"default"}}),Vv=m.forwardRef(({className:t,variant:e,layout:n,isLoading:r=!1,children:o,...a},i)=>x.jsx("div",{className:ne(yk({variant:e,layout:n,className:t}),"break-words max-w-full whitespace-pre-wrap"),ref:i,...a,children:r?x.jsx("div",{className:"flex items-center space-x-2",children:x.jsx(Fv,{})}):o}));Vv.displayName="ChatBubbleMessage";const gk=({icon:t,onClick:e,className:n,variant:r="ghost",size:o="icon",...a})=>x.jsx(Kn,{variant:r,size:o,className:n,onClick:e,...a,children:t}),vk=m.forwardRef(({variant:t,className:e,children:n,...r},o)=>x.jsx("div",{ref:o,className:ne("absolute top-1/2 -translate-y-1/2 flex opacity-0 group-hover:opacity-100 transition-opacity duration-200",t==="sent"?"-left-1 -translate-x-full flex-row-reverse":"-right-1 translate-x-full",e),...r,children:n}));vk.displayName="ChatBubbleActionWrapper";const Wv=m.forwardRef(({className:t,children:e,...n},r)=>x.jsx("div",{className:ne("flex flex-col w-full h-full p-4 gap-6 overflow-y-auto",t),ref:r,...n,children:e}));Wv.displayName="ChatMessageList";var Uv="vercel.ai.error",xk=Symbol.for(Uv),Hv,bk=class kC extends Error{constructor({name:e,message:n,cause:r}){super(n),this[Hv]=!0,this.name=e,this.cause=r}static isInstance(e){return kC.hasMarker(e,Uv)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Hv=xk;var Fr=bk;function qv(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Qv="AI_InvalidArgumentError",Kv=`vercel.ai.error.${Qv}`,wk=Symbol.for(Kv),Yv,Ek=class extends Fr{constructor({message:t,cause:e,argument:n}){super({name:Qv,message:t,cause:e}),this[Yv]=!0,this.argument=n}static isInstance(t){return Fr.hasMarker(t,Kv)}};Yv=wk;var Xv="AI_JSONParseError",Zv=`vercel.ai.error.${Xv}`,_k=Symbol.for(Zv),Gv,Jv=class extends Fr{constructor({text:t,cause:e}){super({name:Xv,message:`JSON parsing failed: Text: ${t}.
Error message: ${qv(e)}`,cause:e}),this[Gv]=!0,this.text=t}static isInstance(t){return Fr.hasMarker(t,Zv)}};Gv=_k;var ex="AI_TypeValidationError",tx=`vercel.ai.error.${ex}`,Mk=Symbol.for(tx),nx,Ck=class Im extends Fr{constructor({value:e,cause:n}){super({name:ex,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${qv(n)}`,cause:n}),this[nx]=!0,this.value=e}static isInstance(e){return Fr.hasMarker(e,tx)}static wrap({value:e,cause:n}){return Im.isInstance(n)&&n.value===e?n:new Im({value:e,cause:n})}};nx=Mk;var rx=Ck;let Nk=(t,e=21)=>(n=e)=>{let r="",o=n;for(;o--;)r+=t[Math.random()*t.length|0];return r};var rr={exports:{}},ox;function Sk(){if(ox)return rr.exports;ox=1;const t=typeof Fs<"u",e=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,n=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function r(s,l,c){c==null&&l!==null&&typeof l=="object"&&(c=l,l=void 0),t&&Fs.isBuffer(s)&&(s=s.toString()),s&&s.charCodeAt(0)===65279&&(s=s.slice(1));const d=JSON.parse(s,l);if(d===null||typeof d!="object")return d;const u=c&&c.protoAction||"error",h=c&&c.constructorAction||"error";if(u==="ignore"&&h==="ignore")return d;if(u!=="ignore"&&h!=="ignore"){if(e.test(s)===!1&&n.test(s)===!1)return d}else if(u!=="ignore"&&h==="ignore"){if(e.test(s)===!1)return d}else if(n.test(s)===!1)return d;return o(d,{protoAction:u,constructorAction:h,safe:c&&c.safe})}function o(s,{protoAction:l="error",constructorAction:c="error",safe:d}={}){let u=[s];for(;u.length;){const h=u;u=[];for(const p of h){if(l!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"__proto__")){if(d===!0)return null;if(l==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.__proto__}if(c!=="ignore"&&Object.prototype.hasOwnProperty.call(p,"constructor")&&Object.prototype.hasOwnProperty.call(p.constructor,"prototype")){if(d===!0)return null;if(c==="error")throw new SyntaxError("Object contains forbidden prototype property");delete p.constructor}for(const y in p){const f=p[y];f&&typeof f=="object"&&u.push(f)}}}return s}function a(s,l,c){const d=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return r(s,l,c)}finally{Error.stackTraceLimit=d}}function i(s,l){const c=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return r(s,l,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=c}}return rr.exports=a,rr.exports.default=a,rr.exports.parse=a,rr.exports.safeParse=i,rr.exports.scan=o,rr.exports}var Ok=Sk();const Ak=Qn(Ok);var kk=({prefix:t,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const o=Nk(n,e);if(t==null)return o;if(n.includes(r))throw new Ek({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return a=>`${t}${r}${o(a)}`},ax=kk(),cu=Symbol.for("vercel.ai.validator");function jk(t){return{[cu]:!0,validate:t}}function Rk(t){return typeof t=="object"&&t!==null&&cu in t&&t[cu]===!0&&"validate"in t}function Pk(t){return Rk(t)?t:Tk(t)}function Tk(t){return jk(e=>{const n=t.safeParse(e);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function Ik({value:t,schema:e}){const n=Pk(e);try{if(n.validate==null)return{success:!0,value:t};const r=n.validate(t);return r.success?r:{success:!1,error:rx.wrap({value:t,cause:r.error})}}catch(r){return{success:!1,error:rx.wrap({value:t,cause:r})}}}function ix({text:t,schema:e}){try{const n=Ak.parse(t);return e==null?{success:!0,value:n}:Ik({value:n,schema:e})}catch(n){return{success:!1,error:Jv.isInstance(n)?n:new Jv({text:t,cause:n})}}}var Ii={code:"0",name:"text",parse:t=>{if(typeof t!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:t}}},Di={code:"3",name:"error",parse:t=>{if(typeof t!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:t}}},Li={code:"4",name:"assistant_message",parse:t=>{if(t==null||typeof t!="object"||!("id"in t)||!("role"in t)||!("content"in t)||typeof t.id!="string"||typeof t.role!="string"||t.role!=="assistant"||!Array.isArray(t.content)||!t.content.every(e=>e!=null&&typeof e=="object"&&"type"in e&&e.type==="text"&&"text"in e&&e.text!=null&&typeof e.text=="object"&&"value"in e.text&&typeof e.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:t}}},$i={code:"5",name:"assistant_control_data",parse:t=>{if(t==null||typeof t!="object"||!("threadId"in t)||!("messageId"in t)||typeof t.threadId!="string"||typeof t.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:t.threadId,messageId:t.messageId}}}},Bi={code:"6",name:"data_message",parse:t=>{if(t==null||typeof t!="object"||!("role"in t)||!("data"in t)||typeof t.role!="string"||t.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:t}}},Dk=[Ii,Di,Li,$i,Bi];Ii.code+"",Di.code+"",Li.code+"",$i.code+"",Bi.code+"",Ii.name+"",Ii.code,Di.name+"",Di.code,Li.name+"",Li.code,$i.name+"",$i.code,Bi.name+"",Bi.code,Dk.map(t=>t.code);function Lk(t){const e=["ROOT"];let n=-1,r=null;function o(l,c,d){switch(l){case'"':{n=c,e.pop(),e.push(d),e.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=c,r=c,e.pop(),e.push(d),e.push("INSIDE_LITERAL");break}case"-":{e.pop(),e.push(d),e.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=c,e.pop(),e.push(d),e.push("INSIDE_NUMBER");break}case"{":{n=c,e.pop(),e.push(d),e.push("INSIDE_OBJECT_START");break}case"[":{n=c,e.pop(),e.push(d),e.push("INSIDE_ARRAY_START");break}}}function a(l,c){switch(l){case",":{e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=c,e.pop();break}}}function i(l,c){switch(l){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=c,e.pop();break}}}for(let l=0;l<t.length;l++){const c=t[l];switch(e[e.length-1]){case"ROOT":o(c,l,"FINISH");break;case"INSIDE_OBJECT_START":{switch(c){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}case"}":{n=l,e.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(c){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(c){case'"':{e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(c){case":":{e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{o(c,l,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{a(c,l);break}case"INSIDE_STRING":{switch(c){case'"':{e.pop(),n=l;break}case"\\":{e.push("INSIDE_STRING_ESCAPE");break}default:n=l}break}case"INSIDE_ARRAY_START":{switch(c){case"]":{n=l,e.pop();break}default:{n=l,o(c,l,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(c){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=l,e.pop();break}default:{n=l;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{o(c,l,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{e.pop(),n=l;break}case"INSIDE_NUMBER":{switch(c){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=l;break}case"e":case"E":case"-":case".":break;case",":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(c,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&a(c,l);break}case"}":{e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&a(c,l);break}case"]":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(c,l);break}default:{e.pop();break}}break}case"INSIDE_LITERAL":{const d=t.substring(r,l+1);!"false".startsWith(d)&&!"true".startsWith(d)&&!"null".startsWith(d)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?a(c,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(c,l)):n=l;break}}}let s=t.slice(0,n+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":{s+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{s+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{s+="]";break}case"INSIDE_LITERAL":{const c=t.substring(r,t.length);"true".startsWith(c)?s+="true".slice(c.length):"false".startsWith(c)?s+="false".slice(c.length):"null".startsWith(c)&&(s+="null".slice(c.length))}}return s}function $k(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=ix({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=ix({text:Lk(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var Uo={code:"0",name:"text",parse:t=>{if(typeof t!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:t}}},Ho={code:"2",name:"data",parse:t=>{if(!Array.isArray(t))throw new Error('"data" parts expect an array value.');return{type:"data",value:t}}},qo={code:"3",name:"error",parse:t=>{if(typeof t!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:t}}},Qo={code:"8",name:"message_annotations",parse:t=>{if(!Array.isArray(t))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:t}}},Ko={code:"9",name:"tool_call",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("toolName"in t)||typeof t.toolName!="string"||!("args"in t)||typeof t.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:t}}},Yo={code:"a",name:"tool_result",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("result"in t))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:t}}},Xo={code:"b",name:"tool_call_streaming_start",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("toolName"in t)||typeof t.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:t}}},Zo={code:"c",name:"tool_call_delta",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("argsTextDelta"in t)||typeof t.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:t}}},Go={code:"d",name:"finish_message",parse:t=>{if(t==null||typeof t!="object"||!("finishReason"in t)||typeof t.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const e={finishReason:t.finishReason};return"usage"in t&&t.usage!=null&&typeof t.usage=="object"&&"promptTokens"in t.usage&&"completionTokens"in t.usage&&(e.usage={promptTokens:typeof t.usage.promptTokens=="number"?t.usage.promptTokens:Number.NaN,completionTokens:typeof t.usage.completionTokens=="number"?t.usage.completionTokens:Number.NaN}),{type:"finish_message",value:e}}},Jo={code:"e",name:"finish_step",parse:t=>{if(t==null||typeof t!="object"||!("finishReason"in t)||typeof t.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const e={finishReason:t.finishReason,isContinued:!1};return"usage"in t&&t.usage!=null&&typeof t.usage=="object"&&"promptTokens"in t.usage&&"completionTokens"in t.usage&&(e.usage={promptTokens:typeof t.usage.promptTokens=="number"?t.usage.promptTokens:Number.NaN,completionTokens:typeof t.usage.completionTokens=="number"?t.usage.completionTokens:Number.NaN}),"isContinued"in t&&typeof t.isContinued=="boolean"&&(e.isContinued=t.isContinued),{type:"finish_step",value:e}}},Bk=[Uo,Ho,qo,Qo,Ko,Yo,Xo,Zo,Go,Jo],Fk={[Uo.code]:Uo,[Ho.code]:Ho,[qo.code]:qo,[Qo.code]:Qo,[Ko.code]:Ko,[Yo.code]:Yo,[Xo.code]:Xo,[Zo.code]:Zo,[Go.code]:Go,[Jo.code]:Jo};Uo.name+"",Uo.code,Ho.name+"",Ho.code,qo.name+"",qo.code,Qo.name+"",Qo.code,Ko.name+"",Ko.code,Yo.name+"",Yo.code,Xo.name+"",Xo.code,Zo.name+"",Zo.code,Go.name+"",Go.code,Jo.name+"",Jo.code;var zk=Bk.map(t=>t.code),Vk=t=>{const e=t.indexOf(":");if(e===-1)throw new Error("Failed to parse stream string. No separator found.");const n=t.slice(0,e);if(!zk.includes(n))throw new Error(`Failed to parse stream string. Invalid code ${n}.`);const r=n,o=t.slice(e+1),a=JSON.parse(o);return Fk[r].parse(a)},Wk=10;function Uk(t,e){const n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return t.length=0,n}async function Hk({stream:t,onTextPart:e,onDataPart:n,onErrorPart:r,onToolCallStreamingStartPart:o,onToolCallDeltaPart:a,onToolCallPart:i,onToolResultPart:s,onMessageAnnotationsPart:l,onFinishMessagePart:c,onFinishStepPart:d}){const u=t.getReader(),h=new TextDecoder,p=[];let y=0;for(;;){const{value:f}=await u.read();if(f&&(p.push(f),y+=f.length,f[f.length-1]!==Wk))continue;if(p.length===0)break;const v=Uk(p,y);y=0;const g=h.decode(v,{stream:!0}).split(`
`).filter(b=>b!=="").map(Vk);for(const{type:b,value:w}of g)switch(b){case"text":await(e==null?void 0:e(w));break;case"data":await(n==null?void 0:n(w));break;case"error":await(r==null?void 0:r(w));break;case"message_annotations":await(l==null?void 0:l(w));break;case"tool_call_streaming_start":await(o==null?void 0:o(w));break;case"tool_call_delta":await(a==null?void 0:a(w));break;case"tool_call":await(i==null?void 0:i(w));break;case"tool_result":await(s==null?void 0:s(w));break;case"finish_message":await(c==null?void 0:c(w));break;case"finish_step":await(d==null?void 0:d(w));break;default:{const E=b;throw new Error(`Unknown stream part type: ${E}`)}}}}function qk({promptTokens:t,completionTokens:e}){return{promptTokens:t,completionTokens:e,totalTokens:t+e}}async function Qk({stream:t,update:e,onToolCall:n,onFinish:r,generateId:o=ax,getCurrentDate:a=()=>new Date}){const i=a();let s,l=!0;const c=[],d=[];let u;const h={};let p={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},y="unknown";function f(){const g=[...d];if(s==null){e(c,g);return}u!=null&&u.length&&(s.annotations=u);const b={...JSON.parse(JSON.stringify(s)),revisionId:o()};e([...c,b],g)}function v(){return(l||s==null)&&(s!=null&&c.push(s),l=!1,s={id:o(),role:"assistant",content:"",createdAt:i}),s}await Hk({stream:t,onTextPart(g){const b=v();s={...b,content:b.content+g},f()},onToolCallStreamingStartPart(g){const b=v();b.toolInvocations==null&&(b.toolInvocations=[]),h[g.toolCallId]={text:"",toolName:g.toolName,index:b.toolInvocations.length},b.toolInvocations.push({state:"partial-call",toolCallId:g.toolCallId,toolName:g.toolName,args:void 0}),f()},onToolCallDeltaPart(g){const b=v(),w=h[g.toolCallId];w.text+=g.argsTextDelta;const{value:E}=$k(w.text);b.toolInvocations[w.index]={state:"partial-call",toolCallId:g.toolCallId,toolName:w.toolName,args:E},f()},async onToolCallPart(g){const b=v();if(h[g.toolCallId]!=null?b.toolInvocations[h[g.toolCallId].index]={state:"call",...g}:(b.toolInvocations==null&&(b.toolInvocations=[]),b.toolInvocations.push({state:"call",...g})),n){const w=await n({toolCall:g});w!=null&&(b.toolInvocations[b.toolInvocations.length-1]={state:"result",...g,result:w})}f()},onToolResultPart(g){const b=v().toolInvocations;if(b==null)throw new Error("tool_result must be preceded by a tool_call");const w=b.findIndex(E=>E.toolCallId===g.toolCallId);if(w===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");b[w]={...b[w],state:"result",...g},f()},onDataPart(g){d.push(...g),f()},onMessageAnnotationsPart(g){u==null?u=[...g]:u.push(...g),f()},onFinishStepPart(g){l=!g.isContinued},onFinishMessagePart(g){y=g.finishReason,g.usage!=null&&(p=qk(g.usage))},onErrorPart(g){throw new Error(g)}}),r==null||r({message:s,finishReason:y,usage:p})}async function Kk({stream:t,onTextPart:e}){const n=t.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:r,value:o}=await n.read();if(r)break;await e(o)}}var Yk=()=>fetch;async function Xk({api:t,body:e,streamProtocol:n="data",credentials:r,headers:o,abortController:a,restoreMessagesOnFailure:i,onResponse:s,onUpdate:l,onFinish:c,onToolCall:d,generateId:u,fetch:h=Yk()}){var p,y;const f=await h(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",...o},signal:(p=a==null?void 0:a())==null?void 0:p.signal,credentials:r}).catch(v=>{throw i(),v});if(s)try{await s(f)}catch(v){throw v}if(!f.ok)throw i(),new Error((y=await f.text())!=null?y:"Failed to fetch the chat response.");if(!f.body)throw new Error("The response body is empty.");switch(n){case"text":{const v={id:u(),createdAt:new Date,role:"assistant",content:""};await Kk({stream:f.body,onTextPart:g=>{v.content+=g,l([{...v}],[])}}),c==null||c(v,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"});return}case"data":{await Qk({stream:f.body,update:l,onToolCall:d,onFinish({message:v,finishReason:g,usage:b}){c&&v!=null&&c(v,{usage:b,finishReason:g})},generateId:u});return}default:{const v=n;throw new Error(`Unknown stream protocol: ${v}`)}}}var sx={exports:{}},uu={},lx;function Zk(){if(lx)return uu;lx=1;var t=sC();function e(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,o=t.useEffect,a=t.useLayoutEffect,i=t.useDebugValue;function s(u,h){var p=h(),y=r({inst:{value:p,getSnapshot:h}}),f=y[0].inst,v=y[1];return a(function(){f.value=p,f.getSnapshot=h,l(f)&&v({inst:f})},[u,p,h]),o(function(){return l(f)&&v({inst:f}),u(function(){l(f)&&v({inst:f})})},[u]),i(p),p}function l(u){var h=u.getSnapshot;u=u.value;try{var p=h();return!n(u,p)}catch{return!0}}function c(u,h){return h()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:s;return uu.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:d,uu}var cx;function ux(){return cx||(cx=1,sx.exports=Zk()),sx.exports}Ks=ux();let vn,xt,Fi,Ie,zt,xn,dx,ea;SC=Qn(Ks),vn=()=>{},xt=vn(),Fi=Object,Ie=t=>t===xt,zt=t=>typeof t=="function",xn=(t,e)=>({...t,...e}),dx=t=>zt(t.then),ea=new WeakMap;let Gk=0;const ta=t=>{const e=typeof t,n=t&&t.constructor,r=n==Date;let o,a;if(Fi(t)===t&&!r&&n!=RegExp){if(o=ea.get(t),o)return o;if(o=++Gk+"~",ea.set(t,o),n==Array){for(o="@",a=0;a<t.length;a++)o+=ta(t[a])+",";ea.set(t,o)}if(n==Fi){o="#";const i=Fi.keys(t).sort();for(;!Ie(a=i.pop());)Ie(t[a])||(o+=a+":"+ta(t[a])+",");ea.set(t,o)}}else o=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},bn=new WeakMap,du={},zi={},hu="undefined",Vi=typeof window!=hu,pu=typeof document!=hu,Jk=()=>Vi&&typeof window.requestAnimationFrame!=hu,hx=(t,e)=>{const n=bn.get(t);return[()=>!Ie(e)&&t.get(e)||du,r=>{if(!Ie(e)){const o=t.get(e);e in zi||(zi[e]=o),n[5](e,xn(o,r),o||du)}},n[6],()=>!Ie(e)&&e in zi?zi[e]:!Ie(e)&&t.get(e)||du]};let fu=!0;const ej=()=>fu,[mu,yu]=Vi&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[vn,vn],tj=()=>{const t=pu&&document.visibilityState;return Ie(t)||t!=="hidden"},nj=t=>(pu&&document.addEventListener("visibilitychange",t),mu("focus",t),()=>{pu&&document.removeEventListener("visibilitychange",t),yu("focus",t)}),rj=t=>{const e=()=>{fu=!0,t()},n=()=>{fu=!1};return mu("online",e),mu("offline",n),()=>{yu("online",e),yu("offline",n)}},oj={isOnline:ej,isVisible:tj},aj={initFocus:nj,initReconnect:rj},px=!zs.useId,na=!Vi||"Deno"in window,ij=t=>Jk()?window.requestAnimationFrame(t):setTimeout(t,1),gu=na?m.useEffect:m.useLayoutEffect,vu=typeof navigator<"u"&&navigator.connection,fx=!na&&vu&&(["slow-2g","2g"].includes(vu.effectiveType)||vu.saveData),xu=t=>{if(zt(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?ta(t):"",[t,e]};let sj=0;const bu=()=>++sj,mx=0,yx=1,gx=2;var ra={__proto__:null,ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:mx,MUTATE_EVENT:gx,RECONNECT_EVENT:yx};async function vx(...t){const[e,n,r,o]=t,a=xn({populateCache:!0,throwOnError:!0},typeof o=="boolean"?{revalidate:o}:o||{});let i=a.populateCache;const s=a.rollbackOnError;let l=a.optimisticData;const c=h=>typeof s=="function"?s(h):s!==!1,d=a.throwOnError;if(zt(n)){const h=n,p=[],y=e.keys();for(const f of y)!/^\$(inf|sub)\$/.test(f)&&h(e.get(f)._k)&&p.push(f);return Promise.all(p.map(u))}return u(n);async function u(h){const[p]=xu(h);if(!p)return;const[y,f]=hx(e,p),[v,g,b,w]=bn.get(e),E=()=>{const L=v[p];return(zt(a.revalidate)?a.revalidate(y().data,h):a.revalidate!==!1)&&(delete b[p],delete w[p],L&&L[0])?L[0](gx).then(()=>y().data):y().data};if(t.length<3)return E();let M=r,S;const N=bu();g[p]=[N,0];const _=!Ie(l),O=y(),k=O.data,I=O._c,B=Ie(I)?k:I;if(_&&(l=zt(l)?l(B,k):l,f({data:l,_c:B})),zt(M))try{M=M(B)}catch(L){S=L}if(M&&dx(M))if(M=await M.catch(L=>{S=L}),N!==g[p][0]){if(S)throw S;return M}else S&&_&&c(S)&&(i=!0,f({data:B,_c:xt}));if(i&&!S)if(zt(i)){const L=i(M,B);f({data:L,error:xt,_c:xt})}else f({data:M,error:xt,_c:xt});if(g[p][1]=bu(),Promise.resolve(E()).then(()=>{f({_c:xt})}),S){if(d)throw S;return}return M}}const xx=(t,e)=>{for(const n in t)t[n][0]&&t[n][0](e)},lj=(t,e)=>{if(!bn.has(t)){const n=xn(aj,e),r={},o=vx.bind(xt,t);let a=vn;const i={},s=(d,u)=>{const h=i[d]||[];return i[d]=h,h.push(u),()=>h.splice(h.indexOf(u),1)},l=(d,u,h)=>{t.set(d,u);const p=i[d];if(p)for(const y of p)y(u,h)},c=()=>{if(!bn.has(t)&&(bn.set(t,[r,{},{},{},o,l,s]),!na)){const d=n.initFocus(setTimeout.bind(xt,xx.bind(xt,r,mx))),u=n.initReconnect(setTimeout.bind(xt,xx.bind(xt,r,yx)));a=()=>{d&&d(),u&&u(),bn.delete(t)}}};return c(),[t,o,c,a]}return[t,bn.get(t)[4]]},cj=(t,e,n,r,o)=>{const a=n.errorRetryCount,i=o.retryCount,s=~~((Math.random()+.5)*(1<<(i<8?i:8)))*n.errorRetryInterval;!Ie(a)&&i>a||setTimeout(r,s,o)},uj=(t,e)=>ta(t)==ta(e),[bx,dj]=lj(new Map),hj=xn({onLoadingSlow:vn,onSuccess:vn,onError:vn,onErrorRetry:cj,onDiscarded:vn,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:fx?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:fx?5e3:3e3,compare:uj,isPaused:()=>!1,cache:bx,mutate:dj,fallback:{}},oj),pj=(t,e)=>{const n=xn(t,e);if(e){const{use:r,fallback:o}=t,{use:a,fallback:i}=e;r&&a&&(n.use=r.concat(a)),o&&i&&(n.fallback=xn(o,i))}return n},fj=m.createContext({}),mj="$inf$",wx=Vi&&window.__SWR_DEVTOOLS_USE__,yj=wx?window.__SWR_DEVTOOLS_USE__:[],gj=()=>{wx&&(window.__SWR_DEVTOOLS_REACT__=zs)},vj=t=>zt(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],xj=()=>xn(hj,m.useContext(fj)),bj=t=>(e,n,r)=>t(e,n&&((...o)=>{const[a]=xu(e),[,,,i]=bn.get(bx);if(a.startsWith(mj))return n(...o);const s=i[a];return Ie(s)?n(...o):(delete i[a],s)}),r),wj=yj.concat(bj),Ej=t=>function(...e){const n=xj(),[r,o,a]=vj(e),i=pj(n,a);let s=t;const{use:l}=i,c=(l||[]).concat(wj);for(let d=c.length;d--;)s=c[d](s);return s(r,o||i.fetcher||null,i)},_j=(t,e,n)=>{const r=e[t]||(e[t]=[]);return r.push(n),()=>{const o=r.indexOf(n);o>=0&&(r[o]=r[r.length-1],r.pop())}};gj();const Ex=zs.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t)}),wu={dedupe:!0},Mj=(t,e,n)=>{const{cache:r,compare:o,suspense:a,fallbackData:i,revalidateOnMount:s,revalidateIfStale:l,refreshInterval:c,refreshWhenHidden:d,refreshWhenOffline:u,keepPreviousData:h}=n,[p,y,f,v]=bn.get(r),[g,b]=xu(t),w=m.useRef(!1),E=m.useRef(!1),M=m.useRef(g),S=m.useRef(e),N=m.useRef(n),_=()=>N.current,O=()=>_().isVisible()&&_().isOnline(),[k,I,B,L]=hx(r,g),C=m.useRef({}).current,P=Ie(i)?n.fallback[g]:i,j=(X,oe)=>{for(const he in C){const ge=he;if(ge==="data"){if(!o(X[ge],oe[ge])&&(!Ie(X[ge])||!o(Z,oe[ge])))return!1}else if(oe[ge]!==X[ge])return!1}return!0},D=m.useMemo(()=>{const X=!g||!e?!1:Ie(s)?_().isPaused()||a?!1:Ie(l)?!0:l:s,oe=De=>{const et=xn(De);return delete et._k,X?{isValidating:!0,isLoading:!0,...et}:et},he=k(),ge=L(),Ve=oe(he),st=he===ge?Ve:oe(ge);let Re=Ve;return[()=>{const De=oe(k());return j(De,Re)?(Re.data=De.data,Re.isLoading=De.isLoading,Re.isValidating=De.isValidating,Re.error=De.error,Re):(Re=De,De)},()=>st]},[r,g]),R=Ks.useSyncExternalStore(m.useCallback(X=>B(g,(oe,he)=>{j(he,oe)||X()}),[r,g]),D[0],D[1]),A=!w.current,V=p[g]&&p[g].length>0,q=R.data,Y=Ie(q)?P:q,H=R.error,G=m.useRef(Y),Z=h?Ie(q)?G.current:q:Y,J=V&&!Ie(H)?!1:A&&!Ie(s)?s:_().isPaused()?!1:a?Ie(Y)?!1:l:Ie(Y)||l,ce=!!(g&&e&&A&&J),U=Ie(R.isValidating)?ce:R.isValidating,te=Ie(R.isLoading)?ce:R.isLoading,re=m.useCallback(async X=>{const oe=S.current;if(!g||!oe||E.current||_().isPaused())return!1;let he,ge,Ve=!0;const st=X||{},Re=!f[g]||!st.dedupe,De=()=>px?!E.current&&g===M.current&&w.current:g===M.current,et={isValidating:!1,isLoading:!1},We=()=>{I(et)},Ze=()=>{const tt=f[g];tt&&tt[1]===ge&&delete f[g]},wt={isValidating:!0};Ie(k().data)&&(wt.isLoading=!0);try{if(Re&&(I(wt),n.loadingTimeout&&Ie(k().data)&&setTimeout(()=>{Ve&&De()&&_().onLoadingSlow(g,n)},n.loadingTimeout),f[g]=[oe(b),bu()]),[he,ge]=f[g],he=await he,Re&&setTimeout(Ze,n.dedupingInterval),!f[g]||f[g][1]!==ge)return Re&&De()&&_().onDiscarded(g),!1;et.error=xt;const tt=y[g];if(!Ie(tt)&&(ge<=tt[0]||ge<=tt[1]||tt[1]===0))return We(),Re&&De()&&_().onDiscarded(g),!1;const ct=k().data;et.data=o(ct,he)?ct:he,Re&&De()&&_().onSuccess(he,g,n)}catch(tt){Ze();const ct=_(),{shouldRetryOnError:ft}=ct;ct.isPaused()||(et.error=tt,Re&&De()&&(ct.onError(tt,g,ct),(ft===!0||zt(ft)&&ft(tt))&&(!_().revalidateOnFocus||!_().revalidateOnReconnect||O())&&ct.onErrorRetry(tt,g,ct,ut=>{const tn=p[g];tn&&tn[0]&&tn[0](ra.ERROR_REVALIDATE_EVENT,ut)},{retryCount:(st.retryCount||0)+1,dedupe:!0})))}return Ve=!1,We(),!0},[g,r]),ie=m.useCallback((...X)=>vx(r,M.current,...X),[]);if(gu(()=>{S.current=e,N.current=n,Ie(q)||(G.current=q)}),gu(()=>{if(!g)return;const X=re.bind(xt,wu);let oe=0;const he=_j(g,p,(ge,Ve={})=>{if(ge==ra.FOCUS_EVENT){const st=Date.now();_().revalidateOnFocus&&st>oe&&O()&&(oe=st+_().focusThrottleInterval,X())}else if(ge==ra.RECONNECT_EVENT)_().revalidateOnReconnect&&O()&&X();else{if(ge==ra.MUTATE_EVENT)return re();if(ge==ra.ERROR_REVALIDATE_EVENT)return re(Ve)}});return E.current=!1,M.current=g,w.current=!0,I({_k:b}),J&&(Ie(Y)||na?X():ij(X)),()=>{E.current=!0,he()}},[g]),gu(()=>{let X;function oe(){const ge=zt(c)?c(k().data):c;ge&&X!==-1&&(X=setTimeout(he,ge))}function he(){!k().error&&(d||_().isVisible())&&(u||_().isOnline())?re(wu).then(oe):oe()}return oe(),()=>{X&&(clearTimeout(X),X=-1)}},[c,d,u,g]),m.useDebugValue(Z),a&&Ie(Y)&&g){if(!px&&na)throw new Error("Fallback data is required when using suspense in SSR.");S.current=e,N.current=n,E.current=!1;const X=v[g];if(!Ie(X)){const oe=ie(X);Ex(oe)}if(Ie(H)){const oe=re(wu);Ie(Z)||(oe.status="fulfilled",oe.value=!0),Ex(oe)}else throw H}return{mutate:ie,get data(){return C.data=!0,Z},get error(){return C.error=!0,H},get isValidating(){return C.isValidating=!0,U},get isLoading(){return C.isLoading=!0,te}}},Wi=Ej(Mj);var Eu,_x;function Cj(){if(_x)return Eu;_x=1;function t(e,n){if(typeof e!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let r,o=0;return function(...a){clearTimeout(r);const i=Date.now(),s=i-o,l=n-s;l<=0?(o=i,e.apply(this,a)):r=setTimeout(()=>{o=Date.now(),e.apply(this,a)},l)}}return Eu=t,Eu}var Nj=Cj();const Sj=Qn(Nj);function Mx(t,e){return e!=null?Sj(t,e):t}var Oj=async(t,e,n,r,o,a,i,s,l,c,d,u,h,p,y,f,v)=>{var g;const b=i.current;n(e.messages,!1);const w=p?e.messages:e.messages.map(({role:M,content:S,experimental_attachments:N,data:_,annotations:O,toolInvocations:k})=>({role:M,content:S,...N!==void 0&&{experimental_attachments:N},..._!==void 0&&{data:_},...O!==void 0&&{annotations:O},...k!==void 0&&{toolInvocations:k}})),E=o.current;return await Xk({api:t,body:(g=y==null?void 0:y({messages:e.messages,requestData:e.data,requestBody:e.body}))!=null?g:{messages:w,data:e.data,...a.current.body,...e.body},streamProtocol:c,credentials:a.current.credentials,headers:{...a.current.headers,...e.headers},abortController:()=>s.current,restoreMessagesOnFailure(){v||n(b,!1)},onResponse:u,onUpdate(M,S){n([...e.messages,...M],!1),S!=null&&S.length&&r([...E??[],...S],!1)},onToolCall:h,onFinish:d,generateId:l,fetch:f})};function Aj({api:t="/api/chat",id:e,initialMessages:n,initialInput:r="",sendExtraMessageFields:o,onToolCall:a,experimental_prepareRequestBody:i,maxSteps:s=1,streamProtocol:l="data",onResponse:c,onFinish:d,onError:u,credentials:h,headers:p,body:y,generateId:f=ax,fetch:v,keepLastMessageOnError:g=!0,experimental_throttle:b}={}){const w=m.useId(),E=e??w,M=typeof t=="string"?[t,E]:E,[S]=m.useState([]),{data:N,mutate:_}=Wi([M,"messages"],null,{fallbackData:n??S}),O=m.useRef(N||[]);m.useEffect(()=>{O.current=N||[]},[N]);const{data:k,mutate:I}=Wi([M,"streamData"],null),B=m.useRef(k);m.useEffect(()=>{B.current=k},[k]);const{data:L=!1,mutate:C}=Wi([M,"loading"],null),{data:P=void 0,mutate:j}=Wi([M,"error"],null),D=m.useRef(null),R=m.useRef({credentials:h,headers:p,body:y});m.useEffect(()=>{R.current={credentials:h,headers:p,body:y}},[h,p,y]);const A=m.useCallback(async U=>{const te=O.current.length;try{C(!0),j(void 0);const X=new AbortController;D.current=X,await Oj(t,U,Mx(_,b),Mx(I,b),B,R,O,D,f,l,d,c,a,o,i,v,g),D.current=null}catch(X){if(X.name==="AbortError")return D.current=null,null;u&&X instanceof Error&&u(X),j(X)}finally{C(!1)}const re=O.current,ie=re[re.length-1];re.length>te&&ie!=null&&s>1&&Cx(ie)&&kj(re)<s&&await A({messages:re})},[_,C,t,R,c,d,u,j,I,B,l,o,i,a,s,O,D,f,v,g,b]),V=m.useCallback(async(U,{data:te,headers:re,body:ie,experimental_attachments:X}={})=>{var oe,he;U.id||(U.id=f());const ge=await Nx(X),Ve=O.current.concat({...U,id:(oe=U.id)!=null?oe:f(),createdAt:(he=U.createdAt)!=null?he:new Date,experimental_attachments:ge.length>0?ge:void 0});return A({messages:Ve,headers:re,body:ie,data:te})},[A,f]),q=m.useCallback(async({data:U,headers:te,body:re}={})=>{const ie=O.current;if(ie.length===0)return null;const X=ie[ie.length-1];return A({messages:X.role==="assistant"?ie.slice(0,-1):ie,headers:te,body:re,data:U})},[A]),Y=m.useCallback(()=>{D.current&&(D.current.abort(),D.current=null)},[]),H=m.useCallback(U=>{typeof U=="function"&&(U=U(O.current)),_(U,!1),O.current=U},[_]),G=m.useCallback(U=>{typeof U=="function"&&(U=U(B.current)),I(U,!1),B.current=U},[I]),[Z,J]=m.useState(r),ce=m.useCallback(async(U,te={},re)=>{var ie;if((ie=U==null?void 0:U.preventDefault)==null||ie.call(U),!Z&&!te.allowEmptySubmit)return;re&&(R.current={...R.current,...re});const X=await Nx(te.experimental_attachments),oe={messages:!Z&&!X.length&&te.allowEmptySubmit?O.current:O.current.concat({id:f(),createdAt:new Date,role:"user",content:Z,experimental_attachments:X.length>0?X:void 0}),headers:te.headers,body:te.body,data:te.data};A(oe),J("")},[Z,f,A]);return{messages:N||[],setMessages:H,data:k,setData:G,error:P,append:V,reload:q,stop:Y,input:Z,setInput:J,handleInputChange:U=>{J(U.target.value)},handleSubmit:ce,isLoading:L,addToolResult:({toolCallId:U,result:te})=>{const re=O.current.map((X,oe,he)=>oe===he.length-1&&X.role==="assistant"&&X.toolInvocations?{...X,toolInvocations:X.toolInvocations.map(ge=>ge.toolCallId===U?{...ge,result:te,state:"result"}:ge)}:X);_(re,!1);const ie=re[re.length-1];Cx(ie)&&A({messages:re})}}}function Cx(t){return t.role==="assistant"&&t.toolInvocations&&t.toolInvocations.length>0&&t.toolInvocations.every(e=>"result"in e)}function kj(t){let e=0;for(let n=t.length-1;n>=0&&t[n].role==="assistant";n--)e++;return e}async function Nx(t){if(t==null)return[];if(t instanceof FileList)return Promise.all(Array.from(t).map(async e=>{const{name:n,type:r}=e,o=await new Promise((a,i)=>{const s=new FileReader;s.onload=l=>{var c;a((c=l.target)==null?void 0:c.result)},s.onerror=l=>i(l),s.readAsDataURL(e)});return{name:n,contentType:r,url:o}}));if(Array.isArray(t))return t;throw new Error("Invalid attachments type")}wm=Aj,Xs=m.forwardRef(({className:t,...e},n)=>x.jsx("textarea",{className:ne("flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...e})),Xs.displayName="Textarea";function jj({minHeight:t,maxHeight:e}){const n=m.useRef(null),r=m.useCallback(o=>{const a=n.current;if(!a)return;if(o){a.style.height=`${t}px`;return}a.style.height=`${t}px`;const i=Math.max(t,Math.min(a.scrollHeight,e??Number.POSITIVE_INFINITY));a.style.height=`${i}px`},[t,e]);return m.useEffect(()=>{const o=n.current;o&&(o.style.height=`${t}px`)},[t]),m.useEffect(()=>{const o=()=>r();return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[r]),{textareaRef:n,adjustHeight:r}}const Rj=48,Sx=164;Ff=function({onSubmit:t,disabled:e,enableTool:n,enableFile:r,placeholder:o,minHeight:a,maxHeight:i,className:s,onChange:l,value:c}){const[d,u]=m.useState(!1),[h,p]=m.useState(""),{textareaRef:y,adjustHeight:f}=jj({minHeight:a||Rj,maxHeight:i||Sx}),[v,g]=m.useState(!0),b=async w=>{try{u(!0),await t(h,w)}finally{u(!1)}};return x.jsx("div",{className:ne("w-full py-4 max-w-xl",s),children:x.jsx("div",{className:"relative w-full mx-auto",children:x.jsxs("div",{className:"relative flex flex-col",children:[x.jsx("div",{className:"overflow-y-auto",style:{maxHeight:`${i||Sx}px`},children:x.jsx(Xs,{id:"ai-input-04",value:(l?c:h)||"",disabled:e||d,placeholder:o,className:"w-full rounded-xl rounded-b-none px-4 py-3 bg-black/5 dark:bg-white/5 border-none dark:text-white placeholder:text-black/70 dark:placeholder:text-white/70 resize-none focus-visible:ring-0 leading-[1.2]",ref:y,onKeyDown:w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),b(w))},onChange:w=>{l||p(w.target.value),f(),l==null||l(w)}})}),x.jsxs("div",{className:"h-12 bg-black/5 dark:bg-white/5 rounded-b-xl",children:[x.jsxs("div",{className:"absolute left-3 bottom-3 flex items-center gap-2",children:[r?x.jsxs("label",{className:"cursor-pointer rounded-lg p-2 bg-black/5 dark:bg-white/5",children:[x.jsx("input",{type:"file",className:"hidden"}),x.jsx($e,{name:"paperclip",className:"w-4 h-4 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors"})]}):void 0,n?x.jsxs("button",{type:"button",onClick:()=>{g(!v)},className:ne("rounded-full transition-all flex items-center gap-2 px-1.5 py-1 border h-8",v?"bg-sky-500/15 border-sky-400 text-sky-500":"bg-black/5 dark:bg-white/5 border-transparent text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:[x.jsx("div",{className:"w-4 h-4 flex items-center justify-center flex-shrink-0",children:x.jsx(hf.div,{animate:{rotate:v?180:0,scale:v?1.1:1},whileHover:{rotate:v?180:15,scale:1.1,transition:{type:"spring",stiffness:300,damping:10}},transition:{type:"spring",stiffness:260,damping:25},children:x.jsx($e,{name:"globe",className:ne("w-4 h-4",v?"text-sky-500":"text-inherit")})})}),x.jsx(IC,{children:v&&x.jsx(hf.span,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"text-sm overflow-hidden whitespace-nowrap text-sky-500 flex-shrink-0",children:"Search"})})]}):void 0]}),x.jsx("div",{className:"absolute right-3 bottom-3",children:x.jsx("button",{type:"button",disabled:e||d,onClick:w=>{b(w)},className:ne("rounded-lg p-2",l&&c||h?"bg-sky-500/15 text-sky-500":"bg-black/5 dark:bg-white/5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white"),children:x.jsx($e,{name:"send",className:"w-4 h-4"})})})]})]})})})};var _u,Ox;function Pj(){if(Ox)return _u;Ox=1;function t(){this.__data__=[],this.size=0}return _u=t,_u}var Mu,Ax;$a=function(){if(Ax)return Mu;Ax=1;function t(e,n){return e===n||e!==e&&n!==n}return Mu=t,Mu};var Cu,kx;function Ui(){if(kx)return Cu;kx=1;var t=$a();function e(n,r){for(var o=n.length;o--;)if(t(n[o][0],r))return o;return-1}return Cu=e,Cu}var Nu,jx;function Tj(){if(jx)return Nu;jx=1;var t=Ui(),e=Array.prototype,n=e.splice;function r(o){var a=this.__data__,i=t(a,o);if(i<0)return!1;var s=a.length-1;return i==s?a.pop():n.call(a,i,1),--this.size,!0}return Nu=r,Nu}var Su,Rx;function Ij(){if(Rx)return Su;Rx=1;var t=Ui();function e(n){var r=this.__data__,o=t(r,n);return o<0?void 0:r[o][1]}return Su=e,Su}var Ou,Px;function Dj(){if(Px)return Ou;Px=1;var t=Ui();function e(n){return t(this.__data__,n)>-1}return Ou=e,Ou}var Au,Tx;function Lj(){if(Tx)return Au;Tx=1;var t=Ui();function e(n,r){var o=this.__data__,a=t(o,n);return a<0?(++this.size,o.push([n,r])):o[a][1]=r,this}return Au=e,Au}var ku,Ix;function Hi(){if(Ix)return ku;Ix=1;var t=Pj(),e=Tj(),n=Ij(),r=Dj(),o=Lj();function a(i){var s=-1,l=i==null?0:i.length;for(this.clear();++s<l;){var c=i[s];this.set(c[0],c[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=n,a.prototype.has=r,a.prototype.set=o,ku=a,ku}var ju,Dx;function $j(){if(Dx)return ju;Dx=1;var t=Hi();function e(){this.__data__=new t,this.size=0}return ju=e,ju}var Ru,Lx;function Bj(){if(Lx)return Ru;Lx=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return Ru=t,Ru}var Pu,$x;function Fj(){if($x)return Pu;$x=1;function t(e){return this.__data__.get(e)}return Pu=t,Pu}var Tu,Bx;function zj(){if(Bx)return Tu;Bx=1;function t(e){return this.__data__.has(e)}return Tu=t,Tu}var Iu,Fx;function zx(){if(Fx)return Iu;Fx=1;var t=typeof ho=="object"&&ho&&ho.Object===Object&&ho;return Iu=t,Iu}var Du,Vx;Qt=function(){if(Vx)return Du;Vx=1;var t=zx(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return Du=n,Du};var Lu,Wx;po=function(){if(Wx)return Lu;Wx=1;var t=Qt(),e=t.Symbol;return Lu=e,Lu};var $u,Ux;function Vj(){if(Ux)return $u;Ux=1;var t=po(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,o=t?t.toStringTag:void 0;function a(i){var s=n.call(i,o),l=i[o];try{i[o]=void 0;var c=!0}catch{}var d=r.call(i);return c&&(s?i[o]=l:delete i[o]),d}return $u=a,$u}var Bu,Hx;function Wj(){if(Hx)return Bu;Hx=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return Bu=n,Bu}var Fu,qx;gr=function(){if(qx)return Fu;qx=1;var t=po(),e=Vj(),n=Wj(),r="[object Null]",o="[object Undefined]",a=t?t.toStringTag:void 0;function i(s){return s==null?s===void 0?o:r:a&&a in Object(s)?e(s):n(s)}return Fu=i,Fu};var zu,Qx;xr=function(){if(Qx)return zu;Qx=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return zu=t,zu};var Vu,Kx;pl=function(){if(Kx)return Vu;Kx=1;var t=gr(),e=xr(),n="[object AsyncFunction]",r="[object Function]",o="[object GeneratorFunction]",a="[object Proxy]";function i(s){if(!e(s))return!1;var l=t(s);return l==r||l==o||l==n||l==a}return Vu=i,Vu};var Wu,Yx;function Uj(){if(Yx)return Wu;Yx=1;var t=Qt(),e=t["__core-js_shared__"];return Wu=e,Wu}var Uu,Xx;function Hj(){if(Xx)return Uu;Xx=1;var t=Uj(),e=function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!e&&e in r}return Uu=n,Uu}var Hu,Zx;function Gx(){if(Zx)return Hu;Zx=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return Hu=n,Hu}var qu,Jx;function qj(){if(Jx)return qu;Jx=1;var t=pl(),e=Hj(),n=xr(),r=Gx(),o=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,i=Function.prototype,s=Object.prototype,l=i.toString,c=s.hasOwnProperty,d=RegExp("^"+l.call(c).replace(o,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function u(h){if(!n(h)||e(h))return!1;var p=t(h)?d:a;return p.test(r(h))}return qu=u,qu}var Qu,eb;function Qj(){if(eb)return Qu;eb=1;function t(e,n){return e==null?void 0:e[n]}return Qu=t,Qu}var Ku,tb;function or(){if(tb)return Ku;tb=1;var t=qj(),e=Qj();function n(r,o){var a=e(r,o);return t(a)?a:void 0}return Ku=n,Ku}var Yu,nb;function Xu(){if(nb)return Yu;nb=1;var t=or(),e=Qt(),n=t(e,"Map");return Yu=n,Yu}var Zu,rb;function qi(){if(rb)return Zu;rb=1;var t=or(),e=t(Object,"create");return Zu=e,Zu}var Gu,ob;function Kj(){if(ob)return Gu;ob=1;var t=qi();function e(){this.__data__=t?t(null):{},this.size=0}return Gu=e,Gu}var Ju,ab;function Yj(){if(ab)return Ju;ab=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return Ju=t,Ju}var ed,ib;function Xj(){if(ib)return ed;ib=1;var t=qi(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function o(a){var i=this.__data__;if(t){var s=i[a];return s===e?void 0:s}return r.call(i,a)?i[a]:void 0}return ed=o,ed}var td,sb;function Zj(){if(sb)return td;sb=1;var t=qi(),e=Object.prototype,n=e.hasOwnProperty;function r(o){var a=this.__data__;return t?a[o]!==void 0:n.call(a,o)}return td=r,td}var nd,lb;function Gj(){if(lb)return nd;lb=1;var t=qi(),e="__lodash_hash_undefined__";function n(r,o){var a=this.__data__;return this.size+=this.has(r)?0:1,a[r]=t&&o===void 0?e:o,this}return nd=n,nd}var rd,cb;function Jj(){if(cb)return rd;cb=1;var t=Kj(),e=Yj(),n=Xj(),r=Zj(),o=Gj();function a(i){var s=-1,l=i==null?0:i.length;for(this.clear();++s<l;){var c=i[s];this.set(c[0],c[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=n,a.prototype.has=r,a.prototype.set=o,rd=a,rd}var od,ub;function eR(){if(ub)return od;ub=1;var t=Jj(),e=Hi(),n=Xu();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return od=r,od}var ad,db;function tR(){if(db)return ad;db=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return ad=t,ad}var id,hb;function Qi(){if(hb)return id;hb=1;var t=tR();function e(n,r){var o=n.__data__;return t(r)?o[typeof r=="string"?"string":"hash"]:o.map}return id=e,id}var sd,pb;function nR(){if(pb)return sd;pb=1;var t=Qi();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return sd=e,sd}var ld,fb;function rR(){if(fb)return ld;fb=1;var t=Qi();function e(n){return t(this,n).get(n)}return ld=e,ld}var cd,mb;function oR(){if(mb)return cd;mb=1;var t=Qi();function e(n){return t(this,n).has(n)}return cd=e,cd}var ud,yb;function aR(){if(yb)return ud;yb=1;var t=Qi();function e(n,r){var o=t(this,n),a=o.size;return o.set(n,r),this.size+=o.size==a?0:1,this}return ud=e,ud}var dd,gb;function hd(){if(gb)return dd;gb=1;var t=eR(),e=nR(),n=rR(),r=oR(),o=aR();function a(i){var s=-1,l=i==null?0:i.length;for(this.clear();++s<l;){var c=i[s];this.set(c[0],c[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=n,a.prototype.has=r,a.prototype.set=o,dd=a,dd}var pd,vb;function iR(){if(vb)return pd;vb=1;var t=Hi(),e=Xu(),n=hd(),r=200;function o(a,i){var s=this.__data__;if(s instanceof t){var l=s.__data__;if(!e||l.length<r-1)return l.push([a,i]),this.size=++s.size,this;s=this.__data__=new n(l)}return s.set(a,i),this.size=s.size,this}return pd=o,pd}var fd,xb;Tl=function(){if(xb)return fd;xb=1;var t=Hi(),e=$j(),n=Bj(),r=Fj(),o=zj(),a=iR();function i(s){var l=this.__data__=new t(s);this.size=l.size}return i.prototype.clear=e,i.prototype.delete=n,i.prototype.get=r,i.prototype.has=o,i.prototype.set=a,fd=i,fd};var md,bb;function sR(){if(bb)return md;bb=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return md=e,md}var yd,wb;function lR(){if(wb)return yd;wb=1;function t(e){return this.__data__.has(e)}return yd=t,yd}var gd,Eb;qf=function(){if(Eb)return gd;Eb=1;var t=hd(),e=sR(),n=lR();function r(o){var a=-1,i=o==null?0:o.length;for(this.__data__=new t;++a<i;)this.add(o[a])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,gd=r,gd};var vd,_b;Pf=function(){if(_b)return vd;_b=1;function t(e,n){for(var r=-1,o=e==null?0:e.length;++r<o;)if(n(e[r],r,e))return!0;return!1}return vd=t,vd};var xd,Mb;Of=function(){if(Mb)return xd;Mb=1;function t(e,n){return e.has(n)}return xd=t,xd};var bd,Cb;function Nb(){if(Cb)return bd;Cb=1;var t=qf(),e=Pf(),n=Of(),r=1,o=2;function a(i,s,l,c,d,u){var h=l&r,p=i.length,y=s.length;if(p!=y&&!(h&&y>p))return!1;var f=u.get(i),v=u.get(s);if(f&&v)return f==s&&v==i;var g=-1,b=!0,w=l&o?new t:void 0;for(u.set(i,s),u.set(s,i);++g<p;){var E=i[g],M=s[g];if(c)var S=h?c(M,E,g,s,i,u):c(E,M,g,i,s,u);if(S!==void 0){if(S)continue;b=!1;break}if(w){if(!e(s,function(N,_){if(!n(w,_)&&(E===N||d(E,N,l,c,u)))return w.push(_)})){b=!1;break}}else if(!(E===M||d(E,M,l,c,u))){b=!1;break}}return u.delete(i),u.delete(s),b}return bd=a,bd}var wd,Sb;am=function(){if(Sb)return wd;Sb=1;var t=Qt(),e=t.Uint8Array;return wd=e,wd};var Ed,Ob;function cR(){if(Ob)return Ed;Ob=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(o,a){r[++n]=[a,o]}),r}return Ed=t,Ed}var _d,Ab;Hf=function(){if(Ab)return _d;Ab=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(o){r[++n]=o}),r}return _d=t,_d};var Md,kb;function uR(){if(kb)return Md;kb=1;var t=po(),e=am(),n=$a(),r=Nb(),o=cR(),a=Hf(),i=1,s=2,l="[object Boolean]",c="[object Date]",d="[object Error]",u="[object Map]",h="[object Number]",p="[object RegExp]",y="[object Set]",f="[object String]",v="[object Symbol]",g="[object ArrayBuffer]",b="[object DataView]",w=t?t.prototype:void 0,E=w?w.valueOf:void 0;function M(S,N,_,O,k,I,B){switch(_){case b:if(S.byteLength!=N.byteLength||S.byteOffset!=N.byteOffset)return!1;S=S.buffer,N=N.buffer;case g:return!(S.byteLength!=N.byteLength||!I(new e(S),new e(N)));case l:case c:case h:return n(+S,+N);case d:return S.name==N.name&&S.message==N.message;case p:case f:return S==N+"";case u:var L=o;case y:var C=O&i;if(L||(L=a),S.size!=N.size&&!C)return!1;var P=B.get(S);if(P)return P==N;O|=s,B.set(S,N);var j=r(L(S),L(N),O,k,I,B);return B.delete(S),j;case v:if(E)return E.call(S)==E.call(N)}return!1}return Md=M,Md}var Cd,jb;rl=function(){if(jb)return Cd;jb=1;function t(e,n){for(var r=-1,o=n.length,a=e.length;++r<o;)e[a+r]=n[r];return e}return Cd=t,Cd};var Nd,Rb;ln=function(){if(Rb)return Nd;Rb=1;var t=Array.isArray;return Nd=t,Nd};var Sd,Pb;function Tb(){if(Pb)return Sd;Pb=1;var t=rl(),e=ln();function n(r,o,a){var i=o(r);return e(r)?i:t(i,a(r))}return Sd=n,Sd}var Od,Ib;function dR(){if(Ib)return Od;Ib=1;function t(e,n){for(var r=-1,o=e==null?0:e.length,a=0,i=[];++r<o;){var s=e[r];n(s,r,e)&&(i[a++]=s)}return i}return Od=t,Od}var Ad,Db;function Lb(){if(Db)return Ad;Db=1;function t(){return[]}return Ad=t,Ad}var kd,$b;Rl=function(){if($b)return kd;$b=1;var t=dR(),e=Lb(),n=Object.prototype,r=n.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(i){return i==null?[]:(i=Object(i),t(o(i),function(s){return r.call(i,s)}))}:e;return kd=a,kd};var jd,Bb;function hR(){if(Bb)return jd;Bb=1;function t(e,n){for(var r=-1,o=Array(e);++r<e;)o[r]=n(r);return o}return jd=t,jd}var Rd,Fb;vr=function(){if(Fb)return Rd;Fb=1;function t(e){return e!=null&&typeof e=="object"}return Rd=t,Rd};var Pd,zb;function pR(){if(zb)return Pd;zb=1;var t=gr(),e=vr(),n="[object Arguments]";function r(o){return e(o)&&t(o)==n}return Pd=r,Pd}var Td,Vb;nl=function(){if(Vb)return Td;Vb=1;var t=pR(),e=vr(),n=Object.prototype,r=n.hasOwnProperty,o=n.propertyIsEnumerable,a=t(function(){return arguments}())?t:function(i){return e(i)&&r.call(i,"callee")&&!o.call(i,"callee")};return Td=a,Td};var Ki={exports:{}},Id,Wb;function fR(){if(Wb)return Id;Wb=1;function t(){return!1}return Id=t,Id}Ki.exports;var Ub;Il=function(){return Ub||(Ub=1,function(t,e){var n=Qt(),r=fR(),o=e&&!e.nodeType&&e,a=o&&!0&&t&&!t.nodeType&&t,i=a&&a.exports===o,s=i?n.Buffer:void 0,l=s?s.isBuffer:void 0,c=l||r;t.exports=c}(Ki,Ki.exports)),Ki.exports};var Dd,Hb;Ba=function(){if(Hb)return Dd;Hb=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,o){var a=typeof r;return o=o??t,!!o&&(a=="number"||a!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<o}return Dd=n,Dd};var Ld,qb;function $d(){if(qb)return Ld;qb=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return Ld=e,Ld}var Bd,Qb;function mR(){if(Qb)return Bd;Qb=1;var t=gr(),e=$d(),n=vr(),r="[object Arguments]",o="[object Array]",a="[object Boolean]",i="[object Date]",s="[object Error]",l="[object Function]",c="[object Map]",d="[object Number]",u="[object Object]",h="[object RegExp]",p="[object Set]",y="[object String]",f="[object WeakMap]",v="[object ArrayBuffer]",g="[object DataView]",b="[object Float32Array]",w="[object Float64Array]",E="[object Int8Array]",M="[object Int16Array]",S="[object Int32Array]",N="[object Uint8Array]",_="[object Uint8ClampedArray]",O="[object Uint16Array]",k="[object Uint32Array]",I={};I[b]=I[w]=I[E]=I[M]=I[S]=I[N]=I[_]=I[O]=I[k]=!0,I[r]=I[o]=I[v]=I[a]=I[g]=I[i]=I[s]=I[l]=I[c]=I[d]=I[u]=I[h]=I[p]=I[y]=I[f]=!1;function B(L){return n(L)&&e(L.length)&&!!I[t(L)]}return Bd=B,Bd}var Fd,Kb;kf=function(){if(Kb)return Fd;Kb=1;function t(e){return function(n){return e(n)}}return Fd=t,Fd};var Yi={exports:{}};Yi.exports;var Yb;sm=function(){return Yb||(Yb=1,function(t,e){var n=zx(),r=e&&!e.nodeType&&e,o=r&&!0&&t&&!t.nodeType&&t,a=o&&o.exports===r,i=a&&n.process,s=function(){try{var l=o&&o.require&&o.require("util").types;return l||i&&i.binding&&i.binding("util")}catch{}}();t.exports=s}(Yi,Yi.exports)),Yi.exports};var zd,Xb;Dl=function(){if(Xb)return zd;Xb=1;var t=mR(),e=kf(),n=sm(),r=n&&n.isTypedArray,o=r?e(r):t;return zd=o,zd};var Vd,Zb;function Gb(){if(Zb)return Vd;Zb=1;var t=hR(),e=nl(),n=ln(),r=Il(),o=Ba(),a=Dl(),i=Object.prototype,s=i.hasOwnProperty;function l(c,d){var u=n(c),h=!u&&e(c),p=!u&&!h&&r(c),y=!u&&!h&&!p&&a(c),f=u||h||p||y,v=f?t(c.length,String):[],g=v.length;for(var b in c)(d||s.call(c,b))&&!(f&&(b=="length"||p&&(b=="offset"||b=="parent")||y&&(b=="buffer"||b=="byteLength"||b=="byteOffset")||o(b,g)))&&v.push(b);return v}return Vd=l,Vd}var Wd,Jb;Pl=function(){if(Jb)return Wd;Jb=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,o=typeof r=="function"&&r.prototype||t;return n===o}return Wd=e,Wd};var Ud,ew;function tw(){if(ew)return Ud;ew=1;function t(e,n){return function(r){return e(n(r))}}return Ud=t,Ud}var Hd,nw;function yR(){if(nw)return Hd;nw=1;var t=tw(),e=t(Object.keys,Object);return Hd=e,Hd}var qd,rw;function gR(){if(rw)return qd;rw=1;var t=Pl(),e=yR(),n=Object.prototype,r=n.hasOwnProperty;function o(a){if(!t(a))return e(a);var i=[];for(var s in Object(a))r.call(a,s)&&s!="constructor"&&i.push(s);return i}return qd=o,qd}var Qd,ow;al=function(){if(ow)return Qd;ow=1;var t=pl(),e=$d();function n(r){return r!=null&&e(r.length)&&!t(r)}return Qd=n,Qd};var Kd,aw;ol=function(){if(aw)return Kd;aw=1;var t=Gb(),e=gR(),n=al();function r(o){return n(o)?t(o):e(o)}return Kd=r,Kd};var Yd,iw;lm=function(){if(iw)return Yd;iw=1;var t=Tb(),e=Rl(),n=ol();function r(o){return t(o,n,e)}return Yd=r,Yd};var Xd,sw;function vR(){if(sw)return Xd;sw=1;var t=lm(),e=1,n=Object.prototype,r=n.hasOwnProperty;function o(a,i,s,l,c,d){var u=s&e,h=t(a),p=h.length,y=t(i),f=y.length;if(p!=f&&!u)return!1;for(var v=p;v--;){var g=h[v];if(!(u?g in i:r.call(i,g)))return!1}var b=d.get(a),w=d.get(i);if(b&&w)return b==i&&w==a;var E=!0;d.set(a,i),d.set(i,a);for(var M=u;++v<p;){g=h[v];var S=a[g],N=i[g];if(l)var _=u?l(N,S,g,i,a,d):l(S,N,g,a,i,d);if(!(_===void 0?S===N||c(S,N,s,l,d):_)){E=!1;break}M||(M=g=="constructor")}if(E&&!M){var O=a.constructor,k=i.constructor;O!=k&&"constructor"in a&&"constructor"in i&&!(typeof O=="function"&&O instanceof O&&typeof k=="function"&&k instanceof k)&&(E=!1)}return d.delete(a),d.delete(i),E}return Xd=o,Xd}var Zd,lw;function xR(){if(lw)return Zd;lw=1;var t=or(),e=Qt(),n=t(e,"DataView");return Zd=n,Zd}var Gd,cw;function bR(){if(cw)return Gd;cw=1;var t=or(),e=Qt(),n=t(e,"Promise");return Gd=n,Gd}var Jd,uw;Uf=function(){if(uw)return Jd;uw=1;var t=or(),e=Qt(),n=t(e,"Set");return Jd=n,Jd};var eh,dw;function wR(){if(dw)return eh;dw=1;var t=or(),e=Qt(),n=t(e,"WeakMap");return eh=n,eh}var th,hw;im=function(){if(hw)return th;hw=1;var t=xR(),e=Xu(),n=bR(),r=Uf(),o=wR(),a=gr(),i=Gx(),s="[object Map]",l="[object Object]",c="[object Promise]",d="[object Set]",u="[object WeakMap]",h="[object DataView]",p=i(t),y=i(e),f=i(n),v=i(r),g=i(o),b=a;return(t&&b(new t(new ArrayBuffer(1)))!=h||e&&b(new e)!=s||n&&b(n.resolve())!=c||r&&b(new r)!=d||o&&b(new o)!=u)&&(b=function(w){var E=a(w),M=E==l?w.constructor:void 0,S=M?i(M):"";if(S)switch(S){case p:return h;case y:return s;case f:return c;case v:return d;case g:return u}return E}),th=b,th};var nh,pw;function ER(){if(pw)return nh;pw=1;var t=Tl(),e=Nb(),n=uR(),r=vR(),o=im(),a=ln(),i=Il(),s=Dl(),l=1,c="[object Arguments]",d="[object Array]",u="[object Object]",h=Object.prototype,p=h.hasOwnProperty;function y(f,v,g,b,w,E){var M=a(f),S=a(v),N=M?d:o(f),_=S?d:o(v);N=N==c?u:N,_=_==c?u:_;var O=N==u,k=_==u,I=N==_;if(I&&i(f)){if(!i(v))return!1;M=!0,O=!1}if(I&&!O)return E||(E=new t),M||s(f)?e(f,v,g,b,w,E):n(f,v,N,g,b,w,E);if(!(g&l)){var B=O&&p.call(f,"__wrapped__"),L=k&&p.call(v,"__wrapped__");if(B||L){var C=B?f.value():f,P=L?v.value():v;return E||(E=new t),w(C,P,g,b,E)}}return I?(E||(E=new t),r(f,v,g,b,w,E)):!1}return nh=y,nh}var rh,fw;sl=function(){if(fw)return rh;fw=1;var t=ER(),e=vr();function n(r,o,a,i,s){return r===o?!0:r==null||o==null||!e(r)&&!e(o)?r!==r&&o!==o:t(r,o,a,i,n,s)}return rh=n,rh};var oh,mw;function _R(){if(mw)return oh;mw=1;var t=Tl(),e=sl(),n=1,r=2;function o(a,i,s,l){var c=s.length,d=c,u=!l;if(a==null)return!d;for(a=Object(a);c--;){var h=s[c];if(u&&h[2]?h[1]!==a[h[0]]:!(h[0]in a))return!1}for(;++c<d;){h=s[c];var p=h[0],y=a[p],f=h[1];if(u&&h[2]){if(y===void 0&&!(p in a))return!1}else{var v=new t;if(l)var g=l(y,f,p,a,i,v);if(!(g===void 0?e(f,y,n|r,l,v):g))return!1}}return!0}return oh=o,oh}var ah,yw;function gw(){if(yw)return ah;yw=1;var t=xr();function e(n){return n===n&&!t(n)}return ah=e,ah}var ih,vw;function MR(){if(vw)return ih;vw=1;var t=gw(),e=ol();function n(r){for(var o=e(r),a=o.length;a--;){var i=o[a],s=r[i];o[a]=[i,s,t(s)]}return o}return ih=n,ih}var sh,xw;function bw(){if(xw)return sh;xw=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return sh=t,sh}var lh,ww;function CR(){if(ww)return lh;ww=1;var t=_R(),e=MR(),n=bw();function r(o){var a=e(o);return a.length==1&&a[0][2]?n(a[0][0],a[0][1]):function(i){return i===o||t(i,o,a)}}return lh=r,lh}var ch,Ew;Da=function(){if(Ew)return ch;Ew=1;var t=gr(),e=vr(),n="[object Symbol]";function r(o){return typeof o=="symbol"||e(o)&&t(o)==n}return ch=r,ch};var uh,_w;function dh(){if(_w)return uh;_w=1;var t=ln(),e=Da(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function o(a,i){if(t(a))return!1;var s=typeof a;return s=="number"||s=="symbol"||s=="boolean"||a==null||e(a)?!0:r.test(a)||!n.test(a)||i!=null&&a in Object(i)}return uh=o,uh}var hh,Mw;If=function(){if(Mw)return hh;Mw=1;var t=hd(),e="Expected a function";function n(r,o){if(typeof r!="function"||o!=null&&typeof o!="function")throw new TypeError(e);var a=function(){var i=arguments,s=o?o.apply(this,i):i[0],l=a.cache;if(l.has(s))return l.get(s);var c=r.apply(this,i);return a.cache=l.set(s,c)||l,c};return a.cache=new(n.Cache||t),a}return n.Cache=t,hh=n,hh};var ph,Cw;function NR(){if(Cw)return ph;Cw=1;var t=If(),e=500;function n(r){var o=t(r,function(i){return a.size===e&&a.clear(),i}),a=o.cache;return o}return ph=n,ph}var fh,Nw;function SR(){if(Nw)return fh;Nw=1;var t=NR(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(o){var a=[];return o.charCodeAt(0)===46&&a.push(""),o.replace(e,function(i,s,l,c){a.push(l?c.replace(n,"$1"):s||i)}),a});return fh=r,fh}var mh,Sw;il=function(){if(Sw)return mh;Sw=1;function t(e,n){for(var r=-1,o=e==null?0:e.length,a=Array(o);++r<o;)a[r]=n(e[r],r,e);return a}return mh=t,mh};var yh,Ow;function OR(){if(Ow)return yh;Ow=1;var t=po(),e=il(),n=ln(),r=Da(),o=1/0,a=t?t.prototype:void 0,i=a?a.toString:void 0;function s(l){if(typeof l=="string")return l;if(n(l))return e(l,s)+"";if(r(l))return i?i.call(l):"";var c=l+"";return c=="0"&&1/l==-o?"-0":c}return yh=s,yh}var gh,Aw;Wf=function(){if(Aw)return gh;Aw=1;var t=OR();function e(n){return n==null?"":t(n)}return gh=e,gh};var vh,kw;go=function(){if(kw)return vh;kw=1;var t=ln(),e=dh(),n=SR(),r=Wf();function o(a,i){return t(a)?a:e(a,i)?[a]:n(r(a))}return vh=o,vh};var xh,jw;br=function(){if(jw)return xh;jw=1;var t=Da(),e=1/0;function n(r){if(typeof r=="string"||t(r))return r;var o=r+"";return o=="0"&&1/r==-e?"-0":o}return xh=n,xh};var bh,Rw;La=function(){if(Rw)return bh;Rw=1;var t=go(),e=br();function n(r,o){o=t(o,r);for(var a=0,i=o.length;r!=null&&a<i;)r=r[e(o[a++])];return a&&a==i?r:void 0}return bh=n,bh};var wh,Pw;Vf=function(){if(Pw)return wh;Pw=1;var t=La();function e(n,r,o){var a=n==null?void 0:t(n,r);return a===void 0?o:a}return wh=e,wh};var Eh,Tw;function AR(){if(Tw)return Eh;Tw=1;function t(e,n){return e!=null&&n in Object(e)}return Eh=t,Eh}var _h,Iw;function kR(){if(Iw)return _h;Iw=1;var t=go(),e=nl(),n=ln(),r=Ba(),o=$d(),a=br();function i(s,l,c){l=t(l,s);for(var d=-1,u=l.length,h=!1;++d<u;){var p=a(l[d]);if(!(h=s!=null&&c(s,p)))break;s=s[p]}return h||++d!=u?h:(u=s==null?0:s.length,!!u&&o(u)&&r(p,u)&&(n(s)||e(s)))}return _h=i,_h}var Mh,Dw;hm=function(){if(Dw)return Mh;Dw=1;var t=AR(),e=kR();function n(r,o){return r!=null&&e(r,o,t)}return Mh=n,Mh};var Ch,Lw;function jR(){if(Lw)return Ch;Lw=1;var t=sl(),e=Vf(),n=hm(),r=dh(),o=gw(),a=bw(),i=br(),s=1,l=2;function c(d,u){return r(d)&&o(u)?a(i(d),u):function(h){var p=e(h,d);return p===void 0&&p===u?n(h,d):t(u,p,s|l)}}return Ch=c,Ch}var Nh,$w;Af=function(){if($w)return Nh;$w=1;function t(e){return e}return Nh=t,Nh};var Sh,Bw;function RR(){if(Bw)return Sh;Bw=1;function t(e){return function(n){return n==null?void 0:n[e]}}return Sh=t,Sh}var Oh,Fw;function PR(){if(Fw)return Oh;Fw=1;var t=La();function e(n){return function(r){return t(r,n)}}return Oh=e,Oh}var Ah,zw;function TR(){if(zw)return Ah;zw=1;var t=RR(),e=PR(),n=dh(),r=br();function o(a){return n(a)?t(r(a)):e(a)}return Ah=o,Ah}var kh,Vw;tl=function(){if(Vw)return kh;Vw=1;var t=CR(),e=jR(),n=Af(),r=ln(),o=TR();function a(i){return typeof i=="function"?i:i==null?n:typeof i=="object"?r(i)?e(i[0],i[1]):t(i):o(i)}return kh=a,kh};var jh,Ww;function IR(){if(Ww)return jh;Ww=1;var t="Expected a function";function e(n){if(typeof n!="function")throw new TypeError(t);return function(){var r=arguments;switch(r.length){case 0:return!n.call(this);case 1:return!n.call(this,r[0]);case 2:return!n.call(this,r[0],r[1]);case 3:return!n.call(this,r[0],r[1],r[2])}return!n.apply(this,r)}}return jh=e,jh}var Rh,Uw;jf=function(){if(Uw)return Rh;Uw=1;var t=or(),e=function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}}();return Rh=e,Rh};var Ph,Hw;Tf=function(){if(Hw)return Ph;Hw=1;var t=jf();function e(n,r,o){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:o,writable:!0}):n[r]=o}return Ph=e,Ph};var Th,qw;nm=function(){if(qw)return Th;qw=1;var t=Tf(),e=$a(),n=Object.prototype,r=n.hasOwnProperty;function o(a,i,s){var l=a[i];(!(r.call(a,i)&&e(l,s))||s===void 0&&!(i in a))&&t(a,i,s)}return Th=o,Th};var Ih,Qw;function DR(){if(Qw)return Ih;Qw=1;var t=nm(),e=go(),n=Ba(),r=xr(),o=br();function a(i,s,l,c){if(!r(i))return i;s=e(s,i);for(var d=-1,u=s.length,h=u-1,p=i;p!=null&&++d<u;){var y=o(s[d]),f=l;if(y==="__proto__"||y==="constructor"||y==="prototype")return i;if(d!=h){var v=p[y];f=c?c(v,y,p):void 0,f===void 0&&(f=r(v)?v:n(s[d+1])?[]:{})}t(p,y,f),p=p[y]}return i}return Ih=a,Ih}var Dh,Kw;dm=function(){if(Kw)return Dh;Kw=1;var t=La(),e=DR(),n=go();function r(o,a,i){for(var s=-1,l=a.length,c={};++s<l;){var d=a[s],u=t(o,d);i(u,d)&&e(c,n(d,o),u)}return c}return Dh=r,Dh};var Lh,Yw;Rf=function(){if(Yw)return Lh;Yw=1;var t=tw(),e=t(Object.getPrototypeOf,Object);return Lh=e,Lh};var $h,Xw;om=function(){if(Xw)return $h;Xw=1;var t=rl(),e=Rf(),n=Rl(),r=Lb(),o=Object.getOwnPropertySymbols,a=o?function(i){for(var s=[];i;)t(s,n(i)),i=e(i);return s}:r;return $h=a,$h};var Bh,Zw;function LR(){if(Zw)return Bh;Zw=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return Bh=t,Bh}var Fh,Gw;function $R(){if(Gw)return Fh;Gw=1;var t=xr(),e=Pl(),n=LR(),r=Object.prototype,o=r.hasOwnProperty;function a(i){if(!t(i))return n(i);var s=e(i),l=[];for(var c in i)c=="constructor"&&(s||!o.call(i,c))||l.push(c);return l}return Fh=a,Fh}var zh,Jw;rm=function(){if(Jw)return zh;Jw=1;var t=Gb(),e=$R(),n=al();function r(o){return n(o)?t(o,!0):e(o)}return zh=r,zh};var Vh,e1;cm=function(){if(e1)return Vh;e1=1;var t=Tb(),e=om(),n=rm();function r(o){return t(o,n,e)}return Vh=r,Vh};var Wh,t1;function BR(){if(t1)return Wh;t1=1;var t=il(),e=tl(),n=dm(),r=cm();function o(a,i){if(a==null)return{};var s=t(r(a),function(l){return[l]});return i=e(i),n(a,s,function(l,c){return i(l,c[0])})}return Wh=o,Wh}var Uh,n1;function FR(){if(n1)return Uh;n1=1;var t=tl(),e=IR(),n=BR();function r(o,a){return n(o,e(t(a)))}return Uh=r,Uh}var zR=FR();Wa=Qn(zR);var Hh,r1;function VR(){if(r1)return Hh;r1=1;function t(e){return e===void 0}return Hh=t,Hh}var WR=VR();Ua=Qn(WR);function at(t){if(typeof t=="string"||typeof t=="number")return""+t;let e="";if(Array.isArray(t))for(let n=0,r;n<t.length;n++)(r=at(t[n]))!==""&&(e+=(e&&" ")+r);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}var UR={value:()=>{}};function Xi(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Zi(n)}function Zi(t){this._=t}function HR(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",o=n.indexOf(".");if(o>=0&&(r=n.slice(o+1),n=n.slice(0,o)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Zi.prototype=Xi.prototype={constructor:Zi,on:function(t,e){var n=this._,r=HR(t+"",n),o,a=-1,i=r.length;if(arguments.length<2){for(;++a<i;)if((o=(t=r[a]).type)&&(o=qR(n[o],t.name)))return o;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<i;)if(o=(t=r[a]).type)n[o]=o1(n[o],t.name,e);else if(e==null)for(o in n)n[o]=o1(n[o],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Zi(t)},call:function(t,e){if((o=arguments.length-2)>0)for(var n=new Array(o),r=0,o,a;r<o;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,o=a.length;r<o;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,a=r.length;o<a;++o)r[o].value.apply(e,n)}};function qR(t,e){for(var n=0,r=t.length,o;n<r;++n)if((o=t[n]).name===e)return o.value}function o1(t,e,n){for(var r=0,o=t.length;r<o;++r)if(t[r].name===e){t[r]=UR,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var qh="http://www.w3.org/1999/xhtml";const a1={svg:"http://www.w3.org/2000/svg",xhtml:qh,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Gi(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),a1.hasOwnProperty(e)?{space:a1[e],local:t}:t}function QR(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===qh&&e.documentElement.namespaceURI===qh?e.createElement(t):e.createElementNS(n,t)}}function KR(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function i1(t){var e=Gi(t);return(e.local?KR:QR)(e)}function YR(){}function Qh(t){return t==null?YR:function(){return this.querySelector(t)}}function XR(t){typeof t!="function"&&(t=Qh(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var a=e[o],i=a.length,s=r[o]=new Array(i),l,c,d=0;d<i;++d)(l=a[d])&&(c=t.call(l,l.__data__,d,a))&&("__data__"in l&&(c.__data__=l.__data__),s[d]=c);return new St(r,this._parents)}function ZR(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function GR(){return[]}function s1(t){return t==null?GR:function(){return this.querySelectorAll(t)}}function JR(t){return function(){return ZR(t.apply(this,arguments))}}function eP(t){typeof t=="function"?t=JR(t):t=s1(t);for(var e=this._groups,n=e.length,r=[],o=[],a=0;a<n;++a)for(var i=e[a],s=i.length,l,c=0;c<s;++c)(l=i[c])&&(r.push(t.call(l,l.__data__,c,i)),o.push(l));return new St(r,o)}function l1(t){return function(){return this.matches(t)}}function c1(t){return function(e){return e.matches(t)}}var tP=Array.prototype.find;function nP(t){return function(){return tP.call(this.children,t)}}function rP(){return this.firstElementChild}function oP(t){return this.select(t==null?rP:nP(typeof t=="function"?t:c1(t)))}var aP=Array.prototype.filter;function iP(){return Array.from(this.children)}function sP(t){return function(){return aP.call(this.children,t)}}function lP(t){return this.selectAll(t==null?iP:sP(typeof t=="function"?t:c1(t)))}function cP(t){typeof t!="function"&&(t=l1(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var a=e[o],i=a.length,s=r[o]=[],l,c=0;c<i;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&s.push(l);return new St(r,this._parents)}function u1(t){return new Array(t.length)}function uP(){return new St(this._enter||this._groups.map(u1),this._parents)}function Ji(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Ji.prototype={constructor:Ji,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function dP(t){return function(){return t}}function hP(t,e,n,r,o,a){for(var i=0,s,l=e.length,c=a.length;i<c;++i)(s=e[i])?(s.__data__=a[i],r[i]=s):n[i]=new Ji(t,a[i]);for(;i<l;++i)(s=e[i])&&(o[i]=s)}function pP(t,e,n,r,o,a,i){var s,l,c=new Map,d=e.length,u=a.length,h=new Array(d),p;for(s=0;s<d;++s)(l=e[s])&&(h[s]=p=i.call(l,l.__data__,s,e)+"",c.has(p)?o[s]=l:c.set(p,l));for(s=0;s<u;++s)p=i.call(t,a[s],s,a)+"",(l=c.get(p))?(r[s]=l,l.__data__=a[s],c.delete(p)):n[s]=new Ji(t,a[s]);for(s=0;s<d;++s)(l=e[s])&&c.get(h[s])===l&&(o[s]=l)}function fP(t){return t.__data__}function mP(t,e){if(!arguments.length)return Array.from(this,fP);var n=e?pP:hP,r=this._parents,o=this._groups;typeof t!="function"&&(t=dP(t));for(var a=o.length,i=new Array(a),s=new Array(a),l=new Array(a),c=0;c<a;++c){var d=r[c],u=o[c],h=u.length,p=yP(t.call(d,d&&d.__data__,c,r)),y=p.length,f=s[c]=new Array(y),v=i[c]=new Array(y),g=l[c]=new Array(h);n(d,u,f,v,g,p,e);for(var b=0,w=0,E,M;b<y;++b)if(E=f[b]){for(b>=w&&(w=b+1);!(M=v[w])&&++w<y;);E._next=M||null}}return i=new St(i,r),i._enter=s,i._exit=l,i}function yP(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function gP(){return new St(this._exit||this._groups.map(u1),this._parents)}function vP(t,e,n){var r=this.enter(),o=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(o=e(o),o&&(o=o.selection())),n==null?a.remove():n(a),r&&o?r.merge(o).order():o}function xP(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,o=n.length,a=r.length,i=Math.min(o,a),s=new Array(o),l=0;l<i;++l)for(var c=n[l],d=r[l],u=c.length,h=s[l]=new Array(u),p,y=0;y<u;++y)(p=c[y]||d[y])&&(h[y]=p);for(;l<o;++l)s[l]=n[l];return new St(s,this._parents)}function bP(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],o=r.length-1,a=r[o],i;--o>=0;)(i=r[o])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}function wP(t){t||(t=EP);function e(u,h){return u&&h?t(u.__data__,h.__data__):!u-!h}for(var n=this._groups,r=n.length,o=new Array(r),a=0;a<r;++a){for(var i=n[a],s=i.length,l=o[a]=new Array(s),c,d=0;d<s;++d)(c=i[d])&&(l[d]=c);l.sort(e)}return new St(o,this._parents).order()}function EP(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function _P(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function MP(){return Array.from(this)}function CP(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],o=0,a=r.length;o<a;++o){var i=r[o];if(i)return i}return null}function NP(){let t=0;for(const e of this)++t;return t}function SP(){return!this.node()}function OP(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var o=e[n],a=0,i=o.length,s;a<i;++a)(s=o[a])&&t.call(s,s.__data__,a,o);return this}function AP(t){return function(){this.removeAttribute(t)}}function kP(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jP(t,e){return function(){this.setAttribute(t,e)}}function RP(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function PP(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function TP(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function IP(t,e){var n=Gi(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?kP:AP:typeof e=="function"?n.local?TP:PP:n.local?RP:jP)(n,e))}function d1(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function DP(t){return function(){this.style.removeProperty(t)}}function LP(t,e,n){return function(){this.style.setProperty(t,e,n)}}function $P(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function BP(t,e,n){return arguments.length>1?this.each((e==null?DP:typeof e=="function"?$P:LP)(t,e,n??"")):zr(this.node(),t)}function zr(t,e){return t.style.getPropertyValue(e)||d1(t).getComputedStyle(t,null).getPropertyValue(e)}function FP(t){return function(){delete this[t]}}function zP(t,e){return function(){this[t]=e}}function VP(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function WP(t,e){return arguments.length>1?this.each((e==null?FP:typeof e=="function"?VP:zP)(t,e)):this.node()[t]}function h1(t){return t.trim().split(/^|\s+/)}function Kh(t){return t.classList||new p1(t)}function p1(t){this._node=t,this._names=h1(t.getAttribute("class")||"")}p1.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function f1(t,e){for(var n=Kh(t),r=-1,o=e.length;++r<o;)n.add(e[r])}function m1(t,e){for(var n=Kh(t),r=-1,o=e.length;++r<o;)n.remove(e[r])}function UP(t){return function(){f1(this,t)}}function HP(t){return function(){m1(this,t)}}function qP(t,e){return function(){(e.apply(this,arguments)?f1:m1)(this,t)}}function QP(t,e){var n=h1(t+"");if(arguments.length<2){for(var r=Kh(this.node()),o=-1,a=n.length;++o<a;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof e=="function"?qP:e?UP:HP)(n,e))}function KP(){this.textContent=""}function YP(t){return function(){this.textContent=t}}function XP(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ZP(t){return arguments.length?this.each(t==null?KP:(typeof t=="function"?XP:YP)(t)):this.node().textContent}function GP(){this.innerHTML=""}function JP(t){return function(){this.innerHTML=t}}function eT(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function tT(t){return arguments.length?this.each(t==null?GP:(typeof t=="function"?eT:JP)(t)):this.node().innerHTML}function nT(){this.nextSibling&&this.parentNode.appendChild(this)}function rT(){return this.each(nT)}function oT(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function aT(){return this.each(oT)}function iT(t){var e=typeof t=="function"?t:i1(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function sT(){return null}function lT(t,e){var n=typeof t=="function"?t:i1(t),r=e==null?sT:typeof e=="function"?e:Qh(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function cT(){var t=this.parentNode;t&&t.removeChild(this)}function uT(){return this.each(cT)}function dT(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function hT(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function pT(t){return this.select(t?hT:dT)}function fT(t){return arguments.length?this.property("__data__",t):this.node().__data__}function mT(t){return function(e){t.call(this,e,this.__data__)}}function yT(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function gT(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,o=e.length,a;n<o;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function vT(t,e,n){return function(){var r=this.__on,o,a=mT(e);if(r){for(var i=0,s=r.length;i<s;++i)if((o=r[i]).type===t.type&&o.name===t.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=a,o.options=n),o.value=e;return}}this.addEventListener(t.type,a,n),o={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(o):this.__on=[o]}}function xT(t,e,n){var r=yT(t+""),o,a=r.length,i;if(arguments.length<2){var s=this.node().__on;if(s){for(var l=0,c=s.length,d;l<c;++l)for(o=0,d=s[l];o<a;++o)if((i=r[o]).type===d.type&&i.name===d.name)return d.value}return}for(s=e?vT:gT,o=0;o<a;++o)this.each(s(r[o],e,n));return this}function y1(t,e,n){var r=d1(t),o=r.CustomEvent;typeof o=="function"?o=new o(e,n):(o=r.document.createEvent("Event"),n?(o.initEvent(e,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(e,!1,!1)),t.dispatchEvent(o)}function bT(t,e){return function(){return y1(this,t,e)}}function wT(t,e){return function(){return y1(this,t,e.apply(this,arguments))}}function ET(t,e){return this.each((typeof e=="function"?wT:bT)(t,e))}function*_T(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],o=0,a=r.length,i;o<a;++o)(i=r[o])&&(yield i)}var g1=[null];function St(t,e){this._groups=t,this._parents=e}function oa(){return new St([[document.documentElement]],g1)}function MT(){return this}St.prototype=oa.prototype={constructor:St,select:XR,selectAll:eP,selectChild:oP,selectChildren:lP,filter:cP,data:mP,enter:uP,exit:gP,join:vP,merge:xP,selection:MT,order:bP,sort:wP,call:_P,nodes:MP,node:CP,size:NP,empty:SP,each:OP,attr:IP,style:BP,property:WP,classed:QP,text:ZP,html:tT,raise:rT,lower:aT,append:iT,insert:lT,remove:uT,clone:pT,datum:fT,on:xT,dispatch:ET,[Symbol.iterator]:_T};function Ot(t){return typeof t=="string"?new St([[document.querySelector(t)]],[document.documentElement]):new St([[t]],g1)}function CT(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Vt(t,e){if(t=CT(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var o=e.getBoundingClientRect();return[t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop]}}return[t.pageX,t.pageY]}const NT={passive:!1},aa={capture:!0,passive:!1};function Yh(t){t.stopImmediatePropagation()}function Vr(t){t.preventDefault(),t.stopImmediatePropagation()}function v1(t){var e=t.document.documentElement,n=Ot(t).on("dragstart.drag",Vr,aa);"onselectstart"in e?n.on("selectstart.drag",Vr,aa):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function x1(t,e){var n=t.document.documentElement,r=Ot(t).on("dragstart.drag",null);e&&(r.on("click.drag",Vr,aa),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const es=t=>()=>t;function Xh(t,{sourceEvent:e,subject:n,target:r,identifier:o,active:a,x:i,y:s,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}Xh.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function ST(t){return!t.ctrlKey&&!t.button}function OT(){return this.parentNode}function AT(t,e){return e??{x:t.x,y:t.y}}function kT(){return navigator.maxTouchPoints||"ontouchstart"in this}function b1(){var t=ST,e=OT,n=AT,r=kT,o={},a=Xi("start","drag","end"),i=0,s,l,c,d,u=0;function h(E){E.on("mousedown.drag",p).filter(r).on("touchstart.drag",v).on("touchmove.drag",g,NT).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(E,M){if(!(d||!t.call(this,E,M))){var S=w(this,e.call(this,E,M),E,M,"mouse");S&&(Ot(E.view).on("mousemove.drag",y,aa).on("mouseup.drag",f,aa),v1(E.view),Yh(E),c=!1,s=E.clientX,l=E.clientY,S("start",E))}}function y(E){if(Vr(E),!c){var M=E.clientX-s,S=E.clientY-l;c=M*M+S*S>u}o.mouse("drag",E)}function f(E){Ot(E.view).on("mousemove.drag mouseup.drag",null),x1(E.view,c),Vr(E),o.mouse("end",E)}function v(E,M){if(t.call(this,E,M)){var S=E.changedTouches,N=e.call(this,E,M),_=S.length,O,k;for(O=0;O<_;++O)(k=w(this,N,E,M,S[O].identifier,S[O]))&&(Yh(E),k("start",E,S[O]))}}function g(E){var M=E.changedTouches,S=M.length,N,_;for(N=0;N<S;++N)(_=o[M[N].identifier])&&(Vr(E),_("drag",E,M[N]))}function b(E){var M=E.changedTouches,S=M.length,N,_;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),N=0;N<S;++N)(_=o[M[N].identifier])&&(Yh(E),_("end",E,M[N]))}function w(E,M,S,N,_,O){var k=a.copy(),I=Vt(O||S,M),B,L,C;if((C=n.call(E,new Xh("beforestart",{sourceEvent:S,target:h,identifier:_,active:i,x:I[0],y:I[1],dx:0,dy:0,dispatch:k}),N))!=null)return B=C.x-I[0]||0,L=C.y-I[1]||0,function P(j,D,R){var A=I,V;switch(j){case"start":o[_]=P,V=i++;break;case"end":delete o[_],--i;case"drag":I=Vt(R||D,M),V=i;break}k.call(j,E,new Xh(j,{sourceEvent:D,subject:C,target:h,identifier:_,active:V,x:I[0]+B,y:I[1]+L,dx:I[0]-A[0],dy:I[1]-A[1],dispatch:k}),N)}}return h.filter=function(E){return arguments.length?(t=typeof E=="function"?E:es(!!E),h):t},h.container=function(E){return arguments.length?(e=typeof E=="function"?E:es(E),h):e},h.subject=function(E){return arguments.length?(n=typeof E=="function"?E:es(E),h):n},h.touchable=function(E){return arguments.length?(r=typeof E=="function"?E:es(!!E),h):r},h.on=function(){var E=a.on.apply(a,arguments);return E===a?h:E},h.clickDistance=function(E){return arguments.length?(u=(E=+E)*E,h):Math.sqrt(u)},h}function Zh(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function w1(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ia(){}var sa=.7,ts=1/sa,Wr="\\s*([+-]?\\d+)\\s*",la="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jT=/^#([0-9a-f]{3,8})$/,RT=new RegExp(`^rgb\\(${Wr},${Wr},${Wr}\\)$`),PT=new RegExp(`^rgb\\(${Zt},${Zt},${Zt}\\)$`),TT=new RegExp(`^rgba\\(${Wr},${Wr},${Wr},${la}\\)$`),IT=new RegExp(`^rgba\\(${Zt},${Zt},${Zt},${la}\\)$`),DT=new RegExp(`^hsl\\(${la},${Zt},${Zt}\\)$`),LT=new RegExp(`^hsla\\(${la},${Zt},${Zt},${la}\\)$`),E1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Zh(ia,yr,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:_1,formatHex:_1,formatHex8:$T,formatHsl:BT,formatRgb:M1,toString:M1});function _1(){return this.rgb().formatHex()}function $T(){return this.rgb().formatHex8()}function BT(){return A1(this).formatHsl()}function M1(){return this.rgb().formatRgb()}yr=function(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=jT.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?C1(e):n===3?new _t(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ns(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ns(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=RT.exec(t))?new _t(e[1],e[2],e[3],1):(e=PT.exec(t))?new _t(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=TT.exec(t))?ns(e[1],e[2],e[3],e[4]):(e=IT.exec(t))?ns(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=DT.exec(t))?O1(e[1],e[2]/100,e[3]/100,1):(e=LT.exec(t))?O1(e[1],e[2]/100,e[3]/100,e[4]):E1.hasOwnProperty(t)?C1(E1[t]):t==="transparent"?new _t(NaN,NaN,NaN,0):null};function C1(t){return new _t(t>>16&255,t>>8&255,t&255,1)}function ns(t,e,n,r){return r<=0&&(t=e=n=NaN),new _t(t,e,n,r)}function FT(t){return t instanceof ia||(t=yr(t)),t?(t=t.rgb(),new _t(t.r,t.g,t.b,t.opacity)):new _t}function Gh(t,e,n,r){return arguments.length===1?FT(t):new _t(t,e,n,r??1)}function _t(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Zh(_t,Gh,w1(ia,{brighter(t){return t=t==null?ts:Math.pow(ts,t),new _t(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?sa:Math.pow(sa,t),new _t(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new _t(ar(this.r),ar(this.g),ar(this.b),rs(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:N1,formatHex:N1,formatHex8:zT,formatRgb:S1,toString:S1}));function N1(){return`#${ir(this.r)}${ir(this.g)}${ir(this.b)}`}function zT(){return`#${ir(this.r)}${ir(this.g)}${ir(this.b)}${ir((isNaN(this.opacity)?1:this.opacity)*255)}`}function S1(){const t=rs(this.opacity);return`${t===1?"rgb(":"rgba("}${ar(this.r)}, ${ar(this.g)}, ${ar(this.b)}${t===1?")":`, ${t})`}`}function rs(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ar(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ir(t){return t=ar(t),(t<16?"0":"")+t.toString(16)}function O1(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Wt(t,e,n,r)}function A1(t){if(t instanceof Wt)return new Wt(t.h,t.s,t.l,t.opacity);if(t instanceof ia||(t=yr(t)),!t)return new Wt;if(t instanceof Wt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,o=Math.min(e,n,r),a=Math.max(e,n,r),i=NaN,s=a-o,l=(a+o)/2;return s?(e===a?i=(n-r)/s+(n<r)*6:n===a?i=(r-e)/s+2:i=(e-n)/s+4,s/=l<.5?a+o:2-a-o,i*=60):s=l>0&&l<1?0:i,new Wt(i,s,l,t.opacity)}function VT(t,e,n,r){return arguments.length===1?A1(t):new Wt(t,e,n,r??1)}function Wt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Zh(Wt,VT,w1(ia,{brighter(t){return t=t==null?ts:Math.pow(ts,t),new Wt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?sa:Math.pow(sa,t),new Wt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,o=2*n-r;return new _t(Jh(t>=240?t-240:t+120,o,r),Jh(t,o,r),Jh(t<120?t+240:t-120,o,r),this.opacity)},clamp(){return new Wt(k1(this.h),os(this.s),os(this.l),rs(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=rs(this.opacity);return`${t===1?"hsl(":"hsla("}${k1(this.h)}, ${os(this.s)*100}%, ${os(this.l)*100}%${t===1?")":`, ${t})`}`}}));function k1(t){return t=(t||0)%360,t<0?t+360:t}function os(t){return Math.max(0,Math.min(1,t||0))}function Jh(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}Ll=t=>()=>t;function WT(t,e){return function(n){return t+n*e}}function UT(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function HT(t){return(t=+t)==1?j1:function(e,n){return n-e?UT(e,n,t):Ll(isNaN(e)?n:e)}}function j1(t,e){var n=e-t;return n?WT(t,n):Ll(isNaN(t)?e:t)}fl=function t(e){var n=HT(e);function r(o,a){var i=n((o=Gh(o)).r,(a=Gh(a)).r),s=n(o.g,a.g),l=n(o.b,a.b),c=j1(o.opacity,a.opacity);return function(d){return o.r=i(d),o.g=s(d),o.b=l(d),o.opacity=c(d),o+""}}return r.gamma=t,r}(1),cn=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}};var ep=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tp=new RegExp(ep.source,"g");function qT(t){return function(){return t}}function QT(t){return function(e){return t(e)+""}}Em=function(t,e){var n=ep.lastIndex=tp.lastIndex=0,r,o,a,i=-1,s=[],l=[];for(t=t+"",e=e+"";(r=ep.exec(t))&&(o=tp.exec(e));)(a=o.index)>n&&(a=e.slice(n,a),s[i]?s[i]+=a:s[++i]=a),(r=r[0])===(o=o[0])?s[i]?s[i]+=o:s[++i]=o:(s[++i]=null,l.push({i,x:cn(r,o)})),n=tp.lastIndex;return n<e.length&&(a=e.slice(n),s[i]?s[i]+=a:s[++i]=a),s.length<2?l[0]?QT(l[0].x):qT(e):(e=l.length,function(c){for(var d=0,u;d<e;++d)s[(u=l[d]).i]=u.x(c);return s.join("")})};var R1=180/Math.PI,P1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function T1(t,e,n,r,o,a){var i,s,l;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),t*r<e*n&&(t=-t,e=-e,l=-l,i=-i),{translateX:o,translateY:a,rotate:Math.atan2(e,t)*R1,skewX:Math.atan(l)*R1,scaleX:i,scaleY:s}}var as;function KT(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?P1:T1(e.a,e.b,e.c,e.d,e.e,e.f)}function YT(t){return t==null||(as||(as=document.createElementNS("http://www.w3.org/2000/svg","g")),as.setAttribute("transform",t),!(t=as.transform.baseVal.consolidate()))?P1:(t=t.matrix,T1(t.a,t.b,t.c,t.d,t.e,t.f))}function I1(t,e,n,r){function o(c){return c.length?c.pop()+" ":""}function a(c,d,u,h,p,y){if(c!==u||d!==h){var f=p.push("translate(",null,e,null,n);y.push({i:f-4,x:cn(c,u)},{i:f-2,x:cn(d,h)})}else(u||h)&&p.push("translate("+u+e+h+n)}function i(c,d,u,h){c!==d?(c-d>180?d+=360:d-c>180&&(c+=360),h.push({i:u.push(o(u)+"rotate(",null,r)-2,x:cn(c,d)})):d&&u.push(o(u)+"rotate("+d+r)}function s(c,d,u,h){c!==d?h.push({i:u.push(o(u)+"skewX(",null,r)-2,x:cn(c,d)}):d&&u.push(o(u)+"skewX("+d+r)}function l(c,d,u,h,p,y){if(c!==u||d!==h){var f=p.push(o(p)+"scale(",null,",",null,")");y.push({i:f-4,x:cn(c,u)},{i:f-2,x:cn(d,h)})}else(u!==1||h!==1)&&p.push(o(p)+"scale("+u+","+h+")")}return function(c,d){var u=[],h=[];return c=t(c),d=t(d),a(c.translateX,c.translateY,d.translateX,d.translateY,u,h),i(c.rotate,d.rotate,u,h),s(c.skewX,d.skewX,u,h),l(c.scaleX,c.scaleY,d.scaleX,d.scaleY,u,h),c=d=null,function(p){for(var y=-1,f=h.length,v;++y<f;)u[(v=h[y]).i]=v.x(p);return u.join("")}}}var XT=I1(KT,"px, ","px)","deg)"),ZT=I1(YT,", ",")",")"),GT=1e-12;function D1(t){return((t=Math.exp(t))+1/t)/2}function JT(t){return((t=Math.exp(t))-1/t)/2}function e3(t){return((t=Math.exp(2*t))-1)/(t+1)}const t3=function t(e,n,r){function o(a,i){var s=a[0],l=a[1],c=a[2],d=i[0],u=i[1],h=i[2],p=d-s,y=u-l,f=p*p+y*y,v,g;if(f<GT)g=Math.log(h/c)/e,v=function(N){return[s+N*p,l+N*y,c*Math.exp(e*N*g)]};else{var b=Math.sqrt(f),w=(h*h-c*c+r*f)/(2*c*n*b),E=(h*h-c*c-r*f)/(2*h*n*b),M=Math.log(Math.sqrt(w*w+1)-w),S=Math.log(Math.sqrt(E*E+1)-E);g=(S-M)/e,v=function(N){var _=N*g,O=D1(M),k=c/(n*b)*(O*e3(e*_+M)-JT(M));return[s+k*p,l+k*y,c*O/D1(e*_+M)]}}return v.duration=g*1e3*e/Math.SQRT2,v}return o.rho=function(a){var i=Math.max(.001,+a),s=i*i,l=s*s;return t(i,s,l)},o}(Math.SQRT2,2,4);var Ur=0,ca=0,ua=0,L1=1e3,is,da,ss=0,sr=0,ls=0,ha=typeof performance=="object"&&performance.now?performance:Date,$1=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function np(){return sr||($1(n3),sr=ha.now()+ls)}function n3(){sr=0}function cs(){this._call=this._time=this._next=null}cs.prototype=B1.prototype={constructor:cs,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?np():+n)+(e==null?0:+e),!this._next&&da!==this&&(da?da._next=this:is=this,da=this),this._call=t,this._time=n,rp()},stop:function(){this._call&&(this._call=null,this._time=1/0,rp())}};function B1(t,e,n){var r=new cs;return r.restart(t,e,n),r}function r3(){np(),++Ur;for(var t=is,e;t;)(e=sr-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Ur}function F1(){sr=(ss=ha.now())+ls,Ur=ca=0;try{r3()}finally{Ur=0,a3(),sr=0}}function o3(){var t=ha.now(),e=t-ss;e>L1&&(ls-=e,ss=t)}function a3(){for(var t,e=is,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:is=n);da=t,rp(r)}function rp(t){if(!Ur){ca&&(ca=clearTimeout(ca));var e=t-sr;e>24?(t<1/0&&(ca=setTimeout(F1,t-ha.now()-ls)),ua&&(ua=clearInterval(ua))):(ua||(ss=ha.now(),ua=setInterval(o3,L1)),Ur=1,$1(F1))}}function z1(t,e,n){var r=new cs;return e=e==null?0:+e,r.restart(o=>{r.stop(),t(o+e)},e,n),r}var i3=Xi("start","end","cancel","interrupt"),s3=[],V1=0,W1=1,op=2,us=3,U1=4,ap=5,ds=6;function hs(t,e,n,r,o,a){var i=t.__transition;if(!i)t.__transition={};else if(n in i)return;l3(t,n,{name:e,index:r,group:o,on:i3,tween:s3,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:V1})}function ip(t,e){var n=Ut(t,e);if(n.state>V1)throw new Error("too late; already scheduled");return n}function Gt(t,e){var n=Ut(t,e);if(n.state>us)throw new Error("too late; already running");return n}function Ut(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function l3(t,e,n){var r=t.__transition,o;r[e]=n,n.timer=B1(a,0,n.time);function a(c){n.state=W1,n.timer.restart(i,n.delay,n.time),n.delay<=c&&i(c-n.delay)}function i(c){var d,u,h,p;if(n.state!==W1)return l();for(d in r)if(p=r[d],p.name===n.name){if(p.state===us)return z1(i);p.state===U1?(p.state=ds,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[d]):+d<e&&(p.state=ds,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[d])}if(z1(function(){n.state===us&&(n.state=U1,n.timer.restart(s,n.delay,n.time),s(c))}),n.state=op,n.on.call("start",t,t.__data__,n.index,n.group),n.state===op){for(n.state=us,o=new Array(h=n.tween.length),d=0,u=-1;d<h;++d)(p=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(o[++u]=p);o.length=u+1}}function s(c){for(var d=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=ap,1),u=-1,h=o.length;++u<h;)o[u].call(t,d);n.state===ap&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=ds,n.timer.stop(),delete r[e];for(var c in r)return;delete t.__transition}}function ps(t,e){var n=t.__transition,r,o,a=!0,i;if(n){e=e==null?null:e+"";for(i in n){if((r=n[i]).name!==e){a=!1;continue}o=r.state>op&&r.state<ap,r.state=ds,r.timer.stop(),r.on.call(o?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[i]}a&&delete t.__transition}}function c3(t){return this.each(function(){ps(this,t)})}function u3(t,e){var n,r;return function(){var o=Gt(this,t),a=o.tween;if(a!==n){r=n=a;for(var i=0,s=r.length;i<s;++i)if(r[i].name===e){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function d3(t,e,n){var r,o;if(typeof n!="function")throw new Error;return function(){var a=Gt(this,t),i=a.tween;if(i!==r){o=(r=i).slice();for(var s={name:e,value:n},l=0,c=o.length;l<c;++l)if(o[l].name===e){o[l]=s;break}l===c&&o.push(s)}a.tween=o}}function h3(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Ut(this.node(),n).tween,o=0,a=r.length,i;o<a;++o)if((i=r[o]).name===t)return i.value;return null}return this.each((e==null?u3:d3)(n,t,e))}function sp(t,e,n){var r=t._id;return t.each(function(){var o=Gt(this,r);(o.value||(o.value={}))[e]=n.apply(this,arguments)}),function(o){return Ut(o,r).value[e]}}function H1(t,e){var n;return(typeof e=="number"?cn:e instanceof yr?fl:(n=yr(e))?(e=n,fl):Em)(t,e)}function p3(t){return function(){this.removeAttribute(t)}}function f3(t){return function(){this.removeAttributeNS(t.space,t.local)}}function m3(t,e,n){var r,o=n+"",a;return function(){var i=this.getAttribute(t);return i===o?null:i===r?a:a=e(r=i,n)}}function y3(t,e,n){var r,o=n+"",a;return function(){var i=this.getAttributeNS(t.space,t.local);return i===o?null:i===r?a:a=e(r=i,n)}}function g3(t,e,n){var r,o,a;return function(){var i,s=n(this),l;return s==null?void this.removeAttribute(t):(i=this.getAttribute(t),l=s+"",i===l?null:i===r&&l===o?a:(o=l,a=e(r=i,s)))}}function v3(t,e,n){var r,o,a;return function(){var i,s=n(this),l;return s==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),l=s+"",i===l?null:i===r&&l===o?a:(o=l,a=e(r=i,s)))}}function x3(t,e){var n=Gi(t),r=n==="transform"?ZT:H1;return this.attrTween(t,typeof e=="function"?(n.local?v3:g3)(n,r,sp(this,"attr."+t,e)):e==null?(n.local?f3:p3)(n):(n.local?y3:m3)(n,r,e))}function b3(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function w3(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function E3(t,e){var n,r;function o(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&w3(t,a)),n}return o._value=e,o}function _3(t,e){var n,r;function o(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&b3(t,a)),n}return o._value=e,o}function M3(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Gi(t);return this.tween(n,(r.local?E3:_3)(r,e))}function C3(t,e){return function(){ip(this,t).delay=+e.apply(this,arguments)}}function N3(t,e){return e=+e,function(){ip(this,t).delay=e}}function S3(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?C3:N3)(e,t)):Ut(this.node(),e).delay}function O3(t,e){return function(){Gt(this,t).duration=+e.apply(this,arguments)}}function A3(t,e){return e=+e,function(){Gt(this,t).duration=e}}function k3(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?O3:A3)(e,t)):Ut(this.node(),e).duration}function j3(t,e){if(typeof e!="function")throw new Error;return function(){Gt(this,t).ease=e}}function R3(t){var e=this._id;return arguments.length?this.each(j3(e,t)):Ut(this.node(),e).ease}function P3(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Gt(this,t).ease=n}}function T3(t){if(typeof t!="function")throw new Error;return this.each(P3(this._id,t))}function I3(t){typeof t!="function"&&(t=l1(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var a=e[o],i=a.length,s=r[o]=[],l,c=0;c<i;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&s.push(l);return new wn(r,this._parents,this._name,this._id)}function D3(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,o=n.length,a=Math.min(r,o),i=new Array(r),s=0;s<a;++s)for(var l=e[s],c=n[s],d=l.length,u=i[s]=new Array(d),h,p=0;p<d;++p)(h=l[p]||c[p])&&(u[p]=h);for(;s<r;++s)i[s]=e[s];return new wn(i,this._parents,this._name,this._id)}function L3(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function $3(t,e,n){var r,o,a=L3(e)?ip:Gt;return function(){var i=a(this,t),s=i.on;s!==r&&(o=(r=s).copy()).on(e,n),i.on=o}}function B3(t,e){var n=this._id;return arguments.length<2?Ut(this.node(),n).on.on(t):this.each($3(n,t,e))}function F3(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function z3(){return this.on("end.remove",F3(this._id))}function V3(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Qh(t));for(var r=this._groups,o=r.length,a=new Array(o),i=0;i<o;++i)for(var s=r[i],l=s.length,c=a[i]=new Array(l),d,u,h=0;h<l;++h)(d=s[h])&&(u=t.call(d,d.__data__,h,s))&&("__data__"in d&&(u.__data__=d.__data__),c[h]=u,hs(c[h],e,n,h,c,Ut(d,n)));return new wn(a,this._parents,e,n)}function W3(t){var e=this._name,n=this._id;typeof t!="function"&&(t=s1(t));for(var r=this._groups,o=r.length,a=[],i=[],s=0;s<o;++s)for(var l=r[s],c=l.length,d,u=0;u<c;++u)if(d=l[u]){for(var h=t.call(d,d.__data__,u,l),p,y=Ut(d,n),f=0,v=h.length;f<v;++f)(p=h[f])&&hs(p,e,n,f,h,y);a.push(h),i.push(d)}return new wn(a,i,e,n)}var U3=oa.prototype.constructor;function H3(){return new U3(this._groups,this._parents)}function q3(t,e){var n,r,o;return function(){var a=zr(this,t),i=(this.style.removeProperty(t),zr(this,t));return a===i?null:a===n&&i===r?o:o=e(n=a,r=i)}}function q1(t){return function(){this.style.removeProperty(t)}}function Q3(t,e,n){var r,o=n+"",a;return function(){var i=zr(this,t);return i===o?null:i===r?a:a=e(r=i,n)}}function K3(t,e,n){var r,o,a;return function(){var i=zr(this,t),s=n(this),l=s+"";return s==null&&(l=s=(this.style.removeProperty(t),zr(this,t))),i===l?null:i===r&&l===o?a:(o=l,a=e(r=i,s))}}function Y3(t,e){var n,r,o,a="style."+e,i="end."+a,s;return function(){var l=Gt(this,t),c=l.on,d=l.value[a]==null?s||(s=q1(e)):void 0;(c!==n||o!==d)&&(r=(n=c).copy()).on(i,o=d),l.on=r}}function X3(t,e,n){var r=(t+="")=="transform"?XT:H1;return e==null?this.styleTween(t,q3(t,r)).on("end.style."+t,q1(t)):typeof e=="function"?this.styleTween(t,K3(t,r,sp(this,"style."+t,e))).each(Y3(this._id,t)):this.styleTween(t,Q3(t,r,e),n).on("end.style."+t,null)}function Z3(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function G3(t,e,n){var r,o;function a(){var i=e.apply(this,arguments);return i!==o&&(r=(o=i)&&Z3(t,i,n)),r}return a._value=e,a}function J3(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,G3(t,e,n??""))}function e5(t){return function(){this.textContent=t}}function t5(t){return function(){var e=t(this);this.textContent=e??""}}function n5(t){return this.tween("text",typeof t=="function"?t5(sp(this,"text",t)):e5(t==null?"":t+""))}function r5(t){return function(e){this.textContent=t.call(this,e)}}function o5(t){var e,n;function r(){var o=t.apply(this,arguments);return o!==n&&(e=(n=o)&&r5(o)),e}return r._value=t,r}function a5(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,o5(t))}function i5(){for(var t=this._name,e=this._id,n=Q1(),r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],s=i.length,l,c=0;c<s;++c)if(l=i[c]){var d=Ut(l,e);hs(l,t,n,c,i,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new wn(r,this._parents,t,n)}function s5(){var t,e,n=this,r=n._id,o=n.size();return new Promise(function(a,i){var s={value:i},l={value:function(){--o===0&&a()}};n.each(function(){var c=Gt(this,r),d=c.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),c.on=e}),o===0&&a()})}var l5=0;function wn(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Q1(){return++l5}var En=oa.prototype;wn.prototype={constructor:wn,select:V3,selectAll:W3,selectChild:En.selectChild,selectChildren:En.selectChildren,filter:I3,merge:D3,selection:H3,transition:i5,call:En.call,nodes:En.nodes,node:En.node,size:En.size,empty:En.empty,each:En.each,on:B3,attr:x3,attrTween:M3,style:X3,styleTween:J3,text:n5,textTween:a5,remove:z3,tween:h3,delay:S3,duration:k3,ease:R3,easeVarying:T3,end:s5,[Symbol.iterator]:En[Symbol.iterator]};function c5(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var u5={time:null,delay:0,duration:250,ease:c5};function d5(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function h5(t){var e,n;t instanceof wn?(e=t._id,t=t._name):(e=Q1(),(n=u5).time=np(),t=t==null?null:t+"");for(var r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],s=i.length,l,c=0;c<s;++c)(l=i[c])&&hs(l,t,e,c,i,n||d5(l,e));return new wn(r,this._parents,t,e)}oa.prototype.interrupt=c3,oa.prototype.transition=h5;const fs=t=>()=>t;function p5(t,{sourceEvent:e,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function _n(t,e,n){this.k=t,this.x=e,this.y=n}_n.prototype={constructor:_n,scale:function(t){return t===1?this:new _n(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new _n(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ms=new _n(1,0,0);K1.prototype=_n.prototype;function K1(t){for(;!t.__zoom;)if(!(t=t.parentNode))return ms;return t.__zoom}function lp(t){t.stopImmediatePropagation()}function pa(t){t.preventDefault(),t.stopImmediatePropagation()}function f5(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function m5(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Y1(){return this.__zoom||ms}function y5(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function g5(){return navigator.maxTouchPoints||"ontouchstart"in this}function v5(t,e,n){var r=t.invertX(e[0][0])-n[0][0],o=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],i=t.invertY(e[1][1])-n[1][1];return t.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i))}function X1(){var t=f5,e=m5,n=v5,r=y5,o=g5,a=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],s=250,l=t3,c=Xi("start","zoom","end"),d,u,h,p=500,y=150,f=0,v=10;function g(C){C.property("__zoom",Y1).on("wheel.zoom",_,{passive:!1}).on("mousedown.zoom",O).on("dblclick.zoom",k).filter(o).on("touchstart.zoom",I).on("touchmove.zoom",B).on("touchend.zoom touchcancel.zoom",L).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(C,P,j,D){var R=C.selection?C.selection():C;R.property("__zoom",Y1),C!==R?M(C,P,j,D):R.interrupt().each(function(){S(this,arguments).event(D).start().zoom(null,typeof P=="function"?P.apply(this,arguments):P).end()})},g.scaleBy=function(C,P,j,D){g.scaleTo(C,function(){var R=this.__zoom.k,A=typeof P=="function"?P.apply(this,arguments):P;return R*A},j,D)},g.scaleTo=function(C,P,j,D){g.transform(C,function(){var R=e.apply(this,arguments),A=this.__zoom,V=j==null?E(R):typeof j=="function"?j.apply(this,arguments):j,q=A.invert(V),Y=typeof P=="function"?P.apply(this,arguments):P;return n(w(b(A,Y),V,q),R,i)},j,D)},g.translateBy=function(C,P,j,D){g.transform(C,function(){return n(this.__zoom.translate(typeof P=="function"?P.apply(this,arguments):P,typeof j=="function"?j.apply(this,arguments):j),e.apply(this,arguments),i)},null,D)},g.translateTo=function(C,P,j,D,R){g.transform(C,function(){var A=e.apply(this,arguments),V=this.__zoom,q=D==null?E(A):typeof D=="function"?D.apply(this,arguments):D;return n(ms.translate(q[0],q[1]).scale(V.k).translate(typeof P=="function"?-P.apply(this,arguments):-P,typeof j=="function"?-j.apply(this,arguments):-j),A,i)},D,R)};function b(C,P){return P=Math.max(a[0],Math.min(a[1],P)),P===C.k?C:new _n(P,C.x,C.y)}function w(C,P,j){var D=P[0]-j[0]*C.k,R=P[1]-j[1]*C.k;return D===C.x&&R===C.y?C:new _n(C.k,D,R)}function E(C){return[(+C[0][0]+ +C[1][0])/2,(+C[0][1]+ +C[1][1])/2]}function M(C,P,j,D){C.on("start.zoom",function(){S(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).event(D).end()}).tween("zoom",function(){var R=this,A=arguments,V=S(R,A).event(D),q=e.apply(R,A),Y=j==null?E(q):typeof j=="function"?j.apply(R,A):j,H=Math.max(q[1][0]-q[0][0],q[1][1]-q[0][1]),G=R.__zoom,Z=typeof P=="function"?P.apply(R,A):P,J=l(G.invert(Y).concat(H/G.k),Z.invert(Y).concat(H/Z.k));return function(ce){if(ce===1)ce=Z;else{var U=J(ce),te=H/U[2];ce=new _n(te,Y[0]-U[0]*te,Y[1]-U[1]*te)}V.zoom(null,ce)}})}function S(C,P,j){return!j&&C.__zooming||new N(C,P)}function N(C,P){this.that=C,this.args=P,this.active=0,this.sourceEvent=null,this.extent=e.apply(C,P),this.taps=0}N.prototype={event:function(C){return C&&(this.sourceEvent=C),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(C,P){return this.mouse&&C!=="mouse"&&(this.mouse[1]=P.invert(this.mouse[0])),this.touch0&&C!=="touch"&&(this.touch0[1]=P.invert(this.touch0[0])),this.touch1&&C!=="touch"&&(this.touch1[1]=P.invert(this.touch1[0])),this.that.__zoom=P,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(C){var P=Ot(this.that).datum();c.call(C,this.that,new p5(C,{sourceEvent:this.sourceEvent,target:g,type:C,transform:this.that.__zoom,dispatch:c}),P)}};function _(C,...P){if(!t.apply(this,arguments))return;var j=S(this,P).event(C),D=this.__zoom,R=Math.max(a[0],Math.min(a[1],D.k*Math.pow(2,r.apply(this,arguments)))),A=Vt(C);if(j.wheel)(j.mouse[0][0]!==A[0]||j.mouse[0][1]!==A[1])&&(j.mouse[1]=D.invert(j.mouse[0]=A)),clearTimeout(j.wheel);else{if(D.k===R)return;j.mouse=[A,D.invert(A)],ps(this),j.start()}pa(C),j.wheel=setTimeout(V,y),j.zoom("mouse",n(w(b(D,R),j.mouse[0],j.mouse[1]),j.extent,i));function V(){j.wheel=null,j.end()}}function O(C,...P){if(h||!t.apply(this,arguments))return;var j=C.currentTarget,D=S(this,P,!0).event(C),R=Ot(C.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",H,!0),A=Vt(C,j),V=C.clientX,q=C.clientY;v1(C.view),lp(C),D.mouse=[A,this.__zoom.invert(A)],ps(this),D.start();function Y(G){if(pa(G),!D.moved){var Z=G.clientX-V,J=G.clientY-q;D.moved=Z*Z+J*J>f}D.event(G).zoom("mouse",n(w(D.that.__zoom,D.mouse[0]=Vt(G,j),D.mouse[1]),D.extent,i))}function H(G){R.on("mousemove.zoom mouseup.zoom",null),x1(G.view,D.moved),pa(G),D.event(G).end()}}function k(C,...P){if(t.apply(this,arguments)){var j=this.__zoom,D=Vt(C.changedTouches?C.changedTouches[0]:C,this),R=j.invert(D),A=j.k*(C.shiftKey?.5:2),V=n(w(b(j,A),D,R),e.apply(this,P),i);pa(C),s>0?Ot(this).transition().duration(s).call(M,V,D,C):Ot(this).call(g.transform,V,D,C)}}function I(C,...P){if(t.apply(this,arguments)){var j=C.touches,D=j.length,R=S(this,P,C.changedTouches.length===D).event(C),A,V,q,Y;for(lp(C),V=0;V<D;++V)q=j[V],Y=Vt(q,this),Y=[Y,this.__zoom.invert(Y),q.identifier],R.touch0?!R.touch1&&R.touch0[2]!==Y[2]&&(R.touch1=Y,R.taps=0):(R.touch0=Y,A=!0,R.taps=1+!!d);d&&(d=clearTimeout(d)),A&&(R.taps<2&&(u=Y[0],d=setTimeout(function(){d=null},p)),ps(this),R.start())}}function B(C,...P){if(this.__zooming){var j=S(this,P).event(C),D=C.changedTouches,R=D.length,A,V,q,Y;for(pa(C),A=0;A<R;++A)V=D[A],q=Vt(V,this),j.touch0&&j.touch0[2]===V.identifier?j.touch0[0]=q:j.touch1&&j.touch1[2]===V.identifier&&(j.touch1[0]=q);if(V=j.that.__zoom,j.touch1){var H=j.touch0[0],G=j.touch0[1],Z=j.touch1[0],J=j.touch1[1],ce=(ce=Z[0]-H[0])*ce+(ce=Z[1]-H[1])*ce,U=(U=J[0]-G[0])*U+(U=J[1]-G[1])*U;V=b(V,Math.sqrt(ce/U)),q=[(H[0]+Z[0])/2,(H[1]+Z[1])/2],Y=[(G[0]+J[0])/2,(G[1]+J[1])/2]}else if(j.touch0)q=j.touch0[0],Y=j.touch0[1];else return;j.zoom("touch",n(w(V,q,Y),j.extent,i))}}function L(C,...P){if(this.__zooming){var j=S(this,P).event(C),D=C.changedTouches,R=D.length,A,V;for(lp(C),h&&clearTimeout(h),h=setTimeout(function(){h=null},p),A=0;A<R;++A)V=D[A],j.touch0&&j.touch0[2]===V.identifier?delete j.touch0:j.touch1&&j.touch1[2]===V.identifier&&delete j.touch1;if(j.touch1&&!j.touch0&&(j.touch0=j.touch1,delete j.touch1),j.touch0)j.touch0[1]=this.__zoom.invert(j.touch0[0]);else if(j.end(),j.taps===2&&(V=Vt(V,this),Math.hypot(u[0]-V[0],u[1]-V[1])<v)){var q=Ot(this).on("dblclick.zoom");q&&q.apply(this,arguments)}}}return g.wheelDelta=function(C){return arguments.length?(r=typeof C=="function"?C:fs(+C),g):r},g.filter=function(C){return arguments.length?(t=typeof C=="function"?C:fs(!!C),g):t},g.touchable=function(C){return arguments.length?(o=typeof C=="function"?C:fs(!!C),g):o},g.extent=function(C){return arguments.length?(e=typeof C=="function"?C:fs([[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]]),g):e},g.scaleExtent=function(C){return arguments.length?(a[0]=+C[0],a[1]=+C[1],g):[a[0],a[1]]},g.translateExtent=function(C){return arguments.length?(i[0][0]=+C[0][0],i[1][0]=+C[1][0],i[0][1]=+C[0][1],i[1][1]=+C[1][1],g):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},g.constrain=function(C){return arguments.length?(n=C,g):n},g.duration=function(C){return arguments.length?(s=+C,g):s},g.interpolate=function(C){return arguments.length?(l=C,g):l},g.on=function(){var C=c.on.apply(c,arguments);return C===c?g:C},g.clickDistance=function(C){return arguments.length?(f=(C=+C)*C,g):Math.sqrt(f)},g.tapDistance=function(C){return arguments.length?(v=+C,g):v},g}const Mn={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`},fa=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Z1=["Enter"," ","Escape"];var Hr;(function(t){t.Strict="strict",t.Loose="loose"})(Hr||(Hr={})),function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"}(Xn||(Xn={}));var ma;(function(t){t.Partial="partial",t.Full="full"})(ma||(ma={}));const G1={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var $n;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})($n||($n={}));var ys;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(ys||(ys={})),function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"}(xe||(xe={}));const J1={[xe.Left]:xe.Right,[xe.Right]:xe.Left,[xe.Top]:xe.Bottom,[xe.Bottom]:xe.Top};function x5(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function eE(t,e,n){if(!n)return;const r=[];t.forEach((o,a)=>{e!=null&&e.has(a)||r.push(o)}),r.length&&n(r)}function tE(t){return t===null?null:t?"valid":"invalid"}const nE=t=>"id"in t&&"source"in t&&"target"in t,b5=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),cp=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),ya=(t,e=[0,0])=>{const{width:n,height:r}=Cn(t),o=t.origin??e,a=n*o[0],i=r*o[1];return{x:t.position.x-a,y:t.position.y-i}},w5=(t,e={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,o)=>{const a=typeof o=="string";let i=!e.nodeLookup&&!a?o:void 0;e.nodeLookup&&(i=a?e.nodeLookup.get(o):cp(o)?o:e.nodeLookup.get(o.id));const s=i?xs(i,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return gs(r,s)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return vs(n)},ga=(t,e={})=>{if(t.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return t.forEach(r=>{if(e.filter===void 0||e.filter(r)){const o=xs(r);n=gs(n,o)}}),vs(n)},rE=(t,e,[n,r,o]=[0,0,1],a=!1,i=!1)=>{const s={...xa(e,[n,r,o]),width:e.width/o,height:e.height/o},l=[];for(const c of t.values()){const{measured:d,selectable:u=!0,hidden:h=!1}=c;if(i&&!u||h)continue;const p=d.width??c.width??c.initialWidth??null,y=d.height??c.height??c.initialHeight??null,f=va(s,Qr(c)),v=(p??0)*(y??0),g=a&&f>0;(!c.internals.handleBounds||g||f>=v||c.dragging)&&l.push(c)}return l},E5=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function up(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(o=>o.id)):null;return t.forEach(o=>{o.measured.width&&o.measured.height&&(e!=null&&e.includeHiddenNodes||!o.hidden)&&(!r||r.has(o.id))&&n.set(o.id,o)}),n}async function dp({nodes:t,width:e,height:n,panZoom:r,minZoom:o,maxZoom:a},i){if(t.size===0)return Promise.resolve(!1);const s=ga(t),l=pp(s,e,n,(i==null?void 0:i.minZoom)??o,(i==null?void 0:i.maxZoom)??a,(i==null?void 0:i.padding)??.1);return await r.setViewport(l,{duration:i==null?void 0:i.duration}),Promise.resolve(!0)}function oE({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:o,onError:a}){const i=n.get(t),s=i.parentId?n.get(i.parentId):void 0,{x:l,y:c}=s?s.internals.positionAbsolute:{x:0,y:0},d=i.origin??r;let u=o;if(i.extent==="parent"&&!i.expandParent)if(!s)a==null||a("005",Mn.error005());else{const p=s.measured.width,y=s.measured.height;p&&y&&(u=[[l,c],[l+p,c+y]])}else s&&Kr(i.extent)&&(u=[[i.extent[0][0]+l,i.extent[0][1]+c],[i.extent[1][0]+l,i.extent[1][1]+c]]);const h=Kr(u)?lr(e,u,i.measured):e;return{position:{x:h.x-l+i.measured.width*d[0],y:h.y-c+i.measured.height*d[1]},positionAbsolute:h}}async function _5({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:o}){const a=new Set(t.map(u=>u.id)),i=[];for(const u of n){if(u.deletable===!1)continue;const h=a.has(u.id),p=!h&&u.parentId&&i.find(y=>y.id===u.parentId);(h||p)&&i.push(u)}const s=new Set(e.map(u=>u.id)),l=r.filter(u=>u.deletable!==!1),c=E5(i,l);for(const u of l)s.has(u.id)&&!c.find(h=>h.id===u.id)&&c.push(u);if(!o)return{edges:c,nodes:i};const d=await o({nodes:i,edges:c});return typeof d=="boolean"?d?{edges:c,nodes:i}:{edges:[],nodes:[]}:d}const qr=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),lr=(t={x:0,y:0},e,n)=>({x:qr(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:qr(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function aE(t,e,n){const{width:r,height:o}=Cn(n),{x:a,y:i}=n.internals.positionAbsolute;return lr(t,[[a,i],[a+r,i+o]],e)}const iE=(t,e,n)=>t<e?qr(Math.abs(t-e),1,e)/e:t>n?-qr(Math.abs(t-n),1,e)/e:0,sE=(t,e,n=15,r=40)=>{const o=iE(t.x,r,e.width-r)*n,a=iE(t.y,r,e.height-r)*n;return[o,a]},gs=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),hp=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),vs=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),Qr=(t,e=[0,0])=>{var o,a;const{x:n,y:r}=cp(t)?t.internals.positionAbsolute:ya(t,e);return{x:n,y:r,width:((o=t.measured)==null?void 0:o.width)??t.width??t.initialWidth??0,height:((a=t.measured)==null?void 0:a.height)??t.height??t.initialHeight??0}},xs=(t,e=[0,0])=>{var o,a;const{x:n,y:r}=cp(t)?t.internals.positionAbsolute:ya(t,e);return{x:n,y:r,x2:n+(((o=t.measured)==null?void 0:o.width)??t.width??t.initialWidth??0),y2:r+(((a=t.measured)==null?void 0:a.height)??t.height??t.initialHeight??0)}},lE=(t,e)=>vs(gs(hp(t),hp(e))),va=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},cE=t=>Ht(t.width)&&Ht(t.height)&&Ht(t.x)&&Ht(t.y),Ht=t=>!isNaN(t)&&isFinite(t),M5=(t,e)=>{},bs=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),xa=({x:t,y:e},[n,r,o],a=!1,i=[1,1])=>{const s={x:(t-n)/o,y:(e-r)/o};return a?bs(s,i):s},uE=({x:t,y:e},[n,r,o])=>({x:t*o+n,y:e*o+r}),pp=(t,e,n,r,o,a)=>{const i=e/(t.width*(1+a)),s=n/(t.height*(1+a)),l=Math.min(i,s),c=qr(l,r,o),d=t.x+t.width/2,u=t.y+t.height/2,h=e/2-d*c,p=n/2-u*c;return{x:h,y:p,zoom:c}},ws=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function Kr(t){return t!==void 0&&t!=="parent"}function Cn(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function dE(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function hE(t,e={width:0,height:0},n,r,o){const a={...t},i=r.get(n);if(i){const s=i.origin||o;a.x+=i.internals.positionAbsolute.x-(e.width??0)*s[0],a.y+=i.internals.positionAbsolute.y-(e.height??0)*s[1]}return a}function ba(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:o}){const{x:a,y:i}=Nn(t),s=xa({x:a-((o==null?void 0:o.left)??0),y:i-((o==null?void 0:o.top)??0)},r),{x:l,y:c}=n?bs(s,e):s;return{xSnapped:l,ySnapped:c,...s}}const Es=t=>({width:t.offsetWidth,height:t.offsetHeight}),pE=t=>{var e;return((e=t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},C5=["INPUT","SELECT","TEXTAREA"];function fp(t){var n,r;const e=((r=(n=t.composedPath)==null?void 0:n.call(t))==null?void 0:r[0])||t.target;return C5.includes(e==null?void 0:e.nodeName)||(e==null?void 0:e.hasAttribute("contenteditable"))||!!(e!=null&&e.closest(".nokey"))}const fE=t=>"clientX"in t,Nn=(t,e)=>{var a,i;const n=fE(t),r=n?t.clientX:(a=t.touches)==null?void 0:a[0].clientX,o=n?t.clientY:(i=t.touches)==null?void 0:i[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:o-((e==null?void 0:e.top)??0)}},mE=(t,e,n,r,o)=>{const a=e.querySelectorAll(`.${t}`);return!a||!a.length?null:Array.from(a).map(i=>{const s=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:t,nodeId:o,position:i.getAttribute("data-handlepos"),x:(s.left-n.left)/r,y:(s.top-n.top)/r,...Es(i)}})};function yE({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:o,sourceControlY:a,targetControlX:i,targetControlY:s}){const l=t*.125+o*.375+i*.375+n*.125,c=e*.125+a*.375+s*.375+r*.125,d=Math.abs(l-t),u=Math.abs(c-e);return[l,c,d,u]}function _s(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function gE({pos:t,x1:e,y1:n,x2:r,y2:o,c:a}){switch(t){case xe.Left:return[e-_s(e-r,a),n];case xe.Right:return[e+_s(r-e,a),n];case xe.Top:return[e,n-_s(n-o,a)];case xe.Bottom:return[e,n+_s(o-n,a)]}}function vE({sourceX:t,sourceY:e,sourcePosition:n=xe.Bottom,targetX:r,targetY:o,targetPosition:a=xe.Top,curvature:i=.25}){const[s,l]=gE({pos:n,x1:t,y1:e,x2:r,y2:o,c:i}),[c,d]=gE({pos:a,x1:r,y1:o,x2:t,y2:e,c:i}),[u,h,p,y]=yE({sourceX:t,sourceY:e,targetX:r,targetY:o,sourceControlX:s,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${t},${e} C${s},${l} ${c},${d} ${r},${o}`,u,h,p,y]}function xE({sourceX:t,sourceY:e,targetX:n,targetY:r}){const o=Math.abs(n-t)/2,a=n<t?n+o:n-o,i=Math.abs(r-e)/2,s=r<e?r+i:r-i;return[a,s,o,i]}function N5({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:o=!1}){if(!o)return r;const a=n||e.selected||t.selected,i=Math.max(t.internals.z||0,e.internals.z||0,1e3);return r+(a?i:0)}function S5({sourceNode:t,targetNode:e,width:n,height:r,transform:o}){const a=gs(xs(t),xs(e));a.x===a.x2&&(a.x2+=1),a.y===a.y2&&(a.y2+=1);const i={x:-o[0]/o[2],y:-o[1]/o[2],width:n/o[2],height:r/o[2]};return va(i,vs(a))>0}const O5=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,A5=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),bE=(t,e)=>{if(!t.source||!t.target)return e;let n;return nE(t)?n={...t}:n={...t,id:O5(t)},A5(n,e)?e:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,e.concat(n))};function wE({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[o,a,i,s]=xE({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,o,a,i,s]}const EE={[xe.Left]:{x:-1,y:0},[xe.Right]:{x:1,y:0},[xe.Top]:{x:0,y:-1},[xe.Bottom]:{x:0,y:1}},k5=({source:t,sourcePosition:e=xe.Bottom,target:n})=>e===xe.Left||e===xe.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},_E=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function j5({source:t,sourcePosition:e=xe.Bottom,target:n,targetPosition:r=xe.Top,center:o,offset:a}){const i=EE[e],s=EE[r],l={x:t.x+i.x*a,y:t.y+i.y*a},c={x:n.x+s.x*a,y:n.y+s.y*a},d=k5({source:l,sourcePosition:e,target:c}),u=d.x!==0?"x":"y",h=d[u];let p=[],y,f;const v={x:0,y:0},g={x:0,y:0},[b,w,E,M]=xE({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(i[u]*s[u]===-1){y=o.x??b,f=o.y??w;const S=[{x:y,y:l.y},{x:y,y:c.y}],N=[{x:l.x,y:f},{x:c.x,y:f}];i[u]===h?p=u==="x"?S:N:p=u==="x"?N:S}else{const S=[{x:l.x,y:c.y}],N=[{x:c.x,y:l.y}];if(u==="x"?p=i.x===h?N:S:p=i.y===h?S:N,e===r){const B=Math.abs(t[u]-n[u]);if(B<=a){const L=Math.min(a-1,a-B);i[u]===h?v[u]=(l[u]>t[u]?-1:1)*L:g[u]=(c[u]>n[u]?-1:1)*L}}if(e!==r){const B=u==="x"?"y":"x",L=i[u]===s[B],C=l[B]>c[B],P=l[B]<c[B];(i[u]===1&&(!L&&C||L&&P)||i[u]!==1&&(!L&&P||L&&C))&&(p=u==="x"?S:N)}const _={x:l.x+v.x,y:l.y+v.y},O={x:c.x+g.x,y:c.y+g.y},k=Math.max(Math.abs(_.x-p[0].x),Math.abs(O.x-p[0].x)),I=Math.max(Math.abs(_.y-p[0].y),Math.abs(O.y-p[0].y));k>=I?(y=(_.x+O.x)/2,f=p[0].y):(y=p[0].x,f=(_.y+O.y)/2)}return[[t,{x:l.x+v.x,y:l.y+v.y},...p,{x:c.x+g.x,y:c.y+g.y},n],y,f,E,M]}function R5(t,e,n,r){const o=Math.min(_E(t,e)/2,_E(e,n)/2,r),{x:a,y:i}=e;if(t.x===a&&a===n.x||t.y===i&&i===n.y)return`L${a} ${i}`;if(t.y===i){const c=t.x<n.x?-1:1,d=t.y<n.y?1:-1;return`L ${a+o*c},${i}Q ${a},${i} ${a},${i+o*d}`}const s=t.x<n.x?1:-1,l=t.y<n.y?-1:1;return`L ${a},${i+o*l}Q ${a},${i} ${a+o*s},${i}`}function mp({sourceX:t,sourceY:e,sourcePosition:n=xe.Bottom,targetX:r,targetY:o,targetPosition:a=xe.Top,borderRadius:i=5,centerX:s,centerY:l,offset:c=20}){const[d,u,h,p,y]=j5({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:o},targetPosition:a,center:{x:s,y:l},offset:c});return[d.reduce((f,v,g)=>{let b="";return g>0&&g<d.length-1?b=R5(d[g-1],v,d[g+1],i):b=`${g===0?"M":"L"}${v.x} ${v.y}`,f+=b,f},""),u,h,p,y]}function ME(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function P5(t){var u;const{sourceNode:e,targetNode:n}=t;if(!ME(e)||!ME(n))return null;const r=e.internals.handleBounds||CE(e.handles),o=n.internals.handleBounds||CE(n.handles),a=NE((r==null?void 0:r.source)??[],t.sourceHandle),i=NE(t.connectionMode===Hr.Strict?(o==null?void 0:o.target)??[]:((o==null?void 0:o.target)??[]).concat((o==null?void 0:o.source)??[]),t.targetHandle);if(!a||!i)return(u=t.onError)==null||u.call(t,"008",Mn.error008(a?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const s=(a==null?void 0:a.position)||xe.Bottom,l=(i==null?void 0:i.position)||xe.Top,c=wa(e,a,s),d=wa(n,i,l);return{sourceX:c.x,sourceY:c.y,targetX:d.x,targetY:d.y,sourcePosition:s,targetPosition:l}}function CE(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function wa(t,e,n=xe.Left,r=!1){const o=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,a=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:i,height:s}=e??Cn(t);if(r)return{x:o+i/2,y:a+s/2};switch((e==null?void 0:e.position)??n){case xe.Top:return{x:o+i/2,y:a};case xe.Right:return{x:o+i,y:a+s/2};case xe.Bottom:return{x:o+i/2,y:a+s};case xe.Left:return{x:o,y:a+s/2}}}function NE(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function yp(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(n=>`${n}=${t[n]}`).join("&")}`:""}function T5(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:o}){const a=new Set;return t.reduce((i,s)=>([s.markerStart||r,s.markerEnd||o].forEach(l=>{if(l&&typeof l=="object"){const c=yp(l,e);a.has(c)||(i.push({id:c,color:l.color||n,...l}),a.add(c))}}),i),[]).sort((i,s)=>i.id.localeCompare(s.id))}const gp={nodeOrigin:[0,0],nodeExtent:fa,elevateNodesOnSelect:!0,defaults:{}},I5={...gp,checkEquality:!0};function vp(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function D5(t,e,n){const r=vp(gp,n);for(const o of t.values())if(o.parentId)bp(o,t,e,r);else{const a=ya(o,r.nodeOrigin),i=Kr(o.extent)?o.extent:r.nodeExtent,s=lr(a,i,Cn(o));o.internals.positionAbsolute=s}}function xp(t,e,n,r){var s,l;const o=vp(I5,r),a=new Map(e),i=o!=null&&o.elevateNodesOnSelect?1e3:0;e.clear(),n.clear();for(const c of t){let d=a.get(c.id);if(o.checkEquality&&c===(d==null?void 0:d.internals.userNode))e.set(c.id,d);else{const u=ya(c,o.nodeOrigin),h=Kr(c.extent)?c.extent:o.nodeExtent,p=lr(u,h,Cn(c));d={...o.defaults,...c,measured:{width:(s=c.measured)==null?void 0:s.width,height:(l=c.measured)==null?void 0:l.height},internals:{positionAbsolute:p,handleBounds:c.measured?d==null?void 0:d.internals.handleBounds:void 0,z:SE(c,i),userNode:c}},e.set(c.id,d)}c.parentId&&bp(d,e,n,r)}}function L5(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function bp(t,e,n,r){const{elevateNodesOnSelect:o,nodeOrigin:a,nodeExtent:i}=vp(gp,r),s=t.parentId,l=e.get(s);if(!l){console.warn(`Parent node ${s} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}L5(t,n);const c=o?1e3:0,{x:d,y:u,z:h}=$5(t,l,a,i,c),{positionAbsolute:p}=t.internals,y=d!==p.x||u!==p.y;(y||h!==t.internals.z)&&(t.internals={...t.internals,positionAbsolute:y?{x:d,y:u}:p,z:h})}function SE(t,e){return(Ht(t.zIndex)?t.zIndex:0)+(t.selected?e:0)}function $5(t,e,n,r,o){const{x:a,y:i}=e.internals.positionAbsolute,s=Cn(t),l=ya(t,n),c=Kr(t.extent)?lr(l,t.extent,s):l;let d=lr({x:a+c.x,y:i+c.y},r,s);t.extent==="parent"&&(d=aE(d,s,e));const u=SE(t,o),h=e.internals.z??0;return{x:d.x,y:d.y,z:h>u?h:u}}function wp(t,e,n,r=[0,0]){var i;const o=[],a=new Map;for(const s of t){const l=e.get(s.parentId);if(!l)continue;const c=((i=a.get(s.parentId))==null?void 0:i.expandedRect)??Qr(l),d=lE(c,s.rect);a.set(s.parentId,{expandedRect:d,parent:l})}return a.size>0&&a.forEach(({expandedRect:s,parent:l},c)=>{var w;const d=l.internals.positionAbsolute,u=Cn(l),h=l.origin??r,p=s.x<d.x?Math.round(Math.abs(d.x-s.x)):0,y=s.y<d.y?Math.round(Math.abs(d.y-s.y)):0,f=Math.max(u.width,Math.round(s.width)),v=Math.max(u.height,Math.round(s.height)),g=(f-u.width)*h[0],b=(v-u.height)*h[1];(p>0||y>0||g||b)&&(o.push({id:c,type:"position",position:{x:l.position.x-p+g,y:l.position.y-y+b}}),(w=n.get(c))==null||w.forEach(E=>{t.some(M=>M.id===E.id)||o.push({id:E.id,type:"position",position:{x:E.position.x+p,y:E.position.y+y}})})),(u.width<s.width||u.height<s.height||p||y)&&o.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:f+(p?h[0]*p-g:0),height:v+(y?h[1]*y-b:0)}})}),o}function B5(t,e,n,r,o,a){const i=r==null?void 0:r.querySelector(".xyflow__viewport");let s=!1;if(!i)return{changes:[],updatedInternals:s};const l=[],c=window.getComputedStyle(i),{m22:d}=new window.DOMMatrixReadOnly(c.transform),u=[];for(const h of t.values()){const p=e.get(h.id);if(p)if(p.hidden)p.internals={...p.internals,handleBounds:void 0},s=!0;else{const y=Es(h.nodeElement),f=p.measured.width!==y.width||p.measured.height!==y.height;if(y.width&&y.height&&(f||!p.internals.handleBounds||h.force)){const v=h.nodeElement.getBoundingClientRect(),g=Kr(p.extent)?p.extent:a;let{positionAbsolute:b}=p.internals;p.parentId&&p.extent==="parent"?b=aE(b,y,e.get(p.parentId)):g&&(b=lr(b,g,y)),p.measured=y,p.internals={...p.internals,positionAbsolute:b,handleBounds:{source:mE("source",h.nodeElement,v,d,p.id),target:mE("target",h.nodeElement,v,d,p.id)}},p.parentId&&bp(p,e,n,{nodeOrigin:o}),s=!0,f&&(l.push({id:p.id,type:"dimensions",dimensions:y}),p.expandParent&&p.parentId&&u.push({id:p.id,parentId:p.parentId,rect:Qr(p,o)}))}}}if(u.length>0){const h=wp(u,e,n,o);l.push(...h)}return{changes:l,updatedInternals:s}}async function F5({delta:t,panZoom:e,transform:n,translateExtent:r,width:o,height:a}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const i=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[o,a]],r),s=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(s)}function OE(t,e,n){t.clear(),e.clear();for(const r of n){const{source:o,target:a,sourceHandle:i=null,targetHandle:s=null}=r,l=`${o}-source-${i}`,c=`${a}-target-${s}`,d=t.get(l)||new Map,u=t.get(c)||new Map,h={edgeId:r.id,source:o,target:a,sourceHandle:i,targetHandle:s};e.set(r.id,r),t.set(l,d.set(`${a}-${s}`,h)),t.set(c,u.set(`${o}-${i}`,h))}}function AE(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:AE(n,e):!1}function kE(t,e,n){let r=t;do{if(r!=null&&r.matches(e))return!0;if(r===n)return!1;r=r.parentElement}while(r);return!1}function z5(t,e,n,r){const o=new Map;for(const[a,i]of t)if((i.selected||i.id===r)&&(!i.parentId||!AE(i,t))&&(i.draggable||e&&typeof i.draggable>"u")){const s=t.get(a);s&&o.set(a,{id:a,position:s.position||{x:0,y:0},distance:{x:n.x-s.internals.positionAbsolute.x,y:n.y-s.internals.positionAbsolute.y},extent:s.extent,parentId:s.parentId,origin:s.origin,expandParent:s.expandParent,internals:{positionAbsolute:s.internals.positionAbsolute||{x:0,y:0}},measured:{width:s.measured.width??0,height:s.measured.height??0}})}return o}function Ep({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var i,s,l;const o=[];for(const[c,d]of e){const u=(i=n.get(c))==null?void 0:i.internals.userNode;u&&o.push({...u,position:d.position,dragging:r})}if(!t)return[o[0],o];const a=(s=n.get(t))==null?void 0:s.internals.userNode;return[a?{...a,position:((l=e.get(t))==null?void 0:l.position)||a.position,dragging:r}:o[0],o]}function V5({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:o}){let a={x:null,y:null},i=0,s=new Map,l=!1,c={x:0,y:0},d=null,u=!1,h=null,p=!1;function y({noDragClassName:v,handleSelector:g,domNode:b,isSelectable:w,nodeId:E,nodeClickDistance:M=0}){h=Ot(b);function S({x:k,y:I},B){const{nodeLookup:L,nodeExtent:C,snapGrid:P,snapToGrid:j,nodeOrigin:D,onNodeDrag:R,onSelectionDrag:A,onError:V,updateNodePositions:q}=e();a={x:k,y:I};let Y=!1,H={x:0,y:0,x2:0,y2:0};if(s.size>1&&C){const G=ga(s);H=hp(G)}for(const[G,Z]of s){if(!L.has(G))continue;let J={x:k-Z.distance.x,y:I-Z.distance.y};j&&(J=bs(J,P));let ce=[[C[0][0],C[0][1]],[C[1][0],C[1][1]]];if(s.size>1&&C&&!Z.extent){const{positionAbsolute:re}=Z.internals,ie=re.x-H.x+C[0][0],X=re.x+Z.measured.width-H.x2+C[1][0],oe=re.y-H.y+C[0][1],he=re.y+Z.measured.height-H.y2+C[1][1];ce=[[ie,oe],[X,he]]}const{position:U,positionAbsolute:te}=oE({nodeId:G,nextPosition:J,nodeLookup:L,nodeExtent:ce,nodeOrigin:D,onError:V});Y=Y||Z.position.x!==U.x||Z.position.y!==U.y,Z.position=U,Z.internals.positionAbsolute=te}if(Y&&(q(s,!0),B&&(r||R||!E&&A))){const[G,Z]=Ep({nodeId:E,dragItems:s,nodeLookup:L});r==null||r(B,s,G,Z),R==null||R(B,G,Z),E||(A==null||A(B,Z))}}async function N(){if(!d)return;const{transform:k,panBy:I,autoPanSpeed:B}=e(),[L,C]=sE(c,d,B);(L!==0||C!==0)&&(a.x=(a.x??0)-L/k[2],a.y=(a.y??0)-C/k[2],await I({x:L,y:C})&&S(a,null)),i=requestAnimationFrame(N)}function _(k){var Y;const{nodeLookup:I,multiSelectionActive:B,nodesDraggable:L,transform:C,snapGrid:P,snapToGrid:j,selectNodesOnDrag:D,onNodeDragStart:R,onSelectionDragStart:A,unselectNodesAndEdges:V}=e();u=!0,(!D||!w)&&!B&&E&&((Y=I.get(E))!=null&&Y.selected||V()),w&&D&&E&&(t==null||t(E));const q=ba(k.sourceEvent,{transform:C,snapGrid:P,snapToGrid:j,containerBounds:d});if(a=q,s=z5(I,L,q,E),s.size>0&&(n||R||!E&&A)){const[H,G]=Ep({nodeId:E,dragItems:s,nodeLookup:I});n==null||n(k.sourceEvent,s,H,G),R==null||R(k.sourceEvent,H,G),E||(A==null||A(k.sourceEvent,G))}}const O=b1().clickDistance(M).on("start",k=>{const{domNode:I,nodeDragThreshold:B,transform:L,snapGrid:C,snapToGrid:P}=e();d=(I==null?void 0:I.getBoundingClientRect())||null,p=!1,B===0&&_(k),a=ba(k.sourceEvent,{transform:L,snapGrid:C,snapToGrid:P,containerBounds:d}),c=Nn(k.sourceEvent,d)}).on("drag",k=>{const{autoPanOnNodeDrag:I,transform:B,snapGrid:L,snapToGrid:C,nodeDragThreshold:P,nodeLookup:j}=e(),D=ba(k.sourceEvent,{transform:B,snapGrid:L,snapToGrid:C,containerBounds:d});if((k.sourceEvent.type==="touchmove"&&k.sourceEvent.touches.length>1||E&&!j.has(E))&&(p=!0),!p){if(!l&&I&&u&&(l=!0,N()),!u){const R=D.xSnapped-(a.x??0),A=D.ySnapped-(a.y??0);Math.sqrt(R*R+A*A)>P&&_(k)}(a.x!==D.xSnapped||a.y!==D.ySnapped)&&s&&u&&(c=Nn(k.sourceEvent,d),S(D,k.sourceEvent))}}).on("end",k=>{if(!(!u||p)&&(l=!1,u=!1,cancelAnimationFrame(i),s.size>0)){const{nodeLookup:I,updateNodePositions:B,onNodeDragStop:L,onSelectionDragStop:C}=e();if(B(s,!1),o||L||!E&&C){const[P,j]=Ep({nodeId:E,dragItems:s,nodeLookup:I,dragging:!1});o==null||o(k.sourceEvent,s,P,j),L==null||L(k.sourceEvent,P,j),E||(C==null||C(k.sourceEvent,j))}}}).filter(k=>{const I=k.target;return!k.button&&(!v||!kE(I,`.${v}`,b))&&(!g||kE(I,g,b))});h.call(O)}function f(){h==null||h.on(".drag",null)}return{update:y,destroy:f}}function W5(t,e,n){const r=[],o={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const a of e.values())va(o,Qr(a))>0&&r.push(a);return r}const U5=250;function H5(t,e,n,r){var s,l;let o=[],a=1/0;const i=W5(t,n,e+U5);for(const c of i){const d=[...((s=c.internals.handleBounds)==null?void 0:s.source)??[],...((l=c.internals.handleBounds)==null?void 0:l.target)??[]];for(const u of d){if(r.nodeId===u.nodeId&&r.type===u.type&&r.id===u.id)continue;const{x:h,y:p}=wa(c,u,u.position,!0),y=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(p-t.y,2));y>e||(y<a?(o=[{...u,x:h,y:p}],a=y):y===a&&o.push({...u,x:h,y:p}))}}if(!o.length)return null;if(o.length>1){const c=r.type==="source"?"target":"source";return o.find(d=>d.type===c)??o[0]}return o[0]}function jE(t,e,n,r,o,a=!1){var c,d,u;const i=r.get(t);if(!i)return null;const s=o==="strict"?(c=i.internals.handleBounds)==null?void 0:c[e]:[...((d=i.internals.handleBounds)==null?void 0:d.source)??[],...((u=i.internals.handleBounds)==null?void 0:u.target)??[]],l=(n?s==null?void 0:s.find(h=>h.id===n):s==null?void 0:s[0])??null;return l&&a?{...l,...wa(i,l,l.position,!0)}:l}function RE(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function q5(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const PE=()=>!0;function Q5(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:o,edgeUpdaterType:a,isTarget:i,domNode:s,nodeLookup:l,lib:c,autoPanOnConnect:d,flowId:u,panBy:h,cancelConnection:p,onConnectStart:y,onConnect:f,onConnectEnd:v,isValidConnection:g=PE,onReconnectEnd:b,updateConnection:w,getTransform:E,getFromHandle:M,autoPanSpeed:S}){const N=pE(t.target);let _=0,O;const{x:k,y:I}=Nn(t),B=N==null?void 0:N.elementFromPoint(k,I),L=RE(a,B),C=s==null?void 0:s.getBoundingClientRect();if(!C||!L)return;const P=jE(o,L,r,l,e);if(!P)return;let j=Nn(t,C),D=!1,R=null,A=!1,V=null;function q(){if(!d||!C)return;const[U,te]=sE(j,C,S);h({x:U,y:te}),_=requestAnimationFrame(q)}const Y={...P,nodeId:o,type:L,position:P.position},H=l.get(o),G={inProgress:!0,isValid:null,from:wa(H,Y,xe.Left,!0),fromHandle:Y,fromPosition:Y.position,fromNode:H,to:j,toHandle:null,toPosition:J1[Y.position],toNode:null};w(G);let Z=G;y==null||y(t,{nodeId:o,handleId:r,handleType:L});function J(U){if(!M()||!Y){ce(U);return}const te=E();j=Nn(U,C),O=H5(xa(j,te,!1,[1,1]),n,l,Y),D||(q(),D=!0);const re=TE(U,{handle:O,connectionMode:e,fromNodeId:o,fromHandleId:r,fromType:i?"target":"source",isValidConnection:g,doc:N,lib:c,flowId:u,nodeLookup:l});V=re.handleDomNode,R=re.connection,A=q5(!!O,re.isValid);const ie={...Z,isValid:A,to:O&&A?uE({x:O.x,y:O.y},te):j,toHandle:re.toHandle,toPosition:A&&re.toHandle?re.toHandle.position:J1[Y.position],toNode:re.toHandle?l.get(re.toHandle.nodeId):null};A&&O&&Z.toHandle&&ie.toHandle&&Z.toHandle.type===ie.toHandle.type&&Z.toHandle.nodeId===ie.toHandle.nodeId&&Z.toHandle.id===ie.toHandle.id&&Z.to.x===ie.to.x&&Z.to.y===ie.to.y||(w(ie),Z=ie)}function ce(U){(O||V)&&R&&A&&(f==null||f(R));const{inProgress:te,...re}=Z,ie={...re,toPosition:Z.toHandle?Z.toPosition:null};v==null||v(U,ie),a&&(b==null||b(U,ie)),p(),cancelAnimationFrame(_),D=!1,A=!1,R=null,V=null,N.removeEventListener("mousemove",J),N.removeEventListener("mouseup",ce),N.removeEventListener("touchmove",J),N.removeEventListener("touchend",ce)}N.addEventListener("mousemove",J),N.addEventListener("mouseup",ce),N.addEventListener("touchmove",J),N.addEventListener("touchend",ce)}function TE(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:o,fromType:a,doc:i,lib:s,flowId:l,isValidConnection:c=PE,nodeLookup:d}){const u=a==="target",h=e?i.querySelector(`.${s}-flow__handle[data-id="${l}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:p,y}=Nn(t),f=i.elementFromPoint(p,y),v=f!=null&&f.classList.contains(`${s}-flow__handle`)?f:h,g={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const b=RE(void 0,v),w=v.getAttribute("data-nodeid"),E=v.getAttribute("data-handleid"),M=v.classList.contains("connectable"),S=v.classList.contains("connectableend");if(!w||!b)return g;const N={source:u?w:r,sourceHandle:u?E:o,target:u?r:w,targetHandle:u?o:E};g.connection=N;const _=M&&S&&(n===Hr.Strict?u&&b==="source"||!u&&b==="target":w!==r||E!==o);g.isValid=_&&c(N),g.toHandle=jE(w,b,E,d,n,!1)}return g}const _p={onPointerDown:Q5,isValid:TE};function K5({domNode:t,panZoom:e,getTransform:n,getViewScale:r}){const o=Ot(t);function a({translateExtent:s,width:l,height:c,zoomStep:d=10,pannable:u=!0,zoomable:h=!0,inversePan:p=!1}){const y=w=>{const E=n();if(w.sourceEvent.type!=="wheel"||!e)return;const M=-w.sourceEvent.deltaY*(w.sourceEvent.deltaMode===1?.05:w.sourceEvent.deltaMode?1:.002)*d,S=E[2]*Math.pow(2,M);e.scaleTo(S)};let f=[0,0];const v=w=>{(w.sourceEvent.type==="mousedown"||w.sourceEvent.type==="touchstart")&&(f=[w.sourceEvent.clientX??w.sourceEvent.touches[0].clientX,w.sourceEvent.clientY??w.sourceEvent.touches[0].clientY])},g=w=>{const E=n();if(w.sourceEvent.type!=="mousemove"&&w.sourceEvent.type!=="touchmove"||!e)return;const M=[w.sourceEvent.clientX??w.sourceEvent.touches[0].clientX,w.sourceEvent.clientY??w.sourceEvent.touches[0].clientY],S=[M[0]-f[0],M[1]-f[1]];f=M;const N=r()*Math.max(E[2],Math.log(E[2]))*(p?-1:1),_={x:E[0]-S[0]*N,y:E[1]-S[1]*N},O=[[0,0],[l,c]];e.setViewportConstrained({x:_.x,y:_.y,zoom:E[2]},O,s)},b=X1().on("start",v).on("zoom",u?g:null).on("zoom.wheel",h?y:null);o.call(b,{})}function i(){o.on("zoom",null)}return{update:a,destroy:i,pointer:Vt}}const Y5=(t,e)=>t.x!==e.x||t.y!==e.y||t.zoom!==e.k,Ms=t=>({x:t.x,y:t.y,zoom:t.k}),Mp=({x:t,y:e,zoom:n})=>ms.translate(t,e).scale(n),Yr=(t,e)=>t.target.closest(`.${e}`),IE=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),Cp=(t,e=0,n=()=>{})=>{const r=typeof e=="number"&&e>0;return r||n(),r?t.transition().duration(e).on("end",n):t},DE=t=>{const e=t.ctrlKey&&ws()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function X5({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:o,panOnScrollSpeed:a,zoomOnPinch:i,onPanZoomStart:s,onPanZoom:l,onPanZoomEnd:c}){return d=>{if(Yr(d,e))return!1;d.preventDefault(),d.stopImmediatePropagation();const u=n.property("__zoom").k||1;if(d.ctrlKey&&i){const v=Vt(d),g=DE(d),b=u*Math.pow(2,g);r.scaleTo(n,b,v,d);return}const h=d.deltaMode===1?20:1;let p=o===Xn.Vertical?0:d.deltaX*h,y=o===Xn.Horizontal?0:d.deltaY*h;!ws()&&d.shiftKey&&o!==Xn.Vertical&&(p=d.deltaY*h,y=0),r.translateBy(n,-(p/u)*a,-(y/u)*a,{internal:!0});const f=Ms(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling||(t.isPanScrolling=!0,s==null||s(d,f)),t.isPanScrolling&&(l==null||l(d,f),t.panScrollTimeout=setTimeout(()=>{c==null||c(d,f),t.isPanScrolling=!1},150))}}function Z5({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,o){if(!e&&r.type==="wheel"&&!r.ctrlKey||Yr(r,t))return null;r.preventDefault(),n.call(this,r,o)}}function G5({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var a,i,s;if((a=r.sourceEvent)!=null&&a.internal)return;const o=Ms(r.transform);t.mouseButton=((i=r.sourceEvent)==null?void 0:i.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=o,((s=r.sourceEvent)==null?void 0:s.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,o))}}function J5({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:o}){return a=>{var i,s;t.usedRightMouseButton=!!(n&&IE(e,t.mouseButton??0)),(i=a.sourceEvent)!=null&&i.sync||r([a.transform.x,a.transform.y,a.transform.k]),o&&!((s=a.sourceEvent)!=null&&s.internal)&&(o==null||o(a.sourceEvent,Ms(a.transform)))}}function e4({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:o,onPaneContextMenu:a}){return i=>{var s;if(!((s=i.sourceEvent)!=null&&s.internal)&&(t.isZoomingOrPanning=!1,a&&IE(e,t.mouseButton??0)&&!t.usedRightMouseButton&&i.sourceEvent&&a(i.sourceEvent),t.usedRightMouseButton=!1,r(!1),o&&Y5(t.prevViewport,i.transform))){const l=Ms(i.transform);t.prevViewport=l,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{o==null||o(i.sourceEvent,l)},n?150:0)}}}function t4({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:o,zoomOnDoubleClick:a,userSelectionActive:i,noWheelClassName:s,noPanClassName:l,lib:c}){return d=>{var y;const u=t||e,h=n&&d.ctrlKey;if(d.button===1&&d.type==="mousedown"&&(Yr(d,`${c}-flow__node`)||Yr(d,`${c}-flow__edge`)))return!0;if(!r&&!u&&!o&&!a&&!n||i||Yr(d,s)&&d.type==="wheel"||Yr(d,l)&&(d.type!=="wheel"||o&&d.type==="wheel"&&!t)||!n&&d.ctrlKey&&d.type==="wheel")return!1;if(!n&&d.type==="touchstart"&&((y=d.touches)==null?void 0:y.length)>1)return d.preventDefault(),!1;if(!u&&!o&&!h&&d.type==="wheel"||!r&&(d.type==="mousedown"||d.type==="touchstart")||Array.isArray(r)&&!r.includes(d.button)&&d.type==="mousedown")return!1;const p=Array.isArray(r)&&r.includes(d.button)||!d.button||d.button<=1;return(!d.ctrlKey||d.type==="wheel")&&p}}function n4({domNode:t,minZoom:e,maxZoom:n,paneClickDistance:r,translateExtent:o,viewport:a,onPanZoom:i,onPanZoomStart:s,onPanZoomEnd:l,onDraggingChange:c}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},u=t.getBoundingClientRect(),h=X1().clickDistance(!Ht(r)||r<0?0:r).scaleExtent([e,n]).translateExtent(o),p=Ot(t).call(h);w({x:a.x,y:a.y,zoom:qr(a.zoom,e,n)},[[0,0],[u.width,u.height]],o);const y=p.on("wheel.zoom"),f=p.on("dblclick.zoom");h.wheelDelta(DE);function v(B,L){return p?new Promise(C=>{h==null||h.transform(Cp(p,L==null?void 0:L.duration,()=>C(!0)),B)}):Promise.resolve(!1)}function g({noWheelClassName:B,noPanClassName:L,onPaneContextMenu:C,userSelectionActive:P,panOnScroll:j,panOnDrag:D,panOnScrollMode:R,panOnScrollSpeed:A,preventScrolling:V,zoomOnPinch:q,zoomOnScroll:Y,zoomOnDoubleClick:H,zoomActivationKeyPressed:G,lib:Z,onTransformChange:J}){P&&!d.isZoomingOrPanning&&b();const ce=j&&!G&&!P?X5({zoomPanValues:d,noWheelClassName:B,d3Selection:p,d3Zoom:h,panOnScrollMode:R,panOnScrollSpeed:A,zoomOnPinch:q,onPanZoomStart:s,onPanZoom:i,onPanZoomEnd:l}):Z5({noWheelClassName:B,preventScrolling:V,d3ZoomHandler:y});if(p.on("wheel.zoom",ce,{passive:!1}),!P){const te=G5({zoomPanValues:d,onDraggingChange:c,onPanZoomStart:s});h.on("start",te);const re=J5({zoomPanValues:d,panOnDrag:D,onPaneContextMenu:!!C,onPanZoom:i,onTransformChange:J});h.on("zoom",re);const ie=e4({zoomPanValues:d,panOnDrag:D,panOnScroll:j,onPaneContextMenu:C,onPanZoomEnd:l,onDraggingChange:c});h.on("end",ie)}const U=t4({zoomActivationKeyPressed:G,panOnDrag:D,zoomOnScroll:Y,panOnScroll:j,zoomOnDoubleClick:H,zoomOnPinch:q,userSelectionActive:P,noPanClassName:L,noWheelClassName:B,lib:Z});h.filter(U),H?p.on("dblclick.zoom",f):p.on("dblclick.zoom",null)}function b(){h.on("zoom",null)}async function w(B,L,C){const P=Mp(B),j=h==null?void 0:h.constrain()(P,L,C);return j&&await v(j),new Promise(D=>D(j))}async function E(B,L){const C=Mp(B);return await v(C,L),new Promise(P=>P(C))}function M(B){if(p){const L=Mp(B),C=p.property("__zoom");(C.k!==B.zoom||C.x!==B.x||C.y!==B.y)&&(h==null||h.transform(p,L,null,{sync:!0}))}}function S(){const B=p?K1(p.node()):{x:0,y:0,k:1};return{x:B.x,y:B.y,zoom:B.k}}function N(B,L){return p?new Promise(C=>{h==null||h.scaleTo(Cp(p,L==null?void 0:L.duration,()=>C(!0)),B)}):Promise.resolve(!1)}function _(B,L){return p?new Promise(C=>{h==null||h.scaleBy(Cp(p,L==null?void 0:L.duration,()=>C(!0)),B)}):Promise.resolve(!1)}function O(B){h==null||h.scaleExtent(B)}function k(B){h==null||h.translateExtent(B)}function I(B){const L=!Ht(B)||B<0?0:B;h==null||h.clickDistance(L)}return{update:g,destroy:b,setViewport:E,setViewportConstrained:w,getViewport:S,scaleTo:N,scaleBy:_,setScaleExtent:O,setTranslateExtent:k,syncViewport:M,setClickDistance:I}}var Xr;(function(t){t.Line="line",t.Handle="handle"})(Xr||(Xr={}));const r4=["top-left","top-right","bottom-left","bottom-right"],o4=["top","right","bottom","left"];function a4({width:t,prevWidth:e,height:n,prevHeight:r,affectsX:o,affectsY:a}){const i=t-e,s=n-r,l=[i>0?1:i<0?-1:0,s>0?1:s<0?-1:0];return i&&o&&(l[0]=l[0]*-1),s&&a&&(l[1]=l[1]*-1),l}function i4(t){const e=t.includes("right")||t.includes("left"),n=t.includes("bottom")||t.includes("top"),r=t.includes("left"),o=t.includes("top");return{isHorizontal:e,isVertical:n,affectsX:r,affectsY:o}}function Bn(t,e){return Math.max(0,e-t)}function Fn(t,e){return Math.max(0,t-e)}function Cs(t,e,n){return Math.max(0,e-t,t-n)}function LE(t,e){return t?!e:e}function s4(t,e,n,r,o,a,i,s){let{affectsX:l,affectsY:c}=e;const{isHorizontal:d,isVertical:u}=e,h=d&&u,{xSnapped:p,ySnapped:y}=n,{minWidth:f,maxWidth:v,minHeight:g,maxHeight:b}=r,{x:w,y:E,width:M,height:S,aspectRatio:N}=t;let _=Math.floor(d?p-t.pointerX:0),O=Math.floor(u?y-t.pointerY:0);const k=M+(l?-_:_),I=S+(c?-O:O),B=-a[0]*M,L=-a[1]*S;let C=Cs(k,f,v),P=Cs(I,g,b);if(i){let R=0,A=0;l&&_<0?R=Bn(w+_+B,i[0][0]):!l&&_>0&&(R=Fn(w+k+B,i[1][0])),c&&O<0?A=Bn(E+O+L,i[0][1]):!c&&O>0&&(A=Fn(E+I+L,i[1][1])),C=Math.max(C,R),P=Math.max(P,A)}if(s){let R=0,A=0;l&&_>0?R=Fn(w+_,s[0][0]):!l&&_<0&&(R=Bn(w+k,s[1][0])),c&&O>0?A=Fn(E+O,s[0][1]):!c&&O<0&&(A=Bn(E+I,s[1][1])),C=Math.max(C,R),P=Math.max(P,A)}if(o){if(d){const R=Cs(k/N,g,b)*N;if(C=Math.max(C,R),i){let A=0;!l&&!c||l&&!c&&h?A=Fn(E+L+k/N,i[1][1])*N:A=Bn(E+L+(l?_:-_)/N,i[0][1])*N,C=Math.max(C,A)}if(s){let A=0;!l&&!c||l&&!c&&h?A=Bn(E+k/N,s[1][1])*N:A=Fn(E+(l?_:-_)/N,s[0][1])*N,C=Math.max(C,A)}}if(u){const R=Cs(I*N,f,v)/N;if(P=Math.max(P,R),i){let A=0;!l&&!c||c&&!l&&h?A=Fn(w+I*N+B,i[1][0])/N:A=Bn(w+(c?O:-O)*N+B,i[0][0])/N,P=Math.max(P,A)}if(s){let A=0;!l&&!c||c&&!l&&h?A=Bn(w+I*N,s[1][0])/N:A=Fn(w+(c?O:-O)*N,s[0][0])/N,P=Math.max(P,A)}}}O=O+(O<0?P:-P),_=_+(_<0?C:-C),o&&(h?k>I*N?O=(LE(l,c)?-_:_)/N:_=(LE(l,c)?-O:O)*N:d?(O=_/N,c=l):(_=O*N,l=c));const j=l?w+_:w,D=c?E+O:E;return{width:M+(l?-_:_),height:S+(c?-O:O),x:a[0]*_*(l?-1:1)+j,y:a[1]*O*(c?-1:1)+D}}const $E={width:0,height:0,x:0,y:0},l4={...$E,pointerX:0,pointerY:0,aspectRatio:1};function c4(t){return[[0,0],[t.measured.width,t.measured.height]]}function u4(t,e,n){const r=e.position.x+t.position.x,o=e.position.y+t.position.y,a=t.measured.width??0,i=t.measured.height??0,s=n[0]*a,l=n[1]*i;return[[r-s,o-l],[r+a-s,o+i-l]]}function d4({domNode:t,nodeId:e,getStoreItems:n,onChange:r,onEnd:o}){const a=Ot(t);function i({controlPosition:l,boundaries:c,keepAspectRatio:d,onResizeStart:u,onResize:h,onResizeEnd:p,shouldResize:y}){let f={...$E},v={...l4};const g=i4(l);let b,w=null,E=[],M,S,N;const _=b1().on("start",O=>{const{nodeLookup:k,transform:I,snapGrid:B,snapToGrid:L,nodeOrigin:C,paneDomNode:P}=n();if(b=k.get(e),!b)return;w=(P==null?void 0:P.getBoundingClientRect())??null;const{xSnapped:j,ySnapped:D}=ba(O.sourceEvent,{transform:I,snapGrid:B,snapToGrid:L,containerBounds:w});f={width:b.measured.width??0,height:b.measured.height??0,x:b.position.x??0,y:b.position.y??0},v={...f,pointerX:j,pointerY:D,aspectRatio:f.width/f.height},M=void 0,b.parentId&&(b.extent==="parent"||b.expandParent)&&(M=k.get(b.parentId),S=M&&b.extent==="parent"?c4(M):void 0),E=[],N=void 0;for(const[R,A]of k)if(A.parentId===e&&(E.push({id:R,position:{...A.position},extent:A.extent}),A.extent==="parent"||A.expandParent)){const V=u4(A,b,A.origin??C);N?N=[[Math.min(V[0][0],N[0][0]),Math.min(V[0][1],N[0][1])],[Math.max(V[1][0],N[1][0]),Math.max(V[1][1],N[1][1])]]:N=V}u==null||u(O,{...f})}).on("drag",O=>{const{transform:k,snapGrid:I,snapToGrid:B,nodeOrigin:L}=n(),C=ba(O.sourceEvent,{transform:k,snapGrid:I,snapToGrid:B,containerBounds:w}),P=[];if(!b)return;const{x:j,y:D,width:R,height:A}=f,V={},q=b.origin??L,{width:Y,height:H,x:G,y:Z}=s4(v,g,C,c,d,q,S,N),J=Y!==R,ce=H!==A,U=G!==j&&J,te=Z!==D&&ce;if(!U&&!te&&!J&&!ce)return;if((U||te||q[0]===1||q[1]===1)&&(V.x=U?G:f.x,V.y=te?Z:f.y,f.x=V.x,f.y=V.y,E.length>0)){const X=G-j,oe=Z-D;for(const he of E)he.position={x:he.position.x-X+q[0]*(Y-R),y:he.position.y-oe+q[1]*(H-A)},P.push(he)}if((J||ce)&&(V.width=J?Y:f.width,V.height=ce?H:f.height,f.width=V.width,f.height=V.height),M&&b.expandParent){const X=q[0]*(V.width??0);V.x&&V.x<X&&(f.x=X,v.x=v.x-(V.x-X));const oe=q[1]*(V.height??0);V.y&&V.y<oe&&(f.y=oe,v.y=v.y-(V.y-oe))}const re=a4({width:f.width,prevWidth:R,height:f.height,prevHeight:A,affectsX:g.affectsX,affectsY:g.affectsY}),ie={...f,direction:re};(y==null?void 0:y(O,ie))!==!1&&(h==null||h(O,ie),r(V,P))}).on("end",O=>{p==null||p(O,{...f}),o==null||o()});a.call(_)}function s(){a.on(".drag",null)}return{update:i,destroy:s}}var BE={exports:{}},Np={},FE;function h4(){if(FE)return Np;FE=1;var t=sC(),e=ux();function n(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var r=typeof Object.is=="function"?Object.is:n,o=e.useSyncExternalStore,a=t.useRef,i=t.useEffect,s=t.useMemo,l=t.useDebugValue;return Np.useSyncExternalStoreWithSelector=function(c,d,u,h,p){var y=a(null);if(y.current===null){var f={hasValue:!1,value:null};y.current=f}else f=y.current;y=s(function(){function g(S){if(!b){if(b=!0,w=S,S=h(S),p!==void 0&&f.hasValue){var N=f.value;if(p(N,S))return E=N}return E=S}if(N=E,r(w,S))return N;var _=h(S);return p!==void 0&&p(N,_)?N:(w=S,E=_)}var b=!1,w,E,M=u===void 0?null:u;return[function(){return g(d())},M===null?void 0:function(){return g(M())}]},[d,u,h,p]);var v=o(c,y[0],y[1]);return i(function(){f.hasValue=!0,f.value=v},[v]),l(v),v},Np}var zE;function p4(){return zE||(zE=1,BE.exports=h4()),BE.exports}var f4=p4();let VE,Sp,WE,UE,HE,qE;um=Qn(f4),VE={BASE_URL:"/NoLLMChat/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_URL:"/NoLLMChat/"},Sp=t=>{let e;const n=new Set,r=(s,l)=>{const c=typeof s=="function"?s(e):s;if(!Object.is(c,e)){const d=e;e=l??(typeof c!="object"||c===null)?c:Object.assign({},e,c),n.forEach(u=>u(e,d))}},o=()=>e,a={setState:r,getState:o,getInitialState:()=>i,subscribe:s=>(n.add(s),()=>n.delete(s)),destroy:()=>{(VE?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},i=e=t(r,o,a);return a},WE=t=>t?Sp(t):Sp,{useDebugValue:UE}=zs,{useSyncExternalStoreWithSelector:HE}=um,qE=t=>t;function QE(t,e=qE,n){const r=HE(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return UE(r),r}const KE=(t,e)=>{const n=WE(t),r=(o,a=e)=>QE(n,o,a);return Object.assign(r,n),r},m4=(t,e)=>t?KE(t,e):KE;function Qe(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[r,o]of t)if(!Object.is(o,e.get(r)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}const Ns=m.createContext(null),y4=Ns.Provider,YE=Mn.error001();ke=function(t,e){const n=m.useContext(Ns);if(n===null)throw new Error(YE);return QE(n,t,e)},He=function(){const t=m.useContext(Ns);if(t===null)throw new Error(YE);return m.useMemo(()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe}),[t])};const XE={display:"none"},g4={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},ZE="react-flow__node-desc",GE="react-flow__edge-desc",v4="react-flow__aria-live",x4=t=>t.ariaLiveMessage;function b4({rfId:t}){const e=ke(x4);return x.jsx("div",{id:`${v4}-${t}`,"aria-live":"assertive","aria-atomic":"true",style:g4,children:e})}function w4({rfId:t,disableKeyboardA11y:e}){return x.jsxs(x.Fragment,{children:[x.jsxs("div",{id:`${ZE}-${t}`,style:XE,children:["Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "]}),x.jsx("div",{id:`${GE}-${t}`,style:XE,children:"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."}),!e&&x.jsx(b4,{rfId:t})]})}const E4=t=>t.userSelectionActive?"none":"all";Ha=function({position:t="top-left",children:e,className:n,style:r,...o}){const a=ke(E4),i=`${t}`.split("-");return x.jsx("div",{className:at(["react-flow__panel",n,...i]),style:{...r,pointerEvents:a},...o,children:e})};function _4({proOptions:t,position:e="bottom-right"}){return t!=null&&t.hideAttribution?null:x.jsx(Ha,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:x.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const M4=t=>{const e=[],n=[];for(const[,r]of t.nodeLookup)r.selected&&e.push(r.internals.userNode);for(const[,r]of t.edgeLookup)r.selected&&n.push(r);return{selectedNodes:e,selectedEdges:n}},Ss=t=>t.id;function C4(t,e){return Qe(t.selectedNodes.map(Ss),e.selectedNodes.map(Ss))&&Qe(t.selectedEdges.map(Ss),e.selectedEdges.map(Ss))}function N4({onSelectionChange:t}){const e=He(),{selectedNodes:n,selectedEdges:r}=ke(M4,C4);return m.useEffect(()=>{const o={nodes:n,edges:r};t==null||t(o),e.getState().onSelectionChangeHandlers.forEach(a=>a(o))},[n,r,t]),null}const S4=t=>!!t.onSelectionChangeHandlers;function O4({onSelectionChange:t}){const e=ke(S4);return t||e?x.jsx(N4,{onSelectionChange:t}):null}const JE=[0,0],A4={x:0,y:0,zoom:1},k4=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance"],e_=[...k4,"rfId"],j4=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setPaneClickDistance:t.setPaneClickDistance}),t_={translateExtent:fa,nodeOrigin:JE,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function R4(t){const{setNodes:e,setEdges:n,setMinZoom:r,setMaxZoom:o,setTranslateExtent:a,setNodeExtent:i,reset:s,setDefaultNodesAndEdges:l,setPaneClickDistance:c}=ke(j4,Qe),d=He();m.useEffect(()=>(l(t.defaultNodes,t.defaultEdges),()=>{u.current=t_,s()}),[]);const u=m.useRef(t_);return m.useEffect(()=>{for(const h of e_){const p=t[h],y=u.current[h];p!==y&&(typeof t[h]>"u"||(h==="nodes"?e(p):h==="edges"?n(p):h==="minZoom"?r(p):h==="maxZoom"?o(p):h==="translateExtent"?a(p):h==="nodeExtent"?i(p):h==="paneClickDistance"?c(p):h==="fitView"?d.setState({fitViewOnInit:p}):h==="fitViewOptions"?d.setState({fitViewOnInitOptions:p}):d.setState({[h]:p})))}u.current=t},e_.map(h=>t[h])),null}function n_(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function P4(t){var r;const[e,n]=m.useState(t==="system"?null:t);return m.useEffect(()=>{if(t!=="system"){n(t);return}const o=n_(),a=()=>n(o!=null&&o.matches?"dark":"light");return a(),o==null||o.addEventListener("change",a),()=>{o==null||o.removeEventListener("change",a)}},[t]),e!==null?e:(r=n_())!=null&&r.matches?"dark":"light"}const r_=typeof document<"u"?document:null;function Ea(t=null,e={target:r_,actInsideInputWithModifier:!0}){const[n,r]=m.useState(!1),o=m.useRef(!1),a=m.useRef(new Set([])),[i,s]=m.useMemo(()=>{if(t!==null){const l=(Array.isArray(t)?t:[t]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),c=l.reduce((d,u)=>d.concat(...u),[]);return[l,c]}return[[],[]]},[t]);return m.useEffect(()=>{const l=(e==null?void 0:e.target)||r_;if(t!==null){const c=h=>{if(o.current=h.ctrlKey||h.metaKey||h.shiftKey,(!o.current||o.current&&!e.actInsideInputWithModifier)&&fp(h))return!1;const p=a_(h.code,s);a.current.add(h[p]),o_(i,a.current,!1)&&(h.preventDefault(),r(!0))},d=h=>{if((!o.current||o.current&&!e.actInsideInputWithModifier)&&fp(h))return!1;const p=a_(h.code,s);o_(i,a.current,!0)?(r(!1),a.current.clear()):a.current.delete(h[p]),h.key==="Meta"&&a.current.clear(),o.current=!1},u=()=>{a.current.clear(),r(!1)};return l==null||l.addEventListener("keydown",c),l==null||l.addEventListener("keyup",d),window.addEventListener("blur",u),window.addEventListener("contextmenu",u),()=>{l==null||l.removeEventListener("keydown",c),l==null||l.removeEventListener("keyup",d),window.removeEventListener("blur",u),window.removeEventListener("contextmenu",u)}}},[t,r]),n}function o_(t,e,n){return t.filter(r=>n||r.length===e.size).some(r=>r.every(o=>e.has(o)))}function a_(t,e){return e.includes(t)?"code":"key"}const T4=()=>{const t=He();return m.useMemo(()=>({zoomIn:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1/1.2,{duration:e==null?void 0:e.duration}):Promise.resolve(!1)},zoomTo:(e,n)=>{const{panZoom:r}=t.getState();return r?r.scaleTo(e,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>t.getState().transform[2],setViewport:async(e,n)=>{const{transform:[r,o,a],panZoom:i}=t.getState();return i?(await i.setViewport({x:e.x??r,y:e.y??o,zoom:e.zoom??a},{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,n,r]=t.getState().transform;return{x:e,y:n,zoom:r}},fitView:e=>{const{nodeLookup:n,minZoom:r,maxZoom:o,panZoom:a,domNode:i}=t.getState();if(!a||!i)return Promise.resolve(!1);const s=up(n,e),{width:l,height:c}=Es(i);return dp({nodes:s,width:l,height:c,minZoom:r,maxZoom:o,panZoom:a},e)},setCenter:async(e,n,r)=>{const{width:o,height:a,maxZoom:i,panZoom:s}=t.getState(),l=typeof(r==null?void 0:r.zoom)<"u"?r.zoom:i,c=o/2-e*l,d=a/2-n*l;return s?(await s.setViewport({x:c,y:d,zoom:l},{duration:r==null?void 0:r.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitBounds:async(e,n)=>{const{width:r,height:o,minZoom:a,maxZoom:i,panZoom:s}=t.getState(),l=pp(e,r,o,a,i,(n==null?void 0:n.padding)??.1);return s?(await s.setViewport(l,{duration:n==null?void 0:n.duration}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,n={snapToGrid:!0})=>{const{transform:r,snapGrid:o,domNode:a}=t.getState();if(!a)return e;const{x:i,y:s}=a.getBoundingClientRect(),l={x:e.x-i,y:e.y-s};return xa(l,r,n.snapToGrid,o)},flowToScreenPosition:e=>{const{transform:n,domNode:r}=t.getState();if(!r)return e;const{x:o,y:a}=r.getBoundingClientRect(),i=uE(e,n);return{x:i.x+o,y:i.y+a}}}),[])};function i_(t,e){const n=[],r=new Map,o=[];for(const a of t)if(a.type==="add"){o.push(a);continue}else if(a.type==="remove"||a.type==="replace")r.set(a.id,[a]);else{const i=r.get(a.id);i?i.push(a):r.set(a.id,[a])}for(const a of e){const i=r.get(a.id);if(!i){n.push(a);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const s={...a};for(const l of i)I4(l,s);n.push(s)}return o.length&&o.forEach(a=>{a.index!==void 0?n.splice(a.index,0,{...a.item}):n.push({...a.item})}),n}function I4(t,e){switch(t.type){case"select":{e.selected=t.selected;break}case"position":{typeof t.position<"u"&&(e.position=t.position),typeof t.dragging<"u"&&(e.dragging=t.dragging);break}case"dimensions":{typeof t.dimensions<"u"&&(e.measured??(e.measured={}),e.measured.width=t.dimensions.width,e.measured.height=t.dimensions.height,t.setAttributes&&(e.width=t.dimensions.width,e.height=t.dimensions.height)),typeof t.resizing=="boolean"&&(e.resizing=t.resizing);break}}}Yn=function(t,e){return i_(t,e)};function _a(t,e){return i_(t,e)}function cr(t,e){return{id:t,type:"select",selected:e}}function Zr(t,e=new Set,n=!1){const r=[];for(const[o,a]of t){const i=e.has(o);!(a.selected===void 0&&!i)&&a.selected!==i&&(n&&(a.selected=i),r.push(cr(a.id,i)))}return r}function s_({items:t=[],lookup:e}){var o;const n=[],r=new Map(t.map(a=>[a.id,a]));for(const[a,i]of t.entries()){const s=e.get(i.id),l=((o=s==null?void 0:s.internals)==null?void 0:o.userNode)??s;l!==void 0&&l!==i&&n.push({id:i.id,item:i,type:"replace"}),l===void 0&&n.push({item:i,type:"add",index:a})}for(const[a]of e)r.get(a)===void 0&&n.push({id:a,type:"remove"});return n}function l_(t){return{id:t.id,type:"remove"}}const c_=t=>b5(t),D4=t=>nE(t);function u_(t){return m.forwardRef(t)}const L4=typeof window<"u"?m.useLayoutEffect:m.useEffect;function d_(t){const[e,n]=m.useState(BigInt(0)),[r]=m.useState(()=>$4(()=>n(o=>o+BigInt(1))));return L4(()=>{const o=r.get();o.length&&(t(o),r.reset())},[e]),r}function $4(t){let e=[];return{get:()=>e,reset:()=>{e=[]},push:n=>{e.push(n),t()}}}const h_=m.createContext(null);function B4({children:t}){const e=He(),n=m.useCallback(s=>{const{nodes:l=[],setNodes:c,hasDefaultNodes:d,onNodesChange:u,nodeLookup:h}=e.getState();let p=l;for(const y of s)p=typeof y=="function"?y(p):y;d?c(p):u&&u(s_({items:p,lookup:h}))},[]),r=d_(n),o=m.useCallback(s=>{const{edges:l=[],setEdges:c,hasDefaultEdges:d,onEdgesChange:u,edgeLookup:h}=e.getState();let p=l;for(const y of s)p=typeof y=="function"?y(p):y;d?c(p):u&&u(s_({items:p,lookup:h}))},[]),a=d_(o),i=m.useMemo(()=>({nodeQueue:r,edgeQueue:a}),[]);return x.jsx(h_.Provider,{value:i,children:t})}function F4(){const t=m.useContext(h_);if(!t)throw new Error("useBatchContext must be used within a BatchProvider");return t}const z4=t=>!!t.panZoom;Va=function(){const t=T4(),e=He(),n=F4(),r=ke(z4),o=m.useMemo(()=>{const a=u=>e.getState().nodeLookup.get(u),i=u=>{n.nodeQueue.push(u)},s=u=>{n.edgeQueue.push(u)},l=u=>{var g,b;const{nodeLookup:h,nodeOrigin:p}=e.getState(),y=c_(u)?u:h.get(u.id),f=y.parentId?hE(y.position,y.measured,y.parentId,h,p):y.position,v={id:y.id,position:f,width:((g=y.measured)==null?void 0:g.width)??y.width,height:((b=y.measured)==null?void 0:b.height)??y.height,data:y.data};return Qr(v)},c=(u,h,p={replace:!1})=>{i(y=>y.map(f=>{if(f.id===u){const v=typeof h=="function"?h(f):h;return p.replace&&c_(v)?v:{...f,...v}}return f}))},d=(u,h,p={replace:!1})=>{s(y=>y.map(f=>{if(f.id===u){const v=typeof h=="function"?h(f):h;return p.replace&&D4(v)?v:{...f,...v}}return f}))};return{getNodes:()=>e.getState().nodes.map(u=>({...u})),getNode:u=>{var h;return(h=a(u))==null?void 0:h.internals.userNode},getInternalNode:a,getEdges:()=>{const{edges:u=[]}=e.getState();return u.map(h=>({...h}))},getEdge:u=>e.getState().edgeLookup.get(u),setNodes:i,setEdges:s,addNodes:u=>{const h=Array.isArray(u)?u:[u];n.nodeQueue.push(p=>[...p,...h])},addEdges:u=>{const h=Array.isArray(u)?u:[u];n.edgeQueue.push(p=>[...p,...h])},toObject:()=>{const{nodes:u=[],edges:h=[],transform:p}=e.getState(),[y,f,v]=p;return{nodes:u.map(g=>({...g})),edges:h.map(g=>({...g})),viewport:{x:y,y:f,zoom:v}}},deleteElements:async({nodes:u=[],edges:h=[]})=>{const{nodes:p,edges:y,onNodesDelete:f,onEdgesDelete:v,triggerNodeChanges:g,triggerEdgeChanges:b,onDelete:w,onBeforeDelete:E}=e.getState(),{nodes:M,edges:S}=await _5({nodesToRemove:u,edgesToRemove:h,nodes:p,edges:y,onBeforeDelete:E}),N=S.length>0,_=M.length>0;if(N){const O=S.map(l_);v==null||v(S),b(O)}if(_){const O=M.map(l_);f==null||f(M),g(O)}return(_||N)&&(w==null||w({nodes:M,edges:S})),{deletedNodes:M,deletedEdges:S}},getIntersectingNodes:(u,h=!0,p)=>{const y=cE(u),f=y?u:l(u),v=p!==void 0;return f?(p||e.getState().nodes).filter(g=>{const b=e.getState().nodeLookup.get(g.id);if(b&&!y&&(g.id===u.id||!b.internals.positionAbsolute))return!1;const w=Qr(v?g:b),E=va(w,f);return h&&E>0||E>=f.width*f.height}):[]},isNodeIntersecting:(u,h,p=!0)=>{const y=cE(u)?u:l(u);if(!y)return!1;const f=va(y,h);return p&&f>0||f>=y.width*y.height},updateNode:c,updateNodeData:(u,h,p={replace:!1})=>{c(u,y=>{const f=typeof h=="function"?h(y):h;return p.replace?{...y,data:f}:{...y,data:{...y.data,...f}}},p)},updateEdge:d,updateEdgeData:(u,h,p={replace:!1})=>{d(u,y=>{const f=typeof h=="function"?h(y):h;return p.replace?{...y,data:f}:{...y,data:{...y.data,...f}}},p)},getNodesBounds:u=>{const{nodeLookup:h,nodeOrigin:p}=e.getState();return w5(u,{nodeLookup:h,nodeOrigin:p})},getHandleConnections:({type:u,id:h,nodeId:p})=>{var y;return Array.from(((y=e.getState().connectionLookup.get(`${p}-${u}-${h??null}`))==null?void 0:y.values())??[])}}},[]);return m.useMemo(()=>({...o,...t,viewportInitialized:r}),[r])};const p_=t=>t.selected,V4={actInsideInputWithModifier:!1},W4=typeof window<"u"?window:void 0;function U4({deleteKeyCode:t,multiSelectionKeyCode:e}){const n=He(),{deleteElements:r}=Va(),o=Ea(t,V4),a=Ea(e,{target:W4});m.useEffect(()=>{if(o){const{edges:i,nodes:s}=n.getState();r({nodes:s.filter(p_),edges:i.filter(p_)}),n.setState({nodesSelectionActive:!1})}},[o]),m.useEffect(()=>{n.setState({multiSelectionActive:a})},[a])}function H4(t){const e=He();m.useEffect(()=>{const n=()=>{var o,a;if(!t.current)return!1;const r=Es(t.current);(r.height===0||r.width===0)&&((a=(o=e.getState()).onError)==null||a.call(o,"004",Mn.error004())),e.setState({width:r.width||500,height:r.height||500})};if(t.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(t.current),()=>{window.removeEventListener("resize",n),r&&t.current&&r.unobserve(t.current)}}},[])}const Os={position:"absolute",width:"100%",height:"100%",top:0,left:0},q4=t=>({userSelectionActive:t.userSelectionActive,lib:t.lib});function Q4({onPaneContextMenu:t,zoomOnScroll:e=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:o=.5,panOnScrollMode:a=Xn.Free,zoomOnDoubleClick:i=!0,panOnDrag:s=!0,defaultViewport:l,translateExtent:c,minZoom:d,maxZoom:u,zoomActivationKeyCode:h,preventScrolling:p=!0,children:y,noWheelClassName:f,noPanClassName:v,onViewportChange:g,isControlledViewport:b,paneClickDistance:w}){const E=He(),M=m.useRef(null),{userSelectionActive:S,lib:N}=ke(q4,Qe),_=Ea(h),O=m.useRef();H4(M);const k=m.useCallback(I=>{g==null||g({x:I[0],y:I[1],zoom:I[2]}),b||E.setState({transform:I})},[g,b]);return m.useEffect(()=>{if(M.current){O.current=n4({domNode:M.current,minZoom:d,maxZoom:u,translateExtent:c,viewport:l,paneClickDistance:w,onDraggingChange:C=>E.setState({paneDragging:C}),onPanZoomStart:(C,P)=>{const{onViewportChangeStart:j,onMoveStart:D}=E.getState();D==null||D(C,P),j==null||j(P)},onPanZoom:(C,P)=>{const{onViewportChange:j,onMove:D}=E.getState();D==null||D(C,P),j==null||j(P)},onPanZoomEnd:(C,P)=>{const{onViewportChangeEnd:j,onMoveEnd:D}=E.getState();D==null||D(C,P),j==null||j(P)}});const{x:I,y:B,zoom:L}=O.current.getViewport();return E.setState({panZoom:O.current,transform:[I,B,L],domNode:M.current.closest(".react-flow")}),()=>{var C;(C=O.current)==null||C.destroy()}}},[]),m.useEffect(()=>{var I;(I=O.current)==null||I.update({onPaneContextMenu:t,zoomOnScroll:e,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:o,panOnScrollMode:a,zoomOnDoubleClick:i,panOnDrag:s,zoomActivationKeyPressed:_,preventScrolling:p,noPanClassName:v,userSelectionActive:S,noWheelClassName:f,lib:N,onTransformChange:k})},[t,e,n,r,o,a,i,s,_,p,v,S,f,N,k]),x.jsx("div",{className:"react-flow__renderer",ref:M,style:Os,children:y})}const K4=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function Y4(){const{userSelectionActive:t,userSelectionRect:e}=ke(K4,Qe);return t&&e?x.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const Op=(t,e)=>n=>{n.target===e.current&&(t==null||t(n))},X4=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,dragging:t.paneDragging});function Z4({isSelecting:t,selectionKeyPressed:e,selectionMode:n=ma.Full,panOnDrag:r,selectionOnDrag:o,onSelectionStart:a,onSelectionEnd:i,onPaneClick:s,onPaneContextMenu:l,onPaneScroll:c,onPaneMouseEnter:d,onPaneMouseMove:u,onPaneMouseLeave:h,children:p}){const y=m.useRef(null),f=He(),v=m.useRef(0),g=m.useRef(0),b=m.useRef(),w=m.useRef(new Map),{userSelectionActive:E,elementsSelectable:M,dragging:S}=ke(X4,Qe),N=M&&(t||E),_=m.useRef(!1),O=m.useRef(!1),k=()=>{f.setState({userSelectionActive:!1,userSelectionRect:null}),v.current=0,g.current=0},I=R=>{if(_.current){_.current=!1;return}s==null||s(R),f.getState().resetSelectedElements(),f.setState({nodesSelectionActive:!1})},B=R=>{if(Array.isArray(r)&&(r!=null&&r.includes(2))){R.preventDefault();return}l==null||l(R)},L=c?R=>c(R):void 0,C=R=>{var G,Z,J,ce;const{resetSelectedElements:A,domNode:V,edgeLookup:q}=f.getState();if(b.current=V==null?void 0:V.getBoundingClientRect(),!M||!t||R.button!==0||R.target!==y.current||!b.current)return;(Z=(G=R.target)==null?void 0:G.setPointerCapture)==null||Z.call(G,R.pointerId),O.current=!0,_.current=!1,w.current=new Map;for(const[U,te]of q)w.current.set(te.source,((J=w.current.get(te.source))==null?void 0:J.add(U))||new Set([U])),w.current.set(te.target,((ce=w.current.get(te.target))==null?void 0:ce.add(U))||new Set([U]));const{x:Y,y:H}=Nn(R.nativeEvent,b.current);A(),f.setState({userSelectionRect:{width:0,height:0,startX:Y,startY:H,x:Y,y:H}}),a==null||a(R)},P=R=>{const{userSelectionRect:A,edgeLookup:V,transform:q,nodeLookup:Y,triggerNodeChanges:H,triggerEdgeChanges:G}=f.getState();if(!b.current||!A)return;_.current=!0;const{x:Z,y:J}=Nn(R.nativeEvent,b.current),{startX:ce,startY:U}=A,te={startX:ce,startY:U,x:Z<ce?Z:ce,y:J<U?J:U,width:Math.abs(Z-ce),height:Math.abs(J-U)},re=rE(Y,te,q,n===ma.Partial,!0),ie=new Set,X=new Set;for(const oe of re){X.add(oe.id);const he=w.current.get(oe.id);if(he)for(const ge of he)ie.add(ge)}if(v.current!==X.size){v.current=X.size;const oe=Zr(Y,X,!0);H(oe)}if(g.current!==ie.size){g.current=ie.size;const oe=Zr(V,ie);G(oe)}f.setState({userSelectionRect:te,userSelectionActive:!0,nodesSelectionActive:!1})},j=R=>{var V,q;if(R.button!==0||!O.current)return;(q=(V=R.target)==null?void 0:V.releasePointerCapture)==null||q.call(V,R.pointerId);const{userSelectionRect:A}=f.getState();!E&&A&&R.target===y.current&&(I==null||I(R)),v.current>0&&f.setState({nodesSelectionActive:!0}),k(),i==null||i(R),(e||o)&&(_.current=!1),O.current=!1},D=r===!0||Array.isArray(r)&&r.includes(0);return x.jsxs("div",{className:at(["react-flow__pane",{draggable:D,dragging:S,selection:t}]),onClick:N?void 0:Op(I,y),onContextMenu:Op(B,y),onWheel:Op(L,y),onPointerEnter:N?void 0:d,onPointerDown:N?C:u,onPointerMove:N?P:u,onPointerUp:N?j:void 0,onPointerLeave:h,ref:y,style:Os,children:[p,x.jsx(Y4,{})]})}function Ap({id:t,store:e,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:a,multiSelectionActive:i,nodeLookup:s,onError:l}=e.getState(),c=s.get(t);if(!c){l==null||l("012",Mn.error012(t));return}e.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&i)&&(a({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var d;return(d=r==null?void 0:r.current)==null?void 0:d.blur()})):o([t])}function f_({nodeRef:t,disabled:e=!1,noDragClassName:n,handleSelector:r,nodeId:o,isSelectable:a,nodeClickDistance:i}){const s=He(),[l,c]=m.useState(!1),d=m.useRef();return m.useEffect(()=>{d.current=V5({getStoreItems:()=>s.getState(),onNodeMouseDown:u=>{Ap({id:u,store:s,nodeRef:t})},onDragStart:()=>{c(!0)},onDragStop:()=>{c(!1)}})},[]),m.useEffect(()=>{var u,h;if(e)(u=d.current)==null||u.destroy();else if(t.current)return(h=d.current)==null||h.update({noDragClassName:n,handleSelector:r,domNode:t.current,isSelectable:a,nodeId:o,nodeClickDistance:i}),()=>{var p;(p=d.current)==null||p.destroy()}},[n,r,e,a,t,o]),l}const G4=t=>e=>e.selected&&(e.draggable||t&&typeof e.draggable>"u");function m_(){const t=He();return m.useCallback(e=>{const{nodeExtent:n,snapToGrid:r,snapGrid:o,nodesDraggable:a,onError:i,updateNodePositions:s,nodeLookup:l,nodeOrigin:c}=t.getState(),d=new Map,u=G4(a),h=r?o[0]:5,p=r?o[1]:5,y=e.direction.x*h*e.factor,f=e.direction.y*p*e.factor;for(const[,v]of l){if(!u(v))continue;let g={x:v.internals.positionAbsolute.x+y,y:v.internals.positionAbsolute.y+f};r&&(g=bs(g,o));const{position:b,positionAbsolute:w}=oE({nodeId:v.id,nextPosition:g,nodeLookup:l,nodeExtent:n,nodeOrigin:c,onError:i});v.position=b,v.internals.positionAbsolute=w,d.set(v.id,v)}s(d)},[])}const kp=m.createContext(null),J4=kp.Provider;kp.Consumer;const jp=()=>m.useContext(kp),eI=t=>({connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName,rfId:t.rfId}),tI=(t,e,n)=>r=>{const{connectionClickStartHandle:o,connectionMode:a,connection:i}=r,{fromHandle:s,toHandle:l,isValid:c}=i,d=(l==null?void 0:l.nodeId)===t&&(l==null?void 0:l.id)===e&&(l==null?void 0:l.type)===n;return{connectingFrom:(s==null?void 0:s.nodeId)===t&&(s==null?void 0:s.id)===e&&(s==null?void 0:s.type)===n,connectingTo:d,clickConnecting:(o==null?void 0:o.nodeId)===t&&(o==null?void 0:o.id)===e&&(o==null?void 0:o.type)===n,isPossibleEndHandle:a===Hr.Strict?(s==null?void 0:s.type)!==n:t!==(s==null?void 0:s.nodeId)||e!==(s==null?void 0:s.id),connectionInProcess:!!s,valid:d&&c}};function nI({type:t="source",position:e=xe.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:a=!0,id:i,onConnect:s,children:l,className:c,onMouseDown:d,onTouchStart:u,...h},p){var C,P;const y=i||null,f=t==="target",v=He(),g=jp(),{connectOnClick:b,noPanClassName:w,rfId:E}=ke(eI,Qe),{connectingFrom:M,connectingTo:S,clickConnecting:N,isPossibleEndHandle:_,connectionInProcess:O,valid:k}=ke(tI(g,y,t),Qe);g||((P=(C=v.getState()).onError)==null||P.call(C,"010",Mn.error010()));const I=j=>{const{defaultEdgeOptions:D,onConnect:R,hasDefaultEdges:A}=v.getState(),V={...D,...j};if(A){const{edges:q,setEdges:Y}=v.getState();Y(bE(V,q))}R==null||R(V),s==null||s(V)},B=j=>{if(!g)return;const D=fE(j.nativeEvent);if(o&&(D&&j.button===0||!D)){const R=v.getState();_p.onPointerDown(j.nativeEvent,{autoPanOnConnect:R.autoPanOnConnect,connectionMode:R.connectionMode,connectionRadius:R.connectionRadius,domNode:R.domNode,nodeLookup:R.nodeLookup,lib:R.lib,isTarget:f,handleId:y,nodeId:g,flowId:R.rfId,panBy:R.panBy,cancelConnection:R.cancelConnection,onConnectStart:R.onConnectStart,onConnectEnd:R.onConnectEnd,updateConnection:R.updateConnection,onConnect:I,isValidConnection:n||R.isValidConnection,getTransform:()=>v.getState().transform,getFromHandle:()=>v.getState().connection.fromHandle,autoPanSpeed:R.autoPanSpeed})}D?d==null||d(j):u==null||u(j)},L=j=>{const{onClickConnectStart:D,onClickConnectEnd:R,connectionClickStartHandle:A,connectionMode:V,isValidConnection:q,lib:Y,rfId:H,nodeLookup:G,connection:Z}=v.getState();if(!g||!A&&!o)return;if(!A){D==null||D(j.nativeEvent,{nodeId:g,handleId:y,handleType:t}),v.setState({connectionClickStartHandle:{nodeId:g,type:t,id:y}});return}const J=pE(j.target),ce=n||q,{connection:U,isValid:te}=_p.isValid(j.nativeEvent,{handle:{nodeId:g,id:y,type:t},connectionMode:V,fromNodeId:A.nodeId,fromHandleId:A.id||null,fromType:A.type,isValidConnection:ce,flowId:H,doc:J,lib:Y,nodeLookup:G});te&&U&&I(U);const re=structuredClone(Z);delete re.inProgress,re.toPosition=re.toHandle?re.toHandle.position:null,R==null||R(j,re),v.setState({connectionClickStartHandle:null})};return x.jsx("div",{"data-handleid":y,"data-nodeid":g,"data-handlepos":e,"data-id":`${E}-${g}-${y}-${t}`,className:at(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",w,c,{source:!f,target:f,connectable:r,connectablestart:o,connectableend:a,clickconnecting:N,connectingfrom:M,connectingto:S,valid:k,connectionindicator:r&&(!O||_)&&(O?a:o)}]),onMouseDown:B,onTouchStart:B,onClick:b?L:void 0,ref:p,...h,children:l})}fo=m.memo(u_(nI));function rI({data:t,isConnectable:e,sourcePosition:n=xe.Bottom}){return x.jsxs(x.Fragment,{children:[t==null?void 0:t.label,x.jsx(fo,{type:"source",position:n,isConnectable:e})]})}function oI({data:t,isConnectable:e,targetPosition:n=xe.Top,sourcePosition:r=xe.Bottom}){return x.jsxs(x.Fragment,{children:[x.jsx(fo,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label,x.jsx(fo,{type:"source",position:r,isConnectable:e})]})}function aI(){return null}function iI({data:t,isConnectable:e,targetPosition:n=xe.Top}){return x.jsxs(x.Fragment,{children:[x.jsx(fo,{type:"target",position:n,isConnectable:e}),t==null?void 0:t.label]})}const As={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},y_={input:rI,default:oI,output:iI,group:aI};function sI(t){var e,n,r,o;return t.internals.handleBounds===void 0?{width:t.width??t.initialWidth??((e=t.style)==null?void 0:e.width),height:t.height??t.initialHeight??((n=t.style)==null?void 0:n.height)}:{width:t.width??((r=t.style)==null?void 0:r.width),height:t.height??((o=t.style)==null?void 0:o.height)}}const lI=t=>{const{width:e,height:n,x:r,y:o}=ga(t.nodeLookup,{filter:a=>!!a.selected});return{width:Ht(e)?e:null,height:Ht(n)?n:null,userSelectionActive:t.userSelectionActive,transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]}) translate(${r}px,${o}px)`}};function cI({onSelectionContextMenu:t,noPanClassName:e,disableKeyboardA11y:n}){const r=He(),{width:o,height:a,transformString:i,userSelectionActive:s}=ke(lI,Qe),l=m_(),c=m.useRef(null);if(m.useEffect(()=>{var h;n||((h=c.current)==null||h.focus({preventScroll:!0}))},[n]),f_({nodeRef:c}),s||!o||!a)return null;const d=t?h=>{const p=r.getState().nodes.filter(y=>y.selected);t(h,p)}:void 0,u=h=>{Object.prototype.hasOwnProperty.call(As,h.key)&&l({direction:As[h.key],factor:h.shiftKey?4:1})};return x.jsx("div",{className:at(["react-flow__nodesselection","react-flow__container",e]),style:{transform:i},children:x.jsx("div",{ref:c,className:"react-flow__nodesselection-rect",onContextMenu:d,tabIndex:n?void 0:-1,onKeyDown:n?void 0:u,style:{width:o,height:a}})})}const g_=typeof window<"u"?window:void 0,uI=t=>({nodesSelectionActive:t.nodesSelectionActive,userSelectionActive:t.userSelectionActive});function v_({children:t,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,paneClickDistance:s,deleteKeyCode:l,selectionKeyCode:c,selectionOnDrag:d,selectionMode:u,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:y,panActivationKeyCode:f,zoomActivationKeyCode:v,elementsSelectable:g,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:E,panOnScrollSpeed:M,panOnScrollMode:S,zoomOnDoubleClick:N,panOnDrag:_,defaultViewport:O,translateExtent:k,minZoom:I,maxZoom:B,preventScrolling:L,onSelectionContextMenu:C,noWheelClassName:P,noPanClassName:j,disableKeyboardA11y:D,onViewportChange:R,isControlledViewport:A}){const{nodesSelectionActive:V,userSelectionActive:q}=ke(uI),Y=Ea(c,{target:g_}),H=Ea(f,{target:g_}),G=H||_,Z=H||E,J=d&&G!==!0,ce=Y||q||J;return U4({deleteKeyCode:l,multiSelectionKeyCode:y}),x.jsx(Q4,{onPaneContextMenu:a,elementsSelectable:g,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:Z,panOnScrollSpeed:M,panOnScrollMode:S,zoomOnDoubleClick:N,panOnDrag:!Y&&G,defaultViewport:O,translateExtent:k,minZoom:I,maxZoom:B,zoomActivationKeyCode:v,preventScrolling:L,noWheelClassName:P,noPanClassName:j,onViewportChange:R,isControlledViewport:A,paneClickDistance:s,children:x.jsxs(Z4,{onSelectionStart:h,onSelectionEnd:p,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:a,onPaneScroll:i,panOnDrag:G,isSelecting:!!ce,selectionMode:u,selectionKeyPressed:Y,selectionOnDrag:J,children:[t,V&&x.jsx(cI,{onSelectionContextMenu:C,noPanClassName:j,disableKeyboardA11y:D})]})})}v_.displayName="FlowRenderer";const dI=m.memo(v_),hI=t=>e=>t?rE(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(n=>n.id):Array.from(e.nodeLookup.keys());function pI(t){return ke(m.useCallback(hI(t),[t]),Qe)}const fI=t=>t.updateNodeInternals;function mI(){const t=ke(fI),[e]=m.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(o=>{const a=o.target.getAttribute("data-id");r.set(a,{id:a,nodeElement:o.target,force:!0})}),t(r)}));return m.useEffect(()=>()=>{e==null||e.disconnect()},[e]),e}function yI({node:t,nodeType:e,hasDimensions:n,resizeObserver:r}){const o=He(),a=m.useRef(null),i=m.useRef(null),s=m.useRef(t.sourcePosition),l=m.useRef(t.targetPosition),c=m.useRef(e),d=n&&!!t.internals.handleBounds;return m.useEffect(()=>{a.current&&!t.hidden&&(!d||i.current!==a.current)&&(i.current&&(r==null||r.unobserve(i.current)),r==null||r.observe(a.current),i.current=a.current)},[d,t.hidden]),m.useEffect(()=>()=>{i.current&&(r==null||r.unobserve(i.current),i.current=null)},[]),m.useEffect(()=>{if(a.current){const u=c.current!==e,h=s.current!==t.sourcePosition,p=l.current!==t.targetPosition;(u||h||p)&&(c.current=e,s.current=t.sourcePosition,l.current=t.targetPosition,o.getState().updateNodeInternals(new Map([[t.id,{id:t.id,nodeElement:a.current,force:!0}]])))}},[t.id,e,t.sourcePosition,t.targetPosition]),a}function gI({id:t,onClick:e,onMouseEnter:n,onMouseMove:r,onMouseLeave:o,onContextMenu:a,onDoubleClick:i,nodesDraggable:s,elementsSelectable:l,nodesConnectable:c,nodesFocusable:d,resizeObserver:u,noDragClassName:h,noPanClassName:p,disableKeyboardA11y:y,rfId:f,nodeTypes:v,nodeExtent:g,nodeClickDistance:b,onError:w}){const{node:E,internals:M,isParent:S}=ke(U=>{const te=U.nodeLookup.get(t),re=U.parentLookup.has(t);return{node:te,internals:te.internals,isParent:re}},Qe);let N=E.type||"default",_=(v==null?void 0:v[N])||y_[N];_===void 0&&(w==null||w("003",Mn.error003(N)),N="default",_=y_.default);const O=!!(E.draggable||s&&typeof E.draggable>"u"),k=!!(E.selectable||l&&typeof E.selectable>"u"),I=!!(E.connectable||c&&typeof E.connectable>"u"),B=!!(E.focusable||d&&typeof E.focusable>"u"),L=He(),C=dE(E),P=yI({node:E,nodeType:N,hasDimensions:C,resizeObserver:u}),j=f_({nodeRef:P,disabled:E.hidden||!O,noDragClassName:h,handleSelector:E.dragHandle,nodeId:t,isSelectable:k,nodeClickDistance:b}),D=m_();if(E.hidden)return null;const R=Cn(E),A=sI(E),V=k||O||e||n||r||o,q=n?U=>n(U,{...M.userNode}):void 0,Y=r?U=>r(U,{...M.userNode}):void 0,H=o?U=>o(U,{...M.userNode}):void 0,G=a?U=>a(U,{...M.userNode}):void 0,Z=i?U=>i(U,{...M.userNode}):void 0,J=U=>{const{selectNodesOnDrag:te,nodeDragThreshold:re}=L.getState();k&&(!te||!O||re>0)&&Ap({id:t,store:L,nodeRef:P}),e&&e(U,{...M.userNode})},ce=U=>{if(!(fp(U.nativeEvent)||y))if(Z1.includes(U.key)&&k){const te=U.key==="Escape";Ap({id:t,store:L,unselect:te,nodeRef:P})}else O&&E.selected&&Object.prototype.hasOwnProperty.call(As,U.key)&&(L.setState({ariaLiveMessage:`Moved selected node ${U.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~M.positionAbsolute.x}, y: ${~~M.positionAbsolute.y}`}),D({direction:As[U.key],factor:U.shiftKey?4:1}))};return x.jsx("div",{className:at(["react-flow__node",`react-flow__node-${N}`,{[p]:O},E.className,{selected:E.selected,selectable:k,parent:S,draggable:O,dragging:j}]),ref:P,style:{zIndex:M.z,transform:`translate(${M.positionAbsolute.x}px,${M.positionAbsolute.y}px)`,pointerEvents:V?"all":"none",visibility:C?"visible":"hidden",...E.style,...A},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:q,onMouseMove:Y,onMouseLeave:H,onContextMenu:G,onClick:J,onDoubleClick:Z,onKeyDown:B?ce:void 0,tabIndex:B?0:void 0,role:B?"button":void 0,"aria-describedby":y?void 0:`${ZE}-${f}`,"aria-label":E.ariaLabel,children:x.jsx(J4,{value:t,children:x.jsx(_,{id:t,data:E.data,type:N,positionAbsoluteX:M.positionAbsolute.x,positionAbsoluteY:M.positionAbsolute.y,selected:E.selected,selectable:k,draggable:O,deletable:E.deletable??!0,isConnectable:I,sourcePosition:E.sourcePosition,targetPosition:E.targetPosition,dragging:j,dragHandle:E.dragHandle,zIndex:M.z,parentId:E.parentId,...R})})})}const vI=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,onError:t.onError});function x_(t){const{nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,onError:a}=ke(vI,Qe),i=pI(t.onlyRenderVisibleElements),s=mI();return x.jsx("div",{className:"react-flow__nodes",style:Os,children:i.map(l=>x.jsx(gI,{id:l,nodeTypes:t.nodeTypes,nodeExtent:t.nodeExtent,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,resizeObserver:s,nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,nodeClickDistance:t.nodeClickDistance,onError:a},l))})}x_.displayName="NodeRenderer";const xI=m.memo(x_);function bI(t){return ke(m.useCallback(e=>{if(!t)return e.edges.map(r=>r.id);const n=[];if(e.width&&e.height)for(const r of e.edges){const o=e.nodeLookup.get(r.source),a=e.nodeLookup.get(r.target);o&&a&&S5({sourceNode:o,targetNode:a,width:e.width,height:e.height,transform:e.transform})&&n.push(r.id)}return n},[t]),Qe)}const wI=({color:t="none",strokeWidth:e=1})=>x.jsx("polyline",{style:{stroke:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),EI=({color:t="none",strokeWidth:e=1})=>x.jsx("polyline",{style:{stroke:t,fill:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),b_={[ys.Arrow]:wI,[ys.ArrowClosed]:EI};function _I(t){const e=He();return m.useMemo(()=>{var n,r;return Object.prototype.hasOwnProperty.call(b_,t)?b_[t]:((r=(n=e.getState()).onError)==null||r.call(n,"009",Mn.error009(t)),null)},[t])}const MI=({id:t,type:e,color:n,width:r=12.5,height:o=12.5,markerUnits:a="strokeWidth",strokeWidth:i,orient:s="auto-start-reverse"})=>{const l=_I(e);return l?x.jsx("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:s,refX:"0",refY:"0",children:x.jsx(l,{color:n,strokeWidth:i})}):null},w_=({defaultColor:t,rfId:e})=>{const n=ke(a=>a.edges),r=ke(a=>a.defaultEdgeOptions),o=m.useMemo(()=>T5(n,{id:e,defaultColor:t,defaultMarkerStart:r==null?void 0:r.markerStart,defaultMarkerEnd:r==null?void 0:r.markerEnd}),[n,r,e,t]);return o.length?x.jsx("svg",{className:"react-flow__marker",children:x.jsx("defs",{children:o.map(a=>x.jsx(MI,{id:a.id,type:a.type,color:a.color,width:a.width,height:a.height,markerUnits:a.markerUnits,strokeWidth:a.strokeWidth,orient:a.orient},a.id))})}):null};w_.displayName="MarkerDefinitions";var CI=m.memo(w_);function E_({x:t,y:e,label:n,labelStyle:r={},labelShowBg:o=!0,labelBgStyle:a={},labelBgPadding:i=[2,4],labelBgBorderRadius:s=2,children:l,className:c,...d}){const[u,h]=m.useState({x:1,y:0,width:0,height:0}),p=at(["react-flow__edge-textwrapper",c]),y=m.useRef(null);return m.useEffect(()=>{if(y.current){const f=y.current.getBBox();h({x:f.x,y:f.y,width:f.width,height:f.height})}},[n]),typeof n>"u"||!n?null:x.jsxs("g",{transform:`translate(${t-u.width/2} ${e-u.height/2})`,className:p,visibility:u.width?"visible":"hidden",...d,children:[o&&x.jsx("rect",{width:u.width+2*i[0],x:-i[0],y:-i[1],height:u.height+2*i[1],className:"react-flow__edge-textbg",style:a,rx:s,ry:s}),x.jsx("text",{className:"react-flow__edge-text",y:u.height/2,dy:"0.3em",ref:y,style:r,children:n}),l]})}E_.displayName="EdgeText";const NI=m.memo(E_);function ks({id:t,path:e,labelX:n,labelY:r,label:o,labelStyle:a,labelShowBg:i,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c,style:d,markerEnd:u,markerStart:h,className:p,interactionWidth:y=20}){return x.jsxs(x.Fragment,{children:[x.jsx("path",{id:t,style:d,d:e,fill:"none",className:at(["react-flow__edge-path",p]),markerEnd:u,markerStart:h}),y&&x.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:y,className:"react-flow__edge-interaction"}),o&&Ht(n)&&Ht(r)?x.jsx(NI,{x:n,y:r,label:o,labelStyle:a,labelShowBg:i,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c}):null]})}function __({pos:t,x1:e,y1:n,x2:r,y2:o}){return t===xe.Left||t===xe.Right?[.5*(e+r),n]:[e,.5*(n+o)]}function M_({sourceX:t,sourceY:e,sourcePosition:n=xe.Bottom,targetX:r,targetY:o,targetPosition:a=xe.Top}){const[i,s]=__({pos:n,x1:t,y1:e,x2:r,y2:o}),[l,c]=__({pos:a,x1:r,y1:o,x2:t,y2:e}),[d,u,h,p]=yE({sourceX:t,sourceY:e,targetX:r,targetY:o,sourceControlX:i,sourceControlY:s,targetControlX:l,targetControlY:c});return[`M${t},${e} C${i},${s} ${l},${c} ${r},${o}`,d,u,h,p]}function C_(t){return m.memo(({id:e,sourceX:n,sourceY:r,targetX:o,targetY:a,sourcePosition:i=xe.Bottom,targetPosition:s=xe.Top,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:f,markerStart:v,interactionWidth:g})=>{const[b,w,E]=M_({sourceX:n,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:s}),M=t.isInternal?void 0:e;return x.jsx(ks,{id:M,path:b,labelX:w,labelY:E,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:f,markerStart:v,interactionWidth:g})})}const SI=C_({isInternal:!1}),N_=C_({isInternal:!0});SI.displayName="SimpleBezierEdge",N_.displayName="SimpleBezierEdgeInternal";function S_(t){return m.memo(({id:e,sourceX:n,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,sourcePosition:p=xe.Bottom,targetPosition:y=xe.Top,markerEnd:f,markerStart:v,pathOptions:g,interactionWidth:b})=>{const[w,E,M]=mp({sourceX:n,sourceY:r,sourcePosition:p,targetX:o,targetY:a,targetPosition:y,borderRadius:g==null?void 0:g.borderRadius,offset:g==null?void 0:g.offset}),S=t.isInternal?void 0:e;return x.jsx(ks,{id:S,path:w,labelX:E,labelY:M,label:i,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:v,interactionWidth:b})})}const O_=S_({isInternal:!1}),A_=S_({isInternal:!0});O_.displayName="SmoothStepEdge",A_.displayName="SmoothStepEdgeInternal";function k_(t){return m.memo(({id:e,...n})=>{var o;const r=t.isInternal?void 0:e;return x.jsx(O_,{...n,id:r,pathOptions:m.useMemo(()=>{var a;return{borderRadius:0,offset:(a=n.pathOptions)==null?void 0:a.offset}},[(o=n.pathOptions)==null?void 0:o.offset])})})}const OI=k_({isInternal:!1}),j_=k_({isInternal:!0});OI.displayName="StepEdge",j_.displayName="StepEdgeInternal";function R_(t){return m.memo(({id:e,sourceX:n,sourceY:r,targetX:o,targetY:a,label:i,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:p,markerStart:y,interactionWidth:f})=>{const[v,g,b]=wE({sourceX:n,sourceY:r,targetX:o,targetY:a}),w=t.isInternal?void 0:e;return x.jsx(ks,{id:w,path:v,labelX:g,labelY:b,label:i,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:p,markerStart:y,interactionWidth:f})})}const AI=R_({isInternal:!1}),P_=R_({isInternal:!0});AI.displayName="StraightEdge",P_.displayName="StraightEdgeInternal";function T_(t){return m.memo(({id:e,sourceX:n,sourceY:r,targetX:o,targetY:a,sourcePosition:i=xe.Bottom,targetPosition:s=xe.Top,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:f,markerStart:v,pathOptions:g,interactionWidth:b})=>{const[w,E,M]=vE({sourceX:n,sourceY:r,sourcePosition:i,targetX:o,targetY:a,targetPosition:s,curvature:g==null?void 0:g.curvature}),S=t.isInternal?void 0:e;return x.jsx(ks,{id:S,path:w,labelX:E,labelY:M,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:p,style:y,markerEnd:f,markerStart:v,interactionWidth:b})})}const kI=T_({isInternal:!1}),I_=T_({isInternal:!0});kI.displayName="BezierEdge",I_.displayName="BezierEdgeInternal";const D_={default:I_,straight:P_,step:j_,smoothstep:A_,simplebezier:N_},L_={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},jI=(t,e,n)=>n===xe.Left?t-e:n===xe.Right?t+e:t,RI=(t,e,n)=>n===xe.Top?t-e:n===xe.Bottom?t+e:t,$_="react-flow__edgeupdater";function B_({position:t,centerX:e,centerY:n,radius:r=10,onMouseDown:o,onMouseEnter:a,onMouseOut:i,type:s}){return x.jsx("circle",{onMouseDown:o,onMouseEnter:a,onMouseOut:i,className:at([$_,`${$_}-${s}`]),cx:jI(e,r,t),cy:RI(n,r,t),r,stroke:"transparent",fill:"transparent"})}function PI({isReconnectable:t,reconnectRadius:e,edge:n,sourceX:r,sourceY:o,targetX:a,targetY:i,sourcePosition:s,targetPosition:l,onReconnect:c,onReconnectStart:d,onReconnectEnd:u,setReconnecting:h,setUpdateHover:p}){const y=He(),f=(E,M)=>{if(E.button!==0)return;const{autoPanOnConnect:S,domNode:N,isValidConnection:_,connectionMode:O,connectionRadius:k,lib:I,onConnectStart:B,onConnectEnd:L,cancelConnection:C,nodeLookup:P,rfId:j,panBy:D,updateConnection:R}=y.getState(),A=M.type==="target";h(!0),d==null||d(E,n,M.type);const V=(Y,H)=>{h(!1),u==null||u(Y,n,M.type,H)},q=Y=>c==null?void 0:c(n,Y);_p.onPointerDown(E.nativeEvent,{autoPanOnConnect:S,connectionMode:O,connectionRadius:k,domNode:N,handleId:M.id,nodeId:M.nodeId,nodeLookup:P,isTarget:A,edgeUpdaterType:M.type,lib:I,flowId:j,cancelConnection:C,panBy:D,isValidConnection:_,onConnect:q,onConnectStart:B,onConnectEnd:L,onReconnectEnd:V,updateConnection:R,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle})},v=E=>f(E,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),g=E=>f(E,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),b=()=>p(!0),w=()=>p(!1);return x.jsxs(x.Fragment,{children:[(t===!0||t==="source")&&x.jsx(B_,{position:s,centerX:r,centerY:o,radius:e,onMouseDown:v,onMouseEnter:b,onMouseOut:w,type:"source"}),(t===!0||t==="target")&&x.jsx(B_,{position:l,centerX:a,centerY:i,radius:e,onMouseDown:g,onMouseEnter:b,onMouseOut:w,type:"target"})]})}function TI({id:t,edgesFocusable:e,edgesReconnectable:n,elementsSelectable:r,onClick:o,onDoubleClick:a,onContextMenu:i,onMouseEnter:s,onMouseMove:l,onMouseLeave:c,reconnectRadius:d,onReconnect:u,onReconnectStart:h,onReconnectEnd:p,rfId:y,edgeTypes:f,noPanClassName:v,onError:g,disableKeyboardA11y:b}){let w=ke(X=>X.edgeLookup.get(t));const E=ke(X=>X.defaultEdgeOptions);w=E?{...E,...w}:w;let M=w.type||"default",S=(f==null?void 0:f[M])||D_[M];S===void 0&&(g==null||g("011",Mn.error011(M)),M="default",S=D_.default);const N=!!(w.focusable||e&&typeof w.focusable>"u"),_=typeof u<"u"&&(w.reconnectable||n&&typeof w.reconnectable>"u"),O=!!(w.selectable||r&&typeof w.selectable>"u"),k=m.useRef(null),[I,B]=m.useState(!1),[L,C]=m.useState(!1),P=He(),{zIndex:j,sourceX:D,sourceY:R,targetX:A,targetY:V,sourcePosition:q,targetPosition:Y}=ke(m.useCallback(X=>{const oe=X.nodeLookup.get(w.source),he=X.nodeLookup.get(w.target);if(!oe||!he)return{zIndex:w.zIndex,...L_};const ge=P5({id:t,sourceNode:oe,targetNode:he,sourceHandle:w.sourceHandle||null,targetHandle:w.targetHandle||null,connectionMode:X.connectionMode,onError:g});return{zIndex:N5({selected:w.selected,zIndex:w.zIndex,sourceNode:oe,targetNode:he,elevateOnSelect:X.elevateEdgesOnSelect}),...ge||L_}},[w.source,w.target,w.sourceHandle,w.targetHandle,w.selected,w.zIndex]),Qe),H=m.useMemo(()=>w.markerStart?`url('#${yp(w.markerStart,y)}')`:void 0,[w.markerStart,y]),G=m.useMemo(()=>w.markerEnd?`url('#${yp(w.markerEnd,y)}')`:void 0,[w.markerEnd,y]);if(w.hidden||D===null||R===null||A===null||V===null)return null;const Z=X=>{var Ve;const{addSelectedEdges:oe,unselectNodesAndEdges:he,multiSelectionActive:ge}=P.getState();O&&(P.setState({nodesSelectionActive:!1}),w.selected&&ge?(he({nodes:[],edges:[w]}),(Ve=k.current)==null||Ve.blur()):oe([t])),o&&o(X,w)},J=a?X=>{a(X,{...w})}:void 0,ce=i?X=>{i(X,{...w})}:void 0,U=s?X=>{s(X,{...w})}:void 0,te=l?X=>{l(X,{...w})}:void 0,re=c?X=>{c(X,{...w})}:void 0,ie=X=>{var oe;if(!b&&Z1.includes(X.key)&&O){const{unselectNodesAndEdges:he,addSelectedEdges:ge}=P.getState();X.key==="Escape"?((oe=k.current)==null||oe.blur(),he({edges:[w]})):ge([t])}};return x.jsx("svg",{style:{zIndex:j},children:x.jsxs("g",{className:at(["react-flow__edge",`react-flow__edge-${M}`,w.className,v,{selected:w.selected,animated:w.animated,inactive:!O&&!o,updating:I,selectable:O}]),onClick:Z,onDoubleClick:J,onContextMenu:ce,onMouseEnter:U,onMouseMove:te,onMouseLeave:re,onKeyDown:N?ie:void 0,tabIndex:N?0:void 0,role:N?"button":"img","data-id":t,"data-testid":`rf__edge-${t}`,"aria-label":w.ariaLabel===null?void 0:w.ariaLabel||`Edge from ${w.source} to ${w.target}`,"aria-describedby":N?`${GE}-${y}`:void 0,ref:k,children:[!L&&x.jsx(S,{id:t,source:w.source,target:w.target,type:w.type,selected:w.selected,animated:w.animated,selectable:O,deletable:w.deletable??!0,label:w.label,labelStyle:w.labelStyle,labelShowBg:w.labelShowBg,labelBgStyle:w.labelBgStyle,labelBgPadding:w.labelBgPadding,labelBgBorderRadius:w.labelBgBorderRadius,sourceX:D,sourceY:R,targetX:A,targetY:V,sourcePosition:q,targetPosition:Y,data:w.data,style:w.style,sourceHandleId:w.sourceHandle,targetHandleId:w.targetHandle,markerStart:H,markerEnd:G,pathOptions:"pathOptions"in w?w.pathOptions:void 0,interactionWidth:w.interactionWidth}),_&&x.jsx(PI,{edge:w,isReconnectable:_,reconnectRadius:d,onReconnect:u,onReconnectStart:h,onReconnectEnd:p,sourceX:D,sourceY:R,targetX:A,targetY:V,sourcePosition:q,targetPosition:Y,setUpdateHover:B,setReconnecting:C})]})})}const II=t=>({width:t.width,height:t.height,edgesFocusable:t.edgesFocusable,edgesReconnectable:t.edgesReconnectable,elementsSelectable:t.elementsSelectable,connectionMode:t.connectionMode,onError:t.onError});function F_({defaultMarkerColor:t,onlyRenderVisibleElements:e,rfId:n,edgeTypes:r,noPanClassName:o,onReconnect:a,onEdgeContextMenu:i,onEdgeMouseEnter:s,onEdgeMouseMove:l,onEdgeMouseLeave:c,onEdgeClick:d,reconnectRadius:u,onEdgeDoubleClick:h,onReconnectStart:p,onReconnectEnd:y,disableKeyboardA11y:f}){const{edgesFocusable:v,edgesReconnectable:g,elementsSelectable:b,onError:w}=ke(II,Qe),E=bI(e);return x.jsxs("div",{className:"react-flow__edges",children:[x.jsx(CI,{defaultColor:t,rfId:n}),E.map(M=>x.jsx(TI,{id:M,edgesFocusable:v,edgesReconnectable:g,elementsSelectable:b,noPanClassName:o,onReconnect:a,onContextMenu:i,onMouseEnter:s,onMouseMove:l,onMouseLeave:c,onClick:d,reconnectRadius:u,onDoubleClick:h,onReconnectStart:p,onReconnectEnd:y,rfId:n,onError:w,edgeTypes:r,disableKeyboardA11y:f},M))]})}F_.displayName="EdgeRenderer";const DI=m.memo(F_),LI=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function $I({children:t}){const e=ke(LI);return x.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:t})}function BI(t){const e=Va(),n=m.useRef(!1);m.useEffect(()=>{!n.current&&e.viewportInitialized&&t&&(setTimeout(()=>t(e),1),n.current=!0)},[t,e.viewportInitialized])}const FI=t=>{var e;return(e=t.panZoom)==null?void 0:e.syncViewport};function zI(t){const e=ke(FI),n=He();return m.useEffect(()=>{t&&(e==null||e(t),n.setState({transform:[t.x,t.y,t.zoom]}))},[t,e]),null}function VI(t){return t.connection.inProgress?{...t.connection,to:xa(t.connection.to,t.transform)}:{...t.connection}}function WI(t){return VI}function UI(t){const e=WI();return ke(e,Qe)}const HI=t=>({nodesConnectable:t.nodesConnectable,isValid:t.connection.isValid,inProgress:t.connection.inProgress,width:t.width,height:t.height});function qI({containerStyle:t,style:e,type:n,component:r}){const{nodesConnectable:o,width:a,height:i,isValid:s,inProgress:l}=ke(HI,Qe);return a&&o&&l?x.jsx("svg",{style:t,width:a,height:i,className:"react-flow__connectionline react-flow__container",children:x.jsx("g",{className:at(["react-flow__connection",tE(s)]),children:x.jsx(z_,{style:e,type:n,CustomComponent:r,isValid:s})})}):null}const z_=({style:t,type:e=$n.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:o,from:a,fromNode:i,fromHandle:s,fromPosition:l,to:c,toNode:d,toHandle:u,toPosition:h}=UI();if(!o)return;if(n)return x.jsx(n,{connectionLineType:e,connectionLineStyle:t,fromNode:i,fromHandle:s,fromX:a.x,fromY:a.y,toX:c.x,toY:c.y,fromPosition:l,toPosition:h,connectionStatus:tE(r),toNode:d,toHandle:u});let p="";const y={sourceX:a.x,sourceY:a.y,sourcePosition:l,targetX:c.x,targetY:c.y,targetPosition:h};switch(e){case $n.Bezier:[p]=vE(y);break;case $n.SimpleBezier:[p]=M_(y);break;case $n.Step:[p]=mp({...y,borderRadius:0});break;case $n.SmoothStep:[p]=mp(y);break;default:[p]=wE(y)}return x.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:t})};z_.displayName="ConnectionLine";const QI={};function V_(t=QI){m.useRef(t),He(),m.useEffect(()=>{},[t])}function KI(){He(),m.useRef(!1),m.useEffect(()=>{},[])}function W_({nodeTypes:t,edgeTypes:e,onInit:n,onNodeClick:r,onEdgeClick:o,onNodeDoubleClick:a,onEdgeDoubleClick:i,onNodeMouseEnter:s,onNodeMouseMove:l,onNodeMouseLeave:c,onNodeContextMenu:d,onSelectionContextMenu:u,onSelectionStart:h,onSelectionEnd:p,connectionLineType:y,connectionLineStyle:f,connectionLineComponent:v,connectionLineContainerStyle:g,selectionKeyCode:b,selectionOnDrag:w,selectionMode:E,multiSelectionKeyCode:M,panActivationKeyCode:S,zoomActivationKeyCode:N,deleteKeyCode:_,onlyRenderVisibleElements:O,elementsSelectable:k,defaultViewport:I,translateExtent:B,minZoom:L,maxZoom:C,preventScrolling:P,defaultMarkerColor:j,zoomOnScroll:D,zoomOnPinch:R,panOnScroll:A,panOnScrollSpeed:V,panOnScrollMode:q,zoomOnDoubleClick:Y,panOnDrag:H,onPaneClick:G,onPaneMouseEnter:Z,onPaneMouseMove:J,onPaneMouseLeave:ce,onPaneScroll:U,onPaneContextMenu:te,paneClickDistance:re,nodeClickDistance:ie,onEdgeContextMenu:X,onEdgeMouseEnter:oe,onEdgeMouseMove:he,onEdgeMouseLeave:ge,reconnectRadius:Ve,onReconnect:st,onReconnectStart:Re,onReconnectEnd:De,noDragClassName:et,noWheelClassName:We,noPanClassName:Ze,disableKeyboardA11y:wt,nodeExtent:tt,rfId:ct,viewport:ft,onViewportChange:ut}){return V_(t),V_(e),KI(),BI(n),zI(ft),x.jsx(dI,{onPaneClick:G,onPaneMouseEnter:Z,onPaneMouseMove:J,onPaneMouseLeave:ce,onPaneContextMenu:te,onPaneScroll:U,paneClickDistance:re,deleteKeyCode:_,selectionKeyCode:b,selectionOnDrag:w,selectionMode:E,onSelectionStart:h,onSelectionEnd:p,multiSelectionKeyCode:M,panActivationKeyCode:S,zoomActivationKeyCode:N,elementsSelectable:k,zoomOnScroll:D,zoomOnPinch:R,zoomOnDoubleClick:Y,panOnScroll:A,panOnScrollSpeed:V,panOnScrollMode:q,panOnDrag:H,defaultViewport:I,translateExtent:B,minZoom:L,maxZoom:C,onSelectionContextMenu:u,preventScrolling:P,noDragClassName:et,noWheelClassName:We,noPanClassName:Ze,disableKeyboardA11y:wt,onViewportChange:ut,isControlledViewport:!!ft,children:x.jsxs($I,{children:[x.jsx(DI,{edgeTypes:e,onEdgeClick:o,onEdgeDoubleClick:i,onReconnect:st,onReconnectStart:Re,onReconnectEnd:De,onlyRenderVisibleElements:O,onEdgeContextMenu:X,onEdgeMouseEnter:oe,onEdgeMouseMove:he,onEdgeMouseLeave:ge,reconnectRadius:Ve,defaultMarkerColor:j,noPanClassName:Ze,disableKeyboardA11y:wt,rfId:ct}),x.jsx(qI,{style:f,type:y,component:v,containerStyle:g}),x.jsx("div",{className:"react-flow__edgelabel-renderer"}),x.jsx(xI,{nodeTypes:t,onNodeClick:r,onNodeDoubleClick:a,onNodeMouseEnter:s,onNodeMouseMove:l,onNodeMouseLeave:c,onNodeContextMenu:d,nodeClickDistance:ie,onlyRenderVisibleElements:O,noPanClassName:Ze,noDragClassName:et,disableKeyboardA11y:wt,nodeExtent:tt,rfId:ct}),x.jsx("div",{className:"react-flow__viewport-portal"})]})})}W_.displayName="GraphView";const YI=m.memo(W_),U_=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:o,height:a,fitView:i,nodeOrigin:s,nodeExtent:l}={})=>{const c=new Map,d=new Map,u=new Map,h=new Map,p=r??e??[],y=n??t??[],f=s??[0,0],v=l??fa;OE(u,h,p),xp(y,c,d,{nodeOrigin:f,nodeExtent:v,elevateNodesOnSelect:!1});let g=[0,0,1];if(i&&o&&a){const b=ga(c,{filter:S=>!!((S.width||S.initialWidth)&&(S.height||S.initialHeight))}),{x:w,y:E,zoom:M}=pp(b,o,a,.5,2,.1);g=[w,E,M]}return{rfId:"1",width:0,height:0,transform:g,nodes:y,nodeLookup:c,parentLookup:d,edges:p,edgeLookup:h,connectionLookup:u,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:.5,maxZoom:2,translateExtent:fa,nodeExtent:v,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Hr.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:f,nodeDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,fitViewOnInit:!1,fitViewDone:!1,fitViewOnInitOptions:void 0,selectNodesOnDrag:!0,multiSelectionActive:!1,connection:{...G1},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanSpeed:15,connectionRadius:20,onError:M5,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1}},XI=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:o,height:a,fitView:i,nodeOrigin:s,nodeExtent:l})=>m4((c,d)=>({...U_({nodes:t,edges:e,width:o,height:a,fitView:i,nodeOrigin:s,nodeExtent:l,defaultNodes:n,defaultEdges:r}),setNodes:u=>{const{nodeLookup:h,parentLookup:p,nodeOrigin:y,elevateNodesOnSelect:f}=d();xp(u,h,p,{nodeOrigin:y,nodeExtent:l,elevateNodesOnSelect:f,checkEquality:!0}),c({nodes:u})},setEdges:u=>{const{connectionLookup:h,edgeLookup:p}=d();OE(h,p,u),c({edges:u})},setDefaultNodesAndEdges:(u,h)=>{if(u){const{setNodes:p}=d();p(u),c({hasDefaultNodes:!0})}if(h){const{setEdges:p}=d();p(h),c({hasDefaultEdges:!0})}},updateNodeInternals:(u,h={triggerFitView:!0})=>{const{triggerNodeChanges:p,nodeLookup:y,parentLookup:f,fitViewOnInit:v,fitViewDone:g,fitViewOnInitOptions:b,domNode:w,nodeOrigin:E,nodeExtent:M,debug:S,fitViewSync:N}=d(),{changes:_,updatedInternals:O}=B5(u,y,f,w,E,M);if(O){if(D5(y,f,{nodeOrigin:E,nodeExtent:M}),h.triggerFitView){let k=g;!g&&v&&(k=N({...b,nodes:b==null?void 0:b.nodes})),c({fitViewDone:k})}else c({});(_==null?void 0:_.length)>0&&(S&&console.log("React Flow: trigger node changes",_),p==null||p(_))}},updateNodePositions:(u,h=!1)=>{const p=[],y=[];for(const[f,v]of u){const g={id:f,type:"position",position:v.position,dragging:h};v!=null&&v.expandParent&&(v!=null&&v.parentId)&&g.position&&(p.push({id:f,parentId:v.parentId,rect:{...v.internals.positionAbsolute,width:v.measured.width,height:v.measured.height}}),g.position.x=Math.max(0,g.position.x),g.position.y=Math.max(0,g.position.y)),y.push(g)}if(p.length>0){const{nodeLookup:f,parentLookup:v,nodeOrigin:g}=d(),b=wp(p,f,v,g);y.push(...b)}d().triggerNodeChanges(y)},triggerNodeChanges:u=>{const{onNodesChange:h,setNodes:p,nodes:y,hasDefaultNodes:f,debug:v}=d();if(u!=null&&u.length){if(f){const g=Yn(u,y);p(g)}v&&console.log("React Flow: trigger node changes",u),h==null||h(u)}},triggerEdgeChanges:u=>{const{onEdgesChange:h,setEdges:p,edges:y,hasDefaultEdges:f,debug:v}=d();if(u!=null&&u.length){if(f){const g=_a(u,y);p(g)}v&&console.log("React Flow: trigger edge changes",u),h==null||h(u)}},addSelectedNodes:u=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:y,triggerNodeChanges:f,triggerEdgeChanges:v}=d();if(h){const g=u.map(b=>cr(b,!0));f(g);return}f(Zr(y,new Set([...u]),!0)),v(Zr(p))},addSelectedEdges:u=>{const{multiSelectionActive:h,edgeLookup:p,nodeLookup:y,triggerNodeChanges:f,triggerEdgeChanges:v}=d();if(h){const g=u.map(b=>cr(b,!0));v(g);return}v(Zr(p,new Set([...u]))),f(Zr(y,new Set,!0))},unselectNodesAndEdges:({nodes:u,edges:h}={})=>{const{edges:p,nodes:y,nodeLookup:f,triggerNodeChanges:v,triggerEdgeChanges:g}=d(),b=u||y,w=h||p,E=b.map(S=>{const N=f.get(S.id);return N&&(N.selected=!1),cr(S.id,!1)}),M=w.map(S=>cr(S.id,!1));v(E),g(M)},setMinZoom:u=>{const{panZoom:h,maxZoom:p}=d();h==null||h.setScaleExtent([u,p]),c({minZoom:u})},setMaxZoom:u=>{const{panZoom:h,minZoom:p}=d();h==null||h.setScaleExtent([p,u]),c({maxZoom:u})},setTranslateExtent:u=>{var h;(h=d().panZoom)==null||h.setTranslateExtent(u),c({translateExtent:u})},setPaneClickDistance:u=>{var h;(h=d().panZoom)==null||h.setClickDistance(u)},resetSelectedElements:()=>{const{edges:u,nodes:h,triggerNodeChanges:p,triggerEdgeChanges:y}=d(),f=h.reduce((g,b)=>b.selected?[...g,cr(b.id,!1)]:g,[]),v=u.reduce((g,b)=>b.selected?[...g,cr(b.id,!1)]:g,[]);p(f),y(v)},setNodeExtent:u=>{const{nodes:h,nodeLookup:p,parentLookup:y,nodeOrigin:f,elevateNodesOnSelect:v,nodeExtent:g}=d();u[0][0]===g[0][0]&&u[0][1]===g[0][1]&&u[1][0]===g[1][0]&&u[1][1]===g[1][1]||(xp(h,p,y,{nodeOrigin:f,nodeExtent:u,elevateNodesOnSelect:v,checkEquality:!1}),c({nodeExtent:u}))},panBy:u=>{const{transform:h,width:p,height:y,panZoom:f,translateExtent:v}=d();return F5({delta:u,panZoom:f,transform:h,translateExtent:v,width:p,height:y})},fitView:u=>{const{panZoom:h,width:p,height:y,minZoom:f,maxZoom:v,nodeLookup:g}=d();if(!h)return Promise.resolve(!1);const b=up(g,u);return dp({nodes:b,width:p,height:y,panZoom:h,minZoom:f,maxZoom:v},u)},fitViewSync:u=>{const{panZoom:h,width:p,height:y,minZoom:f,maxZoom:v,nodeLookup:g}=d();if(!h)return!1;const b=up(g,u);return dp({nodes:b,width:p,height:y,panZoom:h,minZoom:f,maxZoom:v},u),b.size>0},cancelConnection:()=>{c({connection:{...G1}})},updateConnection:u=>{c({connection:u})},reset:()=>c({...U_()})}),Object.is);function ZI({initialNodes:t,initialEdges:e,defaultNodes:n,defaultEdges:r,initialWidth:o,initialHeight:a,fitView:i,nodeOrigin:s,nodeExtent:l,children:c}){const[d]=m.useState(()=>XI({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:o,height:a,fitView:i,nodeOrigin:s,nodeExtent:l}));return x.jsx(y4,{value:d,children:x.jsx(B4,{children:c})})}function GI({children:t,nodes:e,edges:n,defaultNodes:r,defaultEdges:o,width:a,height:i,fitView:s,nodeOrigin:l,nodeExtent:c}){return m.useContext(Ns)?x.jsx(x.Fragment,{children:t}):x.jsx(ZI,{initialNodes:e,initialEdges:n,defaultNodes:r,defaultEdges:o,initialWidth:a,initialHeight:i,fitView:s,nodeOrigin:l,nodeExtent:c,children:t})}const JI={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function eD({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,className:o,nodeTypes:a,edgeTypes:i,onNodeClick:s,onEdgeClick:l,onInit:c,onMove:d,onMoveStart:u,onMoveEnd:h,onConnect:p,onConnectStart:y,onConnectEnd:f,onClickConnectStart:v,onClickConnectEnd:g,onNodeMouseEnter:b,onNodeMouseMove:w,onNodeMouseLeave:E,onNodeContextMenu:M,onNodeDoubleClick:S,onNodeDragStart:N,onNodeDrag:_,onNodeDragStop:O,onNodesDelete:k,onEdgesDelete:I,onDelete:B,onSelectionChange:L,onSelectionDragStart:C,onSelectionDrag:P,onSelectionDragStop:j,onSelectionContextMenu:D,onSelectionStart:R,onSelectionEnd:A,onBeforeDelete:V,connectionMode:q,connectionLineType:Y=$n.Bezier,connectionLineStyle:H,connectionLineComponent:G,connectionLineContainerStyle:Z,deleteKeyCode:J="Backspace",selectionKeyCode:ce="Shift",selectionOnDrag:U=!1,selectionMode:te=ma.Full,panActivationKeyCode:re="Space",multiSelectionKeyCode:ie=ws()?"Meta":"Control",zoomActivationKeyCode:X=ws()?"Meta":"Control",snapToGrid:oe,snapGrid:he,onlyRenderVisibleElements:ge=!1,selectNodesOnDrag:Ve,nodesDraggable:st,nodesConnectable:Re,nodesFocusable:De,nodeOrigin:et=JE,edgesFocusable:We,edgesReconnectable:Ze,elementsSelectable:wt=!0,defaultViewport:tt=A4,minZoom:ct=.5,maxZoom:ft=2,translateExtent:ut=fa,preventScrolling:tn=!0,nodeExtent:Sn,defaultMarkerColor:Tt="#b1b1b7",zoomOnScroll:Et=!0,zoomOnPinch:F=!0,panOnScroll:W=!1,panOnScrollSpeed:Q=.5,panOnScrollMode:ee=Xn.Free,zoomOnDoubleClick:ve=!0,panOnDrag:Ge=!0,onPaneClick:Ke,onPaneMouseEnter:Se,onPaneMouseMove:le,onPaneMouseLeave:ue,onPaneScroll:fe,onPaneContextMenu:me,paneClickDistance:Ee=0,nodeClickDistance:Le=0,children:Ye,onReconnect:gt,onReconnectStart:oo,onReconnectEnd:ao,onEdgeContextMenu:zn,onEdgeDoubleClick:io,onEdgeMouseEnter:$s,onEdgeMouseMove:af,onEdgeMouseLeave:sf,reconnectRadius:T=10,onNodesChange:$,onEdgesChange:z,noDragClassName:K="nodrag",noWheelClassName:pe="nowheel",noPanClassName:ye="nopan",fitView:we,fitViewOptions:ae,connectOnClick:_e,attributionPosition:be,proOptions:Ce,defaultEdgeOptions:Be,elevateNodesOnSelect:Oe,elevateEdgesOnSelect:Pe,disableKeyboardA11y:rt=!1,autoPanOnConnect:mt,autoPanOnNodeDrag:nt,autoPanSpeed:nn,connectionRadius:Vn,isValidConnection:so,onError:qt,style:rn,id:On,nodeDragThreshold:lo,viewport:co,onViewportChange:Wn,width:Ae,height:qe,colorMode:Te="light",debug:At,...Bs},lf){const cf=On||"1",D6=P4(Te);return x.jsx("div",{...Bs,style:{...rn,...JI},ref:lf,className:at(["react-flow",o,D6]),"data-testid":"rf__wrapper",id:On,children:x.jsxs(GI,{nodes:t,edges:e,width:Ae,height:qe,fitView:we,nodeOrigin:et,nodeExtent:Sn,children:[x.jsx(YI,{onInit:c,onNodeClick:s,onEdgeClick:l,onNodeMouseEnter:b,onNodeMouseMove:w,onNodeMouseLeave:E,onNodeContextMenu:M,onNodeDoubleClick:S,nodeTypes:a,edgeTypes:i,connectionLineType:Y,connectionLineStyle:H,connectionLineComponent:G,connectionLineContainerStyle:Z,selectionKeyCode:ce,selectionOnDrag:U,selectionMode:te,deleteKeyCode:J,multiSelectionKeyCode:ie,panActivationKeyCode:re,zoomActivationKeyCode:X,onlyRenderVisibleElements:ge,defaultViewport:tt,translateExtent:ut,minZoom:ct,maxZoom:ft,preventScrolling:tn,zoomOnScroll:Et,zoomOnPinch:F,zoomOnDoubleClick:ve,panOnScroll:W,panOnScrollSpeed:Q,panOnScrollMode:ee,panOnDrag:Ge,onPaneClick:Ke,onPaneMouseEnter:Se,onPaneMouseMove:le,onPaneMouseLeave:ue,onPaneScroll:fe,onPaneContextMenu:me,paneClickDistance:Ee,nodeClickDistance:Le,onSelectionContextMenu:D,onSelectionStart:R,onSelectionEnd:A,onReconnect:gt,onReconnectStart:oo,onReconnectEnd:ao,onEdgeContextMenu:zn,onEdgeDoubleClick:io,onEdgeMouseEnter:$s,onEdgeMouseMove:af,onEdgeMouseLeave:sf,reconnectRadius:T,defaultMarkerColor:Tt,noDragClassName:K,noWheelClassName:pe,noPanClassName:ye,rfId:cf,disableKeyboardA11y:rt,nodeExtent:Sn,viewport:co,onViewportChange:Wn}),x.jsx(R4,{nodes:t,edges:e,defaultNodes:n,defaultEdges:r,onConnect:p,onConnectStart:y,onConnectEnd:f,onClickConnectStart:v,onClickConnectEnd:g,nodesDraggable:st,nodesConnectable:Re,nodesFocusable:De,edgesFocusable:We,edgesReconnectable:Ze,elementsSelectable:wt,elevateNodesOnSelect:Oe,elevateEdgesOnSelect:Pe,minZoom:ct,maxZoom:ft,nodeExtent:Sn,onNodesChange:$,onEdgesChange:z,snapToGrid:oe,snapGrid:he,connectionMode:q,translateExtent:ut,connectOnClick:_e,defaultEdgeOptions:Be,fitView:we,fitViewOptions:ae,onNodesDelete:k,onEdgesDelete:I,onDelete:B,onNodeDragStart:N,onNodeDrag:_,onNodeDragStop:O,onSelectionDrag:P,onSelectionDragStart:C,onSelectionDragStop:j,onMove:d,onMoveStart:u,onMoveEnd:h,noPanClassName:ye,nodeOrigin:et,rfId:cf,autoPanOnConnect:mt,autoPanOnNodeDrag:nt,autoPanSpeed:nn,onError:qt,connectionRadius:Vn,isValidConnection:so,selectNodesOnDrag:Ve,nodeDragThreshold:lo,onBeforeDelete:V,paneClickDistance:Ee,debug:At}),x.jsx(O4,{onSelectionChange:L}),Ye,x.jsx(_4,{proOptions:Ce,position:be}),x.jsx(w4,{rfId:cf,disableKeyboardA11y:rt})]})})}bC=u_(eD);const tD=t=>{var e;return(e=t.domNode)==null?void 0:e.querySelector(".react-flow__viewport-portal")};vC=function({children:t}){const e=ke(tD);return e?eC.createPortal(t,e):null};const nD=t=>t.nodes;gC=function(){return ke(nD,Qe)},mC=function({type:t,id:e=null,nodeId:n,onConnect:r,onDisconnect:o}){const a=jp(),i=n??a,s=m.useRef(null),l=ke(c=>c.connectionLookup.get(`${i}-${t}-${e}`),x5);return m.useEffect(()=>{if(s.current&&s.current!==l){const c=l??new Map;eE(s.current,c,o),eE(c,s.current,r)}s.current=l??new Map},[l,r,o]),m.useMemo(()=>Array.from((l==null?void 0:l.values())??[]),[l])},dC=function(t){return ke(m.useCallback(e=>e.nodeLookup.get(t),[t]),Qe)};function rD({dimensions:t,lineWidth:e,variant:n,className:r}){return x.jsx("path",{strokeWidth:e,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`,className:at(["react-flow__background-pattern",n,r])})}function oD({radius:t,className:e}){return x.jsx("circle",{cx:t,cy:t,r:t,className:at(["react-flow__background-pattern","dots",e])})}(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(An||(An={}));const aD={[An.Dots]:1,[An.Lines]:1,[An.Cross]:6},iD=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function H_({id:t,variant:e=An.Dots,gap:n=20,size:r,lineWidth:o=1,offset:a=0,color:i,bgColor:s,style:l,className:c,patternClassName:d}){const u=m.useRef(null),{transform:h,patternId:p}=ke(iD,Qe),y=r||aD[e],f=e===An.Dots,v=e===An.Cross,g=Array.isArray(n)?n:[n,n],b=[g[0]*h[2]||1,g[1]*h[2]||1],w=y*h[2],E=Array.isArray(a)?a:[a,a],M=v?[w,w]:b,S=[E[0]*h[2]||1+M[0]/2,E[1]*h[2]||1+M[1]/2],N=`${p}${t||""}`;return x.jsxs("svg",{className:at(["react-flow__background",c]),style:{...l,...Os,"--xy-background-color-props":s,"--xy-background-pattern-color-props":i},ref:u,"data-testid":"rf__background",children:[x.jsx("pattern",{id:N,x:h[0]%b[0],y:h[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${S[0]},-${S[1]})`,children:f?x.jsx(oD,{radius:w/2,className:d}):x.jsx(rD,{dimensions:M,lineWidth:o,variant:e,className:d})}),x.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${N})`})]})}H_.displayName="Background",MC=m.memo(H_);function sD(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:x.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function lD(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:x.jsx("path",{d:"M0 0h32v4.2H0z"})})}function cD(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:x.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function uD(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:x.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function dD(){return x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:x.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function js({children:t,className:e,...n}){return x.jsx("button",{type:"button",className:at(["react-flow__controls-button",e]),...n,children:t})}const hD=t=>({isInteractive:t.nodesDraggable||t.nodesConnectable||t.elementsSelectable,minZoomReached:t.transform[2]<=t.minZoom,maxZoomReached:t.transform[2]>=t.maxZoom});function q_({style:t,showZoom:e=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:a,onZoomOut:i,onFitView:s,onInteractiveChange:l,className:c,children:d,position:u="bottom-left",orientation:h="vertical","aria-label":p="React Flow controls"}){const y=He(),{isInteractive:f,minZoomReached:v,maxZoomReached:g}=ke(hD,Qe),{zoomIn:b,zoomOut:w,fitView:E}=Va(),M=()=>{b(),a==null||a()},S=()=>{w(),i==null||i()},N=()=>{E(o),s==null||s()},_=()=>{y.setState({nodesDraggable:!f,nodesConnectable:!f,elementsSelectable:!f}),l==null||l(!f)},O=h==="horizontal"?"horizontal":"vertical";return x.jsxs(Ha,{className:at(["react-flow__controls",O,c]),position:u,style:t,"data-testid":"rf__controls","aria-label":p,children:[e&&x.jsxs(x.Fragment,{children:[x.jsx(js,{onClick:M,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:g,children:x.jsx(sD,{})}),x.jsx(js,{onClick:S,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:v,children:x.jsx(lD,{})})]}),n&&x.jsx(js,{className:"react-flow__controls-fitview",onClick:N,title:"fit view","aria-label":"fit view",children:x.jsx(cD,{})}),r&&x.jsx(js,{className:"react-flow__controls-interactive",onClick:_,title:"toggle interactivity","aria-label":"toggle interactivity",children:f?x.jsx(dD,{}):x.jsx(uD,{})}),d]})}q_.displayName="Controls",CC=m.memo(q_);function pD({id:t,x:e,y:n,width:r,height:o,style:a,color:i,strokeColor:s,strokeWidth:l,className:c,borderRadius:d,shapeRendering:u,selected:h,onClick:p}){const{background:y,backgroundColor:f}=a||{},v=i||y||f;return x.jsx("rect",{className:at(["react-flow__minimap-node",{selected:h},c]),x:e,y:n,rx:d,ry:d,width:r,height:o,style:{fill:v,stroke:s,strokeWidth:l},shapeRendering:u,onClick:p?g=>p(g,t):void 0})}const fD=m.memo(pD),mD=t=>t.nodes.map(e=>e.id),Rp=t=>t instanceof Function?t:()=>t;function yD({nodeStrokeColor:t,nodeColor:e,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:o,nodeComponent:a=fD,onClick:i}){const s=ke(mD,Qe),l=Rp(e),c=Rp(t),d=Rp(n),u=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return x.jsx(x.Fragment,{children:s.map(h=>x.jsx(vD,{id:h,nodeColorFunc:l,nodeStrokeColorFunc:c,nodeClassNameFunc:d,nodeBorderRadius:r,nodeStrokeWidth:o,NodeComponent:a,onClick:i,shapeRendering:u},h))})}function gD({id:t,nodeColorFunc:e,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:o,nodeStrokeWidth:a,shapeRendering:i,NodeComponent:s,onClick:l}){const{node:c,x:d,y:u,width:h,height:p}=ke(y=>{const f=y.nodeLookup.get(t),{x:v,y:g}=f.internals.positionAbsolute,{width:b,height:w}=Cn(f);return{node:f,x:v,y:g,width:b,height:w}},Qe);return!c||c.hidden||!dE(c)?null:x.jsx(s,{x:d,y:u,width:h,height:p,style:c.style,selected:!!c.selected,className:r(c),color:e(c),borderRadius:o,strokeColor:n(c),strokeWidth:a,shapeRendering:i,onClick:l,id:c.id})}const vD=m.memo(gD);var xD=m.memo(yD);const bD=200,wD=150,ED=t=>{const e={x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]};return{viewBB:e,boundingRect:t.nodeLookup.size>0?lE(ga(t.nodeLookup),e):e,rfId:t.rfId,panZoom:t.panZoom,translateExtent:t.translateExtent,flowWidth:t.width,flowHeight:t.height}},_D="react-flow__minimap-desc";function Q_({style:t,className:e,nodeStrokeColor:n,nodeColor:r,nodeClassName:o="",nodeBorderRadius:a=5,nodeStrokeWidth:i,nodeComponent:s,bgColor:l,maskColor:c,maskStrokeColor:d,maskStrokeWidth:u,position:h="bottom-right",onClick:p,onNodeClick:y,pannable:f=!1,zoomable:v=!1,ariaLabel:g="React Flow mini map",inversePan:b,zoomStep:w=10,offsetScale:E=5}){const M=He(),S=m.useRef(null),{boundingRect:N,viewBB:_,rfId:O,panZoom:k,translateExtent:I,flowWidth:B,flowHeight:L}=ke(ED,Qe),C=(t==null?void 0:t.width)??bD,P=(t==null?void 0:t.height)??wD,j=N.width/C,D=N.height/P,R=Math.max(j,D),A=R*C,V=R*P,q=E*R,Y=N.x-(A-N.width)/2-q,H=N.y-(V-N.height)/2-q,G=A+q*2,Z=V+q*2,J=`${_D}-${O}`,ce=m.useRef(0),U=m.useRef();ce.current=R,m.useEffect(()=>{if(S.current&&k)return U.current=K5({domNode:S.current,panZoom:k,getTransform:()=>M.getState().transform,getViewScale:()=>ce.current}),()=>{var ie;(ie=U.current)==null||ie.destroy()}},[k]),m.useEffect(()=>{var ie;(ie=U.current)==null||ie.update({translateExtent:I,width:B,height:L,inversePan:b,pannable:f,zoomStep:w,zoomable:v})},[f,v,b,w,I,B,L]);const te=p?ie=>{var he;const[X,oe]=((he=U.current)==null?void 0:he.pointer(ie))||[0,0];p(ie,{x:X,y:oe})}:void 0,re=y?m.useCallback((ie,X)=>{const oe=M.getState().nodeLookup.get(X);y(ie,oe)},[]):void 0;return x.jsx(Ha,{position:h,style:{...t,"--xy-minimap-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-stroke-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-width-props":typeof u=="number"?u*R:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="string"?i:void 0},className:at(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:x.jsxs("svg",{width:C,height:P,viewBox:`${Y} ${H} ${G} ${Z}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":J,ref:S,onClick:te,children:[g&&x.jsx("title",{id:J,children:g}),x.jsx(xD,{onClick:re,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:a,nodeClassName:o,nodeStrokeWidth:i,nodeComponent:s}),x.jsx("path",{className:"react-flow__minimap-mask",d:`M${Y-q},${H-q}h${G+q*2}v${Z+q*2}h${-G-q*2}z
        M${_.x},${_.y}h${_.width}v${_.height}h${-_.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}Q_.displayName="MiniMap",NC=m.memo(Q_);function MD({nodeId:t,position:e,variant:n=Xr.Handle,className:r,style:o={},children:a,color:i,minWidth:s=10,minHeight:l=10,maxWidth:c=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:u=!1,shouldResize:h,onResizeStart:p,onResize:y,onResizeEnd:f}){const v=jp(),g=typeof t=="string"?t:v,b=He(),w=m.useRef(null),E=n===Xr.Line?"right":"bottom-right",M=e??E,S=m.useRef(null);m.useEffect(()=>{if(!(!w.current||!g))return S.current||(S.current=d4({domNode:w.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:k,transform:I,snapGrid:B,snapToGrid:L,nodeOrigin:C,domNode:P}=b.getState();return{nodeLookup:k,transform:I,snapGrid:B,snapToGrid:L,nodeOrigin:C,paneDomNode:P}},onChange:(k,I)=>{const{triggerNodeChanges:B,nodeLookup:L,parentLookup:C,nodeOrigin:P}=b.getState(),j=[],D={x:k.x,y:k.y},R=L.get(g);if(R&&R.expandParent&&R.parentId){const A=R.origin??P,V=k.width??R.measured.width,q=k.height??R.measured.height,Y={id:R.id,parentId:R.parentId,rect:{width:V,height:q,...hE({x:k.x??R.position.x,y:k.y??R.position.y},{width:V,height:q},R.parentId,L,A)}},H=wp([Y],L,C,P);j.push(...H),D.x=k.x?Math.max(A[0]*V,k.x):void 0,D.y=k.y?Math.max(A[1]*q,k.y):void 0}if(D.x!==void 0&&D.y!==void 0){const A={id:g,type:"position",position:{...D}};j.push(A)}if(k.width!==void 0&&k.height!==void 0){const A={id:g,type:"dimensions",resizing:!0,setAttributes:!0,dimensions:{width:k.width,height:k.height}};j.push(A)}for(const A of I){const V={...A,type:"position"};j.push(V)}B(j)},onEnd:()=>{const k={id:g,type:"dimensions",resizing:!1};b.getState().triggerNodeChanges([k])}})),S.current.update({controlPosition:M,boundaries:{minWidth:s,minHeight:l,maxWidth:c,maxHeight:d},keepAspectRatio:u,onResizeStart:p,onResize:y,onResizeEnd:f,shouldResize:h}),()=>{var k;(k=S.current)==null||k.destroy()}},[M,s,l,c,d,u,p,y,f,h]);const N=M.split("-"),_=n===Xr.Line?"borderColor":"backgroundColor",O=i?{...o,[_]:i}:o;return x.jsx("div",{className:at(["react-flow__resize-control","nodrag",...N,n,r]),ref:w,style:O,children:a})}const K_=m.memo(MD);hC=function({nodeId:t,isVisible:e=!0,handleClassName:n,handleStyle:r,lineClassName:o,lineStyle:a,color:i,minWidth:s=10,minHeight:l=10,maxWidth:c=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:u=!1,shouldResize:h,onResizeStart:p,onResize:y,onResizeEnd:f}){return e?x.jsxs(x.Fragment,{children:[o4.map(v=>x.jsx(K_,{className:o,style:a,nodeId:t,position:v,variant:Xr.Line,color:i,minWidth:s,minHeight:l,maxWidth:c,maxHeight:d,onResizeStart:p,keepAspectRatio:u,shouldResize:h,onResize:y,onResizeEnd:f},v)),r4.map(v=>x.jsx(K_,{className:n,style:r,nodeId:t,position:v,color:i,minWidth:s,minHeight:l,maxWidth:c,maxHeight:d,onResizeStart:p,keepAspectRatio:u,shouldResize:h,onResize:y,onResizeEnd:f},v))]}):null};var Pp,Y_;function CD(){if(Y_)return Pp;Y_=1;var t=function(g){return e(g)&&!n(g)};function e(g){return!!g&&typeof g=="object"}function n(g){var b=Object.prototype.toString.call(g);return b==="[object RegExp]"||b==="[object Date]"||a(g)}var r=typeof Symbol=="function"&&Symbol.for,o=r?Symbol.for("react.element"):60103;function a(g){return g.$$typeof===o}function i(g){return Array.isArray(g)?[]:{}}function s(g,b){return b.clone!==!1&&b.isMergeableObject(g)?f(i(g),g,b):g}function l(g,b,w){return g.concat(b).map(function(E){return s(E,w)})}function c(g,b){if(!b.customMerge)return f;var w=b.customMerge(g);return typeof w=="function"?w:f}function d(g){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(g).filter(function(b){return Object.propertyIsEnumerable.call(g,b)}):[]}function u(g){return Object.keys(g).concat(d(g))}function h(g,b){try{return b in g}catch{return!1}}function p(g,b){return h(g,b)&&!(Object.hasOwnProperty.call(g,b)&&Object.propertyIsEnumerable.call(g,b))}function y(g,b,w){var E={};return w.isMergeableObject(g)&&u(g).forEach(function(M){E[M]=s(g[M],w)}),u(b).forEach(function(M){p(g,M)||(h(g,M)&&w.isMergeableObject(b[M])?E[M]=c(M,w)(g[M],b[M],w):E[M]=s(b[M],w))}),E}function f(g,b,w){w=w||{},w.arrayMerge=w.arrayMerge||l,w.isMergeableObject=w.isMergeableObject||t,w.cloneUnlessOtherwiseSpecified=s;var E=Array.isArray(b),M=Array.isArray(g),S=E===M;return S?E?w.arrayMerge(g,b,w):y(g,b,w):s(b,w)}f.all=function(g,b){if(!Array.isArray(g))throw new Error("first argument should be an array");return g.reduce(function(w,E){return f(w,E,b)},{})};var v=f;return Pp=v,Pp}var ND=CD();qa=Qn(ND);var X_={},Z_;function SD(){if(Z_)return X_;Z_=1;var t;return function(e){(function(n){var r=typeof globalThis=="object"?globalThis:typeof ho=="object"?ho:typeof self=="object"?self:typeof this=="object"?this:l(),o=a(e);typeof r.Reflect<"u"&&(o=a(r.Reflect,o)),n(o,r),typeof r.Reflect>"u"&&(r.Reflect=e);function a(c,d){return function(u,h){Object.defineProperty(c,u,{configurable:!0,writable:!0,value:h}),d&&d(u,h)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function l(){return i()||s()}})(function(n,r){var o=Object.prototype.hasOwnProperty,a=typeof Symbol=="function",i=a&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=a&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",l=typeof Object.create=="function",c={__proto__:[]}instanceof Array,d=!l&&!c,u={create:l?function(){return Et(Object.create(null))}:c?function(){return Et({__proto__:null})}:function(){return Et({})},has:d?function(F,W){return o.call(F,W)}:function(F,W){return W in F},get:d?function(F,W){return o.call(F,W)?F[W]:void 0}:function(F,W){return F[W]}},h=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:tn(),y=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Sn(),f=typeof WeakMap=="function"?WeakMap:Tt(),v=a?Symbol.for("@reflect-metadata:registry"):void 0,g=tt(),b=ct(g);function w(F,W,Q,ee){if(H(Q)){if(!X(F))throw new TypeError;if(!he(W))throw new TypeError;return L(F,W)}else{if(!X(F))throw new TypeError;if(!J(W))throw new TypeError;if(!J(ee)&&!H(ee)&&!G(ee))throw new TypeError;return G(ee)&&(ee=void 0),Q=ie(Q),C(F,W,Q,ee)}}n("decorate",w);function E(F,W){function Q(ee,ve){if(!J(ee))throw new TypeError;if(!H(ve)&&!ge(ve))throw new TypeError;A(F,W,ee,ve)}return Q}n("metadata",E);function M(F,W,Q,ee){if(!J(Q))throw new TypeError;return H(ee)||(ee=ie(ee)),A(F,W,Q,ee)}n("defineMetadata",M);function S(F,W,Q){if(!J(W))throw new TypeError;return H(Q)||(Q=ie(Q)),P(F,W,Q)}n("hasMetadata",S);function N(F,W,Q){if(!J(W))throw new TypeError;return H(Q)||(Q=ie(Q)),j(F,W,Q)}n("hasOwnMetadata",N);function _(F,W,Q){if(!J(W))throw new TypeError;return H(Q)||(Q=ie(Q)),D(F,W,Q)}n("getMetadata",_);function O(F,W,Q){if(!J(W))throw new TypeError;return H(Q)||(Q=ie(Q)),R(F,W,Q)}n("getOwnMetadata",O);function k(F,W){if(!J(F))throw new TypeError;return H(W)||(W=ie(W)),V(F,W)}n("getMetadataKeys",k);function I(F,W){if(!J(F))throw new TypeError;return H(W)||(W=ie(W)),q(F,W)}n("getOwnMetadataKeys",I);function B(F,W,Q){if(!J(W))throw new TypeError;if(H(Q)||(Q=ie(Q)),!J(W))throw new TypeError;H(Q)||(Q=ie(Q));var ee=ut(W,Q,!1);return H(ee)?!1:ee.OrdinaryDeleteMetadata(F,W,Q)}n("deleteMetadata",B);function L(F,W){for(var Q=F.length-1;Q>=0;--Q){var ee=F[Q],ve=ee(W);if(!H(ve)&&!G(ve)){if(!he(ve))throw new TypeError;W=ve}}return W}function C(F,W,Q,ee){for(var ve=F.length-1;ve>=0;--ve){var Ge=F[ve],Ke=Ge(W,Q,ee);if(!H(Ke)&&!G(Ke)){if(!J(Ke))throw new TypeError;ee=Ke}}return ee}function P(F,W,Q){var ee=j(F,W,Q);if(ee)return!0;var ve=Ze(W);return G(ve)?!1:P(F,ve,Q)}function j(F,W,Q){var ee=ut(W,Q,!1);return H(ee)?!1:te(ee.OrdinaryHasOwnMetadata(F,W,Q))}function D(F,W,Q){var ee=j(F,W,Q);if(ee)return R(F,W,Q);var ve=Ze(W);if(!G(ve))return D(F,ve,Q)}function R(F,W,Q){var ee=ut(W,Q,!1);if(!H(ee))return ee.OrdinaryGetOwnMetadata(F,W,Q)}function A(F,W,Q,ee){var ve=ut(Q,ee,!0);ve.OrdinaryDefineOwnMetadata(F,W,Q,ee)}function V(F,W){var Q=q(F,W),ee=Ze(F);if(ee===null)return Q;var ve=V(ee,W);if(ve.length<=0)return Q;if(Q.length<=0)return ve;for(var Ge=new y,Ke=[],Se=0,le=Q;Se<le.length;Se++){var ue=le[Se],fe=Ge.has(ue);fe||(Ge.add(ue),Ke.push(ue))}for(var me=0,Ee=ve;me<Ee.length;me++){var ue=Ee[me],fe=Ge.has(ue);fe||(Ge.add(ue),Ke.push(ue))}return Ke}function q(F,W){var Q=ut(F,W,!1);return Q?Q.OrdinaryOwnMetadataKeys(F,W):[]}function Y(F){if(F===null)return 1;switch(typeof F){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return F===null?1:6;default:return 6}}function H(F){return F===void 0}function G(F){return F===null}function Z(F){return typeof F=="symbol"}function J(F){return typeof F=="object"?F!==null:typeof F=="function"}function ce(F,W){switch(Y(F)){case 0:return F;case 1:return F;case 2:return F;case 3:return F;case 4:return F;case 5:return F}var Q="string",ee=st(F,i);if(ee!==void 0){var ve=ee.call(F,Q);if(J(ve))throw new TypeError;return ve}return U(F)}function U(F,W){var Q,ee;{var ve=F.toString;if(oe(ve)){var ee=ve.call(F);if(!J(ee))return ee}var Q=F.valueOf;if(oe(Q)){var ee=Q.call(F);if(!J(ee))return ee}}throw new TypeError}function te(F){return!!F}function re(F){return""+F}function ie(F){var W=ce(F);return Z(W)?W:re(W)}function X(F){return Array.isArray?Array.isArray(F):F instanceof Object?F instanceof Array:Object.prototype.toString.call(F)==="[object Array]"}function oe(F){return typeof F=="function"}function he(F){return typeof F=="function"}function ge(F){switch(Y(F)){case 3:return!0;case 4:return!0;default:return!1}}function Ve(F,W){return F===W||F!==F&&W!==W}function st(F,W){var Q=F[W];if(Q!=null){if(!oe(Q))throw new TypeError;return Q}}function Re(F){var W=st(F,s);if(!oe(W))throw new TypeError;var Q=W.call(F);if(!J(Q))throw new TypeError;return Q}function De(F){return F.value}function et(F){var W=F.next();return W.done?!1:W}function We(F){var W=F.return;W&&W.call(F)}function Ze(F){var W=Object.getPrototypeOf(F);if(typeof F!="function"||F===h||W!==h)return W;var Q=F.prototype,ee=Q&&Object.getPrototypeOf(Q);if(ee==null||ee===Object.prototype)return W;var ve=ee.constructor;return typeof ve!="function"||ve===F?W:ve}function wt(){var F;!H(v)&&typeof r.Reflect<"u"&&!(v in r.Reflect)&&typeof r.Reflect.defineMetadata=="function"&&(F=ft(r.Reflect));var W,Q,ee,ve=new f,Ge={registerProvider:Ke,getProvider:le,setProvider:fe};return Ge;function Ke(me){if(!Object.isExtensible(Ge))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case F===me:break;case H(W):W=me;break;case W===me:break;case H(Q):Q=me;break;case Q===me:break;default:ee===void 0&&(ee=new y),ee.add(me);break}}function Se(me,Ee){if(!H(W)){if(W.isProviderFor(me,Ee))return W;if(!H(Q)){if(Q.isProviderFor(me,Ee))return W;if(!H(ee))for(var Le=Re(ee);;){var Ye=et(Le);if(!Ye)return;var gt=De(Ye);if(gt.isProviderFor(me,Ee))return We(Le),gt}}}if(!H(F)&&F.isProviderFor(me,Ee))return F}function le(me,Ee){var Le=ve.get(me),Ye;return H(Le)||(Ye=Le.get(Ee)),H(Ye)&&(Ye=Se(me,Ee),H(Ye)||(H(Le)&&(Le=new p,ve.set(me,Le)),Le.set(Ee,Ye))),Ye}function ue(me){if(H(me))throw new TypeError;return W===me||Q===me||!H(ee)&&ee.has(me)}function fe(me,Ee,Le){if(!ue(Le))throw new Error("Metadata provider not registered.");var Ye=le(me,Ee);if(Ye!==Le){if(!H(Ye))return!1;var gt=ve.get(me);H(gt)&&(gt=new p,ve.set(me,gt)),gt.set(Ee,Le)}return!0}}function tt(){var F;return!H(v)&&J(r.Reflect)&&Object.isExtensible(r.Reflect)&&(F=r.Reflect[v]),H(F)&&(F=wt()),!H(v)&&J(r.Reflect)&&Object.isExtensible(r.Reflect)&&Object.defineProperty(r.Reflect,v,{enumerable:!1,configurable:!1,writable:!1,value:F}),F}function ct(F){var W=new f,Q={isProviderFor:function(ue,fe){var me=W.get(ue);return H(me)?!1:me.has(fe)},OrdinaryDefineOwnMetadata:Ke,OrdinaryHasOwnMetadata:ve,OrdinaryGetOwnMetadata:Ge,OrdinaryOwnMetadataKeys:Se,OrdinaryDeleteMetadata:le};return g.registerProvider(Q),Q;function ee(ue,fe,me){var Ee=W.get(ue),Le=!1;if(H(Ee)){if(!me)return;Ee=new p,W.set(ue,Ee),Le=!0}var Ye=Ee.get(fe);if(H(Ye)){if(!me)return;if(Ye=new p,Ee.set(fe,Ye),!F.setProvider(ue,fe,Q))throw Ee.delete(fe),Le&&W.delete(ue),new Error("Wrong provider for target.")}return Ye}function ve(ue,fe,me){var Ee=ee(fe,me,!1);return H(Ee)?!1:te(Ee.has(ue))}function Ge(ue,fe,me){var Ee=ee(fe,me,!1);if(!H(Ee))return Ee.get(ue)}function Ke(ue,fe,me,Ee){var Le=ee(me,Ee,!0);Le.set(ue,fe)}function Se(ue,fe){var me=[],Ee=ee(ue,fe,!1);if(H(Ee))return me;for(var Le=Ee.keys(),Ye=Re(Le),gt=0;;){var oo=et(Ye);if(!oo)return me.length=gt,me;var ao=De(oo);try{me[gt]=ao}catch(zn){try{We(Ye)}finally{throw zn}}gt++}}function le(ue,fe,me){var Ee=ee(fe,me,!1);if(H(Ee)||!Ee.delete(ue))return!1;if(Ee.size===0){var Le=W.get(fe);H(Le)||(Le.delete(me),Le.size===0&&W.delete(Le))}return!0}}function ft(F){var W=F.defineMetadata,Q=F.hasOwnMetadata,ee=F.getOwnMetadata,ve=F.getOwnMetadataKeys,Ge=F.deleteMetadata,Ke=new f,Se={isProviderFor:function(le,ue){var fe=Ke.get(le);return!H(fe)&&fe.has(ue)?!0:ve(le,ue).length?(H(fe)&&(fe=new y,Ke.set(le,fe)),fe.add(ue),!0):!1},OrdinaryDefineOwnMetadata:W,OrdinaryHasOwnMetadata:Q,OrdinaryGetOwnMetadata:ee,OrdinaryOwnMetadataKeys:ve,OrdinaryDeleteMetadata:Ge};return Se}function ut(F,W,Q){var ee=g.getProvider(F,W);if(!H(ee))return ee;if(Q){if(g.setProvider(F,W,b))return b;throw new Error("Illegal state.")}}function tn(){var F={},W=[],Q=function(){function Se(le,ue,fe){this._index=0,this._keys=le,this._values=ue,this._selector=fe}return Se.prototype["@@iterator"]=function(){return this},Se.prototype[s]=function(){return this},Se.prototype.next=function(){var le=this._index;if(le>=0&&le<this._keys.length){var ue=this._selector(this._keys[le],this._values[le]);return le+1>=this._keys.length?(this._index=-1,this._keys=W,this._values=W):this._index++,{value:ue,done:!1}}return{value:void 0,done:!0}},Se.prototype.throw=function(le){throw this._index>=0&&(this._index=-1,this._keys=W,this._values=W),le},Se.prototype.return=function(le){return this._index>=0&&(this._index=-1,this._keys=W,this._values=W),{value:le,done:!0}},Se}(),ee=function(){function Se(){this._keys=[],this._values=[],this._cacheKey=F,this._cacheIndex=-2}return Object.defineProperty(Se.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Se.prototype.has=function(le){return this._find(le,!1)>=0},Se.prototype.get=function(le){var ue=this._find(le,!1);return ue>=0?this._values[ue]:void 0},Se.prototype.set=function(le,ue){var fe=this._find(le,!0);return this._values[fe]=ue,this},Se.prototype.delete=function(le){var ue=this._find(le,!1);if(ue>=0){for(var fe=this._keys.length,me=ue+1;me<fe;me++)this._keys[me-1]=this._keys[me],this._values[me-1]=this._values[me];return this._keys.length--,this._values.length--,Ve(le,this._cacheKey)&&(this._cacheKey=F,this._cacheIndex=-2),!0}return!1},Se.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=F,this._cacheIndex=-2},Se.prototype.keys=function(){return new Q(this._keys,this._values,ve)},Se.prototype.values=function(){return new Q(this._keys,this._values,Ge)},Se.prototype.entries=function(){return new Q(this._keys,this._values,Ke)},Se.prototype["@@iterator"]=function(){return this.entries()},Se.prototype[s]=function(){return this.entries()},Se.prototype._find=function(le,ue){if(!Ve(this._cacheKey,le)){this._cacheIndex=-1;for(var fe=0;fe<this._keys.length;fe++)if(Ve(this._keys[fe],le)){this._cacheIndex=fe;break}}return this._cacheIndex<0&&ue&&(this._cacheIndex=this._keys.length,this._keys.push(le),this._values.push(void 0)),this._cacheIndex},Se}();return ee;function ve(Se,le){return Se}function Ge(Se,le){return le}function Ke(Se,le){return[Se,le]}}function Sn(){var F=function(){function W(){this._map=new p}return Object.defineProperty(W.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),W.prototype.has=function(Q){return this._map.has(Q)},W.prototype.add=function(Q){return this._map.set(Q,Q),this},W.prototype.delete=function(Q){return this._map.delete(Q)},W.prototype.clear=function(){this._map.clear()},W.prototype.keys=function(){return this._map.keys()},W.prototype.values=function(){return this._map.keys()},W.prototype.entries=function(){return this._map.entries()},W.prototype["@@iterator"]=function(){return this.keys()},W.prototype[s]=function(){return this.keys()},W}();return F}function Tt(){var F=16,W=u.create(),Q=ee();return function(){function le(){this._key=ee()}return le.prototype.has=function(ue){var fe=ve(ue,!1);return fe!==void 0?u.has(fe,this._key):!1},le.prototype.get=function(ue){var fe=ve(ue,!1);return fe!==void 0?u.get(fe,this._key):void 0},le.prototype.set=function(ue,fe){var me=ve(ue,!0);return me[this._key]=fe,this},le.prototype.delete=function(ue){var fe=ve(ue,!1);return fe!==void 0?delete fe[this._key]:!1},le.prototype.clear=function(){this._key=ee()},le}();function ee(){var le;do le="@@WeakMap@@"+Se();while(u.has(W,le));return W[le]=!0,le}function ve(le,ue){if(!o.call(le,Q)){if(!ue)return;Object.defineProperty(le,Q,{value:u.create()})}return le[Q]}function Ge(le,ue){for(var fe=0;fe<ue;++fe)le[fe]=Math.random()*255|0;return le}function Ke(le){if(typeof Uint8Array=="function"){var ue=new Uint8Array(le);return typeof crypto<"u"?crypto.getRandomValues(ue):typeof msCrypto<"u"?msCrypto.getRandomValues(ue):Ge(ue,le),ue}return Ge(new Array(le),le)}function Se(){var le=Ke(F);le[6]=le[6]&79|64,le[8]=le[8]&191|128;for(var ue="",fe=0;fe<F;++fe){var me=le[fe];(fe===4||fe===6||fe===8)&&(ue+="-"),me<16&&(ue+="0"),ue+=me.toString(16).toLowerCase()}return ue}}function Et(F){return F.__=void 0,delete F.__,F}})}(t||(t={})),X_}SD(),jl=globalThis||void 0||self,typeof window<"u"&&(window.Buffer=H6),typeof jl<"u"&&typeof require<"u"&&(jl.Buffer=require("buffer/").Buffer);class it{static isObject(e){return e!==null&&typeof e=="object"}static isObjectWithName(e){return e!==null&&typeof e=="object"&&e.name!==void 0}static assign(e,...n){for(const r of n)for(const o of Object.getOwnPropertyNames(r))e[o]=r[o]}static mixedListToArray(e){return e!==null&&typeof e=="object"?Object.keys(e).map(n=>e[n]):e}}class de extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}class Gr extends de{constructor(){super("Locking not supported on given driver.")}}class Tp extends de{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}class ze{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return typeof e=="function"&&typeof e.hasId=="function"&&typeof e.save=="function"&&typeof e.useDataSource=="function"}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,n){return typeof e=="object"&&e!==null&&e["@instanceof"]===Symbol.for(n)}}class OD extends de{constructor(e,n){super(),this.entityClass=e,this.criteria=n,this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(n)}`}stringifyTarget(e){return ze.isEntitySchema(e)?e.options.name:typeof e=="function"||it.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch{}return""+e}}class G_ extends de{constructor(e,n,r){super(`The optimistic lock on entity ${e} failed, version ${n} was expected, but is actually ${r}.`)}}class J_ extends de{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}class AD extends de{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}class Rs extends de{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}class Jt extends de{constructor(e,n){super(e),Object.setPrototypeOf(this,Jt.prototype),this.message=`Property "${e}" was not found in "${n.targetName}". Make sure your query is correct.`}}class kD extends de{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}class jD extends de{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}class Ma extends de{constructor(){super("The optimistic lock can be used only with getOne() method.")}}class RD extends de{constructor(e){super(),e.length===1?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map(n=>`"${n}"`).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}class PD extends de{constructor(){super("An open transaction is required for pessimistic lock.")}}class TD extends de{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}class eM{constructor(e){it.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new de(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}class en{static isAliasProperty(e){if(typeof e!="string"||e.indexOf(".")===-1)return!1;const[n,r]=e.split(".");return!(!n||!r||e.indexOf("(")!==-1||e.indexOf(")")!==-1)}}var Ip={exports:{}},Dp={exports:{}},tM;function Jr(){return tM||(tM=1,typeof Object.create=="function"?Dp.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Dp.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),Dp.exports}var Lp={exports:{}},nM;function ur(){return nM||(nM=1,function(t,e){var n=q6(),r=n.Buffer;function o(i,s){for(var l in i)s[l]=i[l]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(o(n,e),e.Buffer=a);function a(i,s,l){return r(i,s,l)}a.prototype=Object.create(r.prototype),o(r,a),a.from=function(i,s,l){if(typeof i=="number")throw new TypeError("Argument must not be a number");return r(i,s,l)},a.alloc=function(i,s,l){if(typeof i!="number")throw new TypeError("Argument must be a number");var c=r(i);return s!==void 0?typeof l=="string"?c.fill(s,l):c.fill(s):c.fill(0),c},a.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return r(i)},a.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(i)}}(Lp,Lp.exports)),Lp.exports}var $p,rM;function eo(){if(rM)return $p;rM=1;var t=ur().Buffer;function e(n,r){this._block=t.alloc(n),this._finalSize=r,this._blockSize=n,this._len=0}return e.prototype.update=function(n,r){typeof n=="string"&&(r=r||"utf8",n=t.from(n,r));for(var o=this._block,a=this._blockSize,i=n.length,s=this._len,l=0;l<i;){for(var c=s%a,d=Math.min(i-l,a-c),u=0;u<d;u++)o[c+u]=n[l+u];s+=d,l+=d,s%a===0&&this._update(o)}return this._len+=i,this},e.prototype.digest=function(n){var r=this._len%this._blockSize;this._block[r]=128,this._block.fill(0,r+1),r>=this._finalSize&&(this._update(this._block),this._block.fill(0));var o=this._len*8;if(o<=4294967295)this._block.writeUInt32BE(o,this._blockSize-4);else{var a=(o&4294967295)>>>0,i=(o-a)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(a,this._blockSize-4)}this._update(this._block);var s=this._hash();return n?s.toString(n):s},e.prototype._update=function(){throw new Error("_update must be implemented by subclass")},$p=e,$p}var Bp,oM;function ID(){if(oM)return Bp;oM=1;var t=Jr(),e=eo(),n=ur().Buffer,r=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function a(){this.init(),this._w=o,e.call(this,64,56)}t(a,e),a.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function i(c){return c<<5|c>>>27}function s(c){return c<<30|c>>>2}function l(c,d,u,h){return c===0?d&u|~d&h:c===2?d&u|d&h|u&h:d^u^h}return a.prototype._update=function(c){for(var d=this._w,u=this._a|0,h=this._b|0,p=this._c|0,y=this._d|0,f=this._e|0,v=0;v<16;++v)d[v]=c.readInt32BE(v*4);for(;v<80;++v)d[v]=d[v-3]^d[v-8]^d[v-14]^d[v-16];for(var g=0;g<80;++g){var b=~~(g/20),w=i(u)+l(b,h,p,y)+f+d[g]+r[b]|0;f=y,y=p,p=s(h),h=u,u=w}this._a=u+this._a|0,this._b=h+this._b|0,this._c=p+this._c|0,this._d=y+this._d|0,this._e=f+this._e|0},a.prototype._hash=function(){var c=n.allocUnsafe(20);return c.writeInt32BE(this._a|0,0),c.writeInt32BE(this._b|0,4),c.writeInt32BE(this._c|0,8),c.writeInt32BE(this._d|0,12),c.writeInt32BE(this._e|0,16),c},Bp=a,Bp}var Fp,aM;function DD(){if(aM)return Fp;aM=1;var t=Jr(),e=eo(),n=ur().Buffer,r=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function a(){this.init(),this._w=o,e.call(this,64,56)}t(a,e),a.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function i(d){return d<<1|d>>>31}function s(d){return d<<5|d>>>27}function l(d){return d<<30|d>>>2}function c(d,u,h,p){return d===0?u&h|~u&p:d===2?u&h|u&p|h&p:u^h^p}return a.prototype._update=function(d){for(var u=this._w,h=this._a|0,p=this._b|0,y=this._c|0,f=this._d|0,v=this._e|0,g=0;g<16;++g)u[g]=d.readInt32BE(g*4);for(;g<80;++g)u[g]=i(u[g-3]^u[g-8]^u[g-14]^u[g-16]);for(var b=0;b<80;++b){var w=~~(b/20),E=s(h)+c(w,p,y,f)+v+u[b]+r[w]|0;v=f,f=y,y=l(p),p=h,h=E}this._a=h+this._a|0,this._b=p+this._b|0,this._c=y+this._c|0,this._d=f+this._d|0,this._e=v+this._e|0},a.prototype._hash=function(){var d=n.allocUnsafe(20);return d.writeInt32BE(this._a|0,0),d.writeInt32BE(this._b|0,4),d.writeInt32BE(this._c|0,8),d.writeInt32BE(this._d|0,12),d.writeInt32BE(this._e|0,16),d},Fp=a,Fp}var zp,iM;function sM(){if(iM)return zp;iM=1;var t=Jr(),e=eo(),n=ur().Buffer,r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=new Array(64);function a(){this.init(),this._w=o,e.call(this,64,56)}t(a,e),a.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function i(h,p,y){return y^h&(p^y)}function s(h,p,y){return h&p|y&(h|p)}function l(h){return(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10)}function c(h){return(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7)}function d(h){return(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3}function u(h){return(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10}return a.prototype._update=function(h){for(var p=this._w,y=this._a|0,f=this._b|0,v=this._c|0,g=this._d|0,b=this._e|0,w=this._f|0,E=this._g|0,M=this._h|0,S=0;S<16;++S)p[S]=h.readInt32BE(S*4);for(;S<64;++S)p[S]=u(p[S-2])+p[S-7]+d(p[S-15])+p[S-16]|0;for(var N=0;N<64;++N){var _=M+c(b)+i(b,w,E)+r[N]+p[N]|0,O=l(y)+s(y,f,v)|0;M=E,E=w,w=b,b=g+_|0,g=v,v=f,f=y,y=_+O|0}this._a=y+this._a|0,this._b=f+this._b|0,this._c=v+this._c|0,this._d=g+this._d|0,this._e=b+this._e|0,this._f=w+this._f|0,this._g=E+this._g|0,this._h=M+this._h|0},a.prototype._hash=function(){var h=n.allocUnsafe(32);return h.writeInt32BE(this._a,0),h.writeInt32BE(this._b,4),h.writeInt32BE(this._c,8),h.writeInt32BE(this._d,12),h.writeInt32BE(this._e,16),h.writeInt32BE(this._f,20),h.writeInt32BE(this._g,24),h.writeInt32BE(this._h,28),h},zp=a,zp}var Vp,lM;function LD(){if(lM)return Vp;lM=1;var t=Jr(),e=sM(),n=eo(),r=ur().Buffer,o=new Array(64);function a(){this.init(),this._w=o,n.call(this,64,56)}return t(a,e),a.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},a.prototype._hash=function(){var i=r.allocUnsafe(28);return i.writeInt32BE(this._a,0),i.writeInt32BE(this._b,4),i.writeInt32BE(this._c,8),i.writeInt32BE(this._d,12),i.writeInt32BE(this._e,16),i.writeInt32BE(this._f,20),i.writeInt32BE(this._g,24),i},Vp=a,Vp}var Wp,cM;function uM(){if(cM)return Wp;cM=1;var t=Jr(),e=eo(),n=ur().Buffer,r=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],o=new Array(160);function a(){this.init(),this._w=o,e.call(this,128,112)}t(a,e),a.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function i(f,v,g){return g^f&(v^g)}function s(f,v,g){return f&v|g&(f|v)}function l(f,v){return(f>>>28|v<<4)^(v>>>2|f<<30)^(v>>>7|f<<25)}function c(f,v){return(f>>>14|v<<18)^(f>>>18|v<<14)^(v>>>9|f<<23)}function d(f,v){return(f>>>1|v<<31)^(f>>>8|v<<24)^f>>>7}function u(f,v){return(f>>>1|v<<31)^(f>>>8|v<<24)^(f>>>7|v<<25)}function h(f,v){return(f>>>19|v<<13)^(v>>>29|f<<3)^f>>>6}function p(f,v){return(f>>>19|v<<13)^(v>>>29|f<<3)^(f>>>6|v<<26)}function y(f,v){return f>>>0<v>>>0?1:0}return a.prototype._update=function(f){for(var v=this._w,g=this._ah|0,b=this._bh|0,w=this._ch|0,E=this._dh|0,M=this._eh|0,S=this._fh|0,N=this._gh|0,_=this._hh|0,O=this._al|0,k=this._bl|0,I=this._cl|0,B=this._dl|0,L=this._el|0,C=this._fl|0,P=this._gl|0,j=this._hl|0,D=0;D<32;D+=2)v[D]=f.readInt32BE(D*4),v[D+1]=f.readInt32BE(D*4+4);for(;D<160;D+=2){var R=v[D-30],A=v[D-15*2+1],V=d(R,A),q=u(A,R);R=v[D-2*2],A=v[D-2*2+1];var Y=h(R,A),H=p(A,R),G=v[D-7*2],Z=v[D-7*2+1],J=v[D-16*2],ce=v[D-16*2+1],U=q+Z|0,te=V+G+y(U,q)|0;U=U+H|0,te=te+Y+y(U,H)|0,U=U+ce|0,te=te+J+y(U,ce)|0,v[D]=te,v[D+1]=U}for(var re=0;re<160;re+=2){te=v[re],U=v[re+1];var ie=s(g,b,w),X=s(O,k,I),oe=l(g,O),he=l(O,g),ge=c(M,L),Ve=c(L,M),st=r[re],Re=r[re+1],De=i(M,S,N),et=i(L,C,P),We=j+Ve|0,Ze=_+ge+y(We,j)|0;We=We+et|0,Ze=Ze+De+y(We,et)|0,We=We+Re|0,Ze=Ze+st+y(We,Re)|0,We=We+U|0,Ze=Ze+te+y(We,U)|0;var wt=he+X|0,tt=oe+ie+y(wt,he)|0;_=N,j=P,N=S,P=C,S=M,C=L,L=B+We|0,M=E+Ze+y(L,B)|0,E=w,B=I,w=b,I=k,b=g,k=O,O=We+wt|0,g=Ze+tt+y(O,We)|0}this._al=this._al+O|0,this._bl=this._bl+k|0,this._cl=this._cl+I|0,this._dl=this._dl+B|0,this._el=this._el+L|0,this._fl=this._fl+C|0,this._gl=this._gl+P|0,this._hl=this._hl+j|0,this._ah=this._ah+g+y(this._al,O)|0,this._bh=this._bh+b+y(this._bl,k)|0,this._ch=this._ch+w+y(this._cl,I)|0,this._dh=this._dh+E+y(this._dl,B)|0,this._eh=this._eh+M+y(this._el,L)|0,this._fh=this._fh+S+y(this._fl,C)|0,this._gh=this._gh+N+y(this._gl,P)|0,this._hh=this._hh+_+y(this._hl,j)|0},a.prototype._hash=function(){var f=n.allocUnsafe(64);function v(g,b,w){f.writeInt32BE(g,w),f.writeInt32BE(b,w+4)}return v(this._ah,this._al,0),v(this._bh,this._bl,8),v(this._ch,this._cl,16),v(this._dh,this._dl,24),v(this._eh,this._el,32),v(this._fh,this._fl,40),v(this._gh,this._gl,48),v(this._hh,this._hl,56),f},Wp=a,Wp}var Up,dM;function $D(){if(dM)return Up;dM=1;var t=Jr(),e=uM(),n=eo(),r=ur().Buffer,o=new Array(160);function a(){this.init(),this._w=o,n.call(this,128,112)}return t(a,e),a.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},a.prototype._hash=function(){var i=r.allocUnsafe(48);function s(l,c,d){i.writeInt32BE(l,d),i.writeInt32BE(c,d+4)}return s(this._ah,this._al,0),s(this._bh,this._bl,8),s(this._ch,this._cl,16),s(this._dh,this._dl,24),s(this._eh,this._el,32),s(this._fh,this._fl,40),i},Up=a,Up}var hM;function BD(){if(hM)return Ip.exports;hM=1;var t=Ip.exports=function(e){e=e.toLowerCase();var n=t[e];if(!n)throw new Error(e+" is not supported (we accept pull requests)");return new n};return t.sha=ID(),t.sha1=DD(),t.sha224=LD(),t.sha256=sM(),t.sha384=$D(),t.sha512=uM(),Ip.exports}var FD=BD();const zD=Qn(FD);function VD(t,e={}){const{segmentLength:n=4,separator:r="__",termLength:o=2}=e;return t.split(r).reduce((a,i)=>{const s=i.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),l=s.length>1?o:n,c=s.map(d=>d.substr(0,l)).join("");return a.push(c),a},[]).join(r)}function WD(t,e={}){const n=zD("sha1");n.update(t,"utf8");const r=n.digest("hex");return e.length?r.slice(0,e.length):r}class UD{static isGreaterOrEqual(e,n){const r=pM(e),o=pM(n);return r[0]>o[0]||r[0]===o[0]&&r[1]>o[1]||r[0]===o[0]&&r[1]===o[1]&&r[2]>=o[2]}}function pM(t=""){const e=[0,0,0];return t.split(".").forEach((n,r)=>e[r]=parseInt(n,10)),e}class se{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,n){return e.version!=null&&UD.isGreaterOrEqual(e.version,n)}static isPostgresFamily(e){return["postgres","aurora-postgres","cockroachdb"].includes(e.options.type)}static buildDriverOptions(e,n){if(e.url){const r=this.parseConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const o of Object.keys(r))typeof r[o]>"u"&&delete r[o];return Object.assign({},e,r)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,n){if(e.url){const r=this.parseMongoDBConnectionUrl(e.url);n&&n.useSid&&r.database&&(r.sid=r.database);for(const o of Object.keys(r))typeof r[o]>"u"&&delete r[o];return Object.assign({},e,r)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},n,...r){const o=n&&n.joiner?n.joiner:"_";let a=r.length===1?r[0]:r.join(o);if(e&&e>0&&a.length>e){if(n&&n.shorten===!0){const i=VD(a);if(i.length<e)return i}return WD(a,{length:e})}return a}static buildColumnAlias({maxAliasLength:e},n,...r){return typeof n=="string"?(r.unshift(n),n={shorten:!1,joiner:"_"}):n=Object.assign({shorten:!1,joiner:"_"},n),this.buildAlias({maxAliasLength:e},n,...r)}static parseConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),o=e.substr(r+2),a=o.indexOf("/"),i=a!==-1?o.substr(0,a):o;let s=a!==-1?o.substr(a+1):void 0;s&&s.indexOf("?")!==-1&&(s=s.substr(0,s.indexOf("?")));const l=i.lastIndexOf("@"),c=i.substr(0,l),d=i.substr(l+1);let u=c,h="";const p=c.indexOf(":");p!==-1&&(u=c.substr(0,p),h=c.substr(p+1));const[y,f]=d.split(":");return{type:n,host:y,username:decodeURIComponent(u),password:decodeURIComponent(h),port:f?parseInt(f):void 0,database:s||void 0}}static parseMongoDBConnectionUrl(e){const n=e.split(":")[0],r=e.indexOf("//"),o=e.substr(r+2),a=o.indexOf("/"),i=a!==-1?o.substr(0,a):o;let s=a!==-1?o.substr(a+1):void 0,l="",c,d,u,h,p={};if(s&&s.indexOf("?")!==-1){l=s.substr(s.indexOf("?")+1,s.length);const M=l.split("&");let S,N;M.forEach(_=>{S=_.split("=")[0],N=_.split("=")[1],p[S]=N}),h=p.replicaSet,s=s.substr(0,s.indexOf("?"))}const y=i.lastIndexOf("@"),f=i.substr(0,y),v=i.substr(y+1);let g=f,b="";const w=f.indexOf(":");w!==-1&&(g=f.substr(0,w),b=f.substr(w+1)),h?u=v:[c,d]=v.split(":");let E={type:n,host:c,hostReplicaSet:u,username:decodeURIComponent(g),password:decodeURIComponent(b),port:d?parseInt(d):void 0,database:s||void 0};for(const[M,S]of Object.entries(p))E[M]=S;return E}}class fM{constructor(e,n,r){this.connection=e,this.queryExpressionMap=n,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,r&&it.assign(this,r)}get isMany(){return this.isMappingMany!==void 0?this.isMappingMany:this.relation?this.relation.isManyToMany||this.relation.isOneToMany:!1}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const n of this.queryExpressionMap.selects)if(n.selection===this.alias.name||this.metadata&&this.metadata.columns.find(r=>n.selection===this.alias.name+"."+r.propertyPath))return!0;return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(en.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(en.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!en.isAliasProperty(this.entityOrProperty))return;const n=this.queryExpressionMap.findAliasByName(this.parentAlias);let r=n.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(r||n.metadata.parentEntityMetadata&&(r=n.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),r))return r;throw new de(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){if(this.relation)return this.relation.inverseEntityMetadata;if(this.connection.hasMetadata(this.entityOrProperty))return this.connection.getMetadata(this.entityOrProperty);if(this.mapAsEntity&&this.connection.hasMetadata(this.mapAsEntity))return this.connection.getMetadata(this.mapAsEntity)}get junctionAlias(){if(!this.relation)throw new de("Cannot get junction table for join without relation.");if(typeof this.entityOrProperty!="string")throw new de("Junction property is not defined.");const e=this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."));return this.relation.isOwning?se.buildAlias(this.connection.driver,void 0,e,this.alias.name):se.buildAlias(this.connection.driver,void 0,this.alias.name,e)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}class Hp{constructor(e,n){this.queryExpressionMap=e,this.disableMixedMap=!1,it.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!en.isAliasProperty(this.relationName))throw new de("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!en.isAliasProperty(this.relationName))throw new de("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!en.isAliasProperty(this.relationName))throw new de("Given value must be a string representation of alias property");const e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new de(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return e}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}class qp{constructor(e,n){this.expressionMap=e,it.assign(this,n||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!en.isAliasProperty(this.relationName))throw new de("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!en.isAliasProperty(this.relationName))throw new de("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,n]=this.relationName.split(".");return e+"_"+n+"_rc"}get relation(){if(!en.isAliasProperty(this.relationName))throw new de("Given value is a string representation of alias property");const[e,n]=this.relationName.split("."),r=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(n);if(!r)throw new de(`Relation with property path ${n} in entity was not found.`);return r}get metadata(){if(!en.isAliasProperty(this.relationName))throw new de("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}class Qp{constructor(e){var n;this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy),this.timeTravel=((n=e.options)==null?void 0:n.timeTravelQueries)||!1}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&this.options.indexOf("disable-global-order")===-1){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce((n,r)=>(n[this.mainAlias.name+"."+r]=e[r],n),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let n=e.name;!n&&e.tablePath&&(n=e.tablePath),!n&&typeof e.target=="function"&&(n=e.target.name),!n&&typeof e.target=="string"&&(n=e.target);const r=new eM;return r.type=e.type,n&&(r.name=n),e.metadata&&(r.metadata=e.metadata),e.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(r.tablePath=e.tablePath),e.subQuery&&(r.subQuery=e.subQuery),this.aliases.push(r),r}findAliasByName(e){const n=this.aliases.find(r=>r.name===e);if(!n)throw new de(`"${e}" alias was not found. Maybe you forgot to join it?`);return n}findColumnByAliasExpression(e){const[n,r]=e.split(".");return this.findAliasByName(n).metadata.findColumnWithPropertyName(r)}get relationMetadata(){if(!this.mainAlias)throw new de("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new de(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new Qp(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map(n=>n),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(n=>e.aliases.push(new eM(n))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map(n=>new fM(this.connection,this,n)),e.relationIdAttributes=this.relationIdAttributes.map(n=>new Hp(this,n)),e.relationCountAttributes=this.relationCountAttributes.map(n=>new qp(this,n)),e.wheres=this.wheres.map(n=>({...n})),e.havings=this.havings.map(n=>({...n})),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map(n=>n),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.timeTravel=this.timeTravel,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map(n=>({alias:n.alias,queryBuilder:typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.clone(),options:n.options})),e}}class mM{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}class Kp{static transformFrom(e,n){return Array.isArray(e)?e.slice().reverse().reduce((r,o)=>o.from(r),n):e.from(n)}static transformTo(e,n){return Array.isArray(e)?e.reduce((r,o)=>o.to(r),n):e.to(n)}}class Ca{constructor(e,n,r=!0,o=!1,a,i){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=n,this._useParameter=r,this._multipleParameters=o,this._getSql=a,this._objectLiteralParameters=i}get useParameter(){return ze.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return ze.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return ze.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return ze.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(ze.isFindOperator(this._value))return this._value}get getSql(){return ze.isFindOperator(this._value)?this._value.getSql:this._getSql}transformValue(e){this._value instanceof Ca?this._value.transformValue(e):this._value=Array.isArray(this._value)&&this._multipleParameters?this._value.map(n=>e&&Kp.transformTo(e,n)):Kp.transformTo(e,this._value)}}mo=function(t){return new Ca("in",t,!0,!0)};const HD=/[.*+\-?^${}()|[\]\\]/g,qD=t=>t.replace(HD,"\\$&");class Je{constructor(e,n){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,ze.isDataSource(e)?(this.connection=e,this.queryRunner=n,this.expressionMap=new Qp(this.connection)):(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone())}static registerQueryBuilderClass(e,n){Je.queryBuilderRegistry[e]=n}get alias(){if(!this.expressionMap.mainAlias)throw new de("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,n){return this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map(r=>({selection:r})):e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]),ze.isSelectQueryBuilder(this)?this:Je.queryBuilderRegistry.SelectQueryBuilder(this)}insert(){return this.expressionMap.queryType="insert",ze.isInsertQueryBuilder(this)?this:Je.queryBuilderRegistry.InsertQueryBuilder(this)}update(e,n){const r=n||e;if(e=ze.isEntitySchema(e)?e.options.name:e,typeof e=="function"||typeof e=="string"){const o=this.createFromAlias(e);this.expressionMap.setMainAlias(o)}return this.expressionMap.queryType="update",this.expressionMap.valuesSet=r,ze.isUpdateQueryBuilder(this)?this:Je.queryBuilderRegistry.UpdateQueryBuilder(this)}delete(){return this.expressionMap.queryType="delete",ze.isDeleteQueryBuilder(this)?this:Je.queryBuilderRegistry.DeleteQueryBuilder(this)}softDelete(){return this.expressionMap.queryType="soft-delete",ze.isSoftDeleteQueryBuilder(this)?this:Je.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}restore(){return this.expressionMap.queryType="restore",ze.isSoftDeleteQueryBuilder(this)?this:Je.queryBuilderRegistry.SoftDeleteQueryBuilder(this)}relation(e,n){const r=arguments.length===2?e:void 0,o=arguments.length===2?n:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=o,r){const a=this.createFromAlias(r);this.expressionMap.setMainAlias(a)}return ze.isRelationQueryBuilder(this)?this:Je.queryBuilderRegistry.RelationQueryBuilder(this)}hasRelation(e,n){const r=this.connection.getMetadata(e);return(Array.isArray(n)?n:[n]).every(o=>!!r.findRelationWithPropertyPath(o))}hasParameter(e){var n;return((n=this.parentQueryBuilder)==null?void 0:n.hasParameter(e))||e in this.expressionMap.parameters}setParameter(e,n){if(typeof n=="function")throw new de(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new de("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,n),this.expressionMap.parameters[e]=n,this}setParameters(e){for(const[n,r]of Object.entries(e))this.setParameter(n,r);return this}createParameter(e){let n;do n=`orm_param_${this.parameterIndex++}`;while(this.hasParameter(n));return this.setParameter(n,e),`:${n}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(n=>{this.expressionMap.nativeParameters[n]=e[n]}),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const n=this.expressionMap.mainAlias.metadata;if(n.discriminatorColumn&&n.parentEntityMetadata){const r=n.childEntityMetadatas.filter(o=>o.discriminatorColumn).map(o=>o.discriminatorValue);r.push(n.discriminatorValue),e.discriminatorColumnValues=r}}return e}printSql(){const[e,n]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,n),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),n=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,n,this.expressionMap.nativeParameters)}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();try{return await r.query(e,n)}finally{r!==this.queryRunner&&await r.release()}}createQueryBuilder(e){return new this.constructor(this.connection,e??this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,n,r){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:n,options:r||{}}),this}getTableName(e){return e.split(".").map(n=>n===""?n:this.escape(n)).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new de('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,n){if(this.connection.hasMetadata(e)){const r=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:n,metadata:this.connection.getMetadata(e),tablePath:r.tablePath})}else{if(typeof e=="string"){const a=e.substr(0,1)==="("&&e.substr(-1)===")";return this.expressionMap.createAlias({type:"from",name:n,tablePath:a?void 0:e,subQuery:a?e:void 0})}const r=e(this.subQuery());this.setParameters(r.getParameters());const o=r.getQuery();return this.expressionMap.createAlias({type:"from",name:n,subQuery:o})}}replacePropertyNames(e){return e}replacePropertyNamesForTheWholeQuery(e){const n={};for(const a of this.expressionMap.aliases){if(!a.hasMetadata)continue;const i=this.expressionMap.aliasNamePrefixingEnabled&&a.name?`${a.name}.`:"";n[i]||(n[i]={});for(const s of a.metadata.relations)s.joinColumns.length>0&&(n[i][s.propertyPath]=s.joinColumns[0].databaseName);for(const s of a.metadata.relations){const l=[...s.joinColumns,...s.inverseJoinColumns];for(const c of l){const d=`${s.propertyPath}.${c.referencedColumn.propertyPath}`;n[i][d]=c.databaseName}}for(const s of a.metadata.columns)n[i][s.databaseName]=s.databaseName;for(const s of a.metadata.columns)n[i][s.propertyName]=s.databaseName;for(const s of a.metadata.columns)n[i][s.propertyPath]=s.databaseName}const r=Object.keys(n),o=r.map(a=>qD(a)).join("|");return r.length>0&&(e=e.replace(new RegExp(`([ =(]|^.{0})${o?"("+o+")":""}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),(...a)=>{let i,s,l;if(o){if(i=a[0],s=a[1],l=a[3],n[a[2]][l])return`${s}${this.escape(a[2].substring(0,a[2].length-1))}.${this.escape(n[a[2]][l])}`}else if(i=a[0],s=a[1],l=a[2],n[""][l])return`${s}${this.escape(n[""][l])}`;return i})),e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace(/\*\//g,"")} */ `:""}createTimeTravelQuery(){return this.expressionMap.queryType==="select"&&this.expressionMap.timeTravel?` AS OF SYSTEM TIME ${this.expressionMap.timeTravel}`:""}createWhereExpression(){const e=[],n=this.createWhereClausesExpression(this.expressionMap.wheres);if(n.length>0&&n!=="1=1"&&e.push(this.replacePropertyNames(n)),this.expressionMap.mainAlias.hasMetadata){const o=this.expressionMap.mainAlias.metadata;if(this.expressionMap.queryType==="select"&&!this.expressionMap.withDeleted&&o.deleteDateColumn){const a=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+o.deleteDateColumn.propertyName:o.deleteDateColumn.propertyName,i=`${this.replacePropertyNames(a)} IS NULL`;e.push(i)}if(o.discriminatorColumn&&o.parentEntityMetadata){const a=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+o.discriminatorColumn.databaseName:o.discriminatorColumn.databaseName,i=`${this.replacePropertyNames(a)} IN (:...discriminatorColumnValues)`;e.push(i)}}if(this.expressionMap.extraAppendedAndWhereCondition){const o=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(o)}let r="";return r+=this.createTimeTravelQuery(),e.length?e.length===1?r+=` WHERE ${e[0]}`:r+=` WHERE ( ${e.join(" ) AND ( ")} )`:r+="",r}createReturningExpression(e){const n=this.getReturningColumns(),r=this.connection.driver;if(typeof this.expressionMap.returning!="string"&&this.expressionMap.extraReturningColumns.length>0&&r.isReturningSqlSupported(e)&&n.push(...this.expressionMap.extraReturningColumns.filter(o=>n.indexOf(o)===-1)),n.length){let o=n.map(a=>{const i=this.escape(a.databaseName);return r.options.type==="mssql"?this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update"||this.expressionMap.queryType==="soft-delete"||this.expressionMap.queryType==="restore"?"INSERTED."+i:this.escape(this.getMainTableName())+"."+i:i}).join(", ");return r.options.type==="oracle"&&(o+=" INTO "+n.map(a=>this.createParameter({type:r.columnTypeToNativeParameter(a.type),dir:r.oracle.BIND_OUT})).join(", ")),r.options.type==="mssql"&&(this.expressionMap.queryType==="insert"||this.expressionMap.queryType==="update")&&(o+=" INTO @OutputTable"),o}else if(typeof this.expressionMap.returning=="string")return this.expressionMap.returning;return""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(n=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n))}),e}createWhereClausesExpression(e){return e.map((n,r)=>{const o=this.createWhereConditionExpression(n.condition);switch(n.type){case"and":return(r>0?"AND ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${o}${this.connection.options.isolateWhereStatements?")":""}`;case"or":return(r>0?"OR ":"")+`${this.connection.options.isolateWhereStatements?"(":""}${o}${this.connection.options.isolateWhereStatements?")":""}`}return o}).join(" ").trim()}createWhereConditionExpression(e,n=!1){if(typeof e=="string")return e;if(Array.isArray(e))return e.length===0?"1=1":e.length===1&&!n?this.createWhereClausesExpression(e):"("+this.createWhereClausesExpression(e)+")";const{driver:r}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"jsonContains":return`${e.parameters[0]} ::jsonb @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return r.options.type==="postgres"||r.options.type==="cockroachdb"?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return r.options.type==="cockroachdb"?`${e.parameters[0]}::STRING = ANY(${e.parameters[1]}::STRING[])`:`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`;case"and":return"("+e.parameters.join(" AND ")+")";case"or":return"("+e.parameters.join(" OR ")+")"}throw new TypeError(`Unsupported FindOperator ${Ca.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map(n=>{const r=typeof n.queryBuilder=="string"?n.queryBuilder:n.queryBuilder.getQuery();if(typeof n.queryBuilder!="string"){if(n.queryBuilder.hasCommonTableExpressions())throw new de(`Nested CTEs aren't supported (CTE: ${n.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!ze.isSelectQueryBuilder(n.queryBuilder))throw new de(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${n.alias})`);this.setParameters(n.queryBuilder.getParameters())}let o=this.escape(n.alias);if(n.options.columnNames){const s=n.options.columnNames.map(l=>this.escape(l));if(ze.isSelectQueryBuilder(n.queryBuilder)&&n.queryBuilder.expressionMap.selects.length&&n.options.columnNames.length!==n.queryBuilder.expressionMap.selects.length)throw new de(`cte.options.columnNames length (${n.options.columnNames.length}) doesn't match subquery select list length ${n.queryBuilder.expressionMap.selects.length} (CTE: ${n.alias})`);o+=`(${s.join(", ")})`}const a=n.options.recursive&&e?"RECURSIVE":"";let i="";return this.connection.driver.cteCapabilities.materializedHint&&n.options.materialized!==void 0&&(i=n.options.materialized?"MATERIALIZED":"NOT MATERIALIZED"),[a,o,"AS",i,`(${r})`].filter(Boolean).join(" ")}).join(", ")+" "}getWhereInIdsCondition(e){const n=this.expressionMap.mainAlias.metadata,r=(Array.isArray(e)?e:[e]).map(o=>n.ensureEntityIdMap(o));if(!n.hasMultiplePrimaryKeys){const o=n.primaryColumns[0];if(!o.transformer&&!o.relationMetadata&&!o.embeddedMetadata)return{[o.propertyName]:mo(r.map(a=>o.getEntityValue(a,!1)))}}return new mM(o=>{for(const a of r)o.orWhere(new mM(i=>i.where(a)))})}getExistsCondition(e){const n=e.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select("1").setOption("disable-global-order");return[`EXISTS (${n.getQuery()})`,n.getParameters()]}findColumnsForPropertyPath(e){let n=this.expressionMap.mainAlias;const r=[],o=e.split(".");for(;o.length>1;){const s=o[0];if(!(n!=null&&n.hasMetadata))break;if(n.metadata.hasEmbeddedWithPropertyPath(s)){o.unshift(`${o.shift()}.${o.shift()}`);continue}if(n.metadata.hasRelationWithPropertyPath(s)){const l=this.expressionMap.joinAttributes.find(c=>c.relationPropertyPath===s);if(!(l!=null&&l.alias)){const c=r.length>0?`${r.join(".")}.${s}`:s;throw new Error(`Cannot find alias for relation at ${c}`)}n=l.alias,r.push(...s.split(".")),o.shift();continue}break}if(!n)throw new Error(`Cannot find alias for property ${e}`);const a=o.join("."),i=n.metadata.findColumnsWithPropertyPath(a);if(!i.length)throw new Jt(e,n.metadata);return[n,r,i]}createPropertyPath(e,n,r=""){const o=[];for(const a of Object.keys(n)){const i=r?`${r}.${a}`:a;if(n[a]===null||typeof n[a]!="object"||ze.isFindOperator(n[a])){o.push(i);continue}if(e.hasEmbeddedWithPropertyPath(i)){const s=this.createPropertyPath(e,n[a],i);o.push(...s);continue}if(e.hasRelationWithPropertyPath(i)){const s=e.findRelationWithPropertyPath(i);if(s.relationType==="one-to-one"||s.relationType==="many-to-one"){const d=s.joinColumns.map(u=>u.referencedColumn).filter(u=>!!u);if(d.length>0&&d.every(u=>u.getEntityValue(n[a],!1))){o.push(i);continue}}if(s.relationType==="one-to-many"||s.relationType==="many-to-many")throw new Error(`Cannot query across ${s.relationType} for property ${i}`);const l=s.inverseEntityMetadata.primaryColumns;if(l.length>0&&l.every(d=>d.getEntityValue(n[a],!1))){const d=l.map(u=>`${i}.${u.propertyPath}`);o.push(...d);continue}const c=this.createPropertyPath(s.inverseEntityMetadata,n[a]).map(d=>`${i}.${d}`);o.push(...c);continue}o.push(i)}return o}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const n=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const r of n){const[o,a,i]=this.findColumnsForPropertyPath(r);for(const s of i){let l=e;for(const u of a){if(!l||!(u in l)){l={};break}l=l[u]}const c=this.expressionMap.aliasNamePrefixingEnabled?`${o.name}.${s.propertyPath}`:s.propertyPath,d=s.getEntityValue(l,!0);yield[c,d]}}}else for(const n of Object.keys(e)){const r=e[n];yield[this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${n}`:n,r]}}getWherePredicateCondition(e,n){if(ze.isFindOperator(n)){let r=[];if(n.useParameter)if(n.objectLiteralParameters)this.setParameters(n.objectLiteralParameters);else if(n.multipleParameters)for(const o of n.value)r.push(this.createParameter(o));else r.push(this.createParameter(n.value));if(n.type==="raw")return n.getSql?n.getSql(e):{operator:"equal",parameters:[e,n.value]};if(n.type==="not")return n.child?{operator:n.type,condition:this.getWherePredicateCondition(e,n.child)}:{operator:"notEqual",parameters:[e,...r]};if(n.type==="and"){const o=n.value;return{operator:n.type,parameters:o.map(a=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,a)))}}else if(n.type==="or"){const o=n.value;return{operator:n.type,parameters:o.map(a=>this.createWhereConditionExpression(this.getWherePredicateCondition(e,a)))}}else return{operator:n.type,parameters:[e,...r]}}else return{operator:"equal",parameters:[e,this.createParameter(n)]}}getWhereCondition(e){if(typeof e=="string")return e;if(ze.isBrackets(e)){const o=this.createQueryBuilder();return o.parentQueryBuilder=this,o.expressionMap.mainAlias=this.expressionMap.mainAlias,o.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,o.expressionMap.parameters=this.expressionMap.parameters,o.expressionMap.nativeParameters=this.expressionMap.nativeParameters,o.expressionMap.wheres=[],e.whereFactory(o),{operator:ze.isNotBrackets(e)?"not":"brackets",condition:o.expressionMap.wheres}}if(typeof e=="function")return e(this);const n=Array.isArray(e)?e:[e],r=[];for(const o of n){const a=[];for(const[i,s]of this.getPredicates(o))a.push({type:"and",condition:this.getWherePredicateCondition(i,s)});r.push({type:"or",condition:a})}return r.length===1?r[0].condition:r}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}Je.queryBuilderRegistry={};class QD{static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class KD extends Je{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let o=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),o=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const a=await r.query(e,n,!0),i=QD.from(a);return this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await r.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),o&&await r.commitTransaction(),i}catch(a){if(o)try{await r.rollbackTransaction()}catch{}throw a}finally{r!==this.queryRunner&&await r.release()}}from(e,n){e=ze.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new Rs;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),n=this.createWhereExpression(),r=this.createReturningExpression("delete");return r===""?`DELETE FROM ${e}${n}`:this.connection.driver.options.type==="mssql"?`DELETE FROM ${e} OUTPUT ${r}${n}`:`DELETE FROM ${e}${n} RETURNING ${r}`}}let Ps;const YD=new Uint8Array(16);function XD(){if(!Ps&&(Ps=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ps))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ps(YD)}const ht=[];for(let t=0;t<256;++t)ht.push((t+256).toString(16).slice(1));function ZD(t,e=0){return ht[t[e+0]]+ht[t[e+1]]+ht[t[e+2]]+ht[t[e+3]]+"-"+ht[t[e+4]]+ht[t[e+5]]+"-"+ht[t[e+6]]+ht[t[e+7]]+"-"+ht[t[e+8]]+ht[t[e+9]]+"-"+ht[t[e+10]]+ht[t[e+11]]+ht[t[e+12]]+ht[t[e+13]]+ht[t[e+14]]+ht[t[e+15]]}const GD=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),yM={randomUUID:GD};function JD(t,e,n){if(yM.randomUUID&&!e&&!t)return yM.randomUUID();t=t||{};const r=t.random||(t.rng||XD)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ZD(r)}class gM{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}class vM{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.raw,n}}class Yp{constructor(e,n){this.queryRunner=e,this.expressionMap=n}async update(e,n){const r=this.expressionMap.mainAlias.metadata;await Promise.all(n.map(async(o,a)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((l,c,d)=>(l[this.expressionMap.extraReturningColumns[d].databaseName]=c[0],l),{}));const i=Array.isArray(e.raw)?e.raw[a]:e.raw,s=this.queryRunner.connection.driver.createGeneratedMap(r,i);s&&(this.queryRunner.manager.merge(r.target,o,s),e.generatedMaps.push(s))}else{const i=this.expressionMap.extraReturningColumns;if(i.length>0){const s=this.expressionMap.mainAlias.metadata.getEntityIdMap(o);if(!s)throw new de("Cannot update entity because entity id is not set in the entity.");const l=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(c=>r.targetName+"."+c.propertyPath)).addSelect(i.map(c=>r.targetName+"."+c.propertyPath)).from(r.target,r.targetName).where(s).withDeleted().setOption("create-pojo").getOne();l&&(this.queryRunner.manager.merge(r.target,o,l),e.generatedMaps.push(l))}}}))}async insert(e,n){const r=this.expressionMap.mainAlias.metadata;let o=r.getInsertionReturningColumns();const a=this.queryRunner.connection.driver.isReturningSqlSupported("insert");o=o.filter(s=>s.isGenerated?a===!0:!0);const i=n.map((s,l)=>{this.queryRunner.connection.driver.options.type==="oracle"&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((u,h,p)=>(u[this.expressionMap.extraReturningColumns[p].databaseName]=h[0],u),{}));const c=Array.isArray(e.raw)?e.raw[l]:e.raw,d=this.queryRunner.connection.driver.createGeneratedMap(r,c,l,n.length)||{};return l in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(r.target,d,this.expressionMap.locallyGenerated[l]),this.queryRunner.manager.merge(r.target,s,d),d});if(o.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const s=n.map(c=>{const d=r.getEntityIdMap(c);if(!d)throw new de("Cannot update entity because entity id is not set in the entity.");return d}),l=await this.queryRunner.manager.createQueryBuilder().select(r.primaryColumns.map(c=>r.targetName+"."+c.propertyPath)).addSelect(o.map(c=>r.targetName+"."+c.propertyPath)).from(r.target,r.targetName).where(s).setOption("create-pojo").getMany();n.forEach((c,d)=>{this.queryRunner.manager.merge(r.target,i[d],l[d]),this.queryRunner.manager.merge(r.target,c,l[d])})}n.forEach((s,l)=>{const c=r.getEntityIdMap(s);e.identifiers.push(c),e.generatedMaps.push(i[l])})}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion)}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter(e=>e.asExpression!==void 0||e.isUpdateDate||e.isVersion||e.isDeleteDate)}}class e6 extends Je{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.getValueSets();if(e.length===0)return new vM;const n=this.obtainQueryRunner();let r=!1;try{if(this.expressionMap.useTransaction===!0&&n.isTransactionActive===!1&&(await n.startTransaction(),r=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new gM;e.forEach(y=>{n.broadcaster.broadcastBeforeInsertEvent(p,this.expressionMap.mainAlias.metadata,y)}),await p.wait()}let o=null,a=null;const i=new Yp(n,this.expressionMap),s=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const p of this.expressionMap.returning)s.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(p));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver.options.type==="oracle"||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),s.push(...this.expressionMap.extraReturningColumns.filter(p=>!s.includes(p)))),s.length>0&&this.connection.driver.options.type==="mssql"&&(o=this.connection.driver.buildTableVariableDeclaration("@OutputTable",s),a="SELECT * FROM @OutputTable");const[l,c]=this.getQueryAndParameters(),d=[o,l,a].filter(p=>p!=null).join(`;

`),u=await n.query(d,c,!0),h=vM.from(u);if(this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&await i.insert(h,e),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata){const p=new gM;e.forEach(y=>{n.broadcaster.broadcastAfterInsertEvent(p,this.expressionMap.mainAlias.metadata,y)}),await p.wait()}return r&&await n.commitTransaction(),h}catch(o){if(r)try{await n.rollbackTransaction()}catch{}throw o}finally{n!==this.queryRunner&&await n.release()}}into(e,n){e=ze.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e);return this.expressionMap.setMainAlias(r),this.expressionMap.insertColumns=n||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new Rs;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,n,r){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:n,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,indexPredicate:r==null?void 0:r.indexPredicate,upsertType:r==null?void 0:r.upsertType},this):(this.expressionMap.onUpdate={conflict:e==null?void 0:e.conflict_target,columns:e==null?void 0:e.columns,overwrite:e==null?void 0:e.overwrite,skipUpdateIfNoValuesChanged:r==null?void 0:r.skipUpdateIfNoValuesChanged,upsertType:r==null?void 0:r.upsertType},this)}createInsertExpression(){var i,s;const e=this.getTableName(this.getMainTableName()),n=this.createValuesExpression(),r=this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),o=this.createColumnNamesExpression();let a="INSERT ";if(((i=this.expressionMap.onUpdate)==null?void 0:i.upsertType)==="primary-key"&&(a="UPSERT "),(se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(a+=`${this.expressionMap.onIgnore?" IGNORE ":""}`),a+=`INTO ${e}`,this.alias!==this.getMainTableName()&&se.isPostgresFamily(this.connection.driver)&&(a+=` AS "${this.alias}"`),o?a+=`(${o})`:!n&&(se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(a+="()"),r&&this.connection.driver.options.type==="mssql"&&(a+=` OUTPUT ${r}`),n?(this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="sap")&&this.getValueSets().length>1?a+=` ${n}`:a+=` VALUES ${n}`:se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"?a+=" VALUES ()":a+=" DEFAULT VALUES",((s=this.expressionMap.onUpdate)==null?void 0:s.upsertType)!=="primary-key"){if(this.connection.driver.supportedUpsertTypes.includes("on-conflict-do-update")){if(this.expressionMap.onIgnore)a+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)a+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:l,columns:c,conflict:d,skipUpdateIfNoValuesChanged:u,indexPredicate:h}=this.expressionMap.onUpdate;let p="ON CONFLICT";if(Array.isArray(d)){if(p+=` ( ${d.map(f=>this.escape(f)).join(", ")} )`,h&&!se.isPostgresFamily(this.connection.driver))throw new de("indexPredicate option is not supported by the current database driver");h&&se.isPostgresFamily(this.connection.driver)&&(p+=` WHERE ( ${h} )`)}else d&&(p+=` ON CONSTRAINT ${this.escape(d)}`);const y=[];Array.isArray(l)?y.push(...l.map(f=>`${this.escape(f)} = EXCLUDED.${this.escape(f)}`)):c&&y.push(...c.map(f=>`${this.escape(f)} = :${f}`)),y.length>0&&(a+=` ${p} DO UPDATE SET `,y.push(...this.expressionMap.mainAlias.metadata.columns.filter(f=>f.isUpdateDate&&!(l!=null&&l.includes(f.databaseName))&&!(this.connection.driver.options.type==="oracle"&&this.getValueSets().length>1||se.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")).map(f=>`${this.escape(f.databaseName)} = DEFAULT`)),a+=y.join(", "),a+=" "),Array.isArray(l)&&u&&se.isPostgresFamily(this.connection.driver)&&(a+=" WHERE (",a+=l.map(f=>`${e}.${this.escape(f)} IS DISTINCT FROM EXCLUDED.${this.escape(f)}`).join(" OR "),a+=") ")}}else if(this.connection.driver.supportedUpsertTypes.includes("on-duplicate-key-update")){if(this.expressionMap.onUpdate){const{overwrite:l,columns:c}=this.expressionMap.onUpdate;Array.isArray(l)?(a+=" ON DUPLICATE KEY UPDATE ",a+=l.map(d=>`${this.escape(d)} = VALUES(${this.escape(d)})`).join(", "),a+=" "):Array.isArray(c)&&(a+=" ON DUPLICATE KEY UPDATE ",a+=c.map(d=>`${this.escape(d)} = :${d}`).join(", "),a+=" ")}}else if(this.expressionMap.onUpdate)throw new de("onUpdate is not supported by the current database driver")}return r&&(se.isPostgresFamily(this.connection.driver)||this.connection.driver.options.type==="oracle"||this.connection.driver.options.type==="cockroachdb"||se.isMySQLFamily(this.connection.driver))&&(a+=` RETURNING ${r}`),this.connection.driver.options.type==="mssql"&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(l=>this.expressionMap.insertColumns.length>0?this.expressionMap.insertColumns.indexOf(l.propertyPath)!==-1:l.isInsert).some(l=>this.isOverridingAutoIncrementBehavior(l))&&(a=`SET IDENTITY_INSERT ${e} ON; ${a}; SET IDENTITY_INSERT ${e} OFF`),a}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(e=>this.expressionMap.insertColumns.length?this.expressionMap.insertColumns.indexOf(e.propertyPath)!==-1:!(!e.isInsert||e.isGenerated&&e.generationStrategy==="increment"&&this.connection.driver.options.type!=="spanner"&&this.connection.driver.options.type!=="oracle"&&!se.isSQLiteFamily(this.connection.driver)&&!se.isMySQLFamily(this.connection.driver)&&this.connection.driver.options.type!=="aurora-mysql"&&!(this.connection.driver.options.type==="mssql"&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map(n=>this.escape(n.databaseName)).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const n=this.getValueSets();if(n.length===1)return Object.keys(n[0]).map(r=>this.escape(r)).join(", ")}return this.expressionMap.insertColumns.map(n=>this.escape(n)).join(", ")}createValuesExpression(){const e=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){let r="";return e.forEach((o,a)=>{n.forEach((i,s)=>{s===0&&(this.connection.driver.options.type==="oracle"&&e.length>1||this.connection.driver.options.type==="sap"&&e.length>1?r+=" SELECT ":r+="(");let l=i.getEntityValue(o);if(typeof l!="function"&&(l=this.connection.driver.preparePersistentValue(l,i)),i.isVersion&&l===void 0)r+="1";else if(i.isDiscriminator)r+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(i.isGenerated&&i.generationStrategy==="uuid"&&!this.connection.driver.isUUIDGenerationSupported()&&l===void 0)l=JD(),r+=this.createParameter(l),a in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[a]={}),i.setEntityValue(this.expressionMap.locallyGenerated[a],l);else if(l===void 0)this.connection.driver.options.type==="oracle"&&e.length>1||se.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?i.default!==void 0&&i.default!==null?r+=this.connection.driver.normalizeDefault(i):r+="NULL":r+="DEFAULT";else if(l===null&&this.connection.driver.options.type==="spanner")r+="NULL";else if(typeof l=="function")r+=l();else{this.connection.driver.options.type==="mssql"&&(l=this.connection.driver.parametrizeValue(i,l));const c=this.createParameter(l);if((se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(i.type)!==-1){const d=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";i.srid!=null?r+=`${d}(${c}, ${i.srid})`:r+=`${d}(${c})`}else se.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(i.type)!==-1?i.srid!=null?r+=`ST_SetSRID(ST_GeomFromGeoJSON(${c}), ${i.srid})::${i.type}`:r+=`ST_GeomFromGeoJSON(${c})::${i.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(i.type)!==-1?r+=i.type+"::STGeomFromText("+c+", "+(i.srid||"0")+")":r+=c}s===n.length-1?a===e.length-1?this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy ":r+=")":this.connection.driver.options.type==="oracle"&&e.length>1?r+=" FROM DUAL UNION ALL ":this.connection.driver.options.type==="sap"&&e.length>1?r+=" FROM dummy UNION ALL ":r+="), ":r+=", "})}),r==="()"?"":r}else{let r="";return e.forEach((o,a)=>{Object.keys(o).forEach((i,s)=>{s===0&&(r+="(");const l=o[i];typeof l=="function"?r+=l():l===void 0?this.connection.driver.options.type==="oracle"&&e.length>1||se.isSQLiteFamily(this.connection.driver)||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"?r+="NULL":r+="DEFAULT":l===null&&this.connection.driver.options.type==="spanner"||(r+=this.createParameter(l)),s===Object.keys(o).length-1?a===e.length-1?r+=")":r+="), ":r+=", "})}),r==="()"?"":r}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(it.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new jD}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&e.generationStrategy==="increment"&&this.getValueSets().some(n=>e.getEntityValue(n)!==void 0&&e.getEntityValue(n)!==null)}}class xM{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async update(e){const n=this.expressionMap.relationMetadata;if(n.isManyToOne||n.isOneToOneOwner){const r=n.joinColumns.reduce((o,a)=>{const i=it.isObject(e)?a.referencedColumn.getEntityValue(e):e;return a.setEntityValue(o,i),o},{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(n.entityMetadata.target).set(r).whereInIds(this.expressionMap.of).execute()}else if((n.isOneToOneNotOwner||n.isOneToMany)&&e===null){const r={};n.inverseRelation.joinColumns.forEach(l=>{r[l.propertyName]=null});const o=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],a={},i=[];o.forEach((l,c)=>{n.inverseRelation.joinColumns.map((d,u)=>{const h="joinColumn_"+c+"_"+u;a[h]=it.isObject(l)?d.referencedColumn.getEntityValue(l):l,i.push(`${d.propertyPath} = :${h}`)})});const s=i.map(l=>"("+l+")").join(" OR ");if(!s)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(r).where(s).setParameters(a).execute()}else if(n.isOneToOneNotOwner||n.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new de("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const r=this.expressionMap.of,o=n.inverseRelation.joinColumns.reduce((a,i)=>{const s=it.isObject(r)?i.referencedColumn.getEntityValue(r):r;return i.setEntityValue(a,s),a},{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(o).whereInIds(e).execute()}else{const r=n.junctionEntityMetadata,o=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],a=Array.isArray(e)?e:[e],i=n.isManyToManyOwner?o:a,s=n.isManyToManyOwner?a:o,l=[];if(i.forEach(c=>{s.forEach(d=>{const u={};r.ownerColumns.forEach(h=>{u[h.databaseName]=it.isObject(c)?h.referencedColumn.getEntityValue(c):c}),r.inverseColumns.forEach(h=>{u[h.databaseName]=it.isObject(d)?h.referencedColumn.getEntityValue(d):d}),l.push(u)})}),!l.length)return;this.queryBuilder.connection.driver.options.type==="oracle"||this.queryBuilder.connection.driver.options.type==="sap"?await Promise.all(l.map(c=>this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(c).execute())):await this.queryBuilder.createQueryBuilder().insert().into(r.tableName).values(l).execute()}}}class t6{constructor(e,n){this.queryBuilder=e,this.expressionMap=n}async remove(e){const n=this.expressionMap.relationMetadata;if(n.isOneToMany){const r=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],o=Array.isArray(e)?e:[e],a={};n.inverseRelation.joinColumns.forEach(c=>{a[c.propertyName]=null});const i={},s=[];r.forEach((c,d)=>{s.push(...o.map((u,h)=>[...n.inverseRelation.joinColumns.map((p,y)=>{const f="joinColumn_"+d+"_"+h+"_"+y;return i[f]=it.isObject(c)?p.referencedColumn.getEntityValue(c):c,`${p.propertyPath} = :${f}`}),...n.inverseRelation.entityMetadata.primaryColumns.map((p,y)=>{const f="primaryColumn_"+h+"_"+h+"_"+y;return i[f]=it.isObject(u)?p.getEntityValue(u):u,`${p.propertyPath} = :${f}`})].join(" AND ")))});const l=s.map(c=>"("+c+")").join(" OR ");if(!l)return;await this.queryBuilder.createQueryBuilder().update(n.inverseEntityMetadata.target).set(a).where(l).setParameters(i).execute()}else{const r=n.junctionEntityMetadata,o=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],a=Array.isArray(e)?e:[e],i=n.isManyToManyOwner?o:a,s=n.isManyToManyOwner?a:o,l={},c=[];i.forEach((u,h)=>{c.push(...s.map((p,y)=>[...r.ownerColumns.map((f,v)=>{const g="firstValue_"+h+"_"+y+"_"+v;return l[g]=it.isObject(u)?f.referencedColumn.getEntityValue(u):u,`${f.databaseName} = :${g}`}),...r.inverseColumns.map((f,v)=>{const g="secondValue_"+h+"_"+y+"_"+v;return l[g]=it.isObject(p)?f.referencedColumn.getEntityValue(p):p,`${f.databaseName} = :${g}`})].join(" AND ")))});const d=c.map(u=>"("+u+")").join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(r.tableName).where(d).setParameters(l).execute()}}}class n6 extends Je{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new de("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToMany||n.isOneToMany)throw new de(`Set operation is only supported for many-to-one and one-to-one relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .add() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!it.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new de('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new xM(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new de("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new de(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set() method instead.`);if(n.joinColumns&&n.joinColumns.length>1&&(!it.isObject(e)||Object.keys(e).length<n.joinColumns.length))throw new de('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new xM(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&e.length===0)return;const n=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new de("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(n.isManyToOne||n.isOneToOne)throw new de(`Add operation is only supported for many-to-many and one-to-many relations. However given "${n.propertyPath}" has ${n.relationType} relation. Use .set(null) method instead.`);return new t6(this,this.expressionMap).remove(e)}async addAndRemove(e,n){await this.remove(n),await this.add(e)}async loadOne(){return this.loadMany().then(e=>e[0])}async loadMany(){let e=this.expressionMap.of;if(!it.isObject(e)){const n=this.expressionMap.mainAlias.metadata;if(n.hasMultiplePrimaryKeys)throw new de("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=n.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}class pt{static chunk(e,n){return Array.from(Array(Math.ceil(e.length/n)),(r,o)=>e.slice(o*n,o*n+n))}static splitClassesAndStrings(e){return[e.filter(n=>typeof n!="string"),e.filter(n=>typeof n=="string")]}static groupBy(e,n){return e.reduce((r,o)=>{const a=n(o);let i=r.find(s=>s.id===a);return i||(i={id:a,items:[]},r.push(i)),i.items.push(o),r},[])}static uniq(e,n){return e.reduce((r,o)=>{let a=!1;if(typeof n=="function"){const i=n(o);a=!!r.find(s=>n(s)===i)}else typeof n=="string"?a=!!r.find(i=>i[n]===o[n]):a=r.indexOf(o)!==-1;return a||r.push(o),r},[])}static isPlainObject(e){return e==null?!1:!e.constructor||e.constructor===Object}static mergeArrayKey(e,n,r,o){if(o.has(r)){e[n]=o.get(r);return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){e[n]=r;return}e[n]||(e[n]=Array.isArray(r)?[]:{}),o.set(r,e[n]),this.merge(e[n],r,o),o.delete(r)}}static mergeObjectKey(e,n,r,o){if(o.has(r)){Object.assign(e,{[n]:o.get(r)});return}if(!(r instanceof Promise)){if(!this.isPlainObject(r)&&!Array.isArray(r)){Object.assign(e,{[n]:r});return}e[n]||Object.assign(e,{[n]:Array.isArray(r)?[]:{}}),o.set(r,e[n]),this.merge(e[n],r,o),o.delete(r)}}static merge(e,n,r=new Map){if(this.isPlainObject(e)&&this.isPlainObject(n))for(const o of Object.keys(n))o!=="__proto__"&&this.mergeObjectKey(e,o,n[o],r);if(Array.isArray(e)&&Array.isArray(n))for(let o=0;o<n.length;o++)this.mergeArrayKey(e,o,n[o],r)}static mergeDeep(e,...n){if(!n.length)return e;for(const r of n)pt.merge(e,r);return e}static deepCompare(...e){let n,r,o,a;if(arguments.length<1)return!0;for(n=1,r=arguments.length;n<r;n++)if(o=[],a=[],!this.compare2Objects(o,a,arguments[0],arguments[n]))return!1;return!0}static deepValue(e,n){const r=n.split(".");for(let o=0,a=r.length;o<a;o++)e=e[r[o]];return e}static replaceEmptyObjectsWithBooleans(e){for(let n in e)e[n]&&typeof e[n]=="object"&&(Object.keys(e[n]).length===0?e[n]=!0:this.replaceEmptyObjectsWithBooleans(e[n]))}static propertyPathsToTruthyObject(e){let n={};for(let r of e){const o=r.split(".");if(!o.length)continue;(!n[o[0]]||n[o[0]]===!0)&&(n[o[0]]={});let a=n[o[0]];for(let[i,s]of o.entries())i!==0&&(a[s]?a=a[s]:i===o.length-1?(a[s]={},a=null):(a[s]={},a=a[s]))}return this.replaceEmptyObjectsWithBooleans(n),n}static compareIds(e,n){return e==null||n===void 0||n===null?!1:(typeof e.id=="string"&&typeof n.id=="string"||typeof e.id=="number"&&typeof n.id=="number")&&Object.keys(e).length===1&&Object.keys(n).length===1?e.id===n.id:pt.deepCompare(e,n)}static toBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e==="true"||e==="1":typeof e=="number"?e>0:!1}static zipObject(e,n){return e.reduce((r,o,a)=>(r[o]=n[a],r),{})}static isArraysEqual(e,n){return e.length!==n.length?!1:e.every(r=>n.indexOf(r)!==-1)}static areMutuallyExclusive(...e){return!e.some(n=>{const r=e.filter(o=>o!==n);return n.some(o=>r.some(a=>a.includes(o)))})}static parseSqlCheckExpression(e,n){const r=e.match(new RegExp(`"${n}" varchar CHECK\\s*\\(\\s*"${n}"\\s+IN\\s*`));if(r&&r.index){const o=e.substring(r.index+r[0].length);let a="",i="";const s=[];for(let l=0;l<o.length;l++){const c=o[l];switch(c){case",":a==""?(s.push(i),i=""):i+=c;break;case"'":a==c?o[l+1]===c?(i+=c,l+=1):a="":a=c;break;case")":if(a=="")return s.push(i),s;i+=c;break;default:a!=""&&(i+=c)}}}}static compare2Objects(e,n,r,o){let a;if(Number.isNaN(r)&&Number.isNaN(o)||r===o)return!0;if(r===null||o===null||r===void 0||o===void 0)return!1;if((typeof r.equals=="function"||typeof r.equals=="function")&&r.equals(o))return!0;if(typeof r=="function"&&typeof o=="function"||r instanceof Date&&o instanceof Date||r instanceof RegExp&&o instanceof RegExp||typeof r=="string"&&typeof o=="string"||typeof r=="number"&&typeof o=="number")return r.toString()===o.toString();if(!(typeof r=="object"&&typeof o=="object")||Object.prototype.isPrototypeOf.call(r,o)||Object.prototype.isPrototypeOf.call(o,r)||r.constructor!==o.constructor||r.prototype!==o.prototype||e.indexOf(r)>-1||n.indexOf(o)>-1)return!1;for(a in o)if(o.hasOwnProperty(a)!==r.hasOwnProperty(a)||typeof o[a]!=typeof r[a])return!1;for(a in r){if(o.hasOwnProperty(a)!==r.hasOwnProperty(a)||typeof o[a]!=typeof r[a])return!1;switch(typeof r[a]){case"object":case"function":if(e.push(r),n.push(o),!this.compare2Objects(e,n,r[a],o[a]))return!1;e.pop(),n.pop();break;default:if(r[a]!==o[a])return!1;break}}return!0}}class r6{constructor(e,n,r,o,a){this.expressionMap=e,this.driver=n,this.rawRelationIdResults=r,this.rawRelationCountResults=o,this.queryRunner=a}transform(e,n){const r=this.group(e,n),o=[];return r.forEach(a=>{const i=this.transformRawResultsGroup(a,n);i!==void 0&&!Object.values(i).every(s=>s===null)&&o.push(i)}),o}group(e,n){const r=new Map,o=[];return n.metadata.tableType==="view"?o.push(...n.metadata.columns.map(a=>se.buildAlias(this.driver,void 0,n.name,a.databaseName))):o.push(...n.metadata.primaryColumns.map(a=>se.buildAlias(this.driver,void 0,n.name,a.databaseName))),e.forEach(a=>{const i=o.map(l=>{const c=a[l];return Fs.isBuffer(c)?c.toString("hex"):it.isObject(c)?JSON.stringify(c):c}).join("_"),s=r.get(i);s?s.push(a):r.set(i,[a])}),r}transformRawResultsGroup(e,n){let r=n.metadata;if(r.discriminatorColumn){const c=e.map(u=>u[se.buildAlias(this.driver,void 0,n.name,n.metadata.discriminatorColumn.databaseName)]),d=r.childEntityMetadatas.find(u=>typeof c.find(h=>h===u.discriminatorValue)<"u");d&&(r=d)}let o=r.create(this.queryRunner,{fromDeserializer:!0,pojo:this.expressionMap.options.indexOf("create-pojo")!==-1});const a=this.transformColumns(e,n,o,r),i=this.transformJoins(e,o,n,r),s=this.transformRelationIds(e,n,o,r),l=this.transformRelationCounts(e,n,o);if(a||r.primaryColumns.filter(c=>c.isVirtual===!1).length===0&&(i||s||l))return o}transformColumns(e,n,r,o){let a=!1;return o.columns.forEach(i=>{if(o.childEntityMetadatas.length>0&&o.childEntityMetadatas.findIndex(l=>l.target===i.target)!==-1)return;const s=e[0][se.buildAlias(this.driver,void 0,n.name,i.databaseName)];s===void 0||i.isVirtual||this.expressionMap.selects.find(l=>l.selection===n.name||l.selection===n.name+"."+i.propertyPath)&&(i.setEntityValue(r,this.driver.prepareHydratedValue(s,i)),s!==null&&(a=!0))}),a}transformJoins(e,n,r,o){let a=!1;return this.expressionMap.joinAttributes.forEach(i=>{if(!i.metadata||!i.isSelected||i.relation&&!o.relations.find(l=>l===i.relation))return;if(i.mapToProperty){if(i.mapToPropertyParentAlias!==r.name)return}else if(!i.relation||i.parentAlias!==r.name||i.relationPropertyPath!==i.relation.propertyPath)return;let s=this.transform(e,i.alias);s=i.isMany?s:s[0],s=!i.isMany&&s===void 0?null:s,s!==void 0&&(i.mapToPropertyPropertyName?n[i.mapToPropertyPropertyName]=s:i.relation.setEntityValue(n,s),a=!0)}),a}transformRelationIds(e,n,r,o){let a=!1;return this.rawRelationIdResults.forEach((i,s)=>{if(i.relationIdAttribute.parentAlias!==n.name)return;const l=i.relationIdAttribute.relation,c=this.createValueMapFromJoinColumns(l,i.relationIdAttribute.parentAlias,e);if(c==null)return;this.prepareDataForTransformRelationIds();const d=this.hashEntityIds(l,c),u=this.relationIdMaps[s][d]||[],h=i.relationIdAttribute.mapToPropertyPropertyPath.split("."),p=(y,f,v)=>{const g=y.shift();if(g&&y.length===0)return f[g]=v,f;if(g&&y.length>0)p(y,f[g],v);else return f};l.isOneToOne||l.isManyToOne?u[0]!==void 0&&(p(h,r,u[0]),a=!0):(p(h,r,u),a=a||u.length>0)}),a}transformRelationCounts(e,n,r){let o=!1;return this.rawRelationCountResults.filter(a=>a.relationCountAttribute.parentAlias===n.name).forEach(a=>{const i=a.relationCountAttribute.relation;let s;i.isOneToMany?s=i.inverseRelation.joinColumns[0].referencedColumn.databaseName:s=i.isOwning?i.joinColumns[0].referencedColumn.databaseName:i.inverseRelation.joinColumns[0].referencedColumn.databaseName;const l=e[0][se.buildAlias(this.driver,void 0,n.name,s)];l!=null&&(r[a.relationCountAttribute.mapToPropertyPropertyName]=0,a.results.filter(c=>c.parentId===l).forEach(c=>{r[a.relationCountAttribute.mapToPropertyPropertyName]=parseInt(c.cnt),o=!0}))}),o}createValueMapFromJoinColumns(e,n,r){let o;return e.isManyToOne||e.isOneToOneOwner?o=e.entityMetadata.primaryColumns.map(a=>a):e.isOneToMany||e.isOneToOneNotOwner?o=e.inverseRelation.joinColumns.map(a=>a):e.isOwning?o=e.joinColumns.map(a=>a):o=e.inverseRelation.inverseJoinColumns.map(a=>a),o.reduce((a,i)=>(r.forEach(s=>{e.isManyToOne||e.isOneToOneOwner?a[i.databaseName]=this.driver.prepareHydratedValue(s[se.buildAlias(this.driver,void 0,n,i.databaseName)],i):a[i.databaseName]=this.driver.prepareHydratedValue(s[se.buildAlias(this.driver,void 0,n,i.referencedColumn.databaseName)],i.referencedColumn)}),a),{})}extractEntityPrimaryIds(e,n){let r;return e.isManyToOne||e.isOneToOneOwner?r=e.entityMetadata.primaryColumns.map(o=>o):e.isOneToMany||e.isOneToOneNotOwner?r=e.inverseRelation.joinColumns.map(o=>o):e.isOwning?r=e.joinColumns.map(o=>o):r=e.inverseRelation.inverseJoinColumns.map(o=>o),r.reduce((o,a)=>(o[a.databaseName]=n[a.databaseName],o),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map(e=>{const n=e.relationIdAttribute.relation;let r;return n.isManyToOne||n.isOneToOneOwner?r=n.joinColumns:n.isOneToMany||n.isOneToOneNotOwner?r=n.inverseEntityMetadata.primaryColumns:n.isOwning?r=n.inverseJoinColumns:r=n.inverseRelation.joinColumns,e.results.reduce((o,a)=>{let i=r.reduce((s,l)=>{let c=a[l.databaseName];return n.isOneToMany||n.isOneToOneNotOwner?(l.isVirtual&&l.referencedColumn&&l.referencedColumn.propertyName!==l.propertyName&&(c=l.referencedColumn.createValueMap(c)),pt.mergeDeep(s,l.createValueMap(c))):(!l.isPrimary&&l.referencedColumn.referencedColumn&&(c=l.referencedColumn.referencedColumn.createValueMap(c)),pt.mergeDeep(s,l.referencedColumn.createValueMap(c)))},{});if(r.length===1&&!e.relationIdAttribute.disableMixedMap&&(n.isOneToMany||n.isOneToOneNotOwner?i=r[0].getEntityValue(i):i=r[0].referencedColumn.getEntityValue(i)),i!==void 0){const s=this.hashEntityIds(n,a);o[s]?o[s].push(i):o[s]=[i]}return o},{})}))}hashEntityIds(e,n){const r=this.extractEntityPrimaryIds(e,n);return JSON.stringify(r)}}let o6=class{constructor(t,e,n){this.connection=t,this.queryRunner=e,this.relationIdAttributes=n}async load(t){const e=this.relationIdAttributes.map(async n=>{if(n.relation.isManyToOne||n.relation.isOneToOneOwner){if(n.queryBuilderFactory)throw new de("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const r={},o=t.map(a=>{const i={},s=[];n.relation.joinColumns.forEach(c=>{i[c.databaseName]=this.connection.driver.prepareHydratedValue(a[se.buildAlias(this.connection.driver,void 0,n.parentAlias,c.databaseName)],c.referencedColumn);const d=`${c.databaseName}:${i[c.databaseName]}`;s.indexOf(d)===-1&&s.push(d)}),n.relation.entityMetadata.primaryColumns.forEach(c=>{i[c.databaseName]=this.connection.driver.prepareHydratedValue(a[se.buildAlias(this.connection.driver,void 0,n.parentAlias,c.databaseName)],c);const d=`${c.databaseName}:${i[c.databaseName]}`;s.indexOf(d)===-1&&s.push(d)}),s.sort();const l=s.join("::");return r[l]?null:(r[l]=!0,i)}).filter(a=>a);return{relationIdAttribute:n,results:o}}else if(n.relation.isOneToMany||n.relation.isOneToOneNotOwner){const r=n.relation,o=r.isOwning?r.joinColumns:r.inverseRelation.joinColumns,a=r.inverseEntityMetadata.target,i=r.inverseEntityMetadata.tableName,s=n.alias||i,l={},c={},d=t.map((p,y)=>{const f=[],v={},g=o.map(w=>{const E=w.databaseName+y,M=p[se.buildAlias(this.connection.driver,void 0,n.parentAlias,w.referencedColumn.databaseName)],S=`${s}:${w.propertyPath}:${M}`;return f.indexOf(S)!==-1?"":(f.push(S),v[E]=M,s+"."+w.propertyPath+" = :"+E)}).filter(w=>w).join(" AND ");f.sort();const b=f.join("::");return l[b]?"":(l[b]=!0,Object.assign(c,v),g)}).filter(p=>p).map(p=>"("+p+")").join(" OR ");if(!d)return{relationIdAttribute:n,results:[]};const u=this.connection.createQueryBuilder(this.queryRunner);pt.uniq([...o,...r.inverseRelation.entityMetadata.primaryColumns],p=>p.propertyPath).forEach(p=>{u.addSelect(s+"."+p.propertyPath,p.databaseName)}),u.from(a,s).where("("+d+")").setParameters(c),n.queryBuilderFactory&&n.queryBuilderFactory(u);const h=await u.getRawMany();return h.forEach(p=>{o.forEach(y=>{p[y.databaseName]=this.connection.driver.prepareHydratedValue(p[y.databaseName],y.referencedColumn)}),r.inverseRelation.entityMetadata.primaryColumns.forEach(y=>{p[y.databaseName]=this.connection.driver.prepareHydratedValue(p[y.databaseName],y)})}),{relationIdAttribute:n,results:h}}else{const r=n.relation,o=r.isOwning?r.joinColumns:r.inverseRelation.inverseJoinColumns,a=r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns,i=n.junctionAlias,s=n.joinInverseSideMetadata.tableName,l=n.alias||s,c=r.isOwning?r.junctionEntityMetadata.tableName:r.inverseRelation.junctionEntityMetadata.tableName,d=t.map(b=>o.reduce((w,E)=>(w[E.propertyPath]=b[se.buildAlias(this.connection.driver,void 0,n.parentAlias,E.referencedColumn.databaseName)],w),{}));if(d.length===0)return{relationIdAttribute:n,results:[]};const u={},h={},p=d.map((b,w)=>{const E=[],M={},S=Object.keys(b).map(_=>{const O=_+w,k=b[_],I=`${i}:${_}:${k}`;return E.indexOf(I)!==-1?"":(E.push(I),M[O]=k,i+"."+_+" = :"+O)}).filter(_=>_).join(" AND ");E.sort();const N=E.join("::");return h[N]?"":(h[N]=!0,Object.assign(u,M),S)}).filter(b=>b),y=a.map(b=>i+"."+b.propertyPath+" = "+l+"."+b.referencedColumn.propertyPath).join(" AND "),f=p.map(b=>"("+b+" AND "+y+")").join(" OR "),v=this.connection.createQueryBuilder(this.queryRunner);a.forEach(b=>{v.addSelect(i+"."+b.propertyPath,b.databaseName).addOrderBy(i+"."+b.propertyPath)}),o.forEach(b=>{v.addSelect(i+"."+b.propertyPath,b.databaseName).addOrderBy(i+"."+b.propertyPath)}),v.from(s,l).innerJoin(c,i,f).setParameters(u),n.queryBuilderFactory&&n.queryBuilderFactory(v);const g=await v.getRawMany();return g.forEach(b=>{[...o,...a].forEach(w=>{b[w.databaseName]=this.connection.driver.prepareHydratedValue(b[w.databaseName],w.referencedColumn)})}),{relationIdAttribute:n,results:g}}});return Promise.all(e)}};class a6{constructor(e,n){this.connection=e,this.queryRunner=n}load(e,n,r){const o=Array.isArray(n)?n:[n],a=Array.isArray(r)?r:r?[r]:void 0;return e.isManyToMany?this.loadForManyToMany(e,o,a):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,o,a):this.loadForOneToManyAndOneToOneNotOwner(e,o,a)}async loadManyToManyRelationIdsAndGroup(e,n,r,o){const a=e.isManyToMany||e.isOneToMany,i=Array.isArray(n)?n:[n];if(!r&&(r=await this.connection.relationLoader.load(e,n,this.queryRunner,o),!r.length))return i.map(u=>({entity:u,related:a?[]:void 0}));const s=await this.load(e,n,r),l=Array.isArray(r)?r:[r];let c=[],d=[];return e.isManyToManyOwner?(c=e.junctionEntityMetadata.inverseColumns.map(u=>u.referencedColumn),d=e.junctionEntityMetadata.ownerColumns.map(u=>u.referencedColumn)):e.isManyToManyNotOwner?(c=e.junctionEntityMetadata.ownerColumns.map(u=>u.referencedColumn),d=e.junctionEntityMetadata.inverseColumns.map(u=>u.referencedColumn)):e.isManyToOne||e.isOneToOneOwner?(c=e.joinColumns.map(u=>u.referencedColumn),d=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(c=e.inverseRelation.entityMetadata.primaryColumns,d=e.inverseRelation.joinColumns.map(u=>u.referencedColumn)),i.map(u=>{const h={entity:u,related:a?[]:void 0},p=s.filter(y=>d.every(f=>f.compareEntityValue(u,y[f.entityMetadata.name+"_"+f.propertyAliasName])));return p.length&&l.forEach(y=>{p.forEach(f=>{c.every(v=>v.compareEntityValue(y,f[se.buildAlias(this.connection.driver,void 0,v.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+v.propertyPath.replace(".","_"))]))&&(a?h.related.push(y):h.related=y)})}),h})}loadForManyToMany(e,n,r){const o=e.junctionEntityMetadata,a=o.name,i=e.isOwning?o.ownerColumns:o.inverseColumns,s=e.isOwning?o.inverseColumns:o.ownerColumns,l=this.connection.createQueryBuilder(this.queryRunner);i.forEach(h=>{const p=se.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+h.referencedColumn.propertyPath.replace(".","_"));l.addSelect(a+"."+h.propertyPath,p)}),s.forEach(h=>{const p=se.buildAlias(this.connection.driver,void 0,h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_"));l.addSelect(a+"."+h.propertyPath,p)});let c="";if(i.length===1){const h=n.map(p=>i[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?c=`${a}.${i[0].propertyPath} IN (${h.join(", ")})`:(l.setParameter("values1",h),c=a+"."+i[0].propertyPath+" IN (:...values1)")}else c="("+n.map((h,p)=>i.map(y=>{const f="entity1_"+p+"_"+y.propertyName;return l.setParameter(f,y.referencedColumn.getEntityValue(h)),a+"."+y.propertyPath+" = :"+f}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";let d="";if(r)if(s.length===1){const h=r.map(p=>s[0].referencedColumn.getEntityValue(p));h.every(p=>typeof p=="number")?d=`${a}.${s[0].propertyPath} IN (${h.join(", ")})`:(l.setParameter("values2",h),d=a+"."+s[0].propertyPath+" IN (:...values2)")}else d="("+r.map((h,p)=>s.map(y=>{const f="entity2_"+p+"_"+y.propertyName;return l.setParameter(f,y.referencedColumn.getEntityValue(h)),a+"."+y.propertyPath+" = :"+f}).join(" AND ")).map(h=>"("+h+")").join(" OR ")+")";const u=[c,d].filter(h=>h.length>0).join(" AND ");return l.from(o.target,a).where(u).getRawMany()}loadForManyToOneAndOneToOneOwner(e,n,r){const o=e.entityMetadata.targetName,a=e.joinColumns.every(l=>!!e.entityMetadata.nonVirtualColumns.find(c=>c===l));if(r&&a){let l=[];if(n.forEach(c=>{let d={};e.entityMetadata.primaryColumns.forEach(u=>{const h=u.entityMetadata.name+"_"+u.propertyPath.replace(".","_");d[h]=u.getEntityValue(c)}),r.forEach(u=>{e.joinColumns.forEach(h=>{const p=h.getEntityValue(c),y=h.referencedColumn.getEntityValue(u);if(!(p===void 0||y===void 0)&&p===y){const f=h.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+h.referencedColumn.propertyPath.replace(".","_");d[f]=y}})}),Object.keys(d).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&l.push(d)}),l.length===n.length)return Promise.resolve(l)}const i=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(l=>{const c=se.buildAlias(this.connection.driver,void 0,l.entityMetadata.name+"_"+l.propertyPath.replace(".","_"));i.addSelect(o+"."+l.propertyPath,c)}),e.joinColumns.forEach(l=>{const c=se.buildAlias(this.connection.driver,void 0,l.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+l.referencedColumn.propertyPath.replace(".","_"));i.addSelect(o+"."+l.propertyPath,c)});let s="";if(e.entityMetadata.primaryColumns.length===1){const l=n.map(c=>e.entityMetadata.primaryColumns[0].getEntityValue(c));l.every(c=>typeof c=="number")?s=`${o}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${l.join(", ")})`:(i.setParameter("values",l),s=o+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else s=n.map((l,c)=>e.entityMetadata.primaryColumns.map((d,u)=>{const h="entity"+c+"_"+u;return i.setParameter(h,d.getEntityValue(l)),o+"."+d.propertyPath+" = :"+h}).join(" AND ")).map(l=>"("+l+")").join(" OR ");return i.from(e.entityMetadata.target,o).where(s).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,n,r){if(e=e.inverseRelation,e.entityMetadata.primaryColumns.length===e.joinColumns.length&&e.entityMetadata.primaryColumns.every(s=>e.joinColumns.indexOf(s)!==-1))return Promise.resolve(n.map(s=>{const l={};return e.joinColumns.forEach(function(c){const d=c.referencedColumn.getEntityValue(s),u=c.referencedColumn.entityMetadata.name+"_"+c.referencedColumn.propertyPath.replace(".","_"),h=c.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+c.propertyPath.replace(".","_");l[u]=d,l[h]=d}),l}));const o=e.entityMetadata.targetName,a=this.connection.createQueryBuilder(this.queryRunner);e.entityMetadata.primaryColumns.forEach(s=>{const l=se.buildAlias(this.connection.driver,void 0,s.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+s.propertyPath.replace(".","_"));a.addSelect(o+"."+s.propertyPath,l)}),e.joinColumns.forEach(s=>{const l=se.buildAlias(this.connection.driver,void 0,s.referencedColumn.entityMetadata.name+"_"+s.referencedColumn.propertyPath.replace(".","_"));a.addSelect(o+"."+s.propertyPath,l)});let i="";if(e.joinColumns.length===1){const s=n.map(l=>e.joinColumns[0].referencedColumn.getEntityValue(l));s.every(l=>typeof l=="number")?i=`${o}.${e.joinColumns[0].propertyPath} IN (${s.join(", ")})`:(a.setParameter("values",s),i=o+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else i=n.map((s,l)=>e.joinColumns.map((c,d)=>{const u="entity"+l+"_"+d;return a.setParameter(u,c.referencedColumn.getEntityValue(s)),o+"."+c.propertyPath+" = :"+u}).join(" AND ")).map(s=>"("+s+")").join(" OR ");return a.from(e.entityMetadata.target,o).where(i).getRawMany()}}class i6{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationIds.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationIdAttributes.push(r)})})}metadataToAttribute(e,n){return new Hp(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class s6{constructor(e,n,r){this.connection=e,this.queryRunner=n,this.relationCountAttributes=r}async load(e){const n=(o,a,i)=>i.indexOf(o)===a,r=this.relationCountAttributes.map(async o=>{if(o.relation.isOneToMany){const a=o.relation,i=a.inverseRelation,s=i.joinColumns[0].referencedColumn.propertyName,l=a.inverseEntityMetadata.target,c=a.inverseEntityMetadata.tableName,d=o.alias||c,u=i.propertyName;let h=e.map(y=>y[o.parentAlias+"_"+s]).filter(y=>!!y);if(h=h.filter(n),h.length===0)return{relationCountAttribute:o,results:[]};const p=this.connection.createQueryBuilder(this.queryRunner);return p.select(d+"."+u,"parentId").addSelect("COUNT(*)","cnt").from(l,d).where(d+"."+u+" IN (:...ids)").addGroupBy(d+"."+u).setParameter("ids",h),o.queryBuilderFactory&&o.queryBuilderFactory(p),{relationCountAttribute:o,results:await p.getRawMany()}}else{let a,i,s,l;o.relation.isOwning?(a=o.relation.joinColumns[0].referencedColumn.databaseName,i=o.relation.inverseJoinColumns[0].referencedColumn.databaseName,s=o.relation.junctionEntityMetadata.columns[0],l=o.relation.junctionEntityMetadata.columns[1]):(a=o.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,i=o.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,s=o.relation.junctionEntityMetadata.columns[1],l=o.relation.junctionEntityMetadata.columns[0]);let c=e.map(v=>v[o.parentAlias+"_"+a]).filter(v=>!!v);if(c=c.filter(n),c.length===0)return{relationCountAttribute:o,results:[]};const d=o.junctionAlias,u=o.joinInverseSideMetadata.tableName,h=o.alias||u,p=o.relation.junctionEntityMetadata.tableName,y=d+"."+s.propertyName+" IN ("+c.map(v=>isNaN(v)?"'"+v+"'":v)+") AND "+d+"."+l.propertyName+" = "+h+"."+i,f=this.connection.createQueryBuilder(this.queryRunner);return f.select(d+"."+s.propertyName,"parentId").addSelect("COUNT("+f.escape(h)+"."+f.escape(i)+")","cnt").from(u,h).innerJoin(p,d,y).addGroupBy(d+"."+s.propertyName),o.queryBuilderFactory&&o.queryBuilderFactory(f),{relationCountAttribute:o,results:await f.getRawMany()}}});return Promise.all(r)}}class l6{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(e=>{const n=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(e=>{!e.metadata||e.metadata.isJunction||e.metadata.relationCounts.forEach(n=>{const r=this.metadataToAttribute(e.alias.name,n);this.expressionMap.relationCountAttributes.push(r)})})}metadataToAttribute(e,n){return new qp(this.expressionMap,{relationName:e+"."+n.relation.propertyName,mapToProperty:e+"."+n.propertyName,alias:n.alias,queryBuilderFactory:n.queryBuilderFactory})}}class Xp{static isFindOneOptions(e){const n=e;return n&&(Array.isArray(n.select)||Array.isArray(n.relations)||typeof n.select=="object"||typeof n.relations=="object"||typeof n.where=="object"||typeof n.join=="object"||typeof n.order=="object"||typeof n.cache=="object"||typeof n.cache=="boolean"||typeof n.cache=="number"||typeof n.comment=="string"||typeof n.lock=="object"||typeof n.loadRelationIds=="object"||typeof n.loadRelationIds=="boolean"||typeof n.loadEagerRelations=="boolean"||typeof n.withDeleted=="boolean"||typeof n.relationLoadStrategy=="string"||typeof n.transaction=="boolean")}static isFindManyOptions(e){const n=e;return n&&(this.isFindOneOptions(n)||typeof n.skip=="number"||typeof n.take=="number"||typeof n.skip=="string"||typeof n.take=="string")}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,n){if(n!=null&&n.relations){const r=[...n.relations];if(Xp.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new RD(r)}return e}static applyRelationsRecursively(e,n,r,o,a){let i=[];if(a){const s=new RegExp("^"+a.replace(".","\\.")+"\\.");i=n.filter(l=>l.match(s)).map(l=>o.findRelationWithPropertyPath(l.replace(s,""))).filter(l=>l)}else i=n.map(s=>o.findRelationWithPropertyPath(s)).filter(s=>s);i.forEach(s=>{let l=se.buildAlias(e.connection.driver,{joiner:"__"},r,s.propertyPath);const c=r+"."+s.propertyPath;e.expressionMap.relationLoadStrategy==="query"?e.concatRelationMetadata(s):e.leftJoinAndSelect(c,l),n.splice(n.indexOf(a?a+"."+s.propertyPath:s.propertyPath),1);let d,u;if(e.expressionMap.relationLoadStrategy==="query")d=s.inverseEntityMetadata,u=l;else{const h=e.expressionMap.joinAttributes.find(p=>p.entityOrProperty===c);d=h.metadata,u=h.alias.name}if(!u||!d)throw new Jt(s.propertyPath,o);if(this.applyRelationsRecursively(e,n,u,d,a?a+"."+s.propertyPath:s.propertyPath),e.expressionMap.relationLoadStrategy==="join"){const h=o.relations.find(p=>p.propertyName===s.propertyPath);h&&this.joinEagerRelations(e,l,h.inverseEntityMetadata)}})}static joinEagerRelations(e,n,r){r.eagerRelations.forEach(o=>{let a=se.buildAlias(e.connection.driver,{joiner:"__"},n,o.propertyName),i=!0;for(const c of e.expressionMap.joinAttributes)if(!(c.condition!==void 0||c.mapToProperty!==void 0||c.isMappingMany!==void 0||c.direction!=="LEFT"||c.entityOrProperty!==`${n}.${o.propertyPath}`)){i=!1,a=c.alias.name;break}const s=!!e.expressionMap.joinAttributes.find(c=>c.alias.name===a);i&&!s&&e.leftJoin(n+"."+o.propertyPath,a);let l=!0;for(const c of e.expressionMap.selects)if(!(c.aliasName!==void 0||c.virtual!==void 0||c.selection!==a)){l=!1;break}l&&e.addSelect(a),this.joinEagerRelations(e,a,o.inverseEntityMetadata)})}}class Zp extends Je{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),this.replacePropertyNamesForTheWholeQuery(e)}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,n){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map(r=>({selection:r}));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:n}]);return this}addSelect(e,n){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(r=>({selection:r})));else if(typeof e=="function"){const r=e(this.subQuery());this.setParameters(r.getParameters()),this.expressionMap.selects.push({selection:r.getQuery(),aliasName:n})}else e&&this.expressionMap.selects.push({selection:e,aliasName:n});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}fromDummy(){return this.from(this.connection.driver.dummyTableName??"(SELECT 1 AS dummy_column)","dummy_table")}from(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}addFrom(e,n){const r=this.createFromAlias(e,n);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(r),this}innerJoin(e,n,r,o){return this.join("INNER",e,n,r,o),this}leftJoin(e,n,r,o){return this.join("LEFT",e,n,r,o),this}innerJoinAndSelect(e,n,r,o){return this.addSelect(n),this.innerJoin(e,n,r,o),this}leftJoinAndSelect(e,n,r,o){return this.addSelect(n),this.leftJoin(e,n,r,o),this}innerJoinAndMapMany(e,n,r,o,a){return this.addSelect(r),this.join("INNER",n,r,o,a,e,!0),this}innerJoinAndMapOne(e,n,r,o,a,i){return this.addSelect(r),this.join("INNER",n,r,o,a,e,!1,i),this}leftJoinAndMapMany(e,n,r,o,a){return this.addSelect(r),this.join("LEFT",n,r,o,a,e,!0),this}leftJoinAndMapOne(e,n,r,o,a,i){return this.addSelect(r),this.join("LEFT",n,r,o,a,e,!1,i),this}loadRelationIdAndMap(e,n,r,o){const a=new Hp(this.expressionMap);return a.mapToProperty=e,a.relationName=n,typeof r=="string"&&(a.alias=r),typeof r=="object"&&r.disableMixedMap&&(a.disableMixedMap=!0),a.queryBuilderFactory=o,this.expressionMap.relationIdAttributes.push(a),a.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:a.junctionAlias,metadata:a.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,n,r,o){const a=new qp(this.expressionMap);return a.mapToProperty=e,a.relationName=n,a.alias=r,a.queryBuilderFactory=o,this.expressionMap.relationCountAttributes.push(a),this.expressionMap.createAlias({type:"other",name:a.junctionAlias}),a.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:a.junctionAlias,metadata:a.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach(n=>{e!==void 0&&e.relations!==void 0&&e.relations.indexOf(n.propertyPath)===-1||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+n.propertyPath,this.expressionMap.mainAlias.name+"."+n.propertyPath,e)}),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereExists(e){return this.where(...this.getExistsCondition(e))}andWhereExists(e){return this.andWhere(...this.getExistsCondition(e))}orWhereExists(e){return this.orWhere(...this.getExistsCondition(e))}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,n){return this.expressionMap.havings.push({type:"simple",condition:e}),n&&this.setParameters(n),this}andHaving(e,n){return this.expressionMap.havings.push({type:"and",condition:e}),n&&this.setParameters(n),this}orHaving(e,n){return this.expressionMap.havings.push({type:"or",condition:e}),n&&this.setParameters(n),this}groupBy(e){return e?this.expressionMap.groupBys=[e]:this.expressionMap.groupBys=[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}timeTravelQuery(e){return this.connection.driver.options.type==="cockroachdb"&&(e===void 0?this.expressionMap.timeTravel="follower_read_timestamp()":this.expressionMap.timeTravel=e),this}orderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new de('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new de('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){if(n!==void 0&&n!=="ASC"&&n!=="DESC")throw new de('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(r!==void 0&&r!=="NULLS FIRST"&&r!=="NULLS LAST")throw new de('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),this.expressionMap.limit!==void 0&&isNaN(this.expressionMap.limit))throw new de('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),this.expressionMap.offset!==void 0&&isNaN(this.expressionMap.offset))throw new de('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),this.expressionMap.take!==void 0&&isNaN(this.expressionMap.take))throw new de('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),this.expressionMap.skip!==void 0&&isNaN(this.expressionMap.skip))throw new de('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,n,r){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=n,this.expressionMap.lockTables=r,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if(this.expressionMap.lockMode==="optimistic")throw new Ma;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0);const r=await this.loadRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const e=(await this.getRawAndEntities()).entities[0];if(e&&this.expressionMap.lockMode==="optimistic"&&this.expressionMap.lockVersion){const n=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const r=n.updateDateColumn.getEntityValue(e);if(r.getTime()!==this.expressionMap.lockVersion.getTime())throw new G_(n.name,this.expressionMap.lockVersion,r)}else{const r=n.versionColumn.getEntityValue(e);if(r!==this.expressionMap.lockVersion)throw new G_(n.name,this.expressionMap.lockVersion,r)}}return e===void 0?null:e}async getOneOrFail(){const e=await this.getOne();if(!e)throw new OD(this.expressionMap.mainAlias.target,this.expressionMap.parameters);return e}async getMany(){if(this.expressionMap.lockMode==="optimistic")throw new Ma;return(await this.getRawAndEntities()).entities}async getCount(){if(this.expressionMap.lockMode==="optimistic")throw new Ma;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeCountQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getExists(){if(this.expressionMap.lockMode==="optimistic")throw new Ma;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!1;const r=await this.executeExistsQuery(e);return n&&await e.commitTransaction(),r}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if(this.expressionMap.lockMode==="optimistic")throw new Ma;const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.queryEntity=!0;const r=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const o=this.expressionMap.cacheId;this.expressionMap.cacheId=o&&`${o}-count`;const a=await this.executeCountQuery(e),i=[r.entities,a];return n&&await e.commitTransaction(),i}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,n]=this.getQueryAndParameters(),r=this.obtainQueryRunner();let o=!1;try{this.expressionMap.useTransaction===!0&&r.isTransactionActive===!1&&(await r.startTransaction(),o=!0);const a=()=>{if(r!==this.queryRunner)return r.release()},i=r.stream(e,n,a,a);return o&&await r.commitTransaction(),i}catch(a){if(o)try{await r.rollbackTransaction()}catch{}throw a}}cache(e,n){return typeof e=="boolean"?this.expressionMap.cache=e:typeof e=="number"?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):(typeof e=="string"||typeof e=="number")&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),n&&(this.expressionMap.cacheDuration=n),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,n,r,o,a,i,s,l){a&&this.setParameters(a);const c=new fM(this.connection,this.expressionMap);c.direction=e,c.mapAsEntity=l,c.mapToProperty=i,c.isMappingMany=s,c.entityOrProperty=n,c.condition=o,this.expressionMap.joinAttributes.push(c);const d=c.metadata;if(d){if(d.deleteDateColumn&&!this.expressionMap.withDeleted){const u=`${r}.${d.deleteDateColumn.propertyName} IS NULL`;c.condition=c.condition?` ${c.condition} AND ${u}`:`${u}`}c.alias=this.expressionMap.createAlias({type:"join",name:r,metadata:d}),c.relation&&c.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:c.junctionAlias,metadata:c.relation.junctionEntityMetadata})}else{let u="";if(typeof n=="function"){const p=n(this.subQuery());this.setParameters(p.getParameters()),u=p.getQuery()}else u=n;const h=typeof n=="function"||n.substr(0,1)==="("&&n.substr(-1)===")";c.alias=this.expressionMap.createAlias({type:"join",name:r,tablePath:h===!1?n:void 0,subQuery:h===!0?u:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new de("Cannot build query because main alias is not set (call qb#from method)");const e=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){const s=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,s)),n.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,s))}this.expressionMap.joinAttributes.forEach(s=>{if(s.metadata)e.push(...this.buildEscapedEntityColumnSelects(s.alias.name,s.metadata)),n.push(...this.findEntityColumnSelects(s.alias.name,s.metadata));else if(this.expressionMap.selects.some(l=>l.selection===s.alias.name)){e.push({selection:this.escape(s.alias.name)+".*"});const l=this.expressionMap.selects.find(c=>c.selection===s.alias.name);n.push(l)}}),this.expressionMap.selects.filter(s=>n.indexOf(s)===-1).forEach(s=>e.push({selection:this.replacePropertyNames(s.selection),aliasName:s.aliasName})),e.length===0&&e.push({selection:"*"});let r="";this.expressionMap.useIndex&&se.isMySQLFamily(this.connection.driver)&&(r=` USE INDEX (${this.expressionMap.useIndex})`);const o=this.expressionMap.aliases.filter(s=>s.type==="from"&&(s.tablePath||s.subQuery)).map(s=>s.subQuery?s.subQuery+" "+this.escape(s.name):this.getTableName(s.tablePath)+" "+this.escape(s.name)),a=this.createSelectDistinctExpression(),i=e.map(s=>s.selection+(s.aliasName?" AS "+this.escape(s.aliasName):"")).join(", ");return a+i+" FROM "+o.join(", ")+this.createTableLockExpression()+r}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:n,maxExecutionTime:r}=this.expressionMap,{driver:o}=this.connection;let a="SELECT ";return r>0&&se.isMySQLFamily(o)&&(a+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),se.isPostgresFamily(o)&&n.length>0?a=`SELECT DISTINCT ON (${n.map(i=>this.replacePropertyNames(i)).join(", ")}) `:e&&(a="SELECT DISTINCT "),a}createJoinExpression(){return this.expressionMap.joinAttributes.map(e=>{const n=e.relation,r=e.tablePath,o=e.alias.name;let a=e.condition?" AND ("+e.condition+")":"";const i=e.parentAlias;if(!i||!n){const s=e.alias.subQuery?e.alias.subQuery:this.getTableName(r);return" "+e.direction+" JOIN "+s+" "+this.escape(o)+this.createTableLockExpression()+(e.condition?" ON "+this.replacePropertyNames(e.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){const s=n.joinColumns.map(l=>o+"."+l.referencedColumn.propertyPath+"="+i+"."+n.propertyPath+"."+l.referencedColumn.propertyPath).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(o)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+a)}else if(n.isOneToMany||n.isOneToOneNotOwner){const s=n.inverseRelation.joinColumns.map(l=>(n.inverseEntityMetadata.tableType==="entity-child"&&n.inverseEntityMetadata.discriminatorColumn&&(a+=" AND "+o+"."+n.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+n.inverseEntityMetadata.discriminatorValue+"'"),o+"."+n.inverseRelation.propertyPath+"."+l.referencedColumn.propertyPath+"="+i+"."+l.referencedColumn.propertyPath)).join(" AND ");if(!s)throw new de(`Relation ${n.entityMetadata.name}.${n.propertyName} does not have join columns.`);return" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(o)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+a)}else{const s=n.junctionEntityMetadata.tablePath,l=e.junctionAlias;let c="",d="";return n.isOwning?(c=n.joinColumns.map(u=>l+"."+u.propertyPath+"="+i+"."+u.referencedColumn.propertyPath).join(" AND "),d=n.inverseJoinColumns.map(u=>o+"."+u.referencedColumn.propertyPath+"="+l+"."+u.propertyPath).join(" AND ")):(c=n.inverseRelation.inverseJoinColumns.map(u=>l+"."+u.propertyPath+"="+i+"."+u.referencedColumn.propertyPath).join(" AND "),d=n.inverseRelation.joinColumns.map(u=>o+"."+u.referencedColumn.propertyPath+"="+l+"."+u.propertyPath).join(" AND "))," "+e.direction+" JOIN "+this.getTableName(s)+" "+this.escape(l)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(c)+" "+e.direction+" JOIN "+this.getTableName(r)+" "+this.escape(o)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(d+a)}}).join(" ")}createGroupByExpression(){return!this.expressionMap.groupBys||!this.expressionMap.groupBys.length?"":" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", "))}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length===0?"":" ORDER BY "+Object.keys(e).map(n=>{const r=typeof e[n]=="string"?e[n]:e[n].order+" "+e[n].nulls,o=this.expressionMap.selects.find(a=>a.selection===n);if(o&&!o.aliasName&&n.indexOf(".")!==-1){const a=n.split("."),i=a[0],s=a.slice(1).join("."),l=this.expressionMap.aliases.find(c=>c.name===i);if(l){const c=l.metadata.findColumnWithPropertyPath(s);if(c){const d=se.buildAlias(this.connection.driver,void 0,i,c.databaseName);return this.escape(d)+" "+r}}}return this.replacePropertyNames(n)+" "+r}).join(", ")}createLimitOffsetExpression(){let e=this.expressionMap.offset,n=this.expressionMap.limit;if(!e&&!n&&this.expressionMap.joinAttributes.length===0&&(e=this.expressionMap.skip,n=this.expressionMap.take),this.connection.driver.options.type==="mssql"){let r="";if((n||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(r=" ORDER BY (SELECT NULL)"),n&&e)return r+" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return r+" OFFSET 0 ROWS FETCH NEXT "+n+" ROWS ONLY";if(e)return r+" OFFSET "+e+" ROWS"}else if(se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql"||this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner"){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)throw new TD}else if(se.isSQLiteFamily(this.connection.driver)){if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver.options.type==="oracle"){if(n&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+n+" ROWS ONLY";if(n)return" FETCH NEXT "+n+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(n&&e)return" LIMIT "+n+" OFFSET "+e;if(n)return" LIMIT "+n;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if(this.connection.driver.options.type==="mssql")switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let n="";if(this.expressionMap.lockTables){if(!(se.isPostgresFamily(e)||e.options.type==="cockroachdb"))throw new de("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new de("lockTables cannot be an empty array");n=" OF "+this.expressionMap.lockTables.join(", ")}let r="";switch(this.expressionMap.onLocked==="nowait"?r=" NOWAIT":this.expressionMap.onLocked==="skip_locked"&&(r=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if(e.options.type==="mysql"||e.options.type==="aurora-mysql")return se.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+n+r:" LOCK IN SHARE MODE";if(e.options.type==="mariadb")return" LOCK IN SHARE MODE";if(se.isPostgresFamily(e))return" FOR SHARE"+n+r;if(e.options.type==="oracle")return" FOR UPDATE";if(e.options.type==="mssql")return"";throw new Gr;case"pessimistic_write":if(se.isMySQLFamily(e)||e.options.type==="aurora-mysql"||e.options.type==="oracle")return" FOR UPDATE"+r;if(se.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+r;if(e.options.type==="mssql")return"";throw new Gr;case"pessimistic_partial_write":if(se.isPostgresFamily(e))return" FOR UPDATE"+n+" SKIP LOCKED";if(se.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new Gr;case"pessimistic_write_or_fail":if(se.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR UPDATE"+n+" NOWAIT";if(se.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new Gr;case"for_no_key_update":if(se.isPostgresFamily(e)||e.options.type==="cockroachdb")return" FOR NO KEY UPDATE"+n+r;throw new Gr;case"for_key_share":if(se.isPostgresFamily(e))return" FOR KEY SHARE"+n+r;throw new Gr;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map((n,r)=>{switch(n.type){case"and":return(r>0?"AND ":"")+this.replacePropertyNames(n.condition);case"or":return(r>0?"OR ":"")+this.replacePropertyNames(n.condition);default:return this.replacePropertyNames(n.condition)}}).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,n){const r=this.expressionMap.selects.some(c=>c.selection===e),o=[];if(r&&o.push(...n.columns.filter(c=>c.isSelect===!0)),o.push(...n.columns.filter(c=>this.expressionMap.selects.some(d=>d.selection===e+"."+c.propertyPath))),o.length===0)return[];const a=this.expressionMap.queryEntity?n.primaryColumns.filter(c=>o.indexOf(c)===-1):[],i=[...o,...a],s=[],l=this.escape(e);return i.forEach(c=>{let d=l+"."+this.escape(c.databaseName);c.isVirtualProperty&&c.query&&(d=`(${c.query(l)})`),this.connection.driver.spatialTypes.indexOf(c.type)!==-1&&((se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&(d=`${this.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText"}(${d})`),se.isPostgresFamily(this.connection.driver)&&(c.precision?d=`ST_AsGeoJSON(${d}, ${c.precision})::json`:d=`ST_AsGeoJSON(${d})::json`),this.connection.driver.options.type==="mssql"&&(d=`${d}.ToString()`));const u=this.expressionMap.selects.filter(h=>h.selection===e+"."+c.propertyPath);if(u.length)u.forEach(h=>{s.push({selection:d,aliasName:h.aliasName?h.aliasName:se.buildAlias(this.connection.driver,void 0,e,c.databaseName),virtual:h.virtual})});else{if(c.isVirtualProperty)return;s.push({selection:d,aliasName:se.buildAlias(this.connection.driver,void 0,e,c.databaseName),virtual:r})}}),s}findEntityColumnSelects(e,n){const r=this.expressionMap.selects.find(o=>o.selection===e);return r?[r]:this.expressionMap.selects.filter(o=>n.columns.some(a=>o.selection===e+"."+a.propertyPath))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(e);if(this.expressionMap.joinAttributes.length===0&&this.expressionMap.relationIdAttributes.length===0&&this.expressionMap.relationCountAttributes.length===0)return"COUNT(1)";if(this.connection.driver.options.type==="cockroachdb"||se.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+n.map(o=>`${r}.${this.escape(o.databaseName)}`).join(", ")+"))";if(se.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+n.map(o=>`${r}.${this.escape(o.databaseName)}`).join(", ")+")";if(this.connection.driver.options.type==="mssql"){const o=n.map(a=>`${r}.${this.escape(a.databaseName)}`).join(", '|;|', ");return n.length===1?`COUNT(DISTINCT(${o}))`:`COUNT(DISTINCT(CONCAT(${o})))`}return this.connection.driver.options.type==="spanner"?n.length===1?`COUNT(DISTINCT(${r}.${this.escape(n[0].databaseName)}))`:`COUNT(DISTINCT(CONCAT(${n.map(o=>`CAST(${r}.${this.escape(o.databaseName)} AS STRING)`).join(", '|;|', ")})))`:"COUNT(DISTINCT("+n.map(o=>`${r}.${this.escape(o.databaseName)}`).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const n=this.computeCountExpression(),r=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(n,"cnt").setOption("disable-global-order").loadRawResults(e);return!r||!r[0]||!r[0].cnt?0:parseInt(r[0].cnt)}async executeExistsQuery(e){return(await this.connection.createQueryBuilder().fromDummy().select("1","row_exists").whereExists(this).limit(1).loadRawResults(e)).length>0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?pt.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?pt.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.findOptions.loadEagerRelations!==!1&&this.expressionMap.relationLoadStrategy==="join"&&this.buildEagerRelations(e,typeof this.findOptions.select=="object"?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere(this.conditions.substr(0,1)!=="("?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach(e=>{e.select&&!e.selection?e.type==="inner"?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):e.type==="inner"?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)}),this.findOptions.skip!==void 0&&this.skip(this.findOptions.skip),this.findOptions.take!==void 0&&this.take(this.findOptions.take),typeof this.findOptions.cache=="number"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="boolean"?this.cache(this.findOptions.cache):typeof this.findOptions.cache=="object"&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach(e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)}),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach(e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)}),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach(e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)}),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach(e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)})),this.findOptions.lock){if(this.findOptions.lock.mode==="optimistic")this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if(this.findOptions.lock.mode==="pessimistic_read"||this.findOptions.lock.mode==="pessimistic_write"||this.findOptions.lock.mode==="dirty_read"||this.findOptions.lock.mode==="pessimistic_partial_write"||this.findOptions.lock.mode==="pessimistic_write_or_fail"||this.findOptions.lock.mode==="for_no_key_update"||this.findOptions.lock.mode==="for_key_share"){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map(n=>{const r=this.expressionMap.aliases.find(o=>o.metadata.tableNameWithoutPrefix===n);if(!r)throw new de(`"${n}" is not part of this query`);return this.escape(r.name)}):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}}this.findOptions.loadRelationIds===!0?this.loadAllRelationIds():typeof this.findOptions.loadRelationIds=="object"&&this.loadAllRelationIds(this.findOptions.loadRelationIds),this.findOptions.loadEagerRelations!==!1&&Xp.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),this.findOptions.transaction===!0&&(this.expressionMap.useTransaction=!0)}}concatRelationMetadata(e){this.relationMetadatas.push(e)}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new de('Alias is not set. Use "from" method to set an alias.');if((this.expressionMap.lockMode==="pessimistic_read"||this.expressionMap.lockMode==="pessimistic_write"||this.expressionMap.lockMode==="pessimistic_partial_write"||this.expressionMap.lockMode==="pessimistic_write_or_fail"||this.expressionMap.lockMode==="for_no_key_update"||this.expressionMap.lockMode==="for_key_share")&&!e.isTransactionActive)throw new PD;if(this.expressionMap.lockMode==="optimistic"){const i=this.expressionMap.mainAlias.metadata;if(!i.versionColumn&&!i.updateDateColumn)throw new kD(i.name)}const n=new o6(this.connection,e,this.expressionMap.relationIdAttributes),r=new s6(this.connection,e,this.expressionMap.relationCountAttributes);new i6(this.expressionMap).transform(),new l6(this.expressionMap).transform();let o=[],a=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[i,s]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),l=this.expressionMap.mainAlias.metadata,c=this.expressionMap.mainAlias.name,d=l.primaryColumns.map(p=>{const y=this.escape("distinctAlias"),f=this.escape(se.buildAlias(this.connection.driver,void 0,c,p.databaseName));s[f]||(s[f]="ASC");const v=se.buildAlias(this.connection.driver,void 0,"ids_"+c,p.databaseName);return`${y}.${f} AS ${this.escape(v)}`}),u=this.clone(),h=u.expressionMap.timeTravel;if(o=await new Zp(this.connection,e).select(`DISTINCT ${d.join(", ")}`).addSelect(i).from(`(${u.orderBy().timeTravelQuery(!1).getQuery()})`,"distinctAlias").timeTravelQuery(h).offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(s).cache(this.expressionMap.cache&&this.expressionMap.cacheId?`${this.expressionMap.cacheId}-pagination`:this.expressionMap.cache,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),o.length>0){let p="";const y={};if(l.hasMultiplePrimaryKeys)p=o.map((f,v)=>l.primaryColumns.map(g=>{const b=`orm_distinct_ids_${v}_${g.databaseName}`,w=se.buildAlias(this.connection.driver,void 0,"ids_"+c,g.databaseName);return y[b]=f[w],`${c}.${g.propertyPath}=:${b}`}).join(" AND ")).join(" OR ");else{const f=se.buildAlias(this.connection.driver,void 0,"ids_"+c,l.primaryColumns[0].databaseName),v=o.map(g=>g[f]);v.every(g=>typeof g=="number")?p=`${c}.${l.primaryColumns[0].propertyPath} IN (${v.join(", ")})`:(y.orm_distinct_ids=v,p=c+"."+l.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}o=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:p}).setParameters(y).loadRawResults(e)}}else o=await this.loadRawResults(e);if(o.length>0){const i=await n.load(o),s=await r.load(o);a=new r6(this.expressionMap,this.connection.driver,i,s,this.queryRunner).transform(o,this.expressionMap.mainAlias),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,a)}if(this.expressionMap.relationLoadStrategy==="query"){const i=new a6(this.connection,e);await Promise.all(this.relationMetadatas.map(async s=>{const l=s.inverseEntityMetadata.target,c=s.inverseEntityMetadata.targetName,d=Array.isArray(this.findOptions.select)?pt.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,u=Array.isArray(this.findOptions.relations)?pt.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,h=this.createQueryBuilder(e).select(c).from(l,c).setFindOptions({select:d?pt.deepValue(d,s.propertyPath):void 0,order:this.findOptions.order?pt.deepValue(this.findOptions.order,s.propertyPath):void 0,relations:u?pt.deepValue(u,s.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(a.length>0){const p=await i.loadManyToManyRelationIdsAndGroup(s,a,void 0,h);a.forEach(y=>{const f=p.find(v=>v.entity===y);if(f){const v=f.related===void 0?null:f.related;s.setEntityValue(y,v)}})}}))}return{raw:o,entities:a}}createOrderByCombinedWithSelectExpression(e){const n=this.expressionMap.allOrderBys,r=Object.keys(n).map(a=>{if(a.indexOf(".")!==-1){const i=a.split("."),s=i[0],l=i.slice(1).join("."),c=this.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(l);return this.escape(e)+"."+this.escape(se.buildAlias(this.connection.driver,void 0,s,c.databaseName))}else return this.expressionMap.selects.find(i=>i.selection===a||i.aliasName===a)?this.escape(e)+"."+this.escape(a):""}).join(", "),o={};return Object.keys(n).forEach(a=>{if(a.indexOf(".")!==-1){const i=a.split("."),s=i[0],l=i.slice(1).join("."),c=this.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(l);o[this.escape(e)+"."+this.escape(se.buildAlias(this.connection.driver,void 0,s,c.databaseName))]=n[a]}else this.expressionMap.selects.find(i=>i.selection===a||i.aliasName===a)?o[this.escape(e)+"."+this.escape(a)]=n[a]:o[a]=n[a]}),[r,o]}async loadRawResults(e){const[n,r]=this.getQueryAndParameters(),o=n+" -- PARAMETERS: "+JSON.stringify(r,(d,u)=>typeof u=="bigint"?u.toString():u),a=typeof this.connection.options.cache=="object"?this.connection.options.cache:{};let i;const s=a.alwaysEnabled&&this.expressionMap.cache!==!1||this.expressionMap.cache===!0;let l=!1;if(this.connection.queryResultCache&&s)try{if(i=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:o,duration:this.expressionMap.cacheDuration||a.duration||1e3},e),i&&!this.connection.queryResultCache.isExpired(i))return JSON.parse(i.result)}catch(d){if(!a.ignoreErrors)throw d;l=!0}const c=await e.query(n,r,!0);if(!l&&this.connection.queryResultCache&&s)try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:o,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||a.duration||1e3,result:JSON.stringify(c.records)},i,e)}catch(d){if(!a.ignoreErrors)throw d}return c.records}mergeExpressionMap(e){return it.assign(this.expressionMap,e),this}normalizeNumber(e){return typeof e=="number"||e===void 0||e===null?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner(this.connection.defaultReplicationModeForReads())}buildSelect(e,n,r,o){for(let a in e){if(e[a]===void 0||e[a]===!1)continue;const i=o?o+"."+a:a,s=n.findColumnWithPropertyPathStrict(i),l=n.findEmbeddedWithPropertyPath(i),c=n.findRelationWithPropertyPath(i);if(!l&&!s&&!c)throw new Jt(i,n);s?this.selects.push(r+"."+i):l&&this.buildSelect(e[a],n,r,i)}}buildRelations(e,n,r,o,a){e&&Object.keys(e).forEach(i=>{const s=e[i],l=a?a+"."+i:i,c=r.findEmbeddedWithPropertyPath(l),d=r.findRelationWithPropertyPath(l);if(!c&&!d)throw new Jt(l,r);if(c)this.buildRelations(s,typeof n=="object"?pt.deepValue(n,c.propertyPath):void 0,r,o,l);else if(d){let u=o+"_"+l.replace(".","_");u=se.buildAlias(this.connection.driver,{joiner:"__"},o,u),(s===!0||typeof s=="object")&&(this.expressionMap.relationLoadStrategy==="query"?this.concatRelationMetadata(d):(this.joins.push({type:"left",select:!0,selection:n&&typeof n[i]=="object"?n[i]:void 0,alias:u,parentAlias:o,relationMetadata:d}),n&&typeof n[i]=="object"&&this.buildSelect(n[i],d.inverseEntityMetadata,u))),typeof s=="object"&&this.expressionMap.relationLoadStrategy==="join"&&this.buildRelations(s,typeof n=="object"?pt.deepValue(n,d.propertyPath):void 0,d.inverseEntityMetadata,u,void 0)}})}buildEagerRelations(e,n,r,o,a){e&&Object.keys(e).forEach(i=>{const s=e[i],l=a?a+"."+i:i,c=r.findEmbeddedWithPropertyPath(l),d=r.findRelationWithPropertyPath(l);if(!c&&!d)throw new Jt(l,r);if(c)this.buildEagerRelations(s,typeof n=="object"?pt.deepValue(n,c.propertyPath):void 0,r,o,l);else if(d){let u=o+"_"+l.replace(".","_");u=se.buildAlias(this.connection.driver,{joiner:"__"},o,u),(s===!0||typeof s=="object")&&d.inverseEntityMetadata.eagerRelations.forEach(h=>{let p=u+"_"+h.propertyPath.replace(".","_");p=se.buildAlias(this.connection.driver,{joiner:"__"},u,p),this.joins.find(y=>y.alias===p)||this.joins.push({type:"left",select:!0,alias:p,parentAlias:u,selection:void 0,relationMetadata:h}),n&&typeof n[i]=="object"&&this.buildSelect(n[i],d.inverseEntityMetadata,u)}),typeof s=="object"&&this.buildEagerRelations(s,typeof n=="object"?pt.deepValue(n,d.propertyPath):void 0,d.inverseEntityMetadata,u,void 0)}})}buildOrder(e,n,r,o){for(let a in e){if(e[a]===void 0)continue;const i=o?o+"."+a:a,s=n.findColumnWithPropertyPathStrict(i),l=n.findEmbeddedWithPropertyPath(i),c=n.findRelationWithPropertyPath(i);if(!l&&!s&&!c)throw new Jt(i,n);if(s){let d=typeof e[a]=="object"?e[a].direction:e[a];d=d==="DESC"||d==="desc"||d===-1?"DESC":"ASC";let u=typeof e[a]=="object"?e[a].nulls:void 0;u=(u==null?void 0:u.toLowerCase())==="first"?"NULLS FIRST":(u==null?void 0:u.toLowerCase())==="last"?"NULLS LAST":void 0;let h=`${r}.${i}`;this.addOrderBy(h,d,u)}else if(l)this.buildOrder(e[a],n,r,i);else if(c){let d=r+"_"+i.replace(".","_");d=se.buildAlias(this.connection.driver,{joiner:"__"},r,d),this.joins.find(u=>u.alias===d)||this.joins.push({type:"left",select:!1,alias:d,parentAlias:r,selection:void 0,relationMetadata:c}),this.buildOrder(e[a],c.inverseEntityMetadata,d)}}}buildWhere(e,n,r,o){let a="";if(Array.isArray(e))e.length&&(a=e.map(i=>this.buildWhere(i,n,r,o)).filter(i=>!!i).map(i=>"("+i+")").join(" OR "));else{let i=[];for(let s in e){if(e[s]===void 0||e[s]===null)continue;const l=o?o+"."+s:s,c=n.findColumnWithPropertyPathStrict(l),d=n.findEmbeddedWithPropertyPath(l),u=n.findRelationWithPropertyPath(l);if(!d&&!c&&!u)throw new Jt(l,n);if(c){let h=`${r}.${l}`;c.isVirtualProperty&&c.query&&(h=`(${c.query(r)})`);let p=e[s];ze.isEqualOperator(e[s])&&(p=e[s].value),c.transformer&&(p instanceof Ca?p.transformValue(c.transformer):p=Kp.transformTo(c.transformer,p)),i.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,p)))}else if(d){const h=this.buildWhere(e[s],n,r,l);h&&i.push(h)}else if(u){if(typeof e[s]=="object"&&Object.keys(e[s]).every(h=>e[s][h]===void 0))continue;if(ze.isFindOperator(e[s]))if(e[s].type==="moreThan"||e[s].type==="lessThan"||e[s].type==="moreThanOrEqual"||e[s].type==="lessThanOrEqual"){let h="";e[s].type==="moreThan"?h=">":e[s].type==="lessThan"?h="<":e[s].type==="moreThanOrEqual"?h=">=":e[s].type==="lessThanOrEqual"&&(h="<=");const p=this.subQuery();if(u.isManyToManyOwner)p.select("COUNT(*)").from(u.joinTableName,u.joinTableName).where(u.joinColumns.map(y=>`${u.joinTableName}.${y.propertyName} = ${r}.${y.referencedColumn.propertyName}`).join(" AND "));else if(u.isManyToManyNotOwner)p.select("COUNT(*)").from(u.inverseRelation.joinTableName,u.inverseRelation.joinTableName).where(u.inverseRelation.inverseJoinColumns.map(y=>`${u.inverseRelation.joinTableName}.${y.propertyName} = ${r}.${y.referencedColumn.propertyName}`).join(" AND "));else if(u.isOneToMany)p.select("COUNT(*)").from(u.inverseEntityMetadata.target,u.inverseEntityMetadata.tableName).where(u.inverseRelation.joinColumns.map(y=>`${u.inverseEntityMetadata.tableName}.${y.propertyName} = ${r}.${y.referencedColumn.propertyName}`).join(" AND "));else throw new Error("This relation isn't supported by given find operator");this.andWhere(p.getSql()+" "+h+" "+parseInt(e[s].value))}else if(u.isManyToOne||u.isOneToOne&&u.isOneToOneOwner){const h=`${r}.${l}`;i.push(this.createWhereConditionExpression(this.getWherePredicateCondition(h,e[s])))}else throw new Error("This relation isn't supported by given find operator");else{let h=r+"_"+u.propertyPath.replace(".","_");h=se.buildAlias(this.connection.driver,{joiner:"__"},r,h),this.joins.find(y=>y.alias===h)||this.joins.push({type:"left",select:!1,selection:void 0,alias:h,parentAlias:r,relationMetadata:u});const p=this.buildWhere(e[s],u.inverseEntityMetadata,h);p&&i.push(p)}}}a=i.length?"("+i.join(") AND (")+")":i.join(" AND ")}return a.length?"("+a+")":a}}class bM{constructor(){this.generatedMaps=[]}static from(e){const n=new this;return n.raw=e.records,n.affected=e.affected,n}}class c6 extends Je{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const r=new Yp(e,this.expressionMap);this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=r.getSoftDeletionReturningColumns());const[o,a]=this.getQueryAndParameters(),i=await e.query(o,a,!0),s=bM.from(i);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await r.update(s,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.queryType==="soft-delete"?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):this.expressionMap.queryType==="restore"&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),n&&await e.commitTransaction(),s}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}from(e,n){e=ze.isEntitySchema(e)?e.options.name:e;const r=this.createFromAlias(e,n);return this.expressionMap.setMainAlias(r),this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new Rs;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new de(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const o=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!o)throw new de("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(o)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new de(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new AD(e);const n=[];switch(this.expressionMap.queryType){case"soft-delete":n.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":n.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new de('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&n.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&n.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),n.length<=0)throw new Tp;const r=this.createWhereExpression(),o=this.createReturningExpression("update");return o===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")} OUTPUT ${o}${r}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${n.join(", ")}${r} RETURNING ${o}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(se.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new J_}return""}}class u6 extends Je{constructor(e,n){super(e,n),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),this.replacePropertyNamesForTheWholeQuery(e.trim())}async execute(){const e=this.obtainQueryRunner();let n=!1;try{this.expressionMap.useTransaction===!0&&e.isTransactionActive===!1&&(await e.startTransaction(),n=!0),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let r=null,o=null;const a=new Yp(e,this.expressionMap),i=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const h of this.expressionMap.returning)i.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(h));this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=a.getUpdationReturningColumns(),i.push(...this.expressionMap.extraReturningColumns.filter(h=>!i.includes(h)))),i.length>0&&this.connection.driver.options.type==="mssql"&&(r=this.connection.driver.buildTableVariableDeclaration("@OutputTable",i),o="SELECT * FROM @OutputTable");const[s,l]=this.getQueryAndParameters(),c=[r,s,o],d=await e.query(c.filter(h=>h!=null).join(`;

`),l,!0),u=bM.from(d);return this.expressionMap.updateEntity===!0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await a.update(u,this.expressionMap.whereEntities),this.expressionMap.callListeners===!0&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),n&&await e.commitTransaction(),u}catch(r){if(n)try{await e.rollbackTransaction()}catch{}throw r}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,n){this.expressionMap.wheres=[];const r=this.getWhereCondition(e);return r&&(this.expressionMap.wheres=[{type:"simple",condition:r}]),n&&this.setParameters(n),this}andWhere(e,n){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}orWhere(e,n){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),n&&this.setParameters(n),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new Rs;return this.expressionMap.returning=e,this}orderBy(e,n="ASC",r){return e?typeof e=="object"?this.expressionMap.orderBys=e:r?this.expressionMap.orderBys={[e]:{order:n,nulls:r}}:this.expressionMap.orderBys={[e]:n}:this.expressionMap.orderBys={},this}addOrderBy(e,n="ASC",r){return r?this.expressionMap.orderBys[e]={order:n,nulls:r}:this.expressionMap.orderBys[e]=n,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new de(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const n=Array.isArray(e)?e:[e];return n.forEach(r=>{const o=this.expressionMap.mainAlias.metadata.getEntityIdMap(r);if(!o)throw new de("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(o)}),this.expressionMap.whereEntities=n,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r={};for(let l in e)e[l]!==void 0&&(r[l]=e[l]);const o=[],a=[];if(n?(this.createPropertyPath(n,r).forEach(l=>{const c=n.findColumnsWithPropertyPath(l);if(c.length<=0)throw new Jt(l,n);c.forEach(d=>{if(!d.isUpdate||a.includes(d))return;a.push(d);let u=d.getEntityValue(r);if(d.referencedColumn&&typeof u=="object"&&!(u instanceof Date)&&u!==null&&!Fs.isBuffer(u)?u=d.referencedColumn.getEntityValue(u):typeof u!="function"&&(u=this.connection.driver.preparePersistentValue(u,d)),typeof u=="function")o.push(this.escape(d.databaseName)+" = "+u());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&u===null)o.push(this.escape(d.databaseName)+" = NULL");else{this.connection.driver.options.type==="mssql"&&(u=this.connection.driver.parametrizeValue(d,u));const h=this.createParameter(u);let p=null;if((se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")&&this.connection.driver.spatialTypes.indexOf(d.type)!==-1){const y=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";d.srid!=null?p=`${y}(${h}, ${d.srid})`:p=`${y}(${h})`}else se.isPostgresFamily(this.connection.driver)&&this.connection.driver.spatialTypes.indexOf(d.type)!==-1?d.srid!=null?p=`ST_SetSRID(ST_GeomFromGeoJSON(${h}), ${d.srid})::${d.type}`:p=`ST_GeomFromGeoJSON(${h})::${d.type}`:this.connection.driver.options.type==="mssql"&&this.connection.driver.spatialTypes.indexOf(d.type)!==-1?p=d.type+"::STGeomFromText("+h+", "+(d.srid||"0")+")":p=h;o.push(this.escape(d.databaseName)+" = "+p)}})}),(o.length>0||Object.keys(r).length===0)&&(n.versionColumn&&a.indexOf(n.versionColumn)===-1&&o.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&a.indexOf(n.updateDateColumn)===-1&&o.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(r).map(l=>{let c=r[l];if(typeof c=="function")o.push(this.escape(l)+" = "+c());else if((this.connection.driver.options.type==="sap"||this.connection.driver.options.type==="spanner")&&c===null)o.push(this.escape(l)+" = NULL");else{const d=this.createParameter(c);o.push(this.escape(l)+" = "+d)}}),o.length<=0)throw new Tp;const i=this.createWhereExpression(),s=this.createReturningExpression("update");return s===""?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${o.join(", ")}${i}`:this.connection.driver.options.type==="mssql"?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${o.join(", ")} OUTPUT ${s}${i}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${o.join(", ")}${i} RETURNING ${s}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map(n=>typeof e[n]=="string"?this.replacePropertyNames(n)+" "+e[n]:this.replacePropertyNames(n)+" "+e[n].order+" "+e[n].nulls).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(se.isMySQLFamily(this.connection.driver)||this.connection.driver.options.type==="aurora-mysql")return" LIMIT "+e;throw new J_}return""}getValueSet(){if(typeof this.expressionMap.valuesSet=="object")return this.expressionMap.valuesSet;throw new Tp}}function d6(){Je.registerQueryBuilderClass("DeleteQueryBuilder",t=>new KD(t)),Je.registerQueryBuilderClass("InsertQueryBuilder",t=>new e6(t)),Je.registerQueryBuilderClass("RelationQueryBuilder",t=>new n6(t)),Je.registerQueryBuilderClass("SelectQueryBuilder",t=>new Zp(t)),Je.registerQueryBuilderClass("SoftDeleteQueryBuilder",t=>new c6(t)),Je.registerQueryBuilderClass("UpdateQueryBuilder",t=>new u6(t))}var wM;(function(t){t.VIEW="VIEW",t.MATERIALIZED_VIEW="MATERIALIZED_VIEW",t.GENERATED_COLUMN="GENERATED_COLUMN"})(wM||(wM={}));var Gp={exports:{}},Jp,EM;function h6(){if(EM)return Jp;EM=1;var t=1e3,e=t*60,n=e*60,r=n*24,o=r*7,a=r*365.25;Jp=function(d,u){u=u||{};var h=typeof d;if(h==="string"&&d.length>0)return i(d);if(h==="number"&&isFinite(d))return u.long?l(d):s(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function i(d){if(d=String(d),!(d.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(u){var h=parseFloat(u[1]),p=(u[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return h*a;case"weeks":case"week":case"w":return h*o;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function s(d){var u=Math.abs(d);return u>=r?Math.round(d/r)+"d":u>=n?Math.round(d/n)+"h":u>=e?Math.round(d/e)+"m":u>=t?Math.round(d/t)+"s":d+"ms"}function l(d){var u=Math.abs(d);return u>=r?c(d,u,r,"day"):u>=n?c(d,u,n,"hour"):u>=e?c(d,u,e,"minute"):u>=t?c(d,u,t,"second"):d+" ms"}function c(d,u,h,p){var y=u>=h*1.5;return Math.round(d/h)+" "+p+(y?"s":"")}return Jp}var ef,_M;function p6(){if(_M)return ef;_M=1;function t(e){r.debug=r,r.default=r,r.coerce=c,r.disable=i,r.enable=a,r.enabled=s,r.humanize=h6(),r.destroy=d,Object.keys(e).forEach(u=>{r[u]=e[u]}),r.names=[],r.skips=[],r.formatters={};function n(u){let h=0;for(let p=0;p<u.length;p++)h=(h<<5)-h+u.charCodeAt(p),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=n;function r(u){let h,p=null,y,f;function v(...g){if(!v.enabled)return;const b=v,w=Number(new Date),E=w-(h||w);b.diff=E,b.prev=h,b.curr=w,h=w,g[0]=r.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let M=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(S,N)=>{if(S==="%%")return"%";M++;const _=r.formatters[N];if(typeof _=="function"){const O=g[M];S=_.call(b,O),g.splice(M,1),M--}return S}),r.formatArgs.call(b,g),(b.log||r.log).apply(b,g)}return v.namespace=u,v.useColors=r.useColors(),v.color=r.selectColor(u),v.extend=o,v.destroy=r.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(y!==r.namespaces&&(y=r.namespaces,f=r.enabled(u)),f),set:g=>{p=g}}),typeof r.init=="function"&&r.init(v),v}function o(u,h){const p=r(this.namespace+(typeof h>"u"?":":h)+u);return p.log=this.log,p}function a(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let h;const p=(typeof u=="string"?u:"").split(/[\s,]+/),y=p.length;for(h=0;h<y;h++)p[h]&&(u=p[h].replace(/\*/g,".*?"),u[0]==="-"?r.skips.push(new RegExp("^"+u.slice(1)+"$")):r.names.push(new RegExp("^"+u+"$")))}function i(){const u=[...r.names.map(l),...r.skips.map(l).map(h=>"-"+h)].join(",");return r.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let h,p;for(h=0,p=r.skips.length;h<p;h++)if(r.skips[h].test(u))return!1;for(h=0,p=r.names.length;h<p;h++)if(r.names[h].test(u))return!0;return!1}function l(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return ef=t,ef}var MM;function f6(){return MM||(MM=1,function(t,e){var n={};e.formatArgs=o,e.save=a,e.load=i,e.useColors=r,e.storage=s(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function o(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let u=0,h=0;c[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(u++,p==="%c"&&(h=u))}),c.splice(h,0,d)}e.log=console.debug||console.log||(()=>{});function a(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function i(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof lC<"u"&&"env"in lC&&(c=n.DEBUG),c}function s(){try{return localStorage}catch{}}t.exports=p6()(e);const{formatters:l}=t.exports;l.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}(Gp,Gp.exports)),Gp.exports}f6(),d6();let tf,CM,nf,Ts,Is,Ds,Na,NM,SM,OM,AM,kM,Ls,jM;tf=(t,e)=>({id:t.id,type:t.node_type,position:{x:t.x||0,y:t.y||0},width:t.width||void 0,height:t.height||void 0,data:{loading:!1,flowNode:t,...e}}),CM=t=>({id:t.id,target:t.target,source:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),nf=t=>({id:t.id,source:t.source,target:t.target,targetHandle:t.targetHandle,sourceHandle:t.sourceHandle}),yC=t=>t.filter(e=>"edgeId"in e?`${e.edgeId}`.startsWith("xy-edge__"):!1),Ts=(t,e,n)=>{const r=[];return{changes:t.map(o=>{var l;const a=e.find(c=>o.id===c.id);a||r.push(o.id);const i=(l=n==null?void 0:n[o.source_type])==null?void 0:l.find(c=>(c==null?void 0:c.id)===o.source_id),s=tf(o,{...a==null?void 0:a.data,entity:i});return{type:a?"replace":"add",id:o.id,item:a?qa({...a||{},data:void 0},Wa(s,Ua)):s}}),newIds:[]}},Is=(t,e)=>{const n=[],r=[],o=t.map(a=>{const i=e.find(s=>a.source===s.source&&a.target===s.target);return!i||i.id!==a.id?(i&&r.push(i.id),{type:"add",item:nf(a)}):(n.push(a.id),{type:"replace",item:nf(a)})});return e.forEach(a=>{n.includes(a.id)||r.push(a.id)}),{changes:o,updatedIds:n,deletedIds:r}},Ds={width:440,height:360},Na={width:380,height:650},yo={[lt.Toolbox]:"toolbox",[lt.SessionInfo]:"session-info",[lt.DefaultEmbeddingModel]:"default-embedding-model",[lt.ApplicationBar]:"application-bar"},NM={id:yo[lt.Toolbox],type:lt.Toolbox,position:{x:10+Na.width+20,y:10},measured:Ds,data:{}},SM={id:yo[lt.SessionInfo],type:lt.SessionInfo,position:{x:10,y:10},measured:Na,data:{}},OM={id:yo[lt.DefaultEmbeddingModel],type:lt.DefaultEmbeddingModel,position:{x:10+Na.width+Ds.width+40,y:10},data:{model:Q6}},AM={id:yo[lt.ApplicationBar],type:lt.ApplicationBar,position:{x:10+Na.width+Ds.width+40,y:80},data:{}},kM=[NM,SM,OM,AM],xC=[lt.Toolbox,lt.SessionInfo,lt.ApplicationBar,lt.EditorApp,lt.CodeContainerApp],Rm={flowNodes:[],flowEdges:[],ready:!0,flowEdgeLoading:!1,flowNodeLoading:!1,syncedNodes:[],syncedEdges:[],syncNodeQueue:[],syncEdgeQueue:[],edges:[],nodes:kM},Ls=async t=>{const e=await je("FlowNode").find(t),n=e.reduce((o,a)=>{var i;return o[a.source_type]||(o[a.source_type]=[]),(i=o[a.source_type])==null||i.push(a),o},{}),r={};return await Promise.all(Object.entries(n).map(async([o,a])=>{const i=o;r[i]=await je(i).find({where:{id:mo(a.map(s=>s.source_id))}})})),{flowNodes:e,entityGroups:n,flowNodeDatas:r}},AC=(t,e)=>({reset:()=>{t(Rm)},setNodes:n=>{if(typeof n=="function"){t({nodes:n(e().nodes)});return}t({nodes:n})},setEdges:n=>{if(typeof n=="function"){t({edges:n(e().edges)});return}t({edges:n})},updateNodes:n=>{const r=e().nodes;t({nodes:Yn(n,r)})},updateEdges:n=>{const r=e().edges;t({edges:_a(n,r)})},addConnectionToEdges:n=>{const r=e().edges;t({edges:bE(n,r)})},flowNodesToNodes:(n,r={})=>{const o=e().nodes,{changes:a}=Ts(n,o,r);t({nodes:Yn(a,o)})},flowEdgesToEdges:n=>{const r=e().edges,{changes:o,updatedIds:a,deletedIds:i}=Is(n,r);r.forEach(s=>{a.includes(s.id)||i.push(s.id)}),i.forEach(s=>{o.push({type:"remove",id:s})}),t({edges:_a(o,r)})},getNodes:n=>e().nodes.filter(r=>n.includes(r.id)),removeSyncNodeQueue:n=>{const{syncNodeQueue:r}=e();for(const o of n){const a=r.findIndex(i=>i.timestamp===o);a>-1&&r.splice(a,1)}t({syncNodeQueue:r})},removeSyncEdgeQueue:n=>{const{syncEdgeQueue:r}=e();for(const o of n){const a=r.findIndex(i=>i.timestamp===o);a>-1&&r.splice(a,1)}t({syncEdgeQueue:r})},pushSyncNodeQueue:(n,r)=>{const{syncNodeQueue:o}=e();t({syncNodeQueue:[...o,{query:r,timestamp:Date.now(),syncType:n}]})},pushSyncEdgeQueue:()=>{const{syncEdgeQueue:n}=e();t({syncEdgeQueue:[...n,{timestamp:Date.now()}]})},findFlowNodesWithSource:async(n,r)=>{try{t({flowNodeLoading:!0});const{flowNodes:o,flowNodeDatas:a}=await Ls(n);if(r!=null&&r.clean)t({flowNodes:o,nodes:o.map(i=>{var l;const s=(l=a==null?void 0:a[i.source_type])==null?void 0:l.find(c=>c.id===i.source_id);return tf(i,{data:s})})});else{const i=e().flowNodes,s=o.map(d=>d.id),l=e().nodes,{changes:c}=Ts(o,l,a);t({flowNodes:[...i.filter(d=>!s.includes(d.id)),...o],nodes:Yn(c,l)})}return o}finally{t({flowNodeLoading:!1})}},findFlowEdges:async(n,r)=>{try{t({flowEdgeLoading:!0});const o=await je("FlowEdge").find(n),a=e().flowEdges,i=o.map(s=>s.id);if(r!=null&&r.clean)t({flowEdges:o,edges:o.map(s=>CM(s))});else{const s=e().edges,{changes:l}=Is(o,s);t({flowEdges:[...a.filter(c=>!i.includes(c.id)),...o],edges:_a(l,s)})}return o}finally{t({flowEdgeLoading:!1})}},deleteFlowNode:async n=>{try{if(!n.id&&!n.source_type&&!n.source_id)throw new Error("Missing flow node indentify");const r=await je("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}});if(r){await je("FlowNode").delete(r.id);const o=e().flowNodes;r.source_type&&r.source_id&&await je(r.source_type).delete(r.source_id).catch(i=>{pr("Failed to delete source entity",r.source_type,r.source_id,i)});const a=e().nodes;t({flowNodes:o.filter(i=>i.id!==r.id),nodes:Yn([{type:"remove",id:r.id}],a)})}}catch(r){pr("Failed to delete flow node",r)}},deleteFlowEdge:async n=>{try{if(!n.id&&!n.source&&!n.target)throw new Error("Missing flow edge indentify");const r=await je("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}});if(r){await je("FlowEdge").delete(r.id);const o=e().flowEdges;t({flowEdges:o.filter(a=>a.id!==r.id)})}}catch(r){pr("Failed to delete flow edge",r)}},updateFlowNode:async(n,r)=>{var o;try{if(!((o=kt.getState().currentSession)!=null&&o.id))throw new Error("Session not found");if(!n.id)throw new Error("Missing flow node indentify");await je("FlowNode").update(n.id,n);const a=e().flowNodes.map(i=>i.id===n.id?{...i,...n}:i);t({flowNodes:r!=null&&r.silent?a:[...a]})}catch(a){pr("Failed to create or update flow node",a,n)}},createOrUpdateFlowNode:async(n,r)=>{var o;try{const a=kt.getState().currentSession;if(!(a!=null&&a.id))throw new Error("Session not found");if(!n.id&&(!n.source_type||!n.source_id))throw new Error("Missing flow node indentify");let i,s=n!=null&&n.id?e().flowNodes.find(p=>p.id===n.id):void 0;if(!s&&(n.id||n.source_type&&n.source_id)&&(s=await je("FlowNode").findOne({where:n.id?{id:n.id}:{source_type:n.source_type,source_id:n.source_id}})),s)i=qa(s,Wa(n,Ua)),r!=null&&r.lazy?je("FlowNode").update(s.id,i):await je("FlowNode").update(s.id,i);else if(n.source_id&&n.source_type)i={...n,source_id:`${n.source_id}`,source_type:`${n.source_type}`,node_type:n.node_type||"NEW_MESSAGE",session_id:n.session_id||(a==null?void 0:a.id)},r!=null&&r.lazy?(i.id=Vs(),je("FlowNode").save(i)):i=await je("FlowNode").save(i);else throw new Error("Missing source id and type");let l;const c=e().nodes.find(p=>p.id===i.id);i.source_type&&!c?l=await je(i.source_type).findOne({where:{id:n.source_id}}):i.source_type&&c&&(l=(o=c==null?void 0:c.data)==null?void 0:o.entity);const d=e().flowNodes,u=e().nodes,{changes:h}=Ts([i],u,{[i.source_type]:[l]});return t({flowNodes:[...d.filter(p=>p.id!==i.id),i],nodes:Yn(h,u)}),i}catch(a){pr("Failed to create or update flow node",a,n)}},createOrUpdateFlowEdge:async(n,r)=>{try{const o=kt.getState().currentSession;if(!(o!=null&&o.id))throw new Error("Session not found");if(!n.id&&(!n.source||!n.target))throw new Error("Missing flow node indentify");let a,i=n!=null&&n.id?e().flowEdges.find(c=>c.id===n.id):void 0;if(i&&(n.id||n.source&&n.target)&&(i=await je("FlowEdge").findOne({where:n.id?{id:n.id}:{source:n.source,target:n.target}})),i)a=qa(i,Wa(n,Ua)),r!=null&&r.lazy?je("FlowEdge").update(i.id,a):await je("FlowEdge").update(i.id,a);else if(n.source&&n.target)a={...n,source:`${n.source}`,target:`${n.target}`,session_id:n.session_id||(o==null?void 0:o.id)},r!=null&&r.lazy?(a.id=Vs(),je("FlowEdge").save(a)):a=await je("FlowEdge").save(a);else throw new Error("Missing source and target");const s=e().flowEdges,l=e().edges;return t({flowEdges:[...s.filter(c=>c.id!==a.id),a],edges:_a(Is([a],l).changes,l)}),a}catch(o){pr("Failed to create or update flow node",o)}}}),jM=()=>{var v;const[t,e]=m.useState(),[n,r]=m.useState(),[o,a]=m.useState(),[i,s]=m.useState(),l=m.useRef(),c=m.useRef({}),d=kt(g=>g.currentSession),u=Ws(g=>g.loadModel),h=m.useCallback(async()=>{var g,b;try{if(c.current.handling=d==null?void 0:d.id,!(d!=null&&d.id)||!(d!=null&&d.main_source_id)||(d==null?void 0:d.main_source_type)!=="Thread")return;const[w,E]=await Promise.all([je("Thread").findOne({where:{id:d.main_source_id,session_id:d.id}}),je("FlowNode").findOne({where:{source_id:d.main_source_id,source_type:"Thread",session_id:d.id}})]);if(!w||!E)return;const M=await je("FlowEdge").find({where:{session_id:d.id,target:E.id}}),{flowNodes:S,flowNodeDatas:N}=await Ls({where:{session_id:d.id,id:mo(M.map(L=>L.source))}}),_=(await je("FlowEdge").find({where:{session_id:d.id}})).filter(L=>L.target===E.id).map(L=>{var P;const C=S.find(j=>j.id===L.source);return{connection:L,source:C,entity:(P=N==null?void 0:N[C.source_type])==null?void 0:P.find(j=>j.id===C.source_id)}}),O=_.find(L=>L.source.source_type==="LLM"),k=_.filter(L=>L.source.source_type==="Prompt"),I=_.find(L=>L.source.source_type==="Schema");if(!(O!=null&&O.entity))return;const B=await je("FlowEdge").findOne({where:{session_id:d.id,source:E.id},order:{id:"DESC"}});if(B){const L=await je("FlowNode").findOne({where:{id:B.target,session_id:d.id}});if(!L)return;const C=await je("JSONData").findOne({where:{id:L.source_id,session_id:d.id}});if(!C)return;(g=l.current)==null||g.call(l,C.data),s({node:L,enity:C})}else{const L=await je("JSONData").save({headers:"item",session_id:d.id,json:"",data:[]});if(!L)return;const C=await je("FlowNode").save({session_id:d.id,source_id:L.id,source_type:"JSONData",node_type:"JSON_DATA",x:0,y:0});if(!C)return;await je("FlowEdge").save({session_id:d.id,source:E.id,target:C.id}),(b=l.current)==null||b.call(l,[]),s({node:C,enity:L})}a({llm:O.entity,status:Dt.Started,progress:""}),r({thread:w,threadNode:E}),e({prompts:(k==null?void 0:k.map(L=>L.entity))||[],schema:I==null?void 0:I.entity}),c.current.handled=d.id}finally{c.current.handling=void 0}},[d==null?void 0:d.id,d==null?void 0:d.main_source_id,d==null?void 0:d.main_source_type]),p=m.useCallback(async()=>{if(o!=null&&o.llm.name)try{a(g=>g&&{...g,status:Dt.Loading}),await u(o==null?void 0:o.llm.name,g=>{a(b=>b&&{...b,progress:g.text})}),a(g=>g&&{...g,status:Dt.Loaded,progress:""})}catch{a(g=>g&&{...g,status:Dt.Started,progress:""})}},[(v=o==null?void 0:o.llm)==null?void 0:v.name,u]),y=m.useCallback(g=>(l.current=g,()=>{l.current=void 0}),[]),f=m.useCallback(async g=>{!(i!=null&&i.node)||!(i!=null&&i.enity)||await je("JSONData").save({...i.enity,data:g})},[i==null?void 0:i.enity,i==null?void 0:i.node]);return m.useEffect(()=>{c.current.handling||(c==null?void 0:c.current.handled)===(d==null?void 0:d.id)||h()},[d==null?void 0:d.id,h]),{...t,loadLLM:p,threadInfo:n,mainLLMInfo:o,currentDataNode:i,updateMessagesData:f,onThreadMessagesLoaded:y}};var m6=Object.prototype.toString,to=Array.isArray||function(t){return m6.call(t)==="[object Array]"};function rf(t){return typeof t=="function"}function y6(t){return to(t)?"array":typeof t}function of(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function RM(t,e){return t!=null&&typeof t=="object"&&e in t}function g6(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var v6=RegExp.prototype.test;function x6(t,e){return v6.call(t,e)}var b6=/\S/;function w6(t){return!x6(b6,t)}var E6={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function _6(t){return String(t).replace(/[&<>"'`=\/]/g,function(e){return E6[e]})}var M6=/\s*/,C6=/\s+/,PM=/\s*=/,N6=/\s*\}/,S6=/#|\^|\/|>|\{|&|=|!/;function O6(t,e){if(!t)return[];var n=!1,r=[],o=[],a=[],i=!1,s=!1,l="",c=0;function d(){if(i&&!s)for(;a.length;)delete o[a.pop()];else a=[];i=!1,s=!1}var u,h,p;function y(_){if(typeof _=="string"&&(_=_.split(C6,2)),!to(_)||_.length!==2)throw new Error("Invalid tags: "+_);u=new RegExp(of(_[0])+"\\s*"),h=new RegExp("\\s*"+of(_[1])),p=new RegExp("\\s*"+of("}"+_[1]))}y(e||jt.tags);for(var f=new Sa(t),v,g,b,w,E,M;!f.eos();){if(v=f.pos,b=f.scanUntil(u),b)for(var S=0,N=b.length;S<N;++S)w=b.charAt(S),w6(w)?(a.push(o.length),l+=w):(s=!0,n=!0,l+=" "),o.push(["text",w,v,v+1]),v+=1,w===`
`&&(d(),l="",c=0,n=!1);if(!f.scan(u))break;if(i=!0,g=f.scan(S6)||"name",f.scan(M6),g==="="?(b=f.scanUntil(PM),f.scan(PM),f.scanUntil(h)):g==="{"?(b=f.scanUntil(p),f.scan(N6),f.scanUntil(h),g="&"):b=f.scanUntil(h),!f.scan(h))throw new Error("Unclosed tag at "+f.pos);if(g==">"?E=[g,b,v,f.pos,l,c,n]:E=[g,b,v,f.pos],c++,o.push(E),g==="#"||g==="^")r.push(E);else if(g==="/"){if(M=r.pop(),!M)throw new Error('Unopened section "'+b+'" at '+v);if(M[1]!==b)throw new Error('Unclosed section "'+M[1]+'" at '+v)}else g==="name"||g==="{"||g==="&"?s=!0:g==="="&&y(b)}if(d(),M=r.pop(),M)throw new Error('Unclosed section "'+M[1]+'" at '+f.pos);return k6(A6(o))}function A6(t){for(var e=[],n,r,o=0,a=t.length;o<a;++o)n=t[o],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(e.push(n),r=n));return e}function k6(t){for(var e=[],n=e,r=[],o,a,i=0,s=t.length;i<s;++i)switch(o=t[i],o[0]){case"#":case"^":n.push(o),r.push(o),n=o[4]=[];break;case"/":a=r.pop(),a[5]=o[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(o)}return e}function Sa(t){this.string=t,this.tail=t,this.pos=0}Sa.prototype.eos=function(){return this.tail===""},Sa.prototype.scan=function(t){var e=this.tail.match(t);if(!e||e.index!==0)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},Sa.prototype.scanUntil=function(t){var e=this.tail.search(t),n;switch(e){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,e),this.tail=this.tail.substring(e)}return this.pos+=n.length,n};function no(t,e){this.view=t,this.cache={".":this.view},this.parent=e}no.prototype.push=function(t){return new no(t,this)},no.prototype.lookup=function(t){var e=this.cache,n;if(e.hasOwnProperty(t))n=e[t];else{for(var r=this,o,a,i,s=!1;r;){if(t.indexOf(".")>0)for(o=r.view,a=t.split("."),i=0;o!=null&&i<a.length;)i===a.length-1&&(s=RM(o,a[i])||g6(o,a[i])),o=o[a[i++]];else o=r.view[t],s=RM(r.view,t);if(s){n=o;break}r=r.parent}e[t]=n}return rf(n)&&(n=n.call(this.view)),n};function bt(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}bt.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},bt.prototype.parse=function(t,e){var n=this.templateCache,r=t+":"+(e||jt.tags).join(":"),o=typeof n<"u",a=o?n.get(r):void 0;return a==null&&(a=O6(t,e),o&&n.set(r,a)),a},bt.prototype.render=function(t,e,n,r){var o=this.getConfigTags(r),a=this.parse(t,o),i=e instanceof no?e:new no(e,void 0);return this.renderTokens(a,i,n,t,r)},bt.prototype.renderTokens=function(t,e,n,r,o){for(var a="",i,s,l,c=0,d=t.length;c<d;++c)l=void 0,i=t[c],s=i[0],s==="#"?l=this.renderSection(i,e,n,r,o):s==="^"?l=this.renderInverted(i,e,n,r,o):s===">"?l=this.renderPartial(i,e,n,o):s==="&"?l=this.unescapedValue(i,e):s==="name"?l=this.escapedValue(i,e,o):s==="text"&&(l=this.rawValue(i)),l!==void 0&&(a+=l);return a},bt.prototype.renderSection=function(t,e,n,r,o){var a=this,i="",s=e.lookup(t[1]);function l(u){return a.render(u,e,n,o)}if(s){if(to(s))for(var c=0,d=s.length;c<d;++c)i+=this.renderTokens(t[4],e.push(s[c]),n,r,o);else if(typeof s=="object"||typeof s=="string"||typeof s=="number")i+=this.renderTokens(t[4],e.push(s),n,r,o);else if(rf(s)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");s=s.call(e.view,r.slice(t[3],t[5]),l),s!=null&&(i+=s)}else i+=this.renderTokens(t[4],e,n,r,o);return i}},bt.prototype.renderInverted=function(t,e,n,r,o){var a=e.lookup(t[1]);if(!a||to(a)&&a.length===0)return this.renderTokens(t[4],e,n,r,o)},bt.prototype.indentPartial=function(t,e,n){for(var r=e.replace(/[^ \t]/g,""),o=t.split(`
`),a=0;a<o.length;a++)o[a].length&&(a>0||!n)&&(o[a]=r+o[a]);return o.join(`
`)},bt.prototype.renderPartial=function(t,e,n,r){if(n){var o=this.getConfigTags(r),a=rf(n)?n(t[1]):n[t[1]];if(a!=null){var i=t[6],s=t[5],l=t[4],c=a;s==0&&l&&(c=this.indentPartial(a,l,i));var d=this.parse(c,o);return this.renderTokens(d,e,n,c,r)}}},bt.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(n!=null)return n},bt.prototype.escapedValue=function(t,e,n){var r=this.getConfigEscape(n)||jt.escape,o=e.lookup(t[1]);if(o!=null)return typeof o=="number"&&r===jt.escape?String(o):r(o)},bt.prototype.rawValue=function(t){return t[1]},bt.prototype.getConfigTags=function(t){return to(t)?t:t&&typeof t=="object"?t.tags:void 0},bt.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!to(t))return t.escape};let ro;jt={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){ro.templateCache=t},get templateCache(){return ro.templateCache}},ro=new bt,jt.clearCache=function(){return ro.clearCache()},jt.parse=function(t,e){return ro.parse(t,e)},jt.render=function(t,e,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+y6(t)+'" was given as the first argument for mustache#render(template, view, partials)');return ro.render(t,e,n,r)},jt.escape=_6,jt.Scanner=Sa,jt.Context=no,jt.Writer=bt;let TM,IM,DM;TM=async(t,e)=>{let n="",r="",o;const a=[];await t;for await(const i of t)i&&(Array.isArray(i)?(a.push(...i.map(s=>s.content)),a!=null&&a.length&&(r=a.join(""),e==null||e({chunk:i,content:r}))):(n=typeof i=="object"&&"content"in i?`${i.content}`:`${i}`,e==null||e({chunk:i,content:n})),o=i);return{lastChunk:o,content:n}},zf=()=>{const t=Ws(r=>r.toolsCallingStream),e=Ws(r=>r.structuredStream),n=Ws(r=>r.stream);return{stream:m.useCallback(async(r,{tools:o,schemas:a,onMessageUpdate:i,onMessageFinish:s})=>{var u,h,p,y;a&&(a==null?void 0:a.length)>1&&pr("Multiple schemas are not supported");let l;if(a!=null&&a.length){const f=(p=(h=(u=a==null?void 0:a[0])==null?void 0:u.node)==null?void 0:h.data)==null?void 0:p.entity;if(!((y=f==null?void 0:f.schema_items)!=null&&y.length))throw new Error("Schema is not found");l=e(f.schema_items,r)}else o!=null&&o.length?l=t(o.reduce((f,v)=>{var w,E,M,S,N;const g=(w=v.node.data)==null?void 0:w.entity,b=(S=(M=(E=v==null?void 0:v.connectedNodes)==null?void 0:E.find(_=>_.type===lt.Schema))==null?void 0:M.data)==null?void 0:S.entity;return g&&((N=b==null?void 0:b.schema_items)!=null&&N.length)&&f.push({name:g.name,description:g.description,schemaItems:b.schema_items}),f},[]),r):l=n(r);if(!l)throw new Error("Stream is not supported");const{lastChunk:c,content:d}=await TM(l,i);return s==null||s({content:d,lastChunk:c}),{lastChunk:c,content:d}},[n,e,t])}},IM=()=>{const[t]=m.useState(!1),e=K6(a=>a.similaritySearchWithScore),{stream:n}=zf(),r=m.useCallback(async(a,i)=>{const{placeholders:s}=i||{};if(!(s!=null&&s.length))return[];const l=[];return await Promise.all(s.map(async c=>{var u,h,p,y,f,v;const d=(u=c.node.data)==null?void 0:u.entity;if(d)switch(d.placeholder_type){case hl.VECTOR_DATABASE_RETREIVER:{const g=(h=c.connectedNodes)==null?void 0:h.find(w=>w.type===lt.VectorDatabase),b=(p=g==null?void 0:g.data)==null?void 0:p.entity;return(v=(f=(y=c.connectedNodes)==null?void 0:y.find(w=>w.type===lt.Prompt))==null?void 0:f.data)!=null&&v.entity,void 0}}})),l},[e]),o=m.useCallback(async(a,i,s,l,{onMessageUpdate:c})=>{const{tools:d,schemas:u,placeholders:h}=s||{},p=[];h!=null&&h.length&&p.push(...await r(a,s));const y=i.map(v=>v.role==="system"?new Y6(v.content):v.role==="user"?new X6(v.content):new Z6(v.content)),{content:f}=await n(y,{tools:d,schemas:u,onMessageUpdate:({content:v})=>{c==null||c({nodeData:{loading:!0,content:v}})}});return c==null||c({nodeData:{content:f}}),f},[r,n]);return{loading:t,sendMessage:o}},DM=Un("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ul=m.forwardRef(({className:t,variant:e,...n},r)=>x.jsx("div",{ref:r,role:"alert",className:ne(DM({variant:e}),t),...n})),ul.displayName="Alert",dl=m.forwardRef(({className:t,...e},n)=>x.jsx("h5",{ref:n,className:ne("mb-1 font-medium leading-none tracking-tight",t),...e})),dl.displayName="AlertTitle",Bf=m.forwardRef(({className:t,...e},n)=>x.jsx("div",{ref:n,className:ne("text-sm [&_p]:leading-relaxed",t),...e})),Bf.displayName="AlertDescription";let LM,$M,BM,FM,zM,VM,WM,UM,HM,qM,QM,KM;LM=t=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"none",height:192,viewBox:"0 0 150 150",width:192,...t},m.createElement("clipPath",{id:"a"},m.createElement("path",{d:"m0 0h150v150h-150z"})),m.createElement("g",{clipPath:"url(#a)"},m.createElement("path",{d:"m150 0h-150v150h150z",fill:"#29b5e8"}),m.createElement("path",{clipRule:"evenodd",d:"m130.375 67.2532-14.096 8.1221 14.096 8.0536c.843.4872 1.581 1.1357 2.174 1.9084.592.7727 1.026 1.6545 1.278 2.5951.251.9406.315 1.9215.188 2.8867-.128.9652-.444 1.8959-.931 2.7388-.488.843-1.136 1.5817-1.909 2.174s-1.654 1.0267-2.595 1.2782-1.921.3154-2.887.1878c-.965-.1275-1.896-.444-2.739-.9312l-25.2559-14.5496c-1.1575-.6696-2.1128-1.6394-2.765-2.8068-.6523-1.1674-.9773-2.4893-.9408-3.826.0198-.5792.1089-1.1538.2653-1.7117.517-1.8711 1.7458-3.4654 3.4234-4.4419l25.256-14.4983c.847-.4892 1.782-.8067 2.751-.9343.97-.1275 1.955-.0627 2.899.1909.945.2536 1.83.6909 2.605 1.287.775.596 1.425 1.3391 1.913 2.1866.49.8402.808 1.7693.935 2.7334.128.964.063 1.9439-.191 2.8826-.254.9388-.692 1.8177-1.288 2.5859-.597.7681-1.34 1.4101-2.186 1.8887zm-13.343 39.3698-25.2478-14.5243c-1.1296-.6483-2.4091-.9896-3.7115-.9902s-2.5823.3397-3.7124.987c-1.1301.6472-2.0712 1.579-2.7297 2.7026-.6585 1.1237-1.0115 2.4001-1.0239 3.7024v29.0135c.0654 1.928.8772 3.755 2.264 5.095 1.3869 1.341 3.2403 2.09 5.1691 2.09 1.9289 0 3.7823-.749 5.1691-2.09 1.3868-1.34 2.1986-3.167 2.264-5.095v-16.261l14.1301 8.122c.843.488 1.774.805 2.739.933.966.128 1.947.064 2.888-.187s1.823-.685 2.596-1.277c.774-.592 1.423-1.331 1.91-2.174.488-.843.805-1.773.933-2.739.128-.965.065-1.946-.186-2.887s-.685-1.824-1.277-2.597-1.331-1.422-2.174-1.91zm-29.0992-28.3806-10.527 10.3986c-.3601.3349-.8269.5319-1.318.5563h-3.0897c-.49-.0294-.9551-.2257-1.318-.5563l-10.4671-10.4329c-.3274-.3573-.521-.817-.5478-1.3009v-3.081c.0283-.4861.2215-.9481.5478-1.3095l10.4671-10.4329c.3637-.3281.829-.5214 1.318-.5477h3.0897c.4899.0228.9562.2166 1.318.5477l10.4928 10.4329c.3237.3623.514.8243.5392 1.3095v3.081c-.0237.483-.2143.9428-.5392 1.3009zm-8.3874-2.8928c-.0404-.499-.2485-.9696-.5905-1.3352l-3.0383-3.004c-.3641-.3275-.8291-.5207-1.318-.5478h-.1113c-.4867.0255-.9495.2191-1.3094.5478l-3.0383 3.004c-.3262.3676-.5165.8358-.5392 1.3266v.1113c.0215.4834.2124.9439.5392 1.3009l3.0554 2.9955c.3607.3274.823.5208 1.3094.5477h.1113c.4889-.027.9539-.2203 1.318-.5477l3.0383-3.0212c.3282-.3576.5244-.8166.5563-1.3009zm-47.4914-31.2217 25.2563 14.4811c1.1308.648 2.4115.989 3.7149.9889 1.3033 0 2.584-.3409 3.7148-.989 1.1309-.648 2.0725-1.5806 2.7314-2.7051.659-1.1245 1.0123-2.4018 1.0249-3.7051v-28.9879c-.0654-1.9277-.8772-3.7546-2.264-5.0952s-3.2402-2.0899-5.1691-2.0899c-1.9288 0-3.7822.7493-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v16.2613l-14.1473-8.1307c-.8429-.4877-1.7737-.8047-2.7392-.9328-.9654-.1281-1.9466-.0647-2.8876.1864s-1.8232.6852-2.5965 1.2773c-.7732.5921-1.4222 1.3307-1.91 2.1736-.4878.843-.8048 1.7738-.9329 2.7392-.128.9655-.0647 1.9467.1864 2.8876.2512.941.6852 1.8233 1.2773 2.5965.5921.7733 1.3307 1.4223 2.1737 1.9101zm55.4252 15.4739c1.4914.118 2.9836-.2193 4.2793-.9671l25.2475-14.5496c.843-.4877 1.582-1.1368 2.174-1.91s1.026-1.6555 1.277-2.5965.315-1.9222.187-2.8876c-.128-.9655-.445-1.8962-.933-2.7392-.488-.8429-1.137-1.5816-1.91-2.1737-.774-.5921-1.656-1.0261-2.597-1.2772-1.9-.5072-3.924-.2387-5.627.7464l-14.1298 8.1991v-16.2613c-.0654-1.9277-.8772-3.7546-2.264-5.0952-1.3868-1.3405-3.2402-2.0899-5.1691-2.0899-1.9288 0-3.7822.7494-5.169 2.0899-1.3869 1.3406-2.1987 3.1675-2.2641 5.0952v29.0136c-.0023 1.8784.7086 3.6876 1.9892 5.0619 1.2805 1.3743 3.0351 2.2111 4.909 2.3412zm-25.8554 31.5298c-1.4916-.1213-2.9847.2162-4.2793.9671l-25.2905 14.4893c-1.7024.985-2.9438 2.607-3.451 4.507s-.2387 3.924.7465 5.627c.9851 1.702 2.6061 2.943 4.5065 3.451 1.9004.507 3.9244.238 5.6268-.747l14.1473-8.122v16.261c.0654 1.928.8772 3.755 2.2641 5.096 1.3868 1.34 3.2402 2.09 5.169 2.09 1.9289 0 3.7823-.75 5.1691-2.09 1.3868-1.341 2.1986-3.168 2.264-5.096v-29.0645c-.0038-1.869-.7144-3.6673-1.9891-5.0341s-3.0192-2.2009-4.8834-2.3348zm-6.8468-13.5825c.4875-1.6032.414-3.3247-.2083-4.8806-.6224-1.5559-1.7564-2.8532-3.2152-3.6779l-25.2306-14.541c-1.704-.976-3.7248-1.2385-5.6216-.7303-1.8968.5083-3.5155 1.7461-4.5032 3.4433-.4889.84-.8065 1.7686-.9343 2.732-.1278.9635-.0632 1.9428.1899 2.8811.2531.9384.6897 1.8173 1.2846 2.5858.595.7686 1.3364 1.4115 2.1814 1.8917l14.096 8.1221-14.096 8.0536c-.8429.4861-1.5819 1.1334-2.1746 1.9051-.5928.7717-1.0277 1.6526-1.2801 2.5923-.2523.9398-.317 1.9201-.1905 2.8849s.4418 1.8952.9279 2.7382c.4861.8429 1.1335 1.5819 1.9051 2.1746.7717.5928 1.6526 1.0277 2.5924 1.2801.9397.2523 1.92.317 2.8848.1905s1.8952-.4418 2.7382-.9279l25.2306-14.5496c1.6248-.9071 2.8451-2.3965 3.4149-4.168z",fill:"#fff",fillRule:"evenodd"}))),$M=t=>m.createElement("svg",{className:"mr-2 w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:48,height:48,...t},m.createElement("path",{fill:"#fbc02d",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20 s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),m.createElement("path",{fill:"#e53935",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039 l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),m.createElement("path",{fill:"#4caf50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),m.createElement("path",{fill:"#1565c0",d:"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571 c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})),BM=t=>m.createElement("svg",{className:"mr-2 w-5 h-5",width:1024,height:1024,viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{d:"M44.522 44.5217H489.739V489.739H44.522V44.5217Z",fill:"#F35325"}),m.createElement("path",{d:"M534.261 44.5217H979.478V489.739H534.261V44.5217Z",fill:"#81BC06"}),m.createElement("path",{d:"M44.522 534.261H489.739V979.478H44.522V534.261Z",fill:"#05A6F0"}),m.createElement("path",{d:"M534.261 534.261H979.478V979.478H534.261V534.261Z",fill:"#FFBA08"})),FM=t=>m.createElement("svg",{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 287.56 191",...t},m.createElement("defs",null,m.createElement("style",null,".cls-1{fill:#0081fb;}.cls-2{fill:url(#linear-gradient);}.cls-3{fill:url(#linear-gradient-2);}"),m.createElement("linearGradient",{id:"linear-gradient",x1:62.34,y1:101.45,x2:260.34,y2:91.45,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},m.createElement("stop",{offset:0,stopColor:"#0064e1"}),m.createElement("stop",{offset:.4,stopColor:"#0064e1"}),m.createElement("stop",{offset:.83,stopColor:"#0073ee"}),m.createElement("stop",{offset:1,stopColor:"#0082fb"})),m.createElement("linearGradient",{id:"linear-gradient-2",x1:41.42,y1:53,x2:41.42,y2:126,gradientTransform:"matrix(1, 0, 0, -1, 0, 192)",gradientUnits:"userSpaceOnUse"},m.createElement("stop",{offset:0,stopColor:"#0082fb"}),m.createElement("stop",{offset:1,stopColor:"#0064e0"}))),m.createElement("title",null,"facebook-meta"),m.createElement("path",{className:"cls-1",d:"M31.06,126c0,11,2.41,19.41,5.56,24.51A19,19,0,0,0,53.19,160c8.1,0,15.51-2,29.79-21.76,11.44-15.83,24.92-38,34-52l15.36-23.6c10.67-16.39,23-34.61,37.18-47C181.07,5.6,193.54,0,206.09,0c21.07,0,41.14,12.21,56.5,35.11,16.81,25.08,25,56.67,25,89.27,0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191V160c17.63,0,22-16.2,22-34.74,0-26.42-6.16-55.74-19.73-76.69-9.63-14.86-22.11-23.94-35.84-23.94-14.85,0-26.8,11.2-40.23,31.17-7.14,10.61-14.47,23.54-22.7,38.13l-9.06,16c-18.2,32.27-22.81,39.62-31.91,51.75C84.74,183,71.12,191,53.19,191c-21.27,0-34.72-9.21-43-23.09C3.34,156.6,0,141.76,0,124.85Z"}),m.createElement("path",{className:"cls-2",d:"M24.49,37.3C38.73,15.35,59.28,0,82.85,0c13.65,0,27.22,4,41.39,15.61,15.5,12.65,32,33.48,52.63,67.81l7.39,12.32c17.84,29.72,28,45,33.93,52.22,7.64,9.26,13,12,19.94,12,17.63,0,22-16.2,22-34.74l27.4-.86c0,19.38-3.82,33.62-10.32,44.87C271,180.13,258.72,191,238.13,191c-12.8,0-24.14-2.78-36.68-14.61-9.64-9.08-20.91-25.21-29.58-39.71L146.08,93.6c-12.94-21.62-24.81-37.74-31.68-45C107,40.71,97.51,31.23,82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78Z"}),m.createElement("path",{className:"cls-3",d:"M82.35,31.23c-12.27,0-22.69,8.61-31.41,21.78C38.61,71.62,31.06,99.34,31.06,126c0,11,2.41,19.41,5.56,24.51L10.14,167.91C3.34,156.6,0,141.76,0,124.85,0,94.1,8.44,62.05,24.49,37.3,38.73,15.35,59.28,0,82.85,0Z"})),zM=t=>m.createElement("svg",{className:"mr-2 w-5 h-5",width:256,height:233,viewBox:"0 0 256 233",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{d:"M186.182 0h46.545v46.545h-46.545z"}),m.createElement("path",{fill:"#f7d046",d:"M209.455 0H256v46.545h-46.545z"}),m.createElement("path",{d:"M0 0h46.545v46.545H0zm0 46.545h46.545V93.09H0zm0 46.546h46.545v46.545H0zm0 46.545h46.545v46.545H0zm0 46.546h46.545v46.545H0z"}),m.createElement("path",{fill:"#f7d046",d:"M23.273 0h46.545v46.545H23.273z"}),m.createElement("path",{fill:"#f2a73b",d:"M209.455 46.545H256V93.09h-46.545zm-186.182 0h46.545V93.09H23.273z"}),m.createElement("path",{d:"M139.636 46.545h46.545V93.09h-46.545z"}),m.createElement("path",{fill:"#f2a73b",d:"M162.909 46.545h46.545V93.09h-46.545zm-93.091 0h46.545V93.09H69.818z"}),m.createElement("path",{fill:"#ee792f",d:"M116.364 93.091h46.545v46.545h-46.545zm46.545 0h46.545v46.545h-46.545zm-93.091 0h46.545v46.545H69.818z"}),m.createElement("path",{d:"M93.091 139.636h46.545v46.545H93.091z"}),m.createElement("path",{fill:"#eb5829",d:"M116.364 139.636h46.545v46.545h-46.545z"}),m.createElement("path",{fill:"#ee792f",d:"M209.455 93.091H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"}),m.createElement("path",{d:"M186.182 139.636h46.545v46.545h-46.545z"}),m.createElement("path",{fill:"#eb5829",d:"M209.455 139.636H256v46.545h-46.545z"}),m.createElement("path",{d:"M186.182 186.182h46.545v46.545h-46.545z"}),m.createElement("path",{fill:"#eb5829",d:"M23.273 139.636h46.545v46.545H23.273z"}),m.createElement("path",{fill:"#ea3326",d:"M209.455 186.182H256v46.545h-46.545zm-186.182 0h46.545v46.545H23.273z"})),VM="/NoLLMChat/assets/qwen-B-gSh3_v.webp",WM="/NoLLMChat/assets/smollm-CikBjd4F.png",UM="/NoLLMChat/assets/stablelm-BquePdQ7.png",HM="/NoLLMChat/assets/nomic-BjJqoFji.webp",qM="/NoLLMChat/assets/joshua-ByaReJuI.webp",Ys=m.memo(({name:t,className:e,...n})=>(t=t.toLowerCase(),t.includes("gemma")?x.jsx($M,{className:ne("w-5 h-5",e),...n}):t!=null&&t.includes("qwen")?x.jsx("img",{className:ne("w-5 h-5",e),src:VM,alt:"qwen",...n}):t!=null&&t.includes("phi")?x.jsx(BM,{className:ne("w-5 h-5",e),...n}):t!=null&&t.includes("llama")?x.jsx(FM,{className:ne("w-5 h-5",e),...n}):t!=null&&t.includes("smollm")?x.jsx("img",{className:ne("w-5 h-5",e),src:WM,alt:"smollm",...n}):t!=null&&t.includes("mistral")?x.jsx(zM,{className:ne("w-5 h-5",e),...n}):t!=null&&t.includes("snowflake")?x.jsx(LM,{className:ne("w-5 h-5 rounded-full",e),...n}):t!=null&&t.includes("stablelm")?x.jsx("img",{className:ne("w-5 h-5 rounded-full",e),src:UM,alt:"stablelm",...n}):t!=null&&t.includes("nomic")?x.jsx("img",{className:ne("w-5 h-5 rounded-full",e),src:HM,alt:"nomic",...n}):t!=null&&t.includes("Xenova")||t!=null&&t.includes("janus")?x.jsx("img",{className:ne("w-5 h-5 rounded-full",e),src:qM,alt:"Xenova",...n}):x.jsx($e,{className:ne("w-5 h-5",e),name:"brain"}))),_f=["Qwen2.5-1.5B-Instruct-q4f32_1-MLC","Qwen2.5-Coder-1.5B-Instruct-q4f16_1-MLC","stablelm-2-zephyr-1_6b-q4f16_1-MLC-1k","Phi-3.5-mini-instruct-q4f16_1-MLC-1k","Llama-3.2-3B-Instruct-q4f32_1-MLC"],Mf=m.memo(t=>{var s;const{name:e,model:n,isCached:r,isFunctionCalling:o}=t,{t:a}=an("atoms"),i=m.useCallback(l=>l===1?"llm_info.model_types.embedding":l===2?"llm_info.model_types.vlm":"llm_info.model_types.llm",[]);if(n)return x.jsxs(x.Fragment,{children:[x.jsx(sn,{className:"",children:a(i(n.model_type))}),_f.some(l=>e&&l.includes(e))?x.jsx(sn,{className:"",variant:"outline",children:a("llm_info.recommended")}):null,r?x.jsx(sn,{className:"",variant:"outline",children:a("llm_info.cached")}):null,o?x.jsx(sn,{className:"",variant:"outline",children:a("llm_info.function_calling")}):null,n!=null&&n.low_resource_required?x.jsx(sn,{className:"",variant:"outline",children:a("llm_info.low_resource_required")}):null,(s=n==null?void 0:n.overrides)!=null&&s.context_window_size?x.jsxs(sn,{className:"",variant:"outline",children:[n.overrides.context_window_size.toLocaleString("en-US")," Tokens"]}):null,n!=null&&n.vram_required_MB?x.jsxs(sn,{className:"",variant:"outline",children:["VRAM: ",n.vram_required_MB.toLocaleString("en-US")," MB"]}):null]})}),QM=m.memo(({llm:t,status:e,loadLLM:n,progress:r})=>{const{t:o}=an("flows"),[a,i]=m.useState();m.useEffect(()=>{a||!(t!=null&&t.name)||ff(()=>import("./index-BQ8Gn5fu.js").then(async c=>(await c.__tla,c)),__vite__mapDeps([0,1,2,3,4,5,6])).then(async({hasModelInCache:c,functionCallingModelIds:d,prebuiltAppConfig:u})=>{const h=await c(t==null?void 0:t.name);i({hasCache:h,isFunctionCalling:d.includes(t==null?void 0:t.name),info:u.model_list.find(p=>p.model_id===(t==null?void 0:t.name))})})},[t==null?void 0:t.name,a]);const s=m.useCallback(async()=>{await(n==null?void 0:n())},[n]),l=m.useMemo(()=>{switch(e){case Dt.Downloading:return x.jsx($e,{className:"animate-spin w-7 h-7",name:"arrow-big-down-dash"});case Dt.Loaded:return x.jsx(Ys,{name:(t==null?void 0:t.name)||"brain",className:"w-7 h-7"});default:return x.jsx(Ys,{name:(t==null?void 0:t.name)||"brain",className:"w-7 h-7"})}},[t==null?void 0:t.name,e]);return x.jsx(ul,{className:"flex justify-center !border-none !bg-inherit !p-2 max-w-full overflow-y-hidden mb-2",children:x.jsxs("div",{className:"ml-2 pt-1 max-w-full",children:[x.jsxs(dl,{className:"flex gap-2 items-center pr-6",children:[l,`${(t==null?void 0:t.name)||""}`]}),x.jsxs("div",{className:"max-w-full mt-2 flex-wrap flex gap-1",children:[x.jsx(Mf,{model:a==null?void 0:a.info,isFunctionCalling:(a==null?void 0:a.isFunctionCalling)||!1,name:t==null?void 0:t.name,isCached:(a==null?void 0:a.hasCache)||!1}),e!==Dt.Loaded?r?x.jsx("div",{className:"text-sm break-words flex-wrap",children:r}):x.jsx(Kn,{disabled:e===Dt.Loading,onClick:s,className:"mt-4 w-full",children:o(a!=null&&a.hasCache?"llm_node.load_model_button":"llm_node.download_model_button")}):void 0]})]})})}),KM=t=>{const[e,n]=m.useState([]),r=kt(a=>a.currentSession),o=m.useCallback(async()=>{if(!t||!(r!=null&&r.id))return;const a=await je("FlowEdge").find({where:{session_id:r.id,source:t.id},order:{id:"DESC"}}),{flowNodes:i,flowNodeDatas:s}=await Ls({where:{session_id:r.id,id:mo(a.map(l=>l.target)),source_type:"JSONData"},order:{updated_at:"DESC"},select:["id","source_id","source_type","updated_at"]});n(i.reduce((l,c)=>{var u;const d=(u=s[c.source_type])==null?void 0:u.find(h=>h.id===c.source_id);return d&&l.push({node:c,entity:d}),l},[]))},[r==null?void 0:r.id,t]);return m.useEffect(()=>{t&&o()},[o,t]),{chatList:e,getChatList:o}};function j6({mainLLMInfo:t,loadLLM:e,threadNode:n,currentDataNode:r,...o}){const{chatList:a}=KM(n);return x.jsxs(zc,{variant:"sidebar",side:"right",collapsible:"none",...o,children:[x.jsx("div",{className:"h-1"}),x.jsxs(Wc,{children:[x.jsx(Fo,{className:"flex-1",children:x.jsx(Tr,{children:a.map(({node:i},s)=>{var l;return x.jsx(fn,{children:x.jsxs(mn,{className:"cursor-pointer",children:[x.jsx("span",{children:`Thread ${s+1}`}),x.jsx($e,{name:((l=r==null?void 0:r.node)==null?void 0:l.id)===i.id?"check":"chevron-right",className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})},i.id)})})}),x.jsx(QM,{llm:t==null?void 0:t.llm,status:t==null?void 0:t.status,progress:t==null?void 0:t.progress,loadLLM:e})]})]})}const R6=m.lazy(()=>ff(()=>import("./index-BQCnMJUN.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([7,8,1,2,9,10]))),P6=[{icon:tL,label:"Copy"},{icon:rL,label:"Refresh"},{icon:aL,label:"Volume"}],T6=m.memo(()=>{const t=m.useRef(!1),[e,n]=m.useState(!1),r=m.useCallback(()=>{setTimeout(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},50)},[]),{threadInfo:o,mainLLMInfo:a,currentDataNode:i,loadLLM:s,updateMessagesData:l,onThreadMessagesLoaded:c}=jM(),{sendMessage:d}=IM(),{input:u,setInput:h,messages:p,handleSubmit:y,handleInputChange:f,isLoading:v,reload:g,setMessages:b}=wm({fetch:async(N,_)=>{const O=JSON.parse(_==null?void 0:_.body),k=Vs(),I=O.messages[O.messages.length-1];return t.current=!0,b(B=>[...B,{id:Vs(),content:I.content,role:"user"},{id:k,content:"Thinking...",role:"assistant"}]),await d(I.content,O.messages||[],void 0,[],{onMessageUpdate(B){b(L=>{const C=[...L],P=C.findIndex(j=>j.id===k);return P!==-1&&(C[P]={...C[P],content:B.nodeData.content||""}),C}),t.current&&r()}}),b(B=>(l(B),B)),n(!1),h(""),t.current&&r(),new Response}}),w=m.useRef(null);m.useEffect(()=>{const N=c(_=>{b(_||[]),r()});return()=>{N()}},[b,c,r]);const E=async(N,_)=>(n(!0),await y(_),!0),M=async(N,_)=>{if(N==="Refresh"){n(!0);try{await g()}catch(O){console.error("Error reloading:",O)}finally{n(!1)}}if(N==="Copy"){const O=p[_];O&&O.role==="assistant"&&navigator.clipboard.writeText(O.content)}if(N==="Volume"){const O=p[_];O!=null&&O.content&&await G6.speak((O==null?void 0:O.content)||"")}},S=m.useCallback(()=>t.current=!1,[]);return x.jsxs(Fc,{onClick:S,className:"max-h-full !overflow-hidden !min-h-full",style:{minHeight:"unset"},defaultOpen:!0,children:[x.jsx(Vc,{className:"!max-h-full !overflow-hidden",style:{minHeight:"unset"},children:x.jsxs("main",{className:"flex h-full w-full max-w-2xl flex-col items-center mx-auto overflow-hidden",children:[x.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden min-w-full",children:x.jsx(Wv,{className:"!max-h-full",ref:w,children:p&&p.map((N,_)=>x.jsxs(zv,{variant:N.role=="user"?"sent":"received",children:[N.role!=="user"?x.jsx(mk,{src:"",fallback:"\u{1F916}"}):void 0,x.jsxs(Vv,{children:[x.jsx(m.Suspense,{fallback:x.jsx(Fv,{}),children:x.jsx(R6,{className:"!text-sm [&_p]:leading-relaxed !max-w-full !bg-transparent !text-inherit !font-sans",source:N.content||""})}),N.role==="assistant"&&p.length-1===_&&x.jsx("div",{className:"flex items-center mt-1.5 gap-1",children:!e&&x.jsx(x.Fragment,{children:P6.map((O,k)=>{const I=O.icon;return x.jsx(gk,{variant:"ghost",className:"size-5",icon:x.jsx(I,{className:"size-3"}),onClick:()=>M(O.label,_)},k)})})})]})]},_))})}),x.jsx(Ff,{className:"!max-w-2xl px-4",onSubmit:E,disabled:v||e||(a==null?void 0:a.status)!==Dt.Loaded,placeholder:"Type your message here...",maxHeight:72,value:u,onChange:f})]})}),x.jsx(j6,{currentDataNode:i,threadNode:o==null?void 0:o.threadNode,loadLLM:s,mainLLMInfo:a})]})});function I6(){const t=kt(e=>e.currentSession);if(!t)return x.jsx(cC,{flickeringGrid:!0,className:"w-full h-full"});if(t.main_source_type==="Thread")return x.jsx(T6,{})}let YM,XM,ZM;YM=m.lazy(()=>ff(()=>import("./HomePage-DNmSHrP7.js").then(async t=>(await t.__tla,t)).then(t=>t.N),__vite__mapDeps([11,1,2]))),XM=GN(ec(x.jsxs(Ao,{Component:uk,children:[x.jsx(Ao,{path:Uc.whiteboard,element:x.jsx(m.Suspense,{fallback:x.jsx(cC,{flickeringGrid:!0,typing:!1}),children:x.jsx(YM,{})})}),x.jsx(Ao,{path:Uc.application,element:x.jsx(I6,{})}),x.jsx(Ao,{path:"*",element:x.jsx(QN,{to:Ft("whiteboard")})})]})),{basename:"/NoLLMChat/"}),ZM=m.memo(()=>(J6("[BASE_URL]","/NoLLMChat/"),m.useEffect(()=>{window.location.pathname.includes("/NoLLMChat/")||(window.location.href="/NoLLMChat/".replace("//","/"))},[]),x.jsx(sS,{router:XM}))),OC=Object.freeze(Object.defineProperty({__proto__:null,default:ZM},Symbol.toStringTag,{value:"Module"}))});export{uC as $,mf as A,Us as B,yf as C,Aa as D,Hs as E,ka as F,gf as G,qs as H,vf as I,Qs as J,ja as K,xf as L,Ra as M,Pa as N,fr as O,bf as P,mr as Q,wf as R,Ef as S,Ks as T,Kn as U,dC as V,_f as W,Ys as X,Mf as Y,Ta as Z,Xs as _,sL as __tla,yr as a,hC as a$,Cf as a0,pC as a1,fC as a2,Nf as a3,Ia as a4,Sf as a5,Zs as a6,Gs as a7,Js as a8,el as a9,Of as aA,tl as aB,po as aC,nl as aD,rl as aE,ol as aF,al as aG,Da as aH,il as aI,La as aJ,Af as aK,kf as aL,jf as aM,$a as aN,Ba as aO,Qt as aP,sl as aQ,Rf as aR,Pf as aS,Tf as aT,If as aU,Fa as aV,Df as aW,Lf as aX,$f as aY,ll as aZ,za as a_,cl as aa,Va as ab,fo as ac,xe as ad,mo as ae,mC as af,yC as ag,ul as ah,dl as ai,Bf as aj,Ff as ak,zf as al,hl as am,Wa as an,Ua as ao,sn as ap,Vf as aq,gr as ar,ln as as,vr as at,pl as au,xr as av,Wf as aw,Uf as ax,Hf as ay,qf as az,fl as b,ml as b$,Ha as b0,ke as b1,He as b2,gC as b3,vC as b4,yo as b5,xC as b6,qa as b7,Yn as b8,bC as b9,Qf as bA,Kf as bB,yl as bC,Yf as bD,Xf as bE,Zf as bF,wC as bG,gl as bH,Gf as bI,EC as bJ,vl as bK,xl as bL,bl as bM,Jf as bN,wl as bO,El as bP,_l as bQ,Ml as bR,Cl as bS,Nl as bT,em as bU,tm as bV,_C as bW,Sl as bX,Ol as bY,Al as bZ,kl as b_,Xn as ba,MC as bb,An as bc,CC as bd,NC as be,jl as bf,nm as bg,rm as bh,Rl as bi,om as bj,am as bk,Pl as bl,im as bm,sm as bn,Tl as bo,lm as bp,cm as bq,Il as br,go as bs,br as bt,Dl as bu,um as bv,dm as bw,hm as bx,pm as by,fm as bz,Ll as c,$l as c0,mm as c1,ym as c2,gm as c3,vo as c4,wr as c5,Er as c6,SC as c7,vm as c8,xm as c9,bm as ca,Bl as cb,wm as cc,OC as cd,Em as d,Fl as e,zl as f,_m as g,Mm as h,cn as i,Cm as j,Nm as k,Sm as l,jt as m,Om as n,Am as o,km as p,It as q,jm as r,Rm as s,AC as t,Vl as u,Dt as v,Pm as w,Tm as x,xo as y,Wl as z};
