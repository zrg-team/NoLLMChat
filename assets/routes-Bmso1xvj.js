const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatApplication-601C7v2Y.js","assets/index-DWQzdqsc.js","assets/index-Vcso_2OS.css","assets/index-C1beiGPe.js","assets/toNumber-Ca8lpn2y.js","assets/popover-Qa2ZleT0.js","assets/index-BtRrMOaN.js","assets/chunk-0NskZGly.js","assets/LLMIcon-DTzLaIG1.js","assets/dot-CWbyRG3b.js","assets/createLucideIcon-ByB7ruez.js","assets/alert-dialog-Cnaqib2Z.js","assets/index-DN05I0WP.js","assets/EditorApplication-CDBBtnuO.js","assets/VSLiteApplication-Bne2hI2K.js","assets/file-tree-DH9c22tu.js","assets/Home-BgNY-_7t.js","assets/index-ZqEu-5w_.js","assets/plate-editor-ArT3MpUu.js","assets/DocumentViewer-SyykF__R.js","assets/index-BgvtCfYU.js","assets/SessionList-bDuR3upu.js"])))=>i.map(i=>d[i]);
var zN=Object.defineProperty;var UN=(Gt,hr,ta)=>hr in Gt?zN(Gt,hr,{enumerable:!0,configurable:!0,writable:!0,value:ta}):Gt[hr]=ta;var ae=(Gt,hr,ta)=>UN(Gt,typeof hr!="symbol"?hr+"":hr,ta);import{r as y,C as u0,y as pi,ag as BN,a as fi,h as Za,j as w,P as Ve,b as be,i as kr,u as yt,c as me,l as xl,K as gn,x as Vn,N as ep,ah as HN,O as tp,L as Ye,S as WN,ai as GN,e as mi,s as qN,I as yn,d as kl,T as Al,U as Tl,v as VN,w as h0,f as ZN,J as p0,aj as f0,ak as JN,R as KN,a6 as Ml,al as m0,g as Ja,B as rp,G as gi,am as YN,ab as XN,Q as g0,W as QN,_ as Ka,D as Ya,__tla as eI}from"./index-DWQzdqsc.js";let np,Zn,zr,Xa,Qa,eo,De,Jn,to,ap,ro,Fl,op,Rl,Ur,no,Ol,ip,Nl,ao,y0,sp,Br,_0,lp,cp,dp,up,oo,hp,pp,fp,mp,Il,Bt,gp,Pl,yp,_p,Cl,vp,Kn,St,it,wp,Ie,jl,bp,Ep,Sp,Ot,v0,xp,w0,kp,Ll,Ap,Tp,Mp,Fp,Rp,Op,Np,Ip,Pp,Cp,jp,Dl,Ht,io,Lp,Dp,st,$p,zp,_n,Up,$l,Bp,yi,_i,so,zl,vi,wi,Ul,Bl,bi,b0,Hp,E0,S0,Ei,Wp,cr,Gp,qp,Vp,Hl,Wl,Gl,ql,x0,Zp,dr,k0,A0,Vl,T0,Jp,Kp,Si,vn,M0,F0,R0,O0,Yp,N0,lo,Xp,Qp,I0,Zl,P0,Jl,Kl,co,Yl,Xl,ef,Ql,xi,tf,rf,nf,C0,uo,af,of,ki,sf,lf,cf,j0,wn,L0,df,uf,bn,hf,Ai,D0,$0,pf,ho,ur,z0,U0,Wt,Yn,B0,H0,W0,G0,ff,mf,gf,yf,ec,_f,vf,wf,Ti,Xn,bf,q0,Ef,Sf,tc,xf,V0,rc,nc,ac,kf,oc,ic,sc,lc,cc,dc,Af,Tf,Z0,Mf,Ff,Rf,J0,uc,hc,K0,Ce,pc,fc,Qn,We,ea,En,Of,mc,gc,yc,Nf,Sn,_t,Mi,If,_c,vc,Hr,wc,bc,Ec,Sc,Fi,tI=Promise.all([(()=>{try{return eI}catch{}})()]).then(async()=>{var Gt={},hr;function ta(){if(hr)return Gt;hr=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.parse=i,Gt.serialize=c;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,o=(()=>{const h=function(){};return h.prototype=Object.create(null),h})();function i(h,p){const f=new o,g=h.length;if(g<2)return f;const m=(p==null?void 0:p.decode)||d;let _=0;do{const v=h.indexOf("=",_);if(v===-1)break;const A=h.indexOf(";",_),F=A===-1?g:A;if(v>F){_=h.lastIndexOf(";",v-1)+1;continue}const b=s(h,_,v),D=l(h,v,b),B=h.slice(b,D);if(f[B]===void 0){let j=s(h,v+1,F),G=l(h,F,j);const te=m(h.slice(j,G));f[B]=te}_=F+1}while(_<g);return f}function s(h,p,f){do{const g=h.charCodeAt(p);if(g!==32&&g!==9)return p}while(++p<f);return f}function l(h,p,f){for(;p>f;){const g=h.charCodeAt(--p);if(g!==32&&g!==9)return p+1}return f}function c(h,p,f){const g=(f==null?void 0:f.encode)||encodeURIComponent;if(!t.test(h))throw new TypeError(`argument name is invalid: ${h}`);const m=g(p);if(!e.test(m))throw new TypeError(`argument val is invalid: ${p}`);let _=h+"="+m;if(!f)return _;if(f.maxAge!==void 0){if(!Number.isInteger(f.maxAge))throw new TypeError(`option maxAge is invalid: ${f.maxAge}`);_+="; Max-Age="+f.maxAge}if(f.domain){if(!r.test(f.domain))throw new TypeError(`option domain is invalid: ${f.domain}`);_+="; Domain="+f.domain}if(f.path){if(!n.test(f.path))throw new TypeError(`option path is invalid: ${f.path}`);_+="; Path="+f.path}if(f.expires){if(!u(f.expires)||!Number.isFinite(f.expires.valueOf()))throw new TypeError(`option expires is invalid: ${f.expires}`);_+="; Expires="+f.expires.toUTCString()}if(f.httpOnly&&(_+="; HttpOnly"),f.secure&&(_+="; Secure"),f.partitioned&&(_+="; Partitioned"),f.priority)switch(typeof f.priority=="string"?f.priority.toLowerCase():void 0){case"low":_+="; Priority=Low";break;case"medium":_+="; Priority=Medium";break;case"high":_+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${f.priority}`)}if(f.sameSite)switch(typeof f.sameSite=="string"?f.sameSite.toLowerCase():f.sameSite){case!0:case"strict":_+="; SameSite=Strict";break;case"lax":_+="; SameSite=Lax";break;case"none":_+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${f.sameSite}`)}return _}function d(h){if(h.indexOf("%")===-1)return h;try{return decodeURIComponent(h)}catch{return h}}function u(h){return a.call(h)==="[object Date]"}return Gt}ta();var Pf="popstate";function Y0(t={}){function e(n,a){let{pathname:o,search:i,hash:s}=n.location;return ra("",{pathname:o,search:i,hash:s},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:Ar(a)}return jf(e,r,null,t)}function X0(t={}){function e(a,o){let{pathname:i="/",search:s="",hash:l=""}=Tr(a.location.hash.substring(1));return!i.startsWith("/")&&!i.startsWith(".")&&(i="/"+i),ra("",{pathname:i,search:s,hash:l},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(a,o){let i=a.document.querySelector("base"),s="";if(i&&i.getAttribute("href")){let l=a.location.href,c=l.indexOf("#");s=c===-1?l:l.slice(0,c)}return s+"#"+(typeof o=="string"?o:Ar(o))}function n(a,o){rt(a.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(o)})`)}return jf(e,r,n,t)}function xe(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function rt(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Q0(){return Math.random().toString(36).substring(2,10)}function Cf(t,e){return{usr:t.state,key:t.key,idx:e}}function ra(t,e,r=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Tr(e):e,state:r,key:e&&e.key||n||Q0()}}function Ar({pathname:t="/",search:e="",hash:r=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Tr(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function jf(t,e,r,n={}){let{window:a=document.defaultView,v5Compat:o=!1}=n,i=a.history,s="POP",l=null,c=d();c==null&&(c=0,i.replaceState({...i.state,idx:c},""));function d(){return(i.state||{idx:null}).idx}function u(){s="POP";let m=d(),_=m==null?null:m-c;c=m,l&&l({action:s,location:g.location,delta:_})}function h(m,_){s="PUSH";let v=ra(g.location,m,_);r&&r(v,m),c=d()+1;let A=Cf(v,c),F=g.createHref(v);try{i.pushState(A,"",F)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;a.location.assign(F)}o&&l&&l({action:s,location:g.location,delta:1})}function p(m,_){s="REPLACE";let v=ra(g.location,m,_);r&&r(v,m),c=d();let A=Cf(v,c),F=g.createHref(v);i.replaceState(A,"",F),o&&l&&l({action:s,location:g.location,delta:0})}function f(m){let _=a.location.origin!=="null"?a.location.origin:a.location.href,v=typeof m=="string"?m:Ar(m);return v=v.replace(/ $/,"%20"),xe(_,`No window.location.(origin|href) available to create URL for href: ${v}`),new URL(v,_)}let g={get action(){return s},get location(){return t(a,i)},listen(m){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(Pf,u),l=m,()=>{a.removeEventListener(Pf,u),l=null}},createHref(m){return e(a,m)},createURL:f,encodeLocation(m){let _=f(m);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:h,replace:p,go(m){return i.go(m)}};return g}var eE=new Set(["lazy","caseSensitive","path","id","index","children"]);function tE(t){return t.index===!0}function Ri(t,e,r=[],n={}){return t.map((a,o)=>{let i=[...r,String(o)],s=typeof a.id=="string"?a.id:i.join("-");if(xe(a.index!==!0||!a.children,"Cannot specify children on an index route"),xe(!n[s],`Found a route id collision on id "${s}".  Route id's must be globally unique within Data Router usages`),tE(a)){let l={...a,...e(a),id:s};return n[s]=l,l}else{let l={...a,...e(a),id:s,children:void 0};return n[s]=l,a.children&&(l.children=Ri(a.children,e,i,n)),l}})}function Wr(t,e,r="/"){return Oi(t,e,r,!1)}function Oi(t,e,r,n){let a=typeof e=="string"?Tr(e):e,o=qt(a.pathname||"/",r);if(o==null)return null;let i=Lf(t);nE(i);let s=null;for(let l=0;s==null&&l<i.length;++l){let c=fE(o);s=hE(i[l],c,n)}return s}function rE(t,e){let{route:r,pathname:n,params:a}=t;return{id:r.id,pathname:n,params:a,data:e[r.id],handle:r.handle}}function Lf(t,e=[],r=[],n=""){let a=(o,i,s)=>{let l={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};l.relativePath.startsWith("/")&&(xe(l.relativePath.startsWith(n),`Absolute route path "${l.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(n.length));let c=pr([n,l.relativePath]),d=r.concat(l);o.children&&o.children.length>0&&(xe(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),Lf(o.children,e,d,c)),!(o.path==null&&!o.index)&&e.push({path:c,score:dE(c,o.index),routesMeta:d})};return t.forEach((o,i)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))a(o,i);else for(let l of Df(o.path))a(o,i,l)}),e}function Df(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,a=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return a?[o,""]:[o];let i=Df(n.join("/")),s=[];return s.push(...i.map(l=>l===""?o:[o,l].join("/"))),a&&s.push(...i),s.map(l=>t.startsWith("/")&&l===""?"/":l)}function nE(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:uE(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}var aE=/^:[\w-]+$/,oE=3,iE=2,sE=1,lE=10,cE=-2,$f=t=>t==="*";function dE(t,e){let r=t.split("/"),n=r.length;return r.some($f)&&(n+=cE),e&&(n+=iE),r.filter(a=>!$f(a)).reduce((a,o)=>a+(aE.test(o)?oE:o===""?sE:lE),n)}function uE(t,e){return t.length===e.length&&t.slice(0,-1).every((r,n)=>r===e[n])?t[t.length-1]-e[e.length-1]:0}function hE(t,e,r=!1){let{routesMeta:n}=t,a={},o="/",i=[];for(let s=0;s<n.length;++s){let l=n[s],c=s===n.length-1,d=o==="/"?e:e.slice(o.length)||"/",u=Ni({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},d),h=l.route;if(!u&&c&&r&&!n[n.length-1].route.index&&(u=Ni({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!u)return null;Object.assign(a,u.params),i.push({params:a,pathname:pr([o,u.pathname]),pathnameBase:yE(pr([o,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(o=pr([o,u.pathnameBase]))}return i}function Ni(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=pE(t.path,t.caseSensitive,t.end),a=e.match(r);if(!a)return null;let o=a[0],i=o.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:n.reduce((l,{paramName:c,isOptional:d},u)=>{if(c==="*"){let p=s[u]||"";i=o.slice(0,o.length-p.length).replace(/(.)\/+$/,"$1")}const h=s[u];return d&&!h?l[c]=void 0:l[c]=(h||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:i,pattern:t}}function pE(t,e=!1,r=!0){rt(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,i,s)=>(n.push({paramName:i,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),n]}function fE(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return rt(!1,`The URL path "${t}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function qt(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function mE(t,e="/"){let{pathname:r,search:n="",hash:a=""}=typeof t=="string"?Tr(t):t;return{pathname:r?r.startsWith("/")?r:gE(r,e):e,search:_E(n),hash:vE(a)}}function gE(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function xc(t,e,r,n){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function zf(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function Ii(t){let e=zf(t);return e.map((r,n)=>n===e.length-1?r.pathname:r.pathnameBase)}function Pi(t,e,r,n=!1){let a;typeof t=="string"?a=Tr(t):(a={...t},xe(!a.pathname||!a.pathname.includes("?"),xc("?","pathname","search",a)),xe(!a.pathname||!a.pathname.includes("#"),xc("#","pathname","hash",a)),xe(!a.search||!a.search.includes("#"),xc("#","search","hash",a)));let o=t===""||a.pathname==="",i=o?"/":a.pathname,s;if(i==null)s=r;else{let u=e.length-1;if(!n&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),u-=1;a.pathname=h.join("/")}s=u>=0?e[u]:"/"}let l=mE(a,s),c=i&&i!=="/"&&i.endsWith("/"),d=(o||i===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(c||d)&&(l.pathname+="/"),l}var pr=t=>t.join("/").replace(/\/\/+/g,"/"),yE=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),_E=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,vE=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,Ci=class{constructor(t,e,r,n=!1){this.status=t,this.statusText=e||"",this.internal=n,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function ji(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var Uf=["POST","PUT","PATCH","DELETE"],wE=new Set(Uf),bE=["GET",...Uf],EE=new Set(bE),SE=new Set([301,302,303,307,308]),xE=new Set([307,308]),kc={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},kE={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},po={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},Ac=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,AE=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),Bf="remix-router-transitions",Hf=Symbol("ResetLoaderData");function Wf(t){const e=t.window?t.window:typeof window<"u"?window:void 0,r=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u";xe(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let n=t.mapRouteProperties||AE,a={},o=Ri(t.routes,n,void 0,a),i,s=t.basename||"/",l=t.dataStrategy||OE,c=t.patchRoutesOnNavigation,d={...t.future},u=null,h=new Set,p=null,f=null,g=null,m=t.hydrationData!=null,_=Wr(o,t.history.location,s),v=null;if(_==null&&!c){let O=Nt(404,{pathname:t.history.location.pathname}),{matches:z,route:U}=rm(o);_=z,v={[U.id]:O}}_&&!t.hydrationData&&Hn(_,o,t.history.location.pathname).active&&(_=null);let A;if(_)if(_.some(O=>O.route.lazy))A=!1;else if(!_.some(O=>O.route.loader))A=!0;else{let O=t.hydrationData?t.hydrationData.loaderData:null,z=t.hydrationData?t.hydrationData.errors:null;if(z){let U=_.findIndex(V=>z[V.route.id]!==void 0);A=_.slice(0,U+1).every(V=>!Mc(V.route,O,z))}else A=_.every(U=>!Mc(U.route,O,z))}else{A=!1,_=[];let O=Hn(null,o,t.history.location.pathname);O.active&&O.matches&&(_=O.matches)}let F,b={historyAction:t.history.action,location:t.history.location,matches:_,initialized:A,navigation:kc,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||v,fetchers:new Map,blockers:new Map},D="POP",B=!1,j,G=!1,te=new Map,ue=null,x=!1,R=!1,k=new Set,E=new Map,H=0,N=-1,C=new Map,P=new Set,Z=new Map,ne=new Map,le=new Set,ye=new Map,we,$e=null;function Qe(){if(u=t.history.listen(({action:O,location:z,delta:U})=>{if(we){we(),we=void 0;return}rt(ye.size===0||U!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let V=Ga({currentLocation:b.location,nextLocation:z,historyAction:O});if(V&&U!=null){let oe=new Promise(pe=>{we=pe});t.history.go(U*-1),Wa(V,{state:"blocked",location:z,proceed(){Wa(V,{state:"proceeding",proceed:void 0,reset:void 0,location:z}),oe.then(()=>t.history.go(U))},reset(){let pe=new Map(b.blockers);pe.set(V,po),Fe({blockers:pe})}});return}return gt(O,z)}),r){BE(e,te);let O=()=>HE(e,te);e.addEventListener("pagehide",O),ue=()=>e.removeEventListener("pagehide",O)}return b.initialized||gt("POP",b.location,{initialHydration:!0}),F}function Dt(){u&&u(),ue&&ue(),h.clear(),j&&j.abort(),b.fetchers.forEach((O,z)=>Ha(z)),b.blockers.forEach((O,z)=>bl(z))}function Rt(O){return h.add(O),()=>h.delete(O)}function Fe(O,z={}){b={...b,...O};let U=[],V=[];b.fetchers.forEach((oe,pe)=>{oe.state==="idle"&&(le.has(pe)?U.push(pe):V.push(pe))}),[...h].forEach(oe=>oe(b,{deletedFetchers:U,viewTransitionOpts:z.viewTransitionOpts,flushSync:z.flushSync===!0})),U.forEach(oe=>Ha(oe)),V.forEach(oe=>b.fetchers.delete(oe))}function ut(O,z,{flushSync:U}={}){var ee,_e;let V=b.actionData!=null&&b.navigation.formMethod!=null&&Vt(b.navigation.formMethod)&&b.navigation.state==="loading"&&((ee=O.state)==null?void 0:ee._isRedirect)!==!0,oe;z.actionData?Object.keys(z.actionData).length>0?oe=z.actionData:oe=null:V?oe=b.actionData:oe=null;let pe=z.loaderData?em(b.loaderData,z.loaderData,z.matches||[],z.errors):b.loaderData,ge=b.blockers;ge.size>0&&(ge=new Map(ge),ge.forEach((Ae,Be)=>ge.set(Be,po)));let ie=B===!0||b.navigation.formMethod!=null&&Vt(b.navigation.formMethod)&&((_e=O.state)==null?void 0:_e._isRedirect)!==!0;i&&(o=i,i=void 0),x||D==="POP"||(D==="PUSH"?t.history.push(O,O.state):D==="REPLACE"&&t.history.replace(O,O.state));let de;if(D==="POP"){let Ae=te.get(b.location.pathname);Ae&&Ae.has(O.pathname)?de={currentLocation:b.location,nextLocation:O}:te.has(O.pathname)&&(de={currentLocation:O,nextLocation:b.location})}else if(G){let Ae=te.get(b.location.pathname);Ae?Ae.add(O.pathname):(Ae=new Set([O.pathname]),te.set(b.location.pathname,Ae)),de={currentLocation:b.location,nextLocation:O}}Fe({...z,actionData:oe,loaderData:pe,historyAction:D,location:O,initialized:!0,navigation:kc,revalidation:"idle",restoreScrollPosition:El(O,z.matches||b.matches),preventScrollReset:ie,blockers:ge},{viewTransitionOpts:de,flushSync:U===!0}),D="POP",B=!1,G=!1,x=!1,R=!1,$e==null||$e.resolve(),$e=null}async function Bn(O,z){if(typeof O=="number"){t.history.go(O);return}let U=Tc(b.location,b.matches,s,O,z==null?void 0:z.fromRouteId,z==null?void 0:z.relative),{path:V,submission:oe,error:pe}=Gf(!1,U,z),ge=b.location,ie=ra(b.location,V,z&&z.state);ie={...ie,...t.history.encodeLocation(ie)};let de=z&&z.replace!=null?z.replace:void 0,ee="PUSH";de===!0?ee="REPLACE":de===!1||oe!=null&&Vt(oe.formMethod)&&oe.formAction===b.location.pathname+b.location.search&&(ee="REPLACE");let _e=z&&"preventScrollReset"in z?z.preventScrollReset===!0:void 0,Ae=(z&&z.flushSync)===!0,Be=Ga({currentLocation:ge,nextLocation:ie,historyAction:ee});if(Be){Wa(Be,{state:"blocked",location:ie,proceed(){Wa(Be,{state:"proceeding",proceed:void 0,reset:void 0,location:ie}),Bn(O,z)},reset(){let Ge=new Map(b.blockers);Ge.set(Be,po),Fe({blockers:Ge})}});return}await gt(ee,ie,{submission:oe,pendingError:pe,preventScrollReset:_e,replace:z&&z.replace,enableViewTransition:z&&z.viewTransition,flushSync:Ae})}function $a(){$e||($e=WE()),Ba(),Fe({revalidation:"loading"});let O=$e.promise;return b.navigation.state==="submitting"?O:b.navigation.state==="idle"?(gt(b.historyAction,b.location,{startUninterruptedRevalidation:!0}),O):(gt(D||b.historyAction,b.navigation.location,{overrideNavigation:b.navigation,enableViewTransition:G===!0}),O)}async function gt(O,z,U){j&&j.abort(),j=null,D=O,x=(U&&U.startUninterruptedRevalidation)===!0,Jh(b.location,b.matches),B=(U&&U.preventScrollReset)===!0,G=(U&&U.enableViewTransition)===!0;let V=i||o,oe=U&&U.overrideNavigation,pe=Wr(V,z,s),ge=(U&&U.flushSync)===!0,ie=Hn(pe,V,z.pathname);if(ie.active&&ie.matches&&(pe=ie.matches),!pe){let{error:Re,notFoundMatches:bt,route:Ke}=qa(z.pathname);ut(z,{matches:bt,loaderData:{},errors:{[Ke.id]:Re}},{flushSync:ge});return}if(b.initialized&&!R&&LE(b.location,z)&&!(U&&U.submission&&Vt(U.submission.formMethod))){ut(z,{matches:pe},{flushSync:ge});return}j=new AbortController;let de=na(t.history,z,j.signal,U&&U.submission),ee;if(U&&U.pendingError)ee=[xn(pe).route.id,{type:"error",error:U.pendingError}];else if(U&&U.submission&&Vt(U.submission.formMethod)){let Re=await ni(de,z,U.submission,pe,ie.active,{replace:U.replace,flushSync:ge});if(Re.shortCircuited)return;if(Re.pendingActionResult){let[bt,Ke]=Re.pendingActionResult;if(xt(Ke)&&ji(Ke.error)&&Ke.error.status===404){j=null,ut(z,{matches:Re.matches,loaderData:{},errors:{[bt]:Ke.error}});return}}pe=Re.matches||pe,ee=Re.pendingActionResult,oe=Oc(z,U.submission),ge=!1,ie.active=!1,de=na(t.history,de.url,de.signal)}let{shortCircuited:_e,matches:Ae,loaderData:Be,errors:Ge}=await $t(de,z,pe,ie.active,oe,U&&U.submission,U&&U.fetcherSubmission,U&&U.replace,U&&U.initialHydration===!0,ge,ee);_e||(j=null,ut(z,{matches:Ae||pe,...tm(ee),loaderData:Be,errors:Ge}))}async function ni(O,z,U,V,oe,pe={}){Ba();let ge=zE(z,U);if(Fe({navigation:ge},{flushSync:pe.flushSync===!0}),oe){let ee=await Va(V,z.pathname,O.signal);if(ee.type==="aborted")return{shortCircuited:!0};if(ee.type==="error"){let _e=xn(ee.partialMatches).route.id;return{matches:ee.partialMatches,pendingActionResult:[_e,{type:"error",error:ee.error}]}}else if(ee.matches)V=ee.matches;else{let{notFoundMatches:_e,error:Ae,route:Be}=qa(z.pathname);return{matches:_e,pendingActionResult:[Be.id,{type:"error",error:Ae}]}}}let ie,de=fo(V,z);if(!de.route.action&&!de.route.lazy)ie={type:"error",error:Nt(405,{method:O.method,pathname:z.pathname,routeId:de.route.id})};else if(ie=(await pn("action",b,O,[de],V,null))[de.route.id],O.signal.aborted)return{shortCircuited:!0};if(kn(ie)){let ee;return pe&&pe.replace!=null?ee=pe.replace:ee=Yf(ie.response.headers.get("Location"),new URL(O.url),s)===b.location.pathname+b.location.search,await nr(O,ie,!0,{submission:U,replace:ee}),{shortCircuited:!0}}if(xt(ie)){let ee=xn(V,de.route.id);return(pe&&pe.replace)!==!0&&(D="PUSH"),{matches:V,pendingActionResult:[ee.route.id,ie]}}return{matches:V,pendingActionResult:[de.route.id,ie]}}async function $t(O,z,U,V,oe,pe,ge,ie,de,ee,_e){let Ae=oe||Oc(z,pe),Be=pe||ge||im(Ae),Ge=!x&&!de;if(V){if(Ge){let Et=za(_e);Fe({navigation:Ae,...Et!==void 0?{actionData:Et}:{}},{flushSync:ee})}let Te=await Va(U,z.pathname,O.signal);if(Te.type==="aborted")return{shortCircuited:!0};if(Te.type==="error"){let Et=xn(Te.partialMatches).route.id;return{matches:Te.partialMatches,loaderData:{},errors:{[Et]:Te.error}}}else if(Te.matches)U=Te.matches;else{let{error:Et,notFoundMatches:xr,route:He}=qa(z.pathname);return{matches:xr,loaderData:{},errors:{[He.id]:Et}}}}let Re=i||o,[bt,Ke]=Vf(t.history,b,U,Be,z,de===!0,R,k,le,Z,P,Re,s,_e);if(N=++H,bt.length===0&&Ke.length===0){let Te=li();return ut(z,{matches:U,loaderData:{},errors:_e&&xt(_e[1])?{[_e[0]]:_e[1].error}:null,...tm(_e),...Te?{fetchers:new Map(b.fetchers)}:{}},{flushSync:ee}),{shortCircuited:!0}}if(Ge){let Te={};if(!V){Te.navigation=Ae;let Et=za(_e);Et!==void 0&&(Te.actionData=Et)}Ke.length>0&&(Te.fetchers=Ua(Ke)),Fe(Te,{flushSync:ee})}Ke.forEach(Te=>{or(Te.key),Te.controller&&E.set(Te.key,Te.controller)});let Wn=()=>Ke.forEach(Te=>or(Te.key));j&&j.signal.addEventListener("abort",Wn);let{loaderResults:sr,fetcherResults:fn}=await oi(b,U,bt,Ke,O);if(O.signal.aborted)return{shortCircuited:!0};j&&j.signal.removeEventListener("abort",Wn),Ke.forEach(Te=>E.delete(Te.key));let Er=Li(sr);if(Er)return await nr(O,Er.result,!0,{replace:ie}),{shortCircuited:!0};if(Er=Li(fn),Er)return P.add(Er.key),await nr(O,Er.result,!0,{replace:ie}),{shortCircuited:!0};let{loaderData:ui,errors:lr}=Qf(b,U,sr,_e,Ke,fn);de&&b.errors&&(lr={...b.errors,...lr});let Gn=li(),Sr=ci(N),qn=Gn||Sr||Ke.length>0;return{matches:U,loaderData:ui,errors:lr,...qn?{fetchers:new Map(b.fetchers)}:{}}}function za(O){if(O&&!xt(O[1]))return{[O[0]]:O[1].data};if(b.actionData)return Object.keys(b.actionData).length===0?null:b.actionData}function Ua(O){return O.forEach(z=>{let U=b.fetchers.get(z.key),V=mo(void 0,U?U.data:void 0);b.fetchers.set(z.key,V)}),new Map(b.fetchers)}async function hn(O,z,U,V){or(O);let oe=(V&&V.flushSync)===!0,pe=i||o,ge=Tc(b.location,b.matches,s,U,z,V==null?void 0:V.relative),ie=Wr(pe,ge,s),de=Hn(ie,pe,ge);if(de.active&&de.matches&&(ie=de.matches),!ie){zt(O,z,Nt(404,{pathname:ge}),{flushSync:oe});return}let{path:ee,submission:_e,error:Ae}=Gf(!0,ge,V);if(Ae){zt(O,z,Ae,{flushSync:oe});return}let Be=fo(ie,ee),Ge=(V&&V.preventScrollReset)===!0;if(_e&&Vt(_e.formMethod)){await br(O,z,ee,Be,ie,de.active,oe,Ge,_e);return}Z.set(O,{routeId:z,path:ee}),await ai(O,z,ee,Be,ie,de.active,oe,Ge,_e)}async function br(O,z,U,V,oe,pe,ge,ie,de){Ba(),Z.delete(O);function ee(He){if(!He.route.action&&!He.route.lazy){let mn=Nt(405,{method:de.formMethod,pathname:U,routeId:z});return zt(O,z,mn,{flushSync:ge}),!0}return!1}if(!pe&&ee(V))return;let _e=b.fetchers.get(O);ar(O,UE(de,_e),{flushSync:ge});let Ae=new AbortController,Be=na(t.history,U,Ae.signal,de);if(pe){let He=await Va(oe,U,Be.signal);if(He.type==="aborted")return;if(He.type==="error"){zt(O,z,He.error,{flushSync:ge});return}else if(He.matches){if(oe=He.matches,V=fo(oe,U),ee(V))return}else{zt(O,z,Nt(404,{pathname:U}),{flushSync:ge});return}}E.set(O,Ae);let Ge=H,Re=(await pn("action",b,Be,[V],oe,O))[V.route.id];if(Be.signal.aborted){E.get(O)===Ae&&E.delete(O);return}if(le.has(O)){if(kn(Re)||xt(Re)){ar(O,Gr(void 0));return}}else{if(kn(Re))if(E.delete(O),N>Ge){ar(O,Gr(void 0));return}else return P.add(O),ar(O,mo(de)),nr(Be,Re,!1,{fetcherSubmission:de,preventScrollReset:ie});if(xt(Re)){zt(O,z,Re.error);return}}let bt=b.navigation.location||b.location,Ke=na(t.history,bt,Ae.signal),Wn=i||o,sr=b.navigation.state!=="idle"?Wr(Wn,b.navigation.location,s):b.matches;xe(sr,"Didn't find any matches after fetcher action");let fn=++H;C.set(O,fn);let Er=mo(de,Re.data);b.fetchers.set(O,Er);let[ui,lr]=Vf(t.history,b,sr,de,bt,!1,R,k,le,Z,P,Wn,s,[V.route.id,Re]);lr.filter(He=>He.key!==O).forEach(He=>{let mn=He.key,Sl=b.fetchers.get(mn),hi=mo(void 0,Sl?Sl.data:void 0);b.fetchers.set(mn,hi),or(mn),He.controller&&E.set(mn,He.controller)}),Fe({fetchers:new Map(b.fetchers)});let Gn=()=>lr.forEach(He=>or(He.key));Ae.signal.addEventListener("abort",Gn);let{loaderResults:Sr,fetcherResults:qn}=await oi(b,sr,ui,lr,Ke);if(Ae.signal.aborted)return;Ae.signal.removeEventListener("abort",Gn),C.delete(O),E.delete(O),lr.forEach(He=>E.delete(He.key));let Te=Li(Sr);if(Te)return nr(Ke,Te.result,!1,{preventScrollReset:ie});if(Te=Li(qn),Te)return P.add(Te.key),nr(Ke,Te.result,!1,{preventScrollReset:ie});let{loaderData:Et,errors:xr}=Qf(b,sr,Sr,void 0,lr,qn);if(b.fetchers.has(O)){let He=Gr(Re.data);b.fetchers.set(O,He)}ci(fn),b.navigation.state==="loading"&&fn>N?(xe(D,"Expected pending action"),j&&j.abort(),ut(b.navigation.location,{matches:sr,loaderData:Et,errors:xr,fetchers:new Map(b.fetchers)})):(Fe({errors:xr,loaderData:em(b.loaderData,Et,sr,xr),fetchers:new Map(b.fetchers)}),R=!1)}async function ai(O,z,U,V,oe,pe,ge,ie,de){let ee=b.fetchers.get(O);ar(O,mo(de,ee?ee.data:void 0),{flushSync:ge});let _e=new AbortController,Ae=na(t.history,U,_e.signal);if(pe){let Re=await Va(oe,U,Ae.signal);if(Re.type==="aborted")return;if(Re.type==="error"){zt(O,z,Re.error,{flushSync:ge});return}else if(Re.matches)oe=Re.matches,V=fo(oe,U);else{zt(O,z,Nt(404,{pathname:U}),{flushSync:ge});return}}E.set(O,_e);let Be=H,Ge=(await pn("loader",b,Ae,[V],oe,O))[V.route.id];if(E.get(O)===_e&&E.delete(O),!Ae.signal.aborted){if(le.has(O)){ar(O,Gr(void 0));return}if(kn(Ge))if(N>Be){ar(O,Gr(void 0));return}else{P.add(O),await nr(Ae,Ge,!1,{preventScrollReset:ie});return}if(xt(Ge)){zt(O,z,Ge.error);return}ar(O,Gr(Ge.data))}}async function nr(O,z,U,{submission:V,fetcherSubmission:oe,preventScrollReset:pe,replace:ge}={}){z.response.headers.has("X-Remix-Revalidate")&&(R=!0);let ie=z.response.headers.get("Location");xe(ie,"Expected a Location header on the redirect Response"),ie=Yf(ie,new URL(O.url),s);let de=ra(b.location,ie,{_isRedirect:!0});if(r){let Re=!1;if(z.response.headers.has("X-Remix-Reload-Document"))Re=!0;else if(Ac.test(ie)){const bt=t.history.createURL(ie);Re=bt.origin!==e.location.origin||qt(bt.pathname,s)==null}if(Re){ge?e.location.replace(ie):e.location.assign(ie);return}}j=null;let ee=ge===!0||z.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:_e,formAction:Ae,formEncType:Be}=b.navigation;!V&&!oe&&_e&&Ae&&Be&&(V=im(b.navigation));let Ge=V||oe;if(xE.has(z.response.status)&&Ge&&Vt(Ge.formMethod))await gt(ee,de,{submission:{...Ge,formAction:ie},preventScrollReset:pe||B,enableViewTransition:U?G:void 0});else{let Re=Oc(de,V);await gt(ee,de,{overrideNavigation:Re,fetcherSubmission:oe,preventScrollReset:pe||B,enableViewTransition:U?G:void 0})}}async function pn(O,z,U,V,oe,pe){let ge,ie={};try{ge=await NE(l,O,z,U,V,oe,pe,a,n)}catch(de){return V.forEach(ee=>{ie[ee.route.id]={type:"error",error:de}}),ie}for(let[de,ee]of Object.entries(ge))if(DE(ee)){let _e=ee.result;ie[de]={type:"redirect",response:CE(_e,U,de,oe,s)}}else ie[de]=await PE(ee);return ie}async function oi(O,z,U,V,oe){let pe=pn("loader",O,oe,U,z,null),ge=Promise.all(V.map(async ee=>{if(ee.matches&&ee.match&&ee.controller){let _e=(await pn("loader",O,na(t.history,ee.path,ee.controller.signal),[ee.match],ee.matches,ee.key))[ee.match.route.id];return{[ee.key]:_e}}else return Promise.resolve({[ee.key]:{type:"error",error:Nt(404,{pathname:ee.path})}})})),ie=await pe,de=(await ge).reduce((ee,_e)=>Object.assign(ee,_e),{});return{loaderResults:ie,fetcherResults:de}}function Ba(){R=!0,Z.forEach((O,z)=>{E.has(z)&&k.add(z),or(z)})}function ar(O,z,U={}){b.fetchers.set(O,z),Fe({fetchers:new Map(b.fetchers)},{flushSync:(U&&U.flushSync)===!0})}function zt(O,z,U,V={}){let oe=xn(b.matches,z);Ha(O),Fe({errors:{[oe.route.id]:U},fetchers:new Map(b.fetchers)},{flushSync:(V&&V.flushSync)===!0})}function ii(O){return ne.set(O,(ne.get(O)||0)+1),le.has(O)&&le.delete(O),b.fetchers.get(O)||kE}function Ha(O){let z=b.fetchers.get(O);E.has(O)&&!(z&&z.state==="loading"&&C.has(O))&&or(O),Z.delete(O),C.delete(O),P.delete(O),le.delete(O),k.delete(O),b.fetchers.delete(O)}function wl(O){let z=(ne.get(O)||0)-1;z<=0?(ne.delete(O),le.add(O)):ne.set(O,z),Fe({fetchers:new Map(b.fetchers)})}function or(O){let z=E.get(O);z&&(z.abort(),E.delete(O))}function si(O){for(let z of O){let U=ii(z),V=Gr(U.data);b.fetchers.set(z,V)}}function li(){let O=[],z=!1;for(let U of P){let V=b.fetchers.get(U);xe(V,`Expected fetcher: ${U}`),V.state==="loading"&&(P.delete(U),O.push(U),z=!0)}return si(O),z}function ci(O){let z=[];for(let[U,V]of C)if(V<O){let oe=b.fetchers.get(U);xe(oe,`Expected fetcher: ${U}`),oe.state==="loading"&&(or(U),C.delete(U),z.push(U))}return si(z),z.length>0}function di(O,z){let U=b.blockers.get(O)||po;return ye.get(O)!==z&&ye.set(O,z),U}function bl(O){b.blockers.delete(O),ye.delete(O)}function Wa(O,z){let U=b.blockers.get(O)||po;xe(U.state==="unblocked"&&z.state==="blocked"||U.state==="blocked"&&z.state==="blocked"||U.state==="blocked"&&z.state==="proceeding"||U.state==="blocked"&&z.state==="unblocked"||U.state==="proceeding"&&z.state==="unblocked",`Invalid blocker state transition: ${U.state} -> ${z.state}`);let V=new Map(b.blockers);V.set(O,z),Fe({blockers:V})}function Ga({currentLocation:O,nextLocation:z,historyAction:U}){if(ye.size===0)return;ye.size>1&&rt(!1,"A router only supports one blocker at a time");let V=Array.from(ye.entries()),[oe,pe]=V[V.length-1],ge=b.blockers.get(oe);if(!(ge&&ge.state==="proceeding")&&pe({currentLocation:O,nextLocation:z,historyAction:U}))return oe}function qa(O){let z=Nt(404,{pathname:O}),U=i||o,{matches:V,route:oe}=rm(U);return{notFoundMatches:V,route:oe,error:z}}function Zh(O,z,U){if(p=O,g=z,f=U||null,!m&&b.navigation===kc){m=!0;let V=El(b.location,b.matches);V!=null&&Fe({restoreScrollPosition:V})}return()=>{p=null,g=null,f=null}}function ir(O,z){return f&&f(O,z.map(U=>rE(U,b.loaderData)))||O.key}function Jh(O,z){if(p&&g){let U=ir(O,z);p[U]=g()}}function El(O,z){if(p){let U=ir(O,z),V=p[U];if(typeof V=="number")return V}return null}function Hn(O,z,U){if(c)if(O){if(Object.keys(O[0].params).length>0)return{active:!0,matches:Oi(z,U,s,!0)}}else return{active:!0,matches:Oi(z,U,s,!0)||[]};return{active:!1,matches:null}}async function Va(O,z,U){if(!c)return{type:"success",matches:O};let V=O;for(;;){let oe=i==null,pe=i||o,ge=a;try{await c({path:z,matches:V,patch:(ee,_e)=>{U.aborted||Jf(ee,_e,pe,ge,n)}})}catch(ee){return{type:"error",error:ee,partialMatches:V}}finally{oe&&!U.aborted&&(o=[...o])}if(U.aborted)return{type:"aborted"};let ie=Wr(pe,z,s);if(ie)return{type:"success",matches:ie};let de=Oi(pe,z,s,!0);if(!de||V.length===de.length&&V.every((ee,_e)=>ee.route.id===de[_e].route.id))return{type:"success",matches:null};V=de}}function Kh(O){a={},i=Ri(O,n,void 0,a)}function Yh(O,z){let U=i==null;Jf(O,z,i||o,a,n),U&&(o=[...o],Fe({}))}return F={get basename(){return s},get future(){return d},get state(){return b},get routes(){return o},get window(){return e},initialize:Qe,subscribe:Rt,enableScrollRestoration:Zh,navigate:Bn,fetch:hn,revalidate:$a,createHref:O=>t.history.createHref(O),encodeLocation:O=>t.history.encodeLocation(O),getFetcher:ii,deleteFetcher:wl,dispose:Dt,getBlocker:di,deleteBlocker:bl,patchRoutes:Yh,_internalFetchControllers:E,_internalSetRoutes:Kh},F}function TE(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function Tc(t,e,r,n,a,o){let i,s;if(a){i=[];for(let c of e)if(i.push(c),c.route.id===a){s=c;break}}else i=e,s=e[e.length-1];let l=Pi(n||".",Ii(i),qt(t.pathname,r)||t.pathname,o==="path");if(n==null&&(l.search=t.search,l.hash=t.hash),(n==null||n===""||n===".")&&s){let c=Rc(l.search);if(s.route.index&&!c)l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index";else if(!s.route.index&&c){let d=new URLSearchParams(l.search),u=d.getAll("index");d.delete("index"),u.filter(p=>p).forEach(p=>d.append("index",p));let h=d.toString();l.search=h?`?${h}`:""}}return r!=="/"&&(l.pathname=l.pathname==="/"?r:pr([r,l.pathname])),Ar(l)}function Gf(t,e,r){if(!r||!TE(r))return{path:e};if(r.formMethod&&!$E(r.formMethod))return{path:e,error:Nt(405,{method:r.formMethod})};let n=()=>({path:e,error:Nt(400,{type:"invalid-body"})}),a=(r.formMethod||"get").toUpperCase(),o=nm(e);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Vt(a))return n();let d=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((u,[h,p])=>`${u}${h}=${p}
`,""):String(r.body);return{path:e,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:void 0,text:d}}}else if(r.formEncType==="application/json"){if(!Vt(a))return n();try{let d=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:e,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:d,text:void 0}}}catch{return n()}}}xe(typeof FormData=="function","FormData is not available in this environment");let i,s;if(r.formData)i=Fc(r.formData),s=r.formData;else if(r.body instanceof FormData)i=Fc(r.body),s=r.body;else if(r.body instanceof URLSearchParams)i=r.body,s=Xf(i);else if(r.body==null)i=new URLSearchParams,s=new FormData;else try{i=new URLSearchParams(r.body),s=Xf(i)}catch{return n()}let l={formMethod:a,formAction:o,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:s,json:void 0,text:void 0};if(Vt(l.formMethod))return{path:e,submission:l};let c=Tr(e);return t&&c.search&&Rc(c.search)&&i.append("index",""),c.search=`?${i}`,{path:Ar(c),submission:l}}function qf(t,e,r=!1){let n=t.findIndex(a=>a.route.id===e);return n>=0?t.slice(0,r?n+1:n):t}function Vf(t,e,r,n,a,o,i,s,l,c,d,u,h,p){let f=p?xt(p[1])?p[1].error:p[1].data:void 0,g=t.createURL(e.location),m=t.createURL(a),_=r;o&&e.errors?_=qf(r,Object.keys(e.errors)[0],!0):p&&xt(p[1])&&(_=qf(r,p[0]));let v=p?p[1].statusCode:void 0,A=v&&v>=400,F=_.filter((D,B)=>{let{route:j}=D;if(j.lazy)return!0;if(j.loader==null)return!1;if(o)return Mc(j,e.loaderData,e.errors);if(ME(e.loaderData,e.matches[B],D))return!0;let G=e.matches[B],te=D;return Zf(D,{currentUrl:g,currentParams:G.params,nextUrl:m,nextParams:te.params,...n,actionResult:f,actionStatus:v,defaultShouldRevalidate:A?!1:i||g.pathname+g.search===m.pathname+m.search||g.search!==m.search||FE(G,te)})}),b=[];return c.forEach((D,B)=>{if(o||!r.some(x=>x.route.id===D.routeId)||l.has(B))return;let j=Wr(u,D.path,h);if(!j){b.push({key:B,routeId:D.routeId,path:D.path,matches:null,match:null,controller:null});return}let G=e.fetchers.get(B),te=fo(j,D.path),ue=!1;d.has(B)?ue=!1:s.has(B)?(s.delete(B),ue=!0):G&&G.state!=="idle"&&G.data===void 0?ue=i:ue=Zf(te,{currentUrl:g,currentParams:e.matches[e.matches.length-1].params,nextUrl:m,nextParams:r[r.length-1].params,...n,actionResult:f,actionStatus:v,defaultShouldRevalidate:A?!1:i}),ue&&b.push({key:B,routeId:D.routeId,path:D.path,matches:j,match:te,controller:new AbortController})}),[F,b]}function Mc(t,e,r){if(t.lazy)return!0;if(!t.loader)return!1;let n=e!=null&&e[t.id]!==void 0,a=r!=null&&r[t.id]!==void 0;return!n&&a?!1:typeof t.loader=="function"&&t.loader.hydrate===!0?!0:!n&&!a}function ME(t,e,r){let n=!e||r.route.id!==e.route.id,a=!t.hasOwnProperty(r.route.id);return n||a}function FE(t,e){let r=t.route.path;return t.pathname!==e.pathname||r!=null&&r.endsWith("*")&&t.params["*"]!==e.params["*"]}function Zf(t,e){if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate(e);if(typeof r=="boolean")return r}return e.defaultShouldRevalidate}function Jf(t,e,r,n,a){let o;if(t){let l=n[t];xe(l,`No route found to patch children into: routeId = ${t}`),l.children||(l.children=[]),o=l.children}else o=r;let i=e.filter(l=>!o.some(c=>Kf(l,c))),s=Ri(i,a,[t||"_","patch",String((o==null?void 0:o.length)||"0")],n);o.push(...s)}function Kf(t,e){return"id"in t&&"id"in e&&t.id===e.id?!0:t.index===e.index&&t.path===e.path&&t.caseSensitive===e.caseSensitive?(!t.children||t.children.length===0)&&(!e.children||e.children.length===0)?!0:t.children.every((r,n)=>{var a;return(a=e.children)==null?void 0:a.some(o=>Kf(r,o))}):!1}async function RE(t,e,r){if(!t.lazy)return;let n=await t.lazy();if(!t.lazy)return;let a=r[t.id];xe(a,"No route found in manifest");let o={};for(let i in n){let s=a[i]!==void 0&&i!=="hasErrorBoundary";rt(!s,`Route "${a.id}" has a static property "${i}" defined but its lazy function is also returning a value for this property. The lazy route property "${i}" will be ignored.`),!s&&!eE.has(i)&&(o[i]=n[i])}Object.assign(a,o),Object.assign(a,{...e(a),lazy:void 0})}async function OE({matches:t}){let e=t.filter(r=>r.shouldLoad);return(await Promise.all(e.map(r=>r.resolve()))).reduce((r,n,a)=>Object.assign(r,{[e[a].route.id]:n}),{})}async function NE(t,e,r,n,a,o,i,s,l,c){let d=o.map(p=>p.route.lazy?RE(p.route,l,s):void 0),u=o.map((p,f)=>{let g=d[f],m=a.some(_=>_.route.id===p.route.id);return{...p,shouldLoad:m,resolve:async _=>(_&&n.method==="GET"&&(p.route.lazy||p.route.loader)&&(m=!0),m?IE(e,n,p,g,_,c):Promise.resolve({type:"data",result:void 0}))}}),h=await t({matches:u,request:n,params:o[0].params,fetcherKey:i,context:c});try{await Promise.all(d)}catch{}return h}async function IE(t,e,r,n,a,o){let i,s,l=c=>{let d,u=new Promise((f,g)=>d=g);s=()=>d(),e.signal.addEventListener("abort",s);let h=f=>typeof c!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${t}" [routeId: ${r.route.id}]`)):c({request:e,params:r.params,context:o},...f!==void 0?[f]:[]),p=(async()=>{try{return{type:"data",result:await(a?a(f=>h(f)):h())}}catch(f){return{type:"error",result:f}}})();return Promise.race([p,u])};try{let c=r.route[t];if(n)if(c){let d,[u]=await Promise.all([l(c).catch(h=>{d=h}),n]);if(d!==void 0)throw d;i=u}else if(await n,c=r.route[t],c)i=await l(c);else if(t==="action"){let d=new URL(e.url),u=d.pathname+d.search;throw Nt(405,{method:e.method,pathname:u,routeId:r.route.id})}else return{type:"data",result:void 0};else if(c)i=await l(c);else{let d=new URL(e.url),u=d.pathname+d.search;throw Nt(404,{pathname:u})}}catch(c){return{type:"error",result:c}}finally{s&&e.signal.removeEventListener("abort",s)}return i}async function PE(t){var n,a,o,i;let{result:e,type:r}=t;if(om(e)){let s;try{let l=e.headers.get("Content-Type");l&&/\bapplication\/json\b/.test(l)?e.body==null?s=null:s=await e.json():s=await e.text()}catch(l){return{type:"error",error:l}}return r==="error"?{type:"error",error:new Ci(e.status,e.statusText,s),statusCode:e.status,headers:e.headers}:{type:"data",data:s,statusCode:e.status,headers:e.headers}}if(r==="error"){if(am(e)){if(e.data instanceof Error)return{type:"error",error:e.data,statusCode:(n=e.init)==null?void 0:n.status};e=new Ci(((a=e.init)==null?void 0:a.status)||500,void 0,e.data)}return{type:"error",error:e,statusCode:ji(e)?e.status:void 0}}return am(e)?{type:"data",data:e.data,statusCode:(o=e.init)==null?void 0:o.status,headers:(i=e.init)!=null&&i.headers?new Headers(e.init.headers):void 0}:{type:"data",data:e}}function CE(t,e,r,n,a){let o=t.headers.get("Location");if(xe(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!Ac.test(o)){let i=n.slice(0,n.findIndex(s=>s.route.id===r)+1);o=Tc(new URL(e.url),i,a,o),t.headers.set("Location",o)}return t}function Yf(t,e,r){if(Ac.test(t)){let n=t,a=n.startsWith("//")?new URL(e.protocol+n):new URL(n),o=qt(a.pathname,r)!=null;if(a.origin===e.origin&&o)return a.pathname+a.search+a.hash}return t}function na(t,e,r,n){let a=t.createURL(nm(e)).toString(),o={signal:r};if(n&&Vt(n.formMethod)){let{formMethod:i,formEncType:s}=n;o.method=i.toUpperCase(),s==="application/json"?(o.headers=new Headers({"Content-Type":s}),o.body=JSON.stringify(n.json)):s==="text/plain"?o.body=n.text:s==="application/x-www-form-urlencoded"&&n.formData?o.body=Fc(n.formData):o.body=n.formData}return new Request(a,o)}function Fc(t){let e=new URLSearchParams;for(let[r,n]of t.entries())e.append(r,typeof n=="string"?n:n.name);return e}function Xf(t){let e=new FormData;for(let[r,n]of t.entries())e.append(r,n);return e}function jE(t,e,r,n=!1,a=!1){let o={},i=null,s,l=!1,c={},d=r&&xt(r[1])?r[1].error:void 0;return t.forEach(u=>{if(!(u.route.id in e))return;let h=u.route.id,p=e[h];if(xe(!kn(p),"Cannot handle redirect results in processLoaderData"),xt(p)){let f=p.error;if(d!==void 0&&(f=d,d=void 0),i=i||{},a)i[h]=f;else{let g=xn(t,h);i[g.route.id]==null&&(i[g.route.id]=f)}n||(o[h]=Hf),l||(l=!0,s=ji(p.error)?p.error.status:500),p.headers&&(c[h]=p.headers)}else o[h]=p.data,p.statusCode&&p.statusCode!==200&&!l&&(s=p.statusCode),p.headers&&(c[h]=p.headers)}),d!==void 0&&r&&(i={[r[0]]:d},o[r[0]]=void 0),{loaderData:o,errors:i,statusCode:s||200,loaderHeaders:c}}function Qf(t,e,r,n,a,o){let{loaderData:i,errors:s}=jE(e,r,n);return a.forEach(l=>{let{key:c,match:d,controller:u}=l,h=o[c];if(xe(h,"Did not find corresponding fetcher result"),!(u&&u.signal.aborted))if(xt(h)){let p=xn(t.matches,d==null?void 0:d.route.id);s&&s[p.route.id]||(s={...s,[p.route.id]:h.error}),t.fetchers.delete(c)}else if(kn(h))xe(!1,"Unhandled fetcher revalidation redirect");else{let p=Gr(h.data);t.fetchers.set(c,p)}}),{loaderData:i,errors:s}}function em(t,e,r,n){let a=Object.entries(e).filter(([,o])=>o!==Hf).reduce((o,[i,s])=>(o[i]=s,o),{});for(let o of r){let i=o.route.id;if(!e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&o.route.loader&&(a[i]=t[i]),n&&n.hasOwnProperty(i))break}return a}function tm(t){return t?xt(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function xn(t,e){return(e?t.slice(0,t.findIndex(r=>r.route.id===e)+1):[...t]).reverse().find(r=>r.route.hasErrorBoundary===!0)||t[0]}function rm(t){let e=t.length===1?t[0]:t.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Nt(t,{pathname:e,routeId:r,method:n,type:a,message:o}={}){let i="Unknown Server Error",s="Unknown @remix-run/router error";return t===400?(i="Bad Request",n&&e&&r?s=`You made a ${n} request to "${e}" but did not provide a \`loader\` for route "${r}", so there is no way to handle the request.`:a==="invalid-body"&&(s="Unable to encode submission body")):t===403?(i="Forbidden",s=`Route "${r}" does not match URL "${e}"`):t===404?(i="Not Found",s=`No route matches URL "${e}"`):t===405&&(i="Method Not Allowed",n&&e&&r?s=`You made a ${n.toUpperCase()} request to "${e}" but did not provide an \`action\` for route "${r}", so there is no way to handle the request.`:n&&(s=`Invalid request method "${n.toUpperCase()}"`)),new Ci(t||500,i,new Error(s),!0)}function Li(t){let e=Object.entries(t);for(let r=e.length-1;r>=0;r--){let[n,a]=e[r];if(kn(a))return{key:n,result:a}}}function nm(t){let e=typeof t=="string"?Tr(t):t;return Ar({...e,hash:""})}function LE(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function DE(t){return om(t.result)&&SE.has(t.result.status)}function xt(t){return t.type==="error"}function kn(t){return(t&&t.type)==="redirect"}function am(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function om(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function $E(t){return EE.has(t.toUpperCase())}function Vt(t){return wE.has(t.toUpperCase())}function Rc(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function fo(t,e){let r=typeof e=="string"?Tr(e).search:e.search;if(t[t.length-1].route.index&&Rc(r||""))return t[t.length-1];let n=zf(t);return n[n.length-1]}function im(t){let{formMethod:e,formAction:r,formEncType:n,text:a,formData:o,json:i}=t;if(!(!e||!r||!n)){if(a!=null)return{formMethod:e,formAction:r,formEncType:n,formData:void 0,json:void 0,text:a};if(o!=null)return{formMethod:e,formAction:r,formEncType:n,formData:o,json:void 0,text:void 0};if(i!==void 0)return{formMethod:e,formAction:r,formEncType:n,formData:void 0,json:i,text:void 0}}}function Oc(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function zE(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function mo(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function UE(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function Gr(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function BE(t,e){try{let r=t.sessionStorage.getItem(Bf);if(r){let n=JSON.parse(r);for(let[a,o]of Object.entries(n||{}))o&&Array.isArray(o)&&e.set(a,new Set(o||[]))}}catch{}}function HE(t,e){if(e.size>0){let r={};for(let[n,a]of e)r[n]=[...a];try{t.sessionStorage.setItem(Bf,JSON.stringify(r))}catch(n){rt(!1,`Failed to save applied view transitions in sessionStorage (${n}).`)}}}function WE(){let t,e,r=new Promise((n,a)=>{t=async o=>{n(o);try{await r}catch{}},e=async o=>{a(o);try{await r}catch{}}});return{promise:r,resolve:t,reject:e}}var An=y.createContext(null);An.displayName="DataRouter";var go=y.createContext(null);go.displayName="DataRouterState";var Nc=y.createContext({isTransitioning:!1});Nc.displayName="ViewTransition";var sm=y.createContext(new Map);sm.displayName="Fetchers";var GE=y.createContext(null);GE.displayName="Await";var Zt=y.createContext(null);Zt.displayName="Navigation";var Di=y.createContext(null);Di.displayName="Location";var It=y.createContext({outlet:null,matches:[],isDataRoute:!1});It.displayName="Route";var Ic=y.createContext(null);Ic.displayName="RouteError";function qE(t,{relative:e}={}){xe(aa(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:n}=y.useContext(Zt),{hash:a,pathname:o,search:i}=yo(t,{relative:e}),s=o;return r!=="/"&&(s=o==="/"?r:pr([r,o])),n.createHref({pathname:s,search:i,hash:a})}function aa(){return y.useContext(Di)!=null}function fr(){return xe(aa(),"useLocation() may be used only in the context of a <Router> component."),y.useContext(Di).location}var lm="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function cm(t){y.useContext(Zt).static||y.useLayoutEffect(t)}Kn=function(){let{isDataRoute:t}=y.useContext(It);return t?iS():VE()};function VE(){xe(aa(),"useNavigate() may be used only in the context of a <Router> component.");let t=y.useContext(An),{basename:e,navigator:r}=y.useContext(Zt),{matches:n}=y.useContext(It),{pathname:a}=fr(),o=JSON.stringify(Ii(n)),i=y.useRef(!1);return cm(()=>{i.current=!0}),y.useCallback((s,l={})=>{if(rt(i.current,lm),!i.current)return;if(typeof s=="number"){r.go(s);return}let c=Pi(s,JSON.parse(o),a,l.relative==="path");t==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:pr([e,c.pathname])),(l.replace?r.replace:r.push)(c,l.state,l)},[e,r,o,a,t])}var ZE=y.createContext(null);function JE(t){let e=y.useContext(It).outlet;return e&&y.createElement(ZE.Provider,{value:t},e)}function dm(){let{matches:t}=y.useContext(It),e=t[t.length-1];return e?e.params:{}}function yo(t,{relative:e}={}){let{matches:r}=y.useContext(It),{pathname:n}=fr(),a=JSON.stringify(Ii(r));return y.useMemo(()=>Pi(t,JSON.parse(a),n,e==="path"),[t,a,n,e])}function KE(t,e,r,n){xe(aa(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=y.useContext(Zt),{matches:o}=y.useContext(It),i=o[o.length-1],s=i?i.params:{},l=i?i.pathname:"/",c=i?i.pathnameBase:"/",d=i&&i.route;{let m=d&&d.path||"";pm(l,!d||m.endsWith("*")||m.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${m}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${m}"> to <Route path="${m==="/"?"*":`${m}/*`}">.`)}let u=fr(),h;h=u;let p=h.pathname||"/",f=p;if(c!=="/"){let m=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(m.length).join("/")}let g=Wr(t,{pathname:f});return rt(d||g!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),rt(g==null||g[g.length-1].route.element!==void 0||g[g.length-1].route.Component!==void 0||g[g.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),tS(g&&g.map(m=>Object.assign({},m,{params:Object.assign({},s,m.params),pathname:pr([c,a.encodeLocation?a.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?c:pr([c,a.encodeLocation?a.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),o,r,n)}function YE(){let t=um(),e=ji(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:n},o={padding:"2px 4px",backgroundColor:n},i=null;return console.error("Error handled by React Router default ErrorBoundary:",t),i=y.createElement(y.Fragment,null,y.createElement("p",null,"\u{1F4BF} Hey developer \u{1F44B}"),y.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",y.createElement("code",{style:o},"ErrorBoundary")," or"," ",y.createElement("code",{style:o},"errorElement")," prop on your route.")),y.createElement(y.Fragment,null,y.createElement("h2",null,"Unexpected Application Error!"),y.createElement("h3",{style:{fontStyle:"italic"}},e),r?y.createElement("pre",{style:a},r):null,i)}var XE=y.createElement(YE,null),QE=class extends y.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?y.createElement(It.Provider,{value:this.props.routeContext},y.createElement(Ic.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function eS({routeContext:t,match:e,children:r}){let n=y.useContext(An);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),y.createElement(It.Provider,{value:t},r)}function tS(t,e=[],r=null,n=null){if(t==null){if(!r)return null;if(r.errors)t=r.matches;else if(e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let a=t,o=r==null?void 0:r.errors;if(o!=null){let l=a.findIndex(c=>c.route.id&&(o==null?void 0:o[c.route.id])!==void 0);xe(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),a=a.slice(0,Math.min(a.length,l+1))}let i=!1,s=-1;if(r)for(let l=0;l<a.length;l++){let c=a[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(s=l),c.route.id){let{loaderData:d,errors:u}=r,h=c.route.loader&&!d.hasOwnProperty(c.route.id)&&(!u||u[c.route.id]===void 0);if(c.route.lazy||h){i=!0,s>=0?a=a.slice(0,s+1):a=[a[0]];break}}}return a.reduceRight((l,c,d)=>{let u,h=!1,p=null,f=null;r&&(u=o&&c.route.id?o[c.route.id]:void 0,p=c.route.errorElement||XE,i&&(s<0&&d===0?(pm("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,f=null):s===d&&(h=!0,f=c.route.hydrateFallbackElement||null)));let g=e.concat(a.slice(0,d+1)),m=()=>{let _;return u?_=p:h?_=f:c.route.Component?_=y.createElement(c.route.Component,null):c.route.element?_=c.route.element:_=l,y.createElement(eS,{match:c,routeContext:{outlet:l,matches:g,isDataRoute:r!=null},children:_})};return r&&(c.route.ErrorBoundary||c.route.errorElement||d===0)?y.createElement(QE,{location:r.location,revalidation:r.revalidation,component:p,error:u,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):m()},null)}function Pc(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rS(t){let e=y.useContext(An);return xe(e,Pc(t)),e}function nS(t){let e=y.useContext(go);return xe(e,Pc(t)),e}function aS(t){let e=y.useContext(It);return xe(e,Pc(t)),e}function Cc(t){let e=aS(t),r=e.matches[e.matches.length-1];return xe(r.route.id,`${t} can only be used on routes that contain a unique "id"`),r.route.id}function oS(){return Cc("useRouteId")}function um(){var n;let t=y.useContext(Ic),e=nS("useRouteError"),r=Cc("useRouteError");return t!==void 0?t:(n=e.errors)==null?void 0:n[r]}function iS(){let{router:t}=rS("useNavigate"),e=Cc("useNavigate"),r=y.useRef(!1);return cm(()=>{r.current=!0}),y.useCallback(async(n,a={})=>{rt(r.current,lm),r.current&&(typeof n=="number"?t.navigate(n):await t.navigate(n,{fromRouteId:e,...a}))},[t,e])}var hm={};function pm(t,e,r){!e&&!hm[t]&&(hm[t]=!0,rt(!1,r))}var fm={};function mm(t,e){!t&&!fm[e]&&(fm[e]=!0,console.warn(e))}function gm(t){let e={hasErrorBoundary:t.hasErrorBoundary||t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&(t.element&&rt(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(e,{element:y.createElement(t.Component),Component:void 0})),t.HydrateFallback&&(t.hydrateFallbackElement&&rt(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(e,{hydrateFallbackElement:y.createElement(t.HydrateFallback),HydrateFallback:void 0})),t.ErrorBoundary&&(t.errorElement&&rt(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(e,{errorElement:y.createElement(t.ErrorBoundary),ErrorBoundary:void 0})),e}var sS=class{constructor(){this.status="pending",this.promise=new Promise((t,e)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",t(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",e(r))}})}};function lS({router:t,flushSync:e}){let[r,n]=y.useState(t.state),[a,o]=y.useState(),[i,s]=y.useState({isTransitioning:!1}),[l,c]=y.useState(),[d,u]=y.useState(),[h,p]=y.useState(),f=y.useRef(new Map),g=y.useCallback((A,{deletedFetchers:F,flushSync:b,viewTransitionOpts:D})=>{F.forEach(j=>f.current.delete(j)),A.fetchers.forEach((j,G)=>{j.data!==void 0&&f.current.set(G,j.data)}),mm(b===!1||e!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let B=t.window!=null&&t.window.document!=null&&typeof t.window.document.startViewTransition=="function";if(mm(D==null||B,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!D||!B){e&&b?e(()=>n(A)):y.startTransition(()=>n(A));return}if(e&&b){e(()=>{d&&(l&&l.resolve(),d.skipTransition()),s({isTransitioning:!0,flushSync:!0,currentLocation:D.currentLocation,nextLocation:D.nextLocation})});let j=t.window.document.startViewTransition(()=>{e(()=>n(A))});j.finished.finally(()=>{e(()=>{c(void 0),u(void 0),o(void 0),s({isTransitioning:!1})})}),e(()=>u(j));return}d?(l&&l.resolve(),d.skipTransition(),p({state:A,currentLocation:D.currentLocation,nextLocation:D.nextLocation})):(o(A),s({isTransitioning:!0,flushSync:!1,currentLocation:D.currentLocation,nextLocation:D.nextLocation}))},[t.window,e,d,l]);y.useLayoutEffect(()=>t.subscribe(g),[t,g]),y.useEffect(()=>{i.isTransitioning&&!i.flushSync&&c(new sS)},[i]),y.useEffect(()=>{if(l&&a&&t.window){let A=a,F=l.promise,b=t.window.document.startViewTransition(async()=>{y.startTransition(()=>n(A)),await F});b.finished.finally(()=>{c(void 0),u(void 0),o(void 0),s({isTransitioning:!1})}),u(b)}},[a,l,t.window]),y.useEffect(()=>{l&&a&&r.location.key===a.location.key&&l.resolve()},[l,d,r.location,a]),y.useEffect(()=>{!i.isTransitioning&&h&&(o(h.state),s({isTransitioning:!0,flushSync:!1,currentLocation:h.currentLocation,nextLocation:h.nextLocation}),p(void 0))},[i.isTransitioning,h]);let m=y.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:A=>t.navigate(A),push:(A,F,b)=>t.navigate(A,{state:F,preventScrollReset:b==null?void 0:b.preventScrollReset}),replace:(A,F,b)=>t.navigate(A,{replace:!0,state:F,preventScrollReset:b==null?void 0:b.preventScrollReset})}),[t]),_=t.basename||"/",v=y.useMemo(()=>({router:t,navigator:m,static:!1,basename:_}),[t,m,_]);return y.createElement(y.Fragment,null,y.createElement(An.Provider,{value:v},y.createElement(go.Provider,{value:r},y.createElement(sm.Provider,{value:f.current},y.createElement(Nc.Provider,{value:i},y.createElement(pS,{basename:_,location:r.location,navigationType:r.historyAction,navigator:m},y.createElement(cS,{routes:t.routes,future:t.future,state:r})))))),null)}var cS=y.memo(dS);function dS({routes:t,future:e,state:r}){return KE(t,void 0,r,e)}function uS({to:t,replace:e,state:r,relative:n}){xe(aa(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=y.useContext(Zt);rt(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=y.useContext(It),{pathname:i}=fr(),s=Kn(),l=Pi(t,Ii(o),i,n==="path"),c=JSON.stringify(l);return y.useEffect(()=>{s(JSON.parse(c),{replace:e,state:r,relative:n})},[s,c,n,e,r]),null}function hS(t){return JE(t.context)}function Mr(t){xe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function pS({basename:t="/",children:e=null,location:r,navigationType:n="POP",navigator:a,static:o=!1}){xe(!aa(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let i=t.replace(/^\/*/,"/"),s=y.useMemo(()=>({basename:i,navigator:a,static:o,future:{}}),[i,a,o]);typeof r=="string"&&(r=Tr(r));let{pathname:l="/",search:c="",hash:d="",state:u=null,key:h="default"}=r,p=y.useMemo(()=>{let f=qt(l,i);return f==null?null:{location:{pathname:f,search:c,hash:d,state:u,key:h},navigationType:n}},[i,l,c,d,u,h,n]);return rt(p!=null,`<Router basename="${i}"> is not able to match the URL "${l}${c}${d}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:y.createElement(Zt.Provider,{value:s},y.createElement(Di.Provider,{children:e,value:p}))}function jc(t,e=[]){let r=[];return y.Children.forEach(t,(n,a)=>{if(!y.isValidElement(n))return;let o=[...e,a];if(n.type===y.Fragment){r.push.apply(r,jc(n.props.children,o));return}xe(n.type===Mr,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),xe(!n.props.index||!n.props.children,"An index route cannot have child routes.");let i={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=jc(n.props.children,o)),r.push(i)}),r}var fS=jc,$i="get",zi="application/x-www-form-urlencoded";function Ui(t){return t!=null&&typeof t.tagName=="string"}function mS(t){return Ui(t)&&t.tagName.toLowerCase()==="button"}function gS(t){return Ui(t)&&t.tagName.toLowerCase()==="form"}function yS(t){return Ui(t)&&t.tagName.toLowerCase()==="input"}function _S(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function vS(t,e){return t.button===0&&(!e||e==="_self")&&!_S(t)}var Bi=null;function wS(){if(Bi===null)try{new FormData(document.createElement("form"),0),Bi=!1}catch{Bi=!0}return Bi}var bS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Lc(t){return t!=null&&!bS.has(t)?(rt(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${zi}"`),null):t}function ES(t,e){let r,n,a,o,i;if(gS(t)){let s=t.getAttribute("action");n=s?qt(s,e):null,r=t.getAttribute("method")||$i,a=Lc(t.getAttribute("enctype"))||zi,o=new FormData(t)}else if(mS(t)||yS(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||s.getAttribute("action");if(n=l?qt(l,e):null,r=t.getAttribute("formmethod")||s.getAttribute("method")||$i,a=Lc(t.getAttribute("formenctype"))||Lc(s.getAttribute("enctype"))||zi,o=new FormData(s,t),!wS()){let{name:c,type:d,value:u}=t;if(d==="image"){let h=c?`${c}.`:"";o.append(`${h}x`,"0"),o.append(`${h}y`,"0")}else c&&o.append(c,u)}}else{if(Ui(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=$i,n=null,a=zi,i=t}return o&&a==="text/plain"&&(i=o,o=void 0),{action:n,method:r.toLowerCase(),encType:a,formData:o,body:i}}function Dc(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function SS(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module).then(async n=>(await n.__tla,n));return e[t.id]=r,r}catch(r){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function xS(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function kS(t,e,r){let n=await Promise.all(t.map(async a=>{let o=e.routes[a.route.id];if(o){let i=await SS(o,r);return i.links?i.links():[]}return[]}));return FS(n.flat(1).filter(xS).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function ym(t,e,r,n,a,o){let i=(l,c)=>r[c]?l.route.id!==r[c].route.id:!0,s=(l,c)=>{var d;return r[c].pathname!==l.pathname||((d=r[c].route.path)==null?void 0:d.endsWith("*"))&&r[c].params["*"]!==l.params["*"]};return o==="assets"?e.filter((l,c)=>i(l,c)||s(l,c)):o==="data"?e.filter((l,c)=>{var u;let d=n.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(i(l,c)||s(l,c))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((u=r[0])==null?void 0:u.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function AS(t,e){return TS(t.map(r=>{let n=e.routes[r.route.id];if(!n)return[];let a=[n.module];return n.imports&&(a=a.concat(n.imports)),a}).flat(1))}function TS(t){return[...new Set(t)]}function MS(t){let e={},r=Object.keys(t).sort();for(let n of r)e[n]=t[n];return e}function FS(t,e){let r=new Set;return new Set(e),t.reduce((n,a)=>{let o=JSON.stringify(MS(a));return r.has(o)||(r.add(o),n.push({key:o,link:a})),n},[])}function RS(t){let e=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function OS(){let t=y.useContext(An);return Dc(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function NS(){let t=y.useContext(go);return Dc(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var $c=y.createContext(void 0);$c.displayName="FrameworkContext";function _m(){let t=y.useContext($c);return Dc(t,"You must render this element inside a <HydratedRouter> element"),t}function IS(t,e){let r=y.useContext($c),[n,a]=y.useState(!1),[o,i]=y.useState(!1),{onFocus:s,onBlur:l,onMouseEnter:c,onMouseLeave:d,onTouchStart:u}=e,h=y.useRef(null);y.useEffect(()=>{if(t==="render"&&i(!0),t==="viewport"){let g=_=>{_.forEach(v=>{i(v.isIntersecting)})},m=new IntersectionObserver(g,{threshold:.5});return h.current&&m.observe(h.current),()=>{m.disconnect()}}},[t]),y.useEffect(()=>{if(n){let g=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(g)}}},[n]);let p=()=>{a(!0)},f=()=>{a(!1),i(!1)};return r?t!=="intent"?[o,h,{}]:[o,h,{onFocus:_o(s,p),onBlur:_o(l,f),onMouseEnter:_o(c,p),onMouseLeave:_o(d,f),onTouchStart:_o(u,p)}]:[!1,h,{}]}function _o(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function PS({page:t,...e}){let{router:r}=OS(),n=y.useMemo(()=>Wr(r.routes,t,r.basename),[r.routes,t,r.basename]);return n?y.createElement(jS,{page:t,matches:n,...e}):(console.warn(`Tried to prefetch ${t} but no routes matched.`),null)}function CS(t){let{manifest:e,routeModules:r}=_m(),[n,a]=y.useState([]);return y.useEffect(()=>{let o=!1;return kS(t,e,r).then(i=>{o||a(i)}),()=>{o=!0}},[t,e,r]),n}function jS({page:t,matches:e,...r}){let n=fr(),{manifest:a,routeModules:o}=_m(),{loaderData:i,matches:s}=NS(),l=y.useMemo(()=>ym(t,e,s,a,n,"data"),[t,e,s,a,n]),c=y.useMemo(()=>ym(t,e,s,a,n,"assets"),[t,e,s,a,n]),d=y.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let p=new Set,f=!1;if(e.forEach(m=>{var v;let _=a.routes[m.route.id];!_||!_.hasLoader||(!l.some(A=>A.route.id===m.route.id)&&m.route.id in i&&((v=o[m.route.id])!=null&&v.shouldRevalidate)||_.hasClientLoader?f=!0:p.add(m.route.id))}),p.size===0)return[];let g=RS(t);return f&&p.size>0&&g.searchParams.set("_routes",e.filter(m=>p.has(m.route.id)).map(m=>m.route.id).join(",")),[g.pathname+g.search]},[i,n,a,l,e,t,o]),u=y.useMemo(()=>AS(c,a),[c,a]),h=CS(c);return y.createElement(y.Fragment,null,d.map(p=>y.createElement("link",{key:p,rel:"prefetch",as:"fetch",href:p,...r})),u.map(p=>y.createElement("link",{key:p,rel:"modulepreload",href:p,...r})),h.map(({key:p,link:f})=>y.createElement("link",{key:p,...f})))}function LS(...t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}var vm=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{vm&&(window.__reactRouterVersion="7.0.2")}catch{}function wm(t,e){return Wf({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:Y0({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||bm(),routes:t,mapRouteProperties:gm,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function DS(t,e){return Wf({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:X0({window:e==null?void 0:e.window}),hydrationData:bm(),routes:t,mapRouteProperties:gm,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function bm(){let t=window==null?void 0:window.__staticRouterHydrationData;return t&&t.errors&&(t={...t,errors:$S(t.errors)}),t}function $S(t){if(!t)return null;let e=Object.entries(t),r={};for(let[n,a]of e)if(a&&a.__type==="RouteErrorResponse")r[n]=new Ci(a.status,a.statusText,a.data,a.internal===!0);else if(a&&a.__type==="Error"){if(a.__subType){let o=window[a.__subType];if(typeof o=="function")try{let i=new o(a.message);i.stack="",r[n]=i}catch{}}if(r[n]==null){let o=new Error(a.message);o.stack="",r[n]=o}}else r[n]=a;return r}var Em=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zc=y.forwardRef(function({onClick:t,discover:e="render",prefetch:r="none",relative:n,reloadDocument:a,replace:o,state:i,target:s,to:l,preventScrollReset:c,viewTransition:d,...u},h){let{basename:p}=y.useContext(Zt),f=typeof l=="string"&&Em.test(l),g,m=!1;if(typeof l=="string"&&f&&(g=l,vm))try{let j=new URL(window.location.href),G=l.startsWith("//")?new URL(j.protocol+l):new URL(l),te=qt(G.pathname,p);G.origin===j.origin&&te!=null?l=te+G.search+G.hash:m=!0}catch{rt(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let _=qE(l,{relative:n}),[v,A,F]=IS(r,u),b=HS(l,{replace:o,state:i,target:s,preventScrollReset:c,relative:n,viewTransition:d});function D(j){t&&t(j),j.defaultPrevented||b(j)}let B=y.createElement("a",{...u,...F,href:g||_,onClick:m||a?t:D,ref:LS(h,A),target:s,"data-discover":!f&&e==="render"?"true":void 0});return v&&!f?y.createElement(y.Fragment,null,B,y.createElement(PS,{page:_})):B});zc.displayName="Link";var zS=y.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:r="",end:n=!1,style:a,to:o,viewTransition:i,children:s,...l},c){let d=yo(o,{relative:l.relative}),u=fr(),h=y.useContext(go),{navigator:p,basename:f}=y.useContext(Zt),g=h!=null&&ZS(d)&&i===!0,m=p.encodeLocation?p.encodeLocation(d).pathname:d.pathname,_=u.pathname,v=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;e||(_=_.toLowerCase(),v=v?v.toLowerCase():null,m=m.toLowerCase()),v&&f&&(v=qt(v,f)||v);const A=m!=="/"&&m.endsWith("/")?m.length-1:m.length;let F=_===m||!n&&_.startsWith(m)&&_.charAt(A)==="/",b=v!=null&&(v===m||!n&&v.startsWith(m)&&v.charAt(m.length)==="/"),D={isActive:F,isPending:b,isTransitioning:g},B=F?t:void 0,j;typeof r=="function"?j=r(D):j=[r,F?"active":null,b?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let G=typeof a=="function"?a(D):a;return y.createElement(zc,{...l,"aria-current":B,className:j,ref:c,style:G,to:o,viewTransition:i},typeof s=="function"?s(D):s)});zS.displayName="NavLink";var US=y.forwardRef(({discover:t="render",fetcherKey:e,navigate:r,reloadDocument:n,replace:a,state:o,method:i=$i,action:s,onSubmit:l,relative:c,preventScrollReset:d,viewTransition:u,...h},p)=>{let f=qS(),g=VS(s,{relative:c}),m=i.toLowerCase()==="get"?"get":"post",_=typeof s=="string"&&Em.test(s),v=A=>{if(l&&l(A),A.defaultPrevented)return;A.preventDefault();let F=A.nativeEvent.submitter,b=(F==null?void 0:F.getAttribute("formmethod"))||i;f(F||A.currentTarget,{fetcherKey:e,method:b,navigate:r,replace:a,state:o,relative:c,preventScrollReset:d,viewTransition:u})};return y.createElement("form",{ref:p,method:m,action:g,onSubmit:n?l:v,...h,"data-discover":!_&&t==="render"?"true":void 0})});US.displayName="Form";function BS(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Sm(t){let e=y.useContext(An);return xe(e,BS(t)),e}function HS(t,{target:e,replace:r,state:n,preventScrollReset:a,relative:o,viewTransition:i}={}){let s=Kn(),l=fr(),c=yo(t,{relative:o});return y.useCallback(d=>{if(vS(d,e)){d.preventDefault();let u=r!==void 0?r:Ar(l)===Ar(c);s(t,{replace:u,state:n,preventScrollReset:a,relative:o,viewTransition:i})}},[l,s,c,r,n,e,t,a,o,i])}var WS=0,GS=()=>`__${String(++WS)}__`;function qS(){let{router:t}=Sm("useSubmit"),{basename:e}=y.useContext(Zt),r=oS();return y.useCallback(async(n,a={})=>{let{action:o,method:i,encType:s,formData:l,body:c}=ES(n,e);if(a.navigate===!1){let d=a.fetcherKey||GS();await t.fetch(d,r,a.action||o,{preventScrollReset:a.preventScrollReset,formData:l,body:c,formMethod:a.method||i,formEncType:a.encType||s,flushSync:a.flushSync})}else await t.navigate(a.action||o,{preventScrollReset:a.preventScrollReset,formData:l,body:c,formMethod:a.method||i,formEncType:a.encType||s,replace:a.replace,state:a.state,fromRouteId:r,flushSync:a.flushSync,viewTransition:a.viewTransition})},[t,e,r])}function VS(t,{relative:e}={}){let{basename:r}=y.useContext(Zt),n=y.useContext(It);xe(n,"useFormAction must be used inside a RouteContext");let[a]=n.matches.slice(-1),o={...yo(t||".",{relative:e})},i=fr();if(t==null){o.search=i.search;let s=new URLSearchParams(o.search),l=s.getAll("index");if(l.some(c=>c==="")){s.delete("index"),l.filter(d=>d).forEach(d=>s.append("index",d));let c=s.toString();o.search=c?`?${c}`:""}}return(!t||t===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(o.pathname=o.pathname==="/"?r:pr([r,o.pathname])),Ar(o)}function ZS(t,e={}){let r=y.useContext(Nc);xe(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Sm("useViewTransitionState"),a=yo(t,{relative:e.relative});if(!r.isTransitioning)return!1;let o=qt(r.currentLocation.pathname,n)||r.currentLocation.pathname,i=qt(r.nextLocation.pathname,n)||r.nextLocation.pathname;return Ni(a.pathname,i)!=null||Ni(a.pathname,o)!=null}new TextEncoder;function JS(t){return y.createElement(lS,{flushSync:u0.flushSync,...t})}var KS=BN.useId||(()=>{}),YS=0;Ht=function(t){const[e,r]=y.useState(KS());return pi(()=>{t||r(n=>n??String(YS++))},[t]),t||(e?`radix-${e}`:"")};let Hi,xm,km,Wi,Uc;Hi="Collapsible",[xm,b0]=fi(Hi),[km,Wi]=xm(Hi),Uc=y.forwardRef((t,e)=>{const{__scopeCollapsible:r,open:n,defaultOpen:a,disabled:o,onOpenChange:i,...s}=t,[l=!1,c]=Za({prop:n,defaultProp:a,onChange:i});return w.jsx(km,{scope:r,disabled:o,contentId:Ht(),open:l,onOpenToggle:y.useCallback(()=>c(d=>!d),[c]),children:w.jsx(Ve.div,{"data-state":Gc(l),"data-disabled":o?"":void 0,...s,ref:e})})}),Uc.displayName=Hi;var Am="CollapsibleTrigger",Bc=y.forwardRef((t,e)=>{const{__scopeCollapsible:r,...n}=t,a=Wi(Am,r);return w.jsx(Ve.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":Gc(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...n,ref:e,onClick:be(t.onClick,a.onOpenToggle)})});Bc.displayName=Am;var Hc="CollapsibleContent",Wc=y.forwardRef((t,e)=>{const{forceMount:r,...n}=t,a=Wi(Hc,t.__scopeCollapsible);return w.jsx(kr,{present:r||a.open,children:({present:o})=>w.jsx(XS,{...n,ref:e,present:o})})});Wc.displayName=Hc;var XS=y.forwardRef((t,e)=>{const{__scopeCollapsible:r,present:n,children:a,...o}=t,i=Wi(Hc,r),[s,l]=y.useState(n),c=y.useRef(null),d=yt(e,c),u=y.useRef(0),h=u.current,p=y.useRef(0),f=p.current,g=i.open||s,m=y.useRef(g),_=y.useRef();return y.useEffect(()=>{const v=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(v)},[]),pi(()=>{const v=c.current;if(v){_.current=_.current||{transitionDuration:v.style.transitionDuration,animationName:v.style.animationName},v.style.transitionDuration="0s",v.style.animationName="none";const A=v.getBoundingClientRect();u.current=A.height,p.current=A.width,m.current||(v.style.transitionDuration=_.current.transitionDuration,v.style.animationName=_.current.animationName),l(n)}},[i.open,n]),w.jsx(Ve.div,{"data-state":Gc(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!g,...o,ref:d,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...t.style},children:g&&a})});function Gc(t){return t?"open":"closed"}Hp=Uc,E0=Bc,S0=Wc;let Gi;tf=Hp,rf=Bc,nf=Wc,Gi=768;function QS(){const[t,e]=y.useState(void 0);return y.useEffect(()=>{const r=window.matchMedia(`(max-width: ${Gi-1}px)`),n=()=>{e(window.innerWidth<Gi)};return r.addEventListener("change",n),e(window.innerWidth<Gi),()=>r.removeEventListener("change",n)},[]),!!t}Wp=xl("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),zr=y.forwardRef(({className:t,variant:e,size:r,asChild:n=!1,...a},o)=>{const i=n?gn:"button";return w.jsx(i,{className:me(Wp({variant:e,size:r,className:t})),ref:o,...a})}),zr.displayName="Button",_i=y.forwardRef(({className:t,type:e,...r},n)=>w.jsx("input",{type:e,className:me("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...r})),_i.displayName="Input";var ex="Separator",Tm="horizontal",tx=["horizontal","vertical"],Mm=y.forwardRef((t,e)=>{const{decorative:r,orientation:n=Tm,...a}=t,o=rx(n)?n:Tm,i=r?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return w.jsx(Ve.div,{"data-orientation":o,...i,...a,ref:e})});Mm.displayName=ex;function rx(t){return tx.includes(t)}mc=Mm,Ei=y.forwardRef(({className:t,orientation:e="horizontal",decorative:r=!0,...n},a)=>w.jsx(mc,{ref:a,decorative:r,orientation:e,className:me("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n})),Ei.displayName=mc.displayName;let qi,Vi,qc,Fm;qi="focusScope.autoFocusOnMount",Vi="focusScope.autoFocusOnUnmount",qc={bubbles:!1,cancelable:!0},Fm="FocusScope",wi=y.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:a,onUnmountAutoFocus:o,...i}=t,[s,l]=y.useState(null),c=Vn(a),d=Vn(o),u=y.useRef(null),h=yt(e,g=>l(g)),p=y.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;y.useEffect(()=>{if(n){let g=function(A){if(p.paused||!s)return;const F=A.target;s.contains(F)?u.current=F:qr(u.current,{select:!0})},m=function(A){if(p.paused||!s)return;const F=A.relatedTarget;F!==null&&(s.contains(F)||qr(u.current,{select:!0}))},_=function(A){if(document.activeElement===document.body)for(const F of A)F.removedNodes.length>0&&qr(s)};document.addEventListener("focusin",g),document.addEventListener("focusout",m);const v=new MutationObserver(_);return s&&v.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",m),v.disconnect()}}},[n,s,p.paused]),y.useEffect(()=>{if(s){Nm.add(p);const g=document.activeElement;if(!s.contains(g)){const m=new CustomEvent(qi,qc);s.addEventListener(qi,c),s.dispatchEvent(m),m.defaultPrevented||(nx(lx(Rm(s)),{select:!0}),document.activeElement===g&&qr(s))}return()=>{s.removeEventListener(qi,c),setTimeout(()=>{const m=new CustomEvent(Vi,qc);s.addEventListener(Vi,d),s.dispatchEvent(m),m.defaultPrevented||qr(g??document.body,{select:!0}),s.removeEventListener(Vi,d),Nm.remove(p)},0)}}},[s,c,d,p]);const f=y.useCallback(g=>{if(!r&&!n||p.paused)return;const m=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,_=document.activeElement;if(m&&_){const v=g.currentTarget,[A,F]=ax(v);A&&F?!g.shiftKey&&_===F?(g.preventDefault(),r&&qr(A,{select:!0})):g.shiftKey&&_===A&&(g.preventDefault(),r&&qr(F,{select:!0})):_===v&&g.preventDefault()}},[r,n,p.paused]);return w.jsx(Ve.div,{tabIndex:-1,...i,ref:h,onKeyDown:f})}),wi.displayName=Fm;function nx(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(qr(n,{select:e}),document.activeElement!==r)return}function ax(t){const e=Rm(t),r=Om(e,t),n=Om(e.reverse(),t);return[r,n]}function Rm(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function Om(t,e){for(const r of t)if(!ox(r,{upTo:e}))return r}function ox(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function ix(t){return t instanceof HTMLInputElement&&"select"in t}function qr(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&ix(t)&&e&&t.select()}}var Nm=sx();function sx(){let t=[];return{add(e){const r=t[0];e!==r&&(r==null||r.pause()),t=Im(t,e),t.unshift(e)},remove(e){var r;t=Im(t,e),(r=t[0])==null||r.resume()}}}function Im(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function lx(t){return t.filter(e=>e.tagName!=="A")}var Vc=0;Dl=function(){y.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Pm()),document.body.insertAdjacentElement("beforeend",t[1]??Pm()),Vc++,()=>{Vc===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Vc--}},[])};function Pm(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}Bt=function(){return Bt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},Bt.apply(this,arguments)},Il=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(r[n[a]]=t[n[a]]);return r},yp=function(t,e,r){if(r||arguments.length===2)for(var n=0,a=e.length,o;n<a;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))};var Zi="right-scroll-bar-position",Ji="width-before-scroll-bar",cx="with-scroll-bars-hidden",dx="--removed-body-scroll-bar-size";function Zc(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function ux(t,e){var r=y.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var a=r.value;a!==n&&(r.value=n,r.callback(n,a))}}}})[0];return r.callback=e,r.facade}var hx=typeof window<"u"?y.useLayoutEffect:y.useEffect,Cm=new WeakMap;function px(t,e){var r=ux(null,function(n){return t.forEach(function(a){return Zc(a,n)})});return hx(function(){var n=Cm.get(r);if(n){var a=new Set(n),o=new Set(t),i=r.current;a.forEach(function(s){o.has(s)||Zc(s,null)}),o.forEach(function(s){a.has(s)||Zc(s,i)})}Cm.set(r,t)},[t]),r}function fx(t){return t}function mx(t,e){e===void 0&&(e=fx);var r=[],n=!1,a={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(o){var i=e(o,n);return r.push(i),function(){r=r.filter(function(s){return s!==i})}},assignSyncMedium:function(o){for(n=!0;r.length;){var i=r;r=[],i.forEach(o)}r={push:function(s){return o(s)},filter:function(){return r}}},assignMedium:function(o){n=!0;var i=[];if(r.length){var s=r;r=[],s.forEach(o),i=r}var l=function(){var d=i;i=[],d.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(d){i.push(d),c()},filter:function(d){return i=i.filter(d),r}}}};return a}mp=function(t){t===void 0&&(t={});var e=mx(null);return e.options=Bt({async:!0,ssr:!1},t),e};var jm=function(t){var e=t.sideCar,r=Il(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return y.createElement(n,Bt({},r))};jm.isSideCarExport=!0,_p=function(t,e){return t.useMedium(e),jm};var Lm=mp(),Jc=function(){},Ki=y.forwardRef(function(t,e){var r=y.useRef(null),n=y.useState({onScrollCapture:Jc,onWheelCapture:Jc,onTouchMoveCapture:Jc}),a=n[0],o=n[1],i=t.forwardProps,s=t.children,l=t.className,c=t.removeScrollBar,d=t.enabled,u=t.shards,h=t.sideCar,p=t.noIsolation,f=t.inert,g=t.allowPinchZoom,m=t.as,_=m===void 0?"div":m,v=t.gapMode,A=Il(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),F=h,b=px([r,e]),D=Bt(Bt({},A),a);return y.createElement(y.Fragment,null,d&&y.createElement(F,{sideCar:Lm,removeScrollBar:c,shards:u,noIsolation:p,inert:f,setCallbacks:o,allowPinchZoom:!!g,lockRef:r,gapMode:v}),i?y.cloneElement(y.Children.only(s),Bt(Bt({},D),{ref:b})):y.createElement(_,Bt({},D,{className:l,ref:b}),s))});Ki.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Ki.classNames={fullWidth:Ji,zeroRight:Zi},gp=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function gx(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=gp();return e&&t.setAttribute("nonce",e),t}function yx(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function _x(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}let Dm,$m,zm,Yi,Um,Bm,Hm,Tn,Wm,Kc,Gm,qm,Xi;if(Dm=function(){var t=0,e=null;return{add:function(r){t==0&&(e=gx())&&(yx(e,r),_x(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},$m=function(){var t=Dm();return function(e,r){y.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},Pl=function(){var t=$m(),e=function(r){var n=r.styles,a=r.dynamic;return t(n,a),null};return e},zm={left:0,top:0,right:0,gap:0},Yi=function(t){return parseInt(t||"",10)||0},Um=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],a=e[t==="padding"?"paddingRight":"marginRight"];return[Yi(r),Yi(n),Yi(a)]},Bm=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return zm;var e=Um(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},Hm=Pl(),Tn="data-scroll-locked",Wm=function(t,e,r,n){var a=t.left,o=t.top,i=t.right,s=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(cx,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(s,"px ").concat(n,`;
  }
  body[`).concat(Tn,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(s,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Zi,` {
    right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(Ji,` {
    margin-right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(Zi," .").concat(Zi,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Ji," .").concat(Ji,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Tn,`] {
    `).concat(dx,": ").concat(s,`px;
  }
`)},Kc=function(){var t=parseInt(document.body.getAttribute(Tn)||"0",10);return isFinite(t)?t:0},Gm=function(){y.useEffect(function(){return document.body.setAttribute(Tn,(Kc()+1).toString()),function(){var t=Kc()-1;t<=0?document.body.removeAttribute(Tn):document.body.setAttribute(Tn,t.toString())}},[])},qm=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,a=n===void 0?"margin":n;Gm();var o=y.useMemo(function(){return Bm(a)},[a]);return y.createElement(Hm,{styles:Wm(o,!e,a,r?"":"!important")})},Xi=!1,typeof window<"u")try{var Qi=Object.defineProperty({},"passive",{get:function(){return Xi=!0,!0}});window.addEventListener("test",Qi,Qi),window.removeEventListener("test",Qi,Qi)}catch{Xi=!1}var oa=Xi?{passive:!1}:!1,vx=function(t){return t.tagName==="TEXTAREA"},Vm=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!vx(t)&&r[e]==="visible")},wx=function(t){return Vm(t,"overflowY")},bx=function(t){return Vm(t,"overflowX")},Zm=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var a=Jm(t,n);if(a){var o=Km(t,n),i=o[1],s=o[2];if(i>s)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},Ex=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},Sx=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},Jm=function(t,e){return t==="v"?wx(e):bx(e)},Km=function(t,e){return t==="v"?Ex(e):Sx(e)},xx=function(t,e){return t==="h"&&e==="rtl"?-1:1},kx=function(t,e,r,n,a){var o=xx(t,window.getComputedStyle(e).direction),i=o*n,s=r.target,l=e.contains(s),c=!1,d=i>0,u=0,h=0;do{var p=Km(t,s),f=p[0],g=p[1],m=p[2],_=g-m-o*f;(f||_)&&Jm(t,s)&&(u+=_,h+=f),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!l&&s!==document.body||l&&(e.contains(s)||e===s));return(d&&(Math.abs(u)<1||!a)||!d&&(Math.abs(h)<1||!a))&&(c=!0),c},es=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Ym=function(t){return[t.deltaX,t.deltaY]},Xm=function(t){return t&&"current"in t?t.current:t},Ax=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Tx=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Mx=0,ia=[];function Fx(t){var e=y.useRef([]),r=y.useRef([0,0]),n=y.useRef(),a=y.useState(Mx++)[0],o=y.useState(Pl)[0],i=y.useRef(t);y.useEffect(function(){i.current=t},[t]),y.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(a));var g=yp([t.lockRef.current],(t.shards||[]).map(Xm),!0).filter(Boolean);return g.forEach(function(m){return m.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),g.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(a))})}}},[t.inert,t.lockRef.current,t.shards]);var s=y.useCallback(function(g,m){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!i.current.allowPinchZoom;var _=es(g),v=r.current,A="deltaX"in g?g.deltaX:v[0]-_[0],F="deltaY"in g?g.deltaY:v[1]-_[1],b,D=g.target,B=Math.abs(A)>Math.abs(F)?"h":"v";if("touches"in g&&B==="h"&&D.type==="range")return!1;var j=Zm(B,D);if(!j)return!0;if(j?b=B:(b=B==="v"?"h":"v",j=Zm(B,D)),!j)return!1;if(!n.current&&"changedTouches"in g&&(A||F)&&(n.current=b),!b)return!0;var G=n.current||b;return kx(G,m,g,G==="h"?A:F,!0)},[]),l=y.useCallback(function(g){var m=g;if(!(!ia.length||ia[ia.length-1]!==o)){var _="deltaY"in m?Ym(m):es(m),v=e.current.filter(function(b){return b.name===m.type&&(b.target===m.target||m.target===b.shadowParent)&&Ax(b.delta,_)})[0];if(v&&v.should){m.cancelable&&m.preventDefault();return}if(!v){var A=(i.current.shards||[]).map(Xm).filter(Boolean).filter(function(b){return b.contains(m.target)}),F=A.length>0?s(m,A[0]):!i.current.noIsolation;F&&m.cancelable&&m.preventDefault()}}},[]),c=y.useCallback(function(g,m,_,v){var A={name:g,delta:m,target:_,should:v,shadowParent:Rx(_)};e.current.push(A),setTimeout(function(){e.current=e.current.filter(function(F){return F!==A})},1)},[]),d=y.useCallback(function(g){r.current=es(g),n.current=void 0},[]),u=y.useCallback(function(g){c(g.type,Ym(g),g.target,s(g,t.lockRef.current))},[]),h=y.useCallback(function(g){c(g.type,es(g),g.target,s(g,t.lockRef.current))},[]);y.useEffect(function(){return ia.push(o),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",l,oa),document.addEventListener("touchmove",l,oa),document.addEventListener("touchstart",d,oa),function(){ia=ia.filter(function(g){return g!==o}),document.removeEventListener("wheel",l,oa),document.removeEventListener("touchmove",l,oa),document.removeEventListener("touchstart",d,oa)}},[]);var p=t.removeScrollBar,f=t.inert;return y.createElement(y.Fragment,null,f?y.createElement(o,{styles:Tx(a)}):null,p?y.createElement(qm,{gapMode:t.gapMode}):null)}function Rx(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Ox=_p(Lm,Fx);vi=y.forwardRef(function(t,e){return y.createElement(Ki,Bt({},t,{ref:e,sideCar:Ox}))}),vi.classNames=Ki.classNames;let Qm,Mn,vo,wo,ts,Yc,eg,tg,rs,Xc,rg,Pt,Qc;Qm=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Mn=new WeakMap,vo=new WeakMap,wo={},ts=0,Yc=function(t){return t&&(t.host||Yc(t.parentNode))},eg=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=Yc(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},tg=function(t,e,r,n){var a=eg(e,Array.isArray(t)?t:[t]);wo[r]||(wo[r]=new WeakMap);var o=wo[r],i=[],s=new Set,l=new Set(a),c=function(u){!u||s.has(u)||(s.add(u),c(u.parentNode))};a.forEach(c);var d=function(u){!u||l.has(u)||Array.prototype.forEach.call(u.children,function(h){if(s.has(h))d(h);else try{var p=h.getAttribute(n),f=p!==null&&p!=="false",g=(Mn.get(h)||0)+1,m=(o.get(h)||0)+1;Mn.set(h,g),o.set(h,m),i.push(h),g===1&&f&&vo.set(h,!0),m===1&&h.setAttribute(r,"true"),f||h.setAttribute(n,"true")}catch(_){console.error("aria-hidden: cannot operate on ",h,_)}})};return d(e),s.clear(),ts++,function(){i.forEach(function(u){var h=Mn.get(u)-1,p=o.get(u)-1;Mn.set(u,h),o.set(u,p),h||(vo.has(u)||u.removeAttribute(n),vo.delete(u)),p||u.removeAttribute(r)}),ts--,ts||(Mn=new WeakMap,Mn=new WeakMap,vo=new WeakMap,wo={})}},Cl=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),a=Qm(t);return a?(n.push.apply(n,Array.from(a.querySelectorAll("[aria-live]"))),tg(n,a,r,"aria-hidden")):function(){return null}},rs="Dialog",[Xc,U0]=fi(rs),[rg,Pt]=Xc(rs),Qc=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:a,onOpenChange:o,modal:i=!0}=t,s=y.useRef(null),l=y.useRef(null),[c=!1,d]=Za({prop:n,defaultProp:a,onChange:o});return w.jsx(rg,{scope:e,triggerRef:s,contentRef:l,contentId:Ht(),titleId:Ht(),descriptionId:Ht(),open:c,onOpenChange:d,onOpenToggle:y.useCallback(()=>d(u=>!u),[d]),modal:i,children:r})},Qc.displayName=rs;var ng="DialogTrigger",ag=y.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(ng,r),o=yt(e,a.triggerRef);return w.jsx(Ve.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":rd(a.open),...n,ref:o,onClick:be(t.onClick,a.onOpenToggle)})});ag.displayName=ng;var ed="DialogPortal",[Nx,og]=Xc(ed,{forceMount:void 0}),ig=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:a}=t,o=Pt(ed,e);return w.jsx(Nx,{scope:e,forceMount:r,children:y.Children.map(n,i=>w.jsx(kr,{present:r||o.open,children:w.jsx(tp,{asChild:!0,container:a,children:i})}))})};ig.displayName=ed;var ns="DialogOverlay",sg=y.forwardRef((t,e)=>{const r=og(ns,t.__scopeDialog),{forceMount:n=r.forceMount,...a}=t,o=Pt(ns,t.__scopeDialog);return o.modal?w.jsx(kr,{present:n||o.open,children:w.jsx(Ix,{...a,ref:e})}):null});sg.displayName=ns;var Ix=y.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(ns,r);return w.jsx(vi,{as:gn,allowPinchZoom:!0,shards:[a.contentRef],children:w.jsx(Ve.div,{"data-state":rd(a.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),Fn="DialogContent",lg=y.forwardRef((t,e)=>{const r=og(Fn,t.__scopeDialog),{forceMount:n=r.forceMount,...a}=t,o=Pt(Fn,t.__scopeDialog);return w.jsx(kr,{present:n||o.open,children:o.modal?w.jsx(Px,{...a,ref:e}):w.jsx(Cx,{...a,ref:e})})});lg.displayName=Fn;var Px=y.forwardRef((t,e)=>{const r=Pt(Fn,t.__scopeDialog),n=y.useRef(null),a=yt(e,r.contentRef,n);return y.useEffect(()=>{const o=n.current;if(o)return Cl(o)},[]),w.jsx(cg,{...t,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:be(t.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:be(t.onPointerDownOutside,o=>{const i=o.detail.originalEvent,s=i.button===0&&i.ctrlKey===!0;(i.button===2||s)&&o.preventDefault()}),onFocusOutside:be(t.onFocusOutside,o=>o.preventDefault())})}),Cx=y.forwardRef((t,e)=>{const r=Pt(Fn,t.__scopeDialog),n=y.useRef(!1),a=y.useRef(!1);return w.jsx(cg,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,s;(i=t.onCloseAutoFocus)==null||i.call(t,o),o.defaultPrevented||(n.current||((s=r.triggerRef.current)==null||s.focus()),o.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:o=>{var s,l;(s=t.onInteractOutside)==null||s.call(t,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=o.target;(l=r.triggerRef.current)!=null&&l.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),cg=y.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:o,...i}=t,s=Pt(Fn,r),l=y.useRef(null),c=yt(e,l);return Dl(),w.jsxs(w.Fragment,{children:[w.jsx(wi,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:o,children:w.jsx(ep,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":rd(s.open),...i,ref:c,onDismiss:()=>s.onOpenChange(!1)})}),w.jsxs(w.Fragment,{children:[w.jsx(mg,{titleId:s.titleId}),w.jsx(yg,{contentRef:l,descriptionId:s.descriptionId})]})]})}),td="DialogTitle",dg=y.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(td,r);return w.jsx(Ve.h2,{id:a.titleId,...n,ref:e})});dg.displayName=td;var ug="DialogDescription",hg=y.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(ug,r);return w.jsx(Ve.p,{id:a.descriptionId,...n,ref:e})});hg.displayName=ug;var pg="DialogClose",fg=y.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(pg,r);return w.jsx(Ve.button,{type:"button",...n,ref:e,onClick:be(t.onClick,()=>a.onOpenChange(!1))})});fg.displayName=pg;function rd(t){return t?"open":"closed"}let nd,ad,mg,gg,yg;nd="DialogTitleWarning",[_0,ad]=HN(nd,{contentName:Fn,titleName:td,docsSlug:"dialog"}),mg=({titleId:t})=>{const e=ad(nd),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return y.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},gg="DialogDescriptionWarning",yg=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ad(gg).contentName}}.`;return y.useEffect(()=>{var a;const n=(a=t.current)==null?void 0:a.getAttribute("aria-describedby");e&&n&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},Nl=Qc,y0=ag,Ol=ig,no=sg,Xa=lg,oo=dg,Qa=hg,pc=fg;const jx=Nl,Lx=Ol,_g=y.forwardRef(({className:t,...e},r)=>w.jsx(no,{className:me("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:r}));_g.displayName=no.displayName;const Dx=xl("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),vg=y.forwardRef(({side:t="right",className:e,children:r,...n},a)=>w.jsxs(Lx,{children:[w.jsx(_g,{}),w.jsxs(Xa,{ref:a,className:me(Dx({side:t}),e),...n,children:[r,w.jsxs(pc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[w.jsx(Ye,{name:"x",className:"h-4 w-4"}),w.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));vg.displayName=Xa.displayName;const $x=y.forwardRef(({className:t,...e},r)=>w.jsx(oo,{ref:r,className:me("text-lg font-semibold text-foreground",t),...e}));$x.displayName=oo.displayName;const zx=y.forwardRef(({className:t,...e},r)=>w.jsx(Qa,{ref:r,className:me("text-sm text-muted-foreground",t),...e}));zx.displayName=Qa.displayName;function wg({className:t,...e}){return w.jsx("div",{className:me("animate-pulse rounded-md bg-muted",t),...e})}const Ux=["top","right","bottom","left"],mr=Math.min,kt=Math.max,as=Math.round,os=Math.floor,Vr=t=>({x:t,y:t}),Bx={left:"right",right:"left",bottom:"top",top:"bottom"},Hx={start:"end",end:"start"};function od(t,e,r){return kt(t,mr(e,r))}function Fr(t,e){return typeof t=="function"?t(e):t}function Rr(t){return t.split("-")[0]}function sa(t){return t.split("-")[1]}function id(t){return t==="x"?"y":"x"}function sd(t){return t==="y"?"height":"width"}function Zr(t){return["top","bottom"].includes(Rr(t))?"y":"x"}function ld(t){return id(Zr(t))}function Wx(t,e,r){r===void 0&&(r=!1);const n=sa(t),a=ld(t),o=sd(a);let i=a==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(i=is(i)),[i,is(i)]}function Gx(t){const e=is(t);return[cd(t),e,cd(e)]}function cd(t){return t.replace(/start|end/g,e=>Hx[e])}function qx(t,e,r){const n=["left","right"],a=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return r?e?a:n:e?n:a;case"left":case"right":return e?o:i;default:return[]}}function Vx(t,e,r,n){const a=sa(t);let o=qx(Rr(t),r==="start",n);return a&&(o=o.map(i=>i+"-"+a),e&&(o=o.concat(o.map(cd)))),o}function is(t){return t.replace(/left|right|bottom|top/g,e=>Bx[e])}function Zx(t){return{top:0,right:0,bottom:0,left:0,...t}}function bg(t){return typeof t!="number"?Zx(t):{top:t,right:t,bottom:t,left:t}}function ss(t){const{x:e,y:r,width:n,height:a}=t;return{width:n,height:a,top:r,left:e,right:e+n,bottom:r+a,x:e,y:r}}function Eg(t,e,r){let{reference:n,floating:a}=t;const o=Zr(e),i=ld(e),s=sd(i),l=Rr(e),c=o==="y",d=n.x+n.width/2-a.width/2,u=n.y+n.height/2-a.height/2,h=n[s]/2-a[s]/2;let p;switch(l){case"top":p={x:d,y:n.y-a.height};break;case"bottom":p={x:d,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:u};break;case"left":p={x:n.x-a.width,y:u};break;default:p={x:n.x,y:n.y}}switch(sa(e)){case"start":p[i]-=h*(r&&c?-1:1);break;case"end":p[i]+=h*(r&&c?-1:1);break}return p}const Jx=async(t,e,r)=>{const{placement:n="bottom",strategy:a="absolute",middleware:o=[],platform:i}=r,s=o.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:a}),{x:d,y:u}=Eg(c,n,l),h=n,p={},f=0;for(let g=0;g<s.length;g++){const{name:m,fn:_}=s[g],{x:v,y:A,data:F,reset:b}=await _({x:d,y:u,initialPlacement:n,placement:h,strategy:a,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});d=v??d,u=A??u,p={...p,[m]:{...p[m],...F}},b&&f<=50&&(f++,typeof b=="object"&&(b.placement&&(h=b.placement),b.rects&&(c=b.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:a}):b.rects),{x:d,y:u}=Eg(c,h,l)),g=-1)}return{x:d,y:u,placement:h,strategy:a,middlewareData:p}};async function bo(t,e){var r;e===void 0&&(e={});const{x:n,y:a,platform:o,rects:i,elements:s,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=Fr(e,t),f=bg(p),g=s[h?u==="floating"?"reference":"floating":u],m=ss(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(g)))==null||r?g:g.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(s.floating)),boundary:c,rootBoundary:d,strategy:l})),_=u==="floating"?{x:n,y:a,width:i.floating.width,height:i.floating.height}:i.reference,v=await(o.getOffsetParent==null?void 0:o.getOffsetParent(s.floating)),A=await(o.isElement==null?void 0:o.isElement(v))?await(o.getScale==null?void 0:o.getScale(v))||{x:1,y:1}:{x:1,y:1},F=ss(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:_,offsetParent:v,strategy:l}):_);return{top:(m.top-F.top+f.top)/A.y,bottom:(F.bottom-m.bottom+f.bottom)/A.y,left:(m.left-F.left+f.left)/A.x,right:(F.right-m.right+f.right)/A.x}}const Kx=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:a,rects:o,platform:i,elements:s,middlewareData:l}=e,{element:c,padding:d=0}=Fr(t,e)||{};if(c==null)return{};const u=bg(d),h={x:r,y:n},p=ld(a),f=sd(p),g=await i.getDimensions(c),m=p==="y",_=m?"top":"left",v=m?"bottom":"right",A=m?"clientHeight":"clientWidth",F=o.reference[f]+o.reference[p]-h[p]-o.floating[f],b=h[p]-o.reference[p],D=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let B=D?D[A]:0;(!B||!await(i.isElement==null?void 0:i.isElement(D)))&&(B=s.floating[A]||o.floating[f]);const j=F/2-b/2,G=B/2-g[f]/2-1,te=mr(u[_],G),ue=mr(u[v],G),x=te,R=B-g[f]-ue,k=B/2-g[f]/2+j,E=od(x,k,R),H=!l.arrow&&sa(a)!=null&&k!==E&&o.reference[f]/2-(k<x?te:ue)-g[f]/2<0,N=H?k<x?k-x:k-R:0;return{[p]:h[p]+N,data:{[p]:E,centerOffset:k-E-N,...H&&{alignmentOffset:N}},reset:H}}}),Yx=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:a,middlewareData:o,rects:i,initialPlacement:s,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:g=!0,...m}=Fr(t,e);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const _=Rr(a),v=Zr(s),A=Rr(s)===s,F=await(l.isRTL==null?void 0:l.isRTL(c.floating)),b=h||(A||!g?[is(s)]:Gx(s)),D=f!=="none";!h&&D&&b.push(...Vx(s,g,f,F));const B=[s,...b],j=await bo(e,m),G=[];let te=((n=o.flip)==null?void 0:n.overflows)||[];if(d&&G.push(j[_]),u){const k=Wx(a,i,F);G.push(j[k[0]],j[k[1]])}if(te=[...te,{placement:a,overflows:G}],!G.every(k=>k<=0)){var ue,x;const k=(((ue=o.flip)==null?void 0:ue.index)||0)+1,E=B[k];if(E)return{data:{index:k,overflows:te},reset:{placement:E}};let H=(x=te.filter(N=>N.overflows[0]<=0).sort((N,C)=>N.overflows[1]-C.overflows[1])[0])==null?void 0:x.placement;if(!H)switch(p){case"bestFit":{var R;const N=(R=te.filter(C=>{if(D){const P=Zr(C.placement);return P===v||P==="y"}return!0}).map(C=>[C.placement,C.overflows.filter(P=>P>0).reduce((P,Z)=>P+Z,0)]).sort((C,P)=>C[1]-P[1])[0])==null?void 0:R[0];N&&(H=N);break}case"initialPlacement":H=s;break}if(a!==H)return{reset:{placement:H}}}return{}}}};function Sg(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function xg(t){return Ux.some(e=>t[e]>=0)}const Xx=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...a}=Fr(t,e);switch(n){case"referenceHidden":{const o=await bo(e,{...a,elementContext:"reference"}),i=Sg(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:xg(i)}}}case"escaped":{const o=await bo(e,{...a,altBoundary:!0}),i=Sg(o,r.floating);return{data:{escapedOffsets:i,escaped:xg(i)}}}default:return{}}}}};async function Qx(t,e){const{placement:r,platform:n,elements:a}=t,o=await(n.isRTL==null?void 0:n.isRTL(a.floating)),i=Rr(r),s=sa(r),l=Zr(r)==="y",c=["left","top"].includes(i)?-1:1,d=o&&l?-1:1,u=Fr(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:f}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return s&&typeof f=="number"&&(p=s==="end"?f*-1:f),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}const ek=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:a,y:o,placement:i,middlewareData:s}=e,l=await Qx(e,t);return i===((r=s.offset)==null?void 0:r.placement)&&(n=s.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:o+l.y,data:{...l,placement:i}}}}},tk=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:a}=e,{mainAxis:o=!0,crossAxis:i=!1,limiter:s={fn:m=>{let{x:_,y:v}=m;return{x:_,y:v}}},...l}=Fr(t,e),c={x:r,y:n},d=await bo(e,l),u=Zr(Rr(a)),h=id(u);let p=c[h],f=c[u];if(o){const m=h==="y"?"top":"left",_=h==="y"?"bottom":"right",v=p+d[m],A=p-d[_];p=od(v,p,A)}if(i){const m=u==="y"?"top":"left",_=u==="y"?"bottom":"right",v=f+d[m],A=f-d[_];f=od(v,f,A)}const g=s.fn({...e,[h]:p,[u]:f});return{...g,data:{x:g.x-r,y:g.y-n}}}}},rk=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:a,rects:o,middlewareData:i}=e,{offset:s=0,mainAxis:l=!0,crossAxis:c=!0}=Fr(t,e),d={x:r,y:n},u=Zr(a),h=id(u);let p=d[h],f=d[u];const g=Fr(s,e),m=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const A=h==="y"?"height":"width",F=o.reference[h]-o.floating[A]+m.mainAxis,b=o.reference[h]+o.reference[A]-m.mainAxis;p<F?p=F:p>b&&(p=b)}if(c){var _,v;const A=h==="y"?"width":"height",F=["top","left"].includes(Rr(a)),b=o.reference[u]-o.floating[A]+(F&&((_=i.offset)==null?void 0:_[u])||0)+(F?0:m.crossAxis),D=o.reference[u]+o.reference[A]+(F?0:((v=i.offset)==null?void 0:v[u])||0)-(F?m.crossAxis:0);f<b?f=b:f>D&&(f=D)}return{[h]:p,[u]:f}}}},nk=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:r,rects:n,platform:a,elements:o}=e,{apply:i=()=>{},...s}=Fr(t,e),l=await bo(e,s),c=Rr(r),d=sa(r),u=Zr(r)==="y",{width:h,height:p}=n.floating;let f,g;c==="top"||c==="bottom"?(f=c,g=d===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(g=c,f=d==="end"?"top":"bottom");const m=p-l.top-l.bottom,_=h-l.left-l.right,v=mr(p-l[f],m),A=mr(h-l[g],_),F=!e.middlewareData.shift;let b=v,D=A;if(u?D=d||F?mr(A,_):_:b=d||F?mr(v,m):m,F&&!d){const j=kt(l.left,0),G=kt(l.right,0),te=kt(l.top,0),ue=kt(l.bottom,0);u?D=h-2*(j!==0||G!==0?j+G:kt(l.left,l.right)):b=p-2*(te!==0||ue!==0?te+ue:kt(l.top,l.bottom))}await i({...e,availableWidth:D,availableHeight:b});const B=await a.getDimensions(o.floating);return h!==B.width||p!==B.height?{reset:{rects:!0}}:{}}}};function la(t){return kg(t)?(t.nodeName||"").toLowerCase():"#document"}function At(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Or(t){var e;return(e=(kg(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function kg(t){return t instanceof Node||t instanceof At(t).Node}function Jt(t){return t instanceof Element||t instanceof At(t).Element}function gr(t){return t instanceof HTMLElement||t instanceof At(t).HTMLElement}function Ag(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof At(t).ShadowRoot}function Eo(t){const{overflow:e,overflowX:r,overflowY:n,display:a}=Kt(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(a)}function ak(t){return["table","td","th"].includes(la(t))}function ls(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function dd(t){const e=ud(),r=Jt(t)?Kt(t):t;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function ok(t){let e=Jr(t);for(;gr(e)&&!ca(e);){if(dd(e))return e;if(ls(e))return null;e=Jr(e)}return null}function ud(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ca(t){return["html","body","#document"].includes(la(t))}function Kt(t){return At(t).getComputedStyle(t)}function cs(t){return Jt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Jr(t){if(la(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Ag(t)&&t.host||Or(t);return Ag(e)?e.host:e}function Tg(t){const e=Jr(t);return ca(e)?t.ownerDocument?t.ownerDocument.body:t.body:gr(e)&&Eo(e)?e:Tg(e)}function So(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const a=Tg(t),o=a===((n=t.ownerDocument)==null?void 0:n.body),i=At(a);if(o){const s=hd(i);return e.concat(i,i.visualViewport||[],Eo(a)?a:[],s&&r?So(s):[])}return e.concat(a,So(a,[],r))}function hd(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Mg(t){const e=Kt(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const a=gr(t),o=a?t.offsetWidth:r,i=a?t.offsetHeight:n,s=as(r)!==o||as(n)!==i;return s&&(r=o,n=i),{width:r,height:n,$:s}}function pd(t){return Jt(t)?t:t.contextElement}function da(t){const e=pd(t);if(!gr(e))return Vr(1);const r=e.getBoundingClientRect(),{width:n,height:a,$:o}=Mg(e);let i=(o?as(r.width):r.width)/n,s=(o?as(r.height):r.height)/a;return(!i||!Number.isFinite(i))&&(i=1),(!s||!Number.isFinite(s))&&(s=1),{x:i,y:s}}const ik=Vr(0);function Fg(t){const e=At(t);return!ud()||!e.visualViewport?ik:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function sk(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==At(t)?!1:e}function Rn(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const a=t.getBoundingClientRect(),o=pd(t);let i=Vr(1);e&&(n?Jt(n)&&(i=da(n)):i=da(t));const s=sk(o,r,n)?Fg(o):Vr(0);let l=(a.left+s.x)/i.x,c=(a.top+s.y)/i.y,d=a.width/i.x,u=a.height/i.y;if(o){const h=At(o),p=n&&Jt(n)?At(n):n;let f=h,g=hd(f);for(;g&&n&&p!==f;){const m=da(g),_=g.getBoundingClientRect(),v=Kt(g),A=_.left+(g.clientLeft+parseFloat(v.paddingLeft))*m.x,F=_.top+(g.clientTop+parseFloat(v.paddingTop))*m.y;l*=m.x,c*=m.y,d*=m.x,u*=m.y,l+=A,c+=F,f=At(g),g=hd(f)}}return ss({width:d,height:u,x:l,y:c})}function lk(t){let{elements:e,rect:r,offsetParent:n,strategy:a}=t;const o=a==="fixed",i=Or(n),s=e?ls(e.floating):!1;if(n===i||s&&o)return r;let l={scrollLeft:0,scrollTop:0},c=Vr(1);const d=Vr(0),u=gr(n);if((u||!u&&!o)&&((la(n)!=="body"||Eo(i))&&(l=cs(n)),gr(n))){const h=Rn(n);c=da(n),d.x=h.x+n.clientLeft,d.y=h.y+n.clientTop}return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+d.x,y:r.y*c.y-l.scrollTop*c.y+d.y}}function ck(t){return Array.from(t.getClientRects())}function Rg(t){return Rn(Or(t)).left+cs(t).scrollLeft}function dk(t){const e=Or(t),r=cs(t),n=t.ownerDocument.body,a=kt(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),o=kt(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+Rg(t);const s=-r.scrollTop;return Kt(n).direction==="rtl"&&(i+=kt(e.clientWidth,n.clientWidth)-a),{width:a,height:o,x:i,y:s}}function uk(t,e){const r=At(t),n=Or(t),a=r.visualViewport;let o=n.clientWidth,i=n.clientHeight,s=0,l=0;if(a){o=a.width,i=a.height;const c=ud();(!c||c&&e==="fixed")&&(s=a.offsetLeft,l=a.offsetTop)}return{width:o,height:i,x:s,y:l}}function hk(t,e){const r=Rn(t,!0,e==="fixed"),n=r.top+t.clientTop,a=r.left+t.clientLeft,o=gr(t)?da(t):Vr(1),i=t.clientWidth*o.x,s=t.clientHeight*o.y,l=a*o.x,c=n*o.y;return{width:i,height:s,x:l,y:c}}function Og(t,e,r){let n;if(e==="viewport")n=uk(t,r);else if(e==="document")n=dk(Or(t));else if(Jt(e))n=hk(e,r);else{const a=Fg(t);n={...e,x:e.x-a.x,y:e.y-a.y}}return ss(n)}function Ng(t,e){const r=Jr(t);return r===e||!Jt(r)||ca(r)?!1:Kt(r).position==="fixed"||Ng(r,e)}function pk(t,e){const r=e.get(t);if(r)return r;let n=So(t,[],!1).filter(s=>Jt(s)&&la(s)!=="body"),a=null;const o=Kt(t).position==="fixed";let i=o?Jr(t):t;for(;Jt(i)&&!ca(i);){const s=Kt(i),l=dd(i);!l&&s.position==="fixed"&&(a=null),(o?!l&&!a:!l&&s.position==="static"&&a&&["absolute","fixed"].includes(a.position)||Eo(i)&&!l&&Ng(t,i))?n=n.filter(c=>c!==i):a=s,i=Jr(i)}return e.set(t,n),n}function fk(t){let{element:e,boundary:r,rootBoundary:n,strategy:a}=t;const o=[...r==="clippingAncestors"?ls(e)?[]:pk(e,this._c):[].concat(r),n],i=o[0],s=o.reduce((l,c)=>{const d=Og(e,c,a);return l.top=kt(d.top,l.top),l.right=mr(d.right,l.right),l.bottom=mr(d.bottom,l.bottom),l.left=kt(d.left,l.left),l},Og(e,i,a));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function mk(t){const{width:e,height:r}=Mg(t);return{width:e,height:r}}function gk(t,e,r){const n=gr(e),a=Or(e),o=r==="fixed",i=Rn(t,!0,o,e);let s={scrollLeft:0,scrollTop:0};const l=Vr(0);if(n||!n&&!o)if((la(e)!=="body"||Eo(a))&&(s=cs(e)),n){const u=Rn(e,!0,o,e);l.x=u.x+e.clientLeft,l.y=u.y+e.clientTop}else a&&(l.x=Rg(a));const c=i.left+s.scrollLeft-l.x,d=i.top+s.scrollTop-l.y;return{x:c,y:d,width:i.width,height:i.height}}function fd(t){return Kt(t).position==="static"}function Ig(t,e){return!gr(t)||Kt(t).position==="fixed"?null:e?e(t):t.offsetParent}function Pg(t,e){const r=At(t);if(ls(t))return r;if(!gr(t)){let a=Jr(t);for(;a&&!ca(a);){if(Jt(a)&&!fd(a))return a;a=Jr(a)}return r}let n=Ig(t,e);for(;n&&ak(n)&&fd(n);)n=Ig(n,e);return n&&ca(n)&&fd(n)&&!dd(n)?r:n||ok(t)||r}const yk=async function(t){const e=this.getOffsetParent||Pg,r=this.getDimensions,n=await r(t.floating);return{reference:gk(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function _k(t){return Kt(t).direction==="rtl"}const vk={convertOffsetParentRelativeRectToViewportRelativeRect:lk,getDocumentElement:Or,getClippingRect:fk,getOffsetParent:Pg,getElementRects:yk,getClientRects:ck,getDimensions:mk,getScale:da,isElement:Jt,isRTL:_k};function wk(t,e){let r=null,n;const a=Or(t);function o(){var s;clearTimeout(n),(s=r)==null||s.disconnect(),r=null}function i(s,l){s===void 0&&(s=!1),l===void 0&&(l=1),o();const{left:c,top:d,width:u,height:h}=t.getBoundingClientRect();if(s||e(),!u||!h)return;const p=os(d),f=os(a.clientWidth-(c+u)),g=os(a.clientHeight-(d+h)),m=os(c),_={rootMargin:-p+"px "+-f+"px "+-g+"px "+-m+"px",threshold:kt(0,mr(1,l))||1};let v=!0;function A(F){const b=F[0].intersectionRatio;if(b!==l){if(!v)return i();b?i(!1,b):n=setTimeout(()=>{i(!1,1e-7)},1e3)}v=!1}try{r=new IntersectionObserver(A,{..._,root:a.ownerDocument})}catch{r=new IntersectionObserver(A,_)}r.observe(t)}return i(!0),o}sp=function(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=pd(t),d=a||o?[...c?So(c):[],...So(e)]:[];d.forEach(_=>{a&&_.addEventListener("scroll",r,{passive:!0}),o&&_.addEventListener("resize",r)});const u=c&&s?wk(c,r):null;let h=-1,p=null;i&&(p=new ResizeObserver(_=>{let[v]=_;v&&v.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var A;(A=p)==null||A.observe(e)})),r()}),c&&!l&&p.observe(c),p.observe(e));let f,g=l?Rn(t):null;l&&m();function m(){const _=Rn(t);g&&(_.x!==g.x||_.y!==g.y||_.width!==g.width||_.height!==g.height)&&r(),g=_,f=requestAnimationFrame(m)}return r(),()=>{var _;d.forEach(v=>{a&&v.removeEventListener("scroll",r),o&&v.removeEventListener("resize",r)}),u==null||u(),(_=p)==null||_.disconnect(),p=null,l&&cancelAnimationFrame(f)}};let Cg;ff=ek,yf=tk,mf=Yx,Sf=nk,Cg=Xx,tc=Kx,Ef=rk,gf=(t,e,r)=>{const n=new Map,a={platform:vk,...r},o={...a.platform,_c:n};return Jx(t,e,{...a,platform:o})};var ds=typeof document<"u"?y.useLayoutEffect:y.useEffect;function us(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,a;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!us(t[n],e[n]))return!1;return!0}if(a=Object.keys(t),r=a.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,a[n]))return!1;for(n=r;n--!==0;){const o=a[n];if(!(o==="_owner"&&t.$$typeof)&&!us(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function jg(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Lg(t,e){const r=jg(t);return Math.round(e*r)/r}function Dg(t){const e=y.useRef(t);return ds(()=>{e.current=t}),e}ip=function(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:a,elements:{reference:o,floating:i}={},transform:s=!0,whileElementsMounted:l,open:c}=t,[d,u]=y.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=y.useState(n);us(h,n)||p(n);const[f,g]=y.useState(null),[m,_]=y.useState(null),v=y.useCallback(N=>{N!==D.current&&(D.current=N,g(N))},[]),A=y.useCallback(N=>{N!==B.current&&(B.current=N,_(N))},[]),F=o||f,b=i||m,D=y.useRef(null),B=y.useRef(null),j=y.useRef(d),G=l!=null,te=Dg(l),ue=Dg(a),x=y.useCallback(()=>{if(!D.current||!B.current)return;const N={placement:e,strategy:r,middleware:h};ue.current&&(N.platform=ue.current),gf(D.current,B.current,N).then(C=>{const P={...C,isPositioned:!0};R.current&&!us(j.current,P)&&(j.current=P,u0.flushSync(()=>{u(P)}))})},[h,e,r,ue]);ds(()=>{c===!1&&j.current.isPositioned&&(j.current.isPositioned=!1,u(N=>({...N,isPositioned:!1})))},[c]);const R=y.useRef(!1);ds(()=>(R.current=!0,()=>{R.current=!1}),[]),ds(()=>{if(F&&(D.current=F),b&&(B.current=b),F&&b){if(te.current)return te.current(F,b,x);x()}},[F,b,x,te,G]);const k=y.useMemo(()=>({reference:D,floating:B,setReference:v,setFloating:A}),[v,A]),E=y.useMemo(()=>({reference:F,floating:b}),[F,b]),H=y.useMemo(()=>{const N={position:r,left:0,top:0};if(!E.floating)return N;const C=Lg(E.floating,d.x),P=Lg(E.floating,d.y);return s?{...N,transform:"translate("+C+"px, "+P+"px)",...jg(E.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:C,top:P}},[r,s,E.floating,d.x,d.y]);return y.useMemo(()=>({...d,update:x,refs:k,elements:E,floatingStyles:H}),[d,x,k,E,H])};let $g;$g=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:a}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?tc({element:n.current,padding:a}).fn(r):{}:n?tc({element:n,padding:a}).fn(r):{}}}},lp=(t,e)=>({...ff(t),options:[t,e]}),cp=(t,e)=>({...yf(t),options:[t,e]}),fp=(t,e)=>({...Ef(t),options:[t,e]}),dp=(t,e)=>({...mf(t),options:[t,e]}),up=(t,e)=>({...Sf(t),options:[t,e]}),pp=(t,e)=>({...Cg(t),options:[t,e]}),np=(t,e)=>({...$g(t),options:[t,e]});var bk="Arrow",zg=y.forwardRef((t,e)=>{const{children:r,width:n=10,height:a=5,...o}=t;return w.jsx(Ve.svg,{...o,ref:e,width:n,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:w.jsx("polygon",{points:"0,0 30,0 15,10"})})});zg.displayName=bk;var Ek=zg;function Sk(t,e=[]){let r=[];function n(o,i){const s=y.createContext(i),l=r.length;r=[...r,i];function c(u){const{scope:h,children:p,...f}=u,g=(h==null?void 0:h[t][l])||s,m=y.useMemo(()=>f,Object.values(f));return w.jsx(g.Provider,{value:m,children:p})}function d(u,h){const p=(h==null?void 0:h[t][l])||s,f=y.useContext(p);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${u}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,d]}const a=()=>{const o=r.map(i=>y.createContext(i));return function(i){const s=(i==null?void 0:i[t])||o;return y.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return a.scopeName=t,[n,xk(a,...e)]}function xk(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=n.reduce((i,{useScope:s,scopeName:l})=>{const c=s(a)[`__scope${l}`];return{...i,...c}},{});return y.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}Of=function(t){const[e,r]=y.useState(void 0);return pi(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const o=a[0];let i,s;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,s=c.blockSize}else i=t.offsetWidth,s=t.offsetHeight;r({width:i,height:s})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e};let hs,md,Ug,gd,yd;hs="Popper",[md,so]=Sk(hs),[Ug,gd]=md(hs),yd=t=>{const{__scopePopper:e,children:r}=t,[n,a]=y.useState(null);return w.jsx(Ug,{scope:e,anchor:n,onAnchorChange:a,children:r})},yd.displayName=hs;var Bg="PopperAnchor",Hg=y.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...a}=t,o=gd(Bg,r),i=y.useRef(null),s=yt(e,i);return y.useEffect(()=>{o.onAnchorChange((n==null?void 0:n.current)||i.current)}),n?null:w.jsx(Ve.div,{...a,ref:s})});Hg.displayName=Bg;var _d="PopperContent",[kk,Ak]=md(_d),Wg=y.forwardRef((t,e)=>{var Dt,Rt,Fe,ut,Bn,$a;const{__scopePopper:r,side:n="bottom",sideOffset:a=0,align:o="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:d=0,sticky:u="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:f,...g}=t,m=gd(_d,r),[_,v]=y.useState(null),A=yt(e,gt=>v(gt)),[F,b]=y.useState(null),D=Of(F),B=(D==null?void 0:D.width)??0,j=(D==null?void 0:D.height)??0,G=n+(o!=="center"?"-"+o:""),te=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},ue=Array.isArray(c)?c:[c],x=ue.length>0,R={padding:te,boundary:ue.filter(Mk),altBoundary:x},{refs:k,floatingStyles:E,placement:H,isPositioned:N,middlewareData:C}=ip({strategy:"fixed",placement:G,whileElementsMounted:(...gt)=>sp(...gt,{animationFrame:p==="always"}),elements:{reference:m.anchor},middleware:[lp({mainAxis:a+j,alignmentAxis:i}),l&&cp({mainAxis:!0,crossAxis:!1,limiter:u==="partial"?fp():void 0,...R}),l&&dp({...R}),up({...R,apply:({elements:gt,rects:ni,availableWidth:$t,availableHeight:za})=>{const{width:Ua,height:hn}=ni.reference,br=gt.floating.style;br.setProperty("--radix-popper-available-width",`${$t}px`),br.setProperty("--radix-popper-available-height",`${za}px`),br.setProperty("--radix-popper-anchor-width",`${Ua}px`),br.setProperty("--radix-popper-anchor-height",`${hn}px`)}}),F&&np({element:F,padding:s}),Fk({arrowWidth:B,arrowHeight:j}),h&&pp({strategy:"referenceHidden",...R})]}),[P,Z]=Vg(H),ne=Vn(f);pi(()=>{N&&(ne==null||ne())},[N,ne]);const le=(Dt=C.arrow)==null?void 0:Dt.x,ye=(Rt=C.arrow)==null?void 0:Rt.y,we=((Fe=C.arrow)==null?void 0:Fe.centerOffset)!==0,[$e,Qe]=y.useState();return pi(()=>{_&&Qe(window.getComputedStyle(_).zIndex)},[_]),w.jsx("div",{ref:k.setFloating,"data-radix-popper-content-wrapper":"",style:{...E,transform:N?E.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:$e,"--radix-popper-transform-origin":[(ut=C.transformOrigin)==null?void 0:ut.x,(Bn=C.transformOrigin)==null?void 0:Bn.y].join(" "),...(($a=C.hide)==null?void 0:$a.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:w.jsx(kk,{scope:r,placedSide:P,onArrowChange:b,arrowX:le,arrowY:ye,shouldHideArrow:we,children:w.jsx(Ve.div,{"data-side":P,"data-align":Z,...g,ref:A,style:{...g.style,animation:N?void 0:"none"}})})})});Wg.displayName=_d;var Gg="PopperArrow",Tk={top:"bottom",right:"left",bottom:"top",left:"right"},qg=y.forwardRef(function(t,e){const{__scopePopper:r,...n}=t,a=Ak(Gg,r),o=Tk[a.placedSide];return w.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:w.jsx(Ek,{...n,ref:e,style:{...n.style,display:"block"}})})});qg.displayName=Gg;function Mk(t){return t!==null}var Fk=t=>({name:"transformOrigin",options:t,fn(e){var g,m,_;const{placement:r,rects:n,middlewareData:a}=e,o=((g=a.arrow)==null?void 0:g.centerOffset)!==0,i=o?0:t.arrowWidth,s=o?0:t.arrowHeight,[l,c]=Vg(r),d={start:"0%",center:"50%",end:"100%"}[c],u=(((m=a.arrow)==null?void 0:m.x)??0)+i/2,h=(((_=a.arrow)==null?void 0:_.y)??0)+s/2;let p="",f="";return l==="bottom"?(p=o?d:`${u}px`,f=`${-s}px`):l==="top"?(p=o?d:`${u}px`,f=`${n.floating.height+s}px`):l==="right"?(p=`${-s}px`,f=o?d:`${h}px`):l==="left"&&(p=`${n.floating.width+s}px`,f=o?d:`${h}px`),{data:{x:p,y:f}}}});function Vg(t){const[e,r="center"]=t.split("-");return[e,r]}let xo,Rk,ko,vd,Zg,ps,Jg,fs,wd;bi=yd,zl=Hg,Ul=Wg,Bl=qg,[xo,Rk]=fi("Tooltip",[so]),ko=so(),vd="TooltipProvider",Zg=700,ps="tooltip.open",[Jg,fs]=xo(vd),wd=t=>{const{__scopeTooltip:e,delayDuration:r=Zg,skipDelayDuration:n=300,disableHoverableContent:a=!1,children:o}=t,[i,s]=y.useState(!0),l=y.useRef(!1),c=y.useRef(0);return y.useEffect(()=>{const d=c.current;return()=>window.clearTimeout(d)},[]),w.jsx(Jg,{scope:e,isOpenDelayed:i,delayDuration:r,onOpen:y.useCallback(()=>{window.clearTimeout(c.current),s(!1)},[]),onClose:y.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>s(!0),n)},[n]),isPointerInTransitRef:l,onPointerInTransitChange:y.useCallback(d=>{l.current=d},[]),disableHoverableContent:a,children:o})},wd.displayName=vd;var ms="Tooltip",[Ok,Ao]=xo(ms),Kg=t=>{const{__scopeTooltip:e,children:r,open:n,defaultOpen:a=!1,onOpenChange:o,disableHoverableContent:i,delayDuration:s}=t,l=fs(ms,t.__scopeTooltip),c=ko(e),[d,u]=y.useState(null),h=Ht(),p=y.useRef(0),f=i??l.disableHoverableContent,g=s??l.delayDuration,m=y.useRef(!1),[_=!1,v]=Za({prop:n,defaultProp:a,onChange:B=>{B?(l.onOpen(),document.dispatchEvent(new CustomEvent(ps))):l.onClose(),o==null||o(B)}}),A=y.useMemo(()=>_?m.current?"delayed-open":"instant-open":"closed",[_]),F=y.useCallback(()=>{window.clearTimeout(p.current),p.current=0,m.current=!1,v(!0)},[v]),b=y.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v(!1)},[v]),D=y.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{m.current=!0,v(!0),p.current=0},g)},[g,v]);return y.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),w.jsx(bi,{...c,children:w.jsx(Ok,{scope:e,contentId:h,open:_,stateAttribute:A,trigger:d,onTriggerChange:u,onTriggerEnter:y.useCallback(()=>{l.isOpenDelayed?D():F()},[l.isOpenDelayed,D,F]),onTriggerLeave:y.useCallback(()=>{f?b():(window.clearTimeout(p.current),p.current=0)},[b,f]),onOpen:F,onClose:b,disableHoverableContent:f,children:r})})};Kg.displayName=ms;var bd="TooltipTrigger",Yg=y.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,a=Ao(bd,r),o=fs(bd,r),i=ko(r),s=y.useRef(null),l=yt(e,s,a.onTriggerChange),c=y.useRef(!1),d=y.useRef(!1),u=y.useCallback(()=>c.current=!1,[]);return y.useEffect(()=>()=>document.removeEventListener("pointerup",u),[u]),w.jsx(zl,{asChild:!0,...i,children:w.jsx(Ve.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...n,ref:l,onPointerMove:be(t.onPointerMove,h=>{h.pointerType!=="touch"&&!d.current&&!o.isPointerInTransitRef.current&&(a.onTriggerEnter(),d.current=!0)}),onPointerLeave:be(t.onPointerLeave,()=>{a.onTriggerLeave(),d.current=!1}),onPointerDown:be(t.onPointerDown,()=>{c.current=!0,document.addEventListener("pointerup",u,{once:!0})}),onFocus:be(t.onFocus,()=>{c.current||a.onOpen()}),onBlur:be(t.onBlur,a.onClose),onClick:be(t.onClick,a.onClose)})})});Yg.displayName=bd;var Ed="TooltipPortal",[Nk,Ik]=xo(Ed,{forceMount:void 0}),Xg=t=>{const{__scopeTooltip:e,forceMount:r,children:n,container:a}=t,o=Ao(Ed,e);return w.jsx(Nk,{scope:e,forceMount:r,children:w.jsx(kr,{present:r||o.open,children:w.jsx(tp,{asChild:!0,container:a,children:n})})})};Xg.displayName=Ed;var ua="TooltipContent",Qg=y.forwardRef((t,e)=>{const r=Ik(ua,t.__scopeTooltip),{forceMount:n=r.forceMount,side:a="top",...o}=t,i=Ao(ua,t.__scopeTooltip);return w.jsx(kr,{present:n||i.open,children:i.disableHoverableContent?w.jsx(ey,{side:a,...o,ref:e}):w.jsx(Pk,{side:a,...o,ref:e})})}),Pk=y.forwardRef((t,e)=>{const r=Ao(ua,t.__scopeTooltip),n=fs(ua,t.__scopeTooltip),a=y.useRef(null),o=yt(e,a),[i,s]=y.useState(null),{trigger:l,onClose:c}=r,d=a.current,{onPointerInTransitChange:u}=n,h=y.useCallback(()=>{s(null),u(!1)},[u]),p=y.useCallback((f,g)=>{const m=f.currentTarget,_={x:f.clientX,y:f.clientY},v=Dk(_,m.getBoundingClientRect()),A=$k(_,v),F=zk(g.getBoundingClientRect()),b=Bk([...A,...F]);s(b),u(!0)},[u]);return y.useEffect(()=>()=>h(),[h]),y.useEffect(()=>{if(l&&d){const f=m=>p(m,d),g=m=>p(m,l);return l.addEventListener("pointerleave",f),d.addEventListener("pointerleave",g),()=>{l.removeEventListener("pointerleave",f),d.removeEventListener("pointerleave",g)}}},[l,d,p,h]),y.useEffect(()=>{if(i){const f=g=>{const m=g.target,_={x:g.clientX,y:g.clientY},v=(l==null?void 0:l.contains(m))||(d==null?void 0:d.contains(m)),A=!Uk(_,i);v?h():A&&(h(),c())};return document.addEventListener("pointermove",f),()=>document.removeEventListener("pointermove",f)}},[l,d,i,c,h]),w.jsx(ey,{...t,ref:o})}),[Ck,jk]=xo(ms,{isInside:!1}),ey=y.forwardRef((t,e)=>{const{__scopeTooltip:r,children:n,"aria-label":a,onEscapeKeyDown:o,onPointerDownOutside:i,...s}=t,l=Ao(ua,r),c=ko(r),{onClose:d}=l;return y.useEffect(()=>(document.addEventListener(ps,d),()=>document.removeEventListener(ps,d)),[d]),y.useEffect(()=>{if(l.trigger){const u=h=>{var p;(p=h.target)!=null&&p.contains(l.trigger)&&d()};return window.addEventListener("scroll",u,{capture:!0}),()=>window.removeEventListener("scroll",u,{capture:!0})}},[l.trigger,d]),w.jsx(ep,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:u=>u.preventDefault(),onDismiss:d,children:w.jsxs(Ul,{"data-state":l.stateAttribute,...c,...s,ref:e,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[w.jsx(WN,{children:n}),w.jsx(Ck,{scope:r,isInside:!0,children:w.jsx(GN,{id:l.contentId,role:"tooltip",children:a||n})})]})})});Qg.displayName=ua;var ty="TooltipArrow",Lk=y.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,a=ko(r);return jk(ty,r).isInside?null:w.jsx(Bl,{...a,...n,ref:e})});Lk.displayName=ty;function Dk(t,e){const r=Math.abs(e.top-t.y),n=Math.abs(e.bottom-t.y),a=Math.abs(e.right-t.x),o=Math.abs(e.left-t.x);switch(Math.min(r,n,a,o)){case o:return"left";case a:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function $k(t,e,r=5){const n=[];switch(e){case"top":n.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":n.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":n.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":n.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return n}function zk(t){const{top:e,right:r,bottom:n,left:a}=t;return[{x:a,y:e},{x:r,y:e},{x:r,y:n},{x:a,y:n}]}function Uk(t,e){const{x:r,y:n}=t;let a=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const s=e[o].x,l=e[o].y,c=e[i].x,d=e[i].y;l>n!=d>n&&r<(c-s)*(n-l)/(d-l)+s&&(a=!a)}return a}function Bk(t){const e=t.slice();return e.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Hk(e)}function Hk(t){if(t.length<=1)return t.slice();const e=[];for(let n=0;n<t.length;n++){const a=t[n];for(;e.length>=2;){const o=e[e.length-1],i=e[e.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))e.pop();else break}e.push(a)}e.pop();const r=[];for(let n=t.length-1;n>=0;n--){const a=t[n];for(;r.length>=2;){const o=r[r.length-1],i=r[r.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))r.pop();else break}r.push(a)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}Mf=wd,Ff=Kg,Rf=Yg,J0=Xg,uc=Qg,fc=Mf,Qn=Ff,ea=Rf,En=y.forwardRef(({className:t,sideOffset:e=4,...r},n)=>w.jsx(uc,{ref:n,sideOffset:e,className:me("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})),En.displayName=uc.displayName;const Wk="sidebar:state",Gk=60*60*24*7,qk="16rem",Vk="18rem",Zk="3rem",Jk="b",ry=y.createContext(null);function To(){const t=y.useContext(ry);if(!t)throw new Error("useSidebar must be used within a SidebarProvider.");return t}Fl=y.forwardRef(({defaultOpen:t=!0,open:e,onOpenChange:r,className:n,style:a,children:o,...i},s)=>{const l=QS(),[c,d]=y.useState(!1),[u,h]=y.useState(t),p=e??u,f=y.useCallback(v=>{const A=typeof v=="function"?v(p):v;r?r(A):h(A),document.cookie=`${Wk}=${A}; path=/; max-age=${Gk}`},[r,p]),g=y.useCallback(()=>l?d(v=>!v):f(v=>!v),[l,f,d]);y.useEffect(()=>{const v=A=>{A.key===Jk&&(A.metaKey||A.ctrlKey)&&(A.preventDefault(),g())};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[g]);const m=p?"expanded":"collapsed",_=y.useMemo(()=>({state:m,open:p,setOpen:f,isMobile:l,openMobile:c,setOpenMobile:d,toggleSidebar:g}),[m,p,f,l,c,d,g]);return w.jsx(ry.Provider,{value:_,children:w.jsx(fc,{delayDuration:0,children:w.jsx("div",{style:{"--sidebar-width":qk,"--sidebar-width-icon":Zk,...a},className:me("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:s,...i,children:o})})})}),Fl.displayName="SidebarProvider",bc=y.forwardRef(({side:t="left",variant:e="sidebar",collapsible:r="offcanvas",className:n,children:a,...o},i)=>{const{isMobile:s,state:l,openMobile:c,setOpenMobile:d}=To();return r==="none"?w.jsx("div",{className:me("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:i,...o,children:a}):s?w.jsx(jx,{open:c,onOpenChange:d,...o,children:w.jsx(vg,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":Vk},side:t,children:w.jsx("div",{className:"flex h-full w-full flex-col",children:a})})}):w.jsxs("div",{ref:i,className:"group peer hidden md:block text-sidebar-foreground","data-state":l,"data-collapsible":l==="collapsed"?r:"","data-variant":e,"data-side":t,children:[w.jsx("div",{className:me("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",e==="floating"||e==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),w.jsx("div",{className:me("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",t==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",e==="floating"||e==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...o,children:w.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:a})})]})}),bc.displayName="Sidebar";const ny=y.forwardRef(({className:t,onClick:e,...r},n)=>{const{toggleSidebar:a}=To();return w.jsx(zr,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:me("h-7 w-7",t),onClick:o=>{e==null||e(o),a()},...r,children:w.jsx(Ye,{size:32,name:"panel-left"})})});ny.displayName="SidebarTrigger";const ay=y.forwardRef(({className:t,...e},r)=>{const{toggleSidebar:n}=To();return w.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:me("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...e})});ay.displayName="SidebarRail",Rl=y.forwardRef(({className:t,...e},r)=>w.jsx("main",{ref:r,className:me("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...e})),Rl.displayName="SidebarInset";const Kk=y.forwardRef(({className:t,...e},r)=>w.jsx(_i,{ref:r,"data-sidebar":"input",className:me("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...e}));Kk.displayName="SidebarInput";const Yk=y.forwardRef(({className:t,...e},r)=>w.jsx("div",{ref:r,"data-sidebar":"header",className:me("flex flex-col gap-2 p-2",t),...e}));Yk.displayName="SidebarHeader";const oy=y.forwardRef(({className:t,...e},r)=>w.jsx("div",{ref:r,"data-sidebar":"footer",className:me("flex flex-col gap-2 p-2",t),...e}));oy.displayName="SidebarFooter";const Xk=y.forwardRef(({className:t,...e},r)=>w.jsx(Ei,{ref:r,"data-sidebar":"separator",className:me("mx-2 w-auto bg-sidebar-border",t),...e}));Xk.displayName="SidebarSeparator",Sc=y.forwardRef(({className:t,...e},r)=>w.jsx("div",{ref:r,"data-sidebar":"content",className:me("flex min-h-0 flex-1 flex-col gap-0 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...e})),Sc.displayName="SidebarContent",Fi=y.forwardRef(({className:t,...e},r)=>w.jsx("div",{ref:r,"data-sidebar":"group",className:me("relative flex w-full min-w-0 flex-col p-2",t),...e})),Fi.displayName="SidebarGroup",Ec=y.forwardRef(({className:t,asChild:e=!1,...r},n)=>{const a=e?gn:"div";return w.jsx(a,{ref:n,"data-sidebar":"group-label",className:me("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...r})}),Ec.displayName="SidebarGroupLabel";const Qk=y.forwardRef(({className:t,asChild:e=!1,...r},n)=>{const a=e?gn:"button";return w.jsx(a,{ref:n,"data-sidebar":"group-action",className:me("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...r})});Qk.displayName="SidebarGroupAction";const e1=y.forwardRef(({className:t,...e},r)=>w.jsx("div",{ref:r,"data-sidebar":"group-content",className:me("w-full text-sm",t),...e}));e1.displayName="SidebarGroupContent",eo=y.forwardRef(({className:t,...e},r)=>w.jsx("ul",{ref:r,"data-sidebar":"menu",className:me("flex w-full min-w-0 flex-col gap-1",t),...e})),eo.displayName="SidebarMenu",Jn=y.forwardRef(({className:t,...e},r)=>w.jsx("li",{ref:r,"data-sidebar":"menu-item",className:me("group/menu-item relative",t),...e})),Jn.displayName="SidebarMenuItem";let iy;iy=xl("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),ro=y.forwardRef(({onClick:t,asChild:e=!1,isActive:r=!1,variant:n="default",size:a="default",tooltip:o,className:i,autoHide:s,...l},c)=>{const d=e?gn:"button",{isMobile:u,state:h,toggleSidebar:p}=To(),f=w.jsx(d,{ref:c,"data-sidebar":"menu-button","data-size":a,"data-active":r,className:me(iy({variant:n,size:a}),i),onClick:s?g=>{t==null||t(g),p()}:t,...l});return o?(typeof o=="string"&&(o={children:o}),w.jsxs(Qn,{children:[w.jsx(ea,{asChild:!0,children:f}),w.jsx(En,{side:"right",align:"center",hidden:h!=="collapsed"||u,...o})]})):f}),ro.displayName="SidebarMenuButton";const t1=y.forwardRef(({className:t,asChild:e=!1,showOnHover:r=!1,...n},a)=>{const o=e?gn:"button";return w.jsx(o,{ref:a,"data-sidebar":"menu-action",className:me("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...n})});t1.displayName="SidebarMenuAction";const r1=y.forwardRef(({className:t,...e},r)=>w.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:me("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...e}));r1.displayName="SidebarMenuBadge";const n1=y.forwardRef(({className:t,showIcon:e=!1,...r},n)=>{const a=y.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return w.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:me("rounded-md h-8 flex gap-2 px-2 items-center",t),...r,children:[e&&w.jsx(wg,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),w.jsx(wg,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":a}})]})});n1.displayName="SidebarMenuSkeleton";const sy=y.forwardRef(({className:t,...e},r)=>w.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:me("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...e}));sy.displayName="SidebarMenuSub";const ly=y.forwardRef(({...t},e)=>w.jsx("li",{ref:e,...t}));ly.displayName="SidebarMenuSubItem";const cy=y.forwardRef(({asChild:t=!1,size:e="md",isActive:r,className:n,...a},o)=>{const i=t?gn:"a";return w.jsx(i,{ref:o,"data-sidebar":"menu-sub-button","data-size":e,"data-active":r,className:me("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",e==="sm"&&"text-xs",e==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...a})});cy.displayName="SidebarMenuSubButton";let dy,On,uy;dy="hash",On={application:"/application/:applicationId?",whiteboard:"/whiteboard/:sessionId?",document:"/document/:documentId?",sessions:"/sessions"},it=(t,e)=>{let r=On[t];return e?r=Object.keys(e||{}).reduce((n,a)=>n.replace(`:${a}`,(e==null?void 0:e[a])||""),r):r=r.replace(/\/:[^/]+/g,""),r!=null&&r.endsWith("?")?r.slice(0,-1):r},uy=()=>{{const[,t]=window.location.hash.split("?");return new URLSearchParams(`?${t}`)}};function a1({items:t}){const{t:e}=mi("documents");return w.jsxs(Fi,{children:[w.jsx(Ec,{children:w.jsx("div",{className:"text-sm",children:e("title")})}),w.jsx(eo,{children:t.map(r=>{var n;return w.jsx(tf,{asChild:!0,defaultOpen:r.isActive,className:"group/collapsible",children:w.jsxs(Jn,{children:[w.jsx(rf,{asChild:!0,children:w.jsxs(ro,{className:"cursor-pointer",tooltip:e(r.title),children:[r.icon,w.jsx("span",{children:e(r.title)}),w.jsx(Ye,{name:"chevron-right",className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),w.jsx(nf,{children:w.jsx(sy,{children:(n=r.items)==null?void 0:n.map(a=>w.jsx(ly,{className:"cursor-pointer",children:w.jsx(cy,{asChild:!0,children:w.jsx(zc,{to:it("document",{documentId:a.id}),children:w.jsx("span",{children:e(a.title)})})})},e(a.title)))})})]})},r.title)})})]})}const o1=y.memo(({text:t,colors:e={first:"#9E7AFF",second:"#FE8BBB"},className:r,sparklesCount:n,...a})=>{n=n??10;const[o,i]=y.useState([]);return y.useEffect(()=>{const s=()=>{const u=`${Math.random()*100}%`,h=`${Math.random()*100}%`,p=Math.random()>.5?e.first:e.second,f=Math.random()*2,g=Math.random()*1+.3,m=Math.random()*10+5;return{id:`${u}-${h}-${Date.now()}`,x:u,y:h,color:p,delay:f,scale:g,lifespan:m}},l=()=>{const u=n?Array.from({length:n},s):[];i(u)},c=()=>{i(u=>u.map(h=>h.lifespan<=0?s():{...h,lifespan:h.lifespan-.1}))};l();const d=setInterval(c,100);return()=>clearInterval(d)},[e.first,e.second]),w.jsx("div",{className:me("text-6xl",r),...a,style:{"--sparkles-first-color":`${e.first}`,"--sparkles-second-color":`${e.second}`},children:w.jsxs("span",{className:"relative inline-block",children:[o.map(s=>w.jsx(i1,{...s},s.id)),w.jsx("strong",{children:t})]})})},(t,e)=>t.text===e.text),i1=({id:t,x:e,y:r,color:n,delay:a,scale:o})=>w.jsx(qN.svg,{className:"pointer-events-none absolute z-20",initial:{opacity:0,left:e,top:r},animate:{opacity:[0,1,0],scale:[0,o,0],rotate:[75,120,150]},transition:{duration:.8,repeat:1/0,delay:a},width:"21",height:"21",viewBox:"0 0 21 21",children:w.jsx("path",{d:"M9.82531 0.843845C10.0553 0.215178 10.9446 0.215178 11.1746 0.843845L11.8618 2.72026C12.4006 4.19229 12.3916 6.39157 13.5 7.5C14.6084 8.60843 16.8077 8.59935 18.2797 9.13822L20.1561 9.82534C20.7858 10.0553 20.7858 10.9447 20.1561 11.1747L18.2797 11.8618C16.8077 12.4007 14.6084 12.3916 13.5 13.5C12.3916 14.6084 12.4006 16.8077 11.8618 18.2798L11.1746 20.1562C10.9446 20.7858 10.0553 20.7858 9.82531 20.1562L9.13819 18.2798C8.59932 16.8077 8.60843 14.6084 7.5 13.5C6.39157 12.3916 4.19225 12.4007 2.72023 11.8618L0.843814 11.1747C0.215148 10.9447 0.215148 10.0553 0.843814 9.82534L2.72023 9.13822C4.19225 8.59935 6.39157 8.60843 7.5 7.5C8.60843 6.39157 8.59932 4.19229 9.13819 2.72026L9.82531 0.843845Z",fill:n})},t);function hy({icon:t,sparkles:e,bold:r,text:n,className:a,onClick:o}){return w.jsxs(ro,{className:me(a,"tw-w-full"),onClick:o,children:[w.jsx(Ye,{name:t}),w.jsx(o1,{text:n,sparklesCount:e?3:0,className:me("text-sm",r?"font-bold":"font-normal")})]})}De=(t=>(t.Toolbox="TOOLBOX",t.LLM="LLM",t.NewMessage="NEW_MESSAGE",t.Thread="THREAD",t.Message="MESSAGE",t.Prompt="PROMPT",t.SessionInfo="SESSION_INFO",t.Schema="SCHEMA",t.ToolDefinition="TOOL_DEFINITION",t.ToolHandler="TOOL_HANDLER",t.FewShotExample="FEW_SHOT_EXAMPLE",t.CSVData="CSV_DATA",t.DefaultEmbeddingModel="DEFAULT_EMBEDDING_MODEL",t.VectorDatabase="VECTOR_DATABASE",t.JSONLData="JSONL_DATA",t.ApplicationBar="APPLICATION_BAR",t.Shape="SHAPE",t.CircleShape="CIRCLE_SHAPE",t.TriangleShape="TRIANGLE_SHAPE",t.EditorApp="EDITOR_APP",t.PlaceHolder="PLACEHOLDER",t.VSLiteApp="VSLITE_APP",t.JSONData="JSON_DATA",t.MCP="MCP",t.BasicAgent="BASIC_AGENT",t))(De||{}),uo=(t=>(t.Started="started",t.Done="done",t.Achieved="Achieved",t.Deleted="deleted",t))(uo||{}),St=(t=>(t.Whiteboard="Whiteboard",t.StandaloneApp="StandaloneApp",t))(St||{}),Zp=(t=>(t.Local="local",t.Remote="remote",t))(Zp||{}),dr=(t=>(t.Voy="voy",t.Memory="memory",t))(dr||{}),Br=(t=>(t.DataNode="DataNode",t.DatabaseNode="DatabaseNode",t.IndexedDB="IndexedDB",t))(Br||{});let Sd,py;Sd={Thread:"threads",Message:"messages",LLM:"llms",FlowNode:"flow_nodes",FlowEdge:"flow_edges",Prompt:"prompts",PromptVariable:"prompt_variables",Session:"sessions",Schema:"schemas",SchemaItem:"schema_items",JSONData:"json_data",CSVData:"csv_data",ToolDefinition:"tool_definitions",VectorDatabase:"vector_databases",JSONLData:"jsonl_data",FlowNodeData:"flow_node_data",FlowNodePlaceholder:"flow_node_placeholders",MCP:"mcps",BasicAgent:"basic_agents"},C0={[De.Toolbox]:void 0,[De.SessionInfo]:void 0,[De.DefaultEmbeddingModel]:void 0,[De.ApplicationBar]:void 0,[De.Shape]:void 0,[De.CircleShape]:void 0,[De.TriangleShape]:void 0,[De.EditorApp]:void 0,[De.VSLiteApp]:void 0,[De.NewMessage]:void 0,[De.ToolHandler]:void 0,[De.FewShotExample]:void 0,[De.JSONData]:"JSONData",[De.LLM]:"LLM",[De.Thread]:"Thread",[De.Message]:"Message",[De.Prompt]:"Prompt",[De.Schema]:"Schema",[De.CSVData]:"CSVData",[De.ToolDefinition]:"ToolDefinition",[De.VectorDatabase]:"VectorDatabase",[De.JSONLData]:"JSONLData",[De.PlaceHolder]:"FlowNodePlaceholder",[De.MCP]:"Mcp",[De.BasicAgent]:"BasicAgent"},py="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let fy,my,gy;fy=t=>crypto.getRandomValues(new Uint8Array(t)),my=(t,e,r)=>{let n=(2<<Math.log(t.length-1)/Math.LN2)-1,a=-~(1.6*n*e/t.length);return(o=e)=>{let i="";for(;;){let s=r(a),l=a;for(;l--;)if(i+=t[s[l]&n]||"",i.length===o)return i}}},gy=(t,e=21)=>my(t,e,fy),Ur=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=py[r[t]&63];return e};const yy="_WORKER_INIT_";async function Nn(t,e,r,n,a={}){return t.postMessage({...a,type:e,messageId:r,payload:n})}const _y=(t,e,r)=>{var s,l,c,d,u;const n=t.data.messageId;if(!n)return;const{resolve:a,reject:o,processInfo:i}=(e==null?void 0:e.get(n))||{};n===yy?(s=r==null?void 0:r.onWorkerInit)==null||s.call(r,t):["complete","error"].includes(t.data.type)?(t.data.type==="complete"&&typeof a=="function"?(a==null||a(t.data.payload),(l=r==null?void 0:r.onComplete)==null||l.call(r,t)):typeof o=="function"&&(o==null||o(new Error(JSON.stringify(t.data.payload))),(c=r==null?void 0:r.onError)==null||c.call(r,t)),e.delete(n),(d=r==null?void 0:r.onFinish)==null||d.call(r,t)):t.data.type==="inprogress"?(i&&typeof i=="object"&&"data"in i&&Array.isArray(i==null?void 0:i.data)&&i.data.push(t.data.payload),(u=r==null?void 0:r.onProgress)==null||u.call(r,t)):t.data.type==="started"||yn("[Unknown message type]",t.data)},ha=t=>{let e={};const r=new Promise((n,a)=>{if(e={resolve:n,reject:a},t)return t(n,a)});return e.promise=r,e},s1=t=>!!t&&typeof t=="object"&&"type"in t&&"@instanceof"in t,Mo=t=>{if(t==null||typeof t=="string"||typeof t=="number")return t;if(typeof t=="object"){if(Array.isArray(t))return t.map(r=>Mo(r));const e={};return Object.keys(t).forEach(r=>{const n=t[r];s1(n)?e[r]={"@instanceof":"FindOperator",type:n.type,value:n.value,useParameter:n.useParameter,multipleParameters:n.multipleParameters,getSql:typeof n.getSql=="function"?n.getSql.toString():void 0,objectLiteralParameters:n.objectLiteralParameters}:n&&typeof n=="object"&&n!==null?e[r]=Mo(n):e[r]=n}),e}return t};var xd=(t=>(t.INIT="init",t.REPOSITORY_EXECUTE="repository-execute",t.RAW_QUERY_EXECUTE="raw-query-execute",t))(xd||{});let pa,gs,kd,vy,wy,In;pa=new Worker(new URL("/NoLLMChat/assets/database.worker-BBbV_HBF.js",import.meta.url),{type:"module"}),gs=new Map,kd=t=>_y(t,gs,{onWorkerInit:()=>{}}),vy=async()=>{pa&&pa.removeEventListener("message",kd),pa.addEventListener("message",kd)},wy=()=>{const t=Ur(),e=ha();return gs.set(t,{promise:e.promise,resolve:e.resolve,reject:e.reject}),{promise:e.promise,messageId:t}},In=async(t,e,r)=>{let n="";try{if(!pa)throw new Error("Worker not initialized");const a=wy();return n=a.messageId,Nn(pa,xd.REPOSITORY_EXECUTE,n,[t,e,r]),a.promise}catch(a){throw yn(`Error executing ${xd.REPOSITORY_EXECUTE} action`,a),n&&gs.delete(n),a}},We=t=>({find:e=>In(t,"find",Mo(e)),findOne:e=>In(t,"findOne",Mo(e)),count:e=>In(t,"count",Mo(e)),delete:e=>In(t,"delete",e),save:e=>In(t,"save",e),update:(e,r)=>In(t,"update",{id:e,update:r})}),vy();class l1{constructor(){ae(this,"sessionKeyProcess");ae(this,"sessionKey");ae(this,"loadded",!1);ae(this,"sessionMemory",new Map);this.init()}async init(){if(this.loadded)return;this.sessionMemory=new Map;const e={name:"AES-GCM",length:256},r=["encrypt","decrypt"];this.sessionKeyProcess=window.crypto.subtle.generateKey(e,!0,r).then(n=>n),this.sessionKey=await this.sessionKeyProcess,this.loadded=!0,this.sessionKeyProcess=void 0}async reload(){this.loadded=!1,this.init()}async set(e,r){this.sessionKeyProcess&&await this.sessionKeyProcess;const n=await crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(12)},this.sessionKey,new TextEncoder().encode(r));this.sessionMemory.set(e,n)}async get(e){const r=this.sessionMemory.get(e);if(!r)return null;this.sessionKeyProcess&&await this.sessionKeyProcess;const n=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(12)},this.sessionKey,r);return new TextDecoder().decode(n)}async exists(e){return this.sessionMemory.has(e)}}let by,Ey,Sy,xy,Ad;Bp=new l1,by=(t,e)=>({setToDefaultSession:async r=>{const n=e().sessions;if(!(n!=null&&n.length)){const a=await We("Session").find({where:{status:uo.Started,type:r||St.Whiteboard},order:{updated_at:"DESC"},take:1});return e().setCurrentSession(a==null?void 0:a[0])}return e().setCurrentSession(n==null?void 0:n[0])},setCurrentSession:async r=>{const n=e().currentSession;if(!r||typeof r=="string"&&(n==null?void 0:n.id)===r||typeof r=="object"&&(n==null?void 0:n.id)===r.id&&n.passphrase===r.passphrase&&n.metadata===r.metadata)return n;if(await Bp.reload(),t({currentSession:void 0}),typeof r=="string"||!r)if(r=r||kl.getState().selectedSessionId,r===(n==null?void 0:n.id)&&n)r=n;else{let i=await We("Session").findOne({where:{id:r}});i||(i=await We("Session").findOne({order:{updated_at:"DESC"}})),r=i}kl.setState({selectedSessionId:r.id});const a=await We("FlowNode").findOne({where:{id:r.main_node_id}});r.main_node=a;let o=!1;if(r.type===St.StandaloneApp){const i=e().applications.map(s=>s.id===r.id?(o=!0,r):s);t({currentSession:r,applications:o?i:[r,...e().applications]})}else{const i=e().sessions.map(s=>s.id===r.id?(o=!0,r):s);t({currentSession:r,sessions:o?i:[r,...e().sessions]})}return r},createSession:async r=>{const n=await We("Session").save({...r,name:`${r.name}`,status:uo.Started,type:St.Whiteboard});if(!n)throw new Error("Failed create.");return t({sessions:[n,...e().sessions]}),n},deleteSession:async r=>{const n=await We("Session").findOne({where:{id:r}});if(!n)throw new Error("Failed delete.");if(!await We("Session").delete(r))throw new Error("Failed delete.");const a=e().sessions,o=e().applications;if((n==null?void 0:n.type)===St.Whiteboard){const i=a.filter(s=>s.id!==r);t({sessions:i,...(n==null?void 0:n.id)===r?{currentSession:(i==null?void 0:i[0])||(o==null?void 0:o[0])}:{}})}else{const i=o.filter(s=>s.id!==r);t({applications:i,...(n==null?void 0:n.id)===r?{currentSession:(i==null?void 0:i[0])||(a==null?void 0:a[0])}:{}})}},getSessions:async r=>{try{const n=await We("Session").find({where:(r==null?void 0:r.where)||{status:uo.Started},order:{updated_at:"DESC"},take:20,relations:["main_node"],skip:r!=null&&r.page?(r.page-1)*20:0});n!=null&&n.length&&t({sessions:n})}catch{t({error:"No session"})}}}),Ey={currentSession:void 0,ready:!0,error:void 0,sessions:[],applications:[]},Hr=Al()(Tl((t,e)=>({...Ey,...by(t,e)}))),Sy=()=>{const[t,e]=y.useState(!1),r=Hr(a=>a.createSession),n=y.useCallback(async a=>{try{return e(!0),await r(a)}finally{e(!1)}},[r]);return{loading:t,createSession:n}},If=Nl,xy=Ol,Ad=y.forwardRef(({className:t,...e},r)=>w.jsx(no,{ref:r,className:me("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e})),Ad.displayName=no.displayName,_c=y.forwardRef(({className:t,children:e,...r},n)=>w.jsxs(xy,{children:[w.jsx(Ad,{}),w.jsxs(Xa,{ref:n,className:me("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[e,w.jsxs(pc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[w.jsx(Ye,{name:"x",className:"h-4 w-4"}),w.jsx("span",{className:"sr-only",children:"Close"})]})]})]})),_c.displayName=Xa.displayName,vc=({className:t,...e})=>w.jsx("div",{className:me("flex flex-col space-y-1.5 text-center sm:text-left",t),...e}),vc.displayName="DialogHeader",Wl=({className:t,...e})=>w.jsx("div",{className:me("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e}),Wl.displayName="DialogFooter",wc=y.forwardRef(({className:t,...e},r)=>w.jsx(oo,{ref:r,className:me("text-lg font-semibold leading-none tracking-tight",t),...e})),wc.displayName=oo.displayName,Hl=y.forwardRef(({className:t,...e},r)=>w.jsx(Qa,{ref:r,className:me("text-sm text-muted-foreground",t),...e})),Hl.displayName=Qa.displayName;var c1="Label",ky=y.forwardRef((t,e)=>w.jsx(Ve.label,{...t,ref:e,onMouseDown:r=>{var n;r.target.closest("button, input, select, textarea")||((n=t.onMouseDown)==null||n.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));ky.displayName=c1;var Ay=ky;let Ty;Ty=xl("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),yi=y.forwardRef(({className:t,...e},r)=>w.jsx(Ay,{ref:r,className:me(Ty(),t),...e})),yi.displayName=Ay.displayName,wp=VN(()=>{const t=h0(),{t:e}=mi("dialogs"),[r,n]=y.useState(""),{toast:a}=ZN(),{loading:o,createSession:i}=Sy(),s=d=>{n(d.target.value)},l=async()=>{try{const d=await i({name:r});n(""),t.resolve(d.id),t.hide()}catch(d){a({variant:"destructive",description:e("create_session.errors.create_failed")}),t.reject(d)}},c=()=>{n(""),t.resolve(void 0),t.hide()};return w.jsx(If,{open:t.visible,onOpenChange:c,children:w.jsxs(_c,{className:"sm:max-w-[425px]",children:[w.jsxs(vc,{children:[w.jsx(wc,{children:e("create_session.title")}),w.jsx(Hl,{children:e("create_session.description")})]}),w.jsx("div",{className:"grid gap-4 py-4",children:w.jsxs("div",{className:"flex flex-col space-y-1.5",children:[w.jsx(yi,{className:"mb-2",htmlFor:"name",children:e("create_session.name")}),w.jsx(_i,{onChange:s,id:"name",value:r,placeholder:e("create_session.name_placeholder")})]})}),w.jsx(Wl,{children:w.jsx(zr,{onClick:l,disabled:o||!r,type:"submit",children:e("create_session.create")})})]})})});function d1({currentSession:t}){const{t:e}=mi("sidebar"),r=Kn(),[n,a]=y.useState(),o=h0(wp),i=y.useCallback(async()=>{try{const l=await o.show({});l&&typeof l=="string"&&r(it("whiteboard",{sessionId:l}))}catch{}},[o,r]),s=y.useCallback(()=>{r(it("sessions"))},[r]);return y.useEffect(()=>{!n||n!==(t==null?void 0:t.id)||a(void 0)},[n,t==null?void 0:t.id]),w.jsx(Fi,{className:"group-data-[collapsible=icon]:hidden pb-0",children:w.jsxs(eo,{children:[w.jsx(Jn,{children:w.jsx(hy,{icon:"layout-grid",onClick:s,className:"w-full",text:e("sessions")})}),w.jsx(Jn,{children:w.jsx(hy,{icon:"frame",onClick:i,className:"w-full",text:e("new_session"),bold:!0,sparkles:!0})})]})})}var u1=y.createContext(void 0);yc=function(t){const e=y.useContext(u1);return t||e||"ltr"};function h1(t,e=[]){let r=[];function n(o,i){const s=y.createContext(i),l=r.length;r=[...r,i];function c(u){const{scope:h,children:p,...f}=u,g=(h==null?void 0:h[t][l])||s,m=y.useMemo(()=>f,Object.values(f));return w.jsx(g.Provider,{value:m,children:p})}function d(u,h){const p=(h==null?void 0:h[t][l])||s,f=y.useContext(p);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${u}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,d]}const a=()=>{const o=r.map(i=>y.createContext(i));return function(i){const s=(i==null?void 0:i[t])||o;return y.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return a.scopeName=t,[n,p1(a,...e)]}function p1(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=n.reduce((i,{useScope:s,scopeName:l})=>{const c=s(a)[`__scope${l}`];return{...i,...c}},{});return y.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}let ys,My,Fo,_s,Td,Fy,Ry,Oy,Ny,Md;ys="rovingFocusGroup.onEntryFocus",My={bubbles:!1,cancelable:!0},Fo="RovingFocusGroup",[_s,Td,Fy]=p0(Fo),[Ry,gc]=h1(Fo,[Fy]),[Oy,Ny]=Ry(Fo),Md=y.forwardRef((t,e)=>w.jsx(_s.Provider,{scope:t.__scopeRovingFocusGroup,children:w.jsx(_s.Slot,{scope:t.__scopeRovingFocusGroup,children:w.jsx(f1,{...t,ref:e})})})),Md.displayName=Fo;var f1=y.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:a=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...u}=t,h=y.useRef(null),p=yt(e,h),f=yc(o),[g=null,m]=Za({prop:i,defaultProp:s,onChange:l}),[_,v]=y.useState(!1),A=Vn(c),F=Td(r),b=y.useRef(!1),[D,B]=y.useState(0);return y.useEffect(()=>{const j=h.current;if(j)return j.addEventListener(ys,A),()=>j.removeEventListener(ys,A)},[A]),w.jsx(Oy,{scope:r,orientation:n,dir:f,loop:a,currentTabStopId:g,onItemFocus:y.useCallback(j=>m(j),[m]),onItemShiftTab:y.useCallback(()=>v(!0),[]),onFocusableItemAdd:y.useCallback(()=>B(j=>j+1),[]),onFocusableItemRemove:y.useCallback(()=>B(j=>j-1),[]),children:w.jsx(Ve.div,{tabIndex:_||D===0?-1:0,"data-orientation":n,...u,ref:p,style:{outline:"none",...t.style},onMouseDown:be(t.onMouseDown,()=>{b.current=!0}),onFocus:be(t.onFocus,j=>{const G=!b.current;if(j.target===j.currentTarget&&G&&!_){const te=new CustomEvent(ys,My);if(j.currentTarget.dispatchEvent(te),!te.defaultPrevented){const ue=F().filter(E=>E.focusable),x=ue.find(E=>E.active),R=ue.find(E=>E.id===g),k=[x,R,...ue].filter(Boolean).map(E=>E.ref.current);Cy(k,d)}}b.current=!1}),onBlur:be(t.onBlur,()=>v(!1))})})}),Iy="RovingFocusGroupItem",Py=y.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:a=!1,tabStopId:o,...i}=t,s=Ht(),l=o||s,c=Ny(Iy,r),d=c.currentTabStopId===l,u=Td(r),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return y.useEffect(()=>{if(n)return h(),()=>p()},[n,h,p]),w.jsx(_s.ItemSlot,{scope:r,id:l,focusable:n,active:a,children:w.jsx(Ve.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...i,ref:e,onMouseDown:be(t.onMouseDown,f=>{n?c.onItemFocus(l):f.preventDefault()}),onFocus:be(t.onFocus,()=>c.onItemFocus(l)),onKeyDown:be(t.onKeyDown,f=>{if(f.key==="Tab"&&f.shiftKey){c.onItemShiftTab();return}if(f.target!==f.currentTarget)return;const g=y1(f,c.orientation,c.dir);if(g!==void 0){if(f.metaKey||f.ctrlKey||f.altKey||f.shiftKey)return;f.preventDefault();let m=u().filter(_=>_.focusable).map(_=>_.ref.current);if(g==="last")m.reverse();else if(g==="prev"||g==="next"){g==="prev"&&m.reverse();const _=m.indexOf(f.currentTarget);m=c.loop?_1(m,_+1):m.slice(_+1)}setTimeout(()=>Cy(m))}})})})});Py.displayName=Iy;var m1={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function g1(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function y1(t,e,r){const n=g1(t.key,r);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return m1[n]}function Cy(t,e=!1){const r=document.activeElement;for(const n of t)if(n===r||(n.focus({preventScroll:e}),document.activeElement!==r))return}function _1(t,e){return t.map((r,n)=>t[(e+n)%t.length])}let vs,jy,Fd,Ly,Dy,$y,fa,ma,zy,Uy,Kr,ga,Rd,Od,Nr,By,ya,Nd;Nf=Md,ap=Py,vs=["Enter"," "],jy=["ArrowDown","PageUp","Home"],Fd=["ArrowUp","PageDown","End"],Ly=[...jy,...Fd],Dy={ltr:[...vs,"ArrowRight"],rtl:[...vs,"ArrowLeft"]},$y={ltr:["ArrowLeft"],rtl:["ArrowRight"]},fa="Menu",[ma,zy,Uy]=p0(fa),[Kr,Ll]=fi(fa,[Uy,so,gc]),ga=so(),Rd=gc(),[Od,Nr]=Kr(fa),[By,ya]=Kr(fa),Nd=t=>{const{__scopeMenu:e,open:r=!1,children:n,dir:a,onOpenChange:o,modal:i=!0}=t,s=ga(e),[l,c]=y.useState(null),d=y.useRef(!1),u=Vn(o),h=yc(a);return y.useEffect(()=>{const p=()=>{d.current=!0,document.addEventListener("pointerdown",f,{capture:!0,once:!0}),document.addEventListener("pointermove",f,{capture:!0,once:!0})},f=()=>d.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",f,{capture:!0}),document.removeEventListener("pointermove",f,{capture:!0})}},[]),w.jsx(bi,{...s,children:w.jsx(Od,{scope:e,open:r,onOpenChange:u,content:l,onContentChange:c,children:w.jsx(By,{scope:e,onClose:y.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:h,modal:i,children:n})})})},Nd.displayName=fa;var v1="MenuAnchor",Id=y.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,a=ga(r);return w.jsx(zl,{...a,...n,ref:e})});Id.displayName=v1;var Pd="MenuPortal",[w1,Hy]=Kr(Pd,{forceMount:void 0}),Wy=t=>{const{__scopeMenu:e,forceMount:r,children:n,container:a}=t,o=Nr(Pd,e);return w.jsx(w1,{scope:e,forceMount:r,children:w.jsx(kr,{present:r||o.open,children:w.jsx(tp,{asChild:!0,container:a,children:n})})})};Wy.displayName=Pd;var Ct="MenuContent",[b1,Cd]=Kr(Ct),Gy=y.forwardRef((t,e)=>{const r=Hy(Ct,t.__scopeMenu),{forceMount:n=r.forceMount,...a}=t,o=Nr(Ct,t.__scopeMenu),i=ya(Ct,t.__scopeMenu);return w.jsx(ma.Provider,{scope:t.__scopeMenu,children:w.jsx(kr,{present:n||o.open,children:w.jsx(ma.Slot,{scope:t.__scopeMenu,children:i.modal?w.jsx(E1,{...a,ref:e}):w.jsx(S1,{...a,ref:e})})})})}),E1=y.forwardRef((t,e)=>{const r=Nr(Ct,t.__scopeMenu),n=y.useRef(null),a=yt(e,n);return y.useEffect(()=>{const o=n.current;if(o)return Cl(o)},[]),w.jsx(jd,{...t,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:be(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),S1=y.forwardRef((t,e)=>{const r=Nr(Ct,t.__scopeMenu);return w.jsx(jd,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),jd=y.forwardRef((t,e)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...g}=t,m=Nr(Ct,r),_=ya(Ct,r),v=ga(r),A=Rd(r),F=zy(r),[b,D]=y.useState(null),B=y.useRef(null),j=yt(e,B,m.onContentChange),G=y.useRef(0),te=y.useRef(""),ue=y.useRef(0),x=y.useRef(null),R=y.useRef("right"),k=y.useRef(0),E=f?vi:y.Fragment,H=f?{as:gn,allowPinchZoom:!0}:void 0,N=P=>{var Dt,Rt;const Z=te.current+P,ne=F().filter(Fe=>!Fe.disabled),le=document.activeElement,ye=(Dt=ne.find(Fe=>Fe.ref.current===le))==null?void 0:Dt.textValue,we=ne.map(Fe=>Fe.textValue),$e=C1(we,Z,ye),Qe=(Rt=ne.find(Fe=>Fe.textValue===$e))==null?void 0:Rt.ref.current;(function Fe(ut){te.current=ut,window.clearTimeout(G.current),ut!==""&&(G.current=window.setTimeout(()=>Fe(""),1e3))})(Z),Qe&&setTimeout(()=>Qe.focus())};y.useEffect(()=>()=>window.clearTimeout(G.current),[]),Dl();const C=y.useCallback(P=>{var Z,ne;return R.current===((Z=x.current)==null?void 0:Z.side)&&L1(P,(ne=x.current)==null?void 0:ne.area)},[]);return w.jsx(b1,{scope:r,searchRef:te,onItemEnter:y.useCallback(P=>{C(P)&&P.preventDefault()},[C]),onItemLeave:y.useCallback(P=>{var Z;C(P)||((Z=B.current)==null||Z.focus(),D(null))},[C]),onTriggerLeave:y.useCallback(P=>{C(P)&&P.preventDefault()},[C]),pointerGraceTimerRef:ue,onPointerGraceIntentChange:y.useCallback(P=>{x.current=P},[]),children:w.jsx(E,{...H,children:w.jsx(wi,{asChild:!0,trapped:a,onMountAutoFocus:be(o,P=>{var Z;P.preventDefault(),(Z=B.current)==null||Z.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:w.jsx(ep,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,children:w.jsx(Nf,{asChild:!0,...A,dir:_.dir,orientation:"vertical",loop:n,currentTabStopId:b,onCurrentTabStopIdChange:D,onEntryFocus:be(l,P=>{_.isUsingKeyboardRef.current||P.preventDefault()}),preventScrollOnEntryFocus:!0,children:w.jsx(Ul,{role:"menu","aria-orientation":"vertical","data-state":c_(m.open),"data-radix-menu-content":"",dir:_.dir,...v,...g,ref:j,style:{outline:"none",...g.style},onKeyDown:be(g.onKeyDown,P=>{const Z=P.target.closest("[data-radix-menu-content]")===P.currentTarget,ne=P.ctrlKey||P.altKey||P.metaKey,le=P.key.length===1;Z&&(P.key==="Tab"&&P.preventDefault(),!ne&&le&&N(P.key));const ye=B.current;if(P.target!==ye||!Ly.includes(P.key))return;P.preventDefault();const we=F().filter($e=>!$e.disabled).map($e=>$e.ref.current);Fd.includes(P.key)&&we.reverse(),I1(we)}),onBlur:be(t.onBlur,P=>{P.currentTarget.contains(P.target)||(window.clearTimeout(G.current),te.current="")}),onPointerMove:be(t.onPointerMove,Oo(P=>{const Z=P.target,ne=k.current!==P.clientX;if(P.currentTarget.contains(Z)&&ne){const le=P.clientX>k.current?"right":"left";R.current=le,k.current=P.clientX}}))})})})})})})});Gy.displayName=Ct;var x1="MenuGroup",Ld=y.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return w.jsx(Ve.div,{role:"group",...n,ref:e})});Ld.displayName=x1;var k1="MenuLabel",qy=y.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return w.jsx(Ve.div,{...n,ref:e})});qy.displayName=k1;var ws="MenuItem",Vy="menu.itemSelect",bs=y.forwardRef((t,e)=>{const{disabled:r=!1,onSelect:n,...a}=t,o=y.useRef(null),i=ya(ws,t.__scopeMenu),s=Cd(ws,t.__scopeMenu),l=yt(e,o),c=y.useRef(!1),d=()=>{const u=o.current;if(!r&&u){const h=new CustomEvent(Vy,{bubbles:!0,cancelable:!0});u.addEventListener(Vy,p=>n==null?void 0:n(p),{once:!0}),JN(u,h),h.defaultPrevented?c.current=!1:i.onClose()}};return w.jsx(Zy,{...a,ref:l,disabled:r,onClick:be(t.onClick,d),onPointerDown:u=>{var h;(h=t.onPointerDown)==null||h.call(t,u),c.current=!0},onPointerUp:be(t.onPointerUp,u=>{var h;c.current||((h=u.currentTarget)==null||h.click())}),onKeyDown:be(t.onKeyDown,u=>{const h=s.searchRef.current!=="";r||h&&u.key===" "||vs.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});bs.displayName=ws;var Zy=y.forwardRef((t,e)=>{const{__scopeMenu:r,disabled:n=!1,textValue:a,...o}=t,i=Cd(ws,r),s=Rd(r),l=y.useRef(null),c=yt(e,l),[d,u]=y.useState(!1),[h,p]=y.useState("");return y.useEffect(()=>{const f=l.current;f&&p((f.textContent??"").trim())},[o.children]),w.jsx(ma.ItemSlot,{scope:r,disabled:n,textValue:a??h,children:w.jsx(ap,{asChild:!0,...s,focusable:!n,children:w.jsx(Ve.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:c,onPointerMove:be(t.onPointerMove,Oo(f=>{n?i.onItemLeave(f):(i.onItemEnter(f),f.defaultPrevented||f.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:be(t.onPointerLeave,Oo(f=>i.onItemLeave(f))),onFocus:be(t.onFocus,()=>u(!0)),onBlur:be(t.onBlur,()=>u(!1))})})})}),A1="MenuCheckboxItem",Jy=y.forwardRef((t,e)=>{const{checked:r=!1,onCheckedChange:n,...a}=t;return w.jsx(e_,{scope:t.__scopeMenu,checked:r,children:w.jsx(bs,{role:"menuitemcheckbox","aria-checked":Es(r)?"mixed":r,...a,ref:e,"data-state":zd(r),onSelect:be(a.onSelect,()=>n==null?void 0:n(Es(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Jy.displayName=A1;var Ky="MenuRadioGroup",[T1,M1]=Kr(Ky,{value:void 0,onValueChange:()=>{}}),Yy=y.forwardRef((t,e)=>{const{value:r,onValueChange:n,...a}=t,o=Vn(n);return w.jsx(T1,{scope:t.__scopeMenu,value:r,onValueChange:o,children:w.jsx(Ld,{...a,ref:e})})});Yy.displayName=Ky;var Xy="MenuRadioItem",Qy=y.forwardRef((t,e)=>{const{value:r,...n}=t,a=M1(Xy,t.__scopeMenu),o=r===a.value;return w.jsx(e_,{scope:t.__scopeMenu,checked:o,children:w.jsx(bs,{role:"menuitemradio","aria-checked":o,...n,ref:e,"data-state":zd(o),onSelect:be(n.onSelect,()=>{var i;return(i=a.onValueChange)==null?void 0:i.call(a,r)},{checkForDefaultPrevented:!1})})})});Qy.displayName=Xy;var Dd="MenuItemIndicator",[e_,F1]=Kr(Dd,{checked:!1}),t_=y.forwardRef((t,e)=>{const{__scopeMenu:r,forceMount:n,...a}=t,o=F1(Dd,r);return w.jsx(kr,{present:n||Es(o.checked)||o.checked===!0,children:w.jsx(Ve.span,{...a,ref:e,"data-state":zd(o.checked)})})});t_.displayName=Dd;var R1="MenuSeparator",r_=y.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return w.jsx(Ve.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});r_.displayName=R1;var O1="MenuArrow",n_=y.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,a=ga(r);return w.jsx(Bl,{...a,...n,ref:e})});n_.displayName=O1;var $d="MenuSub",[N1,a_]=Kr($d),o_=t=>{const{__scopeMenu:e,children:r,open:n=!1,onOpenChange:a}=t,o=Nr($d,e),i=ga(e),[s,l]=y.useState(null),[c,d]=y.useState(null),u=Vn(a);return y.useEffect(()=>(o.open===!1&&u(!1),()=>u(!1)),[o.open,u]),w.jsx(bi,{...i,children:w.jsx(Od,{scope:e,open:n,onOpenChange:u,content:c,onContentChange:d,children:w.jsx(N1,{scope:e,contentId:Ht(),triggerId:Ht(),trigger:s,onTriggerChange:l,children:r})})})};o_.displayName=$d;var Ro="MenuSubTrigger",i_=y.forwardRef((t,e)=>{const r=Nr(Ro,t.__scopeMenu),n=ya(Ro,t.__scopeMenu),a=a_(Ro,t.__scopeMenu),o=Cd(Ro,t.__scopeMenu),i=y.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:l}=o,c={__scopeMenu:t.__scopeMenu},d=y.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return y.useEffect(()=>d,[d]),y.useEffect(()=>{const u=s.current;return()=>{window.clearTimeout(u),l(null)}},[s,l]),w.jsx(Id,{asChild:!0,...c,children:w.jsx(Zy,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":c_(r.open),...t,ref:f0(e,a.onTriggerChange),onClick:u=>{var h;(h=t.onClick)==null||h.call(t,u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:be(t.onPointerMove,Oo(u=>{o.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),d()},100))})),onPointerLeave:be(t.onPointerLeave,Oo(u=>{var p,f;d();const h=(p=r.content)==null?void 0:p.getBoundingClientRect();if(h){const g=(f=r.content)==null?void 0:f.dataset.side,m=g==="right",_=m?-5:5,v=h[m?"left":"right"],A=h[m?"right":"left"];o.onPointerGraceIntentChange({area:[{x:u.clientX+_,y:u.clientY},{x:v,y:h.top},{x:A,y:h.top},{x:A,y:h.bottom},{x:v,y:h.bottom}],side:g}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(u),u.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:be(t.onKeyDown,u=>{var p;const h=o.searchRef.current!=="";t.disabled||h&&u.key===" "||Dy[n.dir].includes(u.key)&&(r.onOpenChange(!0),(p=r.content)==null||p.focus(),u.preventDefault())})})})});i_.displayName=Ro;var s_="MenuSubContent",l_=y.forwardRef((t,e)=>{const r=Hy(Ct,t.__scopeMenu),{forceMount:n=r.forceMount,...a}=t,o=Nr(Ct,t.__scopeMenu),i=ya(Ct,t.__scopeMenu),s=a_(s_,t.__scopeMenu),l=y.useRef(null),c=yt(e,l);return w.jsx(ma.Provider,{scope:t.__scopeMenu,children:w.jsx(kr,{present:n||o.open,children:w.jsx(ma.Slot,{scope:t.__scopeMenu,children:w.jsx(jd,{id:s.contentId,"aria-labelledby":s.triggerId,...a,ref:c,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var u;i.isUsingKeyboardRef.current&&((u=l.current)==null||u.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:be(t.onFocusOutside,d=>{d.target!==s.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:be(t.onEscapeKeyDown,d=>{i.onClose(),d.preventDefault()}),onKeyDown:be(t.onKeyDown,d=>{var p;const u=d.currentTarget.contains(d.target),h=$y[i.dir].includes(d.key);u&&h&&(o.onOpenChange(!1),(p=s.trigger)==null||p.focus(),d.preventDefault())})})})})})});l_.displayName=s_;function c_(t){return t?"open":"closed"}function Es(t){return t==="indeterminate"}function zd(t){return Es(t)?"indeterminate":t?"checked":"unchecked"}function I1(t){const e=document.activeElement;for(const r of t)if(r===e||(r.focus(),document.activeElement!==e))return}function P1(t,e){return t.map((r,n)=>t[(e+n)%t.length])}function C1(t,e,r){const n=e.length>1&&Array.from(e).every(s=>s===e[0])?e[0]:e,a=r?t.indexOf(r):-1;let o=P1(t,Math.max(a,0));n.length===1&&(o=o.filter(s=>s!==r));const i=o.find(s=>s.toLowerCase().startsWith(n.toLowerCase()));return i!==r?i:void 0}function j1(t,e){const{x:r,y:n}=t;let a=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const s=e[o].x,l=e[o].y,c=e[i].x,d=e[i].y;l>n!=d>n&&r<(c-s)*(n-l)/(d-l)+s&&(a=!a)}return a}function L1(t,e){if(!e)return!1;const r={x:t.clientX,y:t.clientY};return j1(r,e)}function Oo(t){return e=>e.pointerType==="mouse"?t(e):void 0}let d_,Ss,u_,D1,lt,h_,Ud,Bd;qp=Nd,Ap=Id,Vp=Wy,Tp=Gy,Mp=Ld,Fp=qy,Rp=bs,Op=Jy,Np=Yy,Ip=Qy,Pp=t_,Cp=r_,jp=n_,d_=o_,hp=i_,Gp=l_,Ss="DropdownMenu",[u_,D1]=fi(Ss,[Ll]),lt=Ll(),[h_,Ud]=u_(Ss),Bd=t=>{const{__scopeDropdownMenu:e,children:r,dir:n,open:a,defaultOpen:o,onOpenChange:i,modal:s=!0}=t,l=lt(e),c=y.useRef(null),[d=!1,u]=Za({prop:a,defaultProp:o,onChange:i});return w.jsx(h_,{scope:e,triggerId:Ht(),triggerRef:c,contentId:Ht(),open:d,onOpenChange:u,onOpenToggle:y.useCallback(()=>u(h=>!h),[u]),modal:s,children:w.jsx(qp,{...l,open:d,onOpenChange:u,dir:n,modal:s,children:r})})},Bd.displayName=Ss;var p_="DropdownMenuTrigger",f_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...a}=t,o=Ud(p_,r),i=lt(r);return w.jsx(Ap,{asChild:!0,...i,children:w.jsx(Ve.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:f0(e,o.triggerRef),onPointerDown:be(t.onPointerDown,s=>{!n&&s.button===0&&s.ctrlKey===!1&&(o.onOpenToggle(),o.open||s.preventDefault())}),onKeyDown:be(t.onKeyDown,s=>{n||(["Enter"," "].includes(s.key)&&o.onOpenToggle(),s.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});f_.displayName=p_;var $1="DropdownMenuPortal",m_=t=>{const{__scopeDropdownMenu:e,...r}=t,n=lt(e);return w.jsx(Vp,{...n,...r})};m_.displayName=$1;var g_="DropdownMenuContent",y_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=Ud(g_,r),o=lt(r),i=y.useRef(!1);return w.jsx(Tp,{id:a.contentId,"aria-labelledby":a.triggerId,...o,...n,ref:e,onCloseAutoFocus:be(t.onCloseAutoFocus,s=>{var l;i.current||((l=a.triggerRef.current)==null||l.focus()),i.current=!1,s.preventDefault()}),onInteractOutside:be(t.onInteractOutside,s=>{const l=s.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!a.modal||d)&&(i.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});y_.displayName=g_;var z1="DropdownMenuGroup",__=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Mp,{...a,...n,ref:e})});__.displayName=z1;var U1="DropdownMenuLabel",v_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Fp,{...a,...n,ref:e})});v_.displayName=U1;var B1="DropdownMenuItem",w_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Rp,{...a,...n,ref:e})});w_.displayName=B1;var H1="DropdownMenuCheckboxItem",b_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Op,{...a,...n,ref:e})});b_.displayName=H1;var W1="DropdownMenuRadioGroup",E_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Np,{...a,...n,ref:e})});E_.displayName=W1;var G1="DropdownMenuRadioItem",S_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Ip,{...a,...n,ref:e})});S_.displayName=G1;var q1="DropdownMenuItemIndicator",x_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Pp,{...a,...n,ref:e})});x_.displayName=q1;var V1="DropdownMenuSeparator",k_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Cp,{...a,...n,ref:e})});k_.displayName=V1;var Z1="DropdownMenuArrow",J1=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(jp,{...a,...n,ref:e})});J1.displayName=Z1;var K1=t=>{const{__scopeDropdownMenu:e,children:r,open:n,onOpenChange:a,defaultOpen:o}=t,i=lt(e),[s=!1,l]=Za({prop:n,defaultProp:o,onChange:a});return w.jsx(d_,{...i,open:s,onOpenChange:l,children:r})},Y1="DropdownMenuSubTrigger",A_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(hp,{...a,...n,ref:e})});A_.displayName=Y1;var X1="DropdownMenuSubContent",T_=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return w.jsx(Gp,{...a,...n,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});T_.displayName=X1,Af=Bd,Tf=f_,kf=m_,rc=y_,xf=__,cc=v_,oc=w_,ic=b_,V0=E_,lc=S_,sc=x_,dc=k_,Z0=K1,nc=A_,ac=T_;const Q1=Af,eA=Tf,tA=xf,rA=y.forwardRef(({className:t,inset:e,children:r,...n},a)=>w.jsxs(nc,{ref:a,className:me("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...n,children:[r,w.jsx(Ye,{name:"chevron-right",className:"ml-auto"})]}));rA.displayName=nc.displayName;const nA=y.forwardRef(({className:t,...e},r)=>w.jsx(ac,{ref:r,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));nA.displayName=ac.displayName;const M_=y.forwardRef(({className:t,sideOffset:e=4,...r},n)=>w.jsx(kf,{children:w.jsx(rc,{ref:n,sideOffset:e,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));M_.displayName=rc.displayName;const F_=y.forwardRef(({className:t,inset:e,...r},n)=>w.jsx(oc,{ref:n,className:me("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...r}));F_.displayName=oc.displayName;const aA=y.forwardRef(({className:t,children:e,checked:r,...n},a)=>w.jsxs(ic,{ref:a,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...n,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(sc,{children:w.jsx(Ye,{name:"check",className:"h-4 w-4"})})}),e]}));aA.displayName=ic.displayName;const oA=y.forwardRef(({className:t,children:e,...r},n)=>w.jsxs(lc,{ref:n,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(sc,{children:w.jsx(Ye,{name:"circle",className:"h-4 w-4"})})}),e]}));oA.displayName=lc.displayName;const iA=y.forwardRef(({className:t,inset:e,...r},n)=>w.jsx(cc,{ref:n,className:me("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...r}));iA.displayName=cc.displayName;const sA=y.forwardRef(({className:t,...e},r)=>w.jsx(dc,{ref:r,className:me("-mx-1 my-1 h-px bg-muted",t),...e}));sA.displayName=dc.displayName;function lA(){const{t}=mi("sidebar"),{isMobile:e}=To();return w.jsx(eo,{children:w.jsx(Jn,{children:w.jsxs(Q1,{children:[w.jsx(eA,{asChild:!0,children:w.jsxs(ro,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[w.jsx("div",{children:w.jsx(Ye,{name:"settings",size:28,className:"pr-2"})}),w.jsx(Ye,{name:"chevrons-up-down",className:"ml-auto size-4"})]})}),w.jsx(M_,{className:"w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg",side:e?"bottom":"right",align:"end",sideOffset:4,children:w.jsx(tA,{children:w.jsxs(F_,{children:[w.jsx(Ye,{name:"sparkles"}),t("contact")]})})})]})})})}const cA={navMain:[{title:"playground.title",icon:w.jsx(Ye,{name:"square-terminal"}),isActive:!0,items:[{title:"playground.nodes",id:"nodes"},{title:"playground.connections",id:"connections"}]},{title:"model.title",url:"#",icon:w.jsx(Ye,{name:"bot"}),items:[{title:"model.llm",id:"llm"},{title:"model.embedding",id:"embedding"}]},{title:"tutorial.title",icon:w.jsx(Ye,{name:"book-open"}),items:[{title:"tutorial.get_started",id:"get-started"},{title:"tutorial.simple_workflow",id:"simple-workflow"},{title:"tutorial.ai_structured_output",id:"ai-structured-output"},{title:"tutorial.standalone_chat_application",id:"chat-application"},{title:"tutorial.standalone_editor_application",id:"editor-application"},{title:"tutorial.tool_calling",id:"tool-calling"},{title:"tutorial.vector_database",id:"vector-database"}]},{title:"application.title",icon:w.jsx(Ye,{name:"settings-2"}),items:[{title:"application.chat",id:"chat"},{title:"application.editor",id:"editor"},{title:"application.vslite",id:"vslite"}]}]};function dA({currentSession:t,...e}){return w.jsxs(bc,{collapsible:"offcanvas",...e,children:[w.jsx("div",{className:"h-1"}),w.jsxs(Sc,{children:[w.jsx(d1,{currentSession:t}),w.jsx(a1,{items:cA.navMain})]}),w.jsx(oy,{children:w.jsx(lA,{})}),w.jsx(ay,{})]})}const R_=t=>Symbol.iterator in t,O_=t=>"entries"in t,N_=(t,e)=>{const r=t instanceof Map?t:new Map(t.entries()),n=e instanceof Map?e:new Map(e.entries());if(r.size!==n.size)return!1;for(const[a,o]of r)if(!Object.is(o,n.get(a)))return!1;return!0},uA=(t,e)=>{const r=t[Symbol.iterator](),n=e[Symbol.iterator]();let a=r.next(),o=n.next();for(;!a.done&&!o.done;){if(!Object.is(a.value,o.value))return!1;a=r.next(),o=n.next()}return!!a.done&&!!o.done};function hA(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!R_(t)||!R_(e)?N_({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):O_(t)&&O_(e)?N_(t,e):uA(t,e)}vp=function(t){const e=KN.useRef();return r=>{const n=t(r);return hA(e.current,n)?e.current:e.current=n}},op=y.memo(t=>{const{loading:e,...r}=t;return w.jsx(zr,{...r,disabled:t.disabled||e,children:e?w.jsx(Ye,{name:"loader-circle",className:"animate-spin"}):t.children})});function pA({className:t,onProcess:e=async()=>(await new Promise(a=>setTimeout(a,2e3)),Math.random()>.5),processDuration:r=2e3,...n}){const[a,o]=y.useState(!1),[i,s]=y.useState(null),[l,c]=y.useState(!1),[,d]=y.useState(0);y.useEffect(()=>{if(a){const h=Date.now(),p=setInterval(()=>{const f=(Date.now()-h)/r*100;f>=100?(clearInterval(p),d(100)):d(f)},10);return()=>clearInterval(p)}},[a,r]);async function u(){if(a)return;o(!0),s(null),d(0),await new Promise(p=>setTimeout(p,r));const h=e?await e():!0;s(h),o(!1),c(!0),setTimeout(()=>{s(null),d(0),c(!1)},2e3)}return w.jsx(zr,{className:me("relative group","transition-all duration-300",a&&"cursor-wait",t),variant:"ghost",onClick:u,disabled:a,...n,children:w.jsx("div",{className:me("w-full flex items-center justify-center gap-2",l&&"animate-[scale_300ms_ease-in-out]"),children:i===null?w.jsx(w.Fragment,{children:w.jsx(Ye,{name:"forward",className:me("w-4 h-4 transition-transform duration-200","group-hover:scale-110",a&&"animate-bounce")})}):i?w.jsx(w.Fragment,{children:w.jsx(Ye,{name:"check",className:"w-4 h-4 text-green-500"})}):w.jsx(w.Fragment,{children:w.jsx(Ye,{name:"x",className:"w-4 h-4 text-red-500"})})})})}const yr="NOLLM",fA="0123456789abcdef",mA=[8,4,4,4,12];ql=function(){return mA.map(t=>gy(fA,t)()).join("-")};const gA=()=>{const t=Hr(e=>e.currentSession);return{exportSession:y.useCallback(async()=>{if(!(t!=null&&t.id))return;const e={},r={},n=Object.keys(Sd).filter(l=>l!=="Session");await Promise.all(n.map(l=>We(l).find({where:{session_id:t.id}}).then(c=>{c.map(d=>{r[d.id]=d.id}),e[l]=c}))),Object.keys(r).forEach(l=>{r[l]=`[ID_${ql()}]`});let a=JSON.stringify({[yr]:{key:t.id,session:Object.entries(t).reduce((l,[c,d])=>((typeof d!="object"||d===null)&&(l[c]=d),d===void 0&&(l[c]=null),l),{}),ids:Object.keys(r)},...e});Object.keys(r).forEach(l=>{a=a.replace(new RegExp(l,"g"),r[l])}),a=a.replace(new RegExp(t.id,"g"),"[SESSION_ID]");const o=new Blob([a],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=`${t.name}_${new Date}.json`,s.click()},[t])}},yA=()=>{const[t,e]=y.useState(!1),r=Kn(),n=y.useCallback((o,{idMap:i,newSessionId:s,replaceItem:l})=>{const c=o;return{...Object.keys(c).reduce((d,u)=>(c[u]&&typeof c[u]=="string"&&i[c[u]]?d[u]=i[c[u]]:u==="session_id"&&s?d[u]=s:d[u]=c[u],d),{}),...l||{}}},[]),a=y.useCallback(async o=>{try{e(!0);const i=Object.keys(Sd).filter(u=>u!==yr);if(!Object.keys(o[yr]).length||typeof o[yr]!="object")throw new Error("Missing Metadata");if(!("session"in o[yr])||!o[yr].session)throw new Error("Missing Session Metadata");const s=o[yr].session;if(!("ids"in o[yr]))throw new Error("Missing Session ID");const l=o[yr].ids.reduce((u,h)=>(u[h]=ql(),u),{}),c=Object.keys(o).filter(u=>u!==yr);if(!c.every(u=>i.includes(u)))throw new Error("Invalid JSON keys");if(!c.every(u=>Array.isArray(o[u])))throw new Error("Invalid JSON values");c.forEach(u=>{o[u].forEach(h=>{if("session_id"in h&&h.session_id!=="[SESSION_ID]")throw new Error("Invalid JSON values")})});const d=await We("Session").save(n(s,{idMap:l,newSessionId:"",replaceItem:{id:void 0}}));if(!d)throw new Error("Failed to import session");await Promise.all(i.map(u=>{const h=o[u];if(!h||!h.length)return Promise.resolve();const p=h.map(f=>n(f,{idMap:l,newSessionId:d.id}));return We(u).save(p)})),d.type===St.Whiteboard?r(it("whiteboard",{sessionId:d.id})):d.type===St.StandaloneApp&&r(it("application",{applicationId:d.id}))}finally{e(!1)}},[r,n]);return{loading:t,importSession:a}};function _A(){const{t}=mi("tooltips"),e=fr(),r=kl(h=>h.setTheme),n=kl(h=>h.theme),{exportSession:a}=gA(),{loading:o,importSession:i}=yA(),s=y.useRef(null),l=y.useCallback(()=>{r(n==="dark"?"light":"dark")},[n,r]),c=y.useCallback(async()=>{try{return await a(),!0}catch(h){return Ml("Export Session",h),!1}},[a]),d=y.useCallback(async h=>{var p;try{const f=(p=h.target.files)==null?void 0:p[0];if(!f)return;const g=await new Promise((m,_)=>{const v=new FileReader;v.onload=A=>{var F;try{const b=(F=A.target)==null?void 0:F.result;m(JSON.parse(b))}catch(b){_(b)}},v.onerror=A=>{_(A)},v.readAsText(f)});await i(g)}catch(f){return Ml("Import Session",f),!1}},[i]),u=y.useMemo(()=>{if(e.pathname.includes(it("whiteboard")))return t("whiteboard");if(e.pathname.includes(it("application")))return t("apllication")},[e.pathname,t]);return w.jsxs("header",{className:"flex h-14 shrink-0 items-center gap-2 transition-[width,height] ease-linear justify-between",children:[w.jsxs("div",{className:"flex items-center gap-2 px-4",children:[w.jsx(ny,{}),w.jsx(yi,{children:u})]}),w.jsx("div",{className:"flex items-center pl-4 pr-2",children:w.jsxs(fc,{children:[w.jsxs(Qn,{children:[w.jsx(ea,{children:w.jsxs(op,{loading:o,variant:"ghost",onClick:()=>{var h;return(h=s.current)==null?void 0:h.click()},children:[w.jsx(Ye,{size:18,name:"import"}),w.jsx("input",{ref:s,type:"file",accept:".json",onChange:d,className:"hidden"},`${Date.now()}`)]})}),w.jsx(En,{children:w.jsx("p",{children:t("import")})})]}),w.jsxs(Qn,{children:[w.jsx(ea,{children:w.jsx(pA,{onProcess:c})}),w.jsx(En,{children:w.jsx("p",{children:t("export")})})]}),w.jsxs(Qn,{children:[w.jsx(ea,{children:w.jsx(zr,{disabled:o,onClick:l,variant:"ghost",children:w.jsx(Ye,{size:18,name:n==="dark"?"moon":"sun"})})}),w.jsx(En,{children:w.jsx("p",{children:t("theme")})})]}),w.jsxs(Qn,{children:[w.jsx(ea,{children:w.jsx(zr,{variant:"link",children:w.jsx("a",{referrerPolicy:"no-referrer",target:"_blank",href:"https://github.com/zrg-team/NoLLMChat",children:w.jsx(Ye,{size:18,name:"github"})})})}),w.jsx(En,{children:w.jsx("p",{children:"https://github.com/zrg-team/NoLLMChat"})})]})]})})]})}function I_({requiredSession:t}){const e=dm(),r=Kn(),n=fr(),a=y.useRef(n),o=Hr(d=>d.currentSession),i=Hr(d=>d.setCurrentSession),s=Hr(d=>d.setToDefaultSession),{error:l,ready:c}=Hr(vp(d=>({error:d.error,ready:d.ready})));return a.current=n,y.useEffect(()=>{!(o!=null&&o.id)||!t||(n.pathname.includes(it("whiteboard"))?e.sessionId?e.sessionId&&e.sessionId!==(o==null?void 0:o.id)&&i(e.sessionId):r(it("whiteboard",{sessionId:o==null?void 0:o.id})):n.pathname.includes(it("application"))&&(e.applicationId?e.applicationId&&e.applicationId!==(o==null?void 0:o.id)&&i(e.applicationId):r(it("application",{applicationId:o==null?void 0:o.id}))))},[o==null?void 0:o.id,n.pathname,r,e.applicationId,e.sessionId,t,i]),y.useEffect(()=>{t&&i(e.sessionId||e.applicationId).then(d=>{if(!d)return s(n.pathname.includes(it("whiteboard"))?St.Whiteboard:St.StandaloneApp);uy().has("flow")&&d.type===St.StandaloneApp||(d.type===St.StandaloneApp&&a.current.pathname.includes(it("whiteboard").replace("/",""))?r(it("application",{applicationId:d.id})):d.type===St.Whiteboard&&a.current.pathname.includes(it("application").replace("/",""))&&r(it("whiteboard",{sessionId:d.id})))})},[r,e.applicationId,e.sessionId,t,i,s]),c?w.jsxs(Fl,{defaultOpen:!1,children:[w.jsx(dA,{currentSession:o}),w.jsxs(Rl,{className:"max-h-screen overflow-hidden",children:[w.jsx(_A,{}),w.jsx(Ei,{className:"shrink-0"}),w.jsx("div",{className:"flex flex-1 flex-col p-0 m-0 overflow-y-auto",children:l?w.jsx(m0,{}):w.jsx(hS,{})})]})]}):null}Sn=class{constructor(t){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=t.pageContent!==void 0?t.pageContent.toString():"",this.metadata=t.metadata??{},this.id=t.id}};var Ne;(function(t){t.assertEqual=a=>{};function e(a){}t.assertIs=e;function r(a){throw new Error}t.assertNever=r,t.arrayToEnum=a=>{const o={};for(const i of a)o[i]=i;return o},t.getValidEnumValues=a=>{const o=t.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),i={};for(const s of o)i[s]=a[s];return t.objectValues(i)},t.objectValues=a=>t.objectKeys(a).map(function(o){return a[o]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const o=[];for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&o.push(i);return o},t.find=(a,o)=>{for(const i of a)if(o(i))return i},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,o=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}t.joinValues=n,t.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(Ne||(Ne={}));var P_;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(P_||(P_={}));const se=Ne.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Yr=t=>{switch(typeof t){case"undefined":return se.undefined;case"string":return se.string;case"number":return Number.isNaN(t)?se.nan:se.number;case"boolean":return se.boolean;case"function":return se.function;case"bigint":return se.bigint;case"symbol":return se.symbol;case"object":return Array.isArray(t)?se.array:t===null?se.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?se.promise:typeof Map<"u"&&t instanceof Map?se.map:typeof Set<"u"&&t instanceof Set?se.set:typeof Date<"u"&&t instanceof Date?se.date:se.object;default:return se.unknown}},Y=Ne.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ir extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){const r=e||function(o){return o.message},n={_errors:[]},a=o=>{for(const i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let s=n,l=0;for(;l<i.path.length;){const c=i.path[l];l===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(r(i))):s[c]=s[c]||{_errors:[]},s=s[c],l++}}};return a(this),n}static assert(e){if(!(e instanceof Ir))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ne.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},n=[];for(const a of this.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(e(a))):n.push(e(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Ir.create=t=>new Ir(t);const Hd=(t,e)=>{let r;switch(t.code){case Y.invalid_type:t.received===se.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case Y.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Ne.jsonStringifyReplacer)}`;break;case Y.unrecognized_keys:r=`Unrecognized key(s) in object: ${Ne.joinValues(t.keys,", ")}`;break;case Y.invalid_union:r="Invalid input";break;case Y.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Ne.joinValues(t.options)}`;break;case Y.invalid_enum_value:r=`Invalid enum value. Expected ${Ne.joinValues(t.options)}, received '${t.received}'`;break;case Y.invalid_arguments:r="Invalid function arguments";break;case Y.invalid_return_type:r="Invalid function return type";break;case Y.invalid_date:r="Invalid date";break;case Y.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Ne.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case Y.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case Y.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case Y.custom:r="Invalid input";break;case Y.invalid_intersection_types:r="Intersection results could not be merged";break;case Y.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case Y.not_finite:r="Number must be finite";break;default:r=e.defaultError,Ne.assertNever(t)}return{message:r}};let vA=Hd;function wA(){return vA}const bA=t=>{const{data:e,path:r,errorMaps:n,issueData:a}=t,o=[...r,...a.path||[]],i={...a,path:o};if(a.message!==void 0)return{...a,path:o,message:a.message};let s="";const l=n.filter(c=>!!c).slice().reverse();for(const c of l)s=c(i,{data:e,defaultError:s}).message;return{...a,path:o,message:s}};function re(t,e){const r=wA(),n=bA({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Hd?void 0:Hd].filter(a=>!!a)});t.common.issues.push(n)}class Tt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const a of r){if(a.status==="aborted")return ve;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){const n=[];for(const a of r){const o=await a.key,i=await a.value;n.push({key:o,value:i})}return Tt.mergeObjectSync(e,n)}static mergeObjectSync(e,r){const n={};for(const a of r){const{key:o,value:i}=a;if(o.status==="aborted"||i.status==="aborted")return ve;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(n[o.value]=i.value)}return{status:e.value,value:n}}}const ve=Object.freeze({status:"aborted"}),Wd=t=>({status:"dirty",value:t}),jt=t=>({status:"valid",value:t}),C_=t=>t.status==="aborted",j_=t=>t.status==="dirty",_a=t=>t.status==="valid",xs=t=>typeof Promise<"u"&&t instanceof Promise;var ce;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ce||(ce={}));class Xr{constructor(e,r,n,a){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const L_=(t,e)=>{if(_a(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Ir(t.common.issues);return this._error=r,this._error}}};function ke(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:n,description:a}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,i)=>{const{message:s}=t;return o.code==="invalid_enum_value"?{message:s??i.defaultError}:typeof i.data>"u"?{message:s??n??i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:s??r??i.defaultError}},description:a}}class Oe{get description(){return this._def.description}_getType(e){return Yr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Yr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Tt,ctx:{common:e.parent.common,data:e.data,parsedType:Yr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(xs(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Yr(e)},a=this._parseSync({data:e,path:n.path,parent:n});return L_(n,a)}"~validate"(e){var n,a;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Yr(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:r});return _a(o)?{value:o.value}:{issues:r.common.issues}}catch(o){(a=(n=o==null?void 0:o.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(o=>_a(o)?{value:o.value}:{issues:r.common.issues})}async parseAsync(e,r){const n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Yr(e)},a=this._parse({data:e,path:n.path,parent:n}),o=await(xs(a)?a:Promise.resolve(a));return L_(n,o)}refine(e,r){const n=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,o)=>{const i=e(a),s=()=>o.addIssue({code:Y.custom,...n(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(s(),!1)):i?!0:(s(),!1)})}refinement(e,r){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof r=="function"?r(n,a):r),!1))}_refinement(e){return new ba({schema:this,typeName:Q.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return tn.create(this,this._def)}nullable(){return Ea.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return _r.create(this)}promise(){return Ms.create(this,this._def)}or(e){return As.create([this,e],this._def)}and(e){return Ts.create(this,e,this._def)}transform(e){return new ba({...ke(this._def),schema:this,typeName:Q.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new Zd({...ke(this._def),innerType:this,defaultValue:r,typeName:Q.ZodDefault})}brand(){return new WA({typeName:Q.ZodBranded,type:this,...ke(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new Jd({...ke(this._def),innerType:this,catchValue:r,typeName:Q.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Kd.create(this,e)}readonly(){return Yd.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const EA=/^c[^\s-]{8,}$/i,SA=/^[0-9a-z]+$/,xA=/^[0-9A-HJKMNP-TV-Z]{26}$/i,kA=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,AA=/^[a-z0-9_-]{21}$/i,TA=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,MA=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,FA=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,RA="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Gd;const OA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,NA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,IA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,PA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,CA=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,jA=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,D_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",LA=new RegExp(`^${D_}$`);function $_(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function DA(t){return new RegExp(`^${$_(t)}$`)}function $A(t){let e=`${D_}T${$_(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function zA(t,e){return!!((e==="v4"||!e)&&OA.test(t)||(e==="v6"||!e)&&IA.test(t))}function UA(t,e){if(!TA.test(t))return!1;try{const[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function BA(t,e){return!!((e==="v4"||!e)&&NA.test(t)||(e==="v6"||!e)&&PA.test(t))}class Qr extends Oe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==se.string){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_type,expected:se.string,received:a.parsedType}),ve}const r=new Tt;let n;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const o=e.data.length>a.value,i=e.data.length<a.value;(o||i)&&(n=this._getOrReturnCtx(e,n),o?re(n,{code:Y.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):i&&re(n,{code:Y.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")FA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"email",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Gd||(Gd=new RegExp(RA,"u")),Gd.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"emoji",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")kA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"uuid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")AA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"nanoid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")EA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"cuid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")SA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"cuid2",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")xA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"ulid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),re(n,{validation:"url",code:Y.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"regex",code:Y.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?$A(a).test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?LA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?DA(a).test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?MA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"duration",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?zA(e.data,a.version)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"ip",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?UA(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"jwt",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?BA(e.data,a.version)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"cidr",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?CA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"base64",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?jA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"base64url",code:Y.invalid_string,message:a.message}),r.dirty()):Ne.assertNever(a);return{status:r.value,value:e.data}}_regex(e,r,n){return this.refinement(a=>e.test(a),{validation:r,code:Y.invalid_string,...ce.errToObj(n)})}_addCheck(e){return new Qr({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ce.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ce.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ce.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ce.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ce.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ce.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ce.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ce.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ce.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ce.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ce.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ce.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ce.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...ce.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ce.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ce.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...ce.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...ce.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...ce.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...ce.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...ce.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...ce.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...ce.errToObj(r)})}nonempty(e){return this.min(1,ce.errToObj(e))}trim(){return new Qr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Qr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Qr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Qr.create=t=>new Qr({checks:[],typeName:Q.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...ke(t)});function HA(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=r>n?r:n,o=Number.parseInt(t.toFixed(a).replace(".","")),i=Number.parseInt(e.toFixed(a).replace(".",""));return o%i/10**a}class No extends Oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==se.number){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_type,expected:se.number,received:a.parsedType}),ve}let r;const n=new Tt;for(const a of this._def.checks)a.kind==="int"?Ne.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),re(r,{code:Y.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?HA(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),re(r,{code:Y.not_finite,message:a.message}),n.dirty()):Ne.assertNever(a);return{status:n.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,ce.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ce.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ce.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ce.toString(r))}setLimit(e,r,n,a){return new No({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ce.toString(a)}]})}_addCheck(e){return new No({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ce.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ce.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ce.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:ce.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ce.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ce.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ne.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}}No.create=t=>new No({checks:[],typeName:Q.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...ke(t)});class Io extends Oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==se.bigint)return this._getInvalidInput(e);let r;const n=new Tt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):Ne.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.bigint,received:r.parsedType}),ve}gte(e,r){return this.setLimit("min",e,!0,ce.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ce.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ce.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ce.toString(r))}setLimit(e,r,n,a){return new Io({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ce.toString(a)}]})}_addCheck(e){return new Io({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ce.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ce.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Io.create=t=>new Io({checks:[],typeName:Q.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...ke(t)});class z_ extends Oe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==se.boolean){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.boolean,received:r.parsedType}),ve}return jt(e.data)}}z_.create=t=>new z_({typeName:Q.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...ke(t)});class ks extends Oe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==se.date){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_type,expected:se.date,received:a.parsedType}),ve}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_date}),ve}const r=new Tt;let n;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Ne.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ks({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:ce.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:ce.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}ks.create=t=>new ks({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Q.ZodDate,...ke(t)});class U_ extends Oe{_parse(e){if(this._getType(e)!==se.symbol){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.symbol,received:r.parsedType}),ve}return jt(e.data)}}U_.create=t=>new U_({typeName:Q.ZodSymbol,...ke(t)});class B_ extends Oe{_parse(e){if(this._getType(e)!==se.undefined){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.undefined,received:r.parsedType}),ve}return jt(e.data)}}B_.create=t=>new B_({typeName:Q.ZodUndefined,...ke(t)});class H_ extends Oe{_parse(e){if(this._getType(e)!==se.null){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.null,received:r.parsedType}),ve}return jt(e.data)}}H_.create=t=>new H_({typeName:Q.ZodNull,...ke(t)});class qd extends Oe{constructor(){super(...arguments),this._any=!0}_parse(e){return jt(e.data)}}qd.create=t=>new qd({typeName:Q.ZodAny,...ke(t)});class W_ extends Oe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return jt(e.data)}}W_.create=t=>new W_({typeName:Q.ZodUnknown,...ke(t)});class en extends Oe{_parse(e){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.never,received:r.parsedType}),ve}}en.create=t=>new en({typeName:Q.ZodNever,...ke(t)});class G_ extends Oe{_parse(e){if(this._getType(e)!==se.undefined){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.void,received:r.parsedType}),ve}return jt(e.data)}}G_.create=t=>new G_({typeName:Q.ZodVoid,...ke(t)});class _r extends Oe{_parse(e){const{ctx:r,status:n}=this._processInputParams(e),a=this._def;if(r.parsedType!==se.array)return re(r,{code:Y.invalid_type,expected:se.array,received:r.parsedType}),ve;if(a.exactLength!==null){const i=r.data.length>a.exactLength.value,s=r.data.length<a.exactLength.value;(i||s)&&(re(r,{code:i?Y.too_big:Y.too_small,minimum:s?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(re(r,{code:Y.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(re(r,{code:Y.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,s)=>a.type._parseAsync(new Xr(r,i,r.path,s)))).then(i=>Tt.mergeArray(n,i));const o=[...r.data].map((i,s)=>a.type._parseSync(new Xr(r,i,r.path,s)));return Tt.mergeArray(n,o)}get element(){return this._def.type}min(e,r){return new _r({...this._def,minLength:{value:e,message:ce.toString(r)}})}max(e,r){return new _r({...this._def,maxLength:{value:e,message:ce.toString(r)}})}length(e,r){return new _r({...this._def,exactLength:{value:e,message:ce.toString(r)}})}nonempty(e){return this.min(1,e)}}_r.create=(t,e)=>new _r({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Q.ZodArray,...ke(e)});function va(t){if(t instanceof Ze){const e={};for(const r in t.shape){const n=t.shape[r];e[r]=tn.create(va(n))}return new Ze({...t._def,shape:()=>e})}else return t instanceof _r?new _r({...t._def,type:va(t.element)}):t instanceof tn?tn.create(va(t.unwrap())):t instanceof Ea?Ea.create(va(t.unwrap())):t instanceof Pn?Pn.create(t.items.map(e=>va(e))):t}class Ze extends Oe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Ne.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==se.object){const l=this._getOrReturnCtx(e);return re(l,{code:Y.invalid_type,expected:se.object,received:l.parsedType}),ve}const{status:r,ctx:n}=this._processInputParams(e),{shape:a,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof en&&this._def.unknownKeys==="strip"))for(const l in n.data)o.includes(l)||i.push(l);const s=[];for(const l of o){const c=a[l],d=n.data[l];s.push({key:{status:"valid",value:l},value:c._parse(new Xr(n,d,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof en){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of i)s.push({key:{status:"valid",value:c},value:{status:"valid",value:n.data[c]}});else if(l==="strict")i.length>0&&(re(n,{code:Y.unrecognized_keys,keys:i}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of i){const d=n.data[c];s.push({key:{status:"valid",value:c},value:l._parse(new Xr(n,d,n.path,c)),alwaysSet:c in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of s){const d=await c.key,u=await c.value;l.push({key:d,value:u,alwaysSet:c.alwaysSet})}return l}).then(l=>Tt.mergeObjectSync(r,l)):Tt.mergeObjectSync(r,s)}get shape(){return this._def.shape()}strict(e){return ce.errToObj,new Ze({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var o,i;const a=((i=(o=this._def).errorMap)==null?void 0:i.call(o,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:ce.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new Ze({...this._def,unknownKeys:"strip"})}passthrough(){return new Ze({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ze({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ze({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Q.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new Ze({...this._def,catchall:e})}pick(e){const r={};for(const n of Ne.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Ze({...this._def,shape:()=>r})}omit(e){const r={};for(const n of Ne.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new Ze({...this._def,shape:()=>r})}deepPartial(){return va(this)}partial(e){const r={};for(const n of Ne.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?r[n]=a:r[n]=a.optional()}return new Ze({...this._def,shape:()=>r})}required(e){const r={};for(const n of Ne.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof tn;)a=a._def.innerType;r[n]=a}return new Ze({...this._def,shape:()=>r})}keyof(){return J_(Ne.objectKeys(this.shape))}}Ze.create=(t,e)=>new Ze({shape:()=>t,unknownKeys:"strip",catchall:en.create(),typeName:Q.ZodObject,...ke(e)}),Ze.strictCreate=(t,e)=>new Ze({shape:()=>t,unknownKeys:"strict",catchall:en.create(),typeName:Q.ZodObject,...ke(e)}),Ze.lazycreate=(t,e)=>new Ze({shape:t,unknownKeys:"strip",catchall:en.create(),typeName:Q.ZodObject,...ke(e)});class As extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e),n=this._def.options;function a(o){for(const s of o)if(s.result.status==="valid")return s.result;for(const s of o)if(s.result.status==="dirty")return r.common.issues.push(...s.ctx.common.issues),s.result;const i=o.map(s=>new Ir(s.ctx.common.issues));return re(r,{code:Y.invalid_union,unionErrors:i}),ve}if(r.common.async)return Promise.all(n.map(async o=>{const i={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(a);{let o;const i=[];for(const l of n){const c={...r,common:{...r.common,issues:[]},parent:null},d=l._parseSync({data:r.data,path:r.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!o&&(o={result:d,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(l=>new Ir(l));return re(r,{code:Y.invalid_union,unionErrors:s}),ve}}get options(){return this._def.options}}As.create=(t,e)=>new As({options:t,typeName:Q.ZodUnion,...ke(e)});function Vd(t,e){const r=Yr(t),n=Yr(e);if(t===e)return{valid:!0,data:t};if(r===se.object&&n===se.object){const a=Ne.objectKeys(e),o=Ne.objectKeys(t).filter(s=>a.indexOf(s)!==-1),i={...t,...e};for(const s of o){const l=Vd(t[s],e[s]);if(!l.valid)return{valid:!1};i[s]=l.data}return{valid:!0,data:i}}else if(r===se.array&&n===se.array){if(t.length!==e.length)return{valid:!1};const a=[];for(let o=0;o<t.length;o++){const i=t[o],s=e[o],l=Vd(i,s);if(!l.valid)return{valid:!1};a.push(l.data)}return{valid:!0,data:a}}else return r===se.date&&n===se.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Ts extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e),a=(o,i)=>{if(C_(o)||C_(i))return ve;const s=Vd(o.value,i.value);return s.valid?((j_(o)||j_(i))&&r.dirty(),{status:r.value,value:s.data}):(re(n,{code:Y.invalid_intersection_types}),ve)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,i])=>a(o,i)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Ts.create=(t,e,r)=>new Ts({left:t,right:e,typeName:Q.ZodIntersection,...ke(r)});class Pn extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==se.array)return re(n,{code:Y.invalid_type,expected:se.array,received:n.parsedType}),ve;if(n.data.length<this._def.items.length)return re(n,{code:Y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ve;!this._def.rest&&n.data.length>this._def.items.length&&(re(n,{code:Y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const a=[...n.data].map((o,i)=>{const s=this._def.items[i]||this._def.rest;return s?s._parse(new Xr(n,o,n.path,i)):null}).filter(o=>!!o);return n.common.async?Promise.all(a).then(o=>Tt.mergeArray(r,o)):Tt.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new Pn({...this._def,rest:e})}}Pn.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Pn({items:t,typeName:Q.ZodTuple,rest:null,...ke(e)})};class q_ extends Oe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==se.map)return re(n,{code:Y.invalid_type,expected:se.map,received:n.parsedType}),ve;const a=this._def.keyType,o=this._def.valueType,i=[...n.data.entries()].map(([s,l],c)=>({key:a._parse(new Xr(n,s,n.path,[c,"key"])),value:o._parse(new Xr(n,l,n.path,[c,"value"]))}));if(n.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const l of i){const c=await l.key,d=await l.value;if(c.status==="aborted"||d.status==="aborted")return ve;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),s.set(c.value,d.value)}return{status:r.value,value:s}})}else{const s=new Map;for(const l of i){const c=l.key,d=l.value;if(c.status==="aborted"||d.status==="aborted")return ve;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),s.set(c.value,d.value)}return{status:r.value,value:s}}}}q_.create=(t,e,r)=>new q_({valueType:e,keyType:t,typeName:Q.ZodMap,...ke(r)});class Po extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==se.set)return re(n,{code:Y.invalid_type,expected:se.set,received:n.parsedType}),ve;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(re(n,{code:Y.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(re(n,{code:Y.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const o=this._def.valueType;function i(l){const c=new Set;for(const d of l){if(d.status==="aborted")return ve;d.status==="dirty"&&r.dirty(),c.add(d.value)}return{status:r.value,value:c}}const s=[...n.data.values()].map((l,c)=>o._parse(new Xr(n,l,n.path,c)));return n.common.async?Promise.all(s).then(l=>i(l)):i(s)}min(e,r){return new Po({...this._def,minSize:{value:e,message:ce.toString(r)}})}max(e,r){return new Po({...this._def,maxSize:{value:e,message:ce.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Po.create=(t,e)=>new Po({valueType:t,minSize:null,maxSize:null,typeName:Q.ZodSet,...ke(e)});class V_ extends Oe{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}V_.create=(t,e)=>new V_({getter:t,typeName:Q.ZodLazy,...ke(e)});class Z_ extends Oe{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return re(r,{received:r.data,code:Y.invalid_literal,expected:this._def.value}),ve}return{status:"valid",value:e.data}}get value(){return this._def.value}}Z_.create=(t,e)=>new Z_({value:t,typeName:Q.ZodLiteral,...ke(e)});function J_(t,e){return new wa({values:t,typeName:Q.ZodEnum,...ke(e)})}class wa extends Oe{_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),n=this._def.values;return re(r,{expected:Ne.joinValues(n),received:r.parsedType,code:Y.invalid_type}),ve}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const r=this._getOrReturnCtx(e),n=this._def.values;return re(r,{received:r.data,code:Y.invalid_enum_value,options:n}),ve}return jt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return wa.create(e,{...this._def,...r})}exclude(e,r=this._def){return wa.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}}wa.create=J_;class K_ extends Oe{_parse(e){const r=Ne.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==se.string&&n.parsedType!==se.number){const a=Ne.objectValues(r);return re(n,{expected:Ne.joinValues(a),received:n.parsedType,code:Y.invalid_type}),ve}if(this._cache||(this._cache=new Set(Ne.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const a=Ne.objectValues(r);return re(n,{received:n.data,code:Y.invalid_enum_value,options:a}),ve}return jt(e.data)}get enum(){return this._def.values}}K_.create=(t,e)=>new K_({values:t,typeName:Q.ZodNativeEnum,...ke(e)});class Ms extends Oe{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==se.promise&&r.common.async===!1)return re(r,{code:Y.invalid_type,expected:se.promise,received:r.parsedType}),ve;const n=r.parsedType===se.promise?r.data:Promise.resolve(r.data);return jt(n.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}Ms.create=(t,e)=>new Ms({type:t,typeName:Q.ZodPromise,...ke(e)});class ba extends Oe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Q.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:n}=this._processInputParams(e),a=this._def.effect||null,o={addIssue:i=>{re(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),a.type==="preprocess"){const i=a.transform(n.data,o);if(n.common.async)return Promise.resolve(i).then(async s=>{if(r.value==="aborted")return ve;const l=await this._def.schema._parseAsync({data:s,path:n.path,parent:n});return l.status==="aborted"?ve:l.status==="dirty"||r.value==="dirty"?Wd(l.value):l});{if(r.value==="aborted")return ve;const s=this._def.schema._parseSync({data:i,path:n.path,parent:n});return s.status==="aborted"?ve:s.status==="dirty"||r.value==="dirty"?Wd(s.value):s}}if(a.type==="refinement"){const i=s=>{const l=a.refinement(s,o);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(n.common.async===!1){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ve:(s.status==="dirty"&&r.dirty(),i(s.value),{status:r.value,value:s.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>s.status==="aborted"?ve:(s.status==="dirty"&&r.dirty(),i(s.value).then(()=>({status:r.value,value:s.value}))))}if(a.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!_a(i))return ve;const s=a.transform(i.value,o);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:s}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>_a(i)?Promise.resolve(a.transform(i.value,o)).then(s=>({status:r.value,value:s})):ve);Ne.assertNever(a)}}ba.create=(t,e,r)=>new ba({schema:t,typeName:Q.ZodEffects,effect:e,...ke(r)}),ba.createWithPreprocess=(t,e,r)=>new ba({schema:e,effect:{type:"preprocess",transform:t},typeName:Q.ZodEffects,...ke(r)});class tn extends Oe{_parse(e){return this._getType(e)===se.undefined?jt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}tn.create=(t,e)=>new tn({innerType:t,typeName:Q.ZodOptional,...ke(e)});class Ea extends Oe{_parse(e){return this._getType(e)===se.null?jt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ea.create=(t,e)=>new Ea({innerType:t,typeName:Q.ZodNullable,...ke(e)});class Zd extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e);let n=r.data;return r.parsedType===se.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Zd.create=(t,e)=>new Zd({innerType:t,typeName:Q.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ke(e)});class Jd extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return xs(a)?a.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Ir(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ir(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Jd.create=(t,e)=>new Jd({innerType:t,typeName:Q.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ke(e)});class Y_ extends Oe{_parse(e){if(this._getType(e)!==se.nan){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.nan,received:r.parsedType}),ve}return{status:"valid",value:e.data}}}Y_.create=t=>new Y_({typeName:Q.ZodNaN,...ke(t)});class WA extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class Kd extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ve:a.status==="dirty"?(r.dirty(),Wd(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ve:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,r){return new Kd({in:e,out:r,typeName:Q.ZodPipeline})}}class Yd extends Oe{_parse(e){const r=this._def.innerType._parse(e),n=a=>(_a(a)&&(a.value=Object.freeze(a.value)),a);return xs(r)?r.then(a=>n(a)):n(r)}unwrap(){return this._def.innerType}}Yd.create=(t,e)=>new Yd({innerType:t,typeName:Q.ZodReadonly,...ke(e)}),Ze.lazycreate;var Q;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Q||(Q={}));let Xd;Qp=Qr.create,Xd=qd.create,en.create,_r.create,Xp=Ze.create,Ze.strictCreate,As.create,Ts.create,Pn.create,wa.create,Ms.create,tn.create,Ea.create;var Co={exports:{}},X_={},Qd,Q_;function GA(){if(Q_)return Qd;Q_=1;function t(e,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Qd=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var r=new Date().getTime();if(e&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,r){this._fn=e,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},r=null,n=0,a=0;a<this._errors.length;a++){var o=this._errors[a],i=o.message,s=(e[i]||0)+1;e[i]=s,s>=n&&(r=o,n=s)}return r},Qd}var ev;function qA(){return ev||(ev=1,function(t){var e=GA();t.operation=function(r){var n=t.timeouts(r);return new e(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},t.timeouts=function(r){if(r instanceof Array)return[].concat(r);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in r)n[a]=r[a];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],i=0;i<n.retries;i++)o.push(this.createTimeout(i,n));return r&&r.forever&&!o.length&&o.push(this.createTimeout(i,n)),o.sort(function(s,l){return s-l}),o},t.createTimeout=function(r,n){var a=n.randomize?Math.random()+1:1,o=Math.round(a*Math.max(n.minTimeout,1)*Math.pow(n.factor,r));return o=Math.min(o,n.maxTimeout),o},t.wrap=function(r,n,a){if(n instanceof Array&&(a=n,n=null),!a){a=[];for(var o in r)typeof r[o]=="function"&&a.push(o)}for(var i=0;i<a.length;i++){var s=a[i],l=r[s];r[s]=(function(c){var d=t.operation(n),u=Array.prototype.slice.call(arguments,1),h=u.pop();u.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(r,u)})}).bind(r,l),r[s].options=n}}}(X_)),X_}var tv,rv;function VA(){return rv||(rv=1,tv=qA()),tv}var nv;function ZA(){if(nv)return Co.exports;nv=1;const t=VA(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class r extends Error{constructor(s){super(),s instanceof Error?(this.originalError=s,{message:s}=s):(this.originalError=new Error(s),this.originalError.stack=this.stack),this.name="AbortError",this.message=s}}const n=(i,s,l)=>{const c=l.retries-(s-1);return i.attemptNumber=s,i.retriesLeft=c,i},a=i=>e.includes(i),o=(i,s)=>new Promise((l,c)=>{s={onFailedAttempt:()=>{},retries:10,...s};const d=t.operation(s);d.attempt(async u=>{try{l(await i(u))}catch(h){if(!(h instanceof Error)){c(new TypeError(`Non-error was thrown: "${h}". You should only throw errors.`));return}if(h instanceof r)d.stop(),c(h.originalError);else if(h instanceof TypeError&&!a(h.message))d.stop(),c(h);else{n(h,u,s);try{await s.onFailedAttempt(h)}catch(p){c(p);return}d.retry(h)||c(d.mainError())}}})});return Co.exports=o,Co.exports.default=o,Co.exports.AbortError=r,Co.exports}var JA=ZA();const Fs=Ja(JA),KA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Sa(t){return typeof t=="string"&&KA.test(t)}function YA(t){if(!Sa(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}for(var ct=[],eu=0;eu<256;++eu)ct.push((eu+256).toString(16).slice(1));function av(t,e=0){return(ct[t[e+0]]+ct[t[e+1]]+ct[t[e+2]]+ct[t[e+3]]+"-"+ct[t[e+4]]+ct[t[e+5]]+"-"+ct[t[e+6]]+ct[t[e+7]]+"-"+ct[t[e+8]]+ct[t[e+9]]+"-"+ct[t[e+10]]+ct[t[e+11]]+ct[t[e+12]]+ct[t[e+13]]+ct[t[e+14]]+ct[t[e+15]]).toLowerCase()}var Rs,XA=new Uint8Array(16);function QA(){if(!Rs&&(Rs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Rs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rs(XA)}function eT(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}var tT="6ba7b810-9dad-11d1-80b4-00c04fd430c8",rT="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function nT(t,e,r){function n(a,o,i,s){var l;if(typeof a=="string"&&(a=eT(a)),typeof o=="string"&&(o=YA(o)),((l=o)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+a.length);if(c.set(o),c.set(a,o.length),c=r(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,i){s=s||0;for(var d=0;d<16;++d)i[s+d]=c[d];return i}return av(c)}try{n.name=t}catch{}return n.DNS=tT,n.URL=rT,n}var aT=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ov={randomUUID:aT};function ht(t,e,r){if(ov.randomUUID&&!e&&!t)return ov.randomUUID();t=t||{};var n=t.random||(t.rng||QA)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,av(n)}function oT(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function tu(t,e){return t<<e|t>>>32-e}function iT(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var n=unescape(encodeURIComponent(t));t=[];for(var a=0;a<n.length;++a)t.push(n.charCodeAt(a))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,i=Math.ceil(o/16),s=new Array(i),l=0;l<i;++l){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=t[l*64+d*4]<<24|t[l*64+d*4+1]<<16|t[l*64+d*4+2]<<8|t[l*64+d*4+3];s[l]=c}s[i-1][14]=(t.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(t.length-1)*8&4294967295;for(var u=0;u<i;++u){for(var h=new Uint32Array(80),p=0;p<16;++p)h[p]=s[u][p];for(var f=16;f<80;++f)h[f]=tu(h[f-3]^h[f-8]^h[f-14]^h[f-16],1);for(var g=r[0],m=r[1],_=r[2],v=r[3],A=r[4],F=0;F<80;++F){var b=Math.floor(F/20),D=tu(g,5)+oT(b,m,_,v)+A+e[b]+h[F]>>>0;A=v,v=_,_=tu(m,30)>>>0,m=g,g=D}r[0]=r[0]+g>>>0,r[1]=r[1]+m>>>0,r[2]=r[2]+_>>>0,r[3]=r[3]+v>>>0,r[4]=r[4]+A>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}var iv=nT("v5",80,iT),Os={},sv={exports:{}},lv;function sT(){return lv||(lv=1,function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function o(l,c,d,u,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new a(d,u||l,h),f=r?r+c:c;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],p]:l._events[f].push(p):(l._events[f]=p,l._eventsCount++),l}function i(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(r?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},s.prototype.listeners=function(l){var c=r?r+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,h=d.length,p=new Array(h);u<h;u++)p[u]=d[u].fn;return p},s.prototype.listenerCount=function(l){var c=r?r+l:l,d=this._events[c];return d?d.fn?1:d.length:0},s.prototype.emit=function(l,c,d,u,h,p){var f=r?r+l:l;if(!this._events[f])return!1;var g=this._events[f],m=arguments.length,_,v;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,d),!0;case 4:return g.fn.call(g.context,c,d,u),!0;case 5:return g.fn.call(g.context,c,d,u,h),!0;case 6:return g.fn.call(g.context,c,d,u,h,p),!0}for(v=1,_=new Array(m-1);v<m;v++)_[v-1]=arguments[v];g.fn.apply(g.context,_)}else{var A=g.length,F;for(v=0;v<A;v++)switch(g[v].once&&this.removeListener(l,g[v].fn,void 0,!0),m){case 1:g[v].fn.call(g[v].context);break;case 2:g[v].fn.call(g[v].context,c);break;case 3:g[v].fn.call(g[v].context,c,d);break;case 4:g[v].fn.call(g[v].context,c,d,u);break;default:if(!_)for(F=1,_=new Array(m-1);F<m;F++)_[F-1]=arguments[F];g[v].fn.apply(g[v].context,_)}}return!0},s.prototype.on=function(l,c,d){return o(this,l,c,d,!1)},s.prototype.once=function(l,c,d){return o(this,l,c,d,!0)},s.prototype.removeListener=function(l,c,d,u){var h=r?r+l:l;if(!this._events[h])return this;if(!c)return i(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!u||p.once)&&(!d||p.context===d)&&i(this,h);else{for(var f=0,g=[],m=p.length;f<m;f++)(p[f].fn!==c||u&&!p[f].once||d&&p[f].context!==d)&&g.push(p[f]);g.length?this._events[h]=g.length===1?g[0]:g:i(this,h)}return this},s.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&i(this,c)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s}(sv)),sv.exports}var jo={exports:{}},cv,dv;function lT(){return dv||(dv=1,cv=(t,e)=>(e=e||(()=>{}),t.then(r=>new Promise(n=>{n(e())}).then(()=>r),r=>new Promise(n=>{n(e())}).then(()=>{throw r})))),cv}var uv;function cT(){if(uv)return jo.exports;uv=1;const t=lT();class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}const r=(n,a,o)=>new Promise((i,s)=>{if(typeof a!="number"||a<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(a===1/0){i(n);return}const l=setTimeout(()=>{if(typeof o=="function"){try{i(o())}catch(u){s(u)}return}const c=typeof o=="string"?o:`Promise timed out after ${a} milliseconds`,d=o instanceof Error?o:new e(c);typeof n.cancel=="function"&&n.cancel(),s(d)},a);t(n.then(i,s),()=>{clearTimeout(l)})});return jo.exports=r,jo.exports.default=r,jo.exports.TimeoutError=e,jo.exports}var Ns={},Is={},hv;function dT(){if(hv)return Is;hv=1,Object.defineProperty(Is,"__esModule",{value:!0});function t(e,r,n){let a=0,o=e.length;for(;o>0;){const i=o/2|0;let s=a+i;n(e[s],r)<=0?(a=++s,o-=i+1):o=i}return a}return Is.default=t,Is}var pv;function uT(){if(pv)return Ns;pv=1,Object.defineProperty(Ns,"__esModule",{value:!0});const t=dT();class e{constructor(){this._queue=[]}enqueue(n,a){a=Object.assign({priority:0},a);const o={priority:a.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=a.priority){this._queue.push(o);return}const i=t.default(this._queue,o,(s,l)=>l.priority-s.priority);this._queue.splice(i,0,o)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(a=>a.priority===n.priority).map(a=>a.run)}get size(){return this._queue.length}}return Ns.default=e,Ns}var fv;function hT(){if(fv)return Os;fv=1,Object.defineProperty(Os,"__esModule",{value:!0});const t=sT(),e=cT(),r=uT(),n=()=>{},a=new e.TimeoutError;class o extends t{constructor(s){var l,c,d,u;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,s=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:r.default},s),!(typeof s.intervalCap=="number"&&s.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(l=s.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""}\` (${typeof s.intervalCap})`);if(s.interval===void 0||!(Number.isFinite(s.interval)&&s.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(u=(d=s.interval)===null||d===void 0?void 0:d.toString())!==null&&u!==void 0?u:""}\` (${typeof s.interval})`);this._carryoverConcurrencyCount=s.carryoverConcurrencyCount,this._isIntervalIgnored=s.intervalCap===1/0||s.interval===0,this._intervalCap=s.intervalCap,this._interval=s.interval,this._queue=new s.queueClass,this._queueClass=s.queueClass,this.concurrency=s.concurrency,this._timeout=s.timeout,this._throwOnTimeout=s.throwOnTimeout===!0,this._isPaused=s.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const s=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-s;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const s=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),s&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(s){if(!(typeof s=="number"&&s>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${s}\` (${typeof s})`);this._concurrency=s,this._processQueue()}async add(s,l={}){return new Promise((c,d)=>{const u=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&l.timeout===void 0?s():e.default(Promise.resolve(s()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&d(a)});c(await h)}catch(h){d(h)}this._next()};this._queue.enqueue(u,l),this._tryToStartAnother(),this.emit("add")})}async addAll(s,l){return Promise.all(s.map(async c=>this.add(c,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(s=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),s()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(s=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),s()}})}get size(){return this._queue.size}sizeBy(s){return this._queue.filter(s).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(s){this._timeout=s}}return Os.default=o,Os}var pT=hT();const Pr=Ja(pT);function fT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mv={exports:{}},Xe=mv.exports={},vr,wr;function ru(){throw new Error("setTimeout has not been defined")}function nu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?vr=setTimeout:vr=ru}catch{vr=ru}try{typeof clearTimeout=="function"?wr=clearTimeout:wr=nu}catch{wr=nu}})();function gv(t){if(vr===setTimeout)return setTimeout(t,0);if((vr===ru||!vr)&&setTimeout)return vr=setTimeout,setTimeout(t,0);try{return vr(t,0)}catch{try{return vr.call(null,t,0)}catch{return vr.call(this,t,0)}}}function mT(t){if(wr===clearTimeout)return clearTimeout(t);if((wr===nu||!wr)&&clearTimeout)return wr=clearTimeout,clearTimeout(t);try{return wr(t)}catch{try{return wr.call(null,t)}catch{return wr.call(this,t)}}}var Cr=[],xa=!1,Cn,Ps=-1;function gT(){!xa||!Cn||(xa=!1,Cn.length?Cr=Cn.concat(Cr):Ps=-1,Cr.length&&yv())}function yv(){if(!xa){var t=gv(gT);xa=!0;for(var e=Cr.length;e;){for(Cn=Cr,Cr=[];++Ps<e;)Cn&&Cn[Ps].run();Ps=-1,e=Cr.length}Cn=null,xa=!1,mT(t)}}Xe.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];Cr.push(new _v(t,e)),Cr.length===1&&!xa&&gv(yv)};function _v(t,e){this.fun=t,this.array=e}_v.prototype.run=function(){this.fun.apply(null,this.array)},Xe.title="browser",Xe.browser=!0,Xe.env={},Xe.argv=[],Xe.version="",Xe.versions={};function jr(){}Xe.on=jr,Xe.addListener=jr,Xe.once=jr,Xe.off=jr,Xe.removeListener=jr,Xe.removeAllListeners=jr,Xe.emit=jr,Xe.prependListener=jr,Xe.prependOnceListener=jr,Xe.listeners=function(t){return[]},Xe.binding=function(t){throw new Error("process.binding is not supported")},Xe.cwd=function(){return"/"},Xe.chdir=function(t){throw new Error("process.chdir is not supported")},Xe.umask=function(){return 0};var yT=mv.exports;let au,ou;_t=fT(yT),au=()=>Yt("PROJECT")??nn("LANGCHAIN_SESSION")??"default",ou="0.3.34";var Lo={};let rn;const _T=()=>typeof window<"u"&&typeof window.document<"u",vT=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",wT=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),vv=()=>typeof Deno<"u",bT=()=>typeof _t<"u"&&typeof _t.versions<"u"&&typeof _t.versions.node<"u"&&!vv(),ET=()=>rn||(_T()?rn="browser":bT()?rn="node":vT()?rn="webworker":wT()?rn="jsdom":vv()?rn="deno":rn="other",rn);let iu;function wv(){if(iu===void 0){const t=ET(),e=kT();iu={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:ou,...e}}return iu}function ST(){const t=xT()||{},e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,a]of Object.entries(t))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof a=="string"&&!r.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[n]=a);return e}function xT(){try{return typeof _t<"u"&&Lo?Object.entries(Lo).reduce((t,[e,r])=>(t[e]=String(r),t),{}):void 0}catch{return}}function nn(t){try{return typeof _t<"u"?Lo==null?void 0:Lo[t]:void 0}catch{return}}function Yt(t){return nn(`LANGSMITH_${t}`)||nn(`LANGCHAIN_${t}`)}let su;function kT(){if(su!==void 0)return su;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const r of t){const n=nn(r);n!==void 0&&(e[r]=n)}return su=e,e}const AT=(...t)=>fetch(...t),bv=Symbol.for("ls:fetch_implementation"),TT=()=>{const t=globalThis[bv];return t?typeof t=="function"&&"Headers"in t&&"Request"in t&&"Response"in t:!1},he=t=>async(...e)=>{if(t||Yt("DEBUG")==="true"){const[n,a]=e;console.log(`\u2192 ${(a==null?void 0:a.method)||"GET"} ${n}`)}const r=await(globalThis[bv]??AT)(...e);return(t||Yt("DEBUG")==="true")&&console.log(`\u2190 ${r.status} ${r.statusText} ${r.url}`),r},MT=[400,401,403,404,405,406,407,408],FT=[409];let Ev=class{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.debug=t.debug,"default"in Pr?this.queue=new Pr.default({concurrency:this.maxConcurrency}):this.queue=new Pr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=t==null?void 0:t.onFailedResponseHook}call(t,...e){const r=this.onFailedResponseHook;return this.queue.add(()=>Fs(()=>t(...e).catch(n=>{throw n instanceof Error?n:new Error(n)}),{async onFailedAttempt(n){if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.message.startsWith("AbortError")||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const a=n==null?void 0:n.response,o=a==null?void 0:a.status;if(o){if(MT.includes(+o))throw n;if(FT.includes(+o))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){return t.signal?Promise.race([this.call(e,...r),new Promise((n,a)=>{var o;(o=t.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(e,...r)}fetch(...t){return this.call(()=>he(this.debug)(...t).then(e=>e.ok?e:Promise.reject(e)))}};function Sv(t){return typeof(t==null?void 0:t._getType)=="function"}function xv(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}function Ee(t,e){if(!Sa(t)){const r=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(r)}return t}const kv={};function Av(t){kv[t]||(console.warn(t),kv[t]=!0)}var lu={exports:{}},cu,Tv;function Cs(){if(Tv)return cu;Tv=1;const t="2.0.0",e=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return cu={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:r,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:t,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},cu}var du,Mv;function js(){if(Mv)return du;Mv=1;var t={};return du=typeof _t=="object"&&t&&t.NODE_DEBUG&&/\bsemver\b/i.test(t.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},du}var Fv;function Do(){return Fv||(Fv=1,function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=Cs(),o=js();e=t.exports={};const i=e.re=[],s=e.safeRe=[],l=e.src=[],c=e.t={};let d=0;const u="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[u,n]],p=g=>{for(const[m,_]of h)g=g.split(`${m}*`).join(`${m}{0,${_}}`).split(`${m}+`).join(`${m}{1,${_}}`);return g},f=(g,m,_)=>{const v=p(m),A=d++;o(g,A,m),c[g]=A,l[A]=m,i[A]=new RegExp(m,_?"g":void 0),s[A]=new RegExp(v,_?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${u}*`),f("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${u}+`),f("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),f("FULL",`^${l[c.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),f("LOOSE",`^${l[c.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),f("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),f("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),f("COERCERTL",l[c.COERCE],!0),f("COERCERTLFULL",l[c.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",f("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",f("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(lu,lu.exports)),lu.exports}var uu,Rv;function hu(){if(Rv)return uu;Rv=1;const t=Object.freeze({loose:!0}),e=Object.freeze({});return uu=r=>r?typeof r!="object"?t:r:e,uu}var pu,Ov;function Nv(){if(Ov)return pu;Ov=1;const t=/^[0-9]+$/,e=(r,n)=>{const a=t.test(r),o=t.test(n);return a&&o&&(r=+r,n=+n),r===n?0:a&&!o?-1:o&&!a?1:r<n?-1:1};return pu={compareIdentifiers:e,rcompareIdentifiers:(r,n)=>e(n,r)},pu}var fu,Iv;function pt(){if(Iv)return fu;Iv=1;const t=js(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:r}=Cs(),{safeRe:n,t:a}=Do(),o=hu(),{compareIdentifiers:i}=Nv();class s{constructor(c,d){if(d=o(d),c instanceof s){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);t("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const u=c.trim().match(d.loose?n[a.LOOSE]:n[a.FULL]);if(!u)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+u[1],this.minor=+u[2],this.patch=+u[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");u[4]?this.prerelease=u[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const p=+h;if(p>=0&&p<r)return p}return h}):this.prerelease=[],this.build=u[5]?u[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(t("SemVer.compare",this.version,this.options,c),!(c instanceof s)){if(typeof c=="string"&&c===this.version)return 0;c=new s(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof s||(c=new s(c,this.options)),i(this.major,c.major)||i(this.minor,c.minor)||i(this.patch,c.patch)}comparePre(c){if(c instanceof s||(c=new s(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const u=this.prerelease[d],h=c.prerelease[d];if(t("prerelease compare",d,u,h),u===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(u===void 0)return-1;if(u!==h)return i(u,h)}while(++d)}compareBuild(c){c instanceof s||(c=new s(c,this.options));let d=0;do{const u=this.build[d],h=c.build[d];if(t("build compare",d,u,h),u===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(u===void 0)return-1;if(u!==h)return i(u,h)}while(++d)}inc(c,d,u){switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,u);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,u);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,u),this.inc("pre",d,u);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,u),this.inc("pre",d,u);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(u)?1:0;if(!d&&u===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[h];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&u===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(d){let p=[d,h];u===!1&&(p=[d]),i(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return fu=s,fu}var mu,Pv;function ka(){if(Pv)return mu;Pv=1;const t=pt();return mu=(e,r,n=!1)=>{if(e instanceof t)return e;try{return new t(e,r)}catch(a){if(!n)return null;throw a}},mu}var gu,Cv;function RT(){if(Cv)return gu;Cv=1;const t=ka();return gu=(e,r)=>{const n=t(e,r);return n?n.version:null},gu}var yu,jv;function OT(){if(jv)return yu;jv=1;const t=ka();return yu=(e,r)=>{const n=t(e.trim().replace(/^[=v]+/,""),r);return n?n.version:null},yu}var _u,Lv;function NT(){if(Lv)return _u;Lv=1;const t=pt();return _u=(e,r,n,a,o)=>{typeof n=="string"&&(o=a,a=n,n=void 0);try{return new t(e instanceof t?e.version:e,n).inc(r,a,o).version}catch{return null}},_u}var vu,Dv;function IT(){if(Dv)return vu;Dv=1;const t=ka();return vu=(e,r)=>{const n=t(e,null,!0),a=t(r,null,!0),o=n.compare(a);if(o===0)return null;const i=o>0,s=i?n:a,l=i?a:n,c=!!s.prerelease.length;if(l.prerelease.length&&!c)return!l.patch&&!l.minor?"major":s.patch?"patch":s.minor?"minor":"major";const d=c?"pre":"";return n.major!==a.major?d+"major":n.minor!==a.minor?d+"minor":n.patch!==a.patch?d+"patch":"prerelease"},vu}var wu,$v;function PT(){if($v)return wu;$v=1;const t=pt();return wu=(e,r)=>new t(e,r).major,wu}var bu,zv;function CT(){if(zv)return bu;zv=1;const t=pt();return bu=(e,r)=>new t(e,r).minor,bu}var Eu,Uv;function jT(){if(Uv)return Eu;Uv=1;const t=pt();return Eu=(e,r)=>new t(e,r).patch,Eu}var Su,Bv;function LT(){if(Bv)return Su;Bv=1;const t=ka();return Su=(e,r)=>{const n=t(e,r);return n&&n.prerelease.length?n.prerelease:null},Su}var xu,Hv;function Xt(){if(Hv)return xu;Hv=1;const t=pt();return xu=(e,r,n)=>new t(e,n).compare(new t(r,n)),xu}var ku,Wv;function DT(){if(Wv)return ku;Wv=1;const t=Xt();return ku=(e,r,n)=>t(r,e,n),ku}var Au,Gv;function $T(){if(Gv)return Au;Gv=1;const t=Xt();return Au=(e,r)=>t(e,r,!0),Au}var Tu,qv;function Mu(){if(qv)return Tu;qv=1;const t=pt();return Tu=(e,r,n)=>{const a=new t(e,n),o=new t(r,n);return a.compare(o)||a.compareBuild(o)},Tu}var Fu,Vv;function zT(){if(Vv)return Fu;Vv=1;const t=Mu();return Fu=(e,r)=>e.sort((n,a)=>t(n,a,r)),Fu}var Ru,Zv;function UT(){if(Zv)return Ru;Zv=1;const t=Mu();return Ru=(e,r)=>e.sort((n,a)=>t(a,n,r)),Ru}var Ou,Jv;function Ls(){if(Jv)return Ou;Jv=1;const t=Xt();return Ou=(e,r,n)=>t(e,r,n)>0,Ou}var Nu,Kv;function Iu(){if(Kv)return Nu;Kv=1;const t=Xt();return Nu=(e,r,n)=>t(e,r,n)<0,Nu}var Pu,Yv;function Xv(){if(Yv)return Pu;Yv=1;const t=Xt();return Pu=(e,r,n)=>t(e,r,n)===0,Pu}var Cu,Qv;function ew(){if(Qv)return Cu;Qv=1;const t=Xt();return Cu=(e,r,n)=>t(e,r,n)!==0,Cu}var ju,tw;function Lu(){if(tw)return ju;tw=1;const t=Xt();return ju=(e,r,n)=>t(e,r,n)>=0,ju}var Du,rw;function $u(){if(rw)return Du;rw=1;const t=Xt();return Du=(e,r,n)=>t(e,r,n)<=0,Du}var zu,nw;function aw(){if(nw)return zu;nw=1;const t=Xv(),e=ew(),r=Ls(),n=Lu(),a=Iu(),o=$u();return zu=(i,s,l,c)=>{switch(s){case"===":return typeof i=="object"&&(i=i.version),typeof l=="object"&&(l=l.version),i===l;case"!==":return typeof i=="object"&&(i=i.version),typeof l=="object"&&(l=l.version),i!==l;case"":case"=":case"==":return t(i,l,c);case"!=":return e(i,l,c);case">":return r(i,l,c);case">=":return n(i,l,c);case"<":return a(i,l,c);case"<=":return o(i,l,c);default:throw new TypeError(`Invalid operator: ${s}`)}},zu}var Uu,ow;function BT(){if(ow)return Uu;ow=1;const t=pt(),e=ka(),{safeRe:r,t:n}=Do();return Uu=(a,o)=>{if(a instanceof t)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;o=o||{};let i=null;if(!o.rtl)i=a.match(o.includePrerelease?r[n.COERCEFULL]:r[n.COERCE]);else{const h=o.includePrerelease?r[n.COERCERTLFULL]:r[n.COERCERTL];let p;for(;(p=h.exec(a))&&(!i||i.index+i[0].length!==a.length);)(!i||p.index+p[0].length!==i.index+i[0].length)&&(i=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(i===null)return null;const s=i[2],l=i[3]||"0",c=i[4]||"0",d=o.includePrerelease&&i[5]?`-${i[5]}`:"",u=o.includePrerelease&&i[6]?`+${i[6]}`:"";return e(`${s}.${l}.${c}${d}${u}`,o)},Uu}var Bu,iw;function HT(){if(iw)return Bu;iw=1;class t{constructor(){this.max=1e3,this.map=new Map}get(r){const n=this.map.get(r);if(n!==void 0)return this.map.delete(r),this.map.set(r,n),n}delete(r){return this.map.delete(r)}set(r,n){if(!this.delete(r)&&n!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(r,n)}return this}}return Bu=t,Bu}var Hu,sw;function Qt(){if(sw)return Hu;sw=1;const t=/\s+/g;class e{constructor(E,H){if(H=a(H),E instanceof e)return E.loose===!!H.loose&&E.includePrerelease===!!H.includePrerelease?E:new e(E.raw,H);if(E instanceof o)return this.raw=E.value,this.set=[[E]],this.formatted=void 0,this;if(this.options=H,this.loose=!!H.loose,this.includePrerelease=!!H.includePrerelease,this.raw=E.trim().replace(t," "),this.set=this.raw.split("||").map(N=>this.parseRange(N.trim())).filter(N=>N.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const N=this.set[0];if(this.set=this.set.filter(C=>!g(C[0])),this.set.length===0)this.set=[N];else if(this.set.length>1){for(const C of this.set)if(C.length===1&&m(C[0])){this.set=[C];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let E=0;E<this.set.length;E++){E>0&&(this.formatted+="||");const H=this.set[E];for(let N=0;N<H.length;N++)N>0&&(this.formatted+=" "),this.formatted+=H[N].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(E){const H=((this.options.includePrerelease&&p)|(this.options.loose&&f))+":"+E,N=n.get(H);if(N)return N;const C=this.options.loose,P=C?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];E=E.replace(P,x(this.options.includePrerelease)),i("hyphen replace",E),E=E.replace(l[c.COMPARATORTRIM],d),i("comparator trim",E),E=E.replace(l[c.TILDETRIM],u),i("tilde trim",E),E=E.replace(l[c.CARETTRIM],h),i("caret trim",E);let Z=E.split(" ").map(we=>v(we,this.options)).join(" ").split(/\s+/).map(we=>ue(we,this.options));C&&(Z=Z.filter(we=>(i("loose invalid filter",we,this.options),!!we.match(l[c.COMPARATORLOOSE])))),i("range list",Z);const ne=new Map,le=Z.map(we=>new o(we,this.options));for(const we of le){if(g(we))return[we];ne.set(we.value,we)}ne.size>1&&ne.has("")&&ne.delete("");const ye=[...ne.values()];return n.set(H,ye),ye}intersects(E,H){if(!(E instanceof e))throw new TypeError("a Range is required");return this.set.some(N=>_(N,H)&&E.set.some(C=>_(C,H)&&N.every(P=>C.every(Z=>P.intersects(Z,H)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new s(E,this.options)}catch{return!1}for(let H=0;H<this.set.length;H++)if(R(this.set[H],E,this.options))return!0;return!1}}Hu=e;const r=HT(),n=new r,a=hu(),o=Ds(),i=js(),s=pt(),{safeRe:l,t:c,comparatorTrimReplace:d,tildeTrimReplace:u,caretTrimReplace:h}=Do(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:f}=Cs(),g=k=>k.value==="<0.0.0-0",m=k=>k.value==="",_=(k,E)=>{let H=!0;const N=k.slice();let C=N.pop();for(;H&&N.length;)H=N.every(P=>C.intersects(P,E)),C=N.pop();return H},v=(k,E)=>(i("comp",k,E),k=D(k,E),i("caret",k),k=F(k,E),i("tildes",k),k=j(k,E),i("xrange",k),k=te(k,E),i("stars",k),k),A=k=>!k||k.toLowerCase()==="x"||k==="*",F=(k,E)=>k.trim().split(/\s+/).map(H=>b(H,E)).join(" "),b=(k,E)=>{const H=E.loose?l[c.TILDELOOSE]:l[c.TILDE];return k.replace(H,(N,C,P,Z,ne)=>{i("tilde",k,N,C,P,Z,ne);let le;return A(C)?le="":A(P)?le=`>=${C}.0.0 <${+C+1}.0.0-0`:A(Z)?le=`>=${C}.${P}.0 <${C}.${+P+1}.0-0`:ne?(i("replaceTilde pr",ne),le=`>=${C}.${P}.${Z}-${ne} <${C}.${+P+1}.0-0`):le=`>=${C}.${P}.${Z} <${C}.${+P+1}.0-0`,i("tilde return",le),le})},D=(k,E)=>k.trim().split(/\s+/).map(H=>B(H,E)).join(" "),B=(k,E)=>{i("caret",k,E);const H=E.loose?l[c.CARETLOOSE]:l[c.CARET],N=E.includePrerelease?"-0":"";return k.replace(H,(C,P,Z,ne,le)=>{i("caret",k,C,P,Z,ne,le);let ye;return A(P)?ye="":A(Z)?ye=`>=${P}.0.0${N} <${+P+1}.0.0-0`:A(ne)?P==="0"?ye=`>=${P}.${Z}.0${N} <${P}.${+Z+1}.0-0`:ye=`>=${P}.${Z}.0${N} <${+P+1}.0.0-0`:le?(i("replaceCaret pr",le),P==="0"?Z==="0"?ye=`>=${P}.${Z}.${ne}-${le} <${P}.${Z}.${+ne+1}-0`:ye=`>=${P}.${Z}.${ne}-${le} <${P}.${+Z+1}.0-0`:ye=`>=${P}.${Z}.${ne}-${le} <${+P+1}.0.0-0`):(i("no pr"),P==="0"?Z==="0"?ye=`>=${P}.${Z}.${ne}${N} <${P}.${Z}.${+ne+1}-0`:ye=`>=${P}.${Z}.${ne}${N} <${P}.${+Z+1}.0-0`:ye=`>=${P}.${Z}.${ne} <${+P+1}.0.0-0`),i("caret return",ye),ye})},j=(k,E)=>(i("replaceXRanges",k,E),k.split(/\s+/).map(H=>G(H,E)).join(" ")),G=(k,E)=>{k=k.trim();const H=E.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return k.replace(H,(N,C,P,Z,ne,le)=>{i("xRange",k,N,C,P,Z,ne,le);const ye=A(P),we=ye||A(Z),$e=we||A(ne),Qe=$e;return C==="="&&Qe&&(C=""),le=E.includePrerelease?"-0":"",ye?C===">"||C==="<"?N="<0.0.0-0":N="*":C&&Qe?(we&&(Z=0),ne=0,C===">"?(C=">=",we?(P=+P+1,Z=0,ne=0):(Z=+Z+1,ne=0)):C==="<="&&(C="<",we?P=+P+1:Z=+Z+1),C==="<"&&(le="-0"),N=`${C+P}.${Z}.${ne}${le}`):we?N=`>=${P}.0.0${le} <${+P+1}.0.0-0`:$e&&(N=`>=${P}.${Z}.0${le} <${P}.${+Z+1}.0-0`),i("xRange return",N),N})},te=(k,E)=>(i("replaceStars",k,E),k.trim().replace(l[c.STAR],"")),ue=(k,E)=>(i("replaceGTE0",k,E),k.trim().replace(l[E.includePrerelease?c.GTE0PRE:c.GTE0],"")),x=k=>(E,H,N,C,P,Z,ne,le,ye,we,$e,Qe)=>(A(N)?H="":A(C)?H=`>=${N}.0.0${k?"-0":""}`:A(P)?H=`>=${N}.${C}.0${k?"-0":""}`:Z?H=`>=${H}`:H=`>=${H}${k?"-0":""}`,A(ye)?le="":A(we)?le=`<${+ye+1}.0.0-0`:A($e)?le=`<${ye}.${+we+1}.0-0`:Qe?le=`<=${ye}.${we}.${$e}-${Qe}`:k?le=`<${ye}.${we}.${+$e+1}-0`:le=`<=${le}`,`${H} ${le}`.trim()),R=(k,E,H)=>{for(let N=0;N<k.length;N++)if(!k[N].test(E))return!1;if(E.prerelease.length&&!H.includePrerelease){for(let N=0;N<k.length;N++)if(i(k[N].semver),k[N].semver!==o.ANY&&k[N].semver.prerelease.length>0){const C=k[N].semver;if(C.major===E.major&&C.minor===E.minor&&C.patch===E.patch)return!0}return!1}return!0};return Hu}var Wu,lw;function Ds(){if(lw)return Wu;lw=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(d,u){if(u=r(u),d instanceof e){if(d.loose===!!u.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),i("comparator",d,u),this.options=u,this.loose=!!u.loose,this.parse(d),this.semver===t?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(d){const u=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],h=d.match(u);if(!h)throw new TypeError(`Invalid comparator: ${d}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new s(h[2],this.options.loose):this.semver=t}toString(){return this.value}test(d){if(i("Comparator.test",d,this.options.loose),this.semver===t||d===t)return!0;if(typeof d=="string")try{d=new s(d,this.options)}catch{return!1}return o(d,this.operator,this.semver,this.options)}intersects(d,u){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(d.value,u).test(this.value):d.operator===""?d.value===""?!0:new l(this.value,u).test(d.semver):(u=r(u),u.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!u.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||o(this.semver,"<",d.semver,u)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||o(this.semver,">",d.semver,u)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}Wu=e;const r=hu(),{safeRe:n,t:a}=Do(),o=aw(),i=js(),s=pt(),l=Qt();return Wu}var Gu,cw;function $s(){if(cw)return Gu;cw=1;const t=Qt();return Gu=(e,r,n)=>{try{r=new t(r,n)}catch{return!1}return r.test(e)},Gu}var qu,dw;function WT(){if(dw)return qu;dw=1;const t=Qt();return qu=(e,r)=>new t(e,r).set.map(n=>n.map(a=>a.value).join(" ").trim().split(" ")),qu}var Vu,uw;function GT(){if(uw)return Vu;uw=1;const t=pt(),e=Qt();return Vu=(r,n,a)=>{let o=null,i=null,s=null;try{s=new e(n,a)}catch{return null}return r.forEach(l=>{s.test(l)&&(!o||i.compare(l)===-1)&&(o=l,i=new t(o,a))}),o},Vu}var Zu,hw;function qT(){if(hw)return Zu;hw=1;const t=pt(),e=Qt();return Zu=(r,n,a)=>{let o=null,i=null,s=null;try{s=new e(n,a)}catch{return null}return r.forEach(l=>{s.test(l)&&(!o||i.compare(l)===1)&&(o=l,i=new t(o,a))}),o},Zu}var Ju,pw;function VT(){if(pw)return Ju;pw=1;const t=pt(),e=Qt(),r=Ls();return Ju=(n,a)=>{n=new e(n,a);let o=new t("0.0.0");if(n.test(o)||(o=new t("0.0.0-0"),n.test(o)))return o;o=null;for(let i=0;i<n.set.length;++i){const s=n.set[i];let l=null;s.forEach(c=>{const d=new t(c.semver.version);switch(c.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!l||r(d,l))&&(l=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),l&&(!o||r(o,l))&&(o=l)}return o&&n.test(o)?o:null},Ju}var Ku,fw;function ZT(){if(fw)return Ku;fw=1;const t=Qt();return Ku=(e,r)=>{try{return new t(e,r).range||"*"}catch{return null}},Ku}var Yu,mw;function Xu(){if(mw)return Yu;mw=1;const t=pt(),e=Ds(),{ANY:r}=e,n=Qt(),a=$s(),o=Ls(),i=Iu(),s=$u(),l=Lu();return Yu=(c,d,u,h)=>{c=new t(c,h),d=new n(d,h);let p,f,g,m,_;switch(u){case">":p=o,f=s,g=i,m=">",_=">=";break;case"<":p=i,f=l,g=o,m="<",_="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(c,d,h))return!1;for(let v=0;v<d.set.length;++v){const A=d.set[v];let F=null,b=null;if(A.forEach(D=>{D.semver===r&&(D=new e(">=0.0.0")),F=F||D,b=b||D,p(D.semver,F.semver,h)?F=D:g(D.semver,b.semver,h)&&(b=D)}),F.operator===m||F.operator===_||(!b.operator||b.operator===m)&&f(c,b.semver)||b.operator===_&&g(c,b.semver))return!1}return!0},Yu}var Qu,gw;function JT(){if(gw)return Qu;gw=1;const t=Xu();return Qu=(e,r,n)=>t(e,r,">",n),Qu}var eh,yw;function KT(){if(yw)return eh;yw=1;const t=Xu();return eh=(e,r,n)=>t(e,r,"<",n),eh}var th,_w;function YT(){if(_w)return th;_w=1;const t=Qt();return th=(e,r,n)=>(e=new t(e,n),r=new t(r,n),e.intersects(r,n)),th}var rh,vw;function XT(){if(vw)return rh;vw=1;const t=$s(),e=Xt();return rh=(r,n,a)=>{const o=[];let i=null,s=null;const l=r.sort((h,p)=>e(h,p,a));for(const h of l)t(h,n,a)?(s=h,i||(i=h)):(s&&o.push([i,s]),s=null,i=null);i&&o.push([i,null]);const c=[];for(const[h,p]of o)h===p?c.push(h):!p&&h===l[0]?c.push("*"):p?h===l[0]?c.push(`<=${p}`):c.push(`${h} - ${p}`):c.push(`>=${h}`);const d=c.join(" || "),u=typeof n.raw=="string"?n.raw:String(n);return d.length<u.length?d:n},rh}var nh,ww;function QT(){if(ww)return nh;ww=1;const t=Qt(),e=Ds(),{ANY:r}=e,n=$s(),a=Xt(),o=(u,h,p={})=>{if(u===h)return!0;u=new t(u,p),h=new t(h,p);let f=!1;e:for(const g of u.set){for(const m of h.set){const _=l(g,m,p);if(f=f||_!==null,_)continue e}if(f)return!1}return!0},i=[new e(">=0.0.0-0")],s=[new e(">=0.0.0")],l=(u,h,p)=>{if(u===h)return!0;if(u.length===1&&u[0].semver===r){if(h.length===1&&h[0].semver===r)return!0;p.includePrerelease?u=i:u=s}if(h.length===1&&h[0].semver===r){if(p.includePrerelease)return!0;h=s}const f=new Set;let g,m;for(const j of u)j.operator===">"||j.operator===">="?g=c(g,j,p):j.operator==="<"||j.operator==="<="?m=d(m,j,p):f.add(j.semver);if(f.size>1)return null;let _;if(g&&m&&(_=a(g.semver,m.semver,p),_>0||_===0&&(g.operator!==">="||m.operator!=="<=")))return null;for(const j of f){if(g&&!n(j,String(g),p)||m&&!n(j,String(m),p))return null;for(const G of h)if(!n(j,String(G),p))return!1;return!0}let v,A,F,b,D=m&&!p.includePrerelease&&m.semver.prerelease.length?m.semver:!1,B=g&&!p.includePrerelease&&g.semver.prerelease.length?g.semver:!1;D&&D.prerelease.length===1&&m.operator==="<"&&D.prerelease[0]===0&&(D=!1);for(const j of h){if(b=b||j.operator===">"||j.operator===">=",F=F||j.operator==="<"||j.operator==="<=",g){if(B&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===B.major&&j.semver.minor===B.minor&&j.semver.patch===B.patch&&(B=!1),j.operator===">"||j.operator===">="){if(v=c(g,j,p),v===j&&v!==g)return!1}else if(g.operator===">="&&!n(g.semver,String(j),p))return!1}if(m){if(D&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===D.major&&j.semver.minor===D.minor&&j.semver.patch===D.patch&&(D=!1),j.operator==="<"||j.operator==="<="){if(A=d(m,j,p),A===j&&A!==m)return!1}else if(m.operator==="<="&&!n(m.semver,String(j),p))return!1}if(!j.operator&&(m||g)&&_!==0)return!1}return!(g&&F&&!m&&_!==0||m&&b&&!g&&_!==0||B||D)},c=(u,h,p)=>{if(!u)return h;const f=a(u.semver,h.semver,p);return f>0?u:f<0||h.operator===">"&&u.operator===">="?h:u},d=(u,h,p)=>{if(!u)return h;const f=a(u.semver,h.semver,p);return f<0?u:f>0||h.operator==="<"&&u.operator==="<="?h:u};return nh=o,nh}var ah,bw;function eM(){if(bw)return ah;bw=1;const t=Do(),e=Cs(),r=pt(),n=Nv(),a=ka(),o=RT(),i=OT(),s=NT(),l=IT(),c=PT(),d=CT(),u=jT(),h=LT(),p=Xt(),f=DT(),g=$T(),m=Mu(),_=zT(),v=UT(),A=Ls(),F=Iu(),b=Xv(),D=ew(),B=Lu(),j=$u(),G=aw(),te=BT(),ue=Ds(),x=Qt(),R=$s(),k=WT(),E=GT(),H=qT(),N=VT(),C=ZT(),P=Xu(),Z=JT(),ne=KT(),le=YT(),ye=XT(),we=QT();return ah={parse:a,valid:o,clean:i,inc:s,diff:l,major:c,minor:d,patch:u,prerelease:h,compare:p,rcompare:f,compareLoose:g,compareBuild:m,sort:_,rsort:v,gt:A,lt:F,eq:b,neq:D,gte:B,lte:j,cmp:G,coerce:te,Comparator:ue,Range:x,satisfies:R,toComparators:k,maxSatisfying:E,minSatisfying:H,minVersion:N,validRange:C,outside:P,gtr:Z,ltr:ne,intersects:le,simplifyRange:ye,subset:we,SemVer:r,re:t.re,src:t.src,tokens:t.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},ah}eM();function an(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,r]=t.split(":"),n=r||"latest";if(e.includes("/")){const[a,o]=e.split("/",2);if(!a||!o)throw new Error(`Invalid identifier format: ${t}`);return[a,o,n]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,n]}}class tM extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Se(t,e,r){let n;if(t.ok){r&&(n=await t.text());return}n=await t.text();const a=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${n}`;if(t.status===409)throw new tM(a);const o=new Error(a);throw o.status=t.status,o}var Ew="[...]",rM={result:"[Circular]"},zs=[],Aa=[];const nM=new TextEncoder;function aM(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Us(t){return nM.encode(t)}function Mt(t,e,r,n,a){var o;try{const i=JSON.stringify(t,r,n);return Us(i)}catch(i){if(!((o=i.message)!=null&&o.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Us("[Unserializable]");Yt("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof a>"u"&&(a=aM()),ih(t,"",0,[],void 0,0,a);let s;try{Aa.length===0?s=JSON.stringify(t,r,n):s=JSON.stringify(t,oM(r),n)}catch{return Us("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;zs.length!==0;){const l=zs.pop();l.length===4?Object.defineProperty(l[0],l[1],l[3]):l[0][l[1]]=l[2]}}return Us(s)}}function oh(t,e,r,n){var a=Object.getOwnPropertyDescriptor(n,r);a.get!==void 0?a.configurable?(Object.defineProperty(n,r,{value:t}),zs.push([n,r,e,a])):Aa.push([e,r,t]):(n[r]=t,zs.push([n,r,e]))}function ih(t,e,r,n,a,o,i){o+=1;var s;if(typeof t=="object"&&t!==null){for(s=0;s<n.length;s++)if(n[s]===t){oh(rM,t,e,a);return}if(typeof i.depthLimit<"u"&&o>i.depthLimit){oh(Ew,t,e,a);return}if(typeof i.edgesLimit<"u"&&r+1>i.edgesLimit){oh(Ew,t,e,a);return}if(n.push(t),Array.isArray(t))for(s=0;s<t.length;s++)ih(t[s],s,s,n,t,o,i);else{var l=Object.keys(t);for(s=0;s<l.length;s++){var c=l[s];ih(t[c],c,s,n,t,o,i)}}n.pop()}}function oM(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(Aa.length>0)for(var n=0;n<Aa.length;n++){var a=Aa[n];if(a[1]===e&&a[0]===r){r=a[2],Aa.splice(n,1);break}}return t.call(this,e,r)}}function Sw(t){const e=wv(),r=ST(),n=t.extra??{},a=n.metadata;return t.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...r,...r.revision_id||t.revision_id?{revision_id:t.revision_id??r.revision_id}:{},...a}},t}const iM=t=>{const e=(t==null?void 0:t.toString())??Yt("TRACING_SAMPLING_RATE");if(e===void 0)return;const r=parseFloat(e);if(r<0||r>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r},sM=t=>{const e=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return e==="localhost"||e==="127.0.0.1"||e==="::1"};async function lM(t){const e=[];for await(const r of t)e.push(r);return e}function sh(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const cM=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(r=>setTimeout(r,e)),!0}return!1};function xw(t){return typeof t=="number"?Number(t.toFixed(4)):t}class dM{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let r;const n=new Promise(o=>{r=o}),a=Mt(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:r,itemPromise:n,size:a}),this.sizeBytes+=a,n}pop(e){var a;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const r=[];let n=0;for(;n+(((a=this.peek())==null?void 0:a.size)??0)<e&&this.items.length>0;){const o=this.items.shift();o&&(r.push(o),n+=o.size,this.sizeBytes-=o.size)}if(r.length===0&&this.items.length>0){const o=this.items.shift();r.push(o),n+=o.size,this.sizeBytes-=o.size}return[r.map(o=>({action:o.action,item:o.payload})),()=>r.forEach(o=>o.itemPromiseResolve())]}}const uM=20971520,hM=2500;class $o{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new dM}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:nn("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:nn("LANGSMITH_DEBUG")==="true"});const r=$o.getDefaultClientConfig();if(this.tracingSampleRate=iM(e.tracingSamplingRate),this.apiUrl=sh(e.apiUrl??r.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=sh(e.apiKey??r.apiKey),this.webUrl=sh(e.webUrl??r.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Ev({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new Ev({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:cM,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??r.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??r.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Yt("API_KEY"),r=Yt("ENDPOINT")??"https://api.smith.langchain.com",n=Yt("HIDE_INPUTS")==="true",a=Yt("HIDE_OUTPUTS")==="true";return{apiUrl:r,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:sM(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${ou}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const r={...e};return r.inputs!==void 0&&(r.inputs=await this.processInputs(r.inputs)),r.outputs!==void 0&&(r.outputs=await this.processOutputs(r.outputs)),r}async _getResponse(e,r){const n=(r==null?void 0:r.toString())??"",a=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(he(this.debug),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(o,`Failed to fetch ${e}`),o}async _get(e,r){return(await this._getResponse(e,r)).json()}async*_getPaginated(e,r=new URLSearchParams,n){let a=Number(r.get("offset"))||0;const o=Number(r.get("limit"))||100;for(;;){r.set("offset",String(a)),r.set("limit",String(o));const i=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(he(this.debug),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(s,`Failed to fetch ${e}`);const l=n?n(await s.json()):await s.json();if(l.length===0||(yield l,l.length<o))break;a+=l.length}}async*_getCursorPaginatedList(e,r=null,n="POST",a="runs"){const o=r?{...r}:{};for(;;){const i=await(await this.caller.call(he(this.debug),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(o)})).json();if(!i||!i[a])break;yield i[a];const s=i.cursors;if(!s||!s.next)break;o.cursor=s.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,r=!1){if(this.tracingSampleRate===void 0)return e;if(r){const n=[];for(const a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):n.push(a);return n}else{const n=[];for(const a of e){const o=a.trace_id??a.id;this.filteredPostUuids.has(o)||(a.id===o?this._shouldSample()?n.push(a):this.filteredPostUuids.add(o):n.push(a))}return n}}async _getBatchSizeLimitBytes(){var r;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((r=e.batch_ingest_config)==null?void 0:r.size_limit_bytes)??uM}async _getMultiPartSupport(){var e;return((e=(await this._ensureServerInfo()).instance_flags)==null?void 0:e.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const r=[];for(;this.autoBatchQueue.items.length>0;){const[n,a]=this.autoBatchQueue.pop(e);if(!n.length){a();break}const o=this._processBatch(n,a).catch(console.error);r.push(o)}return Promise.all(r)}async _processBatch(e,r){var n,a;if(!e.length){r();return}try{const o={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)};(a=(n=await this._ensureServerInfo())==null?void 0:n.batch_ingest_config)!=null&&a.use_multipart_endpoint?await this.multipartIngestRuns(o):await this.batchIngestRuns(o)}finally{r()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Sw(e.item));const r=this.autoBatchQueue.push(e);if(this.manualFlushMode)return r;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),r}async _getServerInfo(){const e=await this.caller.call(he(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(hM),...this.fetchOptions});await Se(e,"get server info");const r=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(r,null,2)+`
`),r}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const a=await this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}const o=Sw(a),i=await this.caller.call(he(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:r,body:Mt(o,`Creating run with id: ${o.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:r}){if(e===void 0&&r===void 0)return;let n=await Promise.all((e==null?void 0:e.map(s=>this.prepareRunCreateOrUpdateInputs(s)))??[]),a=await Promise.all((r==null?void 0:r.map(s=>this.prepareRunCreateOrUpdateInputs(s)))??[]);if(n.length>0&&a.length>0){const s=n.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),l=[];for(const c of a)c.id!==void 0&&s[c.id]?s[c.id]={...s[c.id],...c}:l.push(c);n=Object.values(s),a=l}const o={post:n,patch:a};if(!o.post.length&&!o.patch.length)return;const i={post:[],patch:[]};for(const s of["post","patch"]){const l=s,c=o[l].reverse();let d=c.pop();for(;d!==void 0;)i[l].push(d),d=c.pop()}if(i.post.length>0||i.patch.length>0){const s=i.post.map(l=>l.id).concat(i.patch.map(l=>l.id)).join(",");await this._postBatchIngestRuns(Mt(i,`Ingesting runs with ids: ${s}`))}}async _postBatchIngestRuns(e){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(he(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:r,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:r}){if(e===void 0&&r===void 0)return;const n={};let a=[];for(const l of e??[]){const c=await this.prepareRunCreateOrUpdateInputs(l);c.id!==void 0&&c.attachments!==void 0&&(n[c.id]=c.attachments),delete c.attachments,a.push(c)}let o=[];for(const l of r??[])o.push(await this.prepareRunCreateOrUpdateInputs(l));if(a.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(o.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&o.length>0){const l=a.reduce((d,u)=>(u.id&&(d[u.id]=u),d),{}),c=[];for(const d of o)d.id!==void 0&&l[d.id]?l[d.id]={...l[d.id],...d}:c.push(d);a=Object.values(l),o=c}if(a.length===0&&o.length===0)return;const i=[],s=[];for(const[l,c]of[["post",a],["patch",o]])for(const d of c){const{inputs:u,outputs:h,events:p,attachments:f,...g}=d,m={inputs:u,outputs:h,events:p},_=Mt(g,`Serializing for multipart ingestion of run with id: ${g.id}`);s.push({name:`${l}.${g.id}`,payload:new Blob([_],{type:`application/json; length=${_.length}`})});for(const[v,A]of Object.entries(m)){if(A===void 0)continue;const F=Mt(A,`Serializing ${v} for multipart ingestion of run with id: ${g.id}`);s.push({name:`${l}.${g.id}.${v}`,payload:new Blob([F],{type:`application/json; length=${F.length}`})})}if(g.id!==void 0){const v=n[g.id];if(v){delete n[g.id];for(const[A,F]of Object.entries(v)){let b,D;if(Array.isArray(F)?[b,D]=F:(b=F.mimeType,D=F.data),A.includes(".")){console.warn(`Skipping attachment '${A}' for run ${g.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}s.push({name:`attachment.${g.id}.${A}`,payload:new Blob([D],{type:`${b}; length=${D.byteLength}`})})}}}i.push(`trace=${g.trace_id},id=${g.id}`)}await this._sendMultipartRequest(s,i.join("; "))}async _createNodeFetchBody(e,r){const n=[];for(const a of e)n.push(new Blob([`--${r}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),n.push(a.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${r}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,r){const n=new TextEncoder;return new ReadableStream({async start(a){const o=async i=>{typeof i=="string"?a.enqueue(n.encode(i)):a.enqueue(i)};for(const i of e){await o(`--${r}\r
`),await o(`Content-Disposition: form-data; name="${i.name}"\r
`),await o(`Content-Type: ${i.payload.type}\r
\r
`);const s=i.payload.stream().getReader();try{let l;for(;!(l=await s.read()).done;)a.enqueue(l.value)}finally{s.releaseLock()}await o(`\r
`)}await o(`--${r}--\r
`),a.close()}})}async _sendMultipartRequest(e,r){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=await(TT()?this._createNodeFetchBody(e,n):this._createMultipartStream(e,n)),o=await this.batchIngestCaller.call(he(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:a,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${r}`)}}async updateRun(e,r){Ee(e),r.inputs&&(r.inputs=await this.processInputs(r.inputs)),r.outputs&&(r.outputs=await this.processOutputs(r.outputs));const n={...r,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(r.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"},o=await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:Mt(r,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,"update run",!0)}async readRun(e,{loadChildRuns:r}={loadChildRuns:!1}){Ee(e);let n=await this._get(`/runs/${e}`);return r&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:r,projectOpts:n}){if(r!==void 0){let a;r.session_id?a=r.session_id:n!=null&&n.projectName?a=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?a=n==null?void 0:n.projectId:a=(await this.readProject({projectName:Yt("PROJECT")||"default"})).id;const o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${a}/r/${r.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var o;const r=await lM(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},a={};r.sort((i,s)=>((i==null?void 0:i.dotted_order)??"").localeCompare((s==null?void 0:s.dotted_order)??""));for(const i of r){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);(o=i.dotted_order)!=null&&o.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),a[i.id]=i)}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(a[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:r,projectName:n,parentRunId:a,traceId:o,referenceExampleId:i,startTime:s,executionOrder:l,isRoot:c,runType:d,error:u,id:h,query:p,filter:f,traceFilter:g,treeFilter:m,limit:_,select:v,order:A}=e;let F=[];if(r&&(F=Array.isArray(r)?r:[r]),n){const j=Array.isArray(n)?n:[n],G=await Promise.all(j.map(te=>this.readProject({projectName:te}).then(ue=>ue.id)));F.push(...G)}const b=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],D={session:F.length?F:null,run_type:d,reference_example:i,query:p,filter:f,trace_filter:g,tree_filter:m,execution_order:l,parent_run:a,start_time:s?s.toISOString():null,error:u,id:h,limit:_,trace:o,select:v||b,is_root:c,order:A};let B=0;for await(const j of this._getCursorPaginatedList("/runs/query",D))if(_){if(B>=_)break;if(j.length+B>_){yield*j.slice(0,_-B);break}B+=j.length,yield*j}else yield*j}async*listGroupRuns(e){const{projectId:r,projectName:n,groupBy:a,filter:o,startTime:i,endTime:s,limit:l,offset:c}=e,d={session_id:r||(await this.readProject({projectName:n})).id,group_by:a,filter:o,start_time:i?i.toISOString():null,end_time:s?s.toISOString():null,limit:Number(l)||100};let u=Number(c)||0;const h="/runs/group",p=`${this.apiUrl}${h}`;for(;;){const f={...d,offset:u},g=Object.fromEntries(Object.entries(f).filter(([F,b])=>b!==void 0)),m=await this.caller.call(he(),p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(m,`Failed to fetch ${h}`);const _=await m.json(),{groups:v,total:A}=_;if(v.length===0)break;for(const F of v)yield F;if(u+=v.length,u>=A)break}}async getRunStats({id:e,trace:r,parentRun:n,runType:a,projectNames:o,projectIds:i,referenceExampleIds:s,startTime:l,endTime:c,error:d,query:u,filter:h,traceFilter:p,treeFilter:f,isRoot:g,dataSourceType:m}){let _=i||[];o&&(_=[...i||[],...await Promise.all(o.map(A=>this.readProject({projectName:A}).then(F=>F.id)))]);const v=Object.fromEntries(Object.entries({id:e,trace:r,parent_run:n,run_type:a,session:_,reference_example:s,start_time:l,end_time:c,error:d,query:u,filter:h,trace_filter:p,tree_filter:f,is_root:g,data_source_type:m}).filter(([A,F])=>F!==void 0));return await(await this.caller.call(he(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:r}={}){const n={run_id:e,share_token:r||ht()};Ee(e);const a=await(await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Ee(e);const r=await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"unshare run",!0)}async readRunSharedLink(e){Ee(e);const r=await(await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:r}={}){const n=new URLSearchParams({share_token:e});if(r!==void 0)for(const a of r)n.append("id",a);return Ee(e),await(await this.caller.call(he(this.debug),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id),Ee(e);const n=await(await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async shareDataset(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id);const n={dataset_id:e};Ee(e);const a=await(await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Ee(e);const r=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"unshare dataset",!0)}async readSharedDataset(e){return Ee(e),await(await this.caller.call(he(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,r){const n={};r!=null&&r.exampleIds&&(n.id=r.exampleIds);const a=new URLSearchParams;Object.entries(n).forEach(([s,l])=>{Array.isArray(l)?l.forEach(c=>a.append(s,c)):a.append(s,l)});const o=await this.caller.call(he(this.debug),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await o.json();if(!o.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${o.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${o.status} ${o.statusText}`);return i.map(s=>({...s,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:r=null,metadata:n=null,upsert:a=!1,projectExtra:o=null,referenceDatasetId:i=null}){const s=a?"?upsert=true":"",l=`${this.apiUrl}/sessions${s}`,c=o||{};n&&(c.metadata=n);const d={name:e,extra:c,description:r};i!==null&&(d.reference_dataset_id=i);const u=await this.caller.call(he(this.debug),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(u,"create project"),await u.json()}async updateProject(e,{name:r=null,description:n=null,metadata:a=null,projectExtra:o=null,endTime:i=null}){const s=`${this.apiUrl}/sessions/${e}`;let l=o;a&&(l={...l||{},metadata:a});const c={name:r,extra:l,description:n,end_time:i?new Date(i).toISOString():null},d=await this.caller.call(he(this.debug),s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(d,"update project"),await d.json()}async hasProject({projectId:e,projectName:r}){let n="/sessions";const a=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(r!==void 0)a.append("name",r);else throw new Error("Must provide projectName or projectId");const o=await this.caller.call(he(this.debug),`${this.apiUrl}${n}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await o.json();return o.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:r,includeStats:n}){let a="/sessions";const o=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),a+=`/${e}`;else if(r!==void 0)o.append("name",r);else throw new Error("Must provide projectName or projectId");n!==void 0&&o.append("include_stats",n.toString());const i=await this._get(a,o);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${r}] not found`);s=i[0]}else s=i;return s}async getProjectUrl({projectId:e,projectName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:r}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:r}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const r of this._getPaginated("/sessions",e))return this._tenantId=r[0].tenant_id,r[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:r,nameContains:n,referenceDatasetId:a,referenceDatasetName:o,referenceFree:i,metadata:s}={}){const l=new URLSearchParams;if(e!==void 0)for(const c of e)l.append("id",c);if(r!==void 0&&l.append("name",r),n!==void 0&&l.append("name_contains",n),a!==void 0)l.append("reference_dataset",a);else if(o!==void 0){const c=await this.readDataset({datasetName:o});l.append("reference_dataset",c.id)}i!==void 0&&l.append("reference_free",i.toString()),s!==void 0&&l.append("metadata",JSON.stringify(s));for await(const c of this._getPaginated("/sessions",l))yield*c}async deleteProject({projectId:e,projectName:r}){let n;if(e===void 0&&r===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:r})).id:n=e,Ee(n);const a=await this.caller.call(he(this.debug),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(a,`delete session ${n} (${r})`,!0)}async uploadCsv({csvFile:e,fileName:r,inputKeys:n,outputKeys:a,description:o,dataType:i,name:s}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,r),n.forEach(u=>{c.append("input_keys",u)}),a.forEach(u=>{c.append("output_keys",u)}),o&&c.append("description",o),i&&c.append("data_type",i),s&&c.append("name",s);const d=await this.caller.call(he(this.debug),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(d,"upload CSV"),await d.json()}async createDataset(e,{description:r,dataType:n,inputsSchema:a,outputsSchema:o,metadata:i}={}){const s={name:e,description:r,extra:i?{metadata:i}:void 0};n&&(s.data_type=n),a&&(s.inputs_schema_definition=a),o&&(s.outputs_schema_definition=o);const l=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:r}){let n="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(r!==void 0)a.append("name",r);else throw new Error("Must provide datasetName or datasetId");const o=await this._get(n,a);let i;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${r}] not found`);i=o[0]}else i=o;return i}async hasDataset({datasetId:e,datasetName:r}){try{return await this.readDataset({datasetId:e,datasetName:r}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:r,fromVersion:n,toVersion:a}){let o=e;if(o===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:r})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${o}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:r}){const n="/datasets";if(e===void 0)if(r!==void 0)e=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(a=>JSON.parse(a))}async*listDatasets({limit:e=100,offset:r=0,datasetIds:n,datasetName:a,datasetNameContains:o,metadata:i}={}){const s="/datasets",l=new URLSearchParams({limit:e.toString(),offset:r.toString()});if(n!==void 0)for(const c of n)l.append("id",c);a!==void 0&&l.append("name",a),o!==void 0&&l.append("name_contains",o),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(const c of this._getPaginated(s,l))yield*c}async updateDataset(e){const{datasetId:r,datasetName:n,...a}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");const o=r??(await this.readDataset({datasetName:n})).id;Ee(o);const i=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${o}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:r,datasetName:n,asOf:a,tag:o}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");const i=r??(await this.readDataset({datasetName:n})).id;Ee(i);const s=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof a=="string"?a:a.toISOString(),tag:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(s,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:r}){let n="/datasets",a=e;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(r!==void 0&&(a=(await this.readDataset({datasetName:r})).id),a!==void 0)Ee(a),n+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const o=await this.caller.call(he(this.debug),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,`delete ${n}`),await o.json()}async indexDataset({datasetId:e,datasetName:r,tag:n}){let a=e;if(!a&&!r)throw new Error("Must provide either datasetName or datasetId");if(a&&r)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:r})).id),Ee(a);const o={tag:n},i=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"index dataset"),await i.json()}async similarExamples(e,r,n,{filter:a}={}){const o={limit:n,inputs:e};a!==void 0&&(o.filter=a),Ee(r);const i=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${r}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,r,n){var c;if(kw(e)&&(r!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let a=r?n==null?void 0:n.datasetId:e.dataset_id;const o=r?n==null?void 0:n.datasetName:e.dataset_name;if(a===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:o})).id);const i=(r?n==null?void 0:n.createdAt:e.created_at)||new Date;let s;kw(e)?s=e:s={inputs:e,outputs:r,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(a,[s]);return await this.readExample(((c=l.example_ids)==null?void 0:c[0])??ht())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const _=e;let v=_[0].dataset_id;const A=_[0].dataset_name;if(v===void 0&&A===void 0)throw new Error("Must provide either datasetName or datasetId");if(v!==void 0&&A!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");v===void 0&&(v=(await this.readDataset({datasetName:A})).id);const F=await this._uploadExamplesMultipart(v,_);return await Promise.all(F.example_ids.map(b=>this.readExample(b)))}const{inputs:r,outputs:n,metadata:a,splits:o,sourceRunIds:i,useSourceRunIOs:s,useSourceRunAttachments:l,attachments:c,exampleIds:d,datasetId:u,datasetName:h}=e;if(r===void 0)throw new Error("Must provide inputs when using legacy parameters");let p=u;const f=h;if(p===void 0&&f===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&f!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(await this.readDataset({datasetName:f})).id);const g=r.map((_,v)=>({dataset_id:p,inputs:_,outputs:n==null?void 0:n[v],metadata:a==null?void 0:a[v],split:o==null?void 0:o[v],id:d==null?void 0:d[v],attachments:c==null?void 0:c[v],source_run_id:i==null?void 0:i[v],use_source_run_io:s==null?void 0:s[v],use_source_run_attachments:l==null?void 0:l[v]})),m=await this._uploadExamplesMultipart(p,g);return await Promise.all(m.example_ids.map(_=>this.readExample(_)))}async createLLMExample(e,r,n){return this.createExample({input:e},{output:r},n)}async createChatExample(e,r,n){const a=e.map(i=>Sv(i)?xv(i):i),o=Sv(r)?xv(r):r;return this.createExample({input:a},{output:o},n)}async readExample(e){Ee(e);const r=`/examples/${e}`,n=await this._get(r),{attachment_urls:a,...o}=n,i=o;return a&&(i.attachments=Object.entries(a).reduce((s,[l,c])=>(s[l.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},s),{})),i}async*listExamples({datasetId:e,datasetName:r,exampleIds:n,asOf:a,splits:o,inlineS3Urls:i,metadata:s,limit:l,offset:c,filter:d,includeAttachments:u}={}){let h;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(r!==void 0)h=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:h}),f=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;f&&p.append("as_of",f);const g=i??!0;if(p.append("inline_s3_urls",g.toString()),n!==void 0)for(const _ of n)p.append("id",_);if(o!==void 0)for(const _ of o)p.append("splits",_);if(s!==void 0){const _=JSON.stringify(s);p.append("metadata",_)}l!==void 0&&p.append("limit",l.toString()),c!==void 0&&p.append("offset",c.toString()),d!==void 0&&p.append("filter",d),u===!0&&["attachment_urls","outputs","metadata"].forEach(_=>p.append("select",_));let m=0;for await(const _ of this._getPaginated("/examples",p)){for(const v of _){const{attachment_urls:A,...F}=v,b=F;A&&(b.attachments=Object.entries(A).reduce((D,[B,j])=>(D[B.slice(11)]={presigned_url:j.presigned_url,mime_type:j.mime_type||void 0},D),{})),yield b,m++}if(l!==void 0&&m>=l)break}}async deleteExample(e){Ee(e);const r=`/examples/${e}`,n=await this.caller.call(he(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,`delete ${r}`),await n.json()}async updateExample(e,r){let n;r?n=e:n=e.id,Ee(n);let a;r?a={id:n,...r}:a=e;let o;return a.dataset_id!==void 0?o=a.dataset_id:o=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(o,[a])}async updateExamples(e){let r;return e[0].dataset_id===void 0?r=(await this.readExample(e[0].id)).dataset_id:r=e[0].dataset_id,this._updateExamplesMultipart(r,e)}async readDatasetVersion({datasetId:e,datasetName:r,asOf:n,tag:a}){let o;if(e?o=e:o=(await this.readDataset({datasetName:r})).id,Ee(o),n&&a||!n&&!a)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),a!==void 0&&i.append("tag",a);const s=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${o}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(s,"read dataset version"),await s.json()}async listDatasetSplits({datasetId:e,datasetName:r,asOf:n}){let a;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:r})).id:a=e,Ee(a);const o=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&o.append("as_of",i),await this._get(`/datasets/${a}/splits`,o)}async updateDatasetSplits({datasetId:e,datasetName:r,splitName:n,exampleIds:a,remove:o=!1}){let i;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:r})).id:i=e,Ee(i);const s={split_name:n,examples:a.map(c=>(Ee(c),c)),remove:o},l=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(l,"update dataset splits",!0)}async evaluateRun(e,r,{sourceInfo:n,loadChildRuns:a,referenceExample:o}={loadChildRuns:!1}){Av("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(o=await this.readExample(i.reference_example_id));const s=await r.evaluateRun(i,o),[l,c]=await this._logEvaluationFeedback(s,i,n);return c[0]}async createFeedback(e,r,{score:n,value:a,correction:o,comment:i,sourceInfo:s,feedbackSourceType:l="api",sourceRunId:c,feedbackId:d,feedbackConfig:u,projectId:h,comparativeExperimentId:p}){var v;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const f={type:l??"api",metadata:s??{}};c!==void 0&&(f==null?void 0:f.metadata)!==void 0&&!f.metadata.__run&&(f.metadata.__run={run_id:c}),(f==null?void 0:f.metadata)!==void 0&&((v=f.metadata.__run)==null?void 0:v.run_id)!==void 0&&Ee(f.metadata.__run.run_id);const g={id:d??ht(),run_id:e,key:r,score:xw(n),value:a,correction:o,comment:i,feedback_source:f,comparative_experiment_id:p,feedbackConfig:u,session_id:h},m=`${this.apiUrl}/feedback`,_=await this.caller.call(he(this.debug),m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(_,"create feedback",!0),g}async updateFeedback(e,{score:r,value:n,correction:a,comment:o}){const i={};r!=null&&(i.score=xw(r)),n!=null&&(i.value=n),a!=null&&(i.correction=a),o!=null&&(i.comment=o),Ee(e);const s=await this.caller.call(he(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(s,"update feedback",!0)}async readFeedback(e){Ee(e);const r=`/feedback/${e}`;return await this._get(r)}async deleteFeedback(e){Ee(e);const r=`/feedback/${e}`,n=await this.caller.call(he(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,`delete ${r}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:r,feedbackSourceTypes:n}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),r)for(const o of r)a.append("key",o);if(n)for(const o of n)a.append("source",o);for await(const o of this._getPaginated("/feedback",a))yield*o}async createPresignedFeedbackToken(e,r,{expiration:n,feedbackConfig:a}={}){const o={run_id:e,feedback_key:r,feedback_config:a};return n?typeof n=="string"?o.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(o.expires_in=n):o.expires_in={hours:3},await(await this.caller.call(he(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:r,referenceDatasetId:n,createdAt:a,description:o,metadata:i,id:s}){var c;if(r.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:r[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:s,name:e,experiment_ids:r,reference_dataset_id:n,description:o,created_at:(c=a??new Date)==null?void 0:c.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Ee(e);const r=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",r))yield*n}_selectEvalResults(e){let r;return"results"in e?r=e.results:Array.isArray(e)?r=e:r=[e],r}async _logEvaluationFeedback(e,r,n){const a=this._selectEvalResults(e),o=[];for(const i of a){let s=n||{};i.evaluatorInfo&&(s={...i.evaluatorInfo,...s});let l=null;i.targetRunId?l=i.targetRunId:r&&(l=r.id),o.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:s,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[a,o]}async logEvaluationFeedback(e,r,n){const[a]=await this._logEvaluationFeedback(e,r,n);return a}async*listAnnotationQueues(e={}){const{queueIds:r,name:n,nameContains:a,limit:o}=e,i=new URLSearchParams;r&&r.forEach((l,c)=>{Ee(l,`queueIds[${c}]`),i.append("ids",l)}),n&&i.append("name",n),a&&i.append("name_contains",a),i.append("limit",(o!==void 0?Math.min(o,100):100).toString());let s=0;for await(const l of this._getPaginated("/annotation-queues",i))if(yield*l,s++,o!==void 0&&s>=o)break}async createAnnotationQueue(e){const{name:r,description:n,queueId:a,rubricInstructions:o}=e,i={name:r,description:n,id:a||ht(),rubric_instructions:o},s=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([l,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(s,"create annotation queue"),await s.json()}async readAnnotationQueue(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(r,"read annotation queue"),await r.json()}async updateAnnotationQueue(e,r){const{name:n,description:a,rubricInstructions:o}=r,i=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:a,rubric_instructions:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"update annotation queue")}async deleteAnnotationQueue(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"delete annotation queue")}async addRunsToAnnotationQueue(e,r){const n=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r.map((a,o)=>Ee(a,`runIds[${o}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,r){const n=`/annotation-queues/${Ee(e,"queueId")}/run`,a=await this.caller.call(he(this.debug),`${this.apiUrl}${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,r){const n=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs/${Ee(r,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(r,"get size from annotation queue"),await r.json()}async _currentTenantIsOwner(e){const r=await this._getSettings();return e=="-"||r.tenant_handle===e}async _ownerConflictError(e,r){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${r}`)}async _getLatestCommitHash(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();if(!r.ok){const a=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),o=new Error(`Error ${r.status}: ${r.statusText}
${a}`);throw o.statusCode=r.status,o}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,r){const[n,a,o]=an(e),i=await this.caller.call(he(this.debug),`${this.apiUrl}/likes/${n}/${a}`,{method:"POST",body:JSON.stringify({like:r}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,`${r?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[r,n,a]=an(e);if(await this._currentTenantIsOwner(r)){const o=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${n}/${a.substring(0,8)}?organizationId=${o.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${o.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${r}/${n}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${r}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const r of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*r}async*listPrompts(e){const r=new URLSearchParams;r.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),r.append("sort_direction","desc"),r.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&r.append("is_public",e.isPublic.toString()),e!=null&&e.query&&r.append("query",e.query);for await(const n of this._getPaginated("/repos",r,a=>a.repos))yield*n}async getPrompt(e){const[r,n,a]=an(e),o=await this.caller.call(he(this.debug),`${this.apiUrl}/repos/${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(o.status===404)return null;await Se(o,"get prompt");const i=await o.json();return i.repo?i.repo:null}async createPrompt(e,r){const n=await this._getSettings();if(r!=null&&r.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[a,o,i]=an(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const s={repo_handle:o,...(r==null?void 0:r.description)&&{description:r.description},...(r==null?void 0:r.readme)&&{readme:r.readme},...(r==null?void 0:r.tags)&&{tags:r.tags},is_public:!!(r!=null&&r.isPublic)},l=await this.caller.call(he(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(l,"create prompt");const{repo:c}=await l.json();return c}async createCommit(e,r,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,o,i]=an(e),s=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${a}/${o}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(r)),parent_commit:s},c=await this.caller.call(he(this.debug),`${this.apiUrl}/commits/${a}/${o}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(c,"create commit");const d=await c.json();return this._getPromptUrl(`${a}/${o}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,r=[]){return this._updateExamplesMultipart(e,r)}async _updateExamplesMultipart(e,r=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const i of r){const s=i.id,l={...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},c=Mt(l,`Serializing body for example with id: ${s}`),d=new Blob([c],{type:"application/json"});if(n.append(s,d),i.inputs){const u=Mt(i.inputs,`Serializing inputs for example with id: ${s}`),h=new Blob([u],{type:"application/json"});n.append(`${s}.inputs`,h)}if(i.outputs){const u=Mt(i.outputs,`Serializing outputs whle updating example with id: ${s}`),h=new Blob([u],{type:"application/json"});n.append(`${s}.outputs`,h)}if(i.attachments)for(const[u,h]of Object.entries(i.attachments)){let p,f;Array.isArray(h)?[p,f]=h:(p=h.mimeType,f=h.data);const g=new Blob([f],{type:`${p}; length=${f.byteLength}`});n.append(`${s}.attachment.${u}`,g)}if(i.attachments_operations){const u=Mt(i.attachments_operations,`Serializing attachments while updating example with id: ${s}`),h=new Blob([u],{type:"application/json"});n.append(`${s}.attachments_operations`,h)}}const a=e??((o=r[0])==null?void 0:o.dataset_id);return await(await this.caller.call(he(this.debug),`${this.apiUrl}/v1/platform/datasets/${a}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,r=[]){return this._uploadExamplesMultipart(e,r)}async _uploadExamplesMultipart(e,r=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const o of r){const i=(o.id??ht()).toString(),s={created_at:o.created_at,...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split},...o.source_run_id&&{source_run_id:o.source_run_id},...o.use_source_run_io&&{use_source_run_io:o.use_source_run_io},...o.use_source_run_attachments&&{use_source_run_attachments:o.use_source_run_attachments}},l=Mt(s,`Serializing body for uploaded example with id: ${i}`),c=new Blob([l],{type:"application/json"});if(n.append(i,c),o.inputs){const d=Mt(o.inputs,`Serializing inputs for uploaded example with id: ${i}`),u=new Blob([d],{type:"application/json"});n.append(`${i}.inputs`,u)}if(o.outputs){const d=Mt(o.outputs,`Serializing outputs for uploaded example with id: ${i}`),u=new Blob([d],{type:"application/json"});n.append(`${i}.outputs`,u)}if(o.attachments)for(const[d,u]of Object.entries(o.attachments)){let h,p;Array.isArray(u)?[h,p]=u:(h=u.mimeType,p=u.data);const f=new Blob([p],{type:`${h}; length=${p.byteLength}`});n.append(`${i}.attachment.${d}`,f)}}const a=await this.caller.call(he(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n});return await Se(a,"upload examples"),await a.json()}async updatePrompt(e,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,a]=an(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const o={};if((r==null?void 0:r.description)!==void 0&&(o.description=r.description),(r==null?void 0:r.readme)!==void 0&&(o.readme=r.readme),(r==null?void 0:r.tags)!==void 0&&(o.tags=r.tags),(r==null?void 0:r.isPublic)!==void 0&&(o.is_public=r.isPublic),(r==null?void 0:r.isArchived)!==void 0&&(o.is_archived=r.isArchived),Object.keys(o).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(he(this.debug),`${this.apiUrl}/repos/${n}/${a}`,{method:"PATCH",body:JSON.stringify(o),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,n,a]=an(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("delete a prompt",r);return await(await this.caller.call(he(this.debug),`${this.apiUrl}/repos/${r}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,r){const[n,a,o]=an(e),i=await this.caller.call(he(this.debug),`${this.apiUrl}/commits/${n}/${a}/${o}${r!=null&&r.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"pull prompt commit");const s=await i.json();return{owner:n,repo:a,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async _pullPrompt(e,r){const n=await this.pullPromptCommit(e,{includeModel:r==null?void 0:r.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,r){return await this.promptExists(e)?r&&Object.keys(r).some(n=>n!=="object")&&await this.updatePrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}):await this.createPrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}),r!=null&&r.object?await this.createCommit(e,r==null?void 0:r.object,{parentCommitHash:r==null?void 0:r.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,r={}){const{sourceApiUrl:n=this.apiUrl,datasetName:a}=r,[o,i]=this.parseTokenOrUrl(e,n),s=new $o({apiUrl:o,apiKey:"placeholder"}),l=await s.readSharedDataset(i),c=a||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const d=await s.listSharedExamples(i),u=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:d.map(h=>h.inputs),outputs:d.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:u.id})}catch(h){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),h}}parseTokenOrUrl(e,r,n=2,a="dataset"){try{return Ee(e),[r,e]}catch{}try{const o=new URL(e).pathname.split("/").filter(i=>i!=="");if(o.length>=n){const i=o[o.length-n];return[r,i]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function kw(t){return"dataset_id"in t||"dataset_name"in t}const pM=t=>!!["TRACING_V2","TRACING"].find(e=>Yt(e)==="true"),lh=Symbol.for("lc:context_variables");function fM(t){return t.replace(/[-:.]/g,"")}function mM(t,e,r=1){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return fM(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}class Bs{constructor(e,r,n,a){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=r,this.project_name=n,this.replicas=a}static fromHeader(e){const r=e.split(",");let n={},a=[],o,i;for(const s of r){const[l,c]=s.split("="),d=decodeURIComponent(c);l==="langsmith-metadata"?n=JSON.parse(d):l==="langsmith-tags"?a=d.split(","):l==="langsmith-project"?o=d:l==="langsmith-replicas"&&(i=JSON.parse(d))}return new Bs(n,a,o,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class vt{constructor(e){var s;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Aw(e)){Object.assign(this,{...e});return}const r=vt.getDefaultConfig(),{metadata:n,...a}=e,o=a.client??vt.getSharedClient(),i={...n,...(s=a==null?void 0:a.extra)==null?void 0:s.metadata};if(a.extra={...a.extra,metadata:i},Object.assign(this,{...r,...a,client:o}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=mM(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}set metadata(e){var r;this.extra={...this.extra,metadata:{...(r=this.extra)==null?void 0:r.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:ht(),run_type:"chain",project_name:au(),child_runs:[],api_url:nn("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:nn("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return vt.sharedClient||(vt.sharedClient=new $o),vt.sharedClient}createChild(e){var l,c,d,u,h,p;const r=this.child_execution_order+1,n=new vt({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r});lh in this&&(n[lh]=this[lh]);const a=Symbol.for("lc:child_config"),o=((l=e.extra)==null?void 0:l[a])??this.extra[a];if(yM(o)){const f={...o},g=gM(f.callbacks)?(d=(c=f.callbacks).copy)==null?void 0:d.call(c):void 0;g&&(Object.assign(g,{_parentRunId:n.id}),(p=(h=(u=g.handlers)==null?void 0:u.find(Tw))==null?void 0:h.updateFromRunTree)==null||p.call(h,n),f.callbacks=g),n.extra[a]=f}const i=new Set;let s=this;for(;s!=null&&!i.has(s.id);)i.add(s.id),s.child_execution_order=Math.max(s.child_execution_order,r),s=s.parent_run;return this.child_runs.push(n),n}async end(e,r,n=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??r,this.end_time=this.end_time??n,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,r,n=!0){var s,l;const a=e.extra??{};if(((s=a==null?void 0:a.runtime)==null?void 0:s.library)===void 0&&(a.runtime||(a.runtime={}),r))for(const[c,d]of Object.entries(r))a.runtime[c]||(a.runtime[c]=d);let o,i;return n?(i=(l=e.parent_run)==null?void 0:l.id,o=[]):(o=e.child_runs.map(c=>this._convertToCreate(c,r,n)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:o,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,r,n=!0){const a=this._convertToCreate(this,r,n);if(e===this.project_name)return a;const o=d=>iv(`${d}:${e}`,iv.DNS),i=o(a.id),s=a.trace_id?o(a.trace_id):void 0,l=a.parent_run_id?o(a.parent_run_id):void 0;let c;if(a.dotted_order){const d=_M(a.dotted_order),u=[];for(let p=0;p<d.length-1;p++){const[f,g]=d[p],m=o(g);u.push(f.toISOString().replace(/[-:]/g,"").replace(".","")+m)}const[h]=d[d.length-1];u.push(h.toISOString().replace(/[-:]/g,"").replace(".","")+i),c=u.join(".")}else c=void 0;return{...a,id:i,trace_id:s,parent_run_id:l,dotted_order:c,session_name:e}}async postRun(e=!0){try{const r=wv();if(this.replicas&&this.replicas.length>0)for(const[n]of this.replicas){const a=this._remapForProject(n,r,!0);await this.client.createRun(a)}else{const n=this._convertToCreate(this,r,e);await this.client.createRun(n)}if(!e){Av("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const n of this.child_runs)await n.postRun(!1)}}catch(r){console.error(`Error in postRun for run ${this.id}:`,r)}}async patchRun(){var e;if(this.replicas&&this.replicas.length>0)for(const[r,n]of this.replicas){const a=this._remapForProject(r);await this.client.updateRun(a.id,{inputs:a.inputs,outputs:a.outputs,error:a.error,parent_run_id:a.parent_run_id,session_name:a.session_name,reference_example_id:a.reference_example_id,end_time:a.end_time,dotted_order:a.dotted_order,trace_id:a.trace_id,events:a.events,tags:a.tags,extra:a.extra,attachments:this.attachments,...n})}else try{const r={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,r)}catch(r){console.error(`Error in patchRun for run ${this.id}`,r)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,r){var l,c,d,u;const n=e==null?void 0:e.callbacks;let a,o,i,s=pM();if(n){const h=((l=n==null?void 0:n.getParentRunId)==null?void 0:l.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(f=>(f==null?void 0:f.name)=="langchain_tracer");a=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,h),o=p==null?void 0:p.projectName,i=p==null?void 0:p.client,s=s||!!p}return a?new vt({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:i,tracingEnabled:s,project_name:o,tags:[...new Set(((a==null?void 0:a.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(u=a==null?void 0:a.extra)==null?void 0:u.metadata,...e==null?void 0:e.metadata}}}).createChild(r):new vt({...r,client:i,tracingEnabled:s,project_name:o})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,r){var c;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=n["langsmith-trace"];if(!a||typeof a!="string")return;const o=a.trim(),i=o.split(".").map(d=>{const[u,h]=d.split("Z");return{strTime:u,time:Date.parse(u+"Z"),uuid:h}}),s=i[0].uuid,l={...r,name:(r==null?void 0:r.name)??"parent",run_type:(r==null?void 0:r.run_type)??"chain",start_time:(r==null?void 0:r.start_time)??Date.now(),id:(c=i.at(-1))==null?void 0:c.uuid,trace_id:s,dotted_order:o};if(n.baggage&&typeof n.baggage=="string"){const d=Bs.fromHeader(n.baggage);l.metadata=d.metadata,l.tags=d.tags,l.project_name=d.project_name,l.replicas=d.replicas}return new vt(l)}toHeaders(e){var n;const r={"langsmith-trace":this.dotted_order,baggage:new Bs((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[a,o]of Object.entries(r))e.set(a,o);return r}}Object.defineProperty(vt,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function Aw(t){return t!==void 0&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function Tw(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function Mw(t){return Array.isArray(t)&&t.some(e=>Tw(e))}function gM(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function yM(t){var e;return t!==void 0&&typeof t.callbacks=="object"&&(Mw((e=t.callbacks)==null?void 0:e.handlers)||Mw(t.callbacks))}function _M(t){return t.split(".").map(e=>{const r=e.slice(0,-36),n=e.slice(-36),a=parseInt(r.slice(0,4)),o=parseInt(r.slice(4,6))-1,i=parseInt(r.slice(6,8)),s=parseInt(r.slice(9,11)),l=parseInt(r.slice(11,13)),c=parseInt(r.slice(13,15)),d=parseInt(r.slice(15,21));return[new Date(a,o,i,s,l,c,d/1e3),n]})}let vM=class{getStore(){}run(t,e){return e()}};const ch=Symbol.for("ls:tracing_async_local_storage"),wM=new vM;let bM=class{getInstance(){return globalThis[ch]??wM}initializeGlobalInstance(t){globalThis[ch]===void 0&&(globalThis[ch]=t)}};const EM=new bM;function SM(t=!1){const e=EM.getInstance().getStore();if(!t&&!Aw(e))throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function dh(t){return typeof t=="function"&&"langsmith:traceable"in t}const xM=Object.prototype.hasOwnProperty;cf=function(t,e){return xM.call(t,e)},lf=function(t){if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<r.length;n++)r[n]=""+n;return r}if(Object.keys)return Object.keys(t);let e=[];for(let r in t)cf(t,r)&&e.push(r);return e},wn=function(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}};function uh(t){let e=0;const r=t.length;let n;for(;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}j0=function(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")};function kM(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function hh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(hh(t[r]))return!0}else if(typeof t=="object"){const r=lf(t),n=r.length;for(var e=0;e<n;e++)if(hh(t[r[e]]))return!0}}return!1}function Fw(t,e){const r=[t];for(const n in e){const a=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof a<"u"&&r.push(`${n}: ${a}`)}return r.join(`
`)}class AM extends Error{constructor(e,r,n,a,o){super(Fw(e,{name:r,index:n,operation:a,tree:o})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.setPrototypeOf(this,new.target.prototype),this.message=Fw(e,{name:r,index:n,operation:a,tree:o})}}const et=AM,Ta={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){let n=ph(r,this.path);n&&(n=wn(n));const a=zo(r,{op:"remove",path:this.from}).removed;return zo(r,{op:"add",path:this.path,value:a}),{newDocument:r,removed:n}},copy:function(t,e,r){const n=ph(r,this.from);return zo(r,{op:"add",path:this.path,value:wn(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:Ws(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}};var TM={add:function(t,e,r){return uh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:Ta.move,copy:Ta.copy,test:Ta.test,_get:Ta._get};function ph(t,e){if(e=="")return t;var r={op:"_get",path:e};return zo(t,r),r.value}function zo(t,e,r=!1,n=!0,a=!0,o=0){if(r&&(typeof r=="function"?r(e,0,t,e.path):fh(e,0)),e.path===""){let i={newDocument:t};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=t,i;if(e.op==="move"||e.op==="copy")return i.newDocument=ph(t,e.from),e.op==="move"&&(i.removed=t),i;if(e.op==="test"){if(i.test=Ws(t,e.value),i.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return i.newDocument=t,i}else{if(e.op==="remove")return i.removed=t,i.newDocument=null,i;if(e.op==="_get")return e.value=t,i;if(r)throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return i}}else{n||(t=wn(t));const i=(e.path||"").split("/");let s=t,l=1,c=i.length,d,u,h;for(typeof r=="function"?h=r:h=fh;;){if(u=i[l],u&&u.indexOf("~")!=-1&&(u=kM(u)),a&&(u=="__proto__"||u=="prototype"&&l>0&&i[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(s[u]===void 0?d=i.slice(0,l).join("/"):l==c-1&&(d=e.path),d!==void 0&&h(e,0,t,d)),l++,Array.isArray(s)){if(u==="-")u=s.length;else{if(r&&!uh(u))throw new et("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);uh(u)&&(u=~~u)}if(l>=c){if(r&&e.op==="add"&&u>s.length)throw new et("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);const p=TM[e.op].call(e,s,u,t);if(p.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return p}}else if(l>=c){const p=Ta[e.op].call(e,s,u,t);if(p.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return p}if(s=s[u],r&&l<c&&(!s||typeof s!="object"))throw new et("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,e,t)}}}function Hs(t,e,r,n=!0,a=!0){if(r&&!Array.isArray(e))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=wn(t));const o=new Array(e.length);for(let i=0,s=e.length;i<s;i++)o[i]=zo(t,e[i],r,!0,a,i),t=o[i].newDocument;return o.newDocument=t,o}function fh(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new et("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(Ta[t.op]){if(typeof t.path!="string")throw new et("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new et('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new et("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&hh(t.value))throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var a=t.path.split("/").length,o=n.split("/").length;if(a!==o+1&&a!==o)throw new et("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new et("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var i={op:"_get",path:t.from,value:void 0},s=MM([i],r);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new et("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function MM(t,e,r){try{if(!Array.isArray(t))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Hs(wn(e),wn(t),r||!0);else{r=r||fh;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(a){if(a instanceof et)return a;throw a}}function Ws(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),a,o,i;if(r&&n){if(o=t.length,o!=e.length)return!1;for(a=o;a--!==0;)if(!Ws(t[a],e[a]))return!1;return!0}if(r!=n)return!1;var s=Object.keys(t);if(o=s.length,o!==Object.keys(e).length)return!1;for(a=o;a--!==0;)if(!e.hasOwnProperty(s[a]))return!1;for(a=o;a--!==0;)if(i=s[a],!Ws(t[i],e[i]))return!1;return!0}return t!==t&&e!==e}var Rw,Ow;function FM(){return Ow||(Ow=1,Rw=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Rw}var RM=FM();const OM=Ja(RM);var Gs={exports:{}},Nw;function NM(){if(Nw)return Gs.exports;Nw=1;const t=/[\p{Lu}]/u,e=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,o=new RegExp("^"+a.source),i=new RegExp(a.source+n.source,"gu"),s=new RegExp("\\d+"+n.source,"gu"),l=(h,p,f)=>{let g=!1,m=!1,_=!1;for(let v=0;v<h.length;v++){const A=h[v];g&&t.test(A)?(h=h.slice(0,v)+"-"+h.slice(v),g=!1,_=m,m=!0,v++):m&&_&&e.test(A)?(h=h.slice(0,v-1)+"-"+h.slice(v-1),_=m,m=!1,g=!0):(g=p(A)===A&&f(A)!==A,_=m,m=f(A)===A&&p(A)!==A)}return h},c=(h,p)=>(r.lastIndex=0,h.replace(r,f=>p(f))),d=(h,p)=>(i.lastIndex=0,s.lastIndex=0,h.replace(i,(f,g)=>p(g)).replace(s,f=>p(f))),u=(h,p)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(h)?h=h.map(m=>m.trim()).filter(m=>m.length).join("-"):h=h.trim(),h.length===0)return"";const f=p.locale===!1?m=>m.toLowerCase():m=>m.toLocaleLowerCase(p.locale),g=p.locale===!1?m=>m.toUpperCase():m=>m.toLocaleUpperCase(p.locale);return h.length===1?p.pascalCase?g(h):f(h):(h!==f(h)&&(h=l(h,f,g)),h=h.replace(o,""),p.preserveConsecutiveUppercase?h=c(h,f):h=f(h),p.pascalCase&&(h=g(h.charAt(0))+h.slice(1)),d(h,g))};return Gs.exports=u,Gs.exports.default=u,Gs.exports}NM();function IM(t,e){return(e==null?void 0:e[t])||OM(t)}function PM(t,e,r){const n={};for(const a in t)Object.hasOwn(t,a)&&(n[e(a,r)]=t[a]);return n}function Iw(t){return Array.isArray(t)?[...t]:{...t}}function CM(t,e){const r=Iw(t);for(const[n,a]of Object.entries(e)){const[o,...i]=n.split(".").reverse();let s=r;for(const l of i.reverse()){if(s[l]===void 0)break;s[l]=Iw(s[l]),s=s[l]}s[o]!==void 0&&(s[o]={lc:1,type:"secret",id:[a]})}return r}function Pw(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}bn=class{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Pw(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(t,...e){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(t||{}).filter(([r])=>{var n;return(n=this.lc_serializable_keys)==null?void 0:n.includes(r)})):this.lc_kwargs=t??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof bn||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const t={},e={},r=Object.keys(this.lc_kwargs).reduce((n,a)=>(n[a]=a in this?this[a]:this.lc_kwargs[a],n),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(t,Reflect.get(n,"lc_aliases",this)),Object.assign(e,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));return Object.keys(e).forEach(n=>{let a=this,o=r;const[i,...s]=n.split(".").reverse();for(const l of s.reverse()){if(!(l in a)||a[l]===void 0)return;(!(l in o)||o[l]===void 0)&&(typeof a[l]=="object"&&a[l]!=null?o[l]={}:Array.isArray(a[l])&&(o[l]=[])),a=a[l],o=o[l]}i in a&&a[i]!==void 0&&(o[i]=o[i]||a[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:PM(Object.keys(e).length?CM(r,e):r,IM,t)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};var mh={};const jM=()=>typeof window<"u"&&typeof window.document<"u",LM=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",DM=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),gh=()=>typeof Deno<"u",$M=()=>typeof _t<"u"&&typeof _t.versions<"u"&&typeof _t.versions.node<"u"&&!gh(),zM=()=>{let t;return jM()?t="browser":$M()?t="node":LM()?t="webworker":DM()?t="jsdom":gh()?t="deno":t="other",t};let yh;function UM(){return yh===void 0&&(yh={library:"langchain-js",runtime:zM()}),yh}_n=function(t){try{return typeof _t<"u"?mh==null?void 0:mh[t]:gh()?Deno==null?void 0:Deno.env.get(t):void 0}catch{return}};class BM{}k0=function(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming};class Uo extends BM{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Pw(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:_n("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return bn.prototype.toJSON.call(this)}toJSONNotImplemented(){return bn.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class r extends Uo{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,e)}}return new r}}const HM=t=>{const e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},WM=t=>{if(t)return t.events=t.events??[],t.child_runs=t.child_runs??[],t};function _h(t,e){if(t)return new vt({...t,parent_run:_h(e),child_runs:t.child_runs.map(r=>_h(r)).filter(r=>r!==void 0),extra:{...t.extra,runtime:UM()},tracingEnabled:!1})}function vh(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function GM(t){return t.replace(/[-:.]/g,"")}function qM(t,e,r){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return GM(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}function Bo(t){return typeof t._addRunToRunMap=="function"}class Ho extends Uo{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?WM(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,r){e.child_runs.push(r)}_addRunToRunMap(e){const r=qM(e.start_time,e.id,e.execution_order),n={...e},a=this.getRunById(n.parent_run_id);if(n.parent_run_id!==void 0?a&&(this._addChildRun(a,n),a.child_execution_order=Math.max(a.child_execution_order,n.child_execution_order),n.trace_id=a.trace_id,a.dotted_order!==void 0&&(n.dotted_order=[a.dotted_order,r].join("."))):(n.trace_id=n.id,n.dotted_order=r),this.usesRunTreeMap){const o=_h(n,a);o!==void 0&&this.runTreeMap.set(n.id,o)}else this.runMap.set(n.id,n);return n}async _endTrace(e){var n;const r=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);r?r.child_execution_order=Math.max(r.child_execution_order,e.child_execution_order):await this.persistRun(e),await((n=this.onRunUpdate)==null?void 0:n.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const r=e!==void 0&&this.getRunById(e);return r?r.child_execution_order+1:1}_createRunForLLMStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),d=Date.now(),u=s?{...o,metadata:s}:o,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:r},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:i||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,r,n,a,o,i,s,l){var d,u;const c=this.getRunById(n)??this._createRunForLLMStart(e,r,n,a,o,i,s,l);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((u=this.onLLMStart)==null?void 0:u.call(this,c)),c}_createRunForChatModelStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),d=Date.now(),u=s?{...o,metadata:s}:o,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:r},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:u??{},tags:i||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,r,n,a,o,i,s,l){var d,u;const c=this.getRunById(n)??this._createRunForChatModelStart(e,r,n,a,o,i,s,l);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((u=this.onLLMStart)==null?void 0:u.call(this,c)),c}async handleLLMEnd(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...o},await((s=this.onLLMEnd)==null?void 0:s.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...o},await((s=this.onLLMError)==null?void 0:s.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),d=Date.now(),u={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:r,execution_order:c,child_execution_order:c,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(u)}async handleChainStart(e,r,n,a,o,i,s,l){var d,u;const c=this.getRunById(n)??this._createRunForChainStart(e,r,n,a,o,i,s,l);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((u=this.onChainStart)==null?void 0:u.call(this,c)),c}async handleChainEnd(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=vh(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(i.inputs=vh(o.inputs,"input")),await((s=this.onChainEnd)==null?void 0:s.call(this,i)),await this._endTrace(i),i}async handleChainError(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(i.inputs=vh(o.inputs,"input")),await((s=this.onChainError)==null?void 0:s.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,r,n,a,o,i,s){const l=this._getExecutionOrder(a),c=Date.now(),d={id:n,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:r},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(d)}async handleToolStart(e,r,n,a,o,i,s){var c,d;const l=this.getRunById(n)??this._createRunForToolStart(e,r,n,a,o,i,s);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((d=this.onToolStart)==null?void 0:d.call(this,l)),l}async handleToolEnd(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleToolError(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,r){var o;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const a=n;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((o=this.onAgentAction)==null?void 0:o.call(this,n))}async handleAgentEnd(e,r){var a;const n=this.getRunById(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,n)))}_createRunForRetrieverStart(e,r,n,a,o,i,s){const l=this._getExecutionOrder(a),c=Date.now(),d={id:n,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:r},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(d)}async handleRetrieverStart(e,r,n,a,o,i,s){var c,d;const l=this.getRunById(n)??this._createRunForRetrieverStart(e,r,n,a,o,i,s);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((d=this.onRetrieverStart)==null?void 0:d.call(this,l)),l}async handleRetrieverEnd(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleText(e,r){var a;const n=this.getRunById(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,n)))}async handleLLMNewToken(e,r,n,a,o,i){var l;const s=this.getRunById(n);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:r,chunk:i==null?void 0:i.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,s,e,{chunk:i==null?void 0:i.chunk})),s}}var wh={exports:{}};wh.exports;var Cw;function VM(){return Cw||(Cw=1,function(t){const e=(a=0)=>o=>`\x1B[${38+a};5;${o}m`,r=(a=0)=>(o,i,s)=>`\x1B[${38+a};2;${o};${i};${s}m`;function n(){const a=new Map,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};o.color.gray=o.color.blackBright,o.bgColor.bgGray=o.bgColor.bgBlackBright,o.color.grey=o.color.blackBright,o.bgColor.bgGrey=o.bgColor.bgBlackBright;for(const[i,s]of Object.entries(o)){for(const[l,c]of Object.entries(s))o[l]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},s[l]=o[l],a.set(c[0],c[1]);Object.defineProperty(o,i,{value:s,enumerable:!1})}return Object.defineProperty(o,"codes",{value:a,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi256=e(),o.color.ansi16m=r(),o.bgColor.ansi256=e(10),o.bgColor.ansi16m=r(10),Object.defineProperties(o,{rgbToAnsi256:{value:(i,s,l)=>i===s&&s===l?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(s/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:i=>{const s=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(i.toString(16));if(!s)return[0,0,0];let{colorString:l}=s.groups;l.length===3&&(l=l.split("").map(d=>d+d).join(""));const c=Number.parseInt(l,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:i=>o.rgbToAnsi256(...o.hexToRgb(i)),enumerable:!1}}),o}Object.defineProperty(t,"exports",{enumerable:!0,get:n})}(wh)),wh.exports}var ZM=VM();const jw=Ja(ZM);function ft(t,e){return`${t.open}${e}${t.close}`}function Lt(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function Lw(t){return typeof t=="string"?t.trim():t==null?t:Lt(t,t.toString())}function on(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:wt}=jw;class Dw extends Ho{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const r=[];let n=e;for(;n.parent_run_id;){const a=this.runMap.get(n.parent_run_id);if(a)r.push(a),n=a;else break}return r}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((n,a,o)=>{const i=`${n.execution_order}:${n.run_type}:${n.name}`;return a===o.length-1?ft(jw.bold,i):i}).join(" > ");return ft(wt.grey,r)}onChainStart(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.green,"[chain/start]")} [${r}] Entering Chain run with input: ${Lt(e.inputs,"[inputs]")}`)}onChainEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.cyan,"[chain/end]")} [${r}] [${on(e)}] Exiting Chain run with output: ${Lt(e.outputs,"[outputs]")}`)}onChainError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.red,"[chain/error]")} [${r}] [${on(e)}] Chain run errored with error: ${Lt(e.error,"[error]")}`)}onLLMStart(e){const r=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${ft(wt.green,"[llm/start]")} [${r}] Entering LLM run with input: ${Lt(n,"[inputs]")}`)}onLLMEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.cyan,"[llm/end]")} [${r}] [${on(e)}] Exiting LLM run with output: ${Lt(e.outputs,"[response]")}`)}onLLMError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.red,"[llm/error]")} [${r}] [${on(e)}] LLM run errored with error: ${Lt(e.error,"[error]")}`)}onToolStart(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.green,"[tool/start]")} [${r}] Entering Tool run with input: "${Lw(e.inputs.input)}"`)}onToolEnd(e){var n;const r=this.getBreadcrumbs(e);console.log(`${ft(wt.cyan,"[tool/end]")} [${r}] [${on(e)}] Exiting Tool run with output: "${Lw((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.red,"[tool/error]")} [${r}] [${on(e)}] Tool run errored with error: ${Lt(e.error,"[error]")}`)}onRetrieverStart(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.green,"[retriever/start]")} [${r}] Entering Retriever run with input: ${Lt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.cyan,"[retriever/end]")} [${r}] [${on(e)}] Exiting Retriever run with output: ${Lt(e.outputs,"[outputs]")}`)}onRetrieverError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(wt.red,"[retriever/error]")} [${r}] [${on(e)}] Retriever run errored with error: ${Lt(e.error,"[error]")}`)}onAgentAction(e){const r=e,n=this.getBreadcrumbs(e);console.log(`${ft(wt.blue,"[agent/action]")} [${n}] Agent selected action: ${Lt(r.actions[r.actions.length-1],"[action]")}`)}}$p=function(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t},jl=function(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")},v0=function(t){return!!(t&&typeof t=="object"&&"toolCall"in t&&t.toolCall!=null&&typeof t.toolCall=="object"&&"id"in t.toolCall&&typeof t.toolCall.id=="string")},Sp=class extends Error{constructor(t,e){super(t),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=e}},I0=function(t,e=Zl){t=t.trim();const r=t.indexOf("```");if(r===-1)return e(t);let n=t.substring(r+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));const a=n.indexOf("```");let o=n;return a!==-1&&(o=n.substring(0,a)),e(o.trim())},Zl=function(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const r=[];let n=!1,a=!1;for(let o of t){if(n)o==='"'&&!a?n=!1:o===`
`&&!a?o="\\n":o==="\\"?a=!a:a=!1;else if(o==='"')n=!0,a=!1;else if(o==="{")r.push("}");else if(o==="[")r.push("]");else if(o==="}"||o==="]")if(r&&r[r.length-1]===o)r.pop();else return null;e+=o}n&&(e+='"');for(let o=r.length-1;o>=0;o-=1)e+=r[o];try{return JSON.parse(e)}catch{return null}},Yn=function(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&"source_type"in t&&(t.source_type==="url"||t.source_type==="base64"||t.source_type==="text"||t.source_type==="id")},M0=function(t){return Yn(t)&&t.source_type==="url"&&"url"in t&&typeof t.url=="string"},F0=function(t){return Yn(t)&&t.source_type==="base64"&&"data"in t&&typeof t.data=="string"},R0=function(t){if(Yn(t)){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url}};if(t.source_type==="base64"){if(!t.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${t.mime_type};base64,${t.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")},W0=function(t){const e=t.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${t}" - does not match type/subtype format.`);const r=e[0].trim(),n=e[1].trim();if(r===""||n==="")throw new Error(`Invalid mime type: "${t}" - type or subtype is empty.`);const a={};for(const o of t.split(";").slice(1)){const i=o.split("=");if(i.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${t}".`);const s=i[0].trim(),l=i[1].trim();if(s==="")throw new Error(`Invalid parameter syntax in mime type: "${t}".`);a[s]=l}return{type:r,subtype:n,parameters:a}},H0=function({dataUrl:t,asTypedArray:e=!1}){const r=t.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let n;if(r){n=r[1].toLowerCase();const a=e?Uint8Array.from(atob(r[2]),o=>o.charCodeAt(0)):r[2];return{mime_type:n,data:a}}},B0=function(t,e){if(t.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(t)}if(t.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(t)}if(t.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(t)}if(t.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(t)}throw new Error(`Unable to convert content block type '${t.type}' to provider-specific format: not recognized.`)};function Ma(t,e){return typeof t=="string"?t===""?e:typeof e=="string"?t+e:Array.isArray(e)&&e.some(r=>Yn(r))?[{type:"text",source_type:"text",text:t},...e]:[{type:"text",text:t},...e]:Array.isArray(e)?qs(t,e)??[...t,...e]:e===""?t:Array.isArray(t)&&t.some(r=>Yn(r))?[...t,{type:"file",source_type:"text",text:e}]:[...t,{type:"text",text:e}]}function JM(t,e){return t==="error"||e==="error"?"error":"success"}function KM(t,e){function r(n,a){if(typeof n!="object"||n===null||n===void 0)return n;if(a>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>r(i,a+1));const o={};for(const i of Object.keys(n))o[i]=r(n[i],a+1);return o}return JSON.stringify(r(t,0),null,2)}class Fa extends bn{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,r){typeof e=="string"&&(e={content:e,additional_kwargs:r,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const r=KM(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${r}`}}function mt(t,e){const r={...t};for(const[n,a]of Object.entries(e))if(r[n]==null)r[n]=a;else{if(a==null)continue;if(typeof r[n]!=typeof a||Array.isArray(r[n])!==Array.isArray(a))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof r[n]=="string"){if(n==="type")continue;r[n]+=a}else if(typeof r[n]=="object"&&!Array.isArray(r[n]))r[n]=mt(r[n],a);else if(Array.isArray(r[n]))r[n]=qs(r[n],a);else{if(r[n]===a)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return r}function qs(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const r=[...t];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const a=r.findIndex(o=>o.index===n.index);a!==-1?r[a]=mt(r[a],n):r.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;r.push(n)}return r}}}function YM(t,e){if(!t&&!e)throw new Error("Cannot merge two undefined objects.");if(!t||!e)return t||e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return qs(t,e);if(typeof t=="object"&&typeof e=="object")return mt(t,e);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}class Ra extends Fa{}function XM(t){return typeof t.role=="string"}Vl=function(t){return typeof(t==null?void 0:t._getType)=="function"},O0=function(t){return Vl(t)&&typeof t.concat=="function"},w0=function(t){return t!=null&&typeof t=="object"&&"lc_direct_tool_output"in t&&t.lc_direct_tool_output===!0},kp=class extends Fa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(t,e,r){typeof t=="string"&&(t={content:t,name:r,tool_call_id:e}),super(t),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=t.tool_call_id,this.artifact=t.artifact,this.status=t.status}_getType(){return"tool"}static isInstance(t){return t._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},ef=class extends Ra{constructor(t){super(t),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=t.tool_call_id,this.artifact=t.artifact,this.status=t.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(t){return new ef({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),artifact:YM(this.artifact,t.artifact),tool_call_id:this.tool_call_id,id:this.id??t.id,status:JM(this.status,t.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function QM(t){const e=[],r=[];for(const n of t)if(n.function){const a=n.function.name;try{const o=JSON.parse(n.function.arguments),i={name:a||"",args:o||{},id:n.id};e.push(i)}catch{r.push({name:a,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,r]}G0=function(t){return t._getType()==="tool"},Zn=class extends Fa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(t,e){var n;let r;if(typeof t=="string")r={content:t,tool_calls:[],invalid_tool_calls:[],additional_kwargs:e??{}};else{r=t;const a=(n=r.additional_kwargs)==null?void 0:n.tool_calls,o=r.tool_calls;a!=null&&a.length>0&&(o===void 0||o.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&o===void 0){const[i,s]=QM(a);r.tool_calls=i??[],r.invalid_tool_calls=s??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}},T0=function(t){return t._getType()==="ai"},z0=function(t){return t._getType()==="ai"},co=class extends Ra{constructor(t){let e;if(typeof t=="string")e={content:t,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(t.tool_call_chunks===void 0)e={...t,tool_calls:t.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:t.usage_metadata!==void 0?t.usage_metadata:void 0};else{const r=[],n=[];for(const a of t.tool_call_chunks){let o={};try{if(o=Zl(a.args||"{}"),o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:o,id:a.id,type:"tool_call"})}catch{n.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}e={...t,tool_calls:r,invalid_tool_calls:n,usage_metadata:t.usage_metadata!==void 0?t.usage_metadata:void 0}}super(e),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=e.tool_call_chunks??this.tool_call_chunks,this.tool_calls=e.tool_calls??this.tool_calls,this.invalid_tool_calls=e.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=e.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(t){var r,n,a,o,i,s,l,c,d,u,h,p,f,g,m,_,v,A,F,b,D,B,j,G,te,ue,x,R,k,E,H,N,C,P,Z,ne,le,ye,we,$e;const e={content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),tool_call_chunks:[],id:this.id??t.id};if(this.tool_call_chunks!==void 0||t.tool_call_chunks!==void 0){const Qe=qs(this.tool_call_chunks,t.tool_call_chunks);Qe!==void 0&&Qe.length>0&&(e.tool_call_chunks=Qe)}if(this.usage_metadata!==void 0||t.usage_metadata!==void 0){const Qe={...(((n=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:n.audio)!==void 0||((o=(a=t.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:o.audio)!==void 0)&&{audio:(((s=(i=this.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:s.audio)??0)+(((c=(l=t.usage_metadata)==null?void 0:l.input_token_details)==null?void 0:c.audio)??0)},...(((u=(d=this.usage_metadata)==null?void 0:d.input_token_details)==null?void 0:u.cache_read)!==void 0||((p=(h=t.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((g=(f=this.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:g.cache_read)??0)+(((_=(m=t.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:_.cache_read)??0)},...(((A=(v=this.usage_metadata)==null?void 0:v.input_token_details)==null?void 0:A.cache_creation)!==void 0||((b=(F=t.usage_metadata)==null?void 0:F.input_token_details)==null?void 0:b.cache_creation)!==void 0)&&{cache_creation:(((B=(D=this.usage_metadata)==null?void 0:D.input_token_details)==null?void 0:B.cache_creation)??0)+(((G=(j=t.usage_metadata)==null?void 0:j.input_token_details)==null?void 0:G.cache_creation)??0)}},Dt={...(((ue=(te=this.usage_metadata)==null?void 0:te.output_token_details)==null?void 0:ue.audio)!==void 0||((R=(x=t.usage_metadata)==null?void 0:x.output_token_details)==null?void 0:R.audio)!==void 0)&&{audio:(((E=(k=this.usage_metadata)==null?void 0:k.output_token_details)==null?void 0:E.audio)??0)+(((N=(H=t.usage_metadata)==null?void 0:H.output_token_details)==null?void 0:N.audio)??0)},...(((P=(C=this.usage_metadata)==null?void 0:C.output_token_details)==null?void 0:P.reasoning)!==void 0||((ne=(Z=t.usage_metadata)==null?void 0:Z.output_token_details)==null?void 0:ne.reasoning)!==void 0)&&{reasoning:(((ye=(le=this.usage_metadata)==null?void 0:le.output_token_details)==null?void 0:ye.reasoning)??0)+((($e=(we=t.usage_metadata)==null?void 0:we.output_token_details)==null?void 0:$e.reasoning)??0)}},Rt=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Fe=t.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},ut={input_tokens:Rt.input_tokens+Fe.input_tokens,output_tokens:Rt.output_tokens+Fe.output_tokens,total_tokens:Rt.total_tokens+Fe.total_tokens,...Object.keys(Qe).length>0&&{input_token_details:Qe},...Object.keys(Dt).length>0&&{output_token_details:Dt}};e.usage_metadata=ut}return new co(e)}},Jl=class extends Fa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Jl}constructor(t,e){typeof t=="string"&&(t={content:t,role:e}),super(t),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t.role}_getType(){return"generic"}static isInstance(t){return t._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},Ql=class extends Ra{static lc_name(){return"ChatMessageChunk"}constructor(t,e){typeof t=="string"&&(t={content:t,role:e}),super(t),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t.role}_getType(){return"generic"}concat(t){return new Ql({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),role:this.role,id:this.id??t.id})}get _printableFields(){return{...super._printableFields,role:this.role}}},Xl=class extends Ra{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(t){return new Xl({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),name:this.name??"",id:this.id??t.id})}},to=class extends Fa{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(t,e){super(t,e)}},Kl=class extends Ra{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(t,e){super(t,e)}concat(t){return new Kl({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),id:this.id??t.id})}},ao=class extends Fa{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(t,e){super(t,e)}},Yl=class extends Ra{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(t,e){super(t,e)}concat(t){return new Yl({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),id:this.id??t.id})}};function eF(t){return jl(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function tF(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function bh(t){let e,r;if(tF(t)){const n=t.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",r=t.kwargs}else{const{type:n,...a}=t;e=n,r=a}if(e==="human"||e==="user")return new to(r);if(e==="ai"||e==="assistant"){const{tool_calls:n,...a}=r;if(!Array.isArray(n))return new Zn(r);const o=n.map(eF);return new Zn({...a,tool_calls:o})}else{if(e==="system")return new ao(r);if(e==="developer")return new ao({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in r)return new kp({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});throw $p(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}$0=function(t){if(typeof t=="string")return new to(t);if(Vl(t))return t;if(Array.isArray(t)){const[e,r]=t;return bh({type:e,content:r})}else if(XM(t)){const{role:e,...r}=t;return bh({...r,type:e})}else return bh(t)},hf=function(t,e="Human",r="AI"){const n=[];for(const a of t){let o;if(a._getType()==="human")o=e;else if(a._getType()==="ai")o=r;else if(a._getType()==="system")o="System";else if(a._getType()==="function")o="Function";else if(a._getType()==="tool")o="Tool";else if(a._getType()==="generic")o=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);const i=a.name?`${a.name}, `:"",s=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);n.push(`${o}: ${i}${s}`)}return n.join(`
`)},N0=function(t){var r;const e=t._getType();if(e==="human")return new Kl({...t});if(e==="ai"){let n={...t};return"tool_calls"in n&&(n={...n,tool_call_chunks:(r=n.tool_calls)==null?void 0:r.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new co({...n})}else{if(e==="system")return new Yl({...t});if(e==="function")return new Xl({...t});if(Jl.isInstance(t))return new Ql({...t});throw new Error("Unknown message type.")}};let Eh;const rF=()=>{if(Eh===void 0){const t=_n("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Eh=new $o(t)}return Eh};class Wo extends Ho{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:r,projectName:n,client:a,replicas:o}=e;this.projectName=n??au(),this.replicas=o,this.exampleId=r,this.client=a??rF();const i=Wo.getTraceableRunTree();i&&this.updateFromRunTree(i)}async persistRun(e){}async onRunCreate(e){var r;await((r=this.getRunTreeWithTracingConfig(e.id))==null?void 0:r.postRun())}async onRunUpdate(e){var r;await((r=this.getRunTreeWithTracingConfig(e.id))==null?void 0:r.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let r=e;const n=new Set;for(;r.parent_run&&!(n.has(r.id)||(n.add(r.id),!r.parent_run));)r=r.parent_run;n.clear();const a=[r];for(;a.length>0;){const o=a.shift();!o||n.has(o.id)||(n.add(o.id),this.runTreeMap.set(o.id,o),o.child_runs&&a.push(...o.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const r=this.runTreeMap.get(e);if(r)return new vt({...r,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return SM(!0)}catch{return}}}const $w=Symbol.for("ls:tracing_async_local_storage"),Vs=Symbol.for("lc:context_variables"),nF=t=>{globalThis[$w]=t},Go=()=>globalThis[$w];let qo;function aF(){const t="default"in Pr?Pr.default:Pr;return new t({autoStart:!0,concurrency:1})}function oF(){return typeof qo>"u"&&(qo=aF()),qo}async function nt(t,e){if(e===!0){const r=Go();r!==void 0?await r.run(void 0,async()=>t()):await t()}else qo=oF(),qo.add(async()=>{const r=Go();r!==void 0?await r.run(void 0,async()=>t()):await t()})}const iF=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>_n(e)==="true");function zw(t){var r,n;const e=Go();return e===void 0||(n=(r=e.getStore())==null?void 0:r[Vs])==null?void 0:n[t]}const sF=Symbol("lc:configure_hooks"),lF=()=>zw(sF)||[];xp=function(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}};class cF{setHandler(e){return this.setHandlers([e])}}class Zs{constructor(e,r,n,a,o,i,s,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;try{await((n=r.handleText)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleText: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleCustomEvent(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;try{await((s=i.handleCustomEvent)==null?void 0:s.call(i,e,r,this.runId,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class dF extends Zs{getChild(e){const r=new Ot(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetriever`),r.raiseError)throw a}},r.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetrieverError: ${a}`),r.raiseError)throw e}},r.awaitHandlers)))}}class Uw extends Zs{async handleLLMNewToken(e,r,n,a,o,i){await Promise.all(this.handlers.map(s=>nt(async()=>{var l;if(!s.ignoreLLM)try{await((l=s.handleLLMNewToken)==null?void 0:l.call(s,e,r??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMNewToken: ${c}`),s.raiseError)throw c}},s.awaitHandlers)))}async handleLLMError(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreLLM)try{await((s=i.handleLLMError)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleLLMEnd(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreLLM)try{await((s=i.handleLLMEnd)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class uF extends Zs{getChild(e){const r=new Ot(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleChainError(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainError)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleChainEnd(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainEnd)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentAction)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentAction: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentEnd: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}}class hF extends Zs{getChild(e){const r=new Ot(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleToolError(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolError: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolEnd: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}}Ot=class extends cF{constructor(t,e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(e==null?void 0:e.handlers)??this.handlers,this.inheritableHandlers=(e==null?void 0:e.inheritableHandlers)??this.inheritableHandlers,this.tags=(e==null?void 0:e.tags)??this.tags,this.inheritableTags=(e==null?void 0:e.inheritableTags)??this.inheritableTags,this.metadata=(e==null?void 0:e.metadata)??this.metadata,this.inheritableMetadata=(e==null?void 0:e.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=t}getParentRunId(){return this._parentRunId}async handleLLMStart(t,e,r=void 0,n=void 0,a=void 0,o=void 0,i=void 0,s=void 0){return Promise.all(e.map(async(l,c)=>{const d=c===0&&r?r:ht();return await Promise.all(this.handlers.map(u=>{if(!u.ignoreLLM)return Bo(u)&&u._createRunForLLMStart(t,[l],d,this._parentRunId,a,this.tags,this.metadata,s),nt(async()=>{var h;try{await((h=u.handleLLMStart)==null?void 0:h.call(u,t,[l],d,this._parentRunId,a,this.tags,this.metadata,s))}catch(p){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleLLMStart: ${p}`),u.raiseError)throw p}},u.awaitHandlers)})),new Uw(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(t,e,r=void 0,n=void 0,a=void 0,o=void 0,i=void 0,s=void 0){return Promise.all(e.map(async(l,c)=>{const d=c===0&&r?r:ht();return await Promise.all(this.handlers.map(u=>{if(!u.ignoreLLM)return Bo(u)&&u._createRunForChatModelStart(t,[l],d,this._parentRunId,a,this.tags,this.metadata,s),nt(async()=>{var h,p;try{if(u.handleChatModelStart)await((h=u.handleChatModelStart)==null?void 0:h.call(u,t,[l],d,this._parentRunId,a,this.tags,this.metadata,s));else if(u.handleLLMStart){const f=hf(l);await((p=u.handleLLMStart)==null?void 0:p.call(u,t,[f],d,this._parentRunId,a,this.tags,this.metadata,s))}}catch(f){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleLLMStart: ${f}`),u.raiseError)throw f}},u.awaitHandlers)})),new Uw(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(t,e,r=ht(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreChain)return Bo(s)&&s._createRunForChainStart(t,e,r,this._parentRunId,this.tags,this.metadata,n,i),nt(async()=>{var l;try{await((l=s.handleChainStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,n,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new uF(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(t,e,r=ht(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreAgent)return Bo(s)&&s._createRunForToolStart(t,e,r,this._parentRunId,this.tags,this.metadata,i),nt(async()=>{var l;try{await((l=s.handleToolStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleToolStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new hF(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(t,e,r=ht(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreRetriever)return Bo(s)&&s._createRunForRetrieverStart(t,e,r,this._parentRunId,this.tags,this.metadata,i),nt(async()=>{var l;try{await((l=s.handleRetrieverStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleRetrieverStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new dF(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(t,e,r,n,a){await Promise.all(this.handlers.map(o=>nt(async()=>{var i;if(!o.ignoreCustomEvent)try{await((i=o.handleCustomEvent)==null?void 0:i.call(o,t,e,r,this.tags,this.metadata))}catch(s){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${s}`),o.raiseError)throw s}},o.awaitHandlers)))}addHandler(t,e=!0){this.handlers.push(t),e&&this.inheritableHandlers.push(t)}removeHandler(t){this.handlers=this.handlers.filter(e=>e!==t),this.inheritableHandlers=this.inheritableHandlers.filter(e=>e!==t)}setHandlers(t,e=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of t)this.addHandler(r,e)}addTags(t,e=!0){this.removeTags(t),this.tags.push(...t),e&&this.inheritableTags.push(...t)}removeTags(t){this.tags=this.tags.filter(e=>!t.includes(e)),this.inheritableTags=this.inheritableTags.filter(e=>!t.includes(e))}addMetadata(t,e=!0){this.metadata={...this.metadata,...t},e&&(this.inheritableMetadata={...this.inheritableMetadata,...t})}removeMetadata(t){for(const e of Object.keys(t))delete this.metadata[e],delete this.inheritableMetadata[e]}copy(t=[],e=!0){const r=new Ot(this._parentRunId);for(const n of this.handlers){const a=this.inheritableHandlers.includes(n);r.addHandler(n,a)}for(const n of this.tags){const a=this.inheritableTags.includes(n);r.addTags([n],a)}for(const n of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(n);r.addMetadata({[n]:this.metadata[n]},a)}for(const n of t)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===n.name)||r.addHandler(n,e);return r}static fromHandlers(t){class e extends Uo{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,t)}}const r=new this;return r.addHandler(new e),r}static configure(t,e,r,n,a,o,i){return this._configureSync(t,e,r,n,a,o,i)}static _configureSync(t,e,r,n,a,o,i){var u,h;let s;(t||e)&&(Array.isArray(t)||!t?(s=new Ot,s.setHandlers((t==null?void 0:t.map(Js))??[],!0)):s=t,s=s.copy(Array.isArray(e)?e.map(Js):e==null?void 0:e.handlers,!1));const l=_n("LANGCHAIN_VERBOSE")==="true"||(i==null?void 0:i.verbose),c=((u=Wo.getTraceableRunTree())==null?void 0:u.tracingEnabled)||iF(),d=c||(_n("LANGCHAIN_TRACING")??!1);if(l||d){if(s||(s=new Ot),l&&!s.handlers.some(p=>p.name===Dw.prototype.name)){const p=new Dw;s.addHandler(p,!0)}if(d&&!s.handlers.some(p=>p.name==="langchain_tracer")&&c){const p=new Wo;s.addHandler(p,!0),s._parentRunId=((h=Wo.getTraceableRunTree())==null?void 0:h.id)??s._parentRunId}}for(const{contextVar:p,inheritable:f=!0,handlerClass:g,envVar:m}of lF()){const _=m&&_n(m)==="true"&&g;let v;const A=p!==void 0?zw(p):void 0;A&&HM(A)?v=A:_&&(v=new g({})),v!==void 0&&(s||(s=new Ot),s.handlers.some(F=>F.name===v.name)||s.addHandler(v,f))}return(r||n)&&s&&(s.addTags(r??[]),s.addTags(n??[],!1)),(a||o)&&s&&(s.addMetadata(a??{}),s.addMetadata(o??{},!1)),s}};function Js(t){return"name"in t?t:Uo.fromMethods(t)}class pF{getStore(){}run(e,r){return r()}enterWith(e){}}const fF=new pF,Bw=Symbol.for("lc:child_config");class mF{getInstance(){return Go()??fF}getRunnableConfig(){var e,r;return(r=(e=this.getInstance().getStore())==null?void 0:e.extra)==null?void 0:r[Bw]}runWithConfig(e,r,n){var d;const a=Ot._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),o=this.getInstance(),i=o.getStore(),s=a==null?void 0:a.getParentRunId(),l=(d=a==null?void 0:a.handlers)==null?void 0:d.find(u=>(u==null?void 0:u.name)==="langchain_tracer");let c;return l&&s?c=l.getRunTreeWithTracingConfig(s):n||(c=new vt({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Bw]:e}),i!==void 0&&i[Vs]!==void 0&&(c===void 0&&(c={}),c[Vs]=i[Vs]),o.run(c,r)}initializeGlobalInstance(e){Go()===void 0&&nF(e)}}const sn=new mF,Sh=25;async function er(t){return Ot._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function Hw(...t){const e={};for(const r of t.filter(n=>!!n))for(const n of Object.keys(r))if(n==="metadata")e[n]={...e[n],...r[n]};else if(n==="tags"){const a=e[n]??[];e[n]=[...new Set(a.concat(r[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...r[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=r.timeout:r.timeout!==void 0&&(e.timeout=Math.min(e.timeout,r.timeout));else if(n==="signal")e.signal===void 0?e.signal=r.signal:r.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,r.signal]):e.signal=r.signal);else if(n==="callbacks"){const a=e.callbacks,o=r.callbacks;if(Array.isArray(o))if(!a)e.callbacks=o;else if(Array.isArray(a))e.callbacks=a.concat(o);else{const i=a.copy();for(const s of o)i.addHandler(Js(s),!0);e.callbacks=i}else if(o)if(!a)e.callbacks=o;else if(Array.isArray(a)){const i=o.copy();for(const s of a)i.addHandler(Js(s),!0);e.callbacks=i}else e.callbacks=new Ot(o._parentRunId,{handlers:a.handlers.concat(o.handlers),inheritableHandlers:a.inheritableHandlers.concat(o.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(o.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(o.inheritableTags))),metadata:{...a.metadata,...o.metadata}})}else{const a=n;e[a]=r[a]??e[a]}return e}const gF=new Set(["string","number","boolean"]);Ie=function(t){var n;const e=sn.getRunnableConfig();let r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:a,runName:o,...i}=e;r=Object.entries(i).reduce((s,[l,c])=>(c!==void 0&&(s[l]=c),s),r)}if(t&&(r=Object.entries(t).reduce((a,[o,i])=>(i!==void 0&&(a[o]=i),a),r)),r==null?void 0:r.configurable)for(const a of Object.keys(r.configurable))gF.has(typeof r.configurable[a])&&!((n=r.metadata)!=null&&n[a])&&(r.metadata||(r.metadata={}),r.metadata[a]=r.configurable[a]);if(r.timeout!==void 0){if(r.timeout<=0)throw new Error("Timeout must be a positive number");const a=AbortSignal.timeout(r.timeout);r.signal!==void 0?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,a])):r.signal=a,delete r.timeout}return r};function dt(t={},{callbacks:e,maxConcurrency:r,recursionLimit:n,runName:a,configurable:o,runId:i}={}){const s=Ie(t);return e!==void 0&&(delete s.runName,s.callbacks=e),n!==void 0&&(s.recursionLimit=n),r!==void 0&&(s.maxConcurrency=r),a!==void 0&&(s.runName=a),o!==void 0&&(s.configurable={...s.configurable,...o}),i!==void 0&&delete s.runId,s}function Oa(t){return t?{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal}:void 0}async function ln(t,e){if(e===void 0)return t;let r;return Promise.race([t.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,a)=>{r=()=>{a(new Error("Aborted"))},e.addEventListener("abort",r),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",r))}class Ft extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const r=this.reader.cancel();this.reader.releaseLock(),await r}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const r=e.getReader();return new Ft({start(n){return a();function a(){return r.read().then(({done:o,value:i})=>{if(o){n.close();return}return n.enqueue(i),a()})}},cancel(){r.releaseLock()}})}static fromAsyncGenerator(e){return new Ft({async pull(r){const{value:n,done:a}=await e.next();a&&r.close(),r.enqueue(n)},async cancel(r){await e.return(r)}})}}function Ww(t,e=2){const r=Array.from({length:e},()=>[]);return r.map(async function*(n){for(;;)if(n.length===0){const a=await t.next();for(const o of r)o.push(a)}else{if(n[0].done)return;yield n.shift().value}})}ur=function(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string"||typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const r={...t};for(const[n,a]of Object.entries(e))n in r&&!Array.isArray(r[n])?r[n]=ur(r[n],a):r[n]=a;return r}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)};class Na{constructor(e){var r;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((r=this.config)==null?void 0:r.signal),this.setup=new Promise((n,a)=>{sn.runWithConfig(Oa(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,a):this.firstResult.then(o=>n(void 0),a)},!0)})}async next(...e){var r;return(r=this.signal)==null||r.throwIfAborted(),this.firstResultUsed?sn.runWithConfig(Oa(this.config),this.signal?async()=>ln(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function yF(t,e,r,n,...a){const o=new Na({generator:e,startSetup:r,signal:n}),i=await o.setup;return{output:t(o,i,...a),setup:i}}class cn{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const r=this.ops.concat(e.ops),n=Hs({},r);return new Vo({ops:r,state:n[n.length-1].newDocument})}}class Vo extends cn{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const r=this.ops.concat(e.ops),n=Hs(this.state,e.ops);return new Vo({ops:r,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const r=Hs({},e.ops);return new Vo({ops:e.ops,state:r[r.length-1].newDocument})}}const _F=t=>t.name==="log_stream_tracer";async function Gw(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:r}=t;if(["retriever","llm","prompt"].includes(t.run_type))return r;if(!(Object.keys(r).length===1&&(r==null?void 0:r.input)===""))return r.input}async function qw(t,e){const{outputs:r}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?r:r!==void 0&&Object.keys(r).length===1&&(r==null?void 0:r.output)!==void 0?r.output:r}function vF(t){return t!==void 0&&t.message!==void 0}class Vw extends Ho{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ft.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||r.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&r.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,r){for await(const n of r){if(e!==this.rootId){const a=this.keyMapByRunId[e];a&&await this.writer.write(new cn({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new cn({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const r=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=r===1?e.name:`${e.name}:${r}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Gw(e,this._schemaFormat)),await this.writer.write(new cn({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const r=this.keyMapByRunId[e.id];if(r===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${r}/inputs`,value:await Gw(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${r}/final_output`,value:await qw(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${r}/end_time`,value:new Date(e.end_time).toISOString()});const a=new cn({ops:n});await this.writer.write(a)}finally{if(e.id===this.rootId){const r=new cn({ops:[{op:"replace",path:"/final_output",value:await qw(e,this._schemaFormat)}]});await this.writer.write(r),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,r,n){const a=this.keyMapByRunId[e.id];if(a===void 0)return;const o=e.inputs.messages!==void 0;let i;o?vF(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new co({id:`run-${e.id}`,content:r}):i=r;const s=new cn({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:r},{op:"add",path:`/logs/${a}/streamed_output/-`,value:i}]});await this.writer.write(s)}}A0="__run",lo=class{constructor(t){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=t.text,this.generationInfo=t.generationInfo}concat(t){return new lo({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo}})}},Yp=class extends lo{constructor(t){super(t),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=t.message}concat(t){return new Yp({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};function Ks({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const wF=t=>t.name==="event_stream_tracer";class bF extends Ho{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ft.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||r.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&r.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,r){const n=await r.next();if(n.done)return;const a=this.runInfoMap.get(e);if(a===void 0){yield n.value;return}function o(s,l){return s==="llm"&&typeof l=="string"?new lo({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let s;i=new Promise(l=>{s=l}),this.tappedPromises.set(e,i);try{const l={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...l,data:{chunk:o(a.runType,n.value)}},a),yield n.value;for await(const c of r)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...l,data:{chunk:o(a.runType,c)}},a),yield c}finally{s()}}else{yield n.value;for await(const s of r)yield s}}async send(e,r){this._includeRun(r)&&await this.writer.write(e)}async sendEndEvent(e,r){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,r)}):await this.send(e,r)}async onLLMStart(e){var i,s;const r=Ks(e),n=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,a);const o=`on_${n}_start`;await this.send({event:o,data:{input:e.inputs},name:r,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},a)}async onLLMNewToken(e,r,n){const a=this.runInfoMap.get(e.id);let o,i;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?o=new co({content:r,id:`run-${e.id}`}):o=n.chunk.message;else if(a.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?o=new lo({text:r}):o=n.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:i,data:{chunk:o},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var i,s,l;const r=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(r===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=(i=e.outputs)==null?void 0:i.generations;let o;if(r.runType==="chat_model"){for(const c of a??[]){if(o!==void 0)break;o=(s=c[0])==null?void 0:s.message}n="on_chat_model_end"}else if(r.runType==="llm")o={generations:a==null?void 0:a.map(c=>c.map(d=>({text:d.text,generationInfo:d.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${r.runType}`);await this.sendEndEvent({event:n,data:{output:o,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onChainStart(e){var i,s;const r=Ks(e),n=e.run_type??"chain",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:e.run_type};let o={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(o={},a.inputs={}):e.inputs.input!==void 0?(o.input=e.inputs.input,a.inputs=e.inputs.input):(o.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${n}_start`,data:o,name:r,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},a)}async onChainEnd(e){var i;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,a=e.inputs??r.inputs??{},o={output:((i=e.outputs)==null?void 0:i.output)??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(o.input=a.input,r.inputs=a.input),await this.sendEndEvent({event:n,data:o,run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata??{}},r)}async onToolStart(e){var a,o;const r=Ks(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:r,run_id:e.id,tags:e.tags??[],metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onToolEnd(e){var a;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(r.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onRetrieverStart(e){var a,o;const r=Ks(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,n),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:r,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onRetrieverEnd(e){var n;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async handleCustomEvent(e,r,n){const a=this.runInfoMap.get(n);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:a.tags,metadata:a.metadata,data:r},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const EF=[400,401,402,403,404,405,406,407,409],SF=t=>{var r,n;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((r=t==null?void 0:t.response)==null?void 0:r.status)??(t==null?void 0:t.status);if(e&&EF.includes(+e))throw t;if(((n=t==null?void 0:t.error)==null?void 0:n.code)==="insufficient_quota"){const a=new Error(t==null?void 0:t.message);throw a.name="InsufficientQuotaError",a}};Ai=class{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.onFailedAttempt=t.onFailedAttempt??SF;const e="default"in Pr?Pr.default:Pr;this.queue=new e({concurrency:this.maxConcurrency})}call(t,...e){return this.queue.add(()=>Fs(()=>t(...e).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){return t.signal?Promise.race([this.call(e,...r),new Promise((n,a)=>{var o;(o=t.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(e,...r)}fetch(...t){return this.call(()=>fetch(...t).then(e=>e.ok?e:Promise.reject(e)))}};class Zw extends Ho{constructor({config:e,onStart:r,onEnd:n,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=r,this.argOnEnd=n,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function xh(t){return t?t.lc_runnable:!1}class xF{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,r){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const a=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(r)),this.includeTags!==void 0&&(n=n||a.some(o=>{var i;return(i=this.includeTags)==null?void 0:i.includes(o)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(r)),this.excludeTags!==void 0&&(n=n&&a.every(o=>{var i;return!((i=this.excludeTags)!=null&&i.includes(o))})),n}}function kh(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}const kF=["*","_","`"];function AF(t){let e="";for(const[r,n]of Object.entries(t))e+=`	classDef ${r} ${n};
`;return e}function TF(t,e,r){const{firstNode:n,lastNode:a,nodeColors:o,withStyles:i=!0,curveStyle:s="linear",wrapLabelNWords:l=9}=r??{};let c=i?`%%{init: {'flowchart': {'curve': '${s}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const p="default",f={[p]:"{0}({1})"};n!==void 0&&(f[n]="{0}([{1}]):::first"),a!==void 0&&(f[a]="{0}([{1}]):::last");for(const[g,m]of Object.entries(t)){const _=m.name.split(":").pop()??"";let v=kF.some(F=>_.startsWith(F)&&_.endsWith(F))?`<p>${_}</p>`:_;Object.keys(m.metadata??{}).length&&(v+=`<hr/><small><em>${Object.entries(m.metadata??{}).map(([F,b])=>`${F} = ${b}`).join(`
`)}</em></small>`);const A=(f[g]??f[p]).replace("{0}",kh(g)).replace("{1}",v);c+=`	${A}
`}}const d={};for(const p of e){const f=p.source.split(":"),g=p.target.split(":"),m=f.filter((_,v)=>_===g[v]).join(":");d[m]||(d[m]=[]),d[m].push(p)}const u=new Set;function h(p,f){const g=p.length===1&&p[0].source===p[0].target;if(f&&!g){const m=f.split(":").pop();if(u.has(m))throw new Error(`Found duplicate subgraph '${m}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);u.add(m),c+=`	subgraph ${m}
`}for(const m of p){const{source:_,target:v,data:A,conditional:F}=m;let b="";if(A!==void 0){let D=A;const B=D.split(" ");B.length>l&&(D=Array.from({length:Math.ceil(B.length/l)},(j,G)=>B.slice(G*l,(G+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),b=F?` -. &nbsp;${D}&nbsp; .-> `:` -- &nbsp;${D}&nbsp; --> `}else b=F?" -.-> ":" --> ";c+=`	${kh(_)}${b}${kh(v)};
`}for(const m in d)m.startsWith(`${f}:`)&&m!==f&&h(d[m],m);f&&!g&&(c+=`	end
`)}h(d[""]??[],"");for(const p in d)!p.includes(":")&&p!==""&&h(d[p],p);return i&&(c+=AF(o??{})),c}async function MF(t,e){let{backgroundColor:r="white"}=e??{};const n=btoa(t);r!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));const a=`https://mermaid.ink/img/${n}?bgColor=${r}`,o=await fetch(a);if(!o.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${o.status}`,`Status text: ${o.statusText}`].join(`
`));return await o.blob()}function Ys(t,e,r){function n(s,l){var c;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(c=s._zod).traits??(c.traits=new Set),s._zod.traits.add(t),e(s,l);for(const d in i.prototype)d in s||Object.defineProperty(s,d,{value:i.prototype[d].bind(s)});s._zod.constr=i,s._zod.def=l}const a=(r==null?void 0:r.Parent)??Object;class o extends a{}Object.defineProperty(o,"name",{value:t});function i(s){var l;const c=r!=null&&r.Parent?new o:this;n(c,s),(l=c._zod).deferred??(l.deferred=[]);for(const d of c._zod.deferred)d();return c}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:s=>{var l,c;return r!=null&&r.Parent&&s instanceof r.Parent?!0:(c=(l=s==null?void 0:s._zod)==null?void 0:l.traits)==null?void 0:c.has(t)}}),Object.defineProperty(i,"name",{value:t}),i}class Xs extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const FF={};function Qs(t){return FF}function RF(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,n])=>e.indexOf(+r)===-1).map(([r,n])=>n)}function OF(t,e){return typeof e=="bigint"?e.toString():e}function NF(t,e,r){Object.defineProperty(t,e,{get(){{const n=r();return t[e]=n,n}},set(n){Object.defineProperty(t,e,{value:n})},configurable:!0})}function IF(t=10){const e="abcdefghijklmnopqrstuvwxyz";let r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}const Jw=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function el(t,e,r){const n=new t._zod.constr(e??t._zod.def);return(!e||r!=null&&r.parent)&&(n._zod.parent=t),n}function PF(t){return{}}function Ah(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r].continue!==!0)return!0;return!1}function tl(t){return typeof t=="string"?t:t==null?void 0:t.message}function rl(t,e,r){var a,o,i,s,l,c;const n={...t,path:t.path??[]};if(!t.message){const d=tl((i=(o=(a=t.inst)==null?void 0:a._zod.def)==null?void 0:o.error)==null?void 0:i.call(o,t))??tl((s=e==null?void 0:e.error)==null?void 0:s.call(e,t))??tl((l=r.customError)==null?void 0:l.call(r,t))??tl((c=r.localeError)==null?void 0:c.call(r,t))??"Invalid input";n.message=d}return delete n.inst,delete n.continue,e!=null&&e.reportInput||delete n.input,n}const Kw=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,OF,2)},enumerable:!0})},CF=Ys("$ZodError",Kw),nl=Ys("$ZodError",Kw,{Parent:Error}),jF=t=>(e,r,n,a)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new Xs;if(i.issues.length){const s=new((a==null?void 0:a.Err)??t)(i.issues.map(l=>rl(l,o,Qs())));throw Jw(s,a==null?void 0:a.callee),s}return i.value},LF=jF(nl),DF=t=>async(e,r,n,a)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise&&(i=await i),i.issues.length){const s=new((a==null?void 0:a.Err)??t)(i.issues.map(l=>rl(l,o,Qs())));throw Jw(s,a==null?void 0:a.callee),s}return i.value},$F=DF(nl),zF=t=>(e,r,n)=>{const a=n?{...n,async:!1}:{async:!1},o=e._zod.run({value:r,issues:[]},a);if(o instanceof Promise)throw new Xs;return o.issues.length?{success:!1,error:new(t??CF)(o.issues.map(i=>rl(i,a,Qs())))}:{success:!0,data:o.value}},UF=zF(nl),BF=t=>async(e,r,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let o=e._zod.run({value:r,issues:[]},a);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new t(o.issues.map(i=>rl(i,a,Qs())))}:{success:!0,data:o.value}},HF=BF(nl),WF={major:4,minor:0,patch:0},GF=Ys("$ZodType",(t,e)=>{var a;var r;t??(t={}),NF(t._zod,"id",()=>e.type+"_"+IF(10)),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=WF;const n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(const o of n)for(const i of o._zod.onattach)i(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),(a=t._zod.deferred)==null||a.push(()=>{t._zod.run=t._zod.parse});else{const o=(i,s,l)=>{let c=Ah(i),d;for(const u of s){if(u._zod.when){if(!u._zod.when(i))continue}else if(c)continue;const h=i.issues.length,p=u._zod.check(i);if(p instanceof Promise&&(l==null?void 0:l.async)===!1)throw new Xs;if(d||p instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await p,i.issues.length!==h&&(c||(c=Ah(i,h)))});else{if(i.issues.length===h)continue;c||(c=Ah(i,h))}}return d?d.then(()=>i):i};t._zod.run=(i,s)=>{const l=t._zod.parse(i,s);if(l instanceof Promise){if(s.async===!1)throw new Xs;return l.then(c=>o(c,n,s))}return o(l,n,s)}}t["~standard"]={validate:o=>{var i;try{const s=UF(t,o);return s.success?{value:s.data}:{issues:(i=s.error)==null?void 0:i.issues}}catch{return HF(t,o).then(s=>{var l;return s.success?{value:s.data}:{issues:(l=s.error)==null?void 0:l.issues}})}},vendor:"zod",version:1}}),qF=Ys("$ZodNever",(t,e)=>{GF.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});class Yw{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...r){const n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){const r=e._zod.parent;if(r){const n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function VF(){return new Yw}const dn=VF();function ZF(t,e){return new t({type:"never",...PF()})}class Xw{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??dn,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var d,u,h;var n;const a=e._zod.def,o={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;const s={schema:{},count:1,cycle:void 0};this.seen.set(e,s);const l=(u=(d=e._zod).toJSONSchema)==null?void 0:u.call(d);if(l)s.schema=l;else{const p={...r,schemaPath:[...r.schemaPath,e],path:r.path},f=e._zod.parent;if(f)s.ref=f,this.process(f,p),this.seen.get(f).isParent=!0;else{const g=s.schema;switch(a.type){case"string":{const m=g;m.type="string";const{minimum:_,maximum:v,format:A,patterns:F,contentEncoding:b}=e._zod.bag;if(typeof _=="number"&&(m.minLength=_),typeof v=="number"&&(m.maxLength=v),A&&(m.format=o[A]??A,m.format===""&&delete m.format),b&&(m.contentEncoding=b),F&&F.size>0){const D=[...F];D.length===1?m.pattern=D[0].source:D.length>1&&(s.schema.allOf=[...D.map(B=>({...this.target==="draft-7"?{type:"string"}:{},pattern:B.source}))])}break}case"number":{const m=g,{minimum:_,maximum:v,format:A,multipleOf:F,exclusiveMaximum:b,exclusiveMinimum:D}=e._zod.bag;typeof A=="string"&&A.includes("int")?m.type="integer":m.type="number",typeof D=="number"&&(m.exclusiveMinimum=D),typeof _=="number"&&(m.minimum=_,typeof D=="number"&&(D>=_?delete m.minimum:delete m.exclusiveMinimum)),typeof b=="number"&&(m.exclusiveMaximum=b),typeof v=="number"&&(m.maximum=v,typeof b=="number"&&(b<=v?delete m.maximum:delete m.exclusiveMaximum)),typeof F=="number"&&(m.multipleOf=F);break}case"boolean":{const m=g;m.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"undefined":{const m=g;m.type="null";break}case"null":{g.type="null";break}case"any":break;case"unknown":break;case"never":{g.not={};break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const m=g,{minimum:_,maximum:v}=e._zod.bag;typeof _=="number"&&(m.minItems=_),typeof v=="number"&&(m.maxItems=v),m.type="array",m.items=this.process(a.element,{...p,path:[...p.path,"items"]});break}case"object":{const m=g;m.type="object",m.properties={};const _=a.shape;for(const F in _)m.properties[F]=this.process(_[F],{...p,path:[...p.path,"properties",F]});const v=new Set(Object.keys(_)),A=new Set([...v].filter(F=>{const b=a.shape[F]._zod;return this.io==="input"?b.optin===void 0:b.optout===void 0}));A.size>0&&(m.required=Array.from(A)),((h=a.catchall)==null?void 0:h._zod.def.type)==="never"?m.additionalProperties=!1:a.catchall?a.catchall&&(m.additionalProperties=this.process(a.catchall,{...p,path:[...p.path,"additionalProperties"]})):this.io==="output"&&(m.additionalProperties=!1);break}case"union":{const m=g;m.anyOf=a.options.map((_,v)=>this.process(_,{...p,path:[...p.path,"anyOf",v]}));break}case"intersection":{const m=g,_=this.process(a.left,{...p,path:[...p.path,"allOf",0]}),v=this.process(a.right,{...p,path:[...p.path,"allOf",1]}),A=b=>"allOf"in b&&Object.keys(b).length===1,F=[...A(_)?_.allOf:[_],...A(v)?v.allOf:[v]];m.allOf=F;break}case"tuple":{const m=g;m.type="array";const _=a.items.map((F,b)=>this.process(F,{...p,path:[...p.path,"prefixItems",b]}));if(this.target==="draft-2020-12"?m.prefixItems=_:m.items=_,a.rest){const F=this.process(a.rest,{...p,path:[...p.path,"items"]});this.target==="draft-2020-12"?m.items=F:m.additionalItems=F}a.rest&&(m.items=this.process(a.rest,{...p,path:[...p.path,"items"]}));const{minimum:v,maximum:A}=e._zod.bag;typeof v=="number"&&(m.minItems=v),typeof A=="number"&&(m.maxItems=A);break}case"record":{const m=g;m.type="object",m.propertyNames=this.process(a.keyType,{...p,path:[...p.path,"propertyNames"]}),m.additionalProperties=this.process(a.valueType,{...p,path:[...p.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const m=g,_=RF(a.entries);_.every(v=>typeof v=="number")&&(m.type="number"),_.every(v=>typeof v=="string")&&(m.type="string"),m.enum=_;break}case"literal":{const m=g,_=[];for(const v of a.values)if(v===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof v=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");_.push(Number(v))}else _.push(v);if(_.length!==0)if(_.length===1){const v=_[0];m.type=v===null?"null":typeof v,m.const=v}else _.every(v=>typeof v=="number")&&(m.type="number"),_.every(v=>typeof v=="string")&&(m.type="string"),_.every(v=>typeof v=="boolean")&&(m.type="string"),_.every(v=>v===null)&&(m.type="null"),m.enum=_;break}case"file":{const m=g,_={type:"string",format:"binary",contentEncoding:"binary"},{minimum:v,maximum:A,mime:F}=e._zod.bag;v!==void 0&&(_.minLength=v),A!==void 0&&(_.maxLength=A),F?F.length===1?(_.contentMediaType=F[0],Object.assign(m,_)):m.anyOf=F.map(b=>({..._,contentMediaType:b})):Object.assign(m,_);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const m=this.process(a.innerType,p);g.anyOf=[m,{type:"null"}];break}case"nonoptional":{this.process(a.innerType,p),s.ref=a.innerType;break}case"success":{const m=g;m.type="boolean";break}case"default":{this.process(a.innerType,p),s.ref=a.innerType,g.default=JSON.parse(JSON.stringify(a.defaultValue));break}case"prefault":{this.process(a.innerType,p),s.ref=a.innerType,this.io==="input"&&(g._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break}case"catch":{this.process(a.innerType,p),s.ref=a.innerType;let m;try{m=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}g.default=m;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const m=g,_=e._zod.pattern;if(!_)throw new Error("Pattern not found in template literal");m.type="string",m.pattern=_.source;break}case"pipe":{const m=this.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;this.process(m,p),s.ref=m;break}case"readonly":{this.process(a.innerType,p),s.ref=a.innerType,g.readOnly=!0;break}case"promise":{this.process(a.innerType,p),s.ref=a.innerType;break}case"optional":{this.process(a.innerType,p),s.ref=a.innerType;break}case"lazy":{const m=e._zod.innerType;this.process(m,p),s.ref=m;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(s.schema,c),this.io==="input"&&at(e)&&(delete s.schema.examples,delete s.schema.default),this.io==="input"&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,this.seen.get(e).schema}emit(e,r){var d,u,h,p;const n={cycles:(r==null?void 0:r.cycles)??"ref",reused:(r==null?void 0:r.reused)??"inline",external:(r==null?void 0:r.external)??void 0},a=this.seen.get(e);if(!a)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=f=>{var v;const g=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const A=(v=n.external.registry.get(f[0]))==null?void 0:v.id;if(A)return{ref:n.external.uri(A)};const F=f[1].defId??f[1].schema.id??`schema${this.counter++}`;return f[1].defId=F,{defId:F,ref:`${n.external.uri("__shared")}#/${g}/${F}`}}if(f[1]===a)return{ref:"#"};const m=`#/${g}/`,_=f[1].schema.id??`__schema${this.counter++}`;return{defId:_,ref:m+_}},i=f=>{if(f[1].schema.$ref)return;const g=f[1],{ref:m,defId:_}=o(f);g.def={...g.schema},_&&(g.defId=_);const v=g.schema;for(const A in v)delete v[A];v.$ref=m};for(const f of this.seen.entries()){const g=f[1];if(e===f[0]){i(f);continue}if(n.external){const m=(d=n.external.registry.get(f[0]))==null?void 0:d.id;if(e!==f[0]&&m){i(f);continue}}if((u=this.metadataRegistry.get(f[0]))!=null&&u.id){i(f);continue}if(g.cycle){if(n.cycles==="throw")throw new Error(`Cycle detected: #/${(h=g.cycle)==null?void 0:h.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);n.cycles==="ref"&&i(f);continue}if(g.count>1&&n.reused==="ref"){i(f);continue}}const s=(f,g)=>{const m=this.seen.get(f),_=m.def??m.schema,v={..._};if(m.ref===null)return;const A=m.ref;if(m.ref=null,A){s(A,g);const F=this.seen.get(A).schema;F.$ref&&g.target==="draft-7"?(_.allOf=_.allOf??[],_.allOf.push(F)):(Object.assign(_,F),Object.assign(_,v))}m.isParent||this.override({zodSchema:f,jsonSchema:_})};for(const f of[...this.seen.entries()].reverse())s(f[0],{target:this.target});const l={};this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(l,a.def);const c=((p=n.external)==null?void 0:p.defs)??{};for(const f of this.seen.entries()){const g=f[1];g.def&&g.defId&&(c[g.defId]=g.def)}!n.external&&Object.keys(c).length>0&&(this.target==="draft-2020-12"?l.$defs=c:l.definitions=c);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function Qw(t,e){if(t instanceof Yw){const n=new Xw(e),a={};for(const s of t._idmap.entries()){const[l,c]=s;n.process(c)}const o={},i={registry:t,uri:s=>s,defs:a};for(const s of t._idmap.entries()){const[l,c]=s;o[l]=n.emit(c,{...e,external:i})}if(Object.keys(a).length>0){const s=n.target==="draft-2020-12"?"$defs":"definitions";o.__shared={[s]:a}}return{schemas:o}}const r=new Xw(e);return r.process(t),r.emit(t,e)}function at(t,e){const r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);const n=t._zod.def;switch(n.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return at(n.element,r);case"object":{for(const a in n.shape)if(at(n.shape[a],r))return!0;return!1}case"union":{for(const a of n.options)if(at(a,r))return!0;return!1}case"intersection":return at(n.left,r)||at(n.right,r);case"tuple":{for(const a of n.items)if(at(a,r))return!0;return!!(n.rest&&at(n.rest,r))}case"record":return at(n.keyType,r)||at(n.valueType,r);case"map":return at(n.keyType,r)||at(n.valueType,r);case"set":return at(n.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return at(n.innerType,r);case"lazy":return at(n.getter(),r);case"default":return at(n.innerType,r);case"prefault":return at(n.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return at(n.in,r)||at(n.out,r);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${n.type}`)}const JF=Symbol("Let zodToJsonSchema decide on which parser to use"),KF={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},YF=t=>({...KF,...t}),XF=t=>{const e=YF(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function eb(t,e,r,n){n!=null&&n.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function je(t,e,r,n,a){t[e]=r,eb(t,e,n,a)}function QF(){return{}}function eR(t,e){var n,a;const r={type:"array"};return((a=(n=t.type)==null?void 0:n._def)==null?void 0:a.typeName)!==Q.ZodAny&&(r.items=Pe(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&je(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&je(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(je(r,"minItems",t.exactLength.value,t.exactLength.message,e),je(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function tR(t,e){const r={type:"integer",format:"int64"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?je(r,"minimum",n.value,n.message,e):je(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),je(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?je(r,"maximum",n.value,n.message,e):je(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),je(r,"maximum",n.value,n.message,e));break;case"multipleOf":je(r,"multipleOf",n.value,n.message,e);break}return r}function rR(){return{type:"boolean"}}function nR(t,e){return Pe(t.type._def,e)}const aR=(t,e)=>Pe(t.innerType._def,e);function tb(t,e,r){const n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>tb(t,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return oR(t,e)}}const oR=(t,e)=>{const r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(const n of t.checks)switch(n.kind){case"min":je(r,"minimum",n.value,n.message,e);break;case"max":je(r,"maximum",n.value,n.message,e);break}return r};function iR(t,e){return{...Pe(t.innerType._def,e),default:t.defaultValue()}}function sR(t,e){return e.effectStrategy==="input"?Pe(t.schema._def,e):{}}function lR(t){return{type:"string",enum:t.values}}const cR=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function dR(t,e){const r=[Pe(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Pe(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return r.forEach(o=>{if(cR(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:s,...l}=o;i=l}else n=void 0;a.push(i)}}),a.length?{allOf:a,...n}:void 0}function uR(t,e){const r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}let Th;const jn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Th===void 0&&(Th=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Th),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function rb(t,e){const r={type:"string"};function n(a){return e.patternStrategy==="escape"?hR(a):a}if(t.checks)for(const a of t.checks)switch(a.kind){case"min":je(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e);break;case"max":je(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":tr(r,"email",a.message,e);break;case"format:idn-email":tr(r,"idn-email",a.message,e);break;case"pattern:zod":rr(r,jn.email,a.message,e);break}break;case"url":tr(r,"uri",a.message,e);break;case"uuid":tr(r,"uuid",a.message,e);break;case"regex":rr(r,a.regex,a.message,e);break;case"cuid":rr(r,jn.cuid,a.message,e);break;case"cuid2":rr(r,jn.cuid2,a.message,e);break;case"startsWith":rr(r,RegExp(`^${n(a.value)}`),a.message,e);break;case"endsWith":rr(r,RegExp(`${n(a.value)}$`),a.message,e);break;case"datetime":tr(r,"date-time",a.message,e);break;case"date":tr(r,"date",a.message,e);break;case"time":tr(r,"time",a.message,e);break;case"duration":tr(r,"duration",a.message,e);break;case"length":je(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e),je(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"includes":{rr(r,RegExp(n(a.value)),a.message,e);break}case"ip":{a.version!=="v6"&&tr(r,"ipv4",a.message,e),a.version!=="v4"&&tr(r,"ipv6",a.message,e);break}case"emoji":rr(r,jn.emoji,a.message,e);break;case"ulid":{rr(r,jn.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{tr(r,"binary",a.message,e);break}case"contentEncoding:base64":{je(r,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{rr(r,jn.base64,a.message,e);break}}break}case"nanoid":rr(r,jn.nanoid,a.message,e)}return r}const hR=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),tr=(t,e,r,n)=>{var a;t.format||(a=t.anyOf)!=null&&a.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):je(t,"format",e,r,n)},rr=(t,e,r,n)=>{var a;t.pattern||(a=t.allOf)!=null&&a.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:nb(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):je(t,"pattern",nb(e,n),r,n)},nb=(t,e)=>{var c;const r=typeof t=="function"?t():t;if(!e.applyRegexFlags||!r.flags)return r.source;const n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},a=n.i?r.source.toLowerCase():r.source;let o="",i=!1,s=!1,l=!1;for(let d=0;d<a.length;d++){if(i){o+=a[d],i=!1;continue}if(n.i){if(s){if(a[d].match(/[a-z]/)){l?(o+=a[d],o+=`${a[d-2]}-${a[d]}`.toUpperCase(),l=!1):a[d+1]==="-"&&((c=a[d+2])!=null&&c.match(/[a-z]/))?(o+=a[d],l=!0):o+=`${a[d]}${a[d].toUpperCase()}`;continue}}else if(a[d].match(/[a-z]/)){o+=`[${a[d]}${a[d].toUpperCase()}]`;continue}}if(n.m){if(a[d]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[d]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[d]==="."){o+=s?`${a[d]}\r
`:`[${a[d]}\r
]`;continue}o+=a[d],a[d]==="\\"?i=!0:s&&a[d]==="]"?s=!1:!s&&a[d]==="["&&(s=!0)}try{const d=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return o};function ab(t,e){var n,a,o,i;if(e.target==="openApi3"&&((n=t.keyType)==null?void 0:n._def.typeName)===Q.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((s,l)=>({...s,[l]:Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const r={type:"object",additionalProperties:Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return r;if(((a=t.keyType)==null?void 0:a._def.typeName)===Q.ZodString&&((o=t.keyType._def.checks)!=null&&o.length)){const s=Object.entries(rb(t.keyType._def,e)).reduce((l,[c,d])=>c==="type"?l:{...l,[c]:d},{});return{...r,propertyNames:s}}else if(((i=t.keyType)==null?void 0:i._def.typeName)===Q.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};return r}function pR(t,e){if(e.mapStrategy==="record")return ab(t,e);const r=Pe(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function fR(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),n=Array.from(new Set(r.map(a=>typeof a)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:r}}function mR(){return{not:{}}}function gR(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const al={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function yR(t,e){if(e.target==="openApi3")return ob(t,e);const r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in al&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const i=al[o._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,i,s)=>s.indexOf(o)===i);return{type:a.length>1?a:a[0],enum:r.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return ob(t,e)}const ob=(t,e)=>{const r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,a)=>Pe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function _R(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:al[t.innerType._def.typeName],nullable:!0}:{type:[al[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Pe(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=Pe(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function vR(t,e){const r={type:"number"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"int":r.type="integer",eb(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?je(r,"minimum",n.value,n.message,e):je(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),je(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?je(r,"maximum",n.value,n.message,e):je(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),je(r,"maximum",n.value,n.message,e));break;case"multipleOf":je(r,"multipleOf",n.value,n.message,e);break}return r}function wR(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":Pe(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":Pe(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function bR(t,e){const r={type:"object",...Object.entries(t.shape()).reduce((n,[a,o])=>{if(o===void 0||o._def===void 0)return n;const i=Pe(o._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return i===void 0?n:{properties:{...n.properties,[a]:i},required:o.isOptional()?n.required:[...n.required,a]}},{properties:{},required:[]}),additionalProperties:wR(t,e)};return r.required.length||delete r.required,r}const ER=(t,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Pe(t.innerType._def,e);const r=Pe(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},SR=(t,e)=>{if(e.pipeStrategy==="input")return Pe(t.in._def,e);if(e.pipeStrategy==="output")return Pe(t.out._def,e);const r=Pe(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Pe(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function xR(t,e){return Pe(t.type._def,e)}function kR(t,e){const r={type:"array",uniqueItems:!0,items:Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&je(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&je(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function AR(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>Pe(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:Pe(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>Pe(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function TR(){return{not:{}}}function MR(){return{}}const FR=(t,e)=>Pe(t.innerType._def,e);function Pe(t,e,r=!1){var i;const n=e.seen.get(t);if(e.override){const s=(i=e.override)==null?void 0:i.call(e,t,e,n,r);if(s!==JF)return s}if(n&&!r){const s=RR(n,e);if(s!==void 0)return s}const a={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,a);const o=NR(t,t.typeName,e);return o&&IR(t,e,o),a.jsonSchema=o,o}const RR=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:OR(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},OR=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")},NR=(t,e,r)=>{switch(e){case Q.ZodString:return rb(t,r);case Q.ZodNumber:return vR(t,r);case Q.ZodObject:return bR(t,r);case Q.ZodBigInt:return tR(t,r);case Q.ZodBoolean:return rR();case Q.ZodDate:return tb(t,r);case Q.ZodUndefined:return TR();case Q.ZodNull:return gR(r);case Q.ZodArray:return eR(t,r);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return yR(t,r);case Q.ZodIntersection:return dR(t,r);case Q.ZodTuple:return AR(t,r);case Q.ZodRecord:return ab(t,r);case Q.ZodLiteral:return uR(t,r);case Q.ZodEnum:return lR(t);case Q.ZodNativeEnum:return fR(t);case Q.ZodNullable:return _R(t,r);case Q.ZodOptional:return ER(t,r);case Q.ZodMap:return pR(t,r);case Q.ZodSet:return kR(t,r);case Q.ZodLazy:return Pe(t.getter()._def,r);case Q.ZodPromise:return xR(t,r);case Q.ZodNaN:case Q.ZodNever:return mR();case Q.ZodEffects:return sR(t,r);case Q.ZodAny:return QF();case Q.ZodUnknown:return MR();case Q.ZodDefault:return iR(t,r);case Q.ZodBranded:return nR(t,r);case Q.ZodReadonly:return FR(t,r);case Q.ZodCatch:return aR(t,r);case Q.ZodPipeline:return SR(t,r);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(n=>{})()}},IR=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r),PR=(t,e)=>{const r=XF(e),n=void 0,a=e==null?void 0:e.name,o=Pe(t._def,r,!1)??{},i=a===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...n,[a]:o}};return r.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i};Wt=function(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_zod"in e))return!1;const r=e._zod;return typeof r=="object"&&r!==null&&"def"in r},cr=function(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_def"in e)||"_zod"in e)return!1;const r=e._def;return typeof r=="object"&&r!=null&&"typeName"in r},bp=function(t){return!t||typeof t!="object"||Array.isArray(t)?!1:!!(Wt(t)||cr(t))},P0=async function(t,e){if(Wt(t))try{return{success:!0,data:await $F(t,e)}}catch(r){return{success:!1,error:r}}if(cr(t))return t.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")},Ep=async function(t,e){if(Wt(t))return LF(t,e);if(cr(t))return t.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")},Jp=function(t){var e;if(Wt(t))return(e=dn.get(t))==null?void 0:e.description;if(cr(t)||"description"in t&&typeof t.description=="string")return t.description};function CR(t){return bp(t)?cr(t)?t._def.typeName==="ZodString":Wt(t)?t._zod.def.type==="string":!1:!1}function Zo(t){return Wt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="object":!1}function ib(t){return Wt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="array":!1}function Mh(t,e=!1){if(cr(t))return t.strict();if(Zo(t)){const r=t._zod.def.shape;if(e)for(const[o,i]of Object.entries(t._zod.def.shape)){if(Zo(i)){const l=Mh(i,e);r[o]=l}else if(ib(i)){let l=i._zod.def.element;Zo(l)&&(l=Mh(l,e)),r[o]=el(i,{...i._zod.def,element:l})}else r[o]=i;const s=dn.get(i);s&&dn.add(r[o],s)}const n=el(t,{...t._zod.def,shape:r,catchall:ZF(qF)}),a=dn.get(t);return a&&dn.add(n,a),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function jR(t){return cr(t)&&"typeName"in t._def&&t._def.typeName==="ZodEffects"}function LR(t){return Wt(t)&&t._zod.def.type==="pipe"}function Jo(t,e=!1){if(cr(t))return jR(t)?Jo(t._def.schema,e):t;if(Wt(t)){let r=t;if(LR(t)&&(r=Jo(t._zod.def.in,e)),e){if(Zo(r)){const a=r._zod.def.shape;for(const[o,i]of Object.entries(r._zod.def.shape))a[o]=Jo(i,e);r=el(r,{...r._zod.def,shape:a})}else if(ib(r)){const a=Jo(r._zod.def.element,e);r=el(r,{...r._zod.def,element:a})}}const n=dn.get(t);return n&&dn.add(r,n),r}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}Kp=function(t){if(Wt(t)){const e=Jo(t,!0);if(Zo(e)){const r=Mh(e,!0);return Qw(r)}else return Qw(t)}return cr(t)?PR(t):t};function DR(t,e){if(t!==void 0&&!Sa(t))return t;if(xh(e))try{let r=e.getName();return r=r.startsWith("Runnable")?r.slice(8):r,r}catch{return e.getName()}else return e.name??"UnknownSchema"}function $R(t){return xh(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...Kp(t.data.schema),title:t.data.name}}}class ol{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((r,n)=>{e[r.id]=Sa(r.id)?n:r.id}),{nodes:Object.values(this.nodes).map(r=>({id:e[r.id],...$R(r)})),edges:this.edges.map(r=>{const n={source:e[r.source],target:e[r.target]};return typeof r.data<"u"&&(n.data=r.data),typeof r.conditional<"u"&&(n.conditional=r.conditional),n})}}addNode(e,r,n){if(r!==void 0&&this.nodes[r]!==void 0)throw new Error(`Node with id ${r} already exists`);const a=r??ht(),o={id:a,data:e,name:DR(r,e),metadata:n};return this.nodes[a]=o,o}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(r=>r.source!==e.id&&r.target!==e.id)}addEdge(e,r,n,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[r.id]===void 0)throw new Error(`Target node ${r.id} not in graph`);const o={source:e.id,target:r.id,data:n,conditional:a};return this.edges.push(o),o}firstNode(){return sb(this)}lastNode(){return lb(this)}extend(e,r=""){let n=r;Object.values(e.nodes).map(l=>l.id).every(Sa)&&(n="");const a=l=>n?`${n}:${l}`:l;Object.entries(e.nodes).forEach(([l,c])=>{this.nodes[a(l)]={...c,id:a(l)}});const o=e.edges.map(l=>({...l,source:a(l.source),target:a(l.target)}));this.edges=[...this.edges,...o];const i=e.firstNode(),s=e.lastNode();return[i?{id:a(i.id),data:i.data}:void 0,s?{id:a(s.id),data:s.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&sb(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&lb(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),r=new Map;Object.values(e).forEach(a=>{r.set(a,(r.get(a)||0)+1)});const n=a=>{const o=e[a];return Sa(a)&&r.get(o)===1?o:a};return new ol({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,o])=>[n(a),{...o,id:n(a)}])),edges:this.edges.map(a=>({...a,source:n(a.source),target:n(a.target)}))})}drawMermaid(e){const{withStyles:r,curveStyle:n,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:o}=e??{},i=this.reid(),s=i.firstNode(),l=i.lastNode();return TF(i.nodes,i.edges,{firstNode:s==null?void 0:s.id,lastNode:l==null?void 0:l.id,withStyles:r,curveStyle:n,nodeColors:a,wrapLabelNWords:o})}async drawMermaidPng(e){const r=this.drawMermaid(e);return MF(r,{backgroundColor:e==null?void 0:e.backgroundColor})}}function sb(t,e=[]){const r=new Set(t.edges.filter(a=>!e.includes(a.source)).map(a=>a.target)),n=[];for(const a of Object.values(t.nodes))!e.includes(a.id)&&!r.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function lb(t,e=[]){const r=new Set(t.edges.filter(a=>!e.includes(a.target)).map(a=>a.source)),n=[];for(const a of Object.values(t.nodes))!e.includes(a.id)&&!r.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function zR(t){const e=new TextEncoder,r=new ReadableStream({async start(n){for await(const a of t)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Ft.fromReadableStream(r)}function cb(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const UR=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function Fh(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*db(t,e){for(;;){const{value:r,done:n}=sn.runWithConfig(Oa(t),e.next.bind(e),!0);if(n)break;yield r}}async function*Rh(t,e){const r=e[Symbol.asyncIterator]();for(;;){const{value:n,done:a}=await sn.runWithConfig(Oa(t),r.next.bind(e),!0);if(a)break;yield n}}function ot(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}st=class extends bn{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(t){const e=this.name??this.constructor.lc_name()??this.constructor.name;return t?`${e}${t}`:e}bind(t){return new Ln({bound:this,kwargs:t,config:{}})}map(){return new il({bound:this})}withRetry(t){return new ub({bound:this,kwargs:{},config:{},maxAttemptNumber:t==null?void 0:t.stopAfterAttempt,...t})}withConfig(t){return new Ln({bound:this,config:t,kwargs:{}})}withFallbacks(t){const e=Array.isArray(t)?t:t.fallbacks;return new HR({runnable:this,fallbacks:e})}_getOptionsList(t,e=0){if(Array.isArray(t)&&t.length!==e)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${t.length} options for ${e} inputs`);if(Array.isArray(t))return t.map(Ie);if(e>1&&!Array.isArray(t)&&t.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(t).filter(([n])=>n!=="runId"));return Array.from({length:e},(n,a)=>Ie(a===0?t:r))}return Array.from({length:e},()=>Ie(t))}async batch(t,e,r){var s;const n=this._getOptionsList(e??{},t.length),a=((s=n[0])==null?void 0:s.maxConcurrency)??(r==null?void 0:r.maxConcurrency),o=new Ai({maxConcurrency:a,onFailedAttempt:l=>{throw l}}),i=t.map((l,c)=>o.call(async()=>{try{return await this.invoke(l,n[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(i)}async*_streamIterator(t,e){yield this.invoke(t,e)}async stream(t,e){const r=Ie(e),n=new Na({generator:this._streamIterator(t,r),config:r});return await n.setup,Ft.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(t){let e;t===void 0?e=Ie(t):e=Ie({callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,runName:t.runName,configurable:t.configurable,recursionLimit:t.recursionLimit,maxConcurrency:t.maxConcurrency,runId:t.runId,timeout:t.timeout,signal:t.signal});const r={...t};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[e,r]}async _callWithConfig(t,e,r){var i;const n=Ie(r),a=await((i=await er(n))==null?void 0:i.handleChainStart(this.toJSON(),ot(e,"input"),n.runId,n==null?void 0:n.runType,void 0,void 0,(n==null?void 0:n.runName)??this.getName()));delete n.runId;let o;try{const s=t.call(this,e,n,a);o=await ln(s,r==null?void 0:r.signal)}catch(s){throw await(a==null?void 0:a.handleChainError(s)),s}return await(a==null?void 0:a.handleChainEnd(ot(o,"output"))),o}async _batchWithConfig(t,e,r,n){var l;const a=this._getOptionsList(r??{},e.length),o=await Promise.all(a.map(er)),i=await Promise.all(o.map(async(c,d)=>{const u=await(c==null?void 0:c.handleChainStart(this.toJSON(),ot(e[d],"input"),a[d].runId,a[d].runType,void 0,void 0,a[d].runName??this.getName()));return delete a[d].runId,u}));let s;try{const c=t.call(this,e,a,i,n);s=await ln(c,(l=a==null?void 0:a[0])==null?void 0:l.signal)}catch(c){throw await Promise.all(i.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(i.map(c=>c==null?void 0:c.handleChainEnd(ot(s,"output")))),s}async*_transformStreamWithConfig(t,e,r){let n,a=!0,o,i=!0;const s=Ie(r),l=await er(s);async function*c(){for await(const u of t){if(a)if(n===void 0)n=u;else try{n=ur(n,u)}catch{n=void 0,a=!1}yield u}}let d;try{const u=await yF(e.bind(this),c(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},s.runId,s.runType,void 0,void 0,s.runName??this.getName()),r==null?void 0:r.signal,s);delete s.runId,d=u.setup;const h=d==null?void 0:d.handlers.find(wF);let p=u.output;h!==void 0&&d!==void 0&&(p=h.tapOutputIterable(d.runId,p));const f=d==null?void 0:d.handlers.find(_F);f!==void 0&&d!==void 0&&(p=f.tapOutputIterable(d.runId,p));for await(const g of p)if(yield g,i)if(o===void 0)o=g;else try{o=ur(o,g)}catch{o=void 0,i=!1}}catch(u){throw await(d==null?void 0:d.handleChainError(u,void 0,void 0,void 0,{inputs:ot(n,"input")})),u}await(d==null?void 0:d.handleChainEnd(o??{},void 0,void 0,void 0,{inputs:ot(n,"input")}))}getGraph(t){const e=new ol,r=e.addNode({name:`${this.getName()}Input`,schema:Xd()}),n=e.addNode(this),a=e.addNode({name:`${this.getName()}Output`,schema:Xd()});return e.addEdge(r,n),e.addEdge(n,a),e}pipe(t){return new vn({first:this,last:Dn(t)})}pick(t){return this.pipe(new WR(t))}assign(t){return this.pipe(new pf(new ho({steps:t})))}async*transform(t,e){let r;for await(const n of t)r===void 0?r=n:r=ur(r,n);yield*this._streamIterator(r,Ie(e))}async*streamLog(t,e,r){const n=new Vw({...r,autoClose:!1,_schemaFormat:"original"}),a=Ie(e);yield*this._streamLog(t,n,a)}async*_streamLog(t,e,r){const{callbacks:n}=r;if(n===void 0)r.callbacks=[e];else if(Array.isArray(n))r.callbacks=n.concat([e]);else{const s=n.copy();s.addHandler(e,!0),r.callbacks=s}const a=this.stream(t,r);async function o(){try{const s=await a;for await(const l of s){const c=new cn({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await e.writer.write(c)}}finally{await e.writer.close()}}const i=o();try{for await(const s of e)yield s}finally{await i}}streamEvents(t,e,r){let n;if(e.version==="v1")n=this._streamEventsV1(t,e,r);else if(e.version==="v2")n=this._streamEventsV2(t,e,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return e.encoding==="text/event-stream"?zR(n):Ft.fromAsyncGenerator(n)}async*_streamEventsV2(t,e,r){var p;const n=new bF({...r,autoClose:!1}),a=Ie(e),o=a.runId??ht();a.runId=o;const i=a.callbacks;if(i===void 0)a.callbacks=[n];else if(Array.isArray(i))a.callbacks=i.concat(n);else{const f=i.copy();f.addHandler(n,!0),a.callbacks=f}const s=new AbortController,l=this;async function c(){try{let f;e!=null&&e.signal?"any"in AbortSignal?f=AbortSignal.any([s.signal,e.signal]):(f=e.signal,e.signal.addEventListener("abort",()=>{s.abort()},{once:!0})):f=s.signal;const g=await l.stream(t,{...a,signal:f}),m=n.tapOutputIterable(o,g);for await(const _ of m)if(s.signal.aborted)break}finally{await n.finish()}}const d=c();let u=!1,h;try{for await(const f of n){if(!u){f.data.input=t,u=!0,h=f.run_id,yield f;continue}f.run_id===h&&f.event.endsWith("_end")&&((p=f.data)!=null&&p.input)&&delete f.data.input,yield f}}finally{s.abort(),await d}}async*_streamEventsV1(t,e,r){let n,a=!1;const o=Ie(e),i=o.tags??[],s=o.metadata??{},l=o.runName??this.getName(),c=new Vw({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new xF({...r}),u=this._streamLog(t,c,o);for await(const p of u){if(n?n=n.concat(p):n=Vo.fromRunLogPatch(p),n.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const _={...n.state},v={run_id:_.id,event:`on_${_.type}_start`,name:l,tags:i,metadata:s,data:{input:t}};d.includeEvent(v,_.type)&&(yield v)}const f=p.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),g=[...new Set(f)];for(const _ of g){let v,A={};const F=n.state.logs[_];if(F.end_time===void 0?F.streamed_output.length>0?v="stream":v="start":v="end",v==="start")F.inputs!==void 0&&(A.input=F.inputs);else if(v==="end")F.inputs!==void 0&&(A.input=F.inputs),A.output=F.final_output;else if(v==="stream"){const b=F.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${F.name}"`);A={chunk:F.streamed_output[0]},F.streamed_output=[]}yield{event:`on_${F.type}_${v}`,name:F.name,run_id:F.id,tags:F.tags,metadata:F.metadata,data:A}}const{state:m}=n;if(m.streamed_output.length>0){const _=m.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${m.name}"`);const v={chunk:m.streamed_output[0]};m.streamed_output=[];const A={event:`on_${m.type}_stream`,run_id:m.id,tags:i,metadata:s,name:l,data:v};d.includeEvent(A,m.type)&&(yield A)}}const h=n==null?void 0:n.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:l,run_id:h.id,tags:i,metadata:s,data:{output:h.final_output}};d.includeEvent(p,h.type)&&(yield p)}}static isRunnable(t){return xh(t)}withListeners({onStart:t,onEnd:e,onError:r}){return new Ln({bound:this,config:{},configFactories:[n=>({callbacks:[new Zw({config:n,onStart:t,onEnd:e,onError:r})]})]})}asTool(t){return GR(this,t)}};class Ln extends st{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const r=Hw(this.config,...e);return Hw(r,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(r))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new ub({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}async invoke(e,r){return this.bound.invoke(e,await this._mergeConfig(Ie(r),this.kwargs))}async batch(e,r,n){const a=Array.isArray(r)?await Promise.all(r.map(async o=>this._mergeConfig(Ie(o),this.kwargs))):await this._mergeConfig(Ie(r),this.kwargs);return this.bound.batch(e,a,n)}async*_streamIterator(e,r){yield*this.bound._streamIterator(e,await this._mergeConfig(Ie(r),this.kwargs))}async stream(e,r){return this.bound.stream(e,await this._mergeConfig(Ie(r),this.kwargs))}async*transform(e,r){yield*this.bound.transform(e,await this._mergeConfig(Ie(r),this.kwargs))}streamEvents(e,r,n){const a=this,o=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(Ie(r),a.kwargs),version:r.version},n)};return Ft.fromAsyncGenerator(o())}static isRunnableBinding(e){return e.bound&&st.isRunnable(e.bound)}withListeners({onStart:e,onEnd:r,onError:n}){return new Ln({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new Zw({config:a,onStart:e,onEnd:r,onError:n})]})]})}}class il extends st{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new il({bound:this.bound.bind(e)})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _invoke(e,r,n){return this.bound.batch(e,dt(r,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:r,onError:n}){return new il({bound:this.bound.withListeners({onStart:e,onEnd:r,onError:n})})}}class ub extends Ln{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,r,n){const a=e>1?`retry:attempt:${e}`:void 0;return dt(r,{callbacks:n==null?void 0:n.getChild(a)})}async _invoke(e,r,n){return Fs(a=>super.invoke(e,this._patchConfigForRetry(a,r,n)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _batch(e,r,n,a){const o={};try{await Fs(async i=>{const s=e.map((h,p)=>p).filter(h=>o[h.toString()]===void 0||o[h.toString()]instanceof Error),l=s.map(h=>e[h]),c=s.map(h=>this._patchConfigForRetry(i,r==null?void 0:r[h],n==null?void 0:n[h])),d=await super.batch(l,c,{...a,returnExceptions:!0});let u;for(let h=0;h<d.length;h+=1){const p=d[h],f=s[h];p instanceof Error&&u===void 0&&(u=p,u.input=l[h]),o[f.toString()]=p}if(u)throw u;return d},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((a==null?void 0:a.returnExceptions)!==!0)throw i}return Object.keys(o).sort((i,s)=>parseInt(i,10)-parseInt(s,10)).map(i=>o[parseInt(i,10)])}async batch(e,r,n){return this._batchWithConfig(this._batch.bind(this),e,r,n)}}vn=class extends st{static lc_name(){return"RunnableSequence"}constructor(t){super(t),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=t.first,this.middle=t.middle??this.middle,this.last=t.last,this.name=t.name,this.omitSequenceTags=t.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(t,e){var i,s;const r=Ie(e),n=await((i=await er(r))==null?void 0:i.handleChainStart(this.toJSON(),ot(t,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=t,o;try{const l=[this.first,...this.middle];for(let c=0;c<l.length;c+=1){const d=l[c].invoke(a,dt(r,{callbacks:n==null?void 0:n.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));a=await ln(d,e==null?void 0:e.signal)}if((s=e==null?void 0:e.signal)!=null&&s.aborted)throw new Error("Aborted");o=await this.last.invoke(a,dt(r,{callbacks:n==null?void 0:n.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await(n==null?void 0:n.handleChainError(l)),l}return await(n==null?void 0:n.handleChainEnd(ot(o,"output"))),o}async batch(t,e,r){var s;const n=this._getOptionsList(e??{},t.length),a=await Promise.all(n.map(er)),o=await Promise.all(a.map(async(l,c)=>{const d=await(l==null?void 0:l.handleChainStart(this.toJSON(),ot(t[c],"input"),n[c].runId,void 0,void 0,void 0,n[c].runName));return delete n[c].runId,d}));let i=t;try{for(let l=0;l<this.steps.length;l+=1){const c=this.steps[l].batch(i,o.map((d,u)=>{const h=d==null?void 0:d.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return dt(n[u],{callbacks:h})}),r);i=await ln(c,(s=n[0])==null?void 0:s.signal)}}catch(l){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(ot(i,"output")))),i}async*_streamIterator(t,e){var d;const r=await er(e),{runId:n,...a}=e??{},o=await(r==null?void 0:r.handleChainStart(this.toJSON(),ot(t,"input"),n,void 0,void 0,void 0,a==null?void 0:a.runName)),i=[this.first,...this.middle,this.last];let s=!0,l;async function*c(){yield t}try{let u=i[0].transform(c(),dt(a,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let h=1;h<i.length;h+=1)u=await i[h].transform(u,dt(a,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`)}));for await(const h of u)if((d=e==null?void 0:e.signal)==null||d.throwIfAborted(),yield h,s)if(l===void 0)l=h;else try{l=ur(l,h)}catch{l=void 0,s=!1}}catch(u){throw await(o==null?void 0:o.handleChainError(u)),u}await(o==null?void 0:o.handleChainEnd(ot(l,"output")))}getGraph(t){const e=new ol;let r=null;return this.steps.forEach((n,a)=>{const o=n.getGraph(t);a!==0&&o.trimFirstNode(),a!==this.steps.length-1&&o.trimLastNode(),e.extend(o);const i=o.firstNode();if(!i)throw new Error(`Runnable ${n} has no first node`);r&&e.addEdge(r,i),r=o.lastNode()}),e}pipe(t){return vn.isRunnableSequence(t)?new vn({first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}):new vn({first:this.first,middle:[...this.middle,this.last],last:Dn(t),name:this.name})}static isRunnableSequence(t){return Array.isArray(t.middle)&&st.isRunnable(t)}static from([t,...e],r){let n={};return typeof r=="string"?n.name=r:r!==void 0&&(n=r),new vn({...n,first:Dn(t),middle:e.slice(0,-1).map(Dn),last:Dn(e[e.length-1])})}},ho=class extends st{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[e,r]of Object.entries(t.steps))this.steps[e]=Dn(r)}static from(t){return new ho({steps:t})}async invoke(t,e){var o;const r=Ie(e),n=await((o=await er(r))==null?void 0:o.handleChainStart(this.toJSON(),{input:t},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{const i=Object.entries(this.steps).map(async([s,l])=>{a[s]=await l.invoke(t,dt(r,{callbacks:n==null?void 0:n.getChild(`map:key:${s}`)}))});await ln(Promise.all(i),e==null?void 0:e.signal)}catch(i){throw await(n==null?void 0:n.handleChainError(i)),i}return await(n==null?void 0:n.handleChainEnd(a)),a}async*_transform(t,e,r){const n={...this.steps},a=Ww(t,Object.keys(n).length),o=new Map(Object.entries(n).map(([i,s],l)=>{const c=s.transform(a[l],dt(r,{callbacks:e==null?void 0:e.getChild(`map:key:${i}`)}));return[i,c.next().then(d=>({key:i,gen:c,result:d}))]}));for(;o.size;){const i=Promise.race(o.values()),{key:s,result:l,gen:c}=await ln(i,r==null?void 0:r.signal);o.delete(s),l.done||(yield{[s]:l.value},o.set(s,c.next().then(d=>({key:s,gen:c,result:d}))))}}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Ie(e),a=new Na({generator:this.transform(r(),n),config:n});return await a.setup,Ft.fromAsyncGenerator(a)}};class Oh extends st{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!dh(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,r){const[n]=this._getOptionsList(r??{},1),a=await er(n),o=this.func(dt(n,{callbacks:a}),e);return ln(o,n==null?void 0:n.signal)}async*_streamIterator(e,r){var o,i;const[n]=this._getOptionsList(r??{},1),a=await this.invoke(e,r);if(Fh(a)){for await(const s of a)(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield s;return}if(UR(a)){for(;;){(i=n==null?void 0:n.signal)==null||i.throwIfAborted();const s=a.next();if(s.done)break;yield s.value}return}yield a}static from(e){return new Oh({func:e})}}function BR(t){if(dh(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}Si=class extends st{static lc_name(){return"RunnableLambda"}constructor(t){if(dh(t.func))return Oh.from(t.func);super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),BR(t.func),this.func=t.func}static from(t){return new Si({func:t})}async _invoke(t,e,r){return new Promise((n,a)=>{const o=dt(e,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((e==null?void 0:e.recursionLimit)??Sh)-1});sn.runWithConfig(Oa(o),async()=>{var i,s;try{let l=await this.func(t,{...o});if(l&&st.isRunnable(l)){if((e==null?void 0:e.recursionLimit)===0)throw new Error("Recursion limit reached.");l=await l.invoke(t,{...o,recursionLimit:(o.recursionLimit??Sh)-1})}else if(Fh(l)){let c;for await(const d of Rh(o,l))if((i=e==null?void 0:e.signal)==null||i.throwIfAborted(),c===void 0)c=d;else try{c=ur(c,d)}catch{c=d}l=c}else if(cb(l)){let c;for(const d of db(o,l))if((s=e==null?void 0:e.signal)==null||s.throwIfAborted(),c===void 0)c=d;else try{c=ur(c,d)}catch{c=d}l=c}n(l)}catch(l){a(l)}})})}async invoke(t,e){return this._callWithConfig(this._invoke.bind(this),t,e)}async*_transform(t,e,r){var i,s;let n;for await(const l of t)if(n===void 0)n=l;else try{n=ur(n,l)}catch{n=l}const a=dt(r,{callbacks:e==null?void 0:e.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Sh)-1}),o=await new Promise((l,c)=>{sn.runWithConfig(Oa(a),async()=>{try{const d=await this.func(n,{...a,config:a});l(d)}catch(d){c(d)}})});if(o&&st.isRunnable(o)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const l=await o.stream(n,a);for await(const c of l)yield c}else if(Fh(o))for await(const l of Rh(a,o))(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield l;else if(cb(o))for(const l of db(a,o))(s=r==null?void 0:r.signal)==null||s.throwIfAborted(),yield l;else yield o}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Ie(e),a=new Na({generator:this.transform(r(),n),config:n});return await a.setup,Ft.fromAsyncGenerator(a)}};class HR extends st{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,r){const n=Ie(r),a=await er(n),{runId:o,...i}=n,s=await(a==null?void 0:a.handleChainStart(this.toJSON(),ot(e,"input"),o,void 0,void 0,void 0,i==null?void 0:i.runName)),l=dt(i,{callbacks:s==null?void 0:s.getChild()});return await sn.runWithConfig(l,async()=>{var d;let c;for(const u of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();try{const h=await u.invoke(e,l);return await(s==null?void 0:s.handleChainEnd(ot(h,"output"))),h}catch(h){c===void 0&&(c=h)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(s==null?void 0:s.handleChainError(c)),c)})}async*_streamIterator(e,r){var u;const n=Ie(r),a=await er(n),{runId:o,...i}=n,s=await(a==null?void 0:a.handleChainStart(this.toJSON(),ot(e,"input"),o,void 0,void 0,void 0,i==null?void 0:i.runName));let l,c;for(const h of this.runnables()){(u=n==null?void 0:n.signal)==null||u.throwIfAborted();const p=dt(i,{callbacks:s==null?void 0:s.getChild()});try{const f=await h.stream(e,p);c=Rh(p,f);break}catch(f){l===void 0&&(l=f)}}if(c===void 0){const h=l??new Error("No error stored at end of fallback.");throw await(s==null?void 0:s.handleChainError(h)),h}let d;try{for await(const h of c){yield h;try{d=d===void 0?d:ur(d,h)}catch{d=void 0}}}catch(h){throw await(s==null?void 0:s.handleChainError(h)),h}await(s==null?void 0:s.handleChainEnd(ot(d,"output")))}async batch(e,r,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(r??{},e.length),o=await Promise.all(a.map(c=>er(c))),i=await Promise.all(o.map(async(c,d)=>{const u=await(c==null?void 0:c.handleChainStart(this.toJSON(),ot(e[d],"input"),a[d].runId,void 0,void 0,void 0,a[d].runName));return delete a[d].runId,u}));let s;for(const c of this.runnables()){(l=a[0].signal)==null||l.throwIfAborted();try{const d=await c.batch(e,i.map((u,h)=>dt(a[h],{callbacks:u==null?void 0:u.getChild()})),n);return await Promise.all(i.map((u,h)=>u==null?void 0:u.handleChainEnd(ot(d[h],"output")))),d}catch(d){s===void 0&&(s=d)}}throw s?(await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(s))),s):new Error("No error stored at end of fallbacks.")}}function Dn(t){if(typeof t=="function")return new Si({func:t});if(st.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[r,n]of Object.entries(t))e[r]=Dn(n);return new ho({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}pf=class extends st{static lc_name(){return"RunnableAssign"}constructor(t){t instanceof ho&&(t={mapper:t}),super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=t.mapper}async invoke(t,e){const r=await this.mapper.invoke(t,e);return{...t,...r}}async*_transform(t,e,r){const n=this.mapper.getStepsKeys(),[a,o]=Ww(t),i=this.mapper.transform(o,dt(r,{callbacks:e==null?void 0:e.getChild()})),s=i.next();for await(const l of a){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const c=Object.fromEntries(Object.entries(l).filter(([d])=>!n.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await s).value;for await(const l of i)yield l}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Ie(e),a=new Na({generator:this.transform(r(),n),config:n});return await a.setup,Ft.fromAsyncGenerator(a)}};class WR extends st{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const r=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return r.length===0?void 0:Object.fromEntries(r)}}async invoke(e,r){return this._callWithConfig(this._pick.bind(this),e,r)}async*_transform(e){for await(const r of e){const n=await this._pick(r);n!==void 0&&(yield n)}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const a=Ie(r),o=new Na({generator:this.transform(n(),a),config:a});return await o.setup,Ft.fromAsyncGenerator(o)}}class hb extends Ln{constructor(e){const r=vn.from([Si.from(async n=>{let a;if(jl(n))try{a=await Ep(this.schema,n.args)}catch{throw new Sp("Received tool input did not match expected schema",JSON.stringify(n.args))}else a=n;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:r,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function GR(t,e){const r=e.name??t.getName(),n=e.description??Jp(e.schema);return CR(e.schema)?new hb({name:r,description:n,schema:Xp({input:Qp()}).transform(a=>a.input),bound:t}):new hb({name:r,description:n,schema:e.schema,bound:t})}class qR extends st{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,r){return this.transformDocuments(e)}}var Ko={},pb;function VR(){if(pb)return Ko;pb=1,Ko.byteLength=s,Ko.toByteArray=c,Ko.fromByteArray=h;for(var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)t[a]=n[a],e[n.charCodeAt(a)]=a;e[45]=62,e[95]=63;function i(p){var f=p.length;if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=p.indexOf("=");g===-1&&(g=f);var m=g===f?0:4-g%4;return[g,m]}function s(p){var f=i(p),g=f[0],m=f[1];return(g+m)*3/4-m}function l(p,f,g){return(f+g)*3/4-g}function c(p){var f,g=i(p),m=g[0],_=g[1],v=new r(l(p,m,_)),A=0,F=_>0?m-4:m,b;for(b=0;b<F;b+=4)f=e[p.charCodeAt(b)]<<18|e[p.charCodeAt(b+1)]<<12|e[p.charCodeAt(b+2)]<<6|e[p.charCodeAt(b+3)],v[A++]=f>>16&255,v[A++]=f>>8&255,v[A++]=f&255;return _===2&&(f=e[p.charCodeAt(b)]<<2|e[p.charCodeAt(b+1)]>>4,v[A++]=f&255),_===1&&(f=e[p.charCodeAt(b)]<<10|e[p.charCodeAt(b+1)]<<4|e[p.charCodeAt(b+2)]>>2,v[A++]=f>>8&255,v[A++]=f&255),v}function d(p){return t[p>>18&63]+t[p>>12&63]+t[p>>6&63]+t[p&63]}function u(p,f,g){for(var m,_=[],v=f;v<g;v+=3)m=(p[v]<<16&16711680)+(p[v+1]<<8&65280)+(p[v+2]&255),_.push(d(m));return _.join("")}function h(p){for(var f,g=p.length,m=g%3,_=[],v=16383,A=0,F=g-m;A<F;A+=v)_.push(u(p,A,A+v>F?F:A+v));return m===1?(f=p[g-1],_.push(t[f>>2]+t[f<<4&63]+"==")):m===2&&(f=(p[g-2]<<8)+p[g-1],_.push(t[f>>10]+t[f>>4&63]+t[f<<2&63]+"=")),_.join("")}return Ko}var ZR=VR();const JR=Ja(ZR);var KR=Object.defineProperty,YR=(t,e,r)=>e in t?KR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,XR=(t,e,r)=>(YR(t,e+"",r),r);function QR(t,e){let r=Array.from({length:t.length},(n,a)=>({start:a,end:a+1}));for(;r.length>1;){let n=null;for(let a=0;a<r.length-1;a++){const o=t.slice(r[a].start,r[a+1].end),i=e.get(o.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,a])}if(n!=null){const a=n[1];r[a]={start:r[a].start,end:r[a+1].end},r.splice(a+1,1)}else break}return r}function eO(t,e){return t.length===1?[e.get(t.join(","))]:QR(t,e).map(r=>e.get(t.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function tO(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Nh=class{constructor(t,e){ae(this,"specialTokens");ae(this,"inverseSpecialTokens");ae(this,"patStr");ae(this,"textEncoder",new TextEncoder);ae(this,"textDecoder",new TextDecoder("utf-8"));ae(this,"rankMap",new Map);ae(this,"textMap",new Map);this.patStr=t.pat_str;const r=t.bpe_ranks.split(`
`).filter(Boolean).reduce((n,a)=>{const[o,i,...s]=a.split(" "),l=Number.parseInt(i,10);return s.forEach((c,d)=>n[c]=l+d),n},{});for(const[n,a]of Object.entries(r)){const o=JR.toByteArray(n);this.rankMap.set(o.join(","),a),this.textMap.set(a,o)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[a,o])=>(n[o]=this.textEncoder.encode(a),n),{})}encode(t,e=[],r="all"){const n=new RegExp(this.patStr,"ug"),a=Nh.specialTokenRegex(Object.keys(this.specialTokens)),o=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),s=new Set(r==="all"?Object.keys(this.specialTokens).filter(c=>!i.has(c)):r);if(s.size>0){const c=Nh.specialTokenRegex([...s]),d=t.match(c);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let l=0;for(;;){let c=null,d=l;for(;a.lastIndex=d,c=a.exec(t),!(c==null||i.has(c[0]));)d=c.index+1;const u=(c==null?void 0:c.index)??t.length;for(const p of t.substring(l,u).matchAll(n)){const f=this.textEncoder.encode(p[0]),g=this.rankMap.get(f.join(","));if(g!=null){o.push(g);continue}o.push(...eO(f,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];o.push(h),l=c.index+c[0].length}return o}decode(t){const e=[];let r=0;for(let o=0;o<t.length;++o){const i=t[o],s=this.textMap.get(i)??this.inverseSpecialTokens[i];s!=null&&(e.push(s),r+=s.length)}const n=new Uint8Array(r);let a=0;for(const o of e)n.set(o,a),a+=o.length;return this.textDecoder.decode(n)}},fb=Nh;XR(fb,"specialTokenRegex",t=>new RegExp(t.map(e=>tO(e)).join("|"),"g"));function rO(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":return"o200k_base";default:throw new Error("Unknown model")}}const sl={},nO=new Ai({});async function mb(t){return t in sl||(sl[t]=nO.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new fb(e)).catch(e=>{throw delete sl[t],e})),await sl[t]}D0=async function(t){return mb(rO(t))};class Ih extends qR{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(r=>r.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,r={}){return this.splitDocuments(e,r)}splitOnSeparator(e,r){let n;if(r)if(this.keepSeparator){const a=r.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${a})`))}else n=e.split(r);else n=e.split("");return n.filter(a=>a!=="")}async createDocuments(e,r=[],n={}){const a=r.length>0?r:[...Array(e.length)].map(()=>({})),{chunkHeader:o="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:s=!1}=n,l=new Array;for(let c=0;c<e.length;c+=1){const d=e[c];let u=1,h=null,p=-1;for(const f of await this.splitText(d)){let g=o;const m=d.indexOf(f,p+1);if(h===null){const F=this.numberOfNewLines(d,0,m);u+=F}else{const F=p+await this.lengthFunction(h);if(F<m){const b=this.numberOfNewLines(d,F,m);u+=b}else if(F>m){const b=this.numberOfNewLines(d,m,F);u-=b}s&&(g+=i)}const _=this.numberOfNewLines(f),v=a[c].loc&&typeof a[c].loc=="object"?{...a[c].loc}:{};v.lines={from:u,to:u+_};const A={...a[c],loc:v};g+=f,l.push(new Sn({pageContent:g,metadata:A})),u+=_,h=f,p=m}}return l}numberOfNewLines(e,r,n){return(e.slice(r,n).match(/\n/g)||[]).length}async splitDocuments(e,r={}){const n=e.filter(i=>i.pageContent!==void 0),a=n.map(i=>i.pageContent),o=n.map(i=>i.metadata);return this.createDocuments(a,o,r)}joinDocs(e,r){const n=e.join(r).trim();return n===""?null:n}async mergeSplits(e,r){const n=[],a=[];let o=0;for(const s of e){const l=await this.lengthFunction(s);if(o+l+a.length*r.length>this.chunkSize&&(o>this.chunkSize&&console.warn(`Created a chunk of size ${o}, +
which is longer than the specified ${this.chunkSize}`),a.length>0)){const c=this.joinDocs(a,r);for(c!==null&&n.push(c);o>this.chunkOverlap||o+l+a.length*r.length>this.chunkSize&&o>0;)o-=await this.lengthFunction(a[0]),a.shift()}a.push(s),o+=l}const i=this.joinDocs(a,r);return i!==null&&n.push(i),n}}class aO extends Ih{static lc_name(){return"CharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),this.separator=(e==null?void 0:e.separator)??this.separator}async splitText(e){const r=this.splitOnSeparator(e,this.separator);return this.mergeSplits(r,this.keepSeparator?"":this.separator)}}class ll extends Ih{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,r){const n=[];let a=r[r.length-1],o;for(let c=0;c<r.length;c+=1){const d=r[c];if(d===""){a=d;break}if(e.includes(d)){a=d,o=r.slice(c+1);break}}const i=this.splitOnSeparator(e,a);let s=[];const l=this.keepSeparator?"":a;for(const c of i)if(await this.lengthFunction(c)<this.chunkSize)s.push(c);else{if(s.length){const d=await this.mergeSplits(s,l);n.push(...d),s=[]}if(!o)n.push(c);else{const d=await this._splitText(c,o);n.push(...d)}}if(s.length){const c=await this.mergeSplits(s,l);n.push(...c)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,r){return new ll({...r,separators:ll.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}class oO extends Ih{static lc_name(){return"TokenTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"encodingName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disallowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenizer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.encodingName=(e==null?void 0:e.encodingName)??"gpt2",this.allowedSpecial=(e==null?void 0:e.allowedSpecial)??[],this.disallowedSpecial=(e==null?void 0:e.disallowedSpecial)??"all"}async splitText(e){this.tokenizer||(this.tokenizer=await mb(this.encodingName));const r=[],n=this.tokenizer.encode(e,this.allowedSpecial,this.disallowedSpecial);let a=0;for(;a<n.length;){a>0&&(a-=this.chunkOverlap);const o=Math.min(a+this.chunkSize,n.length),i=n.slice(a,o);r.push(this.tokenizer.decode(i)),a=o}return r}}const iO="/NoLLMChat/assets/voy_search_bg-FlZi7F4l.wasm",sO=async(t={},e)=>{let r;if(e.startsWith("data:")){const n=e.replace(/^data:.*?base64,/,"");let a;if(typeof rp=="function"&&typeof rp.from=="function")a=rp.from(n,"base64");else if(typeof atob=="function"){const o=atob(n);a=new Uint8Array(o.length);for(let i=0;i<o.length;i++)a[i]=o.charCodeAt(i)}else throw new Error("Cannot decode base64-encoded data URL");r=await WebAssembly.instantiate(a,t)}else{const n=await fetch(e),a=n.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&a.startsWith("application/wasm"))r=await WebAssembly.instantiateStreaming(n,t);else{const o=await n.arrayBuffer();r=await WebAssembly.instantiate(o,t)}}return r.instance.exports};let Ue;function lO(t){Ue=t}const Lr=new Array(128).fill(void 0);Lr.push(void 0,null,!0,!1);function Ia(t){return Lr[t]}let Yo=Lr.length;function Dr(t){Yo===Lr.length&&Lr.push(Lr.length+1);const e=Yo;return Yo=Lr[e],Lr[e]=t,e}function cO(t){t<132||(Lr[t]=Yo,Yo=t)}function gb(t){const e=Ia(t);return cO(t),e}let $n=0,cl=null;function dl(){return(cl===null||cl.byteLength===0)&&(cl=new Uint8Array(Ue.memory.buffer)),cl}const dO=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let ul=new dO("utf-8");const uO=typeof ul.encodeInto=="function"?function(t,e){return ul.encodeInto(t,e)}:function(t,e){const r=ul.encode(t);return e.set(r),{read:t.length,written:r.length}};function Ph(t,e,r){if(r===void 0){const s=ul.encode(t),l=e(s.length)>>>0;return dl().subarray(l,l+s.length).set(s),$n=s.length,l}let n=t.length,a=e(n)>>>0;const o=dl();let i=0;for(;i<n;i++){const s=t.charCodeAt(i);if(s>127)break;o[a+i]=s}if(i!==n){i!==0&&(t=t.slice(i)),a=r(a,n,n=i+t.length*3)>>>0;const s=dl().subarray(a+i,a+n),l=uO(t,s);i+=l.written}return $n=i,a}function yb(t){return t==null}let hl=null;function Pa(){return(hl===null||hl.byteLength===0)&&(hl=new Int32Array(Ue.memory.buffer)),hl}const hO=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let _b=new hO("utf-8",{ignoreBOM:!0,fatal:!0});_b.decode();function pl(t,e){return t=t>>>0,_b.decode(dl().subarray(t,t+e))}let fl=null;function pO(){return(fl===null||fl.byteLength===0)&&(fl=new Float32Array(Ue.memory.buffer)),fl}function fO(t,e){const r=e(t.length*4)>>>0;return pO().set(t,r/4),$n=t.length,r}function vb(t,e){try{return t.apply(this,e)}catch(r){Ue.__wbindgen_exn_store(Dr(r))}}class un{static __wrap(e){e=e>>>0;const r=Object.create(un.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_voy_free(e)}constructor(e){const r=Ue.voy_new(yb(e)?0:Dr(e));return un.__wrap(r)}serialize(){let e,r;try{const o=Ue.__wbindgen_add_to_stack_pointer(-16);Ue.voy_serialize(o,this.__wbg_ptr);var n=Pa()[o/4+0],a=Pa()[o/4+1];return e=n,r=a,pl(n,a)}finally{Ue.__wbindgen_add_to_stack_pointer(16),Ue.__wbindgen_free(e,r)}}static deserialize(e){const r=Ph(e,Ue.__wbindgen_malloc,Ue.__wbindgen_realloc),n=$n,a=Ue.voy_deserialize(r,n);return un.__wrap(a)}index(e){Ue.voy_index(this.__wbg_ptr,Dr(e))}search(e,r){const n=fO(e,Ue.__wbindgen_malloc),a=$n,o=Ue.voy_search(this.__wbg_ptr,n,a,r);return gb(o)}add(e){Ue.voy_add(this.__wbg_ptr,Dr(e))}remove(e){Ue.voy_remove(this.__wbg_ptr,Dr(e))}clear(){Ue.voy_clear(this.__wbg_ptr)}size(){return Ue.voy_size(this.__wbg_ptr)>>>0}}function mO(t){const e=Ia(t);return Dr(e)}function gO(t){return Ia(t)===void 0}function yO(t){gb(t)}function _O(){const t=new Error;return Dr(t)}function vO(t,e){const r=Ia(e).stack,n=Ph(r,Ue.__wbindgen_malloc,Ue.__wbindgen_realloc),a=$n;Pa()[t/4+1]=a,Pa()[t/4+0]=n}function wO(t,e){let r,n;try{r=t,n=e,console.error(pl(t,e))}finally{Ue.__wbindgen_free(r,n)}}function bO(){return vb(function(t,e){const r=JSON.parse(pl(t,e));return Dr(r)},arguments)}function EO(){return vb(function(t){const e=JSON.stringify(Ia(t));return Dr(e)},arguments)}function SO(t,e){const r=Ia(e),n=typeof r=="string"?r:void 0;var a=yb(n)?0:Ph(n,Ue.__wbindgen_malloc,Ue.__wbindgen_realloc),o=$n;Pa()[t/4+1]=o,Pa()[t/4+0]=a}function xO(t,e){throw new Error(pl(t,e))}URL=globalThis.URL;const Je=await sO({"./voy_search_bg.js":{__wbindgen_object_clone_ref:mO,__wbindgen_is_undefined:gO,__wbindgen_object_drop_ref:yO,__wbg_new_abda76e883ba8a5f:_O,__wbg_stack_658279fe44541cf6:vO,__wbg_error_f851667af71bcfc6:wO,__wbg_parse_76a8a18ca3f8730b:bO,__wbg_stringify_d06ad2addc54d51e:EO,__wbindgen_string_get:SO,__wbindgen_throw:xO}},iO),kO=Je.memory,AO=Je.__wbg_voy_free,TO=Je.voy_new,MO=Je.voy_serialize,FO=Je.voy_deserialize,RO=Je.voy_index,OO=Je.voy_search,NO=Je.voy_add,IO=Je.voy_remove,PO=Je.voy_clear,CO=Je.voy_size,jO=Je.index,LO=Je.search,DO=Je.add,$O=Je.remove,zO=Je.clear,UO=Je.size,BO=Je.__wbindgen_malloc,HO=Je.__wbindgen_realloc,WO=Je.__wbindgen_add_to_stack_pointer,GO=Je.__wbindgen_free,qO=Je.__wbindgen_exn_store,VO=Object.freeze(Object.defineProperty({__proto__:null,__wbg_voy_free:AO,__wbindgen_add_to_stack_pointer:WO,__wbindgen_exn_store:qO,__wbindgen_free:GO,__wbindgen_malloc:BO,__wbindgen_realloc:HO,add:DO,clear:zO,index:jO,memory:kO,remove:$O,search:LO,size:UO,voy_add:NO,voy_clear:PO,voy_deserialize:FO,voy_index:RO,voy_new:TO,voy_remove:IO,voy_search:OO,voy_serialize:MO,voy_size:CO},Symbol.toStringTag,{value:"Module"}));lO(VO),io=function(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')};var wb={exports:{}},bb;function ZO(){return bb||(bb=1,function(t,e){(function(r){t.exports=r()})(function(){return function r(n,a,o){function i(c,d){if(!a[c]){if(!n[c]){var u=typeof io=="function"&&io;if(!d&&u)return u(c,!0);if(s)return s(c,!0);var h=new Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h}var p=a[c]={exports:{}};n[c][0].call(p.exports,function(f){var g=n[c][1][f];return i(g||f)},p,p.exports,r,n,a,o)}return a[c].exports}for(var s=typeof io=="function"&&io,l=0;l<o.length;l++)i(o[l]);return i}({1:[function(r,n,a){(function(o){var i=o.MutationObserver||o.WebKitMutationObserver,s;if(i){var l=0,c=new i(f),d=o.document.createTextNode("");c.observe(d,{characterData:!0}),s=function(){d.data=l=++l%2}}else if(!o.setImmediate&&typeof o.MessageChannel<"u"){var u=new o.MessageChannel;u.port1.onmessage=f,s=function(){u.port2.postMessage(0)}}else"document"in o&&"onreadystatechange"in o.document.createElement("script")?s=function(){var m=o.document.createElement("script");m.onreadystatechange=function(){f(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},o.document.documentElement.appendChild(m)}:s=function(){setTimeout(f,0)};var h,p=[];function f(){h=!0;for(var m,_,v=p.length;v;){for(_=p,p=[],m=-1;++m<v;)_[m]();v=p.length}h=!1}n.exports=g;function g(m){p.push(m)===1&&!h&&s()}}).call(this,typeof gi<"u"?gi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(r,n,a){var o=r(1);function i(){}var s={},l=["REJECTED"],c=["FULFILLED"],d=["PENDING"];n.exports=u;function u(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,b!==i&&g(this,b)}u.prototype.catch=function(b){return this.then(null,b)},u.prototype.then=function(b,D){if(typeof b!="function"&&this.state===c||typeof D!="function"&&this.state===l)return this;var B=new this.constructor(i);if(this.state!==d){var j=this.state===c?b:D;p(B,j,this.outcome)}else this.queue.push(new h(B,b,D));return B};function h(b,D,B){this.promise=b,typeof D=="function"&&(this.onFulfilled=D,this.callFulfilled=this.otherCallFulfilled),typeof B=="function"&&(this.onRejected=B,this.callRejected=this.otherCallRejected)}h.prototype.callFulfilled=function(b){s.resolve(this.promise,b)},h.prototype.otherCallFulfilled=function(b){p(this.promise,this.onFulfilled,b)},h.prototype.callRejected=function(b){s.reject(this.promise,b)},h.prototype.otherCallRejected=function(b){p(this.promise,this.onRejected,b)};function p(b,D,B){o(function(){var j;try{j=D(B)}catch(G){return s.reject(b,G)}j===b?s.reject(b,new TypeError("Cannot resolve promise with itself")):s.resolve(b,j)})}s.resolve=function(b,D){var B=m(f,D);if(B.status==="error")return s.reject(b,B.value);var j=B.value;if(j)g(b,j);else{b.state=c,b.outcome=D;for(var G=-1,te=b.queue.length;++G<te;)b.queue[G].callFulfilled(D)}return b},s.reject=function(b,D){b.state=l,b.outcome=D;for(var B=-1,j=b.queue.length;++B<j;)b.queue[B].callRejected(D);return b};function f(b){var D=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof D=="function")return function(){D.apply(b,arguments)}}function g(b,D){var B=!1;function j(x){B||(B=!0,s.reject(b,x))}function G(x){B||(B=!0,s.resolve(b,x))}function te(){D(G,j)}var ue=m(te);ue.status==="error"&&j(ue.value)}function m(b,D){var B={};try{B.value=b(D),B.status="success"}catch(j){B.status="error",B.value=j}return B}u.resolve=_;function _(b){return b instanceof this?b:s.resolve(new this(i),b)}u.reject=v;function v(b){var D=new this(i);return s.reject(D,b)}u.all=A;function A(b){var D=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=b.length,j=!1;if(!B)return this.resolve([]);for(var G=new Array(B),te=0,ue=-1,x=new this(i);++ue<B;)R(b[ue],ue);return x;function R(k,E){D.resolve(k).then(H,function(N){j||(j=!0,s.reject(x,N))});function H(N){G[E]=N,++te===B&&!j&&(j=!0,s.resolve(x,G))}}}u.race=F;function F(b){var D=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=b.length,j=!1;if(!B)return this.resolve([]);for(var G=-1,te=new this(i);++G<B;)ue(b[G]);return te;function ue(x){D.resolve(x).then(function(R){j||(j=!0,s.resolve(te,R))},function(R){j||(j=!0,s.reject(te,R))})}}},{1:1}],3:[function(r,n,a){(function(o){typeof o.Promise!="function"&&(o.Promise=r(2))}).call(this,typeof gi<"u"?gi:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(r,n,a){var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S};function i(S,T){if(!(S instanceof T))throw new TypeError("Cannot call a class as a function")}function s(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var l=s();function c(){try{if(!l||!l.open)return!1;var S=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),T=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!S||T)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function d(S,T){S=S||[],T=T||{};try{return new Blob(S,T)}catch($){if($.name!=="TypeError")throw $;for(var M=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,L=new M,I=0;I<S.length;I+=1)L.append(S[I]);return L.getBlob(T.type)}}typeof Promise>"u"&&r(3);var u=Promise;function h(S,T){T&&S.then(function(M){T(null,M)},function(M){T(M)})}function p(S,T,M){typeof T=="function"&&S.then(T),typeof M=="function"&&S.catch(M)}function f(S){return typeof S!="string"&&(console.warn(S+" used as a key, but it is not a string."),S=String(S)),S}function g(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var m="local-forage-detect-blob-support",_=void 0,v={},A=Object.prototype.toString,F="readonly",b="readwrite";function D(S){for(var T=S.length,M=new ArrayBuffer(T),L=new Uint8Array(M),I=0;I<T;I++)L[I]=S.charCodeAt(I);return M}function B(S){return new u(function(T){var M=S.transaction(m,b),L=d([""]);M.objectStore(m).put(L,"key"),M.onabort=function(I){I.preventDefault(),I.stopPropagation(),T(!1)},M.oncomplete=function(){var I=navigator.userAgent.match(/Chrome\/(\d+)/),$=navigator.userAgent.match(/Edge\//);T($||!I||parseInt(I[1],10)>=43)}}).catch(function(){return!1})}function j(S){return typeof _=="boolean"?u.resolve(_):B(S).then(function(T){return _=T,_})}function G(S){var T=v[S.name],M={};M.promise=new u(function(L,I){M.resolve=L,M.reject=I}),T.deferredOperations.push(M),T.dbReady?T.dbReady=T.dbReady.then(function(){return M.promise}):T.dbReady=M.promise}function te(S){var T=v[S.name],M=T.deferredOperations.pop();if(M)return M.resolve(),M.promise}function ue(S,T){var M=v[S.name],L=M.deferredOperations.pop();if(L)return L.reject(T),L.promise}function x(S,T){return new u(function(M,L){if(v[S.name]=v[S.name]||le(),S.db)if(T)G(S),S.db.close();else return M(S.db);var I=[S.name];T&&I.push(S.version);var $=l.open.apply(l,I);T&&($.onupgradeneeded=function(W){var q=$.result;try{q.createObjectStore(S.storeName),W.oldVersion<=1&&q.createObjectStore(m)}catch(X){if(X.name==="ConstraintError")console.warn('The database "'+S.name+'" has been upgraded from version '+W.oldVersion+" to version "+W.newVersion+', but the storage "'+S.storeName+'" already exists.');else throw X}}),$.onerror=function(W){W.preventDefault(),L($.error)},$.onsuccess=function(){var W=$.result;W.onversionchange=function(q){q.target.close()},M(W),te(S)}})}function R(S){return x(S,!1)}function k(S){return x(S,!0)}function E(S,T){if(!S.db)return!0;var M=!S.db.objectStoreNames.contains(S.storeName),L=S.version<S.db.version,I=S.version>S.db.version;if(L&&(S.version!==T&&console.warn('The database "'+S.name+`" can't be downgraded from version `+S.db.version+" to version "+S.version+"."),S.version=S.db.version),I||M){if(M){var $=S.db.version+1;$>S.version&&(S.version=$)}return!0}return!1}function H(S){return new u(function(T,M){var L=new FileReader;L.onerror=M,L.onloadend=function(I){var $=btoa(I.target.result||"");T({__local_forage_encoded_blob:!0,data:$,type:S.type})},L.readAsBinaryString(S)})}function N(S){var T=D(atob(S.data));return d([T],{type:S.type})}function C(S){return S&&S.__local_forage_encoded_blob}function P(S){var T=this,M=T._initReady().then(function(){var L=v[T._dbInfo.name];if(L&&L.dbReady)return L.dbReady});return p(M,S,S),M}function Z(S){G(S);for(var T=v[S.name],M=T.forages,L=0;L<M.length;L++){var I=M[L];I._dbInfo.db&&(I._dbInfo.db.close(),I._dbInfo.db=null)}return S.db=null,R(S).then(function($){return S.db=$,E(S)?k(S):$}).then(function($){S.db=T.db=$;for(var W=0;W<M.length;W++)M[W]._dbInfo.db=$}).catch(function($){throw ue(S,$),$})}function ne(S,T,M,L){L===void 0&&(L=1);try{var I=S.db.transaction(S.storeName,T);M(null,I)}catch($){if(L>0&&(!S.db||$.name==="InvalidStateError"||$.name==="NotFoundError"))return u.resolve().then(function(){if(!S.db||$.name==="NotFoundError"&&!S.db.objectStoreNames.contains(S.storeName)&&S.version<=S.db.version)return S.db&&(S.version=S.db.version+1),k(S)}).then(function(){return Z(S).then(function(){ne(S,T,M,L-1)})}).catch(M);M($)}}function le(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function ye(S){var T=this,M={db:null};if(S)for(var L in S)M[L]=S[L];var I=v[M.name];I||(I=le(),v[M.name]=I),I.forages.push(T),T._initReady||(T._initReady=T.ready,T.ready=P);var $=[];function W(){return u.resolve()}for(var q=0;q<I.forages.length;q++){var X=I.forages[q];X!==T&&$.push(X._initReady().catch(W))}var K=I.forages.slice(0);return u.all($).then(function(){return M.db=I.db,R(M)}).then(function(J){return M.db=J,E(M,T._defaultConfig.version)?k(M):J}).then(function(J){M.db=I.db=J,T._dbInfo=M;for(var fe=0;fe<K.length;fe++){var Me=K[fe];Me!==T&&(Me._dbInfo.db=M.db,Me._dbInfo.version=M.version)}})}function we(S,T){var M=this;S=f(S);var L=new u(function(I,$){M.ready().then(function(){ne(M._dbInfo,F,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=X.get(S);K.onsuccess=function(){var J=K.result;J===void 0&&(J=null),C(J)&&(J=N(J)),I(J)},K.onerror=function(){$(K.error)}}catch(J){$(J)}})}).catch($)});return h(L,T),L}function $e(S,T){var M=this,L=new u(function(I,$){M.ready().then(function(){ne(M._dbInfo,F,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=X.openCursor(),J=1;K.onsuccess=function(){var fe=K.result;if(fe){var Me=fe.value;C(Me)&&(Me=N(Me));var ze=S(Me,fe.key,J++);ze!==void 0?I(ze):fe.continue()}else I()},K.onerror=function(){$(K.error)}}catch(fe){$(fe)}})}).catch($)});return h(L,T),L}function Qe(S,T,M){var L=this;S=f(S);var I=new u(function($,W){var q;L.ready().then(function(){return q=L._dbInfo,A.call(T)==="[object Blob]"?j(q.db).then(function(X){return X?T:H(T)}):T}).then(function(X){ne(L._dbInfo,b,function(K,J){if(K)return W(K);try{var fe=J.objectStore(L._dbInfo.storeName);X===null&&(X=void 0);var Me=fe.put(X,S);J.oncomplete=function(){X===void 0&&(X=null),$(X)},J.onabort=J.onerror=function(){var ze=Me.error?Me.error:Me.transaction.error;W(ze)}}catch(ze){W(ze)}})}).catch(W)});return h(I,M),I}function Dt(S,T){var M=this;S=f(S);var L=new u(function(I,$){M.ready().then(function(){ne(M._dbInfo,b,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=X.delete(S);q.oncomplete=function(){I()},q.onerror=function(){$(K.error)},q.onabort=function(){var J=K.error?K.error:K.transaction.error;$(J)}}catch(J){$(J)}})}).catch($)});return h(L,T),L}function Rt(S){var T=this,M=new u(function(L,I){T.ready().then(function(){ne(T._dbInfo,b,function($,W){if($)return I($);try{var q=W.objectStore(T._dbInfo.storeName),X=q.clear();W.oncomplete=function(){L()},W.onabort=W.onerror=function(){var K=X.error?X.error:X.transaction.error;I(K)}}catch(K){I(K)}})}).catch(I)});return h(M,S),M}function Fe(S){var T=this,M=new u(function(L,I){T.ready().then(function(){ne(T._dbInfo,F,function($,W){if($)return I($);try{var q=W.objectStore(T._dbInfo.storeName),X=q.count();X.onsuccess=function(){L(X.result)},X.onerror=function(){I(X.error)}}catch(K){I(K)}})}).catch(I)});return h(M,S),M}function ut(S,T){var M=this,L=new u(function(I,$){if(S<0){I(null);return}M.ready().then(function(){ne(M._dbInfo,F,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=!1,J=X.openKeyCursor();J.onsuccess=function(){var fe=J.result;if(!fe){I(null);return}S===0||K?I(fe.key):(K=!0,fe.advance(S))},J.onerror=function(){$(J.error)}}catch(fe){$(fe)}})}).catch($)});return h(L,T),L}function Bn(S){var T=this,M=new u(function(L,I){T.ready().then(function(){ne(T._dbInfo,F,function($,W){if($)return I($);try{var q=W.objectStore(T._dbInfo.storeName),X=q.openKeyCursor(),K=[];X.onsuccess=function(){var J=X.result;if(!J){L(K);return}K.push(J.key),J.continue()},X.onerror=function(){I(X.error)}}catch(J){I(J)}})}).catch(I)});return h(M,S),M}function $a(S,T){T=g.apply(this,arguments);var M=this.config();S=typeof S!="function"&&S||{},S.name||(S.name=S.name||M.name,S.storeName=S.storeName||M.storeName);var L=this,I;if(!S.name)I=u.reject("Invalid arguments");else{var $=S.name===M.name&&L._dbInfo.db,W=$?u.resolve(L._dbInfo.db):R(S).then(function(q){var X=v[S.name],K=X.forages;X.db=q;for(var J=0;J<K.length;J++)K[J]._dbInfo.db=q;return q});S.storeName?I=W.then(function(q){if(q.objectStoreNames.contains(S.storeName)){var X=q.version+1;G(S);var K=v[S.name],J=K.forages;q.close();for(var fe=0;fe<J.length;fe++){var Me=J[fe];Me._dbInfo.db=null,Me._dbInfo.version=X}var ze=new u(function(Le,tt){var qe=l.open(S.name,X);qe.onerror=function(Ut){var Xh=qe.result;Xh.close(),tt(Ut)},qe.onupgradeneeded=function(){var Ut=qe.result;Ut.deleteObjectStore(S.storeName)},qe.onsuccess=function(){var Ut=qe.result;Ut.close(),Le(Ut)}});return ze.then(function(Le){K.db=Le;for(var tt=0;tt<J.length;tt++){var qe=J[tt];qe._dbInfo.db=Le,te(qe._dbInfo)}}).catch(function(Le){throw(ue(S,Le)||u.resolve()).catch(function(){}),Le})}}):I=W.then(function(q){G(S);var X=v[S.name],K=X.forages;q.close();for(var J=0;J<K.length;J++){var fe=K[J];fe._dbInfo.db=null}var Me=new u(function(ze,Le){var tt=l.deleteDatabase(S.name);tt.onerror=function(){var qe=tt.result;qe&&qe.close(),Le(tt.error)},tt.onblocked=function(){console.warn('dropInstance blocked for database "'+S.name+'" until all open connections are closed')},tt.onsuccess=function(){var qe=tt.result;qe&&qe.close(),ze(qe)}});return Me.then(function(ze){X.db=ze;for(var Le=0;Le<K.length;Le++){var tt=K[Le];te(tt._dbInfo)}}).catch(function(ze){throw(ue(S,ze)||u.resolve()).catch(function(){}),ze})})}return h(I,T),I}var gt={_driver:"asyncStorage",_initStorage:ye,_support:c(),iterate:$e,getItem:we,setItem:Qe,removeItem:Dt,clear:Rt,length:Fe,key:ut,keys:Bn,dropInstance:$a};function ni(){return typeof openDatabase=="function"}var $t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",za="~~local_forage_type~",Ua=/^~~local_forage_type~([^~]+)~/,hn="__lfsc__:",br=hn.length,ai="arbf",nr="blob",pn="si08",oi="ui08",Ba="uic8",ar="si16",zt="si32",ii="ur16",Ha="ui32",wl="fl32",or="fl64",si=br+ai.length,li=Object.prototype.toString;function ci(S){var T=S.length*.75,M=S.length,L,I=0,$,W,q,X;S[S.length-1]==="="&&(T--,S[S.length-2]==="="&&T--);var K=new ArrayBuffer(T),J=new Uint8Array(K);for(L=0;L<M;L+=4)$=$t.indexOf(S[L]),W=$t.indexOf(S[L+1]),q=$t.indexOf(S[L+2]),X=$t.indexOf(S[L+3]),J[I++]=$<<2|W>>4,J[I++]=(W&15)<<4|q>>2,J[I++]=(q&3)<<6|X&63;return K}function di(S){var T=new Uint8Array(S),M="",L;for(L=0;L<T.length;L+=3)M+=$t[T[L]>>2],M+=$t[(T[L]&3)<<4|T[L+1]>>4],M+=$t[(T[L+1]&15)<<2|T[L+2]>>6],M+=$t[T[L+2]&63];return T.length%3===2?M=M.substring(0,M.length-1)+"=":T.length%3===1&&(M=M.substring(0,M.length-2)+"=="),M}function bl(S,T){var M="";if(S&&(M=li.call(S)),S&&(M==="[object ArrayBuffer]"||S.buffer&&li.call(S.buffer)==="[object ArrayBuffer]")){var L,I=hn;S instanceof ArrayBuffer?(L=S,I+=ai):(L=S.buffer,M==="[object Int8Array]"?I+=pn:M==="[object Uint8Array]"?I+=oi:M==="[object Uint8ClampedArray]"?I+=Ba:M==="[object Int16Array]"?I+=ar:M==="[object Uint16Array]"?I+=ii:M==="[object Int32Array]"?I+=zt:M==="[object Uint32Array]"?I+=Ha:M==="[object Float32Array]"?I+=wl:M==="[object Float64Array]"?I+=or:T(new Error("Failed to get type for BinaryArray"))),T(I+di(L))}else if(M==="[object Blob]"){var $=new FileReader;$.onload=function(){var W=za+S.type+"~"+di(this.result);T(hn+nr+W)},$.readAsArrayBuffer(S)}else try{T(JSON.stringify(S))}catch(W){console.error("Couldn't convert value into a JSON string: ",S),T(null,W)}}function Wa(S){if(S.substring(0,br)!==hn)return JSON.parse(S);var T=S.substring(si),M=S.substring(br,si),L;if(M===nr&&Ua.test(T)){var I=T.match(Ua);L=I[1],T=T.substring(I[0].length)}var $=ci(T);switch(M){case ai:return $;case nr:return d([$],{type:L});case pn:return new Int8Array($);case oi:return new Uint8Array($);case Ba:return new Uint8ClampedArray($);case ar:return new Int16Array($);case ii:return new Uint16Array($);case zt:return new Int32Array($);case Ha:return new Uint32Array($);case wl:return new Float32Array($);case or:return new Float64Array($);default:throw new Error("Unkown type: "+M)}}var Ga={serialize:bl,deserialize:Wa,stringToBuffer:ci,bufferToString:di};function qa(S,T,M,L){S.executeSql("CREATE TABLE IF NOT EXISTS "+T.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],M,L)}function Zh(S){var T=this,M={db:null};if(S)for(var L in S)M[L]=typeof S[L]!="string"?S[L].toString():S[L];var I=new u(function($,W){try{M.db=openDatabase(M.name,String(M.version),M.description,M.size)}catch(q){return W(q)}M.db.transaction(function(q){qa(q,M,function(){T._dbInfo=M,$()},function(X,K){W(K)})},W)});return M.serializer=Ga,I}function ir(S,T,M,L,I,$){S.executeSql(M,L,I,function(W,q){q.code===q.SYNTAX_ERR?W.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[T.storeName],function(X,K){K.rows.length?$(X,q):qa(X,T,function(){X.executeSql(M,L,I,$)},$)},$):$(W,q)},$)}function Jh(S,T){var M=this;S=f(S);var L=new u(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){ir(q,W,"SELECT * FROM "+W.storeName+" WHERE key = ? LIMIT 1",[S],function(X,K){var J=K.rows.length?K.rows.item(0).value:null;J&&(J=W.serializer.deserialize(J)),I(J)},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function El(S,T){var M=this,L=new u(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){ir(q,W,"SELECT * FROM "+W.storeName,[],function(X,K){for(var J=K.rows,fe=J.length,Me=0;Me<fe;Me++){var ze=J.item(Me),Le=ze.value;if(Le&&(Le=W.serializer.deserialize(Le)),Le=S(Le,ze.key,Me+1),Le!==void 0){I(Le);return}}I()},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function Hn(S,T,M,L){var I=this;S=f(S);var $=new u(function(W,q){I.ready().then(function(){T===void 0&&(T=null);var X=T,K=I._dbInfo;K.serializer.serialize(T,function(J,fe){fe?q(fe):K.db.transaction(function(Me){ir(Me,K,"INSERT OR REPLACE INTO "+K.storeName+" (key, value) VALUES (?, ?)",[S,J],function(){W(X)},function(ze,Le){q(Le)})},function(Me){if(Me.code===Me.QUOTA_ERR){if(L>0){W(Hn.apply(I,[S,X,M,L-1]));return}q(Me)}})})}).catch(q)});return h($,M),$}function Va(S,T,M){return Hn.apply(this,[S,T,M,1])}function Kh(S,T){var M=this;S=f(S);var L=new u(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){ir(q,W,"DELETE FROM "+W.storeName+" WHERE key = ?",[S],function(){I()},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function Yh(S){var T=this,M=new u(function(L,I){T.ready().then(function(){var $=T._dbInfo;$.db.transaction(function(W){ir(W,$,"DELETE FROM "+$.storeName,[],function(){L()},function(q,X){I(X)})})}).catch(I)});return h(M,S),M}function O(S){var T=this,M=new u(function(L,I){T.ready().then(function(){var $=T._dbInfo;$.db.transaction(function(W){ir(W,$,"SELECT COUNT(key) as c FROM "+$.storeName,[],function(q,X){var K=X.rows.item(0).c;L(K)},function(q,X){I(X)})})}).catch(I)});return h(M,S),M}function z(S,T){var M=this,L=new u(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){ir(q,W,"SELECT key FROM "+W.storeName+" WHERE id = ? LIMIT 1",[S+1],function(X,K){var J=K.rows.length?K.rows.item(0).key:null;I(J)},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function U(S){var T=this,M=new u(function(L,I){T.ready().then(function(){var $=T._dbInfo;$.db.transaction(function(W){ir(W,$,"SELECT key FROM "+$.storeName,[],function(q,X){for(var K=[],J=0;J<X.rows.length;J++)K.push(X.rows.item(J).key);L(K)},function(q,X){I(X)})})}).catch(I)});return h(M,S),M}function V(S){return new u(function(T,M){S.transaction(function(L){L.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(I,$){for(var W=[],q=0;q<$.rows.length;q++)W.push($.rows.item(q).name);T({db:S,storeNames:W})},function(I,$){M($)})},function(L){M(L)})})}function oe(S,T){T=g.apply(this,arguments);var M=this.config();S=typeof S!="function"&&S||{},S.name||(S.name=S.name||M.name,S.storeName=S.storeName||M.storeName);var L=this,I;return S.name?I=new u(function($){var W;S.name===M.name?W=L._dbInfo.db:W=openDatabase(S.name,"","",0),S.storeName?$({db:W,storeNames:[S.storeName]}):$(V(W))}).then(function($){return new u(function(W,q){$.db.transaction(function(X){function K(ze){return new u(function(Le,tt){X.executeSql("DROP TABLE IF EXISTS "+ze,[],function(){Le()},function(qe,Ut){tt(Ut)})})}for(var J=[],fe=0,Me=$.storeNames.length;fe<Me;fe++)J.push(K($.storeNames[fe]));u.all(J).then(function(){W()}).catch(function(ze){q(ze)})},function(X){q(X)})})}):I=u.reject("Invalid arguments"),h(I,T),I}var pe={_driver:"webSQLStorage",_initStorage:Zh,_support:ni(),iterate:El,getItem:Jh,setItem:Va,removeItem:Kh,clear:Yh,length:O,key:z,keys:U,dropInstance:oe};function ge(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ie(S,T){var M=S.name+"/";return S.storeName!==T.storeName&&(M+=S.storeName+"/"),M}function de(){var S="_localforage_support_test";try{return localStorage.setItem(S,!0),localStorage.removeItem(S),!1}catch{return!0}}function ee(){return!de()||localStorage.length>0}function _e(S){var T=this,M={};if(S)for(var L in S)M[L]=S[L];return M.keyPrefix=ie(S,T._defaultConfig),ee()?(T._dbInfo=M,M.serializer=Ga,u.resolve()):u.reject()}function Ae(S){var T=this,M=T.ready().then(function(){for(var L=T._dbInfo.keyPrefix,I=localStorage.length-1;I>=0;I--){var $=localStorage.key(I);$.indexOf(L)===0&&localStorage.removeItem($)}});return h(M,S),M}function Be(S,T){var M=this;S=f(S);var L=M.ready().then(function(){var I=M._dbInfo,$=localStorage.getItem(I.keyPrefix+S);return $&&($=I.serializer.deserialize($)),$});return h(L,T),L}function Ge(S,T){var M=this,L=M.ready().then(function(){for(var I=M._dbInfo,$=I.keyPrefix,W=$.length,q=localStorage.length,X=1,K=0;K<q;K++){var J=localStorage.key(K);if(J.indexOf($)===0){var fe=localStorage.getItem(J);if(fe&&(fe=I.serializer.deserialize(fe)),fe=S(fe,J.substring(W),X++),fe!==void 0)return fe}}});return h(L,T),L}function Re(S,T){var M=this,L=M.ready().then(function(){var I=M._dbInfo,$;try{$=localStorage.key(S)}catch{$=null}return $&&($=$.substring(I.keyPrefix.length)),$});return h(L,T),L}function bt(S){var T=this,M=T.ready().then(function(){for(var L=T._dbInfo,I=localStorage.length,$=[],W=0;W<I;W++){var q=localStorage.key(W);q.indexOf(L.keyPrefix)===0&&$.push(q.substring(L.keyPrefix.length))}return $});return h(M,S),M}function Ke(S){var T=this,M=T.keys().then(function(L){return L.length});return h(M,S),M}function Wn(S,T){var M=this;S=f(S);var L=M.ready().then(function(){var I=M._dbInfo;localStorage.removeItem(I.keyPrefix+S)});return h(L,T),L}function sr(S,T,M){var L=this;S=f(S);var I=L.ready().then(function(){T===void 0&&(T=null);var $=T;return new u(function(W,q){var X=L._dbInfo;X.serializer.serialize(T,function(K,J){if(J)q(J);else try{localStorage.setItem(X.keyPrefix+S,K),W($)}catch(fe){(fe.name==="QuotaExceededError"||fe.name==="NS_ERROR_DOM_QUOTA_REACHED")&&q(fe),q(fe)}})})});return h(I,M),I}function fn(S,T){if(T=g.apply(this,arguments),S=typeof S!="function"&&S||{},!S.name){var M=this.config();S.name=S.name||M.name,S.storeName=S.storeName||M.storeName}var L=this,I;return S.name?I=new u(function($){S.storeName?$(ie(S,L._defaultConfig)):$(S.name+"/")}).then(function($){for(var W=localStorage.length-1;W>=0;W--){var q=localStorage.key(W);q.indexOf($)===0&&localStorage.removeItem(q)}}):I=u.reject("Invalid arguments"),h(I,T),I}var Er={_driver:"localStorageWrapper",_initStorage:_e,_support:ge(),iterate:Ge,getItem:Be,setItem:sr,removeItem:Wn,clear:Ae,length:Ke,key:Re,keys:bt,dropInstance:fn},ui=function(S,T){return S===T||typeof S=="number"&&typeof T=="number"&&isNaN(S)&&isNaN(T)},lr=function(S,T){for(var M=S.length,L=0;L<M;){if(ui(S[L],T))return!0;L++}return!1},Gn=Array.isArray||function(S){return Object.prototype.toString.call(S)==="[object Array]"},Sr={},qn={},Te={INDEXEDDB:gt,WEBSQL:pe,LOCALSTORAGE:Er},Et=[Te.INDEXEDDB._driver,Te.WEBSQL._driver,Te.LOCALSTORAGE._driver],xr=["dropInstance"],He=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(xr),mn={description:"",driver:Et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Sl(S,T){S[T]=function(){var M=arguments;return S.ready().then(function(){return S[T].apply(S,M)})}}function hi(){for(var S=1;S<arguments.length;S++){var T=arguments[S];if(T)for(var M in T)T.hasOwnProperty(M)&&(Gn(T[M])?arguments[0][M]=T[M].slice():arguments[0][M]=T[M])}return arguments[0]}var jN=function(){function S(T){i(this,S);for(var M in Te)if(Te.hasOwnProperty(M)){var L=Te[M],I=L._driver;this[M]=I,Sr[I]||this.defineDriver(L)}this._defaultConfig=hi({},mn),this._config=hi({},this._defaultConfig,T),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return S.prototype.config=function(T){if((typeof T>"u"?"undefined":o(T))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var M in T){if(M==="storeName"&&(T[M]=T[M].replace(/\W/g,"_")),M==="version"&&typeof T[M]!="number")return new Error("Database version must be a number.");this._config[M]=T[M]}return"driver"in T&&T.driver?this.setDriver(this._config.driver):!0}else return typeof T=="string"?this._config[T]:this._config},S.prototype.defineDriver=function(T,M,L){var I=new u(function($,W){try{var q=T._driver,X=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!T._driver){W(X);return}for(var K=He.concat("_initStorage"),J=0,fe=K.length;J<fe;J++){var Me=K[J],ze=!lr(xr,Me);if((ze||T[Me])&&typeof T[Me]!="function"){W(X);return}}var Le=function(){for(var qe=function(DN){return function(){var $N=new Error("Method "+DN+" is not implemented by the current driver"),d0=u.reject($N);return h(d0,arguments[arguments.length-1]),d0}},Ut=0,Xh=xr.length;Ut<Xh;Ut++){var Qh=xr[Ut];T[Qh]||(T[Qh]=qe(Qh))}};Le();var tt=function(qe){Sr[q]&&console.info("Redefining LocalForage driver: "+q),Sr[q]=T,qn[q]=qe,$()};"_support"in T?T._support&&typeof T._support=="function"?T._support().then(tt,W):tt(!!T._support):tt(!0)}catch(qe){W(qe)}});return p(I,M,L),I},S.prototype.driver=function(){return this._driver||null},S.prototype.getDriver=function(T,M,L){var I=Sr[T]?u.resolve(Sr[T]):u.reject(new Error("Driver not found."));return p(I,M,L),I},S.prototype.getSerializer=function(T){var M=u.resolve(Ga);return p(M,T),M},S.prototype.ready=function(T){var M=this,L=M._driverSet.then(function(){return M._ready===null&&(M._ready=M._initDriver()),M._ready});return p(L,T,T),L},S.prototype.setDriver=function(T,M,L){var I=this;Gn(T)||(T=[T]);var $=this._getSupportedDrivers(T);function W(){I._config.driver=I.driver()}function q(J){return I._extend(J),W(),I._ready=I._initStorage(I._config),I._ready}function X(J){return function(){var fe=0;function Me(){for(;fe<J.length;){var ze=J[fe];return fe++,I._dbInfo=null,I._ready=null,I.getDriver(ze).then(q).catch(Me)}W();var Le=new Error("No available storage method found.");return I._driverSet=u.reject(Le),I._driverSet}return Me()}}var K=this._driverSet!==null?this._driverSet.catch(function(){return u.resolve()}):u.resolve();return this._driverSet=K.then(function(){var J=$[0];return I._dbInfo=null,I._ready=null,I.getDriver(J).then(function(fe){I._driver=fe._driver,W(),I._wrapLibraryMethodsWithReady(),I._initDriver=X($)})}).catch(function(){W();var J=new Error("No available storage method found.");return I._driverSet=u.reject(J),I._driverSet}),p(this._driverSet,M,L),this._driverSet},S.prototype.supports=function(T){return!!qn[T]},S.prototype._extend=function(T){hi(this,T)},S.prototype._getSupportedDrivers=function(T){for(var M=[],L=0,I=T.length;L<I;L++){var $=T[L];this.supports($)&&M.push($)}return M},S.prototype._wrapLibraryMethodsWithReady=function(){for(var T=0,M=He.length;T<M;T++)Sl(this,He[T])},S.prototype.createInstance=function(T){return new S(T)},S}(),LN=new jN;n.exports=LN},{3:3}]},{},[4])(4)})}(wb)),wb.exports}var JO=ZO();const Eb=Ja(JO);class KO extends st{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,r){throw new Error("Not implemented!")}async invoke(e,r){return this.getRelevantDocuments(e,Ie(r))}async getRelevantDocuments(e,r){var o;const n=Ie(xp(r)),a=await((o=await Ot.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}))==null?void 0:o.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName));try{const i=await this._getRelevantDocuments(e,a);return await(a==null?void 0:a.handleRetrieverEnd(i)),i}catch(i){throw await(a==null?void 0:a.handleRetrieverError(i)),i}}}class Ch extends KO{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,r){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},r==null?void 0:r.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,r==null?void 0:r.getChild("vectorstore"))}async addDocuments(e,r){return this.vectorStore.addDocuments(e,r)}}class Sb extends bn{constructor(e,r){super(r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,r=4,n=void 0,a=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)).map(o=>o[0])}async similaritySearchWithScore(e,r=4,n=void 0,a=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)}static fromTexts(e,r,n,a){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,r,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,r,n,a,o,i){if(typeof e=="number")return new Ch({vectorStore:this,k:e,filter:r,tags:[...a??[],this._vectorstoreType()],metadata:o,verbose:i,callbacks:n});{const s={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Ch({...s,searchKwargs:e.searchKwargs}):new Ch({...s})}}}function YO(t,e){let r=0,n=0,a=0;for(let o=0;o<t.length;o++)r+=t[o]*e[o],n+=t[o]*t[o],a+=e[o]*e[o];return r/(Math.sqrt(n)*Math.sqrt(a))}function XO(t,e){let r=0,n=0,a=0;for(let o=0;o<t.length;o++)r+=t[o]*e[o],n+=t[o]*t[o],a+=e[o]*e[o];return r/(Math.sqrt(n)*Math.sqrt(a))}function QO(t,e,r){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(n=>e.map(a=>r(n,a)).map(a=>Number.isNaN(a)?0:a))}function xb(t,e){return QO(t,e,XO)}function eN(t,e,r=.5,n=4){if(Math.min(n,e.length)<=0)return[];const a=Array.isArray(t[0])?t:[t],o=xb(a,e)[0],i=tN(o).maxIndex,s=[e[i]],l=[i];for(;l.length<Math.min(n,e.length);){let c=-1/0,d=-1;const u=xb(e,s);o.forEach((h,p)=>{if(l.includes(p))return;const f=Math.max(...u[p]),g=r*h-(1-r)*f;g>c&&(c=g,d=p)}),s.push(e[d]),l.push(d)}return l}function tN(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],r=0;for(let n=1;n<t.length;n+=1)t[n]>e&&(r=n,e=t[n]);return{maxIndex:r,maxValue:e}}class Ca extends Sb{_vectorstoreType(){return"memory"}constructor(e,{similarity:r,...n}={}){super(e,n),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=r??YO}async addDocuments(e){const r=e.map(({pageContent:n})=>n);return this.addVectors(await this.embeddings.embedDocuments(r),e)}async addVectors(e,r){const n=e.map((a,o)=>({content:r[o].pageContent,embedding:a,metadata:r[o].metadata,id:r[o].id}));this.memoryVectors=this.memoryVectors.concat(n)}async _queryVectors(e,r,n){const a=o=>{if(!n)return!0;const i=new Sn({metadata:o.metadata,pageContent:o.content,id:o.id});return n(i)};return this.memoryVectors.filter(a).map((o,i)=>({similarity:this.similarity(e,o.embedding),index:i,metadata:o.metadata,content:o.content,embedding:o.embedding,id:o.id})).sort((o,i)=>o.similarity>i.similarity?-1:0).slice(0,r)}async similaritySearchVectorWithScore(e,r,n){return(await this._queryVectors(e,r,n)).map(a=>[new Sn({metadata:a.metadata,pageContent:a.content,id:a.id}),a.similarity])}async maxMarginalRelevanceSearch(e,r){const n=await this.embeddings.embedQuery(e),a=await this._queryVectors(n,r.fetchK??20,r.filter),o=a.map(i=>i.embedding);return eN(n,o,r.lambda,r.k).map(i=>new Sn({metadata:a[i].metadata,pageContent:a[i].content,id:a[i].id}))}static async fromTexts(e,r,n,a){const o=[];for(let i=0;i<e.length;i+=1){const s=Array.isArray(r)?r[i]:r,l=new Sn({pageContent:e[i],metadata:s});o.push(l)}return Ca.fromDocuments(o,n,a)}static async fromDocuments(e,r,n){const a=new this(r,n);return await a.addDocuments(e),a}static async fromExistingIndex(e,r){return new this(e,r)}}class zn extends Sb{_vectorstoreType(){return"voi"}constructor(e,r){super(r,{}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numDimensions",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"docstore",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.client=e,this.embeddings=r}async addDocuments(e){const r=e.map(({pageContent:o})=>o);if(e.length===0)return;const n=(await this.embeddings.embedDocuments(r.slice(0,1)))[0];if(this.numDimensions===null)this.numDimensions=n.length;else if(this.numDimensions!==n.length)throw new Error(`Vectors must have the same length as the number of dimensions (${this.numDimensions})`);const a=await this.embeddings.embedDocuments(r.slice(1));await this.addVectors([n,...a],e)}async addVectors(e,r){if(e.length===0)return;if(this.numDimensions===null&&(this.numDimensions=e[0].length),e.length!==r.length)throw new Error("Vectors and metadata must have the same length");if(!e.every(a=>a.length===this.numDimensions))throw new Error(`Vectors must have the same length as the number of dimensions (${this.numDimensions})`);e.forEach((a,o)=>{const i=r[o];this.docstore.push({embeddings:a,document:i})});const n=this.docstore.map((a,o)=>({id:String(o),embeddings:a.embeddings,title:"",url:""}));this.client.index({embeddings:n})}async similaritySearchVectorWithScore(e,r){if(this.numDimensions===null)throw new Error("There aren't any elements in the index yet.");if(e.length!==this.numDimensions)throw new Error(`Query vector must have the same length as the number of dimensions (${this.numDimensions})`);const n=Math.min(this.docstore.length,r);return n>this.docstore.length&&console.warn(`k (${r}) is greater than the number of elements in the index (${this.docstore.length}), setting k to ${n}`),this.client.search(new Float32Array(e),n).neighbors.map(({id:a},o)=>[this.docstore[parseInt(a,10)].document,o])}async delete(e){if(e.deleteAll===!0)await this.client.clear();else throw new Error('You must provide a "deleteAll" parameter.')}static async fromTexts(e,r,n,a){const o=[];for(let i=0;i<e.length;i+=1){const s=Array.isArray(r)?r[i]:r,l=new Sn({pageContent:e[i],metadata:s});o.push(l)}return zn.fromDocuments(o,n,a)}static async fromDocuments(e,r,n){const a=new zn(n,r);return await a.addDocuments(e),a}}var kb={exports:{}};sf={},bf=Object.freeze(Object.defineProperty({__proto__:null,default:sf},Symbol.toStringTag,{value:"Module"})),Lp=YN(bf);var Ab;function rN(){return Ab||(Ab=1,function(t){(function(){var e="input is invalid type",r="finalize already called",n=typeof window=="object",a=n?window:{};a.JS_MD5_NO_WINDOW&&(n=!1);var o=!n&&typeof self=="object",i=!a.JS_MD5_NO_NODE_JS&&typeof _t=="object"&&_t.versions&&_t.versions.node;i?a=gi:o&&(a=self);var s=!a.JS_MD5_NO_COMMON_JS&&!0&&t.exports,l=!a.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),d=[128,32768,8388608,-2147483648],u=[0,8,16,24],h=["hex","array","digest","buffer","arrayBuffer","base64"],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),f=[],g;if(l){var m=new ArrayBuffer(68);g=new Uint8Array(m),f=new Uint32Array(m)}var _=Array.isArray;(a.JS_MD5_NO_NODE_JS||!_)&&(_=function(x){return Object.prototype.toString.call(x)==="[object Array]"});var v=ArrayBuffer.isView;l&&(a.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!v)&&(v=function(x){return typeof x=="object"&&x.buffer&&x.buffer.constructor===ArrayBuffer});var A=function(x){var R=typeof x;if(R==="string")return[x,!0];if(R!=="object"||x===null)throw new Error(e);if(l&&x.constructor===ArrayBuffer)return[new Uint8Array(x),!1];if(!_(x)&&!v(x))throw new Error(e);return[x,!1]},F=function(x){return function(R){return new G(!0).update(R)[x]()}},b=function(){var x=F("hex");i&&(x=D(x)),x.create=function(){return new G},x.update=function(E){return x.create().update(E)};for(var R=0;R<h.length;++R){var k=h[R];x[k]=F(k)}return x},D=function(x){var R=Lp,k=XN().Buffer,E;k.from&&!a.JS_MD5_NO_BUFFER_FROM?E=k.from:E=function(N){return new k(N)};var H=function(N){if(typeof N=="string")return R.createHash("md5").update(N,"utf8").digest("hex");if(N==null)throw new Error(e);return N.constructor===ArrayBuffer&&(N=new Uint8Array(N)),_(N)||v(N)||N.constructor===k?R.createHash("md5").update(E(N)).digest("hex"):x(N)};return H},B=function(x){return function(R,k){return new te(R,!0).update(k)[x]()}},j=function(){var x=B("hex");x.create=function(E){return new te(E)},x.update=function(E,H){return x.create(E).update(H)};for(var R=0;R<h.length;++R){var k=h[R];x[k]=B(k)}return x};function G(x){if(x)f[0]=f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0,this.blocks=f,this.buffer8=g;else if(l){var R=new ArrayBuffer(68);this.buffer8=new Uint8Array(R),this.blocks=new Uint32Array(R)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}G.prototype.update=function(x){if(this.finalized)throw new Error(r);var R=A(x);x=R[0];for(var k=R[1],E,H=0,N,C=x.length,P=this.blocks,Z=this.buffer8;H<C;){if(this.hashed&&(this.hashed=!1,P[0]=P[16],P[16]=P[1]=P[2]=P[3]=P[4]=P[5]=P[6]=P[7]=P[8]=P[9]=P[10]=P[11]=P[12]=P[13]=P[14]=P[15]=0),k)if(l)for(N=this.start;H<C&&N<64;++H)E=x.charCodeAt(H),E<128?Z[N++]=E:E<2048?(Z[N++]=192|E>>>6,Z[N++]=128|E&63):E<55296||E>=57344?(Z[N++]=224|E>>>12,Z[N++]=128|E>>>6&63,Z[N++]=128|E&63):(E=65536+((E&1023)<<10|x.charCodeAt(++H)&1023),Z[N++]=240|E>>>18,Z[N++]=128|E>>>12&63,Z[N++]=128|E>>>6&63,Z[N++]=128|E&63);else for(N=this.start;H<C&&N<64;++H)E=x.charCodeAt(H),E<128?P[N>>>2]|=E<<u[N++&3]:E<2048?(P[N>>>2]|=(192|E>>>6)<<u[N++&3],P[N>>>2]|=(128|E&63)<<u[N++&3]):E<55296||E>=57344?(P[N>>>2]|=(224|E>>>12)<<u[N++&3],P[N>>>2]|=(128|E>>>6&63)<<u[N++&3],P[N>>>2]|=(128|E&63)<<u[N++&3]):(E=65536+((E&1023)<<10|x.charCodeAt(++H)&1023),P[N>>>2]|=(240|E>>>18)<<u[N++&3],P[N>>>2]|=(128|E>>>12&63)<<u[N++&3],P[N>>>2]|=(128|E>>>6&63)<<u[N++&3],P[N>>>2]|=(128|E&63)<<u[N++&3]);else if(l)for(N=this.start;H<C&&N<64;++H)Z[N++]=x[H];else for(N=this.start;H<C&&N<64;++H)P[N>>>2]|=x[H]<<u[N++&3];this.lastByteIndex=N,this.bytes+=N-this.start,N>=64?(this.start=N-64,this.hash(),this.hashed=!0):this.start=N}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},G.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var x=this.blocks,R=this.lastByteIndex;x[R>>>2]|=d[R&3],R>=56&&(this.hashed||this.hash(),x[0]=x[16],x[16]=x[1]=x[2]=x[3]=x[4]=x[5]=x[6]=x[7]=x[8]=x[9]=x[10]=x[11]=x[12]=x[13]=x[14]=x[15]=0),x[14]=this.bytes<<3,x[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},G.prototype.hash=function(){var x,R,k,E,H,N,C=this.blocks;this.first?(x=C[0]-680876937,x=(x<<7|x>>>25)-271733879<<0,E=(-1732584194^x&2004318071)+C[1]-117830708,E=(E<<12|E>>>20)+x<<0,k=(-271733879^E&(x^-271733879))+C[2]-1126478375,k=(k<<17|k>>>15)+E<<0,R=(x^k&(E^x))+C[3]-1316259209,R=(R<<22|R>>>10)+k<<0):(x=this.h0,R=this.h1,k=this.h2,E=this.h3,x+=(E^R&(k^E))+C[0]-680876936,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[1]-389564586,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[2]+606105819,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[3]-1044525330,R=(R<<22|R>>>10)+k<<0),x+=(E^R&(k^E))+C[4]-176418897,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[5]+1200080426,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[6]-1473231341,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[7]-45705983,R=(R<<22|R>>>10)+k<<0,x+=(E^R&(k^E))+C[8]+1770035416,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[9]-1958414417,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[10]-42063,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[11]-1990404162,R=(R<<22|R>>>10)+k<<0,x+=(E^R&(k^E))+C[12]+1804603682,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[13]-40341101,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[14]-1502002290,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[15]+1236535329,R=(R<<22|R>>>10)+k<<0,x+=(k^E&(R^k))+C[1]-165796510,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[6]-1069501632,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[11]+643717713,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[0]-373897302,R=(R<<20|R>>>12)+k<<0,x+=(k^E&(R^k))+C[5]-701558691,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[10]+38016083,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[15]-660478335,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[4]-405537848,R=(R<<20|R>>>12)+k<<0,x+=(k^E&(R^k))+C[9]+568446438,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[14]-1019803690,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[3]-187363961,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[8]+1163531501,R=(R<<20|R>>>12)+k<<0,x+=(k^E&(R^k))+C[13]-1444681467,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[2]-51403784,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[7]+1735328473,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[12]-1926607734,R=(R<<20|R>>>12)+k<<0,H=R^k,x+=(H^E)+C[5]-378558,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[8]-2022574463,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[11]+1839030562,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[14]-35309556,R=(R<<23|R>>>9)+k<<0,H=R^k,x+=(H^E)+C[1]-1530992060,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[4]+1272893353,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[7]-155497632,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[10]-1094730640,R=(R<<23|R>>>9)+k<<0,H=R^k,x+=(H^E)+C[13]+681279174,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[0]-358537222,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[3]-722521979,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[6]+76029189,R=(R<<23|R>>>9)+k<<0,H=R^k,x+=(H^E)+C[9]-640364487,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[12]-421815835,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[15]+530742520,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[2]-995338651,R=(R<<23|R>>>9)+k<<0,x+=(k^(R|~E))+C[0]-198630844,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[7]+1126891415,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[14]-1416354905,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[5]-57434055,R=(R<<21|R>>>11)+k<<0,x+=(k^(R|~E))+C[12]+1700485571,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[3]-1894986606,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[10]-1051523,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[1]-2054922799,R=(R<<21|R>>>11)+k<<0,x+=(k^(R|~E))+C[8]+1873313359,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[15]-30611744,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[6]-1560198380,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[13]+1309151649,R=(R<<21|R>>>11)+k<<0,x+=(k^(R|~E))+C[4]-145523070,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[11]-1120210379,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[2]+718787259,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[9]-343485551,R=(R<<21|R>>>11)+k<<0,this.first?(this.h0=x+1732584193<<0,this.h1=R-271733879<<0,this.h2=k-1732584194<<0,this.h3=E+271733878<<0,this.first=!1):(this.h0=this.h0+x<<0,this.h1=this.h1+R<<0,this.h2=this.h2+k<<0,this.h3=this.h3+E<<0)},G.prototype.hex=function(){this.finalize();var x=this.h0,R=this.h1,k=this.h2,E=this.h3;return c[x>>>4&15]+c[x&15]+c[x>>>12&15]+c[x>>>8&15]+c[x>>>20&15]+c[x>>>16&15]+c[x>>>28&15]+c[x>>>24&15]+c[R>>>4&15]+c[R&15]+c[R>>>12&15]+c[R>>>8&15]+c[R>>>20&15]+c[R>>>16&15]+c[R>>>28&15]+c[R>>>24&15]+c[k>>>4&15]+c[k&15]+c[k>>>12&15]+c[k>>>8&15]+c[k>>>20&15]+c[k>>>16&15]+c[k>>>28&15]+c[k>>>24&15]+c[E>>>4&15]+c[E&15]+c[E>>>12&15]+c[E>>>8&15]+c[E>>>20&15]+c[E>>>16&15]+c[E>>>28&15]+c[E>>>24&15]},G.prototype.toString=G.prototype.hex,G.prototype.digest=function(){this.finalize();var x=this.h0,R=this.h1,k=this.h2,E=this.h3;return[x&255,x>>>8&255,x>>>16&255,x>>>24&255,R&255,R>>>8&255,R>>>16&255,R>>>24&255,k&255,k>>>8&255,k>>>16&255,k>>>24&255,E&255,E>>>8&255,E>>>16&255,E>>>24&255]},G.prototype.array=G.prototype.digest,G.prototype.arrayBuffer=function(){this.finalize();var x=new ArrayBuffer(16),R=new Uint32Array(x);return R[0]=this.h0,R[1]=this.h1,R[2]=this.h2,R[3]=this.h3,x},G.prototype.buffer=G.prototype.arrayBuffer,G.prototype.base64=function(){for(var x,R,k,E="",H=this.array(),N=0;N<15;)x=H[N++],R=H[N++],k=H[N++],E+=p[x>>>2]+p[(x<<4|R>>>4)&63]+p[(R<<2|k>>>6)&63]+p[k&63];return x=H[N],E+=p[x>>>2]+p[x<<4&63]+"==",E};function te(x,R){var k,E=A(x);if(x=E[0],E[1]){var H=[],N=x.length,C=0,P;for(k=0;k<N;++k)P=x.charCodeAt(k),P<128?H[C++]=P:P<2048?(H[C++]=192|P>>>6,H[C++]=128|P&63):P<55296||P>=57344?(H[C++]=224|P>>>12,H[C++]=128|P>>>6&63,H[C++]=128|P&63):(P=65536+((P&1023)<<10|x.charCodeAt(++k)&1023),H[C++]=240|P>>>18,H[C++]=128|P>>>12&63,H[C++]=128|P>>>6&63,H[C++]=128|P&63);x=H}x.length>64&&(x=new G(!0).update(x).array());var Z=[],ne=[];for(k=0;k<64;++k){var le=x[k]||0;Z[k]=92^le,ne[k]=54^le}G.call(this,R),this.update(ne),this.oKeyPad=Z,this.inner=!0,this.sharedMemory=R}te.prototype=new G,te.prototype.finalize=function(){if(G.prototype.finalize.call(this),this.inner){this.inner=!1;var x=this.array();G.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(x),G.prototype.finalize.call(this)}};var ue=b();ue.md5=ue,ue.md5.hmac=j(),s?t.exports=ue:a.md5=ue})()}(kb)),kb.exports}var nN=rN();let Xo,ja,Qo,jh,ei;xi=t=>t?t.join("|\u294A|"):"",ki=t=>t?t.split("|\u294A|"):[],Xo=t=>t?t.join("|\u294C|"):"",Mi=t=>t?t.split("|\u294C|"):[],x0=(t,e)=>({headers:xi(t),data:Xo(e.map(r=>xi(r)))}),af=(t,e)=>{const r=ki(t),n=Mi(e).reduce((a,o)=>{const i=ki(o);return i.length===r.length?[...a,r.reduce((s,l,c)=>({...s,[l]:i[c]}),{})]:a},[]);return{headers:r,rows:n}},ja=async({provider:t,storedData:e,databaseName:r})=>{switch(t){case"voy":return e.map((n,a)=>{var o,i;return{id:n.id||((o=n.metadata)==null?void 0:o.id)||a,title:JSON.stringify({pageContent:n.content,metadata:n.metadata}),url:`/${r}/items/${n.id||((i=n.metadata)==null?void 0:i.id)||a}`,embeddings:n.embedding}});case"memory":return e.map((n,a)=>{var o;return{content:n.content,embedding:n.embedding,metadata:n.metadata,id:n.id||((o=n.metadata)==null?void 0:o.id)||a}});default:throw new Error("Invalid provider")}},Qo=async({storageType:t,provider:e,databaseName:r,storageService:n,storageDataNode:a})=>{switch(t){case Br.DataNode:{if(!a)throw new Error("Storage data node not found");if("csv"in a){const{rows:o}=af((a==null?void 0:a.headers)||"",(a==null?void 0:a.csv)||"");return ja({provider:e,storedData:o,databaseName:r})}return"json"in a?ja({provider:e,storedData:JSON.parse((a==null?void 0:a.json)||"[]"),databaseName:r}):"jsonl"in a?ja({provider:e,storedData:Mi(a==null?void 0:a.jsonl).map(o=>JSON.parse(o)),databaseName:r}):[]}case Br.DatabaseNode:return ja({provider:e,storedData:Mi(a==null?void 0:a.raw).map(o=>JSON.parse(o)),databaseName:r});case Br.IndexedDB:{const o=await(n==null?void 0:n.getItem(r));return o?ja({provider:e,storedData:o,databaseName:r}):[]}default:throw new Error("Invalid storage type")}},jh=async({docstore:t,storageType:e,databaseName:r,embeddingStorage:n,storageDataNode:a})=>{const o=t.map(i=>"embedding"in i?{id:i.id,embedding:i.embedding,content:i.content,metadata:i.metadata}:{id:i.document.metadata.id,content:i.document.pageContent,metadata:i.document.metadata,embedding:i.embeddings});switch(e){case Br.DataNode:{if(a=a,!a)throw new Error("Storage data node not found");const i=of(a);i==="CSVData"&&await We(i).update(a.id,{csv:Xo(o.map(s=>{const l=ki(a.headers).map(c=>s[c]);return xi(l)}))}),i==="JSONData"&&await We(i).update(a.id,{json:JSON.stringify(o)}),i==="JSONLData"&&await We(i).update(a.id,{jsonl:Xo(o.map(s=>JSON.stringify(s)))})}break;case Br.DatabaseNode:{const i=a;await We("VectorDatabase").update(i.id,{raw:Xo(o.map(s=>JSON.stringify(s)))})}break;case Br.IndexedDB:await n.setItem(r,o);break}return o},of=t=>"csv"in t?"CSVData":"json"in t?"JSONData":"jsonl"in t?"JSONLData":void 0,ei=t=>nN.md5(t),Dp="nomic-ai/nomic-embed-text-v1.5",zp=class{constructor(t){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Ai(t??{})}},Up=(t,e)=>t.reduce((r,n,a)=>{const o=Math.floor(a/e),i=r[o]||[];return r[o]=i.concat([n]),r},[]);class aN extends zp{constructor(r){super(r??{});ae(this,"worker");ae(this,"EMBEDDING_LOAD_MESSAGE_ID","EMBEDDING_LOAD_MESSAGE_ID");ae(this,"ready",!1);ae(this,"timeout");ae(this,"stripNewLines",!0);ae(this,"modelName","Xenova/all-MiniLM-L6-v2");ae(this,"model","Xenova/all-MiniLM-L6-v2");ae(this,"batchSize",512);ae(this,"pretrainedOptions");ae(this,"pipelineOptions");ae(this,"refProcesses",new Map);ae(this,"initWorker",()=>{Nn(this.worker,"load",this.EMBEDDING_LOAD_MESSAGE_ID,[this.model,this.pretrainedOptions]),this.worker.removeEventListener("message",this.handleMessages),this.worker.addEventListener("message",this.handleMessages);const r=ha();return this.refProcesses.set(this.EMBEDDING_LOAD_MESSAGE_ID,[r.promise,r.resolve,r.reject]),r.promise});ae(this,"handleMessages",r=>{const n=r.data.messageId;if(n!==yy)if(r.data.type==="complete"||r.data.type==="error"){const[,a,o]=this.refProcesses.get(n)||[];r.data.type==="complete"?a==null||a(r.data.payload):o==null||o(new Error(JSON.stringify(r.data.payload))),n===this.EMBEDDING_LOAD_MESSAGE_ID&&(this.ready=!!r.data.payload),this.refProcesses.delete(n)}else r.data.type==="started"||r.data.type==="inprogress"||yn("Unknown message type",r.data)});ae(this,"runEmbedding",async r=>{if(!this.worker)throw new Error("MISSING WORKER");const n=this.refProcesses.get(this.EMBEDDING_LOAD_MESSAGE_ID);if(n!=null&&n[0]&&await(n==null?void 0:n[0]),!this.ready)throw new Error("WORKER NOT READY YET");return this.caller.call(async()=>{const a=Ur(),o=ha(()=>{Nn(this.worker,"embedding",a,[r,this.pipelineOptions])});return this.refProcesses.set(a,[o.promise,o.resolve,o.reject]),o.promise.then(i=>i)})});this.worker=r.worker,this.modelName=(r==null?void 0:r.model)??(r==null?void 0:r.modelName)??this.model,this.model=this.modelName,this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.pretrainedOptions=(r==null?void 0:r.pretrainedOptions)??{},this.pipelineOptions={pooling:"mean",normalize:!0,...r==null?void 0:r.pipelineOptions},this.initWorker()}async embedDocuments(r){const n=Up(this.stripNewLines?r.map(i=>i.replace(/\n/g," ")):r,this.batchSize).map(i=>this.runEmbedding(i)),a=await Promise.all(n),o=[];for(let i=0;i<a.length;i+=1){const s=a[i];for(let l=0;l<s.length;l+=1)o.push(s[l])}return o}async embedQuery(r){return(await this.runEmbedding([this.stripNewLines?r.replace(/\n/g," "):r]))[0]}}let Tb,Mb,Fb,Rb,Lh,ti;Tb=()=>new Worker(new URL("/NoLLMChat/assets/embedding.worker-3Fs0X7iO.js",import.meta.url),{type:"module"}),Mb=(t,e)=>{var r;try{const n=JSON.parse(t.metadata||"{}");if(!(n!=null&&n.textSplitter))return e;switch((r=n==null?void 0:n.textSplitter)==null?void 0:r.type){case"TokenTextSplitter":return new oO({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);case"CharacterTextSplitter":return new aO({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);case"RecursiveCharacterTextSplitter":return new ll({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);default:throw new Error("Invalid text splitter")}}catch{return e}},Fb=(t,e)=>({destroy:()=>{try{const r=e().worker;r&&r.terminate(),t({localEmbedding:void 0,embeddingStorage:void 0,worker:void 0})}catch(r){yn("Destroy Local Embedding Thread",r)}},init:async()=>{try{const r=e().worker;r&&r.terminate();const n=Tb(),a=new aN({modelName:Dp,worker:n}),o=Eb.createInstance({name:"vector-database",driver:Eb.INDEXEDDB,storeName:"main"});t({worker:n,localEmbedding:a,embeddingStorage:o})}catch(r){yn("Init Local Embedding Thread",r)}finally{t({ready:!0})}},index:async(r,n)=>{const a=(r==null?void 0:r.embedding)||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await Mb(i,n),d=await Qo({databaseName:l,storageType:i.storage||"IndexedDB",provider:i.provider,storageService:o,storageDataNode:i||s});switch(i.provider){case dr.Voy:{const u=new un({embeddings:d}),h=new zn(u,a);await h.addDocuments(c),await jh({databaseName:l,provider:i.provider,embeddingStorage:o,docstore:h.docstore,storageType:i.storage||"IndexedDB",storageDataNode:s||i})}break;case dr.Memory:{const u=new Ca(a);u.memoryVectors=d,await u.addDocuments(c),await jh({databaseName:l,provider:i.provider,embeddingStorage:o,docstore:u.memoryVectors,storageType:i.storage||"IndexedDB",storageDataNode:s||i})}break}},getVectorDatabase:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await Qo({databaseName:l,storageType:i.storage||"IndexedDB",provider:i.provider,storageService:e().embeddingStorage,storageDataNode:s});switch(i.provider){case dr.Voy:{const d=new un({embeddings:c});return new zn(d,a)}case dr.Memory:{const d=new Ca(a,n);return d.memoryVectors=c,d}default:throw new Error("Invalid provider")}},similaritySearch:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i||!i.provider)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await Qo({databaseName:l,storageDataNode:s||i,provider:i.provider,storageService:o,storageType:i.storage||"IndexedDB"});switch(i.provider){case dr.Voy:{const d=new un({embeddings:c});return await new zn(d,a).similaritySearch(...n)}case dr.Memory:{const d=new Ca(a);return d.memoryVectors=c,await d.similaritySearch(...n)}default:throw new Error("Invalid provider")}},similaritySearchWithScore:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i||!i.provider)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await Qo({databaseName:l,provider:i.provider,storageDataNode:s||i,storageService:o,storageType:i.storage||"IndexedDB"});switch(i.provider){case dr.Voy:{const d=new un({embeddings:c});return await new zn(d,a).similaritySearchWithScore(...n)}case dr.Memory:{const d=new Ca(a);return d.memoryVectors=c,await d.similaritySearchWithScore(...n)}default:throw new Error("Invalid provider")}}}),Rb={ready:!1,localEmbedding:void 0,embeddingStorage:void 0,worker:void 0},$l=Al()(Tl((t,e)=>({...Rb,...Fb(t,e)}))),Lh=t=>typeof t=="string"?t:t instanceof to?{instanceof:"HumanMessage",item:t,content:t.content}:t instanceof Zn?{instanceof:"AIMessage",item:t,content:t.content}:t instanceof ao?{instanceof:"SystemMessage",item:t,content:t.content}:t,ti=t=>Array.isArray(t)?t.map(Lh):Lh(t);async function*Ob(t,e,r,n){for(;;){const o=r.get(e);if(o){const{processInfo:i}=o;if(i&&typeof i=="object"&&"data"in i&&"lastIndex"in i&&Array.isArray(i.data)){const s=n!=null&&n.lastChunkOnly?i.data[i.data.length-1]:i.data.slice(+`${i.lastIndex}`);s&&(!Array.isArray(s)||s!=null&&s.length)&&(i.lastIndex=n!=null&&n.lastChunkOnly?i.data.length-1:i.data.length>0?i.data.length:0,yield s)}await new Promise(s=>setTimeout(s,(n==null?void 0:n.interval)||150))}else break}const a=await t;return yield a,a}const oN=()=>new Worker(new URL("/NoLLMChat/assets/webllm.worker-D3HEbPi2.js",import.meta.url),{type:"module"}),iN=(t,e)=>r=>{_y(r,t().refProcesses,{onWorkerInit:()=>e({ready:!0})})};async function sN(t,...e){const r=t.worker,n=t.refProcesses;if(!r)throw new Error("Worker not initialized");const a=ha(()=>{Nn(r,"load",t.messageId,e)});return n.set(t.messageId,{promise:a.promise,resolve:a.resolve,reject:a.reject,processInfo:{type:"load",data:[],lastIndex:0}}),Ob(a.promise,t.messageId,n,{lastChunkOnly:!0})}let Nb,Ib,Dh,$h,La,ml,Pb,Cb,jb,Lb,Db,$b,zb,Ub,Bb,Hb,zh;Nb=(t,e)=>({setInitializing:r=>{const n=e().initializing;t({initializing:{...n,...r}})},setSelectedModel:r=>{t({selectedModel:r})},destroy:()=>{try{const r=e().handler,n=e().worker;n&&(r&&n.removeEventListener("message",r),n.terminate()),t({handler:void 0,worker:void 0})}catch(r){yn("Destroy Local LLM thread",r)}},init:()=>{try{const r=e().handler,n=e().worker;n&&(r&&n.removeEventListener("message",r),n.terminate());const a=oN(),o=iN(e,t);a.addEventListener("message",o),t({handler:o,worker:a})}catch(r){yn("Init Local LLM Thread",r)}},syncCachedLLMURLs:async()=>caches.open("webllm/config").then(async r=>r.keys()).then(r=>{const n=r.map(a=>a.url);return t({cachedLLMURLs:n}),n}),loadModel:async(r,{callback:n})=>{let a=e().currentLoadModelMessageId;const o=e().worker,i=e().initProgressCallbacks,s=e().initializing,l=e().refProcesses;if(a){const d=l.get(a);if(d){const{reject:u}=d;u==null||u("stop"),l.delete(a)}}a=Ur(),t({currentLoadModelMessageId:Ur(),selectedModel:r,initializing:{...s,loading:!0}});const c=await sN({messageId:a,worker:o,refProcesses:l},{model:r});for await(const d of c)d&&(i.forEach(u=>u(d)),n==null||n(d));setTimeout(()=>{i.forEach(d=>d({progress:100,timeElapsed:1,text:`Model ${r} loaded.`})),t({initializing:{...e().initializing,loading:!1}})},100)},unLoadModel:()=>{const r=e().worker,n=e().refProcesses,a=e().currentLoadModelMessageId;if(a){const o=n.get(a);if(o){const{reject:i}=o;i==null||i("stop"),n.delete(a)}}r&&Nn(r,"unload",Ur(),[]),t({selectedModel:void 0})},setInitProgressCallback:r=>{const n=e().initProgressCallbacks;return n.push(r),t({initProgressCallbacks:n}),()=>{t({initProgressCallbacks:e().initProgressCallbacks.filter(a=>a!==r)})}},chatCompletion:(r,n)=>{const a=e().refProcesses,o=e().worker;if(!o)throw new Error("Worker not initialized");const i=Ur(),{provider:s,stream:l=!0,response_format:c,tools:d,...u}=n;let h,p;(c==null?void 0:c.type)==="json_object"?(h="structured-stream",p=[c.schema,ti(r),{provider:s,...u}]):d!=null&&d.length?(h="tools-calling-stream",p=[d.map(g=>({name:g.function.name,description:g.function.description,schema:g.function.parameters})),ti(r),{provider:s,...u}]):(h=l?"stream":"invoke",p=l?[ti(r),{provider:s,...u}]:[ti(r),{provider:s,...u}]);const f=ha(()=>{Nn(o,h,i,p)});if(a.set(i,{promise:f.promise,resolve:f.resolve,reject:f.reject,processInfo:{type:"invoke",data:[],lastIndex:0}}),l){const g=f.promise;return Ob(g,i,a)}else return f.promise},getCurrentModelInfo:async()=>{const r=e().refProcesses,n=e().worker;if(!n)throw new Error("Worker not initialized");const a=Ur(),o=ha(()=>{Nn(n,"get-current-model-info",a,[])});return r.set(a,{promise:o.promise,resolve:o.resolve,reject:o.reject,processInfo:{type:"get-current-model-info",data:[],lastIndex:0}}),o.promise}}),Ib={cachedLLMURLs:[],ready:!1,initializing:{worker:!0,init:!0,loading:!1},selectedModel:"",refProcesses:new Map,currentLoadModelMessageId:void 0,handler:void 0,initProgressCallbacks:[],worker:void 0},Gl=Al()(Tl((t,e)=>({...Ib,...Nb(t,e)}))),Dh=1,$h={erro_evt:{name:"erro_evt",structName:"glue_msg_error",className:"GlueMsgError",fields:[{type:"str",name:"message",isNullable:!1}]},load_req:{name:"load_req",structName:"glue_msg_load_req",className:"GlueMsgLoadReq",fields:[{type:"arr_str",name:"model_paths",isNullable:!1},{type:"bool",name:"n_ctx_auto",isNullable:!1},{type:"bool",name:"use_mmap",isNullable:!1},{type:"bool",name:"use_mlock",isNullable:!1},{type:"int",name:"n_gpu_layers",isNullable:!1},{type:"int",name:"seed",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_threads",isNullable:!1},{type:"bool",name:"embeddings",isNullable:!0},{type:"bool",name:"offload_kqv",isNullable:!0},{type:"int",name:"n_batch",isNullable:!0},{type:"int",name:"n_seq_max",isNullable:!0},{type:"str",name:"pooling_type",isNullable:!0},{type:"str",name:"rope_scaling_type",isNullable:!0},{type:"float",name:"rope_freq_base",isNullable:!0},{type:"float",name:"rope_freq_scale",isNullable:!0},{type:"float",name:"yarn_ext_factor",isNullable:!0},{type:"float",name:"yarn_attn_factor",isNullable:!0},{type:"float",name:"yarn_beta_fast",isNullable:!0},{type:"float",name:"yarn_beta_slow",isNullable:!0},{type:"int",name:"yarn_orig_ctx",isNullable:!0},{type:"str",name:"cache_type_k",isNullable:!0},{type:"str",name:"cache_type_v",isNullable:!0}]},load_res:{name:"load_res",structName:"glue_msg_load_res",className:"GlueMsgLoadRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_batch",isNullable:!1},{type:"int",name:"n_ubatch",isNullable:!1},{type:"int",name:"n_vocab",isNullable:!1},{type:"int",name:"n_ctx_train",isNullable:!1},{type:"int",name:"n_embd",isNullable:!1},{type:"int",name:"n_layer",isNullable:!1},{type:"arr_str",name:"metadata_key",isNullable:!1},{type:"arr_str",name:"metadata_val",isNullable:!1},{type:"int",name:"token_bos",isNullable:!1},{type:"int",name:"token_eos",isNullable:!1},{type:"int",name:"token_eot",isNullable:!1},{type:"arr_int",name:"list_tokens_eog",isNullable:!1},{type:"bool",name:"add_bos_token",isNullable:!1},{type:"bool",name:"add_eos_token",isNullable:!1},{type:"bool",name:"has_encoder",isNullable:!1},{type:"int",name:"token_decoder_start",isNullable:!1}]},opti_req:{name:"opti_req",structName:"glue_msg_set_options_req",className:"GlueMsgSetOptionsReq",fields:[{type:"bool",name:"embeddings",isNullable:!1}]},opti_res:{name:"opti_res",structName:"glue_msg_set_options_res",className:"GlueMsgSetOptionsRes",fields:[{type:"bool",name:"success",isNullable:!1}]},sint_req:{name:"sint_req",structName:"glue_msg_sampling_init_req",className:"GlueMsgSamplingInitReq",fields:[{type:"int",name:"mirostat",isNullable:!0},{type:"float",name:"mirostat_tau",isNullable:!0},{type:"float",name:"mirostat_eta",isNullable:!0},{type:"float",name:"temp",isNullable:!0},{type:"float",name:"top_p",isNullable:!0},{type:"int",name:"top_k",isNullable:!0},{type:"int",name:"penalty_last_n",isNullable:!0},{type:"float",name:"penalty_repeat",isNullable:!0},{type:"float",name:"penalty_freq",isNullable:!0},{type:"float",name:"penalty_present",isNullable:!0},{type:"float",name:"dynatemp_range",isNullable:!0},{type:"float",name:"dynatemp_exponent",isNullable:!0},{type:"arr_str",name:"samplers_sequence",isNullable:!0},{type:"str",name:"grammar",isNullable:!0},{type:"int",name:"n_prev",isNullable:!0},{type:"int",name:"n_probs",isNullable:!0},{type:"float",name:"min_p",isNullable:!0},{type:"float",name:"typical_p",isNullable:!0},{type:"float",name:"typ_p",isNullable:!0},{type:"arr_int",name:"logit_bias_toks",isNullable:!0},{type:"arr_float",name:"logit_bias_vals",isNullable:!0},{type:"arr_int",name:"tokens",isNullable:!0}]},sint_res:{name:"sint_res",structName:"glue_msg_sampling_init_res",className:"GlueMsgSamplingInitRes",fields:[{type:"bool",name:"success",isNullable:!1}]},gvoc_req:{name:"gvoc_req",structName:"glue_msg_get_vocab_req",className:"GlueMsgGetVocabReq",fields:[]},gvoc_res:{name:"gvoc_res",structName:"glue_msg_get_vocab_res",className:"GlueMsgGetVocabRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_raw",name:"vocab",isNullable:!1}]},lkup_req:{name:"lkup_req",structName:"glue_msg_lookup_token_req",className:"GlueMsgLookupTokenReq",fields:[{type:"str",name:"piece",isNullable:!1}]},lkup_res:{name:"lkup_res",structName:"glue_msg_lookup_token_res",className:"GlueMsgLookupTokenRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},tokn_req:{name:"tokn_req",structName:"glue_msg_tokenize_req",className:"GlueMsgTokenizeReq",fields:[{type:"str",name:"text",isNullable:!1},{type:"bool",name:"special",isNullable:!1}]},tokn_res:{name:"tokn_res",structName:"glue_msg_tokenize_res",className:"GlueMsgTokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_req:{name:"dtkn_req",structName:"glue_msg_detokenize_req",className:"GlueMsgDetokenizeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_res:{name:"dtkn_res",structName:"glue_msg_detokenize_res",className:"GlueMsgDetokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"buffer",isNullable:!1}]},deco_req:{name:"deco_req",structName:"glue_msg_decode_req",className:"GlueMsgDecodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1},{type:"bool",name:"skip_logits",isNullable:!1}]},deco_res:{name:"deco_res",structName:"glue_msg_decode_res",className:"GlueMsgDecodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},enco_req:{name:"enco_req",structName:"glue_msg_encode_req",className:"GlueMsgEncodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},enco_res:{name:"enco_res",structName:"glue_msg_encode_res",className:"GlueMsgEncodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},ssam_req:{name:"ssam_req",structName:"glue_msg_sampling_sample_req",className:"GlueMsgSamplingSampleReq",fields:[]},ssam_res:{name:"ssam_res",structName:"glue_msg_sampling_sample_res",className:"GlueMsgSamplingSampleRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"piece",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},sacc_req:{name:"sacc_req",structName:"glue_msg_sampling_accept_req",className:"GlueMsgSamplingAcceptReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},sacc_res:{name:"sacc_res",structName:"glue_msg_sampling_accept_res",className:"GlueMsgSamplingAcceptRes",fields:[{type:"bool",name:"success",isNullable:!1}]},glog_req:{name:"glog_req",structName:"glue_msg_get_logits_req",className:"GlueMsgGetLogitsReq",fields:[{type:"int",name:"top_k",isNullable:!1}]},glog_res:{name:"glog_res",structName:"glue_msg_get_logits_res",className:"GlueMsgGetLogitsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1},{type:"arr_float",name:"probs",isNullable:!1}]},gemb_req:{name:"gemb_req",structName:"glue_msg_get_embeddings_req",className:"GlueMsgGetEmbeddingsReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},gemb_res:{name:"gemb_res",structName:"glue_msg_get_embeddings_res",className:"GlueMsgGetEmbeddingsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"arr_float",name:"embeddings",isNullable:!1}]},kvcr_req:{name:"kvcr_req",structName:"glue_msg_get_kv_remove_req",className:"GlueMsgGetKvRemoveReq",fields:[{type:"int",name:"n_keep",isNullable:!1},{type:"int",name:"n_discard",isNullable:!1}]},kvcr_res:{name:"kvcr_res",structName:"glue_msg_get_kv_remove_res",className:"GlueMsgGetKvRemoveRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},kvcc_req:{name:"kvcc_req",structName:"glue_msg_get_kv_clear_req",className:"GlueMsgGetKvClearReq",fields:[]},kvcc_res:{name:"kvcc_res",structName:"glue_msg_get_kv_clear_res",className:"GlueMsgGetKvClearRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},sesa_req:{name:"sesa_req",structName:"glue_msg_session_save_req",className:"GlueMsgSessionSaveReq",fields:[{type:"str",name:"session_path",isNullable:!1}]},sesa_res:{name:"sesa_res",structName:"glue_msg_session_save_res",className:"GlueMsgSessionSaveRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_req:{name:"sesl_req",structName:"glue_msg_session_load_req",className:"GlueMsgSessionLoadReq",fields:[{type:"str",name:"session_path",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_res:{name:"sesl_res",structName:"glue_msg_session_load_res",className:"GlueMsgSessionLoadRes",fields:[{type:"bool",name:"success",isNullable:!1}]},stat_req:{name:"stat_req",structName:"glue_msg_status_req",className:"GlueMsgStatusReq",fields:[]},stat_res:{name:"stat_res",structName:"glue_msg_status_res",className:"GlueMsgStatusRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},tben_req:{name:"tben_req",structName:"glue_msg_test_benchmark_req",className:"GlueMsgTestBenchmarkReq",fields:[{type:"str",name:"type",isNullable:!1},{type:"int",name:"n_samples",isNullable:!1}]},tben_res:{name:"tben_res",structName:"glue_msg_test_benchmark_res",className:"GlueMsgTestBenchmarkRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},tper_req:{name:"tper_req",structName:"glue_msg_test_perplexity_req",className:"GlueMsgTestPerplexityReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},tper_res:{name:"tper_res",structName:"glue_msg_test_perplexity_res",className:"GlueMsgTestPerplexityRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"float",name:"ppl",isNullable:!1},{type:"float",name:"nll",isNullable:!1},{type:"float",name:"cross_entropy",isNullable:!1},{type:"int",name:"n_tokens",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},cfmt_req:{name:"cfmt_req",structName:"glue_msg_chat_format_req",className:"GlueMsgChatFormatReq",fields:[{type:"str",name:"tmpl",isNullable:!0},{type:"bool",name:"add_ass",isNullable:!0},{type:"arr_str",name:"roles",isNullable:!1},{type:"arr_str",name:"contents",isNullable:!1}]},cfmt_res:{name:"cfmt_res",structName:"glue_msg_chat_format_res",className:"GlueMsgChatFormatRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"str",name:"formatted_chat",isNullable:!1}]}},La=new Uint8Array([71,76,85,69]),ml=0,Pb=1,Cb=2,jb=3,Lb=4,Db=5,$b=6,zb=7,Ub=8,Bb=9,Hb=10,zh={str:Lb,int:Cb,float:jb,bool:Pb,raw:Db,arr_str:Bb,arr_int:zb,arr_float:Ub,arr_bool:$b,arr_raw:Hb,null:ml};function lN(t){let e=0;const r=new DataView(t.buffer),n=()=>{const m=r.getUint32(e,!0);return e+=4,m},a=()=>{const m=r.getInt32(e,!0);return e+=4,m},o=()=>{const m=r.getFloat32(e,!0);return e+=4,m},i=()=>n()!==0,s=m=>{const _=m??n(),v=new TextDecoder().decode(t.slice(e,e+_));return e+=_,v},l=()=>{const m=n(),_=t.slice(e,e+m);return e+=m,_},c=m=>{const _=n(),v=new Array(_);for(let A=0;A<_;A++)v[A]=m();return v},d=()=>null,u=m=>{switch(m.type){case"str":return s();case"int":return a();case"float":return o();case"bool":return i();case"raw":return l();case"arr_str":return c(s);case"arr_int":return c(a);case"arr_float":return c(o);case"arr_bool":return c(i);case"arr_raw":return c(l);case"null":return d()}},h=t[0]===La[0]&&t[1]===La[1]&&t[2]===La[2]&&t[3]===La[3];if(e+=4,!h)throw new Error("Invalid magic number");if(n()!==Dh)throw new Error("Invalid version number");const p=s(8),f=$h[p];if(!f)throw new Error(`Unknown message name: ${p}`);const g={_name:p};for(const m of f.fields){const _=n();if(_===ml){if(!m.isNullable)throw new Error(`${p}: Expect field ${m.name} to be non-nullable`);g[m.name]=null;continue}if(_!==zh[m.type])throw new Error(`${p}: Expect field ${m.name} to have type ${m.type}`);g[m.name]=u(m)}return g}function cN(t){const e=$h[t._name];if(!e)throw new Error(`Unknown message name: ${t._name}`);const r=[],n=p=>{const f=new ArrayBuffer(4);new DataView(f).setUint32(0,p,!0),r.push(new Uint8Array(f))},a=p=>{const f=new ArrayBuffer(4);new DataView(f).setInt32(0,p,!0),r.push(new Uint8Array(f))},o=p=>{const f=new ArrayBuffer(4);new DataView(f).setFloat32(0,p,!0),r.push(new Uint8Array(f))},i=p=>{n(p?1:0)},s=p=>{const f=new TextEncoder().encode(p);n(f.byteLength),r.push(f)},l=p=>{n(p.byteLength),r.push(p)},c=(p,f)=>{n(p.length);for(const g of p)f(g)};r.push(La),n(Dh);{const p=new TextEncoder().encode(t._name);r.push(p)}for(const p of e.fields){const f=t[p.name];if(!p.isNullable&&f==null)throw new Error(`${t._name}: Expect field ${p.name} to be non-nullable`);if(f==null){n(ml);continue}switch(n(zh[p.type]),p.type){case"str":s(f);break;case"int":a(f);break;case"float":o(f);break;case"bool":i(f);break;case"raw":l(f);break;case"arr_str":c(f,s);break;case"arr_int":c(f,a);break;case"arr_float":c(f,o);break;case"arr_bool":c(f,i);break;case"arr_raw":c(f,l);break}}const d=r.reduce((p,f)=>p+f.byteLength,0),u=new Uint8Array(d);let h=0;for(const p of r)u.set(p,h),h+=p.byteLength;return u}let Wb,Gb,gl,Uh,Bh,qb,Hh,yl,Wh,Vb,Zb,Jb,Kb,Yb,Gh,_l,Xb,Qb,qh,e0,t0;Wb=t=>{const e=t.reduce((n,a)=>n+a.length,0),r=new Uint8Array(e);r.set(t[0],0);for(let n=1;n<t.length;n++)r.set(t[n],t[n-1].length);return r},Gb=new TextDecoder,gl=t=>Gb.decode(t),Uh=/-(\d{5})-of-(\d{5})\.gguf(?:\?.*)?$/,Bh=t=>{const e=t.match(Uh);return e?{baseURL:t.replace(Uh,""),current:parseInt(e[1]),total:parseInt(e[2])}:{baseURL:t,current:1,total:1}},qb=t=>{t.every(e=>!!e.name)&&t.length>1&&t.sort((e,r)=>{const n=Bh(e.name),a=Bh(r.name);return n.current-a.current})},Hh=t=>new URL(t,document.baseURI).href,yl=t=>t.reduce((e,r)=>e+r,0),Wh=t=>!!(t!=null&&t.startsWith),Vb=()=>(async t=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(t)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),Zb=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),Jb=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),Kb=async()=>{if(!await Zb())throw new Error("WebAssembly runtime does not support exception handling");if(!await Jb())throw new Error("WebAssembly runtime does not support SIMD")},Yb=/^.*\.gguf(?:\?.*)?$/,hc=t=>Yb.test(t),Gh=()=>!!navigator.userAgent.match(/Version\/([0-9\._]+).*Mobile.*Safari.*/),_l=t=>{const e=URL.createObjectURL(Wh(t)?new Blob([t],{type:"text/javascript"}):t);return new Worker(e,{type:"module"})},Xb=t=>(...e)=>{let r=[],n;return r.push(new Promise(a=>{n=a})),t(...e,(a,o)=>{n([a,o]),r.push(new Promise(i=>{n=i}))}),async function*(){let a;for(let o=0,i=!1;!i;o++)[a,i]=await r[o],delete r[o],a!==void 0&&(yield a)}()},Qb=`// Start the main llama.cpp
let wllamaMalloc;
let wllamaStart;
let wllamaAction;
let wllamaExit;
let wllamaDebug;

let Module = null;

//////////////////////////////////////////////////////////////
// UTILS
//////////////////////////////////////////////////////////////

// send message back to main thread
const msg = (data, transfer) => postMessage(data, transfer);

// Convert CPP log into JS log
const cppLogToJSLog = (line) => {
  const matched = line.match(/@@(DEBUG|INFO|WARN|ERROR)@@(.*)/);
  return !!matched
    ? {
        level: (matched[1] === 'INFO' ? 'debug' : matched[1]).toLowerCase(),
        text: matched[2],
      }
    : { level: 'log', text: line };
};

// Get module config that forwards stdout/err to main thread
const getWModuleConfig = (_argMainScriptBlob) => {
  var pathConfig = RUN_OPTIONS.pathConfig;
  var pthreadPoolSize = RUN_OPTIONS.nbThread;
  var argMainScriptBlob = _argMainScriptBlob;

  if (!pathConfig['wllama.wasm']) {
    throw new Error('"wllama.wasm" is missing in pathConfig');
  }
  return {
    noInitialRun: true,
    print: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      msg({ verb: 'console.log', args: [text] });
    },
    printErr: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      const logLine = cppLogToJSLog(text);
      msg({ verb: 'console.' + logLine.level, args: [logLine.text] });
    },
    locateFile: function (filename, basePath) {
      const p = pathConfig[filename];
      const truncate = (str) =>
        str.length > 128 ? \`\${str.substr(0, 128)}...\` : str;
      if (filename.match(/wllama\\.worker\\.js/)) {
        msg({
          verb: 'console.error',
          args: [
            '"wllama.worker.js" is removed from v2.2.1. Hint: make sure to clear browser\\'s cache.',
          ],
        });
      } else {
        msg({
          verb: 'console.debug',
          args: [\`Loading "\${filename}" from "\${truncate(p)}"\`],
        });
        return p;
      }
    },
    mainScriptUrlOrBlob: argMainScriptBlob,
    pthreadPoolSize,
    wasmMemory: pthreadPoolSize > 1 ? getWasmMemory() : null,
    onAbort: function (text) {
      msg({ verb: 'signal.abort', args: [text] });
    },
  };
};

// Get the memory to be used by wasm. (Only used in multi-thread mode)
// Because we have a weird OOM issue on iOS, we need to try some values
// See: https://github.com/emscripten-core/emscripten/issues/19144
//      https://github.com/godotengine/godot/issues/70621
const getWasmMemory = () => {
  let minBytes = 128 * 1024 * 1024;
  let maxBytes = 4096 * 1024 * 1024;
  let stepBytes = 128 * 1024 * 1024;
  while (maxBytes > minBytes) {
    try {
      const wasmMemory = new WebAssembly.Memory({
        initial: minBytes / 65536,
        maximum: maxBytes / 65536,
        shared: true,
      });
      return wasmMemory;
    } catch (e) {
      maxBytes -= stepBytes;
      continue; // retry
    }
  }
  throw new Error('Cannot allocate WebAssembly.Memory');
};

//////////////////////////////////////////////////////////////
// MEMFS PATCH
//////////////////////////////////////////////////////////////

/**
 * By default, emscripten uses memfs. The way it works is by
 * allocating new Uint8Array in javascript heap. This is not good
 * because it requires files to be copied to wasm heap each time
 * a file is read.
 *
 * HeapFS is an alternative, which resolves this problem by
 * allocating space for file directly inside wasm heap. This
 * allows us to mmap without doing any copy.
 *
 * For llama.cpp, this is great because we use MAP_SHARED
 *
 * Ref: https://github.com/ngxson/wllama/pull/39
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/src/library_memfs.js
 *
 * Note 29/05/2024 @ngxson
 * Due to ftell() being limited to MAX_LONG, we cannot load files bigger than 2^31 bytes (or 2GB)
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/system/lib/libc/musl/src/stdio/ftell.c
 */

const fsNameToFile = {}; // map Name => File
const fsIdToFile = {}; // map ID => File
let currFileId = 0;

// Patch and redirect memfs calls to wllama
const patchMEMFS = () => {
  const m = Module;
  // save functions
  m.MEMFS.stream_ops._read = m.MEMFS.stream_ops.read;
  m.MEMFS.stream_ops._write = m.MEMFS.stream_ops.write;
  m.MEMFS.stream_ops._llseek = m.MEMFS.stream_ops.llseek;
  m.MEMFS.stream_ops._allocate = m.MEMFS.stream_ops.allocate;
  m.MEMFS.stream_ops._mmap = m.MEMFS.stream_ops.mmap;
  m.MEMFS.stream_ops._msync = m.MEMFS.stream_ops.msync;

  const patchStream = (stream) => {
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      stream.node.contents = m.HEAPU8.subarray(f.ptr, f.ptr + f.size);
      stream.node.usedBytes = f.size;
    }
  };

  // replace "read" functions
  m.MEMFS.stream_ops.read = function (
    stream,
    buffer,
    offset,
    length,
    position
  ) {
    patchStream(stream);
    return m.MEMFS.stream_ops._read(stream, buffer, offset, length, position);
  };
  m.MEMFS.ops_table.file.stream.read = m.MEMFS.stream_ops.read;

  // replace "llseek" functions
  m.MEMFS.stream_ops.llseek = function (stream, offset, whence) {
    patchStream(stream);
    return m.MEMFS.stream_ops._llseek(stream, offset, whence);
  };
  m.MEMFS.ops_table.file.stream.llseek = m.MEMFS.stream_ops.llseek;

  // replace "mmap" functions
  m.MEMFS.stream_ops.mmap = function (stream, length, position, prot, flags) {
    patchStream(stream);
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      return {
        ptr: f.ptr + position,
        allocated: false,
      };
    } else {
      return m.MEMFS.stream_ops._mmap(stream, length, position, prot, flags);
    }
  };
  m.MEMFS.ops_table.file.stream.mmap = m.MEMFS.stream_ops.mmap;

  // mount FS
  m.FS.mkdir('/models');
  m.FS.mount(m.MEMFS, { root: '.' }, '/models');
};

// Allocate a new file in wllama heapfs, returns file ID
const heapfsAlloc = (name, size) => {
  if (size < 1) {
    throw new Error('File size must be bigger than 0');
  }
  const m = Module;
  const ptr = m.mmapAlloc(size);
  const file = {
    ptr: ptr,
    size: size,
    id: currFileId++,
  };
  fsIdToFile[file.id] = file;
  fsNameToFile[name] = file;
  return file.id;
};

// Add new file to wllama heapfs, return number of written bytes
const heapfsWrite = (id, buffer, offset) => {
  const m = Module;
  if (fsIdToFile[id]) {
    const { ptr, size } = fsIdToFile[id];
    const afterWriteByte = offset + buffer.byteLength;
    if (afterWriteByte > size) {
      throw new Error(
        \`File ID \${id} write out of bound, afterWriteByte = \${afterWriteByte} while size = \${size}\`
      );
    }
    m.HEAPU8.set(buffer, ptr + offset);
    return buffer.byteLength;
  } else {
    throw new Error(\`File ID \${id} not found in heapfs\`);
  }
};

//////////////////////////////////////////////////////////////
// MAIN CODE
//////////////////////////////////////////////////////////////

const callWrapper = (name, ret, args) => {
  const fn = Module.cwrap(name, ret, args);
  return async (action, req) => {
    let result;
    try {
      if (args.length === 2) {
        result = await fn(action, req);
      } else {
        result = fn();
      }
    } catch (ex) {
      console.error(ex);
      throw ex;
    }
    return result;
  };
};

onmessage = async (e) => {
  if (!e.data) return;
  const { verb, args, callbackId } = e.data;

  if (!callbackId) {
    msg({ verb: 'console.error', args: ['callbackId is required', e.data] });
    return;
  }

  if (verb === 'module.init') {
    const argMainScriptBlob = args[0];
    try {
      Module = getWModuleConfig(argMainScriptBlob);
      Module.onRuntimeInitialized = () => {
        // async call once module is ready
        // init FS
        patchMEMFS();
        // init cwrap
        const pointer = 'number';
        // TODO: note sure why emscripten cannot bind if there is only 1 argument
        wllamaMalloc = callWrapper('wllama_malloc', pointer, [
          'number',
          pointer,
        ]);
        wllamaStart = callWrapper('wllama_start', 'string', []);
        wllamaAction = callWrapper('wllama_action', pointer, [
          'string',
          pointer,
        ]);
        wllamaExit = callWrapper('wllama_exit', 'string', []);
        wllamaDebug = callWrapper('wllama_debug', 'string', []);
        msg({ callbackId, result: null });
      };
      wModuleInit();
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.alloc') {
    const argFilename = args[0];
    const argSize = args[1];
    try {
      // create blank file
      const emptyBuffer = new ArrayBuffer(0);
      Module['FS_createDataFile'](
        '/models',
        argFilename,
        emptyBuffer,
        true,
        true,
        true
      );
      // alloc data on heap
      const fileId = heapfsAlloc(argFilename, argSize);
      msg({ callbackId, result: { fileId } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.write') {
    const argFileId = args[0];
    const argBuffer = args[1];
    const argOffset = args[2];
    try {
      const writtenBytes = heapfsWrite(argFileId, argBuffer, argOffset);
      msg({ callbackId, result: { writtenBytes } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.start') {
    try {
      const result = await wllamaStart();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.action') {
    const argAction = args[0];
    const argEncodedMsg = args[1];
    try {
      const inputPtr = await wllamaMalloc(argEncodedMsg.byteLength, 0);
      // copy data to wasm heap
      const inputBuffer = new Uint8Array(
        Module.HEAPU8.buffer,
        inputPtr,
        argEncodedMsg.byteLength
      );
      inputBuffer.set(argEncodedMsg, 0);
      const outputPtr = await wllamaAction(argAction, inputPtr);
      // length of output buffer is written at the first 4 bytes of input buffer
      const outputLen = new Uint32Array(Module.HEAPU8.buffer, inputPtr, 1)[0];
      // copy the output buffer to JS heap
      const outputBuffer = new Uint8Array(outputLen);
      const outputSrcView = new Uint8Array(
        Module.HEAPU8.buffer,
        outputPtr,
        outputLen
      );
      outputBuffer.set(outputSrcView, 0); // copy it
      msg({ callbackId, result: outputBuffer }, [outputBuffer.buffer]);
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.exit') {
    try {
      const result = await wllamaExit();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.debug') {
    try {
      const result = await wllamaDebug();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }
};
`,qh=`let accessHandle;
let abortController = new AbortController();

async function openFile(filename) {
  const opfsRoot = await navigator.storage.getDirectory();
  const cacheDir = await opfsRoot.getDirectoryHandle('cache', { create: true });
  const fileHandler = await cacheDir.getFileHandle(filename, { create: true });
  accessHandle = await fileHandler.createSyncAccessHandle();
  accessHandle.truncate(0); // clear file content
}

async function writeFile(buf) {
  accessHandle.write(buf);
}

async function closeFile() {
  accessHandle.flush();
  accessHandle.close();
}

async function writeTextFile(filename, str) {
  await openFile(filename);
  await writeFile(new TextEncoder().encode(str));
  await closeFile();
}

const throttled = (func, delay) => {
  let lastRun = 0;
  return (...args) => {
    const now = Date.now();
    if (now - lastRun > delay) {
      lastRun = now;
      func.apply(null, args);
    }
  };
};

const assertNonNull = (val) => {
  if (val === null || val === undefined) {
    throw new Error('OPFS Worker: Assertion failed');
  }
};

// respond to main thread
const resOK = () => postMessage({ ok: true });
const resProgress = (loaded, total) =>
  postMessage({ progress: { loaded, total } });
const resErr = (err) => postMessage({ err });

onmessage = async (e) => {
  try {
    if (!e.data) return;

    /**
     * @param {Object} e.data
     *
     * Fine-control FS actions:
     * - { action: 'open', filename: 'string' }
     * - { action: 'write', buf: ArrayBuffer }
     * - { action: 'close' }
     *
     * Simple write API:
     * - { action: 'write-simple', filename: 'string', buf: ArrayBuffer }
     *
     * Download API:
     * - { action: 'download', url: 'string', filename: 'string', options: Object, metadataFileName: 'string' }
     * - { action: 'download-abort' }
     */
    const { action, filename, buf, url, options, metadataFileName } = e.data;

    if (action === 'open') {
      assertNonNull(filename);
      await openFile(filename);
      return resOK();
    } else if (action === 'write') {
      assertNonNull(buf);
      await writeFile(buf);
      return resOK();
    } else if (action === 'close') {
      await closeFile();
      return resOK();
    } else if (action === 'write-simple') {
      assertNonNull(filename);
      assertNonNull(buf);
      await openFile(filename);
      await writeFile(buf);
      await closeFile();
      return resOK();
    } else if (action === 'download') {
      assertNonNull(url);
      assertNonNull(filename);
      assertNonNull(metadataFileName);
      assertNonNull(options);
      assertNonNull(options.aborted);
      abortController = new AbortController();
      if (options.aborted) abortController.abort();
      const response = await fetch(url, {
        ...options,
        signal: abortController.signal,
      });
      const contentLength = response.headers.get('content-length');
      const etag = (response.headers.get('etag') || '').replace(
        /[^A-Za-z0-9]/g,
        ''
      );
      const total = parseInt(contentLength, 10);
      const reader = response.body.getReader();
      await openFile(filename);
      let loaded = 0;
      const throttledProgress = throttled(resProgress, 100);
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        loaded += value.byteLength;
        await writeFile(value);
        throttledProgress(loaded, total);
      }
      resProgress(total, total); // 100% done
      await closeFile();
      // make sure this is in-sync with CacheEntryMetadata
      await writeTextFile(
        metadataFileName,
        JSON.stringify({
          originalURL: url,
          originalSize: total,
          etag,
        })
      );
      return resOK();
    } else if (action === 'download-abort') {
      if (abortController) {
        abortController.abort();
      }
      return;
    }

    throw new Error('OPFS Worker: Invalid action', e.data);
  } catch (err) {
    return resErr(err);
  }
};
`,e0='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&self.name?.startsWith("em-pthread");if(ENVIRONMENT_IS_NODE){var worker_threads=require("worker_threads");global.Worker=worker_threads.Worker;ENVIRONMENT_IS_WORKER=!worker_threads.isMainThread;ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&worker_threads["workerData"]=="em-pthread"}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var _scriptName=typeof document!="undefined"?document.currentScript?.src:undefined;if(ENVIRONMENT_IS_NODE){_scriptName=__filename}else if(ENVIRONMENT_IS_WORKER){_scriptName=self.location.href}var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}if(!ENVIRONMENT_IS_NODE){if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var defaultPrint=console.log.bind(console);var defaultPrintErr=console.error.bind(console);if(ENVIRONMENT_IS_NODE){defaultPrint=(...args)=>fs.writeSync(1,args.join(" ")+"\\n");defaultPrintErr=(...args)=>fs.writeSync(2,args.join(" ")+"\\n")}var out=Module["print"]||defaultPrint;var err=Module["printErr"]||defaultPrintErr;Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var wasmModule;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function GROWABLE_HEAP_I8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP8}function GROWABLE_HEAP_U8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU8}function GROWABLE_HEAP_I16(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP16}function GROWABLE_HEAP_I32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP32}function GROWABLE_HEAP_U32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU32}function GROWABLE_HEAP_F32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF32}function GROWABLE_HEAP_F64(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF64}if(ENVIRONMENT_IS_PTHREAD){var wasmModuleReceived;if(ENVIRONMENT_IS_NODE){var parentPort=worker_threads["parentPort"];parentPort.on("message",msg=>onmessage({data:msg}));Object.assign(globalThis,{self:global,postMessage:msg=>parentPort.postMessage(msg)})}var initializedJS=false;function threadPrintErr(...args){var text=args.join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\\n");return}console.error(text)}if(!Module["printErr"])err=threadPrintErr;function threadAlert(...args){var text=args.join(" ");postMessage({cmd:"alert",text,threadId:_pthread_self()})}self.alert=threadAlert;self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{var msgData=e["data"];var cmd=msgData.cmd;if(cmd==="load"){let messageQueue=[];self.onmessage=e=>messageQueue.push(e);self.startWorker=instance=>{postMessage({cmd:"loaded"});for(let msg of messageQueue){handleMessage(msg)}self.onmessage=handleMessage};for(const handler of msgData.handlers){if(!Module[handler]||Module[handler].proxy){Module[handler]=(...args)=>{postMessage({cmd:"callHandler",handler,args})};if(handler=="print")out=Module[handler];if(handler=="printErr")err=Module[handler]}}wasmMemory=msgData.wasmMemory;updateMemoryViews();wasmModuleReceived(msgData.wasmModule)}else if(cmd==="run"){establishStackSpace(msgData.pthread_ptr);__emscripten_thread_init(msgData.pthread_ptr,0,0,1,0,0);PThread.receiveObjectTransfer(msgData);PThread.threadInitTLS();__emscripten_thread_mailbox_await(msgData.pthread_ptr);if(!initializedJS){initializedJS=true}try{invokeEntryPoint(msgData.start_routine,msgData.arg)}catch(ex){if(ex!="unwind"){throw ex}}}else if(msgData.target==="setimmediate"){}else if(cmd==="checkMailbox"){if(initializedJS){checkMailbox()}}else if(cmd){err(`worker: received unknown command ${cmd}`);err(msgData)}}catch(ex){__emscripten_thread_crashed();throw ex}}self.onmessage=handleMessage}function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}if(!ENVIRONMENT_IS_PTHREAD){if(Module["wasmMemory"]){wasmMemory=Module["wasmMemory"]}else{var INITIAL_MEMORY=Module["INITIAL_MEMORY"]||134217728;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:65536,shared:true})}updateMemoryViews()}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(ENVIRONMENT_IS_PTHREAD)return startWorker(Module);if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["I"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){assignWasmImports();return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);registerTLSInit(wasmExports["P"]);wasmTable=wasmExports["S"];wasmModule=module;removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"],result["module"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}if(ENVIRONMENT_IS_PTHREAD){return new Promise(resolve=>{wasmModuleReceived=module=>{var instance=new WebAssembly.Instance(module,getWasmImports());resolve(receiveInstance(instance,module))}})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var terminateWorker=worker=>{worker.terminate();worker.onmessage=e=>{}};Module["terminateWorker"]=terminateWorker;var cleanupThread=pthread_ptr=>{var worker=PThread.pthreads[pthread_ptr];PThread.returnWorkerToPool(worker)};Module["cleanupThread"]=cleanupThread;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;var spawnThread=threadParams=>{var worker=PThread.getNewWorker();if(!worker){return 6}PThread.runningWorkers.push(worker);PThread.pthreads[threadParams.pthread_ptr]=worker;worker.pthread_ptr=threadParams.pthread_ptr;var msg={cmd:"run",start_routine:threadParams.startRoutine,arg:threadParams.arg,pthread_ptr:threadParams.pthread_ptr};if(ENVIRONMENT_IS_NODE){worker.unref()}worker.postMessage(msg,threadParams.transferList);return 0};Module["spawnThread"]=spawnThread;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;var proxyToMainThread=(funcIndex,emAsmAddr,sync,...callArgs)=>{var serializedNumCallArgs=callArgs.length*2;var sp=stackSave();var args=stackAlloc(serializedNumCallArgs*8);var b=args>>>3;for(var i=0;i<callArgs.length;i++){var arg=callArgs[i];if(typeof arg=="bigint"){HEAP64[b+2*i]=1n;HEAP64[b+2*i+1]=arg}else{HEAP64[b+2*i]=0n;GROWABLE_HEAP_F64()[b+2*i+1>>>0]=arg}}var rtn=__emscripten_run_on_main_thread_js(funcIndex,emAsmAddr,serializedNumCallArgs,args,sync);stackRestore(sp);return rtn};Module["proxyToMainThread"]=proxyToMainThread;function _proc_exit(code){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(0,0,1,code);EXITSTATUS=code;if(!keepRuntimeAlive()){PThread.terminateAllThreads();Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))}Module["_proc_exit"]=_proc_exit;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;function exitOnMainThread(returnCode){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(1,0,0,returnCode);_exit(returnCode)}Module["exitOnMainThread"]=exitOnMainThread;var exitJS=(status,implicit)=>{EXITSTATUS=status;if(ENVIRONMENT_IS_PTHREAD){exitOnMainThread(status);throw"unwind"}_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var PThread={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init(){if(!ENVIRONMENT_IS_PTHREAD){PThread.initMainThread()}},initMainThread(){var pthreadPoolSize=Module["pthreadPoolSize"];while(pthreadPoolSize--){PThread.allocateUnusedWorker()}addOnPreRun(()=>{addRunDependency("loading-workers");PThread.loadWasmModuleToAllWorkers(()=>removeRunDependency("loading-workers"))})},terminateAllThreads:()=>{for(var worker of PThread.runningWorkers){terminateWorker(worker)}for(var worker of PThread.unusedWorkers){terminateWorker(worker)}PThread.unusedWorkers=[];PThread.runningWorkers=[];PThread.pthreads={}},returnWorkerToPool:worker=>{var pthread_ptr=worker.pthread_ptr;delete PThread.pthreads[pthread_ptr];PThread.unusedWorkers.push(worker);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(worker),1);worker.pthread_ptr=0;__emscripten_thread_free_data(pthread_ptr)},receiveObjectTransfer(data){},threadInitTLS(){PThread.tlsInitFunctions.forEach(f=>f())},loadWasmModuleToWorker:worker=>new Promise(onFinishedLoading=>{worker.onmessage=e=>{var d=e["data"];var cmd=d.cmd;if(d.targetThread&&d.targetThread!=_pthread_self()){var targetWorker=PThread.pthreads[d.targetThread];if(targetWorker){targetWorker.postMessage(d,d.transferList)}else{err(`Internal error! Worker sent a message "${cmd}" to target pthread ${d.targetThread}, but that thread no longer exists!`)}return}if(cmd==="checkMailbox"){checkMailbox()}else if(cmd==="spawnThread"){spawnThread(d)}else if(cmd==="cleanupThread"){cleanupThread(d.thread)}else if(cmd==="loaded"){worker.loaded=true;if(ENVIRONMENT_IS_NODE&&!worker.pthread_ptr){worker.unref()}onFinishedLoading(worker)}else if(cmd==="alert"){alert(`Thread ${d.threadId}: ${d.text}`)}else if(d.target==="setimmediate"){worker.postMessage(d)}else if(cmd==="callHandler"){Module[d.handler](...d.args)}else if(cmd){err(`worker sent an unknown command ${cmd}`)}};worker.onerror=e=>{var message="worker sent an error!";err(`${message} ${e.filename}:${e.lineno}: ${e.message}`);throw e};if(ENVIRONMENT_IS_NODE){worker.on("message",data=>worker.onmessage({data}));worker.on("error",e=>worker.onerror(e))}var handlers=[];var knownHandlers=["onExit","onAbort","print","printErr"];for(var handler of knownHandlers){if(Module.propertyIsEnumerable(handler)){handlers.push(handler)}}worker.postMessage({cmd:"load",handlers,wasmMemory,wasmModule})}),loadWasmModuleToAllWorkers(onMaybeReady){if(ENVIRONMENT_IS_PTHREAD){return onMaybeReady()}let pthreadPoolReady=Promise.all(PThread.unusedWorkers.map(PThread.loadWasmModuleToWorker));pthreadPoolReady.then(onMaybeReady)},allocateUnusedWorker(){var worker;var workerOptions={workerData:"em-pthread",name:"em-pthread"};var pthreadMainJs=_scriptName;if(Module["mainScriptUrlOrBlob"]){pthreadMainJs=Module["mainScriptUrlOrBlob"];if(typeof pthreadMainJs!="string"){pthreadMainJs=URL.createObjectURL(pthreadMainJs)}}worker=new Worker(pthreadMainJs,workerOptions);PThread.unusedWorkers.push(worker)},getNewWorker(){if(PThread.unusedWorkers.length==0){PThread.allocateUnusedWorker();PThread.loadWasmModuleToWorker(PThread.unusedWorkers[0])}return PThread.unusedWorkers.pop()}};Module["PThread"]=PThread;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var establishStackSpace=pthread_ptr=>{updateMemoryViews();var stackHigh=GROWABLE_HEAP_U32()[pthread_ptr+52>>>2>>>0];var stackSize=GROWABLE_HEAP_U32()[pthread_ptr+56>>>2>>>0];var stackLow=stackHigh-stackSize;_emscripten_stack_set_limits(stackHigh,stackLow);stackRestore(stackHigh)};Module["establishStackSpace"]=establishStackSpace;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return GROWABLE_HEAP_I8()[ptr>>>0];case"i8":return GROWABLE_HEAP_I8()[ptr>>>0];case"i16":return GROWABLE_HEAP_I16()[ptr>>>1>>>0];case"i32":return GROWABLE_HEAP_I32()[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return GROWABLE_HEAP_F32()[ptr>>>2>>>0];case"double":return GROWABLE_HEAP_F64()[ptr>>>3>>>0];case"*":return GROWABLE_HEAP_U32()[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var wasmTableMirror=[];Module["wasmTableMirror"]=wasmTableMirror;var wasmTable;Module["wasmTable"]=wasmTable;var getWasmTableEntry=funcPtr=>{var func=wasmTableMirror[funcPtr];if(!func){if(funcPtr>=wasmTableMirror.length)wasmTableMirror.length=funcPtr+1;wasmTableMirror[funcPtr]=func=wasmTable.get(funcPtr)}return func};Module["getWasmTableEntry"]=getWasmTableEntry;var invokeEntryPoint=(ptr,arg)=>{runtimeKeepaliveCounter=0;noExitRuntime=0;var result=getWasmTableEntry(ptr)(arg);function finish(result){if(keepRuntimeAlive()){EXITSTATUS=result}else{__emscripten_thread_exit(result)}}finish(result)};Module["invokeEntryPoint"]=invokeEntryPoint;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;var registerTLSInit=tlsInitFunc=>PThread.tlsInitFunctions.push(tlsInitFunc);Module["registerTLSInit"]=registerTLSInit;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i8":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i16":GROWABLE_HEAP_I16()[ptr>>>1>>>0]=value;break;case"i32":GROWABLE_HEAP_I32()[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":GROWABLE_HEAP_F32()[ptr>>>2>>>0]=value;break;case"double":GROWABLE_HEAP_F64()[ptr>>>3>>>0]=value;break;case"*":GROWABLE_HEAP_U32()[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;function pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(2,0,1,pthread_ptr,attr,startRoutine,arg);return ___pthread_create_js(pthread_ptr,attr,startRoutine,arg)}Module["pthreadCreateProxied"]=pthreadCreateProxied;var _emscripten_has_threading_support=()=>typeof SharedArrayBuffer!="undefined";Module["_emscripten_has_threading_support"]=_emscripten_has_threading_support;function ___pthread_create_js(pthread_ptr,attr,startRoutine,arg){pthread_ptr>>>=0;attr>>>=0;startRoutine>>>=0;arg>>>=0;if(!_emscripten_has_threading_support()){return 6}var transferList=[];var error=0;if(ENVIRONMENT_IS_PTHREAD&&(transferList.length===0||error)){return pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg)}if(error)return error;var threadParams={startRoutine,pthread_ptr,arg,transferList};if(ENVIRONMENT_IS_PTHREAD){threadParams.cmd="spawnThread";postMessage(threadParams,transferList);return 0}return spawnThread(threadParams)}Module["___pthread_create_js"]=___pthread_create_js;var syscallGetVarargI=()=>{var ret=GROWABLE_HEAP_I32()[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>view.set(crypto.getRandomValues(new Uint8Array(view.byteLength)))};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.buffer instanceof ArrayBuffer?heapOrArray.subarray(idx,endPtr):heapOrArray.slice(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{GROWABLE_HEAP_U8().fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===GROWABLE_HEAP_I8().buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===GROWABLE_HEAP_I8().buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}GROWABLE_HEAP_I8().set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,GROWABLE_HEAP_I8(),ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(GROWABLE_HEAP_U8(),ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){GROWABLE_HEAP_I32()[buf>>>2>>>0]=stat.dev;GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stat.mode;GROWABLE_HEAP_U32()[buf+8>>>2>>>0]=stat.nlink;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stat.uid;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stat.gid;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);GROWABLE_HEAP_I32()[buf+32>>>2>>>0]=4096;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));GROWABLE_HEAP_U32()[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));GROWABLE_HEAP_U32()[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));GROWABLE_HEAP_U32()[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+40>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+8>>>2>>>0]=stats.blocks;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stats.bfree;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stats.bavail;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stats.files;GROWABLE_HEAP_I32()[buf+24>>>2>>>0]=stats.ffree;GROWABLE_HEAP_I32()[buf+28>>>2>>>0]=stats.fsid;GROWABLE_HEAP_I32()[buf+44>>>2>>>0]=stats.flags;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=GROWABLE_HEAP_U8().slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;function ___syscall_fcntl64(fd,cmd,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(3,0,1,fd,cmd,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;GROWABLE_HEAP_I16()[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(4,0,1,fd,op,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=termios.c_iflag||0;GROWABLE_HEAP_I32()[argp+4>>>2>>>0]=termios.c_oflag||0;GROWABLE_HEAP_I32()[argp+8>>>2>>>0]=termios.c_cflag||0;GROWABLE_HEAP_I32()[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){GROWABLE_HEAP_I8()[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=GROWABLE_HEAP_I32()[argp>>>2>>>0];var c_oflag=GROWABLE_HEAP_I32()[argp+4>>>2>>>0];var c_cflag=GROWABLE_HEAP_I32()[argp+8>>>2>>>0];var c_lflag=GROWABLE_HEAP_I32()[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(GROWABLE_HEAP_I8()[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();GROWABLE_HEAP_I16()[argp>>>1>>>0]=winsize[0];GROWABLE_HEAP_I16()[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(5,0,1,dirfd,path,flags,varargs);path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;function __emscripten_init_main_thread_js(tb){tb>>>=0;__emscripten_thread_init(tb,!ENVIRONMENT_IS_WORKER,1,!ENVIRONMENT_IS_WEB,65536,false);PThread.threadInitTLS()}Module["__emscripten_init_main_thread_js"]=__emscripten_init_main_thread_js;var maybeExit=()=>{if(!keepRuntimeAlive()){try{if(ENVIRONMENT_IS_PTHREAD)__emscripten_thread_exit(EXITSTATUS);else _exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;function __emscripten_thread_mailbox_await(pthread_ptr){pthread_ptr>>>=0;if(typeof Atomics.waitAsync==="function"){var wait=Atomics.waitAsync(GROWABLE_HEAP_I32(),pthread_ptr>>>2,pthread_ptr);wait.value.then(checkMailbox);var waitingAsync=pthread_ptr+128;Atomics.store(GROWABLE_HEAP_I32(),waitingAsync>>>2,1)}}Module["__emscripten_thread_mailbox_await"]=__emscripten_thread_mailbox_await;var checkMailbox=()=>{var pthread_ptr=_pthread_self();if(pthread_ptr){__emscripten_thread_mailbox_await(pthread_ptr);callUserCallback(__emscripten_check_mailbox)}};Module["checkMailbox"]=checkMailbox;function __emscripten_notify_mailbox_postmessage(targetThread,currThreadId){targetThread>>>=0;currThreadId>>>=0;if(targetThread==currThreadId){setTimeout(checkMailbox)}else if(ENVIRONMENT_IS_PTHREAD){postMessage({targetThread,cmd:"checkMailbox"})}else{var worker=PThread.pthreads[targetThread];if(!worker){return}worker.postMessage({cmd:"checkMailbox"})}}Module["__emscripten_notify_mailbox_postmessage"]=__emscripten_notify_mailbox_postmessage;var proxiedJSCallArgs=[];Module["proxiedJSCallArgs"]=proxiedJSCallArgs;function __emscripten_receive_on_main_thread_js(funcIndex,emAsmAddr,callingThread,numCallArgs,args){emAsmAddr>>>=0;callingThread>>>=0;args>>>=0;numCallArgs/=2;proxiedJSCallArgs.length=numCallArgs;var b=args>>>3;for(var i=0;i<numCallArgs;i++){if(HEAP64[b+2*i]){proxiedJSCallArgs[i]=HEAP64[b+2*i+1]}else{proxiedJSCallArgs[i]=GROWABLE_HEAP_F64()[b+2*i+1>>>0]}}var func=proxiedFunctionTable[funcIndex];PThread.currentProxiedOperationCallerThread=callingThread;var rtn=func(...proxiedJSCallArgs);PThread.currentProxiedOperationCallerThread=0;return rtn}Module["__emscripten_receive_on_main_thread_js"]=__emscripten_receive_on_main_thread_js;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __emscripten_thread_cleanup(thread){thread>>>=0;if(!ENVIRONMENT_IS_PTHREAD)cleanupThread(thread);else postMessage({cmd:"cleanupThread",thread})}Module["__emscripten_thread_cleanup"]=__emscripten_thread_cleanup;function __emscripten_thread_set_strongref(thread){thread>>>=0;if(ENVIRONMENT_IS_NODE){PThread.pthreads[thread].ref()}}Module["__emscripten_thread_set_strongref"]=__emscripten_thread_set_strongref;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(6,0,1,len,prot,flags,fd,offset,allocated,addr);len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;GROWABLE_HEAP_I32()[allocated>>>2>>>0]=res.allocated;GROWABLE_HEAP_U32()[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(7,0,1,addr,len,prot,flags,fd,offset);addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var _emscripten_get_now=()=>performance.timeOrigin+performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;function __setitimer_js(which,timeout_ms){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(8,0,1,which,timeout_ms);if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0}Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,GROWABLE_HEAP_U8(),outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);GROWABLE_HEAP_U32()[timezone>>>2>>>0]=stdTimezoneOffset*60;GROWABLE_HEAP_I32()[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var warnOnce=text=>{warnOnce.shown||={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;if(ENVIRONMENT_IS_NODE)text="warning: "+text;err(text)}};Module["warnOnce"]=warnOnce;var _emscripten_check_blocking_allowed=()=>{};Module["_emscripten_check_blocking_allowed"]=_emscripten_check_blocking_allowed;var runtimeKeepalivePush=()=>{runtimeKeepaliveCounter+=1};Module["runtimeKeepalivePush"]=runtimeKeepalivePush;var _emscripten_exit_with_live_runtime=()=>{runtimeKeepalivePush();throw"unwind"};Module["_emscripten_exit_with_live_runtime"]=_emscripten_exit_with_live_runtime;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;function _emscripten_get_heap_max(){return getHeapMax()}Module["_emscripten_get_heap_max"]=_emscripten_get_heap_max;var _emscripten_num_logical_cores=()=>ENVIRONMENT_IS_NODE?require("os").cpus().length:navigator["hardwareConcurrency"];Module["_emscripten_num_logical_cores"]=_emscripten_num_logical_cores;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=GROWABLE_HEAP_U8().length;if(requestedSize<=oldSize){return false}var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){GROWABLE_HEAP_I8()[buffer++>>>0]=str.charCodeAt(i)}GROWABLE_HEAP_I8()[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(9,0,1,__environ,environ_buf);__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;GROWABLE_HEAP_U32()[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(10,0,1,penviron_count,penviron_buf_size);penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();GROWABLE_HEAP_U32()[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);GROWABLE_HEAP_U32()[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(11,0,1,fd);try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(12,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(13,0,1,fd,offset,whence,newOffset);offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(14,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(GROWABLE_HEAP_U8().subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{GROWABLE_HEAP_I8().set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;PThread.init();FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var proxiedFunctionTable=[_proc_exit,exitOnMainThread,pthreadCreateProxied,___syscall_fcntl64,___syscall_ioctl,___syscall_openat,__mmap_js,__munmap_js,__setitimer_js,_environ_get,_environ_sizes_get,_fd_close,_fd_read,_fd_seek,_fd_write];var wasmImports;function assignWasmImports(){wasmImports={u:___pthread_create_js,c:___syscall_fcntl64,h:___syscall_ioctl,i:___syscall_openat,H:__abort_js,C:__emscripten_init_main_thread_js,q:__emscripten_notify_mailbox_postmessage,v:__emscripten_receive_on_main_thread_js,l:__emscripten_runtime_keepalive_clear,d:__emscripten_thread_cleanup,B:__emscripten_thread_mailbox_await,n:__emscripten_thread_set_strongref,x:__mmap_js,y:__munmap_js,m:__setitimer_js,z:__tzset_js,G:_clock_time_get,e:_emscripten_check_blocking_allowed,w:_emscripten_date_now,j:_emscripten_exit_with_live_runtime,r:_emscripten_get_heap_max,b:_emscripten_get_now,s:_emscripten_num_logical_cores,p:_emscripten_resize_heap,D:_environ_get,E:_environ_sizes_get,t:_exit,f:_fd_close,g:_fd_read,A:_fd_seek,F:_fd_write,a:wasmMemory,k:_proc_exit,o:_random_get}}var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["I"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["J"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["K"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["L"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["M"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["N"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["O"])(a0,a1);var __emscripten_tls_init=()=>(__emscripten_tls_init=wasmExports["P"])();var _pthread_self=()=>(_pthread_self=wasmExports["Q"])();var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["R"])(a0,a1);var __emscripten_thread_init=(a0,a1,a2,a3,a4,a5)=>(__emscripten_thread_init=wasmExports["T"])(a0,a1,a2,a3,a4,a5);var __emscripten_thread_crashed=()=>(__emscripten_thread_crashed=wasmExports["U"])();var __emscripten_run_on_main_thread_js=(a0,a1,a2,a3,a4)=>(__emscripten_run_on_main_thread_js=wasmExports["V"])(a0,a1,a2,a3,a4);var __emscripten_thread_free_data=a0=>(__emscripten_thread_free_data=wasmExports["W"])(a0);var __emscripten_thread_exit=a0=>(__emscripten_thread_exit=wasmExports["X"])(a0);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["Y"])(a0,a1);var __emscripten_check_mailbox=()=>(__emscripten_check_mailbox=wasmExports["Z"])();var ___trap=()=>(___trap=wasmExports["_"])();var _emscripten_stack_set_limits=(a0,a1)=>(_emscripten_stack_set_limits=wasmExports["$"])(a0,a1);var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["aa"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["ba"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["ca"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_p=f=>()=>f()>>>0;var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;wasmExports["Q"]=makeWrapper_p(wasmExports["Q"]);wasmExports["R"]=makeWrapper_ppp(wasmExports["R"]);wasmExports["ba"]=makeWrapper_pp(wasmExports["ba"]);wasmExports["ca"]=makeWrapper_p(wasmExports["ca"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}if(ENVIRONMENT_IS_PTHREAD){initRuntime();return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n',t0='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";if(ENVIRONMENT_IS_NODE){}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}{if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.error.bind(console);Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["w"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);wasmMemory=wasmExports["v"];updateMemoryViews();removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return HEAP8[ptr>>>0];case"i8":return HEAP8[ptr>>>0];case"i16":return HEAP16[ptr>>>1>>>0];case"i32":return HEAP32[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return HEAPF32[ptr>>>2>>>0];case"double":return HEAPF64[ptr>>>3>>>0];case"*":return HEAPU32[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":HEAP8[ptr>>>0]=value;break;case"i8":HEAP8[ptr>>>0]=value;break;case"i16":HEAP16[ptr>>>1>>>0]=value;break;case"i32":HEAP32[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":HEAPF32[ptr>>>2>>>0]=value;break;case"double":HEAPF64[ptr>>>3>>>0]=value;break;case"*":HEAPU32[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;var syscallGetVarargI=()=>{var ret=HEAP32[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>crypto.getRandomValues(view)};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.subarray(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{HEAPU8.fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===HEAP8.buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===HEAP8.buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}HEAP8.set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,HEAP8,ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){HEAP32[buf>>>2>>>0]=stat.dev;HEAP32[buf+4>>>2>>>0]=stat.mode;HEAPU32[buf+8>>>2>>>0]=stat.nlink;HEAP32[buf+12>>>2>>>0]=stat.uid;HEAP32[buf+16>>>2>>>0]=stat.gid;HEAP32[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);HEAP32[buf+32>>>2>>>0]=4096;HEAP32[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));HEAPU32[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));HEAPU32[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));HEAPU32[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){HEAP32[buf+4>>>2>>>0]=stats.bsize;HEAP32[buf+40>>>2>>>0]=stats.bsize;HEAP32[buf+8>>>2>>>0]=stats.blocks;HEAP32[buf+12>>>2>>>0]=stats.bfree;HEAP32[buf+16>>>2>>>0]=stats.bavail;HEAP32[buf+20>>>2>>>0]=stats.files;HEAP32[buf+24>>>2>>>0]=stats.ffree;HEAP32[buf+28>>>2>>>0]=stats.fsid;HEAP32[buf+44>>>2>>>0]=stats.flags;HEAP32[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=HEAPU8.slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;function ___syscall_fcntl64(fd,cmd,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;HEAP16[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=termios.c_iflag||0;HEAP32[argp+4>>>2>>>0]=termios.c_oflag||0;HEAP32[argp+8>>>2>>>0]=termios.c_cflag||0;HEAP32[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){HEAP8[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=HEAP32[argp>>>2>>>0];var c_oflag=HEAP32[argp+4>>>2>>>0];var c_cflag=HEAP32[argp+8>>>2>>>0];var c_lflag=HEAP32[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(HEAP8[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();HEAP16[argp>>>1>>>0]=winsize[0];HEAP16[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;HEAP32[allocated>>>2>>>0]=res.allocated;HEAPU32[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var _proc_exit=code=>{EXITSTATUS=code;if(!keepRuntimeAlive()){Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))};Module["_proc_exit"]=_proc_exit;var exitJS=(status,implicit)=>{EXITSTATUS=status;_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var maybeExit=()=>{if(!keepRuntimeAlive()){try{_exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;var _emscripten_get_now=()=>performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;var __setitimer_js=(which,timeout_ms)=>{if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0};Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);HEAPU32[timezone>>>2>>>0]=stdTimezoneOffset*60;HEAP32[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;function _emscripten_get_heap_max(){return getHeapMax()}Module["_emscripten_get_heap_max"]=_emscripten_get_heap_max;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=HEAPU8.length;var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){HEAP8[buffer++>>>0]=str.charCodeAt(i)}HEAP8[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;HEAPU32[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();HEAPU32[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);HEAPU32[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(HEAPU8.subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{HEAP8.set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var wasmImports={b:___syscall_fcntl64,f:___syscall_ioctl,g:___syscall_openat,u:__abort_js,j:__emscripten_runtime_keepalive_clear,o:__mmap_js,p:__munmap_js,k:__setitimer_js,q:__tzset_js,t:_clock_time_get,i:_emscripten_date_now,n:_emscripten_get_heap_max,m:_emscripten_resize_heap,s:_environ_get,c:_environ_sizes_get,a:_fd_close,e:_fd_read,r:_fd_seek,d:_fd_write,h:_proc_exit,l:_random_get};var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["w"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["x"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["y"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["z"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["A"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["B"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["C"])(a0,a1);var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["E"])(a0,a1);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["F"])(a0,a1);var ___trap=()=>(___trap=wasmExports["G"])();var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["H"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["I"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["J"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;var makeWrapper_p=f=>()=>f()>>>0;wasmExports["E"]=makeWrapper_ppp(wasmExports["E"]);wasmExports["I"]=makeWrapper_pp(wasmExports["I"]);wasmExports["J"]=makeWrapper_p(wasmExports["J"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n';class dN{constructor(e,r=1,n,a){ae(this,"logger");ae(this,"suppressNativeLog");ae(this,"taskQueue",[]);ae(this,"taskId",1);ae(this,"resultQueue",[]);ae(this,"busy",!1);ae(this,"worker");ae(this,"pathConfig");ae(this,"multiThread");ae(this,"nbThread");this.pathConfig=e,this.nbThread=r,this.multiThread=r>1,this.logger=a,this.suppressNativeLog=n}async moduleInit(e){if(!this.pathConfig["wllama.wasm"])throw new Error('"single-thread/wllama.wasm" is missing from pathConfig');let r=this.multiThread?e0:t0,n=r.replace("var Module","var ___Module");const a={pathConfig:this.pathConfig,nbThread:this.nbThread},o=[`const RUN_OPTIONS = ${JSON.stringify(a)};`,`function wModuleInit() { ${n}; return Module; }`,Qb].join(`;

`);this.worker=_l(o),this.worker.onmessage=this.onRecvMsg.bind(this),this.worker.onerror=this.logger.error;const i=await this.pushTask({verb:"module.init",args:[new Blob([r],{type:"text/javascript"})],callbackId:this.taskId++}),s=[];for(const l of e){const c=await this.fileAlloc(l.name,l.blob.size);s.push({id:c,...l})}return await Promise.all(s.map(l=>this.fileWrite(l.id,l.blob))),i}async wllamaStart(){const e=await this.pushTask({verb:"wllama.start",args:[],callbackId:this.taskId++});return this.parseResult(e)}async wllamaAction(e,r){const n=cN(r),a=await this.pushTask({verb:"wllama.action",args:[e,n],callbackId:this.taskId++});return lN(a)}async wllamaExit(){if(this.worker){const e=await this.pushTask({verb:"wllama.exit",args:[],callbackId:this.taskId++});this.parseResult(e),this.worker.terminate()}}async wllamaDebug(){const e=await this.pushTask({verb:"wllama.debug",args:[],callbackId:this.taskId++});return JSON.parse(e)}async fileAlloc(e,r){return(await this.pushTask({verb:"fs.alloc",args:[e,r],callbackId:this.taskId++})).fileId}async fileWrite(e,r){const n=r.stream().getReader();let a=0;for(;;){const{done:o,value:i}=await n.read();if(o)break;const s=i.byteLength;await this.pushTask({verb:"fs.write",args:[e,i,a],callbackId:this.taskId++},[i.buffer]),a+=s}}parseResult(e){const r=JSON.parse(e);if(r&&r.error)throw new Error("Unknown error, please see console.log");return r}pushTask(e,r){return new Promise((n,a)=>{this.taskQueue.push({resolve:n,reject:a,param:e,buffers:r}),this.runTaskLoop()})}async runTaskLoop(){if(!this.busy){for(this.busy=!0;;){const e=this.taskQueue.shift();if(!e)break;this.resultQueue.push(e),this.worker.postMessage(e.param,Gh()?void 0:{transfer:e.buffers??[]})}this.busy=!1}}onRecvMsg(e){if(!e.data)return;const{verb:r,args:n}=e.data;if(r&&r.startsWith("console.")){if(this.suppressNativeLog)return;r.endsWith("debug")&&this.logger.debug(...n),r.endsWith("log")&&this.logger.log(...n),r.endsWith("warn")&&this.logger.warn(...n),r.endsWith("error")&&this.logger.error(...n);return}else r==="signal.abort"&&this.abort(n[0]);const{callbackId:a,result:o,err:i}=e.data;if(a){const s=this.resultQueue.findIndex(l=>l.param.callbackId===a);if(s!==-1){const l=this.resultQueue.splice(s,1)[0];i?l.reject(i):l.resolve(o)}else this.logger.error(`Cannot find waiting task with callbackId = ${a}`)}}abort(e){for(;this.resultQueue.length>0;){const r=this.resultQueue.pop();if(!r)break;r.reject(new Error(`Received abort signal from llama.cpp; Message: ${e||"(empty)"}`))}}}let Un;Un="__metadata__",vf="polyfill_for_older_version";class r0{async getNameFromURL(e){return await Da(e,"")}async write(e,r,n){return this.writeMetadata(e,n),await n0(e,r)}async download(e,r={}){const n=_l(qh);let a=!1;r.signal&&(a=r.signal.aborted,r.signal.addEventListener("abort",()=>{a=!0,n.postMessage({action:"download-abort"})}),delete r.signal);const o=await Da(e,Un),i=await Da(e,"");return await new Promise((s,l)=>{n.postMessage({action:"download",url:e,filename:i,metadataFileName:o,options:{headers:r.headers,aborted:a}}),n.onmessage=c=>{var d;if(c.data.ok)n.terminate(),s();else if(c.data.err)n.terminate(),l(c.data.err);else if(c.data.progress){const u=c.data.progress;(d=r.progressCallback)==null||d.call(r,u)}else l(new Error("Unknown message from worker")),console.error("Unknown message from worker",c.data)}})}async open(e){return await a0(e)}async getSize(e){return await uN(e)}async getMetadata(e){const r=await a0(e,Un),n=await this.getSize(e);if(!r)return n>0?{etag:vf,originalSize:n,originalURL:""}:null;try{return await new Response(r).json()}catch{return null}}async list(){const e=await vl(),r=[],n={};for await(let[a,o]of e.entries())if(o.kind==="file"&&a.startsWith(Un)){const i=(await o.getFile()).stream(),s=await new Response(i).json().catch(l=>null);n[a.replace(Un,"")]=s}for await(let[a,o]of e.entries())o.kind==="file"&&!a.startsWith(Un)&&r.push({name:a,size:await o.getFile().then(i=>i.size),metadata:n[a]||{originalSize:(await o.getFile()).size,originalURL:"",etag:""}});return r}async clear(){await this.deleteMany(()=>!0)}async delete(e){const r=await this.getNameFromURL(e);await this.deleteMany(n=>n.name===e||n.name===r)}async deleteMany(e){const r=await vl(),n=await this.list();for(const a of n)e(a)&&r.removeEntry(a.name)}async writeMetadata(e,r){const n=new Blob([JSON.stringify(r)],{type:"text/plain"});await n0(e,n.stream(),Un)}}async function n0(t,e,r=""){try{const n=await Da(t,r),a=await hN(n);await a.truncate(0);const o=e.getReader();for(;;){const{done:i,value:s}=await o.read();if(i)break;await a.write(s)}await a.close()}catch(n){console.error("opfsWrite",n)}}async function a0(t,e=""){const r=async o=>{try{return await(await(await vl()).getFileHandle(o)).getFile()}catch{return null}};let n=await r(t);if(n)return n;const a=await Da(t,e);return n=await r(a),n}async function uN(t,e=""){try{const r=await vl(),n=await Da(t,e);return(await(await r.getFileHandle(n)).getFile()).size}catch{return-1}}async function Da(t,e){const r=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(t)),n=Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("");return`${e}${n}_${t.split("/").pop()}`}async function vl(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("cache",{create:!0})}async function hN(t){const e=_l(qh);let r,n;e.onmessage=o=>{o.data.ok?r(null):o.data.err&&n(o.data.err)};const a=o=>new Promise((i,s)=>{r=i,n=s,e.postMessage(o,Gh()?void 0:{transfer:o.value?[o.value.buffer]:[]})});return await a({open:t}),{truncate:async()=>{},write:o=>a({value:o}),close:async()=>{await a({done:!0}),e.terminate()}}}const pN=3;wf=(t=>(t.VALID="valid",t.INVALID="invalid",t.DELETED="deleted",t))(wf||{}),Ti=class{constructor(t,e,r){ae(this,"modelManager");ae(this,"url");ae(this,"size");ae(this,"files");this.modelManager=t,this.url=e,r?(this.files=this.getAllFiles(r),this.size=yl(this.files.map(n=>n.metadata.originalSize))):(this.files=[],this.size=0)}async open(){if(this.size===-1)throw new Ce("Model is deleted from the cache; Call ModelManager.downloadModel to re-download the model","load_error");const t=[];for(const e of this.files){const r=await this.modelManager.cacheManager.open(e.name);if(!r)throw new Error(`Failed to open file ${e.name}; Hint: the model may be invalid, please refresh it`);t.push(r)}return t}validate(){const t=Xn.parseModelUrl(this.url).length;if(this.size===-1)return"deleted";if(this.size<16||this.files.length!==t)return"invalid";for(const e of this.files)if(!e.metadata||e.metadata.originalSize!==e.size)return"invalid";return"valid"}async refresh(t={}){const e=Xn.parseModelUrl(this.url),r=e.map((l,c)=>({url:l,index:c}));this.modelManager.logger.debug("Downloading model files:",e);const n=this.modelManager.params.parallelDownloads??pN,a=await this.getTotalDownloadSize(e),o=[],i=async()=>{for(;r.length>0;){const l=r.shift();if(!l)break;await this.modelManager.cacheManager.download(l.url,{...t,progressCallback:({loaded:c})=>{var d;o[l.index]=c,(d=t.progressCallback)==null||d.call(t,{loaded:yl(o),total:a})}})}},s=[];for(let l=0;l<n;l++)s.push(i()),o.push(0);await Promise.all(s),this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),this.size=this.files.reduce((l,c)=>l+c.metadata.originalSize,0)}async remove(){this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),await this.modelManager.cacheManager.deleteMany(t=>!!this.files.find(e=>e.name===t.name)),this.size=-1}getAllFiles(t){const e=new Set(Xn.parseModelUrl(this.url)),r=[];for(const n of e){const a=t.find(o=>o.metadata.originalURL===n);if(!a)throw new Error(`Model file not found: ${n}`);r.push(a)}return r.sort((n,a)=>n.metadata.originalURL.localeCompare(a.metadata.originalURL)),r}async getTotalDownloadSize(t){const e=(await Promise.all(t.map(r=>fetch(r,{method:"HEAD"})))).map(r=>Number(r.headers.get("content-length")||"0"));return yl(e)}},Xn=class{constructor(t={}){ae(this,"cacheManager");ae(this,"params");ae(this,"logger");this.cacheManager=t.cacheManager||new r0,this.params=t,this.logger=t.logger||console}static parseModelUrl(t){var i;if(Array.isArray(t))return t;const e=/-(\d{5})-of-(\d{5})\.gguf(?:\?.*)?$/,r=((i=t.match(/\.gguf(\?.*)?$/))==null?void 0:i[1])??"",n=t.match(e);if(!n)return[t];const a=t.replace(e,""),o=n[2];return Array.from({length:Number(o)},(s,l)=>(l+1).toString().padStart(5,"0")).map(s=>`${a}-${s}-of-${o}.gguf${r}`)}async getModels(t={}){const e=await this.cacheManager.list();let r=[];for(const n of e){const a=Xn.parseModelUrl(n.metadata.originalURL);(a.length===1||a[0]===n.metadata.originalURL)&&r.push(new Ti(this,n.metadata.originalURL,e))}return t.includeInvalid||(r=r.filter(n=>n.validate()==="valid")),r}async downloadModel(t,e={}){if(!hc(t))throw new Ce(`Invalid model URL: ${t}; URL must ends with ".gguf"`,"download_error");const r=new Ti(this,t,void 0);return r.validate()!=="valid"&&await r.refresh(e),r}async getModelOrDownload(t,e={}){var n;const r=(await this.getModels()).find(a=>a.url===t);return r?((n=e.progressCallback)==null||n.call(e,{loaded:r.size,total:r.size}),r):this.downloadModel(t,e)}async clear(){await this.cacheManager.clear()}};let o0,i0;o0=/^([a-zA-Z0-9_\-\.]+)\/([a-zA-Z0-9_\-\.]+)$/,i0="Hugging Face model ID is incorrect. Only regular alphanumeric characters, '-', '.' and '_' supported",K0={...console,debug:()=>{}},Ce=class extends Error{constructor(e,r="unknown_error"){super(e);ae(this,"type");this.type=r}},ec=class extends Error{constructor(){super("Operation aborted");ae(this,"name","AbortError")}},_f=class{constructor(t,e={}){ae(this,"cacheManager");ae(this,"modelManager");ae(this,"proxy",null);ae(this,"config");ae(this,"pathConfig");ae(this,"useMultiThread",!1);ae(this,"nbThreads",1);ae(this,"useEmbeddings",!1);ae(this,"loadedContextInfo",null);ae(this,"bosToken",-1);ae(this,"eosToken",-1);ae(this,"eotToken",-1);ae(this,"eogTokens",new Set);ae(this,"addBosToken",!1);ae(this,"addEosToken",!1);ae(this,"chatTemplate");ae(this,"metadata");ae(this,"samplingConfig",{});ae(this,"hasEncoder",!1);ae(this,"decoderStartToken",-1);ae(this,"nCachedTokens",0);if(Kb(),!t)throw new Ce("AssetsPathConfig is required");this.pathConfig=t,this.config=e,this.cacheManager=e.cacheManager??new r0,this.modelManager=e.modelManager??new Xn({cacheManager:this.cacheManager,logger:e.logger??console,parallelDownloads:e.parallelDownloads,allowOffline:e.allowOffline})}logger(){return this.config.logger??console}checkModelLoaded(){if(!this.isModelLoaded())throw new Ce("loadModel() is not yet called","model_not_loaded")}isModelLoaded(){return!!this.proxy&&!!this.metadata}getBOS(){return this.bosToken}getEOS(){return this.eosToken}getEOT(){return this.eotToken}isTokenEOG(t){return t===this.eosToken||t===this.eotToken||this.eogTokens.has(t)}getDecoderStartToken(){return this.decoderStartToken}getModelMetadata(){return this.checkModelLoaded(),this.metadata}isMultithread(){return this.checkModelLoaded(),this.useMultiThread}getNumThreads(){return this.checkModelLoaded(),this.useMultiThread?this.nbThreads:1}isEncoderDecoderArchitecture(){return this.checkModelLoaded(),this.hasEncoder}mustAddBosToken(){return this.checkModelLoaded(),this.addBosToken}mustAddEosToken(){return this.checkModelLoaded(),this.addEosToken}getChatTemplate(){return this.checkModelLoaded(),this.chatTemplate??null}async loadModelFromUrl(t,e={}){const r=Wh(t)?t:t[0],n=await(e.useCache??!0?await this.modelManager.getModelOrDownload(r,e):await this.modelManager.downloadModel(r,e)).open();return await this.loadModel(n,e)}async loadModelFromHF(t,e,r={}){if(!t.match(o0))throw new Ce(i0,"download_error");if(!hc(e))throw new Ce("Only GGUF file is supported","download_error");return await this.loadModelFromUrl(`https://huggingface.co/${t}/resolve/main/${e}`,r)}async loadModel(t,e={}){const r=t instanceof Ti?await t.open():[...t];if(r.some(h=>h.size===0))throw new Ce("Input model (or splits) must be non-empty Blob or File","load_error");if(qb(r),this.proxy)throw new Ce("Module is already initialized","load_error");const n=await Vb();n||this.logger().warn("Multi-threads are not supported in this environment, falling back to single-thread");const a=!!this.pathConfig["multi-thread/wllama.wasm"];a||this.logger().warn('Missing paths to "multi-thread/wllama.wasm", falling back to single-thread');const o=Math.floor((navigator.hardwareConcurrency||1)/2),i=e.n_threads??o;this.nbThreads=i,this.useMultiThread=n&&a&&i>1;const s=this.useMultiThread?{"wllama.wasm":Hh(this.pathConfig["multi-thread/wllama.wasm"])}:{"wllama.wasm":Hh(this.pathConfig["single-thread/wllama.wasm"])};this.proxy=new dN(s,this.useMultiThread?i:1,this.config.suppressNativeLog??!1,this.logger());const l=r.map((h,p)=>({name:`model-${p}.gguf`,blob:h}));await this.proxy.moduleInit(l);const c=await this.proxy.wllamaStart();if(!c.success)throw new Ce(`Error while calling start function, result = ${c}`);const d=await this.proxy.wllamaAction("load",{_name:"load_req",use_mmap:!0,use_mlock:!0,n_gpu_layers:0,seed:e.seed||Math.floor(Math.random()*1e5),n_ctx:e.n_ctx||1024,n_threads:this.useMultiThread?i:1,n_ctx_auto:!1,model_paths:l.map(h=>`models/${h.name}`),embeddings:e.embeddings,offload_kqv:e.offload_kqv,n_batch:e.n_batch,pooling_type:e.pooling_type,rope_scaling_type:e.rope_scaling_type,rope_freq_base:e.rope_freq_base,rope_freq_scale:e.rope_freq_scale,yarn_ext_factor:e.yarn_ext_factor,yarn_attn_factor:e.yarn_attn_factor,yarn_beta_fast:e.yarn_beta_fast,yarn_beta_slow:e.yarn_beta_slow,yarn_orig_ctx:e.yarn_orig_ctx,cache_type_k:e.cache_type_k,cache_type_v:e.cache_type_v,n_seq_max:1}),u={...d,metadata:{}};for(let h=0;h<d.metadata_key.length;h++)u.metadata[d.metadata_key[h]]=d.metadata_val[h];this.bosToken=u.token_bos,this.eosToken=u.token_eos,this.eotToken=u.token_eot,this.useEmbeddings=!!e.embeddings,this.metadata={hparams:{nVocab:u.n_vocab,nCtxTrain:u.n_ctx_train,nEmbd:u.n_embd,nLayer:u.n_layer},meta:u.metadata},this.hasEncoder=!!u.has_encoder,this.decoderStartToken=u.token_decoder_start,this.addBosToken=u.add_bos_token,this.addEosToken=u.add_eos_token,this.chatTemplate=u.metadata["tokenizer.chat_template"],this.loadedContextInfo=u,this.eogTokens=new Set(u.list_tokens_eog),this.logger().debug({loadedCtxInfo:u})}getLoadedContextInfo(){if(this.checkModelLoaded(),!this.loadedContextInfo)throw new Ce("Loaded context info is not available");return{...this.loadedContextInfo}}async createEmbedding(t,e={}){this.checkModelLoaded();const r={skipBOS:!1,skipEOS:!1,...e};await this.samplingInit(this.samplingConfig),await this.kvClear();const n=await this.tokenize(t);return this.bosToken&&!r.skipBOS&&n.unshift(this.bosToken),this.eosToken&&!r.skipEOS&&n.push(this.eosToken),await this.embeddings(n)}async createChatCompletion(t,e){const r=await this.formatChat(t,!0);return e.stream?await this.createCompletionGenerator(r,e):await this.createCompletion(r,{...e,stream:!1})}async createCompletion(t,e){return e.stream?await this.createCompletionGenerator(t,e):await this.createCompletionImpl(t,{...e,stream:!1})}async createCompletionImpl(t,e){var s;this.checkModelLoaded(),this.samplingConfig=e.sampling??{},await this.samplingInit(this.samplingConfig);const r=new Set(e.stopTokens??[]);let n=await this.tokenize(t,!0);this.addBosToken&&n[0]!==this.bosToken&&n.unshift(this.bosToken),e.useCache?n=await this.computeNonCachedTokens(n):await this.kvClear(),await this.samplingAccept(n),this.isEncoderDecoderArchitecture()?(await this.encode(n),await this.decode([this.getDecoderStartToken()],{})):await this.decode(n,{});let a=new Uint8Array,o=!1;const i=()=>{o=!0};for(let l=0;l<(e.nPredict??1/0);l++){const c=await this.samplingSample();if(this.isTokenEOG(c.token)||r.has(c.token)||(a=Wb([a,c.piece]),e.onNewToken&&e.onNewToken(c.token,c.piece,gl(a),{abortSignal:i}),o||((s=e.abortSignal)==null?void 0:s.aborted)))break;await this.samplingAccept([c.token]),await this.decode([c.token],{})}return gl(a)}createCompletionGenerator(t,e){return new Promise((r,n)=>{const a=Xb(o=>{this.createCompletionImpl(t,{...e,onNewToken:(i,s,l)=>{o({token:i,piece:s,currentText:l},!1)}}).catch(n).then(()=>{o(void 0,!0)})});r(a())})}async samplingInit(t,e=[]){this.checkModelLoaded(),this.samplingConfig=t;const r=t.logit_bias??[],n=r.map(o=>o.token),a=r.map(o=>o.bias);if(!(await this.proxy.wllamaAction("sampling_init",{_name:"sint_req",...t,logit_bias_toks:n,logit_bias_vals:a,tokens:e})).success)throw new Ce("Failed to initialize sampling")}async getVocab(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("get_vocab",{_name:"gvoc_req"})).vocab}async lookupToken(t){this.checkModelLoaded();const e=await this.proxy.wllamaAction("lookup_token",{_name:"lkup_req",piece:t});return e.success?e.token:-1}async tokenize(t,e=!0){return this.checkModelLoaded(),(await this.proxy.wllamaAction("tokenize",{_name:"tokn_req",text:t,special:!!e})).tokens}async detokenize(t,e=!1){this.checkModelLoaded();const r=await this.proxy.wllamaAction("detokenize",{_name:"dtkn_req",tokens:t});return e?gl(r.buffer):r.buffer}async decode(t,e){var a;if(this.checkModelLoaded(),this.useEmbeddings)throw new Ce("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.");if(t.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ce("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const r=this.breakTokensIntoBatches(t,this.loadedContextInfo.n_batch);let n;for(let o=0;o<r.length;o++){if((a=e==null?void 0:e.abortSignal)!=null&&a.aborted)throw new ec;const i=r.length>1&&o<r.length-1;if(n=await this.proxy.wllamaAction("decode",{_name:"deco_req",tokens:r[o],skip_logits:e.skipLogits||i}),n.error)throw new Ce(n.error);if(!n.success)throw new Ce("Cannot encode, unknown error")}return this.nCachedTokens=n.n_past,{nPast:n.n_past}}async encode(t,e){var a;if(this.checkModelLoaded(),!this.hasEncoder)throw new Ce("This model does not use encoder-decoder architecture.","inference_error");if(this.useEmbeddings)throw new Ce("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.","inference_error");if(t.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ce("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const r=this.breakTokensIntoBatches(t,this.loadedContextInfo.n_batch);let n;for(let o=0;o<r.length;o++){if((a=e==null?void 0:e.abortSignal)!=null&&a.aborted)throw new ec;if(n=await this.proxy.wllamaAction("encode",{_name:"enco_req",tokens:r[o]}),n.error)throw new Ce(n.error);if(!n.success)throw new Ce("Cannot encode, unknown error")}return this.nCachedTokens=n.n_past,{nPast:n.n_past}}breakTokensIntoBatches(t,e){const r=[];for(let n=0;n<t.length;n+=e)r.push(t.slice(n,n+e));return r}async samplingSample(){this.checkModelLoaded();const t=await this.proxy.wllamaAction("sampling_sample",{_name:"ssam_req"});return{piece:t.piece,token:t.token}}async samplingAccept(t){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("sampling_accept",{_name:"sacc_req",tokens:t})).success)throw new Ce("samplingAccept unknown error")}async getLogits(t=40){this.checkModelLoaded();const e=await this.proxy.wllamaAction("get_logits",{_name:"glog_req",top_k:t}),r=[];for(let n=0;n<e.tokens.length;n++)r.push({token:e.tokens[n],p:e.probs[n]});return r}async embeddings(t){if(this.checkModelLoaded(),!this.useEmbeddings)throw new Ce("embeddings is disabled. Use wllama.setOptions({ embeddings: true }) to enable it.","inference_error");if(this.nCachedTokens>0&&this.logger().warn("Embeddings: KV cache is not empty, this may produce incorrect results"),this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ce("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");if(t.length>this.loadedContextInfo.n_batch)throw new Ce("Embedding tokens does not fit into batch. Please increase n_batch when loading the model","inference_error");if(t.length>this.loadedContextInfo.n_ubatch)throw new Ce("Embedding tokens does not fit into physical batch. Please increase n_ubatch when loading the model","inference_error");const e=await this.proxy.wllamaAction("embeddings",{_name:"gemb_req",tokens:t});if(e.success)return e.embeddings;throw new Ce("embeddings unknown error")}async kvRemove(t,e){if(this.checkModelLoaded(),e!==0){if(!(await this.proxy.wllamaAction("kv_remove",{_name:"kvcr_req",n_keep:t,n_discard:e})).success)throw new Ce("kvRemove unknown error");this.nCachedTokens-=e}}async kvClear(){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("kv_clear",{_name:"kvcc_req"})).success)throw new Ce("kvClear unknown error");this.nCachedTokens=0}async formatChat(t,e,r){this.checkModelLoaded();const n=t.map(i=>i.role),a=t.map(i=>i.content),o=await this.proxy.wllamaAction("chat_format",{_name:"cfmt_req",roles:n,contents:a,tmpl:r,add_ass:e});if(!o.success)throw new Ce("formatChat unknown error");return o.formatted_chat}async setOptions(t){this.checkModelLoaded(),await this.proxy.wllamaAction("set_options",{_name:"opti_req",...t}),this.useEmbeddings=t.embeddings}async exit(){var t;await((t=this.proxy)==null?void 0:t.wllamaExit()),this.proxy=null}async _getDebugInfo(){return this.checkModelLoaded(),await this.proxy.wllamaDebug()}async _testBenchmark(t,e){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_benchmark",{_name:"tben_req",type:t,n_samples:e})}async _testPerplexity(t){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_perplexity",{_name:"tper_req",tokens:t})}async getCachedTokens(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("current_status",{_name:"stat_req"})).tokens}async computeNonCachedTokens(t){const e=await this.getCachedTokens();let r=0;for(;r<Math.min(e.length,t.length)&&e[r]===t[r];r++);return this.logger().debug(`Cache nKeep=${r}`),await this.kvRemove(r,-1),t.slice(r,t.length)}};const fN="/NoLLMChat/assets/wllama-nCpn4NuL.wasm",mN="/NoLLMChat/assets/wllama-Rp7xpeNM.wasm",s0=t=>t.reduce((e,r)=>"text"in r?`${e} ${r.text}`:e,""),Vh=t=>typeof t=="string"?t:Array.isArray(t)?s0(t):typeof t.content=="string"?t.content:s0(t.content);function gN(t){if(typeof t=="string"||!Array.isArray(t))return[{role:"user",content:typeof t=="string"?t:t.toString()}];const e=[];return t.map(r=>{if(typeof r=="string")e.push({role:"assistant",content:r});else if(r instanceof to)e.push({role:"user",content:Vh(r.content)});else if(r instanceof Zn)e.push({role:"assistant",content:Vh(r.content)});else if(r instanceof ao)e.push({role:"system",content:Vh(r.content)});else throw new Error(`Invalid message type ${JSON.stringify(r)}`)}),e}const yN={"single-thread/wllama.wasm":fN,"multi-thread/wllama.wasm":mN};let $r;L0=async(t,e)=>{var i;$r=new _f(yN,{logger:{debug:(...s)=>g0(...s),log:(...s)=>QN(...s),warn:(...s)=>yn(...s),error:(...s)=>Ml(...s)}});const r=({loaded:s,total:l})=>{var u;const c=Math.round(s/l*100),d=`Downloading... ${c}%`;(u=e.callback)==null||u.call(e,{text:d,progress:c,timeElapsed:0})},[n,a,...o]=t.split("/");await $r.loadModelFromHF(`${n}/${a}`,o.join("/"),{progressCallback:r}),(i=e.callback)==null||i.call(e,{text:"Model loaded!",progress:100,timeElapsed:0})},df=async function(){await($r==null?void 0:$r.exit()),$r=void 0},uf=async function(t,e){var o,i,s,l,c,d,u,h;let r="";const n=gN(t),a=await($r==null?void 0:$r.createChatCompletion(n,{nPredict:(o=e==null?void 0:e.configurable)!=null&&o.nPredict?+((i=e==null?void 0:e.configurable)==null?void 0:i.nPredict):void 0,sampling:{temp:(s=e==null?void 0:e.configurable)!=null&&s.temperature?+((l=e==null?void 0:e.configurable)==null?void 0:l.temperature):void 0,top_k:(c=e==null?void 0:e.configurable)!=null&&c.topK?+((d=e==null?void 0:e.configurable)==null?void 0:d.topK):void 0,top_p:(u=e==null?void 0:e.configurable)!=null&&u.topP?+((h=e==null?void 0:e.configurable)==null?void 0:h.topP):void 0},onNewToken:(p,f,g)=>{var _;const m=g.slice(r.length);(_=e.onNewToken)==null||_.call(e,p,f,m),r=g}}));return new Zn(a||"")};const _N={ready:!0,initializing:{loading:!1},selectedModel:void 0,isLoaded:!1,init:()=>{},destroy:()=>{},loadModel:async(t,e)=>{},unLoadModel:()=>{},chatCompletion:async function*(t,e){const{stream:r=!0,response_format:n,tools:a}=e;if((n==null?void 0:n.type)==="json_object")throw new Error("Structured output not supported in Wllama yet");if(a!=null&&a.length)throw new Error("Function calling not supported in Wllama yet");if(!r)throw new Error("Non-streaming mode not supported in Wllama yet");let o="";await uf(t,{onNewToken:(i,s,l)=>{o+=l}}),yield{content:o}},getCurrentModelInfo:async()=>({model:void 0})},vN=t=>({setLoaded:e=>t(r=>({...r,isLoaded:e}))});Al()(Tl((t,e)=>({..._N,...vN(t)})));const wN=y.memo(({children:t})=>{const e=Gl(o=>o.destroy),r=$l(o=>o.destroy),n=Gl(o=>o.init),a=$l(o=>o.init);return y.useEffect(()=>(n(),a(),()=>{e(),r(),df().catch(()=>{})}),[e,r,n,a]),t});function l0(t){return e=>w.jsx(wN,{children:w.jsx(t,{...e})})}const bN=y.lazy(()=>Ka(()=>import("./ChatApplication-601C7v2Y.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),EN=y.lazy(()=>Ka(()=>import("./EditorApplication-CDBBtnuO.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([13,1,2,8,9,10]))),SN=y.lazy(()=>Ka(()=>import("./VSLiteApplication-Bne2hI2K.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([14,1,2,8,9,10,15])));function xN(){var r;const t=Hr(n=>n.currentSession),e=y.useMemo(()=>{var n,a;if(!(t!=null&&t.id))return w.jsx(Ya,{simple:!0,className:"w-full h-full"});if(t.main_source_type==="Thread")return w.jsx(bN,{});if(((n=t.main_node)==null?void 0:n.node_type)==="EDITOR_APP")return w.jsx(EN,{});if(((a=t.main_node)==null?void 0:a.node_type)==="VSLITE_APP")return w.jsx(SN,{})},[t==null?void 0:t.id,t==null?void 0:t.main_source_type,(r=t==null?void 0:t.main_node)==null?void 0:r.node_type]);return w.jsx(y.Suspense,{fallback:w.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:e})}const kN=l0(xN),AN=y.lazy(()=>Ka(()=>import("./Home-BgNY-_7t.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([16,1,2,7,4,8,9,10,5,6,17,18,15]))),TN=()=>w.jsx(y.Suspense,{fallback:w.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:w.jsx(AN,{})}),MN=l0(TN),FN=y.lazy(()=>Ka(()=>import("./DocumentViewer-SyykF__R.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([19,1,2,20]))),RN=()=>{const{documentId:t}=dm();return w.jsx(y.Suspense,{fallback:w.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:w.jsx(FN,{name:t||""})})},ON=y.lazy(()=>Ka(()=>import("./SessionList-bDuR3upu.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([21,1,2,18,11,12]))),NN=()=>w.jsx(y.Suspense,{fallback:w.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:w.jsx(ON,{})});function ri(){const t=um();return Ml("[ERROR]",t),w.jsx(m0,{})}const IN=fS(w.jsxs(Mr,{errorElement:w.jsx(ri,{}),children:[w.jsxs(Mr,{element:w.jsx(I_,{requiredSession:!0}),children:[w.jsx(Mr,{path:On.whiteboard,Component:MN,errorElement:w.jsx(ri,{})}),w.jsx(Mr,{path:On.application,errorElement:w.jsx(ri,{}),Component:kN}),w.jsx(Mr,{path:"*",element:w.jsx(uS,{to:On.sessions})})]}),w.jsxs(Mr,{element:w.jsx(I_,{}),children:[w.jsx(Mr,{path:On.document,errorElement:w.jsx(ri,{}),Component:RN}),w.jsx(Mr,{path:On.sessions,errorElement:w.jsx(ri,{}),Component:NN})]})]})),PN=(t,e)=>{switch(dy){case"browser":return wm(t,e);case"hash":return DS(t);default:return wm(t,e)}},CN=PN(IN,{basename:"/NoLLMChat/"});g0("[BASE_URL]","/NoLLMChat/");let c0;c0=y.memo(()=>{const t=!window.location.pathname.includes("/NoLLMChat/");return y.useLayoutEffect(()=>{t&&(window.location.href="/NoLLMChat/".replace("//","/"))},[t]),t?w.jsx(Ya,{className:"w-screen h-screen",simple:!0}):w.jsx(JS,{router:CN})},()=>!0),q0=Object.freeze(Object.defineProperty({__proto__:null,default:c0},Symbol.toStringTag,{value:"Module"}))});export{np as $,Zn as A,zr as B,Xa as C,Qa as D,eo as E,De as F,Jn as G,to as H,ap as I,ro as J,Fl as K,op as L,Rl as M,Ur as N,no as O,Ol as P,ip as Q,Nl as R,ao as S,y0 as T,sp as U,Br as V,_0 as W,lp as X,cp as Y,dp as Z,up as _,tI as __tla,oo as a,hp as a$,pp as a0,fp as a1,mp as a2,Il as a3,Bt as a4,gp as a5,Pl as a6,yp as a7,_p as a8,Cl as a9,vp as aA,Kn as aB,St as aC,it as aD,wp as aE,Ie as aF,jl as aG,bp as aH,Ep as aI,Sp as aJ,Ot as aK,v0 as aL,xp as aM,w0 as aN,kp as aO,Ll as aP,Ap as aQ,Tp as aR,Mp as aS,Fp as aT,Rp as aU,Op as aV,Np as aW,Ip as aX,Pp as aY,Cp as aZ,jp as a_,Dl as aa,Ht as ab,io as ac,Lp as ad,Dp as ae,st as af,$p as ag,zp as ah,_n as ai,Up as aj,$l as ak,Bp as al,yi as am,_i as an,so as ao,zl as ap,vi as aq,wi as ar,Ul as as,Bl as at,bi as au,b0 as av,Hp as aw,E0 as ax,S0 as ay,Ei as az,Wp as b,cr as b$,Gp as b0,qp as b1,Vp as b2,Hl as b3,Wl as b4,Gl as b5,ql as b6,x0 as b7,Zp as b8,dr as b9,k0 as bA,A0 as bB,Vl as bC,T0 as bD,Jp as bE,Kp as bF,Si as bG,vn as bH,M0 as bI,F0 as bJ,R0 as bK,O0 as bL,Yp as bM,N0 as bN,lo as bO,Xp as bP,Qp as bQ,I0 as bR,Zl as bS,P0 as bT,Jl as bU,Kl as bV,co as bW,Yl as bX,Xl as bY,ef as bZ,Ql as b_,xi as ba,tf as bb,rf as bc,nf as bd,C0 as be,uo as bf,af as bg,of as bh,ki as bi,sf as bj,lf as bk,cf as bl,j0 as bm,wn as bn,L0 as bo,df as bp,uf as bq,bn as br,hf as bs,Ai as bt,D0 as bu,$0 as bv,pf as bw,ho as bx,ur as by,z0 as bz,U0 as c,Wt as c0,Yn as c1,B0 as c2,H0 as c3,W0 as c4,G0 as c5,ff as c6,mf as c7,gf as c8,yf as c9,ec as cA,_f as cB,vf as cC,wf as cD,Ti as cE,Xn as cF,bf as cG,q0 as cH,Ef as ca,Sf as cb,tc as cc,xf as cd,V0 as ce,rc as cf,nc as cg,ac as ch,kf as ci,oc as cj,ic as ck,sc as cl,lc as cm,cc as cn,dc as co,Af as cp,Tf as cq,Z0 as cr,Mf as cs,Ff as ct,Rf as cu,J0 as cv,uc as cw,hc as cx,K0 as cy,Ce as cz,pc as d,fc as e,Qn as f,We as g,ea as h,En as i,Of as j,mc as k,gc as l,yc as m,Nf as n,Sn as o,_t as p,Mi as q,If as r,_c as s,vc as t,Hr as u,wc as v,bc as w,Ec as x,Sc as y,Fi as z};
