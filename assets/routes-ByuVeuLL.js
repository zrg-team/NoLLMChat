const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatApplication-DcNxDajf.js","assets/index-Co7wP9ul.js","assets/index-T6762bQa.css","assets/index-BdpfNFTx.js","assets/toNumber-DlbP0hfD.js","assets/popover-PAGC2fag.js","assets/index-BeQAAAW1.js","assets/chunk-CHthsvU9.js","assets/LLMIcon-CfRRgf8O.js","assets/dot-JbuSMMEk.js","assets/createLucideIcon-CCZKp6dZ.js","assets/alert-dialog-CSC1NOmJ.js","assets/index-D3h_LP7X.js","assets/EditorApplication-BX4Ph5-G.js","assets/VSLiteApplication-jz_3VUza.js","assets/file-tree-B_cEp8uc.js","assets/Home-B_L1j9Wn.js","assets/index-MBJNyinf.js","assets/plate-editor-cSYeR7vw.js","assets/DocumentViewer-BJK3jKm-.js","assets/index-Ch_M2Zi9.js","assets/SessionList-CbGJ9j_E.js"])))=>i.map(i=>d[i]);
var GN=Object.defineProperty;var qN=(qt,pr,ra)=>pr in qt?GN(qt,pr,{enumerable:!0,configurable:!0,writable:!0,value:ra}):qt[pr]=ra;var ae=(qt,pr,ra)=>qN(qt,typeof pr!="symbol"?pr+"":pr,ra);import{r as g,z as Kb,t as hi,ab as VN,a as pi,f as Za,j as v,P as Qe,b as be,h as Tr,u as Rt,c as me,v as bl,a3 as _n,s as Zn,a4 as qh,ac as ZN,a6 as Vh,L as Ke,S as JN,ad as KN,d as fi,o as YN,Y as vn,y as El,T as Zh,V as Jh,p as XN,q as Yb,e as QN,Q as Xb,ae as Qb,af as eI,R as tI,W as Sl,ag as e0,g as Ja,B as Kh,E as mi,ah as rI,ai as nI,a7 as t0,a8 as aI,_ as Ka,D as Ya,__tla as oI}from"./index-Co7wP9ul.js";let Yh,Jn,Hr,Xa,Qa,Kn,He,eo,to,Xh,xl,kl,Qh,Bt,ep,ro,Al,tp,Tl,no,r0,rp,Wr,n0,np,ap,op,ip,ao,a0,sp,lp,Ml,Ht,cp,Fl,up,dp,Rl,Ol,o0,hp,ur,gi,Yn,i0,Et,oo,it,pp,fp,yi,mp,_i,st,gp,yp,wn,_p,Nl,io,Il,vi,wi,Pl,Cl,bi,Wt,so,vp,jl,wp,bp,Ep,Sp,xp,kp,Ap,Tp,Mp,Fp,Rp,Op,Np,Ip,Pp,Ll,Dl,Cp,$l,Ei,Si,zl,jp,Lp,Dp,s0,l0,$p,zp,Up,Bp,c0,bn,u0,d0,lo,Hp,Wp,Gp,h0,Ul,p0,Bl,Hl,co,Wl,Gl,qp,ql,dr,Gt,Xn,f0,m0,g0,y0,Vp,Zp,Jp,Vl,Kp,_0,En,Yp,xi,v0,w0,Ie,Xp,uo,hr,Ot,b0,E0,S0,Zl,x0,Qp,ef,tf,ki,Sn,k0,A0,T0,M0,rf,F0,nf,Jl,af,R0,Kl,Yl,Xl,of,Ql,ec,tc,rc,nc,ac,sf,lf,O0,cf,uf,df,N0,oc,I0,Ce,ic,hf,pf,ff,Ai,Qn,mf,P0,sc,lc,ea,We,ta,xn,gf,cc,uc,yf,kn,Ti,yt,_f,dc,hc,pc,Gr,fc,mc,gc,Mi,ho,iI=Promise.all([(()=>{try{return oI}catch{}})()]).then(async()=>{var qt={},pr;function ra(){if(pr)return qt;pr=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.parse=i,qt.serialize=c;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,o=(()=>{const h=function(){};return h.prototype=Object.create(null),h})();function i(h,p){const f=new o,y=h.length;if(y<2)return f;const m=(p==null?void 0:p.decode)||u;let _=0;do{const w=h.indexOf("=",_);if(w===-1)break;const A=h.indexOf(";",_),F=A===-1?y:A;if(w>F){_=h.lastIndexOf(";",w-1)+1;continue}const b=s(h,_,w),D=l(h,w,b),B=h.slice(b,D);if(f[B]===void 0){let j=s(h,w+1,F),G=l(h,F,j);const te=m(h.slice(j,G));f[B]=te}_=F+1}while(_<y);return f}function s(h,p,f){do{const y=h.charCodeAt(p);if(y!==32&&y!==9)return p}while(++p<f);return f}function l(h,p,f){for(;p>f;){const y=h.charCodeAt(--p);if(y!==32&&y!==9)return p+1}return f}function c(h,p,f){const y=(f==null?void 0:f.encode)||encodeURIComponent;if(!t.test(h))throw new TypeError(`argument name is invalid: ${h}`);const m=y(p);if(!e.test(m))throw new TypeError(`argument val is invalid: ${p}`);let _=h+"="+m;if(!f)return _;if(f.maxAge!==void 0){if(!Number.isInteger(f.maxAge))throw new TypeError(`option maxAge is invalid: ${f.maxAge}`);_+="; Max-Age="+f.maxAge}if(f.domain){if(!r.test(f.domain))throw new TypeError(`option domain is invalid: ${f.domain}`);_+="; Domain="+f.domain}if(f.path){if(!n.test(f.path))throw new TypeError(`option path is invalid: ${f.path}`);_+="; Path="+f.path}if(f.expires){if(!d(f.expires)||!Number.isFinite(f.expires.valueOf()))throw new TypeError(`option expires is invalid: ${f.expires}`);_+="; Expires="+f.expires.toUTCString()}if(f.httpOnly&&(_+="; HttpOnly"),f.secure&&(_+="; Secure"),f.partitioned&&(_+="; Partitioned"),f.priority)switch(typeof f.priority=="string"?f.priority.toLowerCase():void 0){case"low":_+="; Priority=Low";break;case"medium":_+="; Priority=Medium";break;case"high":_+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${f.priority}`)}if(f.sameSite)switch(typeof f.sameSite=="string"?f.sameSite.toLowerCase():f.sameSite){case!0:case"strict":_+="; SameSite=Strict";break;case"lax":_+="; SameSite=Lax";break;case"none":_+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${f.sameSite}`)}return _}function u(h){if(h.indexOf("%")===-1)return h;try{return decodeURIComponent(h)}catch{return h}}function d(h){return a.call(h)==="[object Date]"}return qt}ra();var vf="popstate";function C0(t={}){function e(n,a){let{pathname:o,search:i,hash:s}=n.location;return na("",{pathname:o,search:i,hash:s},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function r(n,a){return typeof a=="string"?a:Mr(a)}return bf(e,r,null,t)}function j0(t={}){function e(a,o){let{pathname:i="/",search:s="",hash:l=""}=Fr(a.location.hash.substring(1));return!i.startsWith("/")&&!i.startsWith(".")&&(i="/"+i),na("",{pathname:i,search:s,hash:l},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(a,o){let i=a.document.querySelector("base"),s="";if(i&&i.getAttribute("href")){let l=a.location.href,c=l.indexOf("#");s=c===-1?l:l.slice(0,c)}return s+"#"+(typeof o=="string"?o:Mr(o))}function n(a,o){rt(a.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(o)})`)}return bf(e,r,n,t)}function xe(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function rt(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function L0(){return Math.random().toString(36).substring(2,10)}function wf(t,e){return{usr:t.state,key:t.key,idx:e}}function na(t,e,r=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Fr(e):e,state:r,key:e&&e.key||n||L0()}}function Mr({pathname:t="/",search:e="",hash:r=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Fr(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function bf(t,e,r,n={}){let{window:a=document.defaultView,v5Compat:o=!1}=n,i=a.history,s="POP",l=null,c=u();c==null&&(c=0,i.replaceState({...i.state,idx:c},""));function u(){return(i.state||{idx:null}).idx}function d(){s="POP";let m=u(),_=m==null?null:m-c;c=m,l&&l({action:s,location:y.location,delta:_})}function h(m,_){s="PUSH";let w=na(y.location,m,_);r&&r(w,m),c=u()+1;let A=wf(w,c),F=y.createHref(w);try{i.pushState(A,"",F)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;a.location.assign(F)}o&&l&&l({action:s,location:y.location,delta:1})}function p(m,_){s="REPLACE";let w=na(y.location,m,_);r&&r(w,m),c=u();let A=wf(w,c),F=y.createHref(w);i.replaceState(A,"",F),o&&l&&l({action:s,location:y.location,delta:0})}function f(m){let _=a.location.origin!=="null"?a.location.origin:a.location.href,w=typeof m=="string"?m:Mr(m);return w=w.replace(/ $/,"%20"),xe(_,`No window.location.(origin|href) available to create URL for href: ${w}`),new URL(w,_)}let y={get action(){return s},get location(){return t(a,i)},listen(m){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(vf,d),l=m,()=>{a.removeEventListener(vf,d),l=null}},createHref(m){return e(a,m)},createURL:f,encodeLocation(m){let _=f(m);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:h,replace:p,go(m){return i.go(m)}};return y}var D0=new Set(["lazy","caseSensitive","path","id","index","children"]);function $0(t){return t.index===!0}function Fi(t,e,r=[],n={}){return t.map((a,o)=>{let i=[...r,String(o)],s=typeof a.id=="string"?a.id:i.join("-");if(xe(a.index!==!0||!a.children,"Cannot specify children on an index route"),xe(!n[s],`Found a route id collision on id "${s}".  Route id's must be globally unique within Data Router usages`),$0(a)){let l={...a,...e(a),id:s};return n[s]=l,l}else{let l={...a,...e(a),id:s,children:void 0};return n[s]=l,a.children&&(l.children=Fi(a.children,e,i,n)),l}})}function qr(t,e,r="/"){return Ri(t,e,r,!1)}function Ri(t,e,r,n){let a=typeof e=="string"?Fr(e):e,o=Vt(a.pathname||"/",r);if(o==null)return null;let i=Ef(t);U0(i);let s=null;for(let l=0;s==null&&l<i.length;++l){let c=X0(o);s=K0(i[l],c,n)}return s}function z0(t,e){let{route:r,pathname:n,params:a}=t;return{id:r.id,pathname:n,params:a,data:e[r.id],handle:r.handle}}function Ef(t,e=[],r=[],n=""){let a=(o,i,s)=>{let l={relativePath:s===void 0?o.path||"":s,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};l.relativePath.startsWith("/")&&(xe(l.relativePath.startsWith(n),`Absolute route path "${l.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(n.length));let c=fr([n,l.relativePath]),u=r.concat(l);o.children&&o.children.length>0&&(xe(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),Ef(o.children,e,u,c)),!(o.path==null&&!o.index)&&e.push({path:c,score:Z0(c,o.index),routesMeta:u})};return t.forEach((o,i)=>{var s;if(o.path===""||!((s=o.path)!=null&&s.includes("?")))a(o,i);else for(let l of Sf(o.path))a(o,i,l)}),e}function Sf(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,a=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return a?[o,""]:[o];let i=Sf(n.join("/")),s=[];return s.push(...i.map(l=>l===""?o:[o,l].join("/"))),a&&s.push(...i),s.map(l=>t.startsWith("/")&&l===""?"/":l)}function U0(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:J0(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}var B0=/^:[\w-]+$/,H0=3,W0=2,G0=1,q0=10,V0=-2,xf=t=>t==="*";function Z0(t,e){let r=t.split("/"),n=r.length;return r.some(xf)&&(n+=V0),e&&(n+=W0),r.filter(a=>!xf(a)).reduce((a,o)=>a+(B0.test(o)?H0:o===""?G0:q0),n)}function J0(t,e){return t.length===e.length&&t.slice(0,-1).every((r,n)=>r===e[n])?t[t.length-1]-e[e.length-1]:0}function K0(t,e,r=!1){let{routesMeta:n}=t,a={},o="/",i=[];for(let s=0;s<n.length;++s){let l=n[s],c=s===n.length-1,u=o==="/"?e:e.slice(o.length)||"/",d=Oi({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d&&c&&r&&!n[n.length-1].route.index&&(d=Oi({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(a,d.params),i.push({params:a,pathname:fr([o,d.pathname]),pathnameBase:tE(fr([o,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(o=fr([o,d.pathnameBase]))}return i}function Oi(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=Y0(t.path,t.caseSensitive,t.end),a=e.match(r);if(!a)return null;let o=a[0],i=o.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:n.reduce((l,{paramName:c,isOptional:u},d)=>{if(c==="*"){let p=s[d]||"";i=o.slice(0,o.length-p.length).replace(/(.)\/+$/,"$1")}const h=s[d];return u&&!h?l[c]=void 0:l[c]=(h||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:i,pattern:t}}function Y0(t,e=!1,r=!0){rt(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,i,s)=>(n.push({paramName:i,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),n]}function X0(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return rt(!1,`The URL path "${t}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Vt(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function Q0(t,e="/"){let{pathname:r,search:n="",hash:a=""}=typeof t=="string"?Fr(t):t;return{pathname:r?r.startsWith("/")?r:eE(r,e):e,search:rE(n),hash:nE(a)}}function eE(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function yc(t,e,r,n){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function kf(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function Ni(t){let e=kf(t);return e.map((r,n)=>n===e.length-1?r.pathname:r.pathnameBase)}function Ii(t,e,r,n=!1){let a;typeof t=="string"?a=Fr(t):(a={...t},xe(!a.pathname||!a.pathname.includes("?"),yc("?","pathname","search",a)),xe(!a.pathname||!a.pathname.includes("#"),yc("#","pathname","hash",a)),xe(!a.search||!a.search.includes("#"),yc("#","search","hash",a)));let o=t===""||a.pathname==="",i=o?"/":a.pathname,s;if(i==null)s=r;else{let d=e.length-1;if(!n&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),d-=1;a.pathname=h.join("/")}s=d>=0?e[d]:"/"}let l=Q0(a,s),c=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var fr=t=>t.join("/").replace(/\/\/+/g,"/"),tE=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),rE=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,nE=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,Pi=class{constructor(t,e,r,n=!1){this.status=t,this.statusText=e||"",this.internal=n,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function Ci(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var Af=["POST","PUT","PATCH","DELETE"],aE=new Set(Af),oE=["GET",...Af],iE=new Set(oE),sE=new Set([301,302,303,307,308]),lE=new Set([307,308]),_c={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},cE={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},po={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},vc=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,uE=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),Tf="remix-router-transitions",Mf=Symbol("ResetLoaderData");function Ff(t){const e=t.window?t.window:typeof window<"u"?window:void 0,r=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u";xe(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let n=t.mapRouteProperties||uE,a={},o=Fi(t.routes,n,void 0,a),i,s=t.basename||"/",l=t.dataStrategy||mE,c=t.patchRoutesOnNavigation,u={...t.future},d=null,h=new Set,p=null,f=null,y=null,m=t.hydrationData!=null,_=qr(o,t.history.location,s),w=null;if(_==null&&!c){let O=Nt(404,{pathname:t.history.location.pathname}),{matches:z,route:U}=Uf(o);_=z,w={[U.id]:O}}_&&!t.hydrationData&&Wn(_,o,t.history.location.pathname).active&&(_=null);let A;if(_)if(_.some(O=>O.route.lazy))A=!1;else if(!_.some(O=>O.route.loader))A=!0;else{let O=t.hydrationData?t.hydrationData.loaderData:null,z=t.hydrationData?t.hydrationData.errors:null;if(z){let U=_.findIndex(V=>z[V.route.id]!==void 0);A=_.slice(0,U+1).every(V=>!bc(V.route,O,z))}else A=_.every(U=>!bc(U.route,O,z))}else{A=!1,_=[];let O=Wn(null,o,t.history.location.pathname);O.active&&O.matches&&(_=O.matches)}let F,b={historyAction:t.history.action,location:t.history.location,matches:_,initialized:A,navigation:_c,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||w,fetchers:new Map,blockers:new Map},D="POP",B=!1,j,G=!1,te=new Map,de=null,x=!1,R=!1,k=new Set,E=new Map,H=0,N=-1,C=new Map,P=new Set,Z=new Map,ne=new Map,le=new Set,ye=new Map,we,De=null;function Xe(){if(d=t.history.listen(({action:O,location:z,delta:U})=>{if(we){we(),we=void 0;return}rt(ye.size===0||U!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let V=Ga({currentLocation:b.location,nextLocation:z,historyAction:O});if(V&&U!=null){let oe=new Promise(pe=>{we=pe});t.history.go(U*-1),Wa(V,{state:"blocked",location:z,proceed(){Wa(V,{state:"proceeding",proceed:void 0,reset:void 0,location:z}),oe.then(()=>t.history.go(U))},reset(){let pe=new Map(b.blockers);pe.set(V,po),Fe({blockers:pe})}});return}return gt(O,z)}),r){AE(e,te);let O=()=>TE(e,te);e.addEventListener("pagehide",O),de=()=>e.removeEventListener("pagehide",O)}return b.initialized||gt("POP",b.location,{initialHydration:!0}),F}function Dt(){d&&d(),de&&de(),h.clear(),j&&j.abort(),b.fetchers.forEach((O,z)=>Ha(z)),b.blockers.forEach((O,z)=>_l(z))}function Ft(O){return h.add(O),()=>h.delete(O)}function Fe(O,z={}){b={...b,...O};let U=[],V=[];b.fetchers.forEach((oe,pe)=>{oe.state==="idle"&&(le.has(pe)?U.push(pe):V.push(pe))}),[...h].forEach(oe=>oe(b,{deletedFetchers:U,viewTransitionOpts:z.viewTransitionOpts,flushSync:z.flushSync===!0})),U.forEach(oe=>Ha(oe)),V.forEach(oe=>b.fetchers.delete(oe))}function dt(O,z,{flushSync:U}={}){var ee,_e;let V=b.actionData!=null&&b.navigation.formMethod!=null&&Zt(b.navigation.formMethod)&&b.navigation.state==="loading"&&((ee=O.state)==null?void 0:ee._isRedirect)!==!0,oe;z.actionData?Object.keys(z.actionData).length>0?oe=z.actionData:oe=null:V?oe=b.actionData:oe=null;let pe=z.loaderData?$f(b.loaderData,z.loaderData,z.matches||[],z.errors):b.loaderData,ge=b.blockers;ge.size>0&&(ge=new Map(ge),ge.forEach((Ae,Ue)=>ge.set(Ue,po)));let ie=B===!0||b.navigation.formMethod!=null&&Zt(b.navigation.formMethod)&&((_e=O.state)==null?void 0:_e._isRedirect)!==!0;i&&(o=i,i=void 0),x||D==="POP"||(D==="PUSH"?t.history.push(O,O.state):D==="REPLACE"&&t.history.replace(O,O.state));let ue;if(D==="POP"){let Ae=te.get(b.location.pathname);Ae&&Ae.has(O.pathname)?ue={currentLocation:b.location,nextLocation:O}:te.has(O.pathname)&&(ue={currentLocation:O,nextLocation:b.location})}else if(G){let Ae=te.get(b.location.pathname);Ae?Ae.add(O.pathname):(Ae=new Set([O.pathname]),te.set(b.location.pathname,Ae)),ue={currentLocation:b.location,nextLocation:O}}Fe({...z,actionData:oe,loaderData:pe,historyAction:D,location:O,initialized:!0,navigation:_c,revalidation:"idle",restoreScrollPosition:vl(O,z.matches||b.matches),preventScrollReset:ie,blockers:ge},{viewTransitionOpts:ue,flushSync:U===!0}),D="POP",B=!1,G=!1,x=!1,R=!1,De==null||De.resolve(),De=null}async function Hn(O,z){if(typeof O=="number"){t.history.go(O);return}let U=wc(b.location,b.matches,s,O,z==null?void 0:z.fromRouteId,z==null?void 0:z.relative),{path:V,submission:oe,error:pe}=Rf(!1,U,z),ge=b.location,ie=na(b.location,V,z&&z.state);ie={...ie,...t.history.encodeLocation(ie)};let ue=z&&z.replace!=null?z.replace:void 0,ee="PUSH";ue===!0?ee="REPLACE":ue===!1||oe!=null&&Zt(oe.formMethod)&&oe.formAction===b.location.pathname+b.location.search&&(ee="REPLACE");let _e=z&&"preventScrollReset"in z?z.preventScrollReset===!0:void 0,Ae=(z&&z.flushSync)===!0,Ue=Ga({currentLocation:ge,nextLocation:ie,historyAction:ee});if(Ue){Wa(Ue,{state:"blocked",location:ie,proceed(){Wa(Ue,{state:"proceeding",proceed:void 0,reset:void 0,location:ie}),Hn(O,z)},reset(){let Ge=new Map(b.blockers);Ge.set(Ue,po),Fe({blockers:Ge})}});return}await gt(ee,ie,{submission:oe,pendingError:pe,preventScrollReset:_e,replace:z&&z.replace,enableViewTransition:z&&z.viewTransition,flushSync:Ae})}function $a(){De||(De=ME()),Ba(),Fe({revalidation:"loading"});let O=De.promise;return b.navigation.state==="submitting"?O:b.navigation.state==="idle"?(gt(b.historyAction,b.location,{startUninterruptedRevalidation:!0}),O):(gt(D||b.historyAction,b.navigation.location,{overrideNavigation:b.navigation,enableViewTransition:G===!0}),O)}async function gt(O,z,U){j&&j.abort(),j=null,D=O,x=(U&&U.startUninterruptedRevalidation)===!0,Uh(b.location,b.matches),B=(U&&U.preventScrollReset)===!0,G=(U&&U.enableViewTransition)===!0;let V=i||o,oe=U&&U.overrideNavigation,pe=qr(V,z,s),ge=(U&&U.flushSync)===!0,ie=Wn(pe,V,z.pathname);if(ie.active&&ie.matches&&(pe=ie.matches),!pe){let{error:Re,notFoundMatches:wt,route:Je}=qa(z.pathname);dt(z,{matches:wt,loaderData:{},errors:{[Je.id]:Re}},{flushSync:ge});return}if(b.initialized&&!R&&bE(b.location,z)&&!(U&&U.submission&&Zt(U.submission.formMethod))){dt(z,{matches:pe},{flushSync:ge});return}j=new AbortController;let ue=aa(t.history,z,j.signal,U&&U.submission),ee;if(U&&U.pendingError)ee=[An(pe).route.id,{type:"error",error:U.pendingError}];else if(U&&U.submission&&Zt(U.submission.formMethod)){let Re=await ri(ue,z,U.submission,pe,ie.active,{replace:U.replace,flushSync:ge});if(Re.shortCircuited)return;if(Re.pendingActionResult){let[wt,Je]=Re.pendingActionResult;if(St(Je)&&Ci(Je.error)&&Je.error.status===404){j=null,dt(z,{matches:Re.matches,loaderData:{},errors:{[wt]:Je.error}});return}}pe=Re.matches||pe,ee=Re.pendingActionResult,oe=xc(z,U.submission),ge=!1,ie.active=!1,ue=aa(t.history,ue.url,ue.signal)}let{shortCircuited:_e,matches:Ae,loaderData:Ue,errors:Ge}=await $t(ue,z,pe,ie.active,oe,U&&U.submission,U&&U.fetcherSubmission,U&&U.replace,U&&U.initialHydration===!0,ge,ee);_e||(j=null,dt(z,{matches:Ae||pe,...zf(ee),loaderData:Ue,errors:Ge}))}async function ri(O,z,U,V,oe,pe={}){Ba();let ge=xE(z,U);if(Fe({navigation:ge},{flushSync:pe.flushSync===!0}),oe){let ee=await Va(V,z.pathname,O.signal);if(ee.type==="aborted")return{shortCircuited:!0};if(ee.type==="error"){let _e=An(ee.partialMatches).route.id;return{matches:ee.partialMatches,pendingActionResult:[_e,{type:"error",error:ee.error}]}}else if(ee.matches)V=ee.matches;else{let{notFoundMatches:_e,error:Ae,route:Ue}=qa(z.pathname);return{matches:_e,pendingActionResult:[Ue.id,{type:"error",error:Ae}]}}}let ie,ue=fo(V,z);if(!ue.route.action&&!ue.route.lazy)ie={type:"error",error:Nt(405,{method:O.method,pathname:z.pathname,routeId:ue.route.id})};else if(ie=(await mn("action",b,O,[ue],V,null))[ue.route.id],O.signal.aborted)return{shortCircuited:!0};if(Tn(ie)){let ee;return pe&&pe.replace!=null?ee=pe.replace:ee=jf(ie.response.headers.get("Location"),new URL(O.url),s)===b.location.pathname+b.location.search,await ar(O,ie,!0,{submission:U,replace:ee}),{shortCircuited:!0}}if(St(ie)){let ee=An(V,ue.route.id);return(pe&&pe.replace)!==!0&&(D="PUSH"),{matches:V,pendingActionResult:[ee.route.id,ie]}}return{matches:V,pendingActionResult:[ue.route.id,ie]}}async function $t(O,z,U,V,oe,pe,ge,ie,ue,ee,_e){let Ae=oe||xc(z,pe),Ue=pe||ge||Gf(Ae),Ge=!x&&!ue;if(V){if(Ge){let bt=za(_e);Fe({navigation:Ae,...bt!==void 0?{actionData:bt}:{}},{flushSync:ee})}let Te=await Va(U,z.pathname,O.signal);if(Te.type==="aborted")return{shortCircuited:!0};if(Te.type==="error"){let bt=An(Te.partialMatches).route.id;return{matches:Te.partialMatches,loaderData:{},errors:{[bt]:Te.error}}}else if(Te.matches)U=Te.matches;else{let{error:bt,notFoundMatches:Ar,route:Be}=qa(z.pathname);return{matches:Ar,loaderData:{},errors:{[Be.id]:bt}}}}let Re=i||o,[wt,Je]=Nf(t.history,b,U,Ue,z,ue===!0,R,k,le,Z,P,Re,s,_e);if(N=++H,wt.length===0&&Je.length===0){let Te=si();return dt(z,{matches:U,loaderData:{},errors:_e&&St(_e[1])?{[_e[0]]:_e[1].error}:null,...zf(_e),...Te?{fetchers:new Map(b.fetchers)}:{}},{flushSync:ee}),{shortCircuited:!0}}if(Ge){let Te={};if(!V){Te.navigation=Ae;let bt=za(_e);bt!==void 0&&(Te.actionData=bt)}Je.length>0&&(Te.fetchers=Ua(Je)),Fe(Te,{flushSync:ee})}Je.forEach(Te=>{ir(Te.key),Te.controller&&E.set(Te.key,Te.controller)});let Gn=()=>Je.forEach(Te=>ir(Te.key));j&&j.signal.addEventListener("abort",Gn);let{loaderResults:lr,fetcherResults:gn}=await ai(b,U,wt,Je,O);if(O.signal.aborted)return{shortCircuited:!0};j&&j.signal.removeEventListener("abort",Gn),Je.forEach(Te=>E.delete(Te.key));let xr=ji(lr);if(xr)return await ar(O,xr.result,!0,{replace:ie}),{shortCircuited:!0};if(xr=ji(gn),xr)return P.add(xr.key),await ar(O,xr.result,!0,{replace:ie}),{shortCircuited:!0};let{loaderData:ui,errors:cr}=Df(b,U,lr,_e,Je,gn);ue&&b.errors&&(cr={...b.errors,...cr});let qn=si(),kr=li(N),Vn=qn||kr||Je.length>0;return{matches:U,loaderData:ui,errors:cr,...Vn?{fetchers:new Map(b.fetchers)}:{}}}function za(O){if(O&&!St(O[1]))return{[O[0]]:O[1].data};if(b.actionData)return Object.keys(b.actionData).length===0?null:b.actionData}function Ua(O){return O.forEach(z=>{let U=b.fetchers.get(z.key),V=mo(void 0,U?U.data:void 0);b.fetchers.set(z.key,V)}),new Map(b.fetchers)}async function fn(O,z,U,V){ir(O);let oe=(V&&V.flushSync)===!0,pe=i||o,ge=wc(b.location,b.matches,s,U,z,V==null?void 0:V.relative),ie=qr(pe,ge,s),ue=Wn(ie,pe,ge);if(ue.active&&ue.matches&&(ie=ue.matches),!ie){zt(O,z,Nt(404,{pathname:ge}),{flushSync:oe});return}let{path:ee,submission:_e,error:Ae}=Rf(!0,ge,V);if(Ae){zt(O,z,Ae,{flushSync:oe});return}let Ue=fo(ie,ee),Ge=(V&&V.preventScrollReset)===!0;if(_e&&Zt(_e.formMethod)){await Sr(O,z,ee,Ue,ie,ue.active,oe,Ge,_e);return}Z.set(O,{routeId:z,path:ee}),await ni(O,z,ee,Ue,ie,ue.active,oe,Ge,_e)}async function Sr(O,z,U,V,oe,pe,ge,ie,ue){Ba(),Z.delete(O);function ee(Be){if(!Be.route.action&&!Be.route.lazy){let yn=Nt(405,{method:ue.formMethod,pathname:U,routeId:z});return zt(O,z,yn,{flushSync:ge}),!0}return!1}if(!pe&&ee(V))return;let _e=b.fetchers.get(O);or(O,kE(ue,_e),{flushSync:ge});let Ae=new AbortController,Ue=aa(t.history,U,Ae.signal,ue);if(pe){let Be=await Va(oe,U,Ue.signal);if(Be.type==="aborted")return;if(Be.type==="error"){zt(O,z,Be.error,{flushSync:ge});return}else if(Be.matches){if(oe=Be.matches,V=fo(oe,U),ee(V))return}else{zt(O,z,Nt(404,{pathname:U}),{flushSync:ge});return}}E.set(O,Ae);let Ge=H,Re=(await mn("action",b,Ue,[V],oe,O))[V.route.id];if(Ue.signal.aborted){E.get(O)===Ae&&E.delete(O);return}if(le.has(O)){if(Tn(Re)||St(Re)){or(O,Vr(void 0));return}}else{if(Tn(Re))if(E.delete(O),N>Ge){or(O,Vr(void 0));return}else return P.add(O),or(O,mo(ue)),ar(Ue,Re,!1,{fetcherSubmission:ue,preventScrollReset:ie});if(St(Re)){zt(O,z,Re.error);return}}let wt=b.navigation.location||b.location,Je=aa(t.history,wt,Ae.signal),Gn=i||o,lr=b.navigation.state!=="idle"?qr(Gn,b.navigation.location,s):b.matches;xe(lr,"Didn't find any matches after fetcher action");let gn=++H;C.set(O,gn);let xr=mo(ue,Re.data);b.fetchers.set(O,xr);let[ui,cr]=Nf(t.history,b,lr,ue,wt,!1,R,k,le,Z,P,Gn,s,[V.route.id,Re]);cr.filter(Be=>Be.key!==O).forEach(Be=>{let yn=Be.key,wl=b.fetchers.get(yn),di=mo(void 0,wl?wl.data:void 0);b.fetchers.set(yn,di),ir(yn),Be.controller&&E.set(yn,Be.controller)}),Fe({fetchers:new Map(b.fetchers)});let qn=()=>cr.forEach(Be=>ir(Be.key));Ae.signal.addEventListener("abort",qn);let{loaderResults:kr,fetcherResults:Vn}=await ai(b,lr,ui,cr,Je);if(Ae.signal.aborted)return;Ae.signal.removeEventListener("abort",qn),C.delete(O),E.delete(O),cr.forEach(Be=>E.delete(Be.key));let Te=ji(kr);if(Te)return ar(Je,Te.result,!1,{preventScrollReset:ie});if(Te=ji(Vn),Te)return P.add(Te.key),ar(Je,Te.result,!1,{preventScrollReset:ie});let{loaderData:bt,errors:Ar}=Df(b,lr,kr,void 0,cr,Vn);if(b.fetchers.has(O)){let Be=Vr(Re.data);b.fetchers.set(O,Be)}li(gn),b.navigation.state==="loading"&&gn>N?(xe(D,"Expected pending action"),j&&j.abort(),dt(b.navigation.location,{matches:lr,loaderData:bt,errors:Ar,fetchers:new Map(b.fetchers)})):(Fe({errors:Ar,loaderData:$f(b.loaderData,bt,lr,Ar),fetchers:new Map(b.fetchers)}),R=!1)}async function ni(O,z,U,V,oe,pe,ge,ie,ue){let ee=b.fetchers.get(O);or(O,mo(ue,ee?ee.data:void 0),{flushSync:ge});let _e=new AbortController,Ae=aa(t.history,U,_e.signal);if(pe){let Re=await Va(oe,U,Ae.signal);if(Re.type==="aborted")return;if(Re.type==="error"){zt(O,z,Re.error,{flushSync:ge});return}else if(Re.matches)oe=Re.matches,V=fo(oe,U);else{zt(O,z,Nt(404,{pathname:U}),{flushSync:ge});return}}E.set(O,_e);let Ue=H,Ge=(await mn("loader",b,Ae,[V],oe,O))[V.route.id];if(E.get(O)===_e&&E.delete(O),!Ae.signal.aborted){if(le.has(O)){or(O,Vr(void 0));return}if(Tn(Ge))if(N>Ue){or(O,Vr(void 0));return}else{P.add(O),await ar(Ae,Ge,!1,{preventScrollReset:ie});return}if(St(Ge)){zt(O,z,Ge.error);return}or(O,Vr(Ge.data))}}async function ar(O,z,U,{submission:V,fetcherSubmission:oe,preventScrollReset:pe,replace:ge}={}){z.response.headers.has("X-Remix-Revalidate")&&(R=!0);let ie=z.response.headers.get("Location");xe(ie,"Expected a Location header on the redirect Response"),ie=jf(ie,new URL(O.url),s);let ue=na(b.location,ie,{_isRedirect:!0});if(r){let Re=!1;if(z.response.headers.has("X-Remix-Reload-Document"))Re=!0;else if(vc.test(ie)){const wt=t.history.createURL(ie);Re=wt.origin!==e.location.origin||Vt(wt.pathname,s)==null}if(Re){ge?e.location.replace(ie):e.location.assign(ie);return}}j=null;let ee=ge===!0||z.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:_e,formAction:Ae,formEncType:Ue}=b.navigation;!V&&!oe&&_e&&Ae&&Ue&&(V=Gf(b.navigation));let Ge=V||oe;if(lE.has(z.response.status)&&Ge&&Zt(Ge.formMethod))await gt(ee,ue,{submission:{...Ge,formAction:ie},preventScrollReset:pe||B,enableViewTransition:U?G:void 0});else{let Re=xc(ue,V);await gt(ee,ue,{overrideNavigation:Re,fetcherSubmission:oe,preventScrollReset:pe||B,enableViewTransition:U?G:void 0})}}async function mn(O,z,U,V,oe,pe){let ge,ie={};try{ge=await gE(l,O,z,U,V,oe,pe,a,n)}catch(ue){return V.forEach(ee=>{ie[ee.route.id]={type:"error",error:ue}}),ie}for(let[ue,ee]of Object.entries(ge))if(EE(ee)){let _e=ee.result;ie[ue]={type:"redirect",response:vE(_e,U,ue,oe,s)}}else ie[ue]=await _E(ee);return ie}async function ai(O,z,U,V,oe){let pe=mn("loader",O,oe,U,z,null),ge=Promise.all(V.map(async ee=>{if(ee.matches&&ee.match&&ee.controller){let _e=(await mn("loader",O,aa(t.history,ee.path,ee.controller.signal),[ee.match],ee.matches,ee.key))[ee.match.route.id];return{[ee.key]:_e}}else return Promise.resolve({[ee.key]:{type:"error",error:Nt(404,{pathname:ee.path})}})})),ie=await pe,ue=(await ge).reduce((ee,_e)=>Object.assign(ee,_e),{});return{loaderResults:ie,fetcherResults:ue}}function Ba(){R=!0,Z.forEach((O,z)=>{E.has(z)&&k.add(z),ir(z)})}function or(O,z,U={}){b.fetchers.set(O,z),Fe({fetchers:new Map(b.fetchers)},{flushSync:(U&&U.flushSync)===!0})}function zt(O,z,U,V={}){let oe=An(b.matches,z);Ha(O),Fe({errors:{[oe.route.id]:U},fetchers:new Map(b.fetchers)},{flushSync:(V&&V.flushSync)===!0})}function oi(O){return ne.set(O,(ne.get(O)||0)+1),le.has(O)&&le.delete(O),b.fetchers.get(O)||cE}function Ha(O){let z=b.fetchers.get(O);E.has(O)&&!(z&&z.state==="loading"&&C.has(O))&&ir(O),Z.delete(O),C.delete(O),P.delete(O),le.delete(O),k.delete(O),b.fetchers.delete(O)}function yl(O){let z=(ne.get(O)||0)-1;z<=0?(ne.delete(O),le.add(O)):ne.set(O,z),Fe({fetchers:new Map(b.fetchers)})}function ir(O){let z=E.get(O);z&&(z.abort(),E.delete(O))}function ii(O){for(let z of O){let U=oi(z),V=Vr(U.data);b.fetchers.set(z,V)}}function si(){let O=[],z=!1;for(let U of P){let V=b.fetchers.get(U);xe(V,`Expected fetcher: ${U}`),V.state==="loading"&&(P.delete(U),O.push(U),z=!0)}return ii(O),z}function li(O){let z=[];for(let[U,V]of C)if(V<O){let oe=b.fetchers.get(U);xe(oe,`Expected fetcher: ${U}`),oe.state==="loading"&&(ir(U),C.delete(U),z.push(U))}return ii(z),z.length>0}function ci(O,z){let U=b.blockers.get(O)||po;return ye.get(O)!==z&&ye.set(O,z),U}function _l(O){b.blockers.delete(O),ye.delete(O)}function Wa(O,z){let U=b.blockers.get(O)||po;xe(U.state==="unblocked"&&z.state==="blocked"||U.state==="blocked"&&z.state==="blocked"||U.state==="blocked"&&z.state==="proceeding"||U.state==="blocked"&&z.state==="unblocked"||U.state==="proceeding"&&z.state==="unblocked",`Invalid blocker state transition: ${U.state} -> ${z.state}`);let V=new Map(b.blockers);V.set(O,z),Fe({blockers:V})}function Ga({currentLocation:O,nextLocation:z,historyAction:U}){if(ye.size===0)return;ye.size>1&&rt(!1,"A router only supports one blocker at a time");let V=Array.from(ye.entries()),[oe,pe]=V[V.length-1],ge=b.blockers.get(oe);if(!(ge&&ge.state==="proceeding")&&pe({currentLocation:O,nextLocation:z,historyAction:U}))return oe}function qa(O){let z=Nt(404,{pathname:O}),U=i||o,{matches:V,route:oe}=Uf(U);return{notFoundMatches:V,route:oe,error:z}}function zh(O,z,U){if(p=O,y=z,f=U||null,!m&&b.navigation===_c){m=!0;let V=vl(b.location,b.matches);V!=null&&Fe({restoreScrollPosition:V})}return()=>{p=null,y=null,f=null}}function sr(O,z){return f&&f(O,z.map(U=>z0(U,b.loaderData)))||O.key}function Uh(O,z){if(p&&y){let U=sr(O,z);p[U]=y()}}function vl(O,z){if(p){let U=sr(O,z),V=p[U];if(typeof V=="number")return V}return null}function Wn(O,z,U){if(c)if(O){if(Object.keys(O[0].params).length>0)return{active:!0,matches:Ri(z,U,s,!0)}}else return{active:!0,matches:Ri(z,U,s,!0)||[]};return{active:!1,matches:null}}async function Va(O,z,U){if(!c)return{type:"success",matches:O};let V=O;for(;;){let oe=i==null,pe=i||o,ge=a;try{await c({path:z,matches:V,patch:(ee,_e)=>{U.aborted||Pf(ee,_e,pe,ge,n)}})}catch(ee){return{type:"error",error:ee,partialMatches:V}}finally{oe&&!U.aborted&&(o=[...o])}if(U.aborted)return{type:"aborted"};let ie=qr(pe,z,s);if(ie)return{type:"success",matches:ie};let ue=Ri(pe,z,s,!0);if(!ue||V.length===ue.length&&V.every((ee,_e)=>ee.route.id===ue[_e].route.id))return{type:"success",matches:null};V=ue}}function Bh(O){a={},i=Fi(O,n,void 0,a)}function Hh(O,z){let U=i==null;Pf(O,z,i||o,a,n),U&&(o=[...o],Fe({}))}return F={get basename(){return s},get future(){return u},get state(){return b},get routes(){return o},get window(){return e},initialize:Xe,subscribe:Ft,enableScrollRestoration:zh,navigate:Hn,fetch:fn,revalidate:$a,createHref:O=>t.history.createHref(O),encodeLocation:O=>t.history.encodeLocation(O),getFetcher:oi,deleteFetcher:yl,dispose:Dt,getBlocker:ci,deleteBlocker:_l,patchRoutes:Hh,_internalFetchControllers:E,_internalSetRoutes:Bh},F}function dE(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function wc(t,e,r,n,a,o){let i,s;if(a){i=[];for(let c of e)if(i.push(c),c.route.id===a){s=c;break}}else i=e,s=e[e.length-1];let l=Ii(n||".",Ni(i),Vt(t.pathname,r)||t.pathname,o==="path");if(n==null&&(l.search=t.search,l.hash=t.hash),(n==null||n===""||n===".")&&s){let c=Sc(l.search);if(s.route.index&&!c)l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index";else if(!s.route.index&&c){let u=new URLSearchParams(l.search),d=u.getAll("index");u.delete("index"),d.filter(p=>p).forEach(p=>u.append("index",p));let h=u.toString();l.search=h?`?${h}`:""}}return r!=="/"&&(l.pathname=l.pathname==="/"?r:fr([r,l.pathname])),Mr(l)}function Rf(t,e,r){if(!r||!dE(r))return{path:e};if(r.formMethod&&!SE(r.formMethod))return{path:e,error:Nt(405,{method:r.formMethod})};let n=()=>({path:e,error:Nt(400,{type:"invalid-body"})}),a=(r.formMethod||"get").toUpperCase(),o=Bf(e);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Zt(a))return n();let u=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((d,[h,p])=>`${d}${h}=${p}
`,""):String(r.body);return{path:e,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:void 0,text:u}}}else if(r.formEncType==="application/json"){if(!Zt(a))return n();try{let u=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:e,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:u,text:void 0}}}catch{return n()}}}xe(typeof FormData=="function","FormData is not available in this environment");let i,s;if(r.formData)i=Ec(r.formData),s=r.formData;else if(r.body instanceof FormData)i=Ec(r.body),s=r.body;else if(r.body instanceof URLSearchParams)i=r.body,s=Lf(i);else if(r.body==null)i=new URLSearchParams,s=new FormData;else try{i=new URLSearchParams(r.body),s=Lf(i)}catch{return n()}let l={formMethod:a,formAction:o,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:s,json:void 0,text:void 0};if(Zt(l.formMethod))return{path:e,submission:l};let c=Fr(e);return t&&c.search&&Sc(c.search)&&i.append("index",""),c.search=`?${i}`,{path:Mr(c),submission:l}}function Of(t,e,r=!1){let n=t.findIndex(a=>a.route.id===e);return n>=0?t.slice(0,r?n+1:n):t}function Nf(t,e,r,n,a,o,i,s,l,c,u,d,h,p){let f=p?St(p[1])?p[1].error:p[1].data:void 0,y=t.createURL(e.location),m=t.createURL(a),_=r;o&&e.errors?_=Of(r,Object.keys(e.errors)[0],!0):p&&St(p[1])&&(_=Of(r,p[0]));let w=p?p[1].statusCode:void 0,A=w&&w>=400,F=_.filter((D,B)=>{let{route:j}=D;if(j.lazy)return!0;if(j.loader==null)return!1;if(o)return bc(j,e.loaderData,e.errors);if(hE(e.loaderData,e.matches[B],D))return!0;let G=e.matches[B],te=D;return If(D,{currentUrl:y,currentParams:G.params,nextUrl:m,nextParams:te.params,...n,actionResult:f,actionStatus:w,defaultShouldRevalidate:A?!1:i||y.pathname+y.search===m.pathname+m.search||y.search!==m.search||pE(G,te)})}),b=[];return c.forEach((D,B)=>{if(o||!r.some(x=>x.route.id===D.routeId)||l.has(B))return;let j=qr(d,D.path,h);if(!j){b.push({key:B,routeId:D.routeId,path:D.path,matches:null,match:null,controller:null});return}let G=e.fetchers.get(B),te=fo(j,D.path),de=!1;u.has(B)?de=!1:s.has(B)?(s.delete(B),de=!0):G&&G.state!=="idle"&&G.data===void 0?de=i:de=If(te,{currentUrl:y,currentParams:e.matches[e.matches.length-1].params,nextUrl:m,nextParams:r[r.length-1].params,...n,actionResult:f,actionStatus:w,defaultShouldRevalidate:A?!1:i}),de&&b.push({key:B,routeId:D.routeId,path:D.path,matches:j,match:te,controller:new AbortController})}),[F,b]}function bc(t,e,r){if(t.lazy)return!0;if(!t.loader)return!1;let n=e!=null&&e[t.id]!==void 0,a=r!=null&&r[t.id]!==void 0;return!n&&a?!1:typeof t.loader=="function"&&t.loader.hydrate===!0?!0:!n&&!a}function hE(t,e,r){let n=!e||r.route.id!==e.route.id,a=!t.hasOwnProperty(r.route.id);return n||a}function pE(t,e){let r=t.route.path;return t.pathname!==e.pathname||r!=null&&r.endsWith("*")&&t.params["*"]!==e.params["*"]}function If(t,e){if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate(e);if(typeof r=="boolean")return r}return e.defaultShouldRevalidate}function Pf(t,e,r,n,a){let o;if(t){let l=n[t];xe(l,`No route found to patch children into: routeId = ${t}`),l.children||(l.children=[]),o=l.children}else o=r;let i=e.filter(l=>!o.some(c=>Cf(l,c))),s=Fi(i,a,[t||"_","patch",String((o==null?void 0:o.length)||"0")],n);o.push(...s)}function Cf(t,e){return"id"in t&&"id"in e&&t.id===e.id?!0:t.index===e.index&&t.path===e.path&&t.caseSensitive===e.caseSensitive?(!t.children||t.children.length===0)&&(!e.children||e.children.length===0)?!0:t.children.every((r,n)=>{var a;return(a=e.children)==null?void 0:a.some(o=>Cf(r,o))}):!1}async function fE(t,e,r){if(!t.lazy)return;let n=await t.lazy();if(!t.lazy)return;let a=r[t.id];xe(a,"No route found in manifest");let o={};for(let i in n){let s=a[i]!==void 0&&i!=="hasErrorBoundary";rt(!s,`Route "${a.id}" has a static property "${i}" defined but its lazy function is also returning a value for this property. The lazy route property "${i}" will be ignored.`),!s&&!D0.has(i)&&(o[i]=n[i])}Object.assign(a,o),Object.assign(a,{...e(a),lazy:void 0})}async function mE({matches:t}){let e=t.filter(r=>r.shouldLoad);return(await Promise.all(e.map(r=>r.resolve()))).reduce((r,n,a)=>Object.assign(r,{[e[a].route.id]:n}),{})}async function gE(t,e,r,n,a,o,i,s,l,c){let u=o.map(p=>p.route.lazy?fE(p.route,l,s):void 0),d=o.map((p,f)=>{let y=u[f],m=a.some(_=>_.route.id===p.route.id);return{...p,shouldLoad:m,resolve:async _=>(_&&n.method==="GET"&&(p.route.lazy||p.route.loader)&&(m=!0),m?yE(e,n,p,y,_,c):Promise.resolve({type:"data",result:void 0}))}}),h=await t({matches:d,request:n,params:o[0].params,fetcherKey:i,context:c});try{await Promise.all(u)}catch{}return h}async function yE(t,e,r,n,a,o){let i,s,l=c=>{let u,d=new Promise((f,y)=>u=y);s=()=>u(),e.signal.addEventListener("abort",s);let h=f=>typeof c!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${t}" [routeId: ${r.route.id}]`)):c({request:e,params:r.params,context:o},...f!==void 0?[f]:[]),p=(async()=>{try{return{type:"data",result:await(a?a(f=>h(f)):h())}}catch(f){return{type:"error",result:f}}})();return Promise.race([p,d])};try{let c=r.route[t];if(n)if(c){let u,[d]=await Promise.all([l(c).catch(h=>{u=h}),n]);if(u!==void 0)throw u;i=d}else if(await n,c=r.route[t],c)i=await l(c);else if(t==="action"){let u=new URL(e.url),d=u.pathname+u.search;throw Nt(405,{method:e.method,pathname:d,routeId:r.route.id})}else return{type:"data",result:void 0};else if(c)i=await l(c);else{let u=new URL(e.url),d=u.pathname+u.search;throw Nt(404,{pathname:d})}}catch(c){return{type:"error",result:c}}finally{s&&e.signal.removeEventListener("abort",s)}return i}async function _E(t){var n,a,o,i;let{result:e,type:r}=t;if(Wf(e)){let s;try{let l=e.headers.get("Content-Type");l&&/\bapplication\/json\b/.test(l)?e.body==null?s=null:s=await e.json():s=await e.text()}catch(l){return{type:"error",error:l}}return r==="error"?{type:"error",error:new Pi(e.status,e.statusText,s),statusCode:e.status,headers:e.headers}:{type:"data",data:s,statusCode:e.status,headers:e.headers}}if(r==="error"){if(Hf(e)){if(e.data instanceof Error)return{type:"error",error:e.data,statusCode:(n=e.init)==null?void 0:n.status};e=new Pi(((a=e.init)==null?void 0:a.status)||500,void 0,e.data)}return{type:"error",error:e,statusCode:Ci(e)?e.status:void 0}}return Hf(e)?{type:"data",data:e.data,statusCode:(o=e.init)==null?void 0:o.status,headers:(i=e.init)!=null&&i.headers?new Headers(e.init.headers):void 0}:{type:"data",data:e}}function vE(t,e,r,n,a){let o=t.headers.get("Location");if(xe(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!vc.test(o)){let i=n.slice(0,n.findIndex(s=>s.route.id===r)+1);o=wc(new URL(e.url),i,a,o),t.headers.set("Location",o)}return t}function jf(t,e,r){if(vc.test(t)){let n=t,a=n.startsWith("//")?new URL(e.protocol+n):new URL(n),o=Vt(a.pathname,r)!=null;if(a.origin===e.origin&&o)return a.pathname+a.search+a.hash}return t}function aa(t,e,r,n){let a=t.createURL(Bf(e)).toString(),o={signal:r};if(n&&Zt(n.formMethod)){let{formMethod:i,formEncType:s}=n;o.method=i.toUpperCase(),s==="application/json"?(o.headers=new Headers({"Content-Type":s}),o.body=JSON.stringify(n.json)):s==="text/plain"?o.body=n.text:s==="application/x-www-form-urlencoded"&&n.formData?o.body=Ec(n.formData):o.body=n.formData}return new Request(a,o)}function Ec(t){let e=new URLSearchParams;for(let[r,n]of t.entries())e.append(r,typeof n=="string"?n:n.name);return e}function Lf(t){let e=new FormData;for(let[r,n]of t.entries())e.append(r,n);return e}function wE(t,e,r,n=!1,a=!1){let o={},i=null,s,l=!1,c={},u=r&&St(r[1])?r[1].error:void 0;return t.forEach(d=>{if(!(d.route.id in e))return;let h=d.route.id,p=e[h];if(xe(!Tn(p),"Cannot handle redirect results in processLoaderData"),St(p)){let f=p.error;if(u!==void 0&&(f=u,u=void 0),i=i||{},a)i[h]=f;else{let y=An(t,h);i[y.route.id]==null&&(i[y.route.id]=f)}n||(o[h]=Mf),l||(l=!0,s=Ci(p.error)?p.error.status:500),p.headers&&(c[h]=p.headers)}else o[h]=p.data,p.statusCode&&p.statusCode!==200&&!l&&(s=p.statusCode),p.headers&&(c[h]=p.headers)}),u!==void 0&&r&&(i={[r[0]]:u},o[r[0]]=void 0),{loaderData:o,errors:i,statusCode:s||200,loaderHeaders:c}}function Df(t,e,r,n,a,o){let{loaderData:i,errors:s}=wE(e,r,n);return a.forEach(l=>{let{key:c,match:u,controller:d}=l,h=o[c];if(xe(h,"Did not find corresponding fetcher result"),!(d&&d.signal.aborted))if(St(h)){let p=An(t.matches,u==null?void 0:u.route.id);s&&s[p.route.id]||(s={...s,[p.route.id]:h.error}),t.fetchers.delete(c)}else if(Tn(h))xe(!1,"Unhandled fetcher revalidation redirect");else{let p=Vr(h.data);t.fetchers.set(c,p)}}),{loaderData:i,errors:s}}function $f(t,e,r,n){let a=Object.entries(e).filter(([,o])=>o!==Mf).reduce((o,[i,s])=>(o[i]=s,o),{});for(let o of r){let i=o.route.id;if(!e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&o.route.loader&&(a[i]=t[i]),n&&n.hasOwnProperty(i))break}return a}function zf(t){return t?St(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function An(t,e){return(e?t.slice(0,t.findIndex(r=>r.route.id===e)+1):[...t]).reverse().find(r=>r.route.hasErrorBoundary===!0)||t[0]}function Uf(t){let e=t.length===1?t[0]:t.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Nt(t,{pathname:e,routeId:r,method:n,type:a,message:o}={}){let i="Unknown Server Error",s="Unknown @remix-run/router error";return t===400?(i="Bad Request",n&&e&&r?s=`You made a ${n} request to "${e}" but did not provide a \`loader\` for route "${r}", so there is no way to handle the request.`:a==="invalid-body"&&(s="Unable to encode submission body")):t===403?(i="Forbidden",s=`Route "${r}" does not match URL "${e}"`):t===404?(i="Not Found",s=`No route matches URL "${e}"`):t===405&&(i="Method Not Allowed",n&&e&&r?s=`You made a ${n.toUpperCase()} request to "${e}" but did not provide an \`action\` for route "${r}", so there is no way to handle the request.`:n&&(s=`Invalid request method "${n.toUpperCase()}"`)),new Pi(t||500,i,new Error(s),!0)}function ji(t){let e=Object.entries(t);for(let r=e.length-1;r>=0;r--){let[n,a]=e[r];if(Tn(a))return{key:n,result:a}}}function Bf(t){let e=typeof t=="string"?Fr(t):t;return Mr({...e,hash:""})}function bE(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function EE(t){return Wf(t.result)&&sE.has(t.result.status)}function St(t){return t.type==="error"}function Tn(t){return(t&&t.type)==="redirect"}function Hf(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function Wf(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function SE(t){return iE.has(t.toUpperCase())}function Zt(t){return aE.has(t.toUpperCase())}function Sc(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function fo(t,e){let r=typeof e=="string"?Fr(e).search:e.search;if(t[t.length-1].route.index&&Sc(r||""))return t[t.length-1];let n=kf(t);return n[n.length-1]}function Gf(t){let{formMethod:e,formAction:r,formEncType:n,text:a,formData:o,json:i}=t;if(!(!e||!r||!n)){if(a!=null)return{formMethod:e,formAction:r,formEncType:n,formData:void 0,json:void 0,text:a};if(o!=null)return{formMethod:e,formAction:r,formEncType:n,formData:o,json:void 0,text:void 0};if(i!==void 0)return{formMethod:e,formAction:r,formEncType:n,formData:void 0,json:i,text:void 0}}}function xc(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function xE(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function mo(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function kE(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function Vr(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function AE(t,e){try{let r=t.sessionStorage.getItem(Tf);if(r){let n=JSON.parse(r);for(let[a,o]of Object.entries(n||{}))o&&Array.isArray(o)&&e.set(a,new Set(o||[]))}}catch{}}function TE(t,e){if(e.size>0){let r={};for(let[n,a]of e)r[n]=[...a];try{t.sessionStorage.setItem(Tf,JSON.stringify(r))}catch(n){rt(!1,`Failed to save applied view transitions in sessionStorage (${n}).`)}}}function ME(){let t,e,r=new Promise((n,a)=>{t=async o=>{n(o);try{await r}catch{}},e=async o=>{a(o);try{await r}catch{}}});return{promise:r,resolve:t,reject:e}}var Mn=g.createContext(null);Mn.displayName="DataRouter";var go=g.createContext(null);go.displayName="DataRouterState";var kc=g.createContext({isTransitioning:!1});kc.displayName="ViewTransition";var qf=g.createContext(new Map);qf.displayName="Fetchers";var FE=g.createContext(null);FE.displayName="Await";var Jt=g.createContext(null);Jt.displayName="Navigation";var Li=g.createContext(null);Li.displayName="Location";var It=g.createContext({outlet:null,matches:[],isDataRoute:!1});It.displayName="Route";var Ac=g.createContext(null);Ac.displayName="RouteError";function RE(t,{relative:e}={}){xe(oa(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:n}=g.useContext(Jt),{hash:a,pathname:o,search:i}=yo(t,{relative:e}),s=o;return r!=="/"&&(s=o==="/"?r:fr([r,o])),n.createHref({pathname:s,search:i,hash:a})}function oa(){return g.useContext(Li)!=null}function mr(){return xe(oa(),"useLocation() may be used only in the context of a <Router> component."),g.useContext(Li).location}var Vf="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Zf(t){g.useContext(Jt).static||g.useLayoutEffect(t)}Yn=function(){let{isDataRoute:t}=g.useContext(It);return t?WE():OE()};function OE(){xe(oa(),"useNavigate() may be used only in the context of a <Router> component.");let t=g.useContext(Mn),{basename:e,navigator:r}=g.useContext(Jt),{matches:n}=g.useContext(It),{pathname:a}=mr(),o=JSON.stringify(Ni(n)),i=g.useRef(!1);return Zf(()=>{i.current=!0}),g.useCallback((s,l={})=>{if(rt(i.current,Vf),!i.current)return;if(typeof s=="number"){r.go(s);return}let c=Ii(s,JSON.parse(o),a,l.relative==="path");t==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:fr([e,c.pathname])),(l.replace?r.replace:r.push)(c,l.state,l)},[e,r,o,a,t])}var NE=g.createContext(null);function IE(t){let e=g.useContext(It).outlet;return e&&g.createElement(NE.Provider,{value:t},e)}function Jf(){let{matches:t}=g.useContext(It),e=t[t.length-1];return e?e.params:{}}function yo(t,{relative:e}={}){let{matches:r}=g.useContext(It),{pathname:n}=mr(),a=JSON.stringify(Ni(r));return g.useMemo(()=>Ii(t,JSON.parse(a),n,e==="path"),[t,a,n,e])}function PE(t,e,r,n){xe(oa(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=g.useContext(Jt),{matches:o}=g.useContext(It),i=o[o.length-1],s=i?i.params:{},l=i?i.pathname:"/",c=i?i.pathnameBase:"/",u=i&&i.route;{let m=u&&u.path||"";Xf(l,!u||m.endsWith("*")||m.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${m}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${m}"> to <Route path="${m==="/"?"*":`${m}/*`}">.`)}let d=mr(),h;h=d;let p=h.pathname||"/",f=p;if(c!=="/"){let m=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(m.length).join("/")}let y=qr(t,{pathname:f});return rt(u||y!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),rt(y==null||y[y.length-1].route.element!==void 0||y[y.length-1].route.Component!==void 0||y[y.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),$E(y&&y.map(m=>Object.assign({},m,{params:Object.assign({},s,m.params),pathname:fr([c,a.encodeLocation?a.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?c:fr([c,a.encodeLocation?a.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),o,r,n)}function CE(){let t=Kf(),e=Ci(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:n},o={padding:"2px 4px",backgroundColor:n},i=null;return console.error("Error handled by React Router default ErrorBoundary:",t),i=g.createElement(g.Fragment,null,g.createElement("p",null,"\u{1F4BF} Hey developer \u{1F44B}"),g.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",g.createElement("code",{style:o},"ErrorBoundary")," or"," ",g.createElement("code",{style:o},"errorElement")," prop on your route.")),g.createElement(g.Fragment,null,g.createElement("h2",null,"Unexpected Application Error!"),g.createElement("h3",{style:{fontStyle:"italic"}},e),r?g.createElement("pre",{style:a},r):null,i)}var jE=g.createElement(CE,null),LE=class extends g.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?g.createElement(It.Provider,{value:this.props.routeContext},g.createElement(Ac.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function DE({routeContext:t,match:e,children:r}){let n=g.useContext(Mn);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),g.createElement(It.Provider,{value:t},r)}function $E(t,e=[],r=null,n=null){if(t==null){if(!r)return null;if(r.errors)t=r.matches;else if(e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let a=t,o=r==null?void 0:r.errors;if(o!=null){let l=a.findIndex(c=>c.route.id&&(o==null?void 0:o[c.route.id])!==void 0);xe(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),a=a.slice(0,Math.min(a.length,l+1))}let i=!1,s=-1;if(r)for(let l=0;l<a.length;l++){let c=a[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(s=l),c.route.id){let{loaderData:u,errors:d}=r,h=c.route.loader&&!u.hasOwnProperty(c.route.id)&&(!d||d[c.route.id]===void 0);if(c.route.lazy||h){i=!0,s>=0?a=a.slice(0,s+1):a=[a[0]];break}}}return a.reduceRight((l,c,u)=>{let d,h=!1,p=null,f=null;r&&(d=o&&c.route.id?o[c.route.id]:void 0,p=c.route.errorElement||jE,i&&(s<0&&u===0?(Xf("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,f=null):s===u&&(h=!0,f=c.route.hydrateFallbackElement||null)));let y=e.concat(a.slice(0,u+1)),m=()=>{let _;return d?_=p:h?_=f:c.route.Component?_=g.createElement(c.route.Component,null):c.route.element?_=c.route.element:_=l,g.createElement(DE,{match:c,routeContext:{outlet:l,matches:y,isDataRoute:r!=null},children:_})};return r&&(c.route.ErrorBoundary||c.route.errorElement||u===0)?g.createElement(LE,{location:r.location,revalidation:r.revalidation,component:p,error:d,children:m(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):m()},null)}function Tc(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zE(t){let e=g.useContext(Mn);return xe(e,Tc(t)),e}function UE(t){let e=g.useContext(go);return xe(e,Tc(t)),e}function BE(t){let e=g.useContext(It);return xe(e,Tc(t)),e}function Mc(t){let e=BE(t),r=e.matches[e.matches.length-1];return xe(r.route.id,`${t} can only be used on routes that contain a unique "id"`),r.route.id}function HE(){return Mc("useRouteId")}function Kf(){var n;let t=g.useContext(Ac),e=UE("useRouteError"),r=Mc("useRouteError");return t!==void 0?t:(n=e.errors)==null?void 0:n[r]}function WE(){let{router:t}=zE("useNavigate"),e=Mc("useNavigate"),r=g.useRef(!1);return Zf(()=>{r.current=!0}),g.useCallback(async(n,a={})=>{rt(r.current,Vf),r.current&&(typeof n=="number"?t.navigate(n):await t.navigate(n,{fromRouteId:e,...a}))},[t,e])}var Yf={};function Xf(t,e,r){!e&&!Yf[t]&&(Yf[t]=!0,rt(!1,r))}var Qf={};function em(t,e){!t&&!Qf[e]&&(Qf[e]=!0,console.warn(e))}function tm(t){let e={hasErrorBoundary:t.hasErrorBoundary||t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&(t.element&&rt(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(e,{element:g.createElement(t.Component),Component:void 0})),t.HydrateFallback&&(t.hydrateFallbackElement&&rt(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(e,{hydrateFallbackElement:g.createElement(t.HydrateFallback),HydrateFallback:void 0})),t.ErrorBoundary&&(t.errorElement&&rt(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(e,{errorElement:g.createElement(t.ErrorBoundary),ErrorBoundary:void 0})),e}var GE=class{constructor(){this.status="pending",this.promise=new Promise((t,e)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",t(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",e(r))}})}};function qE({router:t,flushSync:e}){let[r,n]=g.useState(t.state),[a,o]=g.useState(),[i,s]=g.useState({isTransitioning:!1}),[l,c]=g.useState(),[u,d]=g.useState(),[h,p]=g.useState(),f=g.useRef(new Map),y=g.useCallback((A,{deletedFetchers:F,flushSync:b,viewTransitionOpts:D})=>{F.forEach(j=>f.current.delete(j)),A.fetchers.forEach((j,G)=>{j.data!==void 0&&f.current.set(G,j.data)}),em(b===!1||e!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let B=t.window!=null&&t.window.document!=null&&typeof t.window.document.startViewTransition=="function";if(em(D==null||B,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!D||!B){e&&b?e(()=>n(A)):g.startTransition(()=>n(A));return}if(e&&b){e(()=>{u&&(l&&l.resolve(),u.skipTransition()),s({isTransitioning:!0,flushSync:!0,currentLocation:D.currentLocation,nextLocation:D.nextLocation})});let j=t.window.document.startViewTransition(()=>{e(()=>n(A))});j.finished.finally(()=>{e(()=>{c(void 0),d(void 0),o(void 0),s({isTransitioning:!1})})}),e(()=>d(j));return}u?(l&&l.resolve(),u.skipTransition(),p({state:A,currentLocation:D.currentLocation,nextLocation:D.nextLocation})):(o(A),s({isTransitioning:!0,flushSync:!1,currentLocation:D.currentLocation,nextLocation:D.nextLocation}))},[t.window,e,u,l]);g.useLayoutEffect(()=>t.subscribe(y),[t,y]),g.useEffect(()=>{i.isTransitioning&&!i.flushSync&&c(new GE)},[i]),g.useEffect(()=>{if(l&&a&&t.window){let A=a,F=l.promise,b=t.window.document.startViewTransition(async()=>{g.startTransition(()=>n(A)),await F});b.finished.finally(()=>{c(void 0),d(void 0),o(void 0),s({isTransitioning:!1})}),d(b)}},[a,l,t.window]),g.useEffect(()=>{l&&a&&r.location.key===a.location.key&&l.resolve()},[l,u,r.location,a]),g.useEffect(()=>{!i.isTransitioning&&h&&(o(h.state),s({isTransitioning:!0,flushSync:!1,currentLocation:h.currentLocation,nextLocation:h.nextLocation}),p(void 0))},[i.isTransitioning,h]);let m=g.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:A=>t.navigate(A),push:(A,F,b)=>t.navigate(A,{state:F,preventScrollReset:b==null?void 0:b.preventScrollReset}),replace:(A,F,b)=>t.navigate(A,{replace:!0,state:F,preventScrollReset:b==null?void 0:b.preventScrollReset})}),[t]),_=t.basename||"/",w=g.useMemo(()=>({router:t,navigator:m,static:!1,basename:_}),[t,m,_]);return g.createElement(g.Fragment,null,g.createElement(Mn.Provider,{value:w},g.createElement(go.Provider,{value:r},g.createElement(qf.Provider,{value:f.current},g.createElement(kc.Provider,{value:i},g.createElement(YE,{basename:_,location:r.location,navigationType:r.historyAction,navigator:m},g.createElement(VE,{routes:t.routes,future:t.future,state:r})))))),null)}var VE=g.memo(ZE);function ZE({routes:t,future:e,state:r}){return PE(t,void 0,r,e)}function JE({to:t,replace:e,state:r,relative:n}){xe(oa(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=g.useContext(Jt);rt(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=g.useContext(It),{pathname:i}=mr(),s=Yn(),l=Ii(t,Ni(o),i,n==="path"),c=JSON.stringify(l);return g.useEffect(()=>{s(JSON.parse(c),{replace:e,state:r,relative:n})},[s,c,n,e,r]),null}function KE(t){return IE(t.context)}function Rr(t){xe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function YE({basename:t="/",children:e=null,location:r,navigationType:n="POP",navigator:a,static:o=!1}){xe(!oa(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let i=t.replace(/^\/*/,"/"),s=g.useMemo(()=>({basename:i,navigator:a,static:o,future:{}}),[i,a,o]);typeof r=="string"&&(r=Fr(r));let{pathname:l="/",search:c="",hash:u="",state:d=null,key:h="default"}=r,p=g.useMemo(()=>{let f=Vt(l,i);return f==null?null:{location:{pathname:f,search:c,hash:u,state:d,key:h},navigationType:n}},[i,l,c,u,d,h,n]);return rt(p!=null,`<Router basename="${i}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:g.createElement(Jt.Provider,{value:s},g.createElement(Li.Provider,{children:e,value:p}))}function Fc(t,e=[]){let r=[];return g.Children.forEach(t,(n,a)=>{if(!g.isValidElement(n))return;let o=[...e,a];if(n.type===g.Fragment){r.push.apply(r,Fc(n.props.children,o));return}xe(n.type===Rr,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),xe(!n.props.index||!n.props.children,"An index route cannot have child routes.");let i={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=Fc(n.props.children,o)),r.push(i)}),r}var XE=Fc,Di="get",$i="application/x-www-form-urlencoded";function zi(t){return t!=null&&typeof t.tagName=="string"}function QE(t){return zi(t)&&t.tagName.toLowerCase()==="button"}function eS(t){return zi(t)&&t.tagName.toLowerCase()==="form"}function tS(t){return zi(t)&&t.tagName.toLowerCase()==="input"}function rS(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function nS(t,e){return t.button===0&&(!e||e==="_self")&&!rS(t)}var Ui=null;function aS(){if(Ui===null)try{new FormData(document.createElement("form"),0),Ui=!1}catch{Ui=!0}return Ui}var oS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Rc(t){return t!=null&&!oS.has(t)?(rt(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${$i}"`),null):t}function iS(t,e){let r,n,a,o,i;if(eS(t)){let s=t.getAttribute("action");n=s?Vt(s,e):null,r=t.getAttribute("method")||Di,a=Rc(t.getAttribute("enctype"))||$i,o=new FormData(t)}else if(QE(t)||tS(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||s.getAttribute("action");if(n=l?Vt(l,e):null,r=t.getAttribute("formmethod")||s.getAttribute("method")||Di,a=Rc(t.getAttribute("formenctype"))||Rc(s.getAttribute("enctype"))||$i,o=new FormData(s,t),!aS()){let{name:c,type:u,value:d}=t;if(u==="image"){let h=c?`${c}.`:"";o.append(`${h}x`,"0"),o.append(`${h}y`,"0")}else c&&o.append(c,d)}}else{if(zi(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=Di,n=null,a=$i,i=t}return o&&a==="text/plain"&&(i=o,o=void 0),{action:n,method:r.toLowerCase(),encType:a,formData:o,body:i}}function Oc(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function sS(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module).then(async n=>(await n.__tla,n));return e[t.id]=r,r}catch(r){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function lS(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function cS(t,e,r){let n=await Promise.all(t.map(async a=>{let o=e.routes[a.route.id];if(o){let i=await sS(o,r);return i.links?i.links():[]}return[]}));return pS(n.flat(1).filter(lS).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function rm(t,e,r,n,a,o){let i=(l,c)=>r[c]?l.route.id!==r[c].route.id:!0,s=(l,c)=>{var u;return r[c].pathname!==l.pathname||((u=r[c].route.path)==null?void 0:u.endsWith("*"))&&r[c].params["*"]!==l.params["*"]};return o==="assets"?e.filter((l,c)=>i(l,c)||s(l,c)):o==="data"?e.filter((l,c)=>{var d;let u=n.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(i(l,c)||s(l,c))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((d=r[0])==null?void 0:d.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function uS(t,e){return dS(t.map(r=>{let n=e.routes[r.route.id];if(!n)return[];let a=[n.module];return n.imports&&(a=a.concat(n.imports)),a}).flat(1))}function dS(t){return[...new Set(t)]}function hS(t){let e={},r=Object.keys(t).sort();for(let n of r)e[n]=t[n];return e}function pS(t,e){let r=new Set;return new Set(e),t.reduce((n,a)=>{let o=JSON.stringify(hS(a));return r.has(o)||(r.add(o),n.push({key:o,link:a})),n},[])}function fS(t){let e=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function mS(){let t=g.useContext(Mn);return Oc(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function gS(){let t=g.useContext(go);return Oc(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Nc=g.createContext(void 0);Nc.displayName="FrameworkContext";function nm(){let t=g.useContext(Nc);return Oc(t,"You must render this element inside a <HydratedRouter> element"),t}function yS(t,e){let r=g.useContext(Nc),[n,a]=g.useState(!1),[o,i]=g.useState(!1),{onFocus:s,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=e,h=g.useRef(null);g.useEffect(()=>{if(t==="render"&&i(!0),t==="viewport"){let y=_=>{_.forEach(w=>{i(w.isIntersecting)})},m=new IntersectionObserver(y,{threshold:.5});return h.current&&m.observe(h.current),()=>{m.disconnect()}}},[t]),g.useEffect(()=>{if(n){let y=setTimeout(()=>{i(!0)},100);return()=>{clearTimeout(y)}}},[n]);let p=()=>{a(!0)},f=()=>{a(!1),i(!1)};return r?t!=="intent"?[o,h,{}]:[o,h,{onFocus:_o(s,p),onBlur:_o(l,f),onMouseEnter:_o(c,p),onMouseLeave:_o(u,f),onTouchStart:_o(d,p)}]:[!1,h,{}]}function _o(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function _S({page:t,...e}){let{router:r}=mS(),n=g.useMemo(()=>qr(r.routes,t,r.basename),[r.routes,t,r.basename]);return n?g.createElement(wS,{page:t,matches:n,...e}):(console.warn(`Tried to prefetch ${t} but no routes matched.`),null)}function vS(t){let{manifest:e,routeModules:r}=nm(),[n,a]=g.useState([]);return g.useEffect(()=>{let o=!1;return cS(t,e,r).then(i=>{o||a(i)}),()=>{o=!0}},[t,e,r]),n}function wS({page:t,matches:e,...r}){let n=mr(),{manifest:a,routeModules:o}=nm(),{loaderData:i,matches:s}=gS(),l=g.useMemo(()=>rm(t,e,s,a,n,"data"),[t,e,s,a,n]),c=g.useMemo(()=>rm(t,e,s,a,n,"assets"),[t,e,s,a,n]),u=g.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let p=new Set,f=!1;if(e.forEach(m=>{var w;let _=a.routes[m.route.id];!_||!_.hasLoader||(!l.some(A=>A.route.id===m.route.id)&&m.route.id in i&&((w=o[m.route.id])!=null&&w.shouldRevalidate)||_.hasClientLoader?f=!0:p.add(m.route.id))}),p.size===0)return[];let y=fS(t);return f&&p.size>0&&y.searchParams.set("_routes",e.filter(m=>p.has(m.route.id)).map(m=>m.route.id).join(",")),[y.pathname+y.search]},[i,n,a,l,e,t,o]),d=g.useMemo(()=>uS(c,a),[c,a]),h=vS(c);return g.createElement(g.Fragment,null,u.map(p=>g.createElement("link",{key:p,rel:"prefetch",as:"fetch",href:p,...r})),d.map(p=>g.createElement("link",{key:p,rel:"modulepreload",href:p,...r})),h.map(({key:p,link:f})=>g.createElement("link",{key:p,...f})))}function bS(...t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}var am=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{am&&(window.__reactRouterVersion="7.0.2")}catch{}function om(t,e){return Ff({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:C0({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||im(),routes:t,mapRouteProperties:tm,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function ES(t,e){return Ff({basename:e==null?void 0:e.basename,future:e==null?void 0:e.future,history:j0({window:e==null?void 0:e.window}),hydrationData:im(),routes:t,mapRouteProperties:tm,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function im(){let t=window==null?void 0:window.__staticRouterHydrationData;return t&&t.errors&&(t={...t,errors:SS(t.errors)}),t}function SS(t){if(!t)return null;let e=Object.entries(t),r={};for(let[n,a]of e)if(a&&a.__type==="RouteErrorResponse")r[n]=new Pi(a.status,a.statusText,a.data,a.internal===!0);else if(a&&a.__type==="Error"){if(a.__subType){let o=window[a.__subType];if(typeof o=="function")try{let i=new o(a.message);i.stack="",r[n]=i}catch{}}if(r[n]==null){let o=new Error(a.message);o.stack="",r[n]=o}}else r[n]=a;return r}var sm=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ic=g.forwardRef(function({onClick:t,discover:e="render",prefetch:r="none",relative:n,reloadDocument:a,replace:o,state:i,target:s,to:l,preventScrollReset:c,viewTransition:u,...d},h){let{basename:p}=g.useContext(Jt),f=typeof l=="string"&&sm.test(l),y,m=!1;if(typeof l=="string"&&f&&(y=l,am))try{let j=new URL(window.location.href),G=l.startsWith("//")?new URL(j.protocol+l):new URL(l),te=Vt(G.pathname,p);G.origin===j.origin&&te!=null?l=te+G.search+G.hash:m=!0}catch{rt(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let _=RE(l,{relative:n}),[w,A,F]=yS(r,d),b=TS(l,{replace:o,state:i,target:s,preventScrollReset:c,relative:n,viewTransition:u});function D(j){t&&t(j),j.defaultPrevented||b(j)}let B=g.createElement("a",{...d,...F,href:y||_,onClick:m||a?t:D,ref:bS(h,A),target:s,"data-discover":!f&&e==="render"?"true":void 0});return w&&!f?g.createElement(g.Fragment,null,B,g.createElement(_S,{page:_})):B});Ic.displayName="Link";var xS=g.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:r="",end:n=!1,style:a,to:o,viewTransition:i,children:s,...l},c){let u=yo(o,{relative:l.relative}),d=mr(),h=g.useContext(go),{navigator:p,basename:f}=g.useContext(Jt),y=h!=null&&NS(u)&&i===!0,m=p.encodeLocation?p.encodeLocation(u).pathname:u.pathname,_=d.pathname,w=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;e||(_=_.toLowerCase(),w=w?w.toLowerCase():null,m=m.toLowerCase()),w&&f&&(w=Vt(w,f)||w);const A=m!=="/"&&m.endsWith("/")?m.length-1:m.length;let F=_===m||!n&&_.startsWith(m)&&_.charAt(A)==="/",b=w!=null&&(w===m||!n&&w.startsWith(m)&&w.charAt(m.length)==="/"),D={isActive:F,isPending:b,isTransitioning:y},B=F?t:void 0,j;typeof r=="function"?j=r(D):j=[r,F?"active":null,b?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let G=typeof a=="function"?a(D):a;return g.createElement(Ic,{...l,"aria-current":B,className:j,ref:c,style:G,to:o,viewTransition:i},typeof s=="function"?s(D):s)});xS.displayName="NavLink";var kS=g.forwardRef(({discover:t="render",fetcherKey:e,navigate:r,reloadDocument:n,replace:a,state:o,method:i=Di,action:s,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,...h},p)=>{let f=RS(),y=OS(s,{relative:c}),m=i.toLowerCase()==="get"?"get":"post",_=typeof s=="string"&&sm.test(s),w=A=>{if(l&&l(A),A.defaultPrevented)return;A.preventDefault();let F=A.nativeEvent.submitter,b=(F==null?void 0:F.getAttribute("formmethod"))||i;f(F||A.currentTarget,{fetcherKey:e,method:b,navigate:r,replace:a,state:o,relative:c,preventScrollReset:u,viewTransition:d})};return g.createElement("form",{ref:p,method:m,action:y,onSubmit:n?l:w,...h,"data-discover":!_&&t==="render"?"true":void 0})});kS.displayName="Form";function AS(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lm(t){let e=g.useContext(Mn);return xe(e,AS(t)),e}function TS(t,{target:e,replace:r,state:n,preventScrollReset:a,relative:o,viewTransition:i}={}){let s=Yn(),l=mr(),c=yo(t,{relative:o});return g.useCallback(u=>{if(nS(u,e)){u.preventDefault();let d=r!==void 0?r:Mr(l)===Mr(c);s(t,{replace:d,state:n,preventScrollReset:a,relative:o,viewTransition:i})}},[l,s,c,r,n,e,t,a,o,i])}var MS=0,FS=()=>`__${String(++MS)}__`;function RS(){let{router:t}=lm("useSubmit"),{basename:e}=g.useContext(Jt),r=HE();return g.useCallback(async(n,a={})=>{let{action:o,method:i,encType:s,formData:l,body:c}=iS(n,e);if(a.navigate===!1){let u=a.fetcherKey||FS();await t.fetch(u,r,a.action||o,{preventScrollReset:a.preventScrollReset,formData:l,body:c,formMethod:a.method||i,formEncType:a.encType||s,flushSync:a.flushSync})}else await t.navigate(a.action||o,{preventScrollReset:a.preventScrollReset,formData:l,body:c,formMethod:a.method||i,formEncType:a.encType||s,replace:a.replace,state:a.state,fromRouteId:r,flushSync:a.flushSync,viewTransition:a.viewTransition})},[t,e,r])}function OS(t,{relative:e}={}){let{basename:r}=g.useContext(Jt),n=g.useContext(It);xe(n,"useFormAction must be used inside a RouteContext");let[a]=n.matches.slice(-1),o={...yo(t||".",{relative:e})},i=mr();if(t==null){o.search=i.search;let s=new URLSearchParams(o.search),l=s.getAll("index");if(l.some(c=>c==="")){s.delete("index"),l.filter(u=>u).forEach(u=>s.append("index",u));let c=s.toString();o.search=c?`?${c}`:""}}return(!t||t===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(o.pathname=o.pathname==="/"?r:fr([r,o.pathname])),Mr(o)}function NS(t,e={}){let r=g.useContext(kc);xe(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=lm("useViewTransitionState"),a=yo(t,{relative:e.relative});if(!r.isTransitioning)return!1;let o=Vt(r.currentLocation.pathname,n)||r.currentLocation.pathname,i=Vt(r.nextLocation.pathname,n)||r.nextLocation.pathname;return Oi(a.pathname,i)!=null||Oi(a.pathname,o)!=null}new TextEncoder;function IS(t){return g.createElement(qE,{flushSync:Kb.flushSync,...t})}var PS=VN.useId||(()=>{}),CS=0;Wt=function(t){const[e,r]=g.useState(PS());return hi(()=>{t||r(n=>n??String(CS++))},[t]),t||(e?`radix-${e}`:"")};let Bi,cm,um,Hi,Pc;Bi="Collapsible",[cm,a0]=pi(Bi),[um,Hi]=cm(Bi),Pc=g.forwardRef((t,e)=>{const{__scopeCollapsible:r,open:n,defaultOpen:a,disabled:o,onOpenChange:i,...s}=t,[l=!1,c]=Za({prop:n,defaultProp:a,onChange:i});return v.jsx(um,{scope:r,disabled:o,contentId:Wt(),open:l,onOpenToggle:g.useCallback(()=>c(u=>!u),[c]),children:v.jsx(Qe.div,{"data-state":Dc(l),"data-disabled":o?"":void 0,...s,ref:e})})}),Pc.displayName=Bi;var dm="CollapsibleTrigger",Cc=g.forwardRef((t,e)=>{const{__scopeCollapsible:r,...n}=t,a=Hi(dm,r);return v.jsx(Qe.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":Dc(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...n,ref:e,onClick:be(t.onClick,a.onOpenToggle)})});Cc.displayName=dm;var jc="CollapsibleContent",Lc=g.forwardRef((t,e)=>{const{forceMount:r,...n}=t,a=Hi(jc,t.__scopeCollapsible);return v.jsx(Tr,{present:r||a.open,children:({present:o})=>v.jsx(jS,{...n,ref:e,present:o})})});Lc.displayName=jc;var jS=g.forwardRef((t,e)=>{const{__scopeCollapsible:r,present:n,children:a,...o}=t,i=Hi(jc,r),[s,l]=g.useState(n),c=g.useRef(null),u=Rt(e,c),d=g.useRef(0),h=d.current,p=g.useRef(0),f=p.current,y=i.open||s,m=g.useRef(y),_=g.useRef();return g.useEffect(()=>{const w=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(w)},[]),hi(()=>{const w=c.current;if(w){_.current=_.current||{transitionDuration:w.style.transitionDuration,animationName:w.style.animationName},w.style.transitionDuration="0s",w.style.animationName="none";const A=w.getBoundingClientRect();d.current=A.height,p.current=A.width,m.current||(w.style.transitionDuration=_.current.transitionDuration,w.style.animationName=_.current.animationName),l(n)}},[i.open,n]),v.jsx(Qe.div,{"data-state":Dc(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!y,...o,ref:u,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...t.style},children:y&&a})});function Dc(t){return t?"open":"closed"}Dp=Pc,s0=Cc,l0=Lc;const LS=Dp,DS=Cc,$S=Lc,$c=768;function zS(){const[t,e]=g.useState(void 0);return g.useEffect(()=>{const r=window.matchMedia(`(max-width: ${$c-1}px)`),n=()=>{e(window.innerWidth<$c)};return r.addEventListener("change",n),e(window.innerWidth<$c),()=>r.removeEventListener("change",n)},[]),!!t}jp=bl("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Hr=g.forwardRef(({className:t,variant:e,size:r,asChild:n=!1,...a},o)=>{const i=n?_n:"button";return v.jsx(i,{className:me(jp({variant:e,size:r,className:t})),ref:o,...a})}),Hr.displayName="Button",Si=g.forwardRef(({className:t,type:e,...r},n)=>v.jsx("input",{type:e,className:me("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...r})),Si.displayName="Input";var US="Separator",hm="horizontal",BS=["horizontal","vertical"],pm=g.forwardRef((t,e)=>{const{decorative:r,orientation:n=hm,...a}=t,o=HS(n)?n:hm,i=r?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return v.jsx(Qe.div,{"data-orientation":o,...i,...a,ref:e})});pm.displayName=US;function HS(t){return BS.includes(t)}Vl=pm,_i=g.forwardRef(({className:t,orientation:e="horizontal",decorative:r=!0,...n},a)=>v.jsx(Vl,{ref:a,decorative:r,orientation:e,className:me("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n})),_i.displayName=Vl.displayName;let Wi,Gi,zc,fm;Wi="focusScope.autoFocusOnMount",Gi="focusScope.autoFocusOnUnmount",zc={bubbles:!1,cancelable:!0},fm="FocusScope",wi=g.forwardRef((t,e)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:a,onUnmountAutoFocus:o,...i}=t,[s,l]=g.useState(null),c=Zn(a),u=Zn(o),d=g.useRef(null),h=Rt(e,y=>l(y)),p=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(n){let y=function(A){if(p.paused||!s)return;const F=A.target;s.contains(F)?d.current=F:Zr(d.current,{select:!0})},m=function(A){if(p.paused||!s)return;const F=A.relatedTarget;F!==null&&(s.contains(F)||Zr(d.current,{select:!0}))},_=function(A){if(document.activeElement===document.body)for(const F of A)F.removedNodes.length>0&&Zr(s)};document.addEventListener("focusin",y),document.addEventListener("focusout",m);const w=new MutationObserver(_);return s&&w.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",m),w.disconnect()}}},[n,s,p.paused]),g.useEffect(()=>{if(s){ym.add(p);const y=document.activeElement;if(!s.contains(y)){const m=new CustomEvent(Wi,zc);s.addEventListener(Wi,c),s.dispatchEvent(m),m.defaultPrevented||(WS(JS(mm(s)),{select:!0}),document.activeElement===y&&Zr(s))}return()=>{s.removeEventListener(Wi,c),setTimeout(()=>{const m=new CustomEvent(Gi,zc);s.addEventListener(Gi,u),s.dispatchEvent(m),m.defaultPrevented||Zr(y??document.body,{select:!0}),s.removeEventListener(Gi,u),ym.remove(p)},0)}}},[s,c,u,p]);const f=g.useCallback(y=>{if(!r&&!n||p.paused)return;const m=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,_=document.activeElement;if(m&&_){const w=y.currentTarget,[A,F]=GS(w);A&&F?!y.shiftKey&&_===F?(y.preventDefault(),r&&Zr(A,{select:!0})):y.shiftKey&&_===A&&(y.preventDefault(),r&&Zr(F,{select:!0})):_===w&&y.preventDefault()}},[r,n,p.paused]);return v.jsx(Qe.div,{tabIndex:-1,...i,ref:h,onKeyDown:f})}),wi.displayName=fm;function WS(t,{select:e=!1}={}){const r=document.activeElement;for(const n of t)if(Zr(n,{select:e}),document.activeElement!==r)return}function GS(t){const e=mm(t),r=gm(e,t),n=gm(e.reverse(),t);return[r,n]}function mm(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const a=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||a?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function gm(t,e){for(const r of t)if(!qS(r,{upTo:e}))return r}function qS(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function VS(t){return t instanceof HTMLInputElement&&"select"in t}function Zr(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&VS(t)&&e&&t.select()}}var ym=ZS();function ZS(){let t=[];return{add(e){const r=t[0];e!==r&&(r==null||r.pause()),t=_m(t,e),t.unshift(e)},remove(e){var r;t=_m(t,e),(r=t[0])==null||r.resume()}}}function _m(t,e){const r=[...t],n=r.indexOf(e);return n!==-1&&r.splice(n,1),r}function JS(t){return t.filter(e=>e.tagName!=="A")}var Uc=0;Ol=function(){g.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??vm()),document.body.insertAdjacentElement("beforeend",t[1]??vm()),Uc++,()=>{Uc===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Uc--}},[])};function vm(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}Ht=function(){return Ht=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},Ht.apply(this,arguments)},Ml=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(t);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(t,n[a])&&(r[n[a]]=t[n[a]]);return r},up=function(t,e,r){if(r||arguments.length===2)for(var n=0,a=e.length,o;n<a;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))};var qi="right-scroll-bar-position",Vi="width-before-scroll-bar",KS="with-scroll-bars-hidden",YS="--removed-body-scroll-bar-size";function Bc(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function XS(t,e){var r=g.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(n){var a=r.value;a!==n&&(r.value=n,r.callback(n,a))}}}})[0];return r.callback=e,r.facade}var QS=typeof window<"u"?g.useLayoutEffect:g.useEffect,wm=new WeakMap;function ex(t,e){var r=XS(null,function(n){return t.forEach(function(a){return Bc(a,n)})});return QS(function(){var n=wm.get(r);if(n){var a=new Set(n),o=new Set(t),i=r.current;a.forEach(function(s){o.has(s)||Bc(s,null)}),o.forEach(function(s){a.has(s)||Bc(s,i)})}wm.set(r,t)},[t]),r}function tx(t){return t}function rx(t,e){e===void 0&&(e=tx);var r=[],n=!1,a={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(o){var i=e(o,n);return r.push(i),function(){r=r.filter(function(s){return s!==i})}},assignSyncMedium:function(o){for(n=!0;r.length;){var i=r;r=[],i.forEach(o)}r={push:function(s){return o(s)},filter:function(){return r}}},assignMedium:function(o){n=!0;var i=[];if(r.length){var s=r;r=[],s.forEach(o),i=r}var l=function(){var u=i;i=[],u.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),r={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),r}}}};return a}lp=function(t){t===void 0&&(t={});var e=rx(null);return e.options=Ht({async:!0,ssr:!1},t),e};var bm=function(t){var e=t.sideCar,r=Ml(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return g.createElement(n,Ht({},r))};bm.isSideCarExport=!0,dp=function(t,e){return t.useMedium(e),bm};var Em=lp(),Hc=function(){},Zi=g.forwardRef(function(t,e){var r=g.useRef(null),n=g.useState({onScrollCapture:Hc,onWheelCapture:Hc,onTouchMoveCapture:Hc}),a=n[0],o=n[1],i=t.forwardProps,s=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,p=t.noIsolation,f=t.inert,y=t.allowPinchZoom,m=t.as,_=m===void 0?"div":m,w=t.gapMode,A=Ml(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),F=h,b=ex([r,e]),D=Ht(Ht({},A),a);return g.createElement(g.Fragment,null,u&&g.createElement(F,{sideCar:Em,removeScrollBar:c,shards:d,noIsolation:p,inert:f,setCallbacks:o,allowPinchZoom:!!y,lockRef:r,gapMode:w}),i?g.cloneElement(g.Children.only(s),Ht(Ht({},D),{ref:b})):g.createElement(_,Ht({},D,{className:l,ref:b}),s))});Zi.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Zi.classNames={fullWidth:Vi,zeroRight:qi},cp=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function nx(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=cp();return e&&t.setAttribute("nonce",e),t}function ax(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function ox(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}let Sm,xm,km,Ji,Am,Tm,Mm,Fn,Fm,Wc,Rm,Om,Ki;if(Sm=function(){var t=0,e=null;return{add:function(r){t==0&&(e=nx())&&(ax(e,r),ox(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},xm=function(){var t=Sm();return function(e,r){g.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},Fl=function(){var t=xm(),e=function(r){var n=r.styles,a=r.dynamic;return t(n,a),null};return e},km={left:0,top:0,right:0,gap:0},Ji=function(t){return parseInt(t||"",10)||0},Am=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],a=e[t==="padding"?"paddingRight":"marginRight"];return[Ji(r),Ji(n),Ji(a)]},Tm=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return km;var e=Am(t),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-r+e[2]-e[0])}},Mm=Fl(),Fn="data-scroll-locked",Fm=function(t,e,r,n){var a=t.left,o=t.top,i=t.right,s=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(KS,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(s,"px ").concat(n,`;
  }
  body[`).concat(Fn,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(s,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(qi,` {
    right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(Vi,` {
    margin-right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(qi," .").concat(qi,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(Vi," .").concat(Vi,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Fn,`] {
    `).concat(YS,": ").concat(s,`px;
  }
`)},Wc=function(){var t=parseInt(document.body.getAttribute(Fn)||"0",10);return isFinite(t)?t:0},Rm=function(){g.useEffect(function(){return document.body.setAttribute(Fn,(Wc()+1).toString()),function(){var t=Wc()-1;t<=0?document.body.removeAttribute(Fn):document.body.setAttribute(Fn,t.toString())}},[])},Om=function(t){var e=t.noRelative,r=t.noImportant,n=t.gapMode,a=n===void 0?"margin":n;Rm();var o=g.useMemo(function(){return Tm(a)},[a]);return g.createElement(Mm,{styles:Fm(o,!e,a,r?"":"!important")})},Ki=!1,typeof window<"u")try{var Yi=Object.defineProperty({},"passive",{get:function(){return Ki=!0,!0}});window.addEventListener("test",Yi,Yi),window.removeEventListener("test",Yi,Yi)}catch{Ki=!1}var ia=Ki?{passive:!1}:!1,ix=function(t){return t.tagName==="TEXTAREA"},Nm=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!ix(t)&&r[e]==="visible")},sx=function(t){return Nm(t,"overflowY")},lx=function(t){return Nm(t,"overflowX")},Im=function(t,e){var r=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var a=Pm(t,n);if(a){var o=Cm(t,n),i=o[1],s=o[2];if(i>s)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},cx=function(t){var e=t.scrollTop,r=t.scrollHeight,n=t.clientHeight;return[e,r,n]},ux=function(t){var e=t.scrollLeft,r=t.scrollWidth,n=t.clientWidth;return[e,r,n]},Pm=function(t,e){return t==="v"?sx(e):lx(e)},Cm=function(t,e){return t==="v"?cx(e):ux(e)},dx=function(t,e){return t==="h"&&e==="rtl"?-1:1},hx=function(t,e,r,n,a){var o=dx(t,window.getComputedStyle(e).direction),i=o*n,s=r.target,l=e.contains(s),c=!1,u=i>0,d=0,h=0;do{var p=Cm(t,s),f=p[0],y=p[1],m=p[2],_=y-m-o*f;(f||_)&&Pm(t,s)&&(d+=_,h+=f),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!l&&s!==document.body||l&&(e.contains(s)||e===s));return(u&&(Math.abs(d)<1||!a)||!u&&(Math.abs(h)<1||!a))&&(c=!0),c},Xi=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},jm=function(t){return[t.deltaX,t.deltaY]},Lm=function(t){return t&&"current"in t?t.current:t},px=function(t,e){return t[0]===e[0]&&t[1]===e[1]},fx=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},mx=0,sa=[];function gx(t){var e=g.useRef([]),r=g.useRef([0,0]),n=g.useRef(),a=g.useState(mx++)[0],o=g.useState(Fl)[0],i=g.useRef(t);g.useEffect(function(){i.current=t},[t]),g.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(a));var y=up([t.lockRef.current],(t.shards||[]).map(Lm),!0).filter(Boolean);return y.forEach(function(m){return m.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),y.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(a))})}}},[t.inert,t.lockRef.current,t.shards]);var s=g.useCallback(function(y,m){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!i.current.allowPinchZoom;var _=Xi(y),w=r.current,A="deltaX"in y?y.deltaX:w[0]-_[0],F="deltaY"in y?y.deltaY:w[1]-_[1],b,D=y.target,B=Math.abs(A)>Math.abs(F)?"h":"v";if("touches"in y&&B==="h"&&D.type==="range")return!1;var j=Im(B,D);if(!j)return!0;if(j?b=B:(b=B==="v"?"h":"v",j=Im(B,D)),!j)return!1;if(!n.current&&"changedTouches"in y&&(A||F)&&(n.current=b),!b)return!0;var G=n.current||b;return hx(G,m,y,G==="h"?A:F,!0)},[]),l=g.useCallback(function(y){var m=y;if(!(!sa.length||sa[sa.length-1]!==o)){var _="deltaY"in m?jm(m):Xi(m),w=e.current.filter(function(b){return b.name===m.type&&(b.target===m.target||m.target===b.shadowParent)&&px(b.delta,_)})[0];if(w&&w.should){m.cancelable&&m.preventDefault();return}if(!w){var A=(i.current.shards||[]).map(Lm).filter(Boolean).filter(function(b){return b.contains(m.target)}),F=A.length>0?s(m,A[0]):!i.current.noIsolation;F&&m.cancelable&&m.preventDefault()}}},[]),c=g.useCallback(function(y,m,_,w){var A={name:y,delta:m,target:_,should:w,shadowParent:yx(_)};e.current.push(A),setTimeout(function(){e.current=e.current.filter(function(F){return F!==A})},1)},[]),u=g.useCallback(function(y){r.current=Xi(y),n.current=void 0},[]),d=g.useCallback(function(y){c(y.type,jm(y),y.target,s(y,t.lockRef.current))},[]),h=g.useCallback(function(y){c(y.type,Xi(y),y.target,s(y,t.lockRef.current))},[]);g.useEffect(function(){return sa.push(o),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,ia),document.addEventListener("touchmove",l,ia),document.addEventListener("touchstart",u,ia),function(){sa=sa.filter(function(y){return y!==o}),document.removeEventListener("wheel",l,ia),document.removeEventListener("touchmove",l,ia),document.removeEventListener("touchstart",u,ia)}},[]);var p=t.removeScrollBar,f=t.inert;return g.createElement(g.Fragment,null,f?g.createElement(o,{styles:fx(a)}):null,p?g.createElement(Om,{gapMode:t.gapMode}):null)}function yx(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const _x=dp(Em,gx);vi=g.forwardRef(function(t,e){return g.createElement(Zi,Ht({},t,{ref:e,sideCar:_x}))}),vi.classNames=Zi.classNames;let Dm,Rn,vo,wo,Qi,Gc,$m,zm,es,qc,Um,Pt,Vc;Dm=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Rn=new WeakMap,vo=new WeakMap,wo={},Qi=0,Gc=function(t){return t&&(t.host||Gc(t.parentNode))},$m=function(t,e){return e.map(function(r){if(t.contains(r))return r;var n=Gc(r);return n&&t.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},zm=function(t,e,r,n){var a=$m(e,Array.isArray(t)?t:[t]);wo[r]||(wo[r]=new WeakMap);var o=wo[r],i=[],s=new Set,l=new Set(a),c=function(d){!d||s.has(d)||(s.add(d),c(d.parentNode))};a.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(s.has(h))u(h);else try{var p=h.getAttribute(n),f=p!==null&&p!=="false",y=(Rn.get(h)||0)+1,m=(o.get(h)||0)+1;Rn.set(h,y),o.set(h,m),i.push(h),y===1&&f&&vo.set(h,!0),m===1&&h.setAttribute(r,"true"),f||h.setAttribute(n,"true")}catch(_){console.error("aria-hidden: cannot operate on ",h,_)}})};return u(e),s.clear(),Qi++,function(){i.forEach(function(d){var h=Rn.get(d)-1,p=o.get(d)-1;Rn.set(d,h),o.set(d,p),h||(vo.has(d)||d.removeAttribute(n),vo.delete(d)),p||d.removeAttribute(r)}),Qi--,Qi||(Rn=new WeakMap,Rn=new WeakMap,vo=new WeakMap,wo={})}},Rl=function(t,e,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),a=Dm(t);return a?(n.push.apply(n,Array.from(a.querySelectorAll("[aria-live]"))),zm(n,a,r,"aria-hidden")):function(){return null}},es="Dialog",[qc,F0]=pi(es),[Um,Pt]=qc(es),Vc=t=>{const{__scopeDialog:e,children:r,open:n,defaultOpen:a,onOpenChange:o,modal:i=!0}=t,s=g.useRef(null),l=g.useRef(null),[c=!1,u]=Za({prop:n,defaultProp:a,onChange:o});return v.jsx(Um,{scope:e,triggerRef:s,contentRef:l,contentId:Wt(),titleId:Wt(),descriptionId:Wt(),open:c,onOpenChange:u,onOpenToggle:g.useCallback(()=>u(d=>!d),[u]),modal:i,children:r})},Vc.displayName=es;var Bm="DialogTrigger",Hm=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(Bm,r),o=Rt(e,a.triggerRef);return v.jsx(Qe.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Kc(a.open),...n,ref:o,onClick:be(t.onClick,a.onOpenToggle)})});Hm.displayName=Bm;var Zc="DialogPortal",[vx,Wm]=qc(Zc,{forceMount:void 0}),Gm=t=>{const{__scopeDialog:e,forceMount:r,children:n,container:a}=t,o=Pt(Zc,e);return v.jsx(vx,{scope:e,forceMount:r,children:g.Children.map(n,i=>v.jsx(Tr,{present:r||o.open,children:v.jsx(Vh,{asChild:!0,container:a,children:i})}))})};Gm.displayName=Zc;var ts="DialogOverlay",qm=g.forwardRef((t,e)=>{const r=Wm(ts,t.__scopeDialog),{forceMount:n=r.forceMount,...a}=t,o=Pt(ts,t.__scopeDialog);return o.modal?v.jsx(Tr,{present:n||o.open,children:v.jsx(wx,{...a,ref:e})}):null});qm.displayName=ts;var wx=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(ts,r);return v.jsx(vi,{as:_n,allowPinchZoom:!0,shards:[a.contentRef],children:v.jsx(Qe.div,{"data-state":Kc(a.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),On="DialogContent",Vm=g.forwardRef((t,e)=>{const r=Wm(On,t.__scopeDialog),{forceMount:n=r.forceMount,...a}=t,o=Pt(On,t.__scopeDialog);return v.jsx(Tr,{present:n||o.open,children:o.modal?v.jsx(bx,{...a,ref:e}):v.jsx(Ex,{...a,ref:e})})});Vm.displayName=On;var bx=g.forwardRef((t,e)=>{const r=Pt(On,t.__scopeDialog),n=g.useRef(null),a=Rt(e,r.contentRef,n);return g.useEffect(()=>{const o=n.current;if(o)return Rl(o)},[]),v.jsx(Zm,{...t,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:be(t.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:be(t.onPointerDownOutside,o=>{const i=o.detail.originalEvent,s=i.button===0&&i.ctrlKey===!0;(i.button===2||s)&&o.preventDefault()}),onFocusOutside:be(t.onFocusOutside,o=>o.preventDefault())})}),Ex=g.forwardRef((t,e)=>{const r=Pt(On,t.__scopeDialog),n=g.useRef(!1),a=g.useRef(!1);return v.jsx(Zm,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,s;(i=t.onCloseAutoFocus)==null||i.call(t,o),o.defaultPrevented||(n.current||((s=r.triggerRef.current)==null||s.focus()),o.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:o=>{var s,l;(s=t.onInteractOutside)==null||s.call(t,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=o.target;(l=r.triggerRef.current)!=null&&l.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&a.current&&o.preventDefault()}})}),Zm=g.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:o,...i}=t,s=Pt(On,r),l=g.useRef(null),c=Rt(e,l);return Ol(),v.jsxs(v.Fragment,{children:[v.jsx(wi,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:o,children:v.jsx(qh,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":Kc(s.open),...i,ref:c,onDismiss:()=>s.onOpenChange(!1)})}),v.jsxs(v.Fragment,{children:[v.jsx(eg,{titleId:s.titleId}),v.jsx(rg,{contentRef:l,descriptionId:s.descriptionId})]})]})}),Jc="DialogTitle",Jm=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(Jc,r);return v.jsx(Qe.h2,{id:a.titleId,...n,ref:e})});Jm.displayName=Jc;var Km="DialogDescription",Ym=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(Km,r);return v.jsx(Qe.p,{id:a.descriptionId,...n,ref:e})});Ym.displayName=Km;var Xm="DialogClose",Qm=g.forwardRef((t,e)=>{const{__scopeDialog:r,...n}=t,a=Pt(Xm,r);return v.jsx(Qe.button,{type:"button",...n,ref:e,onClick:be(t.onClick,()=>a.onOpenChange(!1))})});Qm.displayName=Xm;function Kc(t){return t?"open":"closed"}let Yc,Xc,eg,tg,rg;Yc="DialogTitleWarning",[n0,Xc]=ZN(Yc,{contentName:On,titleName:Jc,docsSlug:"dialog"}),eg=({titleId:t})=>{const e=Xc(Yc),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return g.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},tg="DialogDescriptionWarning",rg=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Xc(tg).contentName}}.`;return g.useEffect(()=>{var a;const n=(a=t.current)==null?void 0:a.getAttribute("aria-describedby");e&&n&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},Tl=Vc,r0=Hm,Al=Gm,ro=qm,Xa=Vm,ao=Jm,Qa=Ym,sc=Qm;const Sx=Tl,xx=Al,ng=g.forwardRef(({className:t,...e},r)=>v.jsx(ro,{className:me("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:r}));ng.displayName=ro.displayName;const kx=bl("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ag=g.forwardRef(({side:t="right",className:e,children:r,...n},a)=>v.jsxs(xx,{children:[v.jsx(ng,{}),v.jsxs(Xa,{ref:a,className:me(kx({side:t}),e),...n,children:[r,v.jsxs(sc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[v.jsx(Ke,{name:"x",className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ag.displayName=Xa.displayName;const Ax=g.forwardRef(({className:t,...e},r)=>v.jsx(ao,{ref:r,className:me("text-lg font-semibold text-foreground",t),...e}));Ax.displayName=ao.displayName;const Tx=g.forwardRef(({className:t,...e},r)=>v.jsx(Qa,{ref:r,className:me("text-sm text-muted-foreground",t),...e}));Tx.displayName=Qa.displayName;function og({className:t,...e}){return v.jsx("div",{className:me("animate-pulse rounded-md bg-muted",t),...e})}const Mx=["top","right","bottom","left"],gr=Math.min,xt=Math.max,rs=Math.round,ns=Math.floor,Jr=t=>({x:t,y:t}),Fx={left:"right",right:"left",bottom:"top",top:"bottom"},Rx={start:"end",end:"start"};function Qc(t,e,r){return xt(t,gr(e,r))}function Or(t,e){return typeof t=="function"?t(e):t}function Nr(t){return t.split("-")[0]}function la(t){return t.split("-")[1]}function eu(t){return t==="x"?"y":"x"}function tu(t){return t==="y"?"height":"width"}function Kr(t){return["top","bottom"].includes(Nr(t))?"y":"x"}function ru(t){return eu(Kr(t))}function Ox(t,e,r){r===void 0&&(r=!1);const n=la(t),a=ru(t),o=tu(a);let i=a==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(i=as(i)),[i,as(i)]}function Nx(t){const e=as(t);return[nu(t),e,nu(e)]}function nu(t){return t.replace(/start|end/g,e=>Rx[e])}function Ix(t,e,r){const n=["left","right"],a=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return r?e?a:n:e?n:a;case"left":case"right":return e?o:i;default:return[]}}function Px(t,e,r,n){const a=la(t);let o=Ix(Nr(t),r==="start",n);return a&&(o=o.map(i=>i+"-"+a),e&&(o=o.concat(o.map(nu)))),o}function as(t){return t.replace(/left|right|bottom|top/g,e=>Fx[e])}function Cx(t){return{top:0,right:0,bottom:0,left:0,...t}}function ig(t){return typeof t!="number"?Cx(t):{top:t,right:t,bottom:t,left:t}}function os(t){const{x:e,y:r,width:n,height:a}=t;return{width:n,height:a,top:r,left:e,right:e+n,bottom:r+a,x:e,y:r}}function sg(t,e,r){let{reference:n,floating:a}=t;const o=Kr(e),i=ru(e),s=tu(i),l=Nr(e),c=o==="y",u=n.x+n.width/2-a.width/2,d=n.y+n.height/2-a.height/2,h=n[s]/2-a[s]/2;let p;switch(l){case"top":p={x:u,y:n.y-a.height};break;case"bottom":p={x:u,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:d};break;case"left":p={x:n.x-a.width,y:d};break;default:p={x:n.x,y:n.y}}switch(la(e)){case"start":p[i]-=h*(r&&c?-1:1);break;case"end":p[i]+=h*(r&&c?-1:1);break}return p}const jx=async(t,e,r)=>{const{placement:n="bottom",strategy:a="absolute",middleware:o=[],platform:i}=r,s=o.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:a}),{x:u,y:d}=sg(c,n,l),h=n,p={},f=0;for(let y=0;y<s.length;y++){const{name:m,fn:_}=s[y],{x:w,y:A,data:F,reset:b}=await _({x:u,y:d,initialPlacement:n,placement:h,strategy:a,middlewareData:p,rects:c,platform:i,elements:{reference:t,floating:e}});u=w??u,d=A??d,p={...p,[m]:{...p[m],...F}},b&&f<=50&&(f++,typeof b=="object"&&(b.placement&&(h=b.placement),b.rects&&(c=b.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:a}):b.rects),{x:u,y:d}=sg(c,h,l)),y=-1)}return{x:u,y:d,placement:h,strategy:a,middlewareData:p}};async function bo(t,e){var r;e===void 0&&(e={});const{x:n,y:a,platform:o,rects:i,elements:s,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=Or(e,t),f=ig(p),y=s[h?d==="floating"?"reference":"floating":d],m=os(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(y)))==null||r?y:y.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(s.floating)),boundary:c,rootBoundary:u,strategy:l})),_=d==="floating"?{x:n,y:a,width:i.floating.width,height:i.floating.height}:i.reference,w=await(o.getOffsetParent==null?void 0:o.getOffsetParent(s.floating)),A=await(o.isElement==null?void 0:o.isElement(w))?await(o.getScale==null?void 0:o.getScale(w))||{x:1,y:1}:{x:1,y:1},F=os(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:_,offsetParent:w,strategy:l}):_);return{top:(m.top-F.top+f.top)/A.y,bottom:(F.bottom-m.bottom+f.bottom)/A.y,left:(m.left-F.left+f.left)/A.x,right:(F.right-m.right+f.right)/A.x}}const Lx=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:n,placement:a,rects:o,platform:i,elements:s,middlewareData:l}=e,{element:c,padding:u=0}=Or(t,e)||{};if(c==null)return{};const d=ig(u),h={x:r,y:n},p=ru(a),f=tu(p),y=await i.getDimensions(c),m=p==="y",_=m?"top":"left",w=m?"bottom":"right",A=m?"clientHeight":"clientWidth",F=o.reference[f]+o.reference[p]-h[p]-o.floating[f],b=h[p]-o.reference[p],D=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let B=D?D[A]:0;(!B||!await(i.isElement==null?void 0:i.isElement(D)))&&(B=s.floating[A]||o.floating[f]);const j=F/2-b/2,G=B/2-y[f]/2-1,te=gr(d[_],G),de=gr(d[w],G),x=te,R=B-y[f]-de,k=B/2-y[f]/2+j,E=Qc(x,k,R),H=!l.arrow&&la(a)!=null&&k!==E&&o.reference[f]/2-(k<x?te:de)-y[f]/2<0,N=H?k<x?k-x:k-R:0;return{[p]:h[p]+N,data:{[p]:E,centerOffset:k-E-N,...H&&{alignmentOffset:N}},reset:H}}}),Dx=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,n;const{placement:a,middlewareData:o,rects:i,initialPlacement:s,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:y=!0,...m}=Or(t,e);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const _=Nr(a),w=Kr(s),A=Nr(s)===s,F=await(l.isRTL==null?void 0:l.isRTL(c.floating)),b=h||(A||!y?[as(s)]:Nx(s)),D=f!=="none";!h&&D&&b.push(...Px(s,y,f,F));const B=[s,...b],j=await bo(e,m),G=[];let te=((n=o.flip)==null?void 0:n.overflows)||[];if(u&&G.push(j[_]),d){const k=Ox(a,i,F);G.push(j[k[0]],j[k[1]])}if(te=[...te,{placement:a,overflows:G}],!G.every(k=>k<=0)){var de,x;const k=(((de=o.flip)==null?void 0:de.index)||0)+1,E=B[k];if(E)return{data:{index:k,overflows:te},reset:{placement:E}};let H=(x=te.filter(N=>N.overflows[0]<=0).sort((N,C)=>N.overflows[1]-C.overflows[1])[0])==null?void 0:x.placement;if(!H)switch(p){case"bestFit":{var R;const N=(R=te.filter(C=>{if(D){const P=Kr(C.placement);return P===w||P==="y"}return!0}).map(C=>[C.placement,C.overflows.filter(P=>P>0).reduce((P,Z)=>P+Z,0)]).sort((C,P)=>C[1]-P[1])[0])==null?void 0:R[0];N&&(H=N);break}case"initialPlacement":H=s;break}if(a!==H)return{reset:{placement:H}}}return{}}}};function lg(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function cg(t){return Mx.some(e=>t[e]>=0)}const $x=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:n="referenceHidden",...a}=Or(t,e);switch(n){case"referenceHidden":{const o=await bo(e,{...a,elementContext:"reference"}),i=lg(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:cg(i)}}}case"escaped":{const o=await bo(e,{...a,altBoundary:!0}),i=lg(o,r.floating);return{data:{escapedOffsets:i,escaped:cg(i)}}}default:return{}}}}};async function zx(t,e){const{placement:r,platform:n,elements:a}=t,o=await(n.isRTL==null?void 0:n.isRTL(a.floating)),i=Nr(r),s=la(r),l=Kr(r)==="y",c=["left","top"].includes(i)?-1:1,u=o&&l?-1:1,d=Or(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:f}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return s&&typeof f=="number"&&(p=s==="end"?f*-1:f),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const Ux=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,n;const{x:a,y:o,placement:i,middlewareData:s}=e,l=await zx(e,t);return i===((r=s.offset)==null?void 0:r.placement)&&(n=s.arrow)!=null&&n.alignmentOffset?{}:{x:a+l.x,y:o+l.y,data:{...l,placement:i}}}}},Bx=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:n,placement:a}=e,{mainAxis:o=!0,crossAxis:i=!1,limiter:s={fn:m=>{let{x:_,y:w}=m;return{x:_,y:w}}},...l}=Or(t,e),c={x:r,y:n},u=await bo(e,l),d=Kr(Nr(a)),h=eu(d);let p=c[h],f=c[d];if(o){const m=h==="y"?"top":"left",_=h==="y"?"bottom":"right",w=p+u[m],A=p-u[_];p=Qc(w,p,A)}if(i){const m=d==="y"?"top":"left",_=d==="y"?"bottom":"right",w=f+u[m],A=f-u[_];f=Qc(w,f,A)}const y=s.fn({...e,[h]:p,[d]:f});return{...y,data:{x:y.x-r,y:y.y-n}}}}},Hx=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:n,placement:a,rects:o,middlewareData:i}=e,{offset:s=0,mainAxis:l=!0,crossAxis:c=!0}=Or(t,e),u={x:r,y:n},d=Kr(a),h=eu(d);let p=u[h],f=u[d];const y=Or(s,e),m=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const A=h==="y"?"height":"width",F=o.reference[h]-o.floating[A]+m.mainAxis,b=o.reference[h]+o.reference[A]-m.mainAxis;p<F?p=F:p>b&&(p=b)}if(c){var _,w;const A=h==="y"?"width":"height",F=["top","left"].includes(Nr(a)),b=o.reference[d]-o.floating[A]+(F&&((_=i.offset)==null?void 0:_[d])||0)+(F?0:m.crossAxis),D=o.reference[d]+o.reference[A]+(F?0:((w=i.offset)==null?void 0:w[d])||0)-(F?m.crossAxis:0);f<b?f=b:f>D&&(f=D)}return{[h]:p,[d]:f}}}},Wx=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:r,rects:n,platform:a,elements:o}=e,{apply:i=()=>{},...s}=Or(t,e),l=await bo(e,s),c=Nr(r),u=la(r),d=Kr(r)==="y",{width:h,height:p}=n.floating;let f,y;c==="top"||c==="bottom"?(f=c,y=u===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(y=c,f=u==="end"?"top":"bottom");const m=p-l.top-l.bottom,_=h-l.left-l.right,w=gr(p-l[f],m),A=gr(h-l[y],_),F=!e.middlewareData.shift;let b=w,D=A;if(d?D=u||F?gr(A,_):_:b=u||F?gr(w,m):m,F&&!u){const j=xt(l.left,0),G=xt(l.right,0),te=xt(l.top,0),de=xt(l.bottom,0);d?D=h-2*(j!==0||G!==0?j+G:xt(l.left,l.right)):b=p-2*(te!==0||de!==0?te+de:xt(l.top,l.bottom))}await i({...e,availableWidth:D,availableHeight:b});const B=await a.getDimensions(o.floating);return h!==B.width||p!==B.height?{reset:{rects:!0}}:{}}}};function ca(t){return ug(t)?(t.nodeName||"").toLowerCase():"#document"}function kt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Ir(t){var e;return(e=(ug(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function ug(t){return t instanceof Node||t instanceof kt(t).Node}function Kt(t){return t instanceof Element||t instanceof kt(t).Element}function yr(t){return t instanceof HTMLElement||t instanceof kt(t).HTMLElement}function dg(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof kt(t).ShadowRoot}function Eo(t){const{overflow:e,overflowX:r,overflowY:n,display:a}=Yt(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+r)&&!["inline","contents"].includes(a)}function Gx(t){return["table","td","th"].includes(ca(t))}function is(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function au(t){const e=ou(),r=Kt(t)?Yt(t):t;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function qx(t){let e=Yr(t);for(;yr(e)&&!ua(e);){if(au(e))return e;if(is(e))return null;e=Yr(e)}return null}function ou(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ua(t){return["html","body","#document"].includes(ca(t))}function Yt(t){return kt(t).getComputedStyle(t)}function ss(t){return Kt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Yr(t){if(ca(t)==="html")return t;const e=t.assignedSlot||t.parentNode||dg(t)&&t.host||Ir(t);return dg(e)?e.host:e}function hg(t){const e=Yr(t);return ua(e)?t.ownerDocument?t.ownerDocument.body:t.body:yr(e)&&Eo(e)?e:hg(e)}function So(t,e,r){var n;e===void 0&&(e=[]),r===void 0&&(r=!0);const a=hg(t),o=a===((n=t.ownerDocument)==null?void 0:n.body),i=kt(a);if(o){const s=iu(i);return e.concat(i,i.visualViewport||[],Eo(a)?a:[],s&&r?So(s):[])}return e.concat(a,So(a,[],r))}function iu(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function pg(t){const e=Yt(t);let r=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const a=yr(t),o=a?t.offsetWidth:r,i=a?t.offsetHeight:n,s=rs(r)!==o||rs(n)!==i;return s&&(r=o,n=i),{width:r,height:n,$:s}}function su(t){return Kt(t)?t:t.contextElement}function da(t){const e=su(t);if(!yr(e))return Jr(1);const r=e.getBoundingClientRect(),{width:n,height:a,$:o}=pg(e);let i=(o?rs(r.width):r.width)/n,s=(o?rs(r.height):r.height)/a;return(!i||!Number.isFinite(i))&&(i=1),(!s||!Number.isFinite(s))&&(s=1),{x:i,y:s}}const Vx=Jr(0);function fg(t){const e=kt(t);return!ou()||!e.visualViewport?Vx:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Zx(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==kt(t)?!1:e}function Nn(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1);const a=t.getBoundingClientRect(),o=su(t);let i=Jr(1);e&&(n?Kt(n)&&(i=da(n)):i=da(t));const s=Zx(o,r,n)?fg(o):Jr(0);let l=(a.left+s.x)/i.x,c=(a.top+s.y)/i.y,u=a.width/i.x,d=a.height/i.y;if(o){const h=kt(o),p=n&&Kt(n)?kt(n):n;let f=h,y=iu(f);for(;y&&n&&p!==f;){const m=da(y),_=y.getBoundingClientRect(),w=Yt(y),A=_.left+(y.clientLeft+parseFloat(w.paddingLeft))*m.x,F=_.top+(y.clientTop+parseFloat(w.paddingTop))*m.y;l*=m.x,c*=m.y,u*=m.x,d*=m.y,l+=A,c+=F,f=kt(y),y=iu(f)}}return os({width:u,height:d,x:l,y:c})}function Jx(t){let{elements:e,rect:r,offsetParent:n,strategy:a}=t;const o=a==="fixed",i=Ir(n),s=e?is(e.floating):!1;if(n===i||s&&o)return r;let l={scrollLeft:0,scrollTop:0},c=Jr(1);const u=Jr(0),d=yr(n);if((d||!d&&!o)&&((ca(n)!=="body"||Eo(i))&&(l=ss(n)),yr(n))){const h=Nn(n);c=da(n),u.x=h.x+n.clientLeft,u.y=h.y+n.clientTop}return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x,y:r.y*c.y-l.scrollTop*c.y+u.y}}function Kx(t){return Array.from(t.getClientRects())}function mg(t){return Nn(Ir(t)).left+ss(t).scrollLeft}function Yx(t){const e=Ir(t),r=ss(t),n=t.ownerDocument.body,a=xt(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),o=xt(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+mg(t);const s=-r.scrollTop;return Yt(n).direction==="rtl"&&(i+=xt(e.clientWidth,n.clientWidth)-a),{width:a,height:o,x:i,y:s}}function Xx(t,e){const r=kt(t),n=Ir(t),a=r.visualViewport;let o=n.clientWidth,i=n.clientHeight,s=0,l=0;if(a){o=a.width,i=a.height;const c=ou();(!c||c&&e==="fixed")&&(s=a.offsetLeft,l=a.offsetTop)}return{width:o,height:i,x:s,y:l}}function Qx(t,e){const r=Nn(t,!0,e==="fixed"),n=r.top+t.clientTop,a=r.left+t.clientLeft,o=yr(t)?da(t):Jr(1),i=t.clientWidth*o.x,s=t.clientHeight*o.y,l=a*o.x,c=n*o.y;return{width:i,height:s,x:l,y:c}}function gg(t,e,r){let n;if(e==="viewport")n=Xx(t,r);else if(e==="document")n=Yx(Ir(t));else if(Kt(e))n=Qx(e,r);else{const a=fg(t);n={...e,x:e.x-a.x,y:e.y-a.y}}return os(n)}function yg(t,e){const r=Yr(t);return r===e||!Kt(r)||ua(r)?!1:Yt(r).position==="fixed"||yg(r,e)}function ek(t,e){const r=e.get(t);if(r)return r;let n=So(t,[],!1).filter(s=>Kt(s)&&ca(s)!=="body"),a=null;const o=Yt(t).position==="fixed";let i=o?Yr(t):t;for(;Kt(i)&&!ua(i);){const s=Yt(i),l=au(i);!l&&s.position==="fixed"&&(a=null),(o?!l&&!a:!l&&s.position==="static"&&a&&["absolute","fixed"].includes(a.position)||Eo(i)&&!l&&yg(t,i))?n=n.filter(c=>c!==i):a=s,i=Yr(i)}return e.set(t,n),n}function tk(t){let{element:e,boundary:r,rootBoundary:n,strategy:a}=t;const o=[...r==="clippingAncestors"?is(e)?[]:ek(e,this._c):[].concat(r),n],i=o[0],s=o.reduce((l,c)=>{const u=gg(e,c,a);return l.top=xt(u.top,l.top),l.right=gr(u.right,l.right),l.bottom=gr(u.bottom,l.bottom),l.left=xt(u.left,l.left),l},gg(e,i,a));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function rk(t){const{width:e,height:r}=pg(t);return{width:e,height:r}}function nk(t,e,r){const n=yr(e),a=Ir(e),o=r==="fixed",i=Nn(t,!0,o,e);let s={scrollLeft:0,scrollTop:0};const l=Jr(0);if(n||!n&&!o)if((ca(e)!=="body"||Eo(a))&&(s=ss(e)),n){const d=Nn(e,!0,o,e);l.x=d.x+e.clientLeft,l.y=d.y+e.clientTop}else a&&(l.x=mg(a));const c=i.left+s.scrollLeft-l.x,u=i.top+s.scrollTop-l.y;return{x:c,y:u,width:i.width,height:i.height}}function lu(t){return Yt(t).position==="static"}function _g(t,e){return!yr(t)||Yt(t).position==="fixed"?null:e?e(t):t.offsetParent}function vg(t,e){const r=kt(t);if(is(t))return r;if(!yr(t)){let a=Yr(t);for(;a&&!ua(a);){if(Kt(a)&&!lu(a))return a;a=Yr(a)}return r}let n=_g(t,e);for(;n&&Gx(n)&&lu(n);)n=_g(n,e);return n&&ua(n)&&lu(n)&&!au(n)?r:n||qx(t)||r}const ak=async function(t){const e=this.getOffsetParent||vg,r=this.getDimensions,n=await r(t.floating);return{reference:nk(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function ok(t){return Yt(t).direction==="rtl"}const ik={convertOffsetParentRelativeRectToViewportRelativeRect:Jx,getDocumentElement:Ir,getClippingRect:tk,getOffsetParent:vg,getElementRects:ak,getClientRects:Kx,getDimensions:rk,getScale:da,isElement:Kt,isRTL:ok};function sk(t,e){let r=null,n;const a=Ir(t);function o(){var s;clearTimeout(n),(s=r)==null||s.disconnect(),r=null}function i(s,l){s===void 0&&(s=!1),l===void 0&&(l=1),o();const{left:c,top:u,width:d,height:h}=t.getBoundingClientRect();if(s||e(),!d||!h)return;const p=ns(u),f=ns(a.clientWidth-(c+d)),y=ns(a.clientHeight-(u+h)),m=ns(c),_={rootMargin:-p+"px "+-f+"px "+-y+"px "+-m+"px",threshold:xt(0,gr(1,l))||1};let w=!0;function A(F){const b=F[0].intersectionRatio;if(b!==l){if(!w)return i();b?i(!1,b):n=setTimeout(()=>{i(!1,1e-7)},1e3)}w=!1}try{r=new IntersectionObserver(A,{..._,root:a.ownerDocument})}catch{r=new IntersectionObserver(A,_)}r.observe(t)}return i(!0),o}tp=function(t,e,r,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=su(t),u=a||o?[...c?So(c):[],...So(e)]:[];u.forEach(_=>{a&&_.addEventListener("scroll",r,{passive:!0}),o&&_.addEventListener("resize",r)});const d=c&&s?sk(c,r):null;let h=-1,p=null;i&&(p=new ResizeObserver(_=>{let[w]=_;w&&w.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var A;(A=p)==null||A.observe(e)})),r()}),c&&!l&&p.observe(c),p.observe(e));let f,y=l?Nn(t):null;l&&m();function m(){const _=Nn(t);y&&(_.x!==y.x||_.y!==y.y||_.width!==y.width||_.height!==y.height)&&r(),y=_,f=requestAnimationFrame(m)}return r(),()=>{var _;u.forEach(w=>{a&&w.removeEventListener("scroll",r),o&&w.removeEventListener("resize",r)}),d==null||d(),(_=p)==null||_.disconnect(),p=null,l&&cancelAnimationFrame(f)}};let wg;Vp=Ux,Kp=Bx,Zp=Dx,nf=Wx,wg=$x,Jl=Lx,Lp=Hx,Jp=(t,e,r)=>{const n=new Map,a={platform:ik,...r},o={...a.platform,_c:n};return jx(t,e,{...a,platform:o})};var ls=typeof document<"u"?g.useLayoutEffect:g.useEffect;function cs(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,n,a;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(n=r;n--!==0;)if(!cs(t[n],e[n]))return!1;return!0}if(a=Object.keys(t),r=a.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(e,a[n]))return!1;for(n=r;n--!==0;){const o=a[n];if(!(o==="_owner"&&t.$$typeof)&&!cs(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function bg(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Eg(t,e){const r=bg(t);return Math.round(e*r)/r}function Sg(t){const e=g.useRef(t);return ls(()=>{e.current=t}),e}ep=function(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:n=[],platform:a,elements:{reference:o,floating:i}={},transform:s=!0,whileElementsMounted:l,open:c}=t,[u,d]=g.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=g.useState(n);cs(h,n)||p(n);const[f,y]=g.useState(null),[m,_]=g.useState(null),w=g.useCallback(N=>{N!==D.current&&(D.current=N,y(N))},[]),A=g.useCallback(N=>{N!==B.current&&(B.current=N,_(N))},[]),F=o||f,b=i||m,D=g.useRef(null),B=g.useRef(null),j=g.useRef(u),G=l!=null,te=Sg(l),de=Sg(a),x=g.useCallback(()=>{if(!D.current||!B.current)return;const N={placement:e,strategy:r,middleware:h};de.current&&(N.platform=de.current),Jp(D.current,B.current,N).then(C=>{const P={...C,isPositioned:!0};R.current&&!cs(j.current,P)&&(j.current=P,Kb.flushSync(()=>{d(P)}))})},[h,e,r,de]);ls(()=>{c===!1&&j.current.isPositioned&&(j.current.isPositioned=!1,d(N=>({...N,isPositioned:!1})))},[c]);const R=g.useRef(!1);ls(()=>(R.current=!0,()=>{R.current=!1}),[]),ls(()=>{if(F&&(D.current=F),b&&(B.current=b),F&&b){if(te.current)return te.current(F,b,x);x()}},[F,b,x,te,G]);const k=g.useMemo(()=>({reference:D,floating:B,setReference:w,setFloating:A}),[w,A]),E=g.useMemo(()=>({reference:F,floating:b}),[F,b]),H=g.useMemo(()=>{const N={position:r,left:0,top:0};if(!E.floating)return N;const C=Eg(E.floating,u.x),P=Eg(E.floating,u.y);return s?{...N,transform:"translate("+C+"px, "+P+"px)",...bg(E.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:C,top:P}},[r,s,E.floating,u.x,u.y]);return g.useMemo(()=>({...u,update:x,refs:k,elements:E,floatingStyles:H}),[u,x,k,E,H])};let xg;xg=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:n,padding:a}=typeof t=="function"?t(r):t;return n&&e(n)?n.current!=null?Jl({element:n.current,padding:a}).fn(r):{}:n?Jl({element:n,padding:a}).fn(r):{}}}},rp=(t,e)=>({...Vp(t),options:[t,e]}),np=(t,e)=>({...Kp(t),options:[t,e]}),sp=(t,e)=>({...Lp(t),options:[t,e]}),ap=(t,e)=>({...Zp(t),options:[t,e]}),op=(t,e)=>({...nf(t),options:[t,e]}),Yh=(t,e)=>({...wg(t),options:[t,e]}),ip=(t,e)=>({...xg(t),options:[t,e]});var lk="Arrow",kg=g.forwardRef((t,e)=>{const{children:r,width:n=10,height:a=5,...o}=t;return v.jsx(Qe.svg,{...o,ref:e,width:n,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:v.jsx("polygon",{points:"0,0 30,0 15,10"})})});kg.displayName=lk;var ck=kg;function Ag(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Tg(...t){return e=>{let r=!1;const n=t.map(a=>{const o=Ag(a,e);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let a=0;a<n.length;a++){const o=n[a];typeof o=="function"?o():Ag(t[a],null)}}}}function Mg(...t){return g.useCallback(Tg(...t),t)}function uk(t,e=[]){let r=[];function n(o,i){const s=g.createContext(i),l=r.length;r=[...r,i];function c(d){const{scope:h,children:p,...f}=d,y=(h==null?void 0:h[t][l])||s,m=g.useMemo(()=>f,Object.values(f));return v.jsx(y.Provider,{value:m,children:p})}function u(d,h){const p=(h==null?void 0:h[t][l])||s,f=g.useContext(p);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,u]}const a=()=>{const o=r.map(i=>g.createContext(i));return function(i){const s=(i==null?void 0:i[t])||o;return g.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return a.scopeName=t,[n,dk(a,...e)]}function dk(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=n.reduce((i,{useScope:s,scopeName:l})=>{const c=s(a)[`__scope${l}`];return{...i,...c}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}var Fg=g.forwardRef((t,e)=>{const{children:r,...n}=t,a=g.Children.toArray(r),o=a.find(pk);if(o){const i=o.props.children,s=a.map(l=>l===o?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:l);return v.jsx(cu,{...n,ref:e,children:g.isValidElement(i)?g.cloneElement(i,void 0,s):null})}return v.jsx(cu,{...n,ref:e,children:r})});Fg.displayName="Slot";var cu=g.forwardRef((t,e)=>{const{children:r,...n}=t;if(g.isValidElement(r)){const a=mk(r);return g.cloneElement(r,{...fk(n,r.props),ref:e?Tg(e,a):a})}return g.Children.count(r)>1?g.Children.only(null):null});cu.displayName="SlotClone";var hk=({children:t})=>v.jsx(v.Fragment,{children:t});function pk(t){return g.isValidElement(t)&&t.type===hk}function fk(t,e){const r={...e};for(const n in e){const a=t[n],o=e[n];/^on[A-Z]/.test(n)?a&&o?r[n]=(...i)=>{o(...i),a(...i)}:a&&(r[n]=a):n==="style"?r[n]={...a,...o}:n==="className"&&(r[n]=[a,o].filter(Boolean).join(" "))}return{...t,...r}}function mk(t){var n,a;let e=(n=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:n.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=(a=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:a.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var gk=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Rg=gk.reduce((t,e)=>{const r=g.forwardRef((n,a)=>{const{asChild:o,...i}=n,s=o?Fg:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(s,{...i,ref:a})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});gf=function(t){const[e,r]=g.useState(void 0);return hi(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const o=a[0];let i,s;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,s=c.blockSize}else i=t.offsetWidth,s=t.offsetHeight;r({width:i,height:s})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else r(void 0)},[t]),e};let us,uu,Og,du,hu;us="Popper",[uu,io]=uk(us),[Og,du]=uu(us),hu=t=>{const{__scopePopper:e,children:r}=t,[n,a]=g.useState(null);return v.jsx(Og,{scope:e,anchor:n,onAnchorChange:a,children:r})},hu.displayName=us;var Ng="PopperAnchor",Ig=g.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:n,...a}=t,o=du(Ng,r),i=g.useRef(null),s=Mg(e,i);return g.useEffect(()=>{o.onAnchorChange((n==null?void 0:n.current)||i.current)}),n?null:v.jsx(Rg.div,{...a,ref:s})});Ig.displayName=Ng;var pu="PopperContent",[yk,_k]=uu(pu),Pg=g.forwardRef((t,e)=>{var Dt,Ft,Fe,dt,Hn,$a;const{__scopePopper:r,side:n="bottom",sideOffset:a=0,align:o="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:f,...y}=t,m=du(pu,r),[_,w]=g.useState(null),A=Mg(e,gt=>w(gt)),[F,b]=g.useState(null),D=gf(F),B=(D==null?void 0:D.width)??0,j=(D==null?void 0:D.height)??0,G=n+(o!=="center"?"-"+o:""),te=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},de=Array.isArray(c)?c:[c],x=de.length>0,R={padding:te,boundary:de.filter(wk),altBoundary:x},{refs:k,floatingStyles:E,placement:H,isPositioned:N,middlewareData:C}=ep({strategy:"fixed",placement:G,whileElementsMounted:(...gt)=>tp(...gt,{animationFrame:p==="always"}),elements:{reference:m.anchor},middleware:[rp({mainAxis:a+j,alignmentAxis:i}),l&&np({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?sp():void 0,...R}),l&&ap({...R}),op({...R,apply:({elements:gt,rects:ri,availableWidth:$t,availableHeight:za})=>{const{width:Ua,height:fn}=ri.reference,Sr=gt.floating.style;Sr.setProperty("--radix-popper-available-width",`${$t}px`),Sr.setProperty("--radix-popper-available-height",`${za}px`),Sr.setProperty("--radix-popper-anchor-width",`${Ua}px`),Sr.setProperty("--radix-popper-anchor-height",`${fn}px`)}}),F&&ip({element:F,padding:s}),bk({arrowWidth:B,arrowHeight:j}),h&&Yh({strategy:"referenceHidden",...R})]}),[P,Z]=Lg(H),ne=Zn(f);hi(()=>{N&&(ne==null||ne())},[N,ne]);const le=(Dt=C.arrow)==null?void 0:Dt.x,ye=(Ft=C.arrow)==null?void 0:Ft.y,we=((Fe=C.arrow)==null?void 0:Fe.centerOffset)!==0,[De,Xe]=g.useState();return hi(()=>{_&&Xe(window.getComputedStyle(_).zIndex)},[_]),v.jsx("div",{ref:k.setFloating,"data-radix-popper-content-wrapper":"",style:{...E,transform:N?E.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:De,"--radix-popper-transform-origin":[(dt=C.transformOrigin)==null?void 0:dt.x,(Hn=C.transformOrigin)==null?void 0:Hn.y].join(" "),...(($a=C.hide)==null?void 0:$a.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:v.jsx(yk,{scope:r,placedSide:P,onArrowChange:b,arrowX:le,arrowY:ye,shouldHideArrow:we,children:v.jsx(Rg.div,{"data-side":P,"data-align":Z,...y,ref:A,style:{...y.style,animation:N?void 0:"none"}})})})});Pg.displayName=pu;var Cg="PopperArrow",vk={top:"bottom",right:"left",bottom:"top",left:"right"},jg=g.forwardRef(function(t,e){const{__scopePopper:r,...n}=t,a=_k(Cg,r),o=vk[a.placedSide];return v.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:v.jsx(ck,{...n,ref:e,style:{...n.style,display:"block"}})})});jg.displayName=Cg;function wk(t){return t!==null}var bk=t=>({name:"transformOrigin",options:t,fn(e){var y,m,_;const{placement:r,rects:n,middlewareData:a}=e,o=((y=a.arrow)==null?void 0:y.centerOffset)!==0,i=o?0:t.arrowWidth,s=o?0:t.arrowHeight,[l,c]=Lg(r),u={start:"0%",center:"50%",end:"100%"}[c],d=(((m=a.arrow)==null?void 0:m.x)??0)+i/2,h=(((_=a.arrow)==null?void 0:_.y)??0)+s/2;let p="",f="";return l==="bottom"?(p=o?u:`${d}px`,f=`${-s}px`):l==="top"?(p=o?u:`${d}px`,f=`${n.floating.height+s}px`):l==="right"?(p=`${-s}px`,f=o?u:`${h}px`):l==="left"&&(p=`${n.floating.width+s}px`,f=o?u:`${h}px`),{data:{x:p,y:f}}}});function Lg(t){const[e,r="center"]=t.split("-");return[e,r]}let xo,Ek,ko,fu,Dg,ds,$g,hs,mu;bi=hu,Il=Ig,Pl=Pg,Cl=jg,[xo,Ek]=pi("Tooltip",[io]),ko=io(),fu="TooltipProvider",Dg=700,ds="tooltip.open",[$g,hs]=xo(fu),mu=t=>{const{__scopeTooltip:e,delayDuration:r=Dg,skipDelayDuration:n=300,disableHoverableContent:a=!1,children:o}=t,[i,s]=g.useState(!0),l=g.useRef(!1),c=g.useRef(0);return g.useEffect(()=>{const u=c.current;return()=>window.clearTimeout(u)},[]),v.jsx($g,{scope:e,isOpenDelayed:i,delayDuration:r,onOpen:g.useCallback(()=>{window.clearTimeout(c.current),s(!1)},[]),onClose:g.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>s(!0),n)},[n]),isPointerInTransitRef:l,onPointerInTransitChange:g.useCallback(u=>{l.current=u},[]),disableHoverableContent:a,children:o})},mu.displayName=fu;var ps="Tooltip",[Sk,Ao]=xo(ps),zg=t=>{const{__scopeTooltip:e,children:r,open:n,defaultOpen:a=!1,onOpenChange:o,disableHoverableContent:i,delayDuration:s}=t,l=hs(ps,t.__scopeTooltip),c=ko(e),[u,d]=g.useState(null),h=Wt(),p=g.useRef(0),f=i??l.disableHoverableContent,y=s??l.delayDuration,m=g.useRef(!1),[_=!1,w]=Za({prop:n,defaultProp:a,onChange:B=>{B?(l.onOpen(),document.dispatchEvent(new CustomEvent(ds))):l.onClose(),o==null||o(B)}}),A=g.useMemo(()=>_?m.current?"delayed-open":"instant-open":"closed",[_]),F=g.useCallback(()=>{window.clearTimeout(p.current),p.current=0,m.current=!1,w(!0)},[w]),b=g.useCallback(()=>{window.clearTimeout(p.current),p.current=0,w(!1)},[w]),D=g.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{m.current=!0,w(!0),p.current=0},y)},[y,w]);return g.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),v.jsx(bi,{...c,children:v.jsx(Sk,{scope:e,contentId:h,open:_,stateAttribute:A,trigger:u,onTriggerChange:d,onTriggerEnter:g.useCallback(()=>{l.isOpenDelayed?D():F()},[l.isOpenDelayed,D,F]),onTriggerLeave:g.useCallback(()=>{f?b():(window.clearTimeout(p.current),p.current=0)},[b,f]),onOpen:F,onClose:b,disableHoverableContent:f,children:r})})};zg.displayName=ps;var gu="TooltipTrigger",Ug=g.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,a=Ao(gu,r),o=hs(gu,r),i=ko(r),s=g.useRef(null),l=Rt(e,s,a.onTriggerChange),c=g.useRef(!1),u=g.useRef(!1),d=g.useCallback(()=>c.current=!1,[]);return g.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),v.jsx(Il,{asChild:!0,...i,children:v.jsx(Qe.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...n,ref:l,onPointerMove:be(t.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!o.isPointerInTransitRef.current&&(a.onTriggerEnter(),u.current=!0)}),onPointerLeave:be(t.onPointerLeave,()=>{a.onTriggerLeave(),u.current=!1}),onPointerDown:be(t.onPointerDown,()=>{c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:be(t.onFocus,()=>{c.current||a.onOpen()}),onBlur:be(t.onBlur,a.onClose),onClick:be(t.onClick,a.onClose)})})});Ug.displayName=gu;var yu="TooltipPortal",[xk,kk]=xo(yu,{forceMount:void 0}),Bg=t=>{const{__scopeTooltip:e,forceMount:r,children:n,container:a}=t,o=Ao(yu,e);return v.jsx(xk,{scope:e,forceMount:r,children:v.jsx(Tr,{present:r||o.open,children:v.jsx(Vh,{asChild:!0,container:a,children:n})})})};Bg.displayName=yu;var ha="TooltipContent",Hg=g.forwardRef((t,e)=>{const r=kk(ha,t.__scopeTooltip),{forceMount:n=r.forceMount,side:a="top",...o}=t,i=Ao(ha,t.__scopeTooltip);return v.jsx(Tr,{present:n||i.open,children:i.disableHoverableContent?v.jsx(Wg,{side:a,...o,ref:e}):v.jsx(Ak,{side:a,...o,ref:e})})}),Ak=g.forwardRef((t,e)=>{const r=Ao(ha,t.__scopeTooltip),n=hs(ha,t.__scopeTooltip),a=g.useRef(null),o=Rt(e,a),[i,s]=g.useState(null),{trigger:l,onClose:c}=r,u=a.current,{onPointerInTransitChange:d}=n,h=g.useCallback(()=>{s(null),d(!1)},[d]),p=g.useCallback((f,y)=>{const m=f.currentTarget,_={x:f.clientX,y:f.clientY},w=Rk(_,m.getBoundingClientRect()),A=Ok(_,w),F=Nk(y.getBoundingClientRect()),b=Pk([...A,...F]);s(b),d(!0)},[d]);return g.useEffect(()=>()=>h(),[h]),g.useEffect(()=>{if(l&&u){const f=m=>p(m,u),y=m=>p(m,l);return l.addEventListener("pointerleave",f),u.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",f),u.removeEventListener("pointerleave",y)}}},[l,u,p,h]),g.useEffect(()=>{if(i){const f=y=>{const m=y.target,_={x:y.clientX,y:y.clientY},w=(l==null?void 0:l.contains(m))||(u==null?void 0:u.contains(m)),A=!Ik(_,i);w?h():A&&(h(),c())};return document.addEventListener("pointermove",f),()=>document.removeEventListener("pointermove",f)}},[l,u,i,c,h]),v.jsx(Wg,{...t,ref:o})}),[Tk,Mk]=xo(ps,{isInside:!1}),Wg=g.forwardRef((t,e)=>{const{__scopeTooltip:r,children:n,"aria-label":a,onEscapeKeyDown:o,onPointerDownOutside:i,...s}=t,l=Ao(ha,r),c=ko(r),{onClose:u}=l;return g.useEffect(()=>(document.addEventListener(ds,u),()=>document.removeEventListener(ds,u)),[u]),g.useEffect(()=>{if(l.trigger){const d=h=>{var p;(p=h.target)!=null&&p.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),v.jsx(qh,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:v.jsxs(Pl,{"data-state":l.stateAttribute,...c,...s,ref:e,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[v.jsx(JN,{children:n}),v.jsx(Tk,{scope:r,isInside:!0,children:v.jsx(KN,{id:l.contentId,role:"tooltip",children:a||n})})]})})});Hg.displayName=ha;var Gg="TooltipArrow",Fk=g.forwardRef((t,e)=>{const{__scopeTooltip:r,...n}=t,a=ko(r);return Mk(Gg,r).isInside?null:v.jsx(Cl,{...a,...n,ref:e})});Fk.displayName=Gg;function Rk(t,e){const r=Math.abs(e.top-t.y),n=Math.abs(e.bottom-t.y),a=Math.abs(e.right-t.x),o=Math.abs(e.left-t.x);switch(Math.min(r,n,a,o)){case o:return"left";case a:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Ok(t,e,r=5){const n=[];switch(e){case"top":n.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":n.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":n.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":n.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return n}function Nk(t){const{top:e,right:r,bottom:n,left:a}=t;return[{x:a,y:e},{x:r,y:e},{x:r,y:n},{x:a,y:n}]}function Ik(t,e){const{x:r,y:n}=t;let a=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const s=e[o].x,l=e[o].y,c=e[i].x,u=e[i].y;l>n!=u>n&&r<(c-s)*(n-l)/(u-l)+s&&(a=!a)}return a}function Pk(t){const e=t.slice();return e.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Ck(e)}function Ck(t){if(t.length<=1)return t.slice();const e=[];for(let n=0;n<t.length;n++){const a=t[n];for(;e.length>=2;){const o=e[e.length-1],i=e[e.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))e.pop();else break}e.push(a)}e.pop();const r=[];for(let n=t.length-1;n>=0;n--){const a=t[n];for(;r.length>=2;){const o=r[r.length-1],i=r[r.length-2];if((o.x-i.x)*(a.y-i.y)>=(o.y-i.y)*(a.x-i.x))r.pop();else break}r.push(a)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}cf=mu,uf=zg,df=Ug,N0=Bg,oc=Hg,lc=cf,ea=uf,ta=df,xn=g.forwardRef(({className:t,sideOffset:e=4,...r},n)=>v.jsx(oc,{ref:n,sideOffset:e,className:me("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})),xn.displayName=oc.displayName;const jk="sidebar:state",Lk=60*60*24*7,Dk="16rem",$k="18rem",zk="3rem",Uk="b",qg=g.createContext(null);function To(){const t=g.useContext(qg);if(!t)throw new Error("useSidebar must be used within a SidebarProvider.");return t}xl=g.forwardRef(({defaultOpen:t=!0,open:e,onOpenChange:r,className:n,style:a,children:o,...i},s)=>{const l=zS(),[c,u]=g.useState(!1),[d,h]=g.useState(t),p=e??d,f=g.useCallback(w=>{const A=typeof w=="function"?w(p):w;r?r(A):h(A),document.cookie=`${jk}=${A}; path=/; max-age=${Lk}`},[r,p]),y=g.useCallback(()=>l?u(w=>!w):f(w=>!w),[l,f,u]);g.useEffect(()=>{const w=A=>{A.key===Uk&&(A.metaKey||A.ctrlKey)&&(A.preventDefault(),y())};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[y]);const m=p?"expanded":"collapsed",_=g.useMemo(()=>({state:m,open:p,setOpen:f,isMobile:l,openMobile:c,setOpenMobile:u,toggleSidebar:y}),[m,p,f,l,c,u,y]);return v.jsx(qg.Provider,{value:_,children:v.jsx(lc,{delayDuration:0,children:v.jsx("div",{style:{"--sidebar-width":Dk,"--sidebar-width-icon":zk,...a},className:me("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:s,...i,children:o})})})}),xl.displayName="SidebarProvider",fc=g.forwardRef(({side:t="left",variant:e="sidebar",collapsible:r="offcanvas",className:n,children:a,...o},i)=>{const{isMobile:s,state:l,openMobile:c,setOpenMobile:u}=To();return r==="none"?v.jsx("div",{className:me("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:i,...o,children:a}):s?v.jsx(Sx,{open:c,onOpenChange:u,...o,children:v.jsx(ag,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":$k},side:t,children:v.jsx("div",{className:"flex h-full w-full flex-col",children:a})})}):v.jsxs("div",{ref:i,className:"group peer hidden md:block text-sidebar-foreground","data-state":l,"data-collapsible":l==="collapsed"?r:"","data-variant":e,"data-side":t,children:[v.jsx("div",{className:me("duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",e==="floating"||e==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),v.jsx("div",{className:me("duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",t==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",e==="floating"||e==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...o,children:v.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:a})})]})}),fc.displayName="Sidebar";const Vg=g.forwardRef(({className:t,onClick:e,...r},n)=>{const{toggleSidebar:a}=To();return v.jsx(Hr,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:me("h-7 w-7",t),onClick:o=>{e==null||e(o),a()},...r,children:v.jsx(Ke,{size:32,name:"panel-left"})})});Vg.displayName="SidebarTrigger";const Zg=g.forwardRef(({className:t,...e},r)=>{const{toggleSidebar:n}=To();return v.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:me("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",t),...e})});Zg.displayName="SidebarRail",kl=g.forwardRef(({className:t,...e},r)=>v.jsx("main",{ref:r,className:me("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",t),...e})),kl.displayName="SidebarInset";const Bk=g.forwardRef(({className:t,...e},r)=>v.jsx(Si,{ref:r,"data-sidebar":"input",className:me("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",t),...e}));Bk.displayName="SidebarInput";const Hk=g.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"header",className:me("flex flex-col gap-2 p-2",t),...e}));Hk.displayName="SidebarHeader";const Jg=g.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"footer",className:me("flex flex-col gap-2 p-2",t),...e}));Jg.displayName="SidebarFooter";const Wk=g.forwardRef(({className:t,...e},r)=>v.jsx(_i,{ref:r,"data-sidebar":"separator",className:me("mx-2 w-auto bg-sidebar-border",t),...e}));Wk.displayName="SidebarSeparator",gc=g.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"content",className:me("flex min-h-0 flex-1 flex-col gap-0 overflow-auto group-data-[collapsible=icon]:overflow-hidden",t),...e})),gc.displayName="SidebarContent",Mi=g.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"group",className:me("relative flex w-full min-w-0 flex-col p-2",t),...e})),Mi.displayName="SidebarGroup",mc=g.forwardRef(({className:t,asChild:e=!1,...r},n)=>{const a=e?_n:"div";return v.jsx(a,{ref:n,"data-sidebar":"group-label",className:me("duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",t),...r})}),mc.displayName="SidebarGroupLabel";const Gk=g.forwardRef(({className:t,asChild:e=!1,...r},n)=>{const a=e?_n:"button";return v.jsx(a,{ref:n,"data-sidebar":"group-action",className:me("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",t),...r})});Gk.displayName="SidebarGroupAction";const qk=g.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"group-content",className:me("w-full text-sm",t),...e}));qk.displayName="SidebarGroupContent",ho=g.forwardRef(({className:t,...e},r)=>v.jsx("ul",{ref:r,"data-sidebar":"menu",className:me("flex w-full min-w-0 flex-col gap-1",t),...e})),ho.displayName="SidebarMenu",Kn=g.forwardRef(({className:t,...e},r)=>v.jsx("li",{ref:r,"data-sidebar":"menu-item",className:me("group/menu-item relative",t),...e})),Kn.displayName="SidebarMenuItem";let Kg;Kg=bl("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),eo=g.forwardRef(({onClick:t,asChild:e=!1,isActive:r=!1,variant:n="default",size:a="default",tooltip:o,className:i,autoHide:s,...l},c)=>{const u=e?_n:"button",{isMobile:d,state:h,toggleSidebar:p}=To(),f=v.jsx(u,{ref:c,"data-sidebar":"menu-button","data-size":a,"data-active":r,className:me(Kg({variant:n,size:a}),i),onClick:s?y=>{t==null||t(y),p()}:t,...l});return o?(typeof o=="string"&&(o={children:o}),v.jsxs(ea,{children:[v.jsx(ta,{asChild:!0,children:f}),v.jsx(xn,{side:"right",align:"center",hidden:h!=="collapsed"||d,...o})]})):f}),eo.displayName="SidebarMenuButton";const Vk=g.forwardRef(({className:t,asChild:e=!1,showOnHover:r=!1,...n},a)=>{const o=e?_n:"button";return v.jsx(o,{ref:a,"data-sidebar":"menu-action",className:me("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",t),...n})});Vk.displayName="SidebarMenuAction";const Zk=g.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:me("absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t),...e}));Zk.displayName="SidebarMenuBadge";const Jk=g.forwardRef(({className:t,showIcon:e=!1,...r},n)=>{const a=g.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return v.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:me("rounded-md h-8 flex gap-2 px-2 items-center",t),...r,children:[e&&v.jsx(og,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),v.jsx(og,{className:"h-4 flex-1 max-w-[--skeleton-width]","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":a}})]})});Jk.displayName="SidebarMenuSkeleton";const Yg=g.forwardRef(({className:t,...e},r)=>v.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:me("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",t),...e}));Yg.displayName="SidebarMenuSub";const Xg=g.forwardRef(({...t},e)=>v.jsx("li",{ref:e,...t}));Xg.displayName="SidebarMenuSubItem";const Qg=g.forwardRef(({asChild:t=!1,size:e="md",isActive:r,className:n,...a},o)=>{const i=t?_n:"a";return v.jsx(i,{ref:o,"data-sidebar":"menu-sub-button","data-size":e,"data-active":r,className:me("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",e==="sm"&&"text-xs",e==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...a})});Qg.displayName="SidebarMenuSubButton";let ey,In,ty;ey="hash",In={application:"/application/:applicationId?",whiteboard:"/whiteboard/:sessionId?",document:"/document/:documentId?",sessions:"/sessions"},it=(t,e)=>{let r=In[t];return e?r=Object.keys(e||{}).reduce((n,a)=>n.replace(`:${a}`,(e==null?void 0:e[a])||""),r):r=r.replace(/\/:[^/]+/g,""),r!=null&&r.endsWith("?")?r.slice(0,-1):r},ty=()=>{{const[,t]=window.location.hash.split("?");return new URLSearchParams(`?${t}`)}};function Kk({items:t}){const{t:e}=fi("documents");return v.jsxs(Mi,{children:[v.jsx(mc,{children:v.jsx("div",{className:"text-sm",children:e("title")})}),v.jsx(ho,{children:t.map(r=>{var n;return v.jsx(LS,{asChild:!0,defaultOpen:r.isActive,className:"group/collapsible",children:v.jsxs(Kn,{children:[v.jsx(DS,{asChild:!0,children:v.jsxs(eo,{className:"cursor-pointer",tooltip:e(r.title),children:[r.icon,v.jsx("span",{children:e(r.title)}),v.jsx(Ke,{name:"chevron-right",className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),v.jsx($S,{children:v.jsx(Yg,{children:(n=r.items)==null?void 0:n.map(a=>v.jsx(Xg,{className:"cursor-pointer",children:v.jsx(Qg,{asChild:!0,children:v.jsx(Ic,{to:it("document",{documentId:a.id}),children:v.jsx("span",{children:e(a.title)})})})},e(a.title)))})})]})},r.title)})})]})}const Yk=g.memo(({text:t,colors:e={first:"#9E7AFF",second:"#FE8BBB"},className:r,sparklesCount:n,...a})=>{n=n??10;const[o,i]=g.useState([]);return g.useEffect(()=>{const s=()=>{const d=`${Math.random()*100}%`,h=`${Math.random()*100}%`,p=Math.random()>.5?e.first:e.second,f=Math.random()*2,y=Math.random()*1+.3,m=Math.random()*10+5;return{id:`${d}-${h}-${Date.now()}`,x:d,y:h,color:p,delay:f,scale:y,lifespan:m}},l=()=>{const d=n?Array.from({length:n},s):[];i(d)},c=()=>{i(d=>d.map(h=>h.lifespan<=0?s():{...h,lifespan:h.lifespan-.1}))};l();const u=setInterval(c,100);return()=>clearInterval(u)},[e.first,e.second]),v.jsx("div",{className:me("text-6xl",r),...a,style:{"--sparkles-first-color":`${e.first}`,"--sparkles-second-color":`${e.second}`},children:v.jsxs("span",{className:"relative inline-block",children:[o.map(s=>v.jsx(Xk,{...s},s.id)),v.jsx("strong",{children:t})]})})},(t,e)=>t.text===e.text),Xk=({id:t,x:e,y:r,color:n,delay:a,scale:o})=>v.jsx(YN.svg,{className:"pointer-events-none absolute z-20",initial:{opacity:0,left:e,top:r},animate:{opacity:[0,1,0],scale:[0,o,0],rotate:[75,120,150]},transition:{duration:.8,repeat:1/0,delay:a},width:"21",height:"21",viewBox:"0 0 21 21",children:v.jsx("path",{d:"M9.82531 0.843845C10.0553 0.215178 10.9446 0.215178 11.1746 0.843845L11.8618 2.72026C12.4006 4.19229 12.3916 6.39157 13.5 7.5C14.6084 8.60843 16.8077 8.59935 18.2797 9.13822L20.1561 9.82534C20.7858 10.0553 20.7858 10.9447 20.1561 11.1747L18.2797 11.8618C16.8077 12.4007 14.6084 12.3916 13.5 13.5C12.3916 14.6084 12.4006 16.8077 11.8618 18.2798L11.1746 20.1562C10.9446 20.7858 10.0553 20.7858 9.82531 20.1562L9.13819 18.2798C8.59932 16.8077 8.60843 14.6084 7.5 13.5C6.39157 12.3916 4.19225 12.4007 2.72023 11.8618L0.843814 11.1747C0.215148 10.9447 0.215148 10.0553 0.843814 9.82534L2.72023 9.13822C4.19225 8.59935 6.39157 8.60843 7.5 7.5C8.60843 6.39157 8.59932 4.19229 9.13819 2.72026L9.82531 0.843845Z",fill:n})},t);function ry({icon:t,sparkles:e,bold:r,text:n,className:a,onClick:o}){return v.jsxs(eo,{className:me(a,"tw-w-full"),onClick:o,children:[v.jsx(Ke,{name:t}),v.jsx(Yk,{text:n,sparklesCount:e?3:0,className:me("text-sm",r?"font-bold":"font-normal")})]})}He=(t=>(t.Toolbox="TOOLBOX",t.LLM="LLM",t.NewMessage="NEW_MESSAGE",t.Thread="THREAD",t.Message="MESSAGE",t.Prompt="PROMPT",t.SessionInfo="SESSION_INFO",t.Schema="SCHEMA",t.ToolDefinition="TOOL_DEFINITION",t.ToolHandler="TOOL_HANDLER",t.FewShotExample="FEW_SHOT_EXAMPLE",t.CSVData="CSV_DATA",t.DefaultEmbeddingModel="DEFAULT_EMBEDDING_MODEL",t.VectorDatabase="VECTOR_DATABASE",t.JSONLData="JSONL_DATA",t.ApplicationBar="APPLICATION_BAR",t.Shape="SHAPE",t.CircleShape="CIRCLE_SHAPE",t.TriangleShape="TRIANGLE_SHAPE",t.EditorApp="EDITOR_APP",t.PlaceHolder="PLACEHOLDER",t.VSLiteApp="VSLITE_APP",t.JSONData="JSON_DATA",t))(He||{}),oo=(t=>(t.Started="started",t.Done="done",t.Achieved="Achieved",t.Deleted="deleted",t))(oo||{}),Et=(t=>(t.Whiteboard="Whiteboard",t.StandaloneApp="StandaloneApp",t))(Et||{}),hp=(t=>(t.Local="local",t.Remote="remote",t))(hp||{}),ur=(t=>(t.Voy="voy",t.Memory="memory",t))(ur||{}),Wr=(t=>(t.DataNode="DataNode",t.DatabaseNode="DatabaseNode",t.IndexedDB="IndexedDB",t))(Wr||{});let _u,ny;_u={Thread:"threads",Message:"messages",LLM:"llms",FlowNode:"flow_nodes",FlowEdge:"flow_edges",Prompt:"prompts",PromptVariable:"prompt_variables",Session:"sessions",Schema:"schemas",SchemaItem:"schema_items",JSONData:"json_data",CSVData:"csv_data",ToolDefinition:"tool_definitions",VectorDatabase:"vector_databases",JSONLData:"jsonl_data",FlowNodeData:"flow_node_data",FlowNodePlaceholder:"flow_node_placeholders"},i0={[He.Toolbox]:void 0,[He.SessionInfo]:void 0,[He.DefaultEmbeddingModel]:void 0,[He.ApplicationBar]:void 0,[He.Shape]:void 0,[He.CircleShape]:void 0,[He.TriangleShape]:void 0,[He.EditorApp]:void 0,[He.VSLiteApp]:void 0,[He.NewMessage]:void 0,[He.ToolHandler]:void 0,[He.FewShotExample]:void 0,[He.JSONData]:"JSONData",[He.LLM]:"LLM",[He.Thread]:"Thread",[He.Message]:"Message",[He.Prompt]:"Prompt",[He.Schema]:"Schema",[He.CSVData]:"CSVData",[He.ToolDefinition]:"ToolDefinition",[He.VectorDatabase]:"VectorDatabase",[He.JSONLData]:"JSONLData",[He.PlaceHolder]:"FlowNodePlaceholder"},ny="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ay,oy,iy;ay=t=>crypto.getRandomValues(new Uint8Array(t)),oy=(t,e,r)=>{let n=(2<<Math.log(t.length-1)/Math.LN2)-1,a=-~(1.6*n*e/t.length);return(o=e)=>{let i="";for(;;){let s=r(a),l=a;for(;l--;)if(i+=t[s[l]&n]||"",i.length===o)return i}}},iy=(t,e=21)=>oy(t,e,ay),Bt=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=ny[r[t]&63];return e};const sy="_WORKER_INIT_";async function _r(t,e,r,n,a={}){return t.postMessage({...a,type:e,messageId:r,payload:n})}const ly=(t,e,r)=>{var s,l,c,u,d;const n=t.data.messageId;if(!n)return;const{resolve:a,reject:o,processInfo:i}=(e==null?void 0:e.get(n))||{};n===sy?(s=r==null?void 0:r.onWorkerInit)==null||s.call(r,t):["complete","error"].includes(t.data.type)?(t.data.type==="complete"&&typeof a=="function"?(a==null||a(t.data.payload),(l=r==null?void 0:r.onComplete)==null||l.call(r,t)):typeof o=="function"&&(o==null||o(new Error(JSON.stringify(t.data.payload))),(c=r==null?void 0:r.onError)==null||c.call(r,t)),e.delete(n),(u=r==null?void 0:r.onFinish)==null||u.call(r,t)):t.data.type==="inprogress"?(i&&typeof i=="object"&&"data"in i&&Array.isArray(i==null?void 0:i.data)&&i.data.push(t.data.payload),(d=r==null?void 0:r.onProgress)==null||d.call(r,t)):t.data.type==="started"||vn("[Unknown message type]",t.data)},Pr=t=>{let e={};const r=new Promise((n,a)=>{if(e={resolve:n,reject:a},t)return t(n,a)});return e.promise=r,e},Qk=t=>!!t&&typeof t=="object"&&"type"in t&&"@instanceof"in t,Mo=t=>{if(t==null||typeof t=="string"||typeof t=="number")return t;if(typeof t=="object"){if(Array.isArray(t))return t.map(r=>Mo(r));const e={};return Object.keys(t).forEach(r=>{const n=t[r];Qk(n)?e[r]={"@instanceof":"FindOperator",type:n.type,value:n.value,useParameter:n.useParameter,multipleParameters:n.multipleParameters,getSql:typeof n.getSql=="function"?n.getSql.toString():void 0,objectLiteralParameters:n.objectLiteralParameters}:n&&typeof n=="object"&&n!==null?e[r]=Mo(n):e[r]=n}),e}return t};var vu=(t=>(t.INIT="init",t.REPOSITORY_EXECUTE="repository-execute",t.RAW_QUERY_EXECUTE="raw-query-execute",t))(vu||{});let pa,fs,wu,cy,uy,Pn;pa=new Worker(new URL("/NoLLMChat/assets/database.worker-DT5w_ahm.js",import.meta.url),{type:"module"}),fs=new Map,wu=t=>ly(t,fs,{onWorkerInit:()=>{}}),cy=async()=>{pa&&pa.removeEventListener("message",wu),pa.addEventListener("message",wu)},uy=()=>{const t=Bt(),e=Pr();return fs.set(t,{promise:e.promise,resolve:e.resolve,reject:e.reject}),{promise:e.promise,messageId:t}},Pn=async(t,e,r)=>{let n="";try{if(!pa)throw new Error("Worker not initialized");const a=uy();return n=a.messageId,_r(pa,vu.REPOSITORY_EXECUTE,n,[t,e,r]),a.promise}catch(a){throw vn(`Error executing ${vu.REPOSITORY_EXECUTE} action`,a),n&&fs.delete(n),a}},We=t=>({find:e=>Pn(t,"find",Mo(e)),findOne:e=>Pn(t,"findOne",Mo(e)),count:e=>Pn(t,"count",Mo(e)),delete:e=>Pn(t,"delete",e),save:e=>Pn(t,"save",e),update:(e,r)=>Pn(t,"update",{id:e,update:r})}),cy();class e1{constructor(){ae(this,"sessionKeyProcess");ae(this,"sessionKey");ae(this,"loadded",!1);ae(this,"sessionMemory",new Map);this.init()}async init(){if(this.loadded)return;this.sessionMemory=new Map;const e={name:"AES-GCM",length:256},r=["encrypt","decrypt"];this.sessionKeyProcess=window.crypto.subtle.generateKey(e,!0,r).then(n=>n),this.sessionKey=await this.sessionKeyProcess,this.loadded=!0,this.sessionKeyProcess=void 0}async reload(){this.loadded=!1,this.init()}async set(e,r){this.sessionKeyProcess&&await this.sessionKeyProcess;const n=await crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(12)},this.sessionKey,new TextEncoder().encode(r));this.sessionMemory.set(e,n)}async get(e){const r=this.sessionMemory.get(e);if(!r)return null;this.sessionKeyProcess&&await this.sessionKeyProcess;const n=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(12)},this.sessionKey,r);return new TextDecoder().decode(n)}async exists(e){return this.sessionMemory.has(e)}}let dy,hy,py,fy,bu;Cp=new e1,dy=(t,e)=>({setToDefaultSession:async r=>{const n=e().sessions;if(!(n!=null&&n.length)){const a=await We("Session").find({where:{status:oo.Started,type:r||Et.Whiteboard},order:{updated_at:"DESC"},take:1});return e().setCurrentSession(a==null?void 0:a[0])}return e().setCurrentSession(n==null?void 0:n[0])},setCurrentSession:async r=>{const n=e().currentSession;if(!r||typeof r=="string"&&(n==null?void 0:n.id)===r||typeof r=="object"&&(n==null?void 0:n.id)===r.id&&n.passphrase===r.passphrase&&n.metadata===r.metadata)return n;if(await Cp.reload(),t({currentSession:void 0}),typeof r=="string"||!r)if(r=r||El.getState().selectedSessionId,r===(n==null?void 0:n.id)&&n)r=n;else{let i=await We("Session").findOne({where:{id:r}});i||(i=await We("Session").findOne({order:{updated_at:"DESC"}})),r=i}El.setState({selectedSessionId:r.id});const a=await We("FlowNode").findOne({where:{id:r.main_node_id}});r.main_node=a;let o=!1;if(r.type===Et.StandaloneApp){const i=e().applications.map(s=>s.id===r.id?(o=!0,r):s);t({currentSession:r,applications:o?i:[r,...e().applications]})}else{const i=e().sessions.map(s=>s.id===r.id?(o=!0,r):s);t({currentSession:r,sessions:o?i:[r,...e().sessions]})}return r},createSession:async r=>{const n=await We("Session").save({...r,name:`${r.name}`,status:oo.Started,type:Et.Whiteboard});if(!n)throw new Error("Failed create.");return t({sessions:[n,...e().sessions]}),n},deleteSession:async r=>{const n=await We("Session").findOne({where:{id:r}});if(!n)throw new Error("Failed delete.");if(!await We("Session").delete(r))throw new Error("Failed delete.");const a=e().sessions,o=e().applications;if((n==null?void 0:n.type)===Et.Whiteboard){const i=a.filter(s=>s.id!==r);t({sessions:i,...(n==null?void 0:n.id)===r?{currentSession:(i==null?void 0:i[0])||(o==null?void 0:o[0])}:{}})}else{const i=o.filter(s=>s.id!==r);t({applications:i,...(n==null?void 0:n.id)===r?{currentSession:(i==null?void 0:i[0])||(a==null?void 0:a[0])}:{}})}},getSessions:async r=>{try{const n=await We("Session").find({where:(r==null?void 0:r.where)||{status:oo.Started},order:{updated_at:"DESC"},take:20,relations:["main_node"],skip:r!=null&&r.page?(r.page-1)*20:0});n!=null&&n.length&&t({sessions:n})}catch{t({error:"No session"})}}}),hy={currentSession:void 0,ready:!0,error:void 0,sessions:[],applications:[]},Gr=Zh()(Jh((t,e)=>({...hy,...dy(t,e)}))),py=()=>{const[t,e]=g.useState(!1),r=Gr(a=>a.createSession),n=g.useCallback(async a=>{try{return e(!0),await r(a)}finally{e(!1)}},[r]);return{loading:t,createSession:n}},_f=Tl,fy=Al,bu=g.forwardRef(({className:t,...e},r)=>v.jsx(ro,{ref:r,className:me("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e})),bu.displayName=ro.displayName,dc=g.forwardRef(({className:t,children:e,...r},n)=>v.jsxs(fy,{children:[v.jsx(bu,{}),v.jsxs(Xa,{ref:n,className:me("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[e,v.jsxs(sc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[v.jsx(Ke,{name:"x",className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]})),dc.displayName=Xa.displayName,hc=({className:t,...e})=>v.jsx("div",{className:me("flex flex-col space-y-1.5 text-center sm:text-left",t),...e}),hc.displayName="DialogHeader",Dl=({className:t,...e})=>v.jsx("div",{className:me("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e}),Dl.displayName="DialogFooter",pc=g.forwardRef(({className:t,...e},r)=>v.jsx(ao,{ref:r,className:me("text-lg font-semibold leading-none tracking-tight",t),...e})),pc.displayName=ao.displayName,Ll=g.forwardRef(({className:t,...e},r)=>v.jsx(Qa,{ref:r,className:me("text-sm text-muted-foreground",t),...e})),Ll.displayName=Qa.displayName;var t1="Label",my=g.forwardRef((t,e)=>v.jsx(Qe.label,{...t,ref:e,onMouseDown:r=>{var n;r.target.closest("button, input, select, textarea")||((n=t.onMouseDown)==null||n.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));my.displayName=t1;var gy=my;let yy;yy=bl("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ei=g.forwardRef(({className:t,...e},r)=>v.jsx(gy,{ref:r,className:me(yy(),t),...e})),Ei.displayName=gy.displayName,zp=XN(()=>{const t=Yb(),{t:e}=fi("dialogs"),[r,n]=g.useState(""),{toast:a}=QN(),{loading:o,createSession:i}=py(),s=u=>{n(u.target.value)},l=async()=>{try{const u=await i({name:r});n(""),t.resolve(u.id),t.hide()}catch(u){a({variant:"destructive",description:e("create_session.errors.create_failed")}),t.reject(u)}},c=()=>{n(""),t.resolve(void 0),t.hide()};return v.jsx(_f,{open:t.visible,onOpenChange:c,children:v.jsxs(dc,{className:"sm:max-w-[425px]",children:[v.jsxs(hc,{children:[v.jsx(pc,{children:e("create_session.title")}),v.jsx(Ll,{children:e("create_session.description")})]}),v.jsx("div",{className:"grid gap-4 py-4",children:v.jsxs("div",{className:"flex flex-col space-y-1.5",children:[v.jsx(Ei,{className:"mb-2",htmlFor:"name",children:e("create_session.name")}),v.jsx(Si,{onChange:s,id:"name",value:r,placeholder:e("create_session.name_placeholder")})]})}),v.jsx(Dl,{children:v.jsx(Hr,{onClick:l,disabled:o||!r,type:"submit",children:e("create_session.create")})})]})})});function r1({currentSession:t}){const{t:e}=fi("sidebar"),r=Yn(),[n,a]=g.useState(),o=Yb(zp),i=g.useCallback(async()=>{try{const l=await o.show({});l&&typeof l=="string"&&r(it("whiteboard",{sessionId:l}))}catch{}},[o,r]),s=g.useCallback(()=>{r(it("sessions"))},[r]);return g.useEffect(()=>{!n||n!==(t==null?void 0:t.id)||a(void 0)},[n,t==null?void 0:t.id]),v.jsx(Mi,{className:"group-data-[collapsible=icon]:hidden pb-0",children:v.jsxs(ho,{children:[v.jsx(Kn,{children:v.jsx(ry,{icon:"layout-grid",onClick:s,className:"w-full",text:e("sessions")})}),v.jsx(Kn,{children:v.jsx(ry,{icon:"frame",onClick:i,className:"w-full",text:e("new_session"),bold:!0,sparkles:!0})})]})})}var n1=g.createContext(void 0);uc=function(t){const e=g.useContext(n1);return t||e||"ltr"};function a1(t,e=[]){let r=[];function n(o,i){const s=g.createContext(i),l=r.length;r=[...r,i];function c(d){const{scope:h,children:p,...f}=d,y=(h==null?void 0:h[t][l])||s,m=g.useMemo(()=>f,Object.values(f));return v.jsx(y.Provider,{value:m,children:p})}function u(d,h){const p=(h==null?void 0:h[t][l])||s,f=g.useContext(p);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,u]}const a=()=>{const o=r.map(i=>g.createContext(i));return function(i){const s=(i==null?void 0:i[t])||o;return g.useMemo(()=>({[`__scope${t}`]:{...i,[t]:s}}),[i,s])}};return a.scopeName=t,[n,o1(a,...e)]}function o1(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const n=t.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){const o=n.reduce((i,{useScope:s,scopeName:l})=>{const c=s(a)[`__scope${l}`];return{...i,...c}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return r.scopeName=e.scopeName,r}let ms,_y,Fo,gs,Eu,vy,wy,by,Ey,Su;ms="rovingFocusGroup.onEntryFocus",_y={bubbles:!1,cancelable:!0},Fo="RovingFocusGroup",[gs,Eu,vy]=Xb(Fo),[wy,cc]=a1(Fo,[vy]),[by,Ey]=wy(Fo),Su=g.forwardRef((t,e)=>v.jsx(gs.Provider,{scope:t.__scopeRovingFocusGroup,children:v.jsx(gs.Slot,{scope:t.__scopeRovingFocusGroup,children:v.jsx(i1,{...t,ref:e})})})),Su.displayName=Fo;var i1=g.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:a=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=t,h=g.useRef(null),p=Rt(e,h),f=uc(o),[y=null,m]=Za({prop:i,defaultProp:s,onChange:l}),[_,w]=g.useState(!1),A=Zn(c),F=Eu(r),b=g.useRef(!1),[D,B]=g.useState(0);return g.useEffect(()=>{const j=h.current;if(j)return j.addEventListener(ms,A),()=>j.removeEventListener(ms,A)},[A]),v.jsx(by,{scope:r,orientation:n,dir:f,loop:a,currentTabStopId:y,onItemFocus:g.useCallback(j=>m(j),[m]),onItemShiftTab:g.useCallback(()=>w(!0),[]),onFocusableItemAdd:g.useCallback(()=>B(j=>j+1),[]),onFocusableItemRemove:g.useCallback(()=>B(j=>j-1),[]),children:v.jsx(Qe.div,{tabIndex:_||D===0?-1:0,"data-orientation":n,...d,ref:p,style:{outline:"none",...t.style},onMouseDown:be(t.onMouseDown,()=>{b.current=!0}),onFocus:be(t.onFocus,j=>{const G=!b.current;if(j.target===j.currentTarget&&G&&!_){const te=new CustomEvent(ms,_y);if(j.currentTarget.dispatchEvent(te),!te.defaultPrevented){const de=F().filter(E=>E.focusable),x=de.find(E=>E.active),R=de.find(E=>E.id===y),k=[x,R,...de].filter(Boolean).map(E=>E.ref.current);ky(k,u)}}b.current=!1}),onBlur:be(t.onBlur,()=>w(!1))})})}),Sy="RovingFocusGroupItem",xy=g.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:a=!1,tabStopId:o,...i}=t,s=Wt(),l=o||s,c=Ey(Sy,r),u=c.currentTabStopId===l,d=Eu(r),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return g.useEffect(()=>{if(n)return h(),()=>p()},[n,h,p]),v.jsx(gs.ItemSlot,{scope:r,id:l,focusable:n,active:a,children:v.jsx(Qe.span,{tabIndex:u?0:-1,"data-orientation":c.orientation,...i,ref:e,onMouseDown:be(t.onMouseDown,f=>{n?c.onItemFocus(l):f.preventDefault()}),onFocus:be(t.onFocus,()=>c.onItemFocus(l)),onKeyDown:be(t.onKeyDown,f=>{if(f.key==="Tab"&&f.shiftKey){c.onItemShiftTab();return}if(f.target!==f.currentTarget)return;const y=c1(f,c.orientation,c.dir);if(y!==void 0){if(f.metaKey||f.ctrlKey||f.altKey||f.shiftKey)return;f.preventDefault();let m=d().filter(_=>_.focusable).map(_=>_.ref.current);if(y==="last")m.reverse();else if(y==="prev"||y==="next"){y==="prev"&&m.reverse();const _=m.indexOf(f.currentTarget);m=c.loop?u1(m,_+1):m.slice(_+1)}setTimeout(()=>ky(m))}})})})});xy.displayName=Sy;var s1={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function l1(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function c1(t,e,r){const n=l1(t.key,r);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return s1[n]}function ky(t,e=!1){const r=document.activeElement;for(const n of t)if(n===r||(n.focus({preventScroll:e}),document.activeElement!==r))return}function u1(t,e){return t.map((r,n)=>t[(e+n)%t.length])}let ys,Ay,xu,Ty,My,Fy,fa,ma,Ry,Oy,Xr,ga,ku,Au,Cr,Ny,ya,Tu;yf=Su,Xh=xy,ys=["Enter"," "],Ay=["ArrowDown","PageUp","Home"],xu=["ArrowUp","PageDown","End"],Ty=[...Ay,...xu],My={ltr:[...ys,"ArrowRight"],rtl:[...ys,"ArrowLeft"]},Fy={ltr:["ArrowLeft"],rtl:["ArrowRight"]},fa="Menu",[ma,Ry,Oy]=Xb(fa),[Xr,jl]=pi(fa,[Oy,io,cc]),ga=io(),ku=cc(),[Au,Cr]=Xr(fa),[Ny,ya]=Xr(fa),Tu=t=>{const{__scopeMenu:e,open:r=!1,children:n,dir:a,onOpenChange:o,modal:i=!0}=t,s=ga(e),[l,c]=g.useState(null),u=g.useRef(!1),d=Zn(o),h=uc(a);return g.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",f,{capture:!0,once:!0}),document.addEventListener("pointermove",f,{capture:!0,once:!0})},f=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",f,{capture:!0}),document.removeEventListener("pointermove",f,{capture:!0})}},[]),v.jsx(bi,{...s,children:v.jsx(Au,{scope:e,open:r,onOpenChange:d,content:l,onContentChange:c,children:v.jsx(Ny,{scope:e,onClose:g.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:i,children:n})})})},Tu.displayName=fa;var d1="MenuAnchor",Mu=g.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,a=ga(r);return v.jsx(Il,{...a,...n,ref:e})});Mu.displayName=d1;var Fu="MenuPortal",[h1,Iy]=Xr(Fu,{forceMount:void 0}),Py=t=>{const{__scopeMenu:e,forceMount:r,children:n,container:a}=t,o=Cr(Fu,e);return v.jsx(h1,{scope:e,forceMount:r,children:v.jsx(Tr,{present:r||o.open,children:v.jsx(Vh,{asChild:!0,container:a,children:n})})})};Py.displayName=Fu;var Ct="MenuContent",[p1,Ru]=Xr(Ct),Cy=g.forwardRef((t,e)=>{const r=Iy(Ct,t.__scopeMenu),{forceMount:n=r.forceMount,...a}=t,o=Cr(Ct,t.__scopeMenu),i=ya(Ct,t.__scopeMenu);return v.jsx(ma.Provider,{scope:t.__scopeMenu,children:v.jsx(Tr,{present:n||o.open,children:v.jsx(ma.Slot,{scope:t.__scopeMenu,children:i.modal?v.jsx(f1,{...a,ref:e}):v.jsx(m1,{...a,ref:e})})})})}),f1=g.forwardRef((t,e)=>{const r=Cr(Ct,t.__scopeMenu),n=g.useRef(null),a=Rt(e,n);return g.useEffect(()=>{const o=n.current;if(o)return Rl(o)},[]),v.jsx(Ou,{...t,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:be(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),m1=g.forwardRef((t,e)=>{const r=Cr(Ct,t.__scopeMenu);return v.jsx(Ou,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Ou=g.forwardRef((t,e)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:s,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...y}=t,m=Cr(Ct,r),_=ya(Ct,r),w=ga(r),A=ku(r),F=Ry(r),[b,D]=g.useState(null),B=g.useRef(null),j=Rt(e,B,m.onContentChange),G=g.useRef(0),te=g.useRef(""),de=g.useRef(0),x=g.useRef(null),R=g.useRef("right"),k=g.useRef(0),E=f?vi:g.Fragment,H=f?{as:_n,allowPinchZoom:!0}:void 0,N=P=>{var Dt,Ft;const Z=te.current+P,ne=F().filter(Fe=>!Fe.disabled),le=document.activeElement,ye=(Dt=ne.find(Fe=>Fe.ref.current===le))==null?void 0:Dt.textValue,we=ne.map(Fe=>Fe.textValue),De=T1(we,Z,ye),Xe=(Ft=ne.find(Fe=>Fe.textValue===De))==null?void 0:Ft.ref.current;(function Fe(dt){te.current=dt,window.clearTimeout(G.current),dt!==""&&(G.current=window.setTimeout(()=>Fe(""),1e3))})(Z),Xe&&setTimeout(()=>Xe.focus())};g.useEffect(()=>()=>window.clearTimeout(G.current),[]),Ol();const C=g.useCallback(P=>{var Z,ne;return R.current===((Z=x.current)==null?void 0:Z.side)&&F1(P,(ne=x.current)==null?void 0:ne.area)},[]);return v.jsx(p1,{scope:r,searchRef:te,onItemEnter:g.useCallback(P=>{C(P)&&P.preventDefault()},[C]),onItemLeave:g.useCallback(P=>{var Z;C(P)||((Z=B.current)==null||Z.focus(),D(null))},[C]),onTriggerLeave:g.useCallback(P=>{C(P)&&P.preventDefault()},[C]),pointerGraceTimerRef:de,onPointerGraceIntentChange:g.useCallback(P=>{x.current=P},[]),children:v.jsx(E,{...H,children:v.jsx(wi,{asChild:!0,trapped:a,onMountAutoFocus:be(o,P=>{var Z;P.preventDefault(),(Z=B.current)==null||Z.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:v.jsx(qh,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,children:v.jsx(yf,{asChild:!0,...A,dir:_.dir,orientation:"vertical",loop:n,currentTabStopId:b,onCurrentTabStopIdChange:D,onEntryFocus:be(l,P=>{_.isUsingKeyboardRef.current||P.preventDefault()}),preventScrollOnEntryFocus:!0,children:v.jsx(Pl,{role:"menu","aria-orientation":"vertical","data-state":Qy(m.open),"data-radix-menu-content":"",dir:_.dir,...w,...y,ref:j,style:{outline:"none",...y.style},onKeyDown:be(y.onKeyDown,P=>{const Z=P.target.closest("[data-radix-menu-content]")===P.currentTarget,ne=P.ctrlKey||P.altKey||P.metaKey,le=P.key.length===1;Z&&(P.key==="Tab"&&P.preventDefault(),!ne&&le&&N(P.key));const ye=B.current;if(P.target!==ye||!Ty.includes(P.key))return;P.preventDefault();const we=F().filter(De=>!De.disabled).map(De=>De.ref.current);xu.includes(P.key)&&we.reverse(),k1(we)}),onBlur:be(t.onBlur,P=>{P.currentTarget.contains(P.target)||(window.clearTimeout(G.current),te.current="")}),onPointerMove:be(t.onPointerMove,Oo(P=>{const Z=P.target,ne=k.current!==P.clientX;if(P.currentTarget.contains(Z)&&ne){const le=P.clientX>k.current?"right":"left";R.current=le,k.current=P.clientX}}))})})})})})})});Cy.displayName=Ct;var g1="MenuGroup",Nu=g.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return v.jsx(Qe.div,{role:"group",...n,ref:e})});Nu.displayName=g1;var y1="MenuLabel",jy=g.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return v.jsx(Qe.div,{...n,ref:e})});jy.displayName=y1;var _s="MenuItem",Ly="menu.itemSelect",vs=g.forwardRef((t,e)=>{const{disabled:r=!1,onSelect:n,...a}=t,o=g.useRef(null),i=ya(_s,t.__scopeMenu),s=Ru(_s,t.__scopeMenu),l=Rt(e,o),c=g.useRef(!1),u=()=>{const d=o.current;if(!r&&d){const h=new CustomEvent(Ly,{bubbles:!0,cancelable:!0});d.addEventListener(Ly,p=>n==null?void 0:n(p),{once:!0}),eI(d,h),h.defaultPrevented?c.current=!1:i.onClose()}};return v.jsx(Dy,{...a,ref:l,disabled:r,onClick:be(t.onClick,u),onPointerDown:d=>{var h;(h=t.onPointerDown)==null||h.call(t,d),c.current=!0},onPointerUp:be(t.onPointerUp,d=>{var h;c.current||((h=d.currentTarget)==null||h.click())}),onKeyDown:be(t.onKeyDown,d=>{const h=s.searchRef.current!=="";r||h&&d.key===" "||ys.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});vs.displayName=_s;var Dy=g.forwardRef((t,e)=>{const{__scopeMenu:r,disabled:n=!1,textValue:a,...o}=t,i=Ru(_s,r),s=ku(r),l=g.useRef(null),c=Rt(e,l),[u,d]=g.useState(!1),[h,p]=g.useState("");return g.useEffect(()=>{const f=l.current;f&&p((f.textContent??"").trim())},[o.children]),v.jsx(ma.ItemSlot,{scope:r,disabled:n,textValue:a??h,children:v.jsx(Xh,{asChild:!0,...s,focusable:!n,children:v.jsx(Qe.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:c,onPointerMove:be(t.onPointerMove,Oo(f=>{n?i.onItemLeave(f):(i.onItemEnter(f),f.defaultPrevented||f.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:be(t.onPointerLeave,Oo(f=>i.onItemLeave(f))),onFocus:be(t.onFocus,()=>d(!0)),onBlur:be(t.onBlur,()=>d(!1))})})})}),_1="MenuCheckboxItem",$y=g.forwardRef((t,e)=>{const{checked:r=!1,onCheckedChange:n,...a}=t;return v.jsx(Wy,{scope:t.__scopeMenu,checked:r,children:v.jsx(vs,{role:"menuitemcheckbox","aria-checked":ws(r)?"mixed":r,...a,ref:e,"data-state":Cu(r),onSelect:be(a.onSelect,()=>n==null?void 0:n(ws(r)?!0:!r),{checkForDefaultPrevented:!1})})})});$y.displayName=_1;var zy="MenuRadioGroup",[v1,w1]=Xr(zy,{value:void 0,onValueChange:()=>{}}),Uy=g.forwardRef((t,e)=>{const{value:r,onValueChange:n,...a}=t,o=Zn(n);return v.jsx(v1,{scope:t.__scopeMenu,value:r,onValueChange:o,children:v.jsx(Nu,{...a,ref:e})})});Uy.displayName=zy;var By="MenuRadioItem",Hy=g.forwardRef((t,e)=>{const{value:r,...n}=t,a=w1(By,t.__scopeMenu),o=r===a.value;return v.jsx(Wy,{scope:t.__scopeMenu,checked:o,children:v.jsx(vs,{role:"menuitemradio","aria-checked":o,...n,ref:e,"data-state":Cu(o),onSelect:be(n.onSelect,()=>{var i;return(i=a.onValueChange)==null?void 0:i.call(a,r)},{checkForDefaultPrevented:!1})})})});Hy.displayName=By;var Iu="MenuItemIndicator",[Wy,b1]=Xr(Iu,{checked:!1}),Gy=g.forwardRef((t,e)=>{const{__scopeMenu:r,forceMount:n,...a}=t,o=b1(Iu,r);return v.jsx(Tr,{present:n||ws(o.checked)||o.checked===!0,children:v.jsx(Qe.span,{...a,ref:e,"data-state":Cu(o.checked)})})});Gy.displayName=Iu;var E1="MenuSeparator",qy=g.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t;return v.jsx(Qe.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});qy.displayName=E1;var S1="MenuArrow",Vy=g.forwardRef((t,e)=>{const{__scopeMenu:r,...n}=t,a=ga(r);return v.jsx(Cl,{...a,...n,ref:e})});Vy.displayName=S1;var Pu="MenuSub",[x1,Zy]=Xr(Pu),Jy=t=>{const{__scopeMenu:e,children:r,open:n=!1,onOpenChange:a}=t,o=Cr(Pu,e),i=ga(e),[s,l]=g.useState(null),[c,u]=g.useState(null),d=Zn(a);return g.useEffect(()=>(o.open===!1&&d(!1),()=>d(!1)),[o.open,d]),v.jsx(bi,{...i,children:v.jsx(Au,{scope:e,open:n,onOpenChange:d,content:c,onContentChange:u,children:v.jsx(x1,{scope:e,contentId:Wt(),triggerId:Wt(),trigger:s,onTriggerChange:l,children:r})})})};Jy.displayName=Pu;var Ro="MenuSubTrigger",Ky=g.forwardRef((t,e)=>{const r=Cr(Ro,t.__scopeMenu),n=ya(Ro,t.__scopeMenu),a=Zy(Ro,t.__scopeMenu),o=Ru(Ro,t.__scopeMenu),i=g.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:l}=o,c={__scopeMenu:t.__scopeMenu},u=g.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return g.useEffect(()=>u,[u]),g.useEffect(()=>{const d=s.current;return()=>{window.clearTimeout(d),l(null)}},[s,l]),v.jsx(Mu,{asChild:!0,...c,children:v.jsx(Dy,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":Qy(r.open),...t,ref:Qb(e,a.onTriggerChange),onClick:d=>{var h;(h=t.onClick)==null||h.call(t,d),!(t.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:be(t.onPointerMove,Oo(d=>{o.onItemEnter(d),!d.defaultPrevented&&!t.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:be(t.onPointerLeave,Oo(d=>{var p,f;u();const h=(p=r.content)==null?void 0:p.getBoundingClientRect();if(h){const y=(f=r.content)==null?void 0:f.dataset.side,m=y==="right",_=m?-5:5,w=h[m?"left":"right"],A=h[m?"right":"left"];o.onPointerGraceIntentChange({area:[{x:d.clientX+_,y:d.clientY},{x:w,y:h.top},{x:A,y:h.top},{x:A,y:h.bottom},{x:w,y:h.bottom}],side:y}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(d),d.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:be(t.onKeyDown,d=>{var p;const h=o.searchRef.current!=="";t.disabled||h&&d.key===" "||My[n.dir].includes(d.key)&&(r.onOpenChange(!0),(p=r.content)==null||p.focus(),d.preventDefault())})})})});Ky.displayName=Ro;var Yy="MenuSubContent",Xy=g.forwardRef((t,e)=>{const r=Iy(Ct,t.__scopeMenu),{forceMount:n=r.forceMount,...a}=t,o=Cr(Ct,t.__scopeMenu),i=ya(Ct,t.__scopeMenu),s=Zy(Yy,t.__scopeMenu),l=g.useRef(null),c=Rt(e,l);return v.jsx(ma.Provider,{scope:t.__scopeMenu,children:v.jsx(Tr,{present:n||o.open,children:v.jsx(ma.Slot,{scope:t.__scopeMenu,children:v.jsx(Ou,{id:s.contentId,"aria-labelledby":s.triggerId,...a,ref:c,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;i.isUsingKeyboardRef.current&&((d=l.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:be(t.onFocusOutside,u=>{u.target!==s.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:be(t.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:be(t.onKeyDown,u=>{var p;const d=u.currentTarget.contains(u.target),h=Fy[i.dir].includes(u.key);d&&h&&(o.onOpenChange(!1),(p=s.trigger)==null||p.focus(),u.preventDefault())})})})})})});Xy.displayName=Yy;function Qy(t){return t?"open":"closed"}function ws(t){return t==="indeterminate"}function Cu(t){return ws(t)?"indeterminate":t?"checked":"unchecked"}function k1(t){const e=document.activeElement;for(const r of t)if(r===e||(r.focus(),document.activeElement!==e))return}function A1(t,e){return t.map((r,n)=>t[(e+n)%t.length])}function T1(t,e,r){const n=e.length>1&&Array.from(e).every(s=>s===e[0])?e[0]:e,a=r?t.indexOf(r):-1;let o=A1(t,Math.max(a,0));n.length===1&&(o=o.filter(s=>s!==r));const i=o.find(s=>s.toLowerCase().startsWith(n.toLowerCase()));return i!==r?i:void 0}function M1(t,e){const{x:r,y:n}=t;let a=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const s=e[o].x,l=e[o].y,c=e[i].x,u=e[i].y;l>n!=u>n&&r<(c-s)*(n-l)/(u-l)+s&&(a=!a)}return a}function F1(t,e){if(!e)return!1;const r={x:t.clientX,y:t.clientY};return M1(r,e)}function Oo(t){return e=>e.pointerType==="mouse"?t(e):void 0}let e_,bs,t_,R1,lt,r_,ju,Lu;Ip=Tu,wp=Mu,Pp=Py,bp=Cy,Ep=Nu,Sp=jy,xp=vs,kp=$y,Ap=Uy,Tp=Hy,Mp=Gy,Fp=qy,Rp=Vy,e_=Jy,Op=Ky,Np=Xy,bs="DropdownMenu",[t_,R1]=pi(bs,[jl]),lt=jl(),[r_,ju]=t_(bs),Lu=t=>{const{__scopeDropdownMenu:e,children:r,dir:n,open:a,defaultOpen:o,onOpenChange:i,modal:s=!0}=t,l=lt(e),c=g.useRef(null),[u=!1,d]=Za({prop:a,defaultProp:o,onChange:i});return v.jsx(r_,{scope:e,triggerId:Wt(),triggerRef:c,contentId:Wt(),open:u,onOpenChange:d,onOpenToggle:g.useCallback(()=>d(h=>!h),[d]),modal:s,children:v.jsx(Ip,{...l,open:u,onOpenChange:d,dir:n,modal:s,children:r})})},Lu.displayName=bs;var n_="DropdownMenuTrigger",a_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...a}=t,o=ju(n_,r),i=lt(r);return v.jsx(wp,{asChild:!0,...i,children:v.jsx(Qe.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:Qb(e,o.triggerRef),onPointerDown:be(t.onPointerDown,s=>{!n&&s.button===0&&s.ctrlKey===!1&&(o.onOpenToggle(),o.open||s.preventDefault())}),onKeyDown:be(t.onKeyDown,s=>{n||(["Enter"," "].includes(s.key)&&o.onOpenToggle(),s.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});a_.displayName=n_;var O1="DropdownMenuPortal",o_=t=>{const{__scopeDropdownMenu:e,...r}=t,n=lt(e);return v.jsx(Pp,{...n,...r})};o_.displayName=O1;var i_="DropdownMenuContent",s_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=ju(i_,r),o=lt(r),i=g.useRef(!1);return v.jsx(bp,{id:a.contentId,"aria-labelledby":a.triggerId,...o,...n,ref:e,onCloseAutoFocus:be(t.onCloseAutoFocus,s=>{var l;i.current||((l=a.triggerRef.current)==null||l.focus()),i.current=!1,s.preventDefault()}),onInteractOutside:be(t.onInteractOutside,s=>{const l=s.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!a.modal||u)&&(i.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});s_.displayName=i_;var N1="DropdownMenuGroup",l_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Ep,{...a,...n,ref:e})});l_.displayName=N1;var I1="DropdownMenuLabel",c_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Sp,{...a,...n,ref:e})});c_.displayName=I1;var P1="DropdownMenuItem",u_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(xp,{...a,...n,ref:e})});u_.displayName=P1;var C1="DropdownMenuCheckboxItem",d_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(kp,{...a,...n,ref:e})});d_.displayName=C1;var j1="DropdownMenuRadioGroup",h_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Ap,{...a,...n,ref:e})});h_.displayName=j1;var L1="DropdownMenuRadioItem",p_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Tp,{...a,...n,ref:e})});p_.displayName=L1;var D1="DropdownMenuItemIndicator",f_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Mp,{...a,...n,ref:e})});f_.displayName=D1;var $1="DropdownMenuSeparator",m_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Fp,{...a,...n,ref:e})});m_.displayName=$1;var z1="DropdownMenuArrow",U1=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Rp,{...a,...n,ref:e})});U1.displayName=z1;var B1=t=>{const{__scopeDropdownMenu:e,children:r,open:n,onOpenChange:a,defaultOpen:o}=t,i=lt(e),[s=!1,l]=Za({prop:n,defaultProp:o,onChange:a});return v.jsx(e_,{...i,open:s,onOpenChange:l,children:r})},H1="DropdownMenuSubTrigger",g_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Op,{...a,...n,ref:e})});g_.displayName=H1;var W1="DropdownMenuSubContent",y_=g.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...n}=t,a=lt(r);return v.jsx(Np,{...a,...n,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});y_.displayName=W1,sf=Lu,lf=a_,of=o_,Kl=s_,af=l_,nc=c_,Ql=u_,ec=d_,R0=h_,rc=p_,tc=f_,ac=m_,O0=B1,Yl=g_,Xl=y_;const G1=sf,q1=lf,V1=af,Z1=g.forwardRef(({className:t,inset:e,children:r,...n},a)=>v.jsxs(Yl,{ref:a,className:me("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...n,children:[r,v.jsx(Ke,{name:"chevron-right",className:"ml-auto"})]}));Z1.displayName=Yl.displayName;const J1=g.forwardRef(({className:t,...e},r)=>v.jsx(Xl,{ref:r,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));J1.displayName=Xl.displayName;const __=g.forwardRef(({className:t,sideOffset:e=4,...r},n)=>v.jsx(of,{children:v.jsx(Kl,{ref:n,sideOffset:e,className:me("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));__.displayName=Kl.displayName;const v_=g.forwardRef(({className:t,inset:e,...r},n)=>v.jsx(Ql,{ref:n,className:me("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...r}));v_.displayName=Ql.displayName;const K1=g.forwardRef(({className:t,children:e,checked:r,...n},a)=>v.jsxs(ec,{ref:a,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...n,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(tc,{children:v.jsx(Ke,{name:"check",className:"h-4 w-4"})})}),e]}));K1.displayName=ec.displayName;const Y1=g.forwardRef(({className:t,children:e,...r},n)=>v.jsxs(rc,{ref:n,className:me("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(tc,{children:v.jsx(Ke,{name:"circle",className:"h-4 w-4"})})}),e]}));Y1.displayName=rc.displayName;const X1=g.forwardRef(({className:t,inset:e,...r},n)=>v.jsx(nc,{ref:n,className:me("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...r}));X1.displayName=nc.displayName;const Q1=g.forwardRef(({className:t,...e},r)=>v.jsx(ac,{ref:r,className:me("-mx-1 my-1 h-px bg-muted",t),...e}));Q1.displayName=ac.displayName;function eA(){const{t}=fi("sidebar"),{isMobile:e}=To();return v.jsx(ho,{children:v.jsx(Kn,{children:v.jsxs(G1,{children:[v.jsx(q1,{asChild:!0,children:v.jsxs(eo,{size:"lg",className:"data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground",children:[v.jsx("div",{children:v.jsx(Ke,{name:"settings",size:28,className:"pr-2"})}),v.jsx(Ke,{name:"chevrons-up-down",className:"ml-auto size-4"})]})}),v.jsx(__,{className:"w-[--radix-dropdown-menu-trigger-width] min-w-56 rounded-lg",side:e?"bottom":"right",align:"end",sideOffset:4,children:v.jsx(V1,{children:v.jsxs(v_,{children:[v.jsx(Ke,{name:"sparkles"}),t("contact")]})})})]})})})}const tA={navMain:[{title:"playground.title",icon:v.jsx(Ke,{name:"square-terminal"}),isActive:!0,items:[{title:"playground.nodes",id:"nodes"},{title:"playground.connections",id:"connections"}]},{title:"model.title",url:"#",icon:v.jsx(Ke,{name:"bot"}),items:[{title:"model.llm",id:"llm"},{title:"model.embedding",id:"embedding"}]},{title:"tutorial.title",icon:v.jsx(Ke,{name:"book-open"}),items:[{title:"tutorial.get_started",id:"get-started"},{title:"tutorial.simple_workflow",id:"simple-workflow"},{title:"tutorial.ai_structured_output",id:"ai-structured-output"},{title:"tutorial.standalone_chat_application",id:"chat-application"},{title:"tutorial.standalone_editor_application",id:"editor-application"},{title:"tutorial.tool_calling",id:"tool-calling"},{title:"tutorial.vector_database",id:"vector-database"}]},{title:"application.title",icon:v.jsx(Ke,{name:"settings-2"}),items:[{title:"application.chat",id:"chat"},{title:"application.editor",id:"editor"},{title:"application.vslite",id:"vslite"}]}]};function rA({currentSession:t,...e}){return v.jsxs(fc,{collapsible:"offcanvas",...e,children:[v.jsx("div",{className:"h-1"}),v.jsxs(gc,{children:[v.jsx(r1,{currentSession:t}),v.jsx(Kk,{items:tA.navMain})]}),v.jsx(Jg,{children:v.jsx(eA,{})}),v.jsx(Zg,{})]})}const w_=t=>Symbol.iterator in t,b_=t=>"entries"in t,E_=(t,e)=>{const r=t instanceof Map?t:new Map(t.entries()),n=e instanceof Map?e:new Map(e.entries());if(r.size!==n.size)return!1;for(const[a,o]of r)if(!Object.is(o,n.get(a)))return!1;return!0},nA=(t,e)=>{const r=t[Symbol.iterator](),n=e[Symbol.iterator]();let a=r.next(),o=n.next();for(;!a.done&&!o.done;){if(!Object.is(a.value,o.value))return!1;a=r.next(),o=n.next()}return!!a.done&&!!o.done};function aA(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!w_(t)||!w_(e)?E_({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):b_(t)&&b_(e)?E_(t,e):nA(t,e)}$p=function(t){const e=tI.useRef();return r=>{const n=t(r);return aA(e.current,n)?e.current:e.current=n}},Qh=g.memo(t=>{const{loading:e,...r}=t;return v.jsx(Hr,{...r,disabled:t.disabled||e,children:e?v.jsx(Ke,{name:"loader-circle",className:"animate-spin"}):t.children})});function oA({className:t,onProcess:e=async()=>(await new Promise(a=>setTimeout(a,2e3)),Math.random()>.5),processDuration:r=2e3,...n}){const[a,o]=g.useState(!1),[i,s]=g.useState(null),[l,c]=g.useState(!1),[,u]=g.useState(0);g.useEffect(()=>{if(a){const h=Date.now(),p=setInterval(()=>{const f=(Date.now()-h)/r*100;f>=100?(clearInterval(p),u(100)):u(f)},10);return()=>clearInterval(p)}},[a,r]);async function d(){if(a)return;o(!0),s(null),u(0),await new Promise(p=>setTimeout(p,r));const h=e?await e():!0;s(h),o(!1),c(!0),setTimeout(()=>{s(null),u(0),c(!1)},2e3)}return v.jsx(Hr,{className:me("relative group","transition-all duration-300",a&&"cursor-wait",t),variant:"ghost",onClick:d,disabled:a,...n,children:v.jsx("div",{className:me("w-full flex items-center justify-center gap-2",l&&"animate-[scale_300ms_ease-in-out]"),children:i===null?v.jsx(v.Fragment,{children:v.jsx(Ke,{name:"forward",className:me("w-4 h-4 transition-transform duration-200","group-hover:scale-110",a&&"animate-bounce")})}):i?v.jsx(v.Fragment,{children:v.jsx(Ke,{name:"check",className:"w-4 h-4 text-green-500"})}):v.jsx(v.Fragment,{children:v.jsx(Ke,{name:"x",className:"w-4 h-4 text-red-500"})})})})}const vr="NOLLM",iA="0123456789abcdef",sA=[8,4,4,4,12];zl=function(){return sA.map(t=>iy(iA,t)()).join("-")};const lA=()=>{const t=Gr(e=>e.currentSession);return{exportSession:g.useCallback(async()=>{if(!(t!=null&&t.id))return;const e={},r={},n=Object.keys(_u).filter(l=>l!=="Session");await Promise.all(n.map(l=>We(l).find({where:{session_id:t.id}}).then(c=>{c.map(u=>{r[u.id]=u.id}),e[l]=c}))),Object.keys(r).forEach(l=>{r[l]=`[ID_${zl()}]`});let a=JSON.stringify({[vr]:{key:t.id,session:Object.entries(t).reduce((l,[c,u])=>((typeof u!="object"||u===null)&&(l[c]=u),u===void 0&&(l[c]=null),l),{}),ids:Object.keys(r)},...e});Object.keys(r).forEach(l=>{a=a.replace(new RegExp(l,"g"),r[l])}),a=a.replace(new RegExp(t.id,"g"),"[SESSION_ID]");const o=new Blob([a],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=`${t.name}_${new Date}.json`,s.click()},[t])}},cA=()=>{const[t,e]=g.useState(!1),r=Yn(),n=g.useCallback((o,{idMap:i,newSessionId:s,replaceItem:l})=>{const c=o;return{...Object.keys(c).reduce((u,d)=>(c[d]&&typeof c[d]=="string"&&i[c[d]]?u[d]=i[c[d]]:d==="session_id"&&s?u[d]=s:u[d]=c[d],u),{}),...l||{}}},[]),a=g.useCallback(async o=>{try{e(!0);const i=Object.keys(_u).filter(d=>d!==vr);if(!Object.keys(o[vr]).length||typeof o[vr]!="object")throw new Error("Missing Metadata");if(!("session"in o[vr])||!o[vr].session)throw new Error("Missing Session Metadata");const s=o[vr].session;if(!("ids"in o[vr]))throw new Error("Missing Session ID");const l=o[vr].ids.reduce((d,h)=>(d[h]=zl(),d),{}),c=Object.keys(o).filter(d=>d!==vr);if(!c.every(d=>i.includes(d)))throw new Error("Invalid JSON keys");if(!c.every(d=>Array.isArray(o[d])))throw new Error("Invalid JSON values");c.forEach(d=>{o[d].forEach(h=>{if("session_id"in h&&h.session_id!=="[SESSION_ID]")throw new Error("Invalid JSON values")})});const u=await We("Session").save(n(s,{idMap:l,newSessionId:"",replaceItem:{id:void 0}}));if(!u)throw new Error("Failed to import session");await Promise.all(i.map(d=>{const h=o[d];if(!h||!h.length)return Promise.resolve();const p=h.map(f=>n(f,{idMap:l,newSessionId:u.id}));return We(d).save(p)})),u.type===Et.Whiteboard?r(it("whiteboard",{sessionId:u.id})):u.type===Et.StandaloneApp&&r(it("application",{applicationId:u.id}))}finally{e(!1)}},[r,n]);return{loading:t,importSession:a}};function uA(){const{t}=fi("tooltips"),e=mr(),r=El(h=>h.setTheme),n=El(h=>h.theme),{exportSession:a}=lA(),{loading:o,importSession:i}=cA(),s=g.useRef(null),l=g.useCallback(()=>{r(n==="dark"?"light":"dark")},[n,r]),c=g.useCallback(async()=>{try{return await a(),!0}catch(h){return Sl("Export Session",h),!1}},[a]),u=g.useCallback(async h=>{var p;try{const f=(p=h.target.files)==null?void 0:p[0];if(!f)return;const y=await new Promise((m,_)=>{const w=new FileReader;w.onload=A=>{var F;try{const b=(F=A.target)==null?void 0:F.result;m(JSON.parse(b))}catch(b){_(b)}},w.onerror=A=>{_(A)},w.readAsText(f)});await i(y)}catch(f){return Sl("Import Session",f),!1}},[i]),d=g.useMemo(()=>{if(e.pathname.includes(it("whiteboard")))return t("whiteboard");if(e.pathname.includes(it("application")))return t("apllication")},[e.pathname,t]);return v.jsxs("header",{className:"flex h-14 shrink-0 items-center gap-2 transition-[width,height] ease-linear justify-between",children:[v.jsxs("div",{className:"flex items-center gap-2 px-4",children:[v.jsx(Vg,{}),v.jsx(Ei,{children:d})]}),v.jsx("div",{className:"flex items-center pl-4 pr-2",children:v.jsxs(lc,{children:[v.jsxs(ea,{children:[v.jsx(ta,{children:v.jsxs(Qh,{loading:o,variant:"ghost",onClick:()=>{var h;return(h=s.current)==null?void 0:h.click()},children:[v.jsx(Ke,{size:18,name:"import"}),v.jsx("input",{ref:s,type:"file",accept:".json",onChange:u,className:"hidden"},`${Date.now()}`)]})}),v.jsx(xn,{children:v.jsx("p",{children:t("import")})})]}),v.jsxs(ea,{children:[v.jsx(ta,{children:v.jsx(oA,{onProcess:c})}),v.jsx(xn,{children:v.jsx("p",{children:t("export")})})]}),v.jsxs(ea,{children:[v.jsx(ta,{children:v.jsx(Hr,{disabled:o,onClick:l,variant:"ghost",children:v.jsx(Ke,{size:18,name:n==="dark"?"moon":"sun"})})}),v.jsx(xn,{children:v.jsx("p",{children:t("theme")})})]}),v.jsxs(ea,{children:[v.jsx(ta,{children:v.jsx(Hr,{variant:"link",children:v.jsx("a",{referrerPolicy:"no-referrer",target:"_blank",href:"https://github.com/zrg-team/NoLLMChat",children:v.jsx(Ke,{size:18,name:"github"})})})}),v.jsx(xn,{children:v.jsx("p",{children:"https://github.com/zrg-team/NoLLMChat"})})]})]})})]})}function S_({requiredSession:t}){const e=Jf(),r=Yn(),n=mr(),a=g.useRef(n),o=Gr(u=>u.currentSession),i=Gr(u=>u.setCurrentSession),s=Gr(u=>u.setToDefaultSession),{error:l,ready:c}=Gr($p(u=>({error:u.error,ready:u.ready})));return a.current=n,g.useEffect(()=>{!(o!=null&&o.id)||!t||(n.pathname.includes(it("whiteboard"))?e.sessionId?e.sessionId&&e.sessionId!==(o==null?void 0:o.id)&&i(e.sessionId):r(it("whiteboard",{sessionId:o==null?void 0:o.id})):n.pathname.includes(it("application"))&&(e.applicationId?e.applicationId&&e.applicationId!==(o==null?void 0:o.id)&&i(e.applicationId):r(it("application",{applicationId:o==null?void 0:o.id}))))},[o==null?void 0:o.id,n.pathname,r,e.applicationId,e.sessionId,t,i]),g.useEffect(()=>{t&&i(e.sessionId||e.applicationId).then(u=>{if(!u)return s(n.pathname.includes(it("whiteboard"))?Et.Whiteboard:Et.StandaloneApp);ty().has("flow")&&u.type===Et.StandaloneApp||(u.type===Et.StandaloneApp&&a.current.pathname.includes(it("whiteboard").replace("/",""))?r(it("application",{applicationId:u.id})):u.type===Et.Whiteboard&&a.current.pathname.includes(it("application").replace("/",""))&&r(it("whiteboard",{sessionId:u.id})))})},[r,e.applicationId,e.sessionId,t,i,s]),c?v.jsxs(xl,{defaultOpen:!1,children:[v.jsx(rA,{currentSession:o}),v.jsxs(kl,{className:"max-h-screen overflow-hidden",children:[v.jsx(uA,{}),v.jsx(_i,{className:"shrink-0"}),v.jsx("div",{className:"flex flex-1 flex-col p-0 m-0 overflow-y-auto",children:l?v.jsx(e0,{}):v.jsx(KE,{})})]})]}):null}kn=class{constructor(t){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=t.pageContent!==void 0?t.pageContent.toString():"",this.metadata=t.metadata??{},this.id=t.id}};var Ne;(function(t){t.assertEqual=a=>{};function e(a){}t.assertIs=e;function r(a){throw new Error}t.assertNever=r,t.arrayToEnum=a=>{const o={};for(const i of a)o[i]=i;return o},t.getValidEnumValues=a=>{const o=t.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),i={};for(const s of o)i[s]=a[s];return t.objectValues(i)},t.objectValues=a=>t.objectKeys(a).map(function(o){return a[o]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const o=[];for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&o.push(i);return o},t.find=(a,o)=>{for(const i of a)if(o(i))return i},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,o=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}t.joinValues=n,t.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(Ne||(Ne={}));var x_;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(x_||(x_={}));const se=Ne.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qr=t=>{switch(typeof t){case"undefined":return se.undefined;case"string":return se.string;case"number":return Number.isNaN(t)?se.nan:se.number;case"boolean":return se.boolean;case"function":return se.function;case"bigint":return se.bigint;case"symbol":return se.symbol;case"object":return Array.isArray(t)?se.array:t===null?se.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?se.promise:typeof Map<"u"&&t instanceof Map?se.map:typeof Set<"u"&&t instanceof Set?se.set:typeof Date<"u"&&t instanceof Date?se.date:se.object;default:return se.unknown}},Y=Ne.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class jr extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){const r=e||function(o){return o.message},n={_errors:[]},a=o=>{for(const i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let s=n,l=0;for(;l<i.path.length;){const c=i.path[l];l===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(r(i))):s[c]=s[c]||{_errors:[]},s=s[c],l++}}};return a(this),n}static assert(e){if(!(e instanceof jr))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ne.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},n=[];for(const a of this.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(e(a))):n.push(e(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}jr.create=t=>new jr(t);const Du=(t,e)=>{let r;switch(t.code){case Y.invalid_type:t.received===se.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case Y.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Ne.jsonStringifyReplacer)}`;break;case Y.unrecognized_keys:r=`Unrecognized key(s) in object: ${Ne.joinValues(t.keys,", ")}`;break;case Y.invalid_union:r="Invalid input";break;case Y.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Ne.joinValues(t.options)}`;break;case Y.invalid_enum_value:r=`Invalid enum value. Expected ${Ne.joinValues(t.options)}, received '${t.received}'`;break;case Y.invalid_arguments:r="Invalid function arguments";break;case Y.invalid_return_type:r="Invalid function return type";break;case Y.invalid_date:r="Invalid date";break;case Y.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Ne.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case Y.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case Y.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case Y.custom:r="Invalid input";break;case Y.invalid_intersection_types:r="Intersection results could not be merged";break;case Y.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case Y.not_finite:r="Number must be finite";break;default:r=e.defaultError,Ne.assertNever(t)}return{message:r}};let dA=Du;function hA(){return dA}const pA=t=>{const{data:e,path:r,errorMaps:n,issueData:a}=t,o=[...r,...a.path||[]],i={...a,path:o};if(a.message!==void 0)return{...a,path:o,message:a.message};let s="";const l=n.filter(c=>!!c).slice().reverse();for(const c of l)s=c(i,{data:e,defaultError:s}).message;return{...a,path:o,message:s}};function re(t,e){const r=hA(),n=pA({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Du?void 0:Du].filter(a=>!!a)});t.common.issues.push(n)}class At{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const n=[];for(const a of r){if(a.status==="aborted")return ve;a.status==="dirty"&&e.dirty(),n.push(a.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){const n=[];for(const a of r){const o=await a.key,i=await a.value;n.push({key:o,value:i})}return At.mergeObjectSync(e,n)}static mergeObjectSync(e,r){const n={};for(const a of r){const{key:o,value:i}=a;if(o.status==="aborted"||i.status==="aborted")return ve;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(n[o.value]=i.value)}return{status:e.value,value:n}}}const ve=Object.freeze({status:"aborted"}),$u=t=>({status:"dirty",value:t}),jt=t=>({status:"valid",value:t}),k_=t=>t.status==="aborted",A_=t=>t.status==="dirty",_a=t=>t.status==="valid",Es=t=>typeof Promise<"u"&&t instanceof Promise;var ce;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ce||(ce={}));class en{constructor(e,r,n,a){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const T_=(t,e)=>{if(_a(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new jr(t.common.issues);return this._error=r,this._error}}};function ke(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:n,description:a}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,i)=>{const{message:s}=t;return o.code==="invalid_enum_value"?{message:s??i.defaultError}:typeof i.data>"u"?{message:s??n??i.defaultError}:o.code!=="invalid_type"?{message:i.defaultError}:{message:s??r??i.defaultError}},description:a}}class Oe{get description(){return this._def.description}_getType(e){return Qr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Qr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new At,ctx:{common:e.parent.common,data:e.data,parsedType:Qr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(Es(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qr(e)},a=this._parseSync({data:e,path:n.path,parent:n});return T_(n,a)}"~validate"(e){var n,a;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qr(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:r});return _a(o)?{value:o.value}:{issues:r.common.issues}}catch(o){(a=(n=o==null?void 0:o.message)==null?void 0:n.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(o=>_a(o)?{value:o.value}:{issues:r.common.issues})}async parseAsync(e,r){const n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qr(e)},a=this._parse({data:e,path:n.path,parent:n}),o=await(Es(a)?a:Promise.resolve(a));return T_(n,o)}refine(e,r){const n=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,o)=>{const i=e(a),s=()=>o.addIssue({code:Y.custom,...n(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(s(),!1)):i?!0:(s(),!1)})}refinement(e,r){return this._refinement((n,a)=>e(n)?!0:(a.addIssue(typeof r=="function"?r(n,a):r),!1))}_refinement(e){return new ba({schema:this,typeName:Q.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return nn.create(this,this._def)}nullable(){return Ea.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return wr.create(this)}promise(){return As.create(this,this._def)}or(e){return xs.create([this,e],this._def)}and(e){return ks.create(this,e,this._def)}transform(e){return new ba({...ke(this._def),schema:this,typeName:Q.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new Hu({...ke(this._def),innerType:this,defaultValue:r,typeName:Q.ZodDefault})}brand(){return new jA({typeName:Q.ZodBranded,type:this,...ke(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new Wu({...ke(this._def),innerType:this,catchValue:r,typeName:Q.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Gu.create(this,e)}readonly(){return qu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const fA=/^c[^\s-]{8,}$/i,mA=/^[0-9a-z]+$/,gA=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yA=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_A=/^[a-z0-9_-]{21}$/i,vA=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,wA=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bA=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,EA="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let zu;const SA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,xA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,kA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,AA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,TA=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,MA=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,M_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",FA=new RegExp(`^${M_}$`);function F_(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function RA(t){return new RegExp(`^${F_(t)}$`)}function OA(t){let e=`${M_}T${F_(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function NA(t,e){return!!((e==="v4"||!e)&&SA.test(t)||(e==="v6"||!e)&&kA.test(t))}function IA(t,e){if(!vA.test(t))return!1;try{const[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function PA(t,e){return!!((e==="v4"||!e)&&xA.test(t)||(e==="v6"||!e)&&AA.test(t))}class tn extends Oe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==se.string){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_type,expected:se.string,received:a.parsedType}),ve}const r=new At;let n;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const o=e.data.length>a.value,i=e.data.length<a.value;(o||i)&&(n=this._getOrReturnCtx(e,n),o?re(n,{code:Y.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):i&&re(n,{code:Y.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")bA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"email",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")zu||(zu=new RegExp(EA,"u")),zu.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"emoji",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")yA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"uuid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")_A.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"nanoid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")fA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"cuid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")mA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"cuid2",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")gA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"ulid",code:Y.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),re(n,{validation:"url",code:Y.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"regex",code:Y.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?OA(a).test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?FA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?RA(a).test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{code:Y.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?wA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"duration",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?NA(e.data,a.version)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"ip",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?IA(e.data,a.alg)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"jwt",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?PA(e.data,a.version)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"cidr",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?TA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"base64",code:Y.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?MA.test(e.data)||(n=this._getOrReturnCtx(e,n),re(n,{validation:"base64url",code:Y.invalid_string,message:a.message}),r.dirty()):Ne.assertNever(a);return{status:r.value,value:e.data}}_regex(e,r,n){return this.refinement(a=>e.test(a),{validation:r,code:Y.invalid_string,...ce.errToObj(n)})}_addCheck(e){return new tn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ce.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ce.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ce.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ce.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ce.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ce.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ce.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ce.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ce.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ce.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ce.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ce.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ce.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...ce.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ce.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ce.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...ce.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...ce.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...ce.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...ce.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...ce.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...ce.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...ce.errToObj(r)})}nonempty(e){return this.min(1,ce.errToObj(e))}trim(){return new tn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}tn.create=t=>new tn({checks:[],typeName:Q.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...ke(t)});function CA(t,e){const r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,a=r>n?r:n,o=Number.parseInt(t.toFixed(a).replace(".","")),i=Number.parseInt(e.toFixed(a).replace(".",""));return o%i/10**a}class No extends Oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==se.number){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_type,expected:se.number,received:a.parsedType}),ve}let r;const n=new At;for(const a of this._def.checks)a.kind==="int"?Ne.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),re(r,{code:Y.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):a.kind==="multipleOf"?CA(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),re(r,{code:Y.not_finite,message:a.message}),n.dirty()):Ne.assertNever(a);return{status:n.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,ce.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ce.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ce.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ce.toString(r))}setLimit(e,r,n,a){return new No({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ce.toString(a)}]})}_addCheck(e){return new No({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ce.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ce.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ce.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:ce.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ce.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ce.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ne.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}}No.create=t=>new No({checks:[],typeName:Q.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...ke(t)});class Io extends Oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==se.bigint)return this._getInvalidInput(e);let r;const n=new At;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),n.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),re(r,{code:Y.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):Ne.assertNever(a);return{status:n.value,value:e.data}}_getInvalidInput(e){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.bigint,received:r.parsedType}),ve}gte(e,r){return this.setLimit("min",e,!0,ce.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ce.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ce.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ce.toString(r))}setLimit(e,r,n,a){return new Io({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ce.toString(a)}]})}_addCheck(e){return new Io({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ce.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ce.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Io.create=t=>new Io({checks:[],typeName:Q.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...ke(t)});class R_ extends Oe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==se.boolean){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.boolean,received:r.parsedType}),ve}return jt(e.data)}}R_.create=t=>new R_({typeName:Q.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...ke(t)});class Ss extends Oe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==se.date){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_type,expected:se.date,received:a.parsedType}),ve}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return re(a,{code:Y.invalid_date}),ve}const r=new At;let n;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(n=this._getOrReturnCtx(e,n),re(n,{code:Y.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Ne.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ss({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:ce.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:ce.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}Ss.create=t=>new Ss({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Q.ZodDate,...ke(t)});class O_ extends Oe{_parse(e){if(this._getType(e)!==se.symbol){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.symbol,received:r.parsedType}),ve}return jt(e.data)}}O_.create=t=>new O_({typeName:Q.ZodSymbol,...ke(t)});class N_ extends Oe{_parse(e){if(this._getType(e)!==se.undefined){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.undefined,received:r.parsedType}),ve}return jt(e.data)}}N_.create=t=>new N_({typeName:Q.ZodUndefined,...ke(t)});class I_ extends Oe{_parse(e){if(this._getType(e)!==se.null){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.null,received:r.parsedType}),ve}return jt(e.data)}}I_.create=t=>new I_({typeName:Q.ZodNull,...ke(t)});class Uu extends Oe{constructor(){super(...arguments),this._any=!0}_parse(e){return jt(e.data)}}Uu.create=t=>new Uu({typeName:Q.ZodAny,...ke(t)});class P_ extends Oe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return jt(e.data)}}P_.create=t=>new P_({typeName:Q.ZodUnknown,...ke(t)});class rn extends Oe{_parse(e){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.never,received:r.parsedType}),ve}}rn.create=t=>new rn({typeName:Q.ZodNever,...ke(t)});class C_ extends Oe{_parse(e){if(this._getType(e)!==se.undefined){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.void,received:r.parsedType}),ve}return jt(e.data)}}C_.create=t=>new C_({typeName:Q.ZodVoid,...ke(t)});class wr extends Oe{_parse(e){const{ctx:r,status:n}=this._processInputParams(e),a=this._def;if(r.parsedType!==se.array)return re(r,{code:Y.invalid_type,expected:se.array,received:r.parsedType}),ve;if(a.exactLength!==null){const i=r.data.length>a.exactLength.value,s=r.data.length<a.exactLength.value;(i||s)&&(re(r,{code:i?Y.too_big:Y.too_small,minimum:s?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),n.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(re(r,{code:Y.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),n.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(re(r,{code:Y.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,s)=>a.type._parseAsync(new en(r,i,r.path,s)))).then(i=>At.mergeArray(n,i));const o=[...r.data].map((i,s)=>a.type._parseSync(new en(r,i,r.path,s)));return At.mergeArray(n,o)}get element(){return this._def.type}min(e,r){return new wr({...this._def,minLength:{value:e,message:ce.toString(r)}})}max(e,r){return new wr({...this._def,maxLength:{value:e,message:ce.toString(r)}})}length(e,r){return new wr({...this._def,exactLength:{value:e,message:ce.toString(r)}})}nonempty(e){return this.min(1,e)}}wr.create=(t,e)=>new wr({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Q.ZodArray,...ke(e)});function va(t){if(t instanceof Ve){const e={};for(const r in t.shape){const n=t.shape[r];e[r]=nn.create(va(n))}return new Ve({...t._def,shape:()=>e})}else return t instanceof wr?new wr({...t._def,type:va(t.element)}):t instanceof nn?nn.create(va(t.unwrap())):t instanceof Ea?Ea.create(va(t.unwrap())):t instanceof Cn?Cn.create(t.items.map(e=>va(e))):t}class Ve extends Oe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Ne.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==se.object){const l=this._getOrReturnCtx(e);return re(l,{code:Y.invalid_type,expected:se.object,received:l.parsedType}),ve}const{status:r,ctx:n}=this._processInputParams(e),{shape:a,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof rn&&this._def.unknownKeys==="strip"))for(const l in n.data)o.includes(l)||i.push(l);const s=[];for(const l of o){const c=a[l],u=n.data[l];s.push({key:{status:"valid",value:l},value:c._parse(new en(n,u,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof rn){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of i)s.push({key:{status:"valid",value:c},value:{status:"valid",value:n.data[c]}});else if(l==="strict")i.length>0&&(re(n,{code:Y.unrecognized_keys,keys:i}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of i){const u=n.data[c];s.push({key:{status:"valid",value:c},value:l._parse(new en(n,u,n.path,c)),alwaysSet:c in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of s){const u=await c.key,d=await c.value;l.push({key:u,value:d,alwaysSet:c.alwaysSet})}return l}).then(l=>At.mergeObjectSync(r,l)):At.mergeObjectSync(r,s)}get shape(){return this._def.shape()}strict(e){return ce.errToObj,new Ve({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var o,i;const a=((i=(o=this._def).errorMap)==null?void 0:i.call(o,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:ce.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new Ve({...this._def,unknownKeys:"strip"})}passthrough(){return new Ve({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ve({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ve({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Q.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new Ve({...this._def,catchall:e})}pick(e){const r={};for(const n of Ne.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Ve({...this._def,shape:()=>r})}omit(e){const r={};for(const n of Ne.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new Ve({...this._def,shape:()=>r})}deepPartial(){return va(this)}partial(e){const r={};for(const n of Ne.objectKeys(this.shape)){const a=this.shape[n];e&&!e[n]?r[n]=a:r[n]=a.optional()}return new Ve({...this._def,shape:()=>r})}required(e){const r={};for(const n of Ne.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof nn;)a=a._def.innerType;r[n]=a}return new Ve({...this._def,shape:()=>r})}keyof(){return $_(Ne.objectKeys(this.shape))}}Ve.create=(t,e)=>new Ve({shape:()=>t,unknownKeys:"strip",catchall:rn.create(),typeName:Q.ZodObject,...ke(e)}),Ve.strictCreate=(t,e)=>new Ve({shape:()=>t,unknownKeys:"strict",catchall:rn.create(),typeName:Q.ZodObject,...ke(e)}),Ve.lazycreate=(t,e)=>new Ve({shape:t,unknownKeys:"strip",catchall:rn.create(),typeName:Q.ZodObject,...ke(e)});class xs extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e),n=this._def.options;function a(o){for(const s of o)if(s.result.status==="valid")return s.result;for(const s of o)if(s.result.status==="dirty")return r.common.issues.push(...s.ctx.common.issues),s.result;const i=o.map(s=>new jr(s.ctx.common.issues));return re(r,{code:Y.invalid_union,unionErrors:i}),ve}if(r.common.async)return Promise.all(n.map(async o=>{const i={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(a);{let o;const i=[];for(const l of n){const c={...r,common:{...r.common,issues:[]},parent:null},u=l._parseSync({data:r.data,path:r.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!o&&(o={result:u,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(l=>new jr(l));return re(r,{code:Y.invalid_union,unionErrors:s}),ve}}get options(){return this._def.options}}xs.create=(t,e)=>new xs({options:t,typeName:Q.ZodUnion,...ke(e)});function Bu(t,e){const r=Qr(t),n=Qr(e);if(t===e)return{valid:!0,data:t};if(r===se.object&&n===se.object){const a=Ne.objectKeys(e),o=Ne.objectKeys(t).filter(s=>a.indexOf(s)!==-1),i={...t,...e};for(const s of o){const l=Bu(t[s],e[s]);if(!l.valid)return{valid:!1};i[s]=l.data}return{valid:!0,data:i}}else if(r===se.array&&n===se.array){if(t.length!==e.length)return{valid:!1};const a=[];for(let o=0;o<t.length;o++){const i=t[o],s=e[o],l=Bu(i,s);if(!l.valid)return{valid:!1};a.push(l.data)}return{valid:!0,data:a}}else return r===se.date&&n===se.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class ks extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e),a=(o,i)=>{if(k_(o)||k_(i))return ve;const s=Bu(o.value,i.value);return s.valid?((A_(o)||A_(i))&&r.dirty(),{status:r.value,value:s.data}):(re(n,{code:Y.invalid_intersection_types}),ve)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,i])=>a(o,i)):a(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}ks.create=(t,e,r)=>new ks({left:t,right:e,typeName:Q.ZodIntersection,...ke(r)});class Cn extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==se.array)return re(n,{code:Y.invalid_type,expected:se.array,received:n.parsedType}),ve;if(n.data.length<this._def.items.length)return re(n,{code:Y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ve;!this._def.rest&&n.data.length>this._def.items.length&&(re(n,{code:Y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const a=[...n.data].map((o,i)=>{const s=this._def.items[i]||this._def.rest;return s?s._parse(new en(n,o,n.path,i)):null}).filter(o=>!!o);return n.common.async?Promise.all(a).then(o=>At.mergeArray(r,o)):At.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new Cn({...this._def,rest:e})}}Cn.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Cn({items:t,typeName:Q.ZodTuple,rest:null,...ke(e)})};class j_ extends Oe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==se.map)return re(n,{code:Y.invalid_type,expected:se.map,received:n.parsedType}),ve;const a=this._def.keyType,o=this._def.valueType,i=[...n.data.entries()].map(([s,l],c)=>({key:a._parse(new en(n,s,n.path,[c,"key"])),value:o._parse(new en(n,l,n.path,[c,"value"]))}));if(n.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const l of i){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return ve;(c.status==="dirty"||u.status==="dirty")&&r.dirty(),s.set(c.value,u.value)}return{status:r.value,value:s}})}else{const s=new Map;for(const l of i){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return ve;(c.status==="dirty"||u.status==="dirty")&&r.dirty(),s.set(c.value,u.value)}return{status:r.value,value:s}}}}j_.create=(t,e,r)=>new j_({valueType:e,keyType:t,typeName:Q.ZodMap,...ke(r)});class Po extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==se.set)return re(n,{code:Y.invalid_type,expected:se.set,received:n.parsedType}),ve;const a=this._def;a.minSize!==null&&n.data.size<a.minSize.value&&(re(n,{code:Y.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&n.data.size>a.maxSize.value&&(re(n,{code:Y.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const o=this._def.valueType;function i(l){const c=new Set;for(const u of l){if(u.status==="aborted")return ve;u.status==="dirty"&&r.dirty(),c.add(u.value)}return{status:r.value,value:c}}const s=[...n.data.values()].map((l,c)=>o._parse(new en(n,l,n.path,c)));return n.common.async?Promise.all(s).then(l=>i(l)):i(s)}min(e,r){return new Po({...this._def,minSize:{value:e,message:ce.toString(r)}})}max(e,r){return new Po({...this._def,maxSize:{value:e,message:ce.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Po.create=(t,e)=>new Po({valueType:t,minSize:null,maxSize:null,typeName:Q.ZodSet,...ke(e)});class L_ extends Oe{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}L_.create=(t,e)=>new L_({getter:t,typeName:Q.ZodLazy,...ke(e)});class D_ extends Oe{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return re(r,{received:r.data,code:Y.invalid_literal,expected:this._def.value}),ve}return{status:"valid",value:e.data}}get value(){return this._def.value}}D_.create=(t,e)=>new D_({value:t,typeName:Q.ZodLiteral,...ke(e)});function $_(t,e){return new wa({values:t,typeName:Q.ZodEnum,...ke(e)})}class wa extends Oe{_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),n=this._def.values;return re(r,{expected:Ne.joinValues(n),received:r.parsedType,code:Y.invalid_type}),ve}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const r=this._getOrReturnCtx(e),n=this._def.values;return re(r,{received:r.data,code:Y.invalid_enum_value,options:n}),ve}return jt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return wa.create(e,{...this._def,...r})}exclude(e,r=this._def){return wa.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}}wa.create=$_;class z_ extends Oe{_parse(e){const r=Ne.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==se.string&&n.parsedType!==se.number){const a=Ne.objectValues(r);return re(n,{expected:Ne.joinValues(a),received:n.parsedType,code:Y.invalid_type}),ve}if(this._cache||(this._cache=new Set(Ne.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const a=Ne.objectValues(r);return re(n,{received:n.data,code:Y.invalid_enum_value,options:a}),ve}return jt(e.data)}get enum(){return this._def.values}}z_.create=(t,e)=>new z_({values:t,typeName:Q.ZodNativeEnum,...ke(e)});class As extends Oe{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==se.promise&&r.common.async===!1)return re(r,{code:Y.invalid_type,expected:se.promise,received:r.parsedType}),ve;const n=r.parsedType===se.promise?r.data:Promise.resolve(r.data);return jt(n.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}As.create=(t,e)=>new As({type:t,typeName:Q.ZodPromise,...ke(e)});class ba extends Oe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Q.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:n}=this._processInputParams(e),a=this._def.effect||null,o={addIssue:i=>{re(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),a.type==="preprocess"){const i=a.transform(n.data,o);if(n.common.async)return Promise.resolve(i).then(async s=>{if(r.value==="aborted")return ve;const l=await this._def.schema._parseAsync({data:s,path:n.path,parent:n});return l.status==="aborted"?ve:l.status==="dirty"||r.value==="dirty"?$u(l.value):l});{if(r.value==="aborted")return ve;const s=this._def.schema._parseSync({data:i,path:n.path,parent:n});return s.status==="aborted"?ve:s.status==="dirty"||r.value==="dirty"?$u(s.value):s}}if(a.type==="refinement"){const i=s=>{const l=a.refinement(s,o);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(n.common.async===!1){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?ve:(s.status==="dirty"&&r.dirty(),i(s.value),{status:r.value,value:s.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>s.status==="aborted"?ve:(s.status==="dirty"&&r.dirty(),i(s.value).then(()=>({status:r.value,value:s.value}))))}if(a.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!_a(i))return ve;const s=a.transform(i.value,o);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:s}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>_a(i)?Promise.resolve(a.transform(i.value,o)).then(s=>({status:r.value,value:s})):ve);Ne.assertNever(a)}}ba.create=(t,e,r)=>new ba({schema:t,typeName:Q.ZodEffects,effect:e,...ke(r)}),ba.createWithPreprocess=(t,e,r)=>new ba({schema:e,effect:{type:"preprocess",transform:t},typeName:Q.ZodEffects,...ke(r)});class nn extends Oe{_parse(e){return this._getType(e)===se.undefined?jt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}nn.create=(t,e)=>new nn({innerType:t,typeName:Q.ZodOptional,...ke(e)});class Ea extends Oe{_parse(e){return this._getType(e)===se.null?jt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ea.create=(t,e)=>new Ea({innerType:t,typeName:Q.ZodNullable,...ke(e)});class Hu extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e);let n=r.data;return r.parsedType===se.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Hu.create=(t,e)=>new Hu({innerType:t,typeName:Q.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ke(e)});class Wu extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Es(a)?a.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new jr(n.common.issues)},input:n.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new jr(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Wu.create=(t,e)=>new Wu({innerType:t,typeName:Q.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ke(e)});class U_ extends Oe{_parse(e){if(this._getType(e)!==se.nan){const r=this._getOrReturnCtx(e);return re(r,{code:Y.invalid_type,expected:se.nan,received:r.parsedType}),ve}return{status:"valid",value:e.data}}}U_.create=t=>new U_({typeName:Q.ZodNaN,...ke(t)});class jA extends Oe{_parse(e){const{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class Gu extends Oe{_parse(e){const{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ve:a.status==="dirty"?(r.dirty(),$u(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const a=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ve:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:n.path,parent:n})}}static create(e,r){return new Gu({in:e,out:r,typeName:Q.ZodPipeline})}}class qu extends Oe{_parse(e){const r=this._def.innerType._parse(e),n=a=>(_a(a)&&(a.value=Object.freeze(a.value)),a);return Es(r)?r.then(a=>n(a)):n(r)}unwrap(){return this._def.innerType}}qu.create=(t,e)=>new qu({innerType:t,typeName:Q.ZodReadonly,...ke(e)}),Ve.lazycreate;var Q;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Q||(Q={}));let Vu;Wp=tn.create,Vu=Uu.create,rn.create,wr.create,Hp=Ve.create,Ve.strictCreate,xs.create,ks.create,Cn.create,wa.create,As.create,nn.create,Ea.create;var Co={exports:{}},B_={},Zu,H_;function LA(){if(H_)return Zu;H_=1;function t(e,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Zu=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var r=new Date().getTime();if(e&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,r){this._fn=e,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},r=null,n=0,a=0;a<this._errors.length;a++){var o=this._errors[a],i=o.message,s=(e[i]||0)+1;e[i]=s,s>=n&&(r=o,n=s)}return r},Zu}var W_;function DA(){return W_||(W_=1,function(t){var e=LA();t.operation=function(r){var n=t.timeouts(r);return new e(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},t.timeouts=function(r){if(r instanceof Array)return[].concat(r);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in r)n[a]=r[a];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],i=0;i<n.retries;i++)o.push(this.createTimeout(i,n));return r&&r.forever&&!o.length&&o.push(this.createTimeout(i,n)),o.sort(function(s,l){return s-l}),o},t.createTimeout=function(r,n){var a=n.randomize?Math.random()+1:1,o=Math.round(a*Math.max(n.minTimeout,1)*Math.pow(n.factor,r));return o=Math.min(o,n.maxTimeout),o},t.wrap=function(r,n,a){if(n instanceof Array&&(a=n,n=null),!a){a=[];for(var o in r)typeof r[o]=="function"&&a.push(o)}for(var i=0;i<a.length;i++){var s=a[i],l=r[s];r[s]=(function(c){var u=t.operation(n),d=Array.prototype.slice.call(arguments,1),h=d.pop();d.push(function(p){u.retry(p)||(p&&(arguments[0]=u.mainError()),h.apply(this,arguments))}),u.attempt(function(){c.apply(r,d)})}).bind(r,l),r[s].options=n}}}(B_)),B_}var G_,q_;function $A(){return q_||(q_=1,G_=DA()),G_}var V_;function zA(){if(V_)return Co.exports;V_=1;const t=$A(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class r extends Error{constructor(s){super(),s instanceof Error?(this.originalError=s,{message:s}=s):(this.originalError=new Error(s),this.originalError.stack=this.stack),this.name="AbortError",this.message=s}}const n=(i,s,l)=>{const c=l.retries-(s-1);return i.attemptNumber=s,i.retriesLeft=c,i},a=i=>e.includes(i),o=(i,s)=>new Promise((l,c)=>{s={onFailedAttempt:()=>{},retries:10,...s};const u=t.operation(s);u.attempt(async d=>{try{l(await i(d))}catch(h){if(!(h instanceof Error)){c(new TypeError(`Non-error was thrown: "${h}". You should only throw errors.`));return}if(h instanceof r)u.stop(),c(h.originalError);else if(h instanceof TypeError&&!a(h.message))u.stop(),c(h);else{n(h,d,s);try{await s.onFailedAttempt(h)}catch(p){c(p);return}u.retry(h)||c(u.mainError())}}})});return Co.exports=o,Co.exports.default=o,Co.exports.AbortError=r,Co.exports}var UA=zA();const Ts=Ja(UA),BA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Sa(t){return typeof t=="string"&&BA.test(t)}function HA(t){if(!Sa(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}for(var ct=[],Ju=0;Ju<256;++Ju)ct.push((Ju+256).toString(16).slice(1));function Z_(t,e=0){return(ct[t[e+0]]+ct[t[e+1]]+ct[t[e+2]]+ct[t[e+3]]+"-"+ct[t[e+4]]+ct[t[e+5]]+"-"+ct[t[e+6]]+ct[t[e+7]]+"-"+ct[t[e+8]]+ct[t[e+9]]+"-"+ct[t[e+10]]+ct[t[e+11]]+ct[t[e+12]]+ct[t[e+13]]+ct[t[e+14]]+ct[t[e+15]]).toLowerCase()}var Ms,WA=new Uint8Array(16);function GA(){if(!Ms&&(Ms=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ms))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ms(WA)}function qA(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}var VA="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ZA="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function JA(t,e,r){function n(a,o,i,s){var l;if(typeof a=="string"&&(a=qA(a)),typeof o=="string"&&(o=HA(o)),((l=o)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+a.length);if(c.set(o),c.set(a,o.length),c=r(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,i){s=s||0;for(var u=0;u<16;++u)i[s+u]=c[u];return i}return Z_(c)}try{n.name=t}catch{}return n.DNS=VA,n.URL=ZA,n}var KA=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const J_={randomUUID:KA};function ht(t,e,r){if(J_.randomUUID&&!e&&!t)return J_.randomUUID();t=t||{};var n=t.random||(t.rng||GA)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Z_(n)}function YA(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function Ku(t,e){return t<<e|t>>>32-e}function XA(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var n=unescape(encodeURIComponent(t));t=[];for(var a=0;a<n.length;++a)t.push(n.charCodeAt(a))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,i=Math.ceil(o/16),s=new Array(i),l=0;l<i;++l){for(var c=new Uint32Array(16),u=0;u<16;++u)c[u]=t[l*64+u*4]<<24|t[l*64+u*4+1]<<16|t[l*64+u*4+2]<<8|t[l*64+u*4+3];s[l]=c}s[i-1][14]=(t.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(t.length-1)*8&4294967295;for(var d=0;d<i;++d){for(var h=new Uint32Array(80),p=0;p<16;++p)h[p]=s[d][p];for(var f=16;f<80;++f)h[f]=Ku(h[f-3]^h[f-8]^h[f-14]^h[f-16],1);for(var y=r[0],m=r[1],_=r[2],w=r[3],A=r[4],F=0;F<80;++F){var b=Math.floor(F/20),D=Ku(y,5)+YA(b,m,_,w)+A+e[b]+h[F]>>>0;A=w,w=_,_=Ku(m,30)>>>0,m=y,y=D}r[0]=r[0]+y>>>0,r[1]=r[1]+m>>>0,r[2]=r[2]+_>>>0,r[3]=r[3]+w>>>0,r[4]=r[4]+A>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}var K_=JA("v5",80,XA),Fs={},Y_={exports:{}},X_;function QA(){return X_||(X_=1,function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function o(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new a(u,d||l,h),f=r?r+c:c;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],p]:l._events[f].push(p):(l._events[f]=p,l._eventsCount++),l}function i(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)e.call(c,u)&&l.push(r?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},s.prototype.listeners=function(l){var c=r?r+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,h=u.length,p=new Array(h);d<h;d++)p[d]=u[d].fn;return p},s.prototype.listenerCount=function(l){var c=r?r+l:l,u=this._events[c];return u?u.fn?1:u.length:0},s.prototype.emit=function(l,c,u,d,h,p){var f=r?r+l:l;if(!this._events[f])return!1;var y=this._events[f],m=arguments.length,_,w;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),m){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,u),!0;case 4:return y.fn.call(y.context,c,u,d),!0;case 5:return y.fn.call(y.context,c,u,d,h),!0;case 6:return y.fn.call(y.context,c,u,d,h,p),!0}for(w=1,_=new Array(m-1);w<m;w++)_[w-1]=arguments[w];y.fn.apply(y.context,_)}else{var A=y.length,F;for(w=0;w<A;w++)switch(y[w].once&&this.removeListener(l,y[w].fn,void 0,!0),m){case 1:y[w].fn.call(y[w].context);break;case 2:y[w].fn.call(y[w].context,c);break;case 3:y[w].fn.call(y[w].context,c,u);break;case 4:y[w].fn.call(y[w].context,c,u,d);break;default:if(!_)for(F=1,_=new Array(m-1);F<m;F++)_[F-1]=arguments[F];y[w].fn.apply(y[w].context,_)}}return!0},s.prototype.on=function(l,c,u){return o(this,l,c,u,!1)},s.prototype.once=function(l,c,u){return o(this,l,c,u,!0)},s.prototype.removeListener=function(l,c,u,d){var h=r?r+l:l;if(!this._events[h])return this;if(!c)return i(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&i(this,h);else{for(var f=0,y=[],m=p.length;f<m;f++)(p[f].fn!==c||d&&!p[f].once||u&&p[f].context!==u)&&y.push(p[f]);y.length?this._events[h]=y.length===1?y[0]:y:i(this,h)}return this},s.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&i(this,c)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s}(Y_)),Y_.exports}var jo={exports:{}},Q_,ev;function eT(){return ev||(ev=1,Q_=(t,e)=>(e=e||(()=>{}),t.then(r=>new Promise(n=>{n(e())}).then(()=>r),r=>new Promise(n=>{n(e())}).then(()=>{throw r})))),Q_}var tv;function tT(){if(tv)return jo.exports;tv=1;const t=eT();class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}const r=(n,a,o)=>new Promise((i,s)=>{if(typeof a!="number"||a<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(a===1/0){i(n);return}const l=setTimeout(()=>{if(typeof o=="function"){try{i(o())}catch(d){s(d)}return}const c=typeof o=="string"?o:`Promise timed out after ${a} milliseconds`,u=o instanceof Error?o:new e(c);typeof n.cancel=="function"&&n.cancel(),s(u)},a);t(n.then(i,s),()=>{clearTimeout(l)})});return jo.exports=r,jo.exports.default=r,jo.exports.TimeoutError=e,jo.exports}var Rs={},Os={},rv;function rT(){if(rv)return Os;rv=1,Object.defineProperty(Os,"__esModule",{value:!0});function t(e,r,n){let a=0,o=e.length;for(;o>0;){const i=o/2|0;let s=a+i;n(e[s],r)<=0?(a=++s,o-=i+1):o=i}return a}return Os.default=t,Os}var nv;function nT(){if(nv)return Rs;nv=1,Object.defineProperty(Rs,"__esModule",{value:!0});const t=rT();class e{constructor(){this._queue=[]}enqueue(n,a){a=Object.assign({priority:0},a);const o={priority:a.priority,run:n};if(this.size&&this._queue[this.size-1].priority>=a.priority){this._queue.push(o);return}const i=t.default(this._queue,o,(s,l)=>l.priority-s.priority);this._queue.splice(i,0,o)}dequeue(){const n=this._queue.shift();return n==null?void 0:n.run}filter(n){return this._queue.filter(a=>a.priority===n.priority).map(a=>a.run)}get size(){return this._queue.length}}return Rs.default=e,Rs}var av;function aT(){if(av)return Fs;av=1,Object.defineProperty(Fs,"__esModule",{value:!0});const t=QA(),e=tT(),r=nT(),n=()=>{},a=new e.TimeoutError;class o extends t{constructor(s){var l,c,u,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,s=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:r.default},s),!(typeof s.intervalCap=="number"&&s.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(l=s.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""}\` (${typeof s.intervalCap})`);if(s.interval===void 0||!(Number.isFinite(s.interval)&&s.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(u=s.interval)===null||u===void 0?void 0:u.toString())!==null&&d!==void 0?d:""}\` (${typeof s.interval})`);this._carryoverConcurrencyCount=s.carryoverConcurrencyCount,this._isIntervalIgnored=s.intervalCap===1/0||s.interval===0,this._intervalCap=s.intervalCap,this._interval=s.interval,this._queue=new s.queueClass,this._queueClass=s.queueClass,this.concurrency=s.concurrency,this._timeout=s.timeout,this._throwOnTimeout=s.throwOnTimeout===!0,this._isPaused=s.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const s=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-s;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const s=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),s&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(s){if(!(typeof s=="number"&&s>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${s}\` (${typeof s})`);this._concurrency=s,this._processQueue()}async add(s,l={}){return new Promise((c,u)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const h=this._timeout===void 0&&l.timeout===void 0?s():e.default(Promise.resolve(s()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&u(a)});c(await h)}catch(h){u(h)}this._next()};this._queue.enqueue(d,l),this._tryToStartAnother(),this.emit("add")})}async addAll(s,l){return Promise.all(s.map(async c=>this.add(c,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(s=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),s()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(s=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),s()}})}get size(){return this._queue.size}sizeBy(s){return this._queue.filter(s).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(s){this._timeout=s}}return Fs.default=o,Fs}var oT=aT();const Lr=Ja(oT);function iT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ov={exports:{}},Ye=ov.exports={},br,Er;function Yu(){throw new Error("setTimeout has not been defined")}function Xu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?br=setTimeout:br=Yu}catch{br=Yu}try{typeof clearTimeout=="function"?Er=clearTimeout:Er=Xu}catch{Er=Xu}})();function iv(t){if(br===setTimeout)return setTimeout(t,0);if((br===Yu||!br)&&setTimeout)return br=setTimeout,setTimeout(t,0);try{return br(t,0)}catch{try{return br.call(null,t,0)}catch{return br.call(this,t,0)}}}function sT(t){if(Er===clearTimeout)return clearTimeout(t);if((Er===Xu||!Er)&&clearTimeout)return Er=clearTimeout,clearTimeout(t);try{return Er(t)}catch{try{return Er.call(null,t)}catch{return Er.call(this,t)}}}var Dr=[],xa=!1,jn,Ns=-1;function lT(){!xa||!jn||(xa=!1,jn.length?Dr=jn.concat(Dr):Ns=-1,Dr.length&&sv())}function sv(){if(!xa){var t=iv(lT);xa=!0;for(var e=Dr.length;e;){for(jn=Dr,Dr=[];++Ns<e;)jn&&jn[Ns].run();Ns=-1,e=Dr.length}jn=null,xa=!1,sT(t)}}Ye.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];Dr.push(new lv(t,e)),Dr.length===1&&!xa&&iv(sv)};function lv(t,e){this.fun=t,this.array=e}lv.prototype.run=function(){this.fun.apply(null,this.array)},Ye.title="browser",Ye.browser=!0,Ye.env={},Ye.argv=[],Ye.version="",Ye.versions={};function $r(){}Ye.on=$r,Ye.addListener=$r,Ye.once=$r,Ye.off=$r,Ye.removeListener=$r,Ye.removeAllListeners=$r,Ye.emit=$r,Ye.prependListener=$r,Ye.prependOnceListener=$r,Ye.listeners=function(t){return[]},Ye.binding=function(t){throw new Error("process.binding is not supported")},Ye.cwd=function(){return"/"},Ye.chdir=function(t){throw new Error("process.chdir is not supported")},Ye.umask=function(){return 0};var cT=ov.exports;let Qu,ed;yt=iT(cT),Qu=()=>Xt("PROJECT")??on("LANGCHAIN_SESSION")??"default",ed="0.3.34";var Lo={};let an;const uT=()=>typeof window<"u"&&typeof window.document<"u",dT=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",hT=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),cv=()=>typeof Deno<"u",pT=()=>typeof yt<"u"&&typeof yt.versions<"u"&&typeof yt.versions.node<"u"&&!cv(),fT=()=>an||(uT()?an="browser":pT()?an="node":dT()?an="webworker":hT()?an="jsdom":cv()?an="deno":an="other",an);let td;function uv(){if(td===void 0){const t=fT(),e=yT();td={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:ed,...e}}return td}function mT(){const t=gT()||{},e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[n,a]of Object.entries(t))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof a=="string"&&!r.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[n]=a);return e}function gT(){try{return typeof yt<"u"&&Lo?Object.entries(Lo).reduce((t,[e,r])=>(t[e]=String(r),t),{}):void 0}catch{return}}function on(t){try{return typeof yt<"u"?Lo==null?void 0:Lo[t]:void 0}catch{return}}function Xt(t){return on(`LANGSMITH_${t}`)||on(`LANGCHAIN_${t}`)}let rd;function yT(){if(rd!==void 0)return rd;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const r of t){const n=on(r);n!==void 0&&(e[r]=n)}return rd=e,e}const _T=(...t)=>fetch(...t),dv=Symbol.for("ls:fetch_implementation"),vT=()=>{const t=globalThis[dv];return t?typeof t=="function"&&"Headers"in t&&"Request"in t&&"Response"in t:!1},he=t=>async(...e)=>{if(t||Xt("DEBUG")==="true"){const[n,a]=e;console.log(`\u2192 ${(a==null?void 0:a.method)||"GET"} ${n}`)}const r=await(globalThis[dv]??_T)(...e);return(t||Xt("DEBUG")==="true")&&console.log(`\u2190 ${r.status} ${r.statusText} ${r.url}`),r},wT=[400,401,403,404,405,406,407,408],bT=[409];let hv=class{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.debug=t.debug,"default"in Lr?this.queue=new Lr.default({concurrency:this.maxConcurrency}):this.queue=new Lr({concurrency:this.maxConcurrency}),this.onFailedResponseHook=t==null?void 0:t.onFailedResponseHook}call(t,...e){const r=this.onFailedResponseHook;return this.queue.add(()=>Ts(()=>t(...e).catch(n=>{throw n instanceof Error?n:new Error(n)}),{async onFailedAttempt(n){if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.message.startsWith("AbortError")||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const a=n==null?void 0:n.response,o=a==null?void 0:a.status;if(o){if(wT.includes(+o))throw n;if(bT.includes(+o))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){return t.signal?Promise.race([this.call(e,...r),new Promise((n,a)=>{var o;(o=t.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(e,...r)}fetch(...t){return this.call(()=>he(this.debug)(...t).then(e=>e.ok?e:Promise.reject(e)))}};function pv(t){return typeof(t==null?void 0:t._getType)=="function"}function fv(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}function Ee(t,e){if(!Sa(t)){const r=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(r)}return t}const mv={};function gv(t){mv[t]||(console.warn(t),mv[t]=!0)}var nd={exports:{}},ad,yv;function Is(){if(yv)return ad;yv=1;const t="2.0.0",e=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return ad={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:r,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:t,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ad}var od,_v;function Ps(){if(_v)return od;_v=1;var t={};return od=typeof yt=="object"&&t&&t.NODE_DEBUG&&/\bsemver\b/i.test(t.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},od}var vv;function Do(){return vv||(vv=1,function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=Is(),o=Ps();e=t.exports={};const i=e.re=[],s=e.safeRe=[],l=e.src=[],c=e.t={};let u=0;const d="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[d,n]],p=y=>{for(const[m,_]of h)y=y.split(`${m}*`).join(`${m}{0,${_}}`).split(`${m}+`).join(`${m}{1,${_}}`);return y},f=(y,m,_)=>{const w=p(m),A=u++;o(y,A,m),c[y]=A,l[A]=m,i[A]=new RegExp(m,_?"g":void 0),s[A]=new RegExp(w,_?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),f("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),f("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${d}+`),f("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),f("FULL",`^${l[c.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),f("LOOSE",`^${l[c.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),f("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),f("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),f("COERCERTL",l[c.COERCE],!0),f("COERCERTLFULL",l[c.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",f("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",f("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(nd,nd.exports)),nd.exports}var id,wv;function sd(){if(wv)return id;wv=1;const t=Object.freeze({loose:!0}),e=Object.freeze({});return id=r=>r?typeof r!="object"?t:r:e,id}var ld,bv;function Ev(){if(bv)return ld;bv=1;const t=/^[0-9]+$/,e=(r,n)=>{const a=t.test(r),o=t.test(n);return a&&o&&(r=+r,n=+n),r===n?0:a&&!o?-1:o&&!a?1:r<n?-1:1};return ld={compareIdentifiers:e,rcompareIdentifiers:(r,n)=>e(n,r)},ld}var cd,Sv;function pt(){if(Sv)return cd;Sv=1;const t=Ps(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:r}=Is(),{safeRe:n,t:a}=Do(),o=sd(),{compareIdentifiers:i}=Ev();class s{constructor(c,u){if(u=o(u),c instanceof s){if(c.loose===!!u.loose&&c.includePrerelease===!!u.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);t("SemVer",c,u),this.options=u,this.loose=!!u.loose,this.includePrerelease=!!u.includePrerelease;const d=c.trim().match(u.loose?n[a.LOOSE]:n[a.FULL]);if(!d)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+d[1],this.minor=+d[2],this.patch=+d[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");d[4]?this.prerelease=d[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const p=+h;if(p>=0&&p<r)return p}return h}):this.prerelease=[],this.build=d[5]?d[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(t("SemVer.compare",this.version,this.options,c),!(c instanceof s)){if(typeof c=="string"&&c===this.version)return 0;c=new s(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof s||(c=new s(c,this.options)),i(this.major,c.major)||i(this.minor,c.minor)||i(this.patch,c.patch)}comparePre(c){if(c instanceof s||(c=new s(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let u=0;do{const d=this.prerelease[u],h=c.prerelease[u];if(t("prerelease compare",u,d,h),d===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(d===void 0)return-1;if(d!==h)return i(d,h)}while(++u)}compareBuild(c){c instanceof s||(c=new s(c,this.options));let u=0;do{const d=this.build[u],h=c.build[u];if(t("build compare",u,d,h),d===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(d===void 0)return-1;if(d!==h)return i(d,h)}while(++u)}inc(c,u,d){switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",u,d);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",u,d);break;case"prepatch":this.prerelease.length=0,this.inc("patch",u,d),this.inc("pre",u,d);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",u,d),this.inc("pre",u,d);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(d)?1:0;if(!u&&d===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[h];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(u===this.prerelease.join(".")&&d===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(u){let p=[u,h];d===!1&&(p=[u]),i(this.prerelease[0],u)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return cd=s,cd}var ud,xv;function ka(){if(xv)return ud;xv=1;const t=pt();return ud=(e,r,n=!1)=>{if(e instanceof t)return e;try{return new t(e,r)}catch(a){if(!n)return null;throw a}},ud}var dd,kv;function ET(){if(kv)return dd;kv=1;const t=ka();return dd=(e,r)=>{const n=t(e,r);return n?n.version:null},dd}var hd,Av;function ST(){if(Av)return hd;Av=1;const t=ka();return hd=(e,r)=>{const n=t(e.trim().replace(/^[=v]+/,""),r);return n?n.version:null},hd}var pd,Tv;function xT(){if(Tv)return pd;Tv=1;const t=pt();return pd=(e,r,n,a,o)=>{typeof n=="string"&&(o=a,a=n,n=void 0);try{return new t(e instanceof t?e.version:e,n).inc(r,a,o).version}catch{return null}},pd}var fd,Mv;function kT(){if(Mv)return fd;Mv=1;const t=ka();return fd=(e,r)=>{const n=t(e,null,!0),a=t(r,null,!0),o=n.compare(a);if(o===0)return null;const i=o>0,s=i?n:a,l=i?a:n,c=!!s.prerelease.length;if(l.prerelease.length&&!c)return!l.patch&&!l.minor?"major":s.patch?"patch":s.minor?"minor":"major";const u=c?"pre":"";return n.major!==a.major?u+"major":n.minor!==a.minor?u+"minor":n.patch!==a.patch?u+"patch":"prerelease"},fd}var md,Fv;function AT(){if(Fv)return md;Fv=1;const t=pt();return md=(e,r)=>new t(e,r).major,md}var gd,Rv;function TT(){if(Rv)return gd;Rv=1;const t=pt();return gd=(e,r)=>new t(e,r).minor,gd}var yd,Ov;function MT(){if(Ov)return yd;Ov=1;const t=pt();return yd=(e,r)=>new t(e,r).patch,yd}var _d,Nv;function FT(){if(Nv)return _d;Nv=1;const t=ka();return _d=(e,r)=>{const n=t(e,r);return n&&n.prerelease.length?n.prerelease:null},_d}var vd,Iv;function Qt(){if(Iv)return vd;Iv=1;const t=pt();return vd=(e,r,n)=>new t(e,n).compare(new t(r,n)),vd}var wd,Pv;function RT(){if(Pv)return wd;Pv=1;const t=Qt();return wd=(e,r,n)=>t(r,e,n),wd}var bd,Cv;function OT(){if(Cv)return bd;Cv=1;const t=Qt();return bd=(e,r)=>t(e,r,!0),bd}var Ed,jv;function Sd(){if(jv)return Ed;jv=1;const t=pt();return Ed=(e,r,n)=>{const a=new t(e,n),o=new t(r,n);return a.compare(o)||a.compareBuild(o)},Ed}var xd,Lv;function NT(){if(Lv)return xd;Lv=1;const t=Sd();return xd=(e,r)=>e.sort((n,a)=>t(n,a,r)),xd}var kd,Dv;function IT(){if(Dv)return kd;Dv=1;const t=Sd();return kd=(e,r)=>e.sort((n,a)=>t(a,n,r)),kd}var Ad,$v;function Cs(){if($v)return Ad;$v=1;const t=Qt();return Ad=(e,r,n)=>t(e,r,n)>0,Ad}var Td,zv;function Md(){if(zv)return Td;zv=1;const t=Qt();return Td=(e,r,n)=>t(e,r,n)<0,Td}var Fd,Uv;function Bv(){if(Uv)return Fd;Uv=1;const t=Qt();return Fd=(e,r,n)=>t(e,r,n)===0,Fd}var Rd,Hv;function Wv(){if(Hv)return Rd;Hv=1;const t=Qt();return Rd=(e,r,n)=>t(e,r,n)!==0,Rd}var Od,Gv;function Nd(){if(Gv)return Od;Gv=1;const t=Qt();return Od=(e,r,n)=>t(e,r,n)>=0,Od}var Id,qv;function Pd(){if(qv)return Id;qv=1;const t=Qt();return Id=(e,r,n)=>t(e,r,n)<=0,Id}var Cd,Vv;function Zv(){if(Vv)return Cd;Vv=1;const t=Bv(),e=Wv(),r=Cs(),n=Nd(),a=Md(),o=Pd();return Cd=(i,s,l,c)=>{switch(s){case"===":return typeof i=="object"&&(i=i.version),typeof l=="object"&&(l=l.version),i===l;case"!==":return typeof i=="object"&&(i=i.version),typeof l=="object"&&(l=l.version),i!==l;case"":case"=":case"==":return t(i,l,c);case"!=":return e(i,l,c);case">":return r(i,l,c);case">=":return n(i,l,c);case"<":return a(i,l,c);case"<=":return o(i,l,c);default:throw new TypeError(`Invalid operator: ${s}`)}},Cd}var jd,Jv;function PT(){if(Jv)return jd;Jv=1;const t=pt(),e=ka(),{safeRe:r,t:n}=Do();return jd=(a,o)=>{if(a instanceof t)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;o=o||{};let i=null;if(!o.rtl)i=a.match(o.includePrerelease?r[n.COERCEFULL]:r[n.COERCE]);else{const h=o.includePrerelease?r[n.COERCERTLFULL]:r[n.COERCERTL];let p;for(;(p=h.exec(a))&&(!i||i.index+i[0].length!==a.length);)(!i||p.index+p[0].length!==i.index+i[0].length)&&(i=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(i===null)return null;const s=i[2],l=i[3]||"0",c=i[4]||"0",u=o.includePrerelease&&i[5]?`-${i[5]}`:"",d=o.includePrerelease&&i[6]?`+${i[6]}`:"";return e(`${s}.${l}.${c}${u}${d}`,o)},jd}var Ld,Kv;function CT(){if(Kv)return Ld;Kv=1;class t{constructor(){this.max=1e3,this.map=new Map}get(r){const n=this.map.get(r);if(n!==void 0)return this.map.delete(r),this.map.set(r,n),n}delete(r){return this.map.delete(r)}set(r,n){if(!this.delete(r)&&n!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(r,n)}return this}}return Ld=t,Ld}var Dd,Yv;function er(){if(Yv)return Dd;Yv=1;const t=/\s+/g;class e{constructor(E,H){if(H=a(H),E instanceof e)return E.loose===!!H.loose&&E.includePrerelease===!!H.includePrerelease?E:new e(E.raw,H);if(E instanceof o)return this.raw=E.value,this.set=[[E]],this.formatted=void 0,this;if(this.options=H,this.loose=!!H.loose,this.includePrerelease=!!H.includePrerelease,this.raw=E.trim().replace(t," "),this.set=this.raw.split("||").map(N=>this.parseRange(N.trim())).filter(N=>N.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const N=this.set[0];if(this.set=this.set.filter(C=>!y(C[0])),this.set.length===0)this.set=[N];else if(this.set.length>1){for(const C of this.set)if(C.length===1&&m(C[0])){this.set=[C];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let E=0;E<this.set.length;E++){E>0&&(this.formatted+="||");const H=this.set[E];for(let N=0;N<H.length;N++)N>0&&(this.formatted+=" "),this.formatted+=H[N].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(E){const H=((this.options.includePrerelease&&p)|(this.options.loose&&f))+":"+E,N=n.get(H);if(N)return N;const C=this.options.loose,P=C?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];E=E.replace(P,x(this.options.includePrerelease)),i("hyphen replace",E),E=E.replace(l[c.COMPARATORTRIM],u),i("comparator trim",E),E=E.replace(l[c.TILDETRIM],d),i("tilde trim",E),E=E.replace(l[c.CARETTRIM],h),i("caret trim",E);let Z=E.split(" ").map(we=>w(we,this.options)).join(" ").split(/\s+/).map(we=>de(we,this.options));C&&(Z=Z.filter(we=>(i("loose invalid filter",we,this.options),!!we.match(l[c.COMPARATORLOOSE])))),i("range list",Z);const ne=new Map,le=Z.map(we=>new o(we,this.options));for(const we of le){if(y(we))return[we];ne.set(we.value,we)}ne.size>1&&ne.has("")&&ne.delete("");const ye=[...ne.values()];return n.set(H,ye),ye}intersects(E,H){if(!(E instanceof e))throw new TypeError("a Range is required");return this.set.some(N=>_(N,H)&&E.set.some(C=>_(C,H)&&N.every(P=>C.every(Z=>P.intersects(Z,H)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new s(E,this.options)}catch{return!1}for(let H=0;H<this.set.length;H++)if(R(this.set[H],E,this.options))return!0;return!1}}Dd=e;const r=CT(),n=new r,a=sd(),o=js(),i=Ps(),s=pt(),{safeRe:l,t:c,comparatorTrimReplace:u,tildeTrimReplace:d,caretTrimReplace:h}=Do(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:f}=Is(),y=k=>k.value==="<0.0.0-0",m=k=>k.value==="",_=(k,E)=>{let H=!0;const N=k.slice();let C=N.pop();for(;H&&N.length;)H=N.every(P=>C.intersects(P,E)),C=N.pop();return H},w=(k,E)=>(i("comp",k,E),k=D(k,E),i("caret",k),k=F(k,E),i("tildes",k),k=j(k,E),i("xrange",k),k=te(k,E),i("stars",k),k),A=k=>!k||k.toLowerCase()==="x"||k==="*",F=(k,E)=>k.trim().split(/\s+/).map(H=>b(H,E)).join(" "),b=(k,E)=>{const H=E.loose?l[c.TILDELOOSE]:l[c.TILDE];return k.replace(H,(N,C,P,Z,ne)=>{i("tilde",k,N,C,P,Z,ne);let le;return A(C)?le="":A(P)?le=`>=${C}.0.0 <${+C+1}.0.0-0`:A(Z)?le=`>=${C}.${P}.0 <${C}.${+P+1}.0-0`:ne?(i("replaceTilde pr",ne),le=`>=${C}.${P}.${Z}-${ne} <${C}.${+P+1}.0-0`):le=`>=${C}.${P}.${Z} <${C}.${+P+1}.0-0`,i("tilde return",le),le})},D=(k,E)=>k.trim().split(/\s+/).map(H=>B(H,E)).join(" "),B=(k,E)=>{i("caret",k,E);const H=E.loose?l[c.CARETLOOSE]:l[c.CARET],N=E.includePrerelease?"-0":"";return k.replace(H,(C,P,Z,ne,le)=>{i("caret",k,C,P,Z,ne,le);let ye;return A(P)?ye="":A(Z)?ye=`>=${P}.0.0${N} <${+P+1}.0.0-0`:A(ne)?P==="0"?ye=`>=${P}.${Z}.0${N} <${P}.${+Z+1}.0-0`:ye=`>=${P}.${Z}.0${N} <${+P+1}.0.0-0`:le?(i("replaceCaret pr",le),P==="0"?Z==="0"?ye=`>=${P}.${Z}.${ne}-${le} <${P}.${Z}.${+ne+1}-0`:ye=`>=${P}.${Z}.${ne}-${le} <${P}.${+Z+1}.0-0`:ye=`>=${P}.${Z}.${ne}-${le} <${+P+1}.0.0-0`):(i("no pr"),P==="0"?Z==="0"?ye=`>=${P}.${Z}.${ne}${N} <${P}.${Z}.${+ne+1}-0`:ye=`>=${P}.${Z}.${ne}${N} <${P}.${+Z+1}.0-0`:ye=`>=${P}.${Z}.${ne} <${+P+1}.0.0-0`),i("caret return",ye),ye})},j=(k,E)=>(i("replaceXRanges",k,E),k.split(/\s+/).map(H=>G(H,E)).join(" ")),G=(k,E)=>{k=k.trim();const H=E.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return k.replace(H,(N,C,P,Z,ne,le)=>{i("xRange",k,N,C,P,Z,ne,le);const ye=A(P),we=ye||A(Z),De=we||A(ne),Xe=De;return C==="="&&Xe&&(C=""),le=E.includePrerelease?"-0":"",ye?C===">"||C==="<"?N="<0.0.0-0":N="*":C&&Xe?(we&&(Z=0),ne=0,C===">"?(C=">=",we?(P=+P+1,Z=0,ne=0):(Z=+Z+1,ne=0)):C==="<="&&(C="<",we?P=+P+1:Z=+Z+1),C==="<"&&(le="-0"),N=`${C+P}.${Z}.${ne}${le}`):we?N=`>=${P}.0.0${le} <${+P+1}.0.0-0`:De&&(N=`>=${P}.${Z}.0${le} <${P}.${+Z+1}.0-0`),i("xRange return",N),N})},te=(k,E)=>(i("replaceStars",k,E),k.trim().replace(l[c.STAR],"")),de=(k,E)=>(i("replaceGTE0",k,E),k.trim().replace(l[E.includePrerelease?c.GTE0PRE:c.GTE0],"")),x=k=>(E,H,N,C,P,Z,ne,le,ye,we,De,Xe)=>(A(N)?H="":A(C)?H=`>=${N}.0.0${k?"-0":""}`:A(P)?H=`>=${N}.${C}.0${k?"-0":""}`:Z?H=`>=${H}`:H=`>=${H}${k?"-0":""}`,A(ye)?le="":A(we)?le=`<${+ye+1}.0.0-0`:A(De)?le=`<${ye}.${+we+1}.0-0`:Xe?le=`<=${ye}.${we}.${De}-${Xe}`:k?le=`<${ye}.${we}.${+De+1}-0`:le=`<=${le}`,`${H} ${le}`.trim()),R=(k,E,H)=>{for(let N=0;N<k.length;N++)if(!k[N].test(E))return!1;if(E.prerelease.length&&!H.includePrerelease){for(let N=0;N<k.length;N++)if(i(k[N].semver),k[N].semver!==o.ANY&&k[N].semver.prerelease.length>0){const C=k[N].semver;if(C.major===E.major&&C.minor===E.minor&&C.patch===E.patch)return!0}return!1}return!0};return Dd}var $d,Xv;function js(){if(Xv)return $d;Xv=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(u,d){if(d=r(d),u instanceof e){if(u.loose===!!d.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),i("comparator",u,d),this.options=d,this.loose=!!d.loose,this.parse(u),this.semver===t?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(u){const d=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],h=u.match(d);if(!h)throw new TypeError(`Invalid comparator: ${u}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new s(h[2],this.options.loose):this.semver=t}toString(){return this.value}test(u){if(i("Comparator.test",u,this.options.loose),this.semver===t||u===t)return!0;if(typeof u=="string")try{u=new s(u,this.options)}catch{return!1}return o(u,this.operator,this.semver,this.options)}intersects(u,d){if(!(u instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(u.value,d).test(this.value):u.operator===""?u.value===""?!0:new l(this.value,d).test(u.semver):(d=r(d),d.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||o(this.semver,"<",u.semver,d)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||o(this.semver,">",u.semver,d)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}$d=e;const r=sd(),{safeRe:n,t:a}=Do(),o=Zv(),i=Ps(),s=pt(),l=er();return $d}var zd,Qv;function Ls(){if(Qv)return zd;Qv=1;const t=er();return zd=(e,r,n)=>{try{r=new t(r,n)}catch{return!1}return r.test(e)},zd}var Ud,ew;function jT(){if(ew)return Ud;ew=1;const t=er();return Ud=(e,r)=>new t(e,r).set.map(n=>n.map(a=>a.value).join(" ").trim().split(" ")),Ud}var Bd,tw;function LT(){if(tw)return Bd;tw=1;const t=pt(),e=er();return Bd=(r,n,a)=>{let o=null,i=null,s=null;try{s=new e(n,a)}catch{return null}return r.forEach(l=>{s.test(l)&&(!o||i.compare(l)===-1)&&(o=l,i=new t(o,a))}),o},Bd}var Hd,rw;function DT(){if(rw)return Hd;rw=1;const t=pt(),e=er();return Hd=(r,n,a)=>{let o=null,i=null,s=null;try{s=new e(n,a)}catch{return null}return r.forEach(l=>{s.test(l)&&(!o||i.compare(l)===1)&&(o=l,i=new t(o,a))}),o},Hd}var Wd,nw;function $T(){if(nw)return Wd;nw=1;const t=pt(),e=er(),r=Cs();return Wd=(n,a)=>{n=new e(n,a);let o=new t("0.0.0");if(n.test(o)||(o=new t("0.0.0-0"),n.test(o)))return o;o=null;for(let i=0;i<n.set.length;++i){const s=n.set[i];let l=null;s.forEach(c=>{const u=new t(c.semver.version);switch(c.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!l||r(u,l))&&(l=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),l&&(!o||r(o,l))&&(o=l)}return o&&n.test(o)?o:null},Wd}var Gd,aw;function zT(){if(aw)return Gd;aw=1;const t=er();return Gd=(e,r)=>{try{return new t(e,r).range||"*"}catch{return null}},Gd}var qd,ow;function Vd(){if(ow)return qd;ow=1;const t=pt(),e=js(),{ANY:r}=e,n=er(),a=Ls(),o=Cs(),i=Md(),s=Pd(),l=Nd();return qd=(c,u,d,h)=>{c=new t(c,h),u=new n(u,h);let p,f,y,m,_;switch(d){case">":p=o,f=s,y=i,m=">",_=">=";break;case"<":p=i,f=l,y=o,m="<",_="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(c,u,h))return!1;for(let w=0;w<u.set.length;++w){const A=u.set[w];let F=null,b=null;if(A.forEach(D=>{D.semver===r&&(D=new e(">=0.0.0")),F=F||D,b=b||D,p(D.semver,F.semver,h)?F=D:y(D.semver,b.semver,h)&&(b=D)}),F.operator===m||F.operator===_||(!b.operator||b.operator===m)&&f(c,b.semver)||b.operator===_&&y(c,b.semver))return!1}return!0},qd}var Zd,iw;function UT(){if(iw)return Zd;iw=1;const t=Vd();return Zd=(e,r,n)=>t(e,r,">",n),Zd}var Jd,sw;function BT(){if(sw)return Jd;sw=1;const t=Vd();return Jd=(e,r,n)=>t(e,r,"<",n),Jd}var Kd,lw;function HT(){if(lw)return Kd;lw=1;const t=er();return Kd=(e,r,n)=>(e=new t(e,n),r=new t(r,n),e.intersects(r,n)),Kd}var Yd,cw;function WT(){if(cw)return Yd;cw=1;const t=Ls(),e=Qt();return Yd=(r,n,a)=>{const o=[];let i=null,s=null;const l=r.sort((h,p)=>e(h,p,a));for(const h of l)t(h,n,a)?(s=h,i||(i=h)):(s&&o.push([i,s]),s=null,i=null);i&&o.push([i,null]);const c=[];for(const[h,p]of o)h===p?c.push(h):!p&&h===l[0]?c.push("*"):p?h===l[0]?c.push(`<=${p}`):c.push(`${h} - ${p}`):c.push(`>=${h}`);const u=c.join(" || "),d=typeof n.raw=="string"?n.raw:String(n);return u.length<d.length?u:n},Yd}var Xd,uw;function GT(){if(uw)return Xd;uw=1;const t=er(),e=js(),{ANY:r}=e,n=Ls(),a=Qt(),o=(d,h,p={})=>{if(d===h)return!0;d=new t(d,p),h=new t(h,p);let f=!1;e:for(const y of d.set){for(const m of h.set){const _=l(y,m,p);if(f=f||_!==null,_)continue e}if(f)return!1}return!0},i=[new e(">=0.0.0-0")],s=[new e(">=0.0.0")],l=(d,h,p)=>{if(d===h)return!0;if(d.length===1&&d[0].semver===r){if(h.length===1&&h[0].semver===r)return!0;p.includePrerelease?d=i:d=s}if(h.length===1&&h[0].semver===r){if(p.includePrerelease)return!0;h=s}const f=new Set;let y,m;for(const j of d)j.operator===">"||j.operator===">="?y=c(y,j,p):j.operator==="<"||j.operator==="<="?m=u(m,j,p):f.add(j.semver);if(f.size>1)return null;let _;if(y&&m&&(_=a(y.semver,m.semver,p),_>0||_===0&&(y.operator!==">="||m.operator!=="<=")))return null;for(const j of f){if(y&&!n(j,String(y),p)||m&&!n(j,String(m),p))return null;for(const G of h)if(!n(j,String(G),p))return!1;return!0}let w,A,F,b,D=m&&!p.includePrerelease&&m.semver.prerelease.length?m.semver:!1,B=y&&!p.includePrerelease&&y.semver.prerelease.length?y.semver:!1;D&&D.prerelease.length===1&&m.operator==="<"&&D.prerelease[0]===0&&(D=!1);for(const j of h){if(b=b||j.operator===">"||j.operator===">=",F=F||j.operator==="<"||j.operator==="<=",y){if(B&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===B.major&&j.semver.minor===B.minor&&j.semver.patch===B.patch&&(B=!1),j.operator===">"||j.operator===">="){if(w=c(y,j,p),w===j&&w!==y)return!1}else if(y.operator===">="&&!n(y.semver,String(j),p))return!1}if(m){if(D&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===D.major&&j.semver.minor===D.minor&&j.semver.patch===D.patch&&(D=!1),j.operator==="<"||j.operator==="<="){if(A=u(m,j,p),A===j&&A!==m)return!1}else if(m.operator==="<="&&!n(m.semver,String(j),p))return!1}if(!j.operator&&(m||y)&&_!==0)return!1}return!(y&&F&&!m&&_!==0||m&&b&&!y&&_!==0||B||D)},c=(d,h,p)=>{if(!d)return h;const f=a(d.semver,h.semver,p);return f>0?d:f<0||h.operator===">"&&d.operator===">="?h:d},u=(d,h,p)=>{if(!d)return h;const f=a(d.semver,h.semver,p);return f<0?d:f>0||h.operator==="<"&&d.operator==="<="?h:d};return Xd=o,Xd}var Qd,dw;function qT(){if(dw)return Qd;dw=1;const t=Do(),e=Is(),r=pt(),n=Ev(),a=ka(),o=ET(),i=ST(),s=xT(),l=kT(),c=AT(),u=TT(),d=MT(),h=FT(),p=Qt(),f=RT(),y=OT(),m=Sd(),_=NT(),w=IT(),A=Cs(),F=Md(),b=Bv(),D=Wv(),B=Nd(),j=Pd(),G=Zv(),te=PT(),de=js(),x=er(),R=Ls(),k=jT(),E=LT(),H=DT(),N=$T(),C=zT(),P=Vd(),Z=UT(),ne=BT(),le=HT(),ye=WT(),we=GT();return Qd={parse:a,valid:o,clean:i,inc:s,diff:l,major:c,minor:u,patch:d,prerelease:h,compare:p,rcompare:f,compareLoose:y,compareBuild:m,sort:_,rsort:w,gt:A,lt:F,eq:b,neq:D,gte:B,lte:j,cmp:G,coerce:te,Comparator:de,Range:x,satisfies:R,toComparators:k,maxSatisfying:E,minSatisfying:H,minVersion:N,validRange:C,outside:P,gtr:Z,ltr:ne,intersects:le,simplifyRange:ye,subset:we,SemVer:r,re:t.re,src:t.src,tokens:t.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},Qd}qT();function sn(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,r]=t.split(":"),n=r||"latest";if(e.includes("/")){const[a,o]=e.split("/",2);if(!a||!o)throw new Error(`Invalid identifier format: ${t}`);return[a,o,n]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,n]}}class VT extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Se(t,e,r){let n;if(t.ok){r&&(n=await t.text());return}n=await t.text();const a=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${n}`;if(t.status===409)throw new VT(a);const o=new Error(a);throw o.status=t.status,o}var hw="[...]",ZT={result:"[Circular]"},Ds=[],Aa=[];const JT=new TextEncoder;function KT(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function $s(t){return JT.encode(t)}function Tt(t,e,r,n,a){var o;try{const i=JSON.stringify(t,r,n);return $s(i)}catch(i){if(!((o=i.message)!=null&&o.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),$s("[Unserializable]");Xt("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof a>"u"&&(a=KT()),th(t,"",0,[],void 0,0,a);let s;try{Aa.length===0?s=JSON.stringify(t,r,n):s=JSON.stringify(t,YT(r),n)}catch{return $s("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Ds.length!==0;){const l=Ds.pop();l.length===4?Object.defineProperty(l[0],l[1],l[3]):l[0][l[1]]=l[2]}}return $s(s)}}function eh(t,e,r,n){var a=Object.getOwnPropertyDescriptor(n,r);a.get!==void 0?a.configurable?(Object.defineProperty(n,r,{value:t}),Ds.push([n,r,e,a])):Aa.push([e,r,t]):(n[r]=t,Ds.push([n,r,e]))}function th(t,e,r,n,a,o,i){o+=1;var s;if(typeof t=="object"&&t!==null){for(s=0;s<n.length;s++)if(n[s]===t){eh(ZT,t,e,a);return}if(typeof i.depthLimit<"u"&&o>i.depthLimit){eh(hw,t,e,a);return}if(typeof i.edgesLimit<"u"&&r+1>i.edgesLimit){eh(hw,t,e,a);return}if(n.push(t),Array.isArray(t))for(s=0;s<t.length;s++)th(t[s],s,s,n,t,o,i);else{var l=Object.keys(t);for(s=0;s<l.length;s++){var c=l[s];th(t[c],c,s,n,t,o,i)}}n.pop()}}function YT(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(Aa.length>0)for(var n=0;n<Aa.length;n++){var a=Aa[n];if(a[1]===e&&a[0]===r){r=a[2],Aa.splice(n,1);break}}return t.call(this,e,r)}}function pw(t){const e=uv(),r=mT(),n=t.extra??{},a=n.metadata;return t.extra={...n,runtime:{...e,...n==null?void 0:n.runtime},metadata:{...r,...r.revision_id||t.revision_id?{revision_id:t.revision_id??r.revision_id}:{},...a}},t}const XT=t=>{const e=(t==null?void 0:t.toString())??Xt("TRACING_SAMPLING_RATE");if(e===void 0)return;const r=parseFloat(e);if(r<0||r>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r},QT=t=>{const e=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return e==="localhost"||e==="127.0.0.1"||e==="::1"};async function eM(t){const e=[];for await(const r of t)e.push(r);return e}function rh(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const tM=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(r=>setTimeout(r,e)),!0}return!1};function fw(t){return typeof t=="number"?Number(t.toFixed(4)):t}class rM{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let r;const n=new Promise(o=>{r=o}),a=Tt(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:r,itemPromise:n,size:a}),this.sizeBytes+=a,n}pop(e){var a;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const r=[];let n=0;for(;n+(((a=this.peek())==null?void 0:a.size)??0)<e&&this.items.length>0;){const o=this.items.shift();o&&(r.push(o),n+=o.size,this.sizeBytes-=o.size)}if(r.length===0&&this.items.length>0){const o=this.items.shift();r.push(o),n+=o.size,this.sizeBytes-=o.size}return[r.map(o=>({action:o.action,item:o.payload})),()=>r.forEach(o=>o.itemPromiseResolve())]}}const nM=20971520,aM=2500;class $o{constructor(e={}){var n;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new rM}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:on("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:on("LANGSMITH_DEBUG")==="true"});const r=$o.getDefaultClientConfig();if(this.tracingSampleRate=XT(e.tracingSamplingRate),this.apiUrl=rh(e.apiUrl??r.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=rh(e.apiKey??r.apiKey),this.webUrl=rh(e.webUrl??r.webUrl),(n=this.webUrl)!=null&&n.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new hv({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new hv({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:tM,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??r.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??r.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Xt("API_KEY"),r=Xt("ENDPOINT")??"https://api.smith.langchain.com",n=Xt("HIDE_INPUTS")==="true",a=Xt("HIDE_OUTPUTS")==="true";return{apiUrl:r,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:QT(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${ed}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const r={...e};return r.inputs!==void 0&&(r.inputs=await this.processInputs(r.inputs)),r.outputs!==void 0&&(r.outputs=await this.processOutputs(r.outputs)),r}async _getResponse(e,r){const n=(r==null?void 0:r.toString())??"",a=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(he(this.debug),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(o,`Failed to fetch ${e}`),o}async _get(e,r){return(await this._getResponse(e,r)).json()}async*_getPaginated(e,r=new URLSearchParams,n){let a=Number(r.get("offset"))||0;const o=Number(r.get("limit"))||100;for(;;){r.set("offset",String(a)),r.set("limit",String(o));const i=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(he(this.debug),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(s,`Failed to fetch ${e}`);const l=n?n(await s.json()):await s.json();if(l.length===0||(yield l,l.length<o))break;a+=l.length}}async*_getCursorPaginatedList(e,r=null,n="POST",a="runs"){const o=r?{...r}:{};for(;;){const i=await(await this.caller.call(he(this.debug),`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(o)})).json();if(!i||!i[a])break;yield i[a];const s=i.cursors;if(!s||!s.next)break;o.cursor=s.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,r=!1){if(this.tracingSampleRate===void 0)return e;if(r){const n=[];for(const a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):n.push(a);return n}else{const n=[];for(const a of e){const o=a.trace_id??a.id;this.filteredPostUuids.has(o)||(a.id===o?this._shouldSample()?n.push(a):this.filteredPostUuids.add(o):n.push(a))}return n}}async _getBatchSizeLimitBytes(){var r;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((r=e.batch_ingest_config)==null?void 0:r.size_limit_bytes)??nM}async _getMultiPartSupport(){var e;return((e=(await this._ensureServerInfo()).instance_flags)==null?void 0:e.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const r=[];for(;this.autoBatchQueue.items.length>0;){const[n,a]=this.autoBatchQueue.pop(e);if(!n.length){a();break}const o=this._processBatch(n,a).catch(console.error);r.push(o)}return Promise.all(r)}async _processBatch(e,r){var n,a;if(!e.length){r();return}try{const o={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)};(a=(n=await this._ensureServerInfo())==null?void 0:n.batch_ingest_config)!=null&&a.use_multipart_endpoint?await this.multipartIngestRuns(o):await this.batchIngestRuns(o)}finally{r()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=pw(e.item));const r=this.autoBatchQueue.push(e);if(this.manualFlushMode)return r;const n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),r}async _getServerInfo(){const e=await this.caller.call(he(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(aM),...this.fetchOptions});await Se(e,"get server info");const r=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(r,null,2)+`
`),r}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const a=await this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}const o=pw(a),i=await this.caller.call(he(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:r,body:Tt(o,`Creating run with id: ${o.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:r}){if(e===void 0&&r===void 0)return;let n=await Promise.all((e==null?void 0:e.map(s=>this.prepareRunCreateOrUpdateInputs(s)))??[]),a=await Promise.all((r==null?void 0:r.map(s=>this.prepareRunCreateOrUpdateInputs(s)))??[]);if(n.length>0&&a.length>0){const s=n.reduce((c,u)=>(u.id&&(c[u.id]=u),c),{}),l=[];for(const c of a)c.id!==void 0&&s[c.id]?s[c.id]={...s[c.id],...c}:l.push(c);n=Object.values(s),a=l}const o={post:n,patch:a};if(!o.post.length&&!o.patch.length)return;const i={post:[],patch:[]};for(const s of["post","patch"]){const l=s,c=o[l].reverse();let u=c.pop();for(;u!==void 0;)i[l].push(u),u=c.pop()}if(i.post.length>0||i.patch.length>0){const s=i.post.map(l=>l.id).concat(i.patch.map(l=>l.id)).join(",");await this._postBatchIngestRuns(Tt(i,`Ingesting runs with ids: ${s}`))}}async _postBatchIngestRuns(e){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(he(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:r,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:r}){if(e===void 0&&r===void 0)return;const n={};let a=[];for(const l of e??[]){const c=await this.prepareRunCreateOrUpdateInputs(l);c.id!==void 0&&c.attachments!==void 0&&(n[c.id]=c.attachments),delete c.attachments,a.push(c)}let o=[];for(const l of r??[])o.push(await this.prepareRunCreateOrUpdateInputs(l));if(a.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(o.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&o.length>0){const l=a.reduce((u,d)=>(d.id&&(u[d.id]=d),u),{}),c=[];for(const u of o)u.id!==void 0&&l[u.id]?l[u.id]={...l[u.id],...u}:c.push(u);a=Object.values(l),o=c}if(a.length===0&&o.length===0)return;const i=[],s=[];for(const[l,c]of[["post",a],["patch",o]])for(const u of c){const{inputs:d,outputs:h,events:p,attachments:f,...y}=u,m={inputs:d,outputs:h,events:p},_=Tt(y,`Serializing for multipart ingestion of run with id: ${y.id}`);s.push({name:`${l}.${y.id}`,payload:new Blob([_],{type:`application/json; length=${_.length}`})});for(const[w,A]of Object.entries(m)){if(A===void 0)continue;const F=Tt(A,`Serializing ${w} for multipart ingestion of run with id: ${y.id}`);s.push({name:`${l}.${y.id}.${w}`,payload:new Blob([F],{type:`application/json; length=${F.length}`})})}if(y.id!==void 0){const w=n[y.id];if(w){delete n[y.id];for(const[A,F]of Object.entries(w)){let b,D;if(Array.isArray(F)?[b,D]=F:(b=F.mimeType,D=F.data),A.includes(".")){console.warn(`Skipping attachment '${A}' for run ${y.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}s.push({name:`attachment.${y.id}.${A}`,payload:new Blob([D],{type:`${b}; length=${D.byteLength}`})})}}}i.push(`trace=${y.trace_id},id=${y.id}`)}await this._sendMultipartRequest(s,i.join("; "))}async _createNodeFetchBody(e,r){const n=[];for(const a of e)n.push(new Blob([`--${r}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),n.push(a.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${r}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,r){const n=new TextEncoder;return new ReadableStream({async start(a){const o=async i=>{typeof i=="string"?a.enqueue(n.encode(i)):a.enqueue(i)};for(const i of e){await o(`--${r}\r
`),await o(`Content-Disposition: form-data; name="${i.name}"\r
`),await o(`Content-Type: ${i.payload.type}\r
\r
`);const s=i.payload.stream().getReader();try{let l;for(;!(l=await s.read()).done;)a.enqueue(l.value)}finally{s.releaseLock()}await o(`\r
`)}await o(`--${r}--\r
`),a.close()}})}async _sendMultipartRequest(e,r){try{const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=await(vT()?this._createNodeFetchBody(e,n):this._createMultipartStream(e,n)),o=await this.batchIngestCaller.call(he(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`},body:a,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,"ingest multipart runs",!0)}catch(n){console.warn(`${n.message.trim()}

Context: ${r}`)}}async updateRun(e,r){Ee(e),r.inputs&&(r.inputs=await this.processInputs(r.inputs)),r.outputs&&(r.outputs=await this.processOutputs(r.outputs));const n={...r,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(r.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n}).catch(console.error);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"},o=await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:Tt(r,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,"update run",!0)}async readRun(e,{loadChildRuns:r}={loadChildRuns:!1}){Ee(e);let n=await this._get(`/runs/${e}`);return r&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:r,projectOpts:n}){if(r!==void 0){let a;r.session_id?a=r.session_id:n!=null&&n.projectName?a=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?a=n==null?void 0:n.projectId:a=(await this.readProject({projectName:Xt("PROJECT")||"default"})).id;const o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${a}/r/${r.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var o;const r=await eM(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},a={};r.sort((i,s)=>((i==null?void 0:i.dotted_order)??"").localeCompare((s==null?void 0:s.dotted_order)??""));for(const i of r){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);(o=i.dotted_order)!=null&&o.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),a[i.id]=i)}e.child_runs=n[e.id]||[];for(const i in n)i!==e.id&&(a[i].child_runs=n[i]);return e}async*listRuns(e){const{projectId:r,projectName:n,parentRunId:a,traceId:o,referenceExampleId:i,startTime:s,executionOrder:l,isRoot:c,runType:u,error:d,id:h,query:p,filter:f,traceFilter:y,treeFilter:m,limit:_,select:w,order:A}=e;let F=[];if(r&&(F=Array.isArray(r)?r:[r]),n){const j=Array.isArray(n)?n:[n],G=await Promise.all(j.map(te=>this.readProject({projectName:te}).then(de=>de.id)));F.push(...G)}const b=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],D={session:F.length?F:null,run_type:u,reference_example:i,query:p,filter:f,trace_filter:y,tree_filter:m,execution_order:l,parent_run:a,start_time:s?s.toISOString():null,error:d,id:h,limit:_,trace:o,select:w||b,is_root:c,order:A};let B=0;for await(const j of this._getCursorPaginatedList("/runs/query",D))if(_){if(B>=_)break;if(j.length+B>_){yield*j.slice(0,_-B);break}B+=j.length,yield*j}else yield*j}async*listGroupRuns(e){const{projectId:r,projectName:n,groupBy:a,filter:o,startTime:i,endTime:s,limit:l,offset:c}=e,u={session_id:r||(await this.readProject({projectName:n})).id,group_by:a,filter:o,start_time:i?i.toISOString():null,end_time:s?s.toISOString():null,limit:Number(l)||100};let d=Number(c)||0;const h="/runs/group",p=`${this.apiUrl}${h}`;for(;;){const f={...u,offset:d},y=Object.fromEntries(Object.entries(f).filter(([F,b])=>b!==void 0)),m=await this.caller.call(he(),p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(m,`Failed to fetch ${h}`);const _=await m.json(),{groups:w,total:A}=_;if(w.length===0)break;for(const F of w)yield F;if(d+=w.length,d>=A)break}}async getRunStats({id:e,trace:r,parentRun:n,runType:a,projectNames:o,projectIds:i,referenceExampleIds:s,startTime:l,endTime:c,error:u,query:d,filter:h,traceFilter:p,treeFilter:f,isRoot:y,dataSourceType:m}){let _=i||[];o&&(_=[...i||[],...await Promise.all(o.map(A=>this.readProject({projectName:A}).then(F=>F.id)))]);const w=Object.fromEntries(Object.entries({id:e,trace:r,parent_run:n,run_type:a,session:_,reference_example:s,start_time:l,end_time:c,error:u,query:d,filter:h,trace_filter:p,tree_filter:f,is_root:y,data_source_type:m}).filter(([A,F])=>F!==void 0));return await(await this.caller.call(he(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:r}={}){const n={run_id:e,share_token:r||ht()};Ee(e);const a=await(await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Ee(e);const r=await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"unshare run",!0)}async readRunSharedLink(e){Ee(e);const r=await(await this.caller.call(he(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:r}={}){const n=new URLSearchParams({share_token:e});if(r!==void 0)for(const a of r)n.append("id",a);return Ee(e),await(await this.caller.call(he(this.debug),`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id),Ee(e);const n=await(await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async shareDataset(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id);const n={dataset_id:e};Ee(e);const a=await(await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Ee(e);const r=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"unshare dataset",!0)}async readSharedDataset(e){return Ee(e),await(await this.caller.call(he(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,r){const n={};r!=null&&r.exampleIds&&(n.id=r.exampleIds);const a=new URLSearchParams;Object.entries(n).forEach(([s,l])=>{Array.isArray(l)?l.forEach(c=>a.append(s,c)):a.append(s,l)});const o=await this.caller.call(he(this.debug),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await o.json();if(!o.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${o.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${o.status} ${o.statusText}`);return i.map(s=>({...s,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:r=null,metadata:n=null,upsert:a=!1,projectExtra:o=null,referenceDatasetId:i=null}){const s=a?"?upsert=true":"",l=`${this.apiUrl}/sessions${s}`,c=o||{};n&&(c.metadata=n);const u={name:e,extra:c,description:r};i!==null&&(u.reference_dataset_id=i);const d=await this.caller.call(he(this.debug),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(d,"create project"),await d.json()}async updateProject(e,{name:r=null,description:n=null,metadata:a=null,projectExtra:o=null,endTime:i=null}){const s=`${this.apiUrl}/sessions/${e}`;let l=o;a&&(l={...l||{},metadata:a});const c={name:r,extra:l,description:n,end_time:i?new Date(i).toISOString():null},u=await this.caller.call(he(this.debug),s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(u,"update project"),await u.json()}async hasProject({projectId:e,projectName:r}){let n="/sessions";const a=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(r!==void 0)a.append("name",r);else throw new Error("Must provide projectName or projectId");const o=await this.caller.call(he(this.debug),`${this.apiUrl}${n}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await o.json();return o.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:r,includeStats:n}){let a="/sessions";const o=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ee(e),a+=`/${e}`;else if(r!==void 0)o.append("name",r);else throw new Error("Must provide projectName or projectId");n!==void 0&&o.append("include_stats",n.toString());const i=await this._get(a,o);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${r}] not found`);s=i[0]}else s=i;return s}async getProjectUrl({projectId:e,projectName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either projectName or projectId");const n=await this.readProject({projectId:e,projectName:r}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");const n=await this.readDataset({datasetId:e,datasetName:r}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const r of this._getPaginated("/sessions",e))return this._tenantId=r[0].tenant_id,r[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:r,nameContains:n,referenceDatasetId:a,referenceDatasetName:o,referenceFree:i,metadata:s}={}){const l=new URLSearchParams;if(e!==void 0)for(const c of e)l.append("id",c);if(r!==void 0&&l.append("name",r),n!==void 0&&l.append("name_contains",n),a!==void 0)l.append("reference_dataset",a);else if(o!==void 0){const c=await this.readDataset({datasetName:o});l.append("reference_dataset",c.id)}i!==void 0&&l.append("reference_free",i.toString()),s!==void 0&&l.append("metadata",JSON.stringify(s));for await(const c of this._getPaginated("/sessions",l))yield*c}async deleteProject({projectId:e,projectName:r}){let n;if(e===void 0&&r===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:r})).id:n=e,Ee(n);const a=await this.caller.call(he(this.debug),`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(a,`delete session ${n} (${r})`,!0)}async uploadCsv({csvFile:e,fileName:r,inputKeys:n,outputKeys:a,description:o,dataType:i,name:s}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,r),n.forEach(d=>{c.append("input_keys",d)}),a.forEach(d=>{c.append("output_keys",d)}),o&&c.append("description",o),i&&c.append("data_type",i),s&&c.append("name",s);const u=await this.caller.call(he(this.debug),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(u,"upload CSV"),await u.json()}async createDataset(e,{description:r,dataType:n,inputsSchema:a,outputsSchema:o,metadata:i}={}){const s={name:e,description:r,extra:i?{metadata:i}:void 0};n&&(s.data_type=n),a&&(s.inputs_schema_definition=a),o&&(s.outputs_schema_definition=o);const l=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:r}){let n="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Ee(e),n+=`/${e}`;else if(r!==void 0)a.append("name",r);else throw new Error("Must provide datasetName or datasetId");const o=await this._get(n,a);let i;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${r}] not found`);i=o[0]}else i=o;return i}async hasDataset({datasetId:e,datasetName:r}){try{return await this.readDataset({datasetId:e,datasetName:r}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:r,fromVersion:n,toVersion:a}){let o=e;if(o===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:r})).id);const i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${o}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:r}){const n="/datasets";if(e===void 0)if(r!==void 0)e=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(a=>JSON.parse(a))}async*listDatasets({limit:e=100,offset:r=0,datasetIds:n,datasetName:a,datasetNameContains:o,metadata:i}={}){const s="/datasets",l=new URLSearchParams({limit:e.toString(),offset:r.toString()});if(n!==void 0)for(const c of n)l.append("id",c);a!==void 0&&l.append("name",a),o!==void 0&&l.append("name_contains",o),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(const c of this._getPaginated(s,l))yield*c}async updateDataset(e){const{datasetId:r,datasetName:n,...a}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");const o=r??(await this.readDataset({datasetName:n})).id;Ee(o);const i=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${o}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:r,datasetName:n,asOf:a,tag:o}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");const i=r??(await this.readDataset({datasetName:n})).id;Ee(i);const s=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof a=="string"?a:a.toISOString(),tag:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(s,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:r}){let n="/datasets",a=e;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(r!==void 0&&(a=(await this.readDataset({datasetName:r})).id),a!==void 0)Ee(a),n+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const o=await this.caller.call(he(this.debug),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(o,`delete ${n}`),await o.json()}async indexDataset({datasetId:e,datasetName:r,tag:n}){let a=e;if(!a&&!r)throw new Error("Must provide either datasetName or datasetId");if(a&&r)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:r})).id),Ee(a);const o={tag:n},i=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"index dataset"),await i.json()}async similarExamples(e,r,n,{filter:a}={}){const o={limit:n,inputs:e};a!==void 0&&(o.filter=a),Ee(r);const i=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${r}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,r,n){var c;if(mw(e)&&(r!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let a=r?n==null?void 0:n.datasetId:e.dataset_id;const o=r?n==null?void 0:n.datasetName:e.dataset_name;if(a===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:o})).id);const i=(r?n==null?void 0:n.createdAt:e.created_at)||new Date;let s;mw(e)?s=e:s={inputs:e,outputs:r,created_at:i==null?void 0:i.toISOString(),id:n==null?void 0:n.exampleId,metadata:n==null?void 0:n.metadata,split:n==null?void 0:n.split,source_run_id:n==null?void 0:n.sourceRunId,use_source_run_io:n==null?void 0:n.useSourceRunIO,use_source_run_attachments:n==null?void 0:n.useSourceRunAttachments,attachments:n==null?void 0:n.attachments};const l=await this._uploadExamplesMultipart(a,[s]);return await this.readExample(((c=l.example_ids)==null?void 0:c[0])??ht())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const _=e;let w=_[0].dataset_id;const A=_[0].dataset_name;if(w===void 0&&A===void 0)throw new Error("Must provide either datasetName or datasetId");if(w!==void 0&&A!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");w===void 0&&(w=(await this.readDataset({datasetName:A})).id);const F=await this._uploadExamplesMultipart(w,_);return await Promise.all(F.example_ids.map(b=>this.readExample(b)))}const{inputs:r,outputs:n,metadata:a,splits:o,sourceRunIds:i,useSourceRunIOs:s,useSourceRunAttachments:l,attachments:c,exampleIds:u,datasetId:d,datasetName:h}=e;if(r===void 0)throw new Error("Must provide inputs when using legacy parameters");let p=d;const f=h;if(p===void 0&&f===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&f!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(await this.readDataset({datasetName:f})).id);const y=r.map((_,w)=>({dataset_id:p,inputs:_,outputs:n==null?void 0:n[w],metadata:a==null?void 0:a[w],split:o==null?void 0:o[w],id:u==null?void 0:u[w],attachments:c==null?void 0:c[w],source_run_id:i==null?void 0:i[w],use_source_run_io:s==null?void 0:s[w],use_source_run_attachments:l==null?void 0:l[w]})),m=await this._uploadExamplesMultipart(p,y);return await Promise.all(m.example_ids.map(_=>this.readExample(_)))}async createLLMExample(e,r,n){return this.createExample({input:e},{output:r},n)}async createChatExample(e,r,n){const a=e.map(i=>pv(i)?fv(i):i),o=pv(r)?fv(r):r;return this.createExample({input:a},{output:o},n)}async readExample(e){Ee(e);const r=`/examples/${e}`,n=await this._get(r),{attachment_urls:a,...o}=n,i=o;return a&&(i.attachments=Object.entries(a).reduce((s,[l,c])=>(s[l.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},s),{})),i}async*listExamples({datasetId:e,datasetName:r,exampleIds:n,asOf:a,splits:o,inlineS3Urls:i,metadata:s,limit:l,offset:c,filter:u,includeAttachments:d}={}){let h;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(r!==void 0)h=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:h}),f=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;f&&p.append("as_of",f);const y=i??!0;if(p.append("inline_s3_urls",y.toString()),n!==void 0)for(const _ of n)p.append("id",_);if(o!==void 0)for(const _ of o)p.append("splits",_);if(s!==void 0){const _=JSON.stringify(s);p.append("metadata",_)}l!==void 0&&p.append("limit",l.toString()),c!==void 0&&p.append("offset",c.toString()),u!==void 0&&p.append("filter",u),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>p.append("select",_));let m=0;for await(const _ of this._getPaginated("/examples",p)){for(const w of _){const{attachment_urls:A,...F}=w,b=F;A&&(b.attachments=Object.entries(A).reduce((D,[B,j])=>(D[B.slice(11)]={presigned_url:j.presigned_url,mime_type:j.mime_type||void 0},D),{})),yield b,m++}if(l!==void 0&&m>=l)break}}async deleteExample(e){Ee(e);const r=`/examples/${e}`,n=await this.caller.call(he(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,`delete ${r}`),await n.json()}async updateExample(e,r){let n;r?n=e:n=e.id,Ee(n);let a;r?a={id:n,...r}:a=e;let o;return a.dataset_id!==void 0?o=a.dataset_id:o=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(o,[a])}async updateExamples(e){let r;return e[0].dataset_id===void 0?r=(await this.readExample(e[0].id)).dataset_id:r=e[0].dataset_id,this._updateExamplesMultipart(r,e)}async readDatasetVersion({datasetId:e,datasetName:r,asOf:n,tag:a}){let o;if(e?o=e:o=(await this.readDataset({datasetName:r})).id,Ee(o),n&&a||!n&&!a)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),a!==void 0&&i.append("tag",a);const s=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${o}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(s,"read dataset version"),await s.json()}async listDatasetSplits({datasetId:e,datasetName:r,asOf:n}){let a;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:r})).id:a=e,Ee(a);const o=new URLSearchParams,i=n?typeof n=="string"?n:n==null?void 0:n.toISOString():void 0;return i&&o.append("as_of",i),await this._get(`/datasets/${a}/splits`,o)}async updateDatasetSplits({datasetId:e,datasetName:r,splitName:n,exampleIds:a,remove:o=!1}){let i;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:r})).id:i=e,Ee(i);const s={split_name:n,examples:a.map(c=>(Ee(c),c)),remove:o},l=await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(l,"update dataset splits",!0)}async evaluateRun(e,r,{sourceInfo:n,loadChildRuns:a,referenceExample:o}={loadChildRuns:!1}){gv("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(o=await this.readExample(i.reference_example_id));const s=await r.evaluateRun(i,o),[l,c]=await this._logEvaluationFeedback(s,i,n);return c[0]}async createFeedback(e,r,{score:n,value:a,correction:o,comment:i,sourceInfo:s,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,feedbackConfig:d,projectId:h,comparativeExperimentId:p}){var w;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const f={type:l??"api",metadata:s??{}};c!==void 0&&(f==null?void 0:f.metadata)!==void 0&&!f.metadata.__run&&(f.metadata.__run={run_id:c}),(f==null?void 0:f.metadata)!==void 0&&((w=f.metadata.__run)==null?void 0:w.run_id)!==void 0&&Ee(f.metadata.__run.run_id);const y={id:u??ht(),run_id:e,key:r,score:fw(n),value:a,correction:o,comment:i,feedback_source:f,comparative_experiment_id:p,feedbackConfig:d,session_id:h},m=`${this.apiUrl}/feedback`,_=await this.caller.call(he(this.debug),m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(_,"create feedback",!0),y}async updateFeedback(e,{score:r,value:n,correction:a,comment:o}){const i={};r!=null&&(i.score=fw(r)),n!=null&&(i.value=n),a!=null&&(i.correction=a),o!=null&&(i.comment=o),Ee(e);const s=await this.caller.call(he(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(s,"update feedback",!0)}async readFeedback(e){Ee(e);const r=`/feedback/${e}`;return await this._get(r)}async deleteFeedback(e){Ee(e);const r=`/feedback/${e}`,n=await this.caller.call(he(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,`delete ${r}`),await n.json()}async*listFeedback({runIds:e,feedbackKeys:r,feedbackSourceTypes:n}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),r)for(const o of r)a.append("key",o);if(n)for(const o of n)a.append("source",o);for await(const o of this._getPaginated("/feedback",a))yield*o}async createPresignedFeedbackToken(e,r,{expiration:n,feedbackConfig:a}={}){const o={run_id:e,feedback_key:r,feedback_config:a};return n?typeof n=="string"?o.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(o.expires_in=n):o.expires_in={hours:3},await(await this.caller.call(he(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:r,referenceDatasetId:n,createdAt:a,description:o,metadata:i,id:s}){var c;if(r.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:r[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");const l={id:s,name:e,experiment_ids:r,reference_dataset_id:n,description:o,created_at:(c=a??new Date)==null?void 0:c.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(he(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Ee(e);const r=new URLSearchParams({run_id:e});for await(const n of this._getPaginated("/feedback/tokens",r))yield*n}_selectEvalResults(e){let r;return"results"in e?r=e.results:Array.isArray(e)?r=e:r=[e],r}async _logEvaluationFeedback(e,r,n){const a=this._selectEvalResults(e),o=[];for(const i of a){let s=n||{};i.evaluatorInfo&&(s={...i.evaluatorInfo,...s});let l=null;i.targetRunId?l=i.targetRunId:r&&(l=r.id),o.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:s,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[a,o]}async logEvaluationFeedback(e,r,n){const[a]=await this._logEvaluationFeedback(e,r,n);return a}async*listAnnotationQueues(e={}){const{queueIds:r,name:n,nameContains:a,limit:o}=e,i=new URLSearchParams;r&&r.forEach((l,c)=>{Ee(l,`queueIds[${c}]`),i.append("ids",l)}),n&&i.append("name",n),a&&i.append("name_contains",a),i.append("limit",(o!==void 0?Math.min(o,100):100).toString());let s=0;for await(const l of this._getPaginated("/annotation-queues",i))if(yield*l,s++,o!==void 0&&s>=o)break}async createAnnotationQueue(e){const{name:r,description:n,queueId:a,rubricInstructions:o}=e,i={name:r,description:n,id:a||ht(),rubric_instructions:o},s=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([l,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(s,"create annotation queue"),await s.json()}async readAnnotationQueue(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(r,"read annotation queue"),await r.json()}async updateAnnotationQueue(e,r){const{name:n,description:a,rubricInstructions:o}=r,i=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:n,description:a,rubric_instructions:o}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"update annotation queue")}async deleteAnnotationQueue(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(r,"delete annotation queue")}async addRunsToAnnotationQueue(e,r){const n=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r.map((a,o)=>Ee(a,`runIds[${o}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,r){const n=`/annotation-queues/${Ee(e,"queueId")}/run`,a=await this.caller.call(he(this.debug),`${this.apiUrl}${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,r){const n=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/runs/${Ee(r,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(n,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/annotation-queues/${Ee(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(r,"get size from annotation queue"),await r.json()}async _currentTenantIsOwner(e){const r=await this._getSettings();return e=="-"||r.tenant_handle===e}async _ownerConflictError(e,r){const n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${r}`)}async _getLatestCommitHash(e){const r=await this.caller.call(he(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await r.json();if(!r.ok){const a=typeof n.detail=="string"?n.detail:JSON.stringify(n.detail),o=new Error(`Error ${r.status}: ${r.statusText}
${a}`);throw o.statusCode=r.status,o}if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,r){const[n,a,o]=sn(e),i=await this.caller.call(he(this.debug),`${this.apiUrl}/likes/${n}/${a}`,{method:"POST",body:JSON.stringify({like:r}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,`${r?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[r,n,a]=sn(e);if(await this._currentTenantIsOwner(r)){const o=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${n}/${a.substring(0,8)}?organizationId=${o.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${o.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${r}/${n}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${r}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const r of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*r}async*listPrompts(e){const r=new URLSearchParams;r.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),r.append("sort_direction","desc"),r.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&r.append("is_public",e.isPublic.toString()),e!=null&&e.query&&r.append("query",e.query);for await(const n of this._getPaginated("/repos",r,a=>a.repos))yield*n}async getPrompt(e){const[r,n,a]=sn(e),o=await this.caller.call(he(this.debug),`${this.apiUrl}/repos/${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(o.status===404)return null;await Se(o,"get prompt");const i=await o.json();return i.repo?i.repo:null}async createPrompt(e,r){const n=await this._getSettings();if(r!=null&&r.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[a,o,i]=sn(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const s={repo_handle:o,...(r==null?void 0:r.description)&&{description:r.description},...(r==null?void 0:r.readme)&&{readme:r.readme},...(r==null?void 0:r.tags)&&{tags:r.tags},is_public:!!(r!=null&&r.isPublic)},l=await this.caller.call(he(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(l,"create prompt");const{repo:c}=await l.json();return c}async createCommit(e,r,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,o,i]=sn(e),s=(n==null?void 0:n.parentCommitHash)==="latest"||!(n!=null&&n.parentCommitHash)?await this._getLatestCommitHash(`${a}/${o}`):n==null?void 0:n.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(r)),parent_commit:s},c=await this.caller.call(he(this.debug),`${this.apiUrl}/commits/${a}/${o}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(c,"create commit");const u=await c.json();return this._getPromptUrl(`${a}/${o}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,r=[]){return this._updateExamplesMultipart(e,r)}async _updateExamplesMultipart(e,r=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const i of r){const s=i.id,l={...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},c=Tt(l,`Serializing body for example with id: ${s}`),u=new Blob([c],{type:"application/json"});if(n.append(s,u),i.inputs){const d=Tt(i.inputs,`Serializing inputs for example with id: ${s}`),h=new Blob([d],{type:"application/json"});n.append(`${s}.inputs`,h)}if(i.outputs){const d=Tt(i.outputs,`Serializing outputs whle updating example with id: ${s}`),h=new Blob([d],{type:"application/json"});n.append(`${s}.outputs`,h)}if(i.attachments)for(const[d,h]of Object.entries(i.attachments)){let p,f;Array.isArray(h)?[p,f]=h:(p=h.mimeType,f=h.data);const y=new Blob([f],{type:`${p}; length=${f.byteLength}`});n.append(`${s}.attachment.${d}`,y)}if(i.attachments_operations){const d=Tt(i.attachments_operations,`Serializing attachments while updating example with id: ${s}`),h=new Blob([d],{type:"application/json"});n.append(`${s}.attachments_operations`,h)}}const a=e??((o=r[0])==null?void 0:o.dataset_id);return await(await this.caller.call(he(this.debug),`${this.apiUrl}/v1/platform/datasets/${a}/examples`,{method:"PATCH",headers:this.headers,body:n})).json()}async uploadExamplesMultipart(e,r=[]){return this._uploadExamplesMultipart(e,r)}async _uploadExamplesMultipart(e,r=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const n=new FormData;for(const o of r){const i=(o.id??ht()).toString(),s={created_at:o.created_at,...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split},...o.source_run_id&&{source_run_id:o.source_run_id},...o.use_source_run_io&&{use_source_run_io:o.use_source_run_io},...o.use_source_run_attachments&&{use_source_run_attachments:o.use_source_run_attachments}},l=Tt(s,`Serializing body for uploaded example with id: ${i}`),c=new Blob([l],{type:"application/json"});if(n.append(i,c),o.inputs){const u=Tt(o.inputs,`Serializing inputs for uploaded example with id: ${i}`),d=new Blob([u],{type:"application/json"});n.append(`${i}.inputs`,d)}if(o.outputs){const u=Tt(o.outputs,`Serializing outputs for uploaded example with id: ${i}`),d=new Blob([u],{type:"application/json"});n.append(`${i}.outputs`,d)}if(o.attachments)for(const[u,d]of Object.entries(o.attachments)){let h,p;Array.isArray(d)?[h,p]=d:(h=d.mimeType,p=d.data);const f=new Blob([p],{type:`${h}; length=${p.byteLength}`});n.append(`${i}.attachment.${u}`,f)}}const a=await this.caller.call(he(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:n});return await Se(a,"upload examples"),await a.json()}async updatePrompt(e,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,a]=sn(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);const o={};if((r==null?void 0:r.description)!==void 0&&(o.description=r.description),(r==null?void 0:r.readme)!==void 0&&(o.readme=r.readme),(r==null?void 0:r.tags)!==void 0&&(o.tags=r.tags),(r==null?void 0:r.isPublic)!==void 0&&(o.is_public=r.isPublic),(r==null?void 0:r.isArchived)!==void 0&&(o.is_archived=r.isArchived),Object.keys(o).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(he(this.debug),`${this.apiUrl}/repos/${n}/${a}`,{method:"PATCH",body:JSON.stringify(o),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Se(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,n,a]=sn(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("delete a prompt",r);return await(await this.caller.call(he(this.debug),`${this.apiUrl}/repos/${r}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,r){const[n,a,o]=sn(e),i=await this.caller.call(he(this.debug),`${this.apiUrl}/commits/${n}/${a}/${o}${r!=null&&r.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Se(i,"pull prompt commit");const s=await i.json();return{owner:n,repo:a,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async _pullPrompt(e,r){const n=await this.pullPromptCommit(e,{includeModel:r==null?void 0:r.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,r){return await this.promptExists(e)?r&&Object.keys(r).some(n=>n!=="object")&&await this.updatePrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}):await this.createPrompt(e,{description:r==null?void 0:r.description,readme:r==null?void 0:r.readme,tags:r==null?void 0:r.tags,isPublic:r==null?void 0:r.isPublic}),r!=null&&r.object?await this.createCommit(e,r==null?void 0:r.object,{parentCommitHash:r==null?void 0:r.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,r={}){const{sourceApiUrl:n=this.apiUrl,datasetName:a}=r,[o,i]=this.parseTokenOrUrl(e,n),s=new $o({apiUrl:o,apiKey:"placeholder"}),l=await s.readSharedDataset(i),c=a||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const u=await s.listSharedExamples(i),d=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(h=>h.inputs),outputs:u.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),h}}parseTokenOrUrl(e,r,n=2,a="dataset"){try{return Ee(e),[r,e]}catch{}try{const o=new URL(e).pathname.split("/").filter(i=>i!=="");if(o.length>=n){const i=o[o.length-n];return[r,i]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function mw(t){return"dataset_id"in t||"dataset_name"in t}const oM=t=>!!["TRACING_V2","TRACING"].find(e=>Xt(e)==="true"),nh=Symbol.for("lc:context_variables");function iM(t){return t.replace(/[-:.]/g,"")}function sM(t,e,r=1){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return iM(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}class zs{constructor(e,r,n,a){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=r,this.project_name=n,this.replicas=a}static fromHeader(e){const r=e.split(",");let n={},a=[],o,i;for(const s of r){const[l,c]=s.split("="),u=decodeURIComponent(c);l==="langsmith-metadata"?n=JSON.parse(u):l==="langsmith-tags"?a=u.split(","):l==="langsmith-project"?o=u:l==="langsmith-replicas"&&(i=JSON.parse(u))}return new zs(n,a,o,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class _t{constructor(e){var s;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),gw(e)){Object.assign(this,{...e});return}const r=_t.getDefaultConfig(),{metadata:n,...a}=e,o=a.client??_t.getSharedClient(),i={...n,...(s=a==null?void 0:a.extra)==null?void 0:s.metadata};if(a.extra={...a.extra,metadata:i},Object.assign(this,{...r,...a,client:o}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const l=sM(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}set metadata(e){var r;this.extra={...this.extra,metadata:{...(r=this.extra)==null?void 0:r.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:ht(),run_type:"chain",project_name:Qu(),child_runs:[],api_url:on("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:on("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return _t.sharedClient||(_t.sharedClient=new $o),_t.sharedClient}createChild(e){var l,c,u,d,h,p;const r=this.child_execution_order+1,n=new _t({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r});nh in this&&(n[nh]=this[nh]);const a=Symbol.for("lc:child_config"),o=((l=e.extra)==null?void 0:l[a])??this.extra[a];if(cM(o)){const f={...o},y=lM(f.callbacks)?(u=(c=f.callbacks).copy)==null?void 0:u.call(c):void 0;y&&(Object.assign(y,{_parentRunId:n.id}),(p=(h=(d=y.handlers)==null?void 0:d.find(yw))==null?void 0:h.updateFromRunTree)==null||p.call(h,n),f.callbacks=y),n.extra[a]=f}const i=new Set;let s=this;for(;s!=null&&!i.has(s.id);)i.add(s.id),s.child_execution_order=Math.max(s.child_execution_order,r),s=s.parent_run;return this.child_runs.push(n),n}async end(e,r,n=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??r,this.end_time=this.end_time??n,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,r,n=!0){var s,l;const a=e.extra??{};if(((s=a==null?void 0:a.runtime)==null?void 0:s.library)===void 0&&(a.runtime||(a.runtime={}),r))for(const[c,u]of Object.entries(r))a.runtime[c]||(a.runtime[c]=u);let o,i;return n?(i=(l=e.parent_run)==null?void 0:l.id,o=[]):(o=e.child_runs.map(c=>this._convertToCreate(c,r,n)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:o,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,r,n=!0){const a=this._convertToCreate(this,r,n);if(e===this.project_name)return a;const o=u=>K_(`${u}:${e}`,K_.DNS),i=o(a.id),s=a.trace_id?o(a.trace_id):void 0,l=a.parent_run_id?o(a.parent_run_id):void 0;let c;if(a.dotted_order){const u=uM(a.dotted_order),d=[];for(let p=0;p<u.length-1;p++){const[f,y]=u[p],m=o(y);d.push(f.toISOString().replace(/[-:]/g,"").replace(".","")+m)}const[h]=u[u.length-1];d.push(h.toISOString().replace(/[-:]/g,"").replace(".","")+i),c=d.join(".")}else c=void 0;return{...a,id:i,trace_id:s,parent_run_id:l,dotted_order:c,session_name:e}}async postRun(e=!0){try{const r=uv();if(this.replicas&&this.replicas.length>0)for(const[n]of this.replicas){const a=this._remapForProject(n,r,!0);await this.client.createRun(a)}else{const n=this._convertToCreate(this,r,e);await this.client.createRun(n)}if(!e){gv("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const n of this.child_runs)await n.postRun(!1)}}catch(r){console.error(`Error in postRun for run ${this.id}:`,r)}}async patchRun(){var e;if(this.replicas&&this.replicas.length>0)for(const[r,n]of this.replicas){const a=this._remapForProject(r);await this.client.updateRun(a.id,{inputs:a.inputs,outputs:a.outputs,error:a.error,parent_run_id:a.parent_run_id,session_name:a.session_name,reference_example_id:a.reference_example_id,end_time:a.end_time,dotted_order:a.dotted_order,trace_id:a.trace_id,events:a.events,tags:a.tags,extra:a.extra,attachments:this.attachments,...n})}else try{const r={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,r)}catch(r){console.error(`Error in patchRun for run ${this.id}`,r)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,r){var l,c,u,d;const n=e==null?void 0:e.callbacks;let a,o,i,s=oM();if(n){const h=((l=n==null?void 0:n.getParentRunId)==null?void 0:l.call(n))??"",p=(c=n==null?void 0:n.handlers)==null?void 0:c.find(f=>(f==null?void 0:f.name)=="langchain_tracer");a=(u=p==null?void 0:p.getRun)==null?void 0:u.call(p,h),o=p==null?void 0:p.projectName,i=p==null?void 0:p.client,s=s||!!p}return a?new _t({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:i,tracingEnabled:s,project_name:o,tags:[...new Set(((a==null?void 0:a.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(d=a==null?void 0:a.extra)==null?void 0:d.metadata,...e==null?void 0:e.metadata}}}).createChild(r):new _t({...r,client:i,tracingEnabled:s,project_name:o})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,r){var c;const n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=n["langsmith-trace"];if(!a||typeof a!="string")return;const o=a.trim(),i=o.split(".").map(u=>{const[d,h]=u.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:h}}),s=i[0].uuid,l={...r,name:(r==null?void 0:r.name)??"parent",run_type:(r==null?void 0:r.run_type)??"chain",start_time:(r==null?void 0:r.start_time)??Date.now(),id:(c=i.at(-1))==null?void 0:c.uuid,trace_id:s,dotted_order:o};if(n.baggage&&typeof n.baggage=="string"){const u=zs.fromHeader(n.baggage);l.metadata=u.metadata,l.tags=u.tags,l.project_name=u.project_name,l.replicas=u.replicas}return new _t(l)}toHeaders(e){var n;const r={"langsmith-trace":this.dotted_order,baggage:new zs((n=this.extra)==null?void 0:n.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[a,o]of Object.entries(r))e.set(a,o);return r}}Object.defineProperty(_t,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function gw(t){return t!==void 0&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function yw(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function _w(t){return Array.isArray(t)&&t.some(e=>yw(e))}function lM(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function cM(t){var e;return t!==void 0&&typeof t.callbacks=="object"&&(_w((e=t.callbacks)==null?void 0:e.handlers)||_w(t.callbacks))}function uM(t){return t.split(".").map(e=>{const r=e.slice(0,-36),n=e.slice(-36),a=parseInt(r.slice(0,4)),o=parseInt(r.slice(4,6))-1,i=parseInt(r.slice(6,8)),s=parseInt(r.slice(9,11)),l=parseInt(r.slice(11,13)),c=parseInt(r.slice(13,15)),u=parseInt(r.slice(15,21));return[new Date(a,o,i,s,l,c,u/1e3),n]})}let dM=class{getStore(){}run(t,e){return e()}};const ah=Symbol.for("ls:tracing_async_local_storage"),hM=new dM;let pM=class{getInstance(){return globalThis[ah]??hM}initializeGlobalInstance(t){globalThis[ah]===void 0&&(globalThis[ah]=t)}};const fM=new pM;function mM(t=!1){const e=fM.getInstance().getStore();if(!t&&!gw(e))throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function oh(t){return typeof t=="function"&&"langsmith:traceable"in t}const gM=Object.prototype.hasOwnProperty;Bp=function(t,e){return gM.call(t,e)},Up=function(t){if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<r.length;n++)r[n]=""+n;return r}if(Object.keys)return Object.keys(t);let e=[];for(let r in t)Bp(t,r)&&e.push(r);return e},bn=function(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}};function ih(t){let e=0;const r=t.length;let n;for(;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}c0=function(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")};function yM(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function sh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(sh(t[r]))return!0}else if(typeof t=="object"){const r=Up(t),n=r.length;for(var e=0;e<n;e++)if(sh(t[r[e]]))return!0}}return!1}function vw(t,e){const r=[t];for(const n in e){const a=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof a<"u"&&r.push(`${n}: ${a}`)}return r.join(`
`)}class _M extends Error{constructor(e,r,n,a,o){super(vw(e,{name:r,index:n,operation:a,tree:o})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.setPrototypeOf(this,new.target.prototype),this.message=vw(e,{name:r,index:n,operation:a,tree:o})}}const et=_M,Ta={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){let n=lh(r,this.path);n&&(n=bn(n));const a=zo(r,{op:"remove",path:this.from}).removed;return zo(r,{op:"add",path:this.path,value:a}),{newDocument:r,removed:n}},copy:function(t,e,r){const n=lh(r,this.from);return zo(r,{op:"add",path:this.path,value:bn(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:Bs(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}};var vM={add:function(t,e,r){return ih(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:Ta.move,copy:Ta.copy,test:Ta.test,_get:Ta._get};function lh(t,e){if(e=="")return t;var r={op:"_get",path:e};return zo(t,r),r.value}function zo(t,e,r=!1,n=!0,a=!0,o=0){if(r&&(typeof r=="function"?r(e,0,t,e.path):ch(e,0)),e.path===""){let i={newDocument:t};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=t,i;if(e.op==="move"||e.op==="copy")return i.newDocument=lh(t,e.from),e.op==="move"&&(i.removed=t),i;if(e.op==="test"){if(i.test=Bs(t,e.value),i.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return i.newDocument=t,i}else{if(e.op==="remove")return i.removed=t,i.newDocument=null,i;if(e.op==="_get")return e.value=t,i;if(r)throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return i}}else{n||(t=bn(t));const i=(e.path||"").split("/");let s=t,l=1,c=i.length,u,d,h;for(typeof r=="function"?h=r:h=ch;;){if(d=i[l],d&&d.indexOf("~")!=-1&&(d=yM(d)),a&&(d=="__proto__"||d=="prototype"&&l>0&&i[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&u===void 0&&(s[d]===void 0?u=i.slice(0,l).join("/"):l==c-1&&(u=e.path),u!==void 0&&h(e,0,t,u)),l++,Array.isArray(s)){if(d==="-")d=s.length;else{if(r&&!ih(d))throw new et("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);ih(d)&&(d=~~d)}if(l>=c){if(r&&e.op==="add"&&d>s.length)throw new et("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);const p=vM[e.op].call(e,s,d,t);if(p.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return p}}else if(l>=c){const p=Ta[e.op].call(e,s,d,t);if(p.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return p}if(s=s[d],r&&l<c&&(!s||typeof s!="object"))throw new et("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,e,t)}}}function Us(t,e,r,n=!0,a=!0){if(r&&!Array.isArray(e))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=bn(t));const o=new Array(e.length);for(let i=0,s=e.length;i<s;i++)o[i]=zo(t,e[i],r,!0,a,i),t=o[i].newDocument;return o.newDocument=t,o}function ch(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new et("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(Ta[t.op]){if(typeof t.path!="string")throw new et("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new et('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new et("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&sh(t.value))throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var a=t.path.split("/").length,o=n.split("/").length;if(a!==o+1&&a!==o)throw new et("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new et("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var i={op:"_get",path:t.from,value:void 0},s=wM([i],r);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new et("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function wM(t,e,r){try{if(!Array.isArray(t))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Us(bn(e),bn(t),r||!0);else{r=r||ch;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(a){if(a instanceof et)return a;throw a}}function Bs(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),a,o,i;if(r&&n){if(o=t.length,o!=e.length)return!1;for(a=o;a--!==0;)if(!Bs(t[a],e[a]))return!1;return!0}if(r!=n)return!1;var s=Object.keys(t);if(o=s.length,o!==Object.keys(e).length)return!1;for(a=o;a--!==0;)if(!e.hasOwnProperty(s[a]))return!1;for(a=o;a--!==0;)if(i=s[a],!Bs(t[i],e[i]))return!1;return!0}return t!==t&&e!==e}var ww,bw;function bM(){return bw||(bw=1,ww=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),ww}var EM=bM();const SM=Ja(EM);var Hs={exports:{}},Ew;function xM(){if(Ew)return Hs.exports;Ew=1;const t=/[\p{Lu}]/u,e=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,o=new RegExp("^"+a.source),i=new RegExp(a.source+n.source,"gu"),s=new RegExp("\\d+"+n.source,"gu"),l=(h,p,f)=>{let y=!1,m=!1,_=!1;for(let w=0;w<h.length;w++){const A=h[w];y&&t.test(A)?(h=h.slice(0,w)+"-"+h.slice(w),y=!1,_=m,m=!0,w++):m&&_&&e.test(A)?(h=h.slice(0,w-1)+"-"+h.slice(w-1),_=m,m=!1,y=!0):(y=p(A)===A&&f(A)!==A,_=m,m=f(A)===A&&p(A)!==A)}return h},c=(h,p)=>(r.lastIndex=0,h.replace(r,f=>p(f))),u=(h,p)=>(i.lastIndex=0,s.lastIndex=0,h.replace(i,(f,y)=>p(y)).replace(s,f=>p(f))),d=(h,p)=>{if(!(typeof h=="string"||Array.isArray(h)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(h)?h=h.map(m=>m.trim()).filter(m=>m.length).join("-"):h=h.trim(),h.length===0)return"";const f=p.locale===!1?m=>m.toLowerCase():m=>m.toLocaleLowerCase(p.locale),y=p.locale===!1?m=>m.toUpperCase():m=>m.toLocaleUpperCase(p.locale);return h.length===1?p.pascalCase?y(h):f(h):(h!==f(h)&&(h=l(h,f,y)),h=h.replace(o,""),p.preserveConsecutiveUppercase?h=c(h,f):h=f(h),p.pascalCase&&(h=y(h.charAt(0))+h.slice(1)),u(h,y))};return Hs.exports=d,Hs.exports.default=d,Hs.exports}xM();function kM(t,e){return(e==null?void 0:e[t])||SM(t)}function AM(t,e,r){const n={};for(const a in t)Object.hasOwn(t,a)&&(n[e(a,r)]=t[a]);return n}function Sw(t){return Array.isArray(t)?[...t]:{...t}}function TM(t,e){const r=Sw(t);for(const[n,a]of Object.entries(e)){const[o,...i]=n.split(".").reverse();let s=r;for(const l of i.reverse()){if(s[l]===void 0)break;s[l]=Sw(s[l]),s=s[l]}s[o]!==void 0&&(s[o]={lc:1,type:"secret",id:[a]})}return r}function xw(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}En=class{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,xw(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(t,...e){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(t||{}).filter(([r])=>{var n;return(n=this.lc_serializable_keys)==null?void 0:n.includes(r)})):this.lc_kwargs=t??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof En||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const t={},e={},r=Object.keys(this.lc_kwargs).reduce((n,a)=>(n[a]=a in this?this[a]:this.lc_kwargs[a],n),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(t,Reflect.get(n,"lc_aliases",this)),Object.assign(e,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));return Object.keys(e).forEach(n=>{let a=this,o=r;const[i,...s]=n.split(".").reverse();for(const l of s.reverse()){if(!(l in a)||a[l]===void 0)return;(!(l in o)||o[l]===void 0)&&(typeof a[l]=="object"&&a[l]!=null?o[l]={}:Array.isArray(a[l])&&(o[l]=[])),a=a[l],o=o[l]}i in a&&a[i]!==void 0&&(o[i]=o[i]||a[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:AM(Object.keys(e).length?TM(r,e):r,kM,t)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};var uh={};const MM=()=>typeof window<"u"&&typeof window.document<"u",FM=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",RM=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),dh=()=>typeof Deno<"u",OM=()=>typeof yt<"u"&&typeof yt.versions<"u"&&typeof yt.versions.node<"u"&&!dh(),NM=()=>{let t;return MM()?t="browser":OM()?t="node":FM()?t="webworker":RM()?t="jsdom":dh()?t="deno":t="other",t};let hh;function IM(){return hh===void 0&&(hh={library:"langchain-js",runtime:NM()}),hh}wn=function(t){try{return typeof yt<"u"?uh==null?void 0:uh[t]:dh()?Deno==null?void 0:Deno.env.get(t):void 0}catch{return}};class PM{}E0=function(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming};class Uo extends PM{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,xw(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:wn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return En.prototype.toJSON.call(this)}toJSONNotImplemented(){return En.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class r extends Uo{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,e)}}return new r}}const CM=t=>{const e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},jM=t=>{if(t)return t.events=t.events??[],t.child_runs=t.child_runs??[],t};function ph(t,e){if(t)return new _t({...t,parent_run:ph(e),child_runs:t.child_runs.map(r=>ph(r)).filter(r=>r!==void 0),extra:{...t.extra,runtime:IM()},tracingEnabled:!1})}function fh(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function LM(t){return t.replace(/[-:.]/g,"")}function DM(t,e,r){const n=r.toFixed(0).slice(0,3).padStart(3,"0");return LM(`${new Date(t).toISOString().slice(0,-1)}${n}Z`)+e}function Bo(t){return typeof t._addRunToRunMap=="function"}class Ho extends Uo{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?jM(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,r){e.child_runs.push(r)}_addRunToRunMap(e){const r=DM(e.start_time,e.id,e.execution_order),n={...e},a=this.getRunById(n.parent_run_id);if(n.parent_run_id!==void 0?a&&(this._addChildRun(a,n),a.child_execution_order=Math.max(a.child_execution_order,n.child_execution_order),n.trace_id=a.trace_id,a.dotted_order!==void 0&&(n.dotted_order=[a.dotted_order,r].join("."))):(n.trace_id=n.id,n.dotted_order=r),this.usesRunTreeMap){const o=ph(n,a);o!==void 0&&this.runTreeMap.set(n.id,o)}else this.runMap.set(n.id,n);return n}async _endTrace(e){var n;const r=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);r?r.child_execution_order=Math.max(r.child_execution_order,e.child_execution_order):await this.persistRun(e),await((n=this.onRunUpdate)==null?void 0:n.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const r=e!==void 0&&this.getRunById(e);return r?r.child_execution_order+1:1}_createRunForLLMStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),u=Date.now(),d=s?{...o,metadata:s}:o,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:r},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,r,n,a,o,i,s,l){var u,d;const c=this.getRunById(n)??this._createRunForLLMStart(e,r,n,a,o,i,s,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}_createRunForChatModelStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),u=Date.now(),d=s?{...o,metadata:s}:o,h={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:r},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,r,n,a,o,i,s,l){var u,d;const c=this.getRunById(n)??this._createRunForChatModelStart(e,r,n,a,o,i,s,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}async handleLLMEnd(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...o},await((s=this.onLLMEnd)==null?void 0:s.call(this,i)),await this._endTrace(i),i}async handleLLMError(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i||(i==null?void 0:i.run_type)!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...o},await((s=this.onLLMError)==null?void 0:s.call(this,i)),await this._endTrace(i),i}_createRunForChainStart(e,r,n,a,o,i,s,l){const c=this._getExecutionOrder(a),u=Date.now(),d={id:n,name:l??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:r,execution_order:c,child_execution_order:c,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(d)}async handleChainStart(e,r,n,a,o,i,s,l){var u,d;const c=this.getRunById(n)??this._createRunForChainStart(e,r,n,a,o,i,s,l);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((d=this.onChainStart)==null?void 0:d.call(this,c)),c}async handleChainEnd(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=fh(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(i.inputs=fh(o.inputs,"input")),await((s=this.onChainEnd)==null?void 0:s.call(this,i)),await this._endTrace(i),i}async handleChainError(e,r,n,a,o){var s;const i=this.getRunById(r);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(o==null?void 0:o.inputs)!==void 0&&(i.inputs=fh(o.inputs,"input")),await((s=this.onChainError)==null?void 0:s.call(this,i)),await this._endTrace(i),i}_createRunForToolStart(e,r,n,a,o,i,s){const l=this._getExecutionOrder(a),c=Date.now(),u={id:n,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:r},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(u)}async handleToolStart(e,r,n,a,o,i,s){var c,u;const l=this.getRunById(n)??this._createRunForToolStart(e,r,n,a,o,i,s);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onToolStart)==null?void 0:u.call(this,l)),l}async handleToolEnd(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleToolError(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,r){var o;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="chain")return;const a=n;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((o=this.onAgentAction)==null?void 0:o.call(this,n))}async handleAgentEnd(e,r){var a;const n=this.getRunById(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,n)))}_createRunForRetrieverStart(e,r,n,a,o,i,s){const l=this._getExecutionOrder(a),c=Date.now(),u={id:n,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:r},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:o||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,r,n,a,o,i,s){var c,u;const l=this.getRunById(n)??this._createRunForRetrieverStart(e,r,n,a,o,i,s);return await((c=this.onRunCreate)==null?void 0:c.call(this,l)),await((u=this.onRetrieverStart)==null?void 0:u.call(this,l)),l}async handleRetrieverEnd(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,r){var a;const n=this.getRunById(r);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,n)),await this._endTrace(n),n}async handleText(e,r){var a;const n=this.getRunById(r);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,n)))}async handleLLMNewToken(e,r,n,a,o,i){var l;const s=this.getRunById(n);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:r,chunk:i==null?void 0:i.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,s,e,{chunk:i==null?void 0:i.chunk})),s}}var mh={exports:{}};mh.exports;var kw;function $M(){return kw||(kw=1,function(t){const e=(a=0)=>o=>`\x1B[${38+a};5;${o}m`,r=(a=0)=>(o,i,s)=>`\x1B[${38+a};2;${o};${i};${s}m`;function n(){const a=new Map,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};o.color.gray=o.color.blackBright,o.bgColor.bgGray=o.bgColor.bgBlackBright,o.color.grey=o.color.blackBright,o.bgColor.bgGrey=o.bgColor.bgBlackBright;for(const[i,s]of Object.entries(o)){for(const[l,c]of Object.entries(s))o[l]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},s[l]=o[l],a.set(c[0],c[1]);Object.defineProperty(o,i,{value:s,enumerable:!1})}return Object.defineProperty(o,"codes",{value:a,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi256=e(),o.color.ansi16m=r(),o.bgColor.ansi256=e(10),o.bgColor.ansi16m=r(10),Object.defineProperties(o,{rgbToAnsi256:{value:(i,s,l)=>i===s&&s===l?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(s/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:i=>{const s=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(i.toString(16));if(!s)return[0,0,0];let{colorString:l}=s.groups;l.length===3&&(l=l.split("").map(u=>u+u).join(""));const c=Number.parseInt(l,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:i=>o.rgbToAnsi256(...o.hexToRgb(i)),enumerable:!1}}),o}Object.defineProperty(t,"exports",{enumerable:!0,get:n})}(mh)),mh.exports}var zM=$M();const Aw=Ja(zM);function ft(t,e){return`${t.open}${e}${t.close}`}function Lt(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function Tw(t){return typeof t=="string"?t.trim():t==null?t:Lt(t,t.toString())}function ln(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:vt}=Aw;class Mw extends Ho{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const r=[];let n=e;for(;n.parent_run_id;){const a=this.runMap.get(n.parent_run_id);if(a)r.push(a),n=a;else break}return r}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((n,a,o)=>{const i=`${n.execution_order}:${n.run_type}:${n.name}`;return a===o.length-1?ft(Aw.bold,i):i}).join(" > ");return ft(vt.grey,r)}onChainStart(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.green,"[chain/start]")} [${r}] Entering Chain run with input: ${Lt(e.inputs,"[inputs]")}`)}onChainEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.cyan,"[chain/end]")} [${r}] [${ln(e)}] Exiting Chain run with output: ${Lt(e.outputs,"[outputs]")}`)}onChainError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.red,"[chain/error]")} [${r}] [${ln(e)}] Chain run errored with error: ${Lt(e.error,"[error]")}`)}onLLMStart(e){const r=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${ft(vt.green,"[llm/start]")} [${r}] Entering LLM run with input: ${Lt(n,"[inputs]")}`)}onLLMEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.cyan,"[llm/end]")} [${r}] [${ln(e)}] Exiting LLM run with output: ${Lt(e.outputs,"[response]")}`)}onLLMError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.red,"[llm/error]")} [${r}] [${ln(e)}] LLM run errored with error: ${Lt(e.error,"[error]")}`)}onToolStart(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.green,"[tool/start]")} [${r}] Entering Tool run with input: "${Tw(e.inputs.input)}"`)}onToolEnd(e){var n;const r=this.getBreadcrumbs(e);console.log(`${ft(vt.cyan,"[tool/end]")} [${r}] [${ln(e)}] Exiting Tool run with output: "${Tw((n=e.outputs)==null?void 0:n.output)}"`)}onToolError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.red,"[tool/error]")} [${r}] [${ln(e)}] Tool run errored with error: ${Lt(e.error,"[error]")}`)}onRetrieverStart(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.green,"[retriever/start]")} [${r}] Entering Retriever run with input: ${Lt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.cyan,"[retriever/end]")} [${r}] [${ln(e)}] Exiting Retriever run with output: ${Lt(e.outputs,"[outputs]")}`)}onRetrieverError(e){const r=this.getBreadcrumbs(e);console.log(`${ft(vt.red,"[retriever/error]")} [${r}] [${ln(e)}] Retriever run errored with error: ${Lt(e.error,"[error]")}`)}onAgentAction(e){const r=e,n=this.getBreadcrumbs(e);console.log(`${ft(vt.blue,"[agent/action]")} [${n}] Agent selected action: ${Lt(r.actions[r.actions.length-1],"[action]")}`)}}gp=function(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t};function Fw(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}class UM extends Error{constructor(e,r){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=r}}h0=function(t,e=Ul){t=t.trim();const r=t.indexOf("```");if(r===-1)return e(t);let n=t.substring(r+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));const a=n.indexOf("```");let o=n;return a!==-1&&(o=n.substring(0,a)),e(o.trim())},Ul=function(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const r=[];let n=!1,a=!1;for(let o of t){if(n)o==='"'&&!a?n=!1:o===`
`&&!a?o="\\n":o==="\\"?a=!a:a=!1;else if(o==='"')n=!0,a=!1;else if(o==="{")r.push("}");else if(o==="[")r.push("]");else if(o==="}"||o==="]")if(r&&r[r.length-1]===o)r.pop();else return null;e+=o}n&&(e+='"');for(let o=r.length-1;o>=0;o-=1)e+=r[o];try{return JSON.parse(e)}catch{return null}},Xn=function(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&"source_type"in t&&(t.source_type==="url"||t.source_type==="base64"||t.source_type==="text"||t.source_type==="id")},k0=function(t){return Xn(t)&&t.source_type==="url"&&"url"in t&&typeof t.url=="string"},A0=function(t){return Xn(t)&&t.source_type==="base64"&&"data"in t&&typeof t.data=="string"},T0=function(t){if(Xn(t)){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url}};if(t.source_type==="base64"){if(!t.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${t.mime_type};base64,${t.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")},g0=function(t){const e=t.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${t}" - does not match type/subtype format.`);const r=e[0].trim(),n=e[1].trim();if(r===""||n==="")throw new Error(`Invalid mime type: "${t}" - type or subtype is empty.`);const a={};for(const o of t.split(";").slice(1)){const i=o.split("=");if(i.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${t}".`);const s=i[0].trim(),l=i[1].trim();if(s==="")throw new Error(`Invalid parameter syntax in mime type: "${t}".`);a[s]=l}return{type:r,subtype:n,parameters:a}},m0=function({dataUrl:t,asTypedArray:e=!1}){const r=t.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let n;if(r){n=r[1].toLowerCase();const a=e?Uint8Array.from(atob(r[2]),o=>o.charCodeAt(0)):r[2];return{mime_type:n,data:a}}},f0=function(t,e){if(t.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(t)}if(t.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(t)}if(t.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(t)}if(t.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(t)}throw new Error(`Unable to convert content block type '${t.type}' to provider-specific format: not recognized.`)};function Ma(t,e){return typeof t=="string"?t===""?e:typeof e=="string"?t+e:Array.isArray(e)&&e.some(r=>Xn(r))?[{type:"text",source_type:"text",text:t},...e]:[{type:"text",text:t},...e]:Array.isArray(e)?Ws(t,e)??[...t,...e]:e===""?t:Array.isArray(t)&&t.some(r=>Xn(r))?[...t,{type:"file",source_type:"text",text:e}]:[...t,{type:"text",text:e}]}function BM(t,e){return t==="error"||e==="error"?"error":"success"}function HM(t,e){function r(n,a){if(typeof n!="object"||n===null||n===void 0)return n;if(a>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>r(i,a+1));const o={};for(const i of Object.keys(n))o[i]=r(n[i],a+1);return o}return JSON.stringify(r(t,0),null,2)}class Fa extends En{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,r){typeof e=="string"&&(e={content:e,additional_kwargs:r,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const r=HM(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${r}`}}function mt(t,e){const r={...t};for(const[n,a]of Object.entries(e))if(r[n]==null)r[n]=a;else{if(a==null)continue;if(typeof r[n]!=typeof a||Array.isArray(r[n])!==Array.isArray(a))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof r[n]=="string"){if(n==="type")continue;r[n]+=a}else if(typeof r[n]=="object"&&!Array.isArray(r[n]))r[n]=mt(r[n],a);else if(Array.isArray(r[n]))r[n]=Ws(r[n],a);else{if(r[n]===a)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return r}function Ws(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const r=[...t];for(const n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){const a=r.findIndex(o=>o.index===n.index);a!==-1?r[a]=mt(r[a],n):r.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;r.push(n)}return r}}}function WM(t,e){if(!t&&!e)throw new Error("Cannot merge two undefined objects.");if(!t||!e)return t||e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return Ws(t,e);if(typeof t=="object"&&typeof e=="object")return mt(t,e);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}class Ra extends Fa{}function GM(t){return typeof t.role=="string"}Zl=function(t){return typeof(t==null?void 0:t._getType)=="function"},M0=function(t){return Zl(t)&&typeof t.concat=="function"};class qM extends Fa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,r,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:r}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}qp=class extends Ra{constructor(t){super(t),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=t.tool_call_id,this.artifact=t.artifact,this.status=t.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(t){return new qp({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),artifact:WM(this.artifact,t.artifact),tool_call_id:this.tool_call_id,id:this.id??t.id,status:BM(this.status,t.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function VM(t){const e=[],r=[];for(const n of t)if(n.function){const a=n.function.name;try{const o=JSON.parse(n.function.arguments),i={name:a||"",args:o||{},id:n.id};e.push(i)}catch{r.push({name:a,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,r]}y0=function(t){return t._getType()==="tool"},Jn=class extends Fa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(t,e){var n;let r;if(typeof t=="string")r={content:t,tool_calls:[],invalid_tool_calls:[],additional_kwargs:e??{}};else{r=t;const a=(n=r.additional_kwargs)==null?void 0:n.tool_calls,o=r.tool_calls;a!=null&&a.length>0&&(o===void 0||o.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&o===void 0){const[i,s]=VM(a);r.tool_calls=i??[],r.invalid_tool_calls=s??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}},x0=function(t){return t._getType()==="ai"},b0=function(t){return t._getType()==="ai"},co=class extends Ra{constructor(t){let e;if(typeof t=="string")e={content:t,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(t.tool_call_chunks===void 0)e={...t,tool_calls:t.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:t.usage_metadata!==void 0?t.usage_metadata:void 0};else{const r=[],n=[];for(const a of t.tool_call_chunks){let o={};try{if(o=Ul(a.args||"{}"),o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:o,id:a.id,type:"tool_call"})}catch{n.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}e={...t,tool_calls:r,invalid_tool_calls:n,usage_metadata:t.usage_metadata!==void 0?t.usage_metadata:void 0}}super(e),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=e.tool_call_chunks??this.tool_call_chunks,this.tool_calls=e.tool_calls??this.tool_calls,this.invalid_tool_calls=e.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=e.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(t){var r,n,a,o,i,s,l,c,u,d,h,p,f,y,m,_,w,A,F,b,D,B,j,G,te,de,x,R,k,E,H,N,C,P,Z,ne,le,ye,we,De;const e={content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),tool_call_chunks:[],id:this.id??t.id};if(this.tool_call_chunks!==void 0||t.tool_call_chunks!==void 0){const Xe=Ws(this.tool_call_chunks,t.tool_call_chunks);Xe!==void 0&&Xe.length>0&&(e.tool_call_chunks=Xe)}if(this.usage_metadata!==void 0||t.usage_metadata!==void 0){const Xe={...(((n=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:n.audio)!==void 0||((o=(a=t.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:o.audio)!==void 0)&&{audio:(((s=(i=this.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:s.audio)??0)+(((c=(l=t.usage_metadata)==null?void 0:l.input_token_details)==null?void 0:c.audio)??0)},...(((d=(u=this.usage_metadata)==null?void 0:u.input_token_details)==null?void 0:d.cache_read)!==void 0||((p=(h=t.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:p.cache_read)!==void 0)&&{cache_read:(((y=(f=this.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:y.cache_read)??0)+(((_=(m=t.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:_.cache_read)??0)},...(((A=(w=this.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:A.cache_creation)!==void 0||((b=(F=t.usage_metadata)==null?void 0:F.input_token_details)==null?void 0:b.cache_creation)!==void 0)&&{cache_creation:(((B=(D=this.usage_metadata)==null?void 0:D.input_token_details)==null?void 0:B.cache_creation)??0)+(((G=(j=t.usage_metadata)==null?void 0:j.input_token_details)==null?void 0:G.cache_creation)??0)}},Dt={...(((de=(te=this.usage_metadata)==null?void 0:te.output_token_details)==null?void 0:de.audio)!==void 0||((R=(x=t.usage_metadata)==null?void 0:x.output_token_details)==null?void 0:R.audio)!==void 0)&&{audio:(((E=(k=this.usage_metadata)==null?void 0:k.output_token_details)==null?void 0:E.audio)??0)+(((N=(H=t.usage_metadata)==null?void 0:H.output_token_details)==null?void 0:N.audio)??0)},...(((P=(C=this.usage_metadata)==null?void 0:C.output_token_details)==null?void 0:P.reasoning)!==void 0||((ne=(Z=t.usage_metadata)==null?void 0:Z.output_token_details)==null?void 0:ne.reasoning)!==void 0)&&{reasoning:(((ye=(le=this.usage_metadata)==null?void 0:le.output_token_details)==null?void 0:ye.reasoning)??0)+(((De=(we=t.usage_metadata)==null?void 0:we.output_token_details)==null?void 0:De.reasoning)??0)}},Ft=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Fe=t.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},dt={input_tokens:Ft.input_tokens+Fe.input_tokens,output_tokens:Ft.output_tokens+Fe.output_tokens,total_tokens:Ft.total_tokens+Fe.total_tokens,...Object.keys(Xe).length>0&&{input_token_details:Xe},...Object.keys(Dt).length>0&&{output_token_details:Dt}};e.usage_metadata=dt}return new co(e)}},Bl=class extends Fa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Bl}constructor(t,e){typeof t=="string"&&(t={content:t,role:e}),super(t),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t.role}_getType(){return"generic"}static isInstance(t){return t._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},ql=class extends Ra{static lc_name(){return"ChatMessageChunk"}constructor(t,e){typeof t=="string"&&(t={content:t,role:e}),super(t),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t.role}_getType(){return"generic"}concat(t){return new ql({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),role:this.role,id:this.id??t.id})}get _printableFields(){return{...super._printableFields,role:this.role}}},Gl=class extends Ra{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(t){return new Gl({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),name:this.name??"",id:this.id??t.id})}},to=class extends Fa{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(t,e){super(t,e)}},Hl=class extends Ra{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(t,e){super(t,e)}concat(t){return new Hl({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),id:this.id??t.id})}},no=class extends Fa{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(t,e){super(t,e)}},Wl=class extends Ra{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(t,e){super(t,e)}concat(t){return new Wl({content:Ma(this.content,t.content),additional_kwargs:mt(this.additional_kwargs,t.additional_kwargs),response_metadata:mt(this.response_metadata,t.response_metadata),id:this.id??t.id})}};function ZM(t){return Fw(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function JM(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function gh(t){let e,r;if(JM(t)){const n=t.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",r=t.kwargs}else{const{type:n,...a}=t;e=n,r=a}if(e==="human"||e==="user")return new to(r);if(e==="ai"||e==="assistant"){const{tool_calls:n,...a}=r;if(!Array.isArray(n))return new Jn(r);const o=n.map(ZM);return new Jn({...a,tool_calls:o})}else{if(e==="system")return new no(r);if(e==="developer")return new no({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in r)return new qM({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});throw gp(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}w0=function(t){if(typeof t=="string")return new to(t);if(Zl(t))return t;if(Array.isArray(t)){const[e,r]=t;return gh({type:e,content:r})}else if(GM(t)){const{role:e,...r}=t;return gh({...r,type:e})}else return gh(t)},Yp=function(t,e="Human",r="AI"){const n=[];for(const a of t){let o;if(a._getType()==="human")o=e;else if(a._getType()==="ai")o=r;else if(a._getType()==="system")o="System";else if(a._getType()==="function")o="Function";else if(a._getType()==="tool")o="Tool";else if(a._getType()==="generic")o=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);const i=a.name?`${a.name}, `:"",s=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);n.push(`${o}: ${i}${s}`)}return n.join(`
`)},d0=function(t){var r;const e=t._getType();if(e==="human")return new Hl({...t});if(e==="ai"){let n={...t};return"tool_calls"in n&&(n={...n,tool_call_chunks:(r=n.tool_calls)==null?void 0:r.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new co({...n})}else{if(e==="system")return new Wl({...t});if(e==="function")return new Gl({...t});if(Bl.isInstance(t))return new ql({...t});throw new Error("Unknown message type.")}};let yh;const KM=()=>{if(yh===void 0){const t=wn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};yh=new $o(t)}return yh};class Wo extends Ho{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:r,projectName:n,client:a,replicas:o}=e;this.projectName=n??Qu(),this.replicas=o,this.exampleId=r,this.client=a??KM();const i=Wo.getTraceableRunTree();i&&this.updateFromRunTree(i)}async persistRun(e){}async onRunCreate(e){var r;await((r=this.getRunTreeWithTracingConfig(e.id))==null?void 0:r.postRun())}async onRunUpdate(e){var r;await((r=this.getRunTreeWithTracingConfig(e.id))==null?void 0:r.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let r=e;const n=new Set;for(;r.parent_run&&!(n.has(r.id)||(n.add(r.id),!r.parent_run));)r=r.parent_run;n.clear();const a=[r];for(;a.length>0;){const o=a.shift();!o||n.has(o.id)||(n.add(o.id),this.runTreeMap.set(o.id,o),o.child_runs&&a.push(...o.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const r=this.runTreeMap.get(e);if(r)return new _t({...r,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return mM(!0)}catch{return}}}const Rw=Symbol.for("ls:tracing_async_local_storage"),Gs=Symbol.for("lc:context_variables"),YM=t=>{globalThis[Rw]=t},Go=()=>globalThis[Rw];let qo;function XM(){const t="default"in Lr?Lr.default:Lr;return new t({autoStart:!0,concurrency:1})}function QM(){return typeof qo>"u"&&(qo=XM()),qo}async function nt(t,e){if(e===!0){const r=Go();r!==void 0?await r.run(void 0,async()=>t()):await t()}else qo=QM(),qo.add(async()=>{const r=Go();r!==void 0?await r.run(void 0,async()=>t()):await t()})}const eF=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>wn(e)==="true");function Ow(t){var r,n;const e=Go();return e===void 0||(n=(r=e.getStore())==null?void 0:r[Gs])==null?void 0:n[t]}const tF=Symbol("lc:configure_hooks"),rF=()=>Ow(tF)||[];function nF(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}class aF{setHandler(e){return this.setHandlers([e])}}class qs{constructor(e,r,n,a,o,i,s,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;try{await((n=r.handleText)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleText: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleCustomEvent(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;try{await((s=i.handleCustomEvent)==null?void 0:s.call(i,e,r,this.runId,this.tags,this.metadata))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class oF extends qs{getChild(e){const r=new Ot(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetriever`),r.raiseError)throw a}},r.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreRetriever)try{await((n=r.handleRetrieverError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleRetrieverError: ${a}`),r.raiseError)throw e}},r.awaitHandlers)))}}class Nw extends qs{async handleLLMNewToken(e,r,n,a,o,i){await Promise.all(this.handlers.map(s=>nt(async()=>{var l;if(!s.ignoreLLM)try{await((l=s.handleLLMNewToken)==null?void 0:l.call(s,e,r??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMNewToken: ${c}`),s.raiseError)throw c}},s.awaitHandlers)))}async handleLLMError(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreLLM)try{await((s=i.handleLLMError)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleLLMEnd(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreLLM)try{await((s=i.handleLLMEnd)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}}class iF extends qs{getChild(e){const r=new Ot(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleChainError(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainError)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleChainEnd(e,r,n,a,o){await Promise.all(this.handlers.map(i=>nt(async()=>{var s;if(!i.ignoreChain)try{await((s=i.handleChainEnd)==null?void 0:s.call(i,e,this.runId,this._parentRunId,this.tags,o))}catch(l){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${l}`),i.raiseError)throw l}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentAction)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentAction: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleAgentEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleAgentEnd: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}}class sF extends qs{getChild(e){const r=new Ot(this.runId);return r.setHandlers(this.inheritableHandlers),r.addTags(this.inheritableTags),r.addMetadata(this.inheritableMetadata),e&&r.addTags([e],!1),r}async handleToolError(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolError)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolError: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(r=>nt(async()=>{var n;if(!r.ignoreAgent)try{await((n=r.handleToolEnd)==null?void 0:n.call(r,e,this.runId,this._parentRunId,this.tags))}catch(a){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleToolEnd: ${a}`),r.raiseError)throw a}},r.awaitHandlers)))}}Ot=class extends aF{constructor(t,e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(e==null?void 0:e.handlers)??this.handlers,this.inheritableHandlers=(e==null?void 0:e.inheritableHandlers)??this.inheritableHandlers,this.tags=(e==null?void 0:e.tags)??this.tags,this.inheritableTags=(e==null?void 0:e.inheritableTags)??this.inheritableTags,this.metadata=(e==null?void 0:e.metadata)??this.metadata,this.inheritableMetadata=(e==null?void 0:e.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=t}getParentRunId(){return this._parentRunId}async handleLLMStart(t,e,r=void 0,n=void 0,a=void 0,o=void 0,i=void 0,s=void 0){return Promise.all(e.map(async(l,c)=>{const u=c===0&&r?r:ht();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return Bo(d)&&d._createRunForLLMStart(t,[l],u,this._parentRunId,a,this.tags,this.metadata,s),nt(async()=>{var h;try{await((h=d.handleLLMStart)==null?void 0:h.call(d,t,[l],u,this._parentRunId,a,this.tags,this.metadata,s))}catch(p){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${p}`),d.raiseError)throw p}},d.awaitHandlers)})),new Nw(u,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(t,e,r=void 0,n=void 0,a=void 0,o=void 0,i=void 0,s=void 0){return Promise.all(e.map(async(l,c)=>{const u=c===0&&r?r:ht();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return Bo(d)&&d._createRunForChatModelStart(t,[l],u,this._parentRunId,a,this.tags,this.metadata,s),nt(async()=>{var h,p;try{if(d.handleChatModelStart)await((h=d.handleChatModelStart)==null?void 0:h.call(d,t,[l],u,this._parentRunId,a,this.tags,this.metadata,s));else if(d.handleLLMStart){const f=Yp(l);await((p=d.handleLLMStart)==null?void 0:p.call(d,t,[f],u,this._parentRunId,a,this.tags,this.metadata,s))}}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${f}`),d.raiseError)throw f}},d.awaitHandlers)})),new Nw(u,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(t,e,r=ht(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreChain)return Bo(s)&&s._createRunForChainStart(t,e,r,this._parentRunId,this.tags,this.metadata,n,i),nt(async()=>{var l;try{await((l=s.handleChainStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,n,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new iF(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(t,e,r=ht(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreAgent)return Bo(s)&&s._createRunForToolStart(t,e,r,this._parentRunId,this.tags,this.metadata,i),nt(async()=>{var l;try{await((l=s.handleToolStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleToolStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new sF(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(t,e,r=ht(),n=void 0,a=void 0,o=void 0,i=void 0){return await Promise.all(this.handlers.map(s=>{if(!s.ignoreRetriever)return Bo(s)&&s._createRunForRetrieverStart(t,e,r,this._parentRunId,this.tags,this.metadata,i),nt(async()=>{var l;try{await((l=s.handleRetrieverStart)==null?void 0:l.call(s,t,e,r,this._parentRunId,this.tags,this.metadata,i))}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleRetrieverStart: ${c}`),s.raiseError)throw c}},s.awaitHandlers)})),new oF(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(t,e,r,n,a){await Promise.all(this.handlers.map(o=>nt(async()=>{var i;if(!o.ignoreCustomEvent)try{await((i=o.handleCustomEvent)==null?void 0:i.call(o,t,e,r,this.tags,this.metadata))}catch(s){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${s}`),o.raiseError)throw s}},o.awaitHandlers)))}addHandler(t,e=!0){this.handlers.push(t),e&&this.inheritableHandlers.push(t)}removeHandler(t){this.handlers=this.handlers.filter(e=>e!==t),this.inheritableHandlers=this.inheritableHandlers.filter(e=>e!==t)}setHandlers(t,e=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of t)this.addHandler(r,e)}addTags(t,e=!0){this.removeTags(t),this.tags.push(...t),e&&this.inheritableTags.push(...t)}removeTags(t){this.tags=this.tags.filter(e=>!t.includes(e)),this.inheritableTags=this.inheritableTags.filter(e=>!t.includes(e))}addMetadata(t,e=!0){this.metadata={...this.metadata,...t},e&&(this.inheritableMetadata={...this.inheritableMetadata,...t})}removeMetadata(t){for(const e of Object.keys(t))delete this.metadata[e],delete this.inheritableMetadata[e]}copy(t=[],e=!0){const r=new Ot(this._parentRunId);for(const n of this.handlers){const a=this.inheritableHandlers.includes(n);r.addHandler(n,a)}for(const n of this.tags){const a=this.inheritableTags.includes(n);r.addTags([n],a)}for(const n of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(n);r.addMetadata({[n]:this.metadata[n]},a)}for(const n of t)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===n.name)||r.addHandler(n,e);return r}static fromHandlers(t){class e extends Uo{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ht()}),Object.assign(this,t)}}const r=new this;return r.addHandler(new e),r}static configure(t,e,r,n,a,o,i){return this._configureSync(t,e,r,n,a,o,i)}static _configureSync(t,e,r,n,a,o,i){var d,h;let s;(t||e)&&(Array.isArray(t)||!t?(s=new Ot,s.setHandlers((t==null?void 0:t.map(Vs))??[],!0)):s=t,s=s.copy(Array.isArray(e)?e.map(Vs):e==null?void 0:e.handlers,!1));const l=wn("LANGCHAIN_VERBOSE")==="true"||(i==null?void 0:i.verbose),c=((d=Wo.getTraceableRunTree())==null?void 0:d.tracingEnabled)||eF(),u=c||(wn("LANGCHAIN_TRACING")??!1);if(l||u){if(s||(s=new Ot),l&&!s.handlers.some(p=>p.name===Mw.prototype.name)){const p=new Mw;s.addHandler(p,!0)}if(u&&!s.handlers.some(p=>p.name==="langchain_tracer")&&c){const p=new Wo;s.addHandler(p,!0),s._parentRunId=((h=Wo.getTraceableRunTree())==null?void 0:h.id)??s._parentRunId}}for(const{contextVar:p,inheritable:f=!0,handlerClass:y,envVar:m}of rF()){const _=m&&wn(m)==="true"&&y;let w;const A=p!==void 0?Ow(p):void 0;A&&CM(A)?w=A:_&&(w=new y({})),w!==void 0&&(s||(s=new Ot),s.handlers.some(F=>F.name===w.name)||s.addHandler(w,f))}return(r||n)&&s&&(s.addTags(r??[]),s.addTags(n??[],!1)),(a||o)&&s&&(s.addMetadata(a??{}),s.addMetadata(o??{},!1)),s}};function Vs(t){return"name"in t?t:Uo.fromMethods(t)}class lF{getStore(){}run(e,r){return r()}enterWith(e){}}const cF=new lF,Iw=Symbol.for("lc:child_config");class uF{getInstance(){return Go()??cF}getRunnableConfig(){var e,r;return(r=(e=this.getInstance().getStore())==null?void 0:e.extra)==null?void 0:r[Iw]}runWithConfig(e,r,n){var u;const a=Ot._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),o=this.getInstance(),i=o.getStore(),s=a==null?void 0:a.getParentRunId(),l=(u=a==null?void 0:a.handlers)==null?void 0:u.find(d=>(d==null?void 0:d.name)==="langchain_tracer");let c;return l&&s?c=l.getRunTreeWithTracingConfig(s):n||(c=new _t({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Iw]:e}),i!==void 0&&i[Gs]!==void 0&&(c===void 0&&(c={}),c[Gs]=i[Gs]),o.run(c,r)}initializeGlobalInstance(e){Go()===void 0&&YM(e)}}const cn=new uF,_h=25;async function tr(t){return Ot._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function Pw(...t){const e={};for(const r of t.filter(n=>!!n))for(const n of Object.keys(r))if(n==="metadata")e[n]={...e[n],...r[n]};else if(n==="tags"){const a=e[n]??[];e[n]=[...new Set(a.concat(r[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...r[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=r.timeout:r.timeout!==void 0&&(e.timeout=Math.min(e.timeout,r.timeout));else if(n==="signal")e.signal===void 0?e.signal=r.signal:r.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,r.signal]):e.signal=r.signal);else if(n==="callbacks"){const a=e.callbacks,o=r.callbacks;if(Array.isArray(o))if(!a)e.callbacks=o;else if(Array.isArray(a))e.callbacks=a.concat(o);else{const i=a.copy();for(const s of o)i.addHandler(Vs(s),!0);e.callbacks=i}else if(o)if(!a)e.callbacks=o;else if(Array.isArray(a)){const i=o.copy();for(const s of a)i.addHandler(Vs(s),!0);e.callbacks=i}else e.callbacks=new Ot(o._parentRunId,{handlers:a.handlers.concat(o.handlers),inheritableHandlers:a.inheritableHandlers.concat(o.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(o.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(o.inheritableTags))),metadata:{...a.metadata,...o.metadata}})}else{const a=n;e[a]=r[a]??e[a]}return e}const dF=new Set(["string","number","boolean"]);Ie=function(t){var n;const e=cn.getRunnableConfig();let r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:a,runName:o,...i}=e;r=Object.entries(i).reduce((s,[l,c])=>(c!==void 0&&(s[l]=c),s),r)}if(t&&(r=Object.entries(t).reduce((a,[o,i])=>(i!==void 0&&(a[o]=i),a),r)),r==null?void 0:r.configurable)for(const a of Object.keys(r.configurable))dF.has(typeof r.configurable[a])&&!((n=r.metadata)!=null&&n[a])&&(r.metadata||(r.metadata={}),r.metadata[a]=r.configurable[a]);if(r.timeout!==void 0){if(r.timeout<=0)throw new Error("Timeout must be a positive number");const a=AbortSignal.timeout(r.timeout);r.signal!==void 0?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,a])):r.signal=a,delete r.timeout}return r};function ut(t={},{callbacks:e,maxConcurrency:r,recursionLimit:n,runName:a,configurable:o,runId:i}={}){const s=Ie(t);return e!==void 0&&(delete s.runName,s.callbacks=e),n!==void 0&&(s.recursionLimit=n),r!==void 0&&(s.maxConcurrency=r),a!==void 0&&(s.runName=a),o!==void 0&&(s.configurable={...s.configurable,...o}),i!==void 0&&delete s.runId,s}function Oa(t){return t?{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal}:void 0}async function un(t,e){if(e===void 0)return t;let r;return Promise.race([t.catch(n=>{if(!(e!=null&&e.aborted))throw n}),new Promise((n,a)=>{r=()=>{a(new Error("Aborted"))},e.addEventListener("abort",r),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",r))}class Mt extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const r=this.reader.cancel();this.reader.releaseLock(),await r}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const r=e.getReader();return new Mt({start(n){return a();function a(){return r.read().then(({done:o,value:i})=>{if(o){n.close();return}return n.enqueue(i),a()})}},cancel(){r.releaseLock()}})}static fromAsyncGenerator(e){return new Mt({async pull(r){const{value:n,done:a}=await e.next();a&&r.close(),r.enqueue(n)},async cancel(r){await e.return(r)}})}}function Cw(t,e=2){const r=Array.from({length:e},()=>[]);return r.map(async function*(n){for(;;)if(n.length===0){const a=await t.next();for(const o of r)o.push(a)}else{if(n[0].done)return;yield n.shift().value}})}hr=function(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string"||typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const r={...t};for(const[n,a]of Object.entries(e))n in r&&!Array.isArray(r[n])?r[n]=hr(r[n],a):r[n]=a;return r}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)};class Na{constructor(e){var r;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((r=this.config)==null?void 0:r.signal),this.setup=new Promise((n,a)=>{cn.runWithConfig(Oa(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,a):this.firstResult.then(o=>n(void 0),a)},!0)})}async next(...e){var r;return(r=this.signal)==null||r.throwIfAborted(),this.firstResultUsed?cn.runWithConfig(Oa(this.config),this.signal?async()=>un(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function hF(t,e,r,n,...a){const o=new Na({generator:e,startSetup:r,signal:n}),i=await o.setup;return{output:t(o,i,...a),setup:i}}class dn{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const r=this.ops.concat(e.ops),n=Us({},r);return new Vo({ops:r,state:n[n.length-1].newDocument})}}class Vo extends dn{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const r=this.ops.concat(e.ops),n=Us(this.state,e.ops);return new Vo({ops:r,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){const r=Us({},e.ops);return new Vo({ops:e.ops,state:r[r.length-1].newDocument})}}const pF=t=>t.name==="log_stream_tracer";async function jw(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:r}=t;if(["retriever","llm","prompt"].includes(t.run_type))return r;if(!(Object.keys(r).length===1&&(r==null?void 0:r.input)===""))return r.input}async function Lw(t,e){const{outputs:r}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?r:r!==void 0&&Object.keys(r).length===1&&(r==null?void 0:r.output)!==void 0?r.output:r}function fF(t){return t!==void 0&&t.message!==void 0}class Dw extends Ho{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Mt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||r.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&r.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,r){for await(const n of r){if(e!==this.rootId){const a=this.keyMapByRunId[e];a&&await this.writer.write(new dn({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new dn({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const r=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=r===1?e.name:`${e.name}:${r}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await jw(e,this._schemaFormat)),await this.writer.write(new dn({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const r=this.keyMapByRunId[e.id];if(r===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${r}/inputs`,value:await jw(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${r}/final_output`,value:await Lw(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${r}/end_time`,value:new Date(e.end_time).toISOString()});const a=new dn({ops:n});await this.writer.write(a)}finally{if(e.id===this.rootId){const r=new dn({ops:[{op:"replace",path:"/final_output",value:await Lw(e,this._schemaFormat)}]});await this.writer.write(r),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,r,n){const a=this.keyMapByRunId[e.id];if(a===void 0)return;const o=e.inputs.messages!==void 0;let i;o?fF(n==null?void 0:n.chunk)?i=n==null?void 0:n.chunk:i=new co({id:`run-${e.id}`,content:r}):i=r;const s=new dn({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:r},{op:"add",path:`/logs/${a}/streamed_output/-`,value:i}]});await this.writer.write(s)}}S0="__run",lo=class{constructor(t){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=t.text,this.generationInfo=t.generationInfo}concat(t){return new lo({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo}})}},rf=class extends lo{constructor(t){super(t),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=t.message}concat(t){return new rf({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};function Zs({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const mF=t=>t.name==="event_stream_tracer";class gF extends Ho{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Mt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const r=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||r.find(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&r.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}async*tapOutputIterable(e,r){const n=await r.next();if(n.done)return;const a=this.runInfoMap.get(e);if(a===void 0){yield n.value;return}function o(s,l){return s==="llm"&&typeof l=="string"?new lo({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let s;i=new Promise(l=>{s=l}),this.tappedPromises.set(e,i);try{const l={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...l,data:{chunk:o(a.runType,n.value)}},a),yield n.value;for await(const c of r)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...l,data:{chunk:o(a.runType,c)}},a),yield c}finally{s()}}else{yield n.value;for await(const s of r)yield s}}async send(e,r){this._includeRun(r)&&await this.writer.write(e)}async sendEndEvent(e,r){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,r)}):await this.send(e,r)}async onLLMStart(e){var i,s;const r=Zs(e),n=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,a);const o=`on_${n}_start`;await this.send({event:o,data:{input:e.inputs},name:r,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},a)}async onLLMNewToken(e,r,n){const a=this.runInfoMap.get(e.id);let o,i;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")i="on_chat_model_stream",(n==null?void 0:n.chunk)===void 0?o=new co({content:r,id:`run-${e.id}`}):o=n.chunk.message;else if(a.runType==="llm")i="on_llm_stream",(n==null?void 0:n.chunk)===void 0?o=new lo({text:r}):o=n.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:i,data:{chunk:o},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var i,s,l;const r=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(r===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=(i=e.outputs)==null?void 0:i.generations;let o;if(r.runType==="chat_model"){for(const c of a??[]){if(o!==void 0)break;o=(s=c[0])==null?void 0:s.message}n="on_chat_model_end"}else if(r.runType==="llm")o={generations:a==null?void 0:a.map(c=>c.map(u=>({text:u.text,generationInfo:u.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${r.runType}`);await this.sendEndEvent({event:n,data:{output:o,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onChainStart(e){var i,s;const r=Zs(e),n=e.run_type??"chain",a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:r,runType:e.run_type};let o={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(o={},a.inputs={}):e.inputs.input!==void 0?(o.input=e.inputs.input,a.inputs=e.inputs.input):(o.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${n}_start`,data:o,name:r,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},a)}async onChainEnd(e){var i;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,a=e.inputs??r.inputs??{},o={output:((i=e.outputs)==null?void 0:i.output)??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(o.input=a.input,r.inputs=a.input),await this.sendEndEvent({event:n,data:o,run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata??{}},r)}async onToolStart(e){var a,o;const r=Zs(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:r,run_id:e.id,tags:e.tags??[],metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onToolEnd(e){var a;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(r.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onRetrieverStart(e){var a,o;const r=Zs(e),n={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:r,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,n),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:r,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},n)}async onRetrieverEnd(e){var n;const r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((n=e.outputs)==null?void 0:n.documents)??e.outputs,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async handleCustomEvent(e,r,n){const a=this.runInfoMap.get(n);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:a.tags,metadata:a.metadata,data:r},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const yF=[400,401,402,403,404,405,406,407,409],_F=t=>{var r,n;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((r=t==null?void 0:t.response)==null?void 0:r.status)??(t==null?void 0:t.status);if(e&&yF.includes(+e))throw t;if(((n=t==null?void 0:t.error)==null?void 0:n.code)==="insufficient_quota"){const a=new Error(t==null?void 0:t.message);throw a.name="InsufficientQuotaError",a}};xi=class{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.onFailedAttempt=t.onFailedAttempt??_F;const e="default"in Lr?Lr.default:Lr;this.queue=new e({concurrency:this.maxConcurrency})}call(t,...e){return this.queue.add(()=>Ts(()=>t(...e).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){return t.signal?Promise.race([this.call(e,...r),new Promise((n,a)=>{var o;(o=t.signal)==null||o.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(e,...r)}fetch(...t){return this.call(()=>fetch(...t).then(e=>e.ok?e:Promise.reject(e)))}};class $w extends Ho{constructor({config:e,onStart:r,onEnd:n,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=r,this.argOnEnd=n,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function vh(t){return t?t.lc_runnable:!1}class vF{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,r){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const a=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(r)),this.includeTags!==void 0&&(n=n||a.some(o=>{var i;return(i=this.includeTags)==null?void 0:i.includes(o)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(r)),this.excludeTags!==void 0&&(n=n&&a.every(o=>{var i;return!((i=this.excludeTags)!=null&&i.includes(o))})),n}}function wh(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}const wF=["*","_","`"];function bF(t){let e="";for(const[r,n]of Object.entries(t))e+=`	classDef ${r} ${n};
`;return e}function EF(t,e,r){const{firstNode:n,lastNode:a,nodeColors:o,withStyles:i=!0,curveStyle:s="linear",wrapLabelNWords:l=9}=r??{};let c=i?`%%{init: {'flowchart': {'curve': '${s}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const p="default",f={[p]:"{0}({1})"};n!==void 0&&(f[n]="{0}([{1}]):::first"),a!==void 0&&(f[a]="{0}([{1}]):::last");for(const[y,m]of Object.entries(t)){const _=m.name.split(":").pop()??"";let w=wF.some(F=>_.startsWith(F)&&_.endsWith(F))?`<p>${_}</p>`:_;Object.keys(m.metadata??{}).length&&(w+=`<hr/><small><em>${Object.entries(m.metadata??{}).map(([F,b])=>`${F} = ${b}`).join(`
`)}</em></small>`);const A=(f[y]??f[p]).replace("{0}",wh(y)).replace("{1}",w);c+=`	${A}
`}}const u={};for(const p of e){const f=p.source.split(":"),y=p.target.split(":"),m=f.filter((_,w)=>_===y[w]).join(":");u[m]||(u[m]=[]),u[m].push(p)}const d=new Set;function h(p,f){const y=p.length===1&&p[0].source===p[0].target;if(f&&!y){const m=f.split(":").pop();if(d.has(m))throw new Error(`Found duplicate subgraph '${m}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(m),c+=`	subgraph ${m}
`}for(const m of p){const{source:_,target:w,data:A,conditional:F}=m;let b="";if(A!==void 0){let D=A;const B=D.split(" ");B.length>l&&(D=Array.from({length:Math.ceil(B.length/l)},(j,G)=>B.slice(G*l,(G+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),b=F?` -. &nbsp;${D}&nbsp; .-> `:` -- &nbsp;${D}&nbsp; --> `}else b=F?" -.-> ":" --> ";c+=`	${wh(_)}${b}${wh(w)};
`}for(const m in u)m.startsWith(`${f}:`)&&m!==f&&h(u[m],m);f&&!y&&(c+=`	end
`)}h(u[""]??[],"");for(const p in u)!p.includes(":")&&p!==""&&h(u[p],p);return i&&(c+=bF(o??{})),c}async function SF(t,e){let{backgroundColor:r="white"}=e??{};const n=btoa(t);r!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));const a=`https://mermaid.ink/img/${n}?bgColor=${r}`,o=await fetch(a);if(!o.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${o.status}`,`Status text: ${o.statusText}`].join(`
`));return await o.blob()}function Js(t,e,r){function n(s,l){var c;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(c=s._zod).traits??(c.traits=new Set),s._zod.traits.add(t),e(s,l);for(const u in i.prototype)u in s||Object.defineProperty(s,u,{value:i.prototype[u].bind(s)});s._zod.constr=i,s._zod.def=l}const a=(r==null?void 0:r.Parent)??Object;class o extends a{}Object.defineProperty(o,"name",{value:t});function i(s){var l;const c=r!=null&&r.Parent?new o:this;n(c,s),(l=c._zod).deferred??(l.deferred=[]);for(const u of c._zod.deferred)u();return c}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:s=>{var l,c;return r!=null&&r.Parent&&s instanceof r.Parent?!0:(c=(l=s==null?void 0:s._zod)==null?void 0:l.traits)==null?void 0:c.has(t)}}),Object.defineProperty(i,"name",{value:t}),i}class Ks extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const xF={};function Ys(t){return xF}function kF(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,n])=>e.indexOf(+r)===-1).map(([r,n])=>n)}function AF(t,e){return typeof e=="bigint"?e.toString():e}function TF(t,e,r){Object.defineProperty(t,e,{get(){{const n=r();return t[e]=n,n}},set(n){Object.defineProperty(t,e,{value:n})},configurable:!0})}function MF(t=10){const e="abcdefghijklmnopqrstuvwxyz";let r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}const zw=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function Xs(t,e,r){const n=new t._zod.constr(e??t._zod.def);return(!e||r!=null&&r.parent)&&(n._zod.parent=t),n}function FF(t){return{}}function bh(t,e=0){for(let r=e;r<t.issues.length;r++)if(t.issues[r].continue!==!0)return!0;return!1}function Qs(t){return typeof t=="string"?t:t==null?void 0:t.message}function el(t,e,r){var a,o,i,s,l,c;const n={...t,path:t.path??[]};if(!t.message){const u=Qs((i=(o=(a=t.inst)==null?void 0:a._zod.def)==null?void 0:o.error)==null?void 0:i.call(o,t))??Qs((s=e==null?void 0:e.error)==null?void 0:s.call(e,t))??Qs((l=r.customError)==null?void 0:l.call(r,t))??Qs((c=r.localeError)==null?void 0:c.call(r,t))??"Invalid input";n.message=u}return delete n.inst,delete n.continue,e!=null&&e.reportInput||delete n.input,n}const Uw=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,AF,2)},enumerable:!0})},RF=Js("$ZodError",Uw),tl=Js("$ZodError",Uw,{Parent:Error}),OF=t=>(e,r,n,a)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new Ks;if(i.issues.length){const s=new((a==null?void 0:a.Err)??t)(i.issues.map(l=>el(l,o,Ys())));throw zw(s,a==null?void 0:a.callee),s}return i.value},NF=OF(tl),IF=t=>async(e,r,n,a)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let i=e._zod.run({value:r,issues:[]},o);if(i instanceof Promise&&(i=await i),i.issues.length){const s=new((a==null?void 0:a.Err)??t)(i.issues.map(l=>el(l,o,Ys())));throw zw(s,a==null?void 0:a.callee),s}return i.value},PF=IF(tl),CF=t=>(e,r,n)=>{const a=n?{...n,async:!1}:{async:!1},o=e._zod.run({value:r,issues:[]},a);if(o instanceof Promise)throw new Ks;return o.issues.length?{success:!1,error:new(t??RF)(o.issues.map(i=>el(i,a,Ys())))}:{success:!0,data:o.value}},jF=CF(tl),LF=t=>async(e,r,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let o=e._zod.run({value:r,issues:[]},a);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new t(o.issues.map(i=>el(i,a,Ys())))}:{success:!0,data:o.value}},DF=LF(tl),$F={major:4,minor:0,patch:0},zF=Js("$ZodType",(t,e)=>{var a;var r;t??(t={}),TF(t._zod,"id",()=>e.type+"_"+MF(10)),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=$F;const n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(const o of n)for(const i of o._zod.onattach)i(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),(a=t._zod.deferred)==null||a.push(()=>{t._zod.run=t._zod.parse});else{const o=(i,s,l)=>{let c=bh(i),u;for(const d of s){if(d._zod.when){if(!d._zod.when(i))continue}else if(c)continue;const h=i.issues.length,p=d._zod.check(i);if(p instanceof Promise&&(l==null?void 0:l.async)===!1)throw new Ks;if(u||p instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await p,i.issues.length!==h&&(c||(c=bh(i,h)))});else{if(i.issues.length===h)continue;c||(c=bh(i,h))}}return u?u.then(()=>i):i};t._zod.run=(i,s)=>{const l=t._zod.parse(i,s);if(l instanceof Promise){if(s.async===!1)throw new Ks;return l.then(c=>o(c,n,s))}return o(l,n,s)}}t["~standard"]={validate:o=>{var i;try{const s=jF(t,o);return s.success?{value:s.data}:{issues:(i=s.error)==null?void 0:i.issues}}catch{return DF(t,o).then(s=>{var l;return s.success?{value:s.data}:{issues:(l=s.error)==null?void 0:l.issues}})}},vendor:"zod",version:1}}),UF=Js("$ZodNever",(t,e)=>{zF.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)});class Bw{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...r){const n=r[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){const r=e._zod.parent;if(r){const n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function BF(){return new Bw}const hn=BF();function HF(t,e){return new t({type:"never",...FF()})}class Hw{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??hn,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,r={path:[],schemaPath:[]}){var u,d,h;var n;const a=e._zod.def,o={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;const s={schema:{},count:1,cycle:void 0};this.seen.set(e,s);const l=(d=(u=e._zod).toJSONSchema)==null?void 0:d.call(u);if(l)s.schema=l;else{const p={...r,schemaPath:[...r.schemaPath,e],path:r.path},f=e._zod.parent;if(f)s.ref=f,this.process(f,p),this.seen.get(f).isParent=!0;else{const y=s.schema;switch(a.type){case"string":{const m=y;m.type="string";const{minimum:_,maximum:w,format:A,patterns:F,contentEncoding:b}=e._zod.bag;if(typeof _=="number"&&(m.minLength=_),typeof w=="number"&&(m.maxLength=w),A&&(m.format=o[A]??A,m.format===""&&delete m.format),b&&(m.contentEncoding=b),F&&F.size>0){const D=[...F];D.length===1?m.pattern=D[0].source:D.length>1&&(s.schema.allOf=[...D.map(B=>({...this.target==="draft-7"?{type:"string"}:{},pattern:B.source}))])}break}case"number":{const m=y,{minimum:_,maximum:w,format:A,multipleOf:F,exclusiveMaximum:b,exclusiveMinimum:D}=e._zod.bag;typeof A=="string"&&A.includes("int")?m.type="integer":m.type="number",typeof D=="number"&&(m.exclusiveMinimum=D),typeof _=="number"&&(m.minimum=_,typeof D=="number"&&(D>=_?delete m.minimum:delete m.exclusiveMinimum)),typeof b=="number"&&(m.exclusiveMaximum=b),typeof w=="number"&&(m.maximum=w,typeof b=="number"&&(b<=w?delete m.maximum:delete m.exclusiveMaximum)),typeof F=="number"&&(m.multipleOf=F);break}case"boolean":{const m=y;m.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"undefined":{const m=y;m.type="null";break}case"null":{y.type="null";break}case"any":break;case"unknown":break;case"never":{y.not={};break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const m=y,{minimum:_,maximum:w}=e._zod.bag;typeof _=="number"&&(m.minItems=_),typeof w=="number"&&(m.maxItems=w),m.type="array",m.items=this.process(a.element,{...p,path:[...p.path,"items"]});break}case"object":{const m=y;m.type="object",m.properties={};const _=a.shape;for(const F in _)m.properties[F]=this.process(_[F],{...p,path:[...p.path,"properties",F]});const w=new Set(Object.keys(_)),A=new Set([...w].filter(F=>{const b=a.shape[F]._zod;return this.io==="input"?b.optin===void 0:b.optout===void 0}));A.size>0&&(m.required=Array.from(A)),((h=a.catchall)==null?void 0:h._zod.def.type)==="never"?m.additionalProperties=!1:a.catchall?a.catchall&&(m.additionalProperties=this.process(a.catchall,{...p,path:[...p.path,"additionalProperties"]})):this.io==="output"&&(m.additionalProperties=!1);break}case"union":{const m=y;m.anyOf=a.options.map((_,w)=>this.process(_,{...p,path:[...p.path,"anyOf",w]}));break}case"intersection":{const m=y,_=this.process(a.left,{...p,path:[...p.path,"allOf",0]}),w=this.process(a.right,{...p,path:[...p.path,"allOf",1]}),A=b=>"allOf"in b&&Object.keys(b).length===1,F=[...A(_)?_.allOf:[_],...A(w)?w.allOf:[w]];m.allOf=F;break}case"tuple":{const m=y;m.type="array";const _=a.items.map((F,b)=>this.process(F,{...p,path:[...p.path,"prefixItems",b]}));if(this.target==="draft-2020-12"?m.prefixItems=_:m.items=_,a.rest){const F=this.process(a.rest,{...p,path:[...p.path,"items"]});this.target==="draft-2020-12"?m.items=F:m.additionalItems=F}a.rest&&(m.items=this.process(a.rest,{...p,path:[...p.path,"items"]}));const{minimum:w,maximum:A}=e._zod.bag;typeof w=="number"&&(m.minItems=w),typeof A=="number"&&(m.maxItems=A);break}case"record":{const m=y;m.type="object",m.propertyNames=this.process(a.keyType,{...p,path:[...p.path,"propertyNames"]}),m.additionalProperties=this.process(a.valueType,{...p,path:[...p.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const m=y,_=kF(a.entries);_.every(w=>typeof w=="number")&&(m.type="number"),_.every(w=>typeof w=="string")&&(m.type="string"),m.enum=_;break}case"literal":{const m=y,_=[];for(const w of a.values)if(w===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof w=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");_.push(Number(w))}else _.push(w);if(_.length!==0)if(_.length===1){const w=_[0];m.type=w===null?"null":typeof w,m.const=w}else _.every(w=>typeof w=="number")&&(m.type="number"),_.every(w=>typeof w=="string")&&(m.type="string"),_.every(w=>typeof w=="boolean")&&(m.type="string"),_.every(w=>w===null)&&(m.type="null"),m.enum=_;break}case"file":{const m=y,_={type:"string",format:"binary",contentEncoding:"binary"},{minimum:w,maximum:A,mime:F}=e._zod.bag;w!==void 0&&(_.minLength=w),A!==void 0&&(_.maxLength=A),F?F.length===1?(_.contentMediaType=F[0],Object.assign(m,_)):m.anyOf=F.map(b=>({..._,contentMediaType:b})):Object.assign(m,_);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const m=this.process(a.innerType,p);y.anyOf=[m,{type:"null"}];break}case"nonoptional":{this.process(a.innerType,p),s.ref=a.innerType;break}case"success":{const m=y;m.type="boolean";break}case"default":{this.process(a.innerType,p),s.ref=a.innerType,y.default=JSON.parse(JSON.stringify(a.defaultValue));break}case"prefault":{this.process(a.innerType,p),s.ref=a.innerType,this.io==="input"&&(y._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break}case"catch":{this.process(a.innerType,p),s.ref=a.innerType;let m;try{m=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}y.default=m;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const m=y,_=e._zod.pattern;if(!_)throw new Error("Pattern not found in template literal");m.type="string",m.pattern=_.source;break}case"pipe":{const m=this.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;this.process(m,p),s.ref=m;break}case"readonly":{this.process(a.innerType,p),s.ref=a.innerType,y.readOnly=!0;break}case"promise":{this.process(a.innerType,p),s.ref=a.innerType;break}case"optional":{this.process(a.innerType,p),s.ref=a.innerType;break}case"lazy":{const m=e._zod.innerType;this.process(m,p),s.ref=m;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(s.schema,c),this.io==="input"&&at(e)&&(delete s.schema.examples,delete s.schema.default),this.io==="input"&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,this.seen.get(e).schema}emit(e,r){var u,d,h,p;const n={cycles:(r==null?void 0:r.cycles)??"ref",reused:(r==null?void 0:r.reused)??"inline",external:(r==null?void 0:r.external)??void 0},a=this.seen.get(e);if(!a)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=f=>{var w;const y=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const A=(w=n.external.registry.get(f[0]))==null?void 0:w.id;if(A)return{ref:n.external.uri(A)};const F=f[1].defId??f[1].schema.id??`schema${this.counter++}`;return f[1].defId=F,{defId:F,ref:`${n.external.uri("__shared")}#/${y}/${F}`}}if(f[1]===a)return{ref:"#"};const m=`#/${y}/`,_=f[1].schema.id??`__schema${this.counter++}`;return{defId:_,ref:m+_}},i=f=>{if(f[1].schema.$ref)return;const y=f[1],{ref:m,defId:_}=o(f);y.def={...y.schema},_&&(y.defId=_);const w=y.schema;for(const A in w)delete w[A];w.$ref=m};for(const f of this.seen.entries()){const y=f[1];if(e===f[0]){i(f);continue}if(n.external){const m=(u=n.external.registry.get(f[0]))==null?void 0:u.id;if(e!==f[0]&&m){i(f);continue}}if((d=this.metadataRegistry.get(f[0]))!=null&&d.id){i(f);continue}if(y.cycle){if(n.cycles==="throw")throw new Error(`Cycle detected: #/${(h=y.cycle)==null?void 0:h.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);n.cycles==="ref"&&i(f);continue}if(y.count>1&&n.reused==="ref"){i(f);continue}}const s=(f,y)=>{const m=this.seen.get(f),_=m.def??m.schema,w={..._};if(m.ref===null)return;const A=m.ref;if(m.ref=null,A){s(A,y);const F=this.seen.get(A).schema;F.$ref&&y.target==="draft-7"?(_.allOf=_.allOf??[],_.allOf.push(F)):(Object.assign(_,F),Object.assign(_,w))}m.isParent||this.override({zodSchema:f,jsonSchema:_})};for(const f of[...this.seen.entries()].reverse())s(f[0],{target:this.target});const l={};this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(l,a.def);const c=((p=n.external)==null?void 0:p.defs)??{};for(const f of this.seen.entries()){const y=f[1];y.def&&y.defId&&(c[y.defId]=y.def)}!n.external&&Object.keys(c).length>0&&(this.target==="draft-2020-12"?l.$defs=c:l.definitions=c);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function Ww(t,e){if(t instanceof Bw){const n=new Hw(e),a={};for(const s of t._idmap.entries()){const[l,c]=s;n.process(c)}const o={},i={registry:t,uri:s=>s,defs:a};for(const s of t._idmap.entries()){const[l,c]=s;o[l]=n.emit(c,{...e,external:i})}if(Object.keys(a).length>0){const s=n.target==="draft-2020-12"?"$defs":"definitions";o.__shared={[s]:a}}return{schemas:o}}const r=new Hw(e);return r.process(t),r.emit(t,e)}function at(t,e){const r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);const n=t._zod.def;switch(n.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return at(n.element,r);case"object":{for(const a in n.shape)if(at(n.shape[a],r))return!0;return!1}case"union":{for(const a of n.options)if(at(a,r))return!0;return!1}case"intersection":return at(n.left,r)||at(n.right,r);case"tuple":{for(const a of n.items)if(at(a,r))return!0;return!!(n.rest&&at(n.rest,r))}case"record":return at(n.keyType,r)||at(n.valueType,r);case"map":return at(n.keyType,r)||at(n.valueType,r);case"set":return at(n.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return at(n.innerType,r);case"lazy":return at(n.getter(),r);case"default":return at(n.innerType,r);case"prefault":return at(n.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return at(n.in,r)||at(n.out,r);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${n.type}`)}const WF=Symbol("Let zodToJsonSchema decide on which parser to use"),GF={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},qF=t=>({...GF,...t}),VF=t=>{const e=qF(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Gw(t,e,r,n){n!=null&&n.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function je(t,e,r,n,a){t[e]=r,Gw(t,e,n,a)}function ZF(){return{}}function JF(t,e){var n,a;const r={type:"array"};return((a=(n=t.type)==null?void 0:n._def)==null?void 0:a.typeName)!==Q.ZodAny&&(r.items=Pe(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&je(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&je(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(je(r,"minItems",t.exactLength.value,t.exactLength.message,e),je(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function KF(t,e){const r={type:"integer",format:"int64"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?je(r,"minimum",n.value,n.message,e):je(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),je(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?je(r,"maximum",n.value,n.message,e):je(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),je(r,"maximum",n.value,n.message,e));break;case"multipleOf":je(r,"multipleOf",n.value,n.message,e);break}return r}function YF(){return{type:"boolean"}}function XF(t,e){return Pe(t.type._def,e)}const QF=(t,e)=>Pe(t.innerType._def,e);function qw(t,e,r){const n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>qw(t,e,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return eR(t,e)}}const eR=(t,e)=>{const r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(const n of t.checks)switch(n.kind){case"min":je(r,"minimum",n.value,n.message,e);break;case"max":je(r,"maximum",n.value,n.message,e);break}return r};function tR(t,e){return{...Pe(t.innerType._def,e),default:t.defaultValue()}}function rR(t,e){return e.effectStrategy==="input"?Pe(t.schema._def,e):{}}function nR(t){return{type:"string",enum:t.values}}const aR=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function oR(t,e){const r=[Pe(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Pe(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o);let n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return r.forEach(o=>{if(aR(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let i=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:s,...l}=o;i=l}else n=void 0;a.push(i)}}),a.length?{allOf:a,...n}:void 0}function iR(t,e){const r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}let Eh;const Ln={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Eh===void 0&&(Eh=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Eh),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Vw(t,e){const r={type:"string"};function n(a){return e.patternStrategy==="escape"?sR(a):a}if(t.checks)for(const a of t.checks)switch(a.kind){case"min":je(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e);break;case"max":je(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"email":switch(e.emailStrategy){case"format:email":rr(r,"email",a.message,e);break;case"format:idn-email":rr(r,"idn-email",a.message,e);break;case"pattern:zod":nr(r,Ln.email,a.message,e);break}break;case"url":rr(r,"uri",a.message,e);break;case"uuid":rr(r,"uuid",a.message,e);break;case"regex":nr(r,a.regex,a.message,e);break;case"cuid":nr(r,Ln.cuid,a.message,e);break;case"cuid2":nr(r,Ln.cuid2,a.message,e);break;case"startsWith":nr(r,RegExp(`^${n(a.value)}`),a.message,e);break;case"endsWith":nr(r,RegExp(`${n(a.value)}$`),a.message,e);break;case"datetime":rr(r,"date-time",a.message,e);break;case"date":rr(r,"date",a.message,e);break;case"time":rr(r,"time",a.message,e);break;case"duration":rr(r,"duration",a.message,e);break;case"length":je(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,a.value):a.value,a.message,e),je(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,a.value):a.value,a.message,e);break;case"includes":{nr(r,RegExp(n(a.value)),a.message,e);break}case"ip":{a.version!=="v6"&&rr(r,"ipv4",a.message,e),a.version!=="v4"&&rr(r,"ipv6",a.message,e);break}case"emoji":nr(r,Ln.emoji,a.message,e);break;case"ulid":{nr(r,Ln.ulid,a.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{rr(r,"binary",a.message,e);break}case"contentEncoding:base64":{je(r,"contentEncoding","base64",a.message,e);break}case"pattern:zod":{nr(r,Ln.base64,a.message,e);break}}break}case"nanoid":nr(r,Ln.nanoid,a.message,e)}return r}const sR=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),rr=(t,e,r,n)=>{var a;t.format||(a=t.anyOf)!=null&&a.some(o=>o.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):je(t,"format",e,r,n)},nr=(t,e,r,n)=>{var a;t.pattern||(a=t.allOf)!=null&&a.some(o=>o.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Zw(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):je(t,"pattern",Zw(e,n),r,n)},Zw=(t,e)=>{var c;const r=typeof t=="function"?t():t;if(!e.applyRegexFlags||!r.flags)return r.source;const n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},a=n.i?r.source.toLowerCase():r.source;let o="",i=!1,s=!1,l=!1;for(let u=0;u<a.length;u++){if(i){o+=a[u],i=!1;continue}if(n.i){if(s){if(a[u].match(/[a-z]/)){l?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),l=!1):a[u+1]==="-"&&((c=a[u+2])!=null&&c.match(/[a-z]/))?(o+=a[u],l=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(n.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[u]==="."){o+=s?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?i=!0:s&&a[u]==="]"?s=!1:!s&&a[u]==="["&&(s=!0)}try{const u=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return o};function Jw(t,e){var n,a,o,i;if(e.target==="openApi3"&&((n=t.keyType)==null?void 0:n._def.typeName)===Q.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((s,l)=>({...s,[l]:Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const r={type:"object",additionalProperties:Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return r;if(((a=t.keyType)==null?void 0:a._def.typeName)===Q.ZodString&&((o=t.keyType._def.checks)!=null&&o.length)){const s=Object.entries(Vw(t.keyType._def,e)).reduce((l,[c,u])=>c==="type"?l:{...l,[c]:u},{});return{...r,propertyNames:s}}else if(((i=t.keyType)==null?void 0:i._def.typeName)===Q.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};return r}function lR(t,e){if(e.mapStrategy==="record")return Jw(t,e);const r=Pe(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function cR(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),n=Array.from(new Set(r.map(a=>typeof a)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:r}}function uR(){return{not:{}}}function dR(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const rl={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function hR(t,e){if(e.target==="openApi3")return Kw(t,e);const r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in rl&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const i=rl[o._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const i=typeof o._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,i,s)=>s.indexOf(o)===i);return{type:a.length>1?a:a[0],enum:r.reduce((o,i)=>o.includes(i._def.value)?o:[...o,i._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return Kw(t,e)}const Kw=(t,e)=>{const r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,a)=>Pe(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function pR(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:rl[t.innerType._def.typeName],nullable:!0}:{type:[rl[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const n=Pe(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=Pe(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function fR(t,e){const r={type:"number"};if(!t.checks)return r;for(const n of t.checks)switch(n.kind){case"int":r.type="integer",Gw(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?je(r,"minimum",n.value,n.message,e):je(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),je(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?je(r,"maximum",n.value,n.message,e):je(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),je(r,"maximum",n.value,n.message,e));break;case"multipleOf":je(r,"multipleOf",n.value,n.message,e);break}return r}function mR(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":Pe(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":Pe(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function gR(t,e){const r={type:"object",...Object.entries(t.shape()).reduce((n,[a,o])=>{if(o===void 0||o._def===void 0)return n;const i=Pe(o._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});return i===void 0?n:{properties:{...n.properties,[a]:i},required:o.isOptional()?n.required:[...n.required,a]}},{properties:{},required:[]}),additionalProperties:mR(t,e)};return r.required.length||delete r.required,r}const yR=(t,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Pe(t.innerType._def,e);const r=Pe(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},_R=(t,e)=>{if(e.pipeStrategy==="input")return Pe(t.in._def,e);if(e.pipeStrategy==="output")return Pe(t.out._def,e);const r=Pe(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Pe(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function vR(t,e){return Pe(t.type._def,e)}function wR(t,e){const r={type:"array",uniqueItems:!0,items:Pe(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&je(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&je(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function bR(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>Pe(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:Pe(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>Pe(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function ER(){return{not:{}}}function SR(){return{}}const xR=(t,e)=>Pe(t.innerType._def,e);function Pe(t,e,r=!1){var i;const n=e.seen.get(t);if(e.override){const s=(i=e.override)==null?void 0:i.call(e,t,e,n,r);if(s!==WF)return s}if(n&&!r){const s=kR(n,e);if(s!==void 0)return s}const a={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,a);const o=TR(t,t.typeName,e);return o&&MR(t,e,o),a.jsonSchema=o,o}const kR=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:AR(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},AR=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")},TR=(t,e,r)=>{switch(e){case Q.ZodString:return Vw(t,r);case Q.ZodNumber:return fR(t,r);case Q.ZodObject:return gR(t,r);case Q.ZodBigInt:return KF(t,r);case Q.ZodBoolean:return YF();case Q.ZodDate:return qw(t,r);case Q.ZodUndefined:return ER();case Q.ZodNull:return dR(r);case Q.ZodArray:return JF(t,r);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return hR(t,r);case Q.ZodIntersection:return oR(t,r);case Q.ZodTuple:return bR(t,r);case Q.ZodRecord:return Jw(t,r);case Q.ZodLiteral:return iR(t,r);case Q.ZodEnum:return nR(t);case Q.ZodNativeEnum:return cR(t);case Q.ZodNullable:return pR(t,r);case Q.ZodOptional:return yR(t,r);case Q.ZodMap:return lR(t,r);case Q.ZodSet:return wR(t,r);case Q.ZodLazy:return Pe(t.getter()._def,r);case Q.ZodPromise:return vR(t,r);case Q.ZodNaN:case Q.ZodNever:return uR();case Q.ZodEffects:return rR(t,r);case Q.ZodAny:return ZF();case Q.ZodUnknown:return SR();case Q.ZodDefault:return tR(t,r);case Q.ZodBranded:return XF(t,r);case Q.ZodReadonly:return xR(t,r);case Q.ZodCatch:return QF(t,r);case Q.ZodPipeline:return _R(t,r);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(n=>{})()}},MR=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r),FR=(t,e)=>{const r=VF(e),n=void 0,a=e==null?void 0:e.name,o=Pe(t._def,r,!1)??{},i=a===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...n,[a]:o}};return r.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i};Gt=function(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_zod"in e))return!1;const r=e._zod;return typeof r=="object"&&r!==null&&"def"in r},dr=function(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_def"in e)||"_zod"in e)return!1;const r=e._def;return typeof r=="object"&&r!=null&&"typeName"in r},ef=function(t){return!t||typeof t!="object"||Array.isArray(t)?!1:!!(Gt(t)||dr(t))},p0=async function(t,e){if(Gt(t))try{return{success:!0,data:await PF(t,e)}}catch(r){return{success:!1,error:r}}if(dr(t))return t.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")},Gp=async function(t,e){if(Gt(t))return NF(t,e);if(dr(t))return t.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")},Qp=function(t){var e;if(Gt(t))return(e=hn.get(t))==null?void 0:e.description;if(dr(t)||"description"in t&&typeof t.description=="string")return t.description};function RR(t){return ef(t)?dr(t)?t._def.typeName==="ZodString":Gt(t)?t._zod.def.type==="string":!1:!1}function Zo(t){return Gt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="object":!1}function Yw(t){return Gt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="array":!1}function Sh(t,e=!1){if(dr(t))return t.strict();if(Zo(t)){const r=t._zod.def.shape;if(e)for(const[o,i]of Object.entries(t._zod.def.shape)){if(Zo(i)){const l=Sh(i,e);r[o]=l}else if(Yw(i)){let l=i._zod.def.element;Zo(l)&&(l=Sh(l,e)),r[o]=Xs(i,{...i._zod.def,element:l})}else r[o]=i;const s=hn.get(i);s&&hn.add(r[o],s)}const n=Xs(t,{...t._zod.def,shape:r,catchall:HF(UF)}),a=hn.get(t);return a&&hn.add(n,a),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function OR(t){return dr(t)&&"typeName"in t._def&&t._def.typeName==="ZodEffects"}function NR(t){return Gt(t)&&t._zod.def.type==="pipe"}function Jo(t,e=!1){if(dr(t))return OR(t)?Jo(t._def.schema,e):t;if(Gt(t)){let r=t;if(NR(t)&&(r=Jo(t._zod.def.in,e)),e){if(Zo(r)){const a=r._zod.def.shape;for(const[o,i]of Object.entries(r._zod.def.shape))a[o]=Jo(i,e);r=Xs(r,{...r._zod.def,shape:a})}else if(Yw(r)){const a=Jo(r._zod.def.element,e);r=Xs(r,{...r._zod.def,element:a})}}const n=hn.get(t);return n&&hn.add(r,n),r}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}tf=function(t){if(Gt(t)){const e=Jo(t,!0);if(Zo(e)){const r=Sh(e,!0);return Ww(r)}else return Ww(t)}return dr(t)?FR(t):t};function IR(t,e){if(t!==void 0&&!Sa(t))return t;if(vh(e))try{let r=e.getName();return r=r.startsWith("Runnable")?r.slice(8):r,r}catch{return e.getName()}else return e.name??"UnknownSchema"}function PR(t){return vh(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...tf(t.data.schema),title:t.data.name}}}class nl{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((r,n)=>{e[r.id]=Sa(r.id)?n:r.id}),{nodes:Object.values(this.nodes).map(r=>({id:e[r.id],...PR(r)})),edges:this.edges.map(r=>{const n={source:e[r.source],target:e[r.target]};return typeof r.data<"u"&&(n.data=r.data),typeof r.conditional<"u"&&(n.conditional=r.conditional),n})}}addNode(e,r,n){if(r!==void 0&&this.nodes[r]!==void 0)throw new Error(`Node with id ${r} already exists`);const a=r??ht(),o={id:a,data:e,name:IR(r,e),metadata:n};return this.nodes[a]=o,o}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(r=>r.source!==e.id&&r.target!==e.id)}addEdge(e,r,n,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[r.id]===void 0)throw new Error(`Target node ${r.id} not in graph`);const o={source:e.id,target:r.id,data:n,conditional:a};return this.edges.push(o),o}firstNode(){return Xw(this)}lastNode(){return Qw(this)}extend(e,r=""){let n=r;Object.values(e.nodes).map(l=>l.id).every(Sa)&&(n="");const a=l=>n?`${n}:${l}`:l;Object.entries(e.nodes).forEach(([l,c])=>{this.nodes[a(l)]={...c,id:a(l)}});const o=e.edges.map(l=>({...l,source:a(l.source),target:a(l.target)}));this.edges=[...this.edges,...o];const i=e.firstNode(),s=e.lastNode();return[i?{id:a(i.id),data:i.data}:void 0,s?{id:a(s.id),data:s.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&Xw(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&Qw(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),r=new Map;Object.values(e).forEach(a=>{r.set(a,(r.get(a)||0)+1)});const n=a=>{const o=e[a];return Sa(a)&&r.get(o)===1?o:a};return new nl({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,o])=>[n(a),{...o,id:n(a)}])),edges:this.edges.map(a=>({...a,source:n(a.source),target:n(a.target)}))})}drawMermaid(e){const{withStyles:r,curveStyle:n,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:o}=e??{},i=this.reid(),s=i.firstNode(),l=i.lastNode();return EF(i.nodes,i.edges,{firstNode:s==null?void 0:s.id,lastNode:l==null?void 0:l.id,withStyles:r,curveStyle:n,nodeColors:a,wrapLabelNWords:o})}async drawMermaidPng(e){const r=this.drawMermaid(e);return SF(r,{backgroundColor:e==null?void 0:e.backgroundColor})}}function Xw(t,e=[]){const r=new Set(t.edges.filter(a=>!e.includes(a.source)).map(a=>a.target)),n=[];for(const a of Object.values(t.nodes))!e.includes(a.id)&&!r.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function Qw(t,e=[]){const r=new Set(t.edges.filter(a=>!e.includes(a.target)).map(a=>a.source)),n=[];for(const a of Object.values(t.nodes))!e.includes(a.id)&&!r.has(a.id)&&n.push(a);return n.length===1?n[0]:void 0}function CR(t){const e=new TextEncoder,r=new ReadableStream({async start(n){for await(const a of t)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Mt.fromReadableStream(r)}function eb(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const jR=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function xh(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*tb(t,e){for(;;){const{value:r,done:n}=cn.runWithConfig(Oa(t),e.next.bind(e),!0);if(n)break;yield r}}async function*kh(t,e){const r=e[Symbol.asyncIterator]();for(;;){const{value:n,done:a}=await cn.runWithConfig(Oa(t),r.next.bind(e),!0);if(a)break;yield n}}function ot(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}st=class extends En{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(t){const e=this.name??this.constructor.lc_name()??this.constructor.name;return t?`${e}${t}`:e}bind(t){return new Dn({bound:this,kwargs:t,config:{}})}map(){return new al({bound:this})}withRetry(t){return new rb({bound:this,kwargs:{},config:{},maxAttemptNumber:t==null?void 0:t.stopAfterAttempt,...t})}withConfig(t){return new Dn({bound:this,config:t,kwargs:{}})}withFallbacks(t){const e=Array.isArray(t)?t:t.fallbacks;return new DR({runnable:this,fallbacks:e})}_getOptionsList(t,e=0){if(Array.isArray(t)&&t.length!==e)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${t.length} options for ${e} inputs`);if(Array.isArray(t))return t.map(Ie);if(e>1&&!Array.isArray(t)&&t.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(t).filter(([n])=>n!=="runId"));return Array.from({length:e},(n,a)=>Ie(a===0?t:r))}return Array.from({length:e},()=>Ie(t))}async batch(t,e,r){var s;const n=this._getOptionsList(e??{},t.length),a=((s=n[0])==null?void 0:s.maxConcurrency)??(r==null?void 0:r.maxConcurrency),o=new xi({maxConcurrency:a,onFailedAttempt:l=>{throw l}}),i=t.map((l,c)=>o.call(async()=>{try{return await this.invoke(l,n[c])}catch(u){if(r!=null&&r.returnExceptions)return u;throw u}}));return Promise.all(i)}async*_streamIterator(t,e){yield this.invoke(t,e)}async stream(t,e){const r=Ie(e),n=new Na({generator:this._streamIterator(t,r),config:r});return await n.setup,Mt.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(t){let e;t===void 0?e=Ie(t):e=Ie({callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,runName:t.runName,configurable:t.configurable,recursionLimit:t.recursionLimit,maxConcurrency:t.maxConcurrency,runId:t.runId,timeout:t.timeout,signal:t.signal});const r={...t};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[e,r]}async _callWithConfig(t,e,r){var i;const n=Ie(r),a=await((i=await tr(n))==null?void 0:i.handleChainStart(this.toJSON(),ot(e,"input"),n.runId,n==null?void 0:n.runType,void 0,void 0,(n==null?void 0:n.runName)??this.getName()));delete n.runId;let o;try{const s=t.call(this,e,n,a);o=await un(s,r==null?void 0:r.signal)}catch(s){throw await(a==null?void 0:a.handleChainError(s)),s}return await(a==null?void 0:a.handleChainEnd(ot(o,"output"))),o}async _batchWithConfig(t,e,r,n){var l;const a=this._getOptionsList(r??{},e.length),o=await Promise.all(a.map(tr)),i=await Promise.all(o.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),ot(e[u],"input"),a[u].runId,a[u].runType,void 0,void 0,a[u].runName??this.getName()));return delete a[u].runId,d}));let s;try{const c=t.call(this,e,a,i,n);s=await un(c,(l=a==null?void 0:a[0])==null?void 0:l.signal)}catch(c){throw await Promise.all(i.map(u=>u==null?void 0:u.handleChainError(c))),c}return await Promise.all(i.map(c=>c==null?void 0:c.handleChainEnd(ot(s,"output")))),s}async*_transformStreamWithConfig(t,e,r){let n,a=!0,o,i=!0;const s=Ie(r),l=await tr(s);async function*c(){for await(const d of t){if(a)if(n===void 0)n=d;else try{n=hr(n,d)}catch{n=void 0,a=!1}yield d}}let u;try{const d=await hF(e.bind(this),c(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},s.runId,s.runType,void 0,void 0,s.runName??this.getName()),r==null?void 0:r.signal,s);delete s.runId,u=d.setup;const h=u==null?void 0:u.handlers.find(mF);let p=d.output;h!==void 0&&u!==void 0&&(p=h.tapOutputIterable(u.runId,p));const f=u==null?void 0:u.handlers.find(pF);f!==void 0&&u!==void 0&&(p=f.tapOutputIterable(u.runId,p));for await(const y of p)if(yield y,i)if(o===void 0)o=y;else try{o=hr(o,y)}catch{o=void 0,i=!1}}catch(d){throw await(u==null?void 0:u.handleChainError(d,void 0,void 0,void 0,{inputs:ot(n,"input")})),d}await(u==null?void 0:u.handleChainEnd(o??{},void 0,void 0,void 0,{inputs:ot(n,"input")}))}getGraph(t){const e=new nl,r=e.addNode({name:`${this.getName()}Input`,schema:Vu()}),n=e.addNode(this),a=e.addNode({name:`${this.getName()}Output`,schema:Vu()});return e.addEdge(r,n),e.addEdge(n,a),e}pipe(t){return new Sn({first:this,last:$n(t)})}pick(t){return this.pipe(new $R(t))}assign(t){return this.pipe(new Xp(new uo({steps:t})))}async*transform(t,e){let r;for await(const n of t)r===void 0?r=n:r=hr(r,n);yield*this._streamIterator(r,Ie(e))}async*streamLog(t,e,r){const n=new Dw({...r,autoClose:!1,_schemaFormat:"original"}),a=Ie(e);yield*this._streamLog(t,n,a)}async*_streamLog(t,e,r){const{callbacks:n}=r;if(n===void 0)r.callbacks=[e];else if(Array.isArray(n))r.callbacks=n.concat([e]);else{const s=n.copy();s.addHandler(e,!0),r.callbacks=s}const a=this.stream(t,r);async function o(){try{const s=await a;for await(const l of s){const c=new dn({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await e.writer.write(c)}}finally{await e.writer.close()}}const i=o();try{for await(const s of e)yield s}finally{await i}}streamEvents(t,e,r){let n;if(e.version==="v1")n=this._streamEventsV1(t,e,r);else if(e.version==="v2")n=this._streamEventsV2(t,e,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return e.encoding==="text/event-stream"?CR(n):Mt.fromAsyncGenerator(n)}async*_streamEventsV2(t,e,r){var p;const n=new gF({...r,autoClose:!1}),a=Ie(e),o=a.runId??ht();a.runId=o;const i=a.callbacks;if(i===void 0)a.callbacks=[n];else if(Array.isArray(i))a.callbacks=i.concat(n);else{const f=i.copy();f.addHandler(n,!0),a.callbacks=f}const s=new AbortController,l=this;async function c(){try{let f;e!=null&&e.signal?"any"in AbortSignal?f=AbortSignal.any([s.signal,e.signal]):(f=e.signal,e.signal.addEventListener("abort",()=>{s.abort()},{once:!0})):f=s.signal;const y=await l.stream(t,{...a,signal:f}),m=n.tapOutputIterable(o,y);for await(const _ of m)if(s.signal.aborted)break}finally{await n.finish()}}const u=c();let d=!1,h;try{for await(const f of n){if(!d){f.data.input=t,d=!0,h=f.run_id,yield f;continue}f.run_id===h&&f.event.endsWith("_end")&&((p=f.data)!=null&&p.input)&&delete f.data.input,yield f}}finally{s.abort(),await u}}async*_streamEventsV1(t,e,r){let n,a=!1;const o=Ie(e),i=o.tags??[],s=o.metadata??{},l=o.runName??this.getName(),c=new Dw({...r,autoClose:!1,_schemaFormat:"streaming_events"}),u=new vF({...r}),d=this._streamLog(t,c,o);for await(const p of d){if(n?n=n.concat(p):n=Vo.fromRunLogPatch(p),n.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const _={...n.state},w={run_id:_.id,event:`on_${_.type}_start`,name:l,tags:i,metadata:s,data:{input:t}};u.includeEvent(w,_.type)&&(yield w)}const f=p.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),y=[...new Set(f)];for(const _ of y){let w,A={};const F=n.state.logs[_];if(F.end_time===void 0?F.streamed_output.length>0?w="stream":w="start":w="end",w==="start")F.inputs!==void 0&&(A.input=F.inputs);else if(w==="end")F.inputs!==void 0&&(A.input=F.inputs),A.output=F.final_output;else if(w==="stream"){const b=F.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${F.name}"`);A={chunk:F.streamed_output[0]},F.streamed_output=[]}yield{event:`on_${F.type}_${w}`,name:F.name,run_id:F.id,tags:F.tags,metadata:F.metadata,data:A}}const{state:m}=n;if(m.streamed_output.length>0){const _=m.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${m.name}"`);const w={chunk:m.streamed_output[0]};m.streamed_output=[];const A={event:`on_${m.type}_stream`,run_id:m.id,tags:i,metadata:s,name:l,data:w};u.includeEvent(A,m.type)&&(yield A)}}const h=n==null?void 0:n.state;if(h!==void 0){const p={event:`on_${h.type}_end`,name:l,run_id:h.id,tags:i,metadata:s,data:{output:h.final_output}};u.includeEvent(p,h.type)&&(yield p)}}static isRunnable(t){return vh(t)}withListeners({onStart:t,onEnd:e,onError:r}){return new Dn({bound:this,config:{},configFactories:[n=>({callbacks:[new $w({config:n,onStart:t,onEnd:e,onError:r})]})]})}asTool(t){return zR(this,t)}};class Dn extends st{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const r=Pw(this.config,...e);return Pw(r,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(r))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new rb({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}async invoke(e,r){return this.bound.invoke(e,await this._mergeConfig(Ie(r),this.kwargs))}async batch(e,r,n){const a=Array.isArray(r)?await Promise.all(r.map(async o=>this._mergeConfig(Ie(o),this.kwargs))):await this._mergeConfig(Ie(r),this.kwargs);return this.bound.batch(e,a,n)}async*_streamIterator(e,r){yield*this.bound._streamIterator(e,await this._mergeConfig(Ie(r),this.kwargs))}async stream(e,r){return this.bound.stream(e,await this._mergeConfig(Ie(r),this.kwargs))}async*transform(e,r){yield*this.bound.transform(e,await this._mergeConfig(Ie(r),this.kwargs))}streamEvents(e,r,n){const a=this,o=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(Ie(r),a.kwargs),version:r.version},n)};return Mt.fromAsyncGenerator(o())}static isRunnableBinding(e){return e.bound&&st.isRunnable(e.bound)}withListeners({onStart:e,onEnd:r,onError:n}){return new Dn({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new $w({config:a,onStart:e,onEnd:r,onError:n})]})]})}}class al extends st{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new al({bound:this.bound.bind(e)})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _invoke(e,r,n){return this.bound.batch(e,ut(r,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:r,onError:n}){return new al({bound:this.bound.withListeners({onStart:e,onEnd:r,onError:n})})}}class rb extends Dn{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,r,n){const a=e>1?`retry:attempt:${e}`:void 0;return ut(r,{callbacks:n==null?void 0:n.getChild(a)})}async _invoke(e,r,n){return Ts(a=>super.invoke(e,this._patchConfigForRetry(a,r,n)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _batch(e,r,n,a){const o={};try{await Ts(async i=>{const s=e.map((h,p)=>p).filter(h=>o[h.toString()]===void 0||o[h.toString()]instanceof Error),l=s.map(h=>e[h]),c=s.map(h=>this._patchConfigForRetry(i,r==null?void 0:r[h],n==null?void 0:n[h])),u=await super.batch(l,c,{...a,returnExceptions:!0});let d;for(let h=0;h<u.length;h+=1){const p=u[h],f=s[h];p instanceof Error&&d===void 0&&(d=p,d.input=l[h]),o[f.toString()]=p}if(d)throw d;return u},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((a==null?void 0:a.returnExceptions)!==!0)throw i}return Object.keys(o).sort((i,s)=>parseInt(i,10)-parseInt(s,10)).map(i=>o[parseInt(i,10)])}async batch(e,r,n){return this._batchWithConfig(this._batch.bind(this),e,r,n)}}Sn=class extends st{static lc_name(){return"RunnableSequence"}constructor(t){super(t),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=t.first,this.middle=t.middle??this.middle,this.last=t.last,this.name=t.name,this.omitSequenceTags=t.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(t,e){var i,s;const r=Ie(e),n=await((i=await tr(r))==null?void 0:i.handleChainStart(this.toJSON(),ot(t,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=t,o;try{const l=[this.first,...this.middle];for(let c=0;c<l.length;c+=1){const u=l[c].invoke(a,ut(r,{callbacks:n==null?void 0:n.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));a=await un(u,e==null?void 0:e.signal)}if((s=e==null?void 0:e.signal)!=null&&s.aborted)throw new Error("Aborted");o=await this.last.invoke(a,ut(r,{callbacks:n==null?void 0:n.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await(n==null?void 0:n.handleChainError(l)),l}return await(n==null?void 0:n.handleChainEnd(ot(o,"output"))),o}async batch(t,e,r){var s;const n=this._getOptionsList(e??{},t.length),a=await Promise.all(n.map(tr)),o=await Promise.all(a.map(async(l,c)=>{const u=await(l==null?void 0:l.handleChainStart(this.toJSON(),ot(t[c],"input"),n[c].runId,void 0,void 0,void 0,n[c].runName));return delete n[c].runId,u}));let i=t;try{for(let l=0;l<this.steps.length;l+=1){const c=this.steps[l].batch(i,o.map((u,d)=>{const h=u==null?void 0:u.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return ut(n[d],{callbacks:h})}),r);i=await un(c,(s=n[0])==null?void 0:s.signal)}}catch(l){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(ot(i,"output")))),i}async*_streamIterator(t,e){var u;const r=await tr(e),{runId:n,...a}=e??{},o=await(r==null?void 0:r.handleChainStart(this.toJSON(),ot(t,"input"),n,void 0,void 0,void 0,a==null?void 0:a.runName)),i=[this.first,...this.middle,this.last];let s=!0,l;async function*c(){yield t}try{let d=i[0].transform(c(),ut(a,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let h=1;h<i.length;h+=1)d=await i[h].transform(d,ut(a,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${h+1}`)}));for await(const h of d)if((u=e==null?void 0:e.signal)==null||u.throwIfAborted(),yield h,s)if(l===void 0)l=h;else try{l=hr(l,h)}catch{l=void 0,s=!1}}catch(d){throw await(o==null?void 0:o.handleChainError(d)),d}await(o==null?void 0:o.handleChainEnd(ot(l,"output")))}getGraph(t){const e=new nl;let r=null;return this.steps.forEach((n,a)=>{const o=n.getGraph(t);a!==0&&o.trimFirstNode(),a!==this.steps.length-1&&o.trimLastNode(),e.extend(o);const i=o.firstNode();if(!i)throw new Error(`Runnable ${n} has no first node`);r&&e.addEdge(r,i),r=o.lastNode()}),e}pipe(t){return Sn.isRunnableSequence(t)?new Sn({first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}):new Sn({first:this.first,middle:[...this.middle,this.last],last:$n(t),name:this.name})}static isRunnableSequence(t){return Array.isArray(t.middle)&&st.isRunnable(t)}static from([t,...e],r){let n={};return typeof r=="string"?n.name=r:r!==void 0&&(n=r),new Sn({...n,first:$n(t),middle:e.slice(0,-1).map($n),last:$n(e[e.length-1])})}},uo=class extends st{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[e,r]of Object.entries(t.steps))this.steps[e]=$n(r)}static from(t){return new uo({steps:t})}async invoke(t,e){var o;const r=Ie(e),n=await((o=await tr(r))==null?void 0:o.handleChainStart(this.toJSON(),{input:t},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{const i=Object.entries(this.steps).map(async([s,l])=>{a[s]=await l.invoke(t,ut(r,{callbacks:n==null?void 0:n.getChild(`map:key:${s}`)}))});await un(Promise.all(i),e==null?void 0:e.signal)}catch(i){throw await(n==null?void 0:n.handleChainError(i)),i}return await(n==null?void 0:n.handleChainEnd(a)),a}async*_transform(t,e,r){const n={...this.steps},a=Cw(t,Object.keys(n).length),o=new Map(Object.entries(n).map(([i,s],l)=>{const c=s.transform(a[l],ut(r,{callbacks:e==null?void 0:e.getChild(`map:key:${i}`)}));return[i,c.next().then(u=>({key:i,gen:c,result:u}))]}));for(;o.size;){const i=Promise.race(o.values()),{key:s,result:l,gen:c}=await un(i,r==null?void 0:r.signal);o.delete(s),l.done||(yield{[s]:l.value},o.set(s,c.next().then(u=>({key:s,gen:c,result:u}))))}}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Ie(e),a=new Na({generator:this.transform(r(),n),config:n});return await a.setup,Mt.fromAsyncGenerator(a)}};class Ah extends st{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!oh(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,r){const[n]=this._getOptionsList(r??{},1),a=await tr(n),o=this.func(ut(n,{callbacks:a}),e);return un(o,n==null?void 0:n.signal)}async*_streamIterator(e,r){var o,i;const[n]=this._getOptionsList(r??{},1),a=await this.invoke(e,r);if(xh(a)){for await(const s of a)(o=n==null?void 0:n.signal)==null||o.throwIfAborted(),yield s;return}if(jR(a)){for(;;){(i=n==null?void 0:n.signal)==null||i.throwIfAborted();const s=a.next();if(s.done)break;yield s.value}return}yield a}static from(e){return new Ah({func:e})}}function LR(t){if(oh(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}ki=class extends st{static lc_name(){return"RunnableLambda"}constructor(t){if(oh(t.func))return Ah.from(t.func);super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),LR(t.func),this.func=t.func}static from(t){return new ki({func:t})}async _invoke(t,e,r){return new Promise((n,a)=>{const o=ut(e,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((e==null?void 0:e.recursionLimit)??_h)-1});cn.runWithConfig(Oa(o),async()=>{var i,s;try{let l=await this.func(t,{...o});if(l&&st.isRunnable(l)){if((e==null?void 0:e.recursionLimit)===0)throw new Error("Recursion limit reached.");l=await l.invoke(t,{...o,recursionLimit:(o.recursionLimit??_h)-1})}else if(xh(l)){let c;for await(const u of kh(o,l))if((i=e==null?void 0:e.signal)==null||i.throwIfAborted(),c===void 0)c=u;else try{c=hr(c,u)}catch{c=u}l=c}else if(eb(l)){let c;for(const u of tb(o,l))if((s=e==null?void 0:e.signal)==null||s.throwIfAborted(),c===void 0)c=u;else try{c=hr(c,u)}catch{c=u}l=c}n(l)}catch(l){a(l)}})})}async invoke(t,e){return this._callWithConfig(this._invoke.bind(this),t,e)}async*_transform(t,e,r){var i,s;let n;for await(const l of t)if(n===void 0)n=l;else try{n=hr(n,l)}catch{n=l}const a=ut(r,{callbacks:e==null?void 0:e.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??_h)-1}),o=await new Promise((l,c)=>{cn.runWithConfig(Oa(a),async()=>{try{const u=await this.func(n,{...a,config:a});l(u)}catch(u){c(u)}})});if(o&&st.isRunnable(o)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const l=await o.stream(n,a);for await(const c of l)yield c}else if(xh(o))for await(const l of kh(a,o))(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield l;else if(eb(o))for(const l of tb(a,o))(s=r==null?void 0:r.signal)==null||s.throwIfAborted(),yield l;else yield o}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Ie(e),a=new Na({generator:this.transform(r(),n),config:n});return await a.setup,Mt.fromAsyncGenerator(a)}};class DR extends st{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,r){const n=Ie(r),a=await tr(n),{runId:o,...i}=n,s=await(a==null?void 0:a.handleChainStart(this.toJSON(),ot(e,"input"),o,void 0,void 0,void 0,i==null?void 0:i.runName)),l=ut(i,{callbacks:s==null?void 0:s.getChild()});return await cn.runWithConfig(l,async()=>{var u;let c;for(const d of this.runnables()){(u=n==null?void 0:n.signal)==null||u.throwIfAborted();try{const h=await d.invoke(e,l);return await(s==null?void 0:s.handleChainEnd(ot(h,"output"))),h}catch(h){c===void 0&&(c=h)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(s==null?void 0:s.handleChainError(c)),c)})}async*_streamIterator(e,r){var d;const n=Ie(r),a=await tr(n),{runId:o,...i}=n,s=await(a==null?void 0:a.handleChainStart(this.toJSON(),ot(e,"input"),o,void 0,void 0,void 0,i==null?void 0:i.runName));let l,c;for(const h of this.runnables()){(d=n==null?void 0:n.signal)==null||d.throwIfAborted();const p=ut(i,{callbacks:s==null?void 0:s.getChild()});try{const f=await h.stream(e,p);c=kh(p,f);break}catch(f){l===void 0&&(l=f)}}if(c===void 0){const h=l??new Error("No error stored at end of fallback.");throw await(s==null?void 0:s.handleChainError(h)),h}let u;try{for await(const h of c){yield h;try{u=u===void 0?u:hr(u,h)}catch{u=void 0}}}catch(h){throw await(s==null?void 0:s.handleChainError(h)),h}await(s==null?void 0:s.handleChainEnd(ot(u,"output")))}async batch(e,r,n){var l;if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(r??{},e.length),o=await Promise.all(a.map(c=>tr(c))),i=await Promise.all(o.map(async(c,u)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),ot(e[u],"input"),a[u].runId,void 0,void 0,void 0,a[u].runName));return delete a[u].runId,d}));let s;for(const c of this.runnables()){(l=a[0].signal)==null||l.throwIfAborted();try{const u=await c.batch(e,i.map((d,h)=>ut(a[h],{callbacks:d==null?void 0:d.getChild()})),n);return await Promise.all(i.map((d,h)=>d==null?void 0:d.handleChainEnd(ot(u[h],"output")))),u}catch(u){s===void 0&&(s=u)}}throw s?(await Promise.all(i.map(c=>c==null?void 0:c.handleChainError(s))),s):new Error("No error stored at end of fallbacks.")}}function $n(t){if(typeof t=="function")return new ki({func:t});if(st.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[r,n]of Object.entries(t))e[r]=$n(n);return new uo({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}Xp=class extends st{static lc_name(){return"RunnableAssign"}constructor(t){t instanceof uo&&(t={mapper:t}),super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=t.mapper}async invoke(t,e){const r=await this.mapper.invoke(t,e);return{...t,...r}}async*_transform(t,e,r){const n=this.mapper.getStepsKeys(),[a,o]=Cw(t),i=this.mapper.transform(o,ut(r,{callbacks:e==null?void 0:e.getChild()})),s=i.next();for await(const l of a){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const c=Object.fromEntries(Object.entries(l).filter(([u])=>!n.includes(u)));Object.keys(c).length>0&&(yield c)}yield(await s).value;for await(const l of i)yield l}transform(t,e){return this._transformStreamWithConfig(t,this._transform.bind(this),e)}async stream(t,e){async function*r(){yield t}const n=Ie(e),a=new Na({generator:this.transform(r(),n),config:n});return await a.setup,Mt.fromAsyncGenerator(a)}};class $R extends st{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const r=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return r.length===0?void 0:Object.fromEntries(r)}}async invoke(e,r){return this._callWithConfig(this._pick.bind(this),e,r)}async*_transform(e){for await(const r of e){const n=await this._pick(r);n!==void 0&&(yield n)}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}const a=Ie(r),o=new Na({generator:this.transform(n(),a),config:a});return await o.setup,Mt.fromAsyncGenerator(o)}}class nb extends Dn{constructor(e){const r=Sn.from([ki.from(async n=>{let a;if(Fw(n))try{a=await Gp(this.schema,n.args)}catch{throw new UM("Received tool input did not match expected schema",JSON.stringify(n.args))}else a=n;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:r,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function zR(t,e){const r=e.name??t.getName(),n=e.description??Qp(e.schema);return RR(e.schema)?new nb({name:r,description:n,schema:Hp({input:Wp()}).transform(a=>a.input),bound:t}):new nb({name:r,description:n,schema:e.schema,bound:t})}class UR extends st{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,r){return this.transformDocuments(e)}}var Ko={},ab;function BR(){if(ab)return Ko;ab=1,Ko.byteLength=s,Ko.toByteArray=c,Ko.fromByteArray=h;for(var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)t[a]=n[a],e[n.charCodeAt(a)]=a;e[45]=62,e[95]=63;function i(p){var f=p.length;if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var y=p.indexOf("=");y===-1&&(y=f);var m=y===f?0:4-y%4;return[y,m]}function s(p){var f=i(p),y=f[0],m=f[1];return(y+m)*3/4-m}function l(p,f,y){return(f+y)*3/4-y}function c(p){var f,y=i(p),m=y[0],_=y[1],w=new r(l(p,m,_)),A=0,F=_>0?m-4:m,b;for(b=0;b<F;b+=4)f=e[p.charCodeAt(b)]<<18|e[p.charCodeAt(b+1)]<<12|e[p.charCodeAt(b+2)]<<6|e[p.charCodeAt(b+3)],w[A++]=f>>16&255,w[A++]=f>>8&255,w[A++]=f&255;return _===2&&(f=e[p.charCodeAt(b)]<<2|e[p.charCodeAt(b+1)]>>4,w[A++]=f&255),_===1&&(f=e[p.charCodeAt(b)]<<10|e[p.charCodeAt(b+1)]<<4|e[p.charCodeAt(b+2)]>>2,w[A++]=f>>8&255,w[A++]=f&255),w}function u(p){return t[p>>18&63]+t[p>>12&63]+t[p>>6&63]+t[p&63]}function d(p,f,y){for(var m,_=[],w=f;w<y;w+=3)m=(p[w]<<16&16711680)+(p[w+1]<<8&65280)+(p[w+2]&255),_.push(u(m));return _.join("")}function h(p){for(var f,y=p.length,m=y%3,_=[],w=16383,A=0,F=y-m;A<F;A+=w)_.push(d(p,A,A+w>F?F:A+w));return m===1?(f=p[y-1],_.push(t[f>>2]+t[f<<4&63]+"==")):m===2&&(f=(p[y-2]<<8)+p[y-1],_.push(t[f>>10]+t[f>>4&63]+t[f<<2&63]+"=")),_.join("")}return Ko}var HR=BR();const WR=Ja(HR);var GR=Object.defineProperty,qR=(t,e,r)=>e in t?GR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,VR=(t,e,r)=>(qR(t,e+"",r),r);function ZR(t,e){let r=Array.from({length:t.length},(n,a)=>({start:a,end:a+1}));for(;r.length>1;){let n=null;for(let a=0;a<r.length-1;a++){const o=t.slice(r[a].start,r[a+1].end),i=e.get(o.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,a])}if(n!=null){const a=n[1];r[a]={start:r[a].start,end:r[a+1].end},r.splice(a+1,1)}else break}return r}function JR(t,e){return t.length===1?[e.get(t.join(","))]:ZR(t,e).map(r=>e.get(t.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function KR(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Th=class{constructor(t,e){ae(this,"specialTokens");ae(this,"inverseSpecialTokens");ae(this,"patStr");ae(this,"textEncoder",new TextEncoder);ae(this,"textDecoder",new TextDecoder("utf-8"));ae(this,"rankMap",new Map);ae(this,"textMap",new Map);this.patStr=t.pat_str;const r=t.bpe_ranks.split(`
`).filter(Boolean).reduce((n,a)=>{const[o,i,...s]=a.split(" "),l=Number.parseInt(i,10);return s.forEach((c,u)=>n[c]=l+u),n},{});for(const[n,a]of Object.entries(r)){const o=WR.toByteArray(n);this.rankMap.set(o.join(","),a),this.textMap.set(a,o)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[a,o])=>(n[o]=this.textEncoder.encode(a),n),{})}encode(t,e=[],r="all"){const n=new RegExp(this.patStr,"ug"),a=Th.specialTokenRegex(Object.keys(this.specialTokens)),o=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),s=new Set(r==="all"?Object.keys(this.specialTokens).filter(c=>!i.has(c)):r);if(s.size>0){const c=Th.specialTokenRegex([...s]),u=t.match(c);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let l=0;for(;;){let c=null,u=l;for(;a.lastIndex=u,c=a.exec(t),!(c==null||i.has(c[0]));)u=c.index+1;const d=(c==null?void 0:c.index)??t.length;for(const p of t.substring(l,d).matchAll(n)){const f=this.textEncoder.encode(p[0]),y=this.rankMap.get(f.join(","));if(y!=null){o.push(y);continue}o.push(...JR(f,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];o.push(h),l=c.index+c[0].length}return o}decode(t){const e=[];let r=0;for(let o=0;o<t.length;++o){const i=t[o],s=this.textMap.get(i)??this.inverseSpecialTokens[i];s!=null&&(e.push(s),r+=s.length)}const n=new Uint8Array(r);let a=0;for(const o of e)n.set(o,a),a+=o.length;return this.textDecoder.decode(n)}},ob=Th;VR(ob,"specialTokenRegex",t=>new RegExp(t.map(e=>KR(e)).join("|"),"g"));function YR(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":return"o200k_base";default:throw new Error("Unknown model")}}const ol={},XR=new xi({});async function ib(t){return t in ol||(ol[t]=XR.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new ob(e)).catch(e=>{throw delete ol[t],e})),await ol[t]}v0=async function(t){return ib(YR(t))};class Mh extends UR{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(r=>r.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,r={}){return this.splitDocuments(e,r)}splitOnSeparator(e,r){let n;if(r)if(this.keepSeparator){const a=r.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");n=e.split(new RegExp(`(?=${a})`))}else n=e.split(r);else n=e.split("");return n.filter(a=>a!=="")}async createDocuments(e,r=[],n={}){const a=r.length>0?r:[...Array(e.length)].map(()=>({})),{chunkHeader:o="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:s=!1}=n,l=new Array;for(let c=0;c<e.length;c+=1){const u=e[c];let d=1,h=null,p=-1;for(const f of await this.splitText(u)){let y=o;const m=u.indexOf(f,p+1);if(h===null){const F=this.numberOfNewLines(u,0,m);d+=F}else{const F=p+await this.lengthFunction(h);if(F<m){const b=this.numberOfNewLines(u,F,m);d+=b}else if(F>m){const b=this.numberOfNewLines(u,m,F);d-=b}s&&(y+=i)}const _=this.numberOfNewLines(f),w=a[c].loc&&typeof a[c].loc=="object"?{...a[c].loc}:{};w.lines={from:d,to:d+_};const A={...a[c],loc:w};y+=f,l.push(new kn({pageContent:y,metadata:A})),d+=_,h=f,p=m}}return l}numberOfNewLines(e,r,n){return(e.slice(r,n).match(/\n/g)||[]).length}async splitDocuments(e,r={}){const n=e.filter(i=>i.pageContent!==void 0),a=n.map(i=>i.pageContent),o=n.map(i=>i.metadata);return this.createDocuments(a,o,r)}joinDocs(e,r){const n=e.join(r).trim();return n===""?null:n}async mergeSplits(e,r){const n=[],a=[];let o=0;for(const s of e){const l=await this.lengthFunction(s);if(o+l+a.length*r.length>this.chunkSize&&(o>this.chunkSize&&console.warn(`Created a chunk of size ${o}, +
which is longer than the specified ${this.chunkSize}`),a.length>0)){const c=this.joinDocs(a,r);for(c!==null&&n.push(c);o>this.chunkOverlap||o+l+a.length*r.length>this.chunkSize&&o>0;)o-=await this.lengthFunction(a[0]),a.shift()}a.push(s),o+=l}const i=this.joinDocs(a,r);return i!==null&&n.push(i),n}}class QR extends Mh{static lc_name(){return"CharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),this.separator=(e==null?void 0:e.separator)??this.separator}async splitText(e){const r=this.splitOnSeparator(e,this.separator);return this.mergeSplits(r,this.keepSeparator?"":this.separator)}}class il extends Mh{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,r){const n=[];let a=r[r.length-1],o;for(let c=0;c<r.length;c+=1){const u=r[c];if(u===""){a=u;break}if(e.includes(u)){a=u,o=r.slice(c+1);break}}const i=this.splitOnSeparator(e,a);let s=[];const l=this.keepSeparator?"":a;for(const c of i)if(await this.lengthFunction(c)<this.chunkSize)s.push(c);else{if(s.length){const u=await this.mergeSplits(s,l);n.push(...u),s=[]}if(!o)n.push(c);else{const u=await this._splitText(c,o);n.push(...u)}}if(s.length){const c=await this.mergeSplits(s,l);n.push(...c)}return n}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,r){return new il({...r,separators:il.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}class eO extends Mh{static lc_name(){return"TokenTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"encodingName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disallowedSpecial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenizer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.encodingName=(e==null?void 0:e.encodingName)??"gpt2",this.allowedSpecial=(e==null?void 0:e.allowedSpecial)??[],this.disallowedSpecial=(e==null?void 0:e.disallowedSpecial)??"all"}async splitText(e){this.tokenizer||(this.tokenizer=await ib(this.encodingName));const r=[],n=this.tokenizer.encode(e,this.allowedSpecial,this.disallowedSpecial);let a=0;for(;a<n.length;){a>0&&(a-=this.chunkOverlap);const o=Math.min(a+this.chunkSize,n.length),i=n.slice(a,o);r.push(this.tokenizer.decode(i)),a=o}return r}}const tO="/NoLLMChat/assets/voy_search_bg-FlZi7F4l.wasm",rO=async(t={},e)=>{let r;if(e.startsWith("data:")){const n=e.replace(/^data:.*?base64,/,"");let a;if(typeof Kh=="function"&&typeof Kh.from=="function")a=Kh.from(n,"base64");else if(typeof atob=="function"){const o=atob(n);a=new Uint8Array(o.length);for(let i=0;i<o.length;i++)a[i]=o.charCodeAt(i)}else throw new Error("Cannot decode base64-encoded data URL");r=await WebAssembly.instantiate(a,t)}else{const n=await fetch(e),a=n.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&a.startsWith("application/wasm"))r=await WebAssembly.instantiateStreaming(n,t);else{const o=await n.arrayBuffer();r=await WebAssembly.instantiate(o,t)}}return r.instance.exports};let ze;function nO(t){ze=t}const zr=new Array(128).fill(void 0);zr.push(void 0,null,!0,!1);function Ia(t){return zr[t]}let Yo=zr.length;function Ur(t){Yo===zr.length&&zr.push(zr.length+1);const e=Yo;return Yo=zr[e],zr[e]=t,e}function aO(t){t<132||(zr[t]=Yo,Yo=t)}function sb(t){const e=Ia(t);return aO(t),e}let zn=0,sl=null;function ll(){return(sl===null||sl.byteLength===0)&&(sl=new Uint8Array(ze.memory.buffer)),sl}const oO=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let cl=new oO("utf-8");const iO=typeof cl.encodeInto=="function"?function(t,e){return cl.encodeInto(t,e)}:function(t,e){const r=cl.encode(t);return e.set(r),{read:t.length,written:r.length}};function Fh(t,e,r){if(r===void 0){const s=cl.encode(t),l=e(s.length)>>>0;return ll().subarray(l,l+s.length).set(s),zn=s.length,l}let n=t.length,a=e(n)>>>0;const o=ll();let i=0;for(;i<n;i++){const s=t.charCodeAt(i);if(s>127)break;o[a+i]=s}if(i!==n){i!==0&&(t=t.slice(i)),a=r(a,n,n=i+t.length*3)>>>0;const s=ll().subarray(a+i,a+n),l=iO(t,s);i+=l.written}return zn=i,a}function lb(t){return t==null}let ul=null;function Pa(){return(ul===null||ul.byteLength===0)&&(ul=new Int32Array(ze.memory.buffer)),ul}const sO=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let cb=new sO("utf-8",{ignoreBOM:!0,fatal:!0});cb.decode();function dl(t,e){return t=t>>>0,cb.decode(ll().subarray(t,t+e))}let hl=null;function lO(){return(hl===null||hl.byteLength===0)&&(hl=new Float32Array(ze.memory.buffer)),hl}function cO(t,e){const r=e(t.length*4)>>>0;return lO().set(t,r/4),zn=t.length,r}function ub(t,e){try{return t.apply(this,e)}catch(r){ze.__wbindgen_exn_store(Ur(r))}}class pn{static __wrap(e){e=e>>>0;const r=Object.create(pn.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ze.__wbg_voy_free(e)}constructor(e){const r=ze.voy_new(lb(e)?0:Ur(e));return pn.__wrap(r)}serialize(){let e,r;try{const o=ze.__wbindgen_add_to_stack_pointer(-16);ze.voy_serialize(o,this.__wbg_ptr);var n=Pa()[o/4+0],a=Pa()[o/4+1];return e=n,r=a,dl(n,a)}finally{ze.__wbindgen_add_to_stack_pointer(16),ze.__wbindgen_free(e,r)}}static deserialize(e){const r=Fh(e,ze.__wbindgen_malloc,ze.__wbindgen_realloc),n=zn,a=ze.voy_deserialize(r,n);return pn.__wrap(a)}index(e){ze.voy_index(this.__wbg_ptr,Ur(e))}search(e,r){const n=cO(e,ze.__wbindgen_malloc),a=zn,o=ze.voy_search(this.__wbg_ptr,n,a,r);return sb(o)}add(e){ze.voy_add(this.__wbg_ptr,Ur(e))}remove(e){ze.voy_remove(this.__wbg_ptr,Ur(e))}clear(){ze.voy_clear(this.__wbg_ptr)}size(){return ze.voy_size(this.__wbg_ptr)>>>0}}function uO(t){const e=Ia(t);return Ur(e)}function dO(t){return Ia(t)===void 0}function hO(t){sb(t)}function pO(){const t=new Error;return Ur(t)}function fO(t,e){const r=Ia(e).stack,n=Fh(r,ze.__wbindgen_malloc,ze.__wbindgen_realloc),a=zn;Pa()[t/4+1]=a,Pa()[t/4+0]=n}function mO(t,e){let r,n;try{r=t,n=e,console.error(dl(t,e))}finally{ze.__wbindgen_free(r,n)}}function gO(){return ub(function(t,e){const r=JSON.parse(dl(t,e));return Ur(r)},arguments)}function yO(){return ub(function(t){const e=JSON.stringify(Ia(t));return Ur(e)},arguments)}function _O(t,e){const r=Ia(e),n=typeof r=="string"?r:void 0;var a=lb(n)?0:Fh(n,ze.__wbindgen_malloc,ze.__wbindgen_realloc),o=zn;Pa()[t/4+1]=o,Pa()[t/4+0]=a}function vO(t,e){throw new Error(dl(t,e))}URL=globalThis.URL;const Ze=await rO({"./voy_search_bg.js":{__wbindgen_object_clone_ref:uO,__wbindgen_is_undefined:dO,__wbindgen_object_drop_ref:hO,__wbg_new_abda76e883ba8a5f:pO,__wbg_stack_658279fe44541cf6:fO,__wbg_error_f851667af71bcfc6:mO,__wbg_parse_76a8a18ca3f8730b:gO,__wbg_stringify_d06ad2addc54d51e:yO,__wbindgen_string_get:_O,__wbindgen_throw:vO}},tO),wO=Ze.memory,bO=Ze.__wbg_voy_free,EO=Ze.voy_new,SO=Ze.voy_serialize,xO=Ze.voy_deserialize,kO=Ze.voy_index,AO=Ze.voy_search,TO=Ze.voy_add,MO=Ze.voy_remove,FO=Ze.voy_clear,RO=Ze.voy_size,OO=Ze.index,NO=Ze.search,IO=Ze.add,PO=Ze.remove,CO=Ze.clear,jO=Ze.size,LO=Ze.__wbindgen_malloc,DO=Ze.__wbindgen_realloc,$O=Ze.__wbindgen_add_to_stack_pointer,zO=Ze.__wbindgen_free,UO=Ze.__wbindgen_exn_store,BO=Object.freeze(Object.defineProperty({__proto__:null,__wbg_voy_free:bO,__wbindgen_add_to_stack_pointer:$O,__wbindgen_exn_store:UO,__wbindgen_free:zO,__wbindgen_malloc:LO,__wbindgen_realloc:DO,add:IO,clear:CO,index:OO,memory:wO,remove:PO,search:NO,size:jO,voy_add:TO,voy_clear:FO,voy_deserialize:xO,voy_index:kO,voy_new:EO,voy_remove:MO,voy_search:AO,voy_serialize:SO,voy_size:RO},Symbol.toStringTag,{value:"Module"}));nO(BO),so=function(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')};var db={exports:{}},hb;function HO(){return hb||(hb=1,function(t,e){(function(r){t.exports=r()})(function(){return function r(n,a,o){function i(c,u){if(!a[c]){if(!n[c]){var d=typeof so=="function"&&so;if(!u&&d)return d(c,!0);if(s)return s(c,!0);var h=new Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h}var p=a[c]={exports:{}};n[c][0].call(p.exports,function(f){var y=n[c][1][f];return i(y||f)},p,p.exports,r,n,a,o)}return a[c].exports}for(var s=typeof so=="function"&&so,l=0;l<o.length;l++)i(o[l]);return i}({1:[function(r,n,a){(function(o){var i=o.MutationObserver||o.WebKitMutationObserver,s;if(i){var l=0,c=new i(f),u=o.document.createTextNode("");c.observe(u,{characterData:!0}),s=function(){u.data=l=++l%2}}else if(!o.setImmediate&&typeof o.MessageChannel<"u"){var d=new o.MessageChannel;d.port1.onmessage=f,s=function(){d.port2.postMessage(0)}}else"document"in o&&"onreadystatechange"in o.document.createElement("script")?s=function(){var m=o.document.createElement("script");m.onreadystatechange=function(){f(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},o.document.documentElement.appendChild(m)}:s=function(){setTimeout(f,0)};var h,p=[];function f(){h=!0;for(var m,_,w=p.length;w;){for(_=p,p=[],m=-1;++m<w;)_[m]();w=p.length}h=!1}n.exports=y;function y(m){p.push(m)===1&&!h&&s()}}).call(this,typeof mi<"u"?mi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(r,n,a){var o=r(1);function i(){}var s={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];n.exports=d;function d(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,b!==i&&y(this,b)}d.prototype.catch=function(b){return this.then(null,b)},d.prototype.then=function(b,D){if(typeof b!="function"&&this.state===c||typeof D!="function"&&this.state===l)return this;var B=new this.constructor(i);if(this.state!==u){var j=this.state===c?b:D;p(B,j,this.outcome)}else this.queue.push(new h(B,b,D));return B};function h(b,D,B){this.promise=b,typeof D=="function"&&(this.onFulfilled=D,this.callFulfilled=this.otherCallFulfilled),typeof B=="function"&&(this.onRejected=B,this.callRejected=this.otherCallRejected)}h.prototype.callFulfilled=function(b){s.resolve(this.promise,b)},h.prototype.otherCallFulfilled=function(b){p(this.promise,this.onFulfilled,b)},h.prototype.callRejected=function(b){s.reject(this.promise,b)},h.prototype.otherCallRejected=function(b){p(this.promise,this.onRejected,b)};function p(b,D,B){o(function(){var j;try{j=D(B)}catch(G){return s.reject(b,G)}j===b?s.reject(b,new TypeError("Cannot resolve promise with itself")):s.resolve(b,j)})}s.resolve=function(b,D){var B=m(f,D);if(B.status==="error")return s.reject(b,B.value);var j=B.value;if(j)y(b,j);else{b.state=c,b.outcome=D;for(var G=-1,te=b.queue.length;++G<te;)b.queue[G].callFulfilled(D)}return b},s.reject=function(b,D){b.state=l,b.outcome=D;for(var B=-1,j=b.queue.length;++B<j;)b.queue[B].callRejected(D);return b};function f(b){var D=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof D=="function")return function(){D.apply(b,arguments)}}function y(b,D){var B=!1;function j(x){B||(B=!0,s.reject(b,x))}function G(x){B||(B=!0,s.resolve(b,x))}function te(){D(G,j)}var de=m(te);de.status==="error"&&j(de.value)}function m(b,D){var B={};try{B.value=b(D),B.status="success"}catch(j){B.status="error",B.value=j}return B}d.resolve=_;function _(b){return b instanceof this?b:s.resolve(new this(i),b)}d.reject=w;function w(b){var D=new this(i);return s.reject(D,b)}d.all=A;function A(b){var D=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=b.length,j=!1;if(!B)return this.resolve([]);for(var G=new Array(B),te=0,de=-1,x=new this(i);++de<B;)R(b[de],de);return x;function R(k,E){D.resolve(k).then(H,function(N){j||(j=!0,s.reject(x,N))});function H(N){G[E]=N,++te===B&&!j&&(j=!0,s.resolve(x,G))}}}d.race=F;function F(b){var D=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var B=b.length,j=!1;if(!B)return this.resolve([]);for(var G=-1,te=new this(i);++G<B;)de(b[G]);return te;function de(x){D.resolve(x).then(function(R){j||(j=!0,s.resolve(te,R))},function(R){j||(j=!0,s.reject(te,R))})}}},{1:1}],3:[function(r,n,a){(function(o){typeof o.Promise!="function"&&(o.Promise=r(2))}).call(this,typeof mi<"u"?mi:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(r,n,a){var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S};function i(S,T){if(!(S instanceof T))throw new TypeError("Cannot call a class as a function")}function s(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var l=s();function c(){try{if(!l||!l.open)return!1;var S=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),T=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!S||T)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function u(S,T){S=S||[],T=T||{};try{return new Blob(S,T)}catch($){if($.name!=="TypeError")throw $;for(var M=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,L=new M,I=0;I<S.length;I+=1)L.append(S[I]);return L.getBlob(T.type)}}typeof Promise>"u"&&r(3);var d=Promise;function h(S,T){T&&S.then(function(M){T(null,M)},function(M){T(M)})}function p(S,T,M){typeof T=="function"&&S.then(T),typeof M=="function"&&S.catch(M)}function f(S){return typeof S!="string"&&(console.warn(S+" used as a key, but it is not a string."),S=String(S)),S}function y(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var m="local-forage-detect-blob-support",_=void 0,w={},A=Object.prototype.toString,F="readonly",b="readwrite";function D(S){for(var T=S.length,M=new ArrayBuffer(T),L=new Uint8Array(M),I=0;I<T;I++)L[I]=S.charCodeAt(I);return M}function B(S){return new d(function(T){var M=S.transaction(m,b),L=u([""]);M.objectStore(m).put(L,"key"),M.onabort=function(I){I.preventDefault(),I.stopPropagation(),T(!1)},M.oncomplete=function(){var I=navigator.userAgent.match(/Chrome\/(\d+)/),$=navigator.userAgent.match(/Edge\//);T($||!I||parseInt(I[1],10)>=43)}}).catch(function(){return!1})}function j(S){return typeof _=="boolean"?d.resolve(_):B(S).then(function(T){return _=T,_})}function G(S){var T=w[S.name],M={};M.promise=new d(function(L,I){M.resolve=L,M.reject=I}),T.deferredOperations.push(M),T.dbReady?T.dbReady=T.dbReady.then(function(){return M.promise}):T.dbReady=M.promise}function te(S){var T=w[S.name],M=T.deferredOperations.pop();if(M)return M.resolve(),M.promise}function de(S,T){var M=w[S.name],L=M.deferredOperations.pop();if(L)return L.reject(T),L.promise}function x(S,T){return new d(function(M,L){if(w[S.name]=w[S.name]||le(),S.db)if(T)G(S),S.db.close();else return M(S.db);var I=[S.name];T&&I.push(S.version);var $=l.open.apply(l,I);T&&($.onupgradeneeded=function(W){var q=$.result;try{q.createObjectStore(S.storeName),W.oldVersion<=1&&q.createObjectStore(m)}catch(X){if(X.name==="ConstraintError")console.warn('The database "'+S.name+'" has been upgraded from version '+W.oldVersion+" to version "+W.newVersion+', but the storage "'+S.storeName+'" already exists.');else throw X}}),$.onerror=function(W){W.preventDefault(),L($.error)},$.onsuccess=function(){var W=$.result;W.onversionchange=function(q){q.target.close()},M(W),te(S)}})}function R(S){return x(S,!1)}function k(S){return x(S,!0)}function E(S,T){if(!S.db)return!0;var M=!S.db.objectStoreNames.contains(S.storeName),L=S.version<S.db.version,I=S.version>S.db.version;if(L&&(S.version!==T&&console.warn('The database "'+S.name+`" can't be downgraded from version `+S.db.version+" to version "+S.version+"."),S.version=S.db.version),I||M){if(M){var $=S.db.version+1;$>S.version&&(S.version=$)}return!0}return!1}function H(S){return new d(function(T,M){var L=new FileReader;L.onerror=M,L.onloadend=function(I){var $=btoa(I.target.result||"");T({__local_forage_encoded_blob:!0,data:$,type:S.type})},L.readAsBinaryString(S)})}function N(S){var T=D(atob(S.data));return u([T],{type:S.type})}function C(S){return S&&S.__local_forage_encoded_blob}function P(S){var T=this,M=T._initReady().then(function(){var L=w[T._dbInfo.name];if(L&&L.dbReady)return L.dbReady});return p(M,S,S),M}function Z(S){G(S);for(var T=w[S.name],M=T.forages,L=0;L<M.length;L++){var I=M[L];I._dbInfo.db&&(I._dbInfo.db.close(),I._dbInfo.db=null)}return S.db=null,R(S).then(function($){return S.db=$,E(S)?k(S):$}).then(function($){S.db=T.db=$;for(var W=0;W<M.length;W++)M[W]._dbInfo.db=$}).catch(function($){throw de(S,$),$})}function ne(S,T,M,L){L===void 0&&(L=1);try{var I=S.db.transaction(S.storeName,T);M(null,I)}catch($){if(L>0&&(!S.db||$.name==="InvalidStateError"||$.name==="NotFoundError"))return d.resolve().then(function(){if(!S.db||$.name==="NotFoundError"&&!S.db.objectStoreNames.contains(S.storeName)&&S.version<=S.db.version)return S.db&&(S.version=S.db.version+1),k(S)}).then(function(){return Z(S).then(function(){ne(S,T,M,L-1)})}).catch(M);M($)}}function le(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function ye(S){var T=this,M={db:null};if(S)for(var L in S)M[L]=S[L];var I=w[M.name];I||(I=le(),w[M.name]=I),I.forages.push(T),T._initReady||(T._initReady=T.ready,T.ready=P);var $=[];function W(){return d.resolve()}for(var q=0;q<I.forages.length;q++){var X=I.forages[q];X!==T&&$.push(X._initReady().catch(W))}var K=I.forages.slice(0);return d.all($).then(function(){return M.db=I.db,R(M)}).then(function(J){return M.db=J,E(M,T._defaultConfig.version)?k(M):J}).then(function(J){M.db=I.db=J,T._dbInfo=M;for(var fe=0;fe<K.length;fe++){var Me=K[fe];Me!==T&&(Me._dbInfo.db=M.db,Me._dbInfo.version=M.version)}})}function we(S,T){var M=this;S=f(S);var L=new d(function(I,$){M.ready().then(function(){ne(M._dbInfo,F,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=X.get(S);K.onsuccess=function(){var J=K.result;J===void 0&&(J=null),C(J)&&(J=N(J)),I(J)},K.onerror=function(){$(K.error)}}catch(J){$(J)}})}).catch($)});return h(L,T),L}function De(S,T){var M=this,L=new d(function(I,$){M.ready().then(function(){ne(M._dbInfo,F,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=X.openCursor(),J=1;K.onsuccess=function(){var fe=K.result;if(fe){var Me=fe.value;C(Me)&&(Me=N(Me));var $e=S(Me,fe.key,J++);$e!==void 0?I($e):fe.continue()}else I()},K.onerror=function(){$(K.error)}}catch(fe){$(fe)}})}).catch($)});return h(L,T),L}function Xe(S,T,M){var L=this;S=f(S);var I=new d(function($,W){var q;L.ready().then(function(){return q=L._dbInfo,A.call(T)==="[object Blob]"?j(q.db).then(function(X){return X?T:H(T)}):T}).then(function(X){ne(L._dbInfo,b,function(K,J){if(K)return W(K);try{var fe=J.objectStore(L._dbInfo.storeName);X===null&&(X=void 0);var Me=fe.put(X,S);J.oncomplete=function(){X===void 0&&(X=null),$(X)},J.onabort=J.onerror=function(){var $e=Me.error?Me.error:Me.transaction.error;W($e)}}catch($e){W($e)}})}).catch(W)});return h(I,M),I}function Dt(S,T){var M=this;S=f(S);var L=new d(function(I,$){M.ready().then(function(){ne(M._dbInfo,b,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=X.delete(S);q.oncomplete=function(){I()},q.onerror=function(){$(K.error)},q.onabort=function(){var J=K.error?K.error:K.transaction.error;$(J)}}catch(J){$(J)}})}).catch($)});return h(L,T),L}function Ft(S){var T=this,M=new d(function(L,I){T.ready().then(function(){ne(T._dbInfo,b,function($,W){if($)return I($);try{var q=W.objectStore(T._dbInfo.storeName),X=q.clear();W.oncomplete=function(){L()},W.onabort=W.onerror=function(){var K=X.error?X.error:X.transaction.error;I(K)}}catch(K){I(K)}})}).catch(I)});return h(M,S),M}function Fe(S){var T=this,M=new d(function(L,I){T.ready().then(function(){ne(T._dbInfo,F,function($,W){if($)return I($);try{var q=W.objectStore(T._dbInfo.storeName),X=q.count();X.onsuccess=function(){L(X.result)},X.onerror=function(){I(X.error)}}catch(K){I(K)}})}).catch(I)});return h(M,S),M}function dt(S,T){var M=this,L=new d(function(I,$){if(S<0){I(null);return}M.ready().then(function(){ne(M._dbInfo,F,function(W,q){if(W)return $(W);try{var X=q.objectStore(M._dbInfo.storeName),K=!1,J=X.openKeyCursor();J.onsuccess=function(){var fe=J.result;if(!fe){I(null);return}S===0||K?I(fe.key):(K=!0,fe.advance(S))},J.onerror=function(){$(J.error)}}catch(fe){$(fe)}})}).catch($)});return h(L,T),L}function Hn(S){var T=this,M=new d(function(L,I){T.ready().then(function(){ne(T._dbInfo,F,function($,W){if($)return I($);try{var q=W.objectStore(T._dbInfo.storeName),X=q.openKeyCursor(),K=[];X.onsuccess=function(){var J=X.result;if(!J){L(K);return}K.push(J.key),J.continue()},X.onerror=function(){I(X.error)}}catch(J){I(J)}})}).catch(I)});return h(M,S),M}function $a(S,T){T=y.apply(this,arguments);var M=this.config();S=typeof S!="function"&&S||{},S.name||(S.name=S.name||M.name,S.storeName=S.storeName||M.storeName);var L=this,I;if(!S.name)I=d.reject("Invalid arguments");else{var $=S.name===M.name&&L._dbInfo.db,W=$?d.resolve(L._dbInfo.db):R(S).then(function(q){var X=w[S.name],K=X.forages;X.db=q;for(var J=0;J<K.length;J++)K[J]._dbInfo.db=q;return q});S.storeName?I=W.then(function(q){if(q.objectStoreNames.contains(S.storeName)){var X=q.version+1;G(S);var K=w[S.name],J=K.forages;q.close();for(var fe=0;fe<J.length;fe++){var Me=J[fe];Me._dbInfo.db=null,Me._dbInfo.version=X}var $e=new d(function(Le,tt){var qe=l.open(S.name,X);qe.onerror=function(Ut){var Wh=qe.result;Wh.close(),tt(Ut)},qe.onupgradeneeded=function(){var Ut=qe.result;Ut.deleteObjectStore(S.storeName)},qe.onsuccess=function(){var Ut=qe.result;Ut.close(),Le(Ut)}});return $e.then(function(Le){K.db=Le;for(var tt=0;tt<J.length;tt++){var qe=J[tt];qe._dbInfo.db=Le,te(qe._dbInfo)}}).catch(function(Le){throw(de(S,Le)||d.resolve()).catch(function(){}),Le})}}):I=W.then(function(q){G(S);var X=w[S.name],K=X.forages;q.close();for(var J=0;J<K.length;J++){var fe=K[J];fe._dbInfo.db=null}var Me=new d(function($e,Le){var tt=l.deleteDatabase(S.name);tt.onerror=function(){var qe=tt.result;qe&&qe.close(),Le(tt.error)},tt.onblocked=function(){console.warn('dropInstance blocked for database "'+S.name+'" until all open connections are closed')},tt.onsuccess=function(){var qe=tt.result;qe&&qe.close(),$e(qe)}});return Me.then(function($e){X.db=$e;for(var Le=0;Le<K.length;Le++){var tt=K[Le];te(tt._dbInfo)}}).catch(function($e){throw(de(S,$e)||d.resolve()).catch(function(){}),$e})})}return h(I,T),I}var gt={_driver:"asyncStorage",_initStorage:ye,_support:c(),iterate:De,getItem:we,setItem:Xe,removeItem:Dt,clear:Ft,length:Fe,key:dt,keys:Hn,dropInstance:$a};function ri(){return typeof openDatabase=="function"}var $t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",za="~~local_forage_type~",Ua=/^~~local_forage_type~([^~]+)~/,fn="__lfsc__:",Sr=fn.length,ni="arbf",ar="blob",mn="si08",ai="ui08",Ba="uic8",or="si16",zt="si32",oi="ur16",Ha="ui32",yl="fl32",ir="fl64",ii=Sr+ni.length,si=Object.prototype.toString;function li(S){var T=S.length*.75,M=S.length,L,I=0,$,W,q,X;S[S.length-1]==="="&&(T--,S[S.length-2]==="="&&T--);var K=new ArrayBuffer(T),J=new Uint8Array(K);for(L=0;L<M;L+=4)$=$t.indexOf(S[L]),W=$t.indexOf(S[L+1]),q=$t.indexOf(S[L+2]),X=$t.indexOf(S[L+3]),J[I++]=$<<2|W>>4,J[I++]=(W&15)<<4|q>>2,J[I++]=(q&3)<<6|X&63;return K}function ci(S){var T=new Uint8Array(S),M="",L;for(L=0;L<T.length;L+=3)M+=$t[T[L]>>2],M+=$t[(T[L]&3)<<4|T[L+1]>>4],M+=$t[(T[L+1]&15)<<2|T[L+2]>>6],M+=$t[T[L+2]&63];return T.length%3===2?M=M.substring(0,M.length-1)+"=":T.length%3===1&&(M=M.substring(0,M.length-2)+"=="),M}function _l(S,T){var M="";if(S&&(M=si.call(S)),S&&(M==="[object ArrayBuffer]"||S.buffer&&si.call(S.buffer)==="[object ArrayBuffer]")){var L,I=fn;S instanceof ArrayBuffer?(L=S,I+=ni):(L=S.buffer,M==="[object Int8Array]"?I+=mn:M==="[object Uint8Array]"?I+=ai:M==="[object Uint8ClampedArray]"?I+=Ba:M==="[object Int16Array]"?I+=or:M==="[object Uint16Array]"?I+=oi:M==="[object Int32Array]"?I+=zt:M==="[object Uint32Array]"?I+=Ha:M==="[object Float32Array]"?I+=yl:M==="[object Float64Array]"?I+=ir:T(new Error("Failed to get type for BinaryArray"))),T(I+ci(L))}else if(M==="[object Blob]"){var $=new FileReader;$.onload=function(){var W=za+S.type+"~"+ci(this.result);T(fn+ar+W)},$.readAsArrayBuffer(S)}else try{T(JSON.stringify(S))}catch(W){console.error("Couldn't convert value into a JSON string: ",S),T(null,W)}}function Wa(S){if(S.substring(0,Sr)!==fn)return JSON.parse(S);var T=S.substring(ii),M=S.substring(Sr,ii),L;if(M===ar&&Ua.test(T)){var I=T.match(Ua);L=I[1],T=T.substring(I[0].length)}var $=li(T);switch(M){case ni:return $;case ar:return u([$],{type:L});case mn:return new Int8Array($);case ai:return new Uint8Array($);case Ba:return new Uint8ClampedArray($);case or:return new Int16Array($);case oi:return new Uint16Array($);case zt:return new Int32Array($);case Ha:return new Uint32Array($);case yl:return new Float32Array($);case ir:return new Float64Array($);default:throw new Error("Unkown type: "+M)}}var Ga={serialize:_l,deserialize:Wa,stringToBuffer:li,bufferToString:ci};function qa(S,T,M,L){S.executeSql("CREATE TABLE IF NOT EXISTS "+T.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],M,L)}function zh(S){var T=this,M={db:null};if(S)for(var L in S)M[L]=typeof S[L]!="string"?S[L].toString():S[L];var I=new d(function($,W){try{M.db=openDatabase(M.name,String(M.version),M.description,M.size)}catch(q){return W(q)}M.db.transaction(function(q){qa(q,M,function(){T._dbInfo=M,$()},function(X,K){W(K)})},W)});return M.serializer=Ga,I}function sr(S,T,M,L,I,$){S.executeSql(M,L,I,function(W,q){q.code===q.SYNTAX_ERR?W.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[T.storeName],function(X,K){K.rows.length?$(X,q):qa(X,T,function(){X.executeSql(M,L,I,$)},$)},$):$(W,q)},$)}function Uh(S,T){var M=this;S=f(S);var L=new d(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){sr(q,W,"SELECT * FROM "+W.storeName+" WHERE key = ? LIMIT 1",[S],function(X,K){var J=K.rows.length?K.rows.item(0).value:null;J&&(J=W.serializer.deserialize(J)),I(J)},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function vl(S,T){var M=this,L=new d(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){sr(q,W,"SELECT * FROM "+W.storeName,[],function(X,K){for(var J=K.rows,fe=J.length,Me=0;Me<fe;Me++){var $e=J.item(Me),Le=$e.value;if(Le&&(Le=W.serializer.deserialize(Le)),Le=S(Le,$e.key,Me+1),Le!==void 0){I(Le);return}}I()},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function Wn(S,T,M,L){var I=this;S=f(S);var $=new d(function(W,q){I.ready().then(function(){T===void 0&&(T=null);var X=T,K=I._dbInfo;K.serializer.serialize(T,function(J,fe){fe?q(fe):K.db.transaction(function(Me){sr(Me,K,"INSERT OR REPLACE INTO "+K.storeName+" (key, value) VALUES (?, ?)",[S,J],function(){W(X)},function($e,Le){q(Le)})},function(Me){if(Me.code===Me.QUOTA_ERR){if(L>0){W(Wn.apply(I,[S,X,M,L-1]));return}q(Me)}})})}).catch(q)});return h($,M),$}function Va(S,T,M){return Wn.apply(this,[S,T,M,1])}function Bh(S,T){var M=this;S=f(S);var L=new d(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){sr(q,W,"DELETE FROM "+W.storeName+" WHERE key = ?",[S],function(){I()},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function Hh(S){var T=this,M=new d(function(L,I){T.ready().then(function(){var $=T._dbInfo;$.db.transaction(function(W){sr(W,$,"DELETE FROM "+$.storeName,[],function(){L()},function(q,X){I(X)})})}).catch(I)});return h(M,S),M}function O(S){var T=this,M=new d(function(L,I){T.ready().then(function(){var $=T._dbInfo;$.db.transaction(function(W){sr(W,$,"SELECT COUNT(key) as c FROM "+$.storeName,[],function(q,X){var K=X.rows.item(0).c;L(K)},function(q,X){I(X)})})}).catch(I)});return h(M,S),M}function z(S,T){var M=this,L=new d(function(I,$){M.ready().then(function(){var W=M._dbInfo;W.db.transaction(function(q){sr(q,W,"SELECT key FROM "+W.storeName+" WHERE id = ? LIMIT 1",[S+1],function(X,K){var J=K.rows.length?K.rows.item(0).key:null;I(J)},function(X,K){$(K)})})}).catch($)});return h(L,T),L}function U(S){var T=this,M=new d(function(L,I){T.ready().then(function(){var $=T._dbInfo;$.db.transaction(function(W){sr(W,$,"SELECT key FROM "+$.storeName,[],function(q,X){for(var K=[],J=0;J<X.rows.length;J++)K.push(X.rows.item(J).key);L(K)},function(q,X){I(X)})})}).catch(I)});return h(M,S),M}function V(S){return new d(function(T,M){S.transaction(function(L){L.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(I,$){for(var W=[],q=0;q<$.rows.length;q++)W.push($.rows.item(q).name);T({db:S,storeNames:W})},function(I,$){M($)})},function(L){M(L)})})}function oe(S,T){T=y.apply(this,arguments);var M=this.config();S=typeof S!="function"&&S||{},S.name||(S.name=S.name||M.name,S.storeName=S.storeName||M.storeName);var L=this,I;return S.name?I=new d(function($){var W;S.name===M.name?W=L._dbInfo.db:W=openDatabase(S.name,"","",0),S.storeName?$({db:W,storeNames:[S.storeName]}):$(V(W))}).then(function($){return new d(function(W,q){$.db.transaction(function(X){function K($e){return new d(function(Le,tt){X.executeSql("DROP TABLE IF EXISTS "+$e,[],function(){Le()},function(qe,Ut){tt(Ut)})})}for(var J=[],fe=0,Me=$.storeNames.length;fe<Me;fe++)J.push(K($.storeNames[fe]));d.all(J).then(function(){W()}).catch(function($e){q($e)})},function(X){q(X)})})}):I=d.reject("Invalid arguments"),h(I,T),I}var pe={_driver:"webSQLStorage",_initStorage:zh,_support:ri(),iterate:vl,getItem:Uh,setItem:Va,removeItem:Bh,clear:Hh,length:O,key:z,keys:U,dropInstance:oe};function ge(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ie(S,T){var M=S.name+"/";return S.storeName!==T.storeName&&(M+=S.storeName+"/"),M}function ue(){var S="_localforage_support_test";try{return localStorage.setItem(S,!0),localStorage.removeItem(S),!1}catch{return!0}}function ee(){return!ue()||localStorage.length>0}function _e(S){var T=this,M={};if(S)for(var L in S)M[L]=S[L];return M.keyPrefix=ie(S,T._defaultConfig),ee()?(T._dbInfo=M,M.serializer=Ga,d.resolve()):d.reject()}function Ae(S){var T=this,M=T.ready().then(function(){for(var L=T._dbInfo.keyPrefix,I=localStorage.length-1;I>=0;I--){var $=localStorage.key(I);$.indexOf(L)===0&&localStorage.removeItem($)}});return h(M,S),M}function Ue(S,T){var M=this;S=f(S);var L=M.ready().then(function(){var I=M._dbInfo,$=localStorage.getItem(I.keyPrefix+S);return $&&($=I.serializer.deserialize($)),$});return h(L,T),L}function Ge(S,T){var M=this,L=M.ready().then(function(){for(var I=M._dbInfo,$=I.keyPrefix,W=$.length,q=localStorage.length,X=1,K=0;K<q;K++){var J=localStorage.key(K);if(J.indexOf($)===0){var fe=localStorage.getItem(J);if(fe&&(fe=I.serializer.deserialize(fe)),fe=S(fe,J.substring(W),X++),fe!==void 0)return fe}}});return h(L,T),L}function Re(S,T){var M=this,L=M.ready().then(function(){var I=M._dbInfo,$;try{$=localStorage.key(S)}catch{$=null}return $&&($=$.substring(I.keyPrefix.length)),$});return h(L,T),L}function wt(S){var T=this,M=T.ready().then(function(){for(var L=T._dbInfo,I=localStorage.length,$=[],W=0;W<I;W++){var q=localStorage.key(W);q.indexOf(L.keyPrefix)===0&&$.push(q.substring(L.keyPrefix.length))}return $});return h(M,S),M}function Je(S){var T=this,M=T.keys().then(function(L){return L.length});return h(M,S),M}function Gn(S,T){var M=this;S=f(S);var L=M.ready().then(function(){var I=M._dbInfo;localStorage.removeItem(I.keyPrefix+S)});return h(L,T),L}function lr(S,T,M){var L=this;S=f(S);var I=L.ready().then(function(){T===void 0&&(T=null);var $=T;return new d(function(W,q){var X=L._dbInfo;X.serializer.serialize(T,function(K,J){if(J)q(J);else try{localStorage.setItem(X.keyPrefix+S,K),W($)}catch(fe){(fe.name==="QuotaExceededError"||fe.name==="NS_ERROR_DOM_QUOTA_REACHED")&&q(fe),q(fe)}})})});return h(I,M),I}function gn(S,T){if(T=y.apply(this,arguments),S=typeof S!="function"&&S||{},!S.name){var M=this.config();S.name=S.name||M.name,S.storeName=S.storeName||M.storeName}var L=this,I;return S.name?I=new d(function($){S.storeName?$(ie(S,L._defaultConfig)):$(S.name+"/")}).then(function($){for(var W=localStorage.length-1;W>=0;W--){var q=localStorage.key(W);q.indexOf($)===0&&localStorage.removeItem(q)}}):I=d.reject("Invalid arguments"),h(I,T),I}var xr={_driver:"localStorageWrapper",_initStorage:_e,_support:ge(),iterate:Ge,getItem:Ue,setItem:lr,removeItem:Gn,clear:Ae,length:Je,key:Re,keys:wt,dropInstance:gn},ui=function(S,T){return S===T||typeof S=="number"&&typeof T=="number"&&isNaN(S)&&isNaN(T)},cr=function(S,T){for(var M=S.length,L=0;L<M;){if(ui(S[L],T))return!0;L++}return!1},qn=Array.isArray||function(S){return Object.prototype.toString.call(S)==="[object Array]"},kr={},Vn={},Te={INDEXEDDB:gt,WEBSQL:pe,LOCALSTORAGE:xr},bt=[Te.INDEXEDDB._driver,Te.WEBSQL._driver,Te.LOCALSTORAGE._driver],Ar=["dropInstance"],Be=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ar),yn={description:"",driver:bt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function wl(S,T){S[T]=function(){var M=arguments;return S.ready().then(function(){return S[T].apply(S,M)})}}function di(){for(var S=1;S<arguments.length;S++){var T=arguments[S];if(T)for(var M in T)T.hasOwnProperty(M)&&(qn(T[M])?arguments[0][M]=T[M].slice():arguments[0][M]=T[M])}return arguments[0]}var UN=function(){function S(T){i(this,S);for(var M in Te)if(Te.hasOwnProperty(M)){var L=Te[M],I=L._driver;this[M]=I,kr[I]||this.defineDriver(L)}this._defaultConfig=di({},yn),this._config=di({},this._defaultConfig,T),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return S.prototype.config=function(T){if((typeof T>"u"?"undefined":o(T))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var M in T){if(M==="storeName"&&(T[M]=T[M].replace(/\W/g,"_")),M==="version"&&typeof T[M]!="number")return new Error("Database version must be a number.");this._config[M]=T[M]}return"driver"in T&&T.driver?this.setDriver(this._config.driver):!0}else return typeof T=="string"?this._config[T]:this._config},S.prototype.defineDriver=function(T,M,L){var I=new d(function($,W){try{var q=T._driver,X=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!T._driver){W(X);return}for(var K=Be.concat("_initStorage"),J=0,fe=K.length;J<fe;J++){var Me=K[J],$e=!cr(Ar,Me);if(($e||T[Me])&&typeof T[Me]!="function"){W(X);return}}var Le=function(){for(var qe=function(HN){return function(){var WN=new Error("Method "+HN+" is not implemented by the current driver"),Jb=d.reject(WN);return h(Jb,arguments[arguments.length-1]),Jb}},Ut=0,Wh=Ar.length;Ut<Wh;Ut++){var Gh=Ar[Ut];T[Gh]||(T[Gh]=qe(Gh))}};Le();var tt=function(qe){kr[q]&&console.info("Redefining LocalForage driver: "+q),kr[q]=T,Vn[q]=qe,$()};"_support"in T?T._support&&typeof T._support=="function"?T._support().then(tt,W):tt(!!T._support):tt(!0)}catch(qe){W(qe)}});return p(I,M,L),I},S.prototype.driver=function(){return this._driver||null},S.prototype.getDriver=function(T,M,L){var I=kr[T]?d.resolve(kr[T]):d.reject(new Error("Driver not found."));return p(I,M,L),I},S.prototype.getSerializer=function(T){var M=d.resolve(Ga);return p(M,T),M},S.prototype.ready=function(T){var M=this,L=M._driverSet.then(function(){return M._ready===null&&(M._ready=M._initDriver()),M._ready});return p(L,T,T),L},S.prototype.setDriver=function(T,M,L){var I=this;qn(T)||(T=[T]);var $=this._getSupportedDrivers(T);function W(){I._config.driver=I.driver()}function q(J){return I._extend(J),W(),I._ready=I._initStorage(I._config),I._ready}function X(J){return function(){var fe=0;function Me(){for(;fe<J.length;){var $e=J[fe];return fe++,I._dbInfo=null,I._ready=null,I.getDriver($e).then(q).catch(Me)}W();var Le=new Error("No available storage method found.");return I._driverSet=d.reject(Le),I._driverSet}return Me()}}var K=this._driverSet!==null?this._driverSet.catch(function(){return d.resolve()}):d.resolve();return this._driverSet=K.then(function(){var J=$[0];return I._dbInfo=null,I._ready=null,I.getDriver(J).then(function(fe){I._driver=fe._driver,W(),I._wrapLibraryMethodsWithReady(),I._initDriver=X($)})}).catch(function(){W();var J=new Error("No available storage method found.");return I._driverSet=d.reject(J),I._driverSet}),p(this._driverSet,M,L),this._driverSet},S.prototype.supports=function(T){return!!Vn[T]},S.prototype._extend=function(T){di(this,T)},S.prototype._getSupportedDrivers=function(T){for(var M=[],L=0,I=T.length;L<I;L++){var $=T[L];this.supports($)&&M.push($)}return M},S.prototype._wrapLibraryMethodsWithReady=function(){for(var T=0,M=Be.length;T<M;T++)wl(this,Be[T])},S.prototype.createInstance=function(T){return new S(T)},S}(),BN=new UN;n.exports=BN},{3:3}]},{},[4])(4)})}(db)),db.exports}var WO=HO();const pb=Ja(WO);class GO extends st{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,r){throw new Error("Not implemented!")}async invoke(e,r){return this.getRelevantDocuments(e,Ie(r))}async getRelevantDocuments(e,r){var o;const n=Ie(nF(r)),a=await((o=await Ot.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}))==null?void 0:o.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName));try{const i=await this._getRelevantDocuments(e,a);return await(a==null?void 0:a.handleRetrieverEnd(i)),i}catch(i){throw await(a==null?void 0:a.handleRetrieverError(i)),i}}}class Rh extends GO{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,r){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},r==null?void 0:r.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,r==null?void 0:r.getChild("vectorstore"))}async addDocuments(e,r){return this.vectorStore.addDocuments(e,r)}}class fb extends En{constructor(e,r){super(r),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,r=4,n=void 0,a=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)).map(o=>o[0])}async similaritySearchWithScore(e,r=4,n=void 0,a=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)}static fromTexts(e,r,n,a){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,r,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,r,n,a,o,i){if(typeof e=="number")return new Rh({vectorStore:this,k:e,filter:r,tags:[...a??[],this._vectorstoreType()],metadata:o,verbose:i,callbacks:n});{const s={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Rh({...s,searchKwargs:e.searchKwargs}):new Rh({...s})}}}function qO(t,e){let r=0,n=0,a=0;for(let o=0;o<t.length;o++)r+=t[o]*e[o],n+=t[o]*t[o],a+=e[o]*e[o];return r/(Math.sqrt(n)*Math.sqrt(a))}function VO(t,e){let r=0,n=0,a=0;for(let o=0;o<t.length;o++)r+=t[o]*e[o],n+=t[o]*t[o],a+=e[o]*e[o];return r/(Math.sqrt(n)*Math.sqrt(a))}function ZO(t,e,r){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(n=>e.map(a=>r(n,a)).map(a=>Number.isNaN(a)?0:a))}function mb(t,e){return ZO(t,e,VO)}function JO(t,e,r=.5,n=4){if(Math.min(n,e.length)<=0)return[];const a=Array.isArray(t[0])?t:[t],o=mb(a,e)[0],i=KO(o).maxIndex,s=[e[i]],l=[i];for(;l.length<Math.min(n,e.length);){let c=-1/0,u=-1;const d=mb(e,s);o.forEach((h,p)=>{if(l.includes(p))return;const f=Math.max(...d[p]),y=r*h-(1-r)*f;y>c&&(c=y,u=p)}),s.push(e[u]),l.push(u)}return l}function KO(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],r=0;for(let n=1;n<t.length;n+=1)t[n]>e&&(r=n,e=t[n]);return{maxIndex:r,maxValue:e}}class Ca extends fb{_vectorstoreType(){return"memory"}constructor(e,{similarity:r,...n}={}){super(e,n),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=r??qO}async addDocuments(e){const r=e.map(({pageContent:n})=>n);return this.addVectors(await this.embeddings.embedDocuments(r),e)}async addVectors(e,r){const n=e.map((a,o)=>({content:r[o].pageContent,embedding:a,metadata:r[o].metadata,id:r[o].id}));this.memoryVectors=this.memoryVectors.concat(n)}async _queryVectors(e,r,n){const a=o=>{if(!n)return!0;const i=new kn({metadata:o.metadata,pageContent:o.content,id:o.id});return n(i)};return this.memoryVectors.filter(a).map((o,i)=>({similarity:this.similarity(e,o.embedding),index:i,metadata:o.metadata,content:o.content,embedding:o.embedding,id:o.id})).sort((o,i)=>o.similarity>i.similarity?-1:0).slice(0,r)}async similaritySearchVectorWithScore(e,r,n){return(await this._queryVectors(e,r,n)).map(a=>[new kn({metadata:a.metadata,pageContent:a.content,id:a.id}),a.similarity])}async maxMarginalRelevanceSearch(e,r){const n=await this.embeddings.embedQuery(e),a=await this._queryVectors(n,r.fetchK??20,r.filter),o=a.map(i=>i.embedding);return JO(n,o,r.lambda,r.k).map(i=>new kn({metadata:a[i].metadata,pageContent:a[i].content,id:a[i].id}))}static async fromTexts(e,r,n,a){const o=[];for(let i=0;i<e.length;i+=1){const s=Array.isArray(r)?r[i]:r,l=new kn({pageContent:e[i],metadata:s});o.push(l)}return Ca.fromDocuments(o,n,a)}static async fromDocuments(e,r,n){const a=new this(r,n);return await a.addDocuments(e),a}static async fromExistingIndex(e,r){return new this(e,r)}}class Un extends fb{_vectorstoreType(){return"voi"}constructor(e,r){super(r,{}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numDimensions",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"docstore",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.client=e,this.embeddings=r}async addDocuments(e){const r=e.map(({pageContent:o})=>o);if(e.length===0)return;const n=(await this.embeddings.embedDocuments(r.slice(0,1)))[0];if(this.numDimensions===null)this.numDimensions=n.length;else if(this.numDimensions!==n.length)throw new Error(`Vectors must have the same length as the number of dimensions (${this.numDimensions})`);const a=await this.embeddings.embedDocuments(r.slice(1));await this.addVectors([n,...a],e)}async addVectors(e,r){if(e.length===0)return;if(this.numDimensions===null&&(this.numDimensions=e[0].length),e.length!==r.length)throw new Error("Vectors and metadata must have the same length");if(!e.every(a=>a.length===this.numDimensions))throw new Error(`Vectors must have the same length as the number of dimensions (${this.numDimensions})`);e.forEach((a,o)=>{const i=r[o];this.docstore.push({embeddings:a,document:i})});const n=this.docstore.map((a,o)=>({id:String(o),embeddings:a.embeddings,title:"",url:""}));this.client.index({embeddings:n})}async similaritySearchVectorWithScore(e,r){if(this.numDimensions===null)throw new Error("There aren't any elements in the index yet.");if(e.length!==this.numDimensions)throw new Error(`Query vector must have the same length as the number of dimensions (${this.numDimensions})`);const n=Math.min(this.docstore.length,r);return n>this.docstore.length&&console.warn(`k (${r}) is greater than the number of elements in the index (${this.docstore.length}), setting k to ${n}`),this.client.search(new Float32Array(e),n).neighbors.map(({id:a},o)=>[this.docstore[parseInt(a,10)].document,o])}async delete(e){if(e.deleteAll===!0)await this.client.clear();else throw new Error('You must provide a "deleteAll" parameter.')}static async fromTexts(e,r,n,a){const o=[];for(let i=0;i<e.length;i+=1){const s=Array.isArray(r)?r[i]:r,l=new kn({pageContent:e[i],metadata:s});o.push(l)}return Un.fromDocuments(o,n,a)}static async fromDocuments(e,r,n){const a=new Un(n,r);return await a.addDocuments(e),a}}var gb={exports:{}};let yb;yb={},mf=Object.freeze(Object.defineProperty({__proto__:null,default:yb},Symbol.toStringTag,{value:"Module"})),vp=rI(mf);var _b;function YO(){return _b||(_b=1,function(t){(function(){var e="input is invalid type",r="finalize already called",n=typeof window=="object",a=n?window:{};a.JS_MD5_NO_WINDOW&&(n=!1);var o=!n&&typeof self=="object",i=!a.JS_MD5_NO_NODE_JS&&typeof yt=="object"&&yt.versions&&yt.versions.node;i?a=mi:o&&(a=self);var s=!a.JS_MD5_NO_COMMON_JS&&!0&&t.exports,l=!a.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),u=[128,32768,8388608,-2147483648],d=[0,8,16,24],h=["hex","array","digest","buffer","arrayBuffer","base64"],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),f=[],y;if(l){var m=new ArrayBuffer(68);y=new Uint8Array(m),f=new Uint32Array(m)}var _=Array.isArray;(a.JS_MD5_NO_NODE_JS||!_)&&(_=function(x){return Object.prototype.toString.call(x)==="[object Array]"});var w=ArrayBuffer.isView;l&&(a.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!w)&&(w=function(x){return typeof x=="object"&&x.buffer&&x.buffer.constructor===ArrayBuffer});var A=function(x){var R=typeof x;if(R==="string")return[x,!0];if(R!=="object"||x===null)throw new Error(e);if(l&&x.constructor===ArrayBuffer)return[new Uint8Array(x),!1];if(!_(x)&&!w(x))throw new Error(e);return[x,!1]},F=function(x){return function(R){return new G(!0).update(R)[x]()}},b=function(){var x=F("hex");i&&(x=D(x)),x.create=function(){return new G},x.update=function(E){return x.create().update(E)};for(var R=0;R<h.length;++R){var k=h[R];x[k]=F(k)}return x},D=function(x){var R=vp,k=nI().Buffer,E;k.from&&!a.JS_MD5_NO_BUFFER_FROM?E=k.from:E=function(N){return new k(N)};var H=function(N){if(typeof N=="string")return R.createHash("md5").update(N,"utf8").digest("hex");if(N==null)throw new Error(e);return N.constructor===ArrayBuffer&&(N=new Uint8Array(N)),_(N)||w(N)||N.constructor===k?R.createHash("md5").update(E(N)).digest("hex"):x(N)};return H},B=function(x){return function(R,k){return new te(R,!0).update(k)[x]()}},j=function(){var x=B("hex");x.create=function(E){return new te(E)},x.update=function(E,H){return x.create(E).update(H)};for(var R=0;R<h.length;++R){var k=h[R];x[k]=B(k)}return x};function G(x){if(x)f[0]=f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0,this.blocks=f,this.buffer8=y;else if(l){var R=new ArrayBuffer(68);this.buffer8=new Uint8Array(R),this.blocks=new Uint32Array(R)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}G.prototype.update=function(x){if(this.finalized)throw new Error(r);var R=A(x);x=R[0];for(var k=R[1],E,H=0,N,C=x.length,P=this.blocks,Z=this.buffer8;H<C;){if(this.hashed&&(this.hashed=!1,P[0]=P[16],P[16]=P[1]=P[2]=P[3]=P[4]=P[5]=P[6]=P[7]=P[8]=P[9]=P[10]=P[11]=P[12]=P[13]=P[14]=P[15]=0),k)if(l)for(N=this.start;H<C&&N<64;++H)E=x.charCodeAt(H),E<128?Z[N++]=E:E<2048?(Z[N++]=192|E>>>6,Z[N++]=128|E&63):E<55296||E>=57344?(Z[N++]=224|E>>>12,Z[N++]=128|E>>>6&63,Z[N++]=128|E&63):(E=65536+((E&1023)<<10|x.charCodeAt(++H)&1023),Z[N++]=240|E>>>18,Z[N++]=128|E>>>12&63,Z[N++]=128|E>>>6&63,Z[N++]=128|E&63);else for(N=this.start;H<C&&N<64;++H)E=x.charCodeAt(H),E<128?P[N>>>2]|=E<<d[N++&3]:E<2048?(P[N>>>2]|=(192|E>>>6)<<d[N++&3],P[N>>>2]|=(128|E&63)<<d[N++&3]):E<55296||E>=57344?(P[N>>>2]|=(224|E>>>12)<<d[N++&3],P[N>>>2]|=(128|E>>>6&63)<<d[N++&3],P[N>>>2]|=(128|E&63)<<d[N++&3]):(E=65536+((E&1023)<<10|x.charCodeAt(++H)&1023),P[N>>>2]|=(240|E>>>18)<<d[N++&3],P[N>>>2]|=(128|E>>>12&63)<<d[N++&3],P[N>>>2]|=(128|E>>>6&63)<<d[N++&3],P[N>>>2]|=(128|E&63)<<d[N++&3]);else if(l)for(N=this.start;H<C&&N<64;++H)Z[N++]=x[H];else for(N=this.start;H<C&&N<64;++H)P[N>>>2]|=x[H]<<d[N++&3];this.lastByteIndex=N,this.bytes+=N-this.start,N>=64?(this.start=N-64,this.hash(),this.hashed=!0):this.start=N}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},G.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var x=this.blocks,R=this.lastByteIndex;x[R>>>2]|=u[R&3],R>=56&&(this.hashed||this.hash(),x[0]=x[16],x[16]=x[1]=x[2]=x[3]=x[4]=x[5]=x[6]=x[7]=x[8]=x[9]=x[10]=x[11]=x[12]=x[13]=x[14]=x[15]=0),x[14]=this.bytes<<3,x[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},G.prototype.hash=function(){var x,R,k,E,H,N,C=this.blocks;this.first?(x=C[0]-680876937,x=(x<<7|x>>>25)-271733879<<0,E=(-1732584194^x&2004318071)+C[1]-117830708,E=(E<<12|E>>>20)+x<<0,k=(-271733879^E&(x^-271733879))+C[2]-1126478375,k=(k<<17|k>>>15)+E<<0,R=(x^k&(E^x))+C[3]-1316259209,R=(R<<22|R>>>10)+k<<0):(x=this.h0,R=this.h1,k=this.h2,E=this.h3,x+=(E^R&(k^E))+C[0]-680876936,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[1]-389564586,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[2]+606105819,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[3]-1044525330,R=(R<<22|R>>>10)+k<<0),x+=(E^R&(k^E))+C[4]-176418897,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[5]+1200080426,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[6]-1473231341,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[7]-45705983,R=(R<<22|R>>>10)+k<<0,x+=(E^R&(k^E))+C[8]+1770035416,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[9]-1958414417,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[10]-42063,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[11]-1990404162,R=(R<<22|R>>>10)+k<<0,x+=(E^R&(k^E))+C[12]+1804603682,x=(x<<7|x>>>25)+R<<0,E+=(k^x&(R^k))+C[13]-40341101,E=(E<<12|E>>>20)+x<<0,k+=(R^E&(x^R))+C[14]-1502002290,k=(k<<17|k>>>15)+E<<0,R+=(x^k&(E^x))+C[15]+1236535329,R=(R<<22|R>>>10)+k<<0,x+=(k^E&(R^k))+C[1]-165796510,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[6]-1069501632,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[11]+643717713,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[0]-373897302,R=(R<<20|R>>>12)+k<<0,x+=(k^E&(R^k))+C[5]-701558691,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[10]+38016083,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[15]-660478335,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[4]-405537848,R=(R<<20|R>>>12)+k<<0,x+=(k^E&(R^k))+C[9]+568446438,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[14]-1019803690,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[3]-187363961,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[8]+1163531501,R=(R<<20|R>>>12)+k<<0,x+=(k^E&(R^k))+C[13]-1444681467,x=(x<<5|x>>>27)+R<<0,E+=(R^k&(x^R))+C[2]-51403784,E=(E<<9|E>>>23)+x<<0,k+=(x^R&(E^x))+C[7]+1735328473,k=(k<<14|k>>>18)+E<<0,R+=(E^x&(k^E))+C[12]-1926607734,R=(R<<20|R>>>12)+k<<0,H=R^k,x+=(H^E)+C[5]-378558,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[8]-2022574463,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[11]+1839030562,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[14]-35309556,R=(R<<23|R>>>9)+k<<0,H=R^k,x+=(H^E)+C[1]-1530992060,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[4]+1272893353,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[7]-155497632,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[10]-1094730640,R=(R<<23|R>>>9)+k<<0,H=R^k,x+=(H^E)+C[13]+681279174,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[0]-358537222,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[3]-722521979,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[6]+76029189,R=(R<<23|R>>>9)+k<<0,H=R^k,x+=(H^E)+C[9]-640364487,x=(x<<4|x>>>28)+R<<0,E+=(H^x)+C[12]-421815835,E=(E<<11|E>>>21)+x<<0,N=E^x,k+=(N^R)+C[15]+530742520,k=(k<<16|k>>>16)+E<<0,R+=(N^k)+C[2]-995338651,R=(R<<23|R>>>9)+k<<0,x+=(k^(R|~E))+C[0]-198630844,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[7]+1126891415,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[14]-1416354905,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[5]-57434055,R=(R<<21|R>>>11)+k<<0,x+=(k^(R|~E))+C[12]+1700485571,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[3]-1894986606,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[10]-1051523,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[1]-2054922799,R=(R<<21|R>>>11)+k<<0,x+=(k^(R|~E))+C[8]+1873313359,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[15]-30611744,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[6]-1560198380,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[13]+1309151649,R=(R<<21|R>>>11)+k<<0,x+=(k^(R|~E))+C[4]-145523070,x=(x<<6|x>>>26)+R<<0,E+=(R^(x|~k))+C[11]-1120210379,E=(E<<10|E>>>22)+x<<0,k+=(x^(E|~R))+C[2]+718787259,k=(k<<15|k>>>17)+E<<0,R+=(E^(k|~x))+C[9]-343485551,R=(R<<21|R>>>11)+k<<0,this.first?(this.h0=x+1732584193<<0,this.h1=R-271733879<<0,this.h2=k-1732584194<<0,this.h3=E+271733878<<0,this.first=!1):(this.h0=this.h0+x<<0,this.h1=this.h1+R<<0,this.h2=this.h2+k<<0,this.h3=this.h3+E<<0)},G.prototype.hex=function(){this.finalize();var x=this.h0,R=this.h1,k=this.h2,E=this.h3;return c[x>>>4&15]+c[x&15]+c[x>>>12&15]+c[x>>>8&15]+c[x>>>20&15]+c[x>>>16&15]+c[x>>>28&15]+c[x>>>24&15]+c[R>>>4&15]+c[R&15]+c[R>>>12&15]+c[R>>>8&15]+c[R>>>20&15]+c[R>>>16&15]+c[R>>>28&15]+c[R>>>24&15]+c[k>>>4&15]+c[k&15]+c[k>>>12&15]+c[k>>>8&15]+c[k>>>20&15]+c[k>>>16&15]+c[k>>>28&15]+c[k>>>24&15]+c[E>>>4&15]+c[E&15]+c[E>>>12&15]+c[E>>>8&15]+c[E>>>20&15]+c[E>>>16&15]+c[E>>>28&15]+c[E>>>24&15]},G.prototype.toString=G.prototype.hex,G.prototype.digest=function(){this.finalize();var x=this.h0,R=this.h1,k=this.h2,E=this.h3;return[x&255,x>>>8&255,x>>>16&255,x>>>24&255,R&255,R>>>8&255,R>>>16&255,R>>>24&255,k&255,k>>>8&255,k>>>16&255,k>>>24&255,E&255,E>>>8&255,E>>>16&255,E>>>24&255]},G.prototype.array=G.prototype.digest,G.prototype.arrayBuffer=function(){this.finalize();var x=new ArrayBuffer(16),R=new Uint32Array(x);return R[0]=this.h0,R[1]=this.h1,R[2]=this.h2,R[3]=this.h3,x},G.prototype.buffer=G.prototype.arrayBuffer,G.prototype.base64=function(){for(var x,R,k,E="",H=this.array(),N=0;N<15;)x=H[N++],R=H[N++],k=H[N++],E+=p[x>>>2]+p[(x<<4|R>>>4)&63]+p[(R<<2|k>>>6)&63]+p[k&63];return x=H[N],E+=p[x>>>2]+p[x<<4&63]+"==",E};function te(x,R){var k,E=A(x);if(x=E[0],E[1]){var H=[],N=x.length,C=0,P;for(k=0;k<N;++k)P=x.charCodeAt(k),P<128?H[C++]=P:P<2048?(H[C++]=192|P>>>6,H[C++]=128|P&63):P<55296||P>=57344?(H[C++]=224|P>>>12,H[C++]=128|P>>>6&63,H[C++]=128|P&63):(P=65536+((P&1023)<<10|x.charCodeAt(++k)&1023),H[C++]=240|P>>>18,H[C++]=128|P>>>12&63,H[C++]=128|P>>>6&63,H[C++]=128|P&63);x=H}x.length>64&&(x=new G(!0).update(x).array());var Z=[],ne=[];for(k=0;k<64;++k){var le=x[k]||0;Z[k]=92^le,ne[k]=54^le}G.call(this,R),this.update(ne),this.oKeyPad=Z,this.inner=!0,this.sharedMemory=R}te.prototype=new G,te.prototype.finalize=function(){if(G.prototype.finalize.call(this),this.inner){this.inner=!1;var x=this.array();G.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(x),G.prototype.finalize.call(this)}};var de=b();de.md5=de,de.md5.hmac=j(),s?t.exports=de:a.md5=de})()}(gb)),gb.exports}var XO=YO();let Xo,ja,Qo,Oh,ei;gi=t=>t?t.join("|\u294A|"):"",yi=t=>t?t.split("|\u294A|"):[],Xo=t=>t?t.join("|\u294C|"):"",Ti=t=>t?t.split("|\u294C|"):[],o0=(t,e)=>({headers:gi(t),data:Xo(e.map(r=>gi(r)))}),pp=(t,e)=>{const r=yi(t),n=Ti(e).reduce((a,o)=>{const i=yi(o);return i.length===r.length?[...a,r.reduce((s,l,c)=>({...s,[l]:i[c]}),{})]:a},[]);return{headers:r,rows:n}},ja=async({provider:t,storedData:e,databaseName:r})=>{switch(t){case"voy":return e.map((n,a)=>{var o,i;return{id:n.id||((o=n.metadata)==null?void 0:o.id)||a,title:JSON.stringify({pageContent:n.content,metadata:n.metadata}),url:`/${r}/items/${n.id||((i=n.metadata)==null?void 0:i.id)||a}`,embeddings:n.embedding}});case"memory":return e.map((n,a)=>{var o;return{content:n.content,embedding:n.embedding,metadata:n.metadata,id:n.id||((o=n.metadata)==null?void 0:o.id)||a}});default:throw new Error("Invalid provider")}},Qo=async({storageType:t,provider:e,databaseName:r,storageService:n,storageDataNode:a})=>{switch(t){case Wr.DataNode:{if(!a)throw new Error("Storage data node not found");if("csv"in a){const{rows:o}=pp((a==null?void 0:a.headers)||"",(a==null?void 0:a.csv)||"");return ja({provider:e,storedData:o,databaseName:r})}return"json"in a?ja({provider:e,storedData:JSON.parse((a==null?void 0:a.json)||"[]"),databaseName:r}):"jsonl"in a?ja({provider:e,storedData:Ti(a==null?void 0:a.jsonl).map(o=>JSON.parse(o)),databaseName:r}):[]}case Wr.DatabaseNode:return ja({provider:e,storedData:Ti(a==null?void 0:a.raw).map(o=>JSON.parse(o)),databaseName:r});case Wr.IndexedDB:{const o=await(n==null?void 0:n.getItem(r));return o?ja({provider:e,storedData:o,databaseName:r}):[]}default:throw new Error("Invalid storage type")}},Oh=async({docstore:t,storageType:e,databaseName:r,embeddingStorage:n,storageDataNode:a})=>{const o=t.map(i=>"embedding"in i?{id:i.id,embedding:i.embedding,content:i.content,metadata:i.metadata}:{id:i.document.metadata.id,content:i.document.pageContent,metadata:i.document.metadata,embedding:i.embeddings});switch(e){case Wr.DataNode:{if(a=a,!a)throw new Error("Storage data node not found");const i=fp(a);i==="CSVData"&&await We(i).update(a.id,{csv:Xo(o.map(s=>{const l=yi(a.headers).map(c=>s[c]);return gi(l)}))}),i==="JSONData"&&await We(i).update(a.id,{json:JSON.stringify(o)}),i==="JSONLData"&&await We(i).update(a.id,{jsonl:Xo(o.map(s=>JSON.stringify(s)))})}break;case Wr.DatabaseNode:{const i=a;await We("VectorDatabase").update(i.id,{raw:Xo(o.map(s=>JSON.stringify(s)))})}break;case Wr.IndexedDB:await n.setItem(r,o);break}return o},fp=t=>"csv"in t?"CSVData":"json"in t?"JSONData":"jsonl"in t?"JSONLData":void 0,ei=t=>XO.md5(t),mp="nomic-ai/nomic-embed-text-v1.5",yp=class{constructor(t){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new xi(t??{})}},_p=(t,e)=>t.reduce((r,n,a)=>{const o=Math.floor(a/e),i=r[o]||[];return r[o]=i.concat([n]),r},[]);class QO extends yp{constructor(r){super(r??{});ae(this,"worker");ae(this,"EMBEDDING_LOAD_MESSAGE_ID","EMBEDDING_LOAD_MESSAGE_ID");ae(this,"ready",!1);ae(this,"timeout");ae(this,"stripNewLines",!0);ae(this,"modelName","Xenova/all-MiniLM-L6-v2");ae(this,"model","Xenova/all-MiniLM-L6-v2");ae(this,"batchSize",512);ae(this,"pretrainedOptions");ae(this,"pipelineOptions");ae(this,"refProcesses",new Map);ae(this,"initWorker",()=>{_r(this.worker,"load",this.EMBEDDING_LOAD_MESSAGE_ID,[this.model,this.pretrainedOptions]),this.worker.removeEventListener("message",this.handleMessages),this.worker.addEventListener("message",this.handleMessages);const r=Pr();return this.refProcesses.set(this.EMBEDDING_LOAD_MESSAGE_ID,[r.promise,r.resolve,r.reject]),r.promise});ae(this,"handleMessages",r=>{const n=r.data.messageId;if(n!==sy)if(r.data.type==="complete"||r.data.type==="error"){const[,a,o]=this.refProcesses.get(n)||[];r.data.type==="complete"?a==null||a(r.data.payload):o==null||o(new Error(JSON.stringify(r.data.payload))),n===this.EMBEDDING_LOAD_MESSAGE_ID&&(this.ready=!!r.data.payload),this.refProcesses.delete(n)}else r.data.type==="started"||r.data.type==="inprogress"||vn("Unknown message type",r.data)});ae(this,"runEmbedding",async r=>{if(!this.worker)throw new Error("MISSING WORKER");const n=this.refProcesses.get(this.EMBEDDING_LOAD_MESSAGE_ID);if(n!=null&&n[0]&&await(n==null?void 0:n[0]),!this.ready)throw new Error("WORKER NOT READY YET");return this.caller.call(async()=>{const a=Bt(),o=Pr(()=>{_r(this.worker,"embedding",a,[r,this.pipelineOptions])});return this.refProcesses.set(a,[o.promise,o.resolve,o.reject]),o.promise.then(i=>i)})});this.worker=r.worker,this.modelName=(r==null?void 0:r.model)??(r==null?void 0:r.modelName)??this.model,this.model=this.modelName,this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.pretrainedOptions=(r==null?void 0:r.pretrainedOptions)??{},this.pipelineOptions={pooling:"mean",normalize:!0,...r==null?void 0:r.pipelineOptions},this.initWorker()}async embedDocuments(r){const n=_p(this.stripNewLines?r.map(i=>i.replace(/\n/g," ")):r,this.batchSize).map(i=>this.runEmbedding(i)),a=await Promise.all(n),o=[];for(let i=0;i<a.length;i+=1){const s=a[i];for(let l=0;l<s.length;l+=1)o.push(s[l])}return o}async embedQuery(r){return(await this.runEmbedding([this.stripNewLines?r.replace(/\n/g," "):r]))[0]}}let vb,wb,bb,Eb;vb=()=>new Worker(new URL("/NoLLMChat/assets/embedding.worker-3Fs0X7iO.js",import.meta.url),{type:"module"}),wb=(t,e)=>{var r;try{const n=JSON.parse(t.metadata||"{}");if(!(n!=null&&n.textSplitter))return e;switch((r=n==null?void 0:n.textSplitter)==null?void 0:r.type){case"TokenTextSplitter":return new eO({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);case"CharacterTextSplitter":return new QR({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);case"RecursiveCharacterTextSplitter":return new il({chunkOverlap:+n.textSplitter.chunkOverlap,chunkSize:+n.textSplitter.chunkSize}).splitDocuments(e);default:throw new Error("Invalid text splitter")}}catch{return e}},bb=(t,e)=>({destroy:()=>{try{const r=e().worker;r&&r.terminate(),t({localEmbedding:void 0,embeddingStorage:void 0,worker:void 0})}catch(r){vn("Destroy Local Embedding Thread",r)}},init:async()=>{try{const r=e().worker;r&&r.terminate();const n=vb(),a=new QO({modelName:mp,worker:n}),o=pb.createInstance({name:"vector-database",driver:pb.INDEXEDDB,storeName:"main"});t({worker:n,localEmbedding:a,embeddingStorage:o})}catch(r){vn("Init Local Embedding Thread",r)}finally{t({ready:!0})}},index:async(r,n)=>{const a=(r==null?void 0:r.embedding)||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await wb(i,n),u=await Qo({databaseName:l,storageType:i.storage||"IndexedDB",provider:i.provider,storageService:o,storageDataNode:i||s});switch(i.provider){case ur.Voy:{const d=new pn({embeddings:u}),h=new Un(d,a);await h.addDocuments(c),await Oh({databaseName:l,provider:i.provider,embeddingStorage:o,docstore:h.docstore,storageType:i.storage||"IndexedDB",storageDataNode:s||i})}break;case ur.Memory:{const d=new Ca(a);d.memoryVectors=u,await d.addDocuments(c),await Oh({databaseName:l,provider:i.provider,embeddingStorage:o,docstore:d.memoryVectors,storageType:i.storage||"IndexedDB",storageDataNode:s||i})}break}},getVectorDatabase:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await Qo({databaseName:l,storageType:i.storage||"IndexedDB",provider:i.provider,storageService:e().embeddingStorage,storageDataNode:s});switch(i.provider){case ur.Voy:{const u=new pn({embeddings:c});return new Un(u,a)}case ur.Memory:{const u=new Ca(a,n);return u.memoryVectors=c,u}default:throw new Error("Invalid provider")}},similaritySearch:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i||!i.provider)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await Qo({databaseName:l,storageDataNode:s||i,provider:i.provider,storageService:o,storageType:i.storage||"IndexedDB"});switch(i.provider){case ur.Voy:{const u=new pn({embeddings:c});return await new Un(u,a).similaritySearch(...n)}case ur.Memory:{const u=new Ca(a);return u.memoryVectors=c,await u.similaritySearch(...n)}default:throw new Error("Invalid provider")}},similaritySearchWithScore:async(r,...n)=>{const a=r.embedding||e().localEmbedding,o=e().embeddingStorage;if(!a||!o)throw new Error("Missing embedding model or storage.");const i=await We("VectorDatabase").findOne({where:{id:r.database.databaseId}});if(!i||!i.provider)throw new Error("Database not found.");if(!i.provider)throw new Error("Database provider not found.");const s=r.database.dataSourceId&&r.database.dataSourceType?await We(r.database.dataSourceType).findOne({where:{id:r.database.dataSourceId}}):void 0,l=ei(i.name),c=await Qo({databaseName:l,provider:i.provider,storageDataNode:s||i,storageService:o,storageType:i.storage||"IndexedDB"});switch(i.provider){case ur.Voy:{const u=new pn({embeddings:c});return await new Un(u,a).similaritySearchWithScore(...n)}case ur.Memory:{const u=new Ca(a);return u.memoryVectors=c,await u.similaritySearchWithScore(...n)}default:throw new Error("Invalid provider")}}}),Eb={ready:!1,localEmbedding:void 0,embeddingStorage:void 0,worker:void 0},Nl=Zh()(Jh((t,e)=>({...Eb,...bb(t,e)})));async function*pl(t,e,r,n){for(;;){const o=r.get(e);if(o){const{processInfo:i}=o;if(i&&typeof i=="object"&&"data"in i&&"lastIndex"in i&&Array.isArray(i.data)){const s=n!=null&&n.lastChunkOnly?i.data[i.data.length-1]:i.data.slice(+`${i.lastIndex}`);s&&(!Array.isArray(s)||s!=null&&s.length)&&(i.lastIndex=n!=null&&n.lastChunkOnly?i.data.length-1:i.data.length>0?i.data.length:0,yield s)}await new Promise(s=>setTimeout(s,(n==null?void 0:n.interval)||150))}else break}const a=await t;return yield a,a}const eN=()=>new Worker(new URL("/NoLLMChat/assets/local-llm.worker-Xa-wjz8Y.js",import.meta.url),{type:"module"}),tN=(t,e)=>r=>{ly(r,t().refProcesses,{onWorkerInit:()=>e({ready:!0})})};async function rN(t,...e){const r=t.worker,n=t.refProcesses;if(!r)throw new Error("Worker not initialized");const a=Pr(()=>{_r(r,"load",t.messageId,e)});return n.set(t.messageId,{promise:a.promise,resolve:a.resolve,reject:a.reject,processInfo:{type:"load",data:[],lastIndex:0}}),pl(a.promise,t.messageId,n,{lastChunkOnly:!0})}let Sb,xb,Nh,fl,Ih,Ph,La,ml,kb,Ab,Tb,Mb,Fb,Rb,Ob,Nb,Ib,Pb,Ch;Sb=(t,e)=>({setInitializing:r=>{const n=e().initializing;t({initializing:{...n,...r}})},setSelectedModel:r=>{t({selectedModel:r})},destroy:()=>{try{const r=e().handler,n=e().worker;n&&(r&&n.removeEventListener("message",r),n.terminate()),t({handler:void 0,worker:void 0})}catch(r){vn("Destroy Local LLM thread",r)}},init:()=>{try{const r=e().handler,n=e().worker;n&&(r&&n.removeEventListener("message",r),n.terminate());const a=eN(),o=tN(e,t);a.addEventListener("message",o),t({handler:o,worker:a})}catch(r){vn("Init Local LLM Thread",r)}},syncCachedLLMURLs:async()=>caches.open("webllm/config").then(async r=>r.keys()).then(r=>{const n=r.map(a=>a.url);return t({cachedLLMURLs:n}),n}),loadModel:async(r,{callback:n})=>{let a=e().currentLoadModelMessageId;const o=e().worker,i=e().initProgressCallbacks,s=e().initializing,l=e().refProcesses;if(a){const u=l.get(a);if(u){const{reject:d}=u;d==null||d("stop"),l.delete(a)}}a=Bt(),t({currentLoadModelMessageId:Bt(),selectedModel:r,initializing:{...s,loading:!0}});const c=await rN({messageId:a,worker:o,refProcesses:l},{model:r});for await(const u of c)u&&(i.forEach(d=>d(u)),n==null||n(u));setTimeout(()=>{i.forEach(u=>u({progress:100,timeElapsed:1,text:`Model ${r} loaded.`})),t({initializing:{...e().initializing,loading:!1}})},100)},unLoadModel:()=>{const r=e().worker,n=e().refProcesses,a=e().currentLoadModelMessageId;if(a){const o=n.get(a);if(o){const{reject:i}=o;i==null||i("stop"),n.delete(a)}}r&&_r(r,"unload",Bt(),[]),t({selectedModel:void 0})},setInitProgressCallback:r=>{const n=e().initProgressCallbacks;return n.push(r),t({initProgressCallbacks:n}),()=>{t({initProgressCallbacks:e().initProgressCallbacks.filter(a=>a!==r)})}},invoke:(...r)=>{const n=e().refProcesses,a=e().worker;if(!a)throw new Error("Worker not initialized");const o=Bt(),i=Pr(()=>{_r(a,"invoke",o,r)});return n.set(o,{promise:i.promise,resolve:i.resolve,reject:i.reject,processInfo:{type:"invoke",data:[],lastIndex:0}}),i.promise},stream:(...r)=>{const n=e().refProcesses,a=e().worker;if(!a)throw new Error("Worker not initialized");const o=Bt(),[i,...s]=r,l=Pr(()=>{_r(a,"stream",o,[fl(i),...s])});n.set(o,{promise:l.promise,resolve:l.resolve,reject:l.reject,processInfo:{type:"invoke",data:[],lastIndex:0}});const c=l.promise;return pl(c,o,n)},structuredStream:(r,...n)=>{const a=e().refProcesses,o=e().worker;if(!o)throw new Error("Worker not initialized");const i=Bt(),[s,...l]=n,c=Pr(()=>{_r(o,"structured-stream",i,[r,fl(s),...l])});a.set(i,{promise:c.promise,resolve:c.resolve,reject:c.reject,processInfo:{type:"invoke",data:[],lastIndex:0}});const u=c.promise;return pl(u,i,a)},toolsCallingStream:(r,...n)=>{const a=e().refProcesses,o=e().worker;if(!o)throw new Error("Worker not initialized");const i=Bt(),[s,...l]=n,c=Pr(()=>{_r(o,"tools-calling-stream",i,[r,fl(s),...l])});a.set(i,{promise:c.promise,resolve:c.resolve,reject:c.reject,processInfo:{type:"invoke",data:[],lastIndex:0}});const u=c.promise;return pl(u,i,a)},getCurrentModelInfo:async()=>{const r=e().refProcesses,n=e().worker;if(!n)throw new Error("Worker not initialized");const a=Bt(),o=Pr(()=>{_r(n,"get-current-model-info",a,[])});return r.set(a,{promise:o.promise,resolve:o.resolve,reject:o.reject,processInfo:{type:"get-current-model-info",data:[],lastIndex:0}}),o.promise}}),xb={cachedLLMURLs:[],ready:!1,initializing:{worker:!0,init:!0,loading:!1},selectedModel:"",refProcesses:new Map,currentLoadModelMessageId:void 0,handler:void 0,initProgressCallbacks:[],worker:void 0},$l=Zh()(Jh((t,e)=>({...xb,...Sb(t,e)}))),Nh=t=>typeof t=="string"?t:t instanceof to?{instanceof:"HumanMessage",item:t,content:t.content}:t instanceof Jn?{instanceof:"AIMessage",item:t,content:t.content}:t instanceof no?{instanceof:"SystemMessage",item:t,content:t.content}:t,fl=t=>Array.isArray(t)?t.map(Nh):Nh(t),Ih=1,Ph={erro_evt:{name:"erro_evt",structName:"glue_msg_error",className:"GlueMsgError",fields:[{type:"str",name:"message",isNullable:!1}]},load_req:{name:"load_req",structName:"glue_msg_load_req",className:"GlueMsgLoadReq",fields:[{type:"arr_str",name:"model_paths",isNullable:!1},{type:"bool",name:"n_ctx_auto",isNullable:!1},{type:"bool",name:"use_mmap",isNullable:!1},{type:"bool",name:"use_mlock",isNullable:!1},{type:"int",name:"n_gpu_layers",isNullable:!1},{type:"int",name:"seed",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_threads",isNullable:!1},{type:"bool",name:"embeddings",isNullable:!0},{type:"bool",name:"offload_kqv",isNullable:!0},{type:"int",name:"n_batch",isNullable:!0},{type:"int",name:"n_seq_max",isNullable:!0},{type:"str",name:"pooling_type",isNullable:!0},{type:"str",name:"rope_scaling_type",isNullable:!0},{type:"float",name:"rope_freq_base",isNullable:!0},{type:"float",name:"rope_freq_scale",isNullable:!0},{type:"float",name:"yarn_ext_factor",isNullable:!0},{type:"float",name:"yarn_attn_factor",isNullable:!0},{type:"float",name:"yarn_beta_fast",isNullable:!0},{type:"float",name:"yarn_beta_slow",isNullable:!0},{type:"int",name:"yarn_orig_ctx",isNullable:!0},{type:"str",name:"cache_type_k",isNullable:!0},{type:"str",name:"cache_type_v",isNullable:!0}]},load_res:{name:"load_res",structName:"glue_msg_load_res",className:"GlueMsgLoadRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_batch",isNullable:!1},{type:"int",name:"n_ubatch",isNullable:!1},{type:"int",name:"n_vocab",isNullable:!1},{type:"int",name:"n_ctx_train",isNullable:!1},{type:"int",name:"n_embd",isNullable:!1},{type:"int",name:"n_layer",isNullable:!1},{type:"arr_str",name:"metadata_key",isNullable:!1},{type:"arr_str",name:"metadata_val",isNullable:!1},{type:"int",name:"token_bos",isNullable:!1},{type:"int",name:"token_eos",isNullable:!1},{type:"int",name:"token_eot",isNullable:!1},{type:"arr_int",name:"list_tokens_eog",isNullable:!1},{type:"bool",name:"add_bos_token",isNullable:!1},{type:"bool",name:"add_eos_token",isNullable:!1},{type:"bool",name:"has_encoder",isNullable:!1},{type:"int",name:"token_decoder_start",isNullable:!1}]},opti_req:{name:"opti_req",structName:"glue_msg_set_options_req",className:"GlueMsgSetOptionsReq",fields:[{type:"bool",name:"embeddings",isNullable:!1}]},opti_res:{name:"opti_res",structName:"glue_msg_set_options_res",className:"GlueMsgSetOptionsRes",fields:[{type:"bool",name:"success",isNullable:!1}]},sint_req:{name:"sint_req",structName:"glue_msg_sampling_init_req",className:"GlueMsgSamplingInitReq",fields:[{type:"int",name:"mirostat",isNullable:!0},{type:"float",name:"mirostat_tau",isNullable:!0},{type:"float",name:"mirostat_eta",isNullable:!0},{type:"float",name:"temp",isNullable:!0},{type:"float",name:"top_p",isNullable:!0},{type:"int",name:"top_k",isNullable:!0},{type:"int",name:"penalty_last_n",isNullable:!0},{type:"float",name:"penalty_repeat",isNullable:!0},{type:"float",name:"penalty_freq",isNullable:!0},{type:"float",name:"penalty_present",isNullable:!0},{type:"float",name:"dynatemp_range",isNullable:!0},{type:"float",name:"dynatemp_exponent",isNullable:!0},{type:"arr_str",name:"samplers_sequence",isNullable:!0},{type:"str",name:"grammar",isNullable:!0},{type:"int",name:"n_prev",isNullable:!0},{type:"int",name:"n_probs",isNullable:!0},{type:"float",name:"min_p",isNullable:!0},{type:"float",name:"typical_p",isNullable:!0},{type:"float",name:"typ_p",isNullable:!0},{type:"arr_int",name:"logit_bias_toks",isNullable:!0},{type:"arr_float",name:"logit_bias_vals",isNullable:!0},{type:"arr_int",name:"tokens",isNullable:!0}]},sint_res:{name:"sint_res",structName:"glue_msg_sampling_init_res",className:"GlueMsgSamplingInitRes",fields:[{type:"bool",name:"success",isNullable:!1}]},gvoc_req:{name:"gvoc_req",structName:"glue_msg_get_vocab_req",className:"GlueMsgGetVocabReq",fields:[]},gvoc_res:{name:"gvoc_res",structName:"glue_msg_get_vocab_res",className:"GlueMsgGetVocabRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_raw",name:"vocab",isNullable:!1}]},lkup_req:{name:"lkup_req",structName:"glue_msg_lookup_token_req",className:"GlueMsgLookupTokenReq",fields:[{type:"str",name:"piece",isNullable:!1}]},lkup_res:{name:"lkup_res",structName:"glue_msg_lookup_token_res",className:"GlueMsgLookupTokenRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},tokn_req:{name:"tokn_req",structName:"glue_msg_tokenize_req",className:"GlueMsgTokenizeReq",fields:[{type:"str",name:"text",isNullable:!1},{type:"bool",name:"special",isNullable:!1}]},tokn_res:{name:"tokn_res",structName:"glue_msg_tokenize_res",className:"GlueMsgTokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_req:{name:"dtkn_req",structName:"glue_msg_detokenize_req",className:"GlueMsgDetokenizeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_res:{name:"dtkn_res",structName:"glue_msg_detokenize_res",className:"GlueMsgDetokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"buffer",isNullable:!1}]},deco_req:{name:"deco_req",structName:"glue_msg_decode_req",className:"GlueMsgDecodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1},{type:"bool",name:"skip_logits",isNullable:!1}]},deco_res:{name:"deco_res",structName:"glue_msg_decode_res",className:"GlueMsgDecodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},enco_req:{name:"enco_req",structName:"glue_msg_encode_req",className:"GlueMsgEncodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},enco_res:{name:"enco_res",structName:"glue_msg_encode_res",className:"GlueMsgEncodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},ssam_req:{name:"ssam_req",structName:"glue_msg_sampling_sample_req",className:"GlueMsgSamplingSampleReq",fields:[]},ssam_res:{name:"ssam_res",structName:"glue_msg_sampling_sample_res",className:"GlueMsgSamplingSampleRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"piece",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},sacc_req:{name:"sacc_req",structName:"glue_msg_sampling_accept_req",className:"GlueMsgSamplingAcceptReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},sacc_res:{name:"sacc_res",structName:"glue_msg_sampling_accept_res",className:"GlueMsgSamplingAcceptRes",fields:[{type:"bool",name:"success",isNullable:!1}]},glog_req:{name:"glog_req",structName:"glue_msg_get_logits_req",className:"GlueMsgGetLogitsReq",fields:[{type:"int",name:"top_k",isNullable:!1}]},glog_res:{name:"glog_res",structName:"glue_msg_get_logits_res",className:"GlueMsgGetLogitsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1},{type:"arr_float",name:"probs",isNullable:!1}]},gemb_req:{name:"gemb_req",structName:"glue_msg_get_embeddings_req",className:"GlueMsgGetEmbeddingsReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},gemb_res:{name:"gemb_res",structName:"glue_msg_get_embeddings_res",className:"GlueMsgGetEmbeddingsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"arr_float",name:"embeddings",isNullable:!1}]},kvcr_req:{name:"kvcr_req",structName:"glue_msg_get_kv_remove_req",className:"GlueMsgGetKvRemoveReq",fields:[{type:"int",name:"n_keep",isNullable:!1},{type:"int",name:"n_discard",isNullable:!1}]},kvcr_res:{name:"kvcr_res",structName:"glue_msg_get_kv_remove_res",className:"GlueMsgGetKvRemoveRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},kvcc_req:{name:"kvcc_req",structName:"glue_msg_get_kv_clear_req",className:"GlueMsgGetKvClearReq",fields:[]},kvcc_res:{name:"kvcc_res",structName:"glue_msg_get_kv_clear_res",className:"GlueMsgGetKvClearRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},sesa_req:{name:"sesa_req",structName:"glue_msg_session_save_req",className:"GlueMsgSessionSaveReq",fields:[{type:"str",name:"session_path",isNullable:!1}]},sesa_res:{name:"sesa_res",structName:"glue_msg_session_save_res",className:"GlueMsgSessionSaveRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_req:{name:"sesl_req",structName:"glue_msg_session_load_req",className:"GlueMsgSessionLoadReq",fields:[{type:"str",name:"session_path",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_res:{name:"sesl_res",structName:"glue_msg_session_load_res",className:"GlueMsgSessionLoadRes",fields:[{type:"bool",name:"success",isNullable:!1}]},stat_req:{name:"stat_req",structName:"glue_msg_status_req",className:"GlueMsgStatusReq",fields:[]},stat_res:{name:"stat_res",structName:"glue_msg_status_res",className:"GlueMsgStatusRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},tben_req:{name:"tben_req",structName:"glue_msg_test_benchmark_req",className:"GlueMsgTestBenchmarkReq",fields:[{type:"str",name:"type",isNullable:!1},{type:"int",name:"n_samples",isNullable:!1}]},tben_res:{name:"tben_res",structName:"glue_msg_test_benchmark_res",className:"GlueMsgTestBenchmarkRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},tper_req:{name:"tper_req",structName:"glue_msg_test_perplexity_req",className:"GlueMsgTestPerplexityReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},tper_res:{name:"tper_res",structName:"glue_msg_test_perplexity_res",className:"GlueMsgTestPerplexityRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"float",name:"ppl",isNullable:!1},{type:"float",name:"nll",isNullable:!1},{type:"float",name:"cross_entropy",isNullable:!1},{type:"int",name:"n_tokens",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},cfmt_req:{name:"cfmt_req",structName:"glue_msg_chat_format_req",className:"GlueMsgChatFormatReq",fields:[{type:"str",name:"tmpl",isNullable:!0},{type:"bool",name:"add_ass",isNullable:!0},{type:"arr_str",name:"roles",isNullable:!1},{type:"arr_str",name:"contents",isNullable:!1}]},cfmt_res:{name:"cfmt_res",structName:"glue_msg_chat_format_res",className:"GlueMsgChatFormatRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"str",name:"formatted_chat",isNullable:!1}]}},La=new Uint8Array([71,76,85,69]),ml=0,kb=1,Ab=2,Tb=3,Mb=4,Fb=5,Rb=6,Ob=7,Nb=8,Ib=9,Pb=10,Ch={str:Mb,int:Ab,float:Tb,bool:kb,raw:Fb,arr_str:Ib,arr_int:Ob,arr_float:Nb,arr_bool:Rb,arr_raw:Pb,null:ml};function nN(t){let e=0;const r=new DataView(t.buffer),n=()=>{const m=r.getUint32(e,!0);return e+=4,m},a=()=>{const m=r.getInt32(e,!0);return e+=4,m},o=()=>{const m=r.getFloat32(e,!0);return e+=4,m},i=()=>n()!==0,s=m=>{const _=m??n(),w=new TextDecoder().decode(t.slice(e,e+_));return e+=_,w},l=()=>{const m=n(),_=t.slice(e,e+m);return e+=m,_},c=m=>{const _=n(),w=new Array(_);for(let A=0;A<_;A++)w[A]=m();return w},u=()=>null,d=m=>{switch(m.type){case"str":return s();case"int":return a();case"float":return o();case"bool":return i();case"raw":return l();case"arr_str":return c(s);case"arr_int":return c(a);case"arr_float":return c(o);case"arr_bool":return c(i);case"arr_raw":return c(l);case"null":return u()}},h=t[0]===La[0]&&t[1]===La[1]&&t[2]===La[2]&&t[3]===La[3];if(e+=4,!h)throw new Error("Invalid magic number");if(n()!==Ih)throw new Error("Invalid version number");const p=s(8),f=Ph[p];if(!f)throw new Error(`Unknown message name: ${p}`);const y={_name:p};for(const m of f.fields){const _=n();if(_===ml){if(!m.isNullable)throw new Error(`${p}: Expect field ${m.name} to be non-nullable`);y[m.name]=null;continue}if(_!==Ch[m.type])throw new Error(`${p}: Expect field ${m.name} to have type ${m.type}`);y[m.name]=d(m)}return y}function aN(t){const e=Ph[t._name];if(!e)throw new Error(`Unknown message name: ${t._name}`);const r=[],n=p=>{const f=new ArrayBuffer(4);new DataView(f).setUint32(0,p,!0),r.push(new Uint8Array(f))},a=p=>{const f=new ArrayBuffer(4);new DataView(f).setInt32(0,p,!0),r.push(new Uint8Array(f))},o=p=>{const f=new ArrayBuffer(4);new DataView(f).setFloat32(0,p,!0),r.push(new Uint8Array(f))},i=p=>{n(p?1:0)},s=p=>{const f=new TextEncoder().encode(p);n(f.byteLength),r.push(f)},l=p=>{n(p.byteLength),r.push(p)},c=(p,f)=>{n(p.length);for(const y of p)f(y)};r.push(La),n(Ih);{const p=new TextEncoder().encode(t._name);r.push(p)}for(const p of e.fields){const f=t[p.name];if(!p.isNullable&&f==null)throw new Error(`${t._name}: Expect field ${p.name} to be non-nullable`);if(f==null){n(ml);continue}switch(n(Ch[p.type]),p.type){case"str":s(f);break;case"int":a(f);break;case"float":o(f);break;case"bool":i(f);break;case"raw":l(f);break;case"arr_str":c(f,s);break;case"arr_int":c(f,a);break;case"arr_float":c(f,o);break;case"arr_bool":c(f,i);break;case"arr_raw":c(f,l);break}}const u=r.reduce((p,f)=>p+f.byteLength,0),d=new Uint8Array(u);let h=0;for(const p of r)d.set(p,h),h+=p.byteLength;return d}const oN=t=>{const e=t.reduce((n,a)=>n+a.length,0),r=new Uint8Array(e);r.set(t[0],0);for(let n=1;n<t.length;n++)r.set(t[n],t[n-1].length);return r},iN=new TextDecoder,jh=t=>iN.decode(t),Cb=/-(\d{5})-of-(\d{5})\.gguf$/,jb=t=>{const e=t.match(Cb);return e?{baseURL:t.replace(Cb,""),current:parseInt(e[1]),total:parseInt(e[2])}:{baseURL:t,current:1,total:1}},sN=t=>{t.every(e=>!!e.name)&&t.length>1&&t.sort((e,r)=>{const n=jb(e.name),a=jb(r.name);return n.current-a.current})},Lb=t=>new URL(t,document.baseURI).href,Lh=t=>t.reduce((e,r)=>e+r,0),Db=t=>!!(t!=null&&t.startsWith),lN=()=>(async t=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(t)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),cN=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),uN=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),dN=async()=>{if(!await cN())throw new Error("WebAssembly runtime does not support exception handling");if(!await uN())throw new Error("WebAssembly runtime does not support SIMD")},$b=()=>!!navigator.userAgent.match(/Version\/([0-9\._]+).*Mobile.*Safari.*/),Dh=t=>{const e=URL.createObjectURL(Db(t)?new Blob([t],{type:"text/javascript"}):t);return new Worker(e,{type:"module"})},hN=t=>(...e)=>{let r=[],n;return r.push(new Promise(a=>{n=a})),t(...e,(a,o)=>{n([a,o]),r.push(new Promise(i=>{n=i}))}),async function*(){let a;for(let o=0,i=!1;!i;o++)[a,i]=await r[o],delete r[o],a!==void 0&&(yield a)}()},pN=`// Start the main llama.cpp
let wllamaMalloc;
let wllamaStart;
let wllamaAction;
let wllamaExit;
let wllamaDebug;

let Module = null;

//////////////////////////////////////////////////////////////
// UTILS
//////////////////////////////////////////////////////////////

// send message back to main thread
const msg = (data, transfer) => postMessage(data, transfer);

// Convert CPP log into JS log
const cppLogToJSLog = (line) => {
  const matched = line.match(/@@(DEBUG|INFO|WARN|ERROR)@@(.*)/);
  return !!matched
    ? {
        level: (matched[1] === 'INFO' ? 'debug' : matched[1]).toLowerCase(),
        text: matched[2],
      }
    : { level: 'log', text: line };
};

// Get module config that forwards stdout/err to main thread
const getWModuleConfig = (_argMainScriptBlob) => {
  var pathConfig = RUN_OPTIONS.pathConfig;
  var pthreadPoolSize = RUN_OPTIONS.nbThread;
  var argMainScriptBlob = _argMainScriptBlob;

  if (!pathConfig['wllama.wasm']) {
    throw new Error('"wllama.wasm" is missing in pathConfig');
  }
  return {
    noInitialRun: true,
    print: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      msg({ verb: 'console.log', args: [text] });
    },
    printErr: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      const logLine = cppLogToJSLog(text);
      msg({ verb: 'console.' + logLine.level, args: [logLine.text] });
    },
    locateFile: function (filename, basePath) {
      const p = pathConfig[filename];
      const truncate = (str) =>
        str.length > 128 ? \`\${str.substr(0, 128)}...\` : str;
      if (filename.match(/wllama\\.worker\\.js/)) {
        msg({
          verb: 'console.error',
          args: [
            '"wllama.worker.js" is removed from v2.2.1. Hint: make sure to clear browser\\'s cache.',
          ],
        });
      } else {
        msg({
          verb: 'console.debug',
          args: [\`Loading "\${filename}" from "\${truncate(p)}"\`],
        });
        return p;
      }
    },
    mainScriptUrlOrBlob: argMainScriptBlob,
    pthreadPoolSize,
    wasmMemory: pthreadPoolSize > 1 ? getWasmMemory() : null,
    onAbort: function (text) {
      msg({ verb: 'signal.abort', args: [text] });
    },
  };
};

// Get the memory to be used by wasm. (Only used in multi-thread mode)
// Because we have a weird OOM issue on iOS, we need to try some values
// See: https://github.com/emscripten-core/emscripten/issues/19144
//      https://github.com/godotengine/godot/issues/70621
const getWasmMemory = () => {
  let minBytes = 128 * 1024 * 1024;
  let maxBytes = 4096 * 1024 * 1024;
  let stepBytes = 128 * 1024 * 1024;
  while (maxBytes > minBytes) {
    try {
      const wasmMemory = new WebAssembly.Memory({
        initial: minBytes / 65536,
        maximum: maxBytes / 65536,
        shared: true,
      });
      return wasmMemory;
    } catch (e) {
      maxBytes -= stepBytes;
      continue; // retry
    }
  }
  throw new Error('Cannot allocate WebAssembly.Memory');
};

//////////////////////////////////////////////////////////////
// MEMFS PATCH
//////////////////////////////////////////////////////////////

/**
 * By default, emscripten uses memfs. The way it works is by
 * allocating new Uint8Array in javascript heap. This is not good
 * because it requires files to be copied to wasm heap each time
 * a file is read.
 *
 * HeapFS is an alternative, which resolves this problem by
 * allocating space for file directly inside wasm heap. This
 * allows us to mmap without doing any copy.
 *
 * For llama.cpp, this is great because we use MAP_SHARED
 *
 * Ref: https://github.com/ngxson/wllama/pull/39
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/src/library_memfs.js
 *
 * Note 29/05/2024 @ngxson
 * Due to ftell() being limited to MAX_LONG, we cannot load files bigger than 2^31 bytes (or 2GB)
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/system/lib/libc/musl/src/stdio/ftell.c
 */

const fsNameToFile = {}; // map Name => File
const fsIdToFile = {}; // map ID => File
let currFileId = 0;

// Patch and redirect memfs calls to wllama
const patchMEMFS = () => {
  const m = Module;
  // save functions
  m.MEMFS.stream_ops._read = m.MEMFS.stream_ops.read;
  m.MEMFS.stream_ops._write = m.MEMFS.stream_ops.write;
  m.MEMFS.stream_ops._llseek = m.MEMFS.stream_ops.llseek;
  m.MEMFS.stream_ops._allocate = m.MEMFS.stream_ops.allocate;
  m.MEMFS.stream_ops._mmap = m.MEMFS.stream_ops.mmap;
  m.MEMFS.stream_ops._msync = m.MEMFS.stream_ops.msync;

  const patchStream = (stream) => {
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      stream.node.contents = m.HEAPU8.subarray(f.ptr, f.ptr + f.size);
      stream.node.usedBytes = f.size;
    }
  };

  // replace "read" functions
  m.MEMFS.stream_ops.read = function (
    stream,
    buffer,
    offset,
    length,
    position
  ) {
    patchStream(stream);
    return m.MEMFS.stream_ops._read(stream, buffer, offset, length, position);
  };
  m.MEMFS.ops_table.file.stream.read = m.MEMFS.stream_ops.read;

  // replace "llseek" functions
  m.MEMFS.stream_ops.llseek = function (stream, offset, whence) {
    patchStream(stream);
    return m.MEMFS.stream_ops._llseek(stream, offset, whence);
  };
  m.MEMFS.ops_table.file.stream.llseek = m.MEMFS.stream_ops.llseek;

  // replace "mmap" functions
  m.MEMFS.stream_ops.mmap = function (stream, length, position, prot, flags) {
    patchStream(stream);
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      return {
        ptr: f.ptr + position,
        allocated: false,
      };
    } else {
      return m.MEMFS.stream_ops._mmap(stream, length, position, prot, flags);
    }
  };
  m.MEMFS.ops_table.file.stream.mmap = m.MEMFS.stream_ops.mmap;

  // mount FS
  m.FS.mkdir('/models');
  m.FS.mount(m.MEMFS, { root: '.' }, '/models');
};

// Allocate a new file in wllama heapfs, returns file ID
const heapfsAlloc = (name, size) => {
  if (size < 1) {
    throw new Error('File size must be bigger than 0');
  }
  const m = Module;
  const ptr = m.mmapAlloc(size);
  const file = {
    ptr: ptr,
    size: size,
    id: currFileId++,
  };
  fsIdToFile[file.id] = file;
  fsNameToFile[name] = file;
  return file.id;
};

// Add new file to wllama heapfs, return number of written bytes
const heapfsWrite = (id, buffer, offset) => {
  const m = Module;
  if (fsIdToFile[id]) {
    const { ptr, size } = fsIdToFile[id];
    const afterWriteByte = offset + buffer.byteLength;
    if (afterWriteByte > size) {
      throw new Error(
        \`File ID \${id} write out of bound, afterWriteByte = \${afterWriteByte} while size = \${size}\`
      );
    }
    m.HEAPU8.set(buffer, ptr + offset);
    return buffer.byteLength;
  } else {
    throw new Error(\`File ID \${id} not found in heapfs\`);
  }
};

//////////////////////////////////////////////////////////////
// MAIN CODE
//////////////////////////////////////////////////////////////

const callWrapper = (name, ret, args) => {
  const fn = Module.cwrap(name, ret, args);
  return async (action, req) => {
    let result;
    try {
      if (args.length === 2) {
        result = await fn(action, req);
      } else {
        result = fn();
      }
    } catch (ex) {
      console.error(ex);
      throw ex;
    }
    return result;
  };
};

onmessage = async (e) => {
  if (!e.data) return;
  const { verb, args, callbackId } = e.data;

  if (!callbackId) {
    msg({ verb: 'console.error', args: ['callbackId is required', e.data] });
    return;
  }

  if (verb === 'module.init') {
    const argMainScriptBlob = args[0];
    try {
      Module = getWModuleConfig(argMainScriptBlob);
      Module.onRuntimeInitialized = () => {
        // async call once module is ready
        // init FS
        patchMEMFS();
        // init cwrap
        const pointer = 'number';
        // TODO: note sure why emscripten cannot bind if there is only 1 argument
        wllamaMalloc = callWrapper('wllama_malloc', pointer, [
          'number',
          pointer,
        ]);
        wllamaStart = callWrapper('wllama_start', 'string', []);
        wllamaAction = callWrapper('wllama_action', pointer, [
          'string',
          pointer,
        ]);
        wllamaExit = callWrapper('wllama_exit', 'string', []);
        wllamaDebug = callWrapper('wllama_debug', 'string', []);
        msg({ callbackId, result: null });
      };
      wModuleInit();
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.alloc') {
    const argFilename = args[0];
    const argSize = args[1];
    try {
      // create blank file
      const emptyBuffer = new ArrayBuffer(0);
      Module['FS_createDataFile'](
        '/models',
        argFilename,
        emptyBuffer,
        true,
        true,
        true
      );
      // alloc data on heap
      const fileId = heapfsAlloc(argFilename, argSize);
      msg({ callbackId, result: { fileId } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.write') {
    const argFileId = args[0];
    const argBuffer = args[1];
    const argOffset = args[2];
    try {
      const writtenBytes = heapfsWrite(argFileId, argBuffer, argOffset);
      msg({ callbackId, result: { writtenBytes } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.start') {
    try {
      const result = await wllamaStart();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.action') {
    const argAction = args[0];
    const argEncodedMsg = args[1];
    try {
      const inputPtr = await wllamaMalloc(argEncodedMsg.byteLength, 0);
      // copy data to wasm heap
      const inputBuffer = new Uint8Array(
        Module.HEAPU8.buffer,
        inputPtr,
        argEncodedMsg.byteLength
      );
      inputBuffer.set(argEncodedMsg, 0);
      const outputPtr = await wllamaAction(argAction, inputPtr);
      // length of output buffer is written at the first 4 bytes of input buffer
      const outputLen = new Uint32Array(Module.HEAPU8.buffer, inputPtr, 1)[0];
      // copy the output buffer to JS heap
      const outputBuffer = new Uint8Array(outputLen);
      const outputSrcView = new Uint8Array(
        Module.HEAPU8.buffer,
        outputPtr,
        outputLen
      );
      outputBuffer.set(outputSrcView, 0); // copy it
      msg({ callbackId, result: outputBuffer }, [outputBuffer.buffer]);
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.exit') {
    try {
      const result = await wllamaExit();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.debug') {
    try {
      const result = await wllamaDebug();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }
};
`,zb=`let accessHandle;
let abortController = new AbortController();

async function openFile(filename) {
  const opfsRoot = await navigator.storage.getDirectory();
  const cacheDir = await opfsRoot.getDirectoryHandle('cache', { create: true });
  const fileHandler = await cacheDir.getFileHandle(filename, { create: true });
  accessHandle = await fileHandler.createSyncAccessHandle();
  accessHandle.truncate(0); // clear file content
}

async function writeFile(buf) {
  accessHandle.write(buf);
}

async function closeFile() {
  accessHandle.flush();
  accessHandle.close();
}

async function writeTextFile(filename, str) {
  await openFile(filename);
  await writeFile(new TextEncoder().encode(str));
  await closeFile();
}

const throttled = (func, delay) => {
  let lastRun = 0;
  return (...args) => {
    const now = Date.now();
    if (now - lastRun > delay) {
      lastRun = now;
      func.apply(null, args);
    }
  };
};

const assertNonNull = (val) => {
  if (val === null || val === undefined) {
    throw new Error('OPFS Worker: Assertion failed');
  }
};

// respond to main thread
const resOK = () => postMessage({ ok: true });
const resProgress = (loaded, total) =>
  postMessage({ progress: { loaded, total } });
const resErr = (err) => postMessage({ err });

onmessage = async (e) => {
  try {
    if (!e.data) return;

    /**
     * @param {Object} e.data
     *
     * Fine-control FS actions:
     * - { action: 'open', filename: 'string' }
     * - { action: 'write', buf: ArrayBuffer }
     * - { action: 'close' }
     *
     * Simple write API:
     * - { action: 'write-simple', filename: 'string', buf: ArrayBuffer }
     *
     * Download API:
     * - { action: 'download', url: 'string', filename: 'string', options: Object, metadataFileName: 'string' }
     * - { action: 'download-abort' }
     */
    const { action, filename, buf, url, options, metadataFileName } = e.data;

    if (action === 'open') {
      assertNonNull(filename);
      await openFile(filename);
      return resOK();
    } else if (action === 'write') {
      assertNonNull(buf);
      await writeFile(buf);
      return resOK();
    } else if (action === 'close') {
      await closeFile();
      return resOK();
    } else if (action === 'write-simple') {
      assertNonNull(filename);
      assertNonNull(buf);
      await openFile(filename);
      await writeFile(buf);
      await closeFile();
      return resOK();
    } else if (action === 'download') {
      assertNonNull(url);
      assertNonNull(filename);
      assertNonNull(metadataFileName);
      assertNonNull(options);
      assertNonNull(options.aborted);
      abortController = new AbortController();
      if (options.aborted) abortController.abort();
      const response = await fetch(url, {
        ...options,
        signal: abortController.signal,
      });
      const contentLength = response.headers.get('content-length');
      const etag = (response.headers.get('etag') || '').replace(
        /[^A-Za-z0-9]/g,
        ''
      );
      const total = parseInt(contentLength, 10);
      const reader = response.body.getReader();
      await openFile(filename);
      let loaded = 0;
      const throttledProgress = throttled(resProgress, 100);
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        loaded += value.byteLength;
        await writeFile(value);
        throttledProgress(loaded, total);
      }
      resProgress(total, total); // 100% done
      await closeFile();
      // make sure this is in-sync with CacheEntryMetadata
      await writeTextFile(
        metadataFileName,
        JSON.stringify({
          originalURL: url,
          originalSize: total,
          etag,
        })
      );
      return resOK();
    } else if (action === 'download-abort') {
      if (abortController) {
        abortController.abort();
      }
      return;
    }

    throw new Error('OPFS Worker: Invalid action', e.data);
  } catch (err) {
    return resErr(err);
  }
};
`,fN='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&self.name?.startsWith("em-pthread");if(ENVIRONMENT_IS_NODE){var worker_threads=require("worker_threads");global.Worker=worker_threads.Worker;ENVIRONMENT_IS_WORKER=!worker_threads.isMainThread;ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&worker_threads["workerData"]=="em-pthread"}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var _scriptName=typeof document!="undefined"?document.currentScript?.src:undefined;if(ENVIRONMENT_IS_NODE){_scriptName=__filename}else if(ENVIRONMENT_IS_WORKER){_scriptName=self.location.href}var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}if(!ENVIRONMENT_IS_NODE){if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var defaultPrint=console.log.bind(console);var defaultPrintErr=console.error.bind(console);if(ENVIRONMENT_IS_NODE){defaultPrint=(...args)=>fs.writeSync(1,args.join(" ")+"\\n");defaultPrintErr=(...args)=>fs.writeSync(2,args.join(" ")+"\\n")}var out=Module["print"]||defaultPrint;var err=Module["printErr"]||defaultPrintErr;Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var wasmModule;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function GROWABLE_HEAP_I8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP8}function GROWABLE_HEAP_U8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU8}function GROWABLE_HEAP_I16(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP16}function GROWABLE_HEAP_I32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP32}function GROWABLE_HEAP_U32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU32}function GROWABLE_HEAP_F32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF32}function GROWABLE_HEAP_F64(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF64}if(ENVIRONMENT_IS_PTHREAD){var wasmModuleReceived;if(ENVIRONMENT_IS_NODE){var parentPort=worker_threads["parentPort"];parentPort.on("message",msg=>onmessage({data:msg}));Object.assign(globalThis,{self:global,postMessage:msg=>parentPort.postMessage(msg)})}var initializedJS=false;function threadPrintErr(...args){var text=args.join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\\n");return}console.error(text)}if(!Module["printErr"])err=threadPrintErr;function threadAlert(...args){var text=args.join(" ");postMessage({cmd:"alert",text,threadId:_pthread_self()})}self.alert=threadAlert;self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{var msgData=e["data"];var cmd=msgData.cmd;if(cmd==="load"){let messageQueue=[];self.onmessage=e=>messageQueue.push(e);self.startWorker=instance=>{postMessage({cmd:"loaded"});for(let msg of messageQueue){handleMessage(msg)}self.onmessage=handleMessage};for(const handler of msgData.handlers){if(!Module[handler]||Module[handler].proxy){Module[handler]=(...args)=>{postMessage({cmd:"callHandler",handler,args})};if(handler=="print")out=Module[handler];if(handler=="printErr")err=Module[handler]}}wasmMemory=msgData.wasmMemory;updateMemoryViews();wasmModuleReceived(msgData.wasmModule)}else if(cmd==="run"){establishStackSpace(msgData.pthread_ptr);__emscripten_thread_init(msgData.pthread_ptr,0,0,1,0,0);PThread.receiveObjectTransfer(msgData);PThread.threadInitTLS();__emscripten_thread_mailbox_await(msgData.pthread_ptr);if(!initializedJS){initializedJS=true}try{invokeEntryPoint(msgData.start_routine,msgData.arg)}catch(ex){if(ex!="unwind"){throw ex}}}else if(msgData.target==="setimmediate"){}else if(cmd==="checkMailbox"){if(initializedJS){checkMailbox()}}else if(cmd){err(`worker: received unknown command ${cmd}`);err(msgData)}}catch(ex){__emscripten_thread_crashed();throw ex}}self.onmessage=handleMessage}function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}if(!ENVIRONMENT_IS_PTHREAD){if(Module["wasmMemory"]){wasmMemory=Module["wasmMemory"]}else{var INITIAL_MEMORY=Module["INITIAL_MEMORY"]||134217728;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:65536,shared:true})}updateMemoryViews()}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(ENVIRONMENT_IS_PTHREAD)return startWorker(Module);if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["I"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){assignWasmImports();return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);registerTLSInit(wasmExports["P"]);wasmTable=wasmExports["S"];wasmModule=module;removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"],result["module"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}if(ENVIRONMENT_IS_PTHREAD){return new Promise(resolve=>{wasmModuleReceived=module=>{var instance=new WebAssembly.Instance(module,getWasmImports());resolve(receiveInstance(instance,module))}})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var terminateWorker=worker=>{worker.terminate();worker.onmessage=e=>{}};Module["terminateWorker"]=terminateWorker;var cleanupThread=pthread_ptr=>{var worker=PThread.pthreads[pthread_ptr];PThread.returnWorkerToPool(worker)};Module["cleanupThread"]=cleanupThread;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;var spawnThread=threadParams=>{var worker=PThread.getNewWorker();if(!worker){return 6}PThread.runningWorkers.push(worker);PThread.pthreads[threadParams.pthread_ptr]=worker;worker.pthread_ptr=threadParams.pthread_ptr;var msg={cmd:"run",start_routine:threadParams.startRoutine,arg:threadParams.arg,pthread_ptr:threadParams.pthread_ptr};if(ENVIRONMENT_IS_NODE){worker.unref()}worker.postMessage(msg,threadParams.transferList);return 0};Module["spawnThread"]=spawnThread;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;var proxyToMainThread=(funcIndex,emAsmAddr,sync,...callArgs)=>{var serializedNumCallArgs=callArgs.length*2;var sp=stackSave();var args=stackAlloc(serializedNumCallArgs*8);var b=args>>>3;for(var i=0;i<callArgs.length;i++){var arg=callArgs[i];if(typeof arg=="bigint"){HEAP64[b+2*i]=1n;HEAP64[b+2*i+1]=arg}else{HEAP64[b+2*i]=0n;GROWABLE_HEAP_F64()[b+2*i+1>>>0]=arg}}var rtn=__emscripten_run_on_main_thread_js(funcIndex,emAsmAddr,serializedNumCallArgs,args,sync);stackRestore(sp);return rtn};Module["proxyToMainThread"]=proxyToMainThread;function _proc_exit(code){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(0,0,1,code);EXITSTATUS=code;if(!keepRuntimeAlive()){PThread.terminateAllThreads();Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))}Module["_proc_exit"]=_proc_exit;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;function exitOnMainThread(returnCode){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(1,0,0,returnCode);_exit(returnCode)}Module["exitOnMainThread"]=exitOnMainThread;var exitJS=(status,implicit)=>{EXITSTATUS=status;if(ENVIRONMENT_IS_PTHREAD){exitOnMainThread(status);throw"unwind"}_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var PThread={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init(){if(!ENVIRONMENT_IS_PTHREAD){PThread.initMainThread()}},initMainThread(){var pthreadPoolSize=Module["pthreadPoolSize"];while(pthreadPoolSize--){PThread.allocateUnusedWorker()}addOnPreRun(()=>{addRunDependency("loading-workers");PThread.loadWasmModuleToAllWorkers(()=>removeRunDependency("loading-workers"))})},terminateAllThreads:()=>{for(var worker of PThread.runningWorkers){terminateWorker(worker)}for(var worker of PThread.unusedWorkers){terminateWorker(worker)}PThread.unusedWorkers=[];PThread.runningWorkers=[];PThread.pthreads={}},returnWorkerToPool:worker=>{var pthread_ptr=worker.pthread_ptr;delete PThread.pthreads[pthread_ptr];PThread.unusedWorkers.push(worker);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(worker),1);worker.pthread_ptr=0;__emscripten_thread_free_data(pthread_ptr)},receiveObjectTransfer(data){},threadInitTLS(){PThread.tlsInitFunctions.forEach(f=>f())},loadWasmModuleToWorker:worker=>new Promise(onFinishedLoading=>{worker.onmessage=e=>{var d=e["data"];var cmd=d.cmd;if(d.targetThread&&d.targetThread!=_pthread_self()){var targetWorker=PThread.pthreads[d.targetThread];if(targetWorker){targetWorker.postMessage(d,d.transferList)}else{err(`Internal error! Worker sent a message "${cmd}" to target pthread ${d.targetThread}, but that thread no longer exists!`)}return}if(cmd==="checkMailbox"){checkMailbox()}else if(cmd==="spawnThread"){spawnThread(d)}else if(cmd==="cleanupThread"){cleanupThread(d.thread)}else if(cmd==="loaded"){worker.loaded=true;if(ENVIRONMENT_IS_NODE&&!worker.pthread_ptr){worker.unref()}onFinishedLoading(worker)}else if(cmd==="alert"){alert(`Thread ${d.threadId}: ${d.text}`)}else if(d.target==="setimmediate"){worker.postMessage(d)}else if(cmd==="callHandler"){Module[d.handler](...d.args)}else if(cmd){err(`worker sent an unknown command ${cmd}`)}};worker.onerror=e=>{var message="worker sent an error!";err(`${message} ${e.filename}:${e.lineno}: ${e.message}`);throw e};if(ENVIRONMENT_IS_NODE){worker.on("message",data=>worker.onmessage({data}));worker.on("error",e=>worker.onerror(e))}var handlers=[];var knownHandlers=["onExit","onAbort","print","printErr"];for(var handler of knownHandlers){if(Module.propertyIsEnumerable(handler)){handlers.push(handler)}}worker.postMessage({cmd:"load",handlers,wasmMemory,wasmModule})}),loadWasmModuleToAllWorkers(onMaybeReady){if(ENVIRONMENT_IS_PTHREAD){return onMaybeReady()}let pthreadPoolReady=Promise.all(PThread.unusedWorkers.map(PThread.loadWasmModuleToWorker));pthreadPoolReady.then(onMaybeReady)},allocateUnusedWorker(){var worker;var workerOptions={workerData:"em-pthread",name:"em-pthread"};var pthreadMainJs=_scriptName;if(Module["mainScriptUrlOrBlob"]){pthreadMainJs=Module["mainScriptUrlOrBlob"];if(typeof pthreadMainJs!="string"){pthreadMainJs=URL.createObjectURL(pthreadMainJs)}}worker=new Worker(pthreadMainJs,workerOptions);PThread.unusedWorkers.push(worker)},getNewWorker(){if(PThread.unusedWorkers.length==0){PThread.allocateUnusedWorker();PThread.loadWasmModuleToWorker(PThread.unusedWorkers[0])}return PThread.unusedWorkers.pop()}};Module["PThread"]=PThread;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var establishStackSpace=pthread_ptr=>{updateMemoryViews();var stackHigh=GROWABLE_HEAP_U32()[pthread_ptr+52>>>2>>>0];var stackSize=GROWABLE_HEAP_U32()[pthread_ptr+56>>>2>>>0];var stackLow=stackHigh-stackSize;_emscripten_stack_set_limits(stackHigh,stackLow);stackRestore(stackHigh)};Module["establishStackSpace"]=establishStackSpace;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return GROWABLE_HEAP_I8()[ptr>>>0];case"i8":return GROWABLE_HEAP_I8()[ptr>>>0];case"i16":return GROWABLE_HEAP_I16()[ptr>>>1>>>0];case"i32":return GROWABLE_HEAP_I32()[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return GROWABLE_HEAP_F32()[ptr>>>2>>>0];case"double":return GROWABLE_HEAP_F64()[ptr>>>3>>>0];case"*":return GROWABLE_HEAP_U32()[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var wasmTableMirror=[];Module["wasmTableMirror"]=wasmTableMirror;var wasmTable;Module["wasmTable"]=wasmTable;var getWasmTableEntry=funcPtr=>{var func=wasmTableMirror[funcPtr];if(!func){if(funcPtr>=wasmTableMirror.length)wasmTableMirror.length=funcPtr+1;wasmTableMirror[funcPtr]=func=wasmTable.get(funcPtr)}return func};Module["getWasmTableEntry"]=getWasmTableEntry;var invokeEntryPoint=(ptr,arg)=>{runtimeKeepaliveCounter=0;noExitRuntime=0;var result=getWasmTableEntry(ptr)(arg);function finish(result){if(keepRuntimeAlive()){EXITSTATUS=result}else{__emscripten_thread_exit(result)}}finish(result)};Module["invokeEntryPoint"]=invokeEntryPoint;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;var registerTLSInit=tlsInitFunc=>PThread.tlsInitFunctions.push(tlsInitFunc);Module["registerTLSInit"]=registerTLSInit;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i8":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i16":GROWABLE_HEAP_I16()[ptr>>>1>>>0]=value;break;case"i32":GROWABLE_HEAP_I32()[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":GROWABLE_HEAP_F32()[ptr>>>2>>>0]=value;break;case"double":GROWABLE_HEAP_F64()[ptr>>>3>>>0]=value;break;case"*":GROWABLE_HEAP_U32()[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;function pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(2,0,1,pthread_ptr,attr,startRoutine,arg);return ___pthread_create_js(pthread_ptr,attr,startRoutine,arg)}Module["pthreadCreateProxied"]=pthreadCreateProxied;var _emscripten_has_threading_support=()=>typeof SharedArrayBuffer!="undefined";Module["_emscripten_has_threading_support"]=_emscripten_has_threading_support;function ___pthread_create_js(pthread_ptr,attr,startRoutine,arg){pthread_ptr>>>=0;attr>>>=0;startRoutine>>>=0;arg>>>=0;if(!_emscripten_has_threading_support()){return 6}var transferList=[];var error=0;if(ENVIRONMENT_IS_PTHREAD&&(transferList.length===0||error)){return pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg)}if(error)return error;var threadParams={startRoutine,pthread_ptr,arg,transferList};if(ENVIRONMENT_IS_PTHREAD){threadParams.cmd="spawnThread";postMessage(threadParams,transferList);return 0}return spawnThread(threadParams)}Module["___pthread_create_js"]=___pthread_create_js;var syscallGetVarargI=()=>{var ret=GROWABLE_HEAP_I32()[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>view.set(crypto.getRandomValues(new Uint8Array(view.byteLength)))};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.buffer instanceof ArrayBuffer?heapOrArray.subarray(idx,endPtr):heapOrArray.slice(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{GROWABLE_HEAP_U8().fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===GROWABLE_HEAP_I8().buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===GROWABLE_HEAP_I8().buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}GROWABLE_HEAP_I8().set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,GROWABLE_HEAP_I8(),ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(GROWABLE_HEAP_U8(),ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){GROWABLE_HEAP_I32()[buf>>>2>>>0]=stat.dev;GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stat.mode;GROWABLE_HEAP_U32()[buf+8>>>2>>>0]=stat.nlink;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stat.uid;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stat.gid;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);GROWABLE_HEAP_I32()[buf+32>>>2>>>0]=4096;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));GROWABLE_HEAP_U32()[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));GROWABLE_HEAP_U32()[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));GROWABLE_HEAP_U32()[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+40>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+8>>>2>>>0]=stats.blocks;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stats.bfree;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stats.bavail;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stats.files;GROWABLE_HEAP_I32()[buf+24>>>2>>>0]=stats.ffree;GROWABLE_HEAP_I32()[buf+28>>>2>>>0]=stats.fsid;GROWABLE_HEAP_I32()[buf+44>>>2>>>0]=stats.flags;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=GROWABLE_HEAP_U8().slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;function ___syscall_fcntl64(fd,cmd,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(3,0,1,fd,cmd,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;GROWABLE_HEAP_I16()[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(4,0,1,fd,op,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=termios.c_iflag||0;GROWABLE_HEAP_I32()[argp+4>>>2>>>0]=termios.c_oflag||0;GROWABLE_HEAP_I32()[argp+8>>>2>>>0]=termios.c_cflag||0;GROWABLE_HEAP_I32()[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){GROWABLE_HEAP_I8()[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=GROWABLE_HEAP_I32()[argp>>>2>>>0];var c_oflag=GROWABLE_HEAP_I32()[argp+4>>>2>>>0];var c_cflag=GROWABLE_HEAP_I32()[argp+8>>>2>>>0];var c_lflag=GROWABLE_HEAP_I32()[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(GROWABLE_HEAP_I8()[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();GROWABLE_HEAP_I16()[argp>>>1>>>0]=winsize[0];GROWABLE_HEAP_I16()[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(5,0,1,dirfd,path,flags,varargs);path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;function __emscripten_init_main_thread_js(tb){tb>>>=0;__emscripten_thread_init(tb,!ENVIRONMENT_IS_WORKER,1,!ENVIRONMENT_IS_WEB,65536,false);PThread.threadInitTLS()}Module["__emscripten_init_main_thread_js"]=__emscripten_init_main_thread_js;var maybeExit=()=>{if(!keepRuntimeAlive()){try{if(ENVIRONMENT_IS_PTHREAD)__emscripten_thread_exit(EXITSTATUS);else _exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;function __emscripten_thread_mailbox_await(pthread_ptr){pthread_ptr>>>=0;if(typeof Atomics.waitAsync==="function"){var wait=Atomics.waitAsync(GROWABLE_HEAP_I32(),pthread_ptr>>>2,pthread_ptr);wait.value.then(checkMailbox);var waitingAsync=pthread_ptr+128;Atomics.store(GROWABLE_HEAP_I32(),waitingAsync>>>2,1)}}Module["__emscripten_thread_mailbox_await"]=__emscripten_thread_mailbox_await;var checkMailbox=()=>{var pthread_ptr=_pthread_self();if(pthread_ptr){__emscripten_thread_mailbox_await(pthread_ptr);callUserCallback(__emscripten_check_mailbox)}};Module["checkMailbox"]=checkMailbox;function __emscripten_notify_mailbox_postmessage(targetThread,currThreadId){targetThread>>>=0;currThreadId>>>=0;if(targetThread==currThreadId){setTimeout(checkMailbox)}else if(ENVIRONMENT_IS_PTHREAD){postMessage({targetThread,cmd:"checkMailbox"})}else{var worker=PThread.pthreads[targetThread];if(!worker){return}worker.postMessage({cmd:"checkMailbox"})}}Module["__emscripten_notify_mailbox_postmessage"]=__emscripten_notify_mailbox_postmessage;var proxiedJSCallArgs=[];Module["proxiedJSCallArgs"]=proxiedJSCallArgs;function __emscripten_receive_on_main_thread_js(funcIndex,emAsmAddr,callingThread,numCallArgs,args){emAsmAddr>>>=0;callingThread>>>=0;args>>>=0;numCallArgs/=2;proxiedJSCallArgs.length=numCallArgs;var b=args>>>3;for(var i=0;i<numCallArgs;i++){if(HEAP64[b+2*i]){proxiedJSCallArgs[i]=HEAP64[b+2*i+1]}else{proxiedJSCallArgs[i]=GROWABLE_HEAP_F64()[b+2*i+1>>>0]}}var func=proxiedFunctionTable[funcIndex];PThread.currentProxiedOperationCallerThread=callingThread;var rtn=func(...proxiedJSCallArgs);PThread.currentProxiedOperationCallerThread=0;return rtn}Module["__emscripten_receive_on_main_thread_js"]=__emscripten_receive_on_main_thread_js;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __emscripten_thread_cleanup(thread){thread>>>=0;if(!ENVIRONMENT_IS_PTHREAD)cleanupThread(thread);else postMessage({cmd:"cleanupThread",thread})}Module["__emscripten_thread_cleanup"]=__emscripten_thread_cleanup;function __emscripten_thread_set_strongref(thread){thread>>>=0;if(ENVIRONMENT_IS_NODE){PThread.pthreads[thread].ref()}}Module["__emscripten_thread_set_strongref"]=__emscripten_thread_set_strongref;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(6,0,1,len,prot,flags,fd,offset,allocated,addr);len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;GROWABLE_HEAP_I32()[allocated>>>2>>>0]=res.allocated;GROWABLE_HEAP_U32()[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(7,0,1,addr,len,prot,flags,fd,offset);addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var _emscripten_get_now=()=>performance.timeOrigin+performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;function __setitimer_js(which,timeout_ms){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(8,0,1,which,timeout_ms);if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0}Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,GROWABLE_HEAP_U8(),outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);GROWABLE_HEAP_U32()[timezone>>>2>>>0]=stdTimezoneOffset*60;GROWABLE_HEAP_I32()[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var warnOnce=text=>{warnOnce.shown||={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;if(ENVIRONMENT_IS_NODE)text="warning: "+text;err(text)}};Module["warnOnce"]=warnOnce;var _emscripten_check_blocking_allowed=()=>{};Module["_emscripten_check_blocking_allowed"]=_emscripten_check_blocking_allowed;var runtimeKeepalivePush=()=>{runtimeKeepaliveCounter+=1};Module["runtimeKeepalivePush"]=runtimeKeepalivePush;var _emscripten_exit_with_live_runtime=()=>{runtimeKeepalivePush();throw"unwind"};Module["_emscripten_exit_with_live_runtime"]=_emscripten_exit_with_live_runtime;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;function _emscripten_get_heap_max(){return getHeapMax()}Module["_emscripten_get_heap_max"]=_emscripten_get_heap_max;var _emscripten_num_logical_cores=()=>ENVIRONMENT_IS_NODE?require("os").cpus().length:navigator["hardwareConcurrency"];Module["_emscripten_num_logical_cores"]=_emscripten_num_logical_cores;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=GROWABLE_HEAP_U8().length;if(requestedSize<=oldSize){return false}var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){GROWABLE_HEAP_I8()[buffer++>>>0]=str.charCodeAt(i)}GROWABLE_HEAP_I8()[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(9,0,1,__environ,environ_buf);__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;GROWABLE_HEAP_U32()[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(10,0,1,penviron_count,penviron_buf_size);penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();GROWABLE_HEAP_U32()[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);GROWABLE_HEAP_U32()[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(11,0,1,fd);try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(12,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(13,0,1,fd,offset,whence,newOffset);offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(14,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(GROWABLE_HEAP_U8().subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{GROWABLE_HEAP_I8().set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;PThread.init();FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var proxiedFunctionTable=[_proc_exit,exitOnMainThread,pthreadCreateProxied,___syscall_fcntl64,___syscall_ioctl,___syscall_openat,__mmap_js,__munmap_js,__setitimer_js,_environ_get,_environ_sizes_get,_fd_close,_fd_read,_fd_seek,_fd_write];var wasmImports;function assignWasmImports(){wasmImports={u:___pthread_create_js,c:___syscall_fcntl64,h:___syscall_ioctl,i:___syscall_openat,H:__abort_js,C:__emscripten_init_main_thread_js,q:__emscripten_notify_mailbox_postmessage,v:__emscripten_receive_on_main_thread_js,l:__emscripten_runtime_keepalive_clear,d:__emscripten_thread_cleanup,B:__emscripten_thread_mailbox_await,n:__emscripten_thread_set_strongref,x:__mmap_js,y:__munmap_js,m:__setitimer_js,z:__tzset_js,G:_clock_time_get,e:_emscripten_check_blocking_allowed,w:_emscripten_date_now,j:_emscripten_exit_with_live_runtime,r:_emscripten_get_heap_max,b:_emscripten_get_now,s:_emscripten_num_logical_cores,p:_emscripten_resize_heap,D:_environ_get,E:_environ_sizes_get,t:_exit,f:_fd_close,g:_fd_read,A:_fd_seek,F:_fd_write,a:wasmMemory,k:_proc_exit,o:_random_get}}var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["I"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["J"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["K"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["L"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["M"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["N"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["O"])(a0,a1);var __emscripten_tls_init=()=>(__emscripten_tls_init=wasmExports["P"])();var _pthread_self=()=>(_pthread_self=wasmExports["Q"])();var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["R"])(a0,a1);var __emscripten_thread_init=(a0,a1,a2,a3,a4,a5)=>(__emscripten_thread_init=wasmExports["T"])(a0,a1,a2,a3,a4,a5);var __emscripten_thread_crashed=()=>(__emscripten_thread_crashed=wasmExports["U"])();var __emscripten_run_on_main_thread_js=(a0,a1,a2,a3,a4)=>(__emscripten_run_on_main_thread_js=wasmExports["V"])(a0,a1,a2,a3,a4);var __emscripten_thread_free_data=a0=>(__emscripten_thread_free_data=wasmExports["W"])(a0);var __emscripten_thread_exit=a0=>(__emscripten_thread_exit=wasmExports["X"])(a0);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["Y"])(a0,a1);var __emscripten_check_mailbox=()=>(__emscripten_check_mailbox=wasmExports["Z"])();var ___trap=()=>(___trap=wasmExports["_"])();var _emscripten_stack_set_limits=(a0,a1)=>(_emscripten_stack_set_limits=wasmExports["$"])(a0,a1);var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["aa"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["ba"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["ca"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_p=f=>()=>f()>>>0;var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;wasmExports["Q"]=makeWrapper_p(wasmExports["Q"]);wasmExports["R"]=makeWrapper_ppp(wasmExports["R"]);wasmExports["ba"]=makeWrapper_pp(wasmExports["ba"]);wasmExports["ca"]=makeWrapper_p(wasmExports["ca"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}if(ENVIRONMENT_IS_PTHREAD){initRuntime();return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n',mN='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";if(ENVIRONMENT_IS_NODE){}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}{if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.error.bind(console);Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["w"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);wasmMemory=wasmExports["v"];updateMemoryViews();removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return HEAP8[ptr>>>0];case"i8":return HEAP8[ptr>>>0];case"i16":return HEAP16[ptr>>>1>>>0];case"i32":return HEAP32[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return HEAPF32[ptr>>>2>>>0];case"double":return HEAPF64[ptr>>>3>>>0];case"*":return HEAPU32[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":HEAP8[ptr>>>0]=value;break;case"i8":HEAP8[ptr>>>0]=value;break;case"i16":HEAP16[ptr>>>1>>>0]=value;break;case"i32":HEAP32[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":HEAPF32[ptr>>>2>>>0]=value;break;case"double":HEAPF64[ptr>>>3>>>0]=value;break;case"*":HEAPU32[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;var syscallGetVarargI=()=>{var ret=HEAP32[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>crypto.getRandomValues(view)};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.subarray(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{HEAPU8.fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===HEAP8.buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===HEAP8.buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}HEAP8.set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,HEAP8,ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){HEAP32[buf>>>2>>>0]=stat.dev;HEAP32[buf+4>>>2>>>0]=stat.mode;HEAPU32[buf+8>>>2>>>0]=stat.nlink;HEAP32[buf+12>>>2>>>0]=stat.uid;HEAP32[buf+16>>>2>>>0]=stat.gid;HEAP32[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);HEAP32[buf+32>>>2>>>0]=4096;HEAP32[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));HEAPU32[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));HEAPU32[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));HEAPU32[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){HEAP32[buf+4>>>2>>>0]=stats.bsize;HEAP32[buf+40>>>2>>>0]=stats.bsize;HEAP32[buf+8>>>2>>>0]=stats.blocks;HEAP32[buf+12>>>2>>>0]=stats.bfree;HEAP32[buf+16>>>2>>>0]=stats.bavail;HEAP32[buf+20>>>2>>>0]=stats.files;HEAP32[buf+24>>>2>>>0]=stats.ffree;HEAP32[buf+28>>>2>>>0]=stats.fsid;HEAP32[buf+44>>>2>>>0]=stats.flags;HEAP32[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=HEAPU8.slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;function ___syscall_fcntl64(fd,cmd,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;HEAP16[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=termios.c_iflag||0;HEAP32[argp+4>>>2>>>0]=termios.c_oflag||0;HEAP32[argp+8>>>2>>>0]=termios.c_cflag||0;HEAP32[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){HEAP8[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=HEAP32[argp>>>2>>>0];var c_oflag=HEAP32[argp+4>>>2>>>0];var c_cflag=HEAP32[argp+8>>>2>>>0];var c_lflag=HEAP32[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(HEAP8[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();HEAP16[argp>>>1>>>0]=winsize[0];HEAP16[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;HEAP32[allocated>>>2>>>0]=res.allocated;HEAPU32[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var _proc_exit=code=>{EXITSTATUS=code;if(!keepRuntimeAlive()){Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))};Module["_proc_exit"]=_proc_exit;var exitJS=(status,implicit)=>{EXITSTATUS=status;_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var maybeExit=()=>{if(!keepRuntimeAlive()){try{_exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;var _emscripten_get_now=()=>performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;var __setitimer_js=(which,timeout_ms)=>{if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0};Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);HEAPU32[timezone>>>2>>>0]=stdTimezoneOffset*60;HEAP32[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;function _emscripten_get_heap_max(){return getHeapMax()}Module["_emscripten_get_heap_max"]=_emscripten_get_heap_max;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=HEAPU8.length;var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){HEAP8[buffer++>>>0]=str.charCodeAt(i)}HEAP8[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;HEAPU32[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();HEAPU32[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);HEAPU32[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(HEAPU8.subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{HEAP8.set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var wasmImports={b:___syscall_fcntl64,f:___syscall_ioctl,g:___syscall_openat,u:__abort_js,j:__emscripten_runtime_keepalive_clear,o:__mmap_js,p:__munmap_js,k:__setitimer_js,q:__tzset_js,t:_clock_time_get,i:_emscripten_date_now,n:_emscripten_get_heap_max,m:_emscripten_resize_heap,s:_environ_get,c:_environ_sizes_get,a:_fd_close,e:_fd_read,r:_fd_seek,d:_fd_write,h:_proc_exit,l:_random_get};var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["w"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["x"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["y"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["z"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["A"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["B"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["C"])(a0,a1);var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["E"])(a0,a1);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["F"])(a0,a1);var ___trap=()=>(___trap=wasmExports["G"])();var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["H"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["I"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["J"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;var makeWrapper_p=f=>()=>f()>>>0;wasmExports["E"]=makeWrapper_ppp(wasmExports["E"]);wasmExports["I"]=makeWrapper_pp(wasmExports["I"]);wasmExports["J"]=makeWrapper_p(wasmExports["J"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n';class gN{constructor(e,r=1,n,a){ae(this,"logger");ae(this,"suppressNativeLog");ae(this,"taskQueue",[]);ae(this,"taskId",1);ae(this,"resultQueue",[]);ae(this,"busy",!1);ae(this,"worker");ae(this,"pathConfig");ae(this,"multiThread");ae(this,"nbThread");this.pathConfig=e,this.nbThread=r,this.multiThread=r>1,this.logger=a,this.suppressNativeLog=n}async moduleInit(e){if(!this.pathConfig["wllama.wasm"])throw new Error('"single-thread/wllama.wasm" is missing from pathConfig');let r=this.multiThread?fN:mN,n=r.replace("var Module","var ___Module");const a={pathConfig:this.pathConfig,nbThread:this.nbThread},o=[`const RUN_OPTIONS = ${JSON.stringify(a)};`,`function wModuleInit() { ${n}; return Module; }`,pN].join(`;

`);this.worker=Dh(o),this.worker.onmessage=this.onRecvMsg.bind(this),this.worker.onerror=this.logger.error;const i=await this.pushTask({verb:"module.init",args:[new Blob([r],{type:"text/javascript"})],callbackId:this.taskId++}),s=[];for(const l of e){const c=await this.fileAlloc(l.name,l.blob.size);s.push({id:c,...l})}return await Promise.all(s.map(l=>this.fileWrite(l.id,l.blob))),i}async wllamaStart(){const e=await this.pushTask({verb:"wllama.start",args:[],callbackId:this.taskId++});return this.parseResult(e)}async wllamaAction(e,r){const n=aN(r),a=await this.pushTask({verb:"wllama.action",args:[e,n],callbackId:this.taskId++});return nN(a)}async wllamaExit(){if(this.worker){const e=await this.pushTask({verb:"wllama.exit",args:[],callbackId:this.taskId++});this.parseResult(e),this.worker.terminate()}}async wllamaDebug(){const e=await this.pushTask({verb:"wllama.debug",args:[],callbackId:this.taskId++});return JSON.parse(e)}async fileAlloc(e,r){return(await this.pushTask({verb:"fs.alloc",args:[e,r],callbackId:this.taskId++})).fileId}async fileWrite(e,r){const n=r.stream().getReader();let a=0;for(;;){const{done:o,value:i}=await n.read();if(o)break;const s=i.byteLength;await this.pushTask({verb:"fs.write",args:[e,i,a],callbackId:this.taskId++},[i.buffer]),a+=s}}parseResult(e){const r=JSON.parse(e);if(r&&r.error)throw new Error("Unknown error, please see console.log");return r}pushTask(e,r){return new Promise((n,a)=>{this.taskQueue.push({resolve:n,reject:a,param:e,buffers:r}),this.runTaskLoop()})}async runTaskLoop(){if(!this.busy){for(this.busy=!0;;){const e=this.taskQueue.shift();if(!e)break;this.resultQueue.push(e),this.worker.postMessage(e.param,$b()?void 0:{transfer:e.buffers??[]})}this.busy=!1}}onRecvMsg(e){if(!e.data)return;const{verb:r,args:n}=e.data;if(r&&r.startsWith("console.")){if(this.suppressNativeLog)return;r.endsWith("debug")&&this.logger.debug(...n),r.endsWith("log")&&this.logger.log(...n),r.endsWith("warn")&&this.logger.warn(...n),r.endsWith("error")&&this.logger.error(...n);return}else r==="signal.abort"&&this.abort(n[0]);const{callbackId:a,result:o,err:i}=e.data;if(a){const s=this.resultQueue.findIndex(l=>l.param.callbackId===a);if(s!==-1){const l=this.resultQueue.splice(s,1)[0];i?l.reject(i):l.resolve(o)}else this.logger.error(`Cannot find waiting task with callbackId = ${a}`)}}abort(e){for(;this.resultQueue.length>0;){const r=this.resultQueue.pop();if(!r)break;r.reject(new Error(`Received abort signal from llama.cpp; Message: ${e||"(empty)"}`))}}}let Bn;Bn="__metadata__",pf="polyfill_for_older_version";class Ub{async getNameFromURL(e){return await Da(e,"")}async write(e,r,n){return this.writeMetadata(e,n),await Bb(e,r)}async download(e,r={}){const n=Dh(zb);let a=!1;r.signal&&(a=r.signal.aborted,r.signal.addEventListener("abort",()=>{a=!0,n.postMessage({action:"download-abort"})}),delete r.signal);const o=await Da(e,Bn),i=await Da(e,"");return await new Promise((s,l)=>{n.postMessage({action:"download",url:e,filename:i,metadataFileName:o,options:{headers:r.headers,aborted:a}}),n.onmessage=c=>{var u;if(c.data.ok)n.terminate(),s();else if(c.data.err)n.terminate(),l(c.data.err);else if(c.data.progress){const d=c.data.progress;(u=r.progressCallback)==null||u.call(r,d)}else l(new Error("Unknown message from worker")),console.error("Unknown message from worker",c.data)}})}async open(e){return await Hb(e)}async getSize(e){return await yN(e)}async getMetadata(e){const r=await Hb(e,Bn),n=await this.getSize(e);if(!r)return n>0?{etag:pf,originalSize:n,originalURL:""}:null;try{return await new Response(r).json()}catch{return null}}async list(){const e=await gl(),r=[],n={};for await(let[a,o]of e.entries())if(o.kind==="file"&&a.startsWith(Bn)){const i=(await o.getFile()).stream(),s=await new Response(i).json().catch(l=>null);n[a.replace(Bn,"")]=s}for await(let[a,o]of e.entries())o.kind==="file"&&!a.startsWith(Bn)&&r.push({name:a,size:await o.getFile().then(i=>i.size),metadata:n[a]||{originalSize:(await o.getFile()).size,originalURL:"",etag:""}});return r}async clear(){await this.deleteMany(()=>!0)}async delete(e){const r=await this.getNameFromURL(e);await this.deleteMany(n=>n.name===e||n.name===r)}async deleteMany(e){const r=await gl(),n=await this.list();for(const a of n)e(a)&&r.removeEntry(a.name)}async writeMetadata(e,r){const n=new Blob([JSON.stringify(r)],{type:"text/plain"});await Bb(e,n.stream(),Bn)}}async function Bb(t,e,r=""){try{const n=await Da(t,r),a=await _N(n);await a.truncate(0);const o=e.getReader();for(;;){const{done:i,value:s}=await o.read();if(i)break;await a.write(s)}await a.close()}catch(n){console.error("opfsWrite",n)}}async function Hb(t,e=""){const r=async o=>{try{return await(await(await gl()).getFileHandle(o)).getFile()}catch{return null}};let n=await r(t);if(n)return n;const a=await Da(t,e);return n=await r(a),n}async function yN(t,e=""){try{const r=await gl(),n=await Da(t,e);return(await(await r.getFileHandle(n)).getFile()).size}catch{return-1}}async function Da(t,e){const r=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(t)),n=Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("");return`${e}${n}_${t.split("/").pop()}`}async function gl(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("cache",{create:!0})}async function _N(t){const e=Dh(zb);let r,n;e.onmessage=o=>{o.data.ok?r(null):o.data.err&&n(o.data.err)};const a=o=>new Promise((i,s)=>{r=i,n=s,e.postMessage(o,$b()?void 0:{transfer:o.value?[o.value.buffer]:[]})});return await a({open:t}),{truncate:async()=>{},write:o=>a({value:o}),close:async()=>{await a({done:!0}),e.terminate()}}}const vN=3;ff=(t=>(t.VALID="valid",t.INVALID="invalid",t.DELETED="deleted",t))(ff||{}),Ai=class{constructor(t,e,r){ae(this,"modelManager");ae(this,"url");ae(this,"size");ae(this,"files");this.modelManager=t,this.url=e,r?(this.files=this.getAllFiles(r),this.size=Lh(this.files.map(n=>n.metadata.originalSize))):(this.files=[],this.size=0)}async open(){if(this.size===-1)throw new Ce("Model is deleted from the cache; Call ModelManager.downloadModel to re-download the model","load_error");const t=[];for(const e of this.files){const r=await this.modelManager.cacheManager.open(e.name);if(!r)throw new Error(`Failed to open file ${e.name}; Hint: the model may be invalid, please refresh it`);t.push(r)}return t}validate(){const t=Qn.parseModelUrl(this.url).length;if(this.size===-1)return"deleted";if(this.size<16||this.files.length!==t)return"invalid";for(const e of this.files)if(!e.metadata||e.metadata.originalSize!==e.size)return"invalid";return"valid"}async refresh(t={}){const e=Qn.parseModelUrl(this.url),r=e.map((l,c)=>({url:l,index:c}));this.modelManager.logger.debug("Downloading model files:",e);const n=this.modelManager.params.parallelDownloads??vN,a=await this.getTotalDownloadSize(e),o=[],i=async()=>{for(;r.length>0;){const l=r.shift();if(!l)break;await this.modelManager.cacheManager.download(l.url,{...t,progressCallback:({loaded:c})=>{var u;o[l.index]=c,(u=t.progressCallback)==null||u.call(t,{loaded:Lh(o),total:a})}})}},s=[];for(let l=0;l<n;l++)s.push(i()),o.push(0);await Promise.all(s),this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),this.size=this.files.reduce((l,c)=>l+c.metadata.originalSize,0)}async remove(){this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),await this.modelManager.cacheManager.deleteMany(t=>!!this.files.find(e=>e.name===t.name)),this.size=-1}getAllFiles(t){const e=new Set(Qn.parseModelUrl(this.url)),r=[];for(const n of e){const a=t.find(o=>o.metadata.originalURL===n);if(!a)throw new Error(`Model file not found: ${n}`);r.push(a)}return r.sort((n,a)=>n.metadata.originalURL.localeCompare(a.metadata.originalURL)),r}async getTotalDownloadSize(t){const e=(await Promise.all(t.map(r=>fetch(r,{method:"HEAD"})))).map(r=>Number(r.headers.get("content-length")||"0"));return Lh(e)}},Qn=class{constructor(t={}){ae(this,"cacheManager");ae(this,"params");ae(this,"logger");this.cacheManager=t.cacheManager||new Ub,this.params=t,this.logger=t.logger||console}static parseModelUrl(t){if(Array.isArray(t))return t;const e=/-(\d{5})-of-(\d{5})\.gguf$/,r=t.match(e);if(!r)return[t];const n=t.replace(e,""),a=r[2];return Array.from({length:Number(a)},(o,i)=>(i+1).toString().padStart(5,"0")).map(o=>`${n}-${o}-of-${a}.gguf`)}async getModels(t={}){const e=await this.cacheManager.list();let r=[];for(const n of e){const a=Qn.parseModelUrl(n.metadata.originalURL);(a.length===1||a[0]===n.metadata.originalURL)&&r.push(new Ai(this,n.metadata.originalURL,e))}return t.includeInvalid||(r=r.filter(n=>n.validate()==="valid")),r}async downloadModel(t,e={}){if(!t.endsWith(".gguf"))throw new Ce(`Invalid model URL: ${t}; URL must ends with ".gguf"`,"download_error");const r=new Ai(this,t,void 0);return r.validate()!=="valid"&&await r.refresh(e),r}async getModelOrDownload(t,e={}){var n;const r=(await this.getModels()).find(a=>a.url===t);return r?((n=e.progressCallback)==null||n.call(e,{loaded:r.size,total:r.size}),r):this.downloadModel(t,e)}async clear(){await this.cacheManager.clear()}};let Wb,Gb;Wb=/^([a-zA-Z0-9_\-\.]+)\/([a-zA-Z0-9_\-\.]+)$/,Gb="Hugging Face model ID is incorrect. Only regular alphanumeric characters, '-', '.' and '_' supported",I0={...console,debug:()=>{}},Ce=class extends Error{constructor(e,r="unknown_error"){super(e);ae(this,"type");this.type=r}},ic=class extends Error{constructor(){super("Operation aborted");ae(this,"name","AbortError")}},hf=class{constructor(t,e={}){ae(this,"cacheManager");ae(this,"modelManager");ae(this,"proxy",null);ae(this,"config");ae(this,"pathConfig");ae(this,"useMultiThread",!1);ae(this,"nbThreads",1);ae(this,"useEmbeddings",!1);ae(this,"loadedContextInfo",null);ae(this,"bosToken",-1);ae(this,"eosToken",-1);ae(this,"eotToken",-1);ae(this,"eogTokens",new Set);ae(this,"addBosToken",!1);ae(this,"addEosToken",!1);ae(this,"chatTemplate");ae(this,"metadata");ae(this,"samplingConfig",{});ae(this,"hasEncoder",!1);ae(this,"decoderStartToken",-1);ae(this,"nCachedTokens",0);if(dN(),!t)throw new Ce("AssetsPathConfig is required");this.pathConfig=t,this.config=e,this.cacheManager=e.cacheManager??new Ub,this.modelManager=e.modelManager??new Qn({cacheManager:this.cacheManager,logger:e.logger??console,parallelDownloads:e.parallelDownloads,allowOffline:e.allowOffline})}logger(){return this.config.logger??console}checkModelLoaded(){if(!this.isModelLoaded())throw new Ce("loadModel() is not yet called","model_not_loaded")}isModelLoaded(){return!!this.proxy&&!!this.metadata}getBOS(){return this.bosToken}getEOS(){return this.eosToken}getEOT(){return this.eotToken}isTokenEOG(t){return t===this.eosToken||t===this.eotToken||this.eogTokens.has(t)}getDecoderStartToken(){return this.decoderStartToken}getModelMetadata(){return this.checkModelLoaded(),this.metadata}isMultithread(){return this.checkModelLoaded(),this.useMultiThread}getNumThreads(){return this.checkModelLoaded(),this.useMultiThread?this.nbThreads:1}isEncoderDecoderArchitecture(){return this.checkModelLoaded(),this.hasEncoder}mustAddBosToken(){return this.checkModelLoaded(),this.addBosToken}mustAddEosToken(){return this.checkModelLoaded(),this.addEosToken}getChatTemplate(){return this.checkModelLoaded(),this.chatTemplate??null}async loadModelFromUrl(t,e={}){const r=Db(t)?t:t[0],n=await(e.useCache??!0?await this.modelManager.getModelOrDownload(r,e):await this.modelManager.downloadModel(r,e)).open();return await this.loadModel(n,e)}async loadModelFromHF(t,e,r={}){if(!t.match(Wb))throw new Ce(Gb,"download_error");if(!e.endsWith(".gguf"))throw new Ce("Only GGUF file is supported","download_error");return await this.loadModelFromUrl(`https://huggingface.co/${t}/resolve/main/${e}`,r)}async loadModel(t,e={}){const r=t instanceof Ai?await t.open():[...t];if(r.some(h=>h.size===0))throw new Ce("Input model (or splits) must be non-empty Blob or File","load_error");if(sN(r),this.proxy)throw new Ce("Module is already initialized","load_error");const n=await lN();n||this.logger().warn("Multi-threads are not supported in this environment, falling back to single-thread");const a=!!this.pathConfig["multi-thread/wllama.wasm"];a||this.logger().warn('Missing paths to "multi-thread/wllama.wasm", falling back to single-thread');const o=Math.floor((navigator.hardwareConcurrency||1)/2),i=e.n_threads??o;this.nbThreads=i,this.useMultiThread=n&&a&&i>1;const s=this.useMultiThread?{"wllama.wasm":Lb(this.pathConfig["multi-thread/wllama.wasm"])}:{"wllama.wasm":Lb(this.pathConfig["single-thread/wllama.wasm"])};this.proxy=new gN(s,this.useMultiThread?i:1,this.config.suppressNativeLog??!1,this.logger());const l=r.map((h,p)=>({name:`model-${p}.gguf`,blob:h}));await this.proxy.moduleInit(l);const c=await this.proxy.wllamaStart();if(!c.success)throw new Ce(`Error while calling start function, result = ${c}`);const u=await this.proxy.wllamaAction("load",{_name:"load_req",use_mmap:!0,use_mlock:!0,n_gpu_layers:0,seed:e.seed||Math.floor(Math.random()*1e5),n_ctx:e.n_ctx||1024,n_threads:this.useMultiThread?i:1,n_ctx_auto:!1,model_paths:l.map(h=>`models/${h.name}`),embeddings:e.embeddings,offload_kqv:e.offload_kqv,n_batch:e.n_batch,pooling_type:e.pooling_type,rope_scaling_type:e.rope_scaling_type,rope_freq_base:e.rope_freq_base,rope_freq_scale:e.rope_freq_scale,yarn_ext_factor:e.yarn_ext_factor,yarn_attn_factor:e.yarn_attn_factor,yarn_beta_fast:e.yarn_beta_fast,yarn_beta_slow:e.yarn_beta_slow,yarn_orig_ctx:e.yarn_orig_ctx,cache_type_k:e.cache_type_k,cache_type_v:e.cache_type_v}),d={...u,metadata:{}};for(let h=0;h<u.metadata_key.length;h++)d.metadata[u.metadata_key[h]]=u.metadata_val[h];this.bosToken=d.token_bos,this.eosToken=d.token_eos,this.eotToken=d.token_eot,this.useEmbeddings=!!e.embeddings,this.metadata={hparams:{nVocab:d.n_vocab,nCtxTrain:d.n_ctx_train,nEmbd:d.n_embd,nLayer:d.n_layer},meta:d.metadata},this.hasEncoder=!!d.has_encoder,this.decoderStartToken=d.token_decoder_start,this.addBosToken=d.add_bos_token,this.addEosToken=d.add_eos_token,this.chatTemplate=d.metadata["tokenizer.chat_template"],this.loadedContextInfo=d,this.eogTokens=new Set(d.list_tokens_eog),this.logger().debug({loadedCtxInfo:d})}getLoadedContextInfo(){if(this.checkModelLoaded(),!this.loadedContextInfo)throw new Ce("Loaded context info is not available");return{...this.loadedContextInfo}}async createEmbedding(t,e={}){this.checkModelLoaded();const r={skipBOS:!1,skipEOS:!1,...e};await this.samplingInit(this.samplingConfig),await this.kvClear();const n=await this.tokenize(t);return this.bosToken&&!r.skipBOS&&n.unshift(this.bosToken),this.eosToken&&!r.skipEOS&&n.push(this.eosToken),await this.embeddings(n)}async createChatCompletion(t,e){const r=await this.formatChat(t,!0);return e.stream?await this.createCompletionGenerator(r,e):await this.createCompletion(r,{...e,stream:!1})}async createCompletion(t,e){return e.stream?await this.createCompletionGenerator(t,e):await this.createCompletionImpl(t,{...e,stream:!1})}async createCompletionImpl(t,e){var s;this.checkModelLoaded(),this.samplingConfig=e.sampling??{},await this.samplingInit(this.samplingConfig);const r=new Set(e.stopTokens??[]);let n=await this.tokenize(t,!0);this.addBosToken&&n[0]!==this.bosToken&&n.unshift(this.bosToken),e.useCache?n=await this.computeNonCachedTokens(n):await this.kvClear(),await this.samplingAccept(n),this.isEncoderDecoderArchitecture()?(await this.encode(n),await this.decode([this.getDecoderStartToken()],{})):await this.decode(n,{});let a=new Uint8Array,o=!1;const i=()=>{o=!0};for(let l=0;l<(e.nPredict??1/0);l++){const c=await this.samplingSample();if(this.isTokenEOG(c.token)||r.has(c.token)||(a=oN([a,c.piece]),e.onNewToken&&e.onNewToken(c.token,c.piece,jh(a),{abortSignal:i}),o||((s=e.abortSignal)==null?void 0:s.aborted)))break;await this.samplingAccept([c.token]),await this.decode([c.token],{})}return jh(a)}createCompletionGenerator(t,e){return new Promise((r,n)=>{const a=hN(o=>{this.createCompletionImpl(t,{...e,onNewToken:(i,s,l)=>{o({token:i,piece:s,currentText:l},!1)}}).catch(n).then(()=>{o(void 0,!0)})});r(a())})}async samplingInit(t,e=[]){if(this.checkModelLoaded(),this.samplingConfig=t,!(await this.proxy.wllamaAction("sampling_init",{_name:"sint_req",...t,tokens:e})).success)throw new Ce("Failed to initialize sampling")}async getVocab(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("get_vocab",{_name:"gvoc_req"})).vocab}async lookupToken(t){this.checkModelLoaded();const e=await this.proxy.wllamaAction("lookup_token",{_name:"lkup_req",piece:t});return e.success?e.token:-1}async tokenize(t,e=!0){return this.checkModelLoaded(),(await this.proxy.wllamaAction("tokenize",{_name:"tokn_req",text:t,special:!!e})).tokens}async detokenize(t,e=!1){this.checkModelLoaded();const r=await this.proxy.wllamaAction("detokenize",{_name:"dtkn_req",tokens:t});return e?jh(r.buffer):r.buffer}async decode(t,e){var a;if(this.checkModelLoaded(),this.useEmbeddings)throw new Ce("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.");if(t.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ce("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const r=this.breakTokensIntoBatches(t,this.loadedContextInfo.n_batch);let n;for(let o=0;o<r.length;o++){if((a=e==null?void 0:e.abortSignal)!=null&&a.aborted)throw new ic;const i=r.length>1&&o<r.length-1;if(n=await this.proxy.wllamaAction("decode",{_name:"deco_req",tokens:r[o],skip_logits:e.skipLogits||i}),n.error)throw new Ce(n.error);if(!n.success)throw new Ce("Cannot encode, unknown error")}return this.nCachedTokens=n.n_past,{nPast:n.n_past}}async encode(t,e){var a;if(this.checkModelLoaded(),!this.hasEncoder)throw new Ce("This model does not use encoder-decoder architecture.","inference_error");if(this.useEmbeddings)throw new Ce("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.","inference_error");if(t.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ce("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const r=this.breakTokensIntoBatches(t,this.loadedContextInfo.n_batch);let n;for(let o=0;o<r.length;o++){if((a=e==null?void 0:e.abortSignal)!=null&&a.aborted)throw new ic;if(n=await this.proxy.wllamaAction("encode",{_name:"enco_req",tokens:r[o]}),n.error)throw new Ce(n.error);if(!n.success)throw new Ce("Cannot encode, unknown error")}return this.nCachedTokens=n.n_past,{nPast:n.n_past}}breakTokensIntoBatches(t,e){const r=[];for(let n=0;n<t.length;n+=e)r.push(t.slice(n,n+e));return r}async samplingSample(){this.checkModelLoaded();const t=await this.proxy.wllamaAction("sampling_sample",{_name:"ssam_req"});return{piece:t.piece,token:t.token}}async samplingAccept(t){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("sampling_accept",{_name:"sacc_req",tokens:t})).success)throw new Ce("samplingAccept unknown error")}async getLogits(t=40){this.checkModelLoaded();const e=await this.proxy.wllamaAction("get_logits",{_name:"glog_req",top_k:t}),r=[];for(let n=0;n<e.tokens.length;n++)r.push({token:e.tokens[n],p:e.probs[n]});return r}async embeddings(t){if(this.checkModelLoaded(),!this.useEmbeddings)throw new Ce("embeddings is disabled. Use wllama.setOptions({ embeddings: true }) to enable it.","inference_error");if(this.nCachedTokens>0&&this.logger().warn("Embeddings: KV cache is not empty, this may produce incorrect results"),this.nCachedTokens+t.length>this.loadedContextInfo.n_ctx)throw new Ce("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");if(t.length>this.loadedContextInfo.n_batch)throw new Ce("Embedding tokens does not fit into batch. Please increase n_batch when loading the model","inference_error");if(t.length>this.loadedContextInfo.n_ubatch)throw new Ce("Embedding tokens does not fit into physical batch. Please increase n_ubatch when loading the model","inference_error");const e=await this.proxy.wllamaAction("embeddings",{_name:"gemb_req",tokens:t});if(e.success)return e.embeddings;throw new Ce("embeddings unknown error")}async kvRemove(t,e){if(this.checkModelLoaded(),e!==0){if(!(await this.proxy.wllamaAction("kv_remove",{_name:"kvcr_req",n_keep:t,n_discard:e})).success)throw new Ce("kvRemove unknown error");this.nCachedTokens-=e}}async kvClear(){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("kv_clear",{_name:"kvcc_req"})).success)throw new Ce("kvClear unknown error");this.nCachedTokens=0}async formatChat(t,e,r){this.checkModelLoaded();const n=t.map(i=>i.role),a=t.map(i=>i.content),o=await this.proxy.wllamaAction("chat_format",{_name:"cfmt_req",roles:n,contents:a,tmpl:r,add_ass:e});if(!o.success)throw new Ce("formatChat unknown error");return o.formatted_chat}async setOptions(t){this.checkModelLoaded(),await this.proxy.wllamaAction("set_options",{_name:"opti_req",...t}),this.useEmbeddings=t.embeddings}async exit(){var t;await((t=this.proxy)==null?void 0:t.wllamaExit()),this.proxy=null}async _getDebugInfo(){return this.checkModelLoaded(),await this.proxy.wllamaDebug()}async _testBenchmark(t,e){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_benchmark",{_name:"tben_req",type:t,n_samples:e})}async _testPerplexity(t){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_perplexity",{_name:"tper_req",tokens:t})}async getCachedTokens(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("current_status",{_name:"stat_req"})).tokens}async computeNonCachedTokens(t){const e=await this.getCachedTokens();let r=0;for(;r<Math.min(e.length,t.length)&&e[r]===t[r];r++);return this.logger().debug(`Cache nKeep=${r}`),await this.kvRemove(r,-1),t.slice(r,t.length)}};const wN="/NoLLMChat/assets/wllama-DmHb_wK-.wasm",bN="/NoLLMChat/assets/wllama-1y9tp5Pj.wasm",qb=t=>t.reduce((e,r)=>"text"in r?`${e} ${r.text}`:e,""),$h=t=>typeof t=="string"?t:Array.isArray(t)?qb(t):typeof t.content=="string"?t.content:qb(t.content);function EN(t){if(typeof t=="string"||!Array.isArray(t))return[{role:"user",content:typeof t=="string"?t:t.toString()}];const e=[];return t.map(r=>{if(typeof r=="string")e.push({role:"assistant",content:r});else if(r instanceof to)e.push({role:"user",content:$h(r.content)});else if(r instanceof Jn)e.push({role:"assistant",content:$h(r.content)});else if(r instanceof no)e.push({role:"system",content:$h(r.content)});else throw new Error(`Invalid message type ${JSON.stringify(r)}`)}),e}const SN={"single-thread/wllama.wasm":wN,"multi-thread/wllama.wasm":bN};let Br;_0=async(t,e)=>{var i;Br=new hf(SN,{logger:{debug:(...s)=>t0(...s),log:(...s)=>aI(...s),warn:(...s)=>vn(...s),error:(...s)=>Sl(...s)}});const r=({loaded:s,total:l})=>{var d;const c=Math.round(s/l*100),u=`Downloading... ${c}%`;(d=e.callback)==null||d.call(e,{text:u,progress:c,timeElapsed:0})},[n,a,...o]=t.split("/");await Br.loadModelFromHF(`${n}/${a}`,o.join("/"),{progressCallback:r}),(i=e.callback)==null||i.call(e,{text:"Model loaded!",progress:100,timeElapsed:0})};async function xN(){await(Br==null?void 0:Br.exit()),Br=void 0}u0=async function(t,e){var o,i,s,l,c,u,d,h;let r="";const n=EN(t),a=await(Br==null?void 0:Br.createChatCompletion(n,{nPredict:(o=e==null?void 0:e.configurable)!=null&&o.nPredict?+((i=e==null?void 0:e.configurable)==null?void 0:i.nPredict):void 0,sampling:{temp:(s=e==null?void 0:e.configurable)!=null&&s.temperature?+((l=e==null?void 0:e.configurable)==null?void 0:l.temperature):void 0,top_k:(c=e==null?void 0:e.configurable)!=null&&c.topK?+((u=e==null?void 0:e.configurable)==null?void 0:u.topK):void 0,top_p:(d=e==null?void 0:e.configurable)!=null&&d.topP?+((h=e==null?void 0:e.configurable)==null?void 0:h.topP):void 0},onNewToken:(p,f,y)=>{var _;const m=y.slice(r.length);(_=e.onNewToken)==null||_.call(e,p,f,m),r=y}}));return new Jn(a||"")};const kN=g.memo(({children:t})=>{const e=$l(o=>o.destroy),r=Nl(o=>o.destroy),n=$l(o=>o.init),a=Nl(o=>o.init);return g.useEffect(()=>(n(),a(),()=>{e(),r(),xN().catch(()=>{})}),[e,r,n,a]),t});function Vb(t){return e=>v.jsx(kN,{children:v.jsx(t,{...e})})}const AN=g.lazy(()=>Ka(()=>import("./ChatApplication-DcNxDajf.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),TN=g.lazy(()=>Ka(()=>import("./EditorApplication-BX4Ph5-G.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([13,1,2,8,9,10]))),MN=g.lazy(()=>Ka(()=>import("./VSLiteApplication-jz_3VUza.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([14,1,2,8,9,10,15])));function FN(){var r;const t=Gr(n=>n.currentSession),e=g.useMemo(()=>{var n,a;if(!(t!=null&&t.id))return v.jsx(Ya,{simple:!0,className:"w-full h-full"});if(t.main_source_type==="Thread")return v.jsx(AN,{});if(((n=t.main_node)==null?void 0:n.node_type)==="EDITOR_APP")return v.jsx(TN,{});if(((a=t.main_node)==null?void 0:a.node_type)==="VSLITE_APP")return v.jsx(MN,{})},[t==null?void 0:t.id,t==null?void 0:t.main_source_type,(r=t==null?void 0:t.main_node)==null?void 0:r.node_type]);return v.jsx(g.Suspense,{fallback:v.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:e})}const RN=Vb(FN),ON=g.lazy(()=>Ka(()=>import("./Home-B_L1j9Wn.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([16,1,2,7,4,8,9,10,5,6,17,18,15]))),NN=()=>v.jsx(g.Suspense,{fallback:v.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:v.jsx(ON,{})}),IN=Vb(NN),PN=g.lazy(()=>Ka(()=>import("./DocumentViewer-BJK3jKm-.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([19,1,2,20]))),CN=()=>{const{documentId:t}=Jf();return v.jsx(g.Suspense,{fallback:v.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:v.jsx(PN,{name:t||""})})},jN=g.lazy(()=>Ka(()=>import("./SessionList-CbGJ9j_E.js").then(async t=>(await t.__tla,t)),__vite__mapDeps([21,1,2,18,11,12]))),LN=()=>v.jsx(g.Suspense,{fallback:v.jsx(Ya,{flickeringGrid:!0,className:"w-full h-full"}),children:v.jsx(jN,{})});function ti(){const t=Kf();return Sl("[ERROR]",t),v.jsx(e0,{})}const DN=XE(v.jsxs(Rr,{errorElement:v.jsx(ti,{}),children:[v.jsxs(Rr,{element:v.jsx(S_,{requiredSession:!0}),children:[v.jsx(Rr,{path:In.whiteboard,Component:IN,errorElement:v.jsx(ti,{})}),v.jsx(Rr,{path:In.application,errorElement:v.jsx(ti,{}),Component:RN}),v.jsx(Rr,{path:"*",element:v.jsx(JE,{to:In.sessions})})]}),v.jsxs(Rr,{element:v.jsx(S_,{}),children:[v.jsx(Rr,{path:In.document,errorElement:v.jsx(ti,{}),Component:CN}),v.jsx(Rr,{path:In.sessions,errorElement:v.jsx(ti,{}),Component:LN})]})]})),$N=(t,e)=>{switch(ey){case"browser":return om(t,e);case"hash":return ES(t);default:return om(t,e)}},zN=$N(DN,{basename:"/NoLLMChat/"});t0("[BASE_URL]","/NoLLMChat/");let Zb;Zb=g.memo(()=>{const t=!window.location.pathname.includes("/NoLLMChat/");return g.useLayoutEffect(()=>{t&&(window.location.href="/NoLLMChat/".replace("//","/"))},[t]),t?v.jsx(Ya,{className:"w-screen h-screen",simple:!0}):v.jsx(IS,{router:zN})},()=>!0),P0=Object.freeze(Object.defineProperty({__proto__:null,default:Zb},Symbol.toStringTag,{value:"Module"}))});export{Yh as $,Jn as A,Hr as B,Xa as C,Qa as D,Kn as E,He as F,eo as G,to as H,Xh as I,xl as J,kl as K,Qh as L,Bt as M,ep as N,ro as O,Al as P,tp as Q,Tl as R,no as S,r0 as T,rp as U,Wr as V,n0 as W,np as X,ap as Y,op as Z,ip as _,iI as __tla,ao as a,a0 as a$,sp as a0,lp as a1,Ml as a2,Ht as a3,cp as a4,Fl as a5,up as a6,dp as a7,Rl as a8,Ol as a9,o0 as aA,hp as aB,ur as aC,gi as aD,Yn as aE,i0 as aF,Et as aG,oo as aH,it as aI,pp as aJ,fp as aK,yi as aL,mp as aM,_i as aN,st as aO,gp as aP,yp as aQ,wn as aR,_p as aS,Nl as aT,io as aU,Il as aV,vi as aW,wi as aX,Pl as aY,Cl as aZ,bi as a_,Wt as aa,so as ab,vp as ac,jl as ad,wp as ae,bp as af,Ep as ag,Sp as ah,xp as ai,kp as aj,Ap as ak,Tp as al,Mp as am,Fp as an,Rp as ao,Op as ap,Np as aq,Ip as ar,Pp as as,Ll as at,Dl as au,Cp as av,$l as aw,Ei as ax,Si as ay,zl as az,jp as b,Lp as b$,Dp as b0,s0 as b1,l0 as b2,$p as b3,zp as b4,Up as b5,Bp as b6,c0 as b7,bn as b8,u0 as b9,d0 as bA,lo as bB,Hp as bC,Wp as bD,Gp as bE,h0 as bF,Ul as bG,p0 as bH,Bl as bI,Hl as bJ,co as bK,Wl as bL,Gl as bM,qp as bN,ql as bO,dr as bP,Gt as bQ,Xn as bR,f0 as bS,m0 as bT,g0 as bU,y0 as bV,Vp as bW,Zp as bX,Jp as bY,Vl as bZ,Kp as b_,_0 as ba,En as bb,Yp as bc,xi as bd,v0 as be,w0 as bf,Ie as bg,Xp as bh,uo as bi,hr as bj,Ot as bk,b0 as bl,E0 as bm,S0 as bn,Zl as bo,x0 as bp,Qp as bq,ef as br,tf as bs,ki as bt,Sn as bu,k0 as bv,A0 as bw,T0 as bx,M0 as by,rf as bz,F0 as c,nf as c0,Jl as c1,af as c2,R0 as c3,Kl as c4,Yl as c5,Xl as c6,of as c7,Ql as c8,ec as c9,tc as ca,rc as cb,nc as cc,ac as cd,sf as ce,lf as cf,O0 as cg,cf as ch,uf as ci,df as cj,N0 as ck,oc as cl,I0 as cm,Ce as cn,ic as co,hf as cp,pf as cq,ff as cr,Ai as cs,Qn as ct,mf as cu,P0 as cv,sc as d,lc as e,ea as f,We as g,ta as h,xn as i,gf as j,cc as k,uc as l,yf as m,kn as n,Ti as o,yt as p,_f as q,dc as r,hc as s,pc as t,Gr as u,fc as v,mc as w,gc as x,Mi as y,ho as z};
